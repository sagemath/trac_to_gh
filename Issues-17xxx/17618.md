# Issue 17618: Update matplotlib so that plot_directive is less broken

archive/issues_017381.json:
```json
{
    "body": "In #17498, some problems appeared with the `plot_directive module` from matplotlib, in particular, the impossibility to remove the `(Source code)` link (that points nowhere) above images.\n\nWith 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.\n\nTarball:\n[http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2](http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2)\n\n**CC:**  @kiwifb @strogdon @kcrisman @gagern @novoselt\n\n**Branch/Commit:** [9dc580db712380bbcfe20c958d5125696ceb5e70](https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70)\n\n**Reviewer:** Steven Trogdon\n\n**Author:** Thierry Monteil, Fran\u00e7ois Bissey\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17618\n\n",
    "closed_at": "2015-06-23T22:34:25Z",
    "created_at": "2015-01-11T17:32:47Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Update matplotlib so that plot_directive is less broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17618",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
In #17498, some problems appeared with the `plot_directive module` from matplotlib, in particular, the impossibility to remove the `(Source code)` link (that points nowhere) above images.

With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.

Tarball:
[http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2](http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2)

**CC:**  @kiwifb @strogdon @kcrisman @gagern @novoselt

**Branch/Commit:** [9dc580db712380bbcfe20c958d5125696ceb5e70](https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70)

**Reviewer:** Steven Trogdon

**Author:** Thierry Monteil, Fran√ßois Bissey

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/17618





---

archive/issue_comments_304616.json:
```json
{
    "body": "**Branch:** [u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken)",
    "created_at": "2015-01-12T07:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304616",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Branch:** [u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken)



---

archive/issue_comments_304617.json:
```json
{
    "body": "**Commit:** [374eca4c6161a7216b48ebb5ea772d62c5695f11](https://github.com/sagemath/sagetrac-mirror/commit/374eca4c6161a7216b48ebb5ea772d62c5695f11)",
    "created_at": "2015-01-12T07:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304617",
    "user": "https://github.com/kiwifb"
}
```

**Commit:** [374eca4c6161a7216b48ebb5ea772d62c5695f11](https://github.com/sagemath/sagetrac-mirror/commit/374eca4c6161a7216b48ebb5ea772d62c5695f11)



---

archive/issue_comments_304618.json:
```json
{
    "body": "<a id='comment:3'></a>\nI am expecting broken doctests with matplotlib 1.4.x? Did you find any?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fdfecf993adad1466dd6ac6ce839ded8e1b1894\">2fdfecf</a></td><td><code>#17618 package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef72f4b0d2d1f976787a647edfec866d3c1f7110\">ef72f4b</a></td><td><code>#17618 remove upstream-applied patches</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/188c737143b08b43098fd2f44918424b0e98aa12\">188c737</a></td><td><code>#17618 update setup.py.patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/374eca4c6161a7216b48ebb5ea772d62c5695f11\">374eca4</a></td><td><code>#17618 update SPKG.txt</code></td></tr></table>\n",
    "created_at": "2015-01-12T07:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304618",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
I am expecting broken doctests with matplotlib 1.4.x? Did you find any?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fdfecf993adad1466dd6ac6ce839ded8e1b1894">2fdfecf</a></td><td><code>#17618 package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef72f4b0d2d1f976787a647edfec866d3c1f7110">ef72f4b</a></td><td><code>#17618 remove upstream-applied patches</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/188c737143b08b43098fd2f44918424b0e98aa12">188c737</a></td><td><code>#17618 update setup.py.patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/374eca4c6161a7216b48ebb5ea772d62c5695f11">374eca4</a></td><td><code>#17618 update SPKG.txt</code></td></tr></table>




---

archive/issue_comments_304619.json:
```json
{
    "body": "<a id='comment:4'></a>\nIs the tarball ready ?\n\nNathann",
    "created_at": "2015-01-12T14:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304619",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Is the tarball ready ?

Nathann



---

archive/issue_comments_304620.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [fbissey](#comment%3A3):\n> I am expecting broken doctests with matplotlib 1.4.x? Did you find any?\n\n\nI am indeed getting some `MatplotlibDeprecationWarning`\n\nReplying to [ncohen](#comment%3A4):\n> Is the tarball ready ?\n\n\nAs explained on [this thread](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/77150), i would like to be sure to make a reproducible tarball. If you want to test for #17498, you can use the upstream tarball meanwhile (we only remove some dirs it to save space but there is no difference otherwise).",
    "created_at": "2015-01-12T15:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304620",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:5'></a>
Replying to [fbissey](#comment%3A3):
> I am expecting broken doctests with matplotlib 1.4.x? Did you find any?


I am indeed getting some `MatplotlibDeprecationWarning`

Replying to [ncohen](#comment%3A4):
> Is the tarball ready ?


As explained on [this thread](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/77150), i would like to be sure to make a reproducible tarball. If you want to test for #17498, you can use the upstream tarball meanwhile (we only remove some dirs it to save space but there is no difference otherwise).



---

archive/issue_comments_304621.json:
```json
{
    "body": "<a id='comment:6'></a>\n> As explained on [this thread](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/77150), i would like to be sure to make a reproducible tarball.\n\n\nIt seems to be the thread on which I mentionned a workaround using \"diff -R\". I saw your answer but I did not understand it, and so I wait for the answer to the private email I sent you after that.\n\nNathann",
    "created_at": "2015-01-12T15:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304621",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>
> As explained on [this thread](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/77150), i would like to be sure to make a reproducible tarball.


It seems to be the thread on which I mentionned a workaround using "diff -R". I saw your answer but I did not understand it, and so I wait for the answer to the private email I sent you after that.

Nathann



---

archive/issue_comments_304622.json:
```json
{
    "body": "<a id='comment:7'></a>\nHere are the 13 doctest failures that appeared in a `make ptestlong`, quite a few are redundant:\n\n```\nFile \"src/doc/en/bordeaux_2008/introduction.rst\", line 75, in doc.en.bordeaux_2008.introduction\nFailed example:\n    list_plot3d(v, interpolation_type='nn')\nExpected:\n    Graphics3d Object\nGot:\n    doctest:137: MatplotlibDeprecationWarning: The matplotlib.delaunay module was deprecated in version 1.4. Use matplotlib.tri.Triangulation instead.\n    Graphics3d Object\n```\n\n```\nFile \"src/sage/graphs/generic_graph.py\", line 15636, in sage.graphs.generic_graph.GenericGraph.plot\nFailed example:\n    D.plot(edge_labels=True, color_by_label={'a':'blue', 'b':'red'}, edge_style='dashed')\nExpected:\n    Graphics object consisting of 34 graphics primitives\nGot:\n    doctest:239: FormatterWarning: Exception in text/plain formatter: 'module' object has no attribute '_Base'\n    None\n```\n\n```\nFile \"src/sage/plot/arrow.py\", line 349, in sage.plot.arrow.Arrow._render_on_subplot\nFailed example:\n    a.save(filename=filename)\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 850, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.arrow.Arrow._render_on_subplot[11]>\", line 1, in <module>\n        a.save(filename=filename)\n      File \"/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/misc/decorators.py\", line 471, in wrapper\n        return func(*args, **kwds)\n      File \"/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/plot/graphics.py\", line 3048, in save\n        figure = self.matplotlib(**options)\n      File \"/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/plot/graphics.py\", line 2494, in matplotlib\n        g._render_on_subplot(subplot)\n      File \"/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/plot/arrow.py\", line 414, in _render_on_subplot\n        class ConditionalStroke(pe._Base):\n    AttributeError: 'module' object has no attribute '_Base'\n```\n\n\n```\nFile \"src/sage/plot/arrow.py\", line 523, in sage.plot.arrow.arrow2d\nFailed example:\n    arrow2d((1, 1), (3, 3), linestyle='dashed')\nExpected:\n    Graphics object consisting of 1 graphics primitive\nGot:\n    doctest:239: FormatterWarning: Exception in text/plain formatter: 'module' object has no attribute '_Base'\n    None\n```\n\n\n```\nFile \"src/sage/plot/arrow.py\", line 525, in sage.plot.arrow.arrow2d\nFailed example:\n    arrow2d((1, 1), (3, 3), linestyle='--')\nExpected:\n    Graphics object consisting of 1 graphics primitive\nGot:\n    None\n```\n\n\n\n```\nFile \"src/sage/plot/colors.py\", line 22, in sage.plot.colors\nFailed example:\n    sorted(colormaps)\nExpected:\n    ['Accent', 'Accent_r', 'Blues', 'Blues_r', 'BrBG', 'BrBG_r', ...]\nGot:\n    [u'Accent',\n     u'Accent_r',\n     u'Blues',\n     u'Blues_r',\n     u'BrBG',\n```\n\n\n```\nFile \"src/sage/plot/colors.py\", line 1337, in sage.plot.colors.get_cmap\nFailed example:\n    sorted(colormaps)\nExpected:\n    ['Accent', 'Accent_r', 'Blues', 'Blues_r', ...]\nGot:\n    [u'Accent',\n     u'Accent_r',\n     u'Blues',\n     u'Blues_r',\n     u'BrBG',\n     u'BrBG_r',\n```\n\n```\nFile \"src/sage/plot/colors.py\", line 1398, in sage.plot.colors.Colormaps\nFailed example:\n    sorted(colormaps)\nExpected:\n    ['Accent', 'Accent_r', 'Blues', 'Blues_r', ...]\nGot:\n    [u'Accent',\n     u'Accent_r',\n     u'Blues',\n     u'Blues_r',\n```\n\n```\nFile \"src/sage/plot/colors.py\", line 1645, in sage.plot.colors.Colormaps.__delitem__\nFailed example:\n    maps.popitem()\nExpected:\n    ('Spectral', <matplotlib.colors.LinearSegmentedColormap object at ...>)\nGot:\n    (u'Spectral', <matplotlib.colors.LinearSegmentedColormap object at 0x4afd4a0c>)\n```\n\n```\nFile \"src/sage/plot/graphics.py\", line 1091, in sage.plot.graphics.Graphics.add_primitive\nFailed example:\n    G\nExpected:\n    Graphics object consisting of 2 graphics primitives\nGot:\n    doctest:239: FormatterWarning: Exception in text/plain formatter: 'module' object has no attribute '_Base'\n    None\n```\n\n```\nFile \"src/sage/plot/graphics.py\", line 2096, in sage.plot.graphics.Graphics.?\nFailed example:\n    p._matplotlib_tick_formatter(subplot, **d)\nExpected:\n    (<matplotlib.axes.AxesSubplot object at ...>,\n    <matplotlib.ticker.MaxNLocator object at ...>,\n    <matplotlib.ticker.MaxNLocator object at ...>,\n    <matplotlib.ticker.OldScalarFormatter object at ...>,\n    <matplotlib.ticker.OldScalarFormatter object at ...>)\nGot:\n    (<matplotlib.axes._subplots.AxesSubplot object at 0x4b8da48c>,\n     <matplotlib.ticker.MaxNLocator object at 0x4bbe3dac>,\n     <matplotlib.ticker.MaxNLocator object at 0x4bbe3f2c>,\n     <matplotlib.ticker.OldScalarFormatter object at 0x4bbe388c>,\n     <matplotlib.ticker.OldScalarFormatter object at 0x4bbe332c>)\n```\n\n```\nFile \"src/sage/plot/plot3d/list_plot3d.py\", line 90, in sage.plot.plot3d.list_plot3d.list_plot3d\nFailed example:\n    list_plot3d(m, texture='yellow', interpolation_type='nn',frame_aspect_ratio=[1,1,1/3])\nExpected:\n    Graphics3d Object\nGot:\n    doctest:137: MatplotlibDeprecationWarning: The matplotlib.delaunay module was deprecated in version 1.4. Use matplotlib.tri.Triangulation instead.\n    Graphics3d Object\n```\n\n```\nFile \"src/sage/stats/distributions/discrete_gaussian_lattice.py\", line 133, in sage.stats.distributions.discrete_gaussian_lattice.Disc\nreteGaussianDistributionLatticeSampler\nFailed example:\n    list_plot3d(l, point_list=True, interploation='nn')\nExpected:\n    Graphics3d Object\nGot:\n    doctest:137: MatplotlibDeprecationWarning: The matplotlib.delaunay module was deprecated in version 1.4. Use matplotlib.tri.Triang\nulation instead.\n    Graphics3d Object\n```",
    "created_at": "2015-01-12T19:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304622",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:7'></a>
Here are the 13 doctest failures that appeared in a `make ptestlong`, quite a few are redundant:

```
File "src/doc/en/bordeaux_2008/introduction.rst", line 75, in doc.en.bordeaux_2008.introduction
Failed example:
    list_plot3d(v, interpolation_type='nn')
Expected:
    Graphics3d Object
Got:
    doctest:137: MatplotlibDeprecationWarning: The matplotlib.delaunay module was deprecated in version 1.4. Use matplotlib.tri.Triangulation instead.
    Graphics3d Object
```

```
File "src/sage/graphs/generic_graph.py", line 15636, in sage.graphs.generic_graph.GenericGraph.plot
Failed example:
    D.plot(edge_labels=True, color_by_label={'a':'blue', 'b':'red'}, edge_style='dashed')
Expected:
    Graphics object consisting of 34 graphics primitives
Got:
    doctest:239: FormatterWarning: Exception in text/plain formatter: 'module' object has no attribute '_Base'
    None
```

```
File "src/sage/plot/arrow.py", line 349, in sage.plot.arrow.Arrow._render_on_subplot
Failed example:
    a.save(filename=filename)
Exception raised:
    Traceback (most recent call last):
      File "/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 850, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.arrow.Arrow._render_on_subplot[11]>", line 1, in <module>
        a.save(filename=filename)
      File "/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/misc/decorators.py", line 471, in wrapper
        return func(*args, **kwds)
      File "/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/plot/graphics.py", line 3048, in save
        figure = self.matplotlib(**options)
      File "/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/plot/graphics.py", line 2494, in matplotlib
        g._render_on_subplot(subplot)
      File "/opt/sagemath/sage-6.3/local/lib/python2.7/site-packages/sage/plot/arrow.py", line 414, in _render_on_subplot
        class ConditionalStroke(pe._Base):
    AttributeError: 'module' object has no attribute '_Base'
```


```
File "src/sage/plot/arrow.py", line 523, in sage.plot.arrow.arrow2d
Failed example:
    arrow2d((1, 1), (3, 3), linestyle='dashed')
Expected:
    Graphics object consisting of 1 graphics primitive
Got:
    doctest:239: FormatterWarning: Exception in text/plain formatter: 'module' object has no attribute '_Base'
    None
```


```
File "src/sage/plot/arrow.py", line 525, in sage.plot.arrow.arrow2d
Failed example:
    arrow2d((1, 1), (3, 3), linestyle='--')
Expected:
    Graphics object consisting of 1 graphics primitive
Got:
    None
```



```
File "src/sage/plot/colors.py", line 22, in sage.plot.colors
Failed example:
    sorted(colormaps)
Expected:
    ['Accent', 'Accent_r', 'Blues', 'Blues_r', 'BrBG', 'BrBG_r', ...]
Got:
    [u'Accent',
     u'Accent_r',
     u'Blues',
     u'Blues_r',
     u'BrBG',
```


```
File "src/sage/plot/colors.py", line 1337, in sage.plot.colors.get_cmap
Failed example:
    sorted(colormaps)
Expected:
    ['Accent', 'Accent_r', 'Blues', 'Blues_r', ...]
Got:
    [u'Accent',
     u'Accent_r',
     u'Blues',
     u'Blues_r',
     u'BrBG',
     u'BrBG_r',
```

```
File "src/sage/plot/colors.py", line 1398, in sage.plot.colors.Colormaps
Failed example:
    sorted(colormaps)
Expected:
    ['Accent', 'Accent_r', 'Blues', 'Blues_r', ...]
Got:
    [u'Accent',
     u'Accent_r',
     u'Blues',
     u'Blues_r',
```

```
File "src/sage/plot/colors.py", line 1645, in sage.plot.colors.Colormaps.__delitem__
Failed example:
    maps.popitem()
Expected:
    ('Spectral', <matplotlib.colors.LinearSegmentedColormap object at ...>)
Got:
    (u'Spectral', <matplotlib.colors.LinearSegmentedColormap object at 0x4afd4a0c>)
```

```
File "src/sage/plot/graphics.py", line 1091, in sage.plot.graphics.Graphics.add_primitive
Failed example:
    G
Expected:
    Graphics object consisting of 2 graphics primitives
Got:
    doctest:239: FormatterWarning: Exception in text/plain formatter: 'module' object has no attribute '_Base'
    None
```

```
File "src/sage/plot/graphics.py", line 2096, in sage.plot.graphics.Graphics.?
Failed example:
    p._matplotlib_tick_formatter(subplot, **d)
Expected:
    (<matplotlib.axes.AxesSubplot object at ...>,
    <matplotlib.ticker.MaxNLocator object at ...>,
    <matplotlib.ticker.MaxNLocator object at ...>,
    <matplotlib.ticker.OldScalarFormatter object at ...>,
    <matplotlib.ticker.OldScalarFormatter object at ...>)
Got:
    (<matplotlib.axes._subplots.AxesSubplot object at 0x4b8da48c>,
     <matplotlib.ticker.MaxNLocator object at 0x4bbe3dac>,
     <matplotlib.ticker.MaxNLocator object at 0x4bbe3f2c>,
     <matplotlib.ticker.OldScalarFormatter object at 0x4bbe388c>,
     <matplotlib.ticker.OldScalarFormatter object at 0x4bbe332c>)
```

```
File "src/sage/plot/plot3d/list_plot3d.py", line 90, in sage.plot.plot3d.list_plot3d.list_plot3d
Failed example:
    list_plot3d(m, texture='yellow', interpolation_type='nn',frame_aspect_ratio=[1,1,1/3])
Expected:
    Graphics3d Object
Got:
    doctest:137: MatplotlibDeprecationWarning: The matplotlib.delaunay module was deprecated in version 1.4. Use matplotlib.tri.Triangulation instead.
    Graphics3d Object
```

```
File "src/sage/stats/distributions/discrete_gaussian_lattice.py", line 133, in sage.stats.distributions.discrete_gaussian_lattice.Disc
reteGaussianDistributionLatticeSampler
Failed example:
    list_plot3d(l, point_list=True, interploation='nn')
Expected:
    Graphics3d Object
Got:
    doctest:137: MatplotlibDeprecationWarning: The matplotlib.delaunay module was deprecated in version 1.4. Use matplotlib.tri.Triang
ulation instead.
    Graphics3d Object
```



---

archive/issue_comments_304623.json:
```json
{
    "body": "<a id='comment:8'></a>\nSome redundancy indeed. Let's see what's to be done:\n1. Add the missing \"u\" to doctest (for unicode if I am not mistaken). That's one of the easiest bit.\n2. Get rid of calls to _base in sage/plot/*\n3. Migrate from delaunay to tri.Triang\n4. Fix sage/plot/graphics.py - easy.\n5. Why no output in sage/plot/arrow.py?",
    "created_at": "2015-01-12T20:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304623",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Some redundancy indeed. Let's see what's to be done:
1. Add the missing "u" to doctest (for unicode if I am not mistaken). That's one of the easiest bit.
2. Get rid of calls to _base in sage/plot/*
3. Migrate from delaunay to tri.Triang
4. Fix sage/plot/graphics.py - easy.
5. Why no output in sage/plot/arrow.py?



---

archive/issue_comments_304624.json:
```json
{
    "body": "<a id='comment:9'></a>\nIt looks like we may be able to get away with replacing delaunay with tri.Triangulation without any other changes. Another option is to switch to scipy's delaunay.",
    "created_at": "2015-01-12T21:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304624",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
It looks like we may be able to get away with replacing delaunay with tri.Triangulation without any other changes. Another option is to switch to scipy's delaunay.



---

archive/issue_comments_304625.json:
```json
{
    "body": "**Changing commit** from \"[374eca4c6161a7216b48ebb5ea772d62c5695f11](https://github.com/sagemath/sagetrac-mirror/commit/374eca4c6161a7216b48ebb5ea772d62c5695f11)\" to \"[4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab](https://github.com/sagemath/sagetrac-mirror/commit/4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab)\".",
    "created_at": "2015-01-13T18:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[374eca4c6161a7216b48ebb5ea772d62c5695f11](https://github.com/sagemath/sagetrac-mirror/commit/374eca4c6161a7216b48ebb5ea772d62c5695f11)" to "[4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab](https://github.com/sagemath/sagetrac-mirror/commit/4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab)".



---

archive/issue_comments_304626.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf4b81b520e8fd4bb21881b9f05143ad9a209202\">bf4b81b</a></td><td><code>#17618 fix bugs involving a missing _Base class in sage/plot/arrow.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12baa7f99ccd852b4f1f5bfdaf6751676fe31411\">12baa7f</a></td><td><code>#17618 fix unicode doctest failures in colors.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab\">4c6f6e1</a></td><td><code>#17618 fix _subplots doctest failure in plot/graphics.py</code></td></tr></table>\n",
    "created_at": "2015-01-13T18:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304626",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf4b81b520e8fd4bb21881b9f05143ad9a209202">bf4b81b</a></td><td><code>#17618 fix bugs involving a missing _Base class in sage/plot/arrow.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12baa7f99ccd852b4f1f5bfdaf6751676fe31411">12baa7f</a></td><td><code>#17618 fix unicode doctest failures in colors.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab">4c6f6e1</a></td><td><code>#17618 fix _subplots doctest failure in plot/graphics.py</code></td></tr></table>




---

archive/issue_comments_304627.json:
```json
{
    "body": "**Author:** Thierry Monteil",
    "created_at": "2015-01-13T19:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304627",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Author:** Thierry Monteil



---

archive/issue_comments_304628.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [fbissey](#comment%3A9):\n> It looks like we may be able to get away with replacing delaunay with tri.Triangulation without any other changes. Another option is to switch to scipy's delaunay.\n\n\nA drop-in replacement does not work since they do not offer the same methods. Also, we rely on nearest neighbor interpolation which, according to [this page](https://github.com/matplotlib/matplotlib/pull/2504) seems to require installing some natgrid package, see also [this page](http://matplotlib.1069221.n5.nabble.com/Replacing-matplotlib-delaunay-natural-neighbor-interpolation-td42786.html) about removing natgrid.",
    "created_at": "2015-01-13T19:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304628",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:12'></a>
Replying to [fbissey](#comment%3A9):
> It looks like we may be able to get away with replacing delaunay with tri.Triangulation without any other changes. Another option is to switch to scipy's delaunay.


A drop-in replacement does not work since they do not offer the same methods. Also, we rely on nearest neighbor interpolation which, according to [this page](https://github.com/matplotlib/matplotlib/pull/2504) seems to require installing some natgrid package, see also [this page](http://matplotlib.1069221.n5.nabble.com/Replacing-matplotlib-delaunay-natural-neighbor-interpolation-td42786.html) about removing natgrid.



---

archive/issue_comments_304629.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'm not invested in this, but just be sure to check *actual pictures* for a good variety of plots...",
    "created_at": "2015-01-13T19:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304629",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>
I'm not invested in this, but just be sure to check *actual pictures* for a good variety of plots...



---

archive/issue_comments_304630.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [kcrisman](#comment%3A13):\n> I'm not invested in this, \n\n\nUh, sorry for cc-ing you, `git blame` denounced you.\n\n> but just be sure to check *actual pictures* for a good variety of plots...\n\n\nYes, we will look at how failed doctests are visually rendered before and after the fixes.",
    "created_at": "2015-01-13T19:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304630",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:14'></a>
Replying to [kcrisman](#comment%3A13):
> I'm not invested in this, 


Uh, sorry for cc-ing you, `git blame` denounced you.

> but just be sure to check *actual pictures* for a good variety of plots...


Yes, we will look at how failed doctests are visually rendered before and after the fixes.



---

archive/issue_comments_304631.json:
```json
{
    "body": "<a id='comment:15'></a>\nI, on the other hand, am very interested in this because updating matplotlib is a pre-requisite for updating numpy to 1.9.x (MPL 1.3.x won't build with numpy 1.9.x).\n\nSo if we cannot use matplotlib tri.Triangulation could we try scipy's delaunay instead?",
    "created_at": "2015-01-13T20:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304631",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
I, on the other hand, am very interested in this because updating matplotlib is a pre-requisite for updating numpy to 1.9.x (MPL 1.3.x won't build with numpy 1.9.x).

So if we cannot use matplotlib tri.Triangulation could we try scipy's delaunay instead?



---

archive/issue_comments_304632.json:
```json
{
    "body": "<a id='comment:16'></a>\nOK scipy doesn't offer nearest neighbour either. I think it is time to hit the list to know if there is any reason we should stick to nn. linear or cubic should make good default. I would go cubic myself as the default.",
    "created_at": "2015-01-13T23:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304632",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
OK scipy doesn't offer nearest neighbour either. I think it is time to hit the list to know if there is any reason we should stick to nn. linear or cubic should make good default. I would go cubic myself as the default.



---

archive/issue_comments_304633.json:
```json
{
    "body": "<a id='comment:17'></a>\nIf no one comment on my post on sage-devel by tomorrow we just go ahead and change the default. Is this ok with you? We may need to check the documentation.",
    "created_at": "2015-01-14T20:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304633",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
If no one comment on my post on sage-devel by tomorrow we just go ahead and change the default. Is this ok with you? We may need to check the documentation.



---

archive/issue_comments_304634.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK in the absence of comments I think we should go ahead with something.",
    "created_at": "2015-01-15T23:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304634",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
OK in the absence of comments I think we should go ahead with something.



---

archive/issue_comments_304635.json:
```json
{
    "body": "<a id='comment:19'></a>\nI see you didn't put up a tarball or updated the checksums so I will do it. I am testing my current changes, I am doing a build from scratch right now.",
    "created_at": "2015-01-16T00:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304635",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
I see you didn't put up a tarball or updated the checksums so I will do it. I am testing my current changes, I am doing a build from scratch right now.



---

archive/issue_comments_304636.json:
```json
{
    "body": "**Changing commit** from \"[4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab](https://github.com/sagemath/sagetrac-mirror/commit/4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab)\" to \"[8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5](https://github.com/sagemath/sagetrac-mirror/commit/8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5)\".",
    "created_at": "2015-01-16T01:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304636",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab](https://github.com/sagemath/sagetrac-mirror/commit/4c6f6e1b58d270077dc6eb6e0fdff5b85904ceab)" to "[8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5](https://github.com/sagemath/sagetrac-mirror/commit/8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5)".



---

archive/issue_comments_304637.json:
```json
{
    "body": "<a id='comment:20'></a>\nAfter changing to triangulation there are differences with what we have before but I don't know at this stage if it is better or worse. See commit.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5\">8ee674d</a></td><td><code>Add checksum and migrate to tri.Trinagulation</code></td></tr></table>\n",
    "created_at": "2015-01-16T01:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304637",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
After changing to triangulation there are differences with what we have before but I don't know at this stage if it is better or worse. See commit.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5">8ee674d</a></td><td><code>Add checksum and migrate to tri.Trinagulation</code></td></tr></table>




---

archive/issue_comments_304638.json:
```json
{
    "body": "**Changing branch** from \"[u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken)\" to \"[u/fbissey/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-1.4)\".",
    "created_at": "2015-01-16T01:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304638",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_matplotlib_so_that_plot_directive_is_less_broken)" to "[u/fbissey/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-1.4)".



---

archive/issue_comments_304639.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n \n With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.\n \n+Tarball:\n+[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz)\n``````\n",
    "created_at": "2015-01-16T01:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304639",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 
 With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.
 
+Tarball:
+[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz)
``````




---

archive/issue_comments_304640.json:
```json
{
    "body": "<a id='comment:21'></a>\nThere is also a section of code that was specifically to correct data that could segfault the delaunay code. Unfortunately there is no doctest so we cannot check whether we still need it or not.",
    "created_at": "2015-01-16T02:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304640",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>
There is also a section of code that was specifically to correct data that could segfault the delaunay code. Unfortunately there is no doctest so we cannot check whether we still need it or not.



---

archive/issue_comments_304641.json:
```json
{
    "body": "<a id='comment:22'></a>\nOK for the first doctest both delaunay and triangulation are bad compared to spline... Difficult to know which one is worst but nearest neighbour wasn't involved in either.",
    "created_at": "2015-01-16T02:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304641",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
OK for the first doctest both delaunay and triangulation are bad compared to spline... Difficult to know which one is worst but nearest neighbour wasn't involved in either.



---

archive/issue_comments_304642.json:
```json
{
    "body": "<a id='comment:23'></a>\nI'm coming late to the game. Aside from the actual triangulation it looks like there is still\n\n```\ninterpolation_type='nn'\n```\nin `listplot_3d.py` which gives failures for me. And in `discrete_gaussian_lattice.py`\nthere is\n\n`interploation='nn'`\n\nI guess `interploation` should be `interpolation` and the `'nn'` should be something else.",
    "created_at": "2015-01-16T03:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304642",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:23'></a>
I'm coming late to the game. Aside from the actual triangulation it looks like there is still

```
interpolation_type='nn'
```
in `listplot_3d.py` which gives failures for me. And in `discrete_gaussian_lattice.py`
there is

`interploation='nn'`

I guess `interploation` should be `interpolation` and the `'nn'` should be something else.



---

archive/issue_comments_304643.json:
```json
{
    "body": "<a id='comment:24'></a>\nActually with `interpolation_type='nn'` no 3D-graphic is generated at all. And changing `'nn'` to `'cubic'` I get:\n\n```\nsage -t src/sage/plot/plot3d/list_plot3d.py\n**********************************************************************\nFile \"src/sage/plot/plot3d/list_plot3d.py\", line 138, in sage.plot.plot3d.list_plot3d.list_plot3d\nFailed example:\n    list_plot3d(l,interpolation_type='cubic',texture='yellow',num_points=100)\nExpected:\n    Graphics3d Object\nGot:\n    doctest:3847: UserWarning: Warning: converting a masked element to nan.\n    Graphics3d Object\n**********************************************************************\n```",
    "created_at": "2015-01-16T03:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304643",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:24'></a>
Actually with `interpolation_type='nn'` no 3D-graphic is generated at all. And changing `'nn'` to `'cubic'` I get:

```
sage -t src/sage/plot/plot3d/list_plot3d.py
**********************************************************************
File "src/sage/plot/plot3d/list_plot3d.py", line 138, in sage.plot.plot3d.list_plot3d.list_plot3d
Failed example:
    list_plot3d(l,interpolation_type='cubic',texture='yellow',num_points=100)
Expected:
    Graphics3d Object
Got:
    doctest:3847: UserWarning: Warning: converting a masked element to nan.
    Graphics3d Object
**********************************************************************
```



---

archive/issue_comments_304644.json:
```json
{
    "body": "<a id='comment:25'></a>\nYes, still work in progress, I'll have to get to all these next. We'll have to explore that last warning too.",
    "created_at": "2015-01-16T05:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304644",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
Yes, still work in progress, I'll have to get to all these next. We'll have to explore that last warning too.



---

archive/issue_comments_304645.json:
```json
{
    "body": "<a id='comment:26'></a>\nHi, sorry i was out of connection those days, which is why i did not answered earlier. @kiwifb i am not sure 2 days is a sufficient delay to let people answer in such community as Sage, involving so much people, none of which working full time on it.\n\nI am not convinced yet that cubic interpolation is a suitable replacement for nearest neighborhood, both in terms of speed, meaning and visual rendering, so i guess this should be inspected further with that respect (as suggested by `@`kcrismann in his previous answer). I will try to work on it later in the day.\n\nI see two things:\n- the `delaunay` module of matplotlib is only deprecated for now, according to the second thread i mentioned earlier: \"This will be OK for a year or two, but eventually we will completely remove matplotlib.delaunay\", so for now it is possible to catch the deprecation warning and get time to think further. If matplotlib's upgrade is urgent because it blocks other important packages, let us better go for it than silently forget a feature.\n- If matplotlib decides to get rid of its `delaunay` module, why not incorporate it in Sage's source code, this is free software after all. We also have some similar stuff in Sage that could be used as a replacement as @kiwifb suggested with scipy. This can of course be the purpose of another ticket.",
    "created_at": "2015-01-16T07:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304645",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:26'></a>
Hi, sorry i was out of connection those days, which is why i did not answered earlier. @kiwifb i am not sure 2 days is a sufficient delay to let people answer in such community as Sage, involving so much people, none of which working full time on it.

I am not convinced yet that cubic interpolation is a suitable replacement for nearest neighborhood, both in terms of speed, meaning and visual rendering, so i guess this should be inspected further with that respect (as suggested by `@`kcrismann in his previous answer). I will try to work on it later in the day.

I see two things:
- the `delaunay` module of matplotlib is only deprecated for now, according to the second thread i mentioned earlier: "This will be OK for a year or two, but eventually we will completely remove matplotlib.delaunay", so for now it is possible to catch the deprecation warning and get time to think further. If matplotlib's upgrade is urgent because it blocks other important packages, let us better go for it than silently forget a feature.
- If matplotlib decides to get rid of its `delaunay` module, why not incorporate it in Sage's source code, this is free software after all. We also have some similar stuff in Sage that could be used as a replacement as @kiwifb suggested with scipy. This can of course be the purpose of another ticket.



---

archive/issue_comments_304646.json:
```json
{
    "body": "<a id='comment:27'></a>\nThings happen! Anyway if you want to have an answer to something that has been posted more than 24-48hours you may need to re-post again.\nAdmitly the list has been relatively quite the past week so it may not be drawn in the flow has it would normally be.\n\nWhile it is only deprecated it is only pushing the problem away in my opinion - it is a form of procrastination. \n\nI guess we don't completely loss delaunay if we want to hold to it, we can migrate to scipy, what we will lose fast, is the nearest neighbour default. scipy doesn't have it, MPL doesn't really want it, why should we have it? Are there any technical arguments for it? Also the underlying code under delaunay is changed in any case to be based on qhull, there may be difference, even in the linear if we decide to postpone.",
    "created_at": "2015-01-16T08:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304646",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
Things happen! Anyway if you want to have an answer to something that has been posted more than 24-48hours you may need to re-post again.
Admitly the list has been relatively quite the past week so it may not be drawn in the flow has it would normally be.

While it is only deprecated it is only pushing the problem away in my opinion - it is a form of procrastination. 

I guess we don't completely loss delaunay if we want to hold to it, we can migrate to scipy, what we will lose fast, is the nearest neighbour default. scipy doesn't have it, MPL doesn't really want it, why should we have it? Are there any technical arguments for it? Also the underlying code under delaunay is changed in any case to be based on qhull, there may be difference, even in the linear if we decide to postpone.



---

archive/issue_comments_304647.json:
```json
{
    "body": "<a id='comment:28'></a>\nSlightly related, I've opened #17642, #17643, #17644 for numpy/scipy/sympy updates (currently, nothing to see there though).",
    "created_at": "2015-01-16T10:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304647",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>
Slightly related, I've opened #17642, #17643, #17644 for numpy/scipy/sympy updates (currently, nothing to see there though).



---

archive/issue_comments_304648.json:
```json
{
    "body": "<a id='comment:29'></a>\nI may be missing something, and it may be a terminology thing, but it appears that scipy-0.15 does have nearest neighbor interpolation:\n\nhttps://github.com/scipy/scipy/blob/master/scipy/interpolate/interpolate.py\nand\nhttps://github.com/scipy/scipy/blob/master/scipy/interpolate/interpolate_wrapper.py\n\nsearch for `nearest`.",
    "created_at": "2015-01-16T19:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304648",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:29'></a>
I may be missing something, and it may be a terminology thing, but it appears that scipy-0.15 does have nearest neighbor interpolation:

https://github.com/scipy/scipy/blob/master/scipy/interpolate/interpolate.py
and
https://github.com/scipy/scipy/blob/master/scipy/interpolate/interpolate_wrapper.py

search for `nearest`.



---

archive/issue_comments_304649.json:
```json
{
    "body": "<a id='comment:30'></a>\nIndeed, I thought I read that scipy didn't have it. May be delaunay doesn't have it.",
    "created_at": "2015-01-16T19:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304649",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
Indeed, I thought I read that scipy didn't have it. May be delaunay doesn't have it.



---

archive/attachments_020617.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "vectors.sobj",
    "asset_url": "tarball://root/attachments/some-uuid/ticket17618/vectors.sobj",
    "created_at": "2015-01-17T17:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.sobj",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```



---

archive/issue_comments_304650.json:
```json
{
    "body": "",
    "created_at": "2015-01-17T17:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304650",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```





---

archive/attachments_020618.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "6.4_linear.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket17618/6.4_linear.png",
    "created_at": "2015-01-17T17:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```



---

archive/issue_comments_304651.json:
```json
{
    "body": "",
    "created_at": "2015-01-17T17:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304651",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```





---

archive/attachments_020619.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "6.5_linear.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket17618/6.5_linear.png",
    "created_at": "2015-01-17T17:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```



---

archive/issue_comments_304652.json:
```json
{
    "body": "",
    "created_at": "2015-01-17T17:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304652",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```





---

archive/attachments_020620.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "6.5_cubic.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket17618/6.5_cubic.png",
    "created_at": "2015-01-17T17:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```



---

archive/issue_comments_304653.json:
```json
{
    "body": "<a id='comment:31'></a>\nI did the following test to compare the new `cubic` interpolation type with the former `nn`:\n\nCreation of a common test (taken from `discrete_gaussian_lattice.py` doctest):\n\n```\nfrom sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler\nD = DiscreteGaussianDistributionLatticeSampler(identity_matrix(2), 3.0)\nS = [D() for _ in range(2^12)]\nl = [vector(v.list() + [S.count(v)]) for v in set(S)]\nsave(l, '/tmp/vectors.sobj')\n```\n\nThen, on the former 6.4:\n\n```\nsage: l = load('/tmp/vectors.sobj')\nsage: %timeit P = list_plot3d(l, interpolation_type='linear', texture=\"automatic\", point_list=True)\n100 loops, best of 3: 12.4 ms per loop\n```\n\n![](6.4_linear.png)\n\n```\nsage: %timeit P = list_plot3d(l, interpolation_type='nn', texture=\"automatic\", point_list=True)\n10 loops, best of 3: 29.8 ms per loop\n```\n\n![](6.4_nn.png)\n\n\nOn the patched 6.5.beta5:\n\n```\nsage: l = load('/tmp/vectors.sobj')\nsage: %timeit P = list_plot3d(l, interpolation_type='linear', texture=\"automatic\", point_list=True)\n100 loops, best of 3: 18.8 ms per loop\n```\n\n![](6.5_linear.png)\n\n\n```\nsage: %timeit P = list_plot3d(l, interpolation_type='cubic', texture=\"automatic\", point_list=True)\n1 loops, best of 3: 498 ms per loop\n```\n\n![](6.5_cubic.png)\n\nThe generation of the `cubic` interpolation is much (16x) slower that the `nn` interpolation, and the visual renderings are very different (`nn` looks more like a smoothed `linear` while `cubic` shows more spots at lattice points). So, i agree to add the `cubic` interpolation type, but disagree to let this replace `nn` in existing tests (too different) nor as becoming the default (too slow).",
    "created_at": "2015-01-17T17:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304653",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:31'></a>
I did the following test to compare the new `cubic` interpolation type with the former `nn`:

Creation of a common test (taken from `discrete_gaussian_lattice.py` doctest):

```
from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler
D = DiscreteGaussianDistributionLatticeSampler(identity_matrix(2), 3.0)
S = [D() for _ in range(2^12)]
l = [vector(v.list() + [S.count(v)]) for v in set(S)]
save(l, '/tmp/vectors.sobj')
```

Then, on the former 6.4:

```
sage: l = load('/tmp/vectors.sobj')
sage: %timeit P = list_plot3d(l, interpolation_type='linear', texture="automatic", point_list=True)
100 loops, best of 3: 12.4 ms per loop
```

![](6.4_linear.png)

```
sage: %timeit P = list_plot3d(l, interpolation_type='nn', texture="automatic", point_list=True)
10 loops, best of 3: 29.8 ms per loop
```

![](6.4_nn.png)


On the patched 6.5.beta5:

```
sage: l = load('/tmp/vectors.sobj')
sage: %timeit P = list_plot3d(l, interpolation_type='linear', texture="automatic", point_list=True)
100 loops, best of 3: 18.8 ms per loop
```

![](6.5_linear.png)


```
sage: %timeit P = list_plot3d(l, interpolation_type='cubic', texture="automatic", point_list=True)
1 loops, best of 3: 498 ms per loop
```

![](6.5_cubic.png)

The generation of the `cubic` interpolation is much (16x) slower that the `nn` interpolation, and the visual renderings are very different (`nn` looks more like a smoothed `linear` while `cubic` shows more spots at lattice points). So, i agree to add the `cubic` interpolation type, but disagree to let this replace `nn` in existing tests (too different) nor as becoming the default (too slow).



---

archive/issue_comments_304654.json:
```json
{
    "body": "<a id='comment:32'></a>\nIn `list_plot3d.py`, the following is more than dubious, especially if `drop_list` is not empty:\n\n```\n    x=[x[i] for i in range(len(x)) if i not in drop_list]\n    y=[y[i] for i in range(len(x)) if i not in drop_list]\n    z=[z[i] for i in range(len(x)) if i not in drop_list]\n```",
    "created_at": "2015-01-18T10:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304654",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:32'></a>
In `list_plot3d.py`, the following is more than dubious, especially if `drop_list` is not empty:

```
    x=[x[i] for i in range(len(x)) if i not in drop_list]
    y=[y[i] for i in range(len(x)) if i not in drop_list]
    z=[z[i] for i in range(len(x)) if i not in drop_list]
```



---

archive/issue_comments_304655.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-1.4)\" to \"[u/tmonteil/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL-1.4)\".",
    "created_at": "2015-01-18T10:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304655",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing branch** from "[u/fbissey/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-1.4)" to "[u/tmonteil/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL-1.4)".



---

archive/issue_comments_304656.json:
```json
{
    "body": "<a id='comment:34'></a>\nHadn't seen your plots (not shown in email) that's cool work. I don't think the stuff with drop_list is spurious. The point is to eliminate double entries. Indices are added to drop_list if the corresponding point is identical to a previous one. The code you quote builds a new set of x, y and z where each set of point is unique. \n\nOn the other code that code in the generation of drop_list is a bit gauche\n\n```\nif z[i] != z[j]:\n.....\nelif z[i] == z[j]:\n    drop_list.append(j)\n```\nLike there was a third case? the elif could be replaced by else in my opinion.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b4e74ee67b855c4d738dccf401852bf2754675f\">1b4e74e</a></td><td><code>#17618 : fix spacing (trivial)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/065dc779e98d32ec5b081680db5356df98f15ff2\">065dc77</a></td><td><code>#17618 : fix comment 32</code></td></tr></table>\n",
    "created_at": "2015-01-18T11:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304656",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
Hadn't seen your plots (not shown in email) that's cool work. I don't think the stuff with drop_list is spurious. The point is to eliminate double entries. Indices are added to drop_list if the corresponding point is identical to a previous one. The code you quote builds a new set of x, y and z where each set of point is unique. 

On the other code that code in the generation of drop_list is a bit gauche

```
if z[i] != z[j]:
.....
elif z[i] == z[j]:
    drop_list.append(j)
```
Like there was a third case? the elif could be replaced by else in my opinion.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b4e74ee67b855c4d738dccf401852bf2754675f">1b4e74e</a></td><td><code>#17618 : fix spacing (trivial)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/065dc779e98d32ec5b081680db5356df98f15ff2">065dc77</a></td><td><code>#17618 : fix comment 32</code></td></tr></table>




---

archive/issue_comments_304657.json:
```json
{
    "body": "**Changing commit** from \"[8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5](https://github.com/sagemath/sagetrac-mirror/commit/8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5)\" to \"[065dc779e98d32ec5b081680db5356df98f15ff2](https://github.com/sagemath/sagetrac-mirror/commit/065dc779e98d32ec5b081680db5356df98f15ff2)\".",
    "created_at": "2015-01-18T11:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304657",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5](https://github.com/sagemath/sagetrac-mirror/commit/8ee674d1b6e6bc2e22d7bc9f0ad9af05cce766d5)" to "[065dc779e98d32ec5b081680db5356df98f15ff2](https://github.com/sagemath/sagetrac-mirror/commit/065dc779e98d32ec5b081680db5356df98f15ff2)".



---

archive/issue_comments_304658.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [fbissey](#comment%3A34):\n> I don't think the stuff with drop_list is spurious. The point is to eliminate double entries. Indices are added to drop_list if the corresponding point is identical to a previous one. The code you quote builds a new set of x, y and z where each set of point is unique. \n\n\nThe problem is that, if `drop_list` is not empty, then at the first line, the list `x` is shortened (duplicates are removed), but then only a prefix of the lists `y` and `z` is dealt with (since `len(x)` decreased at the first line).\n\n> On the other code that code in the generation of drop_list is a bit gauche\n> \n> ```\n> if z[i] != z[j]:\n> .....\n> elif z[i] == z[j]:\n>     drop_list.append(j)\n> ```\n> Like there was a third case? the elif could be replaced by else in my opinion.\n\n\nIndeed, it would save a useless computation to just write `else`.",
    "created_at": "2015-01-18T21:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304658",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:35'></a>
Replying to [fbissey](#comment%3A34):
> I don't think the stuff with drop_list is spurious. The point is to eliminate double entries. Indices are added to drop_list if the corresponding point is identical to a previous one. The code you quote builds a new set of x, y and z where each set of point is unique. 


The problem is that, if `drop_list` is not empty, then at the first line, the list `x` is shortened (duplicates are removed), but then only a prefix of the lists `y` and `z` is dealt with (since `len(x)` decreased at the first line).

> On the other code that code in the generation of drop_list is a bit gauche
> 
> ```
> if z[i] != z[j]:
> .....
> elif z[i] == z[j]:
>     drop_list.append(j)
> ```
> Like there was a third case? the elif could be replaced by else in my opinion.


Indeed, it would save a useless computation to just write `else`.



---

archive/issue_comments_304659.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [tmonteil](#comment%3A35):\n> Replying to [fbissey](#comment%3A34):\n> > I don't think the stuff with drop_list is spurious. The point is to eliminate double entries. Indices are added to drop_list if the corresponding point is identical to a previous one. The code you quote builds a new set of x, y and z where each set of point is unique. \n\n> \n> The problem is that, if `drop_list` is not empty, then at the first line, the list `x` is shortened (duplicates are removed), but then only a prefix of the lists `y` and `z` is dealt with (since `len(x)` decreased at the first line).\n\n\nGood spotting I understand what you mean now. The quick fix is to use len(y) and len(z) or a pre-set auxiliary variable as you have done some other places.",
    "created_at": "2015-01-18T21:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304659",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>
Replying to [tmonteil](#comment%3A35):
> Replying to [fbissey](#comment%3A34):
> > I don't think the stuff with drop_list is spurious. The point is to eliminate double entries. Indices are added to drop_list if the corresponding point is identical to a previous one. The code you quote builds a new set of x, y and z where each set of point is unique. 

> 
> The problem is that, if `drop_list` is not empty, then at the first line, the list `x` is shortened (duplicates are removed), but then only a prefix of the lists `y` and `z` is dealt with (since `len(x)` decreased at the first line).


Good spotting I understand what you mean now. The quick fix is to use len(y) and len(z) or a pre-set auxiliary variable as you have done some other places.



---

archive/issue_comments_304660.json:
```json
{
    "body": "<a id='comment:37'></a>\nOK I spent some time over the scipy documentation and I think I will try to use scipy delaunay and interpolation instead. It looks doable. There may still be some differences in rendering because the back end for delaunay is different.\nIt may take me a couple of days before getting there.",
    "created_at": "2015-01-19T00:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304660",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
OK I spent some time over the scipy documentation and I think I will try to use scipy delaunay and interpolation instead. It looks doable. There may still be some differences in rendering because the back end for delaunay is different.
It may take me a couple of days before getting there.



---

archive/issue_comments_304661.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [fbissey](#comment%3A37):\n> OK I spent some time over the scipy documentation and I think I will try to use scipy delaunay and interpolation instead. It looks doable. There may still be some differences in rendering because the back end for delaunay is different.\n> It may take me a couple of days before getting there. \n\n\nGreat ! I will finish some cleanup of `list_plot3d.py` meanwhile.",
    "created_at": "2015-01-21T15:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304661",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:38'></a>
Replying to [fbissey](#comment%3A37):
> OK I spent some time over the scipy documentation and I think I will try to use scipy delaunay and interpolation instead. It looks doable. There may still be some differences in rendering because the back end for delaunay is different.
> It may take me a couple of days before getting there. 


Great ! I will finish some cleanup of `list_plot3d.py` meanwhile.



---

archive/issue_comments_304662.json:
```json
{
    "body": "<a id='comment:39'></a>\nI tried to post a comment on Tuesday but trac wouldn't let me :( so in scipy we can produce a Delaunay object and use it for linear interpolation but the nearest neighbor method cannot use a Delaunay object just a list of points. The linear interpolation can use the same kind of list of points. So I think I will give the delaunay object the hard shoulder and go directly to the list of points for both.",
    "created_at": "2015-01-21T20:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304662",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
I tried to post a comment on Tuesday but trac wouldn't let me :( so in scipy we can produce a Delaunay object and use it for linear interpolation but the nearest neighbor method cannot use a Delaunay object just a list of points. The linear interpolation can use the same kind of list of points. So I think I will give the delaunay object the hard shoulder and go directly to the list of points for both.



---

archive/issue_comments_304663.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [fbissey](#comment%3A39):\n> I tried to post a comment on Tuesday but trac wouldn't let me :( so in scipy we can produce a Delaunay object and use it for linear interpolation but the nearest neighbor method cannot use a Delaunay object just a list of points. The linear interpolation can use the same kind of list of points. So I think I will give the delaunay object the hard shoulder and go directly to the list of points for both.\n\n\nI definitely agree with that: using Delaunay triangulations eases finding nearest neighbors, but nearest neighbors can be found without that, see also [this comment](http://matplotlib.1069221.n5.nabble.com/Replacing-matplotlib-delaunay-natural-neighbor-interpolation-td42786.html#a42796). The only loss we could have not using an underlying Delaunay triangulation should be with respect to speed (though computing Delaunay triangulation also costs, even with `qhull`). Do you plan to use `scipy.interpolate.NearestNDInterpolator` (or `scipy.interpolate.griddata`) for `nn` interpolation ? If yes, it seems to rely on `scipy.spatial.cKDTree` which seems to be a method unrelated to relying on a Delaunay triangulation, perhaps is it faster ?\n\nAlso, it could be nice to keep both matplotlib's and scipy's `linear` and `cubic` interpolations in order to compare them (both visually and in terms of speed), at least for now. Depending on that, we could give the whole job to `scipy`.",
    "created_at": "2015-01-22T11:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304663",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:40'></a>
Replying to [fbissey](#comment%3A39):
> I tried to post a comment on Tuesday but trac wouldn't let me :( so in scipy we can produce a Delaunay object and use it for linear interpolation but the nearest neighbor method cannot use a Delaunay object just a list of points. The linear interpolation can use the same kind of list of points. So I think I will give the delaunay object the hard shoulder and go directly to the list of points for both.


I definitely agree with that: using Delaunay triangulations eases finding nearest neighbors, but nearest neighbors can be found without that, see also [this comment](http://matplotlib.1069221.n5.nabble.com/Replacing-matplotlib-delaunay-natural-neighbor-interpolation-td42786.html#a42796). The only loss we could have not using an underlying Delaunay triangulation should be with respect to speed (though computing Delaunay triangulation also costs, even with `qhull`). Do you plan to use `scipy.interpolate.NearestNDInterpolator` (or `scipy.interpolate.griddata`) for `nn` interpolation ? If yes, it seems to rely on `scipy.spatial.cKDTree` which seems to be a method unrelated to relying on a Delaunay triangulation, perhaps is it faster ?

Also, it could be nice to keep both matplotlib's and scipy's `linear` and `cubic` interpolations in order to compare them (both visually and in terms of speed), at least for now. Depending on that, we could give the whole job to `scipy`.



---

archive/issue_comments_304664.json:
```json
{
    "body": "<a id='comment:41'></a>\nDelaunay would be especially useful for speed if we were re-using it. But that's not the case.  I was planning on using scipy.interpolate.NearestNDInterpolator. I will try to put everything at first so we can test as you suggest. So there will be MPLlinear and SPlinear I will investigate using griddata too now that you suggested it.\n\nI am caught in things but hopefully I can get a decent shot at it today.",
    "created_at": "2015-01-22T19:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304664",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>
Delaunay would be especially useful for speed if we were re-using it. But that's not the case.  I was planning on using scipy.interpolate.NearestNDInterpolator. I will try to put everything at first so we can test as you suggest. So there will be MPLlinear and SPlinear I will investigate using griddata too now that you suggested it.

I am caught in things but hopefully I can get a decent shot at it today.



---

archive/issue_comments_304665.json:
```json
{
    "body": "<a id='comment:42'></a>\nOK so scipy and MPL linear interpolation look pretty much the same on screen but scipy's nn is ugly and all blocky. scipy's linear is the fastest\n\n```\nsage: %timeit P = list_plot3d(l, interpolation_type='linear', texture=\"automatic\", point_list=True)\n100 loops, best of 3: 6.6 ms per loop\nsage: %timeit P = list_plot3d(l, interpolation_type='MPLlinear', texture=\"automatic\", point_list=True)\n100 loops, best of 3: 7.71 ms per loop\nsage: %timeit P = list_plot3d(l, interpolation_type='nn', texture=\"automatic\", point_list=True)\n100 loops, best of 3: 4.15 ms per loop\n```\nThe first one is scipy's linear. nn is fast but blocky![](SP_nn.jpg)",
    "created_at": "2015-01-23T01:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304665",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
OK so scipy and MPL linear interpolation look pretty much the same on screen but scipy's nn is ugly and all blocky. scipy's linear is the fastest

```
sage: %timeit P = list_plot3d(l, interpolation_type='linear', texture="automatic", point_list=True)
100 loops, best of 3: 6.6 ms per loop
sage: %timeit P = list_plot3d(l, interpolation_type='MPLlinear', texture="automatic", point_list=True)
100 loops, best of 3: 7.71 ms per loop
sage: %timeit P = list_plot3d(l, interpolation_type='nn', texture="automatic", point_list=True)
100 loops, best of 3: 4.15 ms per loop
```
The first one is scipy's linear. nn is fast but blocky![](SP_nn.jpg)



---

archive/issue_comments_304666.json:
```json
{
    "body": "scipy nearest neighbor - sage 6.5.beta5",
    "created_at": "2015-01-23T01:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304666",
    "user": "https://github.com/kiwifb"
}
```

scipy nearest neighbor - sage 6.5.beta5



---

archive/attachments_020621.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "SP_nn.jpg",
    "asset_url": "tarball://root/attachments/some-uuid/ticket17618/SP_nn.jpg",
    "created_at": "2015-01-23T01:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.jpg",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_304667.json:
```json
{
    "body": "<a id='comment:43'></a>\nI am trying to get griddata in before posting a new branch.",
    "created_at": "2015-01-23T01:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304667",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
I am trying to get griddata in before posting a new branch.



---

archive/issue_comments_304668.json:
```json
{
    "body": "<a id='comment:44'></a>\nI don't think I will do griddata. griddata will output an array value for for all the x and y want at once. ParametricSurface takes a function and a list of point to evaluate your function at. The best way to plot a known list of given [x,y,z] such as generated by griddata is listplot3d. So we would have listplot3d calling listplot3d and I have no idea on how to avoid that.",
    "created_at": "2015-01-23T02:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304668",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
I don't think I will do griddata. griddata will output an array value for for all the x and y want at once. ParametricSurface takes a function and a list of point to evaluate your function at. The best way to plot a known list of given [x,y,z] such as generated by griddata is listplot3d. So we would have listplot3d calling listplot3d and I have no idea on how to avoid that.



---

archive/issue_comments_304669.json:
```json
{
    "body": "<a id='comment:45'></a>\nHere is the stuff I got so far. Sorry for the delay - I am still thinking about the grid stuff. We may be able to do it but we'll have to use lower level drawing directives than what is used for the other plots.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8\">b2c0045</a></td><td><code>more experiments in list_plot3d</code></td></tr></table>\n",
    "created_at": "2015-02-03T21:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304669",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
Here is the stuff I got so far. Sorry for the delay - I am still thinking about the grid stuff. We may be able to do it but we'll have to use lower level drawing directives than what is used for the other plots.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8">b2c0045</a></td><td><code>more experiments in list_plot3d</code></td></tr></table>




---

archive/issue_comments_304670.json:
```json
{
    "body": "**Changing branch** from \"[u/tmonteil/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL-1.4)\" to \"[u/fbissey/trac17618-MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac17618-MPL-1.4)\".",
    "created_at": "2015-02-03T21:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304670",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/tmonteil/MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL-1.4)" to "[u/fbissey/trac17618-MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac17618-MPL-1.4)".



---

archive/issue_comments_304671.json:
```json
{
    "body": "**Changing commit** from \"[065dc779e98d32ec5b081680db5356df98f15ff2](https://github.com/sagemath/sagetrac-mirror/commit/065dc779e98d32ec5b081680db5356df98f15ff2)\" to \"[b2c0045d3619b225008984e7631c3abcf4f382e8](https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8)\".",
    "created_at": "2015-02-03T21:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304671",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[065dc779e98d32ec5b081680db5356df98f15ff2](https://github.com/sagemath/sagetrac-mirror/commit/065dc779e98d32ec5b081680db5356df98f15ff2)" to "[b2c0045d3619b225008984e7631c3abcf4f382e8](https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8)".



---

archive/issue_comments_304672.json:
```json
{
    "body": "<a id='comment:46'></a>\nMPL 1.4.3 is out and is the latest release before 2.0, Now that sage 6.5 is officially out we may want to drive that one in if we can.",
    "created_at": "2015-02-17T08:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304672",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>
MPL 1.4.3 is out and is the latest release before 2.0, Now that sage 6.5 is officially out we may want to drive that one in if we can.



---

archive/issue_comments_304673.json:
```json
{
    "body": "<a id='comment:48'></a>\nThis patch has grown a lot of \"hair\" (i.e. stuff unrelated to the purpose of the ticket). To what extent are all the changes in `src/sage/plot/plot3d/list_plot3d.py` really needed?",
    "created_at": "2015-04-08T07:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304673",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>
This patch has grown a lot of "hair" (i.e. stuff unrelated to the purpose of the ticket). To what extent are all the changes in `src/sage/plot/plot3d/list_plot3d.py` really needed?



---

archive/issue_comments_304674.json:
```json
{
    "body": "<a id='comment:49'></a>\nA lot of the stuff is for testing and deciding which bits to include. I haven't really had feedback or suggestions for the last two months. Of course a first step will be to update the tarball to 1.4.3.\n\nThe problem seems to be that we cannot quite reproduce the previous stuff in aspect or speed with functions of MPL or scipy that are not deprecated.",
    "created_at": "2015-04-08T08:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304674",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:49'></a>
A lot of the stuff is for testing and deciding which bits to include. I haven't really had feedback or suggestions for the last two months. Of course a first step will be to update the tarball to 1.4.3.

The problem seems to be that we cannot quite reproduce the previous stuff in aspect or speed with functions of MPL or scipy that are not deprecated.



---

archive/issue_comments_304675.json:
```json
{
    "body": "<a id='comment:51'></a>\nIs anything happening with this ticket? The broken 'source code' links still appear on our online doc.\n\nNathann",
    "created_at": "2015-05-25T10:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304675",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:51'></a>
Is anything happening with this ticket? The broken 'source code' links still appear on our online doc.

Nathann



---

archive/issue_comments_304676.json:
```json
{
    "body": "<a id='comment:52'></a>\nNot lately. I or someone has to update the spkg to 1.4.3 which is the final 1.4 release of MPL before 2.0. The main problem is the deprecation of `Delaunay`, we don't have anything to replace it that match the speed or the appearance in terms of plots. We can have very good slow plotting or very fast crappy plotting but nothing quite like Delaunay and that puts people a bit off.",
    "created_at": "2015-05-25T12:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304676",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'></a>
Not lately. I or someone has to update the spkg to 1.4.3 which is the final 1.4 release of MPL before 2.0. The main problem is the deprecation of `Delaunay`, we don't have anything to replace it that match the speed or the appearance in terms of plots. We can have very good slow plotting or very fast crappy plotting but nothing quite like Delaunay and that puts people a bit off.



---

archive/issue_comments_304677.json:
```json
{
    "body": "<a id='comment:53'></a>\ntest, please ignore",
    "created_at": "2015-06-18T07:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304677",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:53'></a>
test, please ignore



---

archive/issue_comments_304678.json:
```json
{
    "body": "<a id='comment:54'></a>\nOK we need to move this forward. I suggest and will try to do in the next few days:\n* update tarball to 1.4.3\n* use Thierry latest branch in terms of patches\n* Re-introduce Delaunay and use it as a default.\n* fix any doctest warnings due to that decision\n* correct the documentation. \"nn\" has never been \"nearest neighbour\" in the context of Delaunay, it means \"natural neighbour\" which is why the scipy \"nn\" interpolator looks different.\n\nWe'll probably need to deal with Delaunay in MPL 2.0 but there may be suitable replacement in that version.",
    "created_at": "2015-06-18T21:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304678",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:54'></a>
OK we need to move this forward. I suggest and will try to do in the next few days:
* update tarball to 1.4.3
* use Thierry latest branch in terms of patches
* Re-introduce Delaunay and use it as a default.
* fix any doctest warnings due to that decision
* correct the documentation. "nn" has never been "nearest neighbour" in the context of Delaunay, it means "natural neighbour" which is why the scipy "nn" interpolator looks different.

We'll probably need to deal with Delaunay in MPL 2.0 but there may be suitable replacement in that version.



---

archive/issue_comments_304679.json:
```json
{
    "body": "<a id='comment:55'></a>\nThe current linked tarball is suitable for testing at this stage. I am preparing a slimmed down tarball as per instructions in `SPKG.txt` and will put it up when ready.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c9091d6ff06a64a1a237f2ce18886e225c85350\">5c9091d</a></td><td><code>Merge branch 'u/tmonteil/MPL-1.4' of git://trac.sagemath.org/sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b16e00b38cf554bcd55650d95a76ea17ffb4cf1b\">b16e00b</a></td><td><code>Update matplotlib to 1.4.3 replace some Delaunay calls by \"tri\". Keep Delaunay interpolations for the default \"nn\" (natural</code></td></tr></table>\n",
    "created_at": "2015-06-18T22:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304679",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>
The current linked tarball is suitable for testing at this stage. I am preparing a slimmed down tarball as per instructions in `SPKG.txt` and will put it up when ready.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c9091d6ff06a64a1a237f2ce18886e225c85350">5c9091d</a></td><td><code>Merge branch 'u/tmonteil/MPL-1.4' of git://trac.sagemath.org/sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b16e00b38cf554bcd55650d95a76ea17ffb4cf1b">b16e00b</a></td><td><code>Update matplotlib to 1.4.3 replace some Delaunay calls by "tri". Keep Delaunay interpolations for the default "nn" (natural</code></td></tr></table>




---

archive/issue_comments_304680.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/trac17618-MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac17618-MPL-1.4)\" to \"[u/fbissey/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL1.4.3)\".",
    "created_at": "2015-06-18T22:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304680",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/fbissey/trac17618-MPL-1.4](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac17618-MPL-1.4)" to "[u/fbissey/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL1.4.3)".



---

archive/issue_comments_304681.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.\n \n Tarball:\n-[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz)\n+[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz)\n``````\n",
    "created_at": "2015-06-18T22:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304681",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.
 
 Tarball:
-[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.2/matplotlib-1.4.2.tar.gz)
+[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz)
``````




---

archive/issue_comments_304682.json:
```json
{
    "body": "**Changing author** from \"Thierry Monteil\" to \"Thierry Monteil, Fran\u00e7ois Bissey\".",
    "created_at": "2015-06-18T22:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304682",
    "user": "https://github.com/kiwifb"
}
```

**Changing author** from "Thierry Monteil" to "Thierry Monteil, Fran√ßois Bissey".



---

archive/issue_comments_304683.json:
```json
{
    "body": "**Changing commit** from \"[b2c0045d3619b225008984e7631c3abcf4f382e8](https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8)\" to \"[b16e00b38cf554bcd55650d95a76ea17ffb4cf1b](https://github.com/sagemath/sagetrac-mirror/commit/b16e00b38cf554bcd55650d95a76ea17ffb4cf1b)\".",
    "created_at": "2015-06-18T22:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304683",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[b2c0045d3619b225008984e7631c3abcf4f382e8](https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8)" to "[b16e00b38cf554bcd55650d95a76ea17ffb4cf1b](https://github.com/sagemath/sagetrac-mirror/commit/b16e00b38cf554bcd55650d95a76ea17ffb4cf1b)".



---

archive/issue_comments_304684.json:
```json
{
    "body": "**Changing commit** from \"[b16e00b38cf554bcd55650d95a76ea17ffb4cf1b](https://github.com/sagemath/sagetrac-mirror/commit/b16e00b38cf554bcd55650d95a76ea17ffb4cf1b)\" to \"[a62644f4d11251157ce9883521d15993a3bae895](https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895)\".",
    "created_at": "2015-06-18T22:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b16e00b38cf554bcd55650d95a76ea17ffb4cf1b](https://github.com/sagemath/sagetrac-mirror/commit/b16e00b38cf554bcd55650d95a76ea17ffb4cf1b)" to "[a62644f4d11251157ce9883521d15993a3bae895](https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895)".



---

archive/issue_comments_304685.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895\">a62644f</a></td><td><code>Slim the tarball by removing images. Also commit correct version.</code></td></tr></table>\n",
    "created_at": "2015-06-18T22:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895">a62644f</a></td><td><code>Slim the tarball by removing images. Also commit correct version.</code></td></tr></table>




---

archive/issue_comments_304686.json:
```json
{
    "body": "<a id='comment:57'></a>\nReady for review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895\">a62644f</a></td><td><code>Slim the tarball by removing images. Also commit correct version.</code></td></tr></table>\n",
    "created_at": "2015-06-18T22:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304686",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:57'></a>
Ready for review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895">a62644f</a></td><td><code>Slim the tarball by removing images. Also commit correct version.</code></td></tr></table>




---

archive/issue_events_057428.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-18T22:18:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17618#event-57428"
}
```



---

archive/issue_comments_304687.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-06-18T22:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304687",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_304688.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.\n \n Tarball:\n-[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz)\n+[http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2](http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2)\n``````\n",
    "created_at": "2015-06-18T22:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304688",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 With 1.4.2, the `plot_include_source` option seems still broken but a new `plot_html_show_source_link` seems to work, so let us upgrade.
 
 Tarball:
-[https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz](https://downloads.sourceforge.net/project/matplotlib/matplotlib/matplotlib-1.4.3/matplotlib-1.4.3.tar.gz)
+[http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2](http://www.lmona.de/files/sage/matplotlib-1.4.3.tar.bz2)
``````




---

archive/issue_comments_304689.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL1.4.3)\" to \"[u/tmonteil/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL1.4.3)\".",
    "created_at": "2015-06-21T13:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304689",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing branch** from "[u/fbissey/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL1.4.3)" to "[u/tmonteil/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL1.4.3)".



---

archive/issue_comments_304690.json:
```json
{
    "body": "**Changing commit** from \"[a62644f4d11251157ce9883521d15993a3bae895](https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895)\" to \"[4612049e6faa2157c09a8f453fb37ab2b993b2f6](https://github.com/sagemath/sagetrac-mirror/commit/4612049e6faa2157c09a8f453fb37ab2b993b2f6)\".",
    "created_at": "2015-06-21T13:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304690",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing commit** from "[a62644f4d11251157ce9883521d15993a3bae895](https://github.com/sagemath/sagetrac-mirror/commit/a62644f4d11251157ce9883521d15993a3bae895)" to "[4612049e6faa2157c09a8f453fb37ab2b993b2f6](https://github.com/sagemath/sagetrac-mirror/commit/4612049e6faa2157c09a8f453fb37ab2b993b2f6)".



---

archive/issue_comments_304691.json:
```json
{
    "body": "<a id='comment:59'></a>\nI added a `spkg-src` file to automate the tarball's trimming.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4612049e6faa2157c09a8f453fb37ab2b993b2f6\">4612049</a></td><td><code>#17618 add a spkg-src file to automate tarball trimming.</code></td></tr></table>\n",
    "created_at": "2015-06-21T13:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304691",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:59'></a>
I added a `spkg-src` file to automate the tarball's trimming.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4612049e6faa2157c09a8f453fb37ab2b993b2f6">4612049</a></td><td><code>#17618 add a spkg-src file to automate tarball trimming.</code></td></tr></table>




---

archive/issue_comments_304692.json:
```json
{
    "body": "<a id='comment:60'></a>\nThis looks good to me and I think in the interest of moving forward with matplotlib that the approach used is the best. I too was confused with the use of `'nn'`. I'm now running doctests to make sure everything is OK. Then I'll give `positive review`. One clarifying question. Should the following typo be fixed here?\n\n```\n--- a/src/sage/stats/distributions/discrete_gaussian_lattice.py\n+++ b/src/sage/stats/distributions/discrete_gaussian_lattice.py\n@@ -132,7 +132,7 @@ class DiscreteGaussianDistributionLatticeSampler(SageObject):\n         sage: D = DiscreteGaussianDistributionLatticeSampler(identity_matrix(2), 3.0)\n         sage: S = [D() for _ in range(2^12)]\n         sage: l = [vector(v.list() + [S.count(v)]) for v in set(S)]\n-        sage: list_plot3d(l, point_list=True, interploation='nn')\n+        sage: list_plot3d(l, point_list=True, interpolation='nn')\n         Graphics3d Object\n \n     REFERENCES:\n```\nNothing on this ticket caused it but it is a typo and it appeared while searching for `'nn'`.",
    "created_at": "2015-06-21T22:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304692",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:60'></a>
This looks good to me and I think in the interest of moving forward with matplotlib that the approach used is the best. I too was confused with the use of `'nn'`. I'm now running doctests to make sure everything is OK. Then I'll give `positive review`. One clarifying question. Should the following typo be fixed here?

```
--- a/src/sage/stats/distributions/discrete_gaussian_lattice.py
+++ b/src/sage/stats/distributions/discrete_gaussian_lattice.py
@@ -132,7 +132,7 @@ class DiscreteGaussianDistributionLatticeSampler(SageObject):
         sage: D = DiscreteGaussianDistributionLatticeSampler(identity_matrix(2), 3.0)
         sage: S = [D() for _ in range(2^12)]
         sage: l = [vector(v.list() + [S.count(v)]) for v in set(S)]
-        sage: list_plot3d(l, point_list=True, interploation='nn')
+        sage: list_plot3d(l, point_list=True, interpolation='nn')
         Graphics3d Object
 
     REFERENCES:
```
Nothing on this ticket caused it but it is a typo and it appeared while searching for `'nn'`.



---

archive/issue_comments_304693.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2015-06-21T22:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304693",
    "user": "https://github.com/strogdon"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_304694.json:
```json
{
    "body": "<a id='comment:61'></a>\nNow that you have posted it, yes we should and I believe it is appropriate to do it in this ticket. Thierry, would you add it on top of your last commit?",
    "created_at": "2015-06-21T22:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304694",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:61'></a>
Now that you have posted it, yes we should and I believe it is appropriate to do it in this ticket. Thierry, would you add it on top of your last commit?



---

archive/issue_comments_304695.json:
```json
{
    "body": "<a id='comment:62'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30fb859c8e77cc76adb35f6fe8ef44a36215d35d\">30fb859</a></td><td><code>#17618 fix typo in discrete_gaussian_lattice.py</code></td></tr></table>\n",
    "created_at": "2015-06-22T10:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30fb859c8e77cc76adb35f6fe8ef44a36215d35d">30fb859</a></td><td><code>#17618 fix typo in discrete_gaussian_lattice.py</code></td></tr></table>




---

archive/issue_comments_304696.json:
```json
{
    "body": "**Changing commit** from \"[4612049e6faa2157c09a8f453fb37ab2b993b2f6](https://github.com/sagemath/sagetrac-mirror/commit/4612049e6faa2157c09a8f453fb37ab2b993b2f6)\" to \"[30fb859c8e77cc76adb35f6fe8ef44a36215d35d](https://github.com/sagemath/sagetrac-mirror/commit/30fb859c8e77cc76adb35f6fe8ef44a36215d35d)\".",
    "created_at": "2015-06-22T10:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4612049e6faa2157c09a8f453fb37ab2b993b2f6](https://github.com/sagemath/sagetrac-mirror/commit/4612049e6faa2157c09a8f453fb37ab2b993b2f6)" to "[30fb859c8e77cc76adb35f6fe8ef44a36215d35d](https://github.com/sagemath/sagetrac-mirror/commit/30fb859c8e77cc76adb35f6fe8ef44a36215d35d)".



---

archive/issue_comments_304697.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2015-06-22T10:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304697",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_304698.json:
```json
{
    "body": "<a id='comment:63'></a>\nCool, back to need_review.",
    "created_at": "2015-06-22T10:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304698",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:63'></a>
Cool, back to need_review.



---

archive/issue_comments_304699.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-06-22T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304699",
    "user": "https://github.com/strogdon"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_304700.json:
```json
{
    "body": "**Reviewer:** Steven Trogdon",
    "created_at": "2015-06-22T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304700",
    "user": "https://github.com/strogdon"
}
```

**Reviewer:** Steven Trogdon



---

archive/issue_comments_304701.json:
```json
{
    "body": "<a id='comment:64'></a>\nThis works for me.",
    "created_at": "2015-06-22T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304701",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:64'></a>
This works for me.



---

archive/issue_comments_304702.json:
```json
{
    "body": "<a id='comment:65'></a>\n\n```\n+[ -n \"${SAGE_ROOT}\" ] || SAGE_ROOT=\"$(pwd)/../../../\"\n```\n\nIsn't it cleaner to just stop (as `spkg-install` does when `SAGE_LOCAL` is not defined)?",
    "created_at": "2015-06-22T12:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304702",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:65'></a>

```
+[ -n "${SAGE_ROOT}" ] || SAGE_ROOT="$(pwd)/../../../"
```

Isn't it cleaner to just stop (as `spkg-install` does when `SAGE_LOCAL` is not defined)?



---

archive/issue_comments_304703.json:
```json
{
    "body": "**Changing status** from positive_review to needs_info.",
    "created_at": "2015-06-22T13:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304703",
    "user": "https://github.com/strogdon"
}
```

**Changing status** from positive_review to needs_info.



---

archive/issue_comments_304704.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [ncohen](#comment%3A65):\n> \n> ```\n> +[ -n \"${SAGE_ROOT}\" ] || SAGE_ROOT=\"$(pwd)/../../../\"\n> ```\n> \n> Isn't it cleaner to just stop (as `spkg-install` does when `SAGE_LOCAL` is not defined)?\n> \n\nPerhaps something does need to be done. I don't know what the protocol for these `spkg-src` scripts is. The present script does work from a sage shell. However, if not in a sage shell, it fails with something like\n\n```\ntar (child): /64bitdev/storage/sage-git_develop/sage/../../..//upstream/matplotlib-1.4.3.tar.bz2: Cannot open: No such file or directory\ntar (child): Error is not recoverable: exiting now\n```\nunless executed from the `build/pkgs/matplotlib` folder. So setting this back to `needs_info` until it can be resolved.",
    "created_at": "2015-06-22T13:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304704",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:66'></a>
Replying to [ncohen](#comment%3A65):
> 
> ```
> +[ -n "${SAGE_ROOT}" ] || SAGE_ROOT="$(pwd)/../../../"
> ```
> 
> Isn't it cleaner to just stop (as `spkg-install` does when `SAGE_LOCAL` is not defined)?
> 

Perhaps something does need to be done. I don't know what the protocol for these `spkg-src` scripts is. The present script does work from a sage shell. However, if not in a sage shell, it fails with something like

```
tar (child): /64bitdev/storage/sage-git_develop/sage/../../..//upstream/matplotlib-1.4.3.tar.bz2: Cannot open: No such file or directory
tar (child): Error is not recoverable: exiting now
```
unless executed from the `build/pkgs/matplotlib` folder. So setting this back to `needs_info` until it can be resolved.



---

archive/issue_comments_304705.json:
```json
{
    "body": "**Changing commit** from \"[30fb859c8e77cc76adb35f6fe8ef44a36215d35d](https://github.com/sagemath/sagetrac-mirror/commit/30fb859c8e77cc76adb35f6fe8ef44a36215d35d)\" to \"[32afbe15955286dfaf2f3f270ca2e231aa8f0af7](https://github.com/sagemath/sagetrac-mirror/commit/32afbe15955286dfaf2f3f270ca2e231aa8f0af7)\".",
    "created_at": "2015-06-22T14:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[30fb859c8e77cc76adb35f6fe8ef44a36215d35d](https://github.com/sagemath/sagetrac-mirror/commit/30fb859c8e77cc76adb35f6fe8ef44a36215d35d)" to "[32afbe15955286dfaf2f3f270ca2e231aa8f0af7](https://github.com/sagemath/sagetrac-mirror/commit/32afbe15955286dfaf2f3f270ca2e231aa8f0af7)".



---

archive/issue_comments_304706.json:
```json
{
    "body": "<a id='comment:67'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32afbe15955286dfaf2f3f270ca2e231aa8f0af7\">32afbe1</a></td><td><code>#17618 : add some information on how to use spkg-src.</code></td></tr></table>\n",
    "created_at": "2015-06-22T14:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:67'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32afbe15955286dfaf2f3f270ca2e231aa8f0af7">32afbe1</a></td><td><code>#17618 : add some information on how to use spkg-src.</code></td></tr></table>




---

archive/issue_comments_304707.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2015-06-22T14:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304707",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_304708.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [ncohen](#comment%3A65):\n> \n> ```\n> +[ -n \"${SAGE_ROOT}\" ] || SAGE_ROOT=\"$(pwd)/../../../\"\n> ```\n> \n> Isn't it cleaner to just stop (as `spkg-install` does when `SAGE_LOCAL` is not defined)?\n> \n\n\nThe checks done to some `spkg-install` scripts are here to ensure that the script is run from the Sage shell, because they use its features (e.g. some environment variables like `${MAKE}`). Here, in contrary to such `spkg-install` scripts, there is no need to check that since the script do not use such feature, except `${SAGE_ROOT}` that can be recovered from the current location.\n\nReplying to [strogdon](#comment%3A66):\n> Perhaps something does need to be done. I don't know what the protocol for these `spkg-src` scripts is. The present script does work from a sage shell. However, if not in a sage shell, it fails with something like\n> \n> ```\n> tar (child): /64bitdev/storage/sage-git_develop/sage/../../..//upstream/matplotlib-1.4.3.tar.bz2: Cannot open: No such file or directory\n> tar (child): Error is not recoverable: exiting now\n> ```\n> unless executed from the `build/pkgs/matplotlib` folder. So setting this back to `needs_info` until it can be resolved.\n\n\nThe whole \"protocol\" can be found [here](http://www.sagemath.org/documentation/html/en/developer/packaging.html#modified-tarballs), which is pretty vague regarding the importance to be run from the Sage shell.\n\nHow i see it, this script is intented to be run by maintainers, ease of use is prefered over security, which is pretty different from `spkg-install` that is run by users and should be pretty strict regarding misuses. The aim is not to have a script that could be run from anywhere, obfuscated with tons of tests, but should deserve the following purposes:\n\n- document and make transparent the differences between the upstream tarball and the one we distribute (hence the comments above each paragraph),\n- be a handy tool to save some time for next updates (hence the autodiscovery of latest version and download url, and the possibility to be run from the developer's shell),\n- i would add perfect reproductibility of distributed tarballs, but it seems that nobody cares.",
    "created_at": "2015-06-22T14:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304708",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:68'></a>
Replying to [ncohen](#comment%3A65):
> 
> ```
> +[ -n "${SAGE_ROOT}" ] || SAGE_ROOT="$(pwd)/../../../"
> ```
> 
> Isn't it cleaner to just stop (as `spkg-install` does when `SAGE_LOCAL` is not defined)?
> 


The checks done to some `spkg-install` scripts are here to ensure that the script is run from the Sage shell, because they use its features (e.g. some environment variables like `${MAKE}`). Here, in contrary to such `spkg-install` scripts, there is no need to check that since the script do not use such feature, except `${SAGE_ROOT}` that can be recovered from the current location.

Replying to [strogdon](#comment%3A66):
> Perhaps something does need to be done. I don't know what the protocol for these `spkg-src` scripts is. The present script does work from a sage shell. However, if not in a sage shell, it fails with something like
> 
> ```
> tar (child): /64bitdev/storage/sage-git_develop/sage/../../..//upstream/matplotlib-1.4.3.tar.bz2: Cannot open: No such file or directory
> tar (child): Error is not recoverable: exiting now
> ```
> unless executed from the `build/pkgs/matplotlib` folder. So setting this back to `needs_info` until it can be resolved.


The whole "protocol" can be found [here](http://www.sagemath.org/documentation/html/en/developer/packaging.html#modified-tarballs), which is pretty vague regarding the importance to be run from the Sage shell.

How i see it, this script is intented to be run by maintainers, ease of use is prefered over security, which is pretty different from `spkg-install` that is run by users and should be pretty strict regarding misuses. The aim is not to have a script that could be run from anywhere, obfuscated with tons of tests, but should deserve the following purposes:

- document and make transparent the differences between the upstream tarball and the one we distribute (hence the comments above each paragraph),
- be a handy tool to save some time for next updates (hence the autodiscovery of latest version and download url, and the possibility to be run from the developer's shell),
- i would add perfect reproductibility of distributed tarballs, but it seems that nobody cares.



---

archive/issue_comments_304709.json:
```json
{
    "body": "<a id='comment:69'></a>\nWhat about replacing \"#!/usr/bin/env bash\" with \"#!/usr/bin/env sage -sh\" ? Wouldn'it solve the problem in an elegant way? We would not have to check for those environment variables anymore, and that would only require 'sage' can be found in `PATH` (which is easier than requiring SAGE_ROOT to be set)? Errors would be reported by bash itself (i.e. 'sage' not found) when needed?",
    "created_at": "2015-06-22T14:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304709",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:69'></a>
What about replacing "#!/usr/bin/env bash" with "#!/usr/bin/env sage -sh" ? Wouldn'it solve the problem in an elegant way? We would not have to check for those environment variables anymore, and that would only require 'sage' can be found in `PATH` (which is easier than requiring SAGE_ROOT to be set)? Errors would be reported by bash itself (i.e. 'sage' not found) when needed?



---

archive/issue_comments_304710.json:
```json
{
    "body": "<a id='comment:70'></a>\n> - i would add perfect reproductibility of distributed tarballs, but it seems that nobody cares.\n\n\nThat's wrong (the 'nobody cares' part, of course `:-P`)",
    "created_at": "2015-06-22T14:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304710",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:70'></a>
> - i would add perfect reproductibility of distributed tarballs, but it seems that nobody cares.


That's wrong (the 'nobody cares' part, of course `:-P`)



---

archive/issue_comments_304711.json:
```json
{
    "body": "<a id='comment:71'></a>\nReplying to [ncohen](#comment%3A69):\n> What about replacing \"#!/usr/bin/env bash\" with \"#!/usr/bin/env sage -sh\" ? \n\n\nI think that if you put a command with spaces after \"#!/usr/bin/env\", the behavior is either unpredictable or just wrong (= not what you expect). I forget which. In any case, I think it's a bad idea.",
    "created_at": "2015-06-22T15:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304711",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:71'></a>
Replying to [ncohen](#comment%3A69):
> What about replacing "#!/usr/bin/env bash" with "#!/usr/bin/env sage -sh" ? 


I think that if you put a command with spaces after "#!/usr/bin/env", the behavior is either unpredictable or just wrong (= not what you expect). I forget which. In any case, I think it's a bad idea.



---

archive/issue_comments_304712.json:
```json
{
    "body": "<a id='comment:72'></a>\n> I think that if you put a command with spaces after \"#!/usr/bin/env\", the behavior is either unpredictable or just wrong (= not what you expect). I forget which. In any case, I think it's a bad idea.\n\n\nWorks for me. Can you illustrate your claim with examples, possibly online bug reports? It seems that \"env -- sage -sh\" does what it should.",
    "created_at": "2015-06-22T15:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304712",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:72'></a>
> I think that if you put a command with spaces after "#!/usr/bin/env", the behavior is either unpredictable or just wrong (= not what you expect). I forget which. In any case, I think it's a bad idea.


Works for me. Can you illustrate your claim with examples, possibly online bug reports? It seems that "env -- sage -sh" does what it should.



---

archive/issue_comments_304713.json:
```json
{
    "body": "<a id='comment:73'></a>\nOh. You are right, it totally breaks when it's the first line of a bash script.",
    "created_at": "2015-06-22T15:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304713",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:73'></a>
Oh. You are right, it totally breaks when it's the first line of a bash script.



---

archive/issue_comments_304714.json:
```json
{
    "body": "<a id='comment:74'></a>\nReplying to [ncohen](#comment%3A72):\n> > I think that if you put a command with spaces after \"#!/usr/bin/env\", the behavior is either unpredictable or just wrong (= not what you expect). I forget which. In any case, I think it's a bad idea.\n\n> \n> Works for me. Can you illustrate your claim with examples, possibly online bug reports? It seems that \"env -- sage -sh\" does what it should.\n\n\nFor reference, see http://mail-index.netbsd.org/netbsd-users/2008/11/09/msg002388.html.",
    "created_at": "2015-06-22T16:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304714",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:74'></a>
Replying to [ncohen](#comment%3A72):
> > I think that if you put a command with spaces after "#!/usr/bin/env", the behavior is either unpredictable or just wrong (= not what you expect). I forget which. In any case, I think it's a bad idea.

> 
> Works for me. Can you illustrate your claim with examples, possibly online bug reports? It seems that "env -- sage -sh" does what it should.


For reference, see http://mail-index.netbsd.org/netbsd-users/2008/11/09/msg002388.html.



---

archive/issue_comments_304715.json:
```json
{
    "body": "<a id='comment:75'></a>\nI don't think checking for `SAGE_ROOT` is necessarily a bad idea. And the protocol doesn't seem to require the script to be run from the Sage shell. What if something like the following, in addition to the latest commit, were added\n\n```\n--- a/build/pkgs/matplotlib/spkg-src\n+++ b/build/pkgs/matplotlib/spkg-src\n@@ -2,6 +2,10 @@\n \n set -e\n \n+printf \"This script should be run as ./spkg-src from the repository to which it \n+belongs, or from the Sage shell.\\n\"\n+read -rsp $'Press any key to continue or \\'CTRL+C\\' to exit :\\n' -n1 key\n+\n [ -n \"${SAGE_ROOT}\" ] || SAGE_ROOT=\"$(pwd)/../../../\"\n```\nOff hand I don't know how to check if one is `in` the correct repository. And perhaps giving the warning is enough.",
    "created_at": "2015-06-22T16:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304715",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:75'></a>
I don't think checking for `SAGE_ROOT` is necessarily a bad idea. And the protocol doesn't seem to require the script to be run from the Sage shell. What if something like the following, in addition to the latest commit, were added

```
--- a/build/pkgs/matplotlib/spkg-src
+++ b/build/pkgs/matplotlib/spkg-src
@@ -2,6 +2,10 @@
 
 set -e
 
+printf "This script should be run as ./spkg-src from the repository to which it 
+belongs, or from the Sage shell.\n"
+read -rsp $'Press any key to continue or \'CTRL+C\' to exit :\n' -n1 key
+
 [ -n "${SAGE_ROOT}" ] || SAGE_ROOT="$(pwd)/../../../"
```
Off hand I don't know how to check if one is `in` the correct repository. And perhaps giving the warning is enough.



---

archive/issue_comments_304716.json:
```json
{
    "body": "**Changing commit** from \"[32afbe15955286dfaf2f3f270ca2e231aa8f0af7](https://github.com/sagemath/sagetrac-mirror/commit/32afbe15955286dfaf2f3f270ca2e231aa8f0af7)\" to \"[9dc580db712380bbcfe20c958d5125696ceb5e70](https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70)\".",
    "created_at": "2015-06-22T18:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[32afbe15955286dfaf2f3f270ca2e231aa8f0af7](https://github.com/sagemath/sagetrac-mirror/commit/32afbe15955286dfaf2f3f270ca2e231aa8f0af7)" to "[9dc580db712380bbcfe20c958d5125696ceb5e70](https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70)".



---

archive/issue_comments_304717.json:
```json
{
    "body": "<a id='comment:76'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70\">9dc580d</a></td><td><code>#17618 spkg-src can be run from anywhere.</code></td></tr></table>\n",
    "created_at": "2015-06-22T18:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:76'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70">9dc580d</a></td><td><code>#17618 spkg-src can be run from anywhere.</code></td></tr></table>




---

archive/issue_comments_304718.json:
```json
{
    "body": "<a id='comment:77'></a>\nReplying to [strogdon](#comment%3A75):\n\nI am not favorable to developing interactive user interfaces for `spkg-src` scripts.",
    "created_at": "2015-06-22T18:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304718",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:77'></a>
Replying to [strogdon](#comment%3A75):

I am not favorable to developing interactive user interfaces for `spkg-src` scripts.



---

archive/issue_comments_304719.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-06-22T19:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304719",
    "user": "https://github.com/strogdon"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_304720.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [tmonteil](#comment%3A77):\n> Replying to [strogdon](#comment%3A75):\n> \n> I am not favorable to developing interactive user interfaces for `spkg-src` scripts.\n\nIt's not really the best. I'm good with this now. Let's hope it sticks.",
    "created_at": "2015-06-22T19:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304720",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:78'></a>
Replying to [tmonteil](#comment%3A77):
> Replying to [strogdon](#comment%3A75):
> 
> I am not favorable to developing interactive user interfaces for `spkg-src` scripts.

It's not really the best. I'm good with this now. Let's hope it sticks.



---

archive/issue_events_057429.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-23T22:34:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17618#event-57429"
}
```



---

archive/issue_comments_304721.json:
```json
{
    "body": "**Changing branch** from \"[u/tmonteil/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL1.4.3)\" to \"[9dc580db712380bbcfe20c958d5125696ceb5e70](https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70)\".",
    "created_at": "2015-06-23T22:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304721",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tmonteil/MPL1.4.3](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/MPL1.4.3)" to "[9dc580db712380bbcfe20c958d5125696ceb5e70](https://github.com/sagemath/sagetrac-mirror/commit/9dc580db712380bbcfe20c958d5125696ceb5e70)".



---

archive/issue_comments_304722.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-06-23T22:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17618#issuecomment-304722",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
