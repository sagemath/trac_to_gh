# Issue 17904: CremonaDatabase omits data for curves not first in their class

archive/issues_017667.json:
```json
{
    "body": "Chris Wuthrich reported that\n\n```\nsage: E = EllipticCurve('100467a2')\nsage: E.database_attributes()\n{'conductor': 100467,\n 'cremona_label': '100467a2',\n 'rank': 1,\n 'torsion_order': 1}\n```\nalthough the database does contain the generators:\n\n```\nsage: CremonaDatabase().allgens(100467)['a2']\n[[7465870518064287, 219103670535029299, 7758864174573]]\n```\n\nIt seems that (in two palces) the code to extract the data from the database wrongly assumes that some data only exists for the first curve in each isogeny class, which is not true.\n\nA simple fix to sage/databases/cremona.py is on its way.\n\nCC:  @categorie\n\nKeywords: Cremona database\n\nBranch/Commit: 4de6008e45d19997207d59c686c180c717725d48\n\nReviewer: Chris Wuthrich\n\nAuthor: John Cremona\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17904\n\n",
    "closed_at": "2015-03-08T22:01:02Z",
    "created_at": "2015-03-06T20:18:47Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "CremonaDatabase omits data for curves not first in their class",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17904",
    "user": "https://github.com/JohnCremona"
}
```
Chris Wuthrich reported that

```
sage: E = EllipticCurve('100467a2')
sage: E.database_attributes()
{'conductor': 100467,
 'cremona_label': '100467a2',
 'rank': 1,
 'torsion_order': 1}
```
although the database does contain the generators:

```
sage: CremonaDatabase().allgens(100467)['a2']
[[7465870518064287, 219103670535029299, 7758864174573]]
```

It seems that (in two palces) the code to extract the data from the database wrongly assumes that some data only exists for the first curve in each isogeny class, which is not true.

A simple fix to sage/databases/cremona.py is on its way.

CC:  @categorie

Keywords: Cremona database

Branch/Commit: 4de6008e45d19997207d59c686c180c717725d48

Reviewer: Chris Wuthrich

Author: John Cremona

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17904





---

archive/issue_comments_251210.json:
```json
{
    "body": "Changing keywords from \"\" to \"Cremona database\".",
    "created_at": "2015-03-06T20:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251210",
    "user": "https://github.com/JohnCremona"
}
```

Changing keywords from "" to "Cremona database".



---

archive/issue_comments_251211.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to elliptic curves.",
    "created_at": "2015-03-06T20:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251211",
    "user": "https://github.com/JohnCremona"
}
```

Changing component from PLEASE CHANGE to elliptic curves.



---

archive/issue_comments_251212.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-03-06T20:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251212",
    "user": "https://github.com/JohnCremona"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_251213.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-06T20:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251213",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_251214.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2015-03-06T20:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251214",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_251215.json:
```json
{
    "body": "<a id='comment:3'></a>I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.",
    "created_at": "2015-03-06T20:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251215",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.



---

archive/issue_comments_251216.json:
```json
{
    "body": "<a id='comment:4'></a>I agree with the fix and I checked that it solves the problem. I am running the obligatory tests now.\n\nThanks for fixing that so fast. Very helpful.",
    "created_at": "2015-03-06T22:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251216",
    "user": "https://github.com/categorie"
}
```

<a id='comment:4'></a>I agree with the fix and I checked that it solves the problem. I am running the obligatory tests now.

Thanks for fixing that so fast. Very helpful.



---

archive/issue_comments_251217.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-07T00:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251217",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_251218.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:3 cremona]:\n> I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.\n\n\nYou should add a doctest and annotate it with\n\n```\n# optional - database_cremona_ellcurve\n```\nThere are many such tests already in `src/sage/databases/cremona.py`.\n\n(Note that I am not setting the ticket to needs_work for this)",
    "created_at": "2015-03-07T09:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251218",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:3 cremona]:
> I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.


You should add a doctest and annotate it with

```
# optional - database_cremona_ellcurve
```
There are many such tests already in `src/sage/databases/cremona.py`.

(Note that I am not setting the ticket to needs_work for this)



---

archive/issue_comments_251219.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 jdemeyer]:\n> Replying to [comment:3 cremona]:\n> > I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.\n\n> \n> You should add a doctest and annotate it with\n> \n> ```\n> # optional - database_cremona_ellcurve\n> ```\n> There are many such tests already in `src/sage/databases/cremona.py`.\n\n\nOK, I will do that!\n\n> \n> (Note that I am not setting the ticket to needs_work for this)",
    "created_at": "2015-03-07T11:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251219",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>Replying to [comment:6 jdemeyer]:
> Replying to [comment:3 cremona]:
> > I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.

> 
> You should add a doctest and annotate it with
> 
> ```
> # optional - database_cremona_ellcurve
> ```
> There are many such tests already in `src/sage/databases/cremona.py`.


OK, I will do that!

> 
> (Note that I am not setting the ticket to needs_work for this)



---

archive/issue_comments_251220.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-03-07T12:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_251221.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-03-07T12:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_251222.json:
```json
{
    "body": "<a id='comment:9'></a>OK, so I added the doctest and the act of pushing the new commit automatically caused the needs_review flag to be set.  Sorry, Chris!",
    "created_at": "2015-03-07T12:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251222",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>OK, so I added the doctest and the act of pushing the new commit automatically caused the needs_review flag to be set.  Sorry, Chris!



---

archive/issue_comments_251223.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-07T13:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251223",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_251224.json:
```json
{
    "body": "<a id='comment:10'></a>Ok. I fixed a tiny sphinx error on that page, too.\n\nI did test cremona.py, but I have not run the complete test again after the last changes which only affect the docstring in that file. If anyone finds that inacceptable, then I will run them.\n\n---\nNew commits:",
    "created_at": "2015-03-07T13:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251224",
    "user": "https://github.com/categorie"
}
```

<a id='comment:10'></a>Ok. I fixed a tiny sphinx error on that page, too.

I did test cremona.py, but I have not run the complete test again after the last changes which only affect the docstring in that file. If anyone finds that inacceptable, then I will run them.

---
New commits:



---

archive/issue_comments_251225.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks -- I think we can leave the rest to various bots.\n\nFor what it's worth I used the cremona_curves() iterator to grab every single curve and check that len(E.gens())==E.rank(), which it did fast enough to be confident that all the data was really coming from the database.",
    "created_at": "2015-03-07T14:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251225",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>Thanks -- I think we can leave the rest to various bots.

For what it's worth I used the cremona_curves() iterator to grab every single curve and check that len(E.gens())==E.rank(), which it did fast enough to be confident that all the data was really coming from the database.



---

archive/issue_events_050971.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-08T22:01:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17904#event-50971"
}
```



---

archive/issue_comments_251226.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-08T22:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17904#issuecomment-251226",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
