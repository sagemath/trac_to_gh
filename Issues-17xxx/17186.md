# Issue 17186: LatticePoset: faster is_modular

archive/issues_016949.json:
```json
{
    "body": "Checking if a lattice is modular can be done with rank function. Same applies to [upper|lower]_semimodular.\n\n\nCC:  @nathanncohen\n\nBranch/Commit: c3ff548074278cfe7089a097372321631bfdea1c\n\nReviewer: Nathann Cohen\n\nAuthor: Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17186\n\n",
    "closed_at": "2014-10-24T10:14:37Z",
    "created_at": "2014-10-21T10:51:10Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "LatticePoset: faster is_modular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17186",
    "user": "https://github.com/jm58660"
}
```
Checking if a lattice is modular can be done with rank function. Same applies to [upper|lower]_semimodular.


CC:  @nathanncohen

Branch/Commit: c3ff548074278cfe7089a097372321631bfdea1c

Reviewer: Nathann Cohen

Author: Jori MÃ¤ntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17186





---

archive/issue_comments_224359.json:
```json
{
    "body": "<a id='comment:2'></a>For a proof see Enumerative combinatoric, pp. 286-287.\n\n---\nNew commits:",
    "created_at": "2014-10-21T11:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224359",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>For a proof see Enumerative combinatoric, pp. 286-287.

---
New commits:



---

archive/issue_comments_224360.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-21T11:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224360",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224361.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-10-21T15:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224361",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_224362.json:
```json
{
    "body": "<a id='comment:3'></a>Hello,\n\nI was not able to find this proof at pages 286-287 of any of the two volumes of Enumerative Combinatorics. And it would be cool to have a correct reference to write in the function's code.\n\nI also found a reference there, but they use <= when you use <.\n\nhttps://www.math.ku.edu/~jmartin/courses/math796-S08/notes0201.pdf\n\nBy the way I do not understand why `rank_dict` should be a `dict`, as you use it to associate things to integers between 0 and n-1... A list does that already, and faster.\n\nNathann",
    "created_at": "2014-10-21T15:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224362",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Hello,

I was not able to find this proof at pages 286-287 of any of the two volumes of Enumerative Combinatorics. And it would be cool to have a correct reference to write in the function's code.

I also found a reference there, but they use <= when you use <.

https://www.math.ku.edu/~jmartin/courses/math796-S08/notes0201.pdf

By the way I do not understand why `rank_dict` should be a `dict`, as you use it to associate things to integers between 0 and n-1... A list does that already, and faster.

Nathann



---

archive/issue_comments_224363.json:
```json
{
    "body": "<a id='comment:4'></a>I don't have physical book, this was on http://www-math.mit.edu/~rstan/ec/ec1.pdf\n\nDefinition says \"for all ... => ...\", and my code converts this to \"if ... < ... return False\". Should I convert this to \"return all(... for a in... for b in...)\"?\n\nChanging rank_dict to array would need changing some parts of `hasse_diagram.py`.",
    "created_at": "2014-10-21T16:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224363",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>I don't have physical book, this was on http://www-math.mit.edu/~rstan/ec/ec1.pdf

Definition says "for all ... => ...", and my code converts this to "if ... < ... return False". Should I convert this to "return all(... for a in... for b in...)"?

Changing rank_dict to array would need changing some parts of `hasse_diagram.py`.



---

archive/issue_comments_224364.json:
```json
{
    "body": "<a id='comment:5'></a>> I don't have physical book, this was on http://www-math.mit.edu/~rstan/ec/ec1.pdf\n\n\nOkay.\n\n> Definition says \"for all ... => ...\", and my code converts this to \"if ... < ... return False\". Should I convert this to \"return all(... for a in... for b in...)\"?\n\n\nI see. Sorry for that.\n\n> Changing rank_dict to array would need changing some parts of `hasse_diagram.py`.\n\n\nIt is weird that it got implemented like that in the first place. There is some speed to get for free there. \n\nAnyway. I will review that patch in a second.\n\nNathann",
    "created_at": "2014-10-21T16:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224364",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>> I don't have physical book, this was on http://www-math.mit.edu/~rstan/ec/ec1.pdf


Okay.

> Definition says "for all ... => ...", and my code converts this to "if ... < ... return False". Should I convert this to "return all(... for a in... for b in...)"?


I see. Sorry for that.

> Changing rank_dict to array would need changing some parts of `hasse_diagram.py`.


It is weird that it got implemented like that in the first place. There is some speed to get for free there. 

Anyway. I will review that patch in a second.

Nathann



---

archive/issue_comments_224365.json:
```json
{
    "body": "<a id='comment:6'></a>Hello again !\n\nThis patch is good. Could you please mention in the function's documentation the result that you use to check the property, and if possible refer to the book ?\n\nThanks,\n\nNathann",
    "created_at": "2014-10-21T16:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224365",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Hello again !

This patch is good. Could you please mention in the function's documentation the result that you use to check the property, and if possible refer to the book ?

Thanks,

Nathann



---

archive/issue_comments_224366.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T19:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224367.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-10-21T19:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224367",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_224368.json:
```json
{
    "body": "<a id='comment:8'></a>There was a minor error, `is_ranked` should be `is_graded`. Also there is now some other minor changes.\n\nI'm not happy with examples, but at least the code is now much faster.",
    "created_at": "2014-10-21T19:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224368",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:8'></a>There was a minor error, `is_ranked` should be `is_graded`. Also there is now some other minor changes.

I'm not happy with examples, but at least the code is now much faster.



---

archive/issue_comments_224369.json:
```json
{
    "body": "<a id='comment:9'></a>> There was a minor error, `is_ranked` should be `is_graded`.\n\n\nIsn't it exactly the same for lattices ?\n\n> Also there is now some other minor changes.\n\n\nHmmm... Well, take a look at commit \"Correction from is_ranked to is_graded; some changes on docs\". You will see what is the effect of changing the order in which the functions appear for the reviewer `:-P`\n\n> I'm not happy with examples, but at least the code is now much faster.\n\n\nWell, it seems good to me (even though the examples were weak from the start) but I would like to have your opinion on this ranked/graded thing first, because I do not understand how it could make your code faster if the two are equivalent `O_o`\n\nNathann",
    "created_at": "2014-10-22T09:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224369",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>> There was a minor error, `is_ranked` should be `is_graded`.


Isn't it exactly the same for lattices ?

> Also there is now some other minor changes.


Hmmm... Well, take a look at commit "Correction from is_ranked to is_graded; some changes on docs". You will see what is the effect of changing the order in which the functions appear for the reviewer `:-P`

> I'm not happy with examples, but at least the code is now much faster.


Well, it seems good to me (even though the examples were weak from the start) but I would like to have your opinion on this ranked/graded thing first, because I do not understand how it could make your code faster if the two are equivalent `O_o`

Nathann



---

archive/issue_comments_224370.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-22T09:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224371.json:
```json
{
    "body": "<a id='comment:11'></a>Arghs, of course. Corrected `is_graded` -> `is_ranked`.\n\nSame change should be made for `is_distributive()`. Or actually, `lattices.py` should  define it's own `is_graded` and save thousands of picoseconds.",
    "created_at": "2014-10-22T09:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224371",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>Arghs, of course. Corrected `is_graded` -> `is_ranked`.

Same change should be made for `is_distributive()`. Or actually, `lattices.py` should  define it's own `is_graded` and save thousands of picoseconds.



---

archive/issue_comments_224372.json:
```json
{
    "body": "<a id='comment:12'></a>Yooooooo !\n\n> Arghs, of course. Corrected `is_graded` -> `is_ranked`.\n> \n> Same change should be made for `is_distributive()`. Or actually, `lattices.py` should  define it's own `is_graded` and save thousands of picoseconds.\n\n\nHmmm... But then I wonder: when did you observe a difference in speed ? When you changed the formulation used in the loop (which makes sense) or when you changed graded to ranked (which would be alarming) ?\n\nNathann",
    "created_at": "2014-10-22T09:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224372",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>Yooooooo !

> Arghs, of course. Corrected `is_graded` -> `is_ranked`.
> 
> Same change should be made for `is_distributive()`. Or actually, `lattices.py` should  define it's own `is_graded` and save thousands of picoseconds.


Hmmm... But then I wonder: when did you observe a difference in speed ? When you changed the formulation used in the loop (which makes sense) or when you changed graded to ranked (which would be alarming) ?

Nathann



---

archive/issue_comments_224373.json:
```json
{
    "body": "<a id='comment:13'></a>Nothing to be worry about: Speed difference happened when I changed the whole algorithm.",
    "created_at": "2014-10-22T10:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224373",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:13'></a>Nothing to be worry about: Speed difference happened when I changed the whole algorithm.



---

archive/issue_comments_224374.json:
```json
{
    "body": "<a id='comment:14'></a>Oh, cool. Then I wait for the tests to pass and I switch the ticket to `positive_review`. Thanks `:-)`\n\nNathann",
    "created_at": "2014-10-22T10:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224374",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Oh, cool. Then I wait for the tests to pass and I switch the ticket to `positive_review`. Thanks `:-)`

Nathann



---

archive/issue_comments_224375.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-22T10:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224375",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224376.json:
```json
{
    "body": "<a id='comment:16'></a>Two very minor things that if you don't want to change, you don't have to.\n\n1 - Instead of a comment, I'd put the reference in the docstring\n\n```\nALGORITHM:\n\nBased on pp. 286-287 of Enumerative Combinatorics, Vol 1 [EnumComb1]_.\n```\nperhaps with some detail of the algorithm.\n\n2 - Use `all`. It could be (marginally) faster, and makes it a little easier to read IMO.\n\n```diff\n- for a in range(0, n):\n-     for b in range(a+1, n):\n-         if ( H._rank_dict[a]+H._rank_dict[b] !=\n-              H._rank_dict[H._meet[a,b]] + H._rank_dict[H._join[a,b]] ):\n-             return False\n- return True\n+ return all(H._rank_dict[a] + H._rank_dict[b]\n+            == H._rank_dict[H._meet[a,b]] + H._rank_dict[H._join[a,b]]\n+            for a in range(n) for b in range(a+1, n))\n```",
    "created_at": "2014-10-22T14:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224376",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>Two very minor things that if you don't want to change, you don't have to.

1 - Instead of a comment, I'd put the reference in the docstring

```
ALGORITHM:

Based on pp. 286-287 of Enumerative Combinatorics, Vol 1 [EnumComb1]_.
```
perhaps with some detail of the algorithm.

2 - Use `all`. It could be (marginally) faster, and makes it a little easier to read IMO.

```diff
- for a in range(0, n):
-     for b in range(a+1, n):
-         if ( H._rank_dict[a]+H._rank_dict[b] !=
-              H._rank_dict[H._meet[a,b]] + H._rank_dict[H._join[a,b]] ):
-             return False
- return True
+ return all(H._rank_dict[a] + H._rank_dict[b]
+            == H._rank_dict[H._meet[a,b]] + H._rank_dict[H._join[a,b]]
+            for a in range(n) for b in range(a+1, n))
```



---

archive/issue_comments_224377.json:
```json
{
    "body": "<a id='comment:17'></a>Good ideas from tscrim. I didn't happen to think that in `all(for x... for y)` I can refer to `x` when making loop on `y`. It is of course easier to read code that mirrors closely the mathematical definition.\n\nA question: Should I mention same book on all three functions, or only once?",
    "created_at": "2014-10-22T16:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224377",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:17'></a>Good ideas from tscrim. I didn't happen to think that in `all(for x... for y)` I can refer to `x` when making loop on `y`. It is of course easier to read code that mirrors closely the mathematical definition.

A question: Should I mention same book on all three functions, or only once?



---

archive/issue_comments_224378.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-10-22T16:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224378",
    "user": "https://github.com/jm58660"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_224379.json:
```json
{
    "body": "<a id='comment:18'></a>> A question: Should I mention same book on all three functions, or only once?\n\n\nWe have to find the info if we look for it. Either copy/paste three times if it is not very long, or say in two functions that the explanation is in the third one.\n\nNathann",
    "created_at": "2014-10-22T16:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224379",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>> A question: Should I mention same book on all three functions, or only once?


We have to find the info if we look for it. Either copy/paste three times if it is not very long, or say in two functions that the explanation is in the third one.

Nathann



---

archive/issue_comments_224380.json:
```json
{
    "body": "<a id='comment:19'></a>I'd at least put a reference link to the book `[EnumComb1]_` in all three.",
    "created_at": "2014-10-22T19:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224380",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>I'd at least put a reference link to the book `[EnumComb1]_` in all three.



---

archive/issue_comments_224381.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-23T06:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224382.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-23T06:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224382",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_224383.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-23T09:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224383",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224384.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-24T10:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17186#issuecomment-224384",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049810.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-24T10:14:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17186",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17186#event-49810"
}
```
