# Issue 17819: Use unsigned long for Integer.divisors

archive/issues_017582.json:
```json
{
    "body": "The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems. On 64-bit systems, there should be no speed difference (except perhaps a small speed-up due to skipping the `mpz_longlong` overhead and the fact that we use 64 instead of 63 bits).\n\n**Branch/Commit:** [1194cb75acb96340b16f9a256aa55e0a3c2eb38c](https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c)\n\n**Reviewer:** Fran\u00e7ois Bissey\n\n**Author:** Jeroen Demeyer\n\n**Dependencies:** #17794, #10257\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17819\n\n",
    "closed_at": "2015-03-03T00:25:07Z",
    "created_at": "2015-02-20T19:27:20Z",
    "labels": [
        "component: c_lib",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Use unsigned long for Integer.divisors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17819",
    "user": "https://github.com/jdemeyer"
}
```
The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems. On 64-bit systems, there should be no speed difference (except perhaps a small speed-up due to skipping the `mpz_longlong` overhead and the fact that we use 64 instead of 63 bits).

**Branch/Commit:** [1194cb75acb96340b16f9a256aa55e0a3c2eb38c](https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c)

**Reviewer:** François Bissey

**Author:** Jeroen Demeyer

**Dependencies:** #17794, #10257

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/17819





---

archive/issue_comments_309363.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `uintmax_t` for this, which is at least as large as `long long`. Another advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`.\n+The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `uintmax_t` for this, which is at least as large as `long long`. Another advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. Instead we can use the standard MPIR function `mpz_set_ux`.\n``````\n",
    "created_at": "2015-02-20T19:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309363",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `uintmax_t` for this, which is at least as large as `long long`. Another advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`.
+The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `uintmax_t` for this, which is at least as large as `long long`. Another advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. Instead we can use the standard MPIR function `mpz_set_ux`.
``````




---

archive/issue_comments_309364.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/17819](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17819)",
    "created_at": "2015-02-20T21:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309364",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/17819](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17819)



---

archive/issue_comments_309365.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-02-20T21:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309365",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_309366.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fae8cecadc86555f7962a903bb686f2727ff2f58\">fae8cec</a></td><td><code>Use uintmax_t for Integer.divisors</code></td></tr></table>\n",
    "created_at": "2015-02-20T21:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309366",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fae8cecadc86555f7962a903bb686f2727ff2f58">fae8cec</a></td><td><code>Use uintmax_t for Integer.divisors</code></td></tr></table>




---

archive/issue_comments_309367.json:
```json
{
    "body": "**Commit:** [fae8cecadc86555f7962a903bb686f2727ff2f58](https://github.com/sagemath/sagetrac-mirror/commit/fae8cecadc86555f7962a903bb686f2727ff2f58)",
    "created_at": "2015-02-20T21:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309367",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [fae8cecadc86555f7962a903bb686f2727ff2f58](https://github.com/sagemath/sagetrac-mirror/commit/fae8cecadc86555f7962a903bb686f2727ff2f58)



---

archive/issue_comments_309368.json:
```json
{
    "body": "**Changing commit** from \"[fae8cecadc86555f7962a903bb686f2727ff2f58](https://github.com/sagemath/sagetrac-mirror/commit/fae8cecadc86555f7962a903bb686f2727ff2f58)\" to \"[6f851b9eb96f73930aa265673679434eecfac6a6](https://github.com/sagemath/sagetrac-mirror/commit/6f851b9eb96f73930aa265673679434eecfac6a6)\".",
    "created_at": "2015-02-21T10:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309368",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fae8cecadc86555f7962a903bb686f2727ff2f58](https://github.com/sagemath/sagetrac-mirror/commit/fae8cecadc86555f7962a903bb686f2727ff2f58)" to "[6f851b9eb96f73930aa265673679434eecfac6a6](https://github.com/sagemath/sagetrac-mirror/commit/6f851b9eb96f73930aa265673679434eecfac6a6)".



---

archive/issue_comments_309369.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ba47f0ef294af2b0ac5736a36144a5f77bb6c36\">6ba47f0</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/10257</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/307e5264e155ccb72fd3cc28d08013a8b9ce647b\">307e526</a></td><td><code>Revert raise MemoryError changes from #12212</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd8407bcf29c42dadade7bed183cc68ebf310b69\">cd8407b</a></td><td><code>Merge branch 'ticket/12212_revert_raise' into ticket/10257</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa0612d0a7ad58cc403f157b42877d29ba0371fa\">fa0612d</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/10257</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c561e2e05851c55a4bddd9045768d0559a456fa5\">c561e2e</a></td><td><code>Fix check_allocarray() failure doctest on OS X</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6650ca79a28bd96cd66d3dc3b3b917bd91c415e5\">6650ca7</a></td><td><code>Add csage dependencies in Makefile</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c37e933111f3cc5ccd4c3e673806782c32bbfd74\">c37e933</a></td><td><code>Merge ticket/17794 into ticket/10257</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/352ffb830e05b0935dfe2e6ca26554d5bc388f10\">352ffb8</a></td><td><code>Remove check for -1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e3901d5e6f6cf4e9341cc54edd55de5863ff654\">5e3901d</a></td><td><code>Merge ticket/10257 into ticket/17819</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f851b9eb96f73930aa265673679434eecfac6a6\">6f851b9</a></td><td><code>Use check_allocarray() to allocate array</code></td></tr></table>\n",
    "created_at": "2015-02-21T10:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ba47f0ef294af2b0ac5736a36144a5f77bb6c36">6ba47f0</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/10257</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/307e5264e155ccb72fd3cc28d08013a8b9ce647b">307e526</a></td><td><code>Revert raise MemoryError changes from #12212</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd8407bcf29c42dadade7bed183cc68ebf310b69">cd8407b</a></td><td><code>Merge branch 'ticket/12212_revert_raise' into ticket/10257</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa0612d0a7ad58cc403f157b42877d29ba0371fa">fa0612d</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/10257</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c561e2e05851c55a4bddd9045768d0559a456fa5">c561e2e</a></td><td><code>Fix check_allocarray() failure doctest on OS X</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6650ca79a28bd96cd66d3dc3b3b917bd91c415e5">6650ca7</a></td><td><code>Add csage dependencies in Makefile</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c37e933111f3cc5ccd4c3e673806782c32bbfd74">c37e933</a></td><td><code>Merge ticket/17794 into ticket/10257</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/352ffb830e05b0935dfe2e6ca26554d5bc388f10">352ffb8</a></td><td><code>Remove check for -1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e3901d5e6f6cf4e9341cc54edd55de5863ff654">5e3901d</a></td><td><code>Merge ticket/10257 into ticket/17819</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f851b9eb96f73930aa265673679434eecfac6a6">6f851b9</a></td><td><code>Use check_allocarray() to allocate array</code></td></tr></table>




---

archive/issue_comments_309370.json:
```json
{
    "body": "**Dependencies:** #17794, #10257",
    "created_at": "2015-02-21T10:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309370",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #17794, #10257



---

archive/issue_comments_309371.json:
```json
{
    "body": "**Changing commit** from \"[6f851b9eb96f73930aa265673679434eecfac6a6](https://github.com/sagemath/sagetrac-mirror/commit/6f851b9eb96f73930aa265673679434eecfac6a6)\" to \"[3bc79b71b49aa37b7307174f29e228a6c2bc81f6](https://github.com/sagemath/sagetrac-mirror/commit/3bc79b71b49aa37b7307174f29e228a6c2bc81f6)\".",
    "created_at": "2015-02-22T09:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6f851b9eb96f73930aa265673679434eecfac6a6](https://github.com/sagemath/sagetrac-mirror/commit/6f851b9eb96f73930aa265673679434eecfac6a6)" to "[3bc79b71b49aa37b7307174f29e228a6c2bc81f6](https://github.com/sagemath/sagetrac-mirror/commit/3bc79b71b49aa37b7307174f29e228a6c2bc81f6)".



---

archive/issue_comments_309372.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bc79b71b49aa37b7307174f29e228a6c2bc81f6\">3bc79b7</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/17819_</code></td></tr></table>\n",
    "created_at": "2015-02-22T09:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bc79b71b49aa37b7307174f29e228a6c2bc81f6">3bc79b7</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/17819_</code></td></tr></table>




---

archive/issue_comments_309373.json:
```json
{
    "body": "<a id='comment:7'></a>\nThat sucks. mpz_set_ux isn't in gmp - at least gmp 5.1.3, if you know it is in 6.0.0+ I at least can force an upgrade in sage-on-gentoo. But right now it is a major headache for sage-on-distro (much more so than pari git master).",
    "created_at": "2015-02-26T21:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309373",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
That sucks. mpz_set_ux isn't in gmp - at least gmp 5.1.3, if you know it is in 6.0.0+ I at least can force an upgrade in sage-on-gentoo. But right now it is a major headache for sage-on-distro (much more so than pari git master).



---

archive/issue_comments_309374.json:
```json
{
    "body": "<a id='comment:8'></a>\nIndeed, those functions seem MPIR-specific. For me personally, that's not an issue (we do use MPIR after all in Sage).",
    "created_at": "2015-02-26T21:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309374",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Indeed, those functions seem MPIR-specific. For me personally, that's not an issue (we do use MPIR after all in Sage).



---

archive/issue_comments_309375.json:
```json
{
    "body": "<a id='comment:9'></a>\nI know it would be less of an issue if other gmp using code had moved to using mpir directly one way or another (flint being the only one) rather than just saying \"you can do that if mpir is installed with gmp-compat\". I think I can do an ugly hack for that one.",
    "created_at": "2015-02-26T21:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309375",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I know it would be less of an issue if other gmp using code had moved to using mpir directly one way or another (flint being the only one) rather than just saying "you can do that if mpir is installed with gmp-compat". I think I can do an ugly hack for that one.



---

archive/issue_comments_309376.json:
```json
{
    "body": "<a id='comment:10'></a>\nYou mean there would be *less* an issue if *more* code relied on MPIR?",
    "created_at": "2015-02-26T21:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309376",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
You mean there would be *less* an issue if *more* code relied on MPIR?



---

archive/issue_comments_309377.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jdemeyer](#comment%3A10):\n> You mean there would be *less* an issue if *more* code relied on MPIR?\n\n\nWell that would force the hand. \n\nWhat I mean is take pari. You can compile it with mpir by using the gmp compatibility layer. You cannot tell pari to compile directly against mpir, using mpir headers and libmpir. \n\nIf all the packages in the sage stack could do that. It would be easy, install mpir and build everything against it. Reality is everything apart from flint is using gmp and expect gmp. And only use mpir if it is masquerading itself as gmp. \n\nIn a distro where gmp is already installed because of gcc it won't happen unless you can convince the toolchain team of the distro to switch to mpir. Tough job.",
    "created_at": "2015-02-26T21:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309377",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Replying to [jdemeyer](#comment%3A10):
> You mean there would be *less* an issue if *more* code relied on MPIR?


Well that would force the hand. 

What I mean is take pari. You can compile it with mpir by using the gmp compatibility layer. You cannot tell pari to compile directly against mpir, using mpir headers and libmpir. 

If all the packages in the sage stack could do that. It would be easy, install mpir and build everything against it. Reality is everything apart from flint is using gmp and expect gmp. And only use mpir if it is masquerading itself as gmp. 

In a distro where gmp is already installed because of gcc it won't happen unless you can convince the toolchain team of the distro to switch to mpir. Tough job.



---

archive/issue_comments_309378.json:
```json
{
    "body": "<a id='comment:12'></a>\nWe could also replace `uintmax_t` by `unsigned long` which is usually the same on 64-bit systems and which doesn't have portability issues.",
    "created_at": "2015-02-26T21:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309378",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
We could also replace `uintmax_t` by `unsigned long` which is usually the same on 64-bit systems and which doesn't have portability issues.



---

archive/issue_comments_309379.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> We could also replace `uintmax_t` by `unsigned long` which is usually the same on 64-bit systems and which doesn't have portability issues.\n\n\nI guess that would be handy but what happens on 32 bits systems? We are still dealing with them for the foreseeable future.\n\nI am trying a hack where integer.pyx and mpz.pxd explicitly use mpir. But not anything else.\n\nI am guessing if mpir is a complete superset of gmp I could switch the whole sage library to explicit mpir. A bit of linking madness but it would work.",
    "created_at": "2015-02-26T21:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309379",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> We could also replace `uintmax_t` by `unsigned long` which is usually the same on 64-bit systems and which doesn't have portability issues.


I guess that would be handy but what happens on 32 bits systems? We are still dealing with them for the foreseeable future.

I am trying a hack where integer.pyx and mpz.pxd explicitly use mpir. But not anything else.

I am guessing if mpir is a complete superset of gmp I could switch the whole sage library to explicit mpir. A bit of linking madness but it would work.



---

archive/issue_comments_309380.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [fbissey](#comment%3A13):\n> Replying to [jdemeyer](#comment%3A12):\n> > We could also replace `uintmax_t` by `unsigned long` which is usually the same on 64-bit systems and which doesn't have portability issues.\n\n> \n> I guess that would be handy but what happens on 32 bits systems?\n\nWhen using `unsigned long`, stuff would become slower for 32-bit systems. It's really a matter of what do you prefer? It's a classical pick 2 out of 3: clean code, fast code, portable code.",
    "created_at": "2015-02-26T22:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309380",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [fbissey](#comment%3A13):
> Replying to [jdemeyer](#comment%3A12):
> > We could also replace `uintmax_t` by `unsigned long` which is usually the same on 64-bit systems and which doesn't have portability issues.

> 
> I guess that would be handy but what happens on 32 bits systems?

When using `unsigned long`, stuff would become slower for 32-bit systems. It's really a matter of what do you prefer? It's a classical pick 2 out of 3: clean code, fast code, portable code.



---

archive/issue_comments_309381.json:
```json
{
    "body": "<a id='comment:15'></a>\nNew hurdle, my hack didn't work because I have mpir 2.6.0 installed, I am guessing the symbol is in 2.7.0. I would have to update mpir as well to make it work.\n\nYes classic! And it would be nice if it was completed by 6.6 release. Portable gets sage-on-distro out of the hole for this time but it may not go on forever. At some point mpir and gmp may diverge enough that flint or sage will want to do something that is mpir only. That day I think the best thing to do will be to make mpir explicit, at least where it is needed, rather than faking gmp. And pray that linker do their job properly.",
    "created_at": "2015-02-26T22:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309381",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
New hurdle, my hack didn't work because I have mpir 2.6.0 installed, I am guessing the symbol is in 2.7.0. I would have to update mpir as well to make it work.

Yes classic! And it would be nice if it was completed by 6.6 release. Portable gets sage-on-distro out of the hole for this time but it may not go on forever. At some point mpir and gmp may diverge enough that flint or sage will want to do something that is mpir only. That day I think the best thing to do will be to make mpir explicit, at least where it is needed, rather than faking gmp. And pray that linker do their job properly.



---

archive/issue_comments_309382.json:
```json
{
    "body": "<a id='comment:16'></a>\nUpgraded mpir but it still fails. Inspecting libmpir with\n\n```\nnm -D /usr/lib64/libmpir.so.16 | grep mpz_set_ux\n000000000002ea6e T __gmpz_set_ux\n```\nAnd I get the same thing with mpir built in vanilla sage (and the gmp in sage) everything seems to be prefixed with `__g`. Do you have an idea what is going on?",
    "created_at": "2015-02-27T00:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309382",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Upgraded mpir but it still fails. Inspecting libmpir with

```
nm -D /usr/lib64/libmpir.so.16 | grep mpz_set_ux
000000000002ea6e T __gmpz_set_ux
```
And I get the same thing with mpir built in vanilla sage (and the gmp in sage) everything seems to be prefixed with `__g`. Do you have an idea what is going on?



---

archive/issue_comments_309383.json:
```json
{
    "body": "<a id='comment:17'></a>\ngot it working by replacing every instances of gmp.h by mpir.h in sage/libs/gmp and replacing all gmp/gmpxx by mpir/mpirxx in module_list.py. Because c_lib, pari, ntl and friends are still linked to gmp I have linking to both gmp and mpir when inspecting with ldd, but readelf on the extension will only show mpir since it is the only one it is directly linked against.\n\nChanging the headers in sage/libs/gmp wasn't enough in that it spread symbol problems in other places. \n\nNow to run full doctest on the monster.",
    "created_at": "2015-02-27T01:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309383",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
got it working by replacing every instances of gmp.h by mpir.h in sage/libs/gmp and replacing all gmp/gmpxx by mpir/mpirxx in module_list.py. Because c_lib, pari, ntl and friends are still linked to gmp I have linking to both gmp and mpir when inspecting with ldd, but readelf on the extension will only show mpir since it is the only one it is directly linked against.

Changing the headers in sage/libs/gmp wasn't enough in that it spread symbol problems in other places. 

Now to run full doctest on the monster.



---

archive/issue_comments_309384.json:
```json
{
    "body": "<a id='comment:18'></a>\ndoctest run as normally as expected for sage-on-gentoo on my machine. I was more or less expecting failures in the places where there are gmp(xx) headers outside of sage/libs/gmp but those seem to be more robust.\n\nI would favor portability but that may be a discussion we need to have on sage-devel.",
    "created_at": "2015-02-27T03:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309384",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
doctest run as normally as expected for sage-on-gentoo on my machine. I was more or less expecting failures in the places where there are gmp(xx) headers outside of sage/libs/gmp but those seem to be more robust.

I would favor portability but that may be a discussion we need to have on sage-devel.



---

archive/issue_comments_309385.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [fbissey](#comment%3A18):\n> I would favor portability but that may be a discussion we need to have on sage-devel.\n\nWhat do you think of my proposal to use `unsigned long`? That would be portable and clean. On 64-bit there would be no difference.\n\nFor small inputs, using `unsigned long` will even be faster on 32-bit systems, since the compiler wouldn't need to emulate 64-bit `long long` operations. For larger inputs, there might be a slow-down but it might not be so bad given that there are no native 64-bit operations anyway.",
    "created_at": "2015-02-28T11:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309385",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Replying to [fbissey](#comment%3A18):
> I would favor portability but that may be a discussion we need to have on sage-devel.

What do you think of my proposal to use `unsigned long`? That would be portable and clean. On 64-bit there would be no difference.

For small inputs, using `unsigned long` will even be faster on 32-bit systems, since the compiler wouldn't need to emulate 64-bit `long long` operations. For larger inputs, there might be a slow-down but it might not be so bad given that there are no native 64-bit operations anyway.



---

archive/issue_comments_309386.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jdemeyer](#comment%3A19):\n> Replying to [fbissey](#comment%3A18):\n> > I would favor portability but that may be a discussion we need to have on sage-devel.\n\n> What do you think of my proposal to use `unsigned long`? That would be portable and clean. On 64-bit there would be no difference.\n> \n> For small inputs, using `unsigned long` will even be faster on 32-bit systems, since the compiler wouldn't need to emulate 64-bit `long long` operations. For larger inputs, there might be a slow-down but it might not be so bad given that there are no native 64-bit operations anyway.\n\n\n\nI am OK with using `unsigned long` but it all gave me food for thought.",
    "created_at": "2015-02-28T11:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309386",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
Replying to [jdemeyer](#comment%3A19):
> Replying to [fbissey](#comment%3A18):
> > I would favor portability but that may be a discussion we need to have on sage-devel.

> What do you think of my proposal to use `unsigned long`? That would be portable and clean. On 64-bit there would be no difference.
> 
> For small inputs, using `unsigned long` will even be faster on 32-bit systems, since the compiler wouldn't need to emulate 64-bit `long long` operations. For larger inputs, there might be a slow-down but it might not be so bad given that there are no native 64-bit operations anyway.



I am OK with using `unsigned long` but it all gave me food for thought.



---

archive/issue_comments_309387.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `uintmax_t` for this, which is at least as large as `long long`. Another advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. Instead we can use the standard MPIR function `mpz_set_ux`.\n+The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems.\n``````\n",
    "created_at": "2015-03-01T09:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309387",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `uintmax_t` for this, which is at least as large as `long long`. Another advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. Instead we can use the standard MPIR function `mpz_set_ux`.
+The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems.
``````




---

archive/issue_comments_309388.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-03-01T09:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309388",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_events_057843.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "rename": {
        "from": "Use uintmax_t for Integer.divisors",
        "to": "Use unsigned long for Integer.divisors"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17819#event-57843"
}
```



---

archive/issue_comments_309389.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems.\n+The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems. On 64-bit systems, there should be no speed difference (except perhaps a small speed-up due to skipping the `mpz_longlong` overhead and the fact that we use 64 instead of 63 bits).\n``````\n",
    "created_at": "2015-03-01T09:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309389",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems.
+The `divisors` method of `Integer` is implemented using `long long` if possible. However, it would be better to use `unsigned long` for this. One advantage is that we no longer need the `mpz_set_longlong()` functions from `c_lib`. This will also be faster for small inputs on 32-bit systems. On 64-bit systems, there should be no speed difference (except perhaps a small speed-up due to skipping the `mpz_longlong` overhead and the fact that we use 64 instead of 63 bits).
``````




---

archive/issue_comments_309390.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c\">1194cb7</a></td><td><code>Use unsigned long instead of uintmax_t for divisors()</code></td></tr></table>\n",
    "created_at": "2015-03-01T11:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c">1194cb7</a></td><td><code>Use unsigned long instead of uintmax_t for divisors()</code></td></tr></table>




---

archive/issue_comments_309391.json:
```json
{
    "body": "**Changing commit** from \"[3bc79b71b49aa37b7307174f29e228a6c2bc81f6](https://github.com/sagemath/sagetrac-mirror/commit/3bc79b71b49aa37b7307174f29e228a6c2bc81f6)\" to \"[1194cb75acb96340b16f9a256aa55e0a3c2eb38c](https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c)\".",
    "created_at": "2015-03-01T11:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3bc79b71b49aa37b7307174f29e228a6c2bc81f6](https://github.com/sagemath/sagetrac-mirror/commit/3bc79b71b49aa37b7307174f29e228a6c2bc81f6)" to "[1194cb75acb96340b16f9a256aa55e0a3c2eb38c](https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c)".



---

archive/issue_comments_309392.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-03-01T11:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309392",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_309393.json:
```json
{
    "body": "<a id='comment:25'></a>\nmpz_set_ux is still in that patch but it looks like it links ok ok against gmp. Rebuilding and testing, but it should be good.",
    "created_at": "2015-03-01T20:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309393",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
mpz_set_ux is still in that patch but it looks like it links ok ok against gmp. Rebuilding and testing, but it should be good.



---

archive/issue_comments_309394.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [fbissey](#comment%3A25):\n> mpz_set_ux is still in that patch but it looks like it links ok ok against gmp. Rebuilding and testing, but it should be good.\n\nI left the declaration indeed, but it doesn't hurt...",
    "created_at": "2015-03-01T20:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309394",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [fbissey](#comment%3A25):
> mpz_set_ux is still in that patch but it looks like it links ok ok against gmp. Rebuilding and testing, but it should be good.

I left the declaration indeed, but it doesn't hurt...



---

archive/issue_comments_309395.json:
```json
{
    "body": "<a id='comment:27'></a>\nDefinitely doesn't, good to go.",
    "created_at": "2015-03-01T20:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309395",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
Definitely doesn't, good to go.



---

archive/issue_comments_309396.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-03-01T20:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309396",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_309397.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2015-03-01T20:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309397",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** François Bissey



---

archive/issue_events_057844.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-03T00:25:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17819#event-57844"
}
```



---

archive/issue_comments_309398.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/17819](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17819)\" to \"[1194cb75acb96340b16f9a256aa55e0a3c2eb38c](https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c)\".",
    "created_at": "2015-03-03T00:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309398",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/17819](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17819)" to "[1194cb75acb96340b16f9a256aa55e0a3c2eb38c](https://github.com/sagemath/sagetrac-mirror/commit/1194cb75acb96340b16f9a256aa55e0a3c2eb38c)".



---

archive/issue_comments_309399.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-03-03T00:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17819#issuecomment-309399",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
