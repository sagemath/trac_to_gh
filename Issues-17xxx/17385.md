# Issue 17385: Fix Cygwin's "-no-undefined" patches for zeromq

archive/issues_017385.json:
```json
{
    "body": "CC:  gouezel @tscrim\n\nThe fix at #17333 was misplaced...\n\nIssue created by migration from https://trac.sagemath.org/ticket/17622\n\n",
    "closed_at": "2015-01-15T08:41:47Z",
    "created_at": "2015-01-12T13:06:22Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Fix Cygwin's \"-no-undefined\" patches for zeromq",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17385",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
CC:  gouezel @tscrim

The fix at #17333 was misplaced...

Issue created by migration from https://trac.sagemath.org/ticket/17622





---

archive/issue_comments_231438.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-12T13:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231438",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_231439.json:
```json
{
    "body": "`@`S\u00e9bastien: can you test the fixed patches (just pull the branch and force zeromq install with `./sage -f`)?\nI don't have my VMs at hand so it's not trivial for me to test.\nI should have time to reboot under Windows at some point though.\n\n---\nNew commits:",
    "created_at": "2015-01-12T13:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231439",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

`@`SÃ©bastien: can you test the fixed patches (just pull the branch and force zeromq install with `./sage -f`)?
I don't have my VMs at hand so it's not trivial for me to test.
I should have time to reboot under Windows at some point though.

---
New commits:



---

archive/issue_comments_231440.json:
```json
{
    "body": "I will test it later today. One question though: what is the role of the directory patches/build_system? As far as I can tell, it contains modified copies of the patches, but these copies are never applied...",
    "created_at": "2015-01-12T15:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231440",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

I will test it later today. One question though: what is the role of the directory patches/build_system? As far as I can tell, it contains modified copies of the patches, but these copies are never applied...



---

archive/issue_comments_231441.json:
```json
{
    "body": "The new version is much more sensible than the previous one, and works fine. It also works fine if one removes the subdirectory patches/build_system, so is there a good reason to keep it?",
    "created_at": "2015-01-12T19:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231441",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

The new version is much more sensible than the previous one, and works fine. It also works fine if one removes the subdirectory patches/build_system, so is there a good reason to keep it?



---

archive/issue_comments_231442.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-01-12T19:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231442",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_231443.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-01-12T20:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231443",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_231444.json:
```json
{
    "body": "zeromq uses autotools.\nThe patches in `build_system` directory are those you need to apply to the zeromq build system before autotools automatically generate the full build system.\nOnce these patches are applied, one can invoke autotools to update the build system (e.g. running `autoreconf -fiv && rm -rf autom4te.cache`) and deduce the full patches in the `patches` directory which don't need autotools invokation anymore and can be applied at build time.\n\nTo summarize it's good to ship two set of patches because:\n* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,\n* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)",
    "created_at": "2015-01-12T20:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231444",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

zeromq uses autotools.
The patches in `build_system` directory are those you need to apply to the zeromq build system before autotools automatically generate the full build system.
Once these patches are applied, one can invoke autotools to update the build system (e.g. running `autoreconf -fiv && rm -rf autom4te.cache`) and deduce the full patches in the `patches` directory which don't need autotools invokation anymore and can be applied at build time.

To summarize it's good to ship two set of patches because:
* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,
* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)



---

archive/issue_comments_231445.json:
```json
{
    "body": "OK, thanks a lot for the detailed and convincing explanation",
    "created_at": "2015-01-12T20:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231445",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

OK, thanks a lot for the detailed and convincing explanation



---

archive/issue_comments_231446.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-12T20:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231446",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_231447.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-01-13T01:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231447",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_231448.json:
```json
{
    "body": "Reviewer name is missing",
    "created_at": "2015-01-13T01:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231448",
    "user": "https://github.com/vbraun"
}
```

Reviewer name is missing



---

archive/issue_comments_231449.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-01-13T05:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231449",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_231450.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-15T08:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17385#issuecomment-231450",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050500.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-15T08:41:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17385",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17385#event-50500"
}
```
