# Issue 17285: CIF is missing many functions

archive/issues_017048.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: CIF(cos(3/2))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-31-4eae9038f0b3> in <module>()\n----> 1 CIF(cos(Integer(3)/Integer(2)))\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/complex_interval_field.pyc in __call__(self, x, im)\n    378 \n    379             try:\n--> 380                 return x._complex_mpfi_( self )\n    381             except AttributeError:\n    382                 pass\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._complex_mpfi_ (build/cythonized/sage/symbolic/expression.cpp:8043)()\n```\n\nThe reason that this fails is:\n\n```\nsage: CIF(3/2).cos()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-13-96dae572cb36> in <module>()\n----> 1 CIF(Integer(3)/Integer(2)).cos()\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4068)()\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1631)()\n\nAttributeError: 'sage.rings.complex_interval.ComplexIntervalFieldElement' object has no attribute 'cos'\n```\n\nThis problem was also encoutered [on this ask thread](http://ask.sagemath.org/question/10115/problem-with-conjugate_transpose-of-a-symbolic-matrix/?answer=14912#post-id-14912).\n\nfollow up: #18135 and #18136\n\nDepends on #17130\n\nCC:  @sagetrac-tmonteil @videlec\n\nBranch/Commit: **[`afccfe6`](https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **basic arithmetic**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17285_\n\n",
    "closed_at": "2015-04-14T19:44:05Z",
    "created_at": "2014-11-04T10:37:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "CIF is missing many functions",
    "type": "issue",
    "updated_at": "2015-04-14T19:44:05Z",
    "url": "https://github.com/sagemath/sage/issues/17285",
    "user": "https://github.com/jdemeyer"
}
```

```
sage: CIF(cos(3/2))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-31-4eae9038f0b3> in <module>()
----> 1 CIF(cos(Integer(3)/Integer(2)))

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/complex_interval_field.pyc in __call__(self, x, im)
    378 
    379             try:
--> 380                 return x._complex_mpfi_( self )
    381             except AttributeError:
    382                 pass

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._complex_mpfi_ (build/cythonized/sage/symbolic/expression.cpp:8043)()
```

The reason that this fails is:

```
sage: CIF(3/2).cos()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-13-96dae572cb36> in <module>()
----> 1 CIF(Integer(3)/Integer(2)).cos()

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4068)()

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1631)()

AttributeError: 'sage.rings.complex_interval.ComplexIntervalFieldElement' object has no attribute 'cos'
```

This problem was also encoutered [on this ask thread](http://ask.sagemath.org/question/10115/problem-with-conjugate_transpose-of-a-symbolic-matrix/?answer=14912#post-id-14912).

follow up: #18135 and #18136

Depends on #17130

CC:  @sagetrac-tmonteil @videlec

Branch/Commit: **[`afccfe6`](https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d)**

Reviewer: **Jeroen Demeyer**

Author: **Vincent Delecroix**

Component: **basic arithmetic**

_Issue created by migration from https://trac.sagemath.org/ticket/17285_





---

archive/issue_events_244453.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T10:37:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244453"
}
```



---

archive/issue_events_244454.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T10:37:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244454"
}
```



---

archive/issue_events_244455.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T10:37:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244455"
}
```



---

archive/issue_events_244456.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T10:37:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244456"
}
```



---

archive/issue_comments_230806.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,13 +16,18 @@\n /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._complex_mpfi_ (build/cythonized/sage/symbolic/expression.cpp:8043)()\n ```\n \n-Similar things do work:\n+The reason that this fails is:\n \n ```\n-sage: RIF(cos(3/2))\n-0.0707372016677030?\n-sage: CC(cos(3/2))\n-0.0707372016677029\n-sage: CIF(cos(3))\n--0.98999249660044542?\n+sage: CIF(3/2).cos()\n+---------------------------------------------------------------------------\n+AttributeError                            Traceback (most recent call last)\n+<ipython-input-13-96dae572cb36> in <module>()\n+----> 1 CIF(Integer(3)/Integer(2)).cos()\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4068)()\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1631)()\n+\n+AttributeError: 'sage.rings.complex_interval.ComplexIntervalFieldElement' object has no attribute 'cos'\n ```\n``````\n",
    "created_at": "2014-11-04T11:06:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230806",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,13 +16,18 @@
 /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._complex_mpfi_ (build/cythonized/sage/symbolic/expression.cpp:8043)()
 ```
 
-Similar things do work:
+The reason that this fails is:
 
 ```
-sage: RIF(cos(3/2))
-0.0707372016677030?
-sage: CC(cos(3/2))
-0.0707372016677029
-sage: CIF(cos(3))
--0.98999249660044542?
+sage: CIF(3/2).cos()
+---------------------------------------------------------------------------
+AttributeError                            Traceback (most recent call last)
+<ipython-input-13-96dae572cb36> in <module>()
+----> 1 CIF(Integer(3)/Integer(2)).cos()
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4068)()
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1631)()
+
+AttributeError: 'sage.rings.complex_interval.ComplexIntervalFieldElement' object has no attribute 'cos'
 ```
``````




---

archive/issue_events_244457.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T11:06:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244457"
}
```



---

archive/issue_events_244458.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T11:06:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244458"
}
```



---

archive/issue_events_244459.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T11:06:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "title_is": "CIF is missing many functions",
    "title_was": "CIF(cos(3/2)) fails",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244459"
}
```



---

archive/issue_comments_230807.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,3 +31,6 @@\n \n AttributeError: 'sage.rings.complex_interval.ComplexIntervalFieldElement' object has no attribute 'cos'\n ```\n+\n+This problem was also encoutered [on this ask thread](http://ask.sagemath.org/question/10115/problem-with-conjugate_transpose-of-a-symbolic-matrix/?answer=14912#post-id-14912).\n+\n``````\n",
    "created_at": "2014-11-04T13:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230807",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,3 +31,6 @@
 
 AttributeError: 'sage.rings.complex_interval.ComplexIntervalFieldElement' object has no attribute 'cos'
 ```
+
+This problem was also encoutered [on this ask thread](http://ask.sagemath.org/question/10115/problem-with-conjugate_transpose-of-a-symbolic-matrix/?answer=14912#post-id-14912).
+
``````




---

archive/issue_comments_230808.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAre you working on this ?\n\nIs a solution involving the use of the (already defined) `.exp()` method acceptable on the short term (it may not lead to the thinest possible intervals), or do you think about some more accurate way of writing those ?",
    "created_at": "2014-11-04T13:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230808",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:2" align="right">comment:2</div>

Are you working on this ?

Is a solution involving the use of the (already defined) `.exp()` method acceptable on the short term (it may not lead to the thinest possible intervals), or do you think about some more accurate way of writing those ?



---

archive/issue_comments_230809.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@sagetrac-tmonteil](#comment:2):\n> Are you working on this ?\n\nNo.\n\n> Is a solution involving the use of the (already defined) `.exp()` method acceptable on the short term (it may not lead to the thinest possible intervals), or do you think about some more accurate way of writing those ?\n\nI think it's acceptable to rely on `exp()` but instead, I would rather use the structure of the `exp()` method: completely reduce the computation to a computation in `RIF`.",
    "created_at": "2014-11-04T15:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230809",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@sagetrac-tmonteil](#comment:2):
> Are you working on this ?

No.

> Is a solution involving the use of the (already defined) `.exp()` method acceptable on the short term (it may not lead to the thinest possible intervals), or do you think about some more accurate way of writing those ?

I think it's acceptable to rely on `exp()` but instead, I would rather use the structure of the `exp()` method: completely reduce the computation to a computation in `RIF`.



---

archive/issue_comments_230810.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFor best accuracy, one should use `cos(a+bi) = cos(a)*cosh(b) + sin(a)*sinh(b)*i` and `sin(a+bi) = sin(a)*cosh(b) + cos(a)*sinh(b)*i` (if I got those formulas right). \n\nThere's a `mpfi_sin_cos` but it looks like there's no `mpfi_sinh_cosh` yet.",
    "created_at": "2014-11-04T16:18:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230810",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:4" align="right">comment:4</div>

For best accuracy, one should use `cos(a+bi) = cos(a)*cosh(b) + sin(a)*sinh(b)*i` and `sin(a+bi) = sin(a)*cosh(b) + cos(a)*sinh(b)*i` (if I got those formulas right). 

There's a `mpfi_sin_cos` but it looks like there's no `mpfi_sinh_cosh` yet.



---

archive/issue_comments_230811.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis is also responsible for\n\n```\nsage: a = RLF(cos(2/3))\nsage: b = CLF(QQbar(-2).sqrt())\nsage: a + b\n<repr(<sage.rings.real_lazy.LazyBinop at 0x7fb7ffc28680>) failed: TypeError: unable to simplify to a complex interval approximation>\n```",
    "created_at": "2015-04-02T09:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230811",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

This is also responsible for

```
sage: a = RLF(cos(2/3))
sage: b = CLF(QQbar(-2).sqrt())
sage: a + b
<repr(<sage.rings.real_lazy.LazyBinop at 0x7fb7ffc28680>) failed: TypeError: unable to simplify to a complex interval approximation>
```



---

archive/issue_comments_230812.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2015-04-06T16:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230812",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_230813.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd4cf4e61cbc44485985e1f74de201c87ad06bc9\"><code>dd4cf4e</code></a></td><td><code>Trac 17285: CIF trigonometric functions</code></td></tr></table>\n",
    "created_at": "2015-04-06T16:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230813",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd4cf4e61cbc44485985e1f74de201c87ad06bc9"><code>dd4cf4e</code></a></td><td><code>Trac 17285: CIF trigonometric functions</code></td></tr></table>




---

archive/issue_events_244460.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-06T16:15:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244460"
}
```



---

archive/issue_comments_230814.json:
```json
{
    "body": "Commit: **[`dd4cf4e`](https://github.com/sagemath/sagetrac-mirror/commit/dd4cf4e61cbc44485985e1f74de201c87ad06bc9)**",
    "created_at": "2015-04-06T16:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230814",
    "user": "https://github.com/videlec"
}
```

Commit: **[`dd4cf4e`](https://github.com/sagemath/sagetrac-mirror/commit/dd4cf4e61cbc44485985e1f74de201c87ad06bc9)**



---

archive/issue_comments_230815.json:
```json
{
    "body": "Branch: **[u/vdelecroix/17285](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17285)**",
    "created_at": "2015-04-06T16:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230815",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/17285](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17285)**



---

archive/issue_comments_230816.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis is not the fastest and safest way possible (the obtained interval is sometimes too large). But at least, the given implementation has the feature that trigonometric functions preserve real and imaginary axes...\n\nVincent",
    "created_at": "2015-04-06T16:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230816",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

This is not the fastest and safest way possible (the obtained interval is sometimes too large). But at least, the given implementation has the feature that trigonometric functions preserve real and imaginary axes...

Vincent



---

archive/issue_comments_230817.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNote: the link to the ask question is dead!",
    "created_at": "2015-04-06T16:18:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230817",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Note: the link to the ask question is dead!



---

archive/issue_comments_230818.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI don't like the added complexity of having 3 branches in every function. Why not just use the generic case everywhere?",
    "created_at": "2015-04-06T21:33:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230818",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

I don't like the added complexity of having 3 branches in every function. Why not just use the generic case everywhere?



---

archive/issue_comments_230819.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment:9):\n> I don't like the added complexity of having 3 branches in every function. Why not just use the generic case everywhere?\n\nThe main reason is to avoid numerical noise (I want the cosine of a real number to be a real number). You have\n\n```\nsage: a = CIF(2,0)\nsage: I = CIF.gen()\nsage: ((I*a).exp() + (-I*a).exp()) / 2\n-0.4161468365471424? + 0.?e-16*I\n```\nIt should be fine to remove the imaginary branch, but then it would be less precise\n\n```\nsage: a = CIF(0,2)\nsage: b1 = CIF(0, a.imag().cosh())\nsage: b1.diameter()\n1.33393183261575e-16\nsage: b2 = ((I*a).exp() + (-I*a).exp()) / 2\nsage: b2.diameter()\n2.36079803558624e-16\n```\n\nVincent",
    "created_at": "2015-04-06T21:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230819",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment:9):
> I don't like the added complexity of having 3 branches in every function. Why not just use the generic case everywhere?

The main reason is to avoid numerical noise (I want the cosine of a real number to be a real number). You have

```
sage: a = CIF(2,0)
sage: I = CIF.gen()
sage: ((I*a).exp() + (-I*a).exp()) / 2
-0.4161468365471424? + 0.?e-16*I
```
It should be fine to remove the imaginary branch, but then it would be less precise

```
sage: a = CIF(0,2)
sage: b1 = CIF(0, a.imag().cosh())
sage: b1.diameter()
1.33393183261575e-16
sage: b2 = ((I*a).exp() + (-I*a).exp()) / 2
sage: b2.diameter()
2.36079803558624e-16
```

Vincent



---

archive/issue_events_244461.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T06:23:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244461"
}
```



---

archive/issue_events_244462.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T06:23:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244462"
}
```



---

archive/issue_comments_230820.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nFor the sine and cosine, you can use the formula at the end of [http://en.wikipedia.org/wiki/Trigonometric_functions#Relationship_to_exponential_function_and_complex_numbers](http://en.wikipedia.org/wiki/Trigonometric_functions#Relationship_to_exponential_function_and_complex_numbers) which computes the real and imaginary part separately. Assuming that sinh(0) = 0 exactly, this formula will not introduce a fake imaginary part.",
    "created_at": "2015-04-07T06:23:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230820",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

For the sine and cosine, you can use the formula at the end of [http://en.wikipedia.org/wiki/Trigonometric_functions#Relationship_to_exponential_function_and_complex_numbers](http://en.wikipedia.org/wiki/Trigonometric_functions#Relationship_to_exponential_function_and_complex_numbers) which computes the real and imaginary part separately. Assuming that sinh(0) = 0 exactly, this formula will not introduce a fake imaginary part.



---

archive/issue_events_244463.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T06:23:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244463"
}
```



---

archive/issue_events_244464.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T06:23:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244464"
}
```



---

archive/issue_comments_230821.json:
```json
{
    "body": "Changed commit from **[`dd4cf4e`](https://github.com/sagemath/sagetrac-mirror/commit/dd4cf4e61cbc44485985e1f74de201c87ad06bc9)** to **[`3f8cd41`](https://github.com/sagemath/sagetrac-mirror/commit/3f8cd4178d279dbb6e5ad87c3f4a1c9f5ac75548)**",
    "created_at": "2015-04-07T07:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230821",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dd4cf4e`](https://github.com/sagemath/sagetrac-mirror/commit/dd4cf4e61cbc44485985e1f74de201c87ad06bc9)** to **[`3f8cd41`](https://github.com/sagemath/sagetrac-mirror/commit/3f8cd4178d279dbb6e5ad87c3f4a1c9f5ac75548)**



---

archive/issue_comments_230822.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f8cd4178d279dbb6e5ad87c3f4a1c9f5ac75548\"><code>3f8cd41</code></a></td><td><code>Trac 17285: CIF trigonometric functions</code></td></tr></table>\n",
    "created_at": "2015-04-07T07:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230822",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f8cd4178d279dbb6e5ad87c3f4a1c9f5ac75548"><code>3f8cd41</code></a></td><td><code>Trac 17285: CIF trigonometric functions</code></td></tr></table>




---

archive/issue_comments_230823.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNew implementation using other trigonometric identities (and much faster).\n\nFor `tan` and `tanh` this is certainly not the best possible.\n\nVincent",
    "created_at": "2015-04-07T07:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230823",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

New implementation using other trigonometric identities (and much faster).

For `tan` and `tanh` this is certainly not the best possible.

Vincent



---

archive/issue_events_244465.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-07T07:48:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244465"
}
```



---

archive/issue_events_244466.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-07T07:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244466"
}
```



---

archive/issue_comments_230824.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-04-07T08:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230824",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_230825.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nYou're not actually supposed to do this:\n\n```\nfrom sage.ext.interrupt cimport sig_on, sig_off\n```\nThe official way is still `include \"sage/ext/interrupt.pxi\"` (and this will even become mandatory after #18027)",
    "created_at": "2015-04-07T08:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230825",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

You're not actually supposed to do this:

```
from sage.ext.interrupt cimport sig_on, sig_off
```
The official way is still `include "sage/ext/interrupt.pxi"` (and this will even become mandatory after #18027)



---

archive/issue_events_244467.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T08:05:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244467"
}
```



---

archive/issue_events_244468.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T08:05:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244468"
}
```



---

archive/issue_comments_230826.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI like the new code. However, a few comments:\n- move the `# cos(x + yi) = ... ` comments inside the docstring as an `ALGORITHM:` block.\n- move the `mpfi_init2()` and `mpfi_clear()` outside the `sig_on()`/`sig_off()` (it's not really wrong to put them inside, but it's certainly safer outside)",
    "created_at": "2015-04-07T08:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230826",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

I like the new code. However, a few comments:
- move the `# cos(x + yi) = ... ` comments inside the docstring as an `ALGORITHM:` block.
- move the `mpfi_init2()` and `mpfi_clear()` outside the `sig_on()`/`sig_off()` (it's not really wrong to put them inside, but it's certainly safer outside)



---

archive/issue_comments_230827.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d\"><code>afccfe6</code></a></td><td><code>Trac 17285: signal handling + doc</code></td></tr></table>\n",
    "created_at": "2015-04-07T09:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230827",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d"><code>afccfe6</code></a></td><td><code>Trac 17285: signal handling + doc</code></td></tr></table>




---

archive/issue_comments_230828.json:
```json
{
    "body": "Changed commit from **[`3f8cd41`](https://github.com/sagemath/sagetrac-mirror/commit/3f8cd4178d279dbb6e5ad87c3f4a1c9f5ac75548)** to **[`afccfe6`](https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d)**",
    "created_at": "2015-04-07T09:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230828",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3f8cd41`](https://github.com/sagemath/sagetrac-mirror/commit/3f8cd4178d279dbb6e5ad87c3f4a1c9f5ac75548)** to **[`afccfe6`](https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d)**



---

archive/issue_events_244469.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-07T09:01:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244469"
}
```



---

archive/issue_events_244470.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-07T09:01:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244470"
}
```



---

archive/issue_events_244471.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T10:30:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244471"
}
```



---

archive/issue_events_244472.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T10:30:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244472"
}
```



---

archive/issue_comments_230829.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThanks for the review.\n\nJust one related question. With the current code, if a `KeyboardInterrupt` happens in between the `sig_on/sig_off` block, then the code `mpfi_clear(tmp)` will never get called and hence the memory allocated to `tmp` will not be freed. Is there a clean solution for that?",
    "created_at": "2015-04-07T10:34:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230829",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Thanks for the review.

Just one related question. With the current code, if a `KeyboardInterrupt` happens in between the `sig_on/sig_off` block, then the code `mpfi_clear(tmp)` will never get called and hence the memory allocated to `tmp` will not be freed. Is there a clean solution for that?



---

archive/issue_comments_230830.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@videlec](#comment:19):\n> Is there a clean solution for that?\n\n`try:`/`finally:`.",
    "created_at": "2015-04-07T11:39:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230830",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@videlec](#comment:19):
> Is there a clean solution for that?

`try:`/`finally:`.



---

archive/issue_comments_230831.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,4 @@\n \n This problem was also encoutered [on this ask thread](http://ask.sagemath.org/question/10115/problem-with-conjugate_transpose-of-a-symbolic-matrix/?answer=14912#post-id-14912).\n \n+follow up: #18135 and #18136\n``````\n",
    "created_at": "2015-04-07T16:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230831",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,4 @@
 
 This problem was also encoutered [on this ask thread](http://ask.sagemath.org/question/10115/problem-with-conjugate_transpose-of-a-symbolic-matrix/?answer=14912#post-id-14912).
 
+follow up: #18135 and #18136
``````




---

archive/issue_comments_230832.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/17285](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17285)** to **[`afccfe6`](https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d)**",
    "created_at": "2015-04-14T19:44:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17285#issuecomment-230832",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/17285](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17285)** to **[`afccfe6`](https://github.com/sagemath/sagetrac-mirror/commit/afccfe62eac92dd2cea900f3bac44600e633aa7d)**



---

archive/issue_events_244473.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:44:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244473"
}
```



---

archive/issue_events_244474.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f345e2d39d757af22935036559d290d41dc56ed8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-14T19:44:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17285",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17285#event-244474"
}
```
