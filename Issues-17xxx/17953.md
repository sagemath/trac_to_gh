# Issue 17953: symbolic function args prevent forced conversion of result to numeric

archive/issues_017716.json:
```json
{
    "body": "It is generally preferred that the returned result type matches the argument type when calling a builtin function. For example this is as expected:\n\n```\nsage: factorial(8).parent()\nInteger Ring\nsage: factorial(SR(8)).parent()\nSymbolic Ring\nsage: exp(0).parent()\nInteger Ring\nsage: exp(SR(0)).parent()\nSymbolic Ring\n```\nbut this is not:\n\n```\nfrom sage.symbolic.function import BuiltinFunction\n\nclass TestFunction(BuiltinFunction):\n    def __init__(self):\n        BuiltinFunction.__init__(self, \"testfun\", nargs=2)\n    def _eval_(self, n, x, *args, **kwds):\n        print (parent(n), parent(x))\n        return SR(5)\n\nsage: TestFunction()(SR(1),GF(2)(1))\n(Integer Ring, Finite Field of size 2)\n5\nsage: type(_)\n<type 'int'>\n```\nAn explanation could be that `factorial` and `exp` derive from `GinacFunction`.\n\nCC:  @jdemeyer\n\nReviewer: Marc Mezzarobba\n\nAuthor: Ralf Stephan\n\nBranch: adc230dff1b357478155978ecc1149d58f282403\n\nCommit: adc230dff1b357478155978ecc1149d58f282403\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17953\n\n",
    "closed_at": "2015-04-14T23:01:36Z",
    "created_at": "2015-03-14T10:04:21Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "symbolic function args prevent forced conversion of result to numeric",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17953",
    "user": "https://github.com/rwst"
}
```
It is generally preferred that the returned result type matches the argument type when calling a builtin function. For example this is as expected:

```
sage: factorial(8).parent()
Integer Ring
sage: factorial(SR(8)).parent()
Symbolic Ring
sage: exp(0).parent()
Integer Ring
sage: exp(SR(0)).parent()
Symbolic Ring
```
but this is not:

```
from sage.symbolic.function import BuiltinFunction

class TestFunction(BuiltinFunction):
    def __init__(self):
        BuiltinFunction.__init__(self, "testfun", nargs=2)
    def _eval_(self, n, x, *args, **kwds):
        print (parent(n), parent(x))
        return SR(5)

sage: TestFunction()(SR(1),GF(2)(1))
(Integer Ring, Finite Field of size 2)
5
sage: type(_)
<type 'int'>
```
An explanation could be that `factorial` and `exp` derive from `GinacFunction`.

CC:  @jdemeyer

Reviewer: Marc Mezzarobba

Author: Ralf Stephan

Branch: adc230dff1b357478155978ecc1149d58f282403

Commit: adc230dff1b357478155978ecc1149d58f282403

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17953





---

archive/issue_comments_236580.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2015-03-15T16:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236580",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_236581.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-15T16:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236581",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_236582.json:
```json
{
    "body": "<a id='comment:5'></a>Hello,\n\nFirst of all, I think that the content of the branch is ok (I am running the test right now).\n\nBut I found the following behavior weird\n\n```\nsage: exp(0).parent()\nInteger ring\n```\nIn my opinion, a function should have a well defined domain and range. In some cases, the function preserves some subset. Like the function `x -> x^2` defined in the complex numbers preserves integers, rationals and algebraic. But considering that `{0}` is a subset of the real numbers on which `exp` preserve the integers is going too far.\n\nVincent",
    "created_at": "2015-03-21T10:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236582",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Hello,

First of all, I think that the content of the branch is ok (I am running the test right now).

But I found the following behavior weird

```
sage: exp(0).parent()
Integer ring
```
In my opinion, a function should have a well defined domain and range. In some cases, the function preserves some subset. Like the function `x -> x^2` defined in the complex numbers preserves integers, rationals and algebraic. But considering that `{0}` is a subset of the real numbers on which `exp` preserve the integers is going too far.

Vincent



---

archive/issue_comments_236583.json:
```json
{
    "body": "<a id='comment:6'></a>```\nsage -t --long src/sage/functions/log.py\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 628, in sage.functions.log.Function_lambert_w._eval_\nFailed example:\n    parent(lambert_w(e))\nExpected:\n    Integer Ring\nGot:\n    Symbolic Ring\n**********************************************************************\n```",
    "created_at": "2015-03-21T11:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236583",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>```
sage -t --long src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 628, in sage.functions.log.Function_lambert_w._eval_
Failed example:
    parent(lambert_w(e))
Expected:
    Integer Ring
Got:
    Symbolic Ring
**********************************************************************
```



---

archive/issue_comments_236584.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-21T11:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236584",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_236585.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T13:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236586.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-21T13:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236586",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_236587.json:
```json
{
    "body": "<a id='comment:9'></a>Simpler way of doing\n\n```\nsymbolic_input = any(parent_c(arg) is SR for arg in args)\n```",
    "created_at": "2015-03-22T10:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236587",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Simpler way of doing

```
symbolic_input = any(parent_c(arg) is SR for arg in args)
```



---

archive/issue_comments_236588.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 vdelecroix]:\n> Simpler way of doing\n> \n> ```\n> symbolic_input = any(parent_c(arg) is SR for arg in args)\n> ```\nTrue. Not worth a commit however.",
    "created_at": "2015-03-22T14:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236588",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>Replying to [comment:9 vdelecroix]:
> Simpler way of doing
> 
> ```
> symbolic_input = any(parent_c(arg) is SR for arg in args)
> ```
True. Not worth a commit however.



---

archive/issue_comments_236589.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-12T19:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236589",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_236590.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:5 vdelecroix]:\n> In my opinion, a function should have a well defined domain and range. In some cases, the function preserves some subset. Like the function `x -> x^2` defined in the complex numbers preserves integers, rationals and algebraic. But considering that `{0}` is a subset of the real numbers on which `exp` preserve the integers is going too far.\n\n\nI tend to agree, but the present ticket is a step in the right direction in any case: it fixes some of the issues without making it harder to improve things later on.",
    "created_at": "2015-04-12T19:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236590",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>Replying to [comment:5 vdelecroix]:
> In my opinion, a function should have a well defined domain and range. In some cases, the function preserves some subset. Like the function `x -> x^2` defined in the complex numbers preserves integers, rationals and algebraic. But considering that `{0}` is a subset of the real numbers on which `exp` preserve the integers is going too far.


I tend to agree, but the present ticket is a step in the right direction in any case: it fixes some of the issues without making it harder to improve things later on.



---

archive/issue_comments_236591.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T23:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17953#issuecomment-236591",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051073.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T23:01:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17953",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17953#event-51073"
}
```
