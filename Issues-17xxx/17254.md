# Issue 17254: Upgrade to Singular-4.x.x

archive/issues_017017.json:
```json
{
    "body": "**Lots** of stuff has changed in Singular 4.\nThis is a big update.\n\nBuild system completely changed, and a lot of internal stuff.\n\nOriginal upstream tarball at `www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/`:  `singular-4.0.3p3` **dot** `tar` **dot** `gz`\n\nModified tarball made with spkg-src at:\n* http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2\n\nThis corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:\n* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n\nYou can also make your own tarball based on this commit or another one with\n\n```\nenv SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n./sage --package fix-checksum singular\n```\nThis script is loosely based on the `make_tar.sh` script from upstream.\n\nCC:  jpflori @burcin jakobkroeker @kiwifb @malb @mkoeppe @vbraun @nthiery @bhutz @miguelmarco gjorgenson\n\nReviewer: Fran\u00e7ois Bissey, Jeroen Demeyer, Ben Hutz, Leif Leonhardy, Dima Pasechnik, Travis Scrimshaw\n\nAuthor: Jakob Kroeker, Jean-Pierre Flori, Jeroen Demeyer, John Perry, Fran\u00e7ois Bissey, Leif Leonhardy, Dima Pasechnik\n\nBranch: f1a0dcc6c83ecac7ea4b0ebcd4638b7919047e58\n\nDependencies: #17635\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17254\n\n",
    "closed_at": "2016-10-21T07:04:36Z",
    "created_at": "2014-10-29T15:17:10Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Upgrade to Singular-4.x.x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17254",
    "user": "https://github.com/jdemeyer"
}
```
**Lots** of stuff has changed in Singular 4.
This is a big update.

Build system completely changed, and a lot of internal stuff.

Original upstream tarball at `www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/`:  `singular-4.0.3p3` **dot** `tar` **dot** `gz`

Modified tarball made with spkg-src at:
* http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2

This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:
* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7

You can also make your own tarball based on this commit or another one with

```
env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
./sage --package fix-checksum singular
```
This script is loosely based on the `make_tar.sh` script from upstream.

CC:  jpflori @burcin jakobkroeker @kiwifb @malb @mkoeppe @vbraun @nthiery @bhutz @miguelmarco gjorgenson

Reviewer: François Bissey, Jeroen Demeyer, Ben Hutz, Leif Leonhardy, Dima Pasechnik, Travis Scrimshaw

Author: Jakob Kroeker, Jean-Pierre Flori, Jeroen Demeyer, John Perry, François Bissey, Leif Leonhardy, Dima Pasechnik

Branch: f1a0dcc6c83ecac7ea4b0ebcd4638b7919047e58

Dependencies: #17635

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17254





---

archive/issue_comments_240199.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+**Lots** of stuff has changed in Singular 4. The attached branch is far from working.\n \n Comment: 1\n \n``````\n",
    "created_at": "2014-10-29T19:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240199",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+**Lots** of stuff has changed in Singular 4. The attached branch is far from working.
 
 Comment: 1
 
``````




---

archive/issue_comments_240200.json:
```json
{
    "body": "<a id='comment:2'></a>Yeah, the update is non trivial, that's a reason to get #17184 (and so #16882) inbetween.",
    "created_at": "2014-10-30T10:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240200",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>Yeah, the update is non trivial, that's a reason to get #17184 (and so #16882) inbetween.



---

archive/issue_comments_240201.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 jpflori]:\n> Yeah, the update is non trivial\n\nI wonder if we even have a Sage developer who is familiar enough with Singular to do this (for the record: not me, I know nothing about Singular).\n\n> that's a reason to get #17184 (and so #16882) inbetween.\n\nOf course, I'm not arguing with that.",
    "created_at": "2014-10-30T10:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240201",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Replying to [comment:2 jpflori]:
> Yeah, the update is non trivial

I wonder if we even have a Sage developer who is familiar enough with Singular to do this (for the record: not me, I know nothing about Singular).

> that's a reason to get #17184 (and so #16882) inbetween.

Of course, I'm not arguing with that.



---

archive/issue_comments_240202.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 jdemeyer]:\n> Replying to [comment:2 jpflori]:\n> > Yeah, the update is non trivial\n\n> I wonder if we even have a Sage developer who is familiar enough with Singular to do this (for the record: not me, I know nothing about Singular).\nMaybe Burcin would do...\nIIRC the update was proposed as a GSoC project.",
    "created_at": "2014-10-30T13:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240202",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 jpflori]:
> > Yeah, the update is non trivial

> I wonder if we even have a Sage developer who is familiar enough with Singular to do this (for the record: not me, I know nothing about Singular).
Maybe Burcin would do...
IIRC the update was proposed as a GSoC project.



---

archive/issue_comments_240203.json:
```json
{
    "body": "<a id='comment:6'></a>Q: where to get the singular tarball for this commit? \nI get a failure at \n\n``` \nTrying to download http://www.sagemath.org/packages/upstream/singular/singular-4.0.1p1.tar.bz2\n```\n\n2.\n> > Update to Singular 4.0.1\n\n> Maybe Burcin would do...\n\n\n\nCould the update to 4.0.1. be done by at least two or three persons to spread the knownledge\nabout Singular internals?",
    "created_at": "2014-11-03T11:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240203",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:6'></a>Q: where to get the singular tarball for this commit? 
I get a failure at 

``` 
Trying to download http://www.sagemath.org/packages/upstream/singular/singular-4.0.1p1.tar.bz2
```

2.
> > Update to Singular 4.0.1

> Maybe Burcin would do...



Could the update to 4.0.1. be done by at least two or three persons to spread the knownledge
about Singular internals?



---

archive/issue_comments_240204.json:
```json
{
    "body": "<a id='comment:7'></a>You have to put a tarball repackaged by the `spkg-src` script in the `upstream` folder directly.\nOnce the ticket is merged, the tarball will be put on the official mirror and could be downloaded automatically but not at the moment.\n\nI've put a repackaged tarball at:\n* http://boxen.math.washington.edu/home/jpflori/upstream/singular-4.0.1.tar.bz2",
    "created_at": "2014-11-03T12:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240204",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>You have to put a tarball repackaged by the `spkg-src` script in the `upstream` folder directly.
Once the ticket is merged, the tarball will be put on the official mirror and could be downloaded automatically but not at the moment.

I've put a repackaged tarball at:
* http://boxen.math.washington.edu/home/jpflori/upstream/singular-4.0.1.tar.bz2



---

archive/issue_comments_240205.json:
```json
{
    "body": "<a id='comment:8'></a>(I'm not sure the checksums will the same as what Jeroen branch expect, run `./sage -sh sage-fix-pkg-checksums` after you have downloaded the tarball to fix this.)",
    "created_at": "2014-11-03T12:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240205",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>(I'm not sure the checksums will the same as what Jeroen branch expect, run `./sage -sh sage-fix-pkg-checksums` after you have downloaded the tarball to fix this.)



---

archive/issue_comments_240206.json:
```json
{
    "body": "<a id='comment:9'></a>And I'd be happy to work on the upgrade and learn more about Singular's internals, but please also review the \"easy\" #17184 (where I've already learnt some stuff) firsT.",
    "created_at": "2014-11-03T12:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240206",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>And I'd be happy to work on the upgrade and learn more about Singular's internals, but please also review the "easy" #17184 (where I've already learnt some stuff) firsT.



---

archive/issue_comments_240207.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+**Lots** of stuff has changed in Singular 4. The attached branch is far from working.\n \n+Repackaged upstream tarball: [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2)\n \n Comment: 1\n \n``````\n",
    "created_at": "2014-11-03T20:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240207",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+**Lots** of stuff has changed in Singular 4. The attached branch is far from working.
 
+Repackaged upstream tarball: [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2)
 
 Comment: 1
 
``````




---

archive/issue_comments_240208.json:
```json
{
    "body": "<a id='comment:11'></a>Singular 4.0.1. compiles now in sage but sage does not yet -\nI just pushed a branch 'u/jakobkroeker/ticket/17254'.\nYou have to correct the 'singular-4.0.1p1.tar.bz2' tarball to get it work ( the 'm4' folder is missing). \n\nFor the moment I removed some patches; we probably will have to adjust them later on. For example there is meanwhile no such thing like 'lomalloc_ndebug' so if we want to disable some debug functionality or output for omalloc we have to do that by passing appropriate flags to omalloc/configure, e,g\n'--enable-optimizationflags --disable-debug --without-debug' ?\n\nAlso I disabled the currently broken\n'--enable-debugoutput' configure flag for the standalone 'factory'\nand informed Oleksander Motsak about the issue.\n\nCould someone of you take care of the sage compile errors and figure out what is going wrong and/or ask for help in the Singular forum? I can't do that easily, because within the Singular-team I'm out-of-favor because I constantly  criticise their software and thus I will likely get little or no support.\n\n\nJakob",
    "created_at": "2015-01-21T10:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240208",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:11'></a>Singular 4.0.1. compiles now in sage but sage does not yet -
I just pushed a branch 'u/jakobkroeker/ticket/17254'.
You have to correct the 'singular-4.0.1p1.tar.bz2' tarball to get it work ( the 'm4' folder is missing). 

For the moment I removed some patches; we probably will have to adjust them later on. For example there is meanwhile no such thing like 'lomalloc_ndebug' so if we want to disable some debug functionality or output for omalloc we have to do that by passing appropriate flags to omalloc/configure, e,g
'--enable-optimizationflags --disable-debug --without-debug' ?

Also I disabled the currently broken
'--enable-debugoutput' configure flag for the standalone 'factory'
and informed Oleksander Motsak about the issue.

Could someone of you take care of the sage compile errors and figure out what is going wrong and/or ask for help in the Singular forum? I can't do that easily, because within the Singular-team I'm out-of-favor because I constantly  criticise their software and thus I will likely get little or no support.


Jakob



---

archive/issue_comments_240209.json:
```json
{
    "body": "<a id='comment:12'></a>New commits:",
    "created_at": "2015-01-21T13:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240209",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>New commits:



---

archive/issue_comments_240210.json:
```json
{
    "body": "<a id='comment:14'></a>first hint: for example the interface of 'naIsZero'\nseems changed from \n\n```\nBOOLEAN naIsZero(number a)\n```\nto \n\n```\nBOOLEAN naIsZero(number a, const coeffs cf)\n```\nPersons who might have an idea about the changes:\n\nOleksandr Motsak\nMohamed Barakat\nMartin Lee\nHans Sch\u00f6nemann \n\nsee contact details at\nhttp://www.mathematik.uni-kl.de/agag/mitglieder/",
    "created_at": "2015-01-21T13:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240210",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:14'></a>first hint: for example the interface of 'naIsZero'
seems changed from 

```
BOOLEAN naIsZero(number a)
```
to 

```
BOOLEAN naIsZero(number a, const coeffs cf)
```
Persons who might have an idea about the changes:

Oleksandr Motsak
Mohamed Barakat
Martin Lee
Hans Schönemann 

see contact details at
http://www.mathematik.uni-kl.de/agag/mitglieder/



---

archive/issue_comments_240211.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:7 jpflori]:\n> I've put a repackaged tarball at:\n> * http://boxen.math.washington.edu/home/jpflori/upstream/singular-4.0.1.tar.bz2\n \nThat's an older version than the one that I put in the ticket description, any reason...?",
    "created_at": "2015-01-21T21:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240211",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:7 jpflori]:
> I've put a repackaged tarball at:
> * http://boxen.math.washington.edu/home/jpflori/upstream/singular-4.0.1.tar.bz2
 
That's an older version than the one that I put in the ticket description, any reason...?



---

archive/issue_comments_240212.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:11 jakobkroeker]:\n> You have to correct the 'singular-4.0.1p1.tar.bz2' tarball to get it work ( the 'm4' folder is missing).\n\nMy tarball compiled fine, so what is the problem?",
    "created_at": "2015-01-21T21:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240212",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Replying to [comment:11 jakobkroeker]:
> You have to correct the 'singular-4.0.1p1.tar.bz2' tarball to get it work ( the 'm4' folder is missing).

My tarball compiled fine, so what is the problem?



---

archive/issue_comments_240213.json:
```json
{
    "body": "<a id='comment:18'></a>You should never run `./autogen.sh`, that is supposed to be run at packaging-time, not build-time.",
    "created_at": "2015-01-21T21:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240213",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>You should never run `./autogen.sh`, that is supposed to be run at packaging-time, not build-time.



---

archive/issue_comments_240214.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-21T22:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240215.json:
```json
{
    "body": "<a id='comment:20'></a>>My tarball compiled fine, so what is the problem?\n\n\nConfirm; cannot reproduce the issue.\nSo likely I didn't use the recent tarball, or I screwed something up.\n\n> You should never run ./autogen.sh, that is supposed to be run at packaging-time, not build-time.\n\n\nI'm guilty ;-)",
    "created_at": "2015-01-23T16:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240215",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:20'></a>>My tarball compiled fine, so what is the problem?


Confirm; cannot reproduce the issue.
So likely I didn't use the recent tarball, or I screwed something up.

> You should never run ./autogen.sh, that is supposed to be run at packaging-time, not build-time.


I'm guilty ;-)



---

archive/issue_comments_240216.json:
```json
{
    "body": "<a id='comment:21'></a>singulars spkg-install:\n\nthe '--enable-debugoutput' configure flag \nfor standalone factory needs now in additon '--enable-streamio --without-Singular'",
    "created_at": "2015-01-26T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240216",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:21'></a>singulars spkg-install:

the '--enable-debugoutput' configure flag 
for standalone factory needs now in additon '--enable-streamio --without-Singular'



---

archive/issue_comments_240217.json:
```json
{
    "body": "<a id='comment:22'></a>After a little more tweaking and temporarily disabling the extension fields/rings, \nI was able to build some parts of sage with Singular 4.0.1  on a 'fc18 system' and\nthen.. sage crashes at start! That happens because I didn't update ring creation right - I only  recently discovered examples at './libpolys/tests/rings_test.h'.  And some sage packages create common rings at loading time.\n\nremaining riddles:\n- during build one sage file tried to link to -lsingular (I have no idea why), instead to the   libSingular* files (that changed!), so I worked around by manually creating links to libSingular* files.\n\n- on a ScientificLinux system I get errors like \"ImportError: /home/kroeker/Projects/sage-singular-4.0.1/local/lib/python2.7/site-packages/sage/rings/polynomial/plural.so: undefined symbol: wFunctionalBuch\". This symbol is in libSingular*\n\n- fix ring creation. See examples at './libpolys/tests/rings_test.h'\n\n- the extension fields will need some more love. See 'algext.h' and 'transext.h'. `@`Martin: could you take a look?\n\n- some mapping functions (e.g. nr2mMapZp) now require a source and dst (coefficient) parameter. Not sure if I did it right (source: currentRing, dest: _ring or vice versa?)\n\n- I didn't fix unused interface definitions in singular-cdefs.pxi. TODO\n \nSee branch u/jakobkroeker/ticket/17254\nand some notes at https://github.com/jakobkroeker/jk_test_sage/issues/13\n\nIf a build get stuck before errors described above, then maybe a 'make distclean' is necessary.\nAnd of course, the Singular tarball http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2 is required.\n\n\nAny help appreciated.\n\n\n\n\n\n\n \n---\nNew commits:",
    "created_at": "2015-02-02T12:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240217",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:22'></a>After a little more tweaking and temporarily disabling the extension fields/rings, 
I was able to build some parts of sage with Singular 4.0.1  on a 'fc18 system' and
then.. sage crashes at start! That happens because I didn't update ring creation right - I only  recently discovered examples at './libpolys/tests/rings_test.h'.  And some sage packages create common rings at loading time.

remaining riddles:
- during build one sage file tried to link to -lsingular (I have no idea why), instead to the   libSingular* files (that changed!), so I worked around by manually creating links to libSingular* files.

- on a ScientificLinux system I get errors like "ImportError: /home/kroeker/Projects/sage-singular-4.0.1/local/lib/python2.7/site-packages/sage/rings/polynomial/plural.so: undefined symbol: wFunctionalBuch". This symbol is in libSingular*

- fix ring creation. See examples at './libpolys/tests/rings_test.h'

- the extension fields will need some more love. See 'algext.h' and 'transext.h'. `@`Martin: could you take a look?

- some mapping functions (e.g. nr2mMapZp) now require a source and dst (coefficient) parameter. Not sure if I did it right (source: currentRing, dest: _ring or vice versa?)

- I didn't fix unused interface definitions in singular-cdefs.pxi. TODO
 
See branch u/jakobkroeker/ticket/17254
and some notes at https://github.com/jakobkroeker/jk_test_sage/issues/13

If a build get stuck before errors described above, then maybe a 'make distclean' is necessary.
And of course, the Singular tarball http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2 is required.


Any help appreciated.






 
---
New commits:



---

archive/issue_comments_240218.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-02T12:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240219.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-04T20:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240220.json:
```json
{
    "body": "<a id='comment:26'></a>New commits:",
    "created_at": "2015-02-05T12:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240220",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:26'></a>New commits:



---

archive/issue_comments_240221.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+**Lots** of stuff has changed in Singular 4. But now the attached branch is almost working.\n \n+Repackaged upstream tarball: [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2)\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-02-05T12:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240221",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+**Lots** of stuff has changed in Singular 4. But now the attached branch is almost working.
 
+Repackaged upstream tarball: [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-4.0.1p1.tar.bz2)
 
 Comment: 1
 
``````




---

archive/issue_comments_240222.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-05T14:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240223.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-07T12:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240224.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-07T13:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240225.json:
```json
{
    "body": "<a id='comment:31'></a>What is the status of this ticket? I see the branch is off 6.5.rc0, which is quite old already...",
    "created_at": "2015-05-22T11:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240225",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:31'></a>What is the status of this ticket? I see the branch is off 6.5.rc0, which is quite old already...



---

archive/issue_comments_240226.json:
```json
{
    "body": "<a id='comment:32'></a>>What is the status of this ticket? I see the branch is off 6.5.rc0, which is quite old already...\n\n\nI'm busy and can't work on the ticket currently and expect to have time for the ticket at end of June,\nnot earlier...\n\nwith the state as is, sage should build and start (using the Singular tarball from above), but extension fields and transcendental fields are not functional yet and also a cython Singular-interface cleanup has to be done.",
    "created_at": "2015-05-22T13:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240226",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:32'></a>>What is the status of this ticket? I see the branch is off 6.5.rc0, which is quite old already...


I'm busy and can't work on the ticket currently and expect to have time for the ticket at end of June,
not earlier...

with the state as is, sage should build and start (using the Singular tarball from above), but extension fields and transcendental fields are not functional yet and also a cython Singular-interface cleanup has to be done.



---

archive/issue_comments_240227.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 jakobkroeker]:\n> I'm busy and can't work on the ticket currently and expect to have time for the ticket at end of June, not earlier...\n> \n> with the state as is, sage should build and start (using the Singular tarball from above), but extension fields and transcendental fields are not functional yet and also a cython Singular-interface cleanup has to be done. \n> \n\n\nI'm at SD64.25 and am willing to work on this, but I'll need some hand-holding since I haven't worked on a package like this before. Do you have any suggestions for ways to test extension and transcendental fields?",
    "created_at": "2015-05-24T17:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240227",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:33'></a>Replying to [comment:32 jakobkroeker]:
> I'm busy and can't work on the ticket currently and expect to have time for the ticket at end of June, not earlier...
> 
> with the state as is, sage should build and start (using the Singular tarball from above), but extension fields and transcendental fields are not functional yet and also a cython Singular-interface cleanup has to be done. 
> 


I'm at SD64.25 and am willing to work on this, but I'll need some hand-holding since I haven't worked on a package like this before. Do you have any suggestions for ways to test extension and transcendental fields?



---

archive/issue_comments_240228.json:
```json
{
    "body": "<a id='comment:34'></a>I just applied this to 6.4.1 and encountered the message,\n\n    fatal error: Singular/libsingular.h: No such file or directory\n\nwhile compiling\n\n    build/cythonized/sage/algebras/letterplace/free_algebra_element_letterplace.cpp\n\nAny ideas what causes this?",
    "created_at": "2015-05-24T19:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240228",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:34'></a>I just applied this to 6.4.1 and encountered the message,

    fatal error: Singular/libsingular.h: No such file or directory

while compiling

    build/cythonized/sage/algebras/letterplace/free_algebra_element_letterplace.cpp

Any ideas what causes this?



---

archive/issue_comments_240229.json:
```json
{
    "body": "<a id='comment:35'></a>I haven't looked yet at the new singular 4.0.x but the first port of call would be to check if the header is indeed installed in `$SAGE_LOCAL/include`.",
    "created_at": "2015-05-24T20:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240229",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'></a>I haven't looked yet at the new singular 4.0.x but the first port of call would be to check if the header is indeed installed in `$SAGE_LOCAL/include`.



---

archive/issue_comments_240230.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 fbissey]:\n> I haven't looked yet at the new singular 4.0.x but the first port of call would be to check if the header is indeed installed in `$SAGE_LOCAL/include`.\n\n\nShortly after, that installation of Sage fell completely apart (not sure why) so now I'm working on Sage-6.7.\n\nOn 6.7, git identifies some issues with merging in singular.pyx and ring.pyx, but they're fairly clear to fix, so I did. (Unless they *weren't* easy.) Things went much further this time, until I encountered this error:\n\n```\n****************************************************\n### Singular spkg-install: choose_patches ###\n### Singular spkg-install: apply_patches ###\nApplying /Applications/sage-6.7/local/var/tmp/sage/build/singular-4.0.1p1.p0/patches/stricmp.patch\ncan't find file to patch at input line 7\nPerhaps you used the wrong -p or --strip option?\nThe text leading up to this was:\n--------------------------\n--------------------------\nFile to patch: \nSkip this patch? [y] \nSkipping patch.\n1 out of 1 hunk ignored\nError applying '/Applications/sage-6.7/local/var/tmp/sage/build/singular-4.0.1p1.p0/patches/stricmp.patch'\nError building Singular (error in apply_patches).\n```\nHere's what the file in question suggests:\n|stricmp is being deprecated in Cygwin.\n|One should use strcasecmp.\n|See https://cygwin.com/ml/cygwin/2014-10/msg00359.html\n|diff -druN src/latest/Singular/run.c src/latest/Singular/run.c\n|--- latest/Singular/run.c\t2014-11-19 14:06:05.000000000 +0100\n|+++ latest/Singular/run.c\t2015-01-16 09:32:45.771298300 +0100\n```\nstricmp is being deprecated in Cygwin.\nOne should use strcasecmp.\nSee https://cygwin.com/ml/cygwin/2014-10/msg00359.html\ndiff -druN src/latest/Singular/run.c src/latest/Singular/run.c\n--- latest/Singular/run.c       2014-11-19 14:06:05.000000000 +0100\n+++ latest/Singular/run.c       2015-01-16 09:32:45.771298300 +0100\n@@ -45,6 +45,7 @@\n  #include <sys/stat.h>\n  #include <sys/cygwin.h>\n  #include <sys/unistd.h>\n+ #define stricmp strcasecmp\n //WinMainCRTStartup() { mainCRTStartup(); }\n #else\n  #include <direct.h>\n```\nIndeed, I do not find `run.c` in `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/latest/Singular/`, which I am guessing is where this is supposed to be; instead, I find only run.h.\n\nIn my local distribution of Singular, I find a `run.c`. If I copy it over & try to make, I get the same complaint, & it looks as if the file is actually deleted. Suggestions?",
    "created_at": "2015-05-24T22:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240230",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:36'></a>Replying to [comment:35 fbissey]:
> I haven't looked yet at the new singular 4.0.x but the first port of call would be to check if the header is indeed installed in `$SAGE_LOCAL/include`.


Shortly after, that installation of Sage fell completely apart (not sure why) so now I'm working on Sage-6.7.

On 6.7, git identifies some issues with merging in singular.pyx and ring.pyx, but they're fairly clear to fix, so I did. (Unless they *weren't* easy.) Things went much further this time, until I encountered this error:

```
****************************************************
### Singular spkg-install: choose_patches ###
### Singular spkg-install: apply_patches ###
Applying /Applications/sage-6.7/local/var/tmp/sage/build/singular-4.0.1p1.p0/patches/stricmp.patch
can't find file to patch at input line 7
Perhaps you used the wrong -p or --strip option?
The text leading up to this was:
--------------------------
--------------------------
File to patch: 
Skip this patch? [y] 
Skipping patch.
1 out of 1 hunk ignored
Error applying '/Applications/sage-6.7/local/var/tmp/sage/build/singular-4.0.1p1.p0/patches/stricmp.patch'
Error building Singular (error in apply_patches).
```
Here's what the file in question suggests:
|stricmp is being deprecated in Cygwin.
|One should use strcasecmp.
|See https://cygwin.com/ml/cygwin/2014-10/msg00359.html
|diff -druN src/latest/Singular/run.c src/latest/Singular/run.c
|--- latest/Singular/run.c	2014-11-19 14:06:05.000000000 +0100
|+++ latest/Singular/run.c	2015-01-16 09:32:45.771298300 +0100
```
stricmp is being deprecated in Cygwin.
One should use strcasecmp.
See https://cygwin.com/ml/cygwin/2014-10/msg00359.html
diff -druN src/latest/Singular/run.c src/latest/Singular/run.c
--- latest/Singular/run.c       2014-11-19 14:06:05.000000000 +0100
+++ latest/Singular/run.c       2015-01-16 09:32:45.771298300 +0100
@@ -45,6 +45,7 @@
  #include <sys/stat.h>
  #include <sys/cygwin.h>
  #include <sys/unistd.h>
+ #define stricmp strcasecmp
 //WinMainCRTStartup() { mainCRTStartup(); }
 #else
  #include <direct.h>
```
Indeed, I do not find `run.c` in `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/latest/Singular/`, which I am guessing is where this is supposed to be; instead, I find only run.h.

In my local distribution of Singular, I find a `run.c`. If I copy it over & try to make, I get the same complaint, & it looks as if the file is actually deleted. Suggestions?



---

archive/issue_comments_240231.json:
```json
{
    "body": "<a id='comment:37'></a>Did you mean `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/Singular/` the `latest` bit should be stripped by the `-p1` option to patch.",
    "created_at": "2015-05-24T22:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240231",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>Did you mean `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/Singular/` the `latest` bit should be stripped by the `-p1` option to patch.



---

archive/issue_comments_240232.json:
```json
{
    "body": "<a id='comment:38'></a>The patch has `latest` in it; that's why I wrote that in there, so that is what I mean. Is your meaning that `latest` should not be there? That directory doesn't exist when I look through the paths.",
    "created_at": "2015-05-24T23:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240232",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:38'></a>The patch has `latest` in it; that's why I wrote that in there, so that is what I mean. Is your meaning that `latest` should not be there? That directory doesn't exist when I look through the paths.



---

archive/issue_comments_240233.json:
```json
{
    "body": "<a id='comment:39'></a>It is expected for that directory not to exist for you. Whoever wrote the patch was working in a folder named `latest` but it is their own naming. It doesn't matter anyway. Let me explain to you how the `-p` option of patch works. \n\nYour patch has a header that helps you locate the file to patch:\n\n```\n--- latest/Singular/run.c       2014-11-19 14:06:05.000000000 +0100\n+++ latest/Singular/run.c       2015-01-16 09:32:45.771298300 +0100\n```\n`patch < mypatch.patch` or equivalently `patch -p0< mypatch.patch` will look for the file\n`latest/Singular/run.c` relative to where patch is executed. `-pN` will strip the `N` first folders in front of the file name so \n\n`patch -p1< mypatch.patch` will look for `Singular/run.c`. In `spkg-install` for singular, patches are applied with `patch -p1 <\"$patch\"` so you shouldn't care about `latest` it is discarded. Look for `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/Singular/run.c` OK?",
    "created_at": "2015-05-24T23:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240233",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>It is expected for that directory not to exist for you. Whoever wrote the patch was working in a folder named `latest` but it is their own naming. It doesn't matter anyway. Let me explain to you how the `-p` option of patch works. 

Your patch has a header that helps you locate the file to patch:

```
--- latest/Singular/run.c       2014-11-19 14:06:05.000000000 +0100
+++ latest/Singular/run.c       2015-01-16 09:32:45.771298300 +0100
```
`patch < mypatch.patch` or equivalently `patch -p0< mypatch.patch` will look for the file
`latest/Singular/run.c` relative to where patch is executed. `-pN` will strip the `N` first folders in front of the file name so 

`patch -p1< mypatch.patch` will look for `Singular/run.c`. In `spkg-install` for singular, patches are applied with `patch -p1 <"$patch"` so you shouldn't care about `latest` it is discarded. Look for `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/Singular/run.c` OK?



---

archive/issue_comments_240234.json:
```json
{
    "body": "<a id='comment:40'></a>I think you misunderstand.\n\nReplying to [comment:39 fbissey]:\n> It is expected for that directory not to exist for you.\n\n\nWhy not? That directory *does* exist for me. The problem is that the *file* `run.c` does not exist *in* it.\n\n>Look for `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/Singular/run.c` OK?\n\n\nThere is no such directory. I can get to `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/` but the only directories in there are `latest` and `shared`.",
    "created_at": "2015-05-24T23:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240234",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:40'></a>I think you misunderstand.

Replying to [comment:39 fbissey]:
> It is expected for that directory not to exist for you.


Why not? That directory *does* exist for me. The problem is that the *file* `run.c` does not exist *in* it.

>Look for `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/Singular/run.c` OK?


There is no such directory. I can get to `local/var/tmp/sage/build/singular-4.0.1p1.p0/src/` but the only directories in there are `latest` and `shared`.



---

archive/issue_comments_240235.json:
```json
{
    "body": "<a id='comment:41'></a>OK you seem to be right. The tarball has been packaged strangely and I am not sure I have the right `spkg-install`. It is a cygwin patch and cygwin support in singular seems to have changed considerably. I would just remove the patch for now, it doesn't/cannot apply anywway any new fix for cygwin would have to be done from scratch by someone with a cygwin system.",
    "created_at": "2015-05-24T23:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240235",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>OK you seem to be right. The tarball has been packaged strangely and I am not sure I have the right `spkg-install`. It is a cygwin patch and cygwin support in singular seems to have changed considerably. I would just remove the patch for now, it doesn't/cannot apply anywway any new fix for cygwin would have to be done from scratch by someone with a cygwin system.



---

archive/issue_comments_240236.json:
```json
{
    "body": "<a id='comment:42'></a>How do I remove it? If I move it & `make` anew, the file reappears.",
    "created_at": "2015-05-24T23:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240236",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:42'></a>How do I remove it? If I move it & `make` anew, the file reappears.



---

archive/issue_comments_240237.json:
```json
{
    "body": "<a id='comment:43'></a>`git rm build/pkgs/singular/patches/stricmp.patch`?",
    "created_at": "2015-05-24T23:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240237",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>`git rm build/pkgs/singular/patches/stricmp.patch`?



---

archive/issue_comments_240238.json:
```json
{
    "body": "<a id='comment:44'></a>Thanks, that worked. Now I get failure on a line in ring.pyx,\n\n```\n    if is_64_bit:\n```\nNamely, Cython (?) claims this is undefined. I guess this is a change in Cython, since that isn't introduced by this patch. I found online another way to test this (`sys.maxsize > 2**32`) so I'm trying with that. Found another issue, but that was easy. Proceeding with fingers crossed... it's still compiling, which is already an progress...!",
    "created_at": "2015-05-25T00:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240238",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:44'></a>Thanks, that worked. Now I get failure on a line in ring.pyx,

```
    if is_64_bit:
```
Namely, Cython (?) claims this is undefined. I guess this is a change in Cython, since that isn't introduced by this patch. I found online another way to test this (`sys.maxsize > 2**32`) so I'm trying with that. Found another issue, but that was easy. Proceeding with fingers crossed... it's still compiling, which is already an progress...!



---

archive/issue_comments_240239.json:
```json
{
    "body": "<a id='comment:45'></a>It seems to have built, but Sage doesn't run. Here's the last few lines of the compilation (sorry for so much, but I wanted to show what it was saying at the end of what looks like a successful build, too):\n\n```\n...\nbyte-compiling /Applications/sage-6.7/local/lib/python2.7/site-packages/sage_setup/find.py to find.pyc\nbyte-compiling /Applications/sage-6.7/local/lib/python2.7/site-packages/sage_setup/optional_extension.py to optional_extension.pyc\nrunning install_egg_info\nRemoving /Applications/sage-6.7/local/lib/python2.7/site-packages/sage-6.8.beta0-py2.7.egg-info\nWriting /Applications/sage-6.7/local/lib/python2.7/site-packages/sage-6.8.beta0-py2.7.egg-info\n\nreal\t0m25.849s\nuser\t0m11.855s\nsys\t0m3.847s\n[ -f local/etc/sage-started.txt ] || local/bin/sage-starts\nbuild/pipestatus \"./sage --docbuild --no-pdf-links all html  2>&1\" \"tee -a logs/dochtml.log\"\nDeleting empty directory /Applications/sage-6.7/src/doc/common/static\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/combinat/static\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/combinat/templates\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/polynomial_rings/static\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/polynomial_rings/templates\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/repl/static\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/repl/templates\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/tensor_free_modules/static\nDeleting empty directory /Applications/sage-6.7/src/doc/en/reference/tensor_free_modules/templates\nDeleting empty directory /Applications/sage-6.7/src/doc/output/inventory/en/reference/combinat\nTraceback (most recent call last):\n  File \"/Applications/sage-6.7/src/doc/common/builder.py\", line 1619, in <module>\n    import sage.all\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/all.py\", line 98, in <module>\n    from sage.rings.all      import *\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/all.py\", line 68, in <module>\n    from number_field.all import *\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/number_field/all.py\", line 7, in <module>\n    from totallyreal import enumerate_totallyreal_fields_prim\n  File \"sage/rings/number_field/totallyreal_data.pxd\", line 16, in init sage.rings.number_field.totallyreal (build/cythonized/sage/rings/number_field/totallyreal.c:10339)\n  File \"sage/rings/number_field/totallyreal_data.pyx\", line 39, in init sage.rings.number_field.totallyreal_data (build/cythonized/sage/rings/number_field/totallyreal_data.c:11133)\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py\", line 465, in PolynomialRing\n    R = _single_variate(base_ring, name, sparse, implementation)\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py\", line 539, in _single_variate\n    R = m.PolynomialRing_integral_domain(base_ring, name, sparse, implementation)\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py\", line 1544, in __init__\n    sparse=sparse, element_class=element_class)\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py\", line 1451, in __init__\n    sparse=sparse, element_class=element_class, category=category)\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py\", line 305, in __init__\n    from sage.matrix.matrix_space import is_MatrixSpace\n  File \"/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 57, in <module>\n    import matrix_mpolynomial_dense\nImportError: dlopen(/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so, 2): Symbol not found: __Z17initCanonicalFormv\n  Referenced from: /Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so\n  Expected in: flat namespace\n in /Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so\nmake: *** [doc-html] Error 1\n```",
    "created_at": "2015-05-25T01:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240239",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:45'></a>It seems to have built, but Sage doesn't run. Here's the last few lines of the compilation (sorry for so much, but I wanted to show what it was saying at the end of what looks like a successful build, too):

```
...
byte-compiling /Applications/sage-6.7/local/lib/python2.7/site-packages/sage_setup/find.py to find.pyc
byte-compiling /Applications/sage-6.7/local/lib/python2.7/site-packages/sage_setup/optional_extension.py to optional_extension.pyc
running install_egg_info
Removing /Applications/sage-6.7/local/lib/python2.7/site-packages/sage-6.8.beta0-py2.7.egg-info
Writing /Applications/sage-6.7/local/lib/python2.7/site-packages/sage-6.8.beta0-py2.7.egg-info

real	0m25.849s
user	0m11.855s
sys	0m3.847s
[ -f local/etc/sage-started.txt ] || local/bin/sage-starts
build/pipestatus "./sage --docbuild --no-pdf-links all html  2>&1" "tee -a logs/dochtml.log"
Deleting empty directory /Applications/sage-6.7/src/doc/common/static
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/combinat/static
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/combinat/templates
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/polynomial_rings/static
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/polynomial_rings/templates
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/repl/static
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/repl/templates
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/tensor_free_modules/static
Deleting empty directory /Applications/sage-6.7/src/doc/en/reference/tensor_free_modules/templates
Deleting empty directory /Applications/sage-6.7/src/doc/output/inventory/en/reference/combinat
Traceback (most recent call last):
  File "/Applications/sage-6.7/src/doc/common/builder.py", line 1619, in <module>
    import sage.all
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/all.py", line 98, in <module>
    from sage.rings.all      import *
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/all.py", line 68, in <module>
    from number_field.all import *
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/number_field/all.py", line 7, in <module>
    from totallyreal import enumerate_totallyreal_fields_prim
  File "sage/rings/number_field/totallyreal_data.pxd", line 16, in init sage.rings.number_field.totallyreal (build/cythonized/sage/rings/number_field/totallyreal.c:10339)
  File "sage/rings/number_field/totallyreal_data.pyx", line 39, in init sage.rings.number_field.totallyreal_data (build/cythonized/sage/rings/number_field/totallyreal_data.c:11133)
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 465, in PolynomialRing
    R = _single_variate(base_ring, name, sparse, implementation)
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 539, in _single_variate
    R = m.PolynomialRing_integral_domain(base_ring, name, sparse, implementation)
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py", line 1544, in __init__
    sparse=sparse, element_class=element_class)
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py", line 1451, in __init__
    sparse=sparse, element_class=element_class, category=category)
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py", line 305, in __init__
    from sage.matrix.matrix_space import is_MatrixSpace
  File "/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 57, in <module>
    import matrix_mpolynomial_dense
ImportError: dlopen(/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so, 2): Symbol not found: __Z17initCanonicalFormv
  Referenced from: /Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so
  Expected in: flat namespace
 in /Applications/sage-6.7/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so
make: *** [doc-html] Error 1
```



---

archive/issue_comments_240240.json:
```json
{
    "body": "<a id='comment:46'></a>It appears that it should be generated by `initCanonicalForm` but no functions of that name is to be found in the source code I have for singular 4.0.2 here and I am expecting it to be the same for you. I think you may have old singular headers on your system that are interfering (`factory.h`) we'll have to develop a proper upgrade procedure to remove singular 3.1.x stuff before installing 4.x. That or the singular 4.x headers have not been installed properly. `local/include/factory/factory/factory.h` and `local/include/factory/factory.h` both have this function in singular 3.1.7 but it shouldn't be present in the equivalent headers from singular 4.x.",
    "created_at": "2015-05-25T02:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240240",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>It appears that it should be generated by `initCanonicalForm` but no functions of that name is to be found in the source code I have for singular 4.0.2 here and I am expecting it to be the same for you. I think you may have old singular headers on your system that are interfering (`factory.h`) we'll have to develop a proper upgrade procedure to remove singular 3.1.x stuff before installing 4.x. That or the singular 4.x headers have not been installed properly. `local/include/factory/factory/factory.h` and `local/include/factory/factory.h` both have this function in singular 3.1.7 but it shouldn't be present in the equivalent headers from singular 4.x.



---

archive/issue_comments_240241.json:
```json
{
    "body": "<a id='comment:47'></a>I don't seem to have a `local/include/factory` at all...",
    "created_at": "2015-05-25T05:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240241",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:47'></a>I don't seem to have a `local/include/factory` at all...



---

archive/issue_comments_240242.json:
```json
{
    "body": "<a id='comment:48'></a>I really have to inspect the spkg. I think I went overboard with the `factory` in the path. Should have been `local/include/factory.h` and `local/include/factory/factory.h`. Do you have a `factory.h` and does it contains `initCanonicalForm`?",
    "created_at": "2015-05-25T06:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240242",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:48'></a>I really have to inspect the spkg. I think I went overboard with the `factory` in the path. Should have been `local/include/factory.h` and `local/include/factory/factory.h`. Do you have a `factory.h` and does it contains `initCanonicalForm`?



---

archive/issue_comments_240243.json:
```json
{
    "body": "<a id='comment:49'></a>`make distclean` then `make` seems to have fixed my problems. I am apparently running Singular 4, albeit with the changes I mentioned earlier. At startup, I see the following:\n\n```\nring with rational coefficient field created\n_ring.ShortOut 1\n_ring.N 2\npolynomial ring over integers created\n_ring.ShortOut 1\n_ring.N 2\nring with rational coefficient field created\n_ring.ShortOut 1\n_ring.N 2\n```\nI found that in the source code, so I'm guessing this was put in to test.",
    "created_at": "2015-05-25T15:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240243",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:49'></a>`make distclean` then `make` seems to have fixed my problems. I am apparently running Singular 4, albeit with the changes I mentioned earlier. At startup, I see the following:

```
ring with rational coefficient field created
_ring.ShortOut 1
_ring.N 2
polynomial ring over integers created
_ring.ShortOut 1
_ring.N 2
ring with rational coefficient field created
_ring.ShortOut 1
_ring.N 2
```
I found that in the source code, so I'm guessing this was put in to test.



---

archive/issue_comments_240244.json:
```json
{
    "body": "<a id='comment:50'></a>Well, this is bad.\n\n```\nsage: R=PolynomialRing(GF(32003),'x',7)\nsage: I = sage.rings.ideal.Cyclic(R,7).homogenize()\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-2-59ae6a3e91c7> in <module>()\n----> 1 I = sage.rings.ideal.Cyclic(R,Integer(7)).homogenize()\n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/ideal.pyc in Cyclic(R, n, homog, singular)\n   1607         n = R.ngens()\n   1608 \n-> 1609     singular.lib(\"poly\")\n   1610     R2 = R.change_ring(RationalField())\n   1611     R2._singular_().set_ring()\n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in lib(self, lib, reload)\n    783         if not reload and lib in self.__libs:\n    784             return\n--> 785         self.eval('LIB \"%s\"'%lib)\n    786         self.__libs.append(lib)\n    787 \n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)\n    585             x += ';'\n    586 \n--> 587         s = Expect.eval(self, x, **kwds)\n    588 \n    589         if s.find(\"error\") != -1 or s.find(\"Segment fault\") != -1:\n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1220                 elif split_lines:\n   1221                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n-> 1222                                         for L in code.split('\\n') if L != ''])\n   1223                 else:\n   1224                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)\n    817         try:\n    818             if self._expect is None:\n--> 819                 self._start()\n    820             E = self._expect\n    821             try:\n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)\n    410         \"\"\"\n    411         self.__libs = []\n--> 412         Expect._start(self, alt_message)\n    413         # Load some standard libraries.\n    414         self.lib('general')   # assumed loaded by misc/constants.py\n\n/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)\n    427                 # Change pexpect errors to RuntimeError\n    428                 raise RuntimeError(\"unable to start %s because the command %r failed: %s\\n%s\" %\n--> 429                         (self.name(), cmd, e, self._install_hints()))\n    430         except BaseException:\n    431             self._expect = None\n\nRuntimeError: unable to start singular because the command 'Singular -t --ticks-per-sec 1000' failed: The command was not found or was not executable: Singular.\n```",
    "created_at": "2015-05-25T15:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240244",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:50'></a>Well, this is bad.

```
sage: R=PolynomialRing(GF(32003),'x',7)
sage: I = sage.rings.ideal.Cyclic(R,7).homogenize()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-59ae6a3e91c7> in <module>()
----> 1 I = sage.rings.ideal.Cyclic(R,Integer(7)).homogenize()

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/rings/ideal.pyc in Cyclic(R, n, homog, singular)
   1607         n = R.ngens()
   1608 
-> 1609     singular.lib("poly")
   1610     R2 = R.change_ring(RationalField())
   1611     R2._singular_().set_ring()

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in lib(self, lib, reload)
    783         if not reload and lib in self.__libs:
    784             return
--> 785         self.eval('LIB "%s"'%lib)
    786         self.__libs.append(lib)
    787 

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)
    585             x += ';'
    586 
--> 587         s = Expect.eval(self, x, **kwds)
    588 
    589         if s.find("error") != -1 or s.find("Segment fault") != -1:

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1220                 elif split_lines:
   1221                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
-> 1222                                         for L in code.split('\n') if L != ''])
   1223                 else:
   1224                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)
    817         try:
    818             if self._expect is None:
--> 819                 self._start()
    820             E = self._expect
    821             try:

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)
    410         """
    411         self.__libs = []
--> 412         Expect._start(self, alt_message)
    413         # Load some standard libraries.
    414         self.lib('general')   # assumed loaded by misc/constants.py

/Applications/sage-6.7/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)
    427                 # Change pexpect errors to RuntimeError
    428                 raise RuntimeError("unable to start %s because the command %r failed: %s\n%s" %
--> 429                         (self.name(), cmd, e, self._install_hints()))
    430         except BaseException:
    431             self._expect = None

RuntimeError: unable to start singular because the command 'Singular -t --ticks-per-sec 1000' failed: The command was not found or was not executable: Singular.
```



---

archive/issue_comments_240245.json:
```json
{
    "body": "<a id='comment:51'></a>For what it's worth, lots of other things work.: I can, for instance, compute an ideal's Gr\u00f6bner basis, its Hilbert [numerator, series, polynomial], and so forth.",
    "created_at": "2015-05-25T16:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240245",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:51'></a>For what it's worth, lots of other things work.: I can, for instance, compute an ideal's Gröbner basis, its Hilbert [numerator, series, polynomial], and so forth.



---

archive/issue_comments_240246.json:
```json
{
    "body": "<a id='comment:52'></a>Indeed, there is no Singular binary in local/bin. I presume this is the problem, though I have no idea what became of it.",
    "created_at": "2015-05-25T17:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240246",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:52'></a>Indeed, there is no Singular binary in local/bin. I presume this is the problem, though I have no idea what became of it.



---

archive/issue_comments_240247.json:
```json
{
    "body": "<a id='comment:53'></a>I'm guessing that failure to install the singular binary is because of a symlink: `local/bin/singular' points to `local/bin/Singular` and removing the old (3.x) `Singular` wasn't enough to allow the new one in. I removed `local/bin/singular` and it's now working.\n\nThis may be an issue with Apple's file system, because after installing the new `Singular` I wasn't allowed to create the symlink.",
    "created_at": "2015-05-25T17:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240247",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:53'></a>I'm guessing that failure to install the singular binary is because of a symlink: `local/bin/singular' points to `local/bin/Singular` and removing the old (3.x) `Singular` wasn't enough to allow the new one in. I removed `local/bin/singular` and it's now working.

This may be an issue with Apple's file system, because after installing the new `Singular` I wasn't allowed to create the symlink.



---

archive/issue_comments_240248.json:
```json
{
    "body": "<a id='comment:54'></a>`is_64_bit` is deprecated. In Cython, check `sizeof(the_type_that_you_care_about)` instead.\n\nDo not use `sys.maxsize`, that's much slower.",
    "created_at": "2015-05-25T18:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240248",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:54'></a>`is_64_bit` is deprecated. In Cython, check `sizeof(the_type_that_you_care_about)` instead.

Do not use `sys.maxsize`, that's much slower.



---

archive/issue_comments_240249.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:53 john_perry]:\n> I'm guessing that failure to install the singular binary is because of a symlink: `local/bin/singular' points to `local/bin/Singular` and removing the old (3.x) `Singular` wasn't enough to allow the new one in. I removed `local/bin/singular` and it's now working.\n> \n> This may be an issue with Apple's file system, because after installing the new `Singular` I wasn't allowed to create the symlink.\n\n\nYes you may have seen another ticket in which I demonstrated that something like `Singular` was really `singular`. OS X file system is not case sensitive but it gives the impression of being one.",
    "created_at": "2015-05-25T21:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240249",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>Replying to [comment:53 john_perry]:
> I'm guessing that failure to install the singular binary is because of a symlink: `local/bin/singular' points to `local/bin/Singular` and removing the old (3.x) `Singular` wasn't enough to allow the new one in. I removed `local/bin/singular` and it's now working.
> 
> This may be an issue with Apple's file system, because after installing the new `Singular` I wasn't allowed to create the symlink.


Yes you may have seen another ticket in which I demonstrated that something like `Singular` was really `singular`. OS X file system is not case sensitive but it gives the impression of being one.



---

archive/issue_comments_240250.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:34 john_perry]:\n> I just applied this to 6.4.1 and encountered the message,\n> \n>     fatal error: Singular/libsingular.h: No such file or directory\n> \n> while compiling\n> \n>     build/cythonized/sage/algebras/letterplace/free_algebra_element_letterplace.cpp\n> \n> Any ideas what causes this?\n\n\nIt's now certain that this, too, was caused by the failure to install `Singular` because `singular` exists in the directory (what can I say, it's a Mac). Removing that link and reinstalling the spkg fixed all these problems. \n\n**Meanwhile**, I discovered some memory-related bugs in the patch. For instance, ring.pyx has the line\n\n```\nassert( exponent == base_ring.degree() )\n```\nwhich causes a failure. I'm not sure why those should be equal (the test I used had `Zmod(2^3)` where `exponent==3` and `base_ring.degree()==1`), but commenting it out leads to a failure on these lines:\n\n```\n_param.GFChar     = ch;\n_param.GFDegree   = base_ring.degree();\n_param.GFPar_name = omStrDup(base_ring.gen());   \n```\nbecause `_param` has not been initialized. Adding\n\n```\n_param = <GFInfo *>omAlloc(sizeof(GFInfo));\n```\n**before** the access gives me a ring. However,\n\n1. I'm not sure whether `omAlloc` or one of the other `omAlloc*` commands is more appropriate (e.g., `omAlloc0`). Anyone know?\n2. I suppose this has to be freed somewhere... I know there's an obvious-sounding place, so I'll find it.\n\nThere are other places this change has to occur. One more question:\n\n* A few lines before the ones I cited above is the test for 64-bits. I've switched to jdemeyer's test (`sizeof(long)>4`). However, the code in the patch is exactly the same for both 32- and 64-bit. Is there a recommendation for what to do here? I'm not sufficiently familiar with this to know what to do.",
    "created_at": "2015-05-25T21:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240250",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:56'></a>Replying to [comment:34 john_perry]:
> I just applied this to 6.4.1 and encountered the message,
> 
>     fatal error: Singular/libsingular.h: No such file or directory
> 
> while compiling
> 
>     build/cythonized/sage/algebras/letterplace/free_algebra_element_letterplace.cpp
> 
> Any ideas what causes this?


It's now certain that this, too, was caused by the failure to install `Singular` because `singular` exists in the directory (what can I say, it's a Mac). Removing that link and reinstalling the spkg fixed all these problems. 

**Meanwhile**, I discovered some memory-related bugs in the patch. For instance, ring.pyx has the line

```
assert( exponent == base_ring.degree() )
```
which causes a failure. I'm not sure why those should be equal (the test I used had `Zmod(2^3)` where `exponent==3` and `base_ring.degree()==1`), but commenting it out leads to a failure on these lines:

```
_param.GFChar     = ch;
_param.GFDegree   = base_ring.degree();
_param.GFPar_name = omStrDup(base_ring.gen());   
```
because `_param` has not been initialized. Adding

```
_param = <GFInfo *>omAlloc(sizeof(GFInfo));
```
**before** the access gives me a ring. However,

1. I'm not sure whether `omAlloc` or one of the other `omAlloc*` commands is more appropriate (e.g., `omAlloc0`). Anyone know?
2. I suppose this has to be freed somewhere... I know there's an obvious-sounding place, so I'll find it.

There are other places this change has to occur. One more question:

* A few lines before the ones I cited above is the test for 64-bits. I've switched to jdemeyer's test (`sizeof(long)>4`). However, the code in the patch is exactly the same for both 32- and 64-bit. Is there a recommendation for what to do here? I'm not sufficiently familiar with this to know what to do.



---

archive/issue_comments_240251.json:
```json
{
    "body": "<a id='comment:57'></a>Replying to [comment:56 john_perry]:\n> **Meanwhile**, I discovered some memory-related bugs in the patch. For instance, ring.pyx has the line\n> \n> ```\n> assert( exponent == base_ring.degree() )\n> ```\n> which causes a failure. I'm not sure why those should be equal (the test I used had `Zmod(2^3)` where `exponent==3` and `base_ring.degree()==1`)...\n\n\nTo wit, the source code for `base_ring.degree()` is, in total,\n\n```\n    def degree(self):\n        \"\"\"\n        Return 1.\n\n        EXAMPLE::\n\n            sage: R = Integers(12345678900)\n            sage: R.degree()\n            1\n        \"\"\"\n        return integer.Integer(1)\n```\nI don't know what is meant by the degree of a ring here, so I'll need guidance. For now I've commented it out.",
    "created_at": "2015-05-25T21:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240251",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:57'></a>Replying to [comment:56 john_perry]:
> **Meanwhile**, I discovered some memory-related bugs in the patch. For instance, ring.pyx has the line
> 
> ```
> assert( exponent == base_ring.degree() )
> ```
> which causes a failure. I'm not sure why those should be equal (the test I used had `Zmod(2^3)` where `exponent==3` and `base_ring.degree()==1`)...


To wit, the source code for `base_ring.degree()` is, in total,

```
    def degree(self):
        """
        Return 1.

        EXAMPLE::

            sage: R = Integers(12345678900)
            sage: R.degree()
            1
        """
        return integer.Integer(1)
```
I don't know what is meant by the degree of a ring here, so I'll need guidance. For now I've commented it out.



---

archive/issue_comments_240252.json:
```json
{
    "body": "<a id='comment:59'></a>Pushed code should build on 6.7. Mac users may have problems; if so, delete `local/bin/singular` and then `sage-spkg singular`; it should work after that. (In fact, I have to do it again myself now.) I have to run to the train (leaving SD) or I'd do it before leaving.\n\n---\nNew commits:",
    "created_at": "2015-05-25T23:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240252",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:59'></a>Pushed code should build on 6.7. Mac users may have problems; if so, delete `local/bin/singular` and then `sage-spkg singular`; it should work after that. (In fact, I have to do it again myself now.) I have to run to the train (leaving SD) or I'd do it before leaving.

---
New commits:



---

archive/issue_comments_240253.json:
```json
{
    "body": "<a id='comment:60'></a>Forgot to remove that bad patch; that will come in a subsequent push. Still have the problem with `local/bin/Singular` because of the local symlink; it's a problem with the package itself, because I deleted both symlink and local copy before running the install. I don't know how to fix that, so advice would be appreciated.",
    "created_at": "2015-05-26T01:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240253",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:60'></a>Forgot to remove that bad patch; that will come in a subsequent push. Still have the problem with `local/bin/Singular` because of the local symlink; it's a problem with the package itself, because I deleted both symlink and local copy before running the install. I don't know how to fix that, so advice would be appreciated.



---

archive/issue_comments_240254.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T03:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240255.json:
```json
{
    "body": "<a id='comment:62'></a>Replying to [comment:56 john_perry]:\n> However, the code in the patch is exactly the same for both 32- and 64-bit. Is there a recommendation for what to do here?\n\n\nObviously, replace\n\n```\nif condition:\n    X\nelse:\n    X\n```\nby\n\n```\nX\n```",
    "created_at": "2015-05-26T05:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240255",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'></a>Replying to [comment:56 john_perry]:
> However, the code in the patch is exactly the same for both 32- and 64-bit. Is there a recommendation for what to do here?


Obviously, replace

```
if condition:
    X
else:
    X
```
by

```
X
```



---

archive/issue_comments_240256.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:56 john_perry]:\n>     * A few lines before the ones I cited above is the test for 64-bits. I've switched to jdemeyer's test (`sizeof(long)>4`). However, the code in the patch is exactly the same for both 32- and 64-bit. Is there a recommendation for what to do here? I'm not sufficiently familiar with this to know what to do.\n\n\nLook at the diff for the old corresponding code: this doesn't have the branch.",
    "created_at": "2015-05-26T05:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240256",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:63'></a>Replying to [comment:56 john_perry]:
>     * A few lines before the ones I cited above is the test for 64-bits. I've switched to jdemeyer's test (`sizeof(long)>4`). However, the code in the patch is exactly the same for both 32- and 64-bit. Is there a recommendation for what to do here? I'm not sufficiently familiar with this to know what to do.


Look at the diff for the old corresponding code: this doesn't have the branch.



---

archive/issue_comments_240257.json:
```json
{
    "body": "<a id='comment:64'></a>I would also recommend you to keep the logic of the old code where applicable. For example, the old code started with\n\n```\nif ch.is_power_of(2):\nexponent = ch.nbits() -1\n    # it seems Singular uses ints somewhere\n    # internally, cf. #6051 (Sage) and #138 (Singular)\n    if exponent <= 30:\n```\nand I see no reason to change this.",
    "created_at": "2015-05-26T06:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240257",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'></a>I would also recommend you to keep the logic of the old code where applicable. For example, the old code started with

```
if ch.is_power_of(2):
exponent = ch.nbits() -1
    # it seems Singular uses ints somewhere
    # internally, cf. #6051 (Sage) and #138 (Singular)
    if exponent <= 30:
```
and I see no reason to change this.



---

archive/issue_comments_240258.json:
```json
{
    "body": "<a id='comment:65'></a>naive rebase.\n\nThe spkg is no longer available from boxen..\n\n---\nNew commits:",
    "created_at": "2015-08-04T12:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240258",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:65'></a>naive rebase.

The spkg is no longer available from boxen..

---
New commits:



---

archive/issue_comments_240259.json:
```json
{
    "body": "<a id='comment:66'></a>> The [singular 4.0.1] spkg is no longer available from boxen..\n\n\nThat is unfortunate. \n`@`jdemeyer/`@`jpflori: could you upload the singular 4.0.1.p1 tarball to somewhere else?\n\n>naive rebase. [by chapoton]\n>Conflicts:\n>\tsrc/sage/libs/singular/singular-cdefs.pxi\n\n\nthe file `src/sage/libs/singular/singular-cdefs.pxi` is even missing in the ticket branch\n`public/ticket/17254` \n\n`@`chapoton\nDid you set the ticket branch to broken `public/ticket/17254` instead of leaving it \n'`u/john_perry/ticket.17254.squashed`' by accident?",
    "created_at": "2015-08-18T09:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240259",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:66'></a>> The [singular 4.0.1] spkg is no longer available from boxen..


That is unfortunate. 
`@`jdemeyer/`@`jpflori: could you upload the singular 4.0.1.p1 tarball to somewhere else?

>naive rebase. [by chapoton]
>Conflicts:
>	src/sage/libs/singular/singular-cdefs.pxi


the file `src/sage/libs/singular/singular-cdefs.pxi` is even missing in the ticket branch
`public/ticket/17254` 

`@`chapoton
Did you set the ticket branch to broken `public/ticket/17254` instead of leaving it 
'`u/john_perry/ticket.17254.squashed`' by accident?



---

archive/issue_comments_240260.json:
```json
{
    "body": "<a id='comment:67'></a>It seems I don't have access to boxen anymore...",
    "created_at": "2015-08-18T09:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240260",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:67'></a>It seems I don't have access to boxen anymore...



---

archive/issue_comments_240261.json:
```json
{
    "body": "<a id='comment:68'></a>And I don't have the `p1` tarball Jeroen posted.",
    "created_at": "2015-08-18T09:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240261",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:68'></a>And I don't have the `p1` tarball Jeroen posted.



---

archive/issue_comments_240262.json:
```json
{
    "body": "<a id='comment:69'></a>I have a tarball answering that description. Up on the lmona.de server....\n\n[http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2](http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2)",
    "created_at": "2015-08-18T10:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240262",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:69'></a>I have a tarball answering that description. Up on the lmona.de server....

[http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2](http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2)



---

archive/issue_comments_240263.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+**Lots** of stuff has changed in Singular 4. But now the attached branch is almost working.\n \n+Repackaged upstream tarball: [http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2](http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2)\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-08-18T22:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240263",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+**Lots** of stuff has changed in Singular 4. But now the attached branch is almost working.
 
+Repackaged upstream tarball: [http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2](http://www.lmona.de/files/sage/singular-4.0.1p1.tar.bz2)
 
 Comment: 1
 
``````




---

archive/issue_comments_240264.json:
```json
{
    "body": "<a id='comment:71'></a>bumped to recent sage dvelopment version.\n\nThe build may fail with 'undefined ..' error again.\nProbably this can be fixed with `./sage -ba`; \nif not, `make distclean`-bazooka should work...\n\n\n---\nNew commits:",
    "created_at": "2015-08-18T23:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240264",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:71'></a>bumped to recent sage dvelopment version.

The build may fail with 'undefined ..' error again.
Probably this can be fixed with `./sage -ba`; 
if not, `make distclean`-bazooka should work...


---
New commits:



---

archive/issue_comments_240265.json:
```json
{
    "body": "<a id='comment:72'></a>`@`chapoton\n\n> naive rebase.\n\n\nexcept for the issue with `src/sage/libs/singular/singular-cdefs.pxi`, how did you do the rebase? \nDid you a rebase by hand, or did you create a patch after merge and then apply the patch to 6.9.b0?",
    "created_at": "2015-08-18T23:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240265",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:72'></a>`@`chapoton

> naive rebase.


except for the issue with `src/sage/libs/singular/singular-cdefs.pxi`, how did you do the rebase? 
Did you a rebase by hand, or did you create a patch after merge and then apply the patch to 6.9.b0?



---

archive/issue_comments_240266.json:
```json
{
    "body": "<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-19T18:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240267.json:
```json
{
    "body": "<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-19T18:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240268.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-19T18:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240269.json:
```json
{
    "body": "<a id='comment:76'></a>`@`john_perry\nthanks for the bugfix!\n\n\n> I am willing to work on this\n\n\nsomehow I overlooked your messages in my emails in the past.Are you still available for help? \nMaybe we could work together on the remaining issues? (skype?)\n\nAn example of creating extension fields can be found in Singulars\n`libpolys/tests/polys_test.h :: test_Q_Ext_a()`)\nwhile the basic data structure idea is sketched in \n`libpolys/polys/ext_fields/algext.h`",
    "created_at": "2015-08-19T20:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240269",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:76'></a>`@`john_perry
thanks for the bugfix!


> I am willing to work on this


somehow I overlooked your messages in my emails in the past.Are you still available for help? 
Maybe we could work together on the remaining issues? (skype?)

An example of creating extension fields can be found in Singulars
`libpolys/tests/polys_test.h :: test_Q_Ext_a()`)
while the basic data structure idea is sketched in 
`libpolys/polys/ext_fields/algext.h`



---

archive/issue_comments_240270.json:
```json
{
    "body": "<a id='comment:77'></a>Replying to [comment:76 jakobkroeker]:\n> `@`john_perry\n> somehow I overlooked your messages in my emails in the past.Are you still available for help? \n> Maybe we could work together on the remaining issues? (skype?)\n\n\nI'm willing to collaborate on it, but I've had a more pressing project which has consumed my attention/free time. I thought I'd be done with it months ago :-) so I can't promise to be very helpful and/or focus on this at the moment, but I do hope to be available from time to time, until the current project passes in which case I could focus on this a little bit.",
    "created_at": "2015-08-20T15:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240270",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:77'></a>Replying to [comment:76 jakobkroeker]:
> `@`john_perry
> somehow I overlooked your messages in my emails in the past.Are you still available for help? 
> Maybe we could work together on the remaining issues? (skype?)


I'm willing to collaborate on it, but I've had a more pressing project which has consumed my attention/free time. I thought I'd be done with it months ago :-) so I can't promise to be very helpful and/or focus on this at the moment, but I do hope to be available from time to time, until the current project passes in which case I could focus on this a little bit.



---

archive/issue_comments_240271.json:
```json
{
    "body": "<a id='comment:78'></a>New commits:",
    "created_at": "2015-08-24T00:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240271",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:78'></a>New commits:



---

archive/issue_comments_240272.json:
```json
{
    "body": "<a id='comment:79'></a>-added support for extensions over QQ; fixed some bugs of mine\n\nopen tasks: \n-put back `si2sa_GFqGivaro, si2sa_GFqNTLGF2E, si2sa_GFq_generic`\n\n-and fix failing tests - a lot of tests (about 100) still fail:\n\n`naMap00()` call in `singular.pyx` crashes - either I use it incorrectly or there is a bug in Singular.",
    "created_at": "2015-08-24T00:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240272",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:79'></a>-added support for extensions over QQ; fixed some bugs of mine

open tasks: 
-put back `si2sa_GFqGivaro, si2sa_GFqNTLGF2E, si2sa_GFq_generic`

-and fix failing tests - a lot of tests (about 100) still fail:

`naMap00()` call in `singular.pyx` crashes - either I use it incorrectly or there is a bug in Singular.



---

archive/issue_comments_240273.json:
```json
{
    "body": "<a id='comment:80'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-24T00:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:80'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240274.json:
```json
{
    "body": "<a id='comment:81'></a>repackaged latest Singular\n\nhttps://www.dropbox.com/s/3io9k5srkcjrysr/singular-4.0.2.latest.tar.bz2?dl=0",
    "created_at": "2015-08-25T12:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240274",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:81'></a>repackaged latest Singular

https://www.dropbox.com/s/3io9k5srkcjrysr/singular-4.0.2.latest.tar.bz2?dl=0



---

archive/issue_comments_240275.json:
```json
{
    "body": "<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-25T12:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240276.json:
```json
{
    "body": "<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-25T12:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240277.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+**Lots** of stuff has changed in Singular 4. But now the attached branch is almost working.\n \n+Repackaged upstream tarball: [https://www.dropbox.com/s/3io9k5srkcjrysr/singular-4.0.2.latest.tar.bz2?dl=0](https://www.dropbox.com/s/3io9k5srkcjrysr/singular-4.0.2.latest.tar.bz2?dl=0)\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-08-27T09:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240277",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+**Lots** of stuff has changed in Singular 4. But now the attached branch is almost working.
 
+Repackaged upstream tarball: [https://www.dropbox.com/s/3io9k5srkcjrysr/singular-4.0.2.latest.tar.bz2?dl=0](https://www.dropbox.com/s/3io9k5srkcjrysr/singular-4.0.2.latest.tar.bz2?dl=0)
 
 Comment: 1
 
``````




---

archive/issue_comments_240278.json:
```json
{
    "body": "<a id='comment:85'></a>`@`malb\n\nwhile upgrading to Singular 4 I'm currently hit a segfault in Singular for \n\n```\nsage: x = var('x')\nsage: K.<z> = QQ.extension(x^2 + 1)\nsage: P.<v,w> = K[]\nsage: P._singular_() \nsage: P(1) # crash\n```\n\nSince I neither familiar enough with the sage interface to Singular nor \nwith Singular internals, I'm currently stuck. Could you take a look?",
    "created_at": "2015-08-27T09:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240278",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:85'></a>`@`malb

while upgrading to Singular 4 I'm currently hit a segfault in Singular for 

```
sage: x = var('x')
sage: K.<z> = QQ.extension(x^2 + 1)
sage: P.<v,w> = K[]
sage: P._singular_() 
sage: P(1) # crash
```

Since I neither familiar enough with the sage interface to Singular nor 
with Singular internals, I'm currently stuck. Could you take a look?



---

archive/issue_comments_240279.json:
```json
{
    "body": "<a id='comment:87'></a>So far, I have no luck even building this. Did you see this before:\n\n```\nImportError: \u2026/sage-review/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so: undefined symbol: _Z17initCanonicalFormv\n```",
    "created_at": "2015-08-27T16:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240279",
    "user": "https://github.com/malb"
}
```

<a id='comment:87'></a>So far, I have no luck even building this. Did you see this before:

```
ImportError: …/sage-review/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so: undefined symbol: _Z17initCanonicalFormv
```



---

archive/issue_comments_240280.json:
```json
{
    "body": "<a id='comment:88'></a>> So far, I have no luck even building this. Did you see this before:\n> ImportError: \u2026/sage-review/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so: undefined symbol: _Z17initCanonicalFormv\n\n\nYes. These are clearly artifacts from singular 3.1.7.\nIn Singular 4  is no 'initCanonicalForm'. \n\nEither this is a caching issue, incorrect dependency issue(in sage/cython)\nor somewhere are files from 3.1.7 left. \nOn which OS do you build singular( See also comment 55 )?\nDid you try 'make distclean'? ( If you have a better solution for this, please share it)",
    "created_at": "2015-08-27T17:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240280",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:88'></a>> So far, I have no luck even building this. Did you see this before:
> ImportError: …/sage-review/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so: undefined symbol: _Z17initCanonicalFormv


Yes. These are clearly artifacts from singular 3.1.7.
In Singular 4  is no 'initCanonicalForm'. 

Either this is a caching issue, incorrect dependency issue(in sage/cython)
or somewhere are files from 3.1.7 left. 
On which OS do you build singular( See also comment 55 )?
Did you try 'make distclean'? ( If you have a better solution for this, please share it)



---

archive/issue_comments_240281.json:
```json
{
    "body": "<a id='comment:89'></a>Replying to [comment:88 jakobkroeker]:\n> Either this is a caching issue, incorrect dependency issue(in sage/cython)\n> or somewhere are files from 3.1.7 left.\n\nIf it is a dependency issue (which looks the most likely), please make a *new ticket* for it.",
    "created_at": "2015-08-27T18:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240281",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:89'></a>Replying to [comment:88 jakobkroeker]:
> Either this is a caching issue, incorrect dependency issue(in sage/cython)
> or somewhere are files from 3.1.7 left.

If it is a dependency issue (which looks the most likely), please make a *new ticket* for it.



---

archive/issue_comments_240282.json:
```json
{
    "body": "<a id='comment:90'></a>Indeed, building from scratch made it go away \u2026 this will be fun to deal with eventually.",
    "created_at": "2015-08-31T11:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240282",
    "user": "https://github.com/malb"
}
```

<a id='comment:90'></a>Indeed, building from scratch made it go away … this will be fun to deal with eventually.



---

archive/issue_comments_240283.json:
```json
{
    "body": "<a id='comment:91'></a>Hi, I have rebuild Singular + Sage extension with SAGE_DEBUG=yes and it seems trouble starts a few lines earlier in your minimal example:\n\n```\nsage: x = var('x')\nsage: K.<z> = QQ.extension(x^2 + 1)\nsage: P.<v,w> = K[]\n***omError_WrongSize: wrong size specification of addr                                                                                                                                                           [677/4609]\n occured at: \n  #0 at ??:0                 in ??                  \n occured for addr:0x7f7c9b303190 size:32 specified size:24\n\n// ***dPolyReportError: memory error \n occured at\n occured for poly: z2+1  addr:0x7f7c9b303190 size:32\n***omError_WrongSize: wrong size specification of addr\n occured at: \n  #0 at ??:0                 in ??                  \n occured for addr:0x7f7c9b303190 size:32 specified size:24\n\n// ***dPolyReportError: memory error \n occured at\n occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598\n!!longrat: NULL in monomials/p_polys.cc:3598\noz2+oz2+...  addr:0x7f7c9b303190 size:32\n***omError_WrongSize: wrong size specification of addr\n occured at: \n  #0 at ??:0                 in ??                  \n occured for addr:0x7f7c9b303190 size:32 specified size:24\n\n// ***dPolyReportError: memory error \n occured at\n occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598\n!!longrat: NULL in monomials/p_polys.cc:3598\noz2+oz2+...  addr:0x7f7c9b303190 size:32\n***omError_WrongSize: wrong size specification of addr\n occured at: \n  #0 at ??:0                 in ??                  \n occured for addr:0x7f7c9b303190 size:32 specified size:24\n\n// ***dPolyReportError: memory error \n occured at\n occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598\n!!longrat: NULL in monomials/p_polys.cc:3598\noz2+oz2+...  addr:0x7f7c9b303190 size:32\n***omError_WrongSize: wrong size specification of addr\n occured at: \n  #0 at ??:0                 in ??                  \n occured for addr:0x7f7c9b303190 size:32 specified size:24\n\n// ***dPolyReportError: memory error \n occured at\n occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598\n!!longrat: NULL in monomials/p_polys.cc:3598\noz2+oz2+...  addr:0x7f7c9b303190 size:32\n```",
    "created_at": "2015-08-31T13:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240283",
    "user": "https://github.com/malb"
}
```

<a id='comment:91'></a>Hi, I have rebuild Singular + Sage extension with SAGE_DEBUG=yes and it seems trouble starts a few lines earlier in your minimal example:

```
sage: x = var('x')
sage: K.<z> = QQ.extension(x^2 + 1)
sage: P.<v,w> = K[]
***omError_WrongSize: wrong size specification of addr                                                                                                                                                           [677/4609]
 occured at: 
  #0 at ??:0                 in ??                  
 occured for addr:0x7f7c9b303190 size:32 specified size:24

// ***dPolyReportError: memory error 
 occured at
 occured for poly: z2+1  addr:0x7f7c9b303190 size:32
***omError_WrongSize: wrong size specification of addr
 occured at: 
  #0 at ??:0                 in ??                  
 occured for addr:0x7f7c9b303190 size:32 specified size:24

// ***dPolyReportError: memory error 
 occured at
 occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598
!!longrat: NULL in monomials/p_polys.cc:3598
oz2+oz2+...  addr:0x7f7c9b303190 size:32
***omError_WrongSize: wrong size specification of addr
 occured at: 
  #0 at ??:0                 in ??                  
 occured for addr:0x7f7c9b303190 size:32 specified size:24

// ***dPolyReportError: memory error 
 occured at
 occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598
!!longrat: NULL in monomials/p_polys.cc:3598
oz2+oz2+...  addr:0x7f7c9b303190 size:32
***omError_WrongSize: wrong size specification of addr
 occured at: 
  #0 at ??:0                 in ??                  
 occured for addr:0x7f7c9b303190 size:32 specified size:24

// ***dPolyReportError: memory error 
 occured at
 occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598
!!longrat: NULL in monomials/p_polys.cc:3598
oz2+oz2+...  addr:0x7f7c9b303190 size:32
***omError_WrongSize: wrong size specification of addr
 occured at: 
  #0 at ??:0                 in ??                  
 occured for addr:0x7f7c9b303190 size:32 specified size:24

// ***dPolyReportError: memory error 
 occured at
 occured for poly: !!longrat: NULL in monomials/p_polys.cc:3598
!!longrat: NULL in monomials/p_polys.cc:3598
oz2+oz2+...  addr:0x7f7c9b303190 size:32
```



---

archive/issue_comments_240284.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:91 malb]:\n> Hi, I have rebuild Singular + Sage extension with SAGE_DEBUG=yes and it seems trouble starts a few lines earlier in your minimal example:\n> \n> \n> ```\n> sage: x = var('x')\n> sage: K.<z> = QQ.extension(x^2 + 1)\n> sage: P.<v,w> = K[]\n> ***omError_WrongSize: wrong size specification of addr [...] \n\n\nDo you know in detail what happens or should happen in sage for \n\n{{{\nsage: P.<v,w> = K[]\nsage: P(1) \n}}}\n\nbehind the scenes? \nWith that information we could ask Singular's developers if we use `libSingular` correctly.",
    "created_at": "2015-09-02T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240284",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:92'></a>Replying to [comment:91 malb]:
> Hi, I have rebuild Singular + Sage extension with SAGE_DEBUG=yes and it seems trouble starts a few lines earlier in your minimal example:
> 
> 
> ```
> sage: x = var('x')
> sage: K.<z> = QQ.extension(x^2 + 1)
> sage: P.<v,w> = K[]
> ***omError_WrongSize: wrong size specification of addr [...] 


Do you know in detail what happens or should happen in sage for 

{{{
sage: P.<v,w> = K[]
sage: P(1) 
}}}

behind the scenes? 
With that information we could ask Singular's developers if we use `libSingular` correctly.



---

archive/issue_comments_240285.json:
```json
{
    "body": "<a id='comment:93'></a>It'll construct a ring for the extension and then a ring in in v, w. I'll try to investigate further what's going wrong there (sorry, I'm being slow on this)",
    "created_at": "2015-09-03T07:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240285",
    "user": "https://github.com/malb"
}
```

<a id='comment:93'></a>It'll construct a ring for the extension and then a ring in in v, w. I'll try to investigate further what's going wrong there (sorry, I'm being slow on this)



---

archive/issue_comments_240286.json:
```json
{
    "body": "<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-09T20:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240287.json:
```json
{
    "body": "<a id='comment:95'></a>Replying to [comment:93 malb]:\n> It'll construct a ring for the extension and then a ring in in v, w. I'll try to investigate further what's going wrong there (sorry, I'm being slow on this)\n\n>\n> trouble starts a few lines earlier in your minimal example:\n\n\nIndeed. With printouts I tracked down the issue to ring creation in \n`src/sage/libs/singular/ring.pyx`\nI guess that I incorrectly assembly the minpoly in ring construction\n(omalloc magic or whatever)\nOr there is an issue with the `AlgExtInfo` declaration or in `nInitChar()` call.\n\nCould you take a look or even fix it?\nSee the corresponding Singular example `test_Q_Ext_a()` in \n`latest/libpolys/tests/polys_test.h`",
    "created_at": "2015-09-09T20:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240287",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:95'></a>Replying to [comment:93 malb]:
> It'll construct a ring for the extension and then a ring in in v, w. I'll try to investigate further what's going wrong there (sorry, I'm being slow on this)

>
> trouble starts a few lines earlier in your minimal example:


Indeed. With printouts I tracked down the issue to ring creation in 
`src/sage/libs/singular/ring.pyx`
I guess that I incorrectly assembly the minpoly in ring construction
(omalloc magic or whatever)
Or there is an issue with the `AlgExtInfo` declaration or in `nInitChar()` call.

Could you take a look or even fix it?
See the corresponding Singular example `test_Q_Ext_a()` in 
`latest/libpolys/tests/polys_test.h`



---

archive/issue_comments_240288.json:
```json
{
    "body": "<a id='comment:97'></a>Replying to [comment:88 jakobkroeker]:\n> > So far, I have no luck even building this. Did you see this before:\n> > ImportError: \u2026/sage-review/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so: undefined symbol: _Z17initCanonicalFormv\n\n> \n> Yes. These are clearly artifacts from singular 3.1.7.\n> In Singular 4  is no 'initCanonicalForm'.\n\n\nThe problem was with the include path containing old files, this is now fixed.\n\n---\nNew commits:",
    "created_at": "2015-09-10T12:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240288",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:97'></a>Replying to [comment:88 jakobkroeker]:
> > So far, I have no luck even building this. Did you see this before:
> > ImportError: …/sage-review/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so: undefined symbol: _Z17initCanonicalFormv

> 
> Yes. These are clearly artifacts from singular 3.1.7.
> In Singular 4  is no 'initCanonicalForm'.


The problem was with the include path containing old files, this is now fixed.

---
New commits:



---

archive/issue_comments_240289.json:
```json
{
    "body": "<a id='comment:98'></a>Any progress Martin?\nI'll rebuild a debug version of Sage and give it a try as well in the next few days.",
    "created_at": "2015-10-06T09:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240289",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:98'></a>Any progress Martin?
I'll rebuild a debug version of Sage and give it a try as well in the next few days.



---

archive/issue_comments_240290.json:
```json
{
    "body": "<a id='comment:0'></a>I looked a little bit into the problem and from what I see when the multivariate gets created the first thing done is to create the number field in Singular.\nJust after the number field creation, the first memory error Singular complains about is related to the polynomial defining the number field, so I would say the number field creation already went wrong (or the number field is wrongly used once created).",
    "created_at": "2015-10-08T16:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240290",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>I looked a little bit into the problem and from what I see when the multivariate gets created the first thing done is to create the number field in Singular.
Just after the number field creation, the first memory error Singular complains about is related to the polynomial defining the number field, so I would say the number field creation already went wrong (or the number field is wrongly used once created).



---

archive/issue_comments_240291.json:
```json
{
    "body": "<a id='comment:1'></a>Here is the backtrace of the first error reporting:\n\n```\n(gdb) bt\n#0  omReportError (error=omError_WrongSize, report_error=omError_NoError,\n    r=0x3fffa170be00 <omTestBinAddrSize+68>, fmt=0x3fffa171bd80 \"\")\n    at omError.c:83\n#1  0x00003fffa17120b0 in omReportAddrError (error=omError_WrongSize,\n    report_error=omError_NoError, addr=0x3fffa13001f0, bin_size=0x18,\n    flags=262, r=0x3fffa170be00 <omTestBinAddrSize+68>, fmt=0x3fffa171bd80 \"\")\n    at omDebugCheck.c:409\n#2  0x00003fffa1710d5c in omDoCheckBinAddr (addr=0x3fffa13001f0,\n    bin_size=0x18, flags=262, level=1 '\\001', report=omError_NoError,\n    r=0x3fffa170be00 <omTestBinAddrSize+68>) at omDebugCheck.c:211\n#3  0x00003fffa17108b8 in omDoCheckAddr (addr=0x3fffa13001f0, bin_size=0x18,\n    flags=262, level=1 '\\001', report=omError_NoError,\n    r=0x3fffa170be00 <omTestBinAddrSize+68>) at omDebugCheck.c:169\n#4  0x00003fffa170fd2c in _omCheckAddr (addr=0x3fffa13001f0, size_bin=0x18,\n    flags=262, check=1 '\\001', report=omError_NoError,\n    r=0x3fffa170be00 <omTestBinAddrSize+68>) at omDebugCheck.c:46\n#5  0x00003fffa170cd8c in _omDebugAddr (addr=0x3fffa13001f0, bin_size=0x18,\n    flags=258, check=1 '\\001') at omDebug.c:283\n#6  0x00003fffa170be00 in omTestBinAddrSize (addr=0x3fffa13001f0, size=24, \n    check_level=1) at omDebug.c:46\n#7  0x00003fffa1b64c14 in _p_Test (p=0x3fffa13001f0, r=0x3fffa13344d0, level=0)\n    at pDebug.cc:223\n#8  0x00003fffa1c1fcd0 in naInitChar (cf=0x3fffa131c9a8, \n    infoStruct=0x3fffffff9240) at ext_fields/algext.cc:1419\n#9  0x00003fffa1c5b114 in nInitChar (t=n_algExt, parameter=0x3fffffff9240)\n    at numbers.cc:385\n#10 0x00003fffa0f81758 in __pyx_f_4sage_4libs_8singular_4ring_singular_ring_new\n...\n}",
    "created_at": "2015-10-08T16:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240291",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>Here is the backtrace of the first error reporting:

```
(gdb) bt
#0  omReportError (error=omError_WrongSize, report_error=omError_NoError,
    r=0x3fffa170be00 <omTestBinAddrSize+68>, fmt=0x3fffa171bd80 "")
    at omError.c:83
#1  0x00003fffa17120b0 in omReportAddrError (error=omError_WrongSize,
    report_error=omError_NoError, addr=0x3fffa13001f0, bin_size=0x18,
    flags=262, r=0x3fffa170be00 <omTestBinAddrSize+68>, fmt=0x3fffa171bd80 "")
    at omDebugCheck.c:409
#2  0x00003fffa1710d5c in omDoCheckBinAddr (addr=0x3fffa13001f0,
    bin_size=0x18, flags=262, level=1 '\001', report=omError_NoError,
    r=0x3fffa170be00 <omTestBinAddrSize+68>) at omDebugCheck.c:211
#3  0x00003fffa17108b8 in omDoCheckAddr (addr=0x3fffa13001f0, bin_size=0x18,
    flags=262, level=1 '\001', report=omError_NoError,
    r=0x3fffa170be00 <omTestBinAddrSize+68>) at omDebugCheck.c:169
#4  0x00003fffa170fd2c in _omCheckAddr (addr=0x3fffa13001f0, size_bin=0x18,
    flags=262, check=1 '\001', report=omError_NoError,
    r=0x3fffa170be00 <omTestBinAddrSize+68>) at omDebugCheck.c:46
#5  0x00003fffa170cd8c in _omDebugAddr (addr=0x3fffa13001f0, bin_size=0x18,
    flags=258, check=1 '\001') at omDebug.c:283
#6  0x00003fffa170be00 in omTestBinAddrSize (addr=0x3fffa13001f0, size=24, 
    check_level=1) at omDebug.c:46
#7  0x00003fffa1b64c14 in _p_Test (p=0x3fffa13001f0, r=0x3fffa13344d0, level=0)
    at pDebug.cc:223
#8  0x00003fffa1c1fcd0 in naInitChar (cf=0x3fffa131c9a8, 
    infoStruct=0x3fffffff9240) at ext_fields/algext.cc:1419
#9  0x00003fffa1c5b114 in nInitChar (t=n_algExt, parameter=0x3fffffff9240)
    at numbers.cc:385
#10 0x00003fffa0f81758 in __pyx_f_4sage_4libs_8singular_4ring_singular_ring_new
...
}



---

archive/issue_comments_240292.json:
```json
{
    "body": "<a id='comment:2'></a>And of the second one:\n\n```\n(gdb) bt\n#0  dPolyReportError (p=0x3fffa13001f0, r=0x3fffa13344d0,\n    fmt=0x3fffa1cb5140 \"%s \") at pDebug.cc:46\n#1  0x00003fffa1b64c54 in _p_Test (p=0x3fffa13001f0, r=0x3fffa13344d0, level=0)\n    at pDebug.cc:223\n#2  0x00003fffa1c1fcd0 in naInitChar (cf=0x3fffa131c9a8,\n    infoStruct=0x3fffffff9240) at ext_fields/algext.cc:1419\n#3  0x00003fffa1c5b114 in nInitChar (t=n_algExt, parameter=0x3fffffff9240)\n    at numbers.cc:385\n#4  0x00003fffa0f81758 in __pyx_f_4sage_4libs_8singular_4ring_singular_ring_new\n...\n}",
    "created_at": "2015-10-08T16:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240292",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>And of the second one:

```
(gdb) bt
#0  dPolyReportError (p=0x3fffa13001f0, r=0x3fffa13344d0,
    fmt=0x3fffa1cb5140 "%s ") at pDebug.cc:46
#1  0x00003fffa1b64c54 in _p_Test (p=0x3fffa13001f0, r=0x3fffa13344d0, level=0)
    at pDebug.cc:223
#2  0x00003fffa1c1fcd0 in naInitChar (cf=0x3fffa131c9a8,
    infoStruct=0x3fffffff9240) at ext_fields/algext.cc:1419
#3  0x00003fffa1c5b114 in nInitChar (t=n_algExt, parameter=0x3fffffff9240)
    at numbers.cc:385
#4  0x00003fffa0f81758 in __pyx_f_4sage_4libs_8singular_4ring_singular_ring_new
...
}



---

archive/issue_comments_240293.json:
```json
{
    "body": "<a id='comment:3'></a>Some pointers, I have to quit now and tomorrow I'll have forgotten everything:\n* https://github.com/hannes14/Singular/blob/master/HOWTO-libsingular\n* https://github.com/wbhart/Nemo.jl/wiki/Accessing-Singular-from-Julia",
    "created_at": "2015-10-08T17:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240293",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>Some pointers, I have to quit now and tomorrow I'll have forgotten everything:
* https://github.com/hannes14/Singular/blob/master/HOWTO-libsingular
* https://github.com/wbhart/Nemo.jl/wiki/Accessing-Singular-from-Julia



---

archive/issue_comments_240294.json:
```json
{
    "body": "<a id='comment:4'></a>Got a suggestion from Hannes:\n* https://groups.google.com/d/msg/libsingular-devel/4JRHxVXIF70/r4aXry32BQAJ\n\nAdditional issue:\n* we should clean up old headers when upgrading.",
    "created_at": "2015-10-09T12:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240294",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Got a suggestion from Hannes:
* https://groups.google.com/d/msg/libsingular-devel/4JRHxVXIF70/r4aXry32BQAJ

Additional issue:
* we should clean up old headers when upgrading.



---

archive/issue_comments_240295.json:
```json
{
    "body": "<a id='comment:5'></a>The above suggestion fixes the problem.",
    "created_at": "2015-10-09T13:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240295",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>The above suggestion fixes the problem.



---

archive/issue_comments_240296.json:
```json
{
    "body": "<a id='comment:6'></a>I still get a bunch of crashes/errors when testing `sage/libs/singular`, working on it.",
    "created_at": "2015-10-09T13:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240296",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>I still get a bunch of crashes/errors when testing `sage/libs/singular`, working on it.



---

archive/issue_comments_240297.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-09T14:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240298.json:
```json
{
    "body": "<a id='comment:8'></a>> I still get a bunch of crashes/errors when testing sage/libs/singular, working on it.\n\n\nI was able to fix the issue with `naSetMap()` and `nlInit2gmp()` usage in `sa2si_NF()`)\nand this reduces the number of segfaults significantly\nThe example \n\n```\nsage: x = var('x')\nsage: K.<z> = QQ.extension(x^2 + 1)\nsage: P.<v,w> = K[]\nsage: P._singular_() \nsage: P(2/3) \n```\ndoes not crash any more!\n\nA remaining task is to reuse the plain polynomial ring `qqr = QQ['x']` over Q in \n`sa2si_NF()` instead of rebuilding it everytime. (variable name is irrelevant)\n\n\n.\n.\nNext interesting riddle in `sa2si_ZZmod()`; simple failing example:\n\n```\nsage: sage: R.<a> = Zmod(5)['a', 'b']  \nsage: R(1) #crash\n```\n\n---\nNew commits:",
    "created_at": "2015-10-10T17:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240298",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:8'></a>> I still get a bunch of crashes/errors when testing sage/libs/singular, working on it.


I was able to fix the issue with `naSetMap()` and `nlInit2gmp()` usage in `sa2si_NF()`)
and this reduces the number of segfaults significantly
The example 

```
sage: x = var('x')
sage: K.<z> = QQ.extension(x^2 + 1)
sage: P.<v,w> = K[]
sage: P._singular_() 
sage: P(2/3) 
```
does not crash any more!

A remaining task is to reuse the plain polynomial ring `qqr = QQ['x']` over Q in 
`sa2si_NF()` instead of rebuilding it everytime. (variable name is irrelevant)


.
.
Next interesting riddle in `sa2si_ZZmod()`; simple failing example:

```
sage: sage: R.<a> = Zmod(5)['a', 'b']  
sage: R(1) #crash
```

---
New commits:



---

archive/issue_comments_240299.json:
```json
{
    "body": "<a id='comment:9'></a>New commits:",
    "created_at": "2015-11-10T21:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240299",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>New commits:



---

archive/issue_comments_240300.json:
```json
{
    "body": "<a id='comment:0'></a>The segfault is due to a division by zero (happening in gmp which aborts I guess):\n\n```\n#0  0x00003fffadbeaf28 in __gmpz_mod (rem=0x3fffa03ce230,\n    dividend=0x3fffa03ce220, divisor=0x0) at mod.c:29\n#1  0x00003fffa0d1558c in nrnMapGMP (from=0x3fffa03ce220, dst=0x3fffa03bc9a8)\n    at rmodulon.cc:766\n#2  0x00003fffa0d1561c in nrnMapZ (from=0x3fffa03ce220, src=0x3fffa03bc680,\n    dst=0x3fffa03bc9a8) at rmodulon.cc:790\n#3  0x00003fffa014903c in __pyx_f_4sage_4libs_8singular_8singular_sa2si_ZZmod (\n    __pyx_v_d=0x3fff986212e0, __pyx_v__ring=0x3fffa03d43a8)\n```\n\nI guess the ring is wrongly initialized.",
    "created_at": "2015-11-10T22:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240300",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>The segfault is due to a division by zero (happening in gmp which aborts I guess):

```
#0  0x00003fffadbeaf28 in __gmpz_mod (rem=0x3fffa03ce230,
    dividend=0x3fffa03ce220, divisor=0x0) at mod.c:29
#1  0x00003fffa0d1558c in nrnMapGMP (from=0x3fffa03ce220, dst=0x3fffa03bc9a8)
    at rmodulon.cc:766
#2  0x00003fffa0d1561c in nrnMapZ (from=0x3fffa03ce220, src=0x3fffa03bc680,
    dst=0x3fffa03bc9a8) at rmodulon.cc:790
#3  0x00003fffa014903c in __pyx_f_4sage_4libs_8singular_8singular_sa2si_ZZmod (
    __pyx_v_d=0x3fff986212e0, __pyx_v__ring=0x3fffa03d43a8)
```

I guess the ring is wrongly initialized.



---

archive/issue_comments_240301.json:
```json
{
    "body": "<a id='comment:1'></a>Note that the same thing works when `5` is replaced by anything non-prime.\nAnd indeed during ring creation the former is caught at the beginning of the method in `sage/libs/singular/ring.pyx` as `field`, `finite` and `prime` whereas the latter is caught as `integer_mod_ring`.",
    "created_at": "2015-11-10T22:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240301",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>Note that the same thing works when `5` is replaced by anything non-prime.
And indeed during ring creation the former is caught at the beginning of the method in `sage/libs/singular/ring.pyx` as `field`, `finite` and `prime` whereas the latter is caught as `integer_mod_ring`.



---

archive/issue_comments_240302.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-10T23:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240302",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240303.json:
```json
{
    "body": "<a id='comment:3'></a>Why does this branch change `build/bin/sage-spkg`???",
    "created_at": "2015-11-10T23:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240303",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Why does this branch change `build/bin/sage-spkg`???



---

archive/issue_comments_240304.json:
```json
{
    "body": "<a id='comment:4'></a>No idea, mistake from me surely...",
    "created_at": "2015-11-11T00:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240304",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>No idea, mistake from me surely...



---

archive/issue_comments_240305.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T00:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240306.json:
```json
{
    "body": "<a id='comment:6'></a>Ok the issue is indeed a mix between `Zmod` and `GF`.\nThe ring was initially created in singular as a \"finite field\" but then for some reason the conversion is made as for a \"modular integer\".\nThe former one uses `int`s whereas the second one uses `mpz`s.",
    "created_at": "2015-11-11T00:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240306",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Ok the issue is indeed a mix between `Zmod` and `GF`.
The ring was initially created in singular as a "finite field" but then for some reason the conversion is made as for a "modular integer".
The former one uses `int`s whereas the second one uses `mpz`s.



---

archive/issue_comments_240307.json:
```json
{
    "body": "<a id='comment:7'></a>I've not checked but I guess the reason is as follow:\n* to create the singular ring we ask if the base ring is a prime finite field, not if it's a class derived from `FiniteField`, so classes derived from `IntegerModRing` are caught,\n* when sending something into the ring we follow the \"classes\" logic, boom.",
    "created_at": "2015-11-11T00:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240307",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>I've not checked but I guess the reason is as follow:
* to create the singular ring we ask if the base ring is a prime finite field, not if it's a class derived from `FiniteField`, so classes derived from `IntegerModRing` are caught,
* when sending something into the ring we follow the "classes" logic, boom.



---

archive/issue_comments_240308.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T00:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240309.json:
```json
{
    "body": "<a id='comment:9'></a>Ok next issue:\n`napoly` and `slnumber` do not exist anymore, seemingly since a long time...",
    "created_at": "2015-11-11T01:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240309",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Ok next issue:
`napoly` and `slnumber` do not exist anymore, seemingly since a long time...



---

archive/issue_comments_240310.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T02:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240310",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240311.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T20:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240311",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_049904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-11T20:10:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49904"
}
```



---

archive/issue_comments_240312.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T20:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240313.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2015-11-11T22:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240313",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_240314.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T00:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240315.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T03:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240316.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T03:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240317.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T03:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240318.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T03:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240319.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T18:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240320.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T19:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240321.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2015-11-13T00:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240321",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_240322.json:
```json
{
    "body": "<a id='comment:5'></a>Strange way to deal with floats accuracy, see:\nhttps://groups.google.com/forum/#!topic/libsingular-devel/kj3KlcrcNo8\n\nNow looking into the weighted degree issue.\n\n---\nNew commits:",
    "created_at": "2015-11-13T00:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240322",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Strange way to deal with floats accuracy, see:
https://groups.google.com/forum/#!topic/libsingular-devel/kj3KlcrcNo8

Now looking into the weighted degree issue.

---
New commits:



---

archive/issue_comments_240323.json:
```json
{
    "body": "<a id='comment:6'></a>Note for myself: the issue is that at some point r->pFDeg gets replaced from p_WTotalDegree by p_TotalDegree. Don't know why yet.",
    "created_at": "2015-11-13T06:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240323",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Note for myself: the issue is that at some point r->pFDeg gets replaced from p_WTotalDegree by p_TotalDegree. Don't know why yet.



---

archive/issue_comments_240324.json:
```json
{
    "body": "<a id='comment:7'></a>This is triggered here:\n\n```\n  if ((r->pFDeg==p_WTotaldegree) && rOrd_is_MixedDegree_Ordering(r))\n    r->pFDeg = p_Totaldegree;\n```\nline 3837/8 of `ring.cc`.",
    "created_at": "2015-11-13T07:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240324",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>This is triggered here:

```
  if ((r->pFDeg==p_WTotaldegree) && rOrd_is_MixedDegree_Ordering(r))
    r->pFDeg = p_Totaldegree;
```
line 3837/8 of `ring.cc`.



---

archive/issue_comments_240325.json:
```json
{
    "body": "<a id='comment:8'></a>Made by:\n* https://github.com/Singular/Sources/commit/d711b46eb29f241f3854ae99e8451d3beb7f96e4\n\nMaybe the 0 in the weights makes think Singular the order is useless.",
    "created_at": "2015-11-13T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240325",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>Made by:
* https://github.com/Singular/Sources/commit/d711b46eb29f241f3854ae99e8451d3beb7f96e4

Maybe the 0 in the weights makes think Singular the order is useless.



---

archive/issue_comments_240326.json:
```json
{
    "body": "<a id='comment:9'></a>Question to upstream here:\n* https://groups.google.com/forum/?fromgroups=#!topic/libsingular-devel/jregxl-k8Mw",
    "created_at": "2015-11-13T20:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240326",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Question to upstream here:
* https://groups.google.com/forum/?fromgroups=#!topic/libsingular-devel/jregxl-k8Mw



---

archive/issue_comments_240327.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-17T14:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240328.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-17T15:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240329.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-02T16:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240330.json:
```json
{
    "body": "<a id='comment:143'></a>Replying to [comment:142 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                          |                                  |\n> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n> |[7b5bb32](http://git.sagemath.org/sage.git/commit/?id=7b5bb325da3e5f7816aa93dd38c8e8bc90962e49)|`Use correct function for degree.`|\n\n\nI get the following errors for the last change:\n\n```\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n    deg = 0\n    if p == NULL:\n        return -1\n    if(r != currRing): rChangeCurrRing(r)\n    if x == NULL:\n       return r.pDeg(p,&deg,r)\n              ^\n------------------------------------------------------------\n\nsage/libs/singular/polynomial.pyx:534:15: Object of type 'ring' has no attribute 'pDeg'\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n    deg = 0\n    if p == NULL:\n        return -1\n    if(r != currRing): rChangeCurrRing(r)\n    if x == NULL:\n       return r.pDeg(p,&deg,r)\n                      ^\n------------------------------------------------------------\n\nsage/libs/singular/polynomial.pyx:534:23: Cannot convert 'poly *' to Python object\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n    deg = 0\n    if p == NULL:\n        return -1\n    if(r != currRing): rChangeCurrRing(r)\n    if x == NULL:\n       return r.pDeg(p,&deg,r)\n                       ^\n------------------------------------------------------------\n\nsage/libs/singular/polynomial.pyx:534:24: Cannot convert 'int *' to Python object\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n    deg = 0\n    if p == NULL:\n        return -1\n    if(r != currRing): rChangeCurrRing(r)\n    if x == NULL:\n       return r.pDeg(p,&deg,r)\n                             ^\n```",
    "created_at": "2015-12-23T18:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240330",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:143'></a>Replying to [comment:142 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                          |                                  |
> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
> |[7b5bb32](http://git.sagemath.org/sage.git/commit/?id=7b5bb325da3e5f7816aa93dd38c8e8bc90962e49)|`Use correct function for degree.`|


I get the following errors for the last change:

```

Error compiling Cython file:
------------------------------------------------------------
...
    deg = 0
    if p == NULL:
        return -1
    if(r != currRing): rChangeCurrRing(r)
    if x == NULL:
       return r.pDeg(p,&deg,r)
              ^
------------------------------------------------------------

sage/libs/singular/polynomial.pyx:534:15: Object of type 'ring' has no attribute 'pDeg'

Error compiling Cython file:
------------------------------------------------------------
...
    deg = 0
    if p == NULL:
        return -1
    if(r != currRing): rChangeCurrRing(r)
    if x == NULL:
       return r.pDeg(p,&deg,r)
                      ^
------------------------------------------------------------

sage/libs/singular/polynomial.pyx:534:23: Cannot convert 'poly *' to Python object

Error compiling Cython file:
------------------------------------------------------------
...
    deg = 0
    if p == NULL:
        return -1
    if(r != currRing): rChangeCurrRing(r)
    if x == NULL:
       return r.pDeg(p,&deg,r)
                       ^
------------------------------------------------------------

sage/libs/singular/polynomial.pyx:534:24: Cannot convert 'int *' to Python object

Error compiling Cython file:
------------------------------------------------------------
...
    deg = 0
    if p == NULL:
        return -1
    if(r != currRing): rChangeCurrRing(r)
    if x == NULL:
       return r.pDeg(p,&deg,r)
                             ^
```



---

archive/issue_comments_240331.json:
```json
{
    "body": "<a id='comment:4'></a>Yes I guess I made a typo and forgot to push the latest commit.",
    "created_at": "2015-12-24T16:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240331",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Yes I guess I made a typo and forgot to push the latest commit.



---

archive/issue_comments_240332.json:
```json
{
    "body": "<a id='comment:5'></a>Or forgot to add the function prototype.",
    "created_at": "2015-12-24T16:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240332",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Or forgot to add the function prototype.



---

archive/issue_comments_240333.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-24T16:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240333",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240334.json:
```json
{
    "body": "<a id='comment:7'></a>Hopefully better now although I did not test the fix.\n\nFrom what I remember the next issue was a segfault when letterplace stuff elements were multiplied.",
    "created_at": "2015-12-24T16:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240334",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>Hopefully better now although I did not test the fix.

From what I remember the next issue was a segfault when letterplace stuff elements were multiplied.



---

archive/issue_comments_240335.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-24T21:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240336.json:
```json
{
    "body": "<a id='comment:9'></a>Problem with letterplace algebra:\n\n```\nsage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')\nsage: x**2\nsage: x**2\nsage: x**2\n```",
    "created_at": "2015-12-24T21:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240336",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Problem with letterplace algebra:

```
sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')
sage: x**2
sage: x**2
sage: x**2
```



---

archive/issue_comments_240337.json:
```json
{
    "body": "<a id='comment:0'></a>I seem to remember there was a double free.",
    "created_at": "2015-12-24T21:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240337",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>I seem to remember there was a double free.



---

archive/issue_comments_240338.json:
```json
{
    "body": "<a id='comment:1'></a>Did you manage to build the branch and reproduce the letterplace error?",
    "created_at": "2016-01-05T14:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240338",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>Did you manage to build the branch and reproduce the letterplace error?



---

archive/issue_comments_240339.json:
```json
{
    "body": "<a id='comment:2'></a>I rebased the branch (as best as I could), and I did get an error with letterplace:\n\n```\nsage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')\nsage: x**2\n0\n```\nI am also getting a variety of failures in testing the `rings/polynomial` folder, but most of them seem to be related to constructing ideals. I haven't run tests elsewhere.\n\n---\nNew commits:",
    "created_at": "2016-03-13T04:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240339",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>I rebased the branch (as best as I could), and I did get an error with letterplace:

```
sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')
sage: x**2
0
```
I am also getting a variety of failures in testing the `rings/polynomial` folder, but most of them seem to be related to constructing ideals. I haven't run tests elsewhere.

---
New commits:



---

archive/issue_events_049905.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-13T04:53:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49905"
}
```



---

archive/issue_events_049906.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-13T04:53:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49906"
}
```



---

archive/issue_comments_240340.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-13T09:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240341.json:
```json
{
    "body": "<a id='comment:154'></a>Replying to [comment:149 jpflori]:\n> Problem with letterplace algebra:\n> \n> ```\n> sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')\n> sage: x**2\n> sage: x**2\n> sage: x**2\n> ```\n\n\nwhen I compile the recent 'u/jpflori/ticket/17254' or 'u/tscrim/upgrade_singular-17254' with SAGE_DEBUG=yes on my 32 bit fedora22\n\n```\n  export SAGE_DEBUG=yes\n  ./sage -f singular\n```\nI get an printout from Singular:\n\n```\n  pmLPshift: too big shift requested\n```\n\nthe corresponding Singular source snippet is (look at 'shiftgb.cc')\n\n```\n if (L+sh-1 > uptodeg)\n  {\n#ifdef PDEBUG\n    PrintS(\"pmLPshift: too big shift requested\\n\");\n#endif\n    return(NULL); /* violation, 2check */\n  }\n```\nThis seems to be a bug, but the next question is, why do we get there and is this \nan error caused by a previous one or not.",
    "created_at": "2016-05-10T23:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240341",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:154'></a>Replying to [comment:149 jpflori]:
> Problem with letterplace algebra:
> 
> ```
> sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')
> sage: x**2
> sage: x**2
> sage: x**2
> ```


when I compile the recent 'u/jpflori/ticket/17254' or 'u/tscrim/upgrade_singular-17254' with SAGE_DEBUG=yes on my 32 bit fedora22

```
  export SAGE_DEBUG=yes
  ./sage -f singular
```
I get an printout from Singular:

```
  pmLPshift: too big shift requested
```

the corresponding Singular source snippet is (look at 'shiftgb.cc')

```
 if (L+sh-1 > uptodeg)
  {
#ifdef PDEBUG
    PrintS("pmLPshift: too big shift requested\n");
#endif
    return(NULL); /* violation, 2check */
  }
```
This seems to be a bug, but the next question is, why do we get there and is this 
an error caused by a previous one or not.



---

archive/issue_comments_240342.json:
```json
{
    "body": "<a id='comment:5'></a>remaining failing tests (probably not all related to Singular):\n\n```\n./sage -t src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort\n./sage -t src/sage/schemes/affine/affine_point.py  # Killed due to segmentation fault\n./sage -t src/sage/schemes/affine/affine_morphism.py  # Killed due to segmentation fault\n./sage -t src/sage/schemes/generic/algebraic_scheme.py  # Killed due to segmentation fault\n./sage -t src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Killed due to abort\n./sage -t src/sage/libs/cremona/newforms.pyx  # IOError in doctesting framework\n./sage -t src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Bad exit: 14\n./sage -t src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Timed out (and interrupt failed)\n./sage -t src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault\n./sage -t src/sage/rings/polynomial/multi_polynomial_ideal.py  # Killed due to segmentation fault\n./sage -t src/sage/rings/polynomial/pbori.pyx  # 7 doctests failed\n./sage -t src/sage/schemes/projective/projective_morphism.py  # 9 doctests failed\n./sage -t src/sage/rings/polynomial/polynomial_element.pyx  # 1 doctest failed\n./sage -t src/sage/rings/polynomial/plural.pyx  # 6 doctests failed\n./sage -t src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed\n./sage -t src/sage/schemes/plane_curves/projective_curve.py  # 1 doctest failed\n./sage -t src/sage/rings/polynomial/polynomial_singular_interface.py  # 1 doctest failed\n./sage -t src/sage/rings/number_field/number_field_ideal.py  # 2 doctests failed\n./sage -t src/sage/modular/modform_hecketriangle/abstract_space.py  # 1 doctest failed\n./sage -t src/sage/rings/polynomial/infinite_polynomial_element.py  # 4 doctests failed\n./sage -t src/sage/rings/finite_rings/finite_field_ext_pari.py  # 1 doctest failed\n./sage -t src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed\n./sage -t src/sage/graphs/generic_graph.py  # 1 doctest failed\n./sage -t src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed\n./sage -t src/sage/rings/finite_rings/finite_field_givaro.py  # 1 doctest failed\n./sage -t src/sage/algebras/free_algebra.py  # 12 doctests failed\n./sage -t src/sage/rings/multi_power_series_ring_element.py  # 5 doctests failed\n./sage -t src/sage/rings/polynomial/infinite_polynomial_ring.py  # 1 doctest failed\n./sage -t src/sage/graphs/base/graph_backends.pyx  # 4 doctests failed\n./sage -t src/sage/symbolic/relation.py  # 7 doctests failed\n./sage -t src/sage/interfaces/singular.py  # 5 doctests failed\n./sage -t src/sage/rings/quotient_ring_element.py  # 1 doctest failed\n./sage -t src/sage/structure/element.pyx  # 1 doctest failed\n./sage -t src/sage/schemes/product_projective/wehlerK3.py  # 17 doctests failed\n./sage -t src/sage/categories/pushout.py  # 1 doctest failed\n./sage -t src/sage/rings/quotient_ring.py  # 12 doctests failed\n./sage -t src/sage/structure/sage_object.pyx  # 1 doctest failed\n```",
    "created_at": "2016-05-10T23:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240342",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:5'></a>remaining failing tests (probably not all related to Singular):

```
./sage -t src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort
./sage -t src/sage/schemes/affine/affine_point.py  # Killed due to segmentation fault
./sage -t src/sage/schemes/affine/affine_morphism.py  # Killed due to segmentation fault
./sage -t src/sage/schemes/generic/algebraic_scheme.py  # Killed due to segmentation fault
./sage -t src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Killed due to abort
./sage -t src/sage/libs/cremona/newforms.pyx  # IOError in doctesting framework
./sage -t src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Bad exit: 14
./sage -t src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Timed out (and interrupt failed)
./sage -t src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault
./sage -t src/sage/rings/polynomial/multi_polynomial_ideal.py  # Killed due to segmentation fault
./sage -t src/sage/rings/polynomial/pbori.pyx  # 7 doctests failed
./sage -t src/sage/schemes/projective/projective_morphism.py  # 9 doctests failed
./sage -t src/sage/rings/polynomial/polynomial_element.pyx  # 1 doctest failed
./sage -t src/sage/rings/polynomial/plural.pyx  # 6 doctests failed
./sage -t src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed
./sage -t src/sage/schemes/plane_curves/projective_curve.py  # 1 doctest failed
./sage -t src/sage/rings/polynomial/polynomial_singular_interface.py  # 1 doctest failed
./sage -t src/sage/rings/number_field/number_field_ideal.py  # 2 doctests failed
./sage -t src/sage/modular/modform_hecketriangle/abstract_space.py  # 1 doctest failed
./sage -t src/sage/rings/polynomial/infinite_polynomial_element.py  # 4 doctests failed
./sage -t src/sage/rings/finite_rings/finite_field_ext_pari.py  # 1 doctest failed
./sage -t src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed
./sage -t src/sage/graphs/generic_graph.py  # 1 doctest failed
./sage -t src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed
./sage -t src/sage/rings/finite_rings/finite_field_givaro.py  # 1 doctest failed
./sage -t src/sage/algebras/free_algebra.py  # 12 doctests failed
./sage -t src/sage/rings/multi_power_series_ring_element.py  # 5 doctests failed
./sage -t src/sage/rings/polynomial/infinite_polynomial_ring.py  # 1 doctest failed
./sage -t src/sage/graphs/base/graph_backends.pyx  # 4 doctests failed
./sage -t src/sage/symbolic/relation.py  # 7 doctests failed
./sage -t src/sage/interfaces/singular.py  # 5 doctests failed
./sage -t src/sage/rings/quotient_ring_element.py  # 1 doctest failed
./sage -t src/sage/structure/element.pyx  # 1 doctest failed
./sage -t src/sage/schemes/product_projective/wehlerK3.py  # 17 doctests failed
./sage -t src/sage/categories/pushout.py  # 1 doctest failed
./sage -t src/sage/rings/quotient_ring.py  # 12 doctests failed
./sage -t src/sage/structure/sage_object.pyx  # 1 doctest failed
```



---

archive/issue_comments_240343.json:
```json
{
    "body": "<a id='comment:6'></a>`@`jpflori\n\nwhen using 'r.pLDeg()' instead of 'p_Deg()' in 'singular_polynomial_deg()'  (src/sage/libs/singular/polynomial.pyx)\n\n\nsome test from above pass, for example:\n\n```\n./sage -t src/sage/schemes/affine/affine_point.py \n./sage -t src/sage/schemes/affine/affine_morphism.py \n./sage -t src/sage/rings/polynomial/pbori.pyx  \n./sage -t  src/sage/rings/polynomial/infinite_polynomial_element.py\n```\nespecially some segfaults disappear but then probably other passing tests get broken?\n\nWhich example did you have in mind when you changed 'r.pLDeg()' to 'p_Deg()' in \n'singular_polynomial_deg()'  (src/sage/libs/singular/polynomial.pyx)?\n\nMaybe we should discuss with Hans his commit in case it breaks something\n\nhttps://groups.google.com/forum/#!topic/libsingular-devel/jregxl-k8Mw",
    "created_at": "2016-05-12T00:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240343",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:6'></a>`@`jpflori

when using 'r.pLDeg()' instead of 'p_Deg()' in 'singular_polynomial_deg()'  (src/sage/libs/singular/polynomial.pyx)


some test from above pass, for example:

```
./sage -t src/sage/schemes/affine/affine_point.py 
./sage -t src/sage/schemes/affine/affine_morphism.py 
./sage -t src/sage/rings/polynomial/pbori.pyx  
./sage -t  src/sage/rings/polynomial/infinite_polynomial_element.py
```
especially some segfaults disappear but then probably other passing tests get broken?

Which example did you have in mind when you changed 'r.pLDeg()' to 'p_Deg()' in 
'singular_polynomial_deg()'  (src/sage/libs/singular/polynomial.pyx)?

Maybe we should discuss with Hans his commit in case it breaks something

https://groups.google.com/forum/#!topic/libsingular-devel/jregxl-k8Mw



---

archive/issue_comments_240344.json:
```json
{
    "body": "<a id='comment:7'></a>The `plDeg` function is a Singular internal function, made for ecart, and has some restrictions regarding the ordering it can be applied to (no negative weights or things like that).\nIt gets constructed by Singular at initialization of the object from `p_Deg`.\n\nWhat we want in Sage is the \"usual\" degree which is `p_Deg`.\n\nMaybe the doctests were just wrong, i have no idea.",
    "created_at": "2016-05-12T07:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240344",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>The `plDeg` function is a Singular internal function, made for ecart, and has some restrictions regarding the ordering it can be applied to (no negative weights or things like that).
It gets constructed by Singular at initialization of the object from `p_Deg`.

What we want in Sage is the "usual" degree which is `p_Deg`.

Maybe the doctests were just wrong, i have no idea.



---

archive/issue_comments_240345.json:
```json
{
    "body": "<a id='comment:8'></a>Which branch are you using? The branch on this ticket seems to have multiple conflicts with the current `develop`.",
    "created_at": "2016-05-12T08:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240345",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Which branch are you using? The branch on this ticket seems to have multiple conflicts with the current `develop`.



---

archive/issue_comments_240346.json:
```json
{
    "body": "<a id='comment:9'></a>The conflicts seem to be because of #20386.",
    "created_at": "2016-05-12T08:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240346",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>The conflicts seem to be because of #20386.



---

archive/issue_comments_240347.json:
```json
{
    "body": "<a id='comment:0'></a>fixed some more issues.\n\nA rebase on recent develop branch was too hard for me so I squashed everything in a new commit.\n\n`@`jdemeyer I had to revert some of your changes in `src/module_list.py` \n(removing singular from include path)\nbecause I failed to do the same for Singular 4.",
    "created_at": "2016-05-21T18:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240347",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:0'></a>fixed some more issues.

A rebase on recent develop branch was too hard for me so I squashed everything in a new commit.

`@`jdemeyer I had to revert some of your changes in `src/module_list.py` 
(removing singular from include path)
because I failed to do the same for Singular 4.



---

archive/issue_comments_240348.json:
```json
{
    "body": "<a id='comment:1'></a>actually, in my recent branch the 'upgrade.patch' file is missing.\nNo idea how that happened, but this is a fact.\n\nI will fix that tomorrow or on friday. At the moment I'm just too tired.",
    "created_at": "2016-05-26T00:26:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240348",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>actually, in my recent branch the 'upgrade.patch' file is missing.
No idea how that happened, but this is a fact.

I will fix that tomorrow or on friday. At the moment I'm just too tired.



---

archive/issue_comments_240349.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-28T19:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240350.json:
```json
{
    "body": "<a id='comment:163'></a>Replying to [comment:160 jakobkroeker]:\n> A rebase on recent develop branch was too hard for me so I squashed everything in a new commit.\n> \n> `@`jdemeyer I had to revert some of your changes in `src/module_list.py` \n\n\nBoth of these are quite bad. Do you want me to have a look?",
    "created_at": "2016-05-28T20:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240350",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:163'></a>Replying to [comment:160 jakobkroeker]:
> A rebase on recent develop branch was too hard for me so I squashed everything in a new commit.
> 
> `@`jdemeyer I had to revert some of your changes in `src/module_list.py` 


Both of these are quite bad. Do you want me to have a look?



---

archive/issue_comments_240351.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-29T09:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240352.json:
```json
{
    "body": "<a id='comment:165'></a>Replying to [comment:163 jdemeyer]:\n> Replying to [comment:160 jakobkroeker]:\n> > A rebase on recent develop branch was too hard for me so I squashed everything in a new commit.\n> > \n> > `@`jdemeyer I had to revert some of your changes in `src/module_list.py` \n\n> \n> Both of these are quite bad. Do you want me to have a look?\n\n\nThat would be good. \n\nThe latest `u/jakobkroeker/ticket.17254.squashed.latest` (just committed with force) should have no conflicts with develop/master branch",
    "created_at": "2016-05-29T09:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240352",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:165'></a>Replying to [comment:163 jdemeyer]:
> Replying to [comment:160 jakobkroeker]:
> > A rebase on recent develop branch was too hard for me so I squashed everything in a new commit.
> > 
> > `@`jdemeyer I had to revert some of your changes in `src/module_list.py` 

> 
> Both of these are quite bad. Do you want me to have a look?


That would be good. 

The latest `u/jakobkroeker/ticket.17254.squashed.latest` (just committed with force) should have no conflicts with develop/master branch



---

archive/issue_comments_240353.json:
```json
{
    "body": "<a id='comment:6'></a>Question : why trac shows me that trac's automerging failed?",
    "created_at": "2016-05-29T09:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240353",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:6'></a>Question : why trac shows me that trac's automerging failed?



---

archive/issue_comments_240354.json:
```json
{
    "body": "<a id='comment:7'></a>I experience several strange doctest failures, for example:\n\n```\nFile \"src/sage/modular/modform_hecketriangle/abstract_space.py\", line 379, in sage.modular.modform_hecketriangle.abstract_space.FormsSpace_abstract.one_element\nFailed example:\n    MF.one_element()\nExpected:\n    doctest:...: DeprecationWarning: .one_element() is deprecated. Use .one() instead.\n    See http://trac.sagemath.org/17694 for details.\n    1 + O(q^5)\nGot:\n    doctest:1: DeprecationWarning: .one_element() is deprecated. Use .one() instead.\n    See http://trac.sagemath.org/17694 for details.\n      Running doctests with ID 2016-05-15-20-09-37-2e7003e6.\n    1 + O(q^5)\n*******************\n```\nany idea what is wrong here or how to fix it?\n\n`make distclean` and `ccache --clear` did not help",
    "created_at": "2016-05-29T10:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240354",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:7'></a>I experience several strange doctest failures, for example:

```
File "src/sage/modular/modform_hecketriangle/abstract_space.py", line 379, in sage.modular.modform_hecketriangle.abstract_space.FormsSpace_abstract.one_element
Failed example:
    MF.one_element()
Expected:
    doctest:...: DeprecationWarning: .one_element() is deprecated. Use .one() instead.
    See http://trac.sagemath.org/17694 for details.
    1 + O(q^5)
Got:
    doctest:1: DeprecationWarning: .one_element() is deprecated. Use .one() instead.
    See http://trac.sagemath.org/17694 for details.
      Running doctests with ID 2016-05-15-20-09-37-2e7003e6.
    1 + O(q^5)
*******************
```
any idea what is wrong here or how to fix it?

`make distclean` and `ccache --clear` did not help



---

archive/issue_comments_240355.json:
```json
{
    "body": "<a id='comment:8'></a>Is it based off `develop` or `master`? These are different as `develop` is the (released today) 7.3.beta2, whereas `master` is `7.2`.",
    "created_at": "2016-05-29T10:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240355",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Is it based off `develop` or `master`? These are different as `develop` is the (released today) 7.3.beta2, whereas `master` is `7.2`.



---

archive/issue_comments_240356.json:
```json
{
    "body": "<a id='comment:9'></a>I've seen some errors somewhat similar to that before. It is as if something in the doctesting output gets read with an offset to what it should. I forget exactly what I've done in the past to fix this, but I think it came from a specific type of doctest failure...",
    "created_at": "2016-05-29T10:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240356",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>I've seen some errors somewhat similar to that before. It is as if something in the doctesting output gets read with an offset to what it should. I forget exactly what I've done in the past to fix this, but I think it came from a specific type of doctest failure...



---

archive/issue_comments_240357.json:
```json
{
    "body": "<a id='comment:170'></a>Replying to [comment:169 tscrim]:\n> I've seen some errors somewhat similar to that before. It is as if something in the doctesting output gets read with an offset to what it should. I forget exactly what I've done in the past to fix this, but I think it came from a specific type of doctest failure...\n\n\nare you able to reproduce some of these (false-positive) doctest failures?",
    "created_at": "2016-05-29T15:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240357",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:170'></a>Replying to [comment:169 tscrim]:
> I've seen some errors somewhat similar to that before. It is as if something in the doctesting output gets read with an offset to what it should. I forget exactly what I've done in the past to fix this, but I think it came from a specific type of doctest failure...


are you able to reproduce some of these (false-positive) doctest failures?



---

archive/issue_comments_240358.json:
```json
{
    "body": "<a id='comment:171'></a>Replying to [comment:168 tscrim]:\n> Is it based off `develop` or `master`? These are different as `develop` is the (released today) 7.3.beta2, whereas `master` is `7.2`.\n\n\nBased on develop (https://github.com/sagemath/sage)\non my machine it merges without conflicts with master and develop branch.",
    "created_at": "2016-05-29T15:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240358",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:171'></a>Replying to [comment:168 tscrim]:
> Is it based off `develop` or `master`? These are different as `develop` is the (released today) 7.3.beta2, whereas `master` is `7.2`.


Based on develop (https://github.com/sagemath/sage)
on my machine it merges without conflicts with master and develop branch.



---

archive/issue_comments_240359.json:
```json
{
    "body": "<a id='comment:172'></a>Replying to [comment:171 jakobkroeker]:\n> Replying to [comment:168 tscrim]:\n> > Is it based off `develop` or `master`? These are different as `develop` is the (released today) 7.3.beta2, whereas `master` is `7.2`.\n\n> \n> Based on develop (https://github.com/sagemath/sage)\n> on my machine it merges without conflicts with master and develop branch.\n\n\nThe automerging that is used on trac is not as good as what local versions of git can do.\n\nAs for comment:170, I haven't testing this branch yet.",
    "created_at": "2016-05-29T15:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240359",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:172'></a>Replying to [comment:171 jakobkroeker]:
> Replying to [comment:168 tscrim]:
> > Is it based off `develop` or `master`? These are different as `develop` is the (released today) 7.3.beta2, whereas `master` is `7.2`.

> 
> Based on develop (https://github.com/sagemath/sage)
> on my machine it merges without conflicts with master and develop branch.


The automerging that is used on trac is not as good as what local versions of git can do.

As for comment:170, I haven't testing this branch yet.



---

archive/issue_comments_240360.json:
```json
{
    "body": "<a id='comment:4'></a>There was a merge conflict with Sage 7.3.beta2, I fixed it.\n\n---\nNew commits:",
    "created_at": "2016-05-30T08:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240360",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>There was a merge conflict with Sage 7.3.beta2, I fixed it.

---
New commits:



---

archive/issue_comments_240361.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-30T08:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240362.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-30T09:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240363.json:
```json
{
    "body": "<a id='comment:7'></a>I cleaned up the patch and removed some unacceptable parts. Right now it doesn't build, that still needs to be fixed.",
    "created_at": "2016-05-30T09:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240363",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I cleaned up the patch and removed some unacceptable parts. Right now it doesn't build, that still needs to be fixed.



---

archive/issue_comments_240364.json:
```json
{
    "body": "<a id='comment:8'></a>I think it's best to discuss with upstream about the crazy `#include` directory structure. It was already bad in Singular 3 and it seems to have gotten worse with Singular 4.",
    "created_at": "2016-05-30T10:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240364",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I think it's best to discuss with upstream about the crazy `#include` directory structure. It was already bad in Singular 3 and it seems to have gotten worse with Singular 4.



---

archive/issue_comments_240365.json:
```json
{
    "body": "<a id='comment:179'></a>Replying to [comment:177 jdemeyer]:\n> I cleaned up the patch and removed some unacceptable parts. Right now it doesn't build, that still needs to be fixed.\n\n\nwhat has to be done to get it compiling?",
    "created_at": "2016-05-30T15:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240365",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:179'></a>Replying to [comment:177 jdemeyer]:
> I cleaned up the patch and removed some unacceptable parts. Right now it doesn't build, that still needs to be fixed.


what has to be done to get it compiling?



---

archive/issue_comments_240366.json:
```json
{
    "body": "<a id='comment:0'></a>I am working on a hack to fix the includes, hang on...",
    "created_at": "2016-05-30T15:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240366",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>I am working on a hack to fix the includes, hang on...



---

archive/issue_comments_240367.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-30T15:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240367",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240368.json:
```json
{
    "body": "<a id='comment:182'></a>Replying to [comment:177 jdemeyer]:\n> I cleaned up the patch and removed some unacceptable parts. Right now it doesn't build, that still needs to be fixed.\n\n\n\nAre these the unacceptable parts? (e.g  in src/sage/rings/polynomial/polydict.pyx)\n\n```\ndiff --git a/src/sage/rings/polynomial/polydict.pyx b/src/sage/rings/polynomial/polydict.pyx\nindex fd858f7..0b49f38 100644\n--- a/src/sage/rings/polynomial/polydict.pyx\n+++ b/src/sage/rings/polynomial/polydict.pyx\n@@ -506,7 +506,7 @@ cdef class PolyDict:\n         don't put negative signs on the generators. ::\n \n             sage: Integers(2)['x,y'].gens()\n-            (1*x, 1*y)\n+            (x, y)\n \n         We make sure that intervals are correctly represented. ::\n \n```\n\nThe 1*x output stems from Singular4 and that seems the new behaviour for that ring, for whatever reasons.\n\nsame for \n\n```\ndiff --git a/src/sage/rings/multi_power_series_ring_element.py b/src/sage/rings/multi_power_series_ring_element.py\nindex 7293a91..7b9ca6e 100644\n--- a/src/sage/rings/multi_power_series_ring_element.py\n+++ b/src/sage/rings/multi_power_series_ring_element.py\n@@ -32,7 +32,7 @@ Power series arithmetic, tracking precision::\n     sage: f*=s; f\n     s + 2*s^2 + 3*s^3 + O(s, t)^8\n     sage: f%2\n-    1*s + 1*s^3 + O(1*s, 1*t)^8\n+    s + s^3 + O(s, t)^8\n     sage: (f%2).parent()\n     Multivariate Power Series Ring in s, t over Ring of integers modulo 2\n \n@@ -1078,7 +1078,7 @@ class MPowerSeries(PowerSeries):\n             sage: R.<a,b,c> = PowerSeriesRing(ZZ)\n             sage: f = -a^3*b*c^2 + a^2*b^2*c^4 - 12*a^3*b^3*c^3 + R.O(10)\n             sage: g = f % 2; g\n-            1*a^3*b*c^2 + 1*a^2*b^2*c^4 + O(1*a, 1*b, 1*c)^10\n+            a^3*b*c^2 + a^2*b^2*c^4 + O(a, b, c)^10\n             sage: g in R\n             False\n             sage: g in R.base_extend(Zmod(2))\n```\n             \n\nalso floats are now put in braces,\nmaybe because otherwise parsing the string '1.7E+30*5' in Singular would be wronng or fail? (just guessing)\n\nso removing the following hack\n\n```\n--- a/src/sage/rings/real_double.pyx\n+++ b/src/sage/rings/real_double.pyx\n@@ -689,21 +689,6 @@ cdef class RealDoubleElement(FieldElement):\n             sage: RDF(10^100)\n             1e+100\n         \"\"\"\n-        if isinstance(x,basestring):\n-            # a hack for parsing float strings beginning with braces\n-            if len(x)>2 and x.count('(')==1 and  x.count(')')==1:\n-                try:\n-                    if (x[0] == '(' or x[1] == '(') and x[-1] == ')':\n-                        if (x[0] == '-' and x[1] == '(') :\n-                            x = x[2:-1]\n-                            self._value = - float(x)\n-                            return\n-                        else:\n-                            x = x[1:-1]\n-                            self._value = float(x)\n-                            return\n-                except:\n-                    pass\n         self._value = float(x)\n \n     def _magma_init_(self, magma):\n```\n\nwill result in a lot of failing doctests...",
    "created_at": "2016-05-30T15:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240368",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:182'></a>Replying to [comment:177 jdemeyer]:
> I cleaned up the patch and removed some unacceptable parts. Right now it doesn't build, that still needs to be fixed.



Are these the unacceptable parts? (e.g  in src/sage/rings/polynomial/polydict.pyx)

```
diff --git a/src/sage/rings/polynomial/polydict.pyx b/src/sage/rings/polynomial/polydict.pyx
index fd858f7..0b49f38 100644
--- a/src/sage/rings/polynomial/polydict.pyx
+++ b/src/sage/rings/polynomial/polydict.pyx
@@ -506,7 +506,7 @@ cdef class PolyDict:
         don't put negative signs on the generators. ::
 
             sage: Integers(2)['x,y'].gens()
-            (1*x, 1*y)
+            (x, y)
 
         We make sure that intervals are correctly represented. ::
 
```

The 1*x output stems from Singular4 and that seems the new behaviour for that ring, for whatever reasons.

same for 

```
diff --git a/src/sage/rings/multi_power_series_ring_element.py b/src/sage/rings/multi_power_series_ring_element.py
index 7293a91..7b9ca6e 100644
--- a/src/sage/rings/multi_power_series_ring_element.py
+++ b/src/sage/rings/multi_power_series_ring_element.py
@@ -32,7 +32,7 @@ Power series arithmetic, tracking precision::
     sage: f*=s; f
     s + 2*s^2 + 3*s^3 + O(s, t)^8
     sage: f%2
-    1*s + 1*s^3 + O(1*s, 1*t)^8
+    s + s^3 + O(s, t)^8
     sage: (f%2).parent()
     Multivariate Power Series Ring in s, t over Ring of integers modulo 2
 
@@ -1078,7 +1078,7 @@ class MPowerSeries(PowerSeries):
             sage: R.<a,b,c> = PowerSeriesRing(ZZ)
             sage: f = -a^3*b*c^2 + a^2*b^2*c^4 - 12*a^3*b^3*c^3 + R.O(10)
             sage: g = f % 2; g
-            1*a^3*b*c^2 + 1*a^2*b^2*c^4 + O(1*a, 1*b, 1*c)^10
+            a^3*b*c^2 + a^2*b^2*c^4 + O(a, b, c)^10
             sage: g in R
             False
             sage: g in R.base_extend(Zmod(2))
```
             

also floats are now put in braces,
maybe because otherwise parsing the string '1.7E+30*5' in Singular would be wronng or fail? (just guessing)

so removing the following hack

```
--- a/src/sage/rings/real_double.pyx
+++ b/src/sage/rings/real_double.pyx
@@ -689,21 +689,6 @@ cdef class RealDoubleElement(FieldElement):
             sage: RDF(10^100)
             1e+100
         """
-        if isinstance(x,basestring):
-            # a hack for parsing float strings beginning with braces
-            if len(x)>2 and x.count('(')==1 and  x.count(')')==1:
-                try:
-                    if (x[0] == '(' or x[1] == '(') and x[-1] == ')':
-                        if (x[0] == '-' and x[1] == '(') :
-                            x = x[2:-1]
-                            self._value = - float(x)
-                            return
-                        else:
-                            x = x[1:-1]
-                            self._value = float(x)
-                            return
-                except:
-                    pass
         self._value = float(x)
 
     def _magma_init_(self, magma):
```

will result in a lot of failing doctests...



---

archive/issue_comments_240369.json:
```json
{
    "body": "<a id='comment:183'></a>It's not because Singular prints something in a certain way that Sage has to print it that way. The correct fix is changing the way how Sage prints Singular objects then.",
    "created_at": "2016-05-30T16:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240369",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:183'></a>It's not because Singular prints something in a certain way that Sage has to print it that way. The correct fix is changing the way how Sage prints Singular objects then.



---

archive/issue_comments_240370.json:
```json
{
    "body": "<a id='comment:4'></a>I added a fix for the include file issue.",
    "created_at": "2016-05-30T16:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240370",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>I added a fix for the include file issue.



---

archive/issue_comments_240371.json:
```json
{
    "body": "<a id='comment:185'></a>Replying to [comment:184 jdemeyer]:\n> I added a fix for the include file issue.\n\n\nThanks!",
    "created_at": "2016-05-30T16:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240371",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:185'></a>Replying to [comment:184 jdemeyer]:
> I added a fix for the include file issue.


Thanks!



---

archive/issue_comments_240372.json:
```json
{
    "body": "<a id='comment:186'></a>Replying to [comment:183 jdemeyer]:\n> It's not because Singular prints something in a certain way that Sage has to print it that way. The correct fix is changing the way how Sage prints Singular objects then.\n\n\nAt least we should understand the reasons \n- for ` 1*x `\n- and for braces around floats \n\nI do not know whether it is safe to remove the `1*` and the braces around floats.\nI don't know what Sage does for example with `_repr_()`, (which calls `singular_polynomial_str()` which in turn calls `p_String`\n\nAnd if it' safe, how we should do that? \nregexping each polynomial string on the fly?",
    "created_at": "2016-05-30T16:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240372",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:186'></a>Replying to [comment:183 jdemeyer]:
> It's not because Singular prints something in a certain way that Sage has to print it that way. The correct fix is changing the way how Sage prints Singular objects then.


At least we should understand the reasons 
- for ` 1*x `
- and for braces around floats 

I do not know whether it is safe to remove the `1*` and the braces around floats.
I don't know what Sage does for example with `_repr_()`, (which calls `singular_polynomial_str()` which in turn calls `p_String`

And if it' safe, how we should do that? 
regexping each polynomial string on the fly?



---

archive/issue_comments_240373.json:
```json
{
    "body": "<a id='comment:187'></a>Replying to [comment:186 jakobkroeker]:\n> regexping each polynomial string on the fly?\n\n\nIf that works, why not?",
    "created_at": "2016-05-30T20:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240373",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:187'></a>Replying to [comment:186 jakobkroeker]:
> regexping each polynomial string on the fly?


If that works, why not?



---

archive/issue_comments_240374.json:
```json
{
    "body": "<a id='comment:8'></a>remaining failing tests:\n\n```\n./sage -t --long src/sage/arith/misc.py  # 1 doctest failed\n./sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed\n./sage -t --long src/sage/interfaces/singular.py  # 1 doctest failed\n./sage -t --long src/sage/categories/pushout.py  # 1 doctest failed\n./sage -t --long src/sage/quivers/algebra_elements.pyx  # Timed out (and interrupt failed)\n./sage -t --long src/sage/algebras/free_algebra.py  # 12 doctests failed\n./sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Bad exit: 14\n./sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # Killed due to abort\n./sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Killed due to segmentation fault\n./sage -t --long src/sage/rings/quotient_ring_element.py  # 1 doctest failed\n./sage -t --long src/sage/rings/ring.pyx  # Killed due to abort\n./sage -t --long src/sage/rings/quotient_ring.py  # 12 doctests failed\n./sage -t --long src/sage/rings/multi_power_series_ring_element.py  # 3 doctests failed\n./sage -t --long src/sage/rings/polynomial/infinite_polynomial_ring.py  # 1 doctest failed\n./sage -t --long src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault\n./sage -t --long src/sage/rings/polynomial/plural.pyx  # 6 doctests failed\n./sage -t --long src/sage/rings/polynomial/multi_polynomial_libsingular.pyx  # 2 doctests failed\n./sage -t --long src/sage/rings/polynomial/polynomial_singular_interface.py  # 1 doctest failed\n./sage -t --long src/sage/rings/polynomial/symmetric_ideal.py  # 12 doctests failed\n./sage -t --long src/sage/rings/polynomial/infinite_polynomial_element.py  # 4 doctests failed\n./sage -t --long src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed\n./sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # Killed due to segmentation fault\n./sage -t --long src/sage/schemes/projective/projective_morphism.py  # Killed due to segmentation fault\n./sage -t --long src/sage/schemes/plane_curves/projective_curve.py  # 1 doctest failed\n./sage -t --long src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort\n./sage -t --long src/sage/schemes/affine/affine_point.py  # Killed due to segmentation fault\n./sage -t --long src/sage/schemes/affine/affine_morphism.py  # Killed due to segmentation fault\n./sage -t --long src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed\n./sage -t --long src/sage/schemes/generic/algebraic_scheme.py  # Killed due to segmentation fault\n./sage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Timed out (with hangup after interrupt)\n./sage -t --long src/sage/structure/element.pyx  # 1 doctest failed\n./sage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed\n```\nany volunteers?",
    "created_at": "2016-06-01T06:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240374",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:8'></a>remaining failing tests:

```
./sage -t --long src/sage/arith/misc.py  # 1 doctest failed
./sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed
./sage -t --long src/sage/interfaces/singular.py  # 1 doctest failed
./sage -t --long src/sage/categories/pushout.py  # 1 doctest failed
./sage -t --long src/sage/quivers/algebra_elements.pyx  # Timed out (and interrupt failed)
./sage -t --long src/sage/algebras/free_algebra.py  # 12 doctests failed
./sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Bad exit: 14
./sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # Killed due to abort
./sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Killed due to segmentation fault
./sage -t --long src/sage/rings/quotient_ring_element.py  # 1 doctest failed
./sage -t --long src/sage/rings/ring.pyx  # Killed due to abort
./sage -t --long src/sage/rings/quotient_ring.py  # 12 doctests failed
./sage -t --long src/sage/rings/multi_power_series_ring_element.py  # 3 doctests failed
./sage -t --long src/sage/rings/polynomial/infinite_polynomial_ring.py  # 1 doctest failed
./sage -t --long src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault
./sage -t --long src/sage/rings/polynomial/plural.pyx  # 6 doctests failed
./sage -t --long src/sage/rings/polynomial/multi_polynomial_libsingular.pyx  # 2 doctests failed
./sage -t --long src/sage/rings/polynomial/polynomial_singular_interface.py  # 1 doctest failed
./sage -t --long src/sage/rings/polynomial/symmetric_ideal.py  # 12 doctests failed
./sage -t --long src/sage/rings/polynomial/infinite_polynomial_element.py  # 4 doctests failed
./sage -t --long src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed
./sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # Killed due to segmentation fault
./sage -t --long src/sage/schemes/projective/projective_morphism.py  # Killed due to segmentation fault
./sage -t --long src/sage/schemes/plane_curves/projective_curve.py  # 1 doctest failed
./sage -t --long src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort
./sage -t --long src/sage/schemes/affine/affine_point.py  # Killed due to segmentation fault
./sage -t --long src/sage/schemes/affine/affine_morphism.py  # Killed due to segmentation fault
./sage -t --long src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed
./sage -t --long src/sage/schemes/generic/algebraic_scheme.py  # Killed due to segmentation fault
./sage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Timed out (with hangup after interrupt)
./sage -t --long src/sage/structure/element.pyx  # 1 doctest failed
./sage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed
```
any volunteers?



---

archive/issue_comments_240375.json:
```json
{
    "body": "<a id='comment:9'></a>Do you still get the letterplace segfault?",
    "created_at": "2016-06-01T06:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240375",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Do you still get the letterplace segfault?



---

archive/issue_comments_240376.json:
```json
{
    "body": "<a id='comment:190'></a>Replying to [comment:189 jpflori]:\n> Do you still get the letterplace segfault?\n\n\nI did not fix that one because I have no idea what FreeAlgebra is neither I know something about letterplace implementation, so I did not even try.",
    "created_at": "2016-06-01T19:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240376",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:190'></a>Replying to [comment:189 jpflori]:
> Do you still get the letterplace segfault?


I did not fix that one because I have no idea what FreeAlgebra is neither I know something about letterplace implementation, so I did not even try.



---

archive/issue_comments_240377.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[df297d6](http://git.sagemath.org/sage.git/commit/?id=df297d6c6a4dc2955ef985bdef3646f8a7217be1)|`add meaninful messages to Singular error`|\nremark: the patch above does not solve the issue with letterplace segfault",
    "created_at": "2016-06-01T22:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240377",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[df297d6](http://git.sagemath.org/sage.git/commit/?id=df297d6c6a4dc2955ef985bdef3646f8a7217be1)|`add meaninful messages to Singular error`|
remark: the patch above does not solve the issue with letterplace segfault



---

archive/issue_comments_240378.json:
```json
{
    "body": "<a id='comment:2'></a>simplest failing example:\n\n```\nsage: A.<x> = AffineSpace(GF(3^2, 't'), 1) ## line 299 ##\nIdeal(x).weil_restriction()\n```",
    "created_at": "2016-06-01T22:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240378",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:2'></a>simplest failing example:

```
sage: A.<x> = AffineSpace(GF(3^2, 't'), 1) ## line 299 ##
Ideal(x).weil_restriction()
```



---

archive/issue_comments_240379.json:
```json
{
    "body": "<a id='comment:3'></a>added debug printouts in \n\n```\nu/jakobkroeker/jdemeyer_ticket.17254.latest.debug\n```\n\nfor the example\n\n```\nsage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')\nsage: x**2\n```\nin `free_algebra_element_letterplace.pyx`, `__pow__()` routine\nafter copying the polynomial from one ring to another (with `prCopyR`) something seems broken\n(look at the polynomial degree!)\n\nand for the \n\n```\nsage: A.<x> = AffineSpace(GF(3^2, 't'), 1) ## line 299 ##\nIdeal(x).weil_restriction()\n```\n\nafter the `subs()`  command in the `weil_restriction()`-Routine something is screwed up\n(look at the polynomial degree!)\n\n`@`jpflori\nAny idea?",
    "created_at": "2016-06-02T21:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240379",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:3'></a>added debug printouts in 

```
u/jakobkroeker/jdemeyer_ticket.17254.latest.debug
```

for the example

```
sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')
sage: x**2
```
in `free_algebra_element_letterplace.pyx`, `__pow__()` routine
after copying the polynomial from one ring to another (with `prCopyR`) something seems broken
(look at the polynomial degree!)

and for the 

```
sage: A.<x> = AffineSpace(GF(3^2, 't'), 1) ## line 299 ##
Ideal(x).weil_restriction()
```

after the `subs()`  command in the `weil_restriction()`-Routine something is screwed up
(look at the polynomial degree!)

`@`jpflori
Any idea?



---

archive/issue_comments_240380.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-03T17:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240380",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240381.json:
```json
{
    "body": "<a id='comment:5'></a>p_Deg seems to have problems with lex ordering:\n\n```\nk = QQ\nS.<a,b>=PolynomialRing(k, 2, {\"a\",\"b\"}, order='lex')\na.degree() # 65536\n\nk = QQ\nS.<a,b>=PolynomialRing(k, 2, {\"a\",\"b\"}, order='degrevlex')\na.degree() #1\n\n```",
    "created_at": "2016-06-04T01:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240381",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:5'></a>p_Deg seems to have problems with lex ordering:

```
k = QQ
S.<a,b>=PolynomialRing(k, 2, {"a","b"}, order='lex')
a.degree() # 65536

k = QQ
S.<a,b>=PolynomialRing(k, 2, {"a","b"}, order='degrevlex')
a.degree() #1

```



---

archive/issue_comments_240382.json:
```json
{
    "body": "<a id='comment:6'></a>`@`jpflori\n\nSingulars degree function calls `pLDeg` and not `p_Deg`, \n(grep for '`jjDEG`' in Singular sources), so we should do the same/similar by default.\none of the reasons: `p_Deg` seems returning garbage for lexicographic orderings\n(see comment 195)\n\n\nQuestion: is the behaviour described in the documentation of the 'degree' function in sage \n\n```\nNote that a matrix term ordering alters the grading of the generators\n          of the ring; see the tests below.  To avoid this behavior, use either\n          ``exponents()`` for the exponents themselves, or the optional\n          argument ``std_grading=False``.\n```\n\nnatural and is it what a user would expect? Then we could(?) fix it using a different appropriate call:\n\n```\nsage: sage: tord = TermOrder(matrix([3,0,1,1,1,0,1,0,0]))\nsage: sage: R.<x,y,z> = PolynomialRing(QQ,'x',3,order=tord)\nsage: sage: (x^3*y+x*z^4).degree() # 9\n('p_Totaldegree', 4)\n('p_WTotaldegree', 9)\n('p_WDegree', 9)\n('pFDeg', 4)\n('pLDeg', 5)\n```",
    "created_at": "2016-06-13T01:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240382",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:6'></a>`@`jpflori

Singulars degree function calls `pLDeg` and not `p_Deg`, 
(grep for '`jjDEG`' in Singular sources), so we should do the same/similar by default.
one of the reasons: `p_Deg` seems returning garbage for lexicographic orderings
(see comment 195)


Question: is the behaviour described in the documentation of the 'degree' function in sage 

```
Note that a matrix term ordering alters the grading of the generators
          of the ring; see the tests below.  To avoid this behavior, use either
          ``exponents()`` for the exponents themselves, or the optional
          argument ``std_grading=False``.
```

natural and is it what a user would expect? Then we could(?) fix it using a different appropriate call:

```
sage: sage: tord = TermOrder(matrix([3,0,1,1,1,0,1,0,0]))
sage: sage: R.<x,y,z> = PolynomialRing(QQ,'x',3,order=tord)
sage: sage: (x^3*y+x*z^4).degree() # 9
('p_Totaldegree', 4)
('p_WTotaldegree', 9)
('p_WDegree', 9)
('pFDeg', 4)
('pLDeg', 5)
```



---

archive/issue_comments_240383.json:
```json
{
    "body": "<a id='comment:197'></a>Replying to [comment:196 jakobkroeker]:\n> Question: is the behaviour described in the documentation of the 'degree' function in sage \n> \n> ```\n> Note that a matrix term ordering alters the grading of the generators\n>           of the ring; see the tests below.  To avoid this behavior, use either\n>           ``exponents()`` for the exponents themselves, or the optional\n>           argument ``std_grading=False``.\n> ```\n> \n> natural and is it what a user would expect?\n\nI bumped into this a long time ago. It shocked me then, but I adapted & now my code depends on it. If this is true of me, it is probably true of others.\n\nThis, for example, is from Sage 6.7:\n\n```\nsage: T = TermOrder(matrix(3,3,[1,2,3,3,4,5,0,0,1]))\nsage: R.<x,y,z> = PolynomialRing(QQ,'x',3,order=T)\nsage: y.degree()\n2\nsage: version()\n'SageMath Version 6.7, Release Date: 2015-05-17'\n```\nSo IMHO we should mimic Singular for compatibility reasons (i.e., we're mimicking Sage itself).",
    "created_at": "2016-06-13T02:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240383",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:197'></a>Replying to [comment:196 jakobkroeker]:
> Question: is the behaviour described in the documentation of the 'degree' function in sage 
> 
> ```
> Note that a matrix term ordering alters the grading of the generators
>           of the ring; see the tests below.  To avoid this behavior, use either
>           ``exponents()`` for the exponents themselves, or the optional
>           argument ``std_grading=False``.
> ```
> 
> natural and is it what a user would expect?

I bumped into this a long time ago. It shocked me then, but I adapted & now my code depends on it. If this is true of me, it is probably true of others.

This, for example, is from Sage 6.7:

```
sage: T = TermOrder(matrix(3,3,[1,2,3,3,4,5,0,0,1]))
sage: R.<x,y,z> = PolynomialRing(QQ,'x',3,order=T)
sage: y.degree()
2
sage: version()
'SageMath Version 6.7, Release Date: 2015-05-17'
```
So IMHO we should mimic Singular for compatibility reasons (i.e., we're mimicking Sage itself).



---

archive/issue_events_049907.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-06-14T02:55:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49907"
}
```



---

archive/issue_events_049908.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-06-14T02:55:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49908"
}
```



---

archive/issue_comments_240384.json:
```json
{
    "body": "<a id='comment:8'></a>Rebased on latest beta.\n\n---\nNew commits:",
    "created_at": "2016-06-14T02:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240384",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Rebased on latest beta.

---
New commits:



---

archive/issue_comments_240385.json:
```json
{
    "body": "<a id='comment:199'></a>Replying to [comment:196 jakobkroeker]:\n> Question: is the behaviour described in the documentation of the 'degree' function in sage \n> \n> ```\n> Note that a matrix term ordering alters the grading of the generators\n>           of the ring; see the tests below.  To avoid this behavior, use either\n>           ``exponents()`` for the exponents themselves, or the optional\n>           argument ``std_grading=False``.\n> ```\n> \n> natural and is it what a user would expect? Then we could(?) fix it using a different appropriate call:\n> \n> ```\n> sage: sage: tord = TermOrder(matrix([3,0,1,1,1,0,1,0,0]))\n> sage: sage: R.<x,y,z> = PolynomialRing(QQ,'x',3,order=tord)\n> sage: sage: (x^3*y+x*z^4).degree() # 9\n> ('p_Totaldegree', 4)\n> ('p_WTotaldegree', 9)\n> ('p_WDegree', 9)\n> ('pFDeg', 4)\n> ('pLDeg', 5)\n> ```\n\n\nAs the person who introduced the matrix term ordering into Sage, I think that it was just due to the Singular behavior that a matrix term ordering changes the grading of the generators according to the first row of the matrix in Sage. It shocked everyone including John, and was regarded as a bug. So if we can make the grading and the matrix term ordering independent, switching to Singular 4, then I would be happy. Of course it should go with an appropriate deprecation warning.",
    "created_at": "2016-06-22T01:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240385",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:199'></a>Replying to [comment:196 jakobkroeker]:
> Question: is the behaviour described in the documentation of the 'degree' function in sage 
> 
> ```
> Note that a matrix term ordering alters the grading of the generators
>           of the ring; see the tests below.  To avoid this behavior, use either
>           ``exponents()`` for the exponents themselves, or the optional
>           argument ``std_grading=False``.
> ```
> 
> natural and is it what a user would expect? Then we could(?) fix it using a different appropriate call:
> 
> ```
> sage: sage: tord = TermOrder(matrix([3,0,1,1,1,0,1,0,0]))
> sage: sage: R.<x,y,z> = PolynomialRing(QQ,'x',3,order=tord)
> sage: sage: (x^3*y+x*z^4).degree() # 9
> ('p_Totaldegree', 4)
> ('p_WTotaldegree', 9)
> ('p_WDegree', 9)
> ('pFDeg', 4)
> ('pLDeg', 5)
> ```


As the person who introduced the matrix term ordering into Sage, I think that it was just due to the Singular behavior that a matrix term ordering changes the grading of the generators according to the first row of the matrix in Sage. It shocked everyone including John, and was regarded as a bug. So if we can make the grading and the matrix term ordering independent, switching to Singular 4, then I would be happy. Of course it should go with an appropriate deprecation warning.



---

archive/issue_comments_240386.json:
```json
{
    "body": "<a id='comment:200'></a>Replying to [comment:199 klee]:\n> Of course it should go with an appropriate deprecation warning.\n\n\n+1",
    "created_at": "2016-06-22T04:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240386",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:200'></a>Replying to [comment:199 klee]:
> Of course it should go with an appropriate deprecation warning.


+1



---

archive/issue_comments_240387.json:
```json
{
    "body": "<a id='comment:1'></a>Polymake (#20892) looks for a binary called `libsingular-config`. Is this something that will be installed by Singular 4?",
    "created_at": "2016-06-29T16:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240387",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Polymake (#20892) looks for a binary called `libsingular-config`. Is this something that will be installed by Singular 4?



---

archive/issue_comments_240388.json:
```json
{
    "body": "<a id='comment:202'></a>Replying to [comment:201 mkoeppe]:\n> Polymake (#20892) looks for a binary called `libsingular-config`. Is this something that will be installed by Singular 4?\n\n\nyes, libsingular-config is a bash script in Singular 4",
    "created_at": "2016-07-01T13:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240388",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:202'></a>Replying to [comment:201 mkoeppe]:
> Polymake (#20892) looks for a binary called `libsingular-config`. Is this something that will be installed by Singular 4?


yes, libsingular-config is a bash script in Singular 4



---

archive/issue_comments_240389.json:
```json
{
    "body": "<a id='comment:3'></a>This will hopefully build with GCC 6.x... (cf. #20738) :P",
    "created_at": "2016-07-03T15:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240389",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>This will hopefully build with GCC 6.x... (cf. #20738) :P



---

archive/issue_comments_240390.json:
```json
{
    "body": "<a id='comment:4'></a>Currently I implemented `singular_polynomial_deg` as follows\nto mimic its behaviour as it was with Singular 3.1.7(and older)\n\n```\n    ...\n    cdef long _deg, deg\n    \n    deg = -1\n    _deg = -1 \n    if x == NULL:\n        while p:  \n            _deg = p_WTotaldegree(p,r)\n          \n            if _deg > deg:\n                deg = _deg\n            p = pNext(p)\n\n        return deg\n    ...\n```\n\nThe degree-related tests seem to pass now.\n\nRemakr: pDeg() seems not usable/has different behaviour; see \nhttps://groups.google.com/forum/?_escaped_fragment_=topic/libsingular-devel/dulzKFTF3g8#!topic/libsingular-devel/dulzKFTF3g8 for details.\n\nFurther changes: added some missing rComplete() calls (\notherwise prCopyR cannot be used, for instance, see https://groups.google.com/forum/?_escaped_fragment_=topic/libsingular-devel/4JRHxVXIF70#!topic/libsingular-devel/4JRHxVXIF70 )\n\n\n\n---\nNew commits:",
    "created_at": "2016-07-04T22:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240390",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:4'></a>Currently I implemented `singular_polynomial_deg` as follows
to mimic its behaviour as it was with Singular 3.1.7(and older)

```
    ...
    cdef long _deg, deg
    
    deg = -1
    _deg = -1 
    if x == NULL:
        while p:  
            _deg = p_WTotaldegree(p,r)
          
            if _deg > deg:
                deg = _deg
            p = pNext(p)

        return deg
    ...
```

The degree-related tests seem to pass now.

Remakr: pDeg() seems not usable/has different behaviour; see 
https://groups.google.com/forum/?_escaped_fragment_=topic/libsingular-devel/dulzKFTF3g8#!topic/libsingular-devel/dulzKFTF3g8 for details.

Further changes: added some missing rComplete() calls (
otherwise prCopyR cannot be used, for instance, see https://groups.google.com/forum/?_escaped_fragment_=topic/libsingular-devel/4JRHxVXIF70#!topic/libsingular-devel/4JRHxVXIF70 )



---
New commits:



---

archive/issue_comments_240391.json:
```json
{
    "body": "<a id='comment:5'></a>only few issues are left; \n\nwho will fix the next one? \nthat should be easy!\n\n```\n./sage -t --long src/sage/arith/misc.py  # 1 doctest failed\n./sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed\n./sage -t --long src/sage/quivers/algebra_elements.pyx  # Timed out (and interrupt failed)\n./sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Killed due to segmentation fault\n./sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # Killed due to abort\n./sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Timed out (and interrupt failed)\n./sage -t --long src/sage/rings/ring.pyx  # Killed due to abort\n./sage -t --long src/sage/rings/multi_power_series_ring_element.py  # 2 doctests failed\n./sage -t --long src/sage/rings/polynomial/multi_polynomial_libsingular.pyx  # 2 doctests failed\n./sage -t --long src/sage/rings/polynomial/polynomial_singular_interface.py  # 1 doctest failed\n./sage -t --long src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed\n./sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed\n./sage -t --long src/sage/schemes/projective/projective_morphism.py  # Timed out (with hangup after interrupt)\n./sage -t --long src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort\n./sage -t --long src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed\n./sage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Killed due to segmentation fault\n./sage -t --long src/sage/structure/element.pyx  # 1 doctest failed\n./sage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed\n```",
    "created_at": "2016-07-04T22:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240391",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:5'></a>only few issues are left; 

who will fix the next one? 
that should be easy!

```
./sage -t --long src/sage/arith/misc.py  # 1 doctest failed
./sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed
./sage -t --long src/sage/quivers/algebra_elements.pyx  # Timed out (and interrupt failed)
./sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Killed due to segmentation fault
./sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # Killed due to abort
./sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Timed out (and interrupt failed)
./sage -t --long src/sage/rings/ring.pyx  # Killed due to abort
./sage -t --long src/sage/rings/multi_power_series_ring_element.py  # 2 doctests failed
./sage -t --long src/sage/rings/polynomial/multi_polynomial_libsingular.pyx  # 2 doctests failed
./sage -t --long src/sage/rings/polynomial/polynomial_singular_interface.py  # 1 doctest failed
./sage -t --long src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed
./sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
./sage -t --long src/sage/schemes/projective/projective_morphism.py  # Timed out (with hangup after interrupt)
./sage -t --long src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort
./sage -t --long src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed
./sage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Killed due to segmentation fault
./sage -t --long src/sage/structure/element.pyx  # 1 doctest failed
./sage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed
```



---

archive/issue_comments_240392.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-09T23:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240393.json:
```json
{
    "body": "<a id='comment:7'></a>Failing of \n\n```\nsage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')\nsage: x**2\n```\nis caused by an upstream bug; (reported: https://www.singular.uni-kl.de:8005/trac/ticket/767#ticket)\n\nLetterplace over fields should work (please check)",
    "created_at": "2016-07-10T12:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240393",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:7'></a>Failing of 

```
sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')
sage: x**2
```
is caused by an upstream bug; (reported: https://www.singular.uni-kl.de:8005/trac/ticket/767#ticket)

Letterplace over fields should work (please check)



---

archive/issue_comments_240394.json:
```json
{
    "body": "<a id='comment:208'></a>Replying to [comment:207 jakobkroeker]:\n> Failing of \n> \n> ```\n> sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')\n> sage: x**2\n> ```\n> is caused by an upstream bug; (reported: https://www.singular.uni-kl.de:8005/trac/ticket/767#ticket)\n> \n> Letterplace over fields should work (please check)\n\nThanks for devising this!\n>",
    "created_at": "2016-07-15T09:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240394",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:208'></a>Replying to [comment:207 jakobkroeker]:
> Failing of 
> 
> ```
> sage: F.<x> = FreeAlgebra(ZZ, implementation='letterplace')
> sage: x**2
> ```
> is caused by an upstream bug; (reported: https://www.singular.uni-kl.de:8005/trac/ticket/767#ticket)
> 
> Letterplace over fields should work (please check)

Thanks for devising this!
>



---

archive/issue_comments_240395.json:
```json
{
    "body": "<a id='comment:9'></a>the upsream issue\n\npathed in http://git.sagemath.org/sage.git/commit/?id=ac8e614777f6e5e49149f6227d40ba1cc71585c9\n(upgrade.patch)\n\nis now reported on upstream with a pull request:\n\nhttps://www.singular.uni-kl.de:8005/trac/ticket/770#ticket",
    "created_at": "2016-07-31T09:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240395",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:9'></a>the upsream issue

pathed in http://git.sagemath.org/sage.git/commit/?id=ac8e614777f6e5e49149f6227d40ba1cc71585c9
(upgrade.patch)

is now reported on upstream with a pull request:

https://www.singular.uni-kl.de:8005/trac/ticket/770#ticket



---

archive/issue_comments_240396.json:
```json
{
    "body": "<a id='comment:0'></a>could someone please look what goes wrong with\n\n```\n./sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py\n```\n?",
    "created_at": "2016-07-31T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240396",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:0'></a>could someone please look what goes wrong with

```
./sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py
```
?



---

archive/issue_comments_240397.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+**Lots** of stuff has changed in Singular 4. But now the attached branch based on Singular git version is almost working.\n \n+ATM, make your own tarball with `SINGULAR_GIT=1 spkg-src` and fix checksum `sage --package fix-checksum singular`.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-08-17T10:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240397",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+**Lots** of stuff has changed in Singular 4. But now the attached branch based on Singular git version is almost working.
 
+ATM, make your own tarball with `SINGULAR_GIT=1 spkg-src` and fix checksum `sage --package fix-checksum singular`.
 
 Comment: 1
 
``````




---

archive/issue_comments_240398.json:
```json
{
    "body": "<a id='comment:1'></a>I've removed a bunch of very old hackish stuff in `spkg-install`, especially regarding Solaris and sparc.\nMaybe too much, but the Singular build system changed so much and it does not seem we have real support for such systems anymore that we should only reintroduce removed hacks if found that are still needed.\n\nIt also seems this upgrade to git version rebroke some stuff...\n\n---\nNew commits:",
    "created_at": "2016-08-17T10:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240398",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>I've removed a bunch of very old hackish stuff in `spkg-install`, especially regarding Solaris and sparc.
Maybe too much, but the Singular build system changed so much and it does not seem we have real support for such systems anymore that we should only reintroduce removed hacks if found that are still needed.

It also seems this upgrade to git version rebroke some stuff...

---
New commits:



---

archive/issue_comments_240399.json:
```json
{
    "body": "<a id='comment:2'></a>In particular, in `function.pyx`, in `__init__` after calling\n\n```\n        if currRingHdl == NULL:\n            currRingHdl = ggetid(\"my_awesome_sage_ring\")\n            if currRingHdl == NULL:\n                currRingHdl = enterid(\"my_awesome_sage_ring\", 0, RING_CMD, &IDROOT, 1)\n            currRingHdl.data.uring.ref += 1\n```\nthe last line segfaults because:\n\n```\n(gdb) print currRingHdl.data\n$2 = {\n  i = 0, \n  uring = 0x0, \n  p = 0x0, \n  n = 0x0, \n  uideal = 0x0, \n  umap = 0x0, \n  umatrix = 0x0, \n  ustring = 0x0, \n  iv = 0x0, \n  bim = 0x0, \n  l = 0x0, \n  li = 0x0, \n  pack = 0x0, \n  pinf = 0x0\n}\n```\n\nI guess some additional funciton should be used to initialize properly `currRingHdl`.",
    "created_at": "2016-08-17T10:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240399",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>In particular, in `function.pyx`, in `__init__` after calling

```
        if currRingHdl == NULL:
            currRingHdl = ggetid("my_awesome_sage_ring")
            if currRingHdl == NULL:
                currRingHdl = enterid("my_awesome_sage_ring", 0, RING_CMD, &IDROOT, 1)
            currRingHdl.data.uring.ref += 1
```
the last line segfaults because:

```
(gdb) print currRingHdl.data
$2 = {
  i = 0, 
  uring = 0x0, 
  p = 0x0, 
  n = 0x0, 
  uideal = 0x0, 
  umap = 0x0, 
  umatrix = 0x0, 
  ustring = 0x0, 
  iv = 0x0, 
  bim = 0x0, 
  l = 0x0, 
  li = 0x0, 
  pack = 0x0, 
  pinf = 0x0
}
```

I guess some additional funciton should be used to initialize properly `currRingHdl`.



---

archive/issue_comments_240400.json:
```json
{
    "body": "<a id='comment:3'></a>The culprit might be\nhttps://github.com/Singular/Sources/commit/595145c77dbdb42114960862678d5ca6351578be",
    "created_at": "2016-08-17T10:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240400",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>The culprit might be
https://github.com/Singular/Sources/commit/595145c77dbdb42114960862678d5ca6351578be



---

archive/issue_comments_240401.json:
```json
{
    "body": "<a id='comment:4'></a>So everyone's always using the *latest* git version in `spkg-src`?\n\nFWIW, `sed -i` isn't portable, e.g. won't work on Oraclis.\n\n`SPKG.txt` now says \"Patches: None\" whereas there is `upgrade.patch`.",
    "created_at": "2016-08-17T11:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240401",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>So everyone's always using the *latest* git version in `spkg-src`?

FWIW, `sed -i` isn't portable, e.g. won't work on Oraclis.

`SPKG.txt` now says "Patches: None" whereas there is `upgrade.patch`.



---

archive/issue_comments_240402.json:
```json
{
    "body": "<a id='comment:5'></a>That's just work in progress...\nThis upgrade is hell.",
    "created_at": "2016-08-17T11:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240402",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>That's just work in progress...
This upgrade is hell.



---

archive/issue_comments_240403.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-17T11:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240404.json:
```json
{
    "body": "<a id='comment:217'></a>Replying to [comment:215 jpflori]:\n> That's just work in progress...\n> This upgrade is hell.\n\n\nSure.  So you'll (by default) check out a specific commit once you know which one is suited best?",
    "created_at": "2016-08-17T11:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240404",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:217'></a>Replying to [comment:215 jpflori]:
> That's just work in progress...
> This upgrade is hell.


Sure.  So you'll (by default) check out a specific commit once you know which one is suited best?



---

archive/issue_comments_240405.json:
```json
{
    "body": "<a id='comment:8'></a>Just for the record:\n\n`make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.",
    "created_at": "2016-08-17T11:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240405",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>Just for the record:

`make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.



---

archive/issue_comments_240406.json:
```json
{
    "body": "<a id='comment:9'></a>FYI, explanation for the removal and readdition of `nlDelete`:\nhttps://groups.google.com/d/msg/libsingular-devel/EtEblVqdV3I/CyJJ5jaJCAAJ",
    "created_at": "2016-08-17T13:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240406",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>FYI, explanation for the removal and readdition of `nlDelete`:
https://groups.google.com/d/msg/libsingular-devel/EtEblVqdV3I/CyJJ5jaJCAAJ



---

archive/issue_comments_240407.json:
```json
{
    "body": "<a id='comment:220'></a>Replying to [comment:217 leif]:\n> Replying to [comment:215 jpflori]:\n> > That's just work in progress...\n> > This upgrade is hell.\n\n> \n> Sure.  So you'll (by default) check out a specific commit once you know which one is suited best?\n  \nSure!\nHopefully it should be 4.1 upstream version though I don't know when it's planned.\n4.0.3p1 seems to be a poorer choice as a bunch of bugs reported here where fixed in Singular after that release and the fixes would have to be backported...",
    "created_at": "2016-08-17T13:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240407",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:220'></a>Replying to [comment:217 leif]:
> Replying to [comment:215 jpflori]:
> > That's just work in progress...
> > This upgrade is hell.

> 
> Sure.  So you'll (by default) check out a specific commit once you know which one is suited best?
  
Sure!
Hopefully it should be 4.1 upstream version though I don't know when it's planned.
4.0.3p1 seems to be a poorer choice as a bunch of bugs reported here where fixed in Singular after that release and the fixes would have to be backported...



---

archive/issue_comments_240408.json:
```json
{
    "body": "<a id='comment:221'></a>Replying to [comment:218 leif]:\n> Just for the record:\n> \n> `make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.\n\nYes and tries to copy some files from the person who wrote the script :)",
    "created_at": "2016-08-17T13:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240408",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:221'></a>Replying to [comment:218 leif]:
> Just for the record:
> 
> `make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.

Yes and tries to copy some files from the person who wrote the script :)



---

archive/issue_comments_240409.json:
```json
{
    "body": "<a id='comment:222'></a>Replying to [comment:220 jpflori]:\n> Replying to [comment:217 leif]:\n> > So you'll (by default) check out a specific commit once you know which one is suited best?\n\n> Sure!\n> Hopefully it should be 4.1 upstream version though I don't know when it's planned.\n\n\nI was just about to ask you that, as there are many recent commits mentioning 4.1.\n\nI'll probably add something to `spkg-src` regarding checkout and `autogen.sh` / `make_tar.sh` unless you're going to as well.",
    "created_at": "2016-08-17T13:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240409",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:222'></a>Replying to [comment:220 jpflori]:
> Replying to [comment:217 leif]:
> > So you'll (by default) check out a specific commit once you know which one is suited best?

> Sure!
> Hopefully it should be 4.1 upstream version though I don't know when it's planned.


I was just about to ask you that, as there are many recent commits mentioning 4.1.

I'll probably add something to `spkg-src` regarding checkout and `autogen.sh` / `make_tar.sh` unless you're going to as well.



---

archive/issue_comments_240410.json:
```json
{
    "body": "<a id='comment:223'></a>Replying to [comment:221 jpflori]:\n> Replying to [comment:218 leif]:\n> > `make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.\n\n> Yes and tries to copy some files from the person who wrote the script :)\n\nI just stumbled upon\n\n```sh\ncp /tmp/wawa-i/share/singular/LIB/all.lib  singular-$VERSION/Singular/LIB/.\n```\n\nDid you mean that, or is there more?",
    "created_at": "2016-08-17T13:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240410",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:223'></a>Replying to [comment:221 jpflori]:
> Replying to [comment:218 leif]:
> > `make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.

> Yes and tries to copy some files from the person who wrote the script :)

I just stumbled upon

```sh
cp /tmp/wawa-i/share/singular/LIB/all.lib  singular-$VERSION/Singular/LIB/.
```

Did you mean that, or is there more?



---

archive/issue_comments_240411.json:
```json
{
    "body": "<a id='comment:4'></a>After all, it's `spielwiese`  (~= playground).\n\nIs the repo on GitHub their \"master\" one, or do they (occasionally) just sync from elsewhere?",
    "created_at": "2016-08-17T13:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240411",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>After all, it's `spielwiese`  (~= playground).

Is the repo on GitHub their "master" one, or do they (occasionally) just sync from elsewhere?



---

archive/issue_comments_240412.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-17T13:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240413.json:
```json
{
    "body": "<a id='comment:226'></a>Replying to [comment:223 leif]:\n> Replying to [comment:221 jpflori]:\n> > Replying to [comment:218 leif]:\n> > > `make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.\n\n> > Yes and tries to copy some files from the person who wrote the script :)\n> \n> I just stumbled upon\n> \n> ```\n> #!sh\n> cp /tmp/wawa-i/share/singular/LIB/all.lib  singular-$VERSION/Singular/LIB/.\n> ```\n> \n> Did you mean that, or is there more?\n\nThere is also a non-existing fedora (IIRC) file.",
    "created_at": "2016-08-17T13:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240413",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:226'></a>Replying to [comment:223 leif]:
> Replying to [comment:221 jpflori]:
> > Replying to [comment:218 leif]:
> > > `make_tar.sh` checks out `HEAD`, and calls `autogen.sh` (without checking for errors) which in turn runs (some random version of) `autoreconf`.

> > Yes and tries to copy some files from the person who wrote the script :)
> 
> I just stumbled upon
> 
> ```
> #!sh
> cp /tmp/wawa-i/share/singular/LIB/all.lib  singular-$VERSION/Singular/LIB/.
> ```
> 
> Did you mean that, or is there more?

There is also a non-existing fedora (IIRC) file.



---

archive/issue_comments_240414.json:
```json
{
    "body": "<a id='comment:227'></a>Replying to [comment:224 leif]:\n> After all, it's `spielwiese`  (~= playground).\n> \n> Is the repo on GitHub their \"master\" one, or do they (occasionally) just sync from elsewhere?\n\nI would say the `spielwiese` branch on github is the real master one.\nAs you can see, the following commit:\nhttps://github.com/Singular/Sources/commit/b412eebf8435fb44680b5160c7f8d524cdb20b2b\njust followed my post on libsingular-devel:\nhttps://groups.google.com/forum/#!topic/libsingular-devel/EtEblVqdV3I",
    "created_at": "2016-08-17T13:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240414",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:227'></a>Replying to [comment:224 leif]:
> After all, it's `spielwiese`  (~= playground).
> 
> Is the repo on GitHub their "master" one, or do they (occasionally) just sync from elsewhere?

I would say the `spielwiese` branch on github is the real master one.
As you can see, the following commit:
https://github.com/Singular/Sources/commit/b412eebf8435fb44680b5160c7f8d524cdb20b2b
just followed my post on libsingular-devel:
https://groups.google.com/forum/#!topic/libsingular-devel/EtEblVqdV3I



---

archive/issue_comments_240415.json:
```json
{
    "body": "<a id='comment:8'></a>Things seem good.\nA ptest yeilds:\n\n```\nsage -t --warn-long 121.7 src/doc/en/prep/Advanced-2DPlotting.rst  # Killed due \nto segmentation fault\nsage -t --warn-long 121.7 src/sage/calculus/riemann.pyx  # Timed out (and interr\nupt failed)\nsage -t --warn-long 121.7 src/sage/schemes/elliptic_curves/isogeny_small_degree.\npy  # Killed due to segmentation fault\nsage -t --warn-long 121.7 src/sage/schemes/elliptic_curves/ell_number_field.py  \n# Timed out\nsage -t --warn-long 121.7 src/sage/libs/gap/all_documented_functions.py  # Timed\n out\nsage -t --warn-long 121.7 src/sage/plot/plot.py  # Timed out\nsage -t --warn-long 121.7 src/sage/libs/gap/assigned_names.py  # Timed out\nsage -t --warn-long 121.7 src/sage/finance/time_series.pyx  # Timed out\nsage -t --warn-long 121.7 src/sage/plot/plot3d/implicit_plot3d.py  # Timed out\nsage -t --warn-long 121.7 src/sage/plot/plot3d/parametric_plot3d.py  # Timed out\nsage -t --warn-long 121.7 src/sage/plot/plot3d/plot3d.py  # Timed out\nsage -t --warn-long 121.7 src/sage/plot/graphics.py  # Timed out\nsage -t --warn-long 121.7 src/sage/plot/plot3d/base.pyx  # Timed out\nsage -t --warn-long 121.7 src/doc/en/prep/Calculus.rst  # Killed due to segmentation fault\nsage -t --warn-long 121.7 src/sage/modular/local_comp/type_space.py  # Timed out\nsage -t --warn-long 121.7 src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed\nsage -t --warn-long 121.7 src/sage/schemes/projective/projective_morphism.py  # 4 doctests failed\nsage -t --warn-long 121.7 src/sage/misc/randstate.pyx  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/arith/misc.py  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/structure/element.pyx  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/doctest/test.py  # Timed out\nsage -t --warn-long 121.7 src/sage/tests/french_book/mpoly.py  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 4 doctests failed\nsage -t --warn-long 121.7 src/sage/homology/simplicial_complex.py  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/plot/misc.py  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/interfaces/singular.py  # 3 doctests failed\nsage -t --warn-long 121.7 src/sage/rings/polynomial/multi_polynomial_libsingular.pyx  # 4 doctests failedsage -t --warn-long 121.7 src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort\nsage -t --warn-long 121.7 src/sage/libs/singular/function.pyx  # 6 doctests failed\nsage -t --warn-long 121.7 src/sage/rings/multi_power_series_ring_element.py  # 2 doctests failed\nsage -t --warn-long 121.7 src/sage/rings/polynomial/polynomial_singular_interface.py  # 3 doctests failed\nsage -t --warn-long 121.7 src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx  # 1 doctest failed  \nsage -t --warn-long 121.7 src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed\nsage -t --warn-long 121.7 src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```\nI assume many of them are unrelated to Singular, and due to the POWER7 arch, especially the plots ones.",
    "created_at": "2016-08-17T15:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240415",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>Things seem good.
A ptest yeilds:

```
sage -t --warn-long 121.7 src/doc/en/prep/Advanced-2DPlotting.rst  # Killed due 
to segmentation fault
sage -t --warn-long 121.7 src/sage/calculus/riemann.pyx  # Timed out (and interr
upt failed)
sage -t --warn-long 121.7 src/sage/schemes/elliptic_curves/isogeny_small_degree.
py  # Killed due to segmentation fault
sage -t --warn-long 121.7 src/sage/schemes/elliptic_curves/ell_number_field.py  
# Timed out
sage -t --warn-long 121.7 src/sage/libs/gap/all_documented_functions.py  # Timed
 out
sage -t --warn-long 121.7 src/sage/plot/plot.py  # Timed out
sage -t --warn-long 121.7 src/sage/libs/gap/assigned_names.py  # Timed out
sage -t --warn-long 121.7 src/sage/finance/time_series.pyx  # Timed out
sage -t --warn-long 121.7 src/sage/plot/plot3d/implicit_plot3d.py  # Timed out
sage -t --warn-long 121.7 src/sage/plot/plot3d/parametric_plot3d.py  # Timed out
sage -t --warn-long 121.7 src/sage/plot/plot3d/plot3d.py  # Timed out
sage -t --warn-long 121.7 src/sage/plot/graphics.py  # Timed out
sage -t --warn-long 121.7 src/sage/plot/plot3d/base.pyx  # Timed out
sage -t --warn-long 121.7 src/doc/en/prep/Calculus.rst  # Killed due to segmentation fault
sage -t --warn-long 121.7 src/sage/modular/local_comp/type_space.py  # Timed out
sage -t --warn-long 121.7 src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed
sage -t --warn-long 121.7 src/sage/schemes/projective/projective_morphism.py  # 4 doctests failed
sage -t --warn-long 121.7 src/sage/misc/randstate.pyx  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/arith/misc.py  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/structure/element.pyx  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/doctest/test.py  # Timed out
sage -t --warn-long 121.7 src/sage/tests/french_book/mpoly.py  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 4 doctests failed
sage -t --warn-long 121.7 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/plot/misc.py  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/interfaces/singular.py  # 3 doctests failed
sage -t --warn-long 121.7 src/sage/rings/polynomial/multi_polynomial_libsingular.pyx  # 4 doctests failedsage -t --warn-long 121.7 src/sage/schemes/affine/affine_rational_point.py  # Killed due to abort
sage -t --warn-long 121.7 src/sage/libs/singular/function.pyx  # 6 doctests failed
sage -t --warn-long 121.7 src/sage/rings/multi_power_series_ring_element.py  # 2 doctests failed
sage -t --warn-long 121.7 src/sage/rings/polynomial/polynomial_singular_interface.py  # 3 doctests failed
sage -t --warn-long 121.7 src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx  # 1 doctest failed  
sage -t --warn-long 121.7 src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed
sage -t --warn-long 121.7 src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed
----------------------------------------------------------------------
```
I assume many of them are unrelated to Singular, and due to the POWER7 arch, especially the plots ones.



---

archive/issue_comments_240416.json:
```json
{
    "body": "<a id='comment:9'></a>The singular related ones seem to be:\n* schemes/elliptic_curves/isogeny_small_degree.py: segfault.\n* modular/modform_hecketriangle/graded_ring_element.py: lots of singular stuff, including coercion.\n* schemes/projective/projective_morphism.py: not sure... something about mpfr!\n* arith/misc.py: representation of finite fields changed, easy to fix.\n* structure/element.pyx: new limitation in max exponent?\n* tests/french_book/mpoly.py: different result, might be just as good as the previous one.\n* rings/polynomial/multi_polynomial_ideal.py: some different results, surely just as good and even better\n* interfaces/singular.py: different Singular printing.\n* rings/polynomial/multi_polynomial_libsingular.pyx: printing and squarefree stuff.\n* schemes/affine/affine_rational_point.py: bad abort.\n* src/sage/libs/singular/function.pyx: hopefully mostly random values changed in internal singular functions.\n* rings/multi_power_series_ring_element.py: printing of power series changed.\n* rings/polynomial/polynomial_singular_interface.py: printing changed.\n* rings/polynomial/multi_polynomial_ideal_libsingular.pyx: different result, might be just as good.\n* schemes/jacobians/abstract_jacobian.py: coercion error?\n* rings/polynomial/polydict.pyx: printing of polys changed (x -> 1*x).",
    "created_at": "2016-08-17T15:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240416",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>The singular related ones seem to be:
* schemes/elliptic_curves/isogeny_small_degree.py: segfault.
* modular/modform_hecketriangle/graded_ring_element.py: lots of singular stuff, including coercion.
* schemes/projective/projective_morphism.py: not sure... something about mpfr!
* arith/misc.py: representation of finite fields changed, easy to fix.
* structure/element.pyx: new limitation in max exponent?
* tests/french_book/mpoly.py: different result, might be just as good as the previous one.
* rings/polynomial/multi_polynomial_ideal.py: some different results, surely just as good and even better
* interfaces/singular.py: different Singular printing.
* rings/polynomial/multi_polynomial_libsingular.pyx: printing and squarefree stuff.
* schemes/affine/affine_rational_point.py: bad abort.
* src/sage/libs/singular/function.pyx: hopefully mostly random values changed in internal singular functions.
* rings/multi_power_series_ring_element.py: printing of power series changed.
* rings/polynomial/polynomial_singular_interface.py: printing changed.
* rings/polynomial/multi_polynomial_ideal_libsingular.pyx: different result, might be just as good.
* schemes/jacobians/abstract_jacobian.py: coercion error?
* rings/polynomial/polydict.pyx: printing of polys changed (x -> 1*x).



---

archive/issue_comments_240417.json:
```json
{
    "body": "<a id='comment:0'></a>Automake complains about `LIBTOOL` not being defined although libtool is used.\n\nAnd finally I'm getting: `curl: command not found`... :-)",
    "created_at": "2016-08-17T16:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240417",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:0'></a>Automake complains about `LIBTOOL` not being defined although libtool is used.

And finally I'm getting: `curl: command not found`... :-)



---

archive/issue_comments_240418.json:
```json
{
    "body": "<a id='comment:1'></a>Thread for the \"1*\" issue:\nhttps://groups.google.com/forum/#!topic/libsingular-devel/X29-H_bv9-4",
    "created_at": "2016-08-19T10:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240418",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>Thread for the "1*" issue:
https://groups.google.com/forum/#!topic/libsingular-devel/X29-H_bv9-4



---

archive/issue_comments_240419.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-19T10:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240420.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-19T14:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240421.json:
```json
{
    "body": "<a id='comment:4'></a>As a sidenote, if we really want to stick to a finite ring structure rather than a finite field structure for Z/2Z and Z/pZ, we could do so.\nHans fixed the \"1*\" disturbing behavior.",
    "created_at": "2016-08-19T14:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240421",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>As a sidenote, if we really want to stick to a finite ring structure rather than a finite field structure for Z/2Z and Z/pZ, we could do so.
Hans fixed the "1*" disturbing behavior.



---

archive/issue_comments_240422.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-19T15:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240423.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-19T15:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240424.json:
```json
{
    "body": "<a id='comment:7'></a>For the segfault in `schemes/elliptic_curves/isogeny_small_degree.py` it seems that the following commit now triggers a double free or invalid free (use MALLOC_CHECK_=3 or it will just fails somewhere else randomly):\n* https://github.com/sagemath/sage/commit/14061a1d40e8a27d86eac6dd91559b0131f9fe55\n\n`@`Volker: could you have a look?",
    "created_at": "2016-08-19T17:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240424",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>For the segfault in `schemes/elliptic_curves/isogeny_small_degree.py` it seems that the following commit now triggers a double free or invalid free (use MALLOC_CHECK_=3 or it will just fails somewhere else randomly):
* https://github.com/sagemath/sage/commit/14061a1d40e8a27d86eac6dd91559b0131f9fe55

`@`Volker: could you have a look?



---

archive/issue_comments_240425.json:
```json
{
    "body": "<a id='comment:238'></a>Replying to [comment:237 jpflori]:\n> For the segfault in `schemes/elliptic_curves/isogeny_small_degree.py` it seems that the following commit now triggers a double free or invalid free (use MALLOC_CHECK_=3 or it will just fails somewhere else randomly):\n> * https://github.com/sagemath/sage/commit/14061a1d40e8a27d86eac6dd91559b0131f9fe55\n\n\nKind of painfuly got it:\n* nlNormalize(x) can free whatever is in x and change x from a struct to a disqguised int.\n* when calling sa2si on a polynomial we call nlGetDenom or such functions on pointers returned by p_GetCoeff for the coeffs, which in turn call nlNormalize and free the underlying memory and modify our pointer, but not the original pointers in the polynomial\n* we call p_Delete on the polynomial which call nlDelete on the coeff which gives no indication the underlying memory is freed\n* bang",
    "created_at": "2016-08-20T20:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240425",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:238'></a>Replying to [comment:237 jpflori]:
> For the segfault in `schemes/elliptic_curves/isogeny_small_degree.py` it seems that the following commit now triggers a double free or invalid free (use MALLOC_CHECK_=3 or it will just fails somewhere else randomly):
> * https://github.com/sagemath/sage/commit/14061a1d40e8a27d86eac6dd91559b0131f9fe55


Kind of painfuly got it:
* nlNormalize(x) can free whatever is in x and change x from a struct to a disqguised int.
* when calling sa2si on a polynomial we call nlGetDenom or such functions on pointers returned by p_GetCoeff for the coeffs, which in turn call nlNormalize and free the underlying memory and modify our pointer, but not the original pointers in the polynomial
* we call p_Delete on the polynomial which call nlDelete on the coeff which gives no indication the underlying memory is freed
* bang



---

archive/issue_comments_240426.json:
```json
{
    "body": "<a id='comment:9'></a>The solution would be something like calling p_SetCoeff whenever we call p_GetCoeff to be sure any hackish modification gets transmitted back to the original place.",
    "created_at": "2016-08-20T20:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240426",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>The solution would be something like calling p_SetCoeff whenever we call p_GetCoeff to be sure any hackish modification gets transmitted back to the original place.



---

archive/issue_comments_240427.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T15:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240428.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-23T08:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240429.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-23T20:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240430.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-23T23:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240430",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240431.json:
```json
{
    "body": "<a id='comment:4'></a>Here is the current state of affairs for `make testlong` on a POWER7/\n\n```\nsage -t --long src/sage/misc/randstate.pyx  # 1 doctest failed\nsage -t --long src/sage/symbolic/function.pyx  # 1 doctest failed\nsage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed\nsage -t --long src/sage/calculus/riemann.pyx  # 2 doctests failed\nsage -t --long src/sage/schemes/projective/projective_morphism.py  # Timed out\nsage -t --long src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed\nsage -t --long src/sage/schemes/curves/projective_curve.py  # 2 doctests failed\nsage -t --long src/sage/schemes/curves/affine_curve.py  # 1 doctest failed\nsage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed\nsage -t --long src/sage/finance/time_series.pyx  # 6 doctests failed\nsage -t --long src/sage/plot/graphics.py  # 1 doctest failed\nsage -t --long src/sage/plot/contour_plot.py  # Killed due to segmentation fault\nsage -t --long src/sage/plot/misc.py  # 1 doctest failed\nsage -t --long src/sage/plot/plot.py  # 1 doctest failed\nsage -t --long src/sage/plot/matrix_plot.py  # Killed due to segmentation fault\nsage -t --long src/sage/tests/french_book/mpoly.py  # 2 doctests failed\nsage -t --long src/sage/libs/singular/function.pyx  # 6 doctests failed\nsage -t --long src/doc/en/prep/Advanced-2DPlotting.rst  # Killed due to segmentation fault\nsage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 14 doctests failed\n```",
    "created_at": "2016-08-25T08:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240431",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Here is the current state of affairs for `make testlong` on a POWER7/

```
sage -t --long src/sage/misc/randstate.pyx  # 1 doctest failed
sage -t --long src/sage/symbolic/function.pyx  # 1 doctest failed
sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed
sage -t --long src/sage/calculus/riemann.pyx  # 2 doctests failed
sage -t --long src/sage/schemes/projective/projective_morphism.py  # Timed out
sage -t --long src/sage/schemes/jacobians/abstract_jacobian.py  # 1 doctest failed
sage -t --long src/sage/schemes/curves/projective_curve.py  # 2 doctests failed
sage -t --long src/sage/schemes/curves/affine_curve.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed
sage -t --long src/sage/finance/time_series.pyx  # 6 doctests failed
sage -t --long src/sage/plot/graphics.py  # 1 doctest failed
sage -t --long src/sage/plot/contour_plot.py  # Killed due to segmentation fault
sage -t --long src/sage/plot/misc.py  # 1 doctest failed
sage -t --long src/sage/plot/plot.py  # 1 doctest failed
sage -t --long src/sage/plot/matrix_plot.py  # Killed due to segmentation fault
sage -t --long src/sage/tests/french_book/mpoly.py  # 2 doctests failed
sage -t --long src/sage/libs/singular/function.pyx  # 6 doctests failed
sage -t --long src/doc/en/prep/Advanced-2DPlotting.rst  # Killed due to segmentation fault
sage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 14 doctests failed
```



---

archive/issue_comments_240432.json:
```json
{
    "body": "<a id='comment:5'></a>\n```\nmisc/randstate.pyx  # 1 doctest failed: unrelated, gap random different\nsymbolic/function.pyx  # 1 doctest failed: unrelated, precision issue\nmodular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed: singular, real coeffs printing with parenthesis\ncalculus/riemann.pyx  # 2 doctests failed: unrelated, precision issue\nschemes/projective/projective_morphism.py  # Timed out: singular, real parsing \nschemes/jacobians/abstract_jacobian.py  # 1 doctest failed: singular, real parsing\nschemes/curves/projective_curve.py  # 2 doctests failed: singular, real parsing\nschemes/curves/affine_curve.py  # 1 doctest failed: singular, different result\nrings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed: singular, gwalk and skipping text issue\nfinance/time_series.pyx  # 6 doctests failed: unrelated, precision issue\nplot/graphics.py  # 1 doctest failed: unrelated, div by 0\nplot/contour_plot.py  # Killed due to segmentation fault: passed the second time\nplot/misc.py  # 1 doctest failed: unrelated, div by 0\nplot/plot.py  # 1 doctest failed: unrelated, div by 0\nplot/matrix_plot.py  # Killed due to segmentation fault: passed the second time\ntests/french_book/mpoly.py  # 2 doctests failed: singular, gwalk and skipping text issue\nlibs/singular/function.pyx  # 6 doctests failed: singular, arity code changes and skipping text issue\n```\n\n```\nen/prep/Advanced-2DPlotting.rst  # Killed due to segmentation fault: passed the second time\nen/constructions/algebraic_geometry.rst  # 14 doctests failed: singular, stuff in brnoeth.lib, undefined stuff\n```",
    "created_at": "2016-08-25T12:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240432",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
```
misc/randstate.pyx  # 1 doctest failed: unrelated, gap random different
symbolic/function.pyx  # 1 doctest failed: unrelated, precision issue
modular/modform_hecketriangle/graded_ring_element.py  # 7 doctests failed: singular, real coeffs printing with parenthesis
calculus/riemann.pyx  # 2 doctests failed: unrelated, precision issue
schemes/projective/projective_morphism.py  # Timed out: singular, real parsing 
schemes/jacobians/abstract_jacobian.py  # 1 doctest failed: singular, real parsing
schemes/curves/projective_curve.py  # 2 doctests failed: singular, real parsing
schemes/curves/affine_curve.py  # 1 doctest failed: singular, different result
rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed: singular, gwalk and skipping text issue
finance/time_series.pyx  # 6 doctests failed: unrelated, precision issue
plot/graphics.py  # 1 doctest failed: unrelated, div by 0
plot/contour_plot.py  # Killed due to segmentation fault: passed the second time
plot/misc.py  # 1 doctest failed: unrelated, div by 0
plot/plot.py  # 1 doctest failed: unrelated, div by 0
plot/matrix_plot.py  # Killed due to segmentation fault: passed the second time
tests/french_book/mpoly.py  # 2 doctests failed: singular, gwalk and skipping text issue
libs/singular/function.pyx  # 6 doctests failed: singular, arity code changes and skipping text issue
```

```
en/prep/Advanced-2DPlotting.rst  # Killed due to segmentation fault: passed the second time
en/constructions/algebraic_geometry.rst  # 14 doctests failed: singular, stuff in brnoeth.lib, undefined stuff
```



---

archive/issue_comments_240433.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T12:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240434.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T12:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240435.json:
```json
{
    "body": "<a id='comment:8'></a>So we're hopefully left with:\n* bug in mprimedec.lib (https://groups.google.com/forum/#!topic/libsingular-devel/94d9c574uvg)\n* bug in brnoeth.lib (https://groups.google.com/forum/#!topic/libsingular-devel/DxjhbYqVfFQ)\n* gwalk issue\n* the \"skipping text in `parameter`\" output (when doing GB computations?)",
    "created_at": "2016-08-25T13:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240435",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>So we're hopefully left with:
* bug in mprimedec.lib (https://groups.google.com/forum/#!topic/libsingular-devel/94d9c574uvg)
* bug in brnoeth.lib (https://groups.google.com/forum/#!topic/libsingular-devel/DxjhbYqVfFQ)
* gwalk issue
* the "skipping text in `parameter`" output (when doing GB computations?)



---

archive/issue_comments_240436.json:
```json
{
    "body": "<a id='comment:9'></a>The grwalk thing must be:\n* https://github.com/Singular/Sources/commit/53aa95a962b7ad2b6b48f9f308a22948c39cc41f",
    "created_at": "2016-08-25T13:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240436",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>The grwalk thing must be:
* https://github.com/Singular/Sources/commit/53aa95a962b7ad2b6b48f9f308a22948c39cc41f



---

archive/issue_comments_240437.json:
```json
{
    "body": "<a id='comment:0'></a>In fact the grwalk and brnoeth issues were caused by old `lib` files in `local/share/singular`.\nAlready fixed upstream.",
    "created_at": "2016-08-25T14:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240437",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>In fact the grwalk and brnoeth issues were caused by old `lib` files in `local/share/singular`.
Already fixed upstream.



---

archive/issue_comments_240438.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T14:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240438",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240439.json:
```json
{
    "body": "<a id='comment:2'></a>We're almost good now:\n* the \"skipping text from `parameter`\" text only appears when an error previously happened in Singular, so we it now only appears when testing `libs/singular/function.pyx` becasuse of the `GTZmod` error.\n* hopefully the `GTZmod` error will be fixed upstream soon and we can fix a commit to incule here (which should be more or less official Singular `4.0.3`).\n\nCan someone else please test the current branch?\nYou'll need to build your own tarball first using `spkg-src`.\n\n(There will still be some polishing to do about the Singular C++ function we use, see the comments Hans added in some header files, but that can wait for another ticket.)",
    "created_at": "2016-08-26T09:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240439",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>We're almost good now:
* the "skipping text from `parameter`" text only appears when an error previously happened in Singular, so we it now only appears when testing `libs/singular/function.pyx` becasuse of the `GTZmod` error.
* hopefully the `GTZmod` error will be fixed upstream soon and we can fix a commit to incule here (which should be more or less official Singular `4.0.3`).

Can someone else please test the current branch?
You'll need to build your own tarball first using `spkg-src`.

(There will still be some polishing to do about the Singular C++ function we use, see the comments Hans added in some header files, but that can wait for another ticket.)



---

archive/issue_comments_240440.json:
```json
{
    "body": "<a id='comment:3'></a>Oh crap, we should also reenable the possibility of debug builds.\nIIRC this was removed at some point in this ticket.",
    "created_at": "2016-08-26T09:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240440",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>Oh crap, we should also reenable the possibility of debug builds.
IIRC this was removed at some point in this ticket.



---

archive/issue_comments_240441.json:
```json
{
    "body": "<a id='comment:4'></a>But that can wait for another ticket as well (at least the replace omalloc by malloc stuff).",
    "created_at": "2016-08-26T09:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240441",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>But that can wait for another ticket as well (at least the replace omalloc by malloc stuff).



---

archive/issue_comments_240442.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T13:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240443.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T14:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240444.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T14:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240444",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240445.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T14:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240446.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-26T14:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240446",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_240447.json:
```json
{
    "body": "<a id='comment:9'></a>Setting `SAGE_DEBUG=yes`, debug mode with `xalloc` should be ok although:\n* I did not wait for the build to finish,\n* it seems auto* wants to reconfigure everything,\n* you get a alot of unsued stuff warnings but that's surely normal.\n\nI removed a bunch of hacks from `spkg-install`.\n\nPlease test!",
    "created_at": "2016-08-26T14:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240447",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Setting `SAGE_DEBUG=yes`, debug mode with `xalloc` should be ok although:
* I did not wait for the build to finish,
* it seems auto* wants to reconfigure everything,
* you get a alot of unsued stuff warnings but that's surely normal.

I removed a bunch of hacks from `spkg-install`.

Please test!



---

archive/issue_comments_240448.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n+Build system completely changed, and a lot of internal stuff.\n \n+The branch here is based on commit a070b84d whose message tells 4.0.3p3:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+Make your own tarball with `SINGULAR_GIT_COMMIT=a070b84d spkg-src`.\n+This is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-08-26T14:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240448",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
+Build system completely changed, and a lot of internal stuff.
 
+The branch here is based on commit a070b84d whose message tells 4.0.3p3:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+Make your own tarball with `SINGULAR_GIT_COMMIT=a070b84d spkg-src`.
+This is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240449.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T14:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240450.json:
```json
{
    "body": "<a id='comment:2'></a>the branch does not merge cleanly (so I had to do some manual editing), and after building singular I get\n\n```\n[sagelib-7.4.beta1] ************************************************************************\n[sagelib-7.4.beta1] Traceback (most recent call last):\n[sagelib-7.4.beta1]   File \"setup.py\", line 47, in <module>\n[sagelib-7.4.beta1]     from module_list import ext_modules, library_order, aliases\n[sagelib-7.4.beta1]   File \"/home/dima/software/sage/src/module_list.py\", line 1587, in <module>\n[sagelib-7.4.beta1]     extra_compile_args = givaro_extra_compile_args),\n[sagelib-7.4.beta1] NameError: name 'givaro_extra_compile_args' is not defined\n[sagelib-7.4.beta1] ************************************************************************\n[sagelib-7.4.beta1] Error building the Sage library\n```\n\nalthough this might be due to me trying to merge this into the branch on #17635\n(which should probably become a dependency here)",
    "created_at": "2016-08-26T15:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240450",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>the branch does not merge cleanly (so I had to do some manual editing), and after building singular I get

```
[sagelib-7.4.beta1] ************************************************************************
[sagelib-7.4.beta1] Traceback (most recent call last):
[sagelib-7.4.beta1]   File "setup.py", line 47, in <module>
[sagelib-7.4.beta1]     from module_list import ext_modules, library_order, aliases
[sagelib-7.4.beta1]   File "/home/dima/software/sage/src/module_list.py", line 1587, in <module>
[sagelib-7.4.beta1]     extra_compile_args = givaro_extra_compile_args),
[sagelib-7.4.beta1] NameError: name 'givaro_extra_compile_args' is not defined
[sagelib-7.4.beta1] ************************************************************************
[sagelib-7.4.beta1] Error building the Sage library
```

although this might be due to me trying to merge this into the branch on #17635
(which should probably become a dependency here)



---

archive/issue_comments_240451.json:
```json
{
    "body": "<a id='comment:3'></a>It built okay for me on my Ubunutu 16.04 LTS system.\n\nAlso, I think we should set a fixed tarball and checksum. Do you want me to do this?",
    "created_at": "2016-08-26T17:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240451",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>It built okay for me on my Ubunutu 16.04 LTS system.

Also, I think we should set a fixed tarball and checksum. Do you want me to do this?



---

archive/issue_comments_240452.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-27T06:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240452",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240453.json:
```json
{
    "body": "<a id='comment:4'></a>The upgrade of givaro on #17635 has to be taken into account here.",
    "created_at": "2016-08-27T06:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240453",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>The upgrade of givaro on #17635 has to be taken into account here.



---

archive/issue_comments_240454.json:
```json
{
    "body": "<a id='comment:265'></a>Replying to [comment:263 tscrim]:\n>\n> Also, I think we should set a fixed tarball and checksum. Do you want me to do this?\n\n\nI don't follow the ticket very closely, but that makes me jump: what about taking an upstream tarball instead of hacking something?",
    "created_at": "2016-08-27T07:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240454",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:265'></a>Replying to [comment:263 tscrim]:
>
> Also, I think we should set a fixed tarball and checksum. Do you want me to do this?


I don't follow the ticket very closely, but that makes me jump: what about taking an upstream tarball instead of hacking something?



---

archive/issue_comments_240455.json:
```json
{
    "body": "<a id='comment:266'></a>Replying to [comment:265 Snark]:\n> Replying to [comment:263 tscrim]:\n> >\n> > Also, I think we should set a fixed tarball and checksum. Do you want me to do this?\n\n> \n> I don't follow the ticket very closely, but that makes me jump: what about taking an upstream tarball instead of hacking something?\n\n\nWIP / moving target:\n\n```\ncommit 117ae9c7dde9eb9fcaa4cb899cfb7690addd6dfe\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Fri Aug 26 18:47:06 2016 +0200\n\n    opt: prefer unsigned over int in for loops\n\ncommit f5e732af7572071c189ad8185ce830f96ababa46\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Fri Aug 26 18:46:40 2016 +0200\n\n    compiler warnings\n\ncommit 6e28802f29d0fee351ccab022adc6853e46bd3fe\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Wed Aug 24 17:18:54 2016 +0200\n\n    opt: use id_Delete in syz1.cc\n\ncommit 84963dfd52839fd9d4215c5d5b0534e80417dfad\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Wed Aug 24 16:42:29 2016 +0200\n\n    opt: NULL in syResolvente->*res\n\ncommit 495258ce8ff8e5b1376e6c7fa8ae2815387e8b4a\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Mon Aug 22 16:04:20 2016 +0200\n\n    removed wrong warning (see Tst/Plural/doc-module-ops.tst)\n\ncommit 32e84f5b8f065a8070d982ae939de64e4721beab\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Mon Aug 22 16:03:02 2016 +0200\n\n    removed AlgDep-qso3-dp.tst from Plural/short.lst: also in Plural.lst\n\ncommit a070b84d59be835a2946d1386edd3221d80f3fe7\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Fri Aug 19 16:56:16 2016 +0200\n\n    Singular 4.0.3p3\n\ncommit 961c76da92efc86885b6506c8c83262f14e705ff\nAuthor: Hans Schoenemann <hannes@mathematik.uni-kl.de>\nDate:   Fri Aug 19 16:34:25 2016 +0200\n\n    chg: n_IsMOne for Z/2: maybe n_Zp, n_Zn, n_Z2m\n\n...\n```",
    "created_at": "2016-08-27T13:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240455",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:266'></a>Replying to [comment:265 Snark]:
> Replying to [comment:263 tscrim]:
> >
> > Also, I think we should set a fixed tarball and checksum. Do you want me to do this?

> 
> I don't follow the ticket very closely, but that makes me jump: what about taking an upstream tarball instead of hacking something?


WIP / moving target:

```
commit 117ae9c7dde9eb9fcaa4cb899cfb7690addd6dfe
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Fri Aug 26 18:47:06 2016 +0200

    opt: prefer unsigned over int in for loops

commit f5e732af7572071c189ad8185ce830f96ababa46
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Fri Aug 26 18:46:40 2016 +0200

    compiler warnings

commit 6e28802f29d0fee351ccab022adc6853e46bd3fe
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Wed Aug 24 17:18:54 2016 +0200

    opt: use id_Delete in syz1.cc

commit 84963dfd52839fd9d4215c5d5b0534e80417dfad
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Wed Aug 24 16:42:29 2016 +0200

    opt: NULL in syResolvente->*res

commit 495258ce8ff8e5b1376e6c7fa8ae2815387e8b4a
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Mon Aug 22 16:04:20 2016 +0200

    removed wrong warning (see Tst/Plural/doc-module-ops.tst)

commit 32e84f5b8f065a8070d982ae939de64e4721beab
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Mon Aug 22 16:03:02 2016 +0200

    removed AlgDep-qso3-dp.tst from Plural/short.lst: also in Plural.lst

commit a070b84d59be835a2946d1386edd3221d80f3fe7
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Fri Aug 19 16:56:16 2016 +0200

    Singular 4.0.3p3

commit 961c76da92efc86885b6506c8c83262f14e705ff
Author: Hans Schoenemann <hannes@mathematik.uni-kl.de>
Date:   Fri Aug 19 16:34:25 2016 +0200

    chg: n_IsMOne for Z/2: maybe n_Zp, n_Zn, n_Z2m

...
```



---

archive/issue_comments_240456.json:
```json
{
    "body": "<a id='comment:7'></a>Minor thing:  All error messages in `spkg-install` should start with `\"Error`[`:`]` ...\"`.\n\n`spkg-src` could be beautified a bit as well (e.g. not unconditionally deleting `singular.git`, and recording what we checked out, error checking), besides that `curl` is non-standard... ;-)",
    "created_at": "2016-08-27T13:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240456",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>Minor thing:  All error messages in `spkg-install` should start with `"Error`[`:`]` ..."`.

`spkg-src` could be beautified a bit as well (e.g. not unconditionally deleting `singular.git`, and recording what we checked out, error checking), besides that `curl` is non-standard... ;-)



---

archive/issue_comments_240457.json:
```json
{
    "body": "<a id='comment:8'></a>P.S.:  I'd prefer to not use `-lSingular`, but create a symlink from lower to uppercase instead.",
    "created_at": "2016-08-27T13:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240457",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>P.S.:  I'd prefer to not use `-lSingular`, but create a symlink from lower to uppercase instead.



---

archive/issue_comments_240458.json:
```json
{
    "body": "<a id='comment:9'></a>aclocal is currently a dependency, probably due to warnings treated as errors:\n\n```\n[singular-4.0.3p3] config.status: executing libtool commands\n[singular-4.0.3p3] ### Singular spkg-install: build_singular ###\n[singular-4.0.3p3] make[3]: Entering directory '/home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest'\n[singular-4.0.3p3] CDPATH=\"${ZSH_VERSION+.}:\" && cd . && /bin/sh /home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest/build-aux/missing aclocal-1.14 -I m4\n[singular-4.0.3p3] /home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest/build-aux/missing: line 81: aclocal-1.14: command not found\n[singular-4.0.3p3] WARNING: 'aclocal-1.14' is missing on your system.\n[singular-4.0.3p3]          You should only need it if you modified 'acinclude.m4' or\n[singular-4.0.3p3]          'configure.ac' or m4 files included by 'configure.ac'.\n[singular-4.0.3p3]          The 'aclocal' program is part of the GNU Automake package:\n[singular-4.0.3p3]          <http://www.gnu.org/software/automake>\n[singular-4.0.3p3]          It also requires GNU Autoconf, GNU m4 and Perl in order to run:\n[singular-4.0.3p3]          <http://www.gnu.org/software/autoconf>\n[singular-4.0.3p3]          <http://www.gnu.org/software/m4/>\n[singular-4.0.3p3]          <http://www.perl.org/>\n[singular-4.0.3p3] make[3]: *** [Makefile:485: aclocal.m4] Error 127\n[singular-4.0.3p3] make[3]: Leaving directory '/home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest'\n[singular-4.0.3p3] \n[singular-4.0.3p3] real\t0m28.318s\n[singular-4.0.3p3] user\t0m13.437s\n[singular-4.0.3p3] sys\t0m4.493s\n[singular-4.0.3p3] ************************************************************************\n[singular-4.0.3p3] Error installing package singular-4.0.3p3\n[singular-4.0.3p3] ************************************************************************\n```\nonly caught this as I'm setting up a new laptop :-)",
    "created_at": "2016-08-27T16:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240458",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>aclocal is currently a dependency, probably due to warnings treated as errors:

```
[singular-4.0.3p3] config.status: executing libtool commands
[singular-4.0.3p3] ### Singular spkg-install: build_singular ###
[singular-4.0.3p3] make[3]: Entering directory '/home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest'
[singular-4.0.3p3] CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/sh /home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest/build-aux/missing aclocal-1.14 -I m4
[singular-4.0.3p3] /home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest/build-aux/missing: line 81: aclocal-1.14: command not found
[singular-4.0.3p3] WARNING: 'aclocal-1.14' is missing on your system.
[singular-4.0.3p3]          You should only need it if you modified 'acinclude.m4' or
[singular-4.0.3p3]          'configure.ac' or m4 files included by 'configure.ac'.
[singular-4.0.3p3]          The 'aclocal' program is part of the GNU Automake package:
[singular-4.0.3p3]          <http://www.gnu.org/software/automake>
[singular-4.0.3p3]          It also requires GNU Autoconf, GNU m4 and Perl in order to run:
[singular-4.0.3p3]          <http://www.gnu.org/software/autoconf>
[singular-4.0.3p3]          <http://www.gnu.org/software/m4/>
[singular-4.0.3p3]          <http://www.perl.org/>
[singular-4.0.3p3] make[3]: *** [Makefile:485: aclocal.m4] Error 127
[singular-4.0.3p3] make[3]: Leaving directory '/home/dima/Sage/sage/local/var/tmp/sage/build/singular-4.0.3p3/src/latest'
[singular-4.0.3p3] 
[singular-4.0.3p3] real	0m28.318s
[singular-4.0.3p3] user	0m13.437s
[singular-4.0.3p3] sys	0m4.493s
[singular-4.0.3p3] ************************************************************************
[singular-4.0.3p3] Error installing package singular-4.0.3p3
[singular-4.0.3p3] ************************************************************************
```
only caught this as I'm setting up a new laptop :-)



---

archive/issue_comments_240459.json:
```json
{
    "body": "<a id='comment:0'></a>I have aclocal-1.15, but it insists on 1.14; weird, no?",
    "created_at": "2016-08-27T16:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240459",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>I have aclocal-1.15, but it insists on 1.14; weird, no?



---

archive/issue_comments_240460.json:
```json
{
    "body": "<a id='comment:271'></a>Replying to [comment:269 dimpase]:\n> aclocal is currently a dependency\n\n\nThis should be fixed by running the necessary autotools in `spkg-src`.",
    "created_at": "2016-08-27T17:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240460",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:271'></a>Replying to [comment:269 dimpase]:
> aclocal is currently a dependency


This should be fixed by running the necessary autotools in `spkg-src`.



---

archive/issue_comments_240461.json:
```json
{
    "body": "<a id='comment:272'></a>Replying to [comment:271 jdemeyer]:\n> Replying to [comment:269 dimpase]:\n> > aclocal is currently a dependency\n\n> \n> This should be fixed by running the necessary autotools in `spkg-src`.\n\n\nAC_REQUIRE proper timestamps.",
    "created_at": "2016-08-27T17:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240461",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:272'></a>Replying to [comment:271 jdemeyer]:
> Replying to [comment:269 dimpase]:
> > aclocal is currently a dependency

> 
> This should be fixed by running the necessary autotools in `spkg-src`.


AC_REQUIRE proper timestamps.



---

archive/issue_comments_240462.json:
```json
{
    "body": "<a id='comment:273'></a>Replying to [comment:271 jdemeyer]:\n> Replying to [comment:269 dimpase]:\n> > aclocal is currently a dependency\n\n> \n> This should be fixed by running the necessary autotools in `spkg-src`.\n\n\nI did make the tarball using `spkg-src`, as described.\nI guess it's an upstream bug: they don't detect presence of aclocal-1.14, even though they don't need it, and bail out, even though it's meant to be a warning. \n\nAny, why `1.14` only? Won't they be happy with `1.14` or newer?",
    "created_at": "2016-08-27T17:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240462",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:273'></a>Replying to [comment:271 jdemeyer]:
> Replying to [comment:269 dimpase]:
> > aclocal is currently a dependency

> 
> This should be fixed by running the necessary autotools in `spkg-src`.


I did make the tarball using `spkg-src`, as described.
I guess it's an upstream bug: they don't detect presence of aclocal-1.14, even though they don't need it, and bail out, even though it's meant to be a warning. 

Any, why `1.14` only? Won't they be happy with `1.14` or newer?



---

archive/issue_comments_240463.json:
```json
{
    "body": "<a id='comment:4'></a>modulo the following, `ptestlong` passes with the new branch\n\n```\nsage -t --long --warn-long 77.2 src/sage/schemes/curves/affine_curve.py\n**********************************************************************\nFile \"src/sage/schemes/curves/affine_curve.py\", line 494, in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities\nFailed example:\n    C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)\nExpected:\n    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\nGot:\n    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n**********************************************************************\n1 item had failures:\n   1 of  23 in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities\n    [195 tests, 1 failure, 3.51 s]\n```\n\nI don't know enough about resolution of singularities to decide whether the latter output is correct, or not (notice some signs are changed...)\n\n---\nLast 10 new commits:",
    "created_at": "2016-08-27T19:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240463",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>modulo the following, `ptestlong` passes with the new branch

```
sage -t --long --warn-long 77.2 src/sage/schemes/curves/affine_curve.py
**********************************************************************
File "src/sage/schemes/curves/affine_curve.py", line 494, in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities
Failed example:
    C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)
Expected:
    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
Got:
    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
**********************************************************************
1 item had failures:
   1 of  23 in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities
    [195 tests, 1 failure, 3.51 s]
```

I don't know enough about resolution of singularities to decide whether the latter output is correct, or not (notice some signs are changed...)

---
Last 10 new commits:



---

archive/issue_comments_240464.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-27T19:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240464",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_240465.json:
```json
{
    "body": "<a id='comment:5'></a>Could we please not mix commits from different upgrades?\n\nI don't see an immediate reason to base this ticket on #17635 either; they're IMHO better first reviewed independently.",
    "created_at": "2016-08-27T20:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240465",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>Could we please not mix commits from different upgrades?

I don't see an immediate reason to base this ticket on #17635 either; they're IMHO better first reviewed independently.



---

archive/issue_comments_240466.json:
```json
{
    "body": "<a id='comment:6'></a>LGTM at least in principle.  I'm going to try over the next day or two to test how this works on Cygwin64.",
    "created_at": "2016-08-29T10:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240466",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>LGTM at least in principle.  I'm going to try over the next day or two to test how this works on Cygwin64.



---

archive/issue_comments_240467.json:
```json
{
    "body": "<a id='comment:7'></a>Also I guess the milestone for this ticket should be changed?  I don't know what to though.",
    "created_at": "2016-08-29T10:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240467",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Also I guess the milestone for this ticket should be changed?  I don't know what to though.



---

archive/issue_events_049909.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-29T10:34:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49909"
}
```



---

archive/issue_events_049910.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-29T10:34:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49910"
}
```



---

archive/issue_comments_240468.json:
```json
{
    "body": "<a id='comment:278'></a>Replying to [comment:275 leif]:\n> Could we please not mix commits from different upgrades?\n> \n> I don't see an immediate reason to base this ticket on #17635 either; they're IMHO better first reviewed independently.\n\n\nwell, they depend, albeit not too deeply. Perhaps wait for the next beta with #17635 in?",
    "created_at": "2016-08-29T10:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240468",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:278'></a>Replying to [comment:275 leif]:
> Could we please not mix commits from different upgrades?
> 
> I don't see an immediate reason to base this ticket on #17635 either; they're IMHO better first reviewed independently.


well, they depend, albeit not too deeply. Perhaps wait for the next beta with #17635 in?



---

archive/issue_comments_240469.json:
```json
{
    "body": "<a id='comment:9'></a>IMO, we should get this in as soon as we can to get as much testing as we can before it goes into a stable release.",
    "created_at": "2016-08-29T14:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240469",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>IMO, we should get this in as soon as we can to get as much testing as we can before it goes into a stable release.



---

archive/issue_comments_240470.json:
```json
{
    "body": "<a id='comment:280'></a>Replying to [comment:279 tscrim]:\n> IMO, we should get this in as soon as we can to get as much testing as we can before it goes into a stable release.\n\n\n+1; I'm trying to get cygwin testing ASAP, but first I have to get cygwin builds working against the current `develop` (since my cygwin branch is from a couple months' old `develop`).  Should be close to that, but I'd be fine if this is merged in the meantime, and I can open a ticket for any issue I discover later.",
    "created_at": "2016-08-29T16:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240470",
    "user": "https://github.com/embray"
}
```

<a id='comment:280'></a>Replying to [comment:279 tscrim]:
> IMO, we should get this in as soon as we can to get as much testing as we can before it goes into a stable release.


+1; I'm trying to get cygwin testing ASAP, but first I have to get cygwin builds working against the current `develop` (since my cygwin branch is from a couple months' old `develop`).  Should be close to that, but I'd be fine if this is merged in the meantime, and I can open a ticket for any issue I discover later.



---

archive/issue_comments_240471.json:
```json
{
    "body": "<a id='comment:1'></a>#17635 is now closed, so you need to make sure that it doesn't conflict with that ticket.",
    "created_at": "2016-08-30T07:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240471",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>#17635 is now closed, so you need to make sure that it doesn't conflict with that ticket.



---

archive/issue_comments_240472.json:
```json
{
    "body": "<a id='comment:2'></a>...although Volker closes tickets before fully testing them, so there is still a chance that it will be reopened.",
    "created_at": "2016-08-30T07:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240472",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>...although Volker closes tickets before fully testing them, so there is still a chance that it will be reopened.



---

archive/issue_comments_240473.json:
```json
{
    "body": "<a id='comment:283'></a>Replying to [comment:276 embray]:\n> LGTM at least in principle.  I'm going to try over the next day or two to test how this works on Cygwin64.\n\nThx, I absolutely did nothing Cygwin-related on that one.",
    "created_at": "2016-08-30T17:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240473",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:283'></a>Replying to [comment:276 embray]:
> LGTM at least in principle.  I'm going to try over the next day or two to test how this works on Cygwin64.

Thx, I absolutely did nothing Cygwin-related on that one.



---

archive/issue_comments_240474.json:
```json
{
    "body": "<a id='comment:284'></a>Replying to [comment:267 leif]:\n> Minor thing:  All error messages in `spkg-install` should start with `\"Error`[`:`]` ...\"`.\n> \n\nYes.\n> `spkg-src` could be beautified a bit as well (e.g. not unconditionally deleting `singular.git`, and recording what we checked out, error checking), besides that `curl` is non-standard... ;-)\n\nSure but `curl` was already used in the script anyway and that's only to make the tarball, not for end-users.",
    "created_at": "2016-08-31T07:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240474",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:284'></a>Replying to [comment:267 leif]:
> Minor thing:  All error messages in `spkg-install` should start with `"Error`[`:`]` ..."`.
> 

Yes.
> `spkg-src` could be beautified a bit as well (e.g. not unconditionally deleting `singular.git`, and recording what we checked out, error checking), besides that `curl` is non-standard... ;-)

Sure but `curl` was already used in the script anyway and that's only to make the tarball, not for end-users.



---

archive/issue_comments_240475.json:
```json
{
    "body": "<a id='comment:5'></a>I agree that using `curl` in `spkg-src` is not a big issue.",
    "created_at": "2016-08-31T10:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240475",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>I agree that using `curl` in `spkg-src` is not a big issue.



---

archive/issue_comments_240476.json:
```json
{
    "body": "<a id='comment:6'></a>This cannot go into Sage until there is a proper tarball.",
    "created_at": "2016-08-31T10:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240476",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>This cannot go into Sage until there is a proper tarball.



---

archive/issue_events_049911.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-31T10:10:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49911"
}
```



---

archive/issue_events_049912.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-31T10:10:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49912"
}
```



---

archive/issue_comments_240477.json:
```json
{
    "body": "<a id='comment:7'></a>What's the point of this commented-out code? Just remove it.\n\n```\n# C++11 workaround https://trac.sagemath.org/ticket/20926\n# Since https://trac.sagemath.org/ticket/17635 linbox passes a -std=gnu++11 flag, so we no longer need to add it\n# if [ \"$UNAME\" = CYGWIN ]; then\n     # Special case for Cygwin https://trac.sagemath.org/ticket/21185\n#     CXXFLAGS=\"$CXXFLAGS -std=gnu++98\"\n# else\n#     CXXFLAGS=\"$CXXFLAGS -std=c++98\"\n#fi\n```",
    "created_at": "2016-08-31T10:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240477",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>What's the point of this commented-out code? Just remove it.

```
# C++11 workaround https://trac.sagemath.org/ticket/20926
# Since https://trac.sagemath.org/ticket/17635 linbox passes a -std=gnu++11 flag, so we no longer need to add it
# if [ "$UNAME" = CYGWIN ]; then
     # Special case for Cygwin https://trac.sagemath.org/ticket/21185
#     CXXFLAGS="$CXXFLAGS -std=gnu++98"
# else
#     CXXFLAGS="$CXXFLAGS -std=c++98"
#fi
```



---

archive/issue_comments_240478.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n+Build system completely changed, and a lot of internal stuff.\n \n+The branch here is based on commit a070b84d whose message tells 4.0.3p3:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+Make your own tarball with\n+\n+```\n+SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-08-31T10:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240478",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,16 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
+Build system completely changed, and a lot of internal stuff.
 
+The branch here is based on commit a070b84d whose message tells 4.0.3p3:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+Make your own tarball with
+
+```
+SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240479.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n+Build system completely changed, and a lot of internal stuff.\n \n+The branch here is based on commit a070b84d whose message tells 4.0.3p3:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+Make your own tarball with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-08-31T10:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240479",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
+Build system completely changed, and a lot of internal stuff.
 
+The branch here is based on commit a070b84d whose message tells 4.0.3p3:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+Make your own tarball with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240480.json:
```json
{
    "body": "<a id='comment:0'></a>In `build/pkgs/singular/spkg-install`, if you use `set -e`, it is pointless to do manual error checking like\n\n```\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error applying '$patch'\"\n        return 1\n    fi\n```",
    "created_at": "2016-08-31T10:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240480",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>In `build/pkgs/singular/spkg-install`, if you use `set -e`, it is pointless to do manual error checking like

```
    if [ $? -ne 0 ]; then
        echo >&2 "Error applying '$patch'"
        return 1
    fi
```



---

archive/issue_comments_240481.json:
```json
{
    "body": "<a id='comment:1'></a>What's the point of this commented-out code? Just remove it.\n\n```\n #    Extension('sage.libs.linbox.linbox',\n #             sources = ['sage/libs/linbox/linbox.pyx']),\n```\n\nMore generally, better remove all commented-out code unless there is a clear purpose.",
    "created_at": "2016-08-31T10:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240481",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>What's the point of this commented-out code? Just remove it.

```
 #    Extension('sage.libs.linbox.linbox',
 #             sources = ['sage/libs/linbox/linbox.pyx']),
```

More generally, better remove all commented-out code unless there is a clear purpose.



---

archive/issue_comments_240482.json:
```json
{
    "body": "<a id='comment:2'></a>In\n\n```\n    cdef enum n_coeffType:\n        n_unknown=0\n        n_Zp=1 #/**< \\F{p < 2^31} */\n        n_Q=2   #/**< rational (GMP) numbers */\n        [...]\n```\nI would remove the values (like `=0`) because that is only confusing. And please either properly format the comments there or remove them.",
    "created_at": "2016-08-31T10:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240482",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>In

```
    cdef enum n_coeffType:
        n_unknown=0
        n_Zp=1 #/**< \F{p < 2^31} */
        n_Q=2   #/**< rational (GMP) numbers */
        [...]
```
I would remove the values (like `=0`) because that is only confusing. And please either properly format the comments there or remove them.



---

archive/issue_comments_240483.json:
```json
{
    "body": "<a id='comment:3'></a>This is also silly:\n\n```\n            if sizeof(long) > 4:\n\n                # it seems Singular uses ints somewhere\n                # internally, cf. #6051 (Sage) and #138 (Singular)\n\n                if exponent <= 30:  ringtype = n_Z2m\n                else:               ringtype = n_Znm\n            else:\n                if exponent <= 30: ringtype = n_Z2m\n                else:              ringtype = n_Znm\n```\n\nYou can change code of the form\n\n```\nif condition:\n    A\nelse:\n    A\n```\nto\n\n```\nA\n```",
    "created_at": "2016-08-31T10:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240483",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>This is also silly:

```
            if sizeof(long) > 4:

                # it seems Singular uses ints somewhere
                # internally, cf. #6051 (Sage) and #138 (Singular)

                if exponent <= 30:  ringtype = n_Z2m
                else:               ringtype = n_Znm
            else:
                if exponent <= 30: ringtype = n_Z2m
                else:              ringtype = n_Znm
```

You can change code of the form

```
if condition:
    A
else:
    A
```
to

```
A
```



---

archive/issue_comments_240484.json:
```json
{
    "body": "<a id='comment:4'></a>I think this regression is not acceptable:\n\n```\n             sage: P.<x,y,z> = PolynomialRing(QQ)\n             sage: f= x^2 + 2*x*y + 1/2*z\n             sage: f.is_squarefree()\n             Traceback (most recent call last):\n             ...\n             NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.\n```\n\nAsking whether a multivariate polynomial is squarefree seems like a very natural thing to do and not something you should just break.",
    "created_at": "2016-08-31T10:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240484",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>I think this regression is not acceptable:

```
             sage: P.<x,y,z> = PolynomialRing(QQ)
             sage: f= x^2 + 2*x*y + 1/2*z
             sage: f.is_squarefree()
             Traceback (most recent call last):
             ...
             NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.
```

Asking whether a multivariate polynomial is squarefree seems like a very natural thing to do and not something you should just break.



---

archive/issue_comments_240485.json:
```json
{
    "body": "<a id='comment:5'></a>Also, I am not so happy with the regression in exponent overflow but that's a less serious issue.",
    "created_at": "2016-08-31T10:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240485",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Also, I am not so happy with the regression in exponent overflow but that's a less serious issue.



---

archive/issue_comments_240486.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-31T10:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240486",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240487.json:
```json
{
    "body": "<a id='comment:7'></a>Sorry to say this, but the code is really ugly and certainly uglier than it was before. I see lots of annoying things, like unneeded comments, indentation not a multiple of 4 spaces, needlessly complicated code.\n\nI think this requires somebody to go over all the code and clean it up.",
    "created_at": "2016-08-31T11:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240487",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Sorry to say this, but the code is really ugly and certainly uglier than it was before. I see lots of annoying things, like unneeded comments, indentation not a multiple of 4 spaces, needlessly complicated code.

I think this requires somebody to go over all the code and clean it up.



---

archive/issue_comments_240488.json:
```json
{
    "body": "<a id='comment:8'></a>Another example:\n\n```\n    libSingularFound = False\n\n    for extension in [\"so\", \"dylib\", \"dll\"]:\n        lib = os.environ['SAGE_LOCAL']+\"/lib/libSingular.\"+extension # libsingular renamed to libSingular\n        if os.path.exists(lib):\n            libSingularFound = True\n            handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)\n            if not handle:\n                err = dlerror()\n                if err:\n                    print(err)\n            break\n\n    if not libSingularFound :\n        raise OSError(\"did not find libsingular file\")\n\n\n    if handle == NULL:\n        dlerrormsg = dlerror()\n        if dlerrormsg == NULL:\n            dlerrormsg = \"\"\n        raise ImportError(\"failed to dlopen {} ({})\".format(lib, dlerrormsg))\n```\n\nThe `handle == NULL` cannot be reached since we would error out before. The old code is simpler and better:\n\n```\n    for extension in [\"so\", \"dylib\", \"dll\"]:\n        lib = os.environ['SAGE_LOCAL']+\"/lib/libsingular.\"+extension\n        if os.path.exists(lib):\n            handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)\n            if not handle:\n                err = dlerror()\n                if err:\n                    print(err)\n            break\n\n    if handle == NULL:\n        raise ImportError(\"cannot load libSINGULAR library\")\n```\n\nThere was no reason to make the code more complicated, why was it done???",
    "created_at": "2016-08-31T11:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240488",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Another example:

```
    libSingularFound = False

    for extension in ["so", "dylib", "dll"]:
        lib = os.environ['SAGE_LOCAL']+"/lib/libSingular."+extension # libsingular renamed to libSingular
        if os.path.exists(lib):
            libSingularFound = True
            handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)
            if not handle:
                err = dlerror()
                if err:
                    print(err)
            break

    if not libSingularFound :
        raise OSError("did not find libsingular file")


    if handle == NULL:
        dlerrormsg = dlerror()
        if dlerrormsg == NULL:
            dlerrormsg = ""
        raise ImportError("failed to dlopen {} ({})".format(lib, dlerrormsg))
```

The `handle == NULL` cannot be reached since we would error out before. The old code is simpler and better:

```
    for extension in ["so", "dylib", "dll"]:
        lib = os.environ['SAGE_LOCAL']+"/lib/libsingular."+extension
        if os.path.exists(lib):
            handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)
            if not handle:
                err = dlerror()
                if err:
                    print(err)
            break

    if handle == NULL:
        raise ImportError("cannot load libSINGULAR library")
```

There was no reason to make the code more complicated, why was it done???



---

archive/issue_comments_240489.json:
```json
{
    "body": "<a id='comment:9'></a>Another example in `plural.pyx`:\n\n```\ncdef n_coeffType unknownRingtype = n_unknown\n```\n\nWhat's the point of this?",
    "created_at": "2016-08-31T11:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240489",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Another example in `plural.pyx`:

```
cdef n_coeffType unknownRingtype = n_unknown
```

What's the point of this?



---

archive/issue_comments_240490.json:
```json
{
    "body": "<a id='comment:0'></a>To be clear: I am very happy with the work done on this ticket, really. I just feel that it's not ready to merge yet. I also feel that not much effort was done to re-use the existing code, that code was rewritten without reason. That makes it hard to review because the diff is huge.",
    "created_at": "2016-08-31T11:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240490",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>To be clear: I am very happy with the work done on this ticket, really. I just feel that it's not ready to merge yet. I also feel that not much effort was done to re-use the existing code, that code was rewritten without reason. That makes it hard to review because the diff is huge.



---

archive/issue_comments_240491.json:
```json
{
    "body": "<a id='comment:1'></a>No worry Jeroen, that's exactly the point of making a proper review.\nTo this point this ticket is just a heap of changes, hacks, commits by different people to get the new singular working and at least on my side I did not really look at what the other did, especially given the huge diff.\nI'll try to polish the points you mentioned this week.",
    "created_at": "2016-08-31T16:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240491",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>No worry Jeroen, that's exactly the point of making a proper review.
To this point this ticket is just a heap of changes, hacks, commits by different people to get the new singular working and at least on my side I did not really look at what the other did, especially given the huge diff.
I'll try to polish the points you mentioned this week.



---

archive/issue_comments_240492.json:
```json
{
    "body": "<a id='comment:2'></a>At least we have something that works (modulo the `is_squarefree` issue). That is a very important starting point.",
    "created_at": "2016-08-31T16:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240492",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>At least we have something that works (modulo the `is_squarefree` issue). That is a very important starting point.



---

archive/issue_comments_240493.json:
```json
{
    "body": "<a id='comment:303'></a>Replying to [comment:302 jdemeyer]:\n> At least we have something that works (modulo the `is_squarefree` issue). That is a very important starting point.\n\n\nsurely Singular 4.0.3 still has the squarefree test, so it's matter of digging up how it is implemented:\n\n```\n> ring r=0,(x,y),dp;\n> poly p=x^2+2*x*y+y^2;\n>> ring r=0,(x,y),dp;\n> poly p=x^2+2*x*y+y^2;\n> sqrfree(p);\n[1]:\n   _[1]=1\n   _[2]=x+y\n[2]:\n   1,2\n```",
    "created_at": "2016-08-31T19:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240493",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:303'></a>Replying to [comment:302 jdemeyer]:
> At least we have something that works (modulo the `is_squarefree` issue). That is a very important starting point.


surely Singular 4.0.3 still has the squarefree test, so it's matter of digging up how it is implemented:

```
> ring r=0,(x,y),dp;
> poly p=x^2+2*x*y+y^2;
>> ring r=0,(x,y),dp;
> poly p=x^2+2*x*y+y^2;
> sqrfree(p);
[1]:
   _[1]=1
   _[2]=x+y
[2]:
   1,2
```



---

archive/issue_comments_240494.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-01T09:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_049913.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-09-01T09:41:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49913"
}
```



---

archive/issue_events_049914.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-09-01T09:41:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49914"
}
```



---

archive/issue_comments_240495.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-01T09:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240495",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_240496.json:
```json
{
    "body": "<a id='comment:5'></a>merged last commit from givaro upgrade ticket, uploaded the tarball.",
    "created_at": "2016-09-01T09:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240496",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>merged last commit from givaro upgrade ticket, uploaded the tarball.



---

archive/issue_comments_240497.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n+Build system completely changed, and a lot of internal stuff.\n \n+The branch here is based on commit a070b84d whose message tells 4.0.3p3:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+The tarball is here:\n+\n+http://users.ox.ac.uk/~coml0531/sage/singular-4.0.3p3.tar.bz2\n+\n+It was made using the following procedure : \n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-01T09:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240497",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,21 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
+Build system completely changed, and a lot of internal stuff.
 
+The branch here is based on commit a070b84d whose message tells 4.0.3p3:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+The tarball is here:
+
+http://users.ox.ac.uk/~coml0531/sage/singular-4.0.3p3.tar.bz2
+
+It was made using the following procedure : 
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_events_049915.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2016-09-01T09:48:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49915"
}
```



---

archive/issue_events_049916.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2016-09-01T09:48:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49916"
}
```



---

archive/issue_comments_240498.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n+Build system completely changed, and a lot of internal stuff.\n \n+The branch here is based on commit a070b84d whose message tells 4.0.3p3:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+use the tarball at:\n+* http://perso.telecom-paristech.fr/~flori/singular/singular-4.0.3p3.tar.bz2\n+* or make your own tarball with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-01T09:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240498",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,19 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
+Build system completely changed, and a lot of internal stuff.
 
+The branch here is based on commit a070b84d whose message tells 4.0.3p3:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+use the tarball at:
+* http://perso.telecom-paristech.fr/~flori/singular/singular-4.0.3p3.tar.bz2
+* or make your own tarball with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240499.json:
```json
{
    "body": "<a id='comment:7'></a>oops, we pushed similar stuff at the same time...",
    "created_at": "2016-09-01T09:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240499",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>oops, we pushed similar stuff at the same time...



---

archive/issue_comments_240500.json:
```json
{
    "body": "<a id='comment:8'></a>I'm working on this, so pleas refrain taking Jeroen comments into account right now :)",
    "created_at": "2016-09-01T09:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240500",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>I'm working on this, so pleas refrain taking Jeroen comments into account right now :)



---

archive/issue_comments_240501.json:
```json
{
    "body": "<a id='comment:9'></a>Took some Jeroen comments into account.\n\n---\nNew commits:",
    "created_at": "2016-09-01T10:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240501",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Took some Jeroen comments into account.

---
New commits:



---

archive/issue_comments_240502.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-01T10:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240502",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240503.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-01T10:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240504.json:
```json
{
    "body": "<a id='comment:1'></a>I'm done for at least a couple of hours.\nSo feel free to play with the current branch.\nAnd pleas push any changes on the `public/singular4` branch.",
    "created_at": "2016-09-01T10:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240504",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>I'm done for at least a couple of hours.
So feel free to play with the current branch.
And pleas push any changes on the `public/singular4` branch.



---

archive/issue_comments_240505.json:
```json
{
    "body": "<a id='comment:2'></a>with the new tarball, it complains about absent aclocal-1.13...\n\nSomething needs to be done with this. Normally speaking, you want to make tarballs using `make dist`, after running `./configure`, and not by hand. I'll try to go this route now, and see if this works. By right, it should not require any autotools then (of course one can remove stuff from the tarball, after it's done).\n\nProbably one just needs to run `automake --add-missing --copy` before making tarball.",
    "created_at": "2016-09-01T14:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240505",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>with the new tarball, it complains about absent aclocal-1.13...

Something needs to be done with this. Normally speaking, you want to make tarballs using `make dist`, after running `./configure`, and not by hand. I'll try to go this route now, and see if this works. By right, it should not require any autotools then (of course one can remove stuff from the tarball, after it's done).

Probably one just needs to run `automake --add-missing --copy` before making tarball.



---

archive/issue_comments_240506.json:
```json
{
    "body": "<a id='comment:313'></a>Replying to [comment:312 dimpase]:\n> with the new tarball, it complains about absent aclocal-1.13...\n> \n> Something needs to be done with this. Normally speaking, you want to make tarballs using `make dist`, after running `./configure`, and not by hand. I'll try to go this route now, and see if this works. By right, it should not require any autotools then (of course one can remove stuff from the tarball, after it's done).\n\n\nIs this using the autotools package from #21047?",
    "created_at": "2016-09-01T14:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240506",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:313'></a>Replying to [comment:312 dimpase]:
> with the new tarball, it complains about absent aclocal-1.13...
> 
> Something needs to be done with this. Normally speaking, you want to make tarballs using `make dist`, after running `./configure`, and not by hand. I'll try to go this route now, and see if this works. By right, it should not require any autotools then (of course one can remove stuff from the tarball, after it's done).


Is this using the autotools package from #21047?



---

archive/issue_comments_240507.json:
```json
{
    "body": "<a id='comment:4'></a>it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).",
    "created_at": "2016-09-01T14:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240507",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).



---

archive/issue_comments_240508.json:
```json
{
    "body": "<a id='comment:5'></a>>There was no reason to make the code more complicated, why was it done??? \n\n\nI changed the library loading code to annoy everyone ( just kidding ;-) ) \n\n``\n\n\n> Revert simpler old code to load Singular\n\n\nI disagree. \n\n\nPlease read my arguments first and reply to the arguments (or disprove them). `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that. Still, try to understand the arguments for the change and accept the change if you agree with the arguments.\n\n\nThe old (and current) failing message is \n\n```\nraise ImportError(\"cannot load libSINGULAR library\")\n```\n\nIn some situations this message gives no clue about the error caused a failing and even worse, is misleading:\n\nThe issue I ran into was while working on this upgrade, the loading of libSINGULAR failed, but I could for hours not figure out the cause. The library file was there,\nI was able to open it manually. The error message did mislead my thoughts in the wrong direction. The issue was that Singular changed the naming of `'libsingular.so'` to `'libSingular.so' ` (did you note the difference? ('s' vs 'S') and dlopen failed because sage tried to open a non-existing file!\n\nAlso, if we reach \n\n```\nif handle == NULL\n```\n\nit is legitimate to print for _which_ file we failed to dlopen, because we try several different extensions (`\"so\", \"dylib\", \"dll\"`) in a loop!  Otherwise, by just looking at the error message we would have NO CLUE, for _which_ file `dlopen` failed.  And they may exist all three of them in the same place.",
    "created_at": "2016-09-01T19:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240508",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:5'></a>>There was no reason to make the code more complicated, why was it done??? 


I changed the library loading code to annoy everyone ( just kidding ;-) ) 

``


> Revert simpler old code to load Singular


I disagree. 


Please read my arguments first and reply to the arguments (or disprove them). `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that. Still, try to understand the arguments for the change and accept the change if you agree with the arguments.


The old (and current) failing message is 

```
raise ImportError("cannot load libSINGULAR library")
```

In some situations this message gives no clue about the error caused a failing and even worse, is misleading:

The issue I ran into was while working on this upgrade, the loading of libSINGULAR failed, but I could for hours not figure out the cause. The library file was there,
I was able to open it manually. The error message did mislead my thoughts in the wrong direction. The issue was that Singular changed the naming of `'libsingular.so'` to `'libSingular.so' ` (did you note the difference? ('s' vs 'S') and dlopen failed because sage tried to open a non-existing file!

Also, if we reach 

```
if handle == NULL
```

it is legitimate to print for _which_ file we failed to dlopen, because we try several different extensions (`"so", "dylib", "dll"`) in a loop!  Otherwise, by just looking at the error message we would have NO CLUE, for _which_ file `dlopen` failed.  And they may exist all three of them in the same place.



---

archive/issue_comments_240509.json:
```json
{
    "body": "<a id='comment:6'></a>> Purify enum for singular ring types.\n\n\nIf the comments are not well-formatted, incomplete or incorrect,\nit would be better to fix them rather than removing.\n\n(Have fun to guess by the names what they stand for)",
    "created_at": "2016-09-01T19:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240509",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:6'></a>> Purify enum for singular ring types.


If the comments are not well-formatted, incomplete or incorrect,
it would be better to fix them rather than removing.

(Have fun to guess by the names what they stand for)



---

archive/issue_comments_240510.json:
```json
{
    "body": "<a id='comment:7'></a>> Remove print debug statement in singular lib\n\n\nIf I recall correctly, if Singular ring creation fails (with exception), \nthere is a fallback creating a sage ring, (sage catches the exception,\nand no exception is printed)\n\nSo my question is, how a developer should properly and easily detect, that \nSingular ring creation ended with an exception?",
    "created_at": "2016-09-01T19:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240510",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:7'></a>> Remove print debug statement in singular lib


If I recall correctly, if Singular ring creation fails (with exception), 
there is a fallback creating a sage ring, (sage catches the exception,
and no exception is printed)

So my question is, how a developer should properly and easily detect, that 
Singular ring creation ended with an exception?



---

archive/issue_comments_240511.json:
```json
{
    "body": "<a id='comment:318'></a>Replying to [comment:314 dimpase]:\n> it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).\n\n`spkg-src` just calls `autoreconf` which is the usual way to generate `configure` and `Makefile.in`.\nNot sure why running `configure` or `make` decides to rerun `autotools`.\nMaybe some timestamps issues after patching but we don't patch a lot, especially we do nothing to `configure` and `Makefile.in`, so...\nAnd IIRC I had no trace of `autotools` getting rerun on my setup, except when using `SAGE_DEBUG=yes` (which was already strange enough).",
    "created_at": "2016-09-01T20:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240511",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:318'></a>Replying to [comment:314 dimpase]:
> it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).

`spkg-src` just calls `autoreconf` which is the usual way to generate `configure` and `Makefile.in`.
Not sure why running `configure` or `make` decides to rerun `autotools`.
Maybe some timestamps issues after patching but we don't patch a lot, especially we do nothing to `configure` and `Makefile.in`, so...
And IIRC I had no trace of `autotools` getting rerun on my setup, except when using `SAGE_DEBUG=yes` (which was already strange enough).



---

archive/issue_comments_240512.json:
```json
{
    "body": "<a id='comment:319'></a>Replying to [comment:317 jakobkroeker]:\n> > Remove print debug statement in singular lib\n\n> \n> If I recall correctly, if Singular ring creation fails (with exception), \n> there is a fallback creating a sage ring, (sage catches the exception,\n> and no exception is printed)\n> \n> So my question is, how a developer should properly and easily detect, that \n> Singular ring creation ended with an exception?\n\nIt's fine to have `print` statement during development, but I would say it should not be there in \"production\" code.",
    "created_at": "2016-09-01T20:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240512",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:319'></a>Replying to [comment:317 jakobkroeker]:
> > Remove print debug statement in singular lib

> 
> If I recall correctly, if Singular ring creation fails (with exception), 
> there is a fallback creating a sage ring, (sage catches the exception,
> and no exception is printed)
> 
> So my question is, how a developer should properly and easily detect, that 
> Singular ring creation ended with an exception?

It's fine to have `print` statement during development, but I would say it should not be there in "production" code.



---

archive/issue_comments_240513.json:
```json
{
    "body": "<a id='comment:320'></a>Replying to [comment:316 jakobkroeker]:\n> > Purify enum for singular ring types.\n\n> \n> If the comments are not well-formatted, incomplete or incorrect,\n> it would be better to fix them rather than removing.\n> \n> (Have fun to guess by the names what they stand for)\n\nComments are available here:\nhttps://github.com/Singular/Sources/blob/spielwiese/libpolys/coeffs/coeffs.h\n\nI took the easy solution of removing them form the Cython wrapper.",
    "created_at": "2016-09-01T20:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240513",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:320'></a>Replying to [comment:316 jakobkroeker]:
> > Purify enum for singular ring types.

> 
> If the comments are not well-formatted, incomplete or incorrect,
> it would be better to fix them rather than removing.
> 
> (Have fun to guess by the names what they stand for)

Comments are available here:
https://github.com/Singular/Sources/blob/spielwiese/libpolys/coeffs/coeffs.h

I took the easy solution of removing them form the Cython wrapper.



---

archive/issue_comments_240514.json:
```json
{
    "body": "<a id='comment:321'></a>Replying to [comment:315 jakobkroeker]:\n> \n> >There was no reason to make the code more complicated, why was it done??? \n\n> \n> I changed the library loading code to annoy everyone ( just kidding ;-) ) \n> \n> ``\n> \n> \n> > Revert simpler old code to load Singular\n\n> \n> I disagree. \n> \n> \n> Please read my arguments first and reply to the arguments (or disprove them). `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that. Still, try to understand the arguments for the change and accept the change if you agree with the arguments.\n> \n> \n> The old (and current) failing message is \n> \n> ```\n> raise ImportError(\"cannot load libSINGULAR library\")\n> ```\n> \n> In some situations this message gives no clue about the error caused a failing and even worse, is misleading:\n> \n> The issue I ran into was while working on this upgrade, the loading of libSINGULAR failed, but I could for hours not figure out the cause. The library file was there,\n> I was able to open it manually. The error message did mislead my thoughts in the wrong direction. The issue was that Singular changed the naming of `'libsingular.so'` to `'libSingular.so' ` (did you note the difference? ('s' vs 'S') and dlopen failed because sage tried to open a non-existing file!\n> \n> Also, if we reach \n> \n> ```\n> if handle == NULL\n> ```\n> \n> it is legitimate to print for _which_ file we failed to dlopen, because we try several different extensions (`\"so\", \"dylib\", \"dll\"`) in a loop!  Otherwise, by just looking at the error message we would have NO CLUE, for _which_ file `dlopen` failed.  And they may exist all three of them in the same place.\n> \n> \n> \n> \n> \n\nOk, so maybe we should put back a more verbose error message.",
    "created_at": "2016-09-01T20:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240514",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:321'></a>Replying to [comment:315 jakobkroeker]:
> 
> >There was no reason to make the code more complicated, why was it done??? 

> 
> I changed the library loading code to annoy everyone ( just kidding ;-) ) 
> 
> ``
> 
> 
> > Revert simpler old code to load Singular

> 
> I disagree. 
> 
> 
> Please read my arguments first and reply to the arguments (or disprove them). `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that. Still, try to understand the arguments for the change and accept the change if you agree with the arguments.
> 
> 
> The old (and current) failing message is 
> 
> ```
> raise ImportError("cannot load libSINGULAR library")
> ```
> 
> In some situations this message gives no clue about the error caused a failing and even worse, is misleading:
> 
> The issue I ran into was while working on this upgrade, the loading of libSINGULAR failed, but I could for hours not figure out the cause. The library file was there,
> I was able to open it manually. The error message did mislead my thoughts in the wrong direction. The issue was that Singular changed the naming of `'libsingular.so'` to `'libSingular.so' ` (did you note the difference? ('s' vs 'S') and dlopen failed because sage tried to open a non-existing file!
> 
> Also, if we reach 
> 
> ```
> if handle == NULL
> ```
> 
> it is legitimate to print for _which_ file we failed to dlopen, because we try several different extensions (`"so", "dylib", "dll"`) in a loop!  Otherwise, by just looking at the error message we would have NO CLUE, for _which_ file `dlopen` failed.  And they may exist all three of them in the same place.
> 
> 
> 
> 
> 

Ok, so maybe we should put back a more verbose error message.



---

archive/issue_comments_240515.json:
```json
{
    "body": "<a id='comment:322'></a>Replying to [comment:321 jpflori]:\n> Replying to [comment:315 jakobkroeker]:\n> > \n> > >There was no reason to make the code more complicated, why was it done??? \n\n> > \n> > I changed the library loading code to annoy everyone ( just kidding ;-) ) \n> > \n> > ``\n> > \n> > \n> > > Revert simpler old code to load Singular\n\n> > \n> > I disagree. \n> > \n> > \n> > Please read my arguments first and reply to the arguments (or disprove them). `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that. Still, try to understand the arguments for the change and accept the change if you agree with the arguments.\n> > \n> > \n> > The old (and current) failing message is \n> > \n> > ```\n> > raise ImportError(\"cannot load libSINGULAR library\")\n> > ```\n> > \n> > In some situations this message gives no clue about the error caused a failing and even worse, is misleading:\n> > \n> > The issue I ran into was while working on this upgrade, the loading of libSINGULAR failed, but I could for hours not figure out the cause. The library file was there,\n> > I was able to open it manually. The error message did mislead my thoughts in the wrong direction. The issue was that Singular changed the naming of `'libsingular.so'` to `'libSingular.so' ` (did you note the difference? ('s' vs 'S') and dlopen failed because sage tried to open a non-existing file!\n> > \n> > Also, if we reach \n> > \n> > ```\n> > if handle == NULL\n> > ```\n> > \n> > it is legitimate to print for _which_ file we failed to dlopen, because we try several different extensions (`\"so\", \"dylib\", \"dll\"`) in a loop!  Otherwise, by just looking at the error message we would have NO CLUE, for _which_ file `dlopen` failed.  And they may exist all three of them in the same place.\n> > \n> > \n> > \n> > \n> > \n\n> Ok, so maybe we should put back a more verbose error message.\nAnd rather than trying three different extensions, just try the one corresponding to the underlying system.",
    "created_at": "2016-09-01T20:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240515",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:322'></a>Replying to [comment:321 jpflori]:
> Replying to [comment:315 jakobkroeker]:
> > 
> > >There was no reason to make the code more complicated, why was it done??? 

> > 
> > I changed the library loading code to annoy everyone ( just kidding ;-) ) 
> > 
> > ``
> > 
> > 
> > > Revert simpler old code to load Singular

> > 
> > I disagree. 
> > 
> > 
> > Please read my arguments first and reply to the arguments (or disprove them). `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that. Still, try to understand the arguments for the change and accept the change if you agree with the arguments.
> > 
> > 
> > The old (and current) failing message is 
> > 
> > ```
> > raise ImportError("cannot load libSINGULAR library")
> > ```
> > 
> > In some situations this message gives no clue about the error caused a failing and even worse, is misleading:
> > 
> > The issue I ran into was while working on this upgrade, the loading of libSINGULAR failed, but I could for hours not figure out the cause. The library file was there,
> > I was able to open it manually. The error message did mislead my thoughts in the wrong direction. The issue was that Singular changed the naming of `'libsingular.so'` to `'libSingular.so' ` (did you note the difference? ('s' vs 'S') and dlopen failed because sage tried to open a non-existing file!
> > 
> > Also, if we reach 
> > 
> > ```
> > if handle == NULL
> > ```
> > 
> > it is legitimate to print for _which_ file we failed to dlopen, because we try several different extensions (`"so", "dylib", "dll"`) in a loop!  Otherwise, by just looking at the error message we would have NO CLUE, for _which_ file `dlopen` failed.  And they may exist all three of them in the same place.
> > 
> > 
> > 
> > 
> > 

> Ok, so maybe we should put back a more verbose error message.
And rather than trying three different extensions, just try the one corresponding to the underlying system.



---

archive/issue_comments_240516.json:
```json
{
    "body": "<a id='comment:3'></a>> It's fine to have print statement during development, but I would say it should not be there in \"production\" code. \n\n\nThats fine to remove the (outcommented) debug statements. \n\nMy question is just about if there is a better way to detect a failed singular ring creation  than printouts?.",
    "created_at": "2016-09-01T21:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240516",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:3'></a>> It's fine to have print statement during development, but I would say it should not be there in "production" code. 


Thats fine to remove the (outcommented) debug statements. 

My question is just about if there is a better way to detect a failed singular ring creation  than printouts?.



---

archive/issue_comments_240517.json:
```json
{
    "body": "<a id='comment:324'></a>Replying to [comment:320 jpflori]:\n> Replying to [comment:316 jakobkroeker]:\n> > > Purify enum for singular ring types.\n\n> > \n> > If the comments are not well-formatted, incomplete or incorrect,\n> > it would be better to fix them rather than removing.\n> > \n\n> Comments are available here:\n> https://github.com/Singular/Sources/blob/spielwiese/libpolys/coeffs/coeffs.h\n> \n> I took the easy solution of removing them form the Cython wrapper.\n\n\nSure, there are some comments in `spielwiese/libpolys/coeffs/coeffs.h`,\nbut then the reader has to investigate (how did _you_ find the `coeffs.h`?)\n\nAt least I would add in `decl.pxd` before the line `cdef enum n_coeffType:` something like \n\n```\n# see libpolys/coeffs/coeffs.h for reference\n```\nWhat do you think?\n\nNot that I did a better job, but do you agree, that several comments in `coeffs.h` related to  the `enum n_coeffType` are not really helpful? (=> we should improve them?)",
    "created_at": "2016-09-01T21:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240517",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:324'></a>Replying to [comment:320 jpflori]:
> Replying to [comment:316 jakobkroeker]:
> > > Purify enum for singular ring types.

> > 
> > If the comments are not well-formatted, incomplete or incorrect,
> > it would be better to fix them rather than removing.
> > 

> Comments are available here:
> https://github.com/Singular/Sources/blob/spielwiese/libpolys/coeffs/coeffs.h
> 
> I took the easy solution of removing them form the Cython wrapper.


Sure, there are some comments in `spielwiese/libpolys/coeffs/coeffs.h`,
but then the reader has to investigate (how did _you_ find the `coeffs.h`?)

At least I would add in `decl.pxd` before the line `cdef enum n_coeffType:` something like 

```
# see libpolys/coeffs/coeffs.h for reference
```
What do you think?

Not that I did a better job, but do you agree, that several comments in `coeffs.h` related to  the `enum n_coeffType` are not really helpful? (=> we should improve them?)



---

archive/issue_comments_240518.json:
```json
{
    "body": "<a id='comment:325'></a>Replying to [comment:314 dimpase]:\n> it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).\n\n\nI give up, I don't understand quite what's going on. There is a `missing` script in `build-aux/`\nthat is called on `aclocal-<VERSION>`, where `<VERSION>` is the autotools version the tarball is made with.\nBut I don't know why it is there and how to disable it.",
    "created_at": "2016-09-01T22:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240518",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:325'></a>Replying to [comment:314 dimpase]:
> it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).


I give up, I don't understand quite what's going on. There is a `missing` script in `build-aux/`
that is called on `aclocal-<VERSION>`, where `<VERSION>` is the autotools version the tarball is made with.
But I don't know why it is there and how to disable it.



---

archive/issue_comments_240519.json:
```json
{
    "body": "<a id='comment:6'></a>> And rather than trying three different extensions, just try the one corresponding to the underlying system. \n\n\nNot quite sure, since I 'm not a Mac OS user, but it might be (or might be not) a problem on Mac OS. Are you familiar with Mac OS? \n\nIf I recall correctly, on Mac OS we might have both (\".so\" and \".dylib\") or only one of (\".so\" and \".dylib\")? Is that true??",
    "created_at": "2016-09-01T22:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240519",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:6'></a>> And rather than trying three different extensions, just try the one corresponding to the underlying system. 


Not quite sure, since I 'm not a Mac OS user, but it might be (or might be not) a problem on Mac OS. Are you familiar with Mac OS? 

If I recall correctly, on Mac OS we might have both (".so" and ".dylib") or only one of (".so" and ".dylib")? Is that true??



---

archive/issue_comments_240520.json:
```json
{
    "body": "<a id='comment:327'></a>Replying to [comment:325 dimpase]:\n> Replying to [comment:314 dimpase]:\n> > it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).\n\n> \n> I give up, I don't understand quite what's going on. There is a `missing` script in `build-aux/`\n> that is called on `aclocal-<VERSION>`, where `<VERSION>` is the autotools version the tarball is made with.\n> But I don't know why it is there and how to disable it. \n\n\nWe could ask Jeroen or Jean-Pierre for help to package recent Singular,\n\n...or ask Hans Schoenemann(Singular head developer) for the Singular release timetable...",
    "created_at": "2016-09-01T22:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240520",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:327'></a>Replying to [comment:325 dimpase]:
> Replying to [comment:314 dimpase]:
> > it should not use any autotools while installing, at all. It's clearly something is not done properly while making tarball (by spkg-src).

> 
> I give up, I don't understand quite what's going on. There is a `missing` script in `build-aux/`
> that is called on `aclocal-<VERSION>`, where `<VERSION>` is the autotools version the tarball is made with.
> But I don't know why it is there and how to disable it. 


We could ask Jeroen or Jean-Pierre for help to package recent Singular,

...or ask Hans Schoenemann(Singular head developer) for the Singular release timetable...



---

archive/issue_comments_240521.json:
```json
{
    "body": "<a id='comment:8'></a>the following hack appears to stop that aclocal nonsense:\n\n```\n--- a/build/pkgs/singular/spkg-install\n+++ b/build/pkgs/singular/spkg-install\n@@ -65,6 +65,9 @@ remove_old_version()\n     rm -rf \"$SAGE_LOCAL/share/singular\"\n }\n \n+touch configure.ac aclocal.m4 configure Makefile.am Makefile.in\n+touch */configure.ac */aclocal.m4 */configure */Makefile.am */Makefile.in\n+\n config()\n {\n     # configure notes (dates from Singular 3.x, maybe outdated for 4.x):\n```\n\nwill do more tests on it, before pushing this change...",
    "created_at": "2016-09-01T23:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240521",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>the following hack appears to stop that aclocal nonsense:

```
--- a/build/pkgs/singular/spkg-install
+++ b/build/pkgs/singular/spkg-install
@@ -65,6 +65,9 @@ remove_old_version()
     rm -rf "$SAGE_LOCAL/share/singular"
 }
 
+touch configure.ac aclocal.m4 configure Makefile.am Makefile.in
+touch */configure.ac */aclocal.m4 */configure */Makefile.am */Makefile.in
+
 config()
 {
     # configure notes (dates from Singular 3.x, maybe outdated for 4.x):
```

will do more tests on it, before pushing this change...



---

archive/issue_comments_240522.json:
```json
{
    "body": "<a id='comment:329'></a>Replying to [comment:326 jakobkroeker]:\n> > And rather than trying three different extensions, just try the one corresponding to the underlying system. \n\n> \n> Not quite sure, since I 'm not a Mac OS user, but it might be (or might be not) a problem on Mac OS. Are you familiar with Mac OS? \n> \n> If I recall correctly, on Mac OS we might have both (\".so\" and \".dylib\") or only one of (\".so\" and \".dylib\")? Is that true?? \n\n\nI can tell you if you confirm for me where I should look. When I look in `/Applications/sage-6.7/src/build/lib.macosx-10.9-x86_64-2.7/sage/libs/singular/` I find only `singular.so`. Do you know anywhere else we might put a library? (And is it likely anything would have changed since 6.7?",
    "created_at": "2016-09-02T00:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240522",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:329'></a>Replying to [comment:326 jakobkroeker]:
> > And rather than trying three different extensions, just try the one corresponding to the underlying system. 

> 
> Not quite sure, since I 'm not a Mac OS user, but it might be (or might be not) a problem on Mac OS. Are you familiar with Mac OS? 
> 
> If I recall correctly, on Mac OS we might have both (".so" and ".dylib") or only one of (".so" and ".dylib")? Is that true?? 


I can tell you if you confirm for me where I should look. When I look in `/Applications/sage-6.7/src/build/lib.macosx-10.9-x86_64-2.7/sage/libs/singular/` I find only `singular.so`. Do you know anywhere else we might put a library? (And is it likely anything would have changed since 6.7?



---

archive/issue_comments_240523.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n \n+Build system completely changed, and a lot of internal stuff.\n+\n+Upstream tarball at:\n+* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz\n+Modified tarball made with spkg-src at:\n+* http://www.infres.enst.fr/~flori/singular/singular-4.0.3p3.tar.bz2\n+\n+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+You can also make your own tarball based on this commit or another one with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-02T07:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240523",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,23 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
 
+Build system completely changed, and a lot of internal stuff.
+
+Upstream tarball at:
+* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz
+Modified tarball made with spkg-src at:
+* http://www.infres.enst.fr/~flori/singular/singular-4.0.3p3.tar.bz2
+
+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+You can also make your own tarball based on this commit or another one with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240524.json:
```json
{
    "body": "<a id='comment:0'></a>I guess this one corresponds to the commit I usd:\n* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz\n\nI repackaged it, but now it also fails on my system complaining about `aclocal-1.15`...",
    "created_at": "2016-09-02T07:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240524",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>I guess this one corresponds to the commit I usd:
* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz

I repackaged it, but now it also fails on my system complaining about `aclocal-1.15`...



---

archive/issue_comments_240525.json:
```json
{
    "body": "<a id='comment:1'></a>And the upstream tarball is not autoreconfed in the `xalloc` directory so `SAGE_DEBUG=yes` won't work.",
    "created_at": "2016-09-02T07:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240525",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>And the upstream tarball is not autoreconfed in the `xalloc` directory so `SAGE_DEBUG=yes` won't work.



---

archive/issue_comments_240526.json:
```json
{
    "body": "<a id='comment:2'></a>I haven't been following this discussion closely, but if I were to test out this branch now should I expect it to work (for some value of \"work\"--at least build?)",
    "created_at": "2016-09-02T08:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240526",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>I haven't been following this discussion closely, but if I were to test out this branch now should I expect it to work (for some value of "work"--at least build?)



---

archive/issue_comments_240527.json:
```json
{
    "body": "<a id='comment:3'></a>On my system, `aclocal` first gets called in `resources` seemingly because it thinks that files generated by `libtool` in `../m4/` are older than `aclocal.m4`.",
    "created_at": "2016-09-02T08:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240527",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>On my system, `aclocal` first gets called in `resources` seemingly because it thinks that files generated by `libtool` in `../m4/` are older than `aclocal.m4`.



---

archive/issue_comments_240528.json:
```json
{
    "body": "<a id='comment:334'></a>Replying to [comment:315 jakobkroeker]:\n> Please read my arguments first and reply to the arguments (or disprove them).\n\n\nIf there are arguments for that in one of the 315 comments above, sorry that I missed them :-)\n\n> `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that.\n\n\nI don't care whose code it was. Probably not mine.\n\n> The old (and current) failing message is \n> \n> ```\n> raise ImportError(\"cannot load libSINGULAR library\")\n> ```\n> \n> In some situations this message gives no clue about the error caused a failing and even worse, is misleading:\n\n\nImproving an error message is very good, but I don't see why you needed to complicate the whole code structure for that.\n\n> \n> Also, if we reach \n> \n> ```\n> if handle == NULL\n> ```\n\n\nIt wasn't clear to me whether it was even possible to reach that line.\n\nAnyway, this has been improved now (although the now-unused variables `dlerrormsg` and `libSingularFound` should still be removed).",
    "created_at": "2016-09-02T08:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240528",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:334'></a>Replying to [comment:315 jakobkroeker]:
> Please read my arguments first and reply to the arguments (or disprove them).


If there are arguments for that in one of the 315 comments above, sorry that I missed them :-)

> `@`Jeroen, If it was your code I changed and it hurts you. I'm sorry for that.


I don't care whose code it was. Probably not mine.

> The old (and current) failing message is 
> 
> ```
> raise ImportError("cannot load libSINGULAR library")
> ```
> 
> In some situations this message gives no clue about the error caused a failing and even worse, is misleading:


Improving an error message is very good, but I don't see why you needed to complicate the whole code structure for that.

> 
> Also, if we reach 
> 
> ```
> if handle == NULL
> ```


It wasn't clear to me whether it was even possible to reach that line.

Anyway, this has been improved now (although the now-unused variables `dlerrormsg` and `libSingularFound` should still be removed).



---

archive/issue_comments_240529.json:
```json
{
    "body": "<a id='comment:5'></a>Note that at minute precision these files have similar timestamps, altough at second precision `aclocal.m4` is actually older...",
    "created_at": "2016-09-02T08:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240529",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Note that at minute precision these files have similar timestamps, altough at second precision `aclocal.m4` is actually older...



---

archive/issue_comments_240530.json:
```json
{
    "body": "<a id='comment:6'></a>on 32-bit Ubuntu 14.04 I get, with the `touch` hack above, the following error while building sagelib:\n\n```\n[193/459] Cythonizing sage/libs/singular/singular.pyx\n\nError compiling Cython file:\n------------------------------------------------------------\n...\nfrom sage.libs.singular.decl cimport number, poly, ring, currRing\nfrom sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit\nfrom sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin\nfrom sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a\nfrom sage.libs.singular.decl cimport p_Copy, prCopyR\nfrom sage.libs.singular.decl cimport n_unknown,  n_Zp,  n_Q,   n_R,   n_GF,  n_long_R,  n_algExt,n_transExt,n_long_C,   n_Z,   n_Zn,  n_Znm,  n_Z2m,  n_CF\n^\n------------------------------------------------------------\n\nsage/libs/singular/ring.pyx:26:0: 'sage/libs/singular/decl/n_Zn.pxd' not found\n\nError compiling Cython file:\n------------------------------------------------------------\n...\nfrom sage.libs.singular.decl cimport number, poly, ring, currRing\nfrom sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit\nfrom sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin\nfrom sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a\nfrom sage.libs.singular.decl cimport p_Copy, prCopyR\n...\n```\n\nI don't know whether it's related to `touch` applied, or not.\n\nI can install the requested aclocal version and see whether without `touch` I get the same error...",
    "created_at": "2016-09-02T08:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240530",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>on 32-bit Ubuntu 14.04 I get, with the `touch` hack above, the following error while building sagelib:

```
[193/459] Cythonizing sage/libs/singular/singular.pyx

Error compiling Cython file:
------------------------------------------------------------
...
from sage.libs.singular.decl cimport number, poly, ring, currRing
from sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit
from sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin
from sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a
from sage.libs.singular.decl cimport p_Copy, prCopyR
from sage.libs.singular.decl cimport n_unknown,  n_Zp,  n_Q,   n_R,   n_GF,  n_long_R,  n_algExt,n_transExt,n_long_C,   n_Z,   n_Zn,  n_Znm,  n_Z2m,  n_CF
^
------------------------------------------------------------

sage/libs/singular/ring.pyx:26:0: 'sage/libs/singular/decl/n_Zn.pxd' not found

Error compiling Cython file:
------------------------------------------------------------
...
from sage.libs.singular.decl cimport number, poly, ring, currRing
from sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit
from sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin
from sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a
from sage.libs.singular.decl cimport p_Copy, prCopyR
...
```

I don't know whether it's related to `touch` applied, or not.

I can install the requested aclocal version and see whether without `touch` I get the same error...



---

archive/issue_comments_240531.json:
```json
{
    "body": "<a id='comment:337'></a>> If I recall correctly, on Mac OS we might have both (\".so\" and \".dylib\") or only one of (\".so\" and \".dylib\")? Is that true?? \n\n\nBoth exist for a different purpose. On OS X:\n\n- `.dylib` = dynamic library (needed for the usual case of linking libraries at build-time).\n\n- `.so` = loadable module (needed for run-time linking, for example Python extension modules).\n\nOn most other OSes, there is no difference between these.",
    "created_at": "2016-09-02T08:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240531",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:337'></a>> If I recall correctly, on Mac OS we might have both (".so" and ".dylib") or only one of (".so" and ".dylib")? Is that true?? 


Both exist for a different purpose. On OS X:

- `.dylib` = dynamic library (needed for the usual case of linking libraries at build-time).

- `.so` = loadable module (needed for run-time linking, for example Python extension modules).

On most other OSes, there is no difference between these.



---

archive/issue_comments_240532.json:
```json
{
    "body": "<a id='comment:338'></a>Replying to [comment:336 dimpase]:\n> on 32-bit Ubuntu 14.04 I get, with the `touch` hack above, the following error while building sagelib:\n> \n> ```\n> [193/459] Cythonizing sage/libs/singular/singular.pyx\n> \n> Error compiling Cython file:\n> ------------------------------------------------------------\n> ...\n> from sage.libs.singular.decl cimport number, poly, ring, currRing\n> from sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit\n> from sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin\n> from sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a\n> from sage.libs.singular.decl cimport p_Copy, prCopyR\n> from sage.libs.singular.decl cimport n_unknown,  n_Zp,  n_Q,   n_R,   n_GF,  n_long_R,  n_algExt,n_transExt,n_long_C,   n_Z,   n_Zn,  n_Znm,  n_Z2m,  n_CF\n> ^\n> ------------------------------------------------------------\n> \n> sage/libs/singular/ring.pyx:26:0: 'sage/libs/singular/decl/n_Zn.pxd' not found\n> \n> Error compiling Cython file:\n> ------------------------------------------------------------\n> ...\n> from sage.libs.singular.decl cimport number, poly, ring, currRing\n> from sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit\n> from sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin\n> from sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a\n> from sage.libs.singular.decl cimport p_Copy, prCopyR\n> ...\n> ```\n> \n> I don't know whether it's related to `touch` applied, or not.\n> \n\nNope, I must have screwed up when removing the comments in the enumeration.\n\n> I can install the requested aclocal version and see whether without `touch` I get the same error...\n\nThats not necessary, we cannot get away with only a `touch` anyway because of `xalloc`.\nI'll rerun autoreconf on my side to get proper timestamps in all folders...",
    "created_at": "2016-09-02T08:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240532",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:338'></a>Replying to [comment:336 dimpase]:
> on 32-bit Ubuntu 14.04 I get, with the `touch` hack above, the following error while building sagelib:
> 
> ```
> [193/459] Cythonizing sage/libs/singular/singular.pyx
> 
> Error compiling Cython file:
> ------------------------------------------------------------
> ...
> from sage.libs.singular.decl cimport number, poly, ring, currRing
> from sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit
> from sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin
> from sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a
> from sage.libs.singular.decl cimport p_Copy, prCopyR
> from sage.libs.singular.decl cimport n_unknown,  n_Zp,  n_Q,   n_R,   n_GF,  n_long_R,  n_algExt,n_transExt,n_long_C,   n_Z,   n_Zn,  n_Znm,  n_Z2m,  n_CF
> ^
> ------------------------------------------------------------
> 
> sage/libs/singular/ring.pyx:26:0: 'sage/libs/singular/decl/n_Zn.pxd' not found
> 
> Error compiling Cython file:
> ------------------------------------------------------------
> ...
> from sage.libs.singular.decl cimport number, poly, ring, currRing
> from sage.libs.singular.decl cimport rChangeCurrRing, rCopy0, rComplete, rDelete, idInit
> from sage.libs.singular.decl cimport omAlloc0, omStrDup, omAlloc, omAlloc0Bin,  sip_sring_bin, rnumber_bin
> from sage.libs.singular.decl cimport ringorder_dp, ringorder_Dp, ringorder_lp, ringorder_rp, ringorder_ds, ringorder_Ds, ringorder_ls, ringorder_M, ringorder_C, ringorder_wp, ringorder_Wp, ringorder_ws, ringorder_Ws, ringorder_a
> from sage.libs.singular.decl cimport p_Copy, prCopyR
> ...
> ```
> 
> I don't know whether it's related to `touch` applied, or not.
> 

Nope, I must have screwed up when removing the comments in the enumeration.

> I can install the requested aclocal version and see whether without `touch` I get the same error...

Thats not necessary, we cannot get away with only a `touch` anyway because of `xalloc`.
I'll rerun autoreconf on my side to get proper timestamps in all folders...



---

archive/issue_comments_240533.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-02T08:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240534.json:
```json
{
    "body": "<a id='comment:340'></a>Replying to [comment:339 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                  |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n> |[d6dee3c](https://git.sagemath.org/sage.git/commit/?id=d6dee3c4a86a864952d164b7efa00c128e2b83cc)|`Fix enum in singular ring types.`|\n\n\nOK, this helps to get further; the latest error on 32-bit Ubuntu is\n\n```\n[149/444] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/dima/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/dev/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cythonized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/ring.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/ring.o -fno-strict-aliasing -fno-tree-copyrename\nerror: command 'gcc' failed with exit status 1\n/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/polynomial.cpp: In function \u2018long int __pyx_f_4sage_4libs_8singular_10polynomial_singular_polynomial_deg(polyrec*, polyrec*, ip_sring*)\u2019:\n/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/polynomial.cpp:6028:7: warning: \u2018__pyx_v_i\u2019 may be used uninitialized in this function [-Wmaybe-uninitialized]\n   int __pyx_v_i;\n       ^\nmake[3]: *** [sage] Error 1\n```\nIt might be that gcc is too old, it uses gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3).\n\nShould I rather build Sage's gcc?",
    "created_at": "2016-09-02T09:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240534",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:340'></a>Replying to [comment:339 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                  |
> |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
> |[d6dee3c](https://git.sagemath.org/sage.git/commit/?id=d6dee3c4a86a864952d164b7efa00c128e2b83cc)|`Fix enum in singular ring types.`|


OK, this helps to get further; the latest error on 32-bit Ubuntu is

```
[149/444] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/dima/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/dev/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cythonized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/ring.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/ring.o -fno-strict-aliasing -fno-tree-copyrename
error: command 'gcc' failed with exit status 1
/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/polynomial.cpp: In function ‘long int __pyx_f_4sage_4libs_8singular_10polynomial_singular_polynomial_deg(polyrec*, polyrec*, ip_sring*)’:
/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/polynomial.cpp:6028:7: warning: ‘__pyx_v_i’ may be used uninitialized in this function [-Wmaybe-uninitialized]
   int __pyx_v_i;
       ^
make[3]: *** [sage] Error 1
```
It might be that gcc is too old, it uses gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3).

Should I rather build Sage's gcc?



---

archive/issue_comments_240535.json:
```json
{
    "body": "<a id='comment:341'></a>Replying to [comment:338 jpflori]:\n> > I can install the requested aclocal version and see whether without `touch` I get the same error...\n\n> Thats not necessary, we cannot get away with only a `touch` anyway because of `xalloc`.\n> I'll rerun autoreconf on my side to get proper timestamps in all folders...\n\n\nI do touch stuff in `*/` too, not only in top level.\n(probably `*` is an overkill, but it works).\n \nIndeed, I first tried to touch the top level only, it went a bit further, entered `resources/`, and complained from there instead.",
    "created_at": "2016-09-02T09:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240535",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:341'></a>Replying to [comment:338 jpflori]:
> > I can install the requested aclocal version and see whether without `touch` I get the same error...

> Thats not necessary, we cannot get away with only a `touch` anyway because of `xalloc`.
> I'll rerun autoreconf on my side to get proper timestamps in all folders...


I do touch stuff in `*/` too, not only in top level.
(probably `*` is an overkill, but it works).
 
Indeed, I first tried to touch the top level only, it went a bit further, entered `resources/`, and complained from there instead.



---

archive/issue_comments_240536.json:
```json
{
    "body": "<a id='comment:2'></a>One also needs to `touch [*/]_config.h.in` in order to prevent autoheader` invokation...\nI'll modify the `spkg-src` script to:\n* use the upstream tarball,\n* autoreconf in xalloc,\n* touch all files.",
    "created_at": "2016-09-02T09:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240536",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>One also needs to `touch [*/]_config.h.in` in order to prevent autoheader` invokation...
I'll modify the `spkg-src` script to:
* use the upstream tarball,
* autoreconf in xalloc,
* touch all files.



---

archive/issue_comments_240537.json:
```json
{
    "body": "<a id='comment:343'></a>Replying to [comment:340 dimpase]:\n> OK, this helps to get further; the latest error on 32-bit Ubuntu is\n\n\nWhat's the error message? (it's not in the piece that you quoted)",
    "created_at": "2016-09-02T09:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240537",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:343'></a>Replying to [comment:340 dimpase]:
> OK, this helps to get further; the latest error on 32-bit Ubuntu is


What's the error message? (it's not in the piece that you quoted)



---

archive/issue_comments_240538.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-02T10:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240539.json:
```json
{
    "body": "<a id='comment:345'></a>Replying to [comment:343 jdemeyer]:\n> Replying to [comment:340 dimpase]:\n> > OK, this helps to get further; the latest error on 32-bit Ubuntu is\n\n> \n> What's the error message? (it's not in the piece that you quoted)\n\noops, sorry... please see `err.log` in attachments to this ticket",
    "created_at": "2016-09-02T10:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240539",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:345'></a>Replying to [comment:343 jdemeyer]:
> Replying to [comment:340 dimpase]:
> > OK, this helps to get further; the latest error on 32-bit Ubuntu is

> 
> What's the error message? (it's not in the piece that you quoted)

oops, sorry... please see `err.log` in attachments to this ticket



---

archive/issue_comments_240540.json:
```json
{
    "body": "<a id='comment:6'></a>Ok reuploaded a new tarball (same address).\nPlease test.\nNote that I finally did:\n* use upstream 4.0.3p3\n* autoreconf\n* autoreconf in xalloc\n* touch files\n\nIf I only autoreconfed xalloc, then libtool complained about different versions so I autoreconfed evrything then xalloc.\n(Yes, I know I could build my own autotools to get matching versions but thats more time consuming.)",
    "created_at": "2016-09-02T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240540",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Ok reuploaded a new tarball (same address).
Please test.
Note that I finally did:
* use upstream 4.0.3p3
* autoreconf
* autoreconf in xalloc
* touch files

If I only autoreconfed xalloc, then libtool complained about different versions so I autoreconfed evrything then xalloc.
(Yes, I know I could build my own autotools to get matching versions but thats more time consuming.)



---

archive/issue_comments_240541.json:
```json
{
    "body": "<a id='comment:7'></a>the link to the new tarball is not working",
    "created_at": "2016-09-02T10:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240541",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>the link to the new tarball is not working



---

archive/issue_comments_240542.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n \n+Build system completely changed, and a lot of internal stuff.\n+\n+Upstream tarball at:\n+* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz\n+Modified tarball made with spkg-src at:\n+* http://www.infres.enst.fr/~flori/singular-4.0.3p3.tar.bz2\n+\n+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+You can also make your own tarball based on this commit or another one with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-02T11:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240542",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,23 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
 
+Build system completely changed, and a lot of internal stuff.
+
+Upstream tarball at:
+* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz
+Modified tarball made with spkg-src at:
+* http://www.infres.enst.fr/~flori/singular-4.0.3p3.tar.bz2
+
+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+You can also make your own tarball based on this commit or another one with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240543.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n \n+Build system completely changed, and a lot of internal stuff.\n+\n+Upstream tarball at:\n+* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz\n+Modified tarball made with spkg-src at:\n+* http://perso.telecom-paristech.fr/~flori/singular-4.0.3p3.tar.bz2\n+\n+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+You can also make your own tarball based on this commit or another one with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-02T11:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240543",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,23 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
 
+Build system completely changed, and a lot of internal stuff.
+
+Upstream tarball at:
+* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz
+Modified tarball made with spkg-src at:
+* http://perso.telecom-paristech.fr/~flori/singular-4.0.3p3.tar.bz2
+
+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+You can also make your own tarball based on this commit or another one with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240544.json:
```json
{
    "body": "<a id='comment:0'></a>Should be ok now.",
    "created_at": "2016-09-02T11:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240544",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>Should be ok now.



---

archive/issue_comments_240545.json:
```json
{
    "body": "<a id='comment:351'></a>Replying to [comment:350 jpflori]:\n> Should be ok now.\n\n\nAs far as `aclocal` & Co. problem is concerned, it's fixed now, thanks.",
    "created_at": "2016-09-02T11:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240545",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:351'></a>Replying to [comment:350 jpflori]:
> Should be ok now.


As far as `aclocal` & Co. problem is concerned, it's fixed now, thanks.



---

archive/issue_comments_240546.json:
```json
{
    "body": "<a id='comment:2'></a>Can you also try with `SAGE_DEBUG=yes` ?",
    "created_at": "2016-09-02T12:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240546",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>Can you also try with `SAGE_DEBUG=yes` ?



---

archive/issue_comments_240547.json:
```json
{
    "body": "<a id='comment:3'></a>I now have another error, on a 64-bit machine with gcc 6.1.1:\n\n```\n[dochtml] /home/dima/Sage/sage/local/bin/python: cannot load libSINGULAR library; 'sage_setup.docbuild' is a package and cannot be directly executed\nmake[2]: *** [Makefile:1039: doc-html] Error 1\n```\nthis is even after `make distclean`.\nNo idea what it is and where it really comes from. `make build` completes, but Sage crashes on startup. (in crash report libSINGULAR is also mentioned). I'll attach it in a moment here.",
    "created_at": "2016-09-02T13:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240547",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>I now have another error, on a 64-bit machine with gcc 6.1.1:

```
[dochtml] /home/dima/Sage/sage/local/bin/python: cannot load libSINGULAR library; 'sage_setup.docbuild' is a package and cannot be directly executed
make[2]: *** [Makefile:1039: doc-html] Error 1
```
this is even after `make distclean`.
No idea what it is and where it really comes from. `make build` completes, but Sage crashes on startup. (in crash report libSINGULAR is also mentioned). I'll attach it in a moment here.



---

archive/issue_comments_240548.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [Sage_crash_report.txt](tarball://root/attachments/some-uuid/ticket17254/Sage_crash_report.txt) by @dimpase created at 2016-09-02 13:17:30\n\nI bet it's one of the latest \"simplifying\"/\"cleaning up\" commits that is to blame.",
    "created_at": "2016-09-02T13:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240548",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>Attachment [Sage_crash_report.txt](tarball://root/attachments/some-uuid/ticket17254/Sage_crash_report.txt) by @dimpase created at 2016-09-02 13:17:30

I bet it's one of the latest "simplifying"/"cleaning up" commits that is to blame.



---

archive/issue_comments_240549.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-02T14:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240550.json:
```json
{
    "body": "<a id='comment:356'></a>Replying to [comment:355 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                         |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n> |[9a99f2c](https://git.sagemath.org/sage.git/commit/?id=9a99f2c4b5666aa5a37e396f10ac039d647a5c09)|`Singular, not singular!`|\n\n\nthis fixes a typo in 34960ee. Now Sage starts.",
    "created_at": "2016-09-02T14:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240550",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:356'></a>Replying to [comment:355 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                         |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
> |[9a99f2c](https://git.sagemath.org/sage.git/commit/?id=9a99f2c4b5666aa5a37e396f10ac039d647a5c09)|`Singular, not singular!`|


this fixes a typo in 34960ee. Now Sage starts.



---

archive/issue_comments_240551.json:
```json
{
    "body": "<a id='comment:357'></a>Replying to [comment:334 jdemeyer]:\n> Replying to [comment:315 jakobkroeker]:\n> Anyway, this (remark: loading libSINGULAR) has been improved now  (although the now-unused variables `dlerrormsg` and `libSingularFound` should still be removed).\n\n\n``` \n\n```\n\nNope, \nmy changes were just reverted\nand now Dima had fun with the issue  (see [comment:315 comment_315] ):  \n\n```\n```\n\nDima faced the old error message ( see [comment:353 comment_353] )\n\n```\n[dochtml] /home/dima/Sage/sage/local/bin/python: cannot load libSINGULAR library; 'sage_setup.docbuild' is a package and cannot be directly executed\nmake[2]: *** [Makefile:1039: doc-html] Error 1\n```\n\nHe comments the error:\n\n```\n No idea what it is and where it really comes from\n```\n\nFinally he was able to fix it ([comment:356 comment_356] )",
    "created_at": "2016-09-02T19:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240551",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:357'></a>Replying to [comment:334 jdemeyer]:
> Replying to [comment:315 jakobkroeker]:
> Anyway, this (remark: loading libSINGULAR) has been improved now  (although the now-unused variables `dlerrormsg` and `libSingularFound` should still be removed).


``` 

```

Nope, 
my changes were just reverted
and now Dima had fun with the issue  (see [comment:315 comment_315] ):  

```
```

Dima faced the old error message ( see [comment:353 comment_353] )

```
[dochtml] /home/dima/Sage/sage/local/bin/python: cannot load libSINGULAR library; 'sage_setup.docbuild' is a package and cannot be directly executed
make[2]: *** [Makefile:1039: doc-html] Error 1
```

He comments the error:

```
 No idea what it is and where it really comes from
```

Finally he was able to fix it ([comment:356 comment_356] )



---

archive/issue_comments_240552.json:
```json
{
    "body": "<a id='comment:8'></a>still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4",
    "created_at": "2016-09-03T08:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240552",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4



---

archive/issue_comments_240553.json:
```json
{
    "body": "<a id='comment:359'></a>Replying to [comment:352 jpflori]:\n> Can you also try with `SAGE_DEBUG=yes` ?\n\nthis seems to work (the package building without aclocal-1.15 installed); whether it works is another question.",
    "created_at": "2016-09-03T13:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240553",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:359'></a>Replying to [comment:352 jpflori]:
> Can you also try with `SAGE_DEBUG=yes` ?

this seems to work (the package building without aclocal-1.15 installed); whether it works is another question.



---

archive/issue_comments_240554.json:
```json
{
    "body": "<a id='comment:360'></a>Replying to [comment:358 dimpase]:\n> still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4\n\n\nWhen you get an error during building the Sage library, please do\n\n```sh\nenv SAGE_NUM_THREADS=1 ./sage -b\n```\nand post the log of *that*.",
    "created_at": "2016-09-03T22:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240554",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:360'></a>Replying to [comment:358 dimpase]:
> still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4


When you get an error during building the Sage library, please do

```sh
env SAGE_NUM_THREADS=1 ./sage -b
```
and post the log of *that*.



---

archive/issue_comments_240555.json:
```json
{
    "body": "<a id='comment:1'></a>I'm getting:\n\n```\nsage -t --long --warn-long 99.6 src/sage/schemes/curves/affine_curve.py\n**********************************************************************\nFile \"src/sage/schemes/curves/affine_curve.py\", line 494, in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities\nFailed example:\n    C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)\nExpected:\n    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n    24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n     24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n     8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\nGot:\n    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,\n     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n**********************************************************************\n1 item had failures:\n   1 of  23 in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities\n    [195 tests, 1 failure, 29.15 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 99.6 src/sage/schemes/curves/affine_curve.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\n---\n\nJust in case anybody wonders why Singular suddenly builds that fast:\n\n```\n if [ \"x$SAGE_DEBUG\" = \"xyes\" ]; then\n     ...\n-else\n-    WITH_DEBUG=\"--without-debug\"\n-    ENABLE_DEBUGOUTPUT=\"--disable-debugoutput\"\n-    \n-    # By default, parts of Singular are compiled with -O2 and parts\n-    # with -O3. If we do set any CFLAGS, this always overrides the\n-    # default CFLAGS set by upstream. In order to be compatible, we\n-    # set the optimization to -O2.\n-    # Increasing the optimization level to -O3 has caused various\n-    # problems in the past either with specific compilers or on specific\n-    # platforms.\n-    OPTIMIZATION_FLAGS=\"-O2\"\n-    \n-    CFLAGS=\"$OPTIMIZATION_FLAGS -g $CFLAGS\"\n-    CXXFLAGS=\"$OPTIMIZATION_FLAGS -g $CXXFLAGS\"\n fi\n```\nand\n\n```\nchecking whether build environment is sane... yes\nconfigure: WARNING: Please note that we set empty defaults for `CFLAGS' and `CXXFLAGS' (instead of `-g -O')\nchecking whether C compiler accepts ... yes\n```\n(One of seven instances.)",
    "created_at": "2016-09-04T00:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240555",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>I'm getting:

```
sage -t --long --warn-long 99.6 src/sage/schemes/curves/affine_curve.py
**********************************************************************
File "src/sage/schemes/curves/affine_curve.py", line 494, in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities
Failed example:
    C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)
Expected:
    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
    24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
     24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
     8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
Got:
    (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,
     Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
**********************************************************************
1 item had failures:
   1 of  23 in sage.schemes.curves.affine_curve.AffineCurve.resolution_of_singularities
    [195 tests, 1 failure, 29.15 s]
----------------------------------------------------------------------
sage -t --long --warn-long 99.6 src/sage/schemes/curves/affine_curve.py  # 1 doctest failed
----------------------------------------------------------------------
```

---

Just in case anybody wonders why Singular suddenly builds that fast:

```
 if [ "x$SAGE_DEBUG" = "xyes" ]; then
     ...
-else
-    WITH_DEBUG="--without-debug"
-    ENABLE_DEBUGOUTPUT="--disable-debugoutput"
-    
-    # By default, parts of Singular are compiled with -O2 and parts
-    # with -O3. If we do set any CFLAGS, this always overrides the
-    # default CFLAGS set by upstream. In order to be compatible, we
-    # set the optimization to -O2.
-    # Increasing the optimization level to -O3 has caused various
-    # problems in the past either with specific compilers or on specific
-    # platforms.
-    OPTIMIZATION_FLAGS="-O2"
-    
-    CFLAGS="$OPTIMIZATION_FLAGS -g $CFLAGS"
-    CXXFLAGS="$OPTIMIZATION_FLAGS -g $CXXFLAGS"
 fi
```
and

```
checking whether build environment is sane... yes
configure: WARNING: Please note that we set empty defaults for `CFLAGS' and `CXXFLAGS' (instead of `-g -O')
checking whether C compiler accepts ... yes
```
(One of seven instances.)



---

archive/issue_comments_240556.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-04T12:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240557.json:
```json
{
    "body": "<a id='comment:3'></a>Looks like Singular was currently using `-O3` in many (if not all?) places though, despite the warning(s).  Anyway, I've restored the old `[ \"$SAGE_DEBUG\" != yes ]` branch, for the moment at least.",
    "created_at": "2016-09-04T12:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240557",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>Looks like Singular was currently using `-O3` in many (if not all?) places though, despite the warning(s).  Anyway, I've restored the old `[ "$SAGE_DEBUG" != yes ]` branch, for the moment at least.



---

archive/issue_comments_240558.json:
```json
{
    "body": "<a id='comment:4'></a>Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:\n\n```diff\n--- doctest/expected\n+++ doctest/got\n@@ -1,9 +1,9 @@\n     C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)\n-Expected:\n+Got:\n     (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n     24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n      Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n-     24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,\n+     24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,\n      Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n-     8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n+     8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n \n```\n(No idea where the different line breaks in the actual output come from.)",
    "created_at": "2016-09-04T12:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240558",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:

```diff
--- doctest/expected
+++ doctest/got
@@ -1,9 +1,9 @@
     C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)
-Expected:
+Got:
     (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
     24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
      Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
-     24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,
+     24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,
      Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
-     8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
+     8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
 
```
(No idea where the different line breaks in the actual output come from.)



---

archive/issue_comments_240559.json:
```json
{
    "body": "<a id='comment:365'></a>Replying to [comment:364 leif]:\n> Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:\n\nI've reported this one already (it's actually a different answer...)",
    "created_at": "2016-09-04T13:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240559",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:365'></a>Replying to [comment:364 leif]:
> Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:

I've reported this one already (it's actually a different answer...)



---

archive/issue_comments_240560.json:
```json
{
    "body": "<a id='comment:366'></a>Replying to [comment:365 dimpase]:\n> Replying to [comment:364 leif]:\n> > Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:\n\n> I've reported this one already (it's actually a different answer...)\n\nThere's been some change to that file in 7.4.beta3, haven't checked yet where / whether it's related.\n\n---\n\nIn `spkg-install`, there's no error checking done in `install_docs()` and `fix_includes()`, haven't touched these though.",
    "created_at": "2016-09-04T13:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240560",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:366'></a>Replying to [comment:365 dimpase]:
> Replying to [comment:364 leif]:
> > Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:

> I've reported this one already (it's actually a different answer...)

There's been some change to that file in 7.4.beta3, haven't checked yet where / whether it's related.

---

In `spkg-install`, there's no error checking done in `install_docs()` and `fix_includes()`, haven't touched these though.



---

archive/issue_comments_240561.json:
```json
{
    "body": "<a id='comment:367'></a>Replying to [comment:360 leif]:\n> Replying to [comment:358 dimpase]:\n> > still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4\n\n> \n> When you get an error during building the Sage library, please do\n> \n> ```\n> #!sh\n> env SAGE_NUM_THREADS=1 ./sage -b\n> ```\n> and post the log of *that*.\n\n\nP.S.:  FSF GCC 4.8.5 works for me on *64-bit* Linux.  (Just the doctest failure above.)",
    "created_at": "2016-09-04T13:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240561",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:367'></a>Replying to [comment:360 leif]:
> Replying to [comment:358 dimpase]:
> > still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4

> 
> When you get an error during building the Sage library, please do
> 
> ```
> #!sh
> env SAGE_NUM_THREADS=1 ./sage -b
> ```
> and post the log of *that*.


P.S.:  FSF GCC 4.8.5 works for me on *64-bit* Linux.  (Just the doctest failure above.)



---

archive/issue_comments_240562.json:
```json
{
    "body": "<a id='comment:368'></a>Replying to [comment:366 leif]:\n> Replying to [comment:365 dimpase]:\n> > Replying to [comment:364 leif]:\n> > > Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:\n\n> > I've reported this one already (it's actually a different answer...)\n> \n> There's been some change to that file in 7.4.beta3, haven't checked yet where / whether it's related.\n\n\nApparently not.  I'm getting the same with the branch *pulled into* Sage 7.4.beta3 (as opposed to fetching it, since it's based on beta2 with the Linbox upgrade manually merged in by Dima IIRC).\n\nPresumably unrelated, with GCC 6.2:\n\n```\nsage -t --long src/sage/parallel/map_reduce.py\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 217, in sage.parallel.map_reduce\nFailed example:\n    try:\n        res = EX.run(timeout=0.01)\n    except AbortError:\n        print(\"Computation timeout\")\n    else:\n        print(\"Computation normally finished\")\n        res\nExpected:\n    Computation timeout\nGot:\n    Computation normally finished\n    40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1\n**********************************************************************\n1 item had failures:\n   1 of  47 in sage.parallel.map_reduce\n    [296 tests, 1 failure, 27.61 s]\n```\n\nXD\n\n(Passes when rerun separately though.)",
    "created_at": "2016-09-04T14:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240562",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:368'></a>Replying to [comment:366 leif]:
> Replying to [comment:365 dimpase]:
> > Replying to [comment:364 leif]:
> > > Doctest failure in `src/sage/schemes/curves/affine_curve.py, line 494`, more readable:

> > I've reported this one already (it's actually a different answer...)
> 
> There's been some change to that file in 7.4.beta3, haven't checked yet where / whether it's related.


Apparently not.  I'm getting the same with the branch *pulled into* Sage 7.4.beta3 (as opposed to fetching it, since it's based on beta2 with the Linbox upgrade manually merged in by Dima IIRC).

Presumably unrelated, with GCC 6.2:

```
sage -t --long src/sage/parallel/map_reduce.py
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 217, in sage.parallel.map_reduce
Failed example:
    try:
        res = EX.run(timeout=0.01)
    except AbortError:
        print("Computation timeout")
    else:
        print("Computation normally finished")
        res
Expected:
    Computation timeout
Got:
    Computation normally finished
    40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1
**********************************************************************
1 item had failures:
   1 of  47 in sage.parallel.map_reduce
    [296 tests, 1 failure, 27.61 s]
```

XD

(Passes when rerun separately though.)



---

archive/issue_comments_240563.json:
```json
{
    "body": "<a id='comment:369'></a>Replying to [comment:360 leif]:\n> Replying to [comment:358 dimpase]:\n> > still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4\n\n> \n> When you get an error during building the Sage library, please do\n> \n> ```\n> #!sh\n> env SAGE_NUM_THREADS=1 ./sage -b\n> ```\n> and post the log of *that*.\n\n\nRight, sorry for the multithread mess. With singular built with SAGE_DEBUG=yes I get\n\n```\n[  1/308] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/dima/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/dev/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cythonized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.o -fno-strict-aliasing -fno-tree-copyrename\nIn file included from /home/dima/sage/dev/sage/local/include/singular/kernel/structs.h:12:0,\n                 from /home/dima/sage/dev/sage/local/include/singular/Singular/libsingular.h:8,\n                 from /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp:348:\n/home/dima/sage/dev/sage/local/include/omalloc/omalloc.h:11:30: fatal error: omalloc/omConfig.h: No such file or directory\n #include <omalloc/omConfig.h>\n                              ^\n```\n\nAnd without SAGE_DEBUG the error is\n\n```\n[  1/302] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/di\nma/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/de\nv/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cytho\nnized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singula\nr.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.o -I/home/dima/sage/dev/sage/loca\nl//include -fPIC -I/home/dima/sage/dev/sage/local/include -std=gnu++11 -mmmx -mpopcnt -msse -msse2 -msse3 -msse4.1 -msse4.2 -mavx -mfpmath=ss\ne -fabi-version=6 -fno-strict-aliasing -fno-tree-copyrename\n/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.cpp: In function \u2018__pyx_obj_4sage_5rings_12finite_rings_14element_g\nivaro_FiniteField_givaroElement* __pyx_f_4sage_4libs_8singular_8singular_si2sa_GFqGivaro(snumber*, ip_sring*, __pyx_obj_4sage_5rings_12finite\n_rings_14element_givaro_Cache_givaro*)\u2019:\n/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.cpp:4218:104: error: call of overloaded \u2018init(int&, long int)\u2019 is a\nmbiguous\n     __pyx_v_c = __pyx_v_cache->objectptr->init(__pyx_v_c, ((long)p_GetCoeff(__pyx_v_z, __pyx_v_cfRing)));\n                                                                                                        ^\n/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.cpp:4218:104: note: candidates are:\n\n[..long list omitted by me - see err.log for the complete listing..] \n```",
    "created_at": "2016-09-04T15:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240563",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:369'></a>Replying to [comment:360 leif]:
> Replying to [comment:358 dimpase]:
> > still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4

> 
> When you get an error during building the Sage library, please do
> 
> ```
> #!sh
> env SAGE_NUM_THREADS=1 ./sage -b
> ```
> and post the log of *that*.


Right, sorry for the multithread mess. With singular built with SAGE_DEBUG=yes I get

```
[  1/308] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/dima/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/dev/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cythonized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.o -fno-strict-aliasing -fno-tree-copyrename
In file included from /home/dima/sage/dev/sage/local/include/singular/kernel/structs.h:12:0,
                 from /home/dima/sage/dev/sage/local/include/singular/Singular/libsingular.h:8,
                 from /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp:348:
/home/dima/sage/dev/sage/local/include/omalloc/omalloc.h:11:30: fatal error: omalloc/omConfig.h: No such file or directory
 #include <omalloc/omConfig.h>
                              ^
```

And without SAGE_DEBUG the error is

```
[  1/302] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/di
ma/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/de
v/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cytho
nized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singula
r.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.o -I/home/dima/sage/dev/sage/loca
l//include -fPIC -I/home/dima/sage/dev/sage/local/include -std=gnu++11 -mmmx -mpopcnt -msse -msse2 -msse3 -msse4.1 -msse4.2 -mavx -mfpmath=ss
e -fabi-version=6 -fno-strict-aliasing -fno-tree-copyrename
/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.cpp: In function ‘__pyx_obj_4sage_5rings_12finite_rings_14element_g
ivaro_FiniteField_givaroElement* __pyx_f_4sage_4libs_8singular_8singular_si2sa_GFqGivaro(snumber*, ip_sring*, __pyx_obj_4sage_5rings_12finite
_rings_14element_givaro_Cache_givaro*)’:
/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.cpp:4218:104: error: call of overloaded ‘init(int&, long int)’ is a
mbiguous
     __pyx_v_c = __pyx_v_cache->objectptr->init(__pyx_v_c, ((long)p_GetCoeff(__pyx_v_z, __pyx_v_cfRing)));
                                                                                                        ^
/home/dima/sage/dev/sage/src/build/cythonized/sage/libs/singular/singular.cpp:4218:104: note: candidates are:

[..long list omitted by me - see err.log for the complete listing..] 
```



---

archive/issue_comments_240564.json:
```json
{
    "body": "32-bit Ubuntu 14.04 with gcc 4.8.4 error",
    "created_at": "2016-09-04T15:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240564",
    "user": "https://github.com/dimpase"
}
```

32-bit Ubuntu 14.04 with gcc 4.8.4 error



---

archive/issue_comments_240565.json:
```json
{
    "body": "<a id='comment:370'></a>Attachment [err.log](tarball://root/attachments/some-uuid/ticket17254/err.log) by @nexttime created at 2016-09-04 15:48:11\n\nReplying to [comment:294 jdemeyer]:\n> I think this regression is not acceptable:\n> \n> ```\n>              sage: P.<x,y,z> = PolynomialRing(QQ)\n>              sage: f= x^2 + 2*x*y + 1/2*z\n>              sage: f.is_squarefree()\n>              Traceback (most recent call last):\n>              ...\n>              NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.\n> ```\n> \n> Asking whether a multivariate polynomial is squarefree seems like a very natural thing to do and not something you should just break.\n\n\nHow about\n\n```diff\n--- a/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n+++ b/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n@@ -4703,16 +4703,12 @@ cdef class MPolynomial_libsingular(sage.rings.polynomial.multi_polynomial.MPolyn\n             sage: P.<x,y,z> = PolynomialRing(QQ)\n             sage: f= x^2 + 2*x*y + 1/2*z\n             sage: f.is_squarefree()\n-            Traceback (most recent call last):\n-            ...\n-            NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.\n+            True\n             sage: h = f^2\n             sage: h.is_squarefree()\n-            Traceback (most recent call last):\n-            ...\n-            NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.\n+            False\n         \"\"\"\n-        raise NotImplementedError(\"is_squarefree of multivariate polynomials over rings is not implemented.\")\n+        return all([ e==1 for (f,e) in self.factor() ])\n \n     @coerce_binop\n     def quo_rem(self, MPolynomial_libsingular right):\n```\nfor the moment?\n\nWe could improve it later, probably on a follow-up.",
    "created_at": "2016-09-04T15:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240565",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:370'></a>Attachment [err.log](tarball://root/attachments/some-uuid/ticket17254/err.log) by @nexttime created at 2016-09-04 15:48:11

Replying to [comment:294 jdemeyer]:
> I think this regression is not acceptable:
> 
> ```
>              sage: P.<x,y,z> = PolynomialRing(QQ)
>              sage: f= x^2 + 2*x*y + 1/2*z
>              sage: f.is_squarefree()
>              Traceback (most recent call last):
>              ...
>              NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.
> ```
> 
> Asking whether a multivariate polynomial is squarefree seems like a very natural thing to do and not something you should just break.


How about

```diff
--- a/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
+++ b/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
@@ -4703,16 +4703,12 @@ cdef class MPolynomial_libsingular(sage.rings.polynomial.multi_polynomial.MPolyn
             sage: P.<x,y,z> = PolynomialRing(QQ)
             sage: f= x^2 + 2*x*y + 1/2*z
             sage: f.is_squarefree()
-            Traceback (most recent call last):
-            ...
-            NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.
+            True
             sage: h = f^2
             sage: h.is_squarefree()
-            Traceback (most recent call last):
-            ...
-            NotImplementedError: is_squarefree of multivariate polynomials over rings is not implemented.
+            False
         """
-        raise NotImplementedError("is_squarefree of multivariate polynomials over rings is not implemented.")
+        return all([ e==1 for (f,e) in self.factor() ])
 
     @coerce_binop
     def quo_rem(self, MPolynomial_libsingular right):
```
for the moment?

We could improve it later, probably on a follow-up.



---

archive/issue_comments_240566.json:
```json
{
    "body": "<a id='comment:371'></a>Replying to [comment:369 dimpase]:\n> Right, sorry for the multithread mess. With singular built with SAGE_CHECK=yes I get\n\n\nI guess you meant `SAGE_DEBUG=yes` (and `SAGE_NUM_THREADS=1`).",
    "created_at": "2016-09-04T16:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240566",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:371'></a>Replying to [comment:369 dimpase]:
> Right, sorry for the multithread mess. With singular built with SAGE_CHECK=yes I get


I guess you meant `SAGE_DEBUG=yes` (and `SAGE_NUM_THREADS=1`).



---

archive/issue_comments_240567.json:
```json
{
    "body": "<a id='comment:2'></a>I'll try to revive a 32-bit x86 machine the next days, as we have other issues on 32-bit Ubuntu 14.04 and 16.04 (i.e., building bdists for them) as well.",
    "created_at": "2016-09-04T16:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240567",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>I'll try to revive a 32-bit x86 machine the next days, as we have other issues on 32-bit Ubuntu 14.04 and 16.04 (i.e., building bdists for them) as well.



---

archive/issue_comments_240568.json:
```json
{
    "body": "<a id='comment:373'></a>Replying to [comment:371 leif]:\n> Replying to [comment:369 dimpase]:\n> > Right, sorry for the multithread mess. With singular built with SAGE_CHECK=yes I get\n\n> \n> I guess you meant `SAGE_DEBUG=yes` (and `SAGE_NUM_THREADS=1`).\n\noops, yes that's what I meant.",
    "created_at": "2016-09-04T16:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240568",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:373'></a>Replying to [comment:371 leif]:
> Replying to [comment:369 dimpase]:
> > Right, sorry for the multithread mess. With singular built with SAGE_CHECK=yes I get

> 
> I guess you meant `SAGE_DEBUG=yes` (and `SAGE_NUM_THREADS=1`).

oops, yes that's what I meant.



---

archive/issue_comments_240569.json:
```json
{
    "body": "<a id='comment:374'></a>Replying to [comment:372 leif]:\n> I'll try to revive a 32-bit x86 machine the next days, as we have other issues on 32-bit Ubuntu 14.04 and 16.04 (i.e., building bdists for them) as well.\n\n\nI've installed gcc-6.1.1 on my 32-bit system and am rebuilding Sage with it now. Hopefully it will fix the C++ madness...",
    "created_at": "2016-09-04T16:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240569",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:374'></a>Replying to [comment:372 leif]:
> I'll try to revive a 32-bit x86 machine the next days, as we have other issues on 32-bit Ubuntu 14.04 and 16.04 (i.e., building bdists for them) as well.


I've installed gcc-6.1.1 on my 32-bit system and am rebuilding Sage with it now. Hopefully it will fix the C++ madness...



---

archive/issue_comments_240570.json:
```json
{
    "body": "<a id='comment:375'></a>Replying to [comment:374 dimpase]:\n> Replying to [comment:372 leif]:\n> > I'll try to revive a 32-bit x86 machine the next days, as we have other issues on 32-bit Ubuntu 14.04 and 16.04 (i.e., building bdists for them) as well.\n\n> \n> I've installed gcc-6.1.1 on my 32-bit system and am rebuilding Sage with it now. Hopefully it will fix the C++ madness...\n\n\nNot really GCC-related I'd say, but rather 32-bit vs. 64-bit.\n\nDoes the following work for you?\n\n```diff\n--- a/src/sage/libs/singular/singular.pyx\n+++ b/src/sage/libs/singular/singular.pyx\n@@ -150,7 +150,7 @@ cdef FFgivE si2sa_GFqGivaro(number *n, ring *_ring, Cache_givaro cache):\n     order = cache.objectptr.cardinality() - 1\n \n     while z:\n-        c = cache.objectptr.initi(c, <long>p_GetCoeff(z, cfRing))\n+        c = cache.objectptr.initi(c, <int64_t>p_GetCoeff(z, cfRing))\n         e = p_GetExp(z, 1, cfRing)\n         if e == 0:\n             ret = cache.objectptr.add(ret, c, ret)\n```",
    "created_at": "2016-09-04T16:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240570",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:375'></a>Replying to [comment:374 dimpase]:
> Replying to [comment:372 leif]:
> > I'll try to revive a 32-bit x86 machine the next days, as we have other issues on 32-bit Ubuntu 14.04 and 16.04 (i.e., building bdists for them) as well.

> 
> I've installed gcc-6.1.1 on my 32-bit system and am rebuilding Sage with it now. Hopefully it will fix the C++ madness...


Not really GCC-related I'd say, but rather 32-bit vs. 64-bit.

Does the following work for you?

```diff
--- a/src/sage/libs/singular/singular.pyx
+++ b/src/sage/libs/singular/singular.pyx
@@ -150,7 +150,7 @@ cdef FFgivE si2sa_GFqGivaro(number *n, ring *_ring, Cache_givaro cache):
     order = cache.objectptr.cardinality() - 1
 
     while z:
-        c = cache.objectptr.initi(c, <long>p_GetCoeff(z, cfRing))
+        c = cache.objectptr.initi(c, <int64_t>p_GetCoeff(z, cfRing))
         e = p_GetExp(z, 1, cfRing)
         if e == 0:
             ret = cache.objectptr.add(ret, c, ret)
```



---

archive/issue_comments_240571.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-04T19:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240572.json:
```json
{
    "body": "<a id='comment:7'></a>I pushed a (hopefully sufficient) fix for the 32-bit issue and a slightly beautified version of the `is_squarefree()` implementation above.\n\n(Not sure when I'll be back.)",
    "created_at": "2016-09-04T19:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240572",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>I pushed a (hopefully sufficient) fix for the 32-bit issue and a slightly beautified version of the `is_squarefree()` implementation above.

(Not sure when I'll be back.)



---

archive/issue_comments_240573.json:
```json
{
    "body": "<a id='comment:379'></a>Replying to [comment:377 leif]:\n> I pushed a (hopefully sufficient) fix for the 32-bit issue and a slightly beautified version of the `is_squarefree()` implementation above.\n\n\nOK, at least now it builds on 32-bit.",
    "created_at": "2016-09-04T19:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240573",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:379'></a>Replying to [comment:377 leif]:
> I pushed a (hopefully sufficient) fix for the 32-bit issue and a slightly beautified version of the `is_squarefree()` implementation above.


OK, at least now it builds on 32-bit.



---

archive/issue_comments_240574.json:
```json
{
    "body": "<a id='comment:380'></a>Replying to [comment:379 dimpase]:\n> Replying to [comment:377 leif]:\n> > I pushed a (hopefully sufficient) fix for the 32-bit issue and a slightly beautified version of the `is_squarefree()` implementation above.\n\n> \n> OK, at least now it builds on 32-bit.\n\nOK, long tests pass too, modulo already reported here affine_curves test, and some unrelated numerical noise in gsl (see #21417, needs review).",
    "created_at": "2016-09-05T08:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240574",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:380'></a>Replying to [comment:379 dimpase]:
> Replying to [comment:377 leif]:
> > I pushed a (hopefully sufficient) fix for the 32-bit issue and a slightly beautified version of the `is_squarefree()` implementation above.

> 
> OK, at least now it builds on 32-bit.

OK, long tests pass too, modulo already reported here affine_curves test, and some unrelated numerical noise in gsl (see #21417, needs review).



---

archive/issue_comments_240575.json:
```json
{
    "body": "<a id='comment:381'></a>Replying to [comment:369 dimpase]:\n> Replying to [comment:360 leif]:\n> > Replying to [comment:358 dimpase]:\n> > > still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4\n\n> > \n> > When you get an error during building the Sage library, please do\n> > \n> > ```\n> > #!sh\n> > env SAGE_NUM_THREADS=1 ./sage -b\n> > ```\n> > and post the log of *that*.\n\n> \n> Right, sorry for the multithread mess. With singular built with SAGE_DEBUG=yes I get\n> \n> ```\n> [  1/308] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/dima/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/dev/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cythonized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.o -fno-strict-aliasing -fno-tree-copyrename\n> In file included from /home/dima/sage/dev/sage/local/include/singular/kernel/structs.h:12:0,\n>                  from /home/dima/sage/dev/sage/local/include/singular/Singular/libsingular.h:8,\n>                  from /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp:348:\n> /home/dima/sage/dev/sage/local/include/omalloc/omalloc.h:11:30: fatal error: omalloc/omConfig.h: No such file or directory\n>  #include <omalloc/omConfig.h>\n>                               ^\n> ```\n> \n\nCan you try to remove this line from `omallc/omalloc.h` and restart the SAge library build?",
    "created_at": "2016-09-05T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240575",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:381'></a>Replying to [comment:369 dimpase]:
> Replying to [comment:360 leif]:
> > Replying to [comment:358 dimpase]:
> > > still failing on 32-bit Ubuntu 14.04 with gcc 4.8.4

> > 
> > When you get an error during building the Sage library, please do
> > 
> > ```
> > #!sh
> > env SAGE_NUM_THREADS=1 ./sage -b
> > ```
> > and post the log of *that*.

> 
> Right, sorry for the multithread mess. With singular built with SAGE_DEBUG=yes I get
> 
> ```
> [  1/308] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/dima/sage/dev/sage/local/include -I/home/dima/sage/dev/sage/local/include/python2.7 -I/home/dima/sage/dev/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/sage/dev/sage/src -I/home/dima/sage/dev/sage/src/sage/ext -I/home/dima/sage/dev/sage/src/build/cythonized -I/home/dima/sage/dev/sage/src/build/cythonized/sage/ext -I/home/dima/sage/dev/sage/local/include/python2.7 -c /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp -o build/temp.linux-i686-2.7/home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.o -fno-strict-aliasing -fno-tree-copyrename
> In file included from /home/dima/sage/dev/sage/local/include/singular/kernel/structs.h:12:0,
>                  from /home/dima/sage/dev/sage/local/include/singular/Singular/libsingular.h:8,
>                  from /home/dima/sage/dev/sage/src/build/cythonized/sage/algebras/letterplace/free_algebra_letterplace.cpp:348:
> /home/dima/sage/dev/sage/local/include/omalloc/omalloc.h:11:30: fatal error: omalloc/omConfig.h: No such file or directory
>  #include <omalloc/omConfig.h>
>                               ^
> ```
> 

Can you try to remove this line from `omallc/omalloc.h` and restart the SAge library build?



---

archive/issue_comments_240576.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-05T11:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240576",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240577.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-05T11:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240577",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240578.json:
```json
{
    "body": "<a id='comment:384'></a>Replying to [comment:337 jdemeyer]:\n> > If I recall correctly, on Mac OS we might have both (\".so\" and \".dylib\") or only one of (\".so\" and \".dylib\")? Is that true?? \n\n> \n> Both exist for a different purpose. On OS X:\n> \n> - `.dylib` = dynamic library (needed for the usual case of linking libraries at build-time).\n> \n> - `.so` = loadable module (needed for run-time linking, for example Python extension modules).\n> \n> On most other OSes, there is no difference between these.\n\nI guess we should only deal with `dylib` on OS X as far as Singular is concerned.\nCan someone confirm this?",
    "created_at": "2016-09-05T11:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240578",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:384'></a>Replying to [comment:337 jdemeyer]:
> > If I recall correctly, on Mac OS we might have both (".so" and ".dylib") or only one of (".so" and ".dylib")? Is that true?? 

> 
> Both exist for a different purpose. On OS X:
> 
> - `.dylib` = dynamic library (needed for the usual case of linking libraries at build-time).
> 
> - `.so` = loadable module (needed for run-time linking, for example Python extension modules).
> 
> On most other OSes, there is no difference between these.

I guess we should only deal with `dylib` on OS X as far as Singular is concerned.
Can someone confirm this?



---

archive/issue_comments_240579.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-05T11:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240580.json:
```json
{
    "body": "<a id='comment:386'></a>Replying to [comment:384 jpflori]:\n> Replying to [comment:337 jdemeyer]:\n> > > If I recall correctly, on Mac OS we might have both (\".so\" and \".dylib\") or only one of (\".so\" and \".dylib\")? Is that true?? \n\n> > \n> > Both exist for a different purpose. On OS X:\n> > \n> > - `.dylib` = dynamic library (needed for the usual case of linking libraries at build-time).\n> > \n> > - `.so` = loadable module (needed for run-time linking, for example Python extension modules).\n> > \n> > On most other OSes, there is no difference between these.\n\n> I guess we should only deal with `dylib` on OS X as far as Singular is concerned.\n> Can someone confirm this?\n\nI cannot think of another platform producing `dylib` so it's fair.",
    "created_at": "2016-09-05T11:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240580",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:386'></a>Replying to [comment:384 jpflori]:
> Replying to [comment:337 jdemeyer]:
> > > If I recall correctly, on Mac OS we might have both (".so" and ".dylib") or only one of (".so" and ".dylib")? Is that true?? 

> > 
> > Both exist for a different purpose. On OS X:
> > 
> > - `.dylib` = dynamic library (needed for the usual case of linking libraries at build-time).
> > 
> > - `.so` = loadable module (needed for run-time linking, for example Python extension modules).
> > 
> > On most other OSes, there is no difference between these.

> I guess we should only deal with `dylib` on OS X as far as Singular is concerned.
> Can someone confirm this?

I cannot think of another platform producing `dylib` so it's fair.



---

archive/issue_comments_240581.json:
```json
{
    "body": "<a id='comment:7'></a>Sorry, I was not clear: I meant that Singular produces no `.so` file on OS X.",
    "created_at": "2016-09-05T12:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240581",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>Sorry, I was not clear: I meant that Singular produces no `.so` file on OS X.



---

archive/issue_comments_240582.json:
```json
{
    "body": "<a id='comment:8'></a>with `SAGE_DEBUG=yes ./sage -f singular`\non 32-bit Linux I get \n\n```\n[singular-4.0.3p3]   CXX      libSingular_la-mod_lib.lo\n[singular-4.0.3p3] misc_ip.cc: In function 'char* versionString()':\n[singular-4.0.3p3] misc_ip.cc:783:34: error: 'SIZEOF_VOIDP' was not declared in this scope\n[singular-4.0.3p3]                 SINGULAR_VERSION, SIZEOF_VOIDP*8,\n[singular-4.0.3p3]                                   ^~~~~~~~~~~~\n[singular-4.0.3p3] make[6]: *** [libSingular_la-misc_ip.lo] Error 1\n```",
    "created_at": "2016-09-05T14:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240582",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>with `SAGE_DEBUG=yes ./sage -f singular`
on 32-bit Linux I get 

```
[singular-4.0.3p3]   CXX      libSingular_la-mod_lib.lo
[singular-4.0.3p3] misc_ip.cc: In function 'char* versionString()':
[singular-4.0.3p3] misc_ip.cc:783:34: error: 'SIZEOF_VOIDP' was not declared in this scope
[singular-4.0.3p3]                 SINGULAR_VERSION, SIZEOF_VOIDP*8,
[singular-4.0.3p3]                                   ^~~~~~~~~~~~
[singular-4.0.3p3] make[6]: *** [libSingular_la-misc_ip.lo] Error 1
```



---

archive/issue_comments_240583.json:
```json
{
    "body": "<a id='comment:389'></a>Replying to [comment:383 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                         |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n> |[51502d6](https://git.sagemath.org/sage.git/commit/?id=51502d6630aaa6d8ddfc4a99901f1782aa72bfbb)|`Simplify CFLAGS treatment for Singular.`|\n\n\nYou just undid common subexpression elimination... ;-)",
    "created_at": "2016-09-05T15:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240583",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:389'></a>Replying to [comment:383 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                         |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
> |[51502d6](https://git.sagemath.org/sage.git/commit/?id=51502d6630aaa6d8ddfc4a99901f1782aa72bfbb)|`Simplify CFLAGS treatment for Singular.`|


You just undid common subexpression elimination... ;-)



---

archive/issue_comments_240584.json:
```json
{
    "body": "<a id='comment:0'></a>True.\n\nI just thought it was more readable for a human being.\nAnd was in line with the if clause.\nBut I might be wrong.",
    "created_at": "2016-09-05T15:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240584",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>True.

I just thought it was more readable for a human being.
And was in line with the if clause.
But I might be wrong.



---

archive/issue_comments_240585.json:
```json
{
    "body": "<a id='comment:391'></a>Replying to [comment:390 jpflori]:\n> And was in line with the if clause.\n\n\nWell, it's more likely we add things to `OPTIMIZATION_FLAGS` than to / past `-O0`.",
    "created_at": "2016-09-05T15:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240585",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:391'></a>Replying to [comment:390 jpflori]:
> And was in line with the if clause.


Well, it's more likely we add things to `OPTIMIZATION_FLAGS` than to / past `-O0`.



---

archive/issue_comments_240586.json:
```json
{
    "body": "<a id='comment:392'></a>Replying to [comment:388 dimpase]:\n> with `SAGE_DEBUG=yes ./sage -f singular`\n> on 32-bit Linux I get \n> \n> ```\n> [singular-4.0.3p3]   CXX      libSingular_la-mod_lib.lo\n> [singular-4.0.3p3] misc_ip.cc: In function 'char* versionString()':\n> [singular-4.0.3p3] misc_ip.cc:783:34: error: 'SIZEOF_VOIDP' was not declared in this scope\n> [singular-4.0.3p3]                 SINGULAR_VERSION, SIZEOF_VOIDP*8,\n> [singular-4.0.3p3]                                   ^~~~~~~~~~~~\n> [singular-4.0.3p3] make[6]: *** [libSingular_la-misc_ip.lo] Error 1\n> ```\n\nGot it: `omConfig.h` is needed at build time to define this...\nSo the easiest solution would be not to modify `xalloc/omalloc.h` and to ship `omConfig.h` jsut as `omalloc` does.\nCan you modify `xalloc/configure.ac` by adding \n\n```\nnodist_libomalloc_include_HEADERS = omConfig.h\n```\nthen autoreconf and retest?",
    "created_at": "2016-09-05T16:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240586",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:392'></a>Replying to [comment:388 dimpase]:
> with `SAGE_DEBUG=yes ./sage -f singular`
> on 32-bit Linux I get 
> 
> ```
> [singular-4.0.3p3]   CXX      libSingular_la-mod_lib.lo
> [singular-4.0.3p3] misc_ip.cc: In function 'char* versionString()':
> [singular-4.0.3p3] misc_ip.cc:783:34: error: 'SIZEOF_VOIDP' was not declared in this scope
> [singular-4.0.3p3]                 SINGULAR_VERSION, SIZEOF_VOIDP*8,
> [singular-4.0.3p3]                                   ^~~~~~~~~~~~
> [singular-4.0.3p3] make[6]: *** [libSingular_la-misc_ip.lo] Error 1
> ```

Got it: `omConfig.h` is needed at build time to define this...
So the easiest solution would be not to modify `xalloc/omalloc.h` and to ship `omConfig.h` jsut as `omalloc` does.
Can you modify `xalloc/configure.ac` by adding 

```
nodist_libomalloc_include_HEADERS = omConfig.h
```
then autoreconf and retest?



---

archive/issue_comments_240587.json:
```json
{
    "body": "<a id='comment:393'></a>Replying to [comment:387 jpflori]:\n> Sorry, I was not clear: I meant that Singular produces no `.so` file on OS X.\n\n\nI can only see `dylib` around here. The only `.so` files are in `lib/python2.7` (and they would be `.bundle` if we were building python as a framework).",
    "created_at": "2016-09-05T19:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240587",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:393'></a>Replying to [comment:387 jpflori]:
> Sorry, I was not clear: I meant that Singular produces no `.so` file on OS X.


I can only see `dylib` around here. The only `.so` files are in `lib/python2.7` (and they would be `.bundle` if we were building python as a framework).



---

archive/issue_comments_240588.json:
```json
{
    "body": "<a id='comment:4'></a>I have started working in earnest on a ebuild for sage-on-gentoo. I based on it on stuff in the maintree for 4.0.2. \n\nAnyway I believe that by default `--enable-gfanlib` is on. libgfan needs `cddlib` to be installed to build. Since `cddlib` is not currently a dependency of `singular`, but is a standard package, we could get different `singular` installs depending on build order.\n\nSince `cddlib` is a standard package I propose we make it a dependency of `singular` - unless there are reasons to have `gfanlib` to be completely disabled.",
    "created_at": "2016-09-05T23:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240588",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>I have started working in earnest on a ebuild for sage-on-gentoo. I based on it on stuff in the maintree for 4.0.2. 

Anyway I believe that by default `--enable-gfanlib` is on. libgfan needs `cddlib` to be installed to build. Since `cddlib` is not currently a dependency of `singular`, but is a standard package, we could get different `singular` installs depending on build order.

Since `cddlib` is a standard package I propose we make it a dependency of `singular` - unless there are reasons to have `gfanlib` to be completely disabled.



---

archive/issue_comments_240589.json:
```json
{
    "body": "<a id='comment:395'></a>Replying to [comment:394 fbissey]:\n> Anyway I believe that by default `--enable-gfanlib` is on. libgfan needs `cddlib` to be installed to build. Since `cddlib` is not currently a dependency of `singular`, but is a standard package, we could get different `singular` installs depending on build order.\n> \n> Since `cddlib` is a standard package I propose we make it a dependency of `singular` - unless there are reasons to have `gfanlib` to be completely disabled.\n\n\nI don't think so.  Go ahead...",
    "created_at": "2016-09-06T08:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240589",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:395'></a>Replying to [comment:394 fbissey]:
> Anyway I believe that by default `--enable-gfanlib` is on. libgfan needs `cddlib` to be installed to build. Since `cddlib` is not currently a dependency of `singular`, but is a standard package, we could get different `singular` installs depending on build order.
> 
> Since `cddlib` is a standard package I propose we make it a dependency of `singular` - unless there are reasons to have `gfanlib` to be completely disabled.


I don't think so.  Go ahead...



---

archive/issue_comments_240590.json:
```json
{
    "body": "<a id='comment:396'></a>Replying to [comment:395 leif]:\n> Replying to [comment:394 fbissey]:\n> > Anyway I believe that by default `--enable-gfanlib` is on. libgfan needs `cddlib` to be installed to build. Since `cddlib` is not currently a dependency of `singular`, but is a standard package, we could get different `singular` installs depending on build order.\n> > \n> > Since `cddlib` is a standard package I propose we make it a dependency of `singular` - unless there are reasons to have `gfanlib` to be completely disabled.\n\n> \n> I don't think so.  Go ahead...\n\n\nP.S.: `cddlib` just depends on GMP/MPIR, which is built (nearly) first anyway, so adding the dependency wouldn't slow down anything either.",
    "created_at": "2016-09-06T09:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240590",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:396'></a>Replying to [comment:395 leif]:
> Replying to [comment:394 fbissey]:
> > Anyway I believe that by default `--enable-gfanlib` is on. libgfan needs `cddlib` to be installed to build. Since `cddlib` is not currently a dependency of `singular`, but is a standard package, we could get different `singular` installs depending on build order.
> > 
> > Since `cddlib` is a standard package I propose we make it a dependency of `singular` - unless there are reasons to have `gfanlib` to be completely disabled.

> 
> I don't think so.  Go ahead...


P.S.: `cddlib` just depends on GMP/MPIR, which is built (nearly) first anyway, so adding the dependency wouldn't slow down anything either.



---

archive/issue_comments_240591.json:
```json
{
    "body": "<a id='comment:7'></a>G(roebner)Fans are important, let's enable this.",
    "created_at": "2016-09-06T09:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240591",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>G(roebner)Fans are important, let's enable this.



---

archive/issue_comments_240592.json:
```json
{
    "body": "<a id='comment:398'></a>Replying to [comment:397 dimpase]:\n> G(roebner)Fans are important, let's enable this.\n\n\nAFAICS they're only accessible through the Singular binary, and/but we already also have `gfan`.",
    "created_at": "2016-09-06T09:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240592",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:398'></a>Replying to [comment:397 dimpase]:
> G(roebner)Fans are important, let's enable this.


AFAICS they're only accessible through the Singular binary, and/but we already also have `gfan`.



---

archive/issue_comments_240593.json:
```json
{
    "body": "<a id='comment:399'></a>Replying to [comment:398 leif]:\n> Replying to [comment:397 dimpase]:\n> > G(roebner)Fans are important, let's enable this.\n\n> \n> AFAICS they're only accessible through the Singular binary, and/but we already also have `gfan`.\n\n\nIndeed, but there is a `libgfan.so` installed (linking may need improvement, I'll look into that) and could be used directly instead of going through a pexpect interface. Of course functionality and performance are also a consideration.",
    "created_at": "2016-09-06T10:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240593",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:399'></a>Replying to [comment:398 leif]:
> Replying to [comment:397 dimpase]:
> > G(roebner)Fans are important, let's enable this.

> 
> AFAICS they're only accessible through the Singular binary, and/but we already also have `gfan`.


Indeed, but there is a `libgfan.so` installed (linking may need improvement, I'll look into that) and could be used directly instead of going through a pexpect interface. Of course functionality and performance are also a consideration.



---

archive/issue_comments_240594.json:
```json
{
    "body": "<a id='comment:400'></a>Replying to [comment:392 jpflori]:\n> Replying to [comment:388 dimpase]:\n> > with `SAGE_DEBUG=yes ./sage -f singular`\n> > on 32-bit Linux I get \n> > \n> > ```\n> > [singular-4.0.3p3]   CXX      libSingular_la-mod_lib.lo\n> > [singular-4.0.3p3] misc_ip.cc: In function 'char* versionString()':\n> > [singular-4.0.3p3] misc_ip.cc:783:34: error: 'SIZEOF_VOIDP' was not declared in this scope\n> > [singular-4.0.3p3]                 SINGULAR_VERSION, SIZEOF_VOIDP*8,\n> > [singular-4.0.3p3]                                   ^~~~~~~~~~~~\n> > [singular-4.0.3p3] make[6]: *** [libSingular_la-misc_ip.lo] Error 1\n> > ```\n\n> Got it: `omConfig.h` is needed at build time to define this...\n> So the easiest solution would be not to modify `xalloc/omalloc.h` and to ship `omConfig.h` jsut as `omalloc` does.\n> Can you modify `xalloc/configure.ac` by adding \n> \n> ```\n> nodist_libomalloc_include_HEADERS = omConfig.h\n> ```\n> then autoreconf and retest?\n\nThis seems to work.\nI'll produce a patch.",
    "created_at": "2016-09-06T10:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240594",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:400'></a>Replying to [comment:392 jpflori]:
> Replying to [comment:388 dimpase]:
> > with `SAGE_DEBUG=yes ./sage -f singular`
> > on 32-bit Linux I get 
> > 
> > ```
> > [singular-4.0.3p3]   CXX      libSingular_la-mod_lib.lo
> > [singular-4.0.3p3] misc_ip.cc: In function 'char* versionString()':
> > [singular-4.0.3p3] misc_ip.cc:783:34: error: 'SIZEOF_VOIDP' was not declared in this scope
> > [singular-4.0.3p3]                 SINGULAR_VERSION, SIZEOF_VOIDP*8,
> > [singular-4.0.3p3]                                   ^~~~~~~~~~~~
> > [singular-4.0.3p3] make[6]: *** [libSingular_la-misc_ip.lo] Error 1
> > ```

> Got it: `omConfig.h` is needed at build time to define this...
> So the easiest solution would be not to modify `xalloc/omalloc.h` and to ship `omConfig.h` jsut as `omalloc` does.
> Can you modify `xalloc/configure.ac` by adding 
> 
> ```
> nodist_libomalloc_include_HEADERS = omConfig.h
> ```
> then autoreconf and retest?

This seems to work.
I'll produce a patch.



---

archive/issue_comments_240595.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-06T10:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240596.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-06T13:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240597.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-07T02:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240598.json:
```json
{
    "body": "<a id='comment:4'></a>And I am in. There are several other stuff I want to raise or do related to packaging:\n1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?\n2) singular install `.pc` files we should use them",
    "created_at": "2016-09-07T02:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240598",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>And I am in. There are several other stuff I want to raise or do related to packaging:
1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?
2) singular install `.pc` files we should use them



---

archive/issue_comments_240599.json:
```json
{
    "body": "<a id='comment:405'></a>Replying to [comment:404 fbissey]:\n> 1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?\n\n\nI'm guessing you're talking about dropping libfactory since Macaulay2 is an experimental spkg, so I have no objections..",
    "created_at": "2016-09-07T02:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240599",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:405'></a>Replying to [comment:404 fbissey]:
> 1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?


I'm guessing you're talking about dropping libfactory since Macaulay2 is an experimental spkg, so I have no objections..



---

archive/issue_comments_240600.json:
```json
{
    "body": "<a id='comment:6'></a>It is not really dropping it since it is naturally produced and installed when building singular. But in singular 3.x it was a static library only and libsingular had its own copy inside. In singular 4, libfactory is dynamic and libsingular depends on it...\n\nIn the past we were rebuilding libfactory.a with a slightly different configuration to satisfy Macauley2 and it had no impact on libsingular. This is potentially not the case anymore. I haven't checked but the rebuilding may just be costing us time with no final difference.",
    "created_at": "2016-09-07T02:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240600",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>It is not really dropping it since it is naturally produced and installed when building singular. But in singular 3.x it was a static library only and libsingular had its own copy inside. In singular 4, libfactory is dynamic and libsingular depends on it...

In the past we were rebuilding libfactory.a with a slightly different configuration to satisfy Macauley2 and it had no impact on libsingular. This is potentially not the case anymore. I haven't checked but the rebuilding may just be costing us time with no final difference.



---

archive/issue_comments_240601.json:
```json
{
    "body": "<a id='comment:7'></a>I am almost done with my first pass at using `Singular.pc`. Once it is done there may be simplifications that can be done in `module_list.py`. But I need to clear the view and be sure that it works as it is first.",
    "created_at": "2016-09-07T04:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240601",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>I am almost done with my first pass at using `Singular.pc`. Once it is done there may be simplifications that can be done in `module_list.py`. But I need to clear the view and be sure that it works as it is first.



---

archive/issue_comments_240602.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-07T05:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240602",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240603.json:
```json
{
    "body": "<a id='comment:409'></a>Replying to [comment:404 fbissey]:\n> And I am in. There are several other stuff I want to raise or do related to packaging:\n> 1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?\n> 2) singular install `.pc` files we should use them\n\n\nwell, AFAIK Macaulay2 uses an unpatched version of libfactory.\n(more precisely they apply [this](https://github.com/Macaulay2/M2/blob/master/M2/libraries/factory/patch-4.0.2), but it's just documentation, right?)\n\nI recently spent some time trying to resurrect M2 Sage package, so I'd prefer libfactory as it is now, a separate one.",
    "created_at": "2016-09-07T07:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240603",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:409'></a>Replying to [comment:404 fbissey]:
> And I am in. There are several other stuff I want to raise or do related to packaging:
> 1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?
> 2) singular install `.pc` files we should use them


well, AFAIK Macaulay2 uses an unpatched version of libfactory.
(more precisely they apply [this](https://github.com/Macaulay2/M2/blob/master/M2/libraries/factory/patch-4.0.2), but it's just documentation, right?)

I recently spent some time trying to resurrect M2 Sage package, so I'd prefer libfactory as it is now, a separate one.



---

archive/issue_comments_240604.json:
```json
{
    "body": "<a id='comment:410'></a>Replying to [comment:409 dimpase]:\n> Replying to [comment:404 fbissey]: \n> I recently spent some time trying to resurrect M2 Sage package, so I'd prefer libfactory as it is now, a separate one.\n> \n\n\nI will look into this further. But rebuilding libfactory is a risk. I would be OK if libfactory was a separate package and singular and M2 would build on top of it but that's not what it looks like now.",
    "created_at": "2016-09-07T07:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240604",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:410'></a>Replying to [comment:409 dimpase]:
> Replying to [comment:404 fbissey]: 
> I recently spent some time trying to resurrect M2 Sage package, so I'd prefer libfactory as it is now, a separate one.
> 


I will look into this further. But rebuilding libfactory is a risk. I would be OK if libfactory was a separate package and singular and M2 would build on top of it but that's not what it looks like now.



---

archive/issue_comments_240605.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-07T07:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240606.json:
```json
{
    "body": "<a id='comment:412'></a>Replying to [comment:403 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                                               |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n> |[399f051](https://git.sagemath.org/sage.git/commit/?id=399f051511572037fb4d2de79d44df09b34f08b0)|`Add cddlib as a dependency and make gfanlib building explicit`|\n> |[797c539](https://git.sagemath.org/sage.git/commit/?id=797c53949b2725028e41275c08cb909554fedf3c)|`Improve the cleaning`|\n\nI see `libomalloc`'s in my `loca/lib` but no `libSingomalloc`'s.\nIs the latter one what `3.x` used to install?\nWhatsoever we could still remove the former one as well.",
    "created_at": "2016-09-07T08:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240606",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:412'></a>Replying to [comment:403 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                                               |
> |-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
> |[399f051](https://git.sagemath.org/sage.git/commit/?id=399f051511572037fb4d2de79d44df09b34f08b0)|`Add cddlib as a dependency and make gfanlib building explicit`|
> |[797c539](https://git.sagemath.org/sage.git/commit/?id=797c53949b2725028e41275c08cb909554fedf3c)|`Improve the cleaning`|

I see `libomalloc`'s in my `loca/lib` but no `libSingomalloc`'s.
Is the latter one what `3.x` used to install?
Whatsoever we could still remove the former one as well.



---

archive/issue_comments_240607.json:
```json
{
    "body": "<a id='comment:3'></a>That's a mistake. I really don't know how I did that, looks like a misplaced cut and paste.",
    "created_at": "2016-09-07T09:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240607",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>That's a mistake. I really don't know how I did that, looks like a misplaced cut and paste.



---

archive/issue_comments_240608.json:
```json
{
    "body": "<a id='comment:4'></a>Maybe we could also use some more wildcards in `module_list.py`, especially for `sage/libs/singular`?",
    "created_at": "2016-09-07T09:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240608",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Maybe we could also use some more wildcards in `module_list.py`, especially for `sage/libs/singular`?



---

archive/issue_comments_240609.json:
```json
{
    "body": "<a id='comment:5'></a>Yes that's why I said it was a first pass. Once you have done that, we have a better idea about potential wildcards. `sage/libs/singular` and `sage/algebras/letterplace` both look like they could be reduced to wildcards.",
    "created_at": "2016-09-07T09:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240609",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Yes that's why I said it was a first pass. Once you have done that, we have a better idea about potential wildcards. `sage/libs/singular` and `sage/algebras/letterplace` both look like they could be reduced to wildcards.



---

archive/issue_comments_240610.json:
```json
{
    "body": "<a id='comment:6'></a>I am done for the day. No more commits from me for the next ~10hours at least.",
    "created_at": "2016-09-07T10:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240610",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>I am done for the day. No more commits from me for the next ~10hours at least.



---

archive/issue_comments_240611.json:
```json
{
    "body": "<a id='comment:417'></a>Replying to [comment:409 dimpase]:\n> Replying to [comment:404 fbissey]:\n> > And I am in. There are several other stuff I want to raise or do related to packaging:\n> > 1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?\n> > 2) singular install `.pc` files we should use them\n\n> \n> well, AFAIK Macaulay2 uses an unpatched version of libfactory.\n> (more precisely they apply [this](https://github.com/Macaulay2/M2/blob/master/M2/libraries/factory/patch-4.0.2), but it's just documentation, right?)\n> \n> I recently spent some time trying to resurrect M2 Sage package, so I'd prefer libfactory as it is now, a separate one.\n\n\nRebuilding `libfactory` as we do at the moment is nothing but redundant, so we can safely remove the step.",
    "created_at": "2016-09-07T12:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240611",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:417'></a>Replying to [comment:409 dimpase]:
> Replying to [comment:404 fbissey]:
> > And I am in. There are several other stuff I want to raise or do related to packaging:
> > 1) drop the separate (re-)building of libfactory. Historically this was done to build maccauley2 (anyone else remember that?). My understanding is that upstream maccauley2 includes its own internal copy now. And there is no new style spkg for it currently. Any objections to ditching it?
> > 2) singular install `.pc` files we should use them

> 
> well, AFAIK Macaulay2 uses an unpatched version of libfactory.
> (more precisely they apply [this](https://github.com/Macaulay2/M2/blob/master/M2/libraries/factory/patch-4.0.2), but it's just documentation, right?)
> 
> I recently spent some time trying to resurrect M2 Sage package, so I'd prefer libfactory as it is now, a separate one.


Rebuilding `libfactory` as we do at the moment is nothing but redundant, so we can safely remove the step.



---

archive/issue_comments_240612.json:
```json
{
    "body": "<a id='comment:8'></a>Yes, I'm currently cleaning up that and the \"removal\" part of `spkg-install`.\nPleas hold on.",
    "created_at": "2016-09-07T12:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240612",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>Yes, I'm currently cleaning up that and the "removal" part of `spkg-install`.
Pleas hold on.



---

archive/issue_comments_240613.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-07T12:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240613",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240614.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-07T13:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240614",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240615.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2016-09-07T13:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240615",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_240616.json:
```json
{
    "body": "<a id='comment:1'></a>Any more work needed?",
    "created_at": "2016-09-07T13:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240616",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>Any more work needed?



---

archive/issue_comments_240617.json:
```json
{
    "body": "<a id='comment:2'></a>What do we do with the failing doctest?  (The patch/buildbots won't like it.)\n\nWe could tag it `# known bug` for the moment, for example, and open a follow-up for fixing it later.",
    "created_at": "2016-09-07T13:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240617",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>What do we do with the failing doctest?  (The patch/buildbots won't like it.)

We could tag it `# known bug` for the moment, for example, and open a follow-up for fixing it later.



---

archive/issue_comments_240618.json:
```json
{
    "body": "<a id='comment:423'></a>Replying to [comment:422 leif]:\n> What do we do with the failing doctest?  (The patch/buildbots won't like it.)\n> \n\nHum, I did not think about this one.\nWhat is still failing?\nOnly different values due to the upgrade?\nOr still serious stufF?",
    "created_at": "2016-09-07T14:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240618",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:423'></a>Replying to [comment:422 leif]:
> What do we do with the failing doctest?  (The patch/buildbots won't like it.)
> 

Hum, I did not think about this one.
What is still failing?
Only different values due to the upgrade?
Or still serious stufF?



---

archive/issue_comments_240619.json:
```json
{
    "body": "<a id='comment:424'></a>Replying to [comment:423 jpflori]:\n> Replying to [comment:422 leif]:\n> > What do we do with the failing doctest?  (The patch/buildbots won't like it.)\n> > \n\n> Hum, I did not think about this one.\n> What is still failing?\n> Only different values due to the upgrade?\n> Or still serious stufF?\n\n\nAsk Dima (cf. [comment:365 comment 365]).",
    "created_at": "2016-09-07T14:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240619",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:424'></a>Replying to [comment:423 jpflori]:
> Replying to [comment:422 leif]:
> > What do we do with the failing doctest?  (The patch/buildbots won't like it.)
> > 

> Hum, I did not think about this one.
> What is still failing?
> Only different values due to the upgrade?
> Or still serious stufF?


Ask Dima (cf. [comment:365 comment 365]).



---

archive/issue_comments_240620.json:
```json
{
    "body": "<a id='comment:5'></a>Yes this is the only thing I located here...\nI have no idea either.\nI'll ask on sage-devel.",
    "created_at": "2016-09-07T14:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240620",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Yes this is the only thing I located here...
I have no idea either.
I'll ask on sage-devel.



---

archive/issue_comments_240621.json:
```json
{
    "body": "<a id='comment:426'></a>Replying to [comment:424 leif]:\n> Replying to [comment:423 jpflori]:\n> > Replying to [comment:422 leif]:\n> > > What do we do with the failing doctest?  (The patch/buildbots won't like it.)\n> > > \n\n> > Hum, I did not think about this one.\n> > What is still failing?\n> > Only different values due to the upgrade?\n> > Or still serious stufF?\n\n> \n> Ask Dima (cf. [comment:365 comment 365]).\n\n\nP.S.:  The whole doctest that fails now is\n\n```\nsage: set_verbose(-1)\nsage: K.<a> = QuadraticField(3)\nsage: A.<x,y> = AffineSpace(K, 2)\nsage: C = A.curve(x^4 + 2*x^2 + a*y^3 + 1)\nsage: C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)\n(Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,\n Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by\n 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n```",
    "created_at": "2016-09-07T14:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240621",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:426'></a>Replying to [comment:424 leif]:
> Replying to [comment:423 jpflori]:
> > Replying to [comment:422 leif]:
> > > What do we do with the failing doctest?  (The patch/buildbots won't like it.)
> > > 

> > Hum, I did not think about this one.
> > What is still failing?
> > Only different values due to the upgrade?
> > Or still serious stufF?

> 
> Ask Dima (cf. [comment:365 comment 365]).


P.S.:  The whole doctest that fails now is

```
sage: set_verbose(-1)
sage: K.<a> = QuadraticField(3)
sage: A.<x,y> = AffineSpace(K, 2)
sage: C = A.curve(x^4 + 2*x^2 + a*y^3 + 1)
sage: C.resolution_of_singularities(extend=True)[0] # long time (2 seconds)
(Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
 Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,
 Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by
 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
```



---

archive/issue_comments_240622.json:
```json
{
    "body": "<a id='comment:8'></a>I don't have this ticket built, what is the doctest returning in the new version?",
    "created_at": "2016-09-07T19:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240622",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>I don't have this ticket built, what is the doctest returning in the new version?



---

archive/issue_comments_240623.json:
```json
{
    "body": "<a id='comment:429'></a>Replying to [comment:428 bhutz]:\n> I don't have this ticket built, what is the doctest returning in the new version?\n\n\nsee #17254#comment:364",
    "created_at": "2016-09-07T20:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240623",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:429'></a>Replying to [comment:428 bhutz]:
> I don't have this ticket built, what is the doctest returning in the new version?


see #17254#comment:364



---

archive/issue_comments_240624.json:
```json
{
    "body": "<a id='comment:0'></a>Note that in both cases (old and new Singular) one gets\n\n```\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.\nverbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to very slow toy implementation.\n```\nanyway... ;-)\n\n(Hence the `set_verbose(-1)` I guess.)",
    "created_at": "2016-09-07T20:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240624",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:0'></a>Note that in both cases (old and new Singular) one gets

```
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (1081: multi_polynomial_ideal.py, dimension) Warning: falling back to very slow toy implementation.
verbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to very slow toy implementation.
```
anyway... ;-)

(Hence the `set_verbose(-1)` I guess.)



---

archive/issue_comments_240625.json:
```json
{
    "body": "<a id='comment:1'></a>Two another minor(?) issues I could not solve due to lack of expertise in sage:\n\n-reuse a plain polynomial ring over ZZ and \n\n\n-reuse Singular polynomial ring over QQ\n\ninstead of creating a new one every time,\n\n\nsee\n\n```\nsrc/sage/libs/singular/singular.pyx\n```\n\n**snip**\n\n```\n        # if I understand nrnMapGMP/nMapFuncPtr correctly we need first\n+        # a source value in ZZr\n+        # create ZZr, a plain polynomial ring over ZZ with one variable.\n+        #\n+        # todo (later): reuse ZZr\n+        _name = omStrDup(varname)\n+        _ext_names = <char**>omAlloc0(sizeof(char*))\n+        _ext_names[0] = omStrDup(_name)\n+        _cf = nInitChar( n_Z, NULL) # integer coefficient ring\n+        ZZr = rDefault (_cf ,1, _ext_names)\n+        rComplete(ZZr,1)\n```\n\n```\n\n+    # the result of nlInit2gmp() is in a plain polynomial ring over QQ (not an extension ring!),\n+    # so we hace to get/create one :\n+    #\n+    # todo: reuse qqr/ get an existing Singular polynomial ring over Q.\n+    varname = \"a\"\n+    _name = omStrDup(varname)\n+    cdef char **_ext_names\n+    _ext_names = <char**>omAlloc0(sizeof(char*))\n+    _ext_names[0] = omStrDup(_name)\n+    qqr = rDefault( 0, 1, _ext_names);\n+    rComplete(qqr,1)\n+    qqr.ShortOut = 0}}}",
    "created_at": "2016-09-07T21:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240625",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>Two another minor(?) issues I could not solve due to lack of expertise in sage:

-reuse a plain polynomial ring over ZZ and 


-reuse Singular polynomial ring over QQ

instead of creating a new one every time,


see

```
src/sage/libs/singular/singular.pyx
```

**snip**

```
        # if I understand nrnMapGMP/nMapFuncPtr correctly we need first
+        # a source value in ZZr
+        # create ZZr, a plain polynomial ring over ZZ with one variable.
+        #
+        # todo (later): reuse ZZr
+        _name = omStrDup(varname)
+        _ext_names = <char**>omAlloc0(sizeof(char*))
+        _ext_names[0] = omStrDup(_name)
+        _cf = nInitChar( n_Z, NULL) # integer coefficient ring
+        ZZr = rDefault (_cf ,1, _ext_names)
+        rComplete(ZZr,1)
```

```

+    # the result of nlInit2gmp() is in a plain polynomial ring over QQ (not an extension ring!),
+    # so we hace to get/create one :
+    #
+    # todo: reuse qqr/ get an existing Singular polynomial ring over Q.
+    varname = "a"
+    _name = omStrDup(varname)
+    cdef char **_ext_names
+    _ext_names = <char**>omAlloc0(sizeof(char*))
+    _ext_names[0] = omStrDup(_name)
+    qqr = rDefault( 0, 1, _ext_names);
+    rComplete(qqr,1)
+    qqr.ShortOut = 0}}}



---

archive/issue_comments_240626.json:
```json
{
    "body": "<a id='comment:2'></a>ok. I didn't see the diff on the doc test up there. It is possible it is just a coordinate change, but I'm going to have to get more information from it than the output is providing. I have it building now.",
    "created_at": "2016-09-07T23:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240626",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:2'></a>ok. I didn't see the diff on the doc test up there. It is possible it is just a coordinate change, but I'm going to have to get more information from it than the output is providing. I have it building now.



---

archive/issue_comments_240627.json:
```json
{
    "body": "<a id='comment:3'></a>FWIW, here's the full diff of the *EXMAPLE<sup>TM</sup>*\n\n```python\nsage: K.<a> = QuadraticField(3)\nsage: A.<x,y> = AffineSpace(K, 2)\nsage: C = A.curve(x^4 + a*y^3 +2*x^2 + 1)\nsage: res = C.resolution_of_singularities(extend=True)\n...\n```\n\nwith Singular 3.1.7p1.p2 vs. 4.0.3p3, with all three components of the result:\n\n```diff\ndiff --git a/exmaple-full.singular3.txt b/exmaple-full.singular4.txt\nindex 272f2da..0ad11d0 100644\n--- a/exmaple-full.singular3.txt\n+++ b/exmaple-full.singular4.txt\n@@ -24,41 +24,41 @@ verbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to ve\n sage: res[0]\n \n (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),\n- Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,\n- Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n+ Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,\n+ Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)\n sage: res[1]\n \n ((Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)\n     Defn: Defined on coordinates by sending (x, ss1) to\n           (x, ss1), Scheme morphism:\n     From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)\n-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1\n+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1\n     Defn: Defined on coordinates by sending (x, ss1) to\n-          (x*ss1 + (-1/8*a0^3)*ss1, 1/ss1), Scheme morphism:\n+          (x*ss1 + (1/8*a0^3)*ss1, 1/ss1), Scheme morphism:\n     From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)\n-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n     Defn: Defined on coordinates by sending (x, ss1) to\n-          (x^2*ss1 + ss1, 1/(x*ss1 + (-1/8*a0^3)*ss1))), (Scheme morphism:\n-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1\n+          (x^2*ss1 + ss1, 1/(x*ss1 + (1/8*a0^3)*ss1))), (Scheme morphism:\n+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1\n     To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)\n     Defn: Defined on coordinates by sending (s1, ss0) to\n-          (s1*ss0 + (1/8*a0^3), 1/ss0),\n-  Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1\n+          (s1*ss0 + (-1/8*a0^3), 1/ss0),\n+  Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1\n     Defn: Defined on coordinates by sending (s1, ss0) to\n           (s1, ss0),\n   Scheme morphism:\n-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1\n-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1\n+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n     Defn: Defined on coordinates by sending (s1, ss0) to\n-          (s1^2*ss0 + (1/4*a0^3)*s1, 1/s1)), (Scheme morphism:\n-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n+          (s1^2*ss0 + (-1/4*a0^3)*s1, 1/s1)), (Scheme morphism:\n+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n     To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)\n     Defn: Defined on coordinates by sending (y, s0) to\n-          (y*s0 + (-1/8*a0^3), 1/(y*s0^2 + (-1/4*a0^3)*s0)), Scheme morphism:\n-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1\n+          (y*s0 + (1/8*a0^3), 1/(y*s0^2 + (1/4*a0^3)*s0)), Scheme morphism:\n+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1\n     Defn: Defined on coordinates by sending (y, s0) to\n-          (1/s0, y*s0^2 + (-1/4*a0^3)*s0), Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n+          (1/s0, y*s0^2 + (1/4*a0^3)*s0), Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n     Defn: Defined on coordinates by sending (y, s0) to\n           (y, s0)))\n sage: res[2]\n@@ -68,13 +68,13 @@ sage: res[2]\n    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by x^4 + (1/8*a0^3 - a0)*y^3 + 2*x^2 + 1\n    Defn: Defined on coordinates by sending (x, ss1) to\n          (x, x^2*ss1 + ss1), Scheme morphism:\n-   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1\n+   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1\n    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by x^4 + (1/8*a0^3 - a0)*y^3 + 2*x^2 + 1\n    Defn: Defined on coordinates by sending (s1, ss0) to\n-         (s1*ss0 + (1/8*a0^3), s1^2*ss0 + (1/4*a0^3)*s1), Scheme morphism:\n-   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n+         (s1*ss0 + (-1/8*a0^3), s1^2*ss0 + (-1/4*a0^3)*s1), Scheme morphism:\n+   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y\n    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by x^4 + (1/8*a0^3 - a0)*y^3 + 2*x^2 + 1\n    Defn: Defined on coordinates by sending (y, s0) to\n-         (y*s0 + (-1/8*a0^3), y))\n+         (y*s0 + (1/8*a0^3), y))\n sage: \n```",
    "created_at": "2016-09-08T08:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240627",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>FWIW, here's the full diff of the *EXMAPLE<sup>TM</sup>*

```python
sage: K.<a> = QuadraticField(3)
sage: A.<x,y> = AffineSpace(K, 2)
sage: C = A.curve(x^4 + a*y^3 +2*x^2 + 1)
sage: res = C.resolution_of_singularities(extend=True)
...
```

with Singular 3.1.7p1.p2 vs. 4.0.3p3, with all three components of the result:

```diff
diff --git a/exmaple-full.singular3.txt b/exmaple-full.singular4.txt
index 272f2da..0ad11d0 100644
--- a/exmaple-full.singular3.txt
+++ b/exmaple-full.singular4.txt
@@ -24,41 +24,41 @@ verbose 0 (2086: multi_polynomial_ideal.py, variety) Warning: falling back to ve
 sage: res[0]
 
 (Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0),
- Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1,
- Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
+ Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1,
+ Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y)
 sage: res[1]
 
 ((Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)
     Defn: Defined on coordinates by sending (x, ss1) to
           (x, ss1), Scheme morphism:
     From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)
-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1
+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1
     Defn: Defined on coordinates by sending (x, ss1) to
-          (x*ss1 + (-1/8*a0^3)*ss1, 1/ss1), Scheme morphism:
+          (x*ss1 + (1/8*a0^3)*ss1, 1/ss1), Scheme morphism:
     From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)
-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
     Defn: Defined on coordinates by sending (x, ss1) to
-          (x^2*ss1 + ss1, 1/(x*ss1 + (-1/8*a0^3)*ss1))), (Scheme morphism:
-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1
+          (x^2*ss1 + ss1, 1/(x*ss1 + (1/8*a0^3)*ss1))), (Scheme morphism:
+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1
     To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)
     Defn: Defined on coordinates by sending (s1, ss0) to
-          (s1*ss0 + (1/8*a0^3), 1/ss0),
-  Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1
+          (s1*ss0 + (-1/8*a0^3), 1/ss0),
+  Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1
     Defn: Defined on coordinates by sending (s1, ss0) to
           (s1, ss0),
   Scheme morphism:
-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1
-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1
+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
     Defn: Defined on coordinates by sending (s1, ss0) to
-          (s1^2*ss0 + (1/4*a0^3)*s1, 1/s1)), (Scheme morphism:
-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
+          (s1^2*ss0 + (-1/4*a0^3)*s1, 1/s1)), (Scheme morphism:
+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
     To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*x^2*ss1^3 + 24*ss1^3 + (a0^3 - 8*a0)
     Defn: Defined on coordinates by sending (y, s0) to
-          (y*s0 + (-1/8*a0^3), 1/(y*s0^2 + (-1/4*a0^3)*s0)), Scheme morphism:
-    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
-    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1
+          (y*s0 + (1/8*a0^3), 1/(y*s0^2 + (1/4*a0^3)*s0)), Scheme morphism:
+    From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
+    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1
     Defn: Defined on coordinates by sending (y, s0) to
-          (1/s0, y*s0^2 + (-1/4*a0^3)*s0), Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
+          (1/s0, y*s0^2 + (1/4*a0^3)*s0), Scheme endomorphism of Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
     Defn: Defined on coordinates by sending (y, s0) to
           (y, s0)))
 sage: res[2]
@@ -68,13 +68,13 @@ sage: res[2]
    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by x^4 + (1/8*a0^3 - a0)*y^3 + 2*x^2 + 1
    Defn: Defined on coordinates by sending (x, ss1) to
          (x, x^2*ss1 + ss1), Scheme morphism:
-   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (6*a0^3)*s1
+   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 24*s1^2*ss0 + (a0^3 - 8*a0)*ss0^2 + (-6*a0^3)*s1
    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by x^4 + (1/8*a0^3 - a0)*y^3 + 2*x^2 + 1
    Defn: Defined on coordinates by sending (s1, ss0) to
-         (s1*ss0 + (1/8*a0^3), s1^2*ss0 + (1/4*a0^3)*s1), Scheme morphism:
-   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (-4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
+         (s1*ss0 + (-1/8*a0^3), s1^2*ss0 + (-1/4*a0^3)*s1), Scheme morphism:
+   From: Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by 8*y^2*s0^4 + (4*a0^3)*y*s0^3 - 32*s0^2 + (a0^3 - 8*a0)*y
    To:   Affine Plane Curve over Number Field in a0 with defining polynomial y^4 - 4*y^2 + 16 defined by x^4 + (1/8*a0^3 - a0)*y^3 + 2*x^2 + 1
    Defn: Defined on coordinates by sending (y, s0) to
-         (y*s0 + (-1/8*a0^3), y))
+         (y*s0 + (1/8*a0^3), y))
 sage: 
```



---

archive/issue_comments_240628.json:
```json
{
    "body": "<a id='comment:4'></a>Yes, that helps, since this ticket doesn't build for me for some reason.\n\nThis looks to me like a change of coordinates (x to -x) at the first blow-up that is then carried through the rest of the stages. The connecting maps and the new curves are changed consistently so I see nothing incorrect about the new output, it is just a change of variables from the original blow-ups.",
    "created_at": "2016-09-08T15:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240628",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:4'></a>Yes, that helps, since this ticket doesn't build for me for some reason.

This looks to me like a change of coordinates (x to -x) at the first blow-up that is then carried through the rest of the stages. The connecting maps and the new curves are changed consistently so I see nothing incorrect about the new output, it is just a change of variables from the original blow-ups.



---

archive/issue_comments_240629.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-08T17:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240629",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240630.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-09-08T17:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240630",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_240631.json:
```json
{
    "body": "<a id='comment:6'></a>Ok, I think we're good now.\nSome details are suboptimal, but most of them are documented in the source code (e.g. reuse singular rings).\n\nWho wants to change the status and let the patchbots complain?",
    "created_at": "2016-09-08T17:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240631",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Ok, I think we're good now.
Some details are suboptimal, but most of them are documented in the source code (e.g. reuse singular rings).

Who wants to change the status and let the patchbots complain?



---

archive/issue_comments_240632.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-08T19:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240632",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240633.json:
```json
{
    "body": "<a id='comment:7'></a>Ok, I just randomly added reviewers such that Volker or some scripts won't complain.\n\nAnd we should open (a) follow-up(s) for the mentioned further improvements.\n\nBut this really needs to get into Sage, hopefully already beta4.",
    "created_at": "2016-09-08T19:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240633",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>Ok, I just randomly added reviewers such that Volker or some scripts won't complain.

And we should open (a) follow-up(s) for the mentioned further improvements.

But this really needs to get into Sage, hopefully already beta4.



---

archive/issue_events_049917.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-09-08T19:27:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49917"
}
```



---

archive/issue_events_049918.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-09-08T19:27:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49918"
}
```



---

archive/issue_comments_240634.json:
```json
{
    "body": "<a id='comment:8'></a>(Scrolling through hundreds of comments...)\n\nSorry, Dima, add yourself as author or reviewer (probably Codima as the latter ;-) ), and John Perry seems to have contributed as well, so please add anybody I missed.",
    "created_at": "2016-09-08T19:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240634",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>(Scrolling through hundreds of comments...)

Sorry, Dima, add yourself as author or reviewer (probably Codima as the latter ;-) ), and John Perry seems to have contributed as well, so please add anybody I missed.



---

archive/issue_comments_240635.json:
```json
{
    "body": "<a id='comment:9'></a>CoDima should go into \"Viewers:\" field, which is missing...",
    "created_at": "2016-09-08T20:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240635",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>CoDima should go into "Viewers:" field, which is missing...



---

archive/issue_comments_240636.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n \n+Build system completely changed, and a lot of internal stuff.\n+\n+Original upstream tarball at `www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/`:  `singular-4.0.3p3` **dot** `tar` **dot** `gz`\n+\n+Modified tarball made with spkg-src at:\n+* http://perso.telecom-paristech.fr/~flori/singular-4.0.3p3.tar.bz2\n+\n+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+You can also make your own tarball based on this commit or another one with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-09T15:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240636",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,23 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
 
+Build system completely changed, and a lot of internal stuff.
+
+Original upstream tarball at `www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/`:  `singular-4.0.3p3` **dot** `tar` **dot** `gz`
+
+Modified tarball made with spkg-src at:
+* http://perso.telecom-paristech.fr/~flori/singular-4.0.3p3.tar.bz2
+
+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+You can also make your own tarball based on this commit or another one with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240637.json:
```json
{
    "body": "<a id='comment:0'></a>\n```\n...\n2016-09-09 13:14:01 (10.8 MB/s) - \u2018/tmp/tmpTW_qa8/singular-4.0.3p3.tar.bz2\u2019 saved [12948313/12948313]\n\n> Successfully uploaded\ntar xf /tmp/tmpTW_qa8/singular-4.0.3p3.tar.bz2 -C /tmp/tmpTW_qa8\n> Successfully unpacked\nSha1 of singular-4.0.3p3.tar.bz2 is c368b9dbe7e4d8abf75b49010f2bd9f426b1de11\n> Correct sha1\nNow comparing to previous spkg.\nUnable to locate existing package singular.\nhttp://perso.telecom-paristech.fr/~flori/singular-4.0.3p3.tar.bz2 -- 3 seconds\n++++++++++ http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz ++++++++++\n> name and version = singular-4.0.3p3\nwget --progress=dot:mega -O /tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz\n--2016-09-09 13:14:02--  http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz\nResolving www.mathematik.uni-kl.de (www.mathematik.uni-kl.de)... 131.246.164.55\nConnecting to www.mathematik.uni-kl.de (www.mathematik.uni-kl.de)|131.246.164.55|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 12783052 (12M) [application/x-gzip]\nSaving to: \u2018/tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz\u2019\n\n     0K ........ ........ ........ ........ ........ ........ 24% 8.43M 1s\n  3072K ........ ........ ........ ........ ........ ........ 49% 11.2M 1s\n  6144K ........ ........ ........ ........ ........ ........ 73% 11.2M 0s\n  9216K ........ ........ ........ ........ ........ ........ 98% 11.2M 0s\n 12288K ...                                                  100% 11.3M=1.2s\n\n2016-09-09 13:14:04 (10.4 MB/s) - \u2018/tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz\u2019 saved [12783052/12783052]\n\n> Successfully uploaded\ntar xf /tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz -C /tmp/tmpj_5SgQ\n> Successfully unpacked\nSha1 of singular-4.0.3p3.tar.gz is de34fab01c9c58b3b6e073049a80c0c293fddded\nTraceback (most recent call last):\n  File \"/home/sage/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1018, in test_a_ticket\n    self.check_spkg(spkg)\n  File \"/home/sage/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1197, in check_spkg\n    raise SkipTicket(\"spkg has incorrect sha1\")\nSkipTicket: spkg has incorrect sha1\n...\n```\n\nI **knew** something like [this](https://patchbot.sagemath.org/log/17254/debian/8.5/x86_64/3.16.0-4-amd64/cristal/2016-09-09%2011:14:06?short) would happen...",
    "created_at": "2016-09-09T15:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240637",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:0'></a>
```
...
2016-09-09 13:14:01 (10.8 MB/s) - ‘/tmp/tmpTW_qa8/singular-4.0.3p3.tar.bz2’ saved [12948313/12948313]

> Successfully uploaded
tar xf /tmp/tmpTW_qa8/singular-4.0.3p3.tar.bz2 -C /tmp/tmpTW_qa8
> Successfully unpacked
Sha1 of singular-4.0.3p3.tar.bz2 is c368b9dbe7e4d8abf75b49010f2bd9f426b1de11
> Correct sha1
Now comparing to previous spkg.
Unable to locate existing package singular.
http://perso.telecom-paristech.fr/~flori/singular-4.0.3p3.tar.bz2 -- 3 seconds
++++++++++ http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz ++++++++++
> name and version = singular-4.0.3p3
wget --progress=dot:mega -O /tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz
--2016-09-09 13:14:02--  http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/singular-4.0.3p3.tar.gz
Resolving www.mathematik.uni-kl.de (www.mathematik.uni-kl.de)... 131.246.164.55
Connecting to www.mathematik.uni-kl.de (www.mathematik.uni-kl.de)|131.246.164.55|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 12783052 (12M) [application/x-gzip]
Saving to: ‘/tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz’

     0K ........ ........ ........ ........ ........ ........ 24% 8.43M 1s
  3072K ........ ........ ........ ........ ........ ........ 49% 11.2M 1s
  6144K ........ ........ ........ ........ ........ ........ 73% 11.2M 0s
  9216K ........ ........ ........ ........ ........ ........ 98% 11.2M 0s
 12288K ...                                                  100% 11.3M=1.2s

2016-09-09 13:14:04 (10.4 MB/s) - ‘/tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz’ saved [12783052/12783052]

> Successfully uploaded
tar xf /tmp/tmpj_5SgQ/singular-4.0.3p3.tar.gz -C /tmp/tmpj_5SgQ
> Successfully unpacked
Sha1 of singular-4.0.3p3.tar.gz is de34fab01c9c58b3b6e073049a80c0c293fddded
Traceback (most recent call last):
  File "/home/sage/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1018, in test_a_ticket
    self.check_spkg(spkg)
  File "/home/sage/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1197, in check_spkg
    raise SkipTicket("spkg has incorrect sha1")
SkipTicket: spkg has incorrect sha1
...
```

I **knew** something like [this](https://patchbot.sagemath.org/log/17254/debian/8.5/x86_64/3.16.0-4-amd64/cristal/2016-09-09%2011:14:06?short) would happen...



---

archive/issue_comments_240638.json:
```json
{
    "body": "<a id='comment:1'></a>Seems to work on all buildbots except OSX:\n\n```\nosx:build buildslave-sage$ ./local/bin/singular\n-bash: ./local/bin/singular: Too many levels of symbolic links\n```\nNote that OSX is wonky with filename upper/lower case: Case is preserved but ignored when looking up files.",
    "created_at": "2016-09-09T22:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240638",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Seems to work on all buildbots except OSX:

```
osx:build buildslave-sage$ ./local/bin/singular
-bash: ./local/bin/singular: Too many levels of symbolic links
```
Note that OSX is wonky with filename upper/lower case: Case is preserved but ignored when looking up files.



---

archive/issue_comments_240639.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-09-09T22:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240639",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_240640.json:
```json
{
    "body": "<a id='comment:2'></a>Anyone knows why we deliberately create the link `singular` -> `Singular`? Is it for cygwin. Otherwise let's just drop it and correct the sage internals to use `Singular`. That shouldn't create any problem on OS X.\n\nI just wish I had done a build on my OS X laptop before that came up.",
    "created_at": "2016-09-09T23:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240640",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>Anyone knows why we deliberately create the link `singular` -> `Singular`? Is it for cygwin. Otherwise let's just drop it and correct the sage internals to use `Singular`. That shouldn't create any problem on OS X.

I just wish I had done a build on my OS X laptop before that came up.



---

archive/issue_comments_240641.json:
```json
{
    "body": "<a id='comment:3'></a>Hmmm, I didn't like\n\n```sh\n    # Lower case version is convenient (this can fail on\n    # case-insensitive systems, we ignore the error).\n    ln -sf Singular singular 2> /dev/null\n```\nfrom the beginning... ;-)\n\nSo this actually creates a symlink to itself on MacOS X.  Nice.\n\nJust skip symlinking on Darwin?",
    "created_at": "2016-09-10T00:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240641",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>Hmmm, I didn't like

```sh
    # Lower case version is convenient (this can fail on
    # case-insensitive systems, we ignore the error).
    ln -sf Singular singular 2> /dev/null
```
from the beginning... ;-)

So this actually creates a symlink to itself on MacOS X.  Nice.

Just skip symlinking on Darwin?



---

archive/issue_comments_240642.json:
```json
{
    "body": "<a id='comment:4'></a>... or remove the `-s`, making it a hard link, which is less dangerous.",
    "created_at": "2016-09-10T00:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240642",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>... or remove the `-s`, making it a hard link, which is less dangerous.



---

archive/issue_comments_240643.json:
```json
{
    "body": "<a id='comment:5'></a>If no one can explain why we need `singular` on case sensitive system I think we should just drop it. There is no reason for keeping that kind of useless baggage.",
    "created_at": "2016-09-10T00:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240643",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>If no one can explain why we need `singular` on case sensitive system I think we should just drop it. There is no reason for keeping that kind of useless baggage.



---

archive/issue_comments_240644.json:
```json
{
    "body": "<a id='comment:446'></a>Replying to [comment:445 fbissey]:\n> If no one can explain why we need `singular` on case sensitive system I think we should just drop it. There is no reason for keeping that kind of useless baggage. \n\n\nWell, uppercase Singular is just as ugly and inconvenient as libSingular (and their dash-versions); we'd just have to make further changes like you did for the library name.\n\nI personally don't care, but if it doesn't work on MacOS X while it's at the same time not necessary there either, why \"disable\" it for all other systems, having to make lots(?) of changes elsewhere?",
    "created_at": "2016-09-10T01:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240644",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:446'></a>Replying to [comment:445 fbissey]:
> If no one can explain why we need `singular` on case sensitive system I think we should just drop it. There is no reason for keeping that kind of useless baggage. 


Well, uppercase Singular is just as ugly and inconvenient as libSingular (and their dash-versions); we'd just have to make further changes like you did for the library name.

I personally don't care, but if it doesn't work on MacOS X while it's at the same time not necessary there either, why "disable" it for all other systems, having to make lots(?) of changes elsewhere?



---

archive/issue_comments_240645.json:
```json
{
    "body": "<a id='comment:7'></a>I think you are just pulling my leg because of #21430 :) In any case KISS principle dictate that we shouldn't mess up with what we install unless we need to. Someone did it in the past and the cost is either to keep carrying forward and keep paying, or just fix it once for all and pay a final bill. I also happen to have a fairly good idea of what needs to be fixed - because I used to do it in sage-on-gentoo.\n\nMy OS X laptop is ready for action before I push a fix.",
    "created_at": "2016-09-10T02:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240645",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>I think you are just pulling my leg because of #21430 :) In any case KISS principle dictate that we shouldn't mess up with what we install unless we need to. Someone did it in the past and the cost is either to keep carrying forward and keep paying, or just fix it once for all and pay a final bill. I also happen to have a fairly good idea of what needs to be fixed - because I used to do it in sage-on-gentoo.

My OS X laptop is ready for action before I push a fix.



---

archive/issue_comments_240646.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-10T09:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240646",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240647.json:
```json
{
    "body": "<a id='comment:9'></a>To my surprise there was only one spot with a call to `singular` instead of `Singular` left. Someone has done some cleaning. I also added a small clean up I had hanging up for ages. `singular.py` and `singular.pyx` where the two last files where `SAGE_LOCAL` is obtained through `os.environ` rather than `sage/env.py`.\n\nI'd like to see this go through the bot again now.",
    "created_at": "2016-09-10T09:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240647",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>To my surprise there was only one spot with a call to `singular` instead of `Singular` left. Someone has done some cleaning. I also added a small clean up I had hanging up for ages. `singular.py` and `singular.pyx` where the two last files where `SAGE_LOCAL` is obtained through `os.environ` rather than `sage/env.py`.

I'd like to see this go through the bot again now.



---

archive/issue_comments_240648.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-09-10T09:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240648",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_240649.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-09-10T10:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240649",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_240650.json:
```json
{
    "body": "<a id='comment:0'></a>\n``` \n[sagelib-7.4.beta4] \n[sagelib-7.4.beta4] Error compiling Cython file:\n[sagelib-7.4.beta4] ------------------------------------------------------------\n[sagelib-7.4.beta4] ...\n[sagelib-7.4.beta4]         extension = \"dylib\"\n[sagelib-7.4.beta4]     else:\n[sagelib-7.4.beta4]         extension = \"so\"\n[sagelib-7.4.beta4] \n[sagelib-7.4.beta4]     # library name changed from libsingular to libSingular btw 3.x and 4.x\n[sagelib-7.4.beta4]     lib = sage.env.SAGE_LOCAL+\"/lib/libSingular.\"+extension\n[sagelib-7.4.beta4]              ^\n[sagelib-7.4.beta4] ------------------------------------------------------------\n[sagelib-7.4.beta4] \n[sagelib-7.4.beta4] sage/libs/singular/singular.pyx:774:14: undeclared name not builtin: sage\n```",
    "created_at": "2016-09-10T10:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240650",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:0'></a>
``` 
[sagelib-7.4.beta4] 
[sagelib-7.4.beta4] Error compiling Cython file:
[sagelib-7.4.beta4] ------------------------------------------------------------
[sagelib-7.4.beta4] ...
[sagelib-7.4.beta4]         extension = "dylib"
[sagelib-7.4.beta4]     else:
[sagelib-7.4.beta4]         extension = "so"
[sagelib-7.4.beta4] 
[sagelib-7.4.beta4]     # library name changed from libsingular to libSingular btw 3.x and 4.x
[sagelib-7.4.beta4]     lib = sage.env.SAGE_LOCAL+"/lib/libSingular."+extension
[sagelib-7.4.beta4]              ^
[sagelib-7.4.beta4] ------------------------------------------------------------
[sagelib-7.4.beta4] 
[sagelib-7.4.beta4] sage/libs/singular/singular.pyx:774:14: undeclared name not builtin: sage
```



---

archive/issue_comments_240651.json:
```json
{
    "body": "<a id='comment:1'></a>OK surprising but not a deal breaker.",
    "created_at": "2016-09-10T10:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240651",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>OK surprising but not a deal breaker.



---

archive/issue_comments_240652.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-10T11:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240653.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-09-10T11:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240653",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_240654.json:
```json
{
    "body": "<a id='comment:3'></a>OK, all cleaner and I made sure it builds locally. One more time...",
    "created_at": "2016-09-10T11:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240654",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>OK, all cleaner and I made sure it builds locally. One more time...



---

archive/issue_comments_240655.json:
```json
{
    "body": "<a id='comment:4'></a>Typo:  `form`->`from`.\n\n```diff\n--- a/src/sage/interfaces/singular.py\n+++ b/src/sage/interfaces/singular.py\n@@ -2275,13 +2275,15 @@ def generate_docstring_dictionary():\nsage: from sage.interfaces.singular import generate_docstring_dictionary\nsage: generate_docstring_dictionary()\n\"\"\"\n+ form sage.env import SAGE_LOCAL\n+\nglobal nodes\nglobal node_names\n...\n```",
    "created_at": "2016-09-10T12:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240655",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Typo:  `form`->`from`.

```diff
--- a/src/sage/interfaces/singular.py
+++ b/src/sage/interfaces/singular.py
@@ -2275,13 +2275,15 @@ def generate_docstring_dictionary():
sage: from sage.interfaces.singular import generate_docstring_dictionary
sage: generate_docstring_dictionary()
"""
+ form sage.env import SAGE_LOCAL
+
global nodes
global node_names
...
```



---

archive/issue_comments_240656.json:
```json
{
    "body": "<a id='comment:5'></a>I guess you meant `form SAGE_LOCAL from sage.env`... :-)",
    "created_at": "2016-09-10T12:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240656",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>I guess you meant `form SAGE_LOCAL from sage.env`... :-)



---

archive/issue_comments_240657.json:
```json
{
    "body": "<a id='comment:6'></a>Minor things:\n\n`sage.env` also defines `SAGE_SHARE`.\n\nWe generally use `os.path.join()` rather than `+` and `'/'`.",
    "created_at": "2016-09-10T12:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240657",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>Minor things:

`sage.env` also defines `SAGE_SHARE`.

We generally use `os.path.join()` rather than `+` and `'/'`.



---

archive/issue_comments_240658.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-09-10T13:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_240659.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-09-10T13:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_240660.json:
```json
{
    "body": "<a id='comment:458'></a>Replying to [comment:454 leif]:\n> Typo:  `form`->`from`.\n> \n> ```\n> #!diff\n> --- a/src/sage/interfaces/singular.py\n> +++ b/src/sage/interfaces/singular.py\n> @@ -2275,13 +2275,15 @@ def generate_docstring_dictionary():\n> sage: from sage.interfaces.singular import generate_docstring_dictionary\n> sage: generate_docstring_dictionary()\n> \"\"\"\n> + form sage.env import SAGE_LOCAL\n> +\n> global nodes\n> global node_names\n> ...\n> ```\n\n\nFixed.  (Assuming the antipodeans are asleep.)",
    "created_at": "2016-09-10T13:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240660",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:458'></a>Replying to [comment:454 leif]:
> Typo:  `form`->`from`.
> 
> ```
> #!diff
> --- a/src/sage/interfaces/singular.py
> +++ b/src/sage/interfaces/singular.py
> @@ -2275,13 +2275,15 @@ def generate_docstring_dictionary():
> sage: from sage.interfaces.singular import generate_docstring_dictionary
> sage: generate_docstring_dictionary()
> """
> + form sage.env import SAGE_LOCAL
> +
> global nodes
> global node_names
> ...
> ```


Fixed.  (Assuming the antipodeans are asleep.)



---

archive/issue_comments_240661.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-10T13:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240661",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240662.json:
```json
{
    "body": "<a id='comment:9'></a>Anyone looked into this:\n\n```\nchecking whether to check for gfanlib... yes\nchecking setoper.h usability... yes\nchecking setoper.h presence... yes\nchecking for setoper.h... yes\nchecking cdd/setoper.h usability... no\nchecking cdd/setoper.h presence... no\nchecking for cdd/setoper.h... no\nchecking cddlib/setoper.h usability... no\nchecking cddlib/setoper.h presence... no\nchecking for cddlib/setoper.h... no\nchecking whether libcddgmp is usable... checking for dd_free_global_constants... yes\nyes\nno\nchecking whether to check for polymake interface... yes\nchecking for polymake-config... 0\n```\nand\n\n```\nchecking for setoper.h... yes\nchecking cdd/setoper.h usability... no\nchecking cdd/setoper.h presence... no\nchecking for cdd/setoper.h... no\nchecking cddlib/setoper.h usability... no\nchecking cddlib/setoper.h presence... no\nchecking for cddlib/setoper.h... no\nchecking whether libcddgmp is usable... checking for dd_free_global_constants... yes\nyes\nno\nchecking whether to check for polymake interface... yes\nchecking for polymake-config... 0\nchecking whether non-commutative subsystem should be enabled... yes\nchecking whether to have ratGB... no\nchecking built-in modules... no\nchecking SI_BUILTINMODULES_ADD(add)...... unset\nchecking BUILTIN_LIBS...... unset\n```\nI meant the `yes no` (more results than `checking`; above you have to scroll to the right to see the third), which appears twice in cddlib context, and just noticed the `polymake-config` result.\n\n(There are a few other instances where a result is shown without apparent matching `checking`.)",
    "created_at": "2016-09-10T13:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240662",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>Anyone looked into this:

```
checking whether to check for gfanlib... yes
checking setoper.h usability... yes
checking setoper.h presence... yes
checking for setoper.h... yes
checking cdd/setoper.h usability... no
checking cdd/setoper.h presence... no
checking for cdd/setoper.h... no
checking cddlib/setoper.h usability... no
checking cddlib/setoper.h presence... no
checking for cddlib/setoper.h... no
checking whether libcddgmp is usable... checking for dd_free_global_constants... yes
yes
no
checking whether to check for polymake interface... yes
checking for polymake-config... 0
```
and

```
checking for setoper.h... yes
checking cdd/setoper.h usability... no
checking cdd/setoper.h presence... no
checking for cdd/setoper.h... no
checking cddlib/setoper.h usability... no
checking cddlib/setoper.h presence... no
checking for cddlib/setoper.h... no
checking whether libcddgmp is usable... checking for dd_free_global_constants... yes
yes
no
checking whether to check for polymake interface... yes
checking for polymake-config... 0
checking whether non-commutative subsystem should be enabled... yes
checking whether to have ratGB... no
checking built-in modules... no
checking SI_BUILTINMODULES_ADD(add)...... unset
checking BUILTIN_LIBS...... unset
```
I meant the `yes no` (more results than `checking`; above you have to scroll to the right to see the third), which appears twice in cddlib context, and just noticed the `polymake-config` result.

(There are a few other instances where a result is shown without apparent matching `checking`.)



---

archive/issue_comments_240663.json:
```json
{
    "body": "<a id='comment:0'></a>Thanks Leif :) as for those messages `m4/ax_gfan_check.m4` (I think it is called) is littered with `AC_MSG_RESULT` commands that will have that effect - I am guessing other files may be too. In sage-on-gentoo I decided to disable `polymake` checking until further notice. It looks like `polymake` may need to be built a certain way or something.",
    "created_at": "2016-09-10T19:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240663",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>Thanks Leif :) as for those messages `m4/ax_gfan_check.m4` (I think it is called) is littered with `AC_MSG_RESULT` commands that will have that effect - I am guessing other files may be too. In sage-on-gentoo I decided to disable `polymake` checking until further notice. It looks like `polymake` may need to be built a certain way or something.



---

archive/issue_comments_240664.json:
```json
{
    "body": "<a id='comment:1'></a>Huh, another one:\n\n```\nsage -t --long --warn-long 98.3 src/sage/interfaces/tests.py\n**********************************************************************\nFile \"src/sage/interfaces/tests.py\", line 42, in sage.interfaces.tests\nFailed example:\n    subprocess.call(\"echo syntax error | singular\", **kwds)\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   1 of  18 in sage.interfaces.tests\n    [17 tests, 1 failure, 6.53 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 98.3 src/sage/interfaces/tests.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n(I actually forgot to look at the result of ptestlong which finished hours ago. 8-/ )",
    "created_at": "2016-09-10T19:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240664",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>Huh, another one:

```
sage -t --long --warn-long 98.3 src/sage/interfaces/tests.py
**********************************************************************
File "src/sage/interfaces/tests.py", line 42, in sage.interfaces.tests
Failed example:
    subprocess.call("echo syntax error | singular", **kwds)
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   1 of  18 in sage.interfaces.tests
    [17 tests, 1 failure, 6.53 s]
----------------------------------------------------------------------
sage -t --long --warn-long 98.3 src/sage/interfaces/tests.py  # 1 doctest failed
----------------------------------------------------------------------
```
(I actually forgot to look at the result of ptestlong which finished hours ago. 8-/ )



---

archive/issue_comments_240665.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-09-10T19:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_240666.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-09-10T19:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_240667.json:
```json
{
    "body": "<a id='comment:3'></a>Fixed.",
    "created_at": "2016-09-10T19:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240667",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>Fixed.



---

archive/issue_comments_240668.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-10T19:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240668",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240669.json:
```json
{
    "body": "<a id='comment:4'></a>Indeed I missed that one. I thought it was a message and of course on OS X (fake case sensitivity), where I ran tests, it passed.",
    "created_at": "2016-09-10T20:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240669",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>Indeed I missed that one. I thought it was a message and of course on OS X (fake case sensitivity), where I ran tests, it passed.



---

archive/issue_comments_240670.json:
```json
{
    "body": "<a id='comment:5'></a>Darn I have one failure on OS X that doesn't exist on linux\n\n```\nMirage:sage-7.2.beta5 fbissey$ ./sage -t --long --warn-long 62.6 src/sage/interfaces/singular.py\nRunning doctests with ID 2016-09-11-18-06-48-8b8f2392.\nGit branch: singular4\nUsing --optional=mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 62.6 src/sage/interfaces/singular.py\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 513, in sage.interfaces.singular.Singular._send_interrupt\nFailed example:\n    2*a\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.Singular._send_interrupt[3]>\", line 1, in <module>\n        Integer(2)*a\n      File \"sage/rings/integer.pyx\", line 1785, in sage.rings.integer.Integer.__mul__ (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/rings/integer.c:12530)\n        return coercion_model.bin_op(left, right, operator.mul)\n      File \"sage/structure/coerce.pyx\", line 1063, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/coerce.c:9153)\n        raise\n      File \"sage/structure/coerce.pyx\", line 1059, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/coerce.c:9091)\n        return PyObject_CallObject(op, xy)\n      File \"sage/structure/element.pyx\", line 1739, in sage.structure.element.RingElement.__mul__ (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/element.c:15124)\n        return (<RingElement>left)._mul_(right)\n      File \"sage/structure/element.pyx\", line 1746, in sage.structure.element.RingElement._mul_ (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/element.c:15309)\n        cpdef _mul_(self, right):\n      File \"/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 1385, in _mul_\n        return self._operation('*', right)\n      File \"/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 1264, in _operation\n        raise TypeError(msg)\n    TypeError: Singular error:\n       ? `sage126` is not defined\n       ? error occurred in or before STDIN line 12: `def sage135=sage127 * sage126;`\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.interfaces.singular.Singular._send_interrupt\n    [388 tests, 1 failure, 2.65 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.6 src/sage/interfaces/singular.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 2.8 seconds\n    cpu time: 1.8 seconds\n    cumulative wall time: 2.6 seconds\n```",
    "created_at": "2016-09-11T07:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240670",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Darn I have one failure on OS X that doesn't exist on linux

```
Mirage:sage-7.2.beta5 fbissey$ ./sage -t --long --warn-long 62.6 src/sage/interfaces/singular.py
Running doctests with ID 2016-09-11-18-06-48-8b8f2392.
Git branch: singular4
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 62.6 src/sage/interfaces/singular.py
**********************************************************************
File "src/sage/interfaces/singular.py", line 513, in sage.interfaces.singular.Singular._send_interrupt
Failed example:
    2*a
Exception raised:
    Traceback (most recent call last):
      File "/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.Singular._send_interrupt[3]>", line 1, in <module>
        Integer(2)*a
      File "sage/rings/integer.pyx", line 1785, in sage.rings.integer.Integer.__mul__ (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/rings/integer.c:12530)
        return coercion_model.bin_op(left, right, operator.mul)
      File "sage/structure/coerce.pyx", line 1063, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/coerce.c:9153)
        raise
      File "sage/structure/coerce.pyx", line 1059, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/coerce.c:9091)
        return PyObject_CallObject(op, xy)
      File "sage/structure/element.pyx", line 1739, in sage.structure.element.RingElement.__mul__ (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/element.c:15124)
        return (<RingElement>left)._mul_(right)
      File "sage/structure/element.pyx", line 1746, in sage.structure.element.RingElement._mul_ (/Users/fbissey/build/sage-7.2.beta5/src/build/cythonized/sage/structure/element.c:15309)
        cpdef _mul_(self, right):
      File "/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 1385, in _mul_
        return self._operation('*', right)
      File "/Users/fbissey/build/sage-7.2.beta5/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 1264, in _operation
        raise TypeError(msg)
    TypeError: Singular error:
       ? `sage126` is not defined
       ? error occurred in or before STDIN line 12: `def sage135=sage127 * sage126;`
**********************************************************************
1 item had failures:
   1 of   5 in sage.interfaces.singular.Singular._send_interrupt
    [388 tests, 1 failure, 2.65 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.6 src/sage/interfaces/singular.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 2.8 seconds
    cpu time: 1.8 seconds
    cumulative wall time: 2.6 seconds
```



---

archive/issue_comments_240671.json:
```json
{
    "body": "<a id='comment:6'></a>Is it always exactly the same failure?",
    "created_at": "2016-09-11T10:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240671",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>Is it always exactly the same failure?



---

archive/issue_comments_240672.json:
```json
{
    "body": "<a id='comment:7'></a>yes.",
    "created_at": "2016-09-11T11:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240672",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>yes.



---

archive/issue_comments_240673.json:
```json
{
    "body": "<a id='comment:8'></a>Ok, looking at the test (and the referenced Singular trac ticket), that's perhaps not too surprising, **of course** related to `pexpect`, and of course on MacOS X... 8-)\n\nCan you reproduce the issue directly in Singular?  (I.e., that a previously defined variable \"vanishes\" after pressing Ctrl-C on a following, incomplete line.) \n\n(And when did it last pass?)",
    "created_at": "2016-09-11T11:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240673",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>Ok, looking at the test (and the referenced Singular trac ticket), that's perhaps not too surprising, **of course** related to `pexpect`, and of course on MacOS X... 8-)

Can you reproduce the issue directly in Singular?  (I.e., that a previously defined variable "vanishes" after pressing Ctrl-C on a following, incomplete line.) 

(And when did it last pass?)



---

archive/issue_comments_240674.json:
```json
{
    "body": "<a id='comment:9'></a>I'll need instruction as I am only familiar with `singular` syntax for a few hours every other year :P when some debugging like this one seems necessary.\n\nAnd of course I won't be able to apply it before sometime after getting up - likely after I dealt with my backlog of official work.",
    "created_at": "2016-09-11T12:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240674",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>I'll need instruction as I am only familiar with `singular` syntax for a few hours every other year :P when some debugging like this one seems necessary.

And of course I won't be able to apply it before sometime after getting up - likely after I dealt with my backlog of official work.



---

archive/issue_comments_240675.json:
```json
{
    "body": "<a id='comment:0'></a>I guess it's the last commit:\n\nBranch: public/singular4 \\\\\nCommit: 76b7ea9ae8461b04870d329e886659b17**badb000** (7.4.beta2 + 128 commits)\n\nXD\n\n---\n\nYou could also try running the test in verbose mode (I'm not sure if your Singular got restarted), and playing with the parameters in the test and `_send_interrupt()` (alarm delay, delay before sending `^C`, time waiting for a prompt, and the number of times Sage tries to get the prompt, resending `;`).\n\nW.r.t. Singular syntax, compared to me you're presumably an expert. :-)\n\nOtherwise commands have to be terminated with a `;` (newline alone isn't sufficient), variable definitions look like `def foo=42;`, `foo;` evaluates the expression / prints the value of `foo`.\n\n\\\\\n\nHopefully Jeroen has a suited MacOS X box to investigate...",
    "created_at": "2016-09-11T12:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240675",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:0'></a>I guess it's the last commit:

Branch: public/singular4 \\
Commit: 76b7ea9ae8461b04870d329e886659b17**badb000** (7.4.beta2 + 128 commits)

XD

---

You could also try running the test in verbose mode (I'm not sure if your Singular got restarted), and playing with the parameters in the test and `_send_interrupt()` (alarm delay, delay before sending `^C`, time waiting for a prompt, and the number of times Sage tries to get the prompt, resending `;`).

W.r.t. Singular syntax, compared to me you're presumably an expert. :-)

Otherwise commands have to be terminated with a `;` (newline alone isn't sufficient), variable definitions look like `def foo=42;`, `foo;` evaluates the expression / prints the value of `foo`.

\\

Hopefully Jeroen has a suited MacOS X box to investigate...



---

archive/issue_comments_240676.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-09-11T22:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240676",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_240677.json:
```json
{
    "body": "<a id='comment:1'></a>I'm also getting this on Linux with SAGE_DEBUG=yes:\n\n```\n[sagetex-3.0] Done updating paths.\n[sagetex-3.0] Traceback (most recent call last):\n[sagetex-3.0]   File \"example.sagetex.sage.py\", line 4, in <module>\n[sagetex-3.0]     from sage.all_cmdline import *   # import sage library\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all_cmdline.py\", line 26, in <module>\n[sagetex-3.0]     from sage.all import *\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py\", line 103, in <module>\n[sagetex-3.0]     from sage.rings.all      import *\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/all.py\", line 54, in <module>\n[sagetex-3.0]     from .number_field.all import *\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/number_field/all.py\", line 9, in <module>\n[sagetex-3.0]     from .totallyreal import enumerate_totallyreal_fields_prim\n[sagetex-3.0]   File \"sage/rings/number_field/totallyreal_data.pxd\", line 12, in init sage.rings.number_field.totallyreal (build/cythonized/sage/rings/number_field/totallyreal.c:12118)\n[sagetex-3.0]   File \"sage/rings/number_field/totallyreal_data.pyx\", line 39, in init sage.rings.number_field.totallyreal_data (build/cythonized/sage/rings/number_field/totallyreal_data.c:12869)\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py\", line 461, in PolynomialRing\n[sagetex-3.0]     R = _single_variate(base_ring, name, sparse, implementation)\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py\", line 539, in _single_variate\n[sagetex-3.0]     R = m.PolynomialRing_integral_domain(base_ring, name, sparse, implementation)\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py\", line 1582, in __init__\n[sagetex-3.0]     sparse=sparse, element_class=element_class, category=category)\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py\", line 1453, in __init__\n[sagetex-3.0]     sparse=sparse, element_class=element_class, category=category)\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py\", line 289, in __init__\n[sagetex-3.0]     from sage.matrix.matrix_space import MatrixSpace\n[sagetex-3.0]   File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 58, in <module>\n[sagetex-3.0]     from . import matrix_mpolynomial_dense\n[sagetex-3.0]   File \"sage/rings/polynomial/multi_polynomial_libsingular.pxd\", line 6, in init sage.matrix.matrix_mpolynomial_dense (build/cythonized/sage/matrix/matrix_mpolynomial_dense.cpp:9160)\n[sagetex-3.0] ImportError: /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so: undefined symbol: errorreported\n[sagetex-3.0] Error running Sage on example.sagetex.sage!\n```",
    "created_at": "2016-09-11T22:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240677",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>I'm also getting this on Linux with SAGE_DEBUG=yes:

```
[sagetex-3.0] Done updating paths.
[sagetex-3.0] Traceback (most recent call last):
[sagetex-3.0]   File "example.sagetex.sage.py", line 4, in <module>
[sagetex-3.0]     from sage.all_cmdline import *   # import sage library
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all_cmdline.py", line 26, in <module>
[sagetex-3.0]     from sage.all import *
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py", line 103, in <module>
[sagetex-3.0]     from sage.rings.all      import *
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/all.py", line 54, in <module>
[sagetex-3.0]     from .number_field.all import *
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/number_field/all.py", line 9, in <module>
[sagetex-3.0]     from .totallyreal import enumerate_totallyreal_fields_prim
[sagetex-3.0]   File "sage/rings/number_field/totallyreal_data.pxd", line 12, in init sage.rings.number_field.totallyreal (build/cythonized/sage/rings/number_field/totallyreal.c:12118)
[sagetex-3.0]   File "sage/rings/number_field/totallyreal_data.pyx", line 39, in init sage.rings.number_field.totallyreal_data (build/cythonized/sage/rings/number_field/totallyreal_data.c:12869)
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 461, in PolynomialRing
[sagetex-3.0]     R = _single_variate(base_ring, name, sparse, implementation)
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 539, in _single_variate
[sagetex-3.0]     R = m.PolynomialRing_integral_domain(base_ring, name, sparse, implementation)
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py", line 1582, in __init__
[sagetex-3.0]     sparse=sparse, element_class=element_class, category=category)
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py", line 1453, in __init__
[sagetex-3.0]     sparse=sparse, element_class=element_class, category=category)
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.py", line 289, in __init__
[sagetex-3.0]     from sage.matrix.matrix_space import MatrixSpace
[sagetex-3.0]   File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 58, in <module>
[sagetex-3.0]     from . import matrix_mpolynomial_dense
[sagetex-3.0]   File "sage/rings/polynomial/multi_polynomial_libsingular.pxd", line 6, in init sage.matrix.matrix_mpolynomial_dense (build/cythonized/sage/matrix/matrix_mpolynomial_dense.cpp:9160)
[sagetex-3.0] ImportError: /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so: undefined symbol: errorreported
[sagetex-3.0] Error running Sage on example.sagetex.sage!
```



---

archive/issue_comments_240678.json:
```json
{
    "body": "<a id='comment:2'></a>OK, at least that one I think I can understand. A `-D...` is probably incorrect in `Singular.pc` or the whole build system, when you build it with debugging. I have fought for a long time with `-DNDEBUG` in singular 3 because I don't add it by default in sage-on-gentoo.\n\nYou get exactly the same kind of error (in reverse).",
    "created_at": "2016-09-11T22:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240678",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>OK, at least that one I think I can understand. A `-D...` is probably incorrect in `Singular.pc` or the whole build system, when you build it with debugging. I have fought for a long time with `-DNDEBUG` in singular 3 because I don't add it by default in sage-on-gentoo.

You get exactly the same kind of error (in reverse).



---

archive/issue_comments_240679.json:
```json
{
    "body": "<a id='comment:3'></a>Hum.... building from scratch I didn't seem to encounter this problem here. Access to the failed build would be needed here.",
    "created_at": "2016-09-11T23:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240679",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>Hum.... building from scratch I didn't seem to encounter this problem here. Access to the failed build would be needed here.



---

archive/issue_comments_240680.json:
```json
{
    "body": "<a id='comment:4'></a>OK, `omalloc.pc` is not produced with `SAGE_DEBUG=yes` and it didn't fail for me because the system one was eventually found (it is part of the require line in `Singular.pc`).\n\nSo this is a very real problem.",
    "created_at": "2016-09-12T00:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240680",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>OK, `omalloc.pc` is not produced with `SAGE_DEBUG=yes` and it didn't fail for me because the system one was eventually found (it is part of the require line in `Singular.pc`).

So this is a very real problem.



---

archive/issue_comments_240681.json:
```json
{
    "body": "<a id='comment:5'></a>The long term solution would be to have xalloc to produce its own `omalloc.pc` and ship it. This will have to go in `spkg-src` I am surprised at the fact that there is no apparent patching in `spkg-src`, and where is the stuff from `patches/conditional` applied?",
    "created_at": "2016-09-12T02:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240681",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>The long term solution would be to have xalloc to produce its own `omalloc.pc` and ship it. This will have to go in `spkg-src` I am surprised at the fact that there is no apparent patching in `spkg-src`, and where is the stuff from `patches/conditional` applied?



---

archive/issue_comments_240682.json:
```json
{
    "body": "<a id='comment:6'></a>New tarball, updated branch to follow.",
    "created_at": "2016-09-12T03:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240682",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>New tarball, updated branch to follow.



---

archive/issue_comments_240683.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+**Lots** of stuff has changed in Singular 4.\n+This is a big update.\n \n+Build system completely changed, and a lot of internal stuff.\n+\n+Original upstream tarball at `www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/`:  `singular-4.0.3p3` **dot** `tar` **dot** `gz`\n+\n+Modified tarball made with spkg-src at:\n+* http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2\n+\n+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:\n+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7\n+\n+You can also make your own tarball based on this commit or another one with\n+\n+```\n+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src\n+./sage --package fix-checksum singular\n+```\n+This script is loosely based on the `make_tar.sh` script from upstream.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-12T03:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240683",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,23 @@
+**Lots** of stuff has changed in Singular 4.
+This is a big update.
 
+Build system completely changed, and a lot of internal stuff.
+
+Original upstream tarball at `www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/4-0-3/`:  `singular-4.0.3p3` **dot** `tar` **dot** `gz`
+
+Modified tarball made with spkg-src at:
+* http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2
+
+This corresponds to commit a070b84d whose message tells 4.0.3p3 and on which this branch was based:
+* https://github.com/Singular/Sources/commit/a070b84d59be835a2946d1386edd3221d80f3fe7
+
+You can also make your own tarball based on this commit or another one with
+
+```
+env SINGULAR_GIT_COMMIT=a070b84d ./sage --sh build/pkgs/singular/spkg-src
+./sage --package fix-checksum singular
+```
+This script is loosely based on the `make_tar.sh` script from upstream.
 
 Comment: 1
 
``````




---

archive/issue_comments_240684.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T03:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240685.json:
```json
{
    "body": "<a id='comment:8'></a>Remain the issue on OS X if someone has a clue and instructions on how to test for someone that doesn't know how to use singular.",
    "created_at": "2016-09-12T04:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240685",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Remain the issue on OS X if someone has a clue and instructions on how to test for someone that doesn't know how to use singular.



---

archive/issue_comments_240686.json:
```json
{
    "body": "<a id='comment:479'></a>Replying to [comment:475 fbissey]:\n> The long term solution would be to have xalloc to produce its own `omalloc.pc` and ship it. This will have to go in `spkg-src` I am surprised at the fact that there is no apparent patching in `spkg-src`, and where is the stuff from `patches/conditional` applied?\n\nNope, I prefered to produce a patch for the autotools input and output files and apply it just before configuring.\nWhile we're at it, we could also update the `xalloc` patch part about `omConfig.h` to include upstream solution:\n* https://github.com/Singular/Sources/commit/bebd5a0361ed499fa0769cad9424e1bb193acd7c\n\nCan you also report the pkgconfig thing to upstream?",
    "created_at": "2016-09-12T08:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240686",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:479'></a>Replying to [comment:475 fbissey]:
> The long term solution would be to have xalloc to produce its own `omalloc.pc` and ship it. This will have to go in `spkg-src` I am surprised at the fact that there is no apparent patching in `spkg-src`, and where is the stuff from `patches/conditional` applied?

Nope, I prefered to produce a patch for the autotools input and output files and apply it just before configuring.
While we're at it, we could also update the `xalloc` patch part about `omConfig.h` to include upstream solution:
* https://github.com/Singular/Sources/commit/bebd5a0361ed499fa0769cad9424e1bb193acd7c

Can you also report the pkgconfig thing to upstream?



---

archive/issue_comments_240687.json:
```json
{
    "body": "<a id='comment:0'></a>(I've reported the omalloc.pc issue.)",
    "created_at": "2016-09-12T08:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240687",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>(I've reported the omalloc.pc issue.)



---

archive/issue_comments_240688.json:
```json
{
    "body": "<a id='comment:481'></a>Replying to [comment:479 jpflori]:\n> Replying to [comment:475 fbissey]:\n> > The long term solution would be to have xalloc to produce its own `omalloc.pc` and ship it. This will have to go in `spkg-src` I am surprised at the fact that there is no apparent patching in `spkg-src`, and where is the stuff from `patches/conditional` applied?\n\n> Nope, I prefered to produce a patch for the autotools input and output files and apply it just before configuring.\n> While we're at it, we could also update the `xalloc` patch part about `omConfig.h` to include upstream solution:\n> * https://github.com/Singular/Sources/commit/bebd5a0361ed499fa0769cad9424e1bb193acd7c\n> \n\n\nDoes that replace what I have called `src/xalloc-omconfig.patch` in my last series of push?",
    "created_at": "2016-09-12T08:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240688",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:481'></a>Replying to [comment:479 jpflori]:
> Replying to [comment:475 fbissey]:
> > The long term solution would be to have xalloc to produce its own `omalloc.pc` and ship it. This will have to go in `spkg-src` I am surprised at the fact that there is no apparent patching in `spkg-src`, and where is the stuff from `patches/conditional` applied?

> Nope, I prefered to produce a patch for the autotools input and output files and apply it just before configuring.
> While we're at it, we could also update the `xalloc` patch part about `omConfig.h` to include upstream solution:
> * https://github.com/Singular/Sources/commit/bebd5a0361ed499fa0769cad9424e1bb193acd7c
> 


Does that replace what I have called `src/xalloc-omconfig.patch` in my last series of push?



---

archive/issue_comments_240689.json:
```json
{
    "body": "<a id='comment:2'></a>Yes, exactly.",
    "created_at": "2016-09-12T09:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240689",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>Yes, exactly.



---

archive/issue_comments_240690.json:
```json
{
    "body": "<a id='comment:3'></a>And one new tarball coming then :)",
    "created_at": "2016-09-12T09:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240690",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>And one new tarball coming then :)



---

archive/issue_comments_240691.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T09:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240691",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240692.json:
```json
{
    "body": "<a id='comment:5'></a>Tarball changed in place. I could have broken upstream patch in bits triggering a rerun of autotools and the one that don't. But I preferred to keep it as one piece.",
    "created_at": "2016-09-12T09:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240692",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Tarball changed in place. I could have broken upstream patch in bits triggering a rerun of autotools and the one that don't. But I preferred to keep it as one piece.



---

archive/issue_comments_240693.json:
```json
{
    "body": "<a id='comment:6'></a>Ok, so it seems we are left with the pexpect issue on OS X.",
    "created_at": "2016-09-12T11:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240693",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Ok, so it seems we are left with the pexpect issue on OS X.



---

archive/issue_comments_240694.json:
```json
{
    "body": "<a id='comment:7'></a>\n```\n 506 files changed, 11695 insertions(+), 5407 deletions(-)\n```\n\nThanks.\n\n---\n\nWith GCC 4.8.5 and `SAGE_DEBUG=yes`, I'm getting quite a lot doctest errors (I don't get without):\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/algebras/free_algebra.py  # 4 doctests failed\nsage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # 6 doctests failed\nsage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # 2 doctests failed\nsage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # 10 doctests failed\nsage -t --long src/sage/rings/polynomial/plural.pyx  # Killed due to segmentation fault\nsage -t --long src/sage/rings/quotient_ring.py  # 18 doctests failed\nsage -t --long src/sage/rings/quotient_ring_element.py  # 1 doctest failed\nsage -t --long src/sage/schemes/curves/constructor.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nWill investigate later.",
    "created_at": "2016-09-12T18:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240694",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
```
 506 files changed, 11695 insertions(+), 5407 deletions(-)
```

Thanks.

---

With GCC 4.8.5 and `SAGE_DEBUG=yes`, I'm getting quite a lot doctest errors (I don't get without):

```
----------------------------------------------------------------------
sage -t --long src/sage/algebras/free_algebra.py  # 4 doctests failed
sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # 6 doctests failed
sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # 2 doctests failed
sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # 10 doctests failed
sage -t --long src/sage/rings/polynomial/plural.pyx  # Killed due to segmentation fault
sage -t --long src/sage/rings/quotient_ring.py  # 18 doctests failed
sage -t --long src/sage/rings/quotient_ring_element.py  # 1 doctest failed
sage -t --long src/sage/schemes/curves/constructor.py  # 1 doctest failed
----------------------------------------------------------------------
```

Will investigate later.



---

archive/issue_comments_240695.json:
```json
{
    "body": "<a id='comment:8'></a>P.S.:  I also noticed there still seem to be left-overs:\n\n```\n-rwxr-xr-x 1 leif leif 1590232 2016-09-03 03:02 local/lib/p_Procs_FieldZp.so\n-rwxr-xr-x 1 leif leif 2205960 2016-09-03 03:02 local/lib/p_Procs_FieldQ.so\n-rwxr-xr-x 1 leif leif  167344 2016-09-03 03:02 local/lib/p_Procs_FieldIndep.so\n-rwxr-xr-x 1 leif leif 4420816 2016-09-03 03:02 local/lib/p_Procs_FieldGeneral.so\n```",
    "created_at": "2016-09-12T20:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240695",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>P.S.:  I also noticed there still seem to be left-overs:

```
-rwxr-xr-x 1 leif leif 1590232 2016-09-03 03:02 local/lib/p_Procs_FieldZp.so
-rwxr-xr-x 1 leif leif 2205960 2016-09-03 03:02 local/lib/p_Procs_FieldQ.so
-rwxr-xr-x 1 leif leif  167344 2016-09-03 03:02 local/lib/p_Procs_FieldIndep.so
-rwxr-xr-x 1 leif leif 4420816 2016-09-03 03:02 local/lib/p_Procs_FieldGeneral.so
```



---

archive/issue_comments_240696.json:
```json
{
    "body": "<a id='comment:489'></a>Replying to [comment:487 leif]:\n> With GCC 4.8.5 and `SAGE_DEBUG=yes`, I'm getting quite a lot doctest errors (I don't get without):\n> \n> ```\n> ----------------------------------------------------------------------\n> sage -t --long src/sage/algebras/free_algebra.py  # 4 doctests failed\n> sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # 6 doctests failed\n> sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # 2 doctests failed\n> sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # 10 doctests failed\n> sage -t --long src/sage/rings/polynomial/plural.pyx  # Killed due to segmentation fault\n> sage -t --long src/sage/rings/quotient_ring.py  # 18 doctests failed\n> sage -t --long src/sage/rings/quotient_ring_element.py  # 1 doctest failed\n> sage -t --long src/sage/schemes/curves/constructor.py  # 1 doctest failed\n> ----------------------------------------------------------------------\n> ```\n> \n\nHopefully these are just different printings of singular objects.",
    "created_at": "2016-09-15T10:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240696",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:489'></a>Replying to [comment:487 leif]:
> With GCC 4.8.5 and `SAGE_DEBUG=yes`, I'm getting quite a lot doctest errors (I don't get without):
> 
> ```
> ----------------------------------------------------------------------
> sage -t --long src/sage/algebras/free_algebra.py  # 4 doctests failed
> sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # 6 doctests failed
> sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # 2 doctests failed
> sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # 10 doctests failed
> sage -t --long src/sage/rings/polynomial/plural.pyx  # Killed due to segmentation fault
> sage -t --long src/sage/rings/quotient_ring.py  # 18 doctests failed
> sage -t --long src/sage/rings/quotient_ring_element.py  # 1 doctest failed
> sage -t --long src/sage/schemes/curves/constructor.py  # 1 doctest failed
> ----------------------------------------------------------------------
> ```
> 

Hopefully these are just different printings of singular objects.



---

archive/issue_comments_240697.json:
```json
{
    "body": "<a id='comment:0'></a>Somehow, I don't think a segfault in plural.pyx is just from different printings. :p",
    "created_at": "2016-09-15T12:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240697",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:0'></a>Somehow, I don't think a segfault in plural.pyx is just from different printings. :p



---

archive/issue_comments_240698.json:
```json
{
    "body": "<a id='comment:1'></a>I fail to build it as is:\n\n```\nmake[2]: Entering directory '$sage-base/build/make'\nsage-logger -p 'sage-spkg singular-4.0.3p3' '$sage-base/logs/pkgs/singular-4.0.3p3.log'\n[singular-4.0.3p3] Found local metadata for singular-4.0.3p3\n[singular-4.0.3p3] Invalid checksum for cached file $sage-base/upstream/singular-4.0.3p3.tar.bz2, deleting\n[singular-4.0.3p3] Attempting to download package singular-4.0.3p3.tar.bz2 from mirrors\n[singular-4.0.3p3] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/singular/singular-4.0.3p3.tar.bz2\n[singular-4.0.3p3] [......................................................................]\n[singular-4.0.3p3] Traceback (most recent call last):\n[singular-4.0.3p3]   File \"$sage-base/build/bin/sage-download-file\", line 28, in <module>\n[singular-4.0.3p3]     run_safe()\n[singular-4.0.3p3]   File \"$sage-basebuild/bin/../sage_bootstrap/download/cmdline.py\", line 118, in run_safe\n[singular-4.0.3p3]     run()\n[singular-4.0.3p3]   File \"$sage-base/build/bin/../sage_bootstrap/download/cmdline.py\", line 100, in run\n[singular-4.0.3p3]     app.download_tarball(args.url_or_tarball, args.destination)\n[singular-4.0.3p3]   File \"$sage-base/build/bin/../sage_bootstrap/download/app.py\", line 43, in download_tarball\n[singular-4.0.3p3]     tarball.download()\n[singular-4.0.3p3]   File \"$sage-base/build/bin/../sage_bootstrap/tarball.py\", line 163, in download\n[singular-4.0.3p3]     raise ChecksumError('checksum does not match')\n[singular-4.0.3p3] sage_bootstrap.tarball.ChecksumError: checksum does not match\nMakefile:2761: recipe for target '$sage-base/local/var/lib/sage/installed/singular-4.0.3p3' failed\n\n```",
    "created_at": "2016-09-16T23:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240698",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>I fail to build it as is:

```
make[2]: Entering directory '$sage-base/build/make'
sage-logger -p 'sage-spkg singular-4.0.3p3' '$sage-base/logs/pkgs/singular-4.0.3p3.log'
[singular-4.0.3p3] Found local metadata for singular-4.0.3p3
[singular-4.0.3p3] Invalid checksum for cached file $sage-base/upstream/singular-4.0.3p3.tar.bz2, deleting
[singular-4.0.3p3] Attempting to download package singular-4.0.3p3.tar.bz2 from mirrors
[singular-4.0.3p3] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/singular/singular-4.0.3p3.tar.bz2
[singular-4.0.3p3] [......................................................................]
[singular-4.0.3p3] Traceback (most recent call last):
[singular-4.0.3p3]   File "$sage-base/build/bin/sage-download-file", line 28, in <module>
[singular-4.0.3p3]     run_safe()
[singular-4.0.3p3]   File "$sage-basebuild/bin/../sage_bootstrap/download/cmdline.py", line 118, in run_safe
[singular-4.0.3p3]     run()
[singular-4.0.3p3]   File "$sage-base/build/bin/../sage_bootstrap/download/cmdline.py", line 100, in run
[singular-4.0.3p3]     app.download_tarball(args.url_or_tarball, args.destination)
[singular-4.0.3p3]   File "$sage-base/build/bin/../sage_bootstrap/download/app.py", line 43, in download_tarball
[singular-4.0.3p3]     tarball.download()
[singular-4.0.3p3]   File "$sage-base/build/bin/../sage_bootstrap/tarball.py", line 163, in download
[singular-4.0.3p3]     raise ChecksumError('checksum does not match')
[singular-4.0.3p3] sage_bootstrap.tarball.ChecksumError: checksum does not match
Makefile:2761: recipe for target '$sage-base/local/var/lib/sage/installed/singular-4.0.3p3' failed

```



---

archive/issue_comments_240699.json:
```json
{
    "body": "<a id='comment:2'></a>Thats because of comment:485, changing the tarball in place will always lead to undesirable behavior.",
    "created_at": "2016-09-17T09:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240699",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>Thats because of comment:485, changing the tarball in place will always lead to undesirable behavior.



---

archive/issue_comments_240700.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-19T04:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240701.json:
```json
{
    "body": "<a id='comment:494'></a>Just tidying up.\n\nReplying to [comment:492 vbraun]:\n> Thats because of comment:485, changing the tarball in place will always lead to undesirable behavior.\n\n\nIn this instance because the tarball that Volker uploaded on the mirror for testing doesn't match the one I linked to in the description. It is not so much the \"in place\" I am guessing as it is \"same name\" (which arguably are the same from the point of view of the computer). If it helps I'll change the tarball name at the first opportunity.",
    "created_at": "2016-09-19T04:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240701",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:494'></a>Just tidying up.

Replying to [comment:492 vbraun]:
> Thats because of comment:485, changing the tarball in place will always lead to undesirable behavior.


In this instance because the tarball that Volker uploaded on the mirror for testing doesn't match the one I linked to in the description. It is not so much the "in place" I am guessing as it is "same name" (which arguably are the same from the point of view of the computer). If it helps I'll change the tarball name at the first opportunity.



---

archive/issue_comments_240702.json:
```json
{
    "body": "<a id='comment:5'></a>That's also why I did not patch in `spkg-src`: you can keep the same tarball.\nSure, then you have to include the autogenerated part of the patches into the patches...\nBut all that we currently do is in upstream git so should be removed for the next upgrade.",
    "created_at": "2016-09-20T06:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240702",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>That's also why I did not patch in `spkg-src`: you can keep the same tarball.
Sure, then you have to include the autogenerated part of the patches into the patches...
But all that we currently do is in upstream git so should be removed for the next upgrade.



---

archive/issue_comments_240703.json:
```json
{
    "body": "<a id='comment:6'></a>Could we try the latest snapshot from upstream to make a tarball so we don't have to worry about the patches?",
    "created_at": "2016-09-20T13:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240703",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Could we try the latest snapshot from upstream to make a tarball so we don't have to worry about the patches?



---

archive/issue_comments_240704.json:
```json
{
    "body": "<a id='comment:7'></a>That would be a nice idea but I guess there may still be a need for running autoconf at some point. Actually upstream instruction on using `xalloc` are\n\n```\nREADME for xalloc: a debug helper and alternative to omalloc\n\n- substitute in <topdir>/configure.ac and <topdir>/Makefile.am\n   omalloc by xalloc\n- in <topdir> run ./autogen.sh\n- run <topdir>/configure .....   in <builddir>\n- in <builddir> and <topdir>: save omalloc to omalloc.org, ln -s xalloc omalloc\n- run make in <builddir>\n```\nSo running autoconf before using `xalloc` is expected. Should we make a conditional patch to follow those instructions more closely. i.e. only apply the patch to configure{,.ac}/Makefile.{am,in} when DEBUG is enabled.",
    "created_at": "2016-09-20T21:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240704",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>That would be a nice idea but I guess there may still be a need for running autoconf at some point. Actually upstream instruction on using `xalloc` are

```
README for xalloc: a debug helper and alternative to omalloc

- substitute in <topdir>/configure.ac and <topdir>/Makefile.am
   omalloc by xalloc
- in <topdir> run ./autogen.sh
- run <topdir>/configure .....   in <builddir>
- in <builddir> and <topdir>: save omalloc to omalloc.org, ln -s xalloc omalloc
- run make in <builddir>
```
So running autoconf before using `xalloc` is expected. Should we make a conditional patch to follow those instructions more closely. i.e. only apply the patch to configure{,.ac}/Makefile.{am,in} when DEBUG is enabled.



---

archive/issue_comments_240705.json:
```json
{
    "body": "<a id='comment:498'></a>Replying to [comment:497 fbissey]:\n> That would be a nice idea but I guess there may still be a need for running autoconf at some point.\n\nSure there is.\n> Actually upstream instruction on using `xalloc` are\n> \n> ```\n> README for xalloc: a debug helper and alternative to omalloc\n\n...\n> }}}\nThese instructions are buggy :)\nIt is enough to `cd` to the `xalloc` dir, then `autoreconf` and if you want debug mode, then you delete the `omalloc` dir and `mv xalloc omalloc`.\n\nTo only use patch on top of the upstream `4.0.3p3` what you need to do is to autoreconf everything on your machine on a pristine tree and on a patched one and produce the patch.\nThen you ship the pristine tarball (or not so so pristine as we autoreconf it and indeed as you and I may use different autotools version the final autoreconfed dirs and patches may be different) and the patch to autotools input and output files. \nThat's what I did before.\nAnd even if we use different autotools version it's not that hard to pick up the useful part of the patches produced by `diff` by hand and remove all the crap only due to different autotools versions.",
    "created_at": "2016-09-20T21:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240705",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:498'></a>Replying to [comment:497 fbissey]:
> That would be a nice idea but I guess there may still be a need for running autoconf at some point.

Sure there is.
> Actually upstream instruction on using `xalloc` are
> 
> ```
> README for xalloc: a debug helper and alternative to omalloc

...
> }}}
These instructions are buggy :)
It is enough to `cd` to the `xalloc` dir, then `autoreconf` and if you want debug mode, then you delete the `omalloc` dir and `mv xalloc omalloc`.

To only use patch on top of the upstream `4.0.3p3` what you need to do is to autoreconf everything on your machine on a pristine tree and on a patched one and produce the patch.
Then you ship the pristine tarball (or not so so pristine as we autoreconf it and indeed as you and I may use different autotools version the final autoreconfed dirs and patches may be different) and the patch to autotools input and output files. 
That's what I did before.
And even if we use different autotools version it's not that hard to pick up the useful part of the patches produced by `diff` by hand and remove all the crap only due to different autotools versions.



---

archive/issue_comments_240706.json:
```json
{
    "body": "<a id='comment:9'></a>It is quite obvious to me that I shouldn't be making the next tarball. I just don't work that way. Jean-Pierre, do you mind to regenerate a new tarball and set of patches?",
    "created_at": "2016-09-20T22:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240706",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>It is quite obvious to me that I shouldn't be making the next tarball. I just don't work that way. Jean-Pierre, do you mind to regenerate a new tarball and set of patches?



---

archive/issue_comments_240707.json:
```json
{
    "body": "<a id='comment:0'></a>I have no intentions to work on this ticket, but I am curious how people manage these sets of patches? I know Debian has a clear infrastructure and workflow for this, but we don't seem to have any in Sage. Lately, for packages `scipoptsuite` and `gc` (#21474), I found it to be most convenient to just make a fork and then do `git format-patch` to get a set of patches to put into `patches/`.",
    "created_at": "2016-09-22T18:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240707",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>I have no intentions to work on this ticket, but I am curious how people manage these sets of patches? I know Debian has a clear infrastructure and workflow for this, but we don't seem to have any in Sage. Lately, for packages `scipoptsuite` and `gc` (#21474), I found it to be most convenient to just make a fork and then do `git format-patch` to get a set of patches to put into `patches/`.



---

archive/issue_comments_240708.json:
```json
{
    "body": "<a id='comment:501'></a>Replying to [comment:500 mkoeppe]:\n> I have no intentions to work on this ticket, but I am curious how people manage these sets of patches? I know Debian has a clear infrastructure and workflow for this, but we don't seem to have any in Sage. Lately, for packages `scipoptsuite` and `gc` (#21474), I found it to be most convenient to just make a fork and then do `git format-patch` to get a set of patches to put into `patches/`.\n\n\nyes, that's how I (roughly) do this, too. I just use `git diff` rather than `git format-patch`. Is the latter any better?.",
    "created_at": "2016-09-22T20:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240708",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:501'></a>Replying to [comment:500 mkoeppe]:
> I have no intentions to work on this ticket, but I am curious how people manage these sets of patches? I know Debian has a clear infrastructure and workflow for this, but we don't seem to have any in Sage. Lately, for packages `scipoptsuite` and `gc` (#21474), I found it to be most convenient to just make a fork and then do `git format-patch` to get a set of patches to put into `patches/`.


yes, that's how I (roughly) do this, too. I just use `git diff` rather than `git format-patch`. Is the latter any better?.



---

archive/issue_comments_240709.json:
```json
{
    "body": "<a id='comment:2'></a>It creates the patch file names from the summary lines of the git commits; and it includes a serial number.",
    "created_at": "2016-09-22T20:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240709",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>It creates the patch file names from the summary lines of the git commits; and it includes a serial number.



---

archive/issue_comments_240710.json:
```json
{
    "body": "<a id='comment:3'></a>The pexpect issue seems to be:\n* www.singular.uni-kl.de:8002/trac/ticket/729\nMaybe we should pass the new 'r' value to 'cntrlc' to abort immediately.\n`@`Jeroen: any thought about this?",
    "created_at": "2016-09-29T14:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240710",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>The pexpect issue seems to be:
* www.singular.uni-kl.de:8002/trac/ticket/729
Maybe we should pass the new 'r' value to 'cntrlc' to abort immediately.
`@`Jeroen: any thought about this?



---

archive/issue_comments_240711.json:
```json
{
    "body": "<a id='comment:4'></a>It seems Singular just decides to die:\n\n```\n> 1+\n. ^C\n   ? error occurred in or before _ line 47: `1+`^M\nAuf Wiedersehen.^M\n```",
    "created_at": "2016-09-29T14:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240711",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>It seems Singular just decides to die:

```
> 1+
. ^C
   ? error occurred in or before _ line 47: `1+`^M
Auf Wiedersehen.^M
```



---

archive/issue_comments_240712.json:
```json
{
    "body": "<a id='comment:5'></a>Running `./sage -sh -c \"Singular --cntrlc=a\"` seems completely broken for `^C`.",
    "created_at": "2016-09-29T15:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240712",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Running `./sage -sh -c "Singular --cntrlc=a"` seems completely broken for `^C`.



---

archive/issue_comments_240713.json:
```json
{
    "body": "<a id='comment:506'></a>Replying to [comment:503 jpflori]:\n> The pexpect issue seems to be:\n> * www.singular.uni-kl.de:8002/trac/ticket/729\n\n\nI have not been following the whole discussion (this is comment 506 after all). Which issue are you talking about?",
    "created_at": "2016-09-29T15:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240713",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:506'></a>Replying to [comment:503 jpflori]:
> The pexpect issue seems to be:
> * www.singular.uni-kl.de:8002/trac/ticket/729


I have not been following the whole discussion (this is comment 506 after all). Which issue are you talking about?



---

archive/issue_comments_240714.json:
```json
{
    "body": "<a id='comment:7'></a>That on the OS X buildbot the following test fails:\n\n```\n        The following works without restarting Singular::\n            sage: a = singular(1)\n            sage: _ = singular._expect.sendline('1+')  # unfinished input\n            sage: try:\n            ....:     alarm(0.5)\n            ....:     singular._expect_expr('>')  # interrupt this\n            ....: except KeyboardInterrupt:\n            ....:     pass\n            Control-C pressed.  Interrupting Singular. Please wait a few seconds...\n        We can still access a::\n            sage: 2*a\n            2\n```\n\nLogging singular output into a file, I see that when it gets interrupted, it decides to quit without further explanation (apart from auf wiedersehen).",
    "created_at": "2016-09-29T15:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240714",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>That on the OS X buildbot the following test fails:

```
        The following works without restarting Singular::
            sage: a = singular(1)
            sage: _ = singular._expect.sendline('1+')  # unfinished input
            sage: try:
            ....:     alarm(0.5)
            ....:     singular._expect_expr('>')  # interrupt this
            ....: except KeyboardInterrupt:
            ....:     pass
            Control-C pressed.  Interrupting Singular. Please wait a few seconds...
        We can still access a::
            sage: 2*a
            2
```

Logging singular output into a file, I see that when it gets interrupted, it decides to quit without further explanation (apart from auf wiedersehen).



---

archive/issue_comments_240715.json:
```json
{
    "body": "<a id='comment:8'></a>And on a machine where the tests passes:\n\n```\n> 1+\n. ^C\n;\n. ;\n   ? error occurred in or before STDIN line 48: `;`^M\n error at token `;`^M\n   ? abort...^M\n> def sage127=2;\n```",
    "created_at": "2016-09-30T07:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240715",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>And on a machine where the tests passes:

```
> 1+
. ^C
;
. ;
   ? error occurred in or before STDIN line 48: `;`^M
 error at token `;`^M
   ? abort...^M
> def sage127=2;
```



---

archive/issue_comments_240716.json:
```json
{
    "body": "<a id='comment:9'></a>And I cannot run Singular built in debug mode on that OS X machine.\nIt complains about not finding `[_]om_Info` wich I see in `libomalloc.dylib` in the `S` section.",
    "created_at": "2016-09-30T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240716",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>And I cannot run Singular built in debug mode on that OS X machine.
It complains about not finding `[_]om_Info` wich I see in `libomalloc.dylib` in the `S` section.



---

archive/issue_comments_240717.json:
```json
{
    "body": "<a id='comment:0'></a>During linking some Sage files I see\n`-lomalloc -lSingular -lpolys -lfactory -lresources`\nwhich does not look that right.",
    "created_at": "2016-09-30T09:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240717",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>During linking some Sage files I see
`-lomalloc -lSingular -lpolys -lfactory -lresources`
which does not look that right.



---

archive/issue_comments_240718.json:
```json
{
    "body": "<a id='comment:1'></a>Anyway, that's not the issue.\nMy executable has\n\n```\nbash-3.2$ nm local/bin/Singular |grep _Info\n                 U _om_Info\n```\nwhereas on a debug build on POWER7 it's in the `B` section.",
    "created_at": "2016-09-30T09:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240718",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>Anyway, that's not the issue.
My executable has

```
bash-3.2$ nm local/bin/Singular |grep _Info
                 U _om_Info
```
whereas on a debug build on POWER7 it's in the `B` section.



---

archive/issue_comments_240719.json:
```json
{
    "body": "<a id='comment:2'></a>Wahtsoever, it seems Singular behaves better if I don't pass the `-t` (`--no-tty`) option...",
    "created_at": "2016-09-30T13:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240719",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>Wahtsoever, it seems Singular behaves better if I don't pass the `-t` (`--no-tty`) option...



---

archive/issue_comments_240720.json:
```json
{
    "body": "<a id='comment:3'></a>Unfortunately, OS X makes it **very hard** to debug your own programs when you don't have root access:\n\n```\ndtrace: failed to initialize dtrace: DTrace requires additional privileges\n```",
    "created_at": "2016-09-30T13:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240720",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Unfortunately, OS X makes it **very hard** to debug your own programs when you don't have root access:

```
dtrace: failed to initialize dtrace: DTrace requires additional privileges
```



---

archive/issue_comments_240721.json:
```json
{
    "body": "<a id='comment:4'></a>On OS X, when changing the Signal handler to do nothing at all:\n\n```c\nvoid sigint_handler(int sig)\n{\n  return;\n}\n```\nthe problem still remains.",
    "created_at": "2016-09-30T13:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>On OS X, when changing the Signal handler to do nothing at all:

```c
void sigint_handler(int sig)
{
  return;
}
```
the problem still remains.



---

archive/issue_comments_240722.json:
```json
{
    "body": "<a id='comment:5'></a>The only difference made by the `-t` option stems from:\n\n```\nlatest/Singular/feOpt.cc:      case FE_OPT_NO_TTY:\nlatest/Singular/feOpt.cc-#if defined(HAVE_FEREAD) || defined(HAVE_READLINE)\nlatest/Singular/feOpt.cc:        if (feOptSpec[FE_OPT_NO_TTY].value)\nlatest/Singular/feOpt.cc-          fe_fgets_stdin=fe_fgets;\nlatest/Singular/feOpt.cc-#endif\nlatest/Singular/feOpt.cc-        return NULL;\n```\n\nAnyway, I cannot digup why this option is used.\nLet's try to discard it and live without it at first.",
    "created_at": "2016-09-30T13:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240722",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>The only difference made by the `-t` option stems from:

```
latest/Singular/feOpt.cc:      case FE_OPT_NO_TTY:
latest/Singular/feOpt.cc-#if defined(HAVE_FEREAD) || defined(HAVE_READLINE)
latest/Singular/feOpt.cc:        if (feOptSpec[FE_OPT_NO_TTY].value)
latest/Singular/feOpt.cc-          fe_fgets_stdin=fe_fgets;
latest/Singular/feOpt.cc-#endif
latest/Singular/feOpt.cc-        return NULL;
```

Anyway, I cannot digup why this option is used.
Let's try to discard it and live without it at first.



---

archive/issue_comments_240723.json:
```json
{
    "body": "<a id='comment:6'></a>Oops, it just does not work:\n\n```\nsage: singular(1)\n<repr(<sage.interfaces.singular.SingularElement at 0x19cdc0f50>) failed: AttributeError: 'NoneType' object has no attribute 'group'>\n```",
    "created_at": "2016-09-30T13:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240723",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Oops, it just does not work:

```
sage: singular(1)
<repr(<sage.interfaces.singular.SingularElement at 0x19cdc0f50>) failed: AttributeError: 'NoneType' object has no attribute 'group'>
```



---

archive/issue_comments_240724.json:
```json
{
    "body": "<a id='comment:7'></a>OK, some progress: in `si_set_signal`, there is this part:\n\n```\n  if (sig==SIGINT)\n    sigemptyset (&new_action.sa_mask);\n  else\n    new_action.sa_flags = SA_RESTART;\n```\nUnconditionally executing the last line (i.e. removing the `else`) fixes the problem.",
    "created_at": "2016-09-30T13:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240724",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>OK, some progress: in `si_set_signal`, there is this part:

```
  if (sig==SIGINT)
    sigemptyset (&new_action.sa_mask);
  else
    new_action.sa_flags = SA_RESTART;
```
Unconditionally executing the last line (i.e. removing the `else`) fixes the problem.



---

archive/issue_comments_240725.json:
```json
{
    "body": "<a id='comment:8'></a>To finish rambling on my side I get the following on a linux system:\n\n```\n[jpflori@gcc1-power7 sage.git]$ ./sage -sh -c \"Singular -t --ticks-per-sec=1000 --cntrlc=a\"\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 4.0.3\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Jan 2016\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> ^C\nAuf Wiedersehen.\n[jpflori@gcc1-power7 sage.git]$ ./sage -sh -c \"Singular --ticks-per-sec=1000 --cntrlc=a\"\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 4.0.3\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Jan 2016\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> ^C\n;\n   ? abort...\n   ? error occurred in or before STDIN line 1: `;`\n> \n```",
    "created_at": "2016-09-30T13:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240725",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>To finish rambling on my side I get the following on a linux system:

```
[jpflori@gcc1-power7 sage.git]$ ./sage -sh -c "Singular -t --ticks-per-sec=1000 --cntrlc=a"
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 4.0.3
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Jan 2016
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> ^C
Auf Wiedersehen.
[jpflori@gcc1-power7 sage.git]$ ./sage -sh -c "Singular --ticks-per-sec=1000 --cntrlc=a"
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 4.0.3
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Jan 2016
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> ^C
;
   ? abort...
   ? error occurred in or before STDIN line 1: `;`
> 
```



---

archive/issue_comments_240726.json:
```json
{
    "body": "<a id='comment:9'></a>The man page of `fgets()` reports:\n\n```\nRETURN VALUE\n\n       fgets() returns s on success, and NULL on error or when end of file occurs while no characters have been read.\n```\n\nThis is the problem: an error condition (such as an interrupt) and an EOF both give a `NULL` result for `fgets()` and Singular confuses these.",
    "created_at": "2016-09-30T14:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240726",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>The man page of `fgets()` reports:

```
RETURN VALUE

       fgets() returns s on success, and NULL on error or when end of file occurs while no characters have been read.
```

This is the problem: an error condition (such as an interrupt) and an EOF both give a `NULL` result for `fgets()` and Singular confuses these.



---

archive/issue_comments_240727.json:
```json
{
    "body": "<a id='comment:0'></a>For the `sa_flags` part, it comes from this upstream commit:\n* https://github.com/Singular/Sources/commit/72de5f54f47f1606cf29342d26eea5c7ca054155",
    "created_at": "2016-09-30T14:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240727",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>For the `sa_flags` part, it comes from this upstream commit:
* https://github.com/Singular/Sources/commit/72de5f54f47f1606cf29342d26eea5c7ca054155



---

archive/issue_comments_240728.json:
```json
{
    "body": "<a id='comment:521'></a>Replying to [comment:519 jdemeyer]:\n> The man page of `fgets()` reports:\n> \n> ```\n> RETURN VALUE\n> \n>        fgets() returns s on success, and NULL on error or when end of file occurs while no characters have been read.\n> ```\n> \n> This is the problem: an error condition (such as an interrupt) and an EOF both give a `NULL` result for `fgets()` and Singular confuses these.\n\nGreat!!!\nThanks for finding this.",
    "created_at": "2016-09-30T14:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240728",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:521'></a>Replying to [comment:519 jdemeyer]:
> The man page of `fgets()` reports:
> 
> ```
> RETURN VALUE
> 
>        fgets() returns s on success, and NULL on error or when end of file occurs while no characters have been read.
> ```
> 
> This is the problem: an error condition (such as an interrupt) and an EOF both give a `NULL` result for `fgets()` and Singular confuses these.

Great!!!
Thanks for finding this.



---

archive/issue_comments_240729.json:
```json
{
    "body": "<a id='comment:2'></a>I saw another problem with the installer: in the light of #20692, patches should be applied from `src`, not `src/latest`. Let me first fix that.",
    "created_at": "2016-09-30T15:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240729",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I saw another problem with the installer: in the light of #20692, patches should be applied from `src`, not `src/latest`. Let me first fix that.



---

archive/issue_comments_240730.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-30T15:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240731.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-30T15:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240731",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_240732.json:
```json
{
    "body": "<a id='comment:5'></a>This looks good, this was the last real issue.\nLet's give it a try on the bots.\n\nThere are some small issues left but I think they can be fixed on follow up tickets.",
    "created_at": "2016-09-30T17:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240732",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>This looks good, this was the last real issue.
Let's give it a try on the bots.

There are some small issues left but I think they can be fixed on follow up tickets.



---

archive/issue_comments_240733.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-30T17:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240733",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240734.json:
```json
{
    "body": "<a id='comment:6'></a>I've reported the fgets issue upstream.",
    "created_at": "2016-09-30T17:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240734",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>I've reported the fgets issue upstream.



---

archive/issue_comments_240735.json:
```json
{
    "body": "<a id='comment:7'></a>What could be improved later:\n* debug (with `xalloc`) build on OS X (`om_Info` gets undefined (`U`) in `Singular`, note that it is ok on linux (`B`), maybe depends on ocmpiler, linker vesions)\n* failing test in debug mode,\n* strange linking order (`omalloc` comes before `singular`!)\n* update to a further version including all patches (everything was reported upstream).",
    "created_at": "2016-09-30T17:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240735",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>What could be improved later:
* debug (with `xalloc`) build on OS X (`om_Info` gets undefined (`U`) in `Singular`, note that it is ok on linux (`B`), maybe depends on ocmpiler, linker vesions)
* failing test in debug mode,
* strange linking order (`omalloc` comes before `singular`!)
* update to a further version including all patches (everything was reported upstream).



---

archive/issue_comments_240736.json:
```json
{
    "body": "<a id='comment:8'></a>About interrupts: my patch is a big improvement but still not 100% robust. The problem is that `fgets()` is too high-level and doesn't give enough control. To do this really properly would involve the `pselect()` system call. I don't know to what extent upstream would accept this, since `pselect()` is POSIX-only.",
    "created_at": "2016-10-01T12:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240736",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>About interrupts: my patch is a big improvement but still not 100% robust. The problem is that `fgets()` is too high-level and doesn't give enough control. To do this really properly would involve the `pselect()` system call. I don't know to what extent upstream would accept this, since `pselect()` is POSIX-only.



---

archive/issue_comments_240737.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-01T18:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240737",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_240738.json:
```json
{
    "body": "<a id='comment:529'></a>Replying to [comment:528 jdemeyer]:\n> About interrupts: my patch is a big improvement but still not 100% robust. The problem is that `fgets()` is too high-level and doesn't give enough control. To do this really properly would involve the `pselect()` system call. I don't know to what extent upstream would accept this, since `pselect()` is POSIX-only.\n\n\n` `\n\n\nLet us use a robust interrupt handling in case `pselect()` is supported by the target OS and the flaky one only in remaining cases. \n\n=> Open a new ticket or change to `needs_work`?",
    "created_at": "2016-10-01T18:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240738",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:529'></a>Replying to [comment:528 jdemeyer]:
> About interrupts: my patch is a big improvement but still not 100% robust. The problem is that `fgets()` is too high-level and doesn't give enough control. To do this really properly would involve the `pselect()` system call. I don't know to what extent upstream would accept this, since `pselect()` is POSIX-only.


` `


Let us use a robust interrupt handling in case `pselect()` is supported by the target OS and the flaky one only in remaining cases. 

=> Open a new ticket or change to `needs_work`?



---

archive/issue_comments_240739.json:
```json
{
    "body": "<a id='comment:0'></a>opened a follow-up ticket #21619 for comment:431",
    "created_at": "2016-10-01T18:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240739",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:0'></a>opened a follow-up ticket #21619 for comment:431



---

archive/issue_comments_240740.json:
```json
{
    "body": "<a id='comment:1'></a>`@`all authors and reviewers\n\nplease create follow-up tickets with known remaining issues \n(I find that is mandatory for 'positive review')",
    "created_at": "2016-10-01T18:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240740",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>`@`all authors and reviewers

please create follow-up tickets with known remaining issues 
(I find that is mandatory for 'positive review')



---

archive/issue_comments_240741.json:
```json
{
    "body": "<a id='comment:532'></a>Replying to [comment:529 jakobkroeker]:\n> => Open a new ticket or change to `needs_work`?\n\n\nNew ticket obviously since the interrupt handling on this ticket is not worse than what we currently have in Singular-3-1-7.",
    "created_at": "2016-10-02T08:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240741",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:532'></a>Replying to [comment:529 jakobkroeker]:
> => Open a new ticket or change to `needs_work`?


New ticket obviously since the interrupt handling on this ticket is not worse than what we currently have in Singular-3-1-7.



---

archive/issue_comments_240742.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-02T08:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240742",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_240743.json:
```json
{
    "body": "<a id='comment:533'></a>Replying to [comment:529 jakobkroeker]:\n> Let us use a robust interrupt handling in case `pselect()` is supported by the target OS and the flaky one only in remaining cases.\n\n\nDo you think that Singular upstream would be interested in this?",
    "created_at": "2016-10-02T09:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240743",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:533'></a>Replying to [comment:529 jakobkroeker]:
> Let us use a robust interrupt handling in case `pselect()` is supported by the target OS and the flaky one only in remaining cases.


Do you think that Singular upstream would be interested in this?



---

archive/issue_comments_240744.json:
```json
{
    "body": "<a id='comment:534'></a>> \n> Do you think that Singular upstream would be interested in this [robust interrupt handling using pselect()]?\n\n\nI don't think they care too much about this issue,\n\nbut I also think they will accept a patch/pull request if we do all the work.",
    "created_at": "2016-10-02T10:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240744",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:534'></a>> 
> Do you think that Singular upstream would be interested in this [robust interrupt handling using pselect()]?


I don't think they care too much about this issue,

but I also think they will accept a patch/pull request if we do all the work.



---

archive/issue_comments_240745.json:
```json
{
    "body": "<a id='comment:7'></a>* For debug mode: #21624\n* For linking order: #21625\n* I did not open a follow up ticket for the next upgrade for obvious reasons.",
    "created_at": "2016-10-03T10:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240745",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>* For debug mode: #21624
* For linking order: #21625
* I did not open a follow up ticket for the next upgrade for obvious reasons.



---

archive/issue_comments_240746.json:
```json
{
    "body": "<a id='comment:538'></a>Replying to [comment:498 jpflori]:\n> Replying to [comment:497 fbissey]:\n> > That would be a nice idea but I guess there may still be a need for running autoconf at some point.\n\n> Sure there is.\n> > Actually upstream instruction on using `xalloc` are\n> > \n> > ```\n> > README for xalloc: a debug helper and alternative to omalloc\n\n> ...\n> > }}}\n> These instructions are buggy :)\n> It is enough to `cd` to the `xalloc` dir, then `autoreconf` and if you want debug mode, then you delete the `omalloc` dir and `mv xalloc omalloc`.\n> \n> To only use patch on top of the upstream `4.0.3p3` what you need to do is to autoreconf everything on your machine on a pristine tree and on a patched one and produce the patch.\n \n\nIs it possible to change the upstream source in a way that we do not need an autoreconf for xalloc? For example, would it be sufficient to add \n{{{\nAC_CONFIG_SUBDIRS([xalloc])\n}}}\n\nto the `configure.ac` at upstream?\n\nWhatever is required to get rid of repackaging/autoreconf, we should do that.",
    "created_at": "2016-10-03T17:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240746",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:538'></a>Replying to [comment:498 jpflori]:
> Replying to [comment:497 fbissey]:
> > That would be a nice idea but I guess there may still be a need for running autoconf at some point.

> Sure there is.
> > Actually upstream instruction on using `xalloc` are
> > 
> > ```
> > README for xalloc: a debug helper and alternative to omalloc

> ...
> > }}}
> These instructions are buggy :)
> It is enough to `cd` to the `xalloc` dir, then `autoreconf` and if you want debug mode, then you delete the `omalloc` dir and `mv xalloc omalloc`.
> 
> To only use patch on top of the upstream `4.0.3p3` what you need to do is to autoreconf everything on your machine on a pristine tree and on a patched one and produce the patch.
 

Is it possible to change the upstream source in a way that we do not need an autoreconf for xalloc? For example, would it be sufficient to add 
{{{
AC_CONFIG_SUBDIRS([xalloc])
}}}

to the `configure.ac` at upstream?

Whatever is required to get rid of repackaging/autoreconf, we should do that.



---

archive/issue_events_049919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T17:47:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49919"
}
```



---

archive/issue_events_049920.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T17:47:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49920"
}
```



---

archive/issue_comments_240747.json:
```json
{
    "body": "<a id='comment:9'></a>There is already a different .p3 tarball on the mirrors, so we first have to propagate an updated tarball. And the master fileserver is currently down.",
    "created_at": "2016-10-03T17:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240747",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>There is already a different .p3 tarball on the mirrors, so we first have to propagate an updated tarball. And the master fileserver is currently down.



---

archive/issue_comments_240748.json:
```json
{
    "body": "<a id='comment:540'></a>Replying to [comment:537 jpflori]:\n> * For debug mode: #21624\n> * For linking order: #21625\n> * I did not open a follow up ticket for the next upgrade for obvious reasons.\n\n\nThere is now a metaticket #21632 to collect the remaining issues.",
    "created_at": "2016-10-03T18:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240748",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:540'></a>Replying to [comment:537 jpflori]:
> * For debug mode: #21624
> * For linking order: #21625
> * I did not open a follow up ticket for the next upgrade for obvious reasons.


There is now a metaticket #21632 to collect the remaining issues.



---

archive/issue_comments_240749.json:
```json
{
    "body": "<a id='comment:1'></a>I'm sorry, but since this thread is read by some Singular interface experts, \nI would like to advertise the tickets #17696, #13999, #17697, #10708, #12529. \n\nCould you have a look?",
    "created_at": "2016-10-03T20:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240749",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>I'm sorry, but since this thread is read by some Singular interface experts, 
I would like to advertise the tickets #17696, #13999, #17697, #10708, #12529. 

Could you have a look?



---

archive/issue_comments_240750.json:
```json
{
    "body": "<a id='comment:2'></a>now xalloc folder should be autoconfigured upstream,\n(if I did it right);\nsee https://github.com/Singular/Sources/pull/795",
    "created_at": "2016-10-04T19:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240750",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:2'></a>now xalloc folder should be autoconfigured upstream,
(if I did it right);
see https://github.com/Singular/Sources/pull/795



---

archive/issue_comments_240751.json:
```json
{
    "body": "<a id='comment:3'></a>I hacked into the patchbot allowing unsafe tickets and got the following:\n\n```\n> Successfully unpacked\nSha1 of singular-4.0.3p3.tar.bz2 is dd68e84ef7d0e6c35994e0fce0faa8edf38a7bb1\nTraceback (most recent call last):\n  File \"/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1046, in test_a_ticket\n    self.check_spkg(spkg)\n  File \"/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1227, in check_spkg\n    given_sha = open(path).read().splitlines()[1].split('=')[1]\nIOError: [Errno 2] No such file or directory: 'build/pkgs/singular/checksums.ini'\nhttp://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2 -- 26 seconds\nApply -- 7751 seconds\nhttp://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2 -- 26 seconds\n2016-10-04 21:51:04\n7777 seconds\n[2016-10-04 21:51:06] Reporting #17254 with status Spkg\nfatal: Unable to read current working directory: Datei oder Verzeichnis nicht gefunden\nTraceback (most recent call last):\n  File \"/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1328, in report_ticket\n    tags = [describe_branch('patchbot/base', tag_only=True),\n  File \"/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/util.py\", line 235, in describe_branch\n    universal_newlines=True)\n  File \"/usr/lib/python2.7/subprocess.py\", line 544, in check_output\n    raise CalledProcessError(retcode, cmd, output=output)\nCalledProcessError: Command '['git', 'describe', '--tags', '--match', '[0-9].[0-9]*', 'patchbot/base']' returned non-zero exit status 128\n[2016-10-04 21:51:06] #17254: Spkg\nREPORT\n{'base': '7.4.beta6',\n 'deps': [17635],\n 'machine': ['Ubuntu',\n             '12.04',\n             'x86_64',\n             '3.2.0-70-generic',\n             'x200t-ThinkPad-X200-Tablet'],\n 'owner': 'unknown owner',\n 'patchbot_version': '2.6.3',\n 'plugins': [],\n 'spkgs': [u'http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2'],\n 'status': 'Spkg',\n 'time': '2016-10-04 21:51:06',\n 'user': 'jakobkroeker'}\n17254: Spkg\nok (report successfully posted)\n[2016-10-04 21:51:15] Done reporting #17254\nTraceback (most recent call last):\n  File \"/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1509, in main\n    patchbot.test_a_ticket(ticket)\n  File \"/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1185, in test_a_ticket\n    shutil.rmtree(maybe_temp_root)\n  File \"/usr/lib/python2.7/shutil.py\", line 237, in rmtree\n    onerror(os.listdir, path, sys.exc_info())\n  File \"/usr/lib/python2.7/shutil.py\", line 235, in rmtree\n    names = os.listdir(path)\nOSError: [Errno 2] No such file or directory: '/tmp/tmp8iZiiy-sage-git-temp-17254'\n\n\n```",
    "created_at": "2016-10-04T22:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240751",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:3'></a>I hacked into the patchbot allowing unsafe tickets and got the following:

```
> Successfully unpacked
Sha1 of singular-4.0.3p3.tar.bz2 is dd68e84ef7d0e6c35994e0fce0faa8edf38a7bb1
Traceback (most recent call last):
  File "/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1046, in test_a_ticket
    self.check_spkg(spkg)
  File "/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1227, in check_spkg
    given_sha = open(path).read().splitlines()[1].split('=')[1]
IOError: [Errno 2] No such file or directory: 'build/pkgs/singular/checksums.ini'
http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2 -- 26 seconds
Apply -- 7751 seconds
http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2 -- 26 seconds
2016-10-04 21:51:04
7777 seconds
[2016-10-04 21:51:06] Reporting #17254 with status Spkg
fatal: Unable to read current working directory: Datei oder Verzeichnis nicht gefunden
Traceback (most recent call last):
  File "/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1328, in report_ticket
    tags = [describe_branch('patchbot/base', tag_only=True),
  File "/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/util.py", line 235, in describe_branch
    universal_newlines=True)
  File "/usr/lib/python2.7/subprocess.py", line 544, in check_output
    raise CalledProcessError(retcode, cmd, output=output)
CalledProcessError: Command '['git', 'describe', '--tags', '--match', '[0-9].[0-9]*', 'patchbot/base']' returned non-zero exit status 128
[2016-10-04 21:51:06] #17254: Spkg
REPORT
{'base': '7.4.beta6',
 'deps': [17635],
 'machine': ['Ubuntu',
             '12.04',
             'x86_64',
             '3.2.0-70-generic',
             'x200t-ThinkPad-X200-Tablet'],
 'owner': 'unknown owner',
 'patchbot_version': '2.6.3',
 'plugins': [],
 'spkgs': [u'http://www.lmona.de/files/sage/singular-4.0.3p3.tar.bz2'],
 'status': 'Spkg',
 'time': '2016-10-04 21:51:06',
 'user': 'jakobkroeker'}
17254: Spkg
ok (report successfully posted)
[2016-10-04 21:51:15] Done reporting #17254
Traceback (most recent call last):
  File "/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1509, in main
    patchbot.test_a_ticket(ticket)
  File "/home/jakobkroeker/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1185, in test_a_ticket
    shutil.rmtree(maybe_temp_root)
  File "/usr/lib/python2.7/shutil.py", line 237, in rmtree
    onerror(os.listdir, path, sys.exc_info())
  File "/usr/lib/python2.7/shutil.py", line 235, in rmtree
    names = os.listdir(path)
OSError: [Errno 2] No such file or directory: '/tmp/tmp8iZiiy-sage-git-temp-17254'


```



---

archive/issue_comments_240752.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-21T07:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240752",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049921.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-21T07:04:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17254#event-49921"
}
```



---

archive/issue_comments_240753.json:
```json
{
    "body": "<a id='comment:5'></a>Finally! Where is the party?",
    "created_at": "2016-10-21T08:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240753",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Finally! Where is the party?



---

archive/issue_comments_240754.json:
```json
{
    "body": "<a id='comment:546'></a>Replying to [comment:545 jdemeyer]:\n> Finally! Where is the party?\n\n\nI could invite you to my place but I gather it is a bit far for everyone else :) I'll be experimenting with 4.0.3p4 and ntl-10 once I have absorbed 7.5.beta0.",
    "created_at": "2016-10-21T08:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240754",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:546'></a>Replying to [comment:545 jdemeyer]:
> Finally! Where is the party?


I could invite you to my place but I gather it is a bit far for everyone else :) I'll be experimenting with 4.0.3p4 and ntl-10 once I have absorbed 7.5.beta0.



---

archive/issue_comments_240755.json:
```json
{
    "body": "<a id='comment:7'></a>It would be nice if the debug mode (#21624) could be fixed as that is tested on the buildbot...",
    "created_at": "2016-10-21T09:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17254#issuecomment-240755",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>It would be nice if the debug mode (#21624) could be fixed as that is tested on the buildbot...
