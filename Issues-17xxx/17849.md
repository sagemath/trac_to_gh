# Issue 17849: substitute_function should not evaluate expression

archive/issues_017612.json:
```json
{
    "body": "One expects `substitute_function` to not do anything except exchanging parts of expressions but\n\n```\nsage: ex = sin(x) + atan2(0,0,hold=True) \nsage: ex.substitute_function(sin,cos)\n...\nRuntimeError: arctan2_eval(): arctan2(0,0) encountered\nsage: ex = sin(x) + hypergeometric([1, 1], [2], -1)\nsage: ex\nhypergeometric((1, 1), (2,), -1) + sin(x)\nsage: ex.substitute_function(sin,cos)              \nAttributeError: 'SubstituteFunction' object has no attribute 'tuple'\n```\n\nBranch/Commit: c8ebd3056e2800dc9c760d94fd2d6b088ee541ab\n\nReviewer: Marc Mezzarobba\n\nAuthor: Ralf Stephan\n\nDependencies: #17759\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17849\n\n",
    "closed_at": "2015-05-25T22:49:43Z",
    "created_at": "2015-02-24T14:46:55Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "substitute_function should not evaluate expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17849",
    "user": "https://github.com/rwst"
}
```
One expects `substitute_function` to not do anything except exchanging parts of expressions but

```
sage: ex = sin(x) + atan2(0,0,hold=True) 
sage: ex.substitute_function(sin,cos)
...
RuntimeError: arctan2_eval(): arctan2(0,0) encountered
sage: ex = sin(x) + hypergeometric([1, 1], [2], -1)
sage: ex
hypergeometric((1, 1), (2,), -1) + sin(x)
sage: ex.substitute_function(sin,cos)              
AttributeError: 'SubstituteFunction' object has no attribute 'tuple'
```

Branch/Commit: c8ebd3056e2800dc9c760d94fd2d6b088ee541ab

Reviewer: Marc Mezzarobba

Author: Ralf Stephan

Dependencies: #17759

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17849





---

archive/issue_comments_310124.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#17759\"",
    "created_at": "2015-02-26T14:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310124",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "#17759"



---

archive/issue_comments_310125.json:
```json
{
    "body": "<a id='comment:2'></a>\nCalling `operator(*map(self, ex.operands()), hold=True)` as a quick fix in `SubstituteFunction.composition` presupposes that all operators accept the keyword.",
    "created_at": "2015-02-27T09:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310125",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
Calling `operator(*map(self, ex.operands()), hold=True)` as a quick fix in `SubstituteFunction.composition` presupposes that all operators accept the keyword.



---

archive/issue_comments_310126.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/substitute_function_should_not_evaluate_expression\"",
    "created_at": "2015-03-04T16:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310126",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/substitute_function_should_not_evaluate_expression"



---

archive/issue_comments_310127.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2015-03-04T16:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310127",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_310128.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|\n|[3781eec](https://github.com/sagemath/sagetrac-mirror/commit/3781eec1432c7efe6531be4338fef51cc04eda6d)|`17759: convenience class symbolic ExpressionTreeWalker(Converter)`|\n|[9375510](https://github.com/sagemath/sagetrac-mirror/commit/93755106787a8a6b7626a9c01a7d0aba51c40447)|`Merge branch 'develop' into t/17759/public/17759`|\n|[16aa81d](https://github.com/sagemath/sagetrac-mirror/commit/16aa81d5f5fe7b38db0ce7372e198b6f036ee724)|`17759: handle hold=True and hypergeometric`|\n|[d8767cd](https://github.com/sagemath/sagetrac-mirror/commit/d8767cd4f32d1e1110ca0a1a4e4cffe0e2eada31)|`Merge branch 'public/17759' of trac.sagemath.org:sage into t/17849/substitute_function_should_not_evaluate_expression`|\n|[82332bb](https://github.com/sagemath/sagetrac-mirror/commit/82332bb5eb54696d076b78bf62f21257a872ffad)|`17849: adapt SubstituteFunction; add doctest`|",
    "created_at": "2015-03-04T16:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310128",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
|[3781eec](https://github.com/sagemath/sagetrac-mirror/commit/3781eec1432c7efe6531be4338fef51cc04eda6d)|`17759: convenience class symbolic ExpressionTreeWalker(Converter)`|
|[9375510](https://github.com/sagemath/sagetrac-mirror/commit/93755106787a8a6b7626a9c01a7d0aba51c40447)|`Merge branch 'develop' into t/17759/public/17759`|
|[16aa81d](https://github.com/sagemath/sagetrac-mirror/commit/16aa81d5f5fe7b38db0ce7372e198b6f036ee724)|`17759: handle hold=True and hypergeometric`|
|[d8767cd](https://github.com/sagemath/sagetrac-mirror/commit/d8767cd4f32d1e1110ca0a1a4e4cffe0e2eada31)|`Merge branch 'public/17759' of trac.sagemath.org:sage into t/17849/substitute_function_should_not_evaluate_expression`|
|[82332bb](https://github.com/sagemath/sagetrac-mirror/commit/82332bb5eb54696d076b78bf62f21257a872ffad)|`17849: adapt SubstituteFunction; add doctest`|



---

archive/issue_comments_310129.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-04T16:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310129",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_310130.json:
```json
{
    "body": "Changing commit from \"\" to \"82332bb5eb54696d076b78bf62f21257a872ffad\"",
    "created_at": "2015-03-04T16:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310130",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "82332bb5eb54696d076b78bf62f21257a872ffad"



---

archive/issue_comments_310131.json:
```json
{
    "body": "Changing branch from \"u/rws/substitute_function_should_not_evaluate_expression\" to \"u/rws/17849\"",
    "created_at": "2015-05-25T07:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310131",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/substitute_function_should_not_evaluate_expression" to "u/rws/17849"



---

archive/issue_comments_310132.json:
```json
{
    "body": "Changing branch from \"u/rws/17849\" to \"u/rws/substitute_function_should_not_evaluate_expression\"",
    "created_at": "2015-05-25T07:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310132",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/17849" to "u/rws/substitute_function_should_not_evaluate_expression"



---

archive/issue_events_057883.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-05-25T07:02:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17849#event-57883"
}
```



---

archive/issue_comments_310133.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits:\n|                                                                                                                                          |                                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|\n|[fa73285](https://github.com/sagemath/sagetrac-mirror/commit/fa73285534e56d5ccd19ffc943237757ea06bcf1)|`17759: convenience class symbolic ExpressionTreeWalker(Converter)`|\n|[c8ebd30](https://github.com/sagemath/sagetrac-mirror/commit/c8ebd3056e2800dc9c760d94fd2d6b088ee541ab)|`Merge branch 'u/rws/substitute_function_should_not_evaluate_expression' of trac.sagemath.org:sage into tmp3`|",
    "created_at": "2015-05-25T07:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310133",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
New commits:
|                                                                                                                                          |                                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
|[fa73285](https://github.com/sagemath/sagetrac-mirror/commit/fa73285534e56d5ccd19ffc943237757ea06bcf1)|`17759: convenience class symbolic ExpressionTreeWalker(Converter)`|
|[c8ebd30](https://github.com/sagemath/sagetrac-mirror/commit/c8ebd3056e2800dc9c760d94fd2d6b088ee541ab)|`Merge branch 'u/rws/substitute_function_should_not_evaluate_expression' of trac.sagemath.org:sage into tmp3`|



---

archive/issue_comments_310134.json:
```json
{
    "body": "Changing branch from \"u/rws/substitute_function_should_not_evaluate_expression\" to \"u/rws/17849\"",
    "created_at": "2015-05-25T07:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310134",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/substitute_function_should_not_evaluate_expression" to "u/rws/17849"



---

archive/issue_comments_310135.json:
```json
{
    "body": "Changing commit from \"82332bb5eb54696d076b78bf62f21257a872ffad\" to \"c8ebd3056e2800dc9c760d94fd2d6b088ee541ab\"",
    "created_at": "2015-05-25T07:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310135",
    "user": "https://github.com/rwst"
}
```

Changing commit from "82332bb5eb54696d076b78bf62f21257a872ffad" to "c8ebd3056e2800dc9c760d94fd2d6b088ee541ab"



---

archive/issue_comments_310136.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-25T10:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310136",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310137.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Marc Mezzarobba\"",
    "created_at": "2015-05-25T10:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310137",
    "user": "https://github.com/mezzarobba"
}
```

Changing reviewer from "" to "Marc Mezzarobba"



---

archive/issue_comments_310138.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks.",
    "created_at": "2015-05-25T12:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310138",
    "user": "https://github.com/rwst"
}
```

<a id='comment:9'></a>
Thanks.



---

archive/issue_comments_310139.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-25T22:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310139",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057884.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-25T22:49:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17849#event-57884"
}
```



---

archive/issue_comments_310140.json:
```json
{
    "body": "Changing branch from \"u/rws/17849\" to \"c8ebd3056e2800dc9c760d94fd2d6b088ee541ab\"",
    "created_at": "2015-05-25T22:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17849#issuecomment-310140",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rws/17849" to "c8ebd3056e2800dc9c760d94fd2d6b088ee541ab"
