# Issue 17996: Missing Source in numerical_approx??

archive/issues_017759.json:
```json
{
    "body": "\n```\nsage: GaussianIntegers = NumberField(x^2+1, 'I').ring_of_integers()\nsage: A = GaussianIntegers([2,1])\nsage: A.n??\nType:           builtin_function_or_method\nString form:    <built-in method numerical_approx of sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic object at 0x7f28be1b5410>\nDocstring:\n   Return a numerical approximation of x with at least prec bits of\n   precision.\n\n   EXAMPLES:\n\n      sage: (2/3).n()\n      0.666666666666667\n      sage: pi.n(digits=10)  # indirect doctest\n      3.141592654\n      sage: pi.n(prec=20)   # indirect doctest\n      3.1416\n\n   TESTS:\n\n   Check that http://trac.sagemath.org/14778 is fixed:\n\n      sage: (0).n(algorithm='foo')\n      0.000000000000000\n\nInit docstring: x.__init__(...) initializes x; see help(type(x)) for signature\n```\nNote that the actual code is missing, it only shows the docstring. But `sage_getsource` does include the method body::\n\n```\nsage: print sage.misc.sageinspect.sage_getsource(A.n)\n    def numerical_approx(self, prec=None, digits=None, algorithm=None):\n        \"\"\"\n        Return a numerical approximation of x with at least prec bits of\n        precision.\n\n        EXAMPLES::\n\n            sage: (2/3).n()\n            0.666666666666667\n            sage: pi.n(digits=10)  # indirect doctest\n            3.141592654\n            sage: pi.n(prec=20)   # indirect doctest\n            3.1416\n\n        TESTS:\n\n        Check that :trac:`14778` is fixed::\n\n            sage: (0).n(algorithm='foo')\n            0.000000000000000\n        \"\"\"\n        from sage.misc.functional import numerical_approx\n        return numerical_approx(self, prec=prec, digits=digits,\n                                algorithm=algorithm)\n```\n\n\nCC:  simonking @JohnCremona @kiwifb\n\nBranch/Commit: adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17996\n\n",
    "closed_at": "2015-03-31T23:58:07Z",
    "created_at": "2015-03-18T22:41:10Z",
    "labels": [
        "component: documentation",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Missing Source in numerical_approx??",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17996",
    "user": "https://github.com/vbraun"
}
```

```
sage: GaussianIntegers = NumberField(x^2+1, 'I').ring_of_integers()
sage: A = GaussianIntegers([2,1])
sage: A.n??
Type:           builtin_function_or_method
String form:    <built-in method numerical_approx of sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic object at 0x7f28be1b5410>
Docstring:
   Return a numerical approximation of x with at least prec bits of
   precision.

   EXAMPLES:

      sage: (2/3).n()
      0.666666666666667
      sage: pi.n(digits=10)  # indirect doctest
      3.141592654
      sage: pi.n(prec=20)   # indirect doctest
      3.1416

   TESTS:

   Check that http://trac.sagemath.org/14778 is fixed:

      sage: (0).n(algorithm='foo')
      0.000000000000000

Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
```
Note that the actual code is missing, it only shows the docstring. But `sage_getsource` does include the method body::

```
sage: print sage.misc.sageinspect.sage_getsource(A.n)
    def numerical_approx(self, prec=None, digits=None, algorithm=None):
        """
        Return a numerical approximation of x with at least prec bits of
        precision.

        EXAMPLES::

            sage: (2/3).n()
            0.666666666666667
            sage: pi.n(digits=10)  # indirect doctest
            3.141592654
            sage: pi.n(prec=20)   # indirect doctest
            3.1416

        TESTS:

        Check that :trac:`14778` is fixed::

            sage: (0).n(algorithm='foo')
            0.000000000000000
        """
        from sage.misc.functional import numerical_approx
        return numerical_approx(self, prec=prec, digits=digits,
                                algorithm=algorithm)
```


CC:  simonking @JohnCremona @kiwifb

Branch/Commit: adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca

Upstream: Fixed upstream, but not in a stable release.

Reviewer: François Bissey

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17996





---

archive/issue_comments_305705.json:
```json
{
    "body": "<a id='comment:1'></a>\nI tried the example with sage-6.5.beta4, and it works fine:\n\n```\nsage: GaussianIntegers = NumberField(x^2+1, 'I').ring_of_integers()\nsage: A = GaussianIntegers([2,1])\nsage: A.n??\nType:           builtin_function_or_method\nString form:    <built-in method numerical_approx of sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic object at 0x7f2c4fbb6650>\nDefinition:     A.n(self, prec=None, digits=None, algorithm=None)\nSource:\n    def numerical_approx(self, prec=None, digits=None, algorithm=None):\n        \"\"\"\n        Return a numerical approximation of x with at least prec bits of\n        precision.\n\n        EXAMPLES::\n\n            sage: (2/3).n()\n            0.666666666666667\n            sage: pi.n(digits=10)\n            3.141592654\n            sage: pi.n(prec=20)   # 20 bits\n            3.1416\n\n        TESTS:\n\n        Check that :trac:`14778` is fixed::\n\n            sage: (0).n(algorithm='foo')\n            0.000000000000000\n        \"\"\"\n        import sage.misc.functional\n        return sage.misc.functional.numerical_approx(self, prec=prec,\n                                                     digits=digits,                                                                                                              \n                                                     algorithm=algorithm)                                                                                                        \n\nInit docstring: x.__init__(...) initializes x; see help(type(x)) for signature\n```\nSo, we should have a look at changes in sageinspect that have occurred since 6.5.beta4.",
    "created_at": "2015-03-19T08:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305705",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>
I tried the example with sage-6.5.beta4, and it works fine:

```
sage: GaussianIntegers = NumberField(x^2+1, 'I').ring_of_integers()
sage: A = GaussianIntegers([2,1])
sage: A.n??
Type:           builtin_function_or_method
String form:    <built-in method numerical_approx of sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic object at 0x7f2c4fbb6650>
Definition:     A.n(self, prec=None, digits=None, algorithm=None)
Source:
    def numerical_approx(self, prec=None, digits=None, algorithm=None):
        """
        Return a numerical approximation of x with at least prec bits of
        precision.

        EXAMPLES::

            sage: (2/3).n()
            0.666666666666667
            sage: pi.n(digits=10)
            3.141592654
            sage: pi.n(prec=20)   # 20 bits
            3.1416

        TESTS:

        Check that :trac:`14778` is fixed::

            sage: (0).n(algorithm='foo')
            0.000000000000000
        """
        import sage.misc.functional
        return sage.misc.functional.numerical_approx(self, prec=prec,
                                                     digits=digits,                                                                                                              
                                                     algorithm=algorithm)                                                                                                        

Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
```
So, we should have a look at changes in sageinspect that have occurred since 6.5.beta4.



---

archive/issue_comments_305706.json:
```json
{
    "body": "<a id='comment:2'></a>\nMy bet would be something IPython-related.",
    "created_at": "2015-03-19T09:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305706",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
My bet would be something IPython-related.



---

archive/issue_comments_305707.json:
```json
{
    "body": "<a id='comment:3'></a>\nWe updated to IPython 3.0 in beta4, and there was nothing that should have impacted the commandline after that.",
    "created_at": "2015-03-19T09:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305707",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
We updated to IPython 3.0 in beta4, and there was nothing that should have impacted the commandline after that.



---

archive/issue_comments_305708.json:
```json
{
    "body": "<a id='comment:4'></a>\nPS: The only change in sageinspect.py was #17900: Setup interrupts in Cython, though that doesn't sound like it should have changed anything either.",
    "created_at": "2015-03-19T09:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305708",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
PS: The only change in sageinspect.py was #17900: Setup interrupts in Cython, though that doesn't sound like it should have changed anything either.



---

archive/issue_comments_305709.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/missing_source_in_numerical_approx\"",
    "created_at": "2015-03-25T00:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305709",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/missing_source_in_numerical_approx"



---

archive/issue_comments_305710.json:
```json
{
    "body": "Changing commit from \"\" to \"ecdb27ca2312fb2a3fa28c61c5f381ac6d4a3ac4\"",
    "created_at": "2015-03-25T00:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305710",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "ecdb27ca2312fb2a3fa28c61c5f381ac6d4a3ac4"



---

archive/issue_comments_305711.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-25T00:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305711",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305712.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt was due to the IPython 3 update, they introduced a new function to find the source file that was not aware of Sage's Cython files.\n\n---\nNew commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[0545625](https://github.com/sagemath/sagetrac-mirror/commit/0545625e101befb26d3713e075c1b9317cea853f)|`Update my_getsource for the changed IPython3 argspec`|\n|[6efba39](https://github.com/sagemath/sagetrac-mirror/commit/6efba398bdee4c033edd1926f18d5b73221117ef)|`Allow IPython to find Sage-specific source files`|\n|[ecdb27c](https://github.com/sagemath/sagetrac-mirror/commit/ecdb27ca2312fb2a3fa28c61c5f381ac6d4a3ac4)|`add testcases for pinfo and pinfo2`|",
    "created_at": "2015-03-25T00:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305712",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
It was due to the IPython 3 update, they introduced a new function to find the source file that was not aware of Sage's Cython files.

---
New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[0545625](https://github.com/sagemath/sagetrac-mirror/commit/0545625e101befb26d3713e075c1b9317cea853f)|`Update my_getsource for the changed IPython3 argspec`|
|[6efba39](https://github.com/sagemath/sagetrac-mirror/commit/6efba398bdee4c033edd1926f18d5b73221117ef)|`Allow IPython to find Sage-specific source files`|
|[ecdb27c](https://github.com/sagemath/sagetrac-mirror/commit/ecdb27ca2312fb2a3fa28c61c5f381ac6d4a3ac4)|`add testcases for pinfo and pinfo2`|



---

archive/issue_comments_305713.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2015-03-25T00:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305713",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_305714.json:
```json
{
    "body": "<a id='comment:8'></a>\nNow would be a good time to review this...",
    "created_at": "2015-03-29T21:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305714",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Now would be a good time to review this...



---

archive/issue_comments_305715.json:
```json
{
    "body": "<a id='comment:9'></a>\nLooks good. A cursory look with `grep` seem to indicate that you found everything that needed adjusting. The bot will find anything we missed.",
    "created_at": "2015-03-29T22:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305715",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Looks good. A cursory look with `grep` seem to indicate that you found everything that needed adjusting. The bot will find anything we missed.



---

archive/issue_comments_305716.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-29T22:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305716",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305717.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2015-03-30T08:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305717",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_305718.json:
```json
{
    "body": "<a id='comment:11'></a>\nFails on UW mod:\n\n```\nsage -t --long src/sage/repl/ipython_tests.py\n**********************************************************************\nFile \"src/sage/repl/ipython_tests.py\", line 10, in sage.repl.ipython_tests\nFailed example:\n    shell.run_cell(u'%pinfo dummy')\n[...]\n    /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/IPython/core/page.pyc in _detect_screen_size(screen_lines_def)\n        101     # unconditionally reset it every time.  It's cheaper than making\n        102     # the checks.\n    --> 103     term_flags = termios.tcgetattr(sys.stdout)\n        104 \n        105     # Curses modifies the stdout buffer size by default, which messes\n    <BLANKLINE>\n    error: (25, 'Inappropriate ioctl for device')\n```",
    "created_at": "2015-03-30T20:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305718",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Fails on UW mod:

```
sage -t --long src/sage/repl/ipython_tests.py
**********************************************************************
File "src/sage/repl/ipython_tests.py", line 10, in sage.repl.ipython_tests
Failed example:
    shell.run_cell(u'%pinfo dummy')
[...]
    /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/IPython/core/page.pyc in _detect_screen_size(screen_lines_def)
        101     # unconditionally reset it every time.  It's cheaper than making
        102     # the checks.
    --> 103     term_flags = termios.tcgetattr(sys.stdout)
        104 
        105     # Curses modifies the stdout buffer size by default, which messes
    <BLANKLINE>
    error: (25, 'Inappropriate ioctl for device')
```



---

archive/issue_comments_305719.json:
```json
{
    "body": "<a id='comment:12'></a>\nNow that's a curious message. Is it the only machine it fails on?",
    "created_at": "2015-03-30T20:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305719",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Now that's a curious message. Is it the only machine it fails on?



---

archive/issue_comments_305720.json:
```json
{
    "body": "<a id='comment:13'></a>\nYes, only fails on mod (Linux 2.6.24 :-)\n\nhttps://github.com/ipython/ipython/pull/8208",
    "created_at": "2015-03-31T10:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305720",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
Yes, only fails on mod (Linux 2.6.24 :-)

https://github.com/ipython/ipython/pull/8208



---

archive/issue_comments_305721.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2015-03-31T10:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305721",
    "user": "https://github.com/vbraun"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_305722.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-03-31T10:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_305723.json:
```json
{
    "body": "Changing commit from \"ecdb27ca2312fb2a3fa28c61c5f381ac6d4a3ac4\" to \"adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca\"",
    "created_at": "2015-03-31T10:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ecdb27ca2312fb2a3fa28c61c5f381ac6d4a3ac4" to "adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca"



---

archive/issue_comments_305724.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[adaa25e](https://github.com/sagemath/sagetrac-mirror/commit/adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca)|`Catch the termios error`|",
    "created_at": "2015-03-31T10:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[adaa25e](https://github.com/sagemath/sagetrac-mirror/commit/adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca)|`Catch the termios error`|



---

archive/issue_comments_305725.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2015-03-31T23:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305725",
    "user": "https://github.com/vbraun"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_305726.json:
```json
{
    "body": "<a id='comment:15'></a>\nHas been merged upstream.",
    "created_at": "2015-03-31T23:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305726",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Has been merged upstream.



---

archive/issue_events_065925.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-31T23:58:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17996#event-65925"
}
```



---

archive/issue_comments_305727.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-31T23:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305727",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_305728.json:
```json
{
    "body": "Changing branch from \"u/vbraun/missing_source_in_numerical_approx\" to \"adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca\"",
    "created_at": "2015-03-31T23:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17996#issuecomment-305728",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/missing_source_in_numerical_approx" to "adaa25e029bd602dd4b0d6f39c54a49fd0ca72ca"
