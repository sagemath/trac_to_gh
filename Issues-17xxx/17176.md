# Issue 17176: Gdb on Yosemite

archive/issues_016939.json:
```json
{
    "assignees": [],
    "body": "Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973\n\nUpstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046\n\nCC:  @ohanar\n\nKeywords: **yosemite**\n\nBranch/Commit: **[`c2ff01b`](https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Volker Braun**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17176_\n\n",
    "closed_at": "2015-01-29T13:26:25Z",
    "created_at": "2014-10-18T19:21:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Gdb on Yosemite",
    "type": "issue",
    "updated_at": "2015-01-29T13:26:25Z",
    "url": "https://github.com/sagemath/sage/issues/17176",
    "user": "https://github.com/vbraun"
}
```
Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973

Upstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046

CC:  @ohanar

Keywords: **yosemite**

Branch/Commit: **[`c2ff01b`](https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0)**

Reviewer: **John Palmieri**

Author: **Volker Braun**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/17176_





---

archive/issue_events_245244.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-18T19:21:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245244"
}
```



---

archive/issue_events_245245.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-18T19:21:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245245"
}
```



---

archive/issue_comments_228104.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973\n``````\n",
    "created_at": "2014-10-18T19:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228104",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973
``````




---

archive/issue_events_245246.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-18T19:28:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245246"
}
```



---

archive/issue_comments_228105.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2014-10-18T19:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228105",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_events_245247.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-18T19:28:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245247"
}
```



---

archive/issue_comments_228106.json:
```json
{
    "body": "Changed keywords from none to **yosemite**",
    "created_at": "2014-10-18T19:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228106",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from none to **yosemite**



---

archive/issue_comments_228107.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973\n+Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973\n``````\n",
    "created_at": "2014-10-18T19:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228107",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973
+Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973
``````




---

archive/issue_comments_228108.json:
```json
{
    "body": "Branch: **[u/vbraun/gdb_on_yosemite](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/gdb_on_yosemite)**",
    "created_at": "2014-10-18T19:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228108",
    "user": "https://github.com/vbraun"
}
```

Branch: **[u/vbraun/gdb_on_yosemite](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/gdb_on_yosemite)**



---

archive/issue_comments_228109.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAaand codesign doesn't work, can only run gdb as root.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0\">c2ff01b</a></td><td><code>Adjust header location for setjmp</code></td></tr></table>\n",
    "created_at": "2014-10-18T20:20:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228109",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>

Aaand codesign doesn't work, can only run gdb as root.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0">c2ff01b</a></td><td><code>Adjust header location for setjmp</code></td></tr></table>




---

archive/issue_comments_228110.json:
```json
{
    "body": "Commit: **[`c2ff01b`](https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0)**",
    "created_at": "2014-10-18T20:20:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228110",
    "user": "https://github.com/vbraun"
}
```

Commit: **[`c2ff01b`](https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0)**



---

archive/issue_events_245248.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-19T11:14:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245248"
}
```



---

archive/issue_comments_228111.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973\n+\n+Upstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046\n``````\n",
    "created_at": "2014-10-19T11:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228111",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973
+
+Upstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046
``````




---

archive/issue_comments_228112.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nTried the following to be able to use gdb:\n\n* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/\n* Sign: `codesign -fs gdbc ./gdb/gdb`\n* Put the `gdb` binary in the `procmod` group and make it chgrp\n\n  ```\n  $ ls -al gdb\n  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb\n  ```\n* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:\n\n  ```\n  dscl . append /Groups/procmod GroupMembership vbraun\n  ```\n* Rebooted\n\nStill can't run without root:\n\n```\n$ ./gdb ~/Sage/local/bin/patch \n....\nStarting program: /Users/vbraun/Sage/local/bin/patch \nUnable to find Mach task port for process-id 476: (os/kern) failure (0x5).\n (please check gdb is codesigned - see taskgated(8))\n```\nMore info:\n\n```\n$ codesign -d --verbose gdb\nExecutable=/Users/vbraun/Code/gdb-7.8/gdb/gdb\nIdentifier=org.gnu.gdb\nFormat=Mach-O thin (x86_64)\nCodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded\nSignature size=1237\nSigned Time=Oct 19, 2014, 12:31:26 PM\nInfo.plist entries=4\nTeamIdentifier=not set\nSealed Resources=none\nInternal requirements count=2 size=448\n```",
    "created_at": "2014-10-19T11:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228112",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Tried the following to be able to use gdb:

* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/
* Sign: `codesign -fs gdbc ./gdb/gdb`
* Put the `gdb` binary in the `procmod` group and make it chgrp

  ```
  $ ls -al gdb
  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb
  ```
* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:

  ```
  dscl . append /Groups/procmod GroupMembership vbraun
  ```
* Rebooted

Still can't run without root:

```
$ ./gdb ~/Sage/local/bin/patch 
....
Starting program: /Users/vbraun/Sage/local/bin/patch 
Unable to find Mach task port for process-id 476: (os/kern) failure (0x5).
 (please check gdb is codesigned - see taskgated(8))
```
More info:

```
$ codesign -d --verbose gdb
Executable=/Users/vbraun/Code/gdb-7.8/gdb/gdb
Identifier=org.gnu.gdb
Format=Mach-O thin (x86_64)
CodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded
Signature size=1237
Signed Time=Oct 19, 2014, 12:31:26 PM
Info.plist entries=4
TeamIdentifier=not set
Sealed Resources=none
Internal requirements count=2 size=448
```



---

archive/issue_comments_228113.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOf course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.",
    "created_at": "2014-10-19T11:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228113",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Of course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.



---

archive/issue_comments_228114.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:\n\n```\n#ifndef\t_MACHINE_SETJMP_H_\n#define\t_MACHINE_SETJMP_H_\n\n#include <setjmp.h>\n\n#endif\t/* _MACHINE_SETJMP_H_ */\n```\nIs it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.",
    "created_at": "2014-10-27T17:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228114",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

This seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:

```
#ifndef	_MACHINE_SETJMP_H_
#define	_MACHINE_SETJMP_H_

#include <setjmp.h>

#endif	/* _MACHINE_SETJMP_H_ */
```
Is it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.



---

archive/issue_comments_228115.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nInteresting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:\n\n```\n$ ls /usr/include/machine/setjmp.h \nls: /usr/include/machine/setjmp.h: No such file or directory\n```",
    "created_at": "2014-10-27T18:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228115",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

Interesting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:

```
$ ls /usr/include/machine/setjmp.h 
ls: /usr/include/machine/setjmp.h: No such file or directory
```



---

archive/issue_comments_228116.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOh you said 10.9. Thats probably what it was, then.\n\nIn any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.",
    "created_at": "2014-10-27T18:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228116",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

Oh you said 10.9. Thats probably what it was, then.

In any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.



---

archive/issue_comments_228117.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAnybody care to review this? Without gdb its hard to debug stuff on OSX",
    "created_at": "2015-01-24T19:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228117",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

Anybody care to review this? Without gdb its hard to debug stuff on OSX



---

archive/issue_comments_228118.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIt worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.\n\nIs this good enough for a positive review, given that it's an optional package?",
    "created_at": "2015-01-25T06:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228118",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

It worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.

Is this good enough for a positive review, given that it's an optional package?



---

archive/issue_comments_228119.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIMHO thats enough",
    "created_at": "2015-01-25T12:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228119",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

IMHO thats enough



---

archive/issue_comments_228120.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2015-01-25T12:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228120",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_245249.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-25T12:52:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245249"
}
```



---

archive/issue_events_245250.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-25T12:52:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245250"
}
```



---

archive/issue_events_245251.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-29T13:26:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245251"
}
```



---

archive/issue_events_245252.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6c11bc11c7e685835ac29931d307d94fc9271692",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-01-29T13:26:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17176#event-245252"
}
```



---

archive/issue_comments_228121.json:
```json
{
    "body": "Changed branch from **[u/vbraun/gdb_on_yosemite](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/gdb_on_yosemite)** to **[`c2ff01b`](https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0)**",
    "created_at": "2015-01-29T13:26:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17176#issuecomment-228121",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vbraun/gdb_on_yosemite](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/gdb_on_yosemite)** to **[`c2ff01b`](https://github.com/sagemath/sagetrac-mirror/commit/c2ff01b24aa9bc150498acbb370af5fdcae347d0)**
