# Issue 17176: Gdb on Yosemite

archive/issues_016939.json:
```json
{
    "body": "Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973\n\nUpstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046\n\nCC:  @ohanar\n\nKeywords: yosemite\n\nBranch/Commit: c2ff01b24aa9bc150498acbb370af5fdcae347d0\n\nReviewer: John Palmieri\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17176\n\n",
    "closed_at": "2015-01-29T13:26:25Z",
    "created_at": "2014-10-18T19:21:49Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Gdb on Yosemite",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17176",
    "user": "https://github.com/vbraun"
}
```
Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973

Upstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046

CC:  @ohanar

Keywords: yosemite

Branch/Commit: c2ff01b24aa9bc150498acbb370af5fdcae347d0

Reviewer: John Palmieri

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17176





---

archive/issue_comments_289716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973\n``````\n",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289716",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973
``````




---

archive/issue_comments_289717.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: optional.",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289717",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to packages: optional.



---

archive/issue_comments_289718.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289718",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_289719.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289719",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_289720.json:
```json
{
    "body": "Changing keywords from \"\" to \"yosemite\".",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289720",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "" to "yosemite".



---

archive/issue_comments_289721.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973\n+Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973\n``````\n",
    "created_at": "2014-10-18T19:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289721",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Apple renamed the location of `setjmp.h`, see https://trac.macports.org/ticket/43973
+Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973
``````




---

archive/issue_comments_289722.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/gdb_on_yosemite\"",
    "created_at": "2014-10-18T19:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289722",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/gdb_on_yosemite"



---

archive/issue_comments_289723.json:
```json
{
    "body": "<a id='comment:4'></a>\nAaand codesign doesn't work, can only run gdb as root.\n\n---\nNew commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[c2ff01b](http://git.sagemath.org/sage.git/commit/?id=c2ff01b24aa9bc150498acbb370af5fdcae347d0)|`Adjust header location for setjmp`|",
    "created_at": "2014-10-18T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289723",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Aaand codesign doesn't work, can only run gdb as root.

---
New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[c2ff01b](http://git.sagemath.org/sage.git/commit/?id=c2ff01b24aa9bc150498acbb370af5fdcae347d0)|`Adjust header location for setjmp`|



---

archive/issue_comments_289724.json:
```json
{
    "body": "Changing commit from \"\" to \"c2ff01b24aa9bc150498acbb370af5fdcae347d0\"",
    "created_at": "2014-10-18T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289724",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "c2ff01b24aa9bc150498acbb370af5fdcae347d0"



---

archive/issue_comments_289725.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-19T11:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289725",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_289726.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973\n+\n+Upstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046\n``````\n",
    "created_at": "2014-10-19T11:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289726",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Apple moved `setjmp.h`, see https://trac.macports.org/ticket/43973
+
+Upstream bug: https://sourceware.org/bugzilla/show_bug.cgi?id=17046
``````




---

archive/issue_comments_289727.json:
```json
{
    "body": "<a id='comment:6'></a>\nTried the following to be able to use gdb:\n\n* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/\n* Sign: `codesign -fs gdbc ./gdb/gdb`\n* Put the `gdb` binary in the `procmod` group and make it chgrp\n  {{{\n  $ ls -al gdb\n  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb\n  }}}\n* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:\n  {{{\n  dscl . append /Groups/procmod GroupMembership vbraun\n  }}}\n* Rebooted\n\nStill can't run without root:\n\n```\n$ ./gdb ~/Sage/local/bin/patch \n....\nStarting program: /Users/vbraun/Sage/local/bin/patch \nUnable to find Mach task port for process-id 476: (os/kern) failure (0x5).\n (please check gdb is codesigned - see taskgated(8))\n```\nMore info:\n\n```\n$ codesign -d --verbose gdb\nExecutable=/Users/vbraun/Code/gdb-7.8/gdb/gdb\nIdentifier=org.gnu.gdb\nFormat=Mach-O thin (x86_64)\nCodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded\nSignature size=1237\nSigned Time=Oct 19, 2014, 12:31:26 PM\nInfo.plist entries=4\nTeamIdentifier=not set\nSealed Resources=none\nInternal requirements count=2 size=448\n```",
    "created_at": "2014-10-19T11:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289727",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Tried the following to be able to use gdb:

* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/
* Sign: `codesign -fs gdbc ./gdb/gdb`
* Put the `gdb` binary in the `procmod` group and make it chgrp
  {{{
  $ ls -al gdb
  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb
  }}}
* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:
  {{{
  dscl . append /Groups/procmod GroupMembership vbraun
  }}}
* Rebooted

Still can't run without root:

```
$ ./gdb ~/Sage/local/bin/patch 
....
Starting program: /Users/vbraun/Sage/local/bin/patch 
Unable to find Mach task port for process-id 476: (os/kern) failure (0x5).
 (please check gdb is codesigned - see taskgated(8))
```
More info:

```
$ codesign -d --verbose gdb
Executable=/Users/vbraun/Code/gdb-7.8/gdb/gdb
Identifier=org.gnu.gdb
Format=Mach-O thin (x86_64)
CodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded
Signature size=1237
Signed Time=Oct 19, 2014, 12:31:26 PM
Info.plist entries=4
TeamIdentifier=not set
Sealed Resources=none
Internal requirements count=2 size=448
```



---

archive/issue_comments_289728.json:
```json
{
    "body": "<a id='comment:7'></a>\nOf course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.",
    "created_at": "2014-10-19T11:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289728",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Of course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.



---

archive/issue_comments_289729.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:\n\n```\n#ifndef\t_MACHINE_SETJMP_H_\n#define\t_MACHINE_SETJMP_H_\n\n#include <setjmp.h>\n\n#endif\t/* _MACHINE_SETJMP_H_ */\n```\nIs it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.",
    "created_at": "2014-10-27T17:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289729",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
This seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:

```
#ifndef	_MACHINE_SETJMP_H_
#define	_MACHINE_SETJMP_H_

#include <setjmp.h>

#endif	/* _MACHINE_SETJMP_H_ */
```
Is it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.



---

archive/issue_comments_289730.json:
```json
{
    "body": "<a id='comment:9'></a>\nInteresting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:\n\n```\n$ ls /usr/include/machine/setjmp.h \nls: /usr/include/machine/setjmp.h: No such file or directory\n```",
    "created_at": "2014-10-27T18:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289730",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Interesting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:

```
$ ls /usr/include/machine/setjmp.h 
ls: /usr/include/machine/setjmp.h: No such file or directory
```



---

archive/issue_comments_289731.json:
```json
{
    "body": "<a id='comment:10'></a>\nOh you said 10.9. Thats probably what it was, then.\n\nIn any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.",
    "created_at": "2014-10-27T18:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289731",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
Oh you said 10.9. Thats probably what it was, then.

In any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.



---

archive/issue_comments_289732.json:
```json
{
    "body": "<a id='comment:11'></a>\nAnybody care to review this? Without gdb its hard to debug stuff on OSX",
    "created_at": "2015-01-24T19:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289732",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Anybody care to review this? Without gdb its hard to debug stuff on OSX



---

archive/issue_comments_289733.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.\n\nIs this good enough for a positive review, given that it's an optional package?",
    "created_at": "2015-01-25T06:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289733",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
It worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.

Is this good enough for a positive review, given that it's an optional package?



---

archive/issue_comments_289734.json:
```json
{
    "body": "<a id='comment:13'></a>\nIMHO thats enough",
    "created_at": "2015-01-25T12:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289734",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
IMHO thats enough



---

archive/issue_comments_289735.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2015-01-25T12:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289735",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_289736.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-25T12:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289736",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_049798.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-29T13:26:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17176#event-49798"
}
```



---

archive/issue_comments_289737.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-29T13:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289737",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_289738.json:
```json
{
    "body": "Changing branch from \"u/vbraun/gdb_on_yosemite\" to \"c2ff01b24aa9bc150498acbb370af5fdcae347d0\"",
    "created_at": "2015-01-29T13:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17176#issuecomment-289738",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/gdb_on_yosemite" to "c2ff01b24aa9bc150498acbb370af5fdcae347d0"
