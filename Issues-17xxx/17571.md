# Issue 17571: Method tracing fixture

archive/issues_017334.json:
```json
{
    "body": "This is a spin-off from #16571.\n\nI'd like to introduce a helper method for doctests which will trace a given method of an object, printing its interaction with its surroundings: method entry and exit, arguments and return value, as well as access to other members and methods of this object. For details see the docstring of the branch I'll attach.\n\nCC:  @nilesjohnson\n\nBranch/Commit: e3093ed9167903328b40ccfa5f0d41729d07021d\n\nReviewer: Niles Johnson\n\nAuthor: Martin von Gagern\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17571\n\n",
    "closed_at": "2015-01-12T18:11:31Z",
    "created_at": "2014-12-30T19:43:17Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Method tracing fixture",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17571",
    "user": "https://github.com/gagern"
}
```
This is a spin-off from #16571.

I'd like to introduce a helper method for doctests which will trace a given method of an object, printing its interaction with its surroundings: method entry and exit, arguments and return value, as well as access to other members and methods of this object. For details see the docstring of the branch I'll attach.

CC:  @nilesjohnson

Branch/Commit: e3093ed9167903328b40ccfa5f0d41729d07021d

Reviewer: Niles Johnson

Author: Martin von Gagern

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17571





---

archive/issue_comments_299263.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gagern/ticket/17571\"",
    "created_at": "2015-01-02T21:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299263",
    "user": "https://github.com/gagern"
}
```

Changing branch from "" to "u/gagern/ticket/17571"



---

archive/issue_comments_299264.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-02T21:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299264",
    "user": "https://github.com/gagern"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_299265.json:
```json
{
    "body": "Changing commit from \"\" to \"b89fb603fce4e71a535b5bbf4bc052a70b33999d\"",
    "created_at": "2015-01-02T21:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299265",
    "user": "https://github.com/gagern"
}
```

Changing commit from "" to "b89fb603fce4e71a535b5bbf4bc052a70b33999d"



---

archive/issue_comments_299266.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:26:ticket:16571 niles]:\n> * The function `traceMethod` should be `trace_method` to fit the standard naming convention.  Was there a strong reason for the name you gave it?  If not, please change.\n\n\nDone.\n\n> * `PropertyAccessTracerProxy.__init__` and `PropertyAccessTracerProxy.fmt` need docstrings\n\n\nMoved class docstring to init method, which is explicitely allowed by the dev manual you mentioned.\n\n> * An author block and a copyright block are necessary at the top of the file.  See [here](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files).\n\n\nDone that, thanks!\n\n> * While you're at it, why not expand the documentation?  This could be useful much more generally, and a very short description at the top of the document would help explain what it does.\n\n\nI wrote some text at the beginning of the file to indicate what kind of code I'd eventually expect to be contained in this module. I think that my tracing code might not remain the only fixture, therefore limiting the documentation to just that seems like a bad restriction. I did however extend the documentation of the relevant classes as well, so they might now be easier to use on their own.\n\n> * It doesn't make sense to leave `fixtures.py` out of the reference manual.  I think you add it by adding a line in `src/doc/en/reference/doctest/index.rst`, but I may be misremembering.\n\n\nWorked fine, thanks!\n\n> * There are two tests in `doctest/control.py` that need to be updated because of the new fixtures file. Otherwise all tests pass.\n\n\nOh! I hadn't thought to run doctests in what I considered unrelated files, thanks for doing that! Fixed now.\n\n---\nNew commits:",
    "created_at": "2015-01-02T21:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299266",
    "user": "https://github.com/gagern"
}
```

<a id='comment:2'></a>Replying to [comment:26:ticket:16571 niles]:
> * The function `traceMethod` should be `trace_method` to fit the standard naming convention.  Was there a strong reason for the name you gave it?  If not, please change.


Done.

> * `PropertyAccessTracerProxy.__init__` and `PropertyAccessTracerProxy.fmt` need docstrings


Moved class docstring to init method, which is explicitely allowed by the dev manual you mentioned.

> * An author block and a copyright block are necessary at the top of the file.  See [here](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files).


Done that, thanks!

> * While you're at it, why not expand the documentation?  This could be useful much more generally, and a very short description at the top of the document would help explain what it does.


I wrote some text at the beginning of the file to indicate what kind of code I'd eventually expect to be contained in this module. I think that my tracing code might not remain the only fixture, therefore limiting the documentation to just that seems like a bad restriction. I did however extend the documentation of the relevant classes as well, so they might now be easier to use on their own.

> * It doesn't make sense to leave `fixtures.py` out of the reference manual.  I think you add it by adding a line in `src/doc/en/reference/doctest/index.rst`, but I may be misremembering.


Worked fine, thanks!

> * There are two tests in `doctest/control.py` that need to be updated because of the new fixtures file. Otherwise all tests pass.


Oh! I hadn't thought to run doctests in what I considered unrelated files, thanks for doing that! Fixed now.

---
New commits:



---

archive/issue_comments_299267.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-02T21:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_299268.json:
```json
{
    "body": "Changing commit from \"b89fb603fce4e71a535b5bbf4bc052a70b33999d\" to \"cb1388758f0cf2872c6dbd9f548fd13a18aa4502\"",
    "created_at": "2015-01-02T21:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b89fb603fce4e71a535b5bbf4bc052a70b33999d" to "cb1388758f0cf2872c6dbd9f548fd13a18aa4502"



---

archive/issue_comments_299269.json:
```json
{
    "body": "<a id='comment:5'></a>I'm confused about the docstring for `reproducible_repr` saying \"All types which require special handling are covered by the examples below\".  Aren't dicts an obvious case that also would require special handling?",
    "created_at": "2015-01-05T17:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299269",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:5'></a>I'm confused about the docstring for `reproducible_repr` saying "All types which require special handling are covered by the examples below".  Aren't dicts an obvious case that also would require special handling?



---

archive/issue_comments_299270.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-05T22:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_299271.json:
```json
{
    "body": "Changing commit from \"cb1388758f0cf2872c6dbd9f548fd13a18aa4502\" to \"e3093ed9167903328b40ccfa5f0d41729d07021d\"",
    "created_at": "2015-01-05T22:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cb1388758f0cf2872c6dbd9f548fd13a18aa4502" to "e3093ed9167903328b40ccfa5f0d41729d07021d"



---

archive/issue_comments_299272.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 niles]:\n> I'm confused about the docstring for `reproducible_repr` saying \"All types which require special handling are covered by the examples below\".  Aren't dicts an obvious case that also would require special handling?\n\n\nYou are right, the documentation was misleading. The section was more about types for which I *have* special handling. There might be more types (e.g. `dict` at the time you read the code) which would *require* such handling but didn't receive it. I've clarified things now, and also added handling for `dict` and `list`.",
    "created_at": "2015-01-05T22:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299272",
    "user": "https://github.com/gagern"
}
```

<a id='comment:7'></a>Replying to [comment:5 niles]:
> I'm confused about the docstring for `reproducible_repr` saying "All types which require special handling are covered by the examples below".  Aren't dicts an obvious case that also would require special handling?


You are right, the documentation was misleading. The section was more about types for which I *have* special handling. There might be more types (e.g. `dict` at the time you read the code) which would *require* such handling but didn't receive it. I've clarified things now, and also added handling for `dict` and `list`.



---

archive/issue_comments_299273.json:
```json
{
    "body": "<a id='comment:8'></a>ok, looks good!",
    "created_at": "2015-01-06T13:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299273",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:8'></a>ok, looks good!



---

archive/issue_comments_299274.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-06T13:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299274",
    "user": "https://github.com/nilesjohnson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_299275.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for the review.",
    "created_at": "2015-01-06T17:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299275",
    "user": "https://github.com/gagern"
}
```

<a id='comment:9'></a>Thanks for the review.



---

archive/issue_comments_299276.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Niles Johnson\"",
    "created_at": "2015-01-06T17:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299276",
    "user": "https://github.com/gagern"
}
```

Changing reviewer from "" to "Niles Johnson"



---

archive/issue_comments_299277.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-12T18:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299277",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_299278.json:
```json
{
    "body": "Changing branch from \"u/gagern/ticket/17571\" to \"e3093ed9167903328b40ccfa5f0d41729d07021d\"",
    "created_at": "2015-01-12T18:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17571#issuecomment-299278",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gagern/ticket/17571" to "e3093ed9167903328b40ccfa5f0d41729d07021d"



---

archive/issue_events_050433.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-12T18:11:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17571",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17571#event-50433"
}
```
