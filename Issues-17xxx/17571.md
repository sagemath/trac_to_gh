# Issue 17571: Method tracing fixture

archive/issues_017334.json:
```json
{
    "assignees": [],
    "body": "This is a spin-off from #16571.\n\nI'd like to introduce a helper method for doctests which will trace a given method of an object, printing its interaction with its surroundings: method entry and exit, arguments and return value, as well as access to other members and methods of this object. For details see the docstring of the branch I'll attach.\n\nCC:  @nilesjohnson\n\nComponent: **doctest framework**\n\nAuthor: **Martin von Gagern**\n\nBranch/Commit: **[`e3093ed`](https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d)**\n\nReviewer: **Niles Johnson**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17571_\n\n",
    "closed_at": "2015-01-12T18:11:31Z",
    "created_at": "2014-12-30T19:43:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Method tracing fixture",
    "type": "issue",
    "updated_at": "2015-01-12T18:11:31Z",
    "url": "https://github.com/sagemath/sage/issues/17571",
    "user": "https://github.com/gagern"
}
```
This is a spin-off from #16571.

I'd like to introduce a helper method for doctests which will trace a given method of an object, printing its interaction with its surroundings: method entry and exit, arguments and return value, as well as access to other members and methods of this object. For details see the docstring of the branch I'll attach.

CC:  @nilesjohnson

Component: **doctest framework**

Author: **Martin von Gagern**

Branch/Commit: **[`e3093ed`](https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d)**

Reviewer: **Niles Johnson**

_Issue created by migration from https://trac.sagemath.org/ticket/17571_





---

archive/issue_events_248134.json:
```json
{
    "actor": "https://github.com/gagern",
    "created_at": "2014-12-30T19:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248134"
}
```



---

archive/issue_events_248135.json:
```json
{
    "actor": "https://github.com/gagern",
    "created_at": "2014-12-30T19:43:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "0000b0",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248135"
}
```



---

archive/issue_events_248136.json:
```json
{
    "actor": "https://github.com/gagern",
    "created_at": "2014-12-30T19:43:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248136"
}
```



---

archive/issue_events_248137.json:
```json
{
    "actor": "https://github.com/gagern",
    "created_at": "2014-12-30T19:43:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248137"
}
```



---

archive/issue_comments_235833.json:
```json
{
    "body": "Branch: **[u/gagern/ticket/17571](https://github.com/sagemath/sagetrac-mirror/tree/u/gagern/ticket/17571)**",
    "created_at": "2015-01-02T21:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235833",
    "user": "https://github.com/gagern"
}
```

Branch: **[u/gagern/ticket/17571](https://github.com/sagemath/sagetrac-mirror/tree/u/gagern/ticket/17571)**



---

archive/issue_events_248138.json:
```json
{
    "actor": "https://github.com/gagern",
    "created_at": "2015-01-02T21:52:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248138"
}
```



---

archive/issue_comments_235834.json:
```json
{
    "body": "Commit: **[`b89fb60`](https://github.com/sagemath/sagetrac-mirror/commit/b89fb603fce4e71a535b5bbf4bc052a70b33999d)**",
    "created_at": "2015-01-02T21:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235834",
    "user": "https://github.com/gagern"
}
```

Commit: **[`b89fb60`](https://github.com/sagemath/sagetrac-mirror/commit/b89fb603fce4e71a535b5bbf4bc052a70b33999d)**



---

archive/issue_comments_235835.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [niles](https://github.com/sagemath/sage/issues/16571#comment:26):\n> * The function `traceMethod` should be `trace_method` to fit the standard naming convention.  Was there a strong reason for the name you gave it?  If not, please change.\n\nDone.\n\n> * `PropertyAccessTracerProxy.__init__` and `PropertyAccessTracerProxy.fmt` need docstrings\n\nMoved class docstring to init method, which is explicitely allowed by the dev manual you mentioned.\n\n> * An author block and a copyright block are necessary at the top of the file.  See [here](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files).\n\nDone that, thanks!\n\n> * While you're at it, why not expand the documentation?  This could be useful much more generally, and a very short description at the top of the document would help explain what it does.\n\nI wrote some text at the beginning of the file to indicate what kind of code I'd eventually expect to be contained in this module. I think that my tracing code might not remain the only fixture, therefore limiting the documentation to just that seems like a bad restriction. I did however extend the documentation of the relevant classes as well, so they might now be easier to use on their own.\n\n> * It doesn't make sense to leave `fixtures.py` out of the reference manual.  I think you add it by adding a line in `src/doc/en/reference/doctest/index.rst`, but I may be misremembering.\n\nWorked fine, thanks!\n\n> * There are two tests in `doctest/control.py` that need to be updated because of the new fixtures file. Otherwise all tests pass.\n\nOh! I hadn't thought to run doctests in what I considered unrelated files, thanks for doing that! Fixed now.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecdc1bb29405fabd82f2f31321d585acefeee83e\"><code>ecdc1bb</code></a></td><td><code>Introduce method tracing fixture.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/771948a52e02d77f99d6dc3d85155371a4aa7cbb\"><code>771948a</code></a></td><td><code>Address issues from first review.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2cbaa017f5ac21c48d49a4ae4885dfcfe064e415\"><code>2cbaa01</code></a></td><td><code>Split property access tracing into proxy and helper classes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6334543439b49ded6ef7486b881d21817078e85\"><code>f633454</code></a></td><td><code>Improve documentation style.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8afc55386e90160f14b917abfde096de9ee6e196\"><code>8afc553</code></a></td><td><code>Turn reproducible_repr from a class method to a standalone function.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b89fb603fce4e71a535b5bbf4bc052a70b33999d\"><code>b89fb60</code></a></td><td><code>Use term attribute instead of property.</code></td></tr></table>\n",
    "created_at": "2015-01-02T21:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235835",
    "user": "https://github.com/gagern"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [niles](https://github.com/sagemath/sage/issues/16571#comment:26):
> * The function `traceMethod` should be `trace_method` to fit the standard naming convention.  Was there a strong reason for the name you gave it?  If not, please change.

Done.

> * `PropertyAccessTracerProxy.__init__` and `PropertyAccessTracerProxy.fmt` need docstrings

Moved class docstring to init method, which is explicitely allowed by the dev manual you mentioned.

> * An author block and a copyright block are necessary at the top of the file.  See [here](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files).

Done that, thanks!

> * While you're at it, why not expand the documentation?  This could be useful much more generally, and a very short description at the top of the document would help explain what it does.

I wrote some text at the beginning of the file to indicate what kind of code I'd eventually expect to be contained in this module. I think that my tracing code might not remain the only fixture, therefore limiting the documentation to just that seems like a bad restriction. I did however extend the documentation of the relevant classes as well, so they might now be easier to use on their own.

> * It doesn't make sense to leave `fixtures.py` out of the reference manual.  I think you add it by adding a line in `src/doc/en/reference/doctest/index.rst`, but I may be misremembering.

Worked fine, thanks!

> * There are two tests in `doctest/control.py` that need to be updated because of the new fixtures file. Otherwise all tests pass.

Oh! I hadn't thought to run doctests in what I considered unrelated files, thanks for doing that! Fixed now.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecdc1bb29405fabd82f2f31321d585acefeee83e"><code>ecdc1bb</code></a></td><td><code>Introduce method tracing fixture.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/771948a52e02d77f99d6dc3d85155371a4aa7cbb"><code>771948a</code></a></td><td><code>Address issues from first review.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2cbaa017f5ac21c48d49a4ae4885dfcfe064e415"><code>2cbaa01</code></a></td><td><code>Split property access tracing into proxy and helper classes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6334543439b49ded6ef7486b881d21817078e85"><code>f633454</code></a></td><td><code>Improve documentation style.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8afc55386e90160f14b917abfde096de9ee6e196"><code>8afc553</code></a></td><td><code>Turn reproducible_repr from a class method to a standalone function.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b89fb603fce4e71a535b5bbf4bc052a70b33999d"><code>b89fb60</code></a></td><td><code>Use term attribute instead of property.</code></td></tr></table>




---

archive/issue_comments_235836.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb1388758f0cf2872c6dbd9f548fd13a18aa4502\"><code>cb13887</code></a></td><td><code>Fix trivial spelling mistake.</code></td></tr></table>\n",
    "created_at": "2015-01-02T21:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235836",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb1388758f0cf2872c6dbd9f548fd13a18aa4502"><code>cb13887</code></a></td><td><code>Fix trivial spelling mistake.</code></td></tr></table>




---

archive/issue_comments_235837.json:
```json
{
    "body": "Changed commit from **[`b89fb60`](https://github.com/sagemath/sagetrac-mirror/commit/b89fb603fce4e71a535b5bbf4bc052a70b33999d)** to **[`cb13887`](https://github.com/sagemath/sagetrac-mirror/commit/cb1388758f0cf2872c6dbd9f548fd13a18aa4502)**",
    "created_at": "2015-01-02T21:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235837",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b89fb60`](https://github.com/sagemath/sagetrac-mirror/commit/b89fb603fce4e71a535b5bbf4bc052a70b33999d)** to **[`cb13887`](https://github.com/sagemath/sagetrac-mirror/commit/cb1388758f0cf2872c6dbd9f548fd13a18aa4502)**



---

archive/issue_comments_235838.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI'm confused about the docstring for `reproducible_repr` saying \"All types which require special handling are covered by the examples below\".  Aren't dicts an obvious case that also would require special handling?",
    "created_at": "2015-01-05T17:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235838",
    "user": "https://github.com/nilesjohnson"
}
```

<div id="comment:5" align="right">comment:5</div>

I'm confused about the docstring for `reproducible_repr` saying "All types which require special handling are covered by the examples below".  Aren't dicts an obvious case that also would require special handling?



---

archive/issue_comments_235839.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36241e3e3706ed269ea9617c5094aa54e097dd4a\"><code>36241e3</code></a></td><td><code>Clearer documentation for reproducible_repr.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d\"><code>e3093ed</code></a></td><td><code>Add reproducible_repr for list and dict.</code></td></tr></table>\n",
    "created_at": "2015-01-05T22:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235839",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36241e3e3706ed269ea9617c5094aa54e097dd4a"><code>36241e3</code></a></td><td><code>Clearer documentation for reproducible_repr.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d"><code>e3093ed</code></a></td><td><code>Add reproducible_repr for list and dict.</code></td></tr></table>




---

archive/issue_comments_235840.json:
```json
{
    "body": "Changed commit from **[`cb13887`](https://github.com/sagemath/sagetrac-mirror/commit/cb1388758f0cf2872c6dbd9f548fd13a18aa4502)** to **[`e3093ed`](https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d)**",
    "created_at": "2015-01-05T22:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235840",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb13887`](https://github.com/sagemath/sagetrac-mirror/commit/cb1388758f0cf2872c6dbd9f548fd13a18aa4502)** to **[`e3093ed`](https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d)**



---

archive/issue_comments_235841.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nilesjohnson](#comment%3A5):\n> I'm confused about the docstring for `reproducible_repr` saying \"All types which require special handling are covered by the examples below\".  Aren't dicts an obvious case that also would require special handling?\n\nYou are right, the documentation was misleading. The section was more about types for which I *have* special handling. There might be more types (e.g. `dict` at the time you read the code) which would *require* such handling but didn't receive it. I've clarified things now, and also added handling for `dict` and `list`.",
    "created_at": "2015-01-05T22:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235841",
    "user": "https://github.com/gagern"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nilesjohnson](#comment%3A5):
> I'm confused about the docstring for `reproducible_repr` saying "All types which require special handling are covered by the examples below".  Aren't dicts an obvious case that also would require special handling?

You are right, the documentation was misleading. The section was more about types for which I *have* special handling. There might be more types (e.g. `dict` at the time you read the code) which would *require* such handling but didn't receive it. I've clarified things now, and also added handling for `dict` and `list`.



---

archive/issue_comments_235842.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nok, looks good!",
    "created_at": "2015-01-06T13:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235842",
    "user": "https://github.com/nilesjohnson"
}
```

<div id="comment:8" align="right">comment:8</div>

ok, looks good!



---

archive/issue_events_248139.json:
```json
{
    "actor": "https://github.com/nilesjohnson",
    "created_at": "2015-01-06T13:24:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248139"
}
```



---

archive/issue_events_248140.json:
```json
{
    "actor": "https://github.com/nilesjohnson",
    "created_at": "2015-01-06T13:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248140"
}
```



---

archive/issue_comments_235843.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for the review.",
    "created_at": "2015-01-06T17:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235843",
    "user": "https://github.com/gagern"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for the review.



---

archive/issue_comments_235844.json:
```json
{
    "body": "Reviewer: **Niles Johnson**",
    "created_at": "2015-01-06T17:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235844",
    "user": "https://github.com/gagern"
}
```

Reviewer: **Niles Johnson**



---

archive/issue_comments_235845.json:
```json
{
    "body": "Changed branch from **[u/gagern/ticket/17571](https://github.com/sagemath/sagetrac-mirror/tree/u/gagern/ticket/17571)** to **[`e3093ed`](https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d)**",
    "created_at": "2015-01-12T18:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17571#issuecomment-235845",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gagern/ticket/17571](https://github.com/sagemath/sagetrac-mirror/tree/u/gagern/ticket/17571)** to **[`e3093ed`](https://github.com/sagemath/sagetrac-mirror/commit/e3093ed9167903328b40ccfa5f0d41729d07021d)**



---

archive/issue_events_248141.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-12T18:11:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248141"
}
```



---

archive/issue_events_248142.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2c351fef49e0e93ea840411d541b4f680c35a04a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-01-12T18:11:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17571",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17571#event-248142"
}
```
