# Issue 17785: crash in multipolynomial substitutions

archive/issues_017548.json:
```json
{
    "body": "Keywords: crash, SIGSEGV, substitution\n\nThe substitution code for multipolynomial (using Singular) results in a SIGSEV. For example, with `R.<x,y,z> = QQ[]` and any of\n\n```\nx.subs(None,y=x,x=0,z=y)\nx.subs(None,x=0,y=x,z=x)\nx.subs(None,x=0,y=0,z=x)\nx.subs(None,x=0,y=0,z=z)\n```\nThough, if we do not mix integer and variable in the substitutions it seems to work fine\n\n```\nsage: x.subs(None,x=0,y=0,z=0)\n0\nsage: x.subs(None,x=z,y=x,z=y)\nz\nsage: x.subs(None,x=x,y=y,z=z)\nx\n```\nAnd the following also works\n\n```\nsage: x.subs(None,x=0,y=x,z=0)\n0\nsage: x.subs(None,x=0,y=y,z=0)\n0\nsage: x.subs(None,x=0,y=z,z=0)\n0\nsage: x.subs(None,x=y,y=z,z=0)\ny\nsage: x.subs(None,x=y,y=0,z=0)\ny\nsage: x.subs(None,x=z,y=0,z=0)\nz\n```\n\n---\n\nOriginal report\n\nThe following code gives a coredump in Sage-6.5.rc3:\n\n```\na11,a12,a13,a21,a22,a23,a31,a32,a33 = allvars = var(\"a11,a12,a13,a21,a22,a23,a31,a32,a33\")\nP=PolynomialRing(QQ,allvars,order='degrevlex')\nP.inject_variables()\nA=matrix([[a11,a12,a13,],[a21,a22,a23,],[a31,a32,a33]])\nA.subs(a11=a13,a21=-a23,a31=a33,a22=0)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17785\n\n",
    "closed_at": "2016-01-13T21:09:01Z",
    "created_at": "2015-02-15T13:31:14Z",
    "labels": [
        "component: algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "crash in multipolynomial substitutions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17785",
    "user": "https://github.com/cnassau"
}
```
Keywords: crash, SIGSEGV, substitution

The substitution code for multipolynomial (using Singular) results in a SIGSEV. For example, with `R.<x,y,z> = QQ[]` and any of

```
x.subs(None,y=x,x=0,z=y)
x.subs(None,x=0,y=x,z=x)
x.subs(None,x=0,y=0,z=x)
x.subs(None,x=0,y=0,z=z)
```
Though, if we do not mix integer and variable in the substitutions it seems to work fine

```
sage: x.subs(None,x=0,y=0,z=0)
0
sage: x.subs(None,x=z,y=x,z=y)
z
sage: x.subs(None,x=x,y=y,z=z)
x
```
And the following also works

```
sage: x.subs(None,x=0,y=x,z=0)
0
sage: x.subs(None,x=0,y=y,z=0)
0
sage: x.subs(None,x=0,y=z,z=0)
0
sage: x.subs(None,x=y,y=z,z=0)
y
sage: x.subs(None,x=y,y=0,z=0)
y
sage: x.subs(None,x=z,y=0,z=0)
z
```

---

Original report

The following code gives a coredump in Sage-6.5.rc3:

```
a11,a12,a13,a21,a22,a23,a31,a32,a33 = allvars = var("a11,a12,a13,a21,a22,a23,a31,a32,a33")
P=PolynomialRing(QQ,allvars,order='degrevlex')
P.inject_variables()
A=matrix([[a11,a12,a13,],[a21,a22,a23,],[a31,a32,a33]])
A.subs(a11=a13,a21=-a23,a31=a33,a22=0)
```


Issue created by migration from https://trac.sagemath.org/ticket/17785





---

archive/issue_comments_233920.json:
```json
{
    "body": "Hello,\n\nThis is actually unrelated to matrices\n\n```\nsage: a22.subs(None,a11=a13,a21=-a23,a31=a33,a22=0)\n...\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n```\n\n(and as a sided remark, it is useless to declare the variables with `var`; the command `var` creates variables in the symbolic ring which have nothing to do with the variables of the polynomial ring)\n\nVincent",
    "created_at": "2015-02-15T13:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233920",
    "user": "https://github.com/videlec"
}
```

Hello,

This is actually unrelated to matrices

```
sage: a22.subs(None,a11=a13,a21=-a23,a31=a33,a22=0)
...
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
```

(and as a sided remark, it is useless to declare the variables with `var`; the command `var` creates variables in the symbolic ring which have nothing to do with the variables of the polynomial ring)

Vincent



---

archive/issue_comments_233921.json:
```json
{
    "body": "Simpler examples with three variables `R.<x,y,z> = QQ[]`\n\n```\nsage: x.subs(None,y=x,x=0,z=y)\nsage: x.subs(None,x=0,y=x,z=x)\nsage: x.subs(None,x=0,y=0,z=x)\n```",
    "created_at": "2015-12-04T02:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233921",
    "user": "https://github.com/videlec"
}
```

Simpler examples with three variables `R.<x,y,z> = QQ[]`

```
sage: x.subs(None,y=x,x=0,z=y)
sage: x.subs(None,x=0,y=x,z=x)
sage: x.subs(None,x=0,y=0,z=x)
```



---

archive/issue_comments_233922.json:
```json
{
    "body": "Changing priority from minor to critical.",
    "created_at": "2015-12-04T13:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233922",
    "user": "https://github.com/videlec"
}
```

Changing priority from minor to critical.



---

archive/issue_comments_233923.json:
```json
{
    "body": "Changing keywords from \"crash, substitution\" to \"crash, SIGSEGV, substitution\".",
    "created_at": "2015-12-04T13:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233923",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "crash, substitution" to "crash, SIGSEGV, substitution".



---

archive/issue_events_050805.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-12-04T13:21:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17785#event-50805"
}
```



---

archive/issue_comments_233924.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-05T01:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233924",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233925.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-12-05T01:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233925",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_233926.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-13T10:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233926",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_050806.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-13T21:09:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17785#event-50806"
}
```



---

archive/issue_comments_233927.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-13T21:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17785#issuecomment-233927",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
