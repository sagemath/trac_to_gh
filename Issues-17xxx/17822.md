# Issue 17822: faster matrix integer dense

archive/issues_017585.json:
```json
{
    "body": "We now have a flint implementation of dense integer matrices. The branch proposes various optimization in `matrix.matrix_integer_dense` to make it faster.\n\nfollow up: #17824\n\nBranch/Commit: d48c188400d02ee7df99820b30fd8dc6a8f1bfc9\n\nReviewer: Jeroen Demeyer\n\nAuthor: Vincent Delecroix\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17822\n\n",
    "closed_at": "2015-02-25T22:34:17Z",
    "created_at": "2015-02-21T16:17:00Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "faster matrix integer dense",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17822",
    "user": "https://github.com/videlec"
}
```
We now have a flint implementation of dense integer matrices. The branch proposes various optimization in `matrix.matrix_integer_dense` to make it faster.

follow up: #17824

Branch/Commit: d48c188400d02ee7df99820b30fd8dc6a8f1bfc9

Reviewer: Jeroen Demeyer

Author: Vincent Delecroix

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17822





---

archive/issue_comments_234576.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2015-02-21T16:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234576",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_234577.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-21T16:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234577",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_234578.json:
```json
{
    "body": "<a id='comment:2'></a>new timings:\n\n```\nsage: M = MatrixSpace(ZZ,3)\nsage: m = M([1,2,3,4,5,6,1,2,-3])\nsage: %timeit m*m\n1000000 loops, best of 3: 1.13 \u00b5s per loop\nsage: %timeit m**3\n100000 loops, best of 3: 2.04 \u00b5s per loop\nsage: %timeit m**100\n100000 loops, best of 3: 7.71 \u00b5s per loop\nsage: %timeit m**-100\n1000 loops, best of 3: 377 \u00b5s per loop\nsage: %timeit ~m\n10000 loops, best of 3: 37 \u00b5s per loop\nsage: M1 = MatrixSpace(ZZ,4,2)\nsage: m1 = M1(range(8))\nsage: M2 = MatrixSpace(ZZ,3,4)\nsage: m2 = M2(range(12))\nsage: %timeit m2*m1\n100000 loops, best of 3: 4.8 \u00b5s per loop\n```\n\nsame operations on sage-6.6.beta0:\n\n```\nsage: M = MatrixSpace(ZZ,3)\nsage: m = M([1,2,3,4,5,6,1,2,-3])\nsage: %timeit m*m\n100000 loops, best of 3: 4.72 \u00b5s per loop\nsage: %timeit m**3\n100000 loops, best of 3: 10.2 \u00b5s per loop\nsage: %timeit m**100\n10000 loops, best of 3: 45.8 \u00b5s per loop\nsage: %timeit m**-100\n1000 loops, best of 3: 462 \u00b5s per loop\nsage: %timeit ~m\n1000 loops, best of 3: 138 \u00b5s per loop\nsage: M1 = MatrixSpace(ZZ,4,2)\nsage: m1 = M1(range(8))\nsage: M2 = MatrixSpace(ZZ,3,4)\nsage: m2 = M2(range(12))\nsage: %timeit m2*m1\n100000 loops, best of 3: 10.7 \u00b5s per loop\n```",
    "created_at": "2015-02-21T16:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234578",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>new timings:

```
sage: M = MatrixSpace(ZZ,3)
sage: m = M([1,2,3,4,5,6,1,2,-3])
sage: %timeit m*m
1000000 loops, best of 3: 1.13 µs per loop
sage: %timeit m**3
100000 loops, best of 3: 2.04 µs per loop
sage: %timeit m**100
100000 loops, best of 3: 7.71 µs per loop
sage: %timeit m**-100
1000 loops, best of 3: 377 µs per loop
sage: %timeit ~m
10000 loops, best of 3: 37 µs per loop
sage: M1 = MatrixSpace(ZZ,4,2)
sage: m1 = M1(range(8))
sage: M2 = MatrixSpace(ZZ,3,4)
sage: m2 = M2(range(12))
sage: %timeit m2*m1
100000 loops, best of 3: 4.8 µs per loop
```

same operations on sage-6.6.beta0:

```
sage: M = MatrixSpace(ZZ,3)
sage: m = M([1,2,3,4,5,6,1,2,-3])
sage: %timeit m*m
100000 loops, best of 3: 4.72 µs per loop
sage: %timeit m**3
100000 loops, best of 3: 10.2 µs per loop
sage: %timeit m**100
10000 loops, best of 3: 45.8 µs per loop
sage: %timeit m**-100
1000 loops, best of 3: 462 µs per loop
sage: %timeit ~m
1000 loops, best of 3: 138 µs per loop
sage: M1 = MatrixSpace(ZZ,4,2)
sage: m1 = M1(range(8))
sage: M2 = MatrixSpace(ZZ,3,4)
sage: m2 = M2(range(12))
sage: %timeit m2*m1
100000 loops, best of 3: 10.7 µs per loop
```



---

archive/issue_comments_234579.json:
```json
{
    "body": "<a id='comment:3'></a>Instead of `mpz_cmp_ui((<Integer>n).value, ULONG_MAX) < 1:`, why not use `mpz_fits_ui` which is **exactly** made for that purpose?",
    "created_at": "2015-02-21T17:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234579",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Instead of `mpz_cmp_ui((<Integer>n).value, ULONG_MAX) < 1:`, why not use `mpz_fits_ui` which is **exactly** made for that purpose?



---

archive/issue_comments_234580.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-21T18:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234580",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234581.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-21T18:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_234582.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-21T20:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234583.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-23T09:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234584.json:
```json
{
    "body": "<a id='comment:9'></a>Why did you *move* `__copy__`? It's harder to review that way.\n\nPlease remove\n\n```\ncdef object P\n```\nsince it serves no purpose.",
    "created_at": "2015-02-23T14:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234584",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Why did you *move* `__copy__`? It's harder to review that way.

Please remove

```
cdef object P
```
since it serves no purpose.



---

archive/issue_comments_234585.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-23T14:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234586.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:\n> Why did you *move* `__copy__`? It's harder to review that way.\n\n\n`__copy__` is referenced in the list of LEVEL 2 functionalities. So I first implement it there and then I discover that it was already in the begining of the file.\n\n> Please remove\n> \n> ```\n> cdef object P\n> ```\n> since it serves no purpose.\n\n\nright.",
    "created_at": "2015-02-23T14:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234586",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:
> Why did you *move* `__copy__`? It's harder to review that way.


`__copy__` is referenced in the list of LEVEL 2 functionalities. So I first implement it there and then I discover that it was already in the begining of the file.

> Please remove
> 
> ```
> cdef object P
> ```
> since it serves no purpose.


right.



---

archive/issue_comments_234587.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 vdelecroix]:\n> `__copy__` is referenced in the list of LEVEL 2 functionalities.\n\nWhat does this \"LEVEL 2 functionalities\" mean anyway?",
    "created_at": "2015-02-23T14:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234587",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:11 vdelecroix]:
> `__copy__` is referenced in the list of LEVEL 2 functionalities.

What does this "LEVEL 2 functionalities" mean anyway?



---

archive/issue_comments_234588.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 vdelecroix]:\n> > `__copy__` is referenced in the list of LEVEL 2 functionalities.\n\n> What does this \"LEVEL 2 functionalities\" mean anyway?\n\nIt refers to the crazy organization of the matrix code inside `matrix0.pyx`, `matrix1.pyx` and `matrix2.pyx`.",
    "created_at": "2015-02-23T14:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234588",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 vdelecroix]:
> > `__copy__` is referenced in the list of LEVEL 2 functionalities.

> What does this "LEVEL 2 functionalities" mean anyway?

It refers to the crazy organization of the matrix code inside `matrix0.pyx`, `matrix1.pyx` and `matrix2.pyx`.



---

archive/issue_comments_234589.json:
```json
{
    "body": "<a id='comment:15'></a>Reviewer patch needs review.\n\n---\nNew commits:",
    "created_at": "2015-02-24T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234589",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Reviewer patch needs review.

---
New commits:



---

archive/issue_comments_234590.json:
```json
{
    "body": "<a id='comment:16'></a>What is this Cython syntax for?\n\n```\ncdef Matrix_integer_dense self = <Matrix_integer_dense?>sself\n```",
    "created_at": "2015-02-24T09:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234590",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>What is this Cython syntax for?

```
cdef Matrix_integer_dense self = <Matrix_integer_dense?>sself
```



---

archive/issue_comments_234591.json:
```json
{
    "body": "<a id='comment:17'></a>It's a cast with *check*. In particular, it disallows `sself = None`.",
    "created_at": "2015-02-24T09:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234591",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>It's a cast with *check*. In particular, it disallows `sself = None`.



---

archive/issue_comments_234592.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 vdelecroix]:\n> What is this Cython syntax for?\n> \n> ```\n> cdef Matrix_integer_dense self = <Matrix_integer_dense?>sself\n> ```\n\n\njust found out \"cast type checked\".",
    "created_at": "2015-02-24T09:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234592",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [comment:16 vdelecroix]:
> What is this Cython syntax for?
> 
> ```
> cdef Matrix_integer_dense self = <Matrix_integer_dense?>sself
> ```


just found out "cast type checked".



---

archive/issue_comments_234593.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 jdemeyer]:\n> It's a cast with *check*. In particular, it disallows `sself = None`.\n\n\n`sself` can be `None` here!?",
    "created_at": "2015-02-24T10:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234593",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>Replying to [comment:17 jdemeyer]:
> It's a cast with *check*. In particular, it disallows `sself = None`.


`sself` can be `None` here!?



---

archive/issue_comments_234594.json:
```json
{
    "body": "<a id='comment:20'></a>If you do `None^M` with `M` an integer matrix, then yes.",
    "created_at": "2015-02-24T10:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234594",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>If you do `None^M` with `M` an integer matrix, then yes.



---

archive/issue_comments_234595.json:
```json
{
    "body": "<a id='comment:21'></a>Thanks for the improvements! (And if you have time, there is the follow up #17824)",
    "created_at": "2015-02-24T10:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234595",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>Thanks for the improvements! (And if you have time, there is the follow up #17824)



---

archive/issue_comments_234596.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-24T10:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234596",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_234597.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 vdelecroix]:\n> And if you have time, there is the follow up #17824\n\nNot before this one is merged (I rely on the web trac diff view for reviewing which is only reliable if all dependencies have been merged).",
    "created_at": "2015-02-24T13:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234597",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Replying to [comment:21 vdelecroix]:
> And if you have time, there is the follow up #17824

Not before this one is merged (I rely on the web trac diff view for reviewing which is only reliable if all dependencies have been merged).



---

archive/issue_comments_234598.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-25T22:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17822#issuecomment-234598",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050873.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-25T22:34:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17822",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17822#event-50873"
}
```
