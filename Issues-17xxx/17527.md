# Issue 17527: Echelon form of a matrix is sometimes pickled incorrectly

archive/issues_017290.json:
```json
{
    "body": "The following bug seems to be somewhat subtle; for example, the wrong result does not arise when using the polynomial ring instead of its fraction field, or when changing the ordering of the pair `t`.\n\n```\nsage: K.<x> = FractionField(QQ['x'])\nsage: m = Matrix([[1], [x]])\nsage: t = (m, m.echelon_form())\nsage: s = dumps(t)\nsage: t\n(\n[1]  [1]\n[x], [0]\n)\nsage: loads(s)  # wrong, should be the same as above\n(\n[1]\n[x], [1, x]\n)\n```\n\n\nKeywords: matrix echelon pickle\n\nBranch/Commit: 5c269502e35cfcbed66e5ad1b13a1bad7e10b799\n\nReviewer: Travis Scrimshaw\n\nAuthor: Peter Bruin\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17527\n\n",
    "closed_at": "2017-01-28T17:03:20Z",
    "created_at": "2014-12-19T10:04:49Z",
    "labels": [
        "component: pickling",
        "trivial"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Echelon form of a matrix is sometimes pickled incorrectly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17527",
    "user": "https://github.com/pjbruin"
}
```
The following bug seems to be somewhat subtle; for example, the wrong result does not arise when using the polynomial ring instead of its fraction field, or when changing the ordering of the pair `t`.

```
sage: K.<x> = FractionField(QQ['x'])
sage: m = Matrix([[1], [x]])
sage: t = (m, m.echelon_form())
sage: s = dumps(t)
sage: t
(
[1]  [1]
[x], [0]
)
sage: loads(s)  # wrong, should be the same as above
(
[1]
[x], [1, x]
)
```


Keywords: matrix echelon pickle

Branch/Commit: 5c269502e35cfcbed66e5ad1b13a1bad7e10b799

Reviewer: Travis Scrimshaw

Author: Peter Bruin

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17527





---

archive/issue_comments_229880.json:
```json
{
    "body": "<a id='comment:2'></a>This bug is still present in 7.5.beta3 but appears to be gone in 7.5.rc1.",
    "created_at": "2017-01-03T15:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229880",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:2'></a>This bug is still present in 7.5.beta3 but appears to be gone in 7.5.rc1.



---

archive/issue_comments_229881.json:
```json
{
    "body": "<a id='comment:3'></a>Hmmm...I don't see anything in the closed ticket descriptions that would have fixing this as a potential side-effect. Perhaps we should just add a doctest?",
    "created_at": "2017-01-03T22:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229881",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Hmmm...I don't see anything in the closed ticket descriptions that would have fixing this as a potential side-effect. Perhaps we should just add a doctest?



---

archive/issue_comments_229882.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 tscrim]:\n> Hmmm...I don't see anything in the closed ticket descriptions that would have fixing this as a potential side-effect. Perhaps we should just add a doctest?\n\nI suspect it was fixed by the upgrade to Python 2.7.12 in Sage 7.5.rc0, more specifically [Python issue 892902](https://bugs.python.org/issue892902).",
    "created_at": "2017-01-04T08:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229882",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>Replying to [comment:3 tscrim]:
> Hmmm...I don't see anything in the closed ticket descriptions that would have fixing this as a potential side-effect. Perhaps we should just add a doctest?

I suspect it was fixed by the upgrade to Python 2.7.12 in Sage 7.5.rc0, more specifically [Python issue 892902](https://bugs.python.org/issue892902).



---

archive/issue_comments_229883.json:
```json
{
    "body": "<a id='comment:5'></a>Confirmed by `git bisect` (of course \"bad\" here means \"good\"):\n\n```\nc35ea3cbcef6c1ae9f6a939af853ac339fcd691c is the first bad commit\ncommit c35ea3cbcef6c1ae9f6a939af853ac339fcd691c\nAuthor: Fran\u00e7ois Bissey <francois.bissey@canterbury.ac.nz>\nDate:   Thu Dec 8 14:40:38 2016 +1300\n\n    Upgrade python2 to 2.7.12 and update tinfo and uuid patches\n\n```\nI will add a doctest.",
    "created_at": "2017-01-04T09:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229883",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>Confirmed by `git bisect` (of course "bad" here means "good"):

```
c35ea3cbcef6c1ae9f6a939af853ac339fcd691c is the first bad commit
commit c35ea3cbcef6c1ae9f6a939af853ac339fcd691c
Author: Fran√ßois Bissey <francois.bissey@canterbury.ac.nz>
Date:   Thu Dec 8 14:40:38 2016 +1300

    Upgrade python2 to 2.7.12 and update tinfo and uuid patches

```
I will add a doctest.



---

archive/issue_comments_229884.json:
```json
{
    "body": "Changing type from defect to task.",
    "created_at": "2017-01-04T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229884",
    "user": "https://github.com/pjbruin"
}
```

Changing type from defect to task.



---

archive/issue_comments_229885.json:
```json
{
    "body": "Changing priority from minor to trivial.",
    "created_at": "2017-01-04T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229885",
    "user": "https://github.com/pjbruin"
}
```

Changing priority from minor to trivial.



---

archive/issue_comments_229886.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-04T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229886",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_events_050359.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-04T12:19:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17527#event-50359"
}
```



---

archive/issue_comments_229887.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks.",
    "created_at": "2017-01-04T12:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229887",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Thanks.



---

archive/issue_comments_229888.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-04T12:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229888",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_229889.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-28T17:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17527#issuecomment-229889",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050360.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-28T17:03:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17527",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17527#event-50360"
}
```
