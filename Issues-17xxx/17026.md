# Issue 17026: Compare PARI objects using cmp_universal() instead of strcmp()

archive/issues_016789.json:
```json
{
    "body": "After the separate implementations of `__cmp__()` and `__richcmp__()` for PARI objects in #16127, it is a small step to replace the string comparison in `__cmp__()` by the built-in PARI function `cmp_universal()`.  This is faster, mathematically no more or less meaningful, and (unlike string comparison) gives a total ordering on the set of PARI objects up to the \"indistinguishability\" relation (`gidentical()`).\n\nAn example of two elements that used to be indistinguishable to `cmp()`:\n\n```\nsage: a = pari(\"0*ffgen(ffinit(29, 10, 't))\"); a\n0\nsage: b = pari(0); b\n0\nsage: cmp(a, b)\n1\n```\n\n\nCC:  @jdemeyer\n\nKeywords: pari comparison\n\nBranch/Commit: 85804fc472017342a03c4f0ca45062060184e119\n\nReviewer: Jeroen Demeyer\n\nAuthor: Peter Bruin\n\nDependencies: #16127\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17026\n\n",
    "closed_at": "2014-09-27T12:57:14Z",
    "created_at": "2014-09-22T14:19:12Z",
    "labels": [
        "component: interfaces",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Compare PARI objects using cmp_universal() instead of strcmp()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17026",
    "user": "https://github.com/pjbruin"
}
```
After the separate implementations of `__cmp__()` and `__richcmp__()` for PARI objects in #16127, it is a small step to replace the string comparison in `__cmp__()` by the built-in PARI function `cmp_universal()`.  This is faster, mathematically no more or less meaningful, and (unlike string comparison) gives a total ordering on the set of PARI objects up to the "indistinguishability" relation (`gidentical()`).

An example of two elements that used to be indistinguishable to `cmp()`:

```
sage: a = pari("0*ffgen(ffinit(29, 10, 't))"); a
0
sage: b = pari(0); b
0
sage: cmp(a, b)
1
```


CC:  @jdemeyer

Keywords: pari comparison

Branch/Commit: 85804fc472017342a03c4f0ca45062060184e119

Reviewer: Jeroen Demeyer

Author: Peter Bruin

Dependencies: #16127

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17026





---

archive/issue_comments_286217.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n After the separate implementations of `__cmp__()` and `__richcmp__()` for PARI objects in #16127, it is a small step to replace the string comparison in `__cmp__()` by the built-in PARI function `cmp_universal()`.  This is faster, mathematically no more or less meaningful, and (unlike string comparison) gives a total ordering on the set of PARI objects up to the \"indistinguishability\" relation (`gidentical()`).\n+\n+An example of two elements that used to be indistinguishable to `cmp()`:\n+\n+```\n+sage: a = pari(\"0*ffgen(ffinit(29, 10, 't))\"); a\n+0\n+sage: b = pari(0); b\n+0\n+sage: cmp(a, b)\n+1\n+```\n+\n``````\n",
    "created_at": "2014-09-22T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286217",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,13 @@
 After the separate implementations of `__cmp__()` and `__richcmp__()` for PARI objects in #16127, it is a small step to replace the string comparison in `__cmp__()` by the built-in PARI function `cmp_universal()`.  This is faster, mathematically no more or less meaningful, and (unlike string comparison) gives a total ordering on the set of PARI objects up to the "indistinguishability" relation (`gidentical()`).
+
+An example of two elements that used to be indistinguishable to `cmp()`:
+
+```
+sage: a = pari("0*ffgen(ffinit(29, 10, 't))"); a
+0
+sage: b = pari(0); b
+0
+sage: cmp(a, b)
+1
+```
+
``````




---

archive/issue_comments_286218.json:
```json
{
    "body": "Changing keywords from \"\" to \"pari comparison\".",
    "created_at": "2014-09-22T15:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286218",
    "user": "https://github.com/pjbruin"
}
```

Changing keywords from "" to "pari comparison".



---

archive/issue_comments_286219.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-22T15:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286219",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286220.json:
```json
{
    "body": "Changing commit from \"\" to \"a6159f520bdc0985e9ae05829dfee58e9397e947\"",
    "created_at": "2014-09-22T15:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286220",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "a6159f520bdc0985e9ae05829dfee58e9397e947"



---

archive/issue_comments_286221.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/17026-cmp_universal\"",
    "created_at": "2014-09-22T15:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286221",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/17026-cmp_universal"



---

archive/issue_comments_286222.json:
```json
{
    "body": "<a id='comment:3'></a>There is only one slightly strange thing in all of this, namely the following:\n\n```diff\n--- a/src/sage/rings/number_field/splitting_field.py\n+++ b/src/sage/rings/number_field/splitting_field.py\n@@ -87,7 +87,7 @@ class SplittingData:\n     delta = self.dm.__cmp__(other.dm)\n     if delta:\n         return delta\n- return self.pol.__cmp__(other.pol)\n+ return cmp(str(self.pol), str(other.pol))\n \n     def poldegree(self):\n         \"\"\"\n \n```\nI had to resort to string comparison because there is one doctest (in `sage/schemes/elliptic_curves/ell_number_field.py`) that times out otherwise:\n\n```\nsage: E = EllipticCurve('27a1')\nsage: K.<b> = E.division_field(7); K  # long time (8s on sage.math, 2014)\n```\nI wonder if we are just lucky that this terminates in reasonable time with the current sorting of polynomials, or if there is some PARI bug that potentially causes a very long time or infinite loop in the splitting field computation.",
    "created_at": "2014-09-22T15:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286222",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'></a>There is only one slightly strange thing in all of this, namely the following:

```diff
--- a/src/sage/rings/number_field/splitting_field.py
+++ b/src/sage/rings/number_field/splitting_field.py
@@ -87,7 +87,7 @@ class SplittingData:
     delta = self.dm.__cmp__(other.dm)
     if delta:
         return delta
- return self.pol.__cmp__(other.pol)
+ return cmp(str(self.pol), str(other.pol))
 
     def poldegree(self):
         """
 
```
I had to resort to string comparison because there is one doctest (in `sage/schemes/elliptic_curves/ell_number_field.py`) that times out otherwise:

```
sage: E = EllipticCurve('27a1')
sage: K.<b> = E.division_field(7); K  # long time (8s on sage.math, 2014)
```
I wonder if we are just lucky that this terminates in reasonable time with the current sorting of polynomials, or if there is some PARI bug that potentially causes a very long time or infinite loop in the splitting field computation.



---

archive/issue_comments_286223.json:
```json
{
    "body": "Changing branch from \"u/pbruin/17026-cmp_universal\" to \"u/jdemeyer/ticket/17026\"",
    "created_at": "2014-09-25T09:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286223",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/pbruin/17026-cmp_universal" to "u/jdemeyer/ticket/17026"



---

archive/issue_comments_286224.json:
```json
{
    "body": "<a id='comment:5'></a>Amended commit message.\n\n---\nNew commits:",
    "created_at": "2014-09-25T09:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286224",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Amended commit message.

---
New commits:



---

archive/issue_comments_286225.json:
```json
{
    "body": "Changing commit from \"a6159f520bdc0985e9ae05829dfee58e9397e947\" to \"5613d3539ac1030bf45033b38113a1750d842f46\"",
    "created_at": "2014-09-25T09:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286225",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "a6159f520bdc0985e9ae05829dfee58e9397e947" to "5613d3539ac1030bf45033b38113a1750d842f46"



---

archive/issue_comments_286226.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-25T11:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286227.json:
```json
{
    "body": "Changing commit from \"5613d3539ac1030bf45033b38113a1750d842f46\" to \"85804fc472017342a03c4f0ca45062060184e119\"",
    "created_at": "2014-09-25T11:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286227",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5613d3539ac1030bf45033b38113a1750d842f46" to "85804fc472017342a03c4f0ca45062060184e119"



---

archive/issue_comments_286228.json:
```json
{
    "body": "<a id='comment:7'></a>In `key()`, shouldn't `self.poldegree()` be `self.pol.poldegree()`?\n\nThanks for adding the warning about `cmp()`; I had planned to do that, but forgot.",
    "created_at": "2014-09-25T11:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286228",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>In `key()`, shouldn't `self.poldegree()` be `self.pol.poldegree()`?

Thanks for adding the warning about `cmp()`; I had planned to do that, but forgot.



---

archive/issue_comments_286229.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 pbruin]:\n> In `key()`, shouldn't `self.poldegree()` be `self.pol.poldegree()`?\n\nDoesn't matter, `self.poldegree()` is defined to be `self.pol.poldegree()`.",
    "created_at": "2014-09-25T11:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286229",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:7 pbruin]:
> In `key()`, shouldn't `self.poldegree()` be `self.pol.poldegree()`?

Doesn't matter, `self.poldegree()` is defined to be `self.pol.poldegree()`.



---

archive/issue_comments_286230.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:\n> Replying to [comment:7 pbruin]:\n> > In `key()`, shouldn't `self.poldegree()` be `self.pol.poldegree()`?\n\n> Doesn't matter, `self.poldegree()` is defined to be `self.pol.poldegree()`.\nI see, that had escaped me.",
    "created_at": "2014-09-25T11:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286230",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:
> Replying to [comment:7 pbruin]:
> > In `key()`, shouldn't `self.poldegree()` be `self.pol.poldegree()`?

> Doesn't matter, `self.poldegree()` is defined to be `self.pol.poldegree()`.
I see, that had escaped me.



---

archive/issue_comments_286231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-25T11:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286231",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_286232.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-09-25T11:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286232",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_286233.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/17026\" to \"85804fc472017342a03c4f0ca45062060184e119\"",
    "created_at": "2014-09-27T12:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286233",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/17026" to "85804fc472017342a03c4f0ca45062060184e119"



---

archive/issue_events_049553.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-27T12:57:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17026#event-49553"
}
```



---

archive/issue_comments_286234.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-27T12:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17026#issuecomment-286234",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
