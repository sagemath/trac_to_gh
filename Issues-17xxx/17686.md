# Issue 17686: pexpect interfaces are never deleted

archive/issues_017449.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis crashes because the `Dokchitser` instances are kept alive all the time.\n\n```\nsage: for i in range(2000):\n....:     D = Dokchitser(conductor=1, gammaV=[0], weight=1, eps=1, poles=[1], residues=[-1], init='1')\n```\n\nComponent: **interfaces**\n\nAuthor: **Jeroen Demeyer**\n\nBranch: **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)**\n\nReviewer: **Volker Braun**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17686_\n\n",
    "closed_at": "2015-06-19T08:25:05Z",
    "created_at": "2015-01-29T00:16:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "pexpect interfaces are never deleted",
    "type": "issue",
    "updated_at": "2015-06-19T22:24:21Z",
    "url": "https://github.com/sagemath/sage/issues/17686",
    "user": "https://github.com/sagetrac-alexc"
}
```
<div id="comment:0"></div>

This crashes because the `Dokchitser` instances are kept alive all the time.

```
sage: for i in range(2000):
....:     D = Dokchitser(conductor=1, gammaV=[0], weight=1, eps=1, poles=[1], residues=[-1], init='1')
```

Component: **interfaces**

Author: **Jeroen Demeyer**

Branch: **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)**

Reviewer: **Volker Braun**

_Issue created by migration from https://trac.sagemath.org/ticket/17686_





---

archive/issue_events_249690.json:
```json
{
    "actor": "https://github.com/sagetrac-alexc",
    "created_at": "2015-01-29T00:16:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249690"
}
```



---

archive/issue_events_249691.json:
```json
{
    "actor": "https://github.com/sagetrac-alexc",
    "created_at": "2015-01-29T00:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249691"
}
```



---

archive/issue_events_249692.json:
```json
{
    "actor": "https://github.com/sagetrac-alexc",
    "created_at": "2015-01-29T00:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249692"
}
```



---

archive/issue_events_249693.json:
```json
{
    "actor": "https://github.com/sagetrac-alexc",
    "created_at": "2015-01-29T00:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249693"
}
```



---

archive/issue_comments_238690.json:
```json
{
    "body": "Replying to [@sagetrac-alexc](https://github.com/sagemath/sage/issues/17686#comment:0):\n> Let me know what additional information I can provide to help.\n\nA reproducible example...",
    "created_at": "2015-01-29T06:31:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238690",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [@sagetrac-alexc](https://github.com/sagemath/sage/issues/17686#comment:0):
> Let me know what additional information I can provide to help.

A reproducible example...



---

archive/issue_comments_238691.json:
```json
{
    "body": "Attachment: **[computeltest.py.gz](https://github.com/sagemath/sage/files/ticket17686/computeltest.py.gz)**\n\nExample",
    "created_at": "2015-01-30T05:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238691",
    "user": "https://github.com/sagetrac-alexc"
}
```

Attachment: **[computeltest.py.gz](https://github.com/sagemath/sage/files/ticket17686/computeltest.py.gz)**

Example



---

archive/issue_comments_238692.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@jdemeyer](#comment%3A1):\n> Replying to [@sagetrac-alexc](https://github.com/sagemath/sage/issues/17686#comment:0):\n> > Let me know what additional information I can provide to help.\n> \n> A reproducible example...\n\nI've attached a program which produces the error. The program fails after count = 160 for me.",
    "created_at": "2015-01-30T05:30:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238692",
    "user": "https://github.com/sagetrac-alexc"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@jdemeyer](#comment%3A1):
> Replying to [@sagetrac-alexc](https://github.com/sagemath/sage/issues/17686#comment:0):
> > Let me know what additional information I can provide to help.
> 
> A reproducible example...

I've attached a program which produces the error. The program fails after count = 160 for me.



---

archive/issue_comments_238693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,30 +1,6 @@\n-I get the following error after a runtime of several minutes. If I change parts of my code, the error occurs in different places. Running just snippets of the code does not produce the error. I'm running sage 6.4 on a fresh installation of Ubuntu 14.04 64bit on a fairly powerful computer.\n-\n-The only previous mention of this error that I could find is https://github.com/sagemath/sage/issues/9866.\n-\n-Can anyone suggest workarounds?\n-\n-Let me know what additional information I can provide to help.\n+This crashes because the `Dokchitser` instances do not close the logfile:\n \n ```\n-Traceback (most recent call last):\n-  File \"RHS.py\", line 275, in DokchitserDirichlet\n-    L.init_coeffs('chi(k)', 1, 'conj(chi(k))', pari_precode=pari_precode)\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py\", line 340, in init_coeffs\n-    gp = self.gp()\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py\", line 225, in gp\n-    g.read('computel.gp')\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 634, in read\n-    self.eval(self._read_in_file_command(filename))\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1223, in eval\n-    for L in code.split('\\n') if L != ''])\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/gp.py\", line 400, in _eval_line\n-    wait_for_prompt=wait_for_prompt)\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 817, in _eval_line\n-    self._start()\n-  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 432, in _start\n-    self.name(), cmd, self._install_hints()))\n-RuntimeError: unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed\n-\n-Exception RuntimeError: RuntimeError('sys.path must be a list of directory names',) in <bound method Dokchitser.__del__ of Dokchitser L-series of conductor 7 and weight 1> ignored\n+sage: for i in range(2000):\n+....:     D = Dokchitser(conductor=1, gammaV=[0], weight=1, eps=1, poles=[1], residues=[-1], init='1')\n ```\n``````\n",
    "created_at": "2015-01-30T11:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238693",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,30 +1,6 @@
-I get the following error after a runtime of several minutes. If I change parts of my code, the error occurs in different places. Running just snippets of the code does not produce the error. I'm running sage 6.4 on a fresh installation of Ubuntu 14.04 64bit on a fairly powerful computer.
-
-The only previous mention of this error that I could find is https://github.com/sagemath/sage/issues/9866.
-
-Can anyone suggest workarounds?
-
-Let me know what additional information I can provide to help.
+This crashes because the `Dokchitser` instances do not close the logfile:
 
 ```
-Traceback (most recent call last):
-  File "RHS.py", line 275, in DokchitserDirichlet
-    L.init_coeffs('chi(k)', 1, 'conj(chi(k))', pari_precode=pari_precode)
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py", line 340, in init_coeffs
-    gp = self.gp()
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py", line 225, in gp
-    g.read('computel.gp')
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 634, in read
-    self.eval(self._read_in_file_command(filename))
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1223, in eval
-    for L in code.split('\n') if L != ''])
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/gp.py", line 400, in _eval_line
-    wait_for_prompt=wait_for_prompt)
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 817, in _eval_line
-    self._start()
-  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 432, in _start
-    self.name(), cmd, self._install_hints()))
-RuntimeError: unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed
-
-Exception RuntimeError: RuntimeError('sys.path must be a list of directory names',) in <bound method Dokchitser.__del__ of Dokchitser L-series of conductor 7 and weight 1> ignored
+sage: for i in range(2000):
+....:     D = Dokchitser(conductor=1, gammaV=[0], weight=1, eps=1, poles=[1], residues=[-1], init='1')
 ```
``````




---

archive/issue_events_249694.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-30T11:30:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249694"
}
```



---

archive/issue_events_249695.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-30T11:30:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249695"
}
```



---

archive/issue_events_249696.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-30T11:30:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "title_is": "pexpect interfaces don't close logfile",
    "title_was": "computel.gp: \"unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed\"",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249696"
}
```



---

archive/issue_comments_238694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This crashes because the `Dokchitser` instances do not close the logfile:\n+This crashes because the `Dokchitser` instances are kept alive all the time.\n \n ```\n sage: for i in range(2000):\n``````\n",
    "created_at": "2015-01-31T09:38:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238694",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This crashes because the `Dokchitser` instances do not close the logfile:
+This crashes because the `Dokchitser` instances are kept alive all the time.
 
 ```
 sage: for i in range(2000):
``````




---

archive/issue_events_249697.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-31T09:38:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "title_is": "pexpect interfaces are never deleted",
    "title_was": "pexpect interfaces don't close logfile",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249697"
}
```



---

archive/issue_comments_238695.json:
```json
{
    "body": "Dependencies: **#17704**",
    "created_at": "2015-01-31T09:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238695",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#17704**



---

archive/issue_comments_238696.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8501bb16498e220d74685285c4adde3b3129a533\"><code>8501bb1</code></a></td><td><code>Clean up in expect.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/821151de14a55ccac635eaef4dadf861927a7df4\"><code>821151d</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>\n",
    "created_at": "2015-02-02T22:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238696",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8501bb16498e220d74685285c4adde3b3129a533"><code>8501bb1</code></a></td><td><code>Clean up in expect.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/821151de14a55ccac635eaef4dadf861927a7df4"><code>821151d</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>




---

archive/issue_comments_238697.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17686](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17686)**",
    "created_at": "2015-02-02T22:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238697",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17686](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17686)**



---

archive/issue_events_249698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-02T22:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249698"
}
```



---

archive/issue_comments_238698.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2015-02-02T22:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238698",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_238699.json:
```json
{
    "body": "Commit: **[`821151d`](https://github.com/sagemath/sagetrac-mirror/commit/821151de14a55ccac635eaef4dadf861927a7df4)**",
    "created_at": "2015-02-02T22:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238699",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`821151d`](https://github.com/sagemath/sagetrac-mirror/commit/821151de14a55ccac635eaef4dadf861927a7df4)**



---

archive/issue_comments_238700.json:
```json
{
    "body": "Changed commit from **[`821151d`](https://github.com/sagemath/sagetrac-mirror/commit/821151de14a55ccac635eaef4dadf861927a7df4)** to **[`012c62c`](https://github.com/sagemath/sagetrac-mirror/commit/012c62ce2cb9b5301859d083722d0ee01321bb64)**",
    "created_at": "2015-02-03T11:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238700",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`821151d`](https://github.com/sagemath/sagetrac-mirror/commit/821151de14a55ccac635eaef4dadf861927a7df4)** to **[`012c62c`](https://github.com/sagemath/sagetrac-mirror/commit/012c62ce2cb9b5301859d083722d0ee01321bb64)**



---

archive/issue_comments_238701.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de\"><code>d556229</code></a></td><td><code>Further clean-up of interfaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/012c62ce2cb9b5301859d083722d0ee01321bb64\"><code>012c62c</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>\n",
    "created_at": "2015-02-03T11:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238701",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de"><code>d556229</code></a></td><td><code>Further clean-up of interfaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/012c62ce2cb9b5301859d083722d0ee01321bb64"><code>012c62c</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>




---

archive/issue_comments_238702.json:
```json
{
    "body": "Changed dependencies from **#17704** to **#17704, #17718**",
    "created_at": "2015-02-03T11:31:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238702",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17704** to **#17704, #17718**



---

archive/issue_events_249699.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T16:20:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249699"
}
```



---

archive/issue_events_249700.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T16:20:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249700"
}
```



---

archive/issue_events_249701.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T16:20:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249701"
}
```



---

archive/issue_events_249702.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T16:20:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249702"
}
```



---

archive/issue_comments_238703.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWith #17718 merged:\n\n```\nsage -t --long src/sage/interfaces/sagespawn.pyx  # 2 doctests failed\nsage -t --long src/sage/interfaces/quit.py  # 1 doctest failed\n```",
    "created_at": "2015-02-25T16:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238703",
    "user": "https://github.com/rwst"
}
```

<div id="comment:10" align="right">comment:10</div>

With #17718 merged:

```
sage -t --long src/sage/interfaces/sagespawn.pyx  # 2 doctests failed
sage -t --long src/sage/interfaces/quit.py  # 1 doctest failed
```



---

archive/issue_comments_238704.json:
```json
{
    "body": "Changed commit from **[`012c62c`](https://github.com/sagemath/sagetrac-mirror/commit/012c62ce2cb9b5301859d083722d0ee01321bb64)** to **[`fede9b0`](https://github.com/sagemath/sagetrac-mirror/commit/fede9b02e6f6869461f147bef569a791394ec6b3)**",
    "created_at": "2015-02-25T17:13:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`012c62c`](https://github.com/sagemath/sagetrac-mirror/commit/012c62ce2cb9b5301859d083722d0ee01321bb64)** to **[`fede9b0`](https://github.com/sagemath/sagetrac-mirror/commit/fede9b02e6f6869461f147bef569a791394ec6b3)**



---

archive/issue_comments_238705.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0\"><code>c8d1a28</code></a></td><td><code>Revert interrupt change</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/815fbc66ee98d8448a493a38abf3ab3b1e0e34ae\"><code>815fbc6</code></a></td><td><code>Merge commit 'c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0' into t/17686/ticket/17686</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47646e9be6048ea51faa4df4ad21f981d3924d8d\"><code>47646e9</code></a></td><td><code>Merge remote-tracking branch 'origin/develop' into t/17686/ticket/17686</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fede9b02e6f6869461f147bef569a791394ec6b3\"><code>fede9b0</code></a></td><td><code>Fix doctest for GP</code></td></tr></table>\n",
    "created_at": "2015-02-25T17:13:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238705",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0"><code>c8d1a28</code></a></td><td><code>Revert interrupt change</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/815fbc66ee98d8448a493a38abf3ab3b1e0e34ae"><code>815fbc6</code></a></td><td><code>Merge commit 'c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0' into t/17686/ticket/17686</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47646e9be6048ea51faa4df4ad21f981d3924d8d"><code>47646e9</code></a></td><td><code>Merge remote-tracking branch 'origin/develop' into t/17686/ticket/17686</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fede9b02e6f6869461f147bef569a791394ec6b3"><code>fede9b0</code></a></td><td><code>Fix doctest for GP</code></td></tr></table>




---

archive/issue_events_249703.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-25T17:14:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249703"
}
```



---

archive/issue_events_249704.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-25T17:14:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249704"
}
```



---

archive/issue_comments_238706.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nMerged #17718 and latest `develop`. I also trivially fixed the `quit.py` failure but I don't get any failures in `sagespawn.pyx`. Can you try again and post the details of the failure if they still occur?",
    "created_at": "2015-02-25T17:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238706",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Merged #17718 and latest `develop`. I also trivially fixed the `quit.py` failure but I don't get any failures in `sagespawn.pyx`. Can you try again and post the details of the failure if they still occur?



---

archive/issue_comments_238707.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nYes, `quit.py` is fine but I still get this twice:\n\n```\nFile \"src/sage/interfaces/sagespawn.pyx\", line 69, in sage.interfaces.sagespawn.SageSpawn.__repr__\nFailed example:\n    s  # indirect doctest\nExpected:\n    stupid process with PID ... running /bin/true\nGot:\n    stupid process with PID 3742 running /usr/bin/true\n```",
    "created_at": "2015-02-26T06:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238707",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">comment:13</div>

Yes, `quit.py` is fine but I still get this twice:

```
File "src/sage/interfaces/sagespawn.pyx", line 69, in sage.interfaces.sagespawn.SageSpawn.__repr__
Failed example:
    s  # indirect doctest
Expected:
    stupid process with PID ... running /bin/true
Got:
    stupid process with PID 3742 running /usr/bin/true
```



---

archive/issue_comments_238708.json:
```json
{
    "body": "Changed commit from **[`fede9b0`](https://github.com/sagemath/sagetrac-mirror/commit/fede9b02e6f6869461f147bef569a791394ec6b3)** to **[`76c99e9`](https://github.com/sagemath/sagetrac-mirror/commit/76c99e99410d2f43d1c3bfbcbf6d44c09510d20d)**",
    "created_at": "2015-02-26T08:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238708",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fede9b0`](https://github.com/sagemath/sagetrac-mirror/commit/fede9b02e6f6869461f147bef569a791394ec6b3)** to **[`76c99e9`](https://github.com/sagemath/sagetrac-mirror/commit/76c99e99410d2f43d1c3bfbcbf6d44c09510d20d)**



---

archive/issue_comments_238709.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76c99e99410d2f43d1c3bfbcbf6d44c09510d20d\"><code>76c99e9</code></a></td><td><code>Don't put full path to \"true\" in doctest</code></td></tr></table>\n",
    "created_at": "2015-02-26T08:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238709",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76c99e99410d2f43d1c3bfbcbf6d44c09510d20d"><code>76c99e9</code></a></td><td><code>Don't put full path to "true" in doctest</code></td></tr></table>




---

archive/issue_comments_238710.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nPatchbot says tests are fine, whines about startup time, but on my machine there is no change. My Unix programming doesn't suffice for a code review, however.",
    "created_at": "2015-02-28T14:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238710",
    "user": "https://github.com/rwst"
}
```

<div id="comment:15" align="right">comment:15</div>

Patchbot says tests are fine, whines about startup time, but on my machine there is no change. My Unix programming doesn't suffice for a code review, however.



---

archive/issue_comments_238711.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b3c7f55cc79f9654ffc62058ebda120f5db5b2d\"><code>0b3c7f5</code></a></td><td><code>Merge tag '6.6.beta2' into t/17686/ticket/17686</code></td></tr></table>\n",
    "created_at": "2015-03-02T14:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238711",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b3c7f55cc79f9654ffc62058ebda120f5db5b2d"><code>0b3c7f5</code></a></td><td><code>Merge tag '6.6.beta2' into t/17686/ticket/17686</code></td></tr></table>




---

archive/issue_comments_238712.json:
```json
{
    "body": "Changed commit from **[`76c99e9`](https://github.com/sagemath/sagetrac-mirror/commit/76c99e99410d2f43d1c3bfbcbf6d44c09510d20d)** to **[`0b3c7f5`](https://github.com/sagemath/sagetrac-mirror/commit/0b3c7f55cc79f9654ffc62058ebda120f5db5b2d)**",
    "created_at": "2015-03-02T14:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238712",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`76c99e9`](https://github.com/sagemath/sagetrac-mirror/commit/76c99e99410d2f43d1c3bfbcbf6d44c09510d20d)** to **[`0b3c7f5`](https://github.com/sagemath/sagetrac-mirror/commit/0b3c7f55cc79f9654ffc62058ebda120f5db5b2d)**



---

archive/issue_comments_238713.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\ndoesn't merge cleanly againts the latest 6.7.beta4:\n\n```\nCONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst\n```\ncan this be rebased?",
    "created_at": "2015-05-07T09:28:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238713",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

doesn't merge cleanly againts the latest 6.7.beta4:

```
CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst
```
can this be rebased?



---

archive/issue_comments_238714.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment%3A17):\n> doesn't merge cleanly againts the latest 6.7.beta4:\n> \n> ```\n> CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst\n> ```\n> can this be rebased?\n\nWill it be reviewed then?",
    "created_at": "2015-05-07T09:39:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238714",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment%3A17):
> doesn't merge cleanly againts the latest 6.7.beta4:
> 
> ```
> CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst
> ```
> can this be rebased?

Will it be reviewed then?



---

archive/issue_comments_238715.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment%3A18):\n> Replying to [@dimpase](#comment%3A17):\n> > doesn't merge cleanly againts the latest 6.7.beta4:\n> > \n> > ```\n> > CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst\n> > ```\n> > can this be rebased?\n> \n> Will it be reviewed then?\n\nI will do my best.",
    "created_at": "2015-05-07T09:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238715",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment%3A18):
> Replying to [@dimpase](#comment%3A17):
> > doesn't merge cleanly againts the latest 6.7.beta4:
> > 
> > ```
> > CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst
> > ```
> > can this be rebased?
> 
> Will it be reviewed then?

I will do my best.



---

archive/issue_comments_238716.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/864d55aca034b59c2b3e2817ff5c1394dbed5658\"><code>864d55a</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>\n",
    "created_at": "2015-05-08T08:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238716",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/864d55aca034b59c2b3e2817ff5c1394dbed5658"><code>864d55a</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>




---

archive/issue_comments_238717.json:
```json
{
    "body": "Changed commit from **[`0b3c7f5`](https://github.com/sagemath/sagetrac-mirror/commit/0b3c7f55cc79f9654ffc62058ebda120f5db5b2d)** to **[`864d55a`](https://github.com/sagemath/sagetrac-mirror/commit/864d55aca034b59c2b3e2817ff5c1394dbed5658)**",
    "created_at": "2015-05-08T08:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238717",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b3c7f5`](https://github.com/sagemath/sagetrac-mirror/commit/0b3c7f55cc79f9654ffc62058ebda120f5db5b2d)** to **[`864d55a`](https://github.com/sagemath/sagetrac-mirror/commit/864d55aca034b59c2b3e2817ff5c1394dbed5658)**



---

archive/issue_comments_238718.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWhy is `SageSpawn` written in Cython? Reading over it, I couldn't find a reason, which probably just means I missed it.",
    "created_at": "2015-05-21T08:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238718",
    "user": "https://github.com/malb"
}
```

<div id="comment:21" align="right">comment:21</div>

Why is `SageSpawn` written in Cython? Reading over it, I couldn't find a reason, which probably just means I missed it.



---

archive/issue_comments_238719.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@malb](#comment%3A21):\n> Why is `SageSpawn` written in Cython?\n\n1. it uses various system calls (of course, you could argue about using Python's `os` module but I think directly using system calls is better).\n2. it needs `Py_INCREF()` which cannot be done in pure Python.",
    "created_at": "2015-05-21T09:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238719",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@malb](#comment%3A21):
> Why is `SageSpawn` written in Cython?

1. it uses various system calls (of course, you could argue about using Python's `os` module but I think directly using system calls is better).
2. it needs `Py_INCREF()` which cannot be done in pure Python.



---

archive/issue_comments_238720.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThanks for explaining, that makes sense.",
    "created_at": "2015-05-21T10:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238720",
    "user": "https://github.com/malb"
}
```

<div id="comment:23" align="right">comment:23</div>

Thanks for explaining, that makes sense.



---

archive/issue_comments_238721.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4810d72d22055cd2655f6e559e9fbdbe4d6b470e\"><code>4810d72</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>\n",
    "created_at": "2015-05-27T08:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238721",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4810d72d22055cd2655f6e559e9fbdbe4d6b470e"><code>4810d72</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>




---

archive/issue_comments_238722.json:
```json
{
    "body": "Changed commit from **[`864d55a`](https://github.com/sagemath/sagetrac-mirror/commit/864d55aca034b59c2b3e2817ff5c1394dbed5658)** to **[`4810d72`](https://github.com/sagemath/sagetrac-mirror/commit/4810d72d22055cd2655f6e559e9fbdbe4d6b470e)**",
    "created_at": "2015-05-27T08:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238722",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`864d55a`](https://github.com/sagemath/sagetrac-mirror/commit/864d55aca034b59c2b3e2817ff5c1394dbed5658)** to **[`4810d72`](https://github.com/sagemath/sagetrac-mirror/commit/4810d72d22055cd2655f6e559e9fbdbe4d6b470e)**



---

archive/issue_comments_238723.json:
```json
{
    "body": "Changed dependencies from **#17704, #17718** to none",
    "created_at": "2015-05-27T08:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238723",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17704, #17718** to none



---

archive/issue_comments_238724.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08e422aaabf904356b4d53e68cf30f033a57585e\"><code>08e422a</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>\n",
    "created_at": "2015-05-29T20:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238724",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08e422aaabf904356b4d53e68cf30f033a57585e"><code>08e422a</code></a></td><td><code>Implement proper kill-on-del for pexpect</code></td></tr></table>




---

archive/issue_comments_238725.json:
```json
{
    "body": "Changed commit from **[`4810d72`](https://github.com/sagemath/sagetrac-mirror/commit/4810d72d22055cd2655f6e559e9fbdbe4d6b470e)** to **[`08e422a`](https://github.com/sagemath/sagetrac-mirror/commit/08e422aaabf904356b4d53e68cf30f033a57585e)**",
    "created_at": "2015-05-29T20:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238725",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4810d72`](https://github.com/sagemath/sagetrac-mirror/commit/4810d72d22055cd2655f6e559e9fbdbe4d6b470e)** to **[`08e422a`](https://github.com/sagemath/sagetrac-mirror/commit/08e422aaabf904356b4d53e68cf30f033a57585e)**



---

archive/issue_comments_238726.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThe original spawn class checks `self.closed` in the dtor:\n\n```\n    def __del__(self):\n        if self.closed:\n            return\n        try:\n            self.close()\n        except:\n            pass\n```\nSo why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?",
    "created_at": "2015-06-17T12:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238726",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">comment:27</div>

The original spawn class checks `self.closed` in the dtor:

```
    def __del__(self):
        if self.closed:
            return
        try:
            self.close()
        except:
            pass
```
So why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?



---

archive/issue_comments_238727.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@vbraun](#comment%3A27):\n> So why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?\n\n`Py_INCREF(self)` makes no assumptions on how `pexpect.spawn` works internally. Setting `self.closed` would work currently, but it would for example break with a newer version of `pexpect`.",
    "created_at": "2015-06-17T12:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238727",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@vbraun](#comment%3A27):
> So why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?

`Py_INCREF(self)` makes no assumptions on how `pexpect.spawn` works internally. Setting `self.closed` would work currently, but it would for example break with a newer version of `pexpect`.



---

archive/issue_comments_238728.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2015-06-17T17:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238728",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_249705.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-17T17:36:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249705"
}
```



---

archive/issue_events_249706.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-17T17:36:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249706"
}
```



---

archive/issue_comments_238729.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nFails on OSX:\n\n```\nsage -t --long src/sage/interfaces/expect.py  # 26 doctests failed\nsage -t --long src/sage/interfaces/gap.py  # 95 doctests failed\nsage -t --long src/sage/interfaces/mwrank.py  # 6 doctests failed\n```",
    "created_at": "2015-06-17T20:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238729",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:30" align="right">comment:30</div>

Fails on OSX:

```
sage -t --long src/sage/interfaces/expect.py  # 26 doctests failed
sage -t --long src/sage/interfaces/gap.py  # 95 doctests failed
sage -t --long src/sage/interfaces/mwrank.py  # 6 doctests failed
```



---

archive/issue_events_249707.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-17T20:08:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249707"
}
```



---

archive/issue_events_249708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-17T20:08:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249708"
}
```



---

archive/issue_comments_238730.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe\"><code>15e42fe</code></a></td><td><code>Wrap sendline() in try/except</code></td></tr></table>\n",
    "created_at": "2015-06-18T08:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238730",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe"><code>15e42fe</code></a></td><td><code>Wrap sendline() in try/except</code></td></tr></table>




---

archive/issue_comments_238731.json:
```json
{
    "body": "Changed commit from **[`08e422a`](https://github.com/sagemath/sagetrac-mirror/commit/08e422aaabf904356b4d53e68cf30f033a57585e)** to **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)**",
    "created_at": "2015-06-18T08:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238731",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`08e422a`](https://github.com/sagemath/sagetrac-mirror/commit/08e422aaabf904356b4d53e68cf30f033a57585e)** to **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)**



---

archive/issue_events_249709.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-18T08:51:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249709"
}
```



---

archive/issue_events_249710.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-18T08:51:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249710"
}
```



---

archive/issue_events_249711.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-18T14:07:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249711"
}
```



---

archive/issue_events_249712.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-18T14:07:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249712"
}
```



---

archive/issue_comments_238732.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI got this (with #17924, only randomly fails)\n\n```\nsage -t --long src/sage/interfaces/sagespawn.pyx\n**********************************************************************\nFile \"src/sage/interfaces/sagespawn.pyx\", line 125, in sage.interfaces.sagespawn.SageSpawn.close\nFailed example:\n    while s.isalive():  # long time (5 seconds)\n        sleep(0.1)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.sagespawn.SageSpawn.close[3]>\", line 1, in <module>\n        while s.isalive():  # long time (5 seconds)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect.py\", line 762, in isalive\n        pid, status = os.waitpid(self.pid, waitpid_options)\n      File \"sage/ext/interrupt/interrupt.pyx\", line 197, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:1743)\n        sig_check()\n      File \"sage/ext/interrupt/interrupt.pyx\", line 86, in sage.ext.interrupt.interrupt.sig_raise_exception (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:884)\n        raise KeyboardInterrupt\n    KeyboardInterrupt\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.interfaces.sagespawn.SageSpawn.close\n    [24 tests, 1 failure, 5.08 s]\n```",
    "created_at": "2015-06-18T20:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238732",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

I got this (with #17924, only randomly fails)

```
sage -t --long src/sage/interfaces/sagespawn.pyx
**********************************************************************
File "src/sage/interfaces/sagespawn.pyx", line 125, in sage.interfaces.sagespawn.SageSpawn.close
Failed example:
    while s.isalive():  # long time (5 seconds)
        sleep(0.1)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.sagespawn.SageSpawn.close[3]>", line 1, in <module>
        while s.isalive():  # long time (5 seconds)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect.py", line 762, in isalive
        pid, status = os.waitpid(self.pid, waitpid_options)
      File "sage/ext/interrupt/interrupt.pyx", line 197, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:1743)
        sig_check()
      File "sage/ext/interrupt/interrupt.pyx", line 86, in sage.ext.interrupt.interrupt.sig_raise_exception (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:884)
        raise KeyboardInterrupt
    KeyboardInterrupt
**********************************************************************
1 item had failures:
   1 of   5 in sage.interfaces.sagespawn.SageSpawn.close
    [24 tests, 1 failure, 5.08 s]
```



---

archive/issue_comments_238733.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@vbraun](#comment%3A34):\n> I got this (with #17924, only randomly fails)\n\nOn which machine?\n\nThis is probably yet another race condition: it looks like we are killing the process group of the child process when it has not yet created a new process group. So, we end up killing ourselves.",
    "created_at": "2015-06-19T08:03:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238733",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@vbraun](#comment%3A34):
> I got this (with #17924, only randomly fails)

On which machine?

This is probably yet another race condition: it looks like we are killing the process group of the child process when it has not yet created a new process group. So, we end up killing ourselves.



---

archive/issue_comments_238734.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThat was on arando. I'm going to close this ticket and leave the remaining race to you, then ;-)",
    "created_at": "2015-06-19T08:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238734",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:36" align="right">comment:36</div>

That was on arando. I'm going to close this ticket and leave the remaining race to you, then ;-)



---

archive/issue_comments_238735.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17686](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17686)** to **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)**",
    "created_at": "2015-06-19T08:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238735",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17686](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17686)** to **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)**



---

archive/issue_events_249713.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-19T08:25:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249713"
}
```



---

archive/issue_events_249714.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "17a174f9c6ca6ee442fe39a070bb1551cc46b1ff",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-19T08:25:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17686#event-249714"
}
```



---

archive/issue_comments_238736.json:
```json
{
    "body": "Changed commit from **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)** to none",
    "created_at": "2015-06-19T22:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238736",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`15e42fe`](https://github.com/sagemath/sagetrac-mirror/commit/15e42feddfb154b9bf229b6bccf43d4604158dbe)** to none



---

archive/issue_comments_238737.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nFollowup at #18741",
    "created_at": "2015-06-19T22:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17686#issuecomment-238737",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:38" align="right">comment:38</div>

Followup at #18741
