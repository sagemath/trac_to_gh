# Issue 17890: Remove _(rich)cmp_c_impl

archive/issues_017653.json:
```json
{
    "assignees": [],
    "body": "Instead of\n\n```\n    def _cmp_(left, right)\n    cdef int _cmp_c_impl(left, right) except -2\n```\nwe should have\n\n```\n    cpdef int _cmp_(left, right) except -2\n```\n\nAnalogously for `_richcmp_`.\n\nThere is one important functional change: If a Python class defines both `__cmp__` and `_cmp_`, then formerly the coercion framework would use `__cmp__` by default to implement relational operators like `>=`. After this ticket, `_cmp_` will be tried first, which defaults to `__cmp__`.\n\nCC:  @dkrenn\n\nBranch/Commit: **[`3976f2c`](https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **cython**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17890_\n\n",
    "closed_at": "2015-04-29T03:13:44Z",
    "created_at": "2015-03-03T09:34:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove _(rich)cmp_c_impl",
    "type": "issue",
    "updated_at": "2015-04-29T03:13:44Z",
    "url": "https://github.com/sagemath/sage/issues/17890",
    "user": "https://github.com/jdemeyer"
}
```
Instead of

```
    def _cmp_(left, right)
    cdef int _cmp_c_impl(left, right) except -2
```
we should have

```
    cpdef int _cmp_(left, right) except -2
```

Analogously for `_richcmp_`.

There is one important functional change: If a Python class defines both `__cmp__` and `_cmp_`, then formerly the coercion framework would use `__cmp__` by default to implement relational operators like `>=`. After this ticket, `_cmp_` will be tried first, which defaults to `__cmp__`.

CC:  @dkrenn

Branch/Commit: **[`3976f2c`](https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef)**

Reviewer: **Vincent Delecroix**

Author: **Jeroen Demeyer**

Component: **cython**

_Issue created by migration from https://trac.sagemath.org/ticket/17890_





---

archive/issue_events_255764.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-03T09:34:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255764"
}
```



---

archive/issue_events_255765.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-03T09:34:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "000080",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255765"
}
```



---

archive/issue_events_255766.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-03T09:34:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255766"
}
```



---

archive/issue_events_255767.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-03T09:34:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255767"
}
```



---

archive/issue_comments_242113.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,5 @@\n ```\n     cpdef int _cmp_(left, right) except -2\n ```\n+\n+Analogously for `_richcmp_`.\n``````\n",
    "created_at": "2015-03-03T09:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242113",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,5 @@
 ```
     cpdef int _cmp_(left, right) except -2
 ```
+
+Analogously for `_richcmp_`.
``````




---

archive/issue_events_255768.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-03T09:53:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "title_is": "Remove _(rich)cmp_c_impl",
    "title_was": "Remove _cmp_c_impl",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255768"
}
```



---

archive/issue_comments_242114.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,5 @@\n ```\n \n Analogously for `_richcmp_`.\n+\n+Except for the changes `src/sage/structure/*`, this is essentially just a search-and-replace-all operation.\n``````\n",
    "created_at": "2015-03-03T09:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242114",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,5 @@
 ```
 
 Analogously for `_richcmp_`.
+
+Except for the changes `src/sage/structure/*`, this is essentially just a search-and-replace-all operation.
``````




---

archive/issue_comments_242115.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,3 @@\n ```\n \n Analogously for `_richcmp_`.\n-\n-Except for the changes `src/sage/structure/*`, this is essentially just a search-and-replace-all operation.\n``````\n",
    "created_at": "2015-03-03T14:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242115",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,3 @@
 ```
 
 Analogously for `_richcmp_`.
-
-Except for the changes `src/sage/structure/*`, this is essentially just a search-and-replace-all operation.
``````




---

archive/issue_comments_242116.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17890](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17890)**",
    "created_at": "2015-03-03T22:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242116",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17890](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17890)**



---

archive/issue_comments_242117.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7083f19ecfc83426442aa98c78d50c520337e82e\"><code>7083f19</code></a></td><td><code>Remove use of PY_IS_NUMERIC</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7eb0e93b6c74b1e64d11a7ea1ac7fd1cb4c56aa6\"><code>7eb0e93</code></a></td><td><code>Move py_scalar_to_element to coerce.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8300f591ae2987e01d609e856d38758b28c6bf42\"><code>8300f59</code></a></td><td><code>trac #17862 (review): doc typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3ea57f12a7063954d9afac9c3cd3ff9ff93430a\"><code>a3ea57f</code></a></td><td><code>Merge tag '6.6.beta2' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a830cc93c6bb07565db709bfe03f8acc62034dbb\"><code>a830cc9</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>\n",
    "created_at": "2015-03-03T22:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242117",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7083f19ecfc83426442aa98c78d50c520337e82e"><code>7083f19</code></a></td><td><code>Remove use of PY_IS_NUMERIC</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7eb0e93b6c74b1e64d11a7ea1ac7fd1cb4c56aa6"><code>7eb0e93</code></a></td><td><code>Move py_scalar_to_element to coerce.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8300f591ae2987e01d609e856d38758b28c6bf42"><code>8300f59</code></a></td><td><code>trac #17862 (review): doc typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3ea57f12a7063954d9afac9c3cd3ff9ff93430a"><code>a3ea57f</code></a></td><td><code>Merge tag '6.6.beta2' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a830cc93c6bb07565db709bfe03f8acc62034dbb"><code>a830cc9</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>




---

archive/issue_comments_242118.json:
```json
{
    "body": "Commit: **[`a830cc9`](https://github.com/sagemath/sagetrac-mirror/commit/a830cc93c6bb07565db709bfe03f8acc62034dbb)**",
    "created_at": "2015-03-03T22:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242118",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`a830cc9`](https://github.com/sagemath/sagetrac-mirror/commit/a830cc93c6bb07565db709bfe03f8acc62034dbb)**



---

archive/issue_comments_242119.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,5 @@\n ```\n \n Analogously for `_richcmp_`.\n+\n+Attached branch passes all doctests, but is somewhat slower than before.\n``````\n",
    "created_at": "2015-03-03T22:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242119",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,5 @@
 ```
 
 Analogously for `_richcmp_`.
+
+Attached branch passes all doctests, but is somewhat slower than before.
``````




---

archive/issue_comments_242120.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIf it is slower this is very bad. Do you know why? Isn't a `cdef` function call equivalent to `cpdef` function call?\n\nVincent",
    "created_at": "2015-03-04T09:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242120",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

If it is slower this is very bad. Do you know why? Isn't a `cdef` function call equivalent to `cpdef` function call?

Vincent



---

archive/issue_comments_242121.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@videlec](#comment:6):\n> If it is slower this is very bad. Do you know why?\n\nYes, see [https://groups.google.com/forum/#!topic/sage-devel/AXYk1uEfuPE](https://groups.google.com/forum/#!topic/sage-devel/AXYk1uEfuPE)",
    "created_at": "2015-03-04T11:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242121",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@videlec](#comment:6):
> If it is slower this is very bad. Do you know why?

Yes, see [https://groups.google.com/forum/#!topic/sage-devel/AXYk1uEfuPE](https://groups.google.com/forum/#!topic/sage-devel/AXYk1uEfuPE)



---

archive/issue_comments_242122.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nRelated: #10130.",
    "created_at": "2015-03-04T15:52:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242122",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:8" align="right">comment:8</div>

Related: #10130.



---

archive/issue_comments_242123.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25e517fc735d15ba07c919f7a65103cf04acd2cf\"><code>25e517f</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>\n",
    "created_at": "2015-03-04T16:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242123",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25e517fc735d15ba07c919f7a65103cf04acd2cf"><code>25e517f</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>




---

archive/issue_comments_242124.json:
```json
{
    "body": "Changed commit from **[`a830cc9`](https://github.com/sagemath/sagetrac-mirror/commit/a830cc93c6bb07565db709bfe03f8acc62034dbb)** to **[`25e517f`](https://github.com/sagemath/sagetrac-mirror/commit/25e517fc735d15ba07c919f7a65103cf04acd2cf)**",
    "created_at": "2015-03-04T16:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242124",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a830cc9`](https://github.com/sagemath/sagetrac-mirror/commit/a830cc93c6bb07565db709bfe03f8acc62034dbb)** to **[`25e517f`](https://github.com/sagemath/sagetrac-mirror/commit/25e517fc735d15ba07c919f7a65103cf04acd2cf)**



---

archive/issue_comments_242125.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n \n Analogously for `_richcmp_`.\n \n-Attached branch passes all doctests, but is somewhat slower than before.\n+There is one important functional change: If a Python class defines both `__cmp__` and `_cmp_`, then formerly the coercion framework would use `__cmp__` by default to implement relational operators like `>=`. After this ticket, `_cmp_` will be tried first, which defaults to `__cmp__`.\n``````\n",
    "created_at": "2015-03-04T16:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242125",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 
 Analogously for `_richcmp_`.
 
-Attached branch passes all doctests, but is somewhat slower than before.
+There is one important functional change: If a Python class defines both `__cmp__` and `_cmp_`, then formerly the coercion framework would use `__cmp__` by default to implement relational operators like `>=`. After this ticket, `_cmp_` will be tried first, which defaults to `__cmp__`.
``````




---

archive/issue_comments_242126.json:
```json
{
    "body": "Dependencies: **#17862**",
    "created_at": "2015-03-04T16:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242126",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#17862**



---

archive/issue_comments_242127.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41f7cd14911ed5fde23731c2c78f235e481258e6\"><code>41f7cd1</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>\n",
    "created_at": "2015-03-05T10:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242127",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41f7cd14911ed5fde23731c2c78f235e481258e6"><code>41f7cd1</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>




---

archive/issue_comments_242128.json:
```json
{
    "body": "Changed commit from **[`25e517f`](https://github.com/sagemath/sagetrac-mirror/commit/25e517fc735d15ba07c919f7a65103cf04acd2cf)** to **[`41f7cd1`](https://github.com/sagemath/sagetrac-mirror/commit/41f7cd14911ed5fde23731c2c78f235e481258e6)**",
    "created_at": "2015-03-05T10:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242128",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`25e517f`](https://github.com/sagemath/sagetrac-mirror/commit/25e517fc735d15ba07c919f7a65103cf04acd2cf)** to **[`41f7cd1`](https://github.com/sagemath/sagetrac-mirror/commit/41f7cd14911ed5fde23731c2c78f235e481258e6)**



---

archive/issue_events_255769.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-05T10:49:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255769"
}
```



---

archive/issue_comments_242129.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nSee also #16537",
    "created_at": "2015-03-06T07:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242129",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

See also #16537



---

archive/issue_comments_242130.json:
```json
{
    "body": "Changed commit from **[`41f7cd1`](https://github.com/sagemath/sagetrac-mirror/commit/41f7cd14911ed5fde23731c2c78f235e481258e6)** to **[`d26954c`](https://github.com/sagemath/sagetrac-mirror/commit/d26954c093a671139347c65ee7772b79e9a02783)**",
    "created_at": "2015-03-06T08:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242130",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`41f7cd1`](https://github.com/sagemath/sagetrac-mirror/commit/41f7cd14911ed5fde23731c2c78f235e481258e6)** to **[`d26954c`](https://github.com/sagemath/sagetrac-mirror/commit/d26954c093a671139347c65ee7772b79e9a02783)**



---

archive/issue_comments_242131.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d26954c093a671139347c65ee7772b79e9a02783\"><code>d26954c</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>\n",
    "created_at": "2015-03-06T08:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242131",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d26954c093a671139347c65ee7772b79e9a02783"><code>d26954c</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>




---

archive/issue_comments_242132.json:
```json
{
    "body": "Changed dependencies from **#17862** to none",
    "created_at": "2015-03-06T08:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242132",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17862** to none



---

archive/issue_comments_242133.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea13fd01a8a37ce5d6d42e58d6c5f047250d3f38\"><code>ea13fd0</code></a></td><td><code>Merge tag '6.6.beta5' into t/17890/ticket/17890</code></td></tr></table>\n",
    "created_at": "2015-03-13T17:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242133",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea13fd01a8a37ce5d6d42e58d6c5f047250d3f38"><code>ea13fd0</code></a></td><td><code>Merge tag '6.6.beta5' into t/17890/ticket/17890</code></td></tr></table>




---

archive/issue_comments_242134.json:
```json
{
    "body": "Changed commit from **[`d26954c`](https://github.com/sagemath/sagetrac-mirror/commit/d26954c093a671139347c65ee7772b79e9a02783)** to **[`ea13fd0`](https://github.com/sagemath/sagetrac-mirror/commit/ea13fd01a8a37ce5d6d42e58d6c5f047250d3f38)**",
    "created_at": "2015-03-13T17:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242134",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d26954c`](https://github.com/sagemath/sagetrac-mirror/commit/d26954c093a671139347c65ee7772b79e9a02783)** to **[`ea13fd0`](https://github.com/sagemath/sagetrac-mirror/commit/ea13fd01a8a37ce5d6d42e58d6c5f047250d3f38)**



---

archive/issue_comments_242135.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26\"><code>a7cbb88</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>\n",
    "created_at": "2015-04-16T09:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242135",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26"><code>a7cbb88</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr></table>




---

archive/issue_comments_242136.json:
```json
{
    "body": "Changed commit from **[`ea13fd0`](https://github.com/sagemath/sagetrac-mirror/commit/ea13fd01a8a37ce5d6d42e58d6c5f047250d3f38)** to **[`a7cbb88`](https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26)**",
    "created_at": "2015-04-16T09:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242136",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ea13fd0`](https://github.com/sagemath/sagetrac-mirror/commit/ea13fd01a8a37ce5d6d42e58d6c5f047250d3f38)** to **[`a7cbb88`](https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26)**



---

archive/issue_events_255770.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T14:28:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255770"
}
```



---

archive/issue_events_255771.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T14:28:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255771"
}
```



---

archive/issue_comments_242137.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n## sage.structure.element\n\n1. In the documentation of `sage.structure.element` emphasize what should be done for Python classes as well (and the potential difference between Python and Cython). It is not very clear to me! What I understood is that we should:\n   - implement `__cmp__(left,right)` or/and `_richcmp_(left,right,op)`\n   - avoid `__eq__`, `__ne__`, etc\n\n2. What about putting\n\n```\n# Obvious case\nif left is right:\n    return _rich_to_bool(op, 0)\n```\n  directly in `__richcmp__`?\n\n## sage.structure.parent\n\n3. The default comparison for parents is by id which is natural (and I guess what Python does). But the default hash is not based on id and is the stupid one inherited from `SageObject`. Is there a reason?\n\n4. Why not using `_rich_to_bool` in `parent.pyx` instead of\n\n```\nif op == 0:  #< \n    return r  < 0\nelif op == 2: #==\n    return r == 0 \nelif op == 4: #>\n    return r  > 0\nelif op == 1: #<=\n    return r <= 0\nelif op == 3: #!=\n    return r != 0\nelif op == 5: #>=\n    return r >= 0 \n```\n  And by the way, why is there a method `cdef _rich_to_bool` on element? it would be useful as a standalone function in other places.",
    "created_at": "2015-04-25T14:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242137",
    "user": "https://github.com/videlec"
}
```

<div id="comment:20" align="right">comment:20</div>

## sage.structure.element

1. In the documentation of `sage.structure.element` emphasize what should be done for Python classes as well (and the potential difference between Python and Cython). It is not very clear to me! What I understood is that we should:
   - implement `__cmp__(left,right)` or/and `_richcmp_(left,right,op)`
   - avoid `__eq__`, `__ne__`, etc

2. What about putting

```
# Obvious case
if left is right:
    return _rich_to_bool(op, 0)
```
  directly in `__richcmp__`?

## sage.structure.parent

3. The default comparison for parents is by id which is natural (and I guess what Python does). But the default hash is not based on id and is the stupid one inherited from `SageObject`. Is there a reason?

4. Why not using `_rich_to_bool` in `parent.pyx` instead of

```
if op == 0:  #< 
    return r  < 0
elif op == 2: #==
    return r == 0 
elif op == 4: #>
    return r  > 0
elif op == 1: #<=
    return r <= 0
elif op == 3: #!=
    return r != 0
elif op == 5: #>=
    return r >= 0 
```
  And by the way, why is there a method `cdef _rich_to_bool` on element? it would be useful as a standalone function in other places.



---

archive/issue_comments_242138.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@videlec](#comment:20):\n> ## sage.structure.element\n> \n> 1. In the documentation of `sage.structure.element` emphasize what should be done for Python classes as well (and the potential difference between Python and Cython). It is not very clear to me!\n\nUnfortunately, it is not very clear to me either. In particular, I don't find good Python documentation about the interaction between `__cmp__`, rich comparisons like `__eq__` and `__hash__` and what Python does when you call `cmp(x,y)`. It seems that `cmp(x,y)` only calls `x.__cmp__(y)` when `x` and `y` have the same type, but I don't find this anywhere documented. And I know that inheritance works in a strange way for comparisons, but I also don't quite know how.",
    "created_at": "2015-04-25T15:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242138",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@videlec](#comment:20):
> ## sage.structure.element
> 
> 1. In the documentation of `sage.structure.element` emphasize what should be done for Python classes as well (and the potential difference between Python and Cython). It is not very clear to me!

Unfortunately, it is not very clear to me either. In particular, I don't find good Python documentation about the interaction between `__cmp__`, rich comparisons like `__eq__` and `__hash__` and what Python does when you call `cmp(x,y)`. It seems that `cmp(x,y)` only calls `x.__cmp__(y)` when `x` and `y` have the same type, but I don't find this anywhere documented. And I know that inheritance works in a strange way for comparisons, but I also don't quite know how.



---

archive/issue_comments_242139.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@videlec](#comment:20):\n> 2. What about putting\n> \n> ```\n> # Obvious case\n> if left is right:\n>     return _rich_to_bool(op, 0)\n> ```\n>   directly in `__richcmp__`?\n\nBecause `__richcmp__` should absolutely be as simple as possible. Don't forget that *every subclass* needs a `__richcmp__` method (because of Python's strange inheritance rules regarding comparison).",
    "created_at": "2015-04-25T15:40:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242139",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@videlec](#comment:20):
> 2. What about putting
> 
> ```
> # Obvious case
> if left is right:
>     return _rich_to_bool(op, 0)
> ```
>   directly in `__richcmp__`?

Because `__richcmp__` should absolutely be as simple as possible. Don't forget that *every subclass* needs a `__richcmp__` method (because of Python's strange inheritance rules regarding comparison).



---

archive/issue_comments_242140.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@videlec](#comment:20):\n> 3. The default comparison for parents is by id which is natural (and I guess what Python does). But the default hash is not based on id and is the stupid one inherited from `SageObject`. Is there a reason?\n\nI don't know. This ticket doesn't change anything to hashing, so I consider this outside the scope of this ticket (but you might have a point though).",
    "created_at": "2015-04-25T15:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242140",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@videlec](#comment:20):
> 3. The default comparison for parents is by id which is natural (and I guess what Python does). But the default hash is not based on id and is the stupid one inherited from `SageObject`. Is there a reason?

I don't know. This ticket doesn't change anything to hashing, so I consider this outside the scope of this ticket (but you might have a point though).



---

archive/issue_comments_242141.json:
```json
{
    "body": "Changed commit from **[`a7cbb88`](https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26)** to **[`1ad339b`](https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d)**",
    "created_at": "2015-04-25T20:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242141",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a7cbb88`](https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26)** to **[`1ad339b`](https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d)**



---

archive/issue_comments_242142.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b48fec116a29a3449c816bcf392ce3d07e72667\"><code>9b48fec</code></a></td><td><code>Doctest .pxd files also</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d\"><code>1ad339b</code></a></td><td><code>Implement _rich_to_bool as inline function instead of member function</code></td></tr></table>\n",
    "created_at": "2015-04-25T20:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242142",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b48fec116a29a3449c816bcf392ce3d07e72667"><code>9b48fec</code></a></td><td><code>Doctest .pxd files also</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d"><code>1ad339b</code></a></td><td><code>Implement _rich_to_bool as inline function instead of member function</code></td></tr></table>




---

archive/issue_comments_242143.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba\"><code>17bd067</code></a></td><td><code>Merge tag '6.7.beta2' into t/17890/ticket/17890</code></td></tr></table>\n",
    "created_at": "2015-04-25T20:46:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242143",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba"><code>17bd067</code></a></td><td><code>Merge tag '6.7.beta2' into t/17890/ticket/17890</code></td></tr></table>




---

archive/issue_comments_242144.json:
```json
{
    "body": "Changed commit from **[`1ad339b`](https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d)** to **[`17bd067`](https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba)**",
    "created_at": "2015-04-25T20:46:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242144",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1ad339b`](https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d)** to **[`17bd067`](https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba)**



---

archive/issue_events_255772.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-25T20:47:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255772"
}
```



---

archive/issue_events_255773.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-25T20:47:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255773"
}
```



---

archive/issue_comments_242145.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, I improved `rich_to_bool` a lot.",
    "created_at": "2015-04-25T20:47:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242145",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, I improved `rich_to_bool` a lot.



---

archive/issue_comments_242146.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI did some experimentations with Python classes. The conclusion is:\n\n     just define `_cmp_` and `_richcmp_` (even though you redefine `__hash__`)\n\nThen:\n- rich  comparisons and comparisons work when it involves elements with the same parent (i.e. the newly defined `_cmp_` and `_richcmp_` gets called)\n- rich comparisons involving coercion is fine\n- comparison involving coercion is **wrong**: if you call `cmp(a,b)` with `a` and `b` between two parents `A` and `B` and a coercion `B -> A` then `Element.__richcmp__` is called instead of `Element.__cmp__`.\n\nActually, this is not only a bug in Python but also in Cython! I added print statement in each comparisons function in `Element` and see\n\n```\nsage: cmp(1,1/3)\nElement._richcmp(1,1/3,2)\nElement._richcmp(1,1/3,2)\nElement._richcmp_(1,1/3,2)\nElement._richcmp(1,1/3,0)\nElement._richcmp(1,1/3,0)\nElement._richcmp_(1,1/3,0)\nElement._richcmp(1,1/3,4)\nElement._richcmp(1,1/3,4)\nElement._richcmp_(1,1/3,4)\n1\n```\n\nVincent",
    "created_at": "2015-04-26T09:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242146",
    "user": "https://github.com/videlec"
}
```

<div id="comment:27" align="right">comment:27</div>

I did some experimentations with Python classes. The conclusion is:

     just define `_cmp_` and `_richcmp_` (even though you redefine `__hash__`)

Then:
- rich  comparisons and comparisons work when it involves elements with the same parent (i.e. the newly defined `_cmp_` and `_richcmp_` gets called)
- rich comparisons involving coercion is fine
- comparison involving coercion is **wrong**: if you call `cmp(a,b)` with `a` and `b` between two parents `A` and `B` and a coercion `B -> A` then `Element.__richcmp__` is called instead of `Element.__cmp__`.

Actually, this is not only a bug in Python but also in Cython! I added print statement in each comparisons function in `Element` and see

```
sage: cmp(1,1/3)
Element._richcmp(1,1/3,2)
Element._richcmp(1,1/3,2)
Element._richcmp_(1,1/3,2)
Element._richcmp(1,1/3,0)
Element._richcmp(1,1/3,0)
Element._richcmp_(1,1/3,0)
Element._richcmp(1,1/3,4)
Element._richcmp(1,1/3,4)
Element._richcmp_(1,1/3,4)
1
```

Vincent



---

archive/issue_comments_242147.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nMoreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called! So the test in `Element._cmp` seems useless.",
    "created_at": "2015-04-26T10:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242147",
    "user": "https://github.com/videlec"
}
```

<div id="comment:28" align="right">comment:28</div>

Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called! So the test in `Element._cmp` seems useless.



---

archive/issue_comments_242148.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@videlec](#comment:28):\n> Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called! So the test in `Element._cmp` seems useless.\n\nExcept if you do not define `_richcmp_` and do some rich comparisons (this is the case in `sage.rings.qqbar.AlgebraicReal` for example).",
    "created_at": "2015-04-26T10:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242148",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@videlec](#comment:28):
> Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called! So the test in `Element._cmp` seems useless.

Except if you do not define `_richcmp_` and do some rich comparisons (this is the case in `sage.rings.qqbar.AlgebraicReal` for example).



---

archive/issue_comments_242149.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@videlec](#comment:27):\n> - comparison involving coercion is **wrong**: if you call `cmp(a,b)` with `a` and `b` between two parents `A` and `B` and a coercion `B -> A` then `Element.__richcmp__` is called instead of `Element.__cmp__`.\n> \n> Actually, this is not only a bug in Python\n\nBug or feature?",
    "created_at": "2015-04-26T10:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242149",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@videlec](#comment:27):
> - comparison involving coercion is **wrong**: if you call `cmp(a,b)` with `a` and `b` between two parents `A` and `B` and a coercion `B -> A` then `Element.__richcmp__` is called instead of `Element.__cmp__`.
> 
> Actually, this is not only a bug in Python

Bug or feature?



---

archive/issue_comments_242150.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAnd implementing `_richcmp_` instead of `__cmp__` in `AlgebraicReal` I got an incredible speedup (see #18303).",
    "created_at": "2015-04-26T10:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242150",
    "user": "https://github.com/videlec"
}
```

<div id="comment:31" align="right">comment:31</div>

And implementing `_richcmp_` instead of `__cmp__` in `AlgebraicReal` I got an incredible speedup (see #18303).



---

archive/issue_comments_242151.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@videlec](#comment:28):\n> Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!\n\nOf course not, that's a general rule for inheritance.\n\n> So the test in `Element._cmp` seems useless.\n\nWhat do you mean?",
    "created_at": "2015-04-26T10:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242151",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@videlec](#comment:28):
> Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!

Of course not, that's a general rule for inheritance.

> So the test in `Element._cmp` seems useless.

What do you mean?



---

archive/issue_comments_242152.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@jdemeyer](#comment:32):\n> Replying to [@videlec](#comment:28):\n> > Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!\n\n> Of course not, that's a general rule for inheritance.\n\nI thought this was not the case for cython classes which redefine `__hash__`! Is it only true for `__richcmp__`?\n\n> > So the test in `Element._cmp` seems useless.\n\n> What do you mean?\n\nSorry, I forgot a `_`. I wanted to say `Element._cmp_`. The default implementation does check whether `__cmp__` is redefined in element classes. This code is called only if `__cmp__` is defined but not `_richcmp_`. And it seems much better to define `_richcmp_` in children classes.\n\nVincent",
    "created_at": "2015-04-26T10:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242152",
    "user": "https://github.com/videlec"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@jdemeyer](#comment:32):
> Replying to [@videlec](#comment:28):
> > Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!

> Of course not, that's a general rule for inheritance.

I thought this was not the case for cython classes which redefine `__hash__`! Is it only true for `__richcmp__`?

> > So the test in `Element._cmp` seems useless.

> What do you mean?

Sorry, I forgot a `_`. I wanted to say `Element._cmp_`. The default implementation does check whether `__cmp__` is redefined in element classes. This code is called only if `__cmp__` is defined but not `_richcmp_`. And it seems much better to define `_richcmp_` in children classes.

Vincent



---

archive/issue_comments_242153.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jdemeyer](#comment:30):\n> Replying to [@videlec](#comment:27):\n> > - comparison involving coercion is **wrong**: if you call `cmp(a,b)` with `a` and `b` between two parents `A` and `B` and a coercion `B -> A` then `Element.__richcmp__` is called instead of `Element.__cmp__`.\n> > \n> > Actually, this is not only a bug in Python\n\n> Bug or feature?\n\nCall it whatever you want: `cmp(a1,a2)` (same type) calls `__cmp__` but `cmp(a,b)` (different types) does not and use `__richcmp__` instead. The consequence is that you might perform three times the coercion while calling `cmp` with elements with different parents!",
    "created_at": "2015-04-26T10:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242153",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jdemeyer](#comment:30):
> Replying to [@videlec](#comment:27):
> > - comparison involving coercion is **wrong**: if you call `cmp(a,b)` with `a` and `b` between two parents `A` and `B` and a coercion `B -> A` then `Element.__richcmp__` is called instead of `Element.__cmp__`.
> > 
> > Actually, this is not only a bug in Python

> Bug or feature?

Call it whatever you want: `cmp(a1,a2)` (same type) calls `__cmp__` but `cmp(a,b)` (different types) does not and use `__richcmp__` instead. The consequence is that you might perform three times the coercion while calling `cmp` with elements with different parents!



---

archive/issue_comments_242154.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@videlec](#comment:34):\n> Call it whatever you want: `cmp(a1,a2)` (same type) calls `__cmp__` but `cmp(a,b)` (different types) does not and use `__richcmp__` instead. The consequence is that you might perform three times the coercion while calling `cmp` with elements with different parents!\n\nI agree. Unfortunately this is general Python behaviour and not something this ticket can fix.",
    "created_at": "2015-04-26T10:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242154",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@videlec](#comment:34):
> Call it whatever you want: `cmp(a1,a2)` (same type) calls `__cmp__` but `cmp(a,b)` (different types) does not and use `__richcmp__` instead. The consequence is that you might perform three times the coercion while calling `cmp` with elements with different parents!

I agree. Unfortunately this is general Python behaviour and not something this ticket can fix.



---

archive/issue_comments_242155.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@videlec](#comment:33):\n> Replying to [@jdemeyer](#comment:32):\n> > Replying to [@videlec](#comment:28):\n> > > Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!\n\n> > Of course not, that's a general rule for inheritance.\n\n> \n> I thought this was not the case for cython classes which redefine `__hash__`! Is it only true for `__richcmp__`?\n\nI don't understand what you are saying. For any method `foo`, the statement \"if you redefine `foo` in your Element class then `Element.foo` is not called\" is true.",
    "created_at": "2015-04-26T10:45:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242155",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@videlec](#comment:33):
> Replying to [@jdemeyer](#comment:32):
> > Replying to [@videlec](#comment:28):
> > > Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!

> > Of course not, that's a general rule for inheritance.

> 
> I thought this was not the case for cython classes which redefine `__hash__`! Is it only true for `__richcmp__`?

I don't understand what you are saying. For any method `foo`, the statement "if you redefine `foo` in your Element class then `Element.foo` is not called" is true.



---

archive/issue_comments_242156.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jdemeyer](#comment:36):\n> Replying to [@videlec](#comment:33):\n> > Replying to [@jdemeyer](#comment:32):\n> > > Replying to [@videlec](#comment:28):\n> > > > Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!\n\n> > > Of course not, that's a general rule for inheritance.\n\n> > \n> > I thought this was not the case for cython classes which redefine `__hash__`! Is it only true for `__richcmp__`?\n\n> I don't understand what you are saying. For any method `foo`, the statement \"if you redefine `foo` in your Element class then `Element.foo` is not called\" is true.\n\nWhy in extension class one has to copy/paste the definition of `__richcmp__`?",
    "created_at": "2015-04-26T10:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242156",
    "user": "https://github.com/videlec"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jdemeyer](#comment:36):
> Replying to [@videlec](#comment:33):
> > Replying to [@jdemeyer](#comment:32):
> > > Replying to [@videlec](#comment:28):
> > > > Moreover if you redefine `__cmp__` in your Element class then `Element.__cmp__` is not called!

> > > Of course not, that's a general rule for inheritance.

> > 
> > I thought this was not the case for cython classes which redefine `__hash__`! Is it only true for `__richcmp__`?

> I don't understand what you are saying. For any method `foo`, the statement "if you redefine `foo` in your Element class then `Element.foo` is not called" is true.

Why in extension class one has to copy/paste the definition of `__richcmp__`?



---

archive/issue_comments_242157.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jdemeyer](#comment:35):\n> Replying to [@videlec](#comment:34):\n> > Call it whatever you want: `cmp(a1,a2)` (same type) calls `__cmp__` but `cmp(a,b)` (different types) does not and use `__richcmp__` instead. The consequence is that you might perform three times the coercion while calling `cmp` with elements with different parents!\n\n> \n> I agree. Unfortunately this is general Python behaviour and not something this ticket can fix.\n\nIt needs to be emphasized in the doc then. We should try hard to avoid `cmp(x,y)`!",
    "created_at": "2015-04-26T10:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242157",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jdemeyer](#comment:35):
> Replying to [@videlec](#comment:34):
> > Call it whatever you want: `cmp(a1,a2)` (same type) calls `__cmp__` but `cmp(a,b)` (different types) does not and use `__richcmp__` instead. The consequence is that you might perform three times the coercion while calling `cmp` with elements with different parents!

> 
> I agree. Unfortunately this is general Python behaviour and not something this ticket can fix.

It needs to be emphasized in the doc then. We should try hard to avoid `cmp(x,y)`!



---

archive/issue_events_255774.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T13:27:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255774"
}
```



---

archive/issue_events_255775.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T13:27:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255775"
}
```



---

archive/issue_comments_242158.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\n5. For Python classes, I guess that one needs to implement `_cmp_` and/or `_richcmp_`. This must be precised in the doc of `Element/Parent`. For this reason, we need a `py_rich_to_bool` available at the level of Python (as well as the operators `Py_EQ`, `Py_NE`, etc).\n\n6. I think we should avoid implenting `__eq__`, `__ne__` because one can do with `_richcmp_` that would take care of coercions. What do you think?\n\n7. There should be a mention of the Python issue that `cmp(a,b)` with `a` and `b` of different types does not call `_cmp_` (or `__cmp__`)",
    "created_at": "2015-04-26T13:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242158",
    "user": "https://github.com/videlec"
}
```

<div id="comment:39" align="right">comment:39</div>

5. For Python classes, I guess that one needs to implement `_cmp_` and/or `_richcmp_`. This must be precised in the doc of `Element/Parent`. For this reason, we need a `py_rich_to_bool` available at the level of Python (as well as the operators `Py_EQ`, `Py_NE`, etc).

6. I think we should avoid implenting `__eq__`, `__ne__` because one can do with `_richcmp_` that would take care of coercions. What do you think?

7. There should be a mention of the Python issue that `cmp(a,b)` with `a` and `b` of different types does not call `_cmp_` (or `__cmp__`)



---

archive/issue_comments_242159.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\n8. For `right_to_bool_sgn`:\n   - I found the following more readable\n\n```\ncdef inline bint rich_to_bool_sgn(int op, long c):\n    return rich_to_bool(op, (c > 0) - (c < 0))\n```\n  and in `Integer._cmp_`, you could optimize the sign check as well (either with your version or the one above)\n- why the input is `long c` and not `int c`? the output of `mpz_cmp` is an `int` for example.",
    "created_at": "2015-04-26T14:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242159",
    "user": "https://github.com/videlec"
}
```

<div id="comment:40" align="right">comment:40</div>

8. For `right_to_bool_sgn`:
   - I found the following more readable

```
cdef inline bint rich_to_bool_sgn(int op, long c):
    return rich_to_bool(op, (c > 0) - (c < 0))
```
  and in `Integer._cmp_`, you could optimize the sign check as well (either with your version or the one above)
- why the input is `long c` and not `int c`? the output of `mpz_cmp` is an `int` for example.



---

archive/issue_comments_242160.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@videlec](#comment:37):\n> Why in extension class one has to copy/paste the definition of `__richcmp__`?\n\nThis is vaguely explained in [https://docs.python.org/2/reference/datamodel.html#object.__hash__](https://docs.python.org/2/reference/datamodel.html#object.__hash__) (when reading this, mentally replace `__eq__` by `__richcmp__`)",
    "created_at": "2015-04-26T15:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242160",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@videlec](#comment:37):
> Why in extension class one has to copy/paste the definition of `__richcmp__`?

This is vaguely explained in [https://docs.python.org/2/reference/datamodel.html#object.__hash__](https://docs.python.org/2/reference/datamodel.html#object.__hash__) (when reading this, mentally replace `__eq__` by `__richcmp__`)



---

archive/issue_comments_242161.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThis is how Python implements `cmp`:\n\n```c\nstatic int\ndo_cmp(PyObject *v, PyObject *w)\n{\n    int c;\n    cmpfunc f;\n\n    if (v->ob_type == w->ob_type\n        && (f = v->ob_type->tp_compare) != NULL) {\n        c = (*f)(v, w);\n        if (PyInstance_Check(v)) {\n            /* Instance tp_compare has a different signature.\n               But if it returns undefined we fall through. */\n            if (c != 2)\n                return c;\n            /* Else fall through to try_rich_to_3way_compare() */\n        }\n        else\n            return adjust_tp_compare(c);\n    }\n    /* We only get here if one of the following is true:\n       a) v and w have different types\n       b) v and w have the same type, which doesn't have tp_compare\n       c) v and w are instances, and either __cmp__ is not defined or\n          __cmp__ returns NotImplemented\n    */\n    c = try_rich_to_3way_compare(v, w);\n    if (c < 2)\n        return c;\n    c = try_3way_compare(v, w);\n    if (c < 2)\n        return c;\n    return default_3way_compare(v, w);\n}\n```\n\nNote how `tp_compare` is only called if the types of `v` and `w` are equal. If not, `__richcmp__` is used. Only if `__richcmp__` is not implemented, then `__cmp__` is tried after all.",
    "created_at": "2015-04-26T16:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242161",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

This is how Python implements `cmp`:

```c
static int
do_cmp(PyObject *v, PyObject *w)
{
    int c;
    cmpfunc f;

    if (v->ob_type == w->ob_type
        && (f = v->ob_type->tp_compare) != NULL) {
        c = (*f)(v, w);
        if (PyInstance_Check(v)) {
            /* Instance tp_compare has a different signature.
               But if it returns undefined we fall through. */
            if (c != 2)
                return c;
            /* Else fall through to try_rich_to_3way_compare() */
        }
        else
            return adjust_tp_compare(c);
    }
    /* We only get here if one of the following is true:
       a) v and w have different types
       b) v and w have the same type, which doesn't have tp_compare
       c) v and w are instances, and either __cmp__ is not defined or
          __cmp__ returns NotImplemented
    */
    c = try_rich_to_3way_compare(v, w);
    if (c < 2)
        return c;
    c = try_3way_compare(v, w);
    if (c < 2)
        return c;
    return default_3way_compare(v, w);
}
```

Note how `tp_compare` is only called if the types of `v` and `w` are equal. If not, `__richcmp__` is used. Only if `__richcmp__` is not implemented, then `__cmp__` is tried after all.



---

archive/issue_comments_242162.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@videlec](#comment:40):\n> 8. For `right_to_bool_sgn`:\n>    - I found the following more readable\n> \n> ```\n> cdef inline bint rich_to_bool_sgn(int op, long c):\n>     return rich_to_bool(op, (c > 0) - (c < 0))\n> ```\n\nSure, I can change that.\n\n> - why the input is `long c` and not `int c`? the output of `mpz_cmp` is an `int` for example.\n\nIt's an `inline` function, so it won't matter much for performance. `long` is more general than `int`, so if there is ever a use case for a `long`, it will be possible.",
    "created_at": "2015-04-26T18:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242162",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@videlec](#comment:40):
> 8. For `right_to_bool_sgn`:
>    - I found the following more readable
> 
> ```
> cdef inline bint rich_to_bool_sgn(int op, long c):
>     return rich_to_bool(op, (c > 0) - (c < 0))
> ```

Sure, I can change that.

> - why the input is `long c` and not `int c`? the output of `mpz_cmp` is an `int` for example.

It's an `inline` function, so it won't matter much for performance. `long` is more general than `int`, so if there is ever a use case for a `long`, it will be possible.



---

archive/issue_comments_242163.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@videlec](#comment:39):\n> 5. For Python classes, I guess that one needs to implement `_cmp_` and/or `_richcmp_`. This must be precised in the doc of `Element/Parent`. For this reason, we need a `py_rich_to_bool` available at the level of Python (as well as the operators `Py_EQ`, `Py_NE`, etc).\n> \n> 6. I think we should avoid implenting `__eq__`, `__ne__` because one can do with `_richcmp_` that would take care of coercions. What do you think?\n\nCan we please postpone the pure Python case to a new ticket? I feel like this ticket is already getting big enough and I would prefer to focus on Cython here.",
    "created_at": "2015-04-26T19:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242163",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@videlec](#comment:39):
> 5. For Python classes, I guess that one needs to implement `_cmp_` and/or `_richcmp_`. This must be precised in the doc of `Element/Parent`. For this reason, we need a `py_rich_to_bool` available at the level of Python (as well as the operators `Py_EQ`, `Py_NE`, etc).
> 
> 6. I think we should avoid implenting `__eq__`, `__ne__` because one can do with `_richcmp_` that would take care of coercions. What do you think?

Can we please postpone the pure Python case to a new ticket? I feel like this ticket is already getting big enough and I would prefer to focus on Cython here.



---

archive/issue_comments_242164.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jdemeyer](#comment:44):\n> Replying to [@videlec](#comment:39):\n> > 5. For Python classes, I guess that one needs to implement `_cmp_` and/or `_richcmp_`. This must be precised in the doc of `Element/Parent`. For this reason, we need a `py_rich_to_bool` available at the level of Python (as well as the operators `Py_EQ`, `Py_NE`, etc).\n> > \n> > 6. I think we should avoid implenting `__eq__`, `__ne__` because one can do with `_richcmp_` that would take care of coercions. What do you think?\n\n> \n> Can we please postpone the pure Python case to a new ticket? I feel like this ticket is already getting big enough and I would prefer to focus on Cython here.\n\nAnd there are already two tickets depending on it ;-) I opened #18305\n\nVincent",
    "created_at": "2015-04-26T19:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242164",
    "user": "https://github.com/videlec"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jdemeyer](#comment:44):
> Replying to [@videlec](#comment:39):
> > 5. For Python classes, I guess that one needs to implement `_cmp_` and/or `_richcmp_`. This must be precised in the doc of `Element/Parent`. For this reason, we need a `py_rich_to_bool` available at the level of Python (as well as the operators `Py_EQ`, `Py_NE`, etc).
> > 
> > 6. I think we should avoid implenting `__eq__`, `__ne__` because one can do with `_richcmp_` that would take care of coercions. What do you think?

> 
> Can we please postpone the pure Python case to a new ticket? I feel like this ticket is already getting big enough and I would prefer to focus on Cython here.

And there are already two tickets depending on it ;-) I opened #18305

Vincent



---

archive/issue_comments_242165.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nFor the documentation, I opened #18306.",
    "created_at": "2015-04-26T19:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242165",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

For the documentation, I opened #18306.



---

archive/issue_comments_242166.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@jdemeyer](#comment:43):\n> It's an `inline` function, so it won't matter much for performance. `long` is more general than `int`, so if there is ever a use case for a `long`, it will be possible.\n\nHmm, just checked the assembly output of GCC 4.8.4 and it doesn't actually optimize this properly. So I'll stick to `int` indeed.",
    "created_at": "2015-04-26T20:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242166",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@jdemeyer](#comment:43):
> It's an `inline` function, so it won't matter much for performance. `long` is more general than `int`, so if there is ever a use case for a `long`, it will be possible.

Hmm, just checked the assembly output of GCC 4.8.4 and it doesn't actually optimize this properly. So I'll stick to `int` indeed.



---

archive/issue_comments_242167.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec\"><code>313a400</code></a></td><td><code>Optimize rich_to_bool_sgn</code></td></tr></table>\n",
    "created_at": "2015-04-26T20:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242167",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec"><code>313a400</code></a></td><td><code>Optimize rich_to_bool_sgn</code></td></tr></table>




---

archive/issue_comments_242168.json:
```json
{
    "body": "Changed commit from **[`17bd067`](https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba)** to **[`313a400`](https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec)**",
    "created_at": "2015-04-26T20:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242168",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`17bd067`](https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba)** to **[`313a400`](https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec)**



---

archive/issue_comments_242169.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nFor the assembly literate: with this new branch,\n\n```\nreturn rich_to_bool(op, (c > 0) - (c < 0))\n```\nbecomes\n\n```\n    xorl    %edx, %edx\n    testl   %eax, %eax        # test c\n    setg    %dl               # c > 0\n    shrl    $31, %eax         # c < 0 computed as ((unsigned int)c) >> 31\n    subl    %eax, %edx        # shift = (c > 0) - (c < 0)\n    movl    $184563750, %eax  # bits = 184563750\n    sall    $3, %edx          # shift *= 8\n    addl    %r12d, %edx       # shift += op\n    btl %edx, %eax            # test bit \"shift\" of \"bits\"\n    jnc ...\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec\"><code>313a400</code></a></td><td><code>Optimize rich_to_bool_sgn</code></td></tr></table>\n",
    "created_at": "2015-04-26T21:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242169",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49" align="right">comment:49</div>

For the assembly literate: with this new branch,

```
return rich_to_bool(op, (c > 0) - (c < 0))
```
becomes

```
    xorl    %edx, %edx
    testl   %eax, %eax        # test c
    setg    %dl               # c > 0
    shrl    $31, %eax         # c < 0 computed as ((unsigned int)c) >> 31
    subl    %eax, %edx        # shift = (c > 0) - (c < 0)
    movl    $184563750, %eax  # bits = 184563750
    sall    $3, %edx          # shift *= 8
    addl    %r12d, %edx       # shift += op
    btl %edx, %eax            # test bit "shift" of "bits"
    jnc ...
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec"><code>313a400</code></a></td><td><code>Optimize rich_to_bool_sgn</code></td></tr></table>




---

archive/issue_events_255776.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-26T21:00:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255776"
}
```



---

archive/issue_events_255777.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-26T21:00:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255777"
}
```



---

archive/issue_comments_242170.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\n9. implementation of `_(rich)cmp`:\n   - Why in `_(rich)cmp` it starts with the case `not have_same_parent_c(left,right)` instead of `have_same_parent_c(left,right)`. It would make it more readable the other way around.\n\n```\ncdef _richcmp(left, right):\n    if have_same_parent_c(left, right):\n        return left._richcmp_(<Element>right, op)\n\n    # different parents\n    global coercion_model\n    cdef int r\n    ...\n```\n- In `return left._(rich)cmp_(<Element>right, op)` is the `<Element>` really needed or usefull?\n- could `_left, _right = coercion_model.canonical_coercion(left, right)` be replaced with `left, right = coercion_model.canonical_coercion(left, right)`. As far as I see, there is no need of these extra variables.\n\n10. Could you add some minimal documentation to `_(rich)cmp` and `_(rich)cmp_` like\n\n```\ndef _richcmp(left, right):\n    r\"\"\"\n    Rich comparisons of elements\n\n    This should not be overriden! To implement comparisons override ``_richcmp_``\n    or/and ``_cmp_``.\n    \"\"\"\n\ndef _richcmp_(left, right):\n    r\"\"\"\n    Default implementation of rich comparisons for elements\n\n    By default it tries to see if `_cmp_` is implemented otherwise does a\n    comparison by id for ``==`` and ``!=``. Calling this default method\n    with ``<``, ``<=``, ``>`` or ``>=`` will raise a ``NotImplementedError``.\n\n    EXAMPLES::\n\n        sage: from sage.structure.parent import Parent\n        sage: from sage.structure.element import Element\n        sage: P = Parent()\n        sage: e1 = Element(P); e2 = Element(P)\n        sage: e1 == e1    # indirect doctest\n        True\n        sage: e1 == e2    # indirect doctest\n        False\n        sage: e1 < e2     # indirect doctest\n        Traceback (most recent call last):\n        ...\n        NotImplementedError: comparison not implemented for\n        <type 'sage.structure.element.Element'>\n    \"\"\"\n```\n and I think that `_cmp_` and `_richcmp_` deserves a sphinx directive to make them appear in the reference manual.",
    "created_at": "2015-04-26T22:03:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242170",
    "user": "https://github.com/videlec"
}
```

<div id="comment:51" align="right">comment:51</div>

9. implementation of `_(rich)cmp`:
   - Why in `_(rich)cmp` it starts with the case `not have_same_parent_c(left,right)` instead of `have_same_parent_c(left,right)`. It would make it more readable the other way around.

```
cdef _richcmp(left, right):
    if have_same_parent_c(left, right):
        return left._richcmp_(<Element>right, op)

    # different parents
    global coercion_model
    cdef int r
    ...
```
- In `return left._(rich)cmp_(<Element>right, op)` is the `<Element>` really needed or usefull?
- could `_left, _right = coercion_model.canonical_coercion(left, right)` be replaced with `left, right = coercion_model.canonical_coercion(left, right)`. As far as I see, there is no need of these extra variables.

10. Could you add some minimal documentation to `_(rich)cmp` and `_(rich)cmp_` like

```
def _richcmp(left, right):
    r"""
    Rich comparisons of elements

    This should not be overriden! To implement comparisons override ``_richcmp_``
    or/and ``_cmp_``.
    """

def _richcmp_(left, right):
    r"""
    Default implementation of rich comparisons for elements

    By default it tries to see if `_cmp_` is implemented otherwise does a
    comparison by id for ``==`` and ``!=``. Calling this default method
    with ``<``, ``<=``, ``>`` or ``>=`` will raise a ``NotImplementedError``.

    EXAMPLES::

        sage: from sage.structure.parent import Parent
        sage: from sage.structure.element import Element
        sage: P = Parent()
        sage: e1 = Element(P); e2 = Element(P)
        sage: e1 == e1    # indirect doctest
        True
        sage: e1 == e2    # indirect doctest
        False
        sage: e1 < e2     # indirect doctest
        Traceback (most recent call last):
        ...
        NotImplementedError: comparison not implemented for
        <type 'sage.structure.element.Element'>
    """
```
 and I think that `_cmp_` and `_richcmp_` deserves a sphinx directive to make them appear in the reference manual.



---

archive/issue_events_255778.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T22:03:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255778"
}
```



---

archive/issue_events_255779.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T22:03:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255779"
}
```



---

archive/issue_comments_242171.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@videlec](#comment:51):\n> 9. implementation of `_(rich)cmp`:\n>    - Why in `_(rich)cmp` it starts with the case `not have_same_parent_c(left,right)` instead of `have_same_parent_c(left,right)`. It would make it more readable the other way around.\n\nI don't know why it would be more readable, but I can change it.\n\n> - In `return left._(rich)cmp_(<Element>right, op)` is the `<Element>` really needed or usefull?\n\nIt's useful for efficiency. Note how `_(rich)cmp_` is declared with `Element right`. By explicitly calling this with `<Element>right`, Cython does not need to check that `right` is indeed an `Element`.\n\n> - could `_left, _right = coercion_model.canonical_coercion(left, right)` be replaced with `left, right = coercion_model.canonical_coercion(left, right)`. As far as I see, there is no need of these extra variables.\n\nPerhaps surprisingly, there is a need at least for an extra variable `_left`. The point is that `left` is a \"self\" argument which Cython will always assume and require that it is an instance of `Element`.",
    "created_at": "2015-04-27T06:13:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242171",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@videlec](#comment:51):
> 9. implementation of `_(rich)cmp`:
>    - Why in `_(rich)cmp` it starts with the case `not have_same_parent_c(left,right)` instead of `have_same_parent_c(left,right)`. It would make it more readable the other way around.

I don't know why it would be more readable, but I can change it.

> - In `return left._(rich)cmp_(<Element>right, op)` is the `<Element>` really needed or usefull?

It's useful for efficiency. Note how `_(rich)cmp_` is declared with `Element right`. By explicitly calling this with `<Element>right`, Cython does not need to check that `right` is indeed an `Element`.

> - could `_left, _right = coercion_model.canonical_coercion(left, right)` be replaced with `left, right = coercion_model.canonical_coercion(left, right)`. As far as I see, there is no need of these extra variables.

Perhaps surprisingly, there is a need at least for an extra variable `_left`. The point is that `left` is a "self" argument which Cython will always assume and require that it is an instance of `Element`.



---

archive/issue_comments_242172.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/629f6a5618ec6e5f616bf89e4886ea4dd92ae60e\"><code>629f6a5</code></a></td><td><code>Improve comparisons for permutation groups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1\"><code>0d1e049</code></a></td><td><code>Improve _richcmp and documentation</code></td></tr></table>\n",
    "created_at": "2015-04-27T11:12:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242172",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/629f6a5618ec6e5f616bf89e4886ea4dd92ae60e"><code>629f6a5</code></a></td><td><code>Improve comparisons for permutation groups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1"><code>0d1e049</code></a></td><td><code>Improve _richcmp and documentation</code></td></tr></table>




---

archive/issue_comments_242173.json:
```json
{
    "body": "Changed commit from **[`313a400`](https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec)** to **[`0d1e049`](https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1)**",
    "created_at": "2015-04-27T11:12:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242173",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`313a400`](https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec)** to **[`0d1e049`](https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1)**



---

archive/issue_events_255780.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-27T11:19:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255780"
}
```



---

archive/issue_events_255781.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-27T11:19:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255781"
}
```



---

archive/issue_comments_242174.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nOK, I made some further changes to `_richcmp`. There is one important functional change: when comparing two elements of the same type but different parents such that no coercion is possible (e.g. vectors over a different finite field), comparison is done by `id` instead of always returning `True` for `__lt__`:\n\nbefore:\n\n```\nsage: v = vector(GF(5), [1])\nsage: w = vector(GF(7), [1])\nsage: v < w\nTrue\nsage: w < v\nTrue\n```\n\nafter, `id(v)` and `id(w)` are compared.\n\nThis caused some doctest failures, which I simply removed (there was not much point in those tests). I also discovered #18308 this way (where there should be a coercion, but there isn't).",
    "created_at": "2015-04-27T11:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242174",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

OK, I made some further changes to `_richcmp`. There is one important functional change: when comparing two elements of the same type but different parents such that no coercion is possible (e.g. vectors over a different finite field), comparison is done by `id` instead of always returning `True` for `__lt__`:

before:

```
sage: v = vector(GF(5), [1])
sage: w = vector(GF(7), [1])
sage: v < w
True
sage: w < v
True
```

after, `id(v)` and `id(w)` are compared.

This caused some doctest failures, which I simply removed (there was not much point in those tests). I also discovered #18308 this way (where there should be a coercion, but there isn't).



---

archive/issue_events_255782.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-27T11:19:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255782"
}
```



---

archive/issue_events_255783.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-27T11:19:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255783"
}
```



---

archive/issue_comments_242175.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nYou wrote in the doc of `_richcmp`\n\n```\n        If a class wants to implement rich comparison without coercion,\n        then ``_richcmp`` should be defined (as well as ``__richcmp__``\n        as usual).\n```\nWhy not define directly `__richcmp__` in that case? This is exactly what is done in `Integer` (and also `Rational` in #18304). These could be cited as examples BTW.",
    "created_at": "2015-04-27T14:44:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242175",
    "user": "https://github.com/videlec"
}
```

<div id="comment:55" align="right">comment:55</div>

You wrote in the doc of `_richcmp`

```
        If a class wants to implement rich comparison without coercion,
        then ``_richcmp`` should be defined (as well as ``__richcmp__``
        as usual).
```
Why not define directly `__richcmp__` in that case? This is exactly what is done in `Integer` (and also `Rational` in #18304). These could be cited as examples BTW.



---

archive/issue_comments_242176.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@videlec](#comment:55):\n> You wrote in the doc of `_richcmp`\n> \n> ```\n>         If a class wants to implement rich comparison without coercion,\n>         then ``_richcmp`` should be defined (as well as ``__richcmp__``\n>         as usual).\n> ```\n> Why not define directly `__richcmp__` in that case?\n\nBecause rich comparison after coercion calls `_richcmp`, not `__richcmp__`. The only reason this works for `Integer` is that `ZZ` has no sub-rings: it is never the common parent of two different parents.",
    "created_at": "2015-04-27T15:39:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242176",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@videlec](#comment:55):
> You wrote in the doc of `_richcmp`
> 
> ```
>         If a class wants to implement rich comparison without coercion,
>         then ``_richcmp`` should be defined (as well as ``__richcmp__``
>         as usual).
> ```
> Why not define directly `__richcmp__` in that case?

Because rich comparison after coercion calls `_richcmp`, not `__richcmp__`. The only reason this works for `Integer` is that `ZZ` has no sub-rings: it is never the common parent of two different parents.



---

archive/issue_comments_242177.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nFor `Rational` in #18304, a similar argument holds: the only coercion to `QQ` from a Sage `Parent` is from `ZZ`. Since you're not using the coercion framework for this comparison between `Integer` and `Rational`, you're safe.\n\nIn other words: both work for very specific reasons, they are not examples to follow.",
    "created_at": "2015-04-27T15:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242177",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

For `Rational` in #18304, a similar argument holds: the only coercion to `QQ` from a Sage `Parent` is from `ZZ`. Since you're not using the coercion framework for this comparison between `Integer` and `Rational`, you're safe.

In other words: both work for very specific reasons, they are not examples to follow.



---

archive/issue_comments_242178.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422\"><code>39273f1</code></a></td><td><code>Fix doctest formatting</code></td></tr></table>\n",
    "created_at": "2015-04-27T18:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242178",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422"><code>39273f1</code></a></td><td><code>Fix doctest formatting</code></td></tr></table>




---

archive/issue_comments_242179.json:
```json
{
    "body": "Changed commit from **[`0d1e049`](https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1)** to **[`39273f1`](https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422)**",
    "created_at": "2015-04-27T18:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242179",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d1e049`](https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1)** to **[`39273f1`](https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422)**



---

archive/issue_comments_242180.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af\"><code>04570b3</code></a></td><td><code>Fix bad doctest in etaproducts</code></td></tr></table>\n",
    "created_at": "2015-04-27T18:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242180",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af"><code>04570b3</code></a></td><td><code>Fix bad doctest in etaproducts</code></td></tr></table>




---

archive/issue_comments_242181.json:
```json
{
    "body": "Changed commit from **[`39273f1`](https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422)** to **[`04570b3`](https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af)**",
    "created_at": "2015-04-27T18:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242181",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`39273f1`](https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422)** to **[`04570b3`](https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af)**



---

archive/issue_comments_242182.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@jdemeyer](#comment:56):\n> Replying to [@videlec](#comment:55):\n> > You wrote in the doc of `_richcmp`\n> > \n> > ```\n> >         If a class wants to implement rich comparison without coercion,\n> >         then ``_richcmp`` should be defined (as well as ``__richcmp__``\n> >         as usual).\n> > ```\n> > Why not define directly `__richcmp__` in that case?\n\n> \n> Because rich comparison after coercion calls `_richcmp`, not `__richcmp__`. The only reason this works for `Integer` is that `ZZ` has no sub-rings: it is never the common parent of two different parents.\n\nRight, but `_richcmp` will call `_richcmp_`/`_cmp_`. In Integers (and Rationals after #18304) there is also this `_cmp_` implemented and if everything else failed in `__richcmp__` there is precisely `Element._richcmp(self, other, op)`.\n\nSo even if you implement a subset of `ZZ`/`QQ` as a new parent (let say the additive group `3 ZZ` or the ring `ZZ[1/p]`) then it would be fine with comparisons with integers/rationals as soon as you define a coercion `3 ZZ -> ZZ`/`ZZ[1/p] -> QQ`. So my mistake, the situation for `ZZ` and `QQ` is a bit different: `Integer/Rational` do not avoid coercion in rich comparisons, they just try to avoid it for most common cases.\n\nDo you have an example of a `Parent` where we want to avoid coercions?",
    "created_at": "2015-04-28T06:20:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242182",
    "user": "https://github.com/videlec"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@jdemeyer](#comment:56):
> Replying to [@videlec](#comment:55):
> > You wrote in the doc of `_richcmp`
> > 
> > ```
> >         If a class wants to implement rich comparison without coercion,
> >         then ``_richcmp`` should be defined (as well as ``__richcmp__``
> >         as usual).
> > ```
> > Why not define directly `__richcmp__` in that case?

> 
> Because rich comparison after coercion calls `_richcmp`, not `__richcmp__`. The only reason this works for `Integer` is that `ZZ` has no sub-rings: it is never the common parent of two different parents.

Right, but `_richcmp` will call `_richcmp_`/`_cmp_`. In Integers (and Rationals after #18304) there is also this `_cmp_` implemented and if everything else failed in `__richcmp__` there is precisely `Element._richcmp(self, other, op)`.

So even if you implement a subset of `ZZ`/`QQ` as a new parent (let say the additive group `3 ZZ` or the ring `ZZ[1/p]`) then it would be fine with comparisons with integers/rationals as soon as you define a coercion `3 ZZ -> ZZ`/`ZZ[1/p] -> QQ`. So my mistake, the situation for `ZZ` and `QQ` is a bit different: `Integer/Rational` do not avoid coercion in rich comparisons, they just try to avoid it for most common cases.

Do you have an example of a `Parent` where we want to avoid coercions?



---

archive/issue_comments_242183.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@videlec](#comment:60):\n> Right, but `_richcmp` will call `_richcmp_`/`_cmp_`. In Integers (and Rationals after #18304) there is also this `_cmp_` implemented and if everything else failed in `__richcmp__` there is precisely `Element._richcmp(self, other, op)`.\n> \n> So even if you implement a subset of `ZZ`/`QQ` as a new parent (let say the additive group `3 ZZ` or the ring `ZZ[1/p]`) then it would be fine with comparisons with integers/rationals as soon as you define a coercion `3 ZZ -> ZZ`/`ZZ[1/p] -> QQ`. So my mistake, the situation for `ZZ` and `QQ` is a bit different: `Integer/Rational` do not avoid coercion in rich comparisons, they just try to avoid it for most common cases.\n\nI guess you're right. It's just much less obvious (as `_cmp_` is used after coercion, not `__richcmp__`).\n\n> Do you have an example of a `Parent` where we want to avoid coercions?\n\nSee `src/sage/numerical/linear_functions.pyx` which deals with \"symbolic\" linear inequalities. Here, `(a <= b) <= c` should construct the symbolic inequality `a <= b <= c`.",
    "created_at": "2015-04-28T06:42:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242183",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@videlec](#comment:60):
> Right, but `_richcmp` will call `_richcmp_`/`_cmp_`. In Integers (and Rationals after #18304) there is also this `_cmp_` implemented and if everything else failed in `__richcmp__` there is precisely `Element._richcmp(self, other, op)`.
> 
> So even if you implement a subset of `ZZ`/`QQ` as a new parent (let say the additive group `3 ZZ` or the ring `ZZ[1/p]`) then it would be fine with comparisons with integers/rationals as soon as you define a coercion `3 ZZ -> ZZ`/`ZZ[1/p] -> QQ`. So my mistake, the situation for `ZZ` and `QQ` is a bit different: `Integer/Rational` do not avoid coercion in rich comparisons, they just try to avoid it for most common cases.

I guess you're right. It's just much less obvious (as `_cmp_` is used after coercion, not `__richcmp__`).

> Do you have an example of a `Parent` where we want to avoid coercions?

See `src/sage/numerical/linear_functions.pyx` which deals with "symbolic" linear inequalities. Here, `(a <= b) <= c` should construct the symbolic inequality `a <= b <= c`.



---

archive/issue_comments_242184.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI would really like the following in `Element._richcmp_`\n\n```diff\ndiff --git a/src/sage/structure/element.pyx b/src/sage/structure/element.pyx\nindex 6981135..12cb669 100644\n--- a/src/sage/structure/element.pyx\n+++ b/src/sage/structure/element.pyx\n@@ -1047,11 +1047,21 @@ cdef class Element(SageObject):\n             ...\n             NotImplementedError: comparison not implemented for <type 'sage.structure.element.Element'>\n         \"\"\"\n         # Obvious case\n         if left is right:\n             return rich_to_bool(op, 0)\n \n         cdef int c\n+        if op == Py_NE:\n+            try:\n+                left_eq = left.__eq__\n+            except AttributeError:\n+                pass\n+            else:\n+                if isinstance(left_eq, MethodType):\n+                    return False if left_eq(right) else True\n+\n         try:\n             c = left._cmp_(right)\n         except NotImplementedError:\n```\nthat would allow element implementing `__eq__` to benefit of `__ne__` for free. What do you think? Perhaps not for this ticket though (thinking about #18305). It is a bit dangerous since `__eq__` would not go through coercions but `__ne__` would.",
    "created_at": "2015-04-28T06:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242184",
    "user": "https://github.com/videlec"
}
```

<div id="comment:62" align="right">comment:62</div>

I would really like the following in `Element._richcmp_`

```diff
diff --git a/src/sage/structure/element.pyx b/src/sage/structure/element.pyx
index 6981135..12cb669 100644
--- a/src/sage/structure/element.pyx
+++ b/src/sage/structure/element.pyx
@@ -1047,11 +1047,21 @@ cdef class Element(SageObject):
             ...
             NotImplementedError: comparison not implemented for <type 'sage.structure.element.Element'>
         """
         # Obvious case
         if left is right:
             return rich_to_bool(op, 0)
 
         cdef int c
+        if op == Py_NE:
+            try:
+                left_eq = left.__eq__
+            except AttributeError:
+                pass
+            else:
+                if isinstance(left_eq, MethodType):
+                    return False if left_eq(right) else True
+
         try:
             c = left._cmp_(right)
         except NotImplementedError:
```
that would allow element implementing `__eq__` to benefit of `__ne__` for free. What do you think? Perhaps not for this ticket though (thinking about #18305). It is a bit dangerous since `__eq__` would not go through coercions but `__ne__` would.



---

archive/issue_comments_242185.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jdemeyer](#comment:61):\n> Replying to [@videlec](#comment:60):\n> > Right, but `_richcmp` will call `_richcmp_`/`_cmp_`. In Integers (and Rationals after #18304) there is also this `_cmp_` implemented and if everything else failed in `__richcmp__` there is precisely `Element._richcmp(self, other, op)`.\n> > \n> > So even if you implement a subset of `ZZ`/`QQ` as a new parent (let say the additive group `3 ZZ` or the ring `ZZ[1/p]`) then it would be fine with comparisons with integers/rationals as soon as you define a coercion `3 ZZ -> ZZ`/`ZZ[1/p] -> QQ`. So my mistake, the situation for `ZZ` and `QQ` is a bit different: `Integer/Rational` do not avoid coercion in rich comparisons, they just try to avoid it for most common cases.\n\n> I guess you're right. It's just much less obvious (as `_cmp_` is used after coercion, not `__richcmp__`).\n> \n> > Do you have an example of a `Parent` where we want to avoid coercions?\n\n> See `src/sage/numerical/linear_functions.pyx` which deals with \"symbolic\" linear inequalities. Here, `(a <= b) <= c` should construct the symbolic inequality `a <= b <= c`.\n\nI see. Could you add this one to the documentation of `Element._richcmp` then?",
    "created_at": "2015-04-28T06:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242185",
    "user": "https://github.com/videlec"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jdemeyer](#comment:61):
> Replying to [@videlec](#comment:60):
> > Right, but `_richcmp` will call `_richcmp_`/`_cmp_`. In Integers (and Rationals after #18304) there is also this `_cmp_` implemented and if everything else failed in `__richcmp__` there is precisely `Element._richcmp(self, other, op)`.
> > 
> > So even if you implement a subset of `ZZ`/`QQ` as a new parent (let say the additive group `3 ZZ` or the ring `ZZ[1/p]`) then it would be fine with comparisons with integers/rationals as soon as you define a coercion `3 ZZ -> ZZ`/`ZZ[1/p] -> QQ`. So my mistake, the situation for `ZZ` and `QQ` is a bit different: `Integer/Rational` do not avoid coercion in rich comparisons, they just try to avoid it for most common cases.

> I guess you're right. It's just much less obvious (as `_cmp_` is used after coercion, not `__richcmp__`).
> 
> > Do you have an example of a `Parent` where we want to avoid coercions?

> See `src/sage/numerical/linear_functions.pyx` which deals with "symbolic" linear inequalities. Here, `(a <= b) <= c` should construct the symbolic inequality `a <= b <= c`.

I see. Could you add this one to the documentation of `Element._richcmp` then?



---

archive/issue_comments_242186.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [@videlec](#comment:62):\n> that would allow element implementing `__eq__` to benefit of `__ne__` for free. What do you think? Perhaps not for this ticket though (thinking about #18305). It is a bit dangerous since `__eq__` would not go through coercions but `__ne__` would.\n\nI don't like it so much. I think a Python class can easily do\n\n```\ndef __ne__(self, other):\n    return not (self == other)\n```\n\nAnd then you're indeed bringing coercion in the story and you're assuming that rich comparisons return `True` or `False` and not something symbolic.",
    "created_at": "2015-04-28T07:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242186",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [@videlec](#comment:62):
> that would allow element implementing `__eq__` to benefit of `__ne__` for free. What do you think? Perhaps not for this ticket though (thinking about #18305). It is a bit dangerous since `__eq__` would not go through coercions but `__ne__` would.

I don't like it so much. I think a Python class can easily do

```
def __ne__(self, other):
    return not (self == other)
```

And then you're indeed bringing coercion in the story and you're assuming that rich comparisons return `True` or `False` and not something symbolic.



---

archive/issue_comments_242187.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef\"><code>3976f2c</code></a></td><td><code>Add pointers for special uses of __richcmp__</code></td></tr></table>\n",
    "created_at": "2015-04-28T08:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242187",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef"><code>3976f2c</code></a></td><td><code>Add pointers for special uses of __richcmp__</code></td></tr></table>




---

archive/issue_comments_242188.json:
```json
{
    "body": "Changed commit from **[`04570b3`](https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af)** to **[`3976f2c`](https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef)**",
    "created_at": "2015-04-28T08:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242188",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`04570b3`](https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af)** to **[`3976f2c`](https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef)**



---

archive/issue_comments_242189.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI am running long tests. If these are good, this is good for me.\n\nVincent",
    "created_at": "2015-04-28T08:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242189",
    "user": "https://github.com/videlec"
}
```

<div id="comment:66" align="right">comment:66</div>

I am running long tests. If these are good, this is good for me.

Vincent



---

archive/issue_comments_242190.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nAll tests passed!",
    "created_at": "2015-04-28T08:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242190",
    "user": "https://github.com/videlec"
}
```

<div id="comment:67" align="right">comment:67</div>

All tests passed!



---

archive/issue_comments_242191.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2015-04-28T08:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242191",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_events_255784.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-28T08:40:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255784"
}
```



---

archive/issue_events_255785.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-28T08:40:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255785"
}
```



---

archive/issue_comments_242192.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nGreat, thanks!",
    "created_at": "2015-04-28T10:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242192",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

Great, thanks!



---

archive/issue_comments_242193.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nAnother follow-up: #18322",
    "created_at": "2015-04-28T16:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242193",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:69" align="right">comment:69</div>

Another follow-up: #18322



---

archive/issue_events_255786.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-29T03:13:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255786"
}
```



---

archive/issue_events_255787.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7ee574460db959b71bf15ea589c3a4576dd115dd",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-29T03:13:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17890#event-255787"
}
```



---

archive/issue_comments_242194.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17890](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17890)** to **[`3976f2c`](https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef)**",
    "created_at": "2015-04-29T03:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17890#issuecomment-242194",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17890](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17890)** to **[`3976f2c`](https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef)**
