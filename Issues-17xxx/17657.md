# Issue 17657: Upgrade to Cython 0.22

archive/issues_017420.json:
```json
{
    "body": "Easy upgrade.\n\nNote that the extension `sage.tests.parallel` needs to be removed, since the corresponding source file never existed (for some reason, this was not an error before). It was added by mistake for testing a particular ticket.\n\n**upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2)\n\n**CC:**  @robertwb @kiwifb\n\n**Branch/Commit:** [c4a9d24f22cdb833b9a98748008482ae517ef270](https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270)\n\n**Reviewer:** Robert Bradshaw\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/17657\n\n",
    "closed_at": "2015-02-17T19:28:32Z",
    "created_at": "2015-01-22T08:11:04Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Upgrade to Cython 0.22",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17657",
    "user": "https://github.com/jdemeyer"
}
```
Easy upgrade.

Note that the extension `sage.tests.parallel` needs to be removed, since the corresponding source file never existed (for some reason, this was not an error before). It was added by mistake for testing a particular ticket.

**upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2)

**CC:**  @robertwb @kiwifb

**Branch/Commit:** [c4a9d24f22cdb833b9a98748008482ae517ef270](https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270)

**Reviewer:** Robert Bradshaw

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/17657





---

archive/issue_comments_289750.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2015-01-22T08:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289750",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_289751.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/17657](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17657)",
    "created_at": "2015-01-22T12:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289751",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/17657](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17657)



---

archive/issue_comments_289752.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+Easy upgrade.\n \n+Note that the extension `sage.tests.parallel` needs to be removed, since the corresponding source file never existed (for some reason, this was not an error before). It was added by mistake for testing a particular ticket.\n``````\n",
    "created_at": "2015-01-22T14:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289752",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+Easy upgrade.
 
+Note that the extension `sage.tests.parallel` needs to be removed, since the corresponding source file never existed (for some reason, this was not an error before). It was added by mistake for testing a particular ticket.
``````




---

archive/issue_comments_289753.json:
```json
{
    "body": "**Commit:** [821815a19ffbceac2c100520cf2dabd3953e8022](https://github.com/sagemath/sagetrac-mirror/commit/821815a19ffbceac2c100520cf2dabd3953e8022)",
    "created_at": "2015-01-22T14:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289753",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [821815a19ffbceac2c100520cf2dabd3953e8022](https://github.com/sagemath/sagetrac-mirror/commit/821815a19ffbceac2c100520cf2dabd3953e8022)



---

archive/issue_comments_289754.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/821815a19ffbceac2c100520cf2dabd3953e8022\">821815a</a></td><td><code>Upgrade to Cython 0.22</code></td></tr></table>\n",
    "created_at": "2015-01-22T14:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289754",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/821815a19ffbceac2c100520cf2dabd3953e8022">821815a</a></td><td><code>Upgrade to Cython 0.22</code></td></tr></table>




---

archive/issue_comments_289755.json:
```json
{
    "body": "<a id='comment:5'></a>\n#17661 already removes the `sage.tests.parallel`",
    "created_at": "2015-01-23T12:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289755",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
#17661 already removes the `sage.tests.parallel`



---

archive/issue_comments_289756.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe 0.22 Cython version is a beta release? Do you really want to ship that in Sage? The release cycle between the first beta and the stable version seems to be short in Cython (max 1 month). Don't you want to wait for it?\n\nVincent",
    "created_at": "2015-01-25T17:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289756",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
The 0.22 Cython version is a beta release? Do you really want to ship that in Sage? The release cycle between the first beta and the stable version seems to be short in Cython (max 1 month). Don't you want to wait for it?

Vincent



---

archive/issue_comments_289757.json:
```json
{
    "body": "**Changing status** from new to needs_info.",
    "created_at": "2015-01-25T17:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289757",
    "user": "https://github.com/videlec"
}
```

**Changing status** from new to needs_info.



---

archive/issue_comments_289758.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.\n\nNote that the ticket title isn't \"Upgrade to Cython 0.22.beta0\", that the status wasn't \"needs_review\" and that I didn't even post a tarball link...",
    "created_at": "2015-01-25T21:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289758",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.

Note that the ticket title isn't "Upgrade to Cython 0.22.beta0", that the status wasn't "needs_review" and that I didn't even post a tarball link...



---

archive/issue_events_057116.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "rename": {
        "from": "Upgrade to Cython 0.22",
        "to": "Upgrade to Cython 0.22 after it is released"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17657#event-57116"
}
```



---

archive/issue_comments_289759.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jdemeyer](#comment%3A7):\n> It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.\n\n\nTrue!\n\n> Note that the ticket title isn't \"Upgrade to Cython 0.22.beta0\", that the status wasn't \"needs_review\" and that I didn't even post a tarball link...\n\n\nI was wondering because you need to update with respect to some tarball (sha1sum for example). Sorry for my misunderstanding.\n\nVincent",
    "created_at": "2015-01-25T21:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289759",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Replying to [jdemeyer](#comment%3A7):
> It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.


True!

> Note that the ticket title isn't "Upgrade to Cython 0.22.beta0", that the status wasn't "needs_review" and that I didn't even post a tarball link...


I was wondering because you need to update with respect to some tarball (sha1sum for example). Sorry for my misunderstanding.

Vincent



---

archive/issue_comments_289760.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Easy upgrade.\n \n Note that the extension `sage.tests.parallel` needs to be removed, since the corresponding source file never existed (for some reason, this was not an error before). It was added by mistake for testing a particular ticket.\n+\n+**upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2)\n``````\n",
    "created_at": "2015-02-12T09:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289760",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Easy upgrade.
 
 Note that the extension `sage.tests.parallel` needs to be removed, since the corresponding source file never existed (for some reason, this was not an error before). It was added by mistake for testing a particular ticket.
+
+**upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.22.tar.bz2)
``````




---

archive/issue_events_057117.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "rename": {
        "from": "Upgrade to Cython 0.22 after it is released",
        "to": "Upgrade to Cython 0.22"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17657#event-57117"
}
```



---

archive/issue_comments_289761.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270\">c4a9d24</a></td><td><code>Upgrade to Cython 0.22</code></td></tr></table>\n",
    "created_at": "2015-02-12T09:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270">c4a9d24</a></td><td><code>Upgrade to Cython 0.22</code></td></tr></table>




---

archive/issue_comments_289762.json:
```json
{
    "body": "**Changing commit** from \"[821815a19ffbceac2c100520cf2dabd3953e8022](https://github.com/sagemath/sagetrac-mirror/commit/821815a19ffbceac2c100520cf2dabd3953e8022)\" to \"[c4a9d24f22cdb833b9a98748008482ae517ef270](https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270)\".",
    "created_at": "2015-02-12T09:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[821815a19ffbceac2c100520cf2dabd3953e8022](https://github.com/sagemath/sagetrac-mirror/commit/821815a19ffbceac2c100520cf2dabd3953e8022)" to "[c4a9d24f22cdb833b9a98748008482ae517ef270](https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270)".



---

archive/issue_comments_289763.json:
```json
{
    "body": "<a id='comment:11'></a>\nOne tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.",
    "created_at": "2015-02-12T10:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289763",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:11'></a>
One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.



---

archive/issue_comments_289764.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2015-02-12T10:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289764",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_289765.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [robertwb](#comment%3A11):\n> One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.\n\n\nI am replacing\n\n```\ncdef extern from \"Python.h\":\n    bint PySlice_Check(PyObject* ob)\n\n...PySlice_Check(<PyObject *>row_index)...\n```\nby\n\n```\n...isinstance(row_index, slice)...\n```\n\nWhy is that a problem?",
    "created_at": "2015-02-12T10:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289765",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [robertwb](#comment%3A11):
> One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.


I am replacing

```
cdef extern from "Python.h":
    bint PySlice_Check(PyObject* ob)

...PySlice_Check(<PyObject *>row_index)...
```
by

```
...isinstance(row_index, slice)...
```

Why is that a problem?



---

archive/issue_comments_289766.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-02-12T12:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289766",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_289767.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-02-12T16:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289767",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_289768.json:
```json
{
    "body": "<a id='comment:14'></a>\nBah, got my red and green mixed up. Yes, that's good.",
    "created_at": "2015-02-12T16:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289768",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:14'></a>
Bah, got my red and green mixed up. Yes, that's good.



---

archive/issue_comments_289769.json:
```json
{
    "body": "**Reviewer:** \u200bRobert Bradshaw",
    "created_at": "2015-02-12T16:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289769",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** ​Robert Bradshaw



---

archive/issue_comments_289770.json:
```json
{
    "body": "**Changing reviewer** from \"\u200bRobert Bradshaw\" to \"Robert Bradshaw\".",
    "created_at": "2015-02-17T00:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289770",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "​Robert Bradshaw" to "Robert Bradshaw".



---

archive/issue_comments_289771.json:
```json
{
    "body": "<a id='comment:17'></a>\nbtw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.\n\n```\nbuild/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp: In function 'void* __pyx_f_4sage_3ext_6memory_check_allocarray(size_t, size_t)':\nbuild/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp:5507:60: error: 'mul_overflowcheck' was not declared in this scope\n   __pyx_v_n = mul_overflowcheck(__pyx_v_nmemb, __pyx_v_size);\n```\nThe cython version should probably also be considered in `sage -b`. If you want to work on that do it in a separate ticktet, this is already merged.",
    "created_at": "2015-02-17T10:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289771",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>
btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.

```
build/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp: In function 'void* __pyx_f_4sage_3ext_6memory_check_allocarray(size_t, size_t)':
build/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp:5507:60: error: 'mul_overflowcheck' was not declared in this scope
   __pyx_v_n = mul_overflowcheck(__pyx_v_nmemb, __pyx_v_size);
```
The cython version should probably also be considered in `sage -b`. If you want to work on that do it in a separate ticktet, this is already merged.



---

archive/issue_comments_289772.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [vbraun](#comment%3A17):\n> btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.\n\n\nIt's unrelated to this ticket, it's a bug in `build/deps`: the `csage` target does not state the `c_lib` sources as dependency. This causes `make` to skip `csage`, even though `./sage -b` should work.\n\nThe error you see comes from the `c_lib` change in #10257. I guess you compiled with #10257 applied, then undid #10257.",
    "created_at": "2015-02-17T10:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289772",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [vbraun](#comment%3A17):
> btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.


It's unrelated to this ticket, it's a bug in `build/deps`: the `csage` target does not state the `c_lib` sources as dependency. This causes `make` to skip `csage`, even though `./sage -b` should work.

The error you see comes from the `c_lib` change in #10257. I guess you compiled with #10257 applied, then undid #10257.



---

archive/issue_comments_289773.json:
```json
{
    "body": "<a id='comment:19'></a>\nI created #17794 for this.",
    "created_at": "2015-02-17T10:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289773",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
I created #17794 for this.



---

archive/issue_events_057118.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-17T19:28:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17657#event-57118"
}
```



---

archive/issue_comments_289774.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/17657](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17657)\" to \"[c4a9d24f22cdb833b9a98748008482ae517ef270](https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270)\".",
    "created_at": "2015-02-17T19:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17657#issuecomment-289774",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/17657](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17657)" to "[c4a9d24f22cdb833b9a98748008482ae517ef270](https://github.com/sagemath/sagetrac-mirror/commit/c4a9d24f22cdb833b9a98748008482ae517ef270)".
