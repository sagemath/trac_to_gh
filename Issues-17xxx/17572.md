# Issue 17572: Sage 6.5.beta4 build fails at r-3.1.2p0 on OS X 10.10.1

archive/issues_017335.json:
```json
{
    "body": "Keywords: r clang\n\nOn a particular OS X 10.10.1 system, building `r-3.1.2.p0` fails. I'm using git source, branch \"develop\". This also happens with OS X 10.10 and with Sage 6.4.beta3 and Sage 6.3. I'm using Xcode 6.1.1 and commandlinetoolsosx10.10forxcode6.1.1.\n\nThe reason is that `clang` is used to compile R packages, instead of `gcc -std=gnu99`.\n\nReported in sage-release group under topic \"Sage 6.5.beta4 released\". Logfile [attachment:r-3.1.2.p0.log] attached.\n\nProblem also occurs on a second system with OS X 10.9.5, Xcode 6.1.1 with comand line tools, when building sage 6.5.beta5.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17572\n\n",
    "closed_at": "2015-05-25T07:29:55Z",
    "created_at": "2014-12-31T02:38:39Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Sage 6.5.beta4 build fails at r-3.1.2p0 on OS X 10.10.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17572",
    "user": "https://github.com/DrXyzzy"
}
```
Keywords: r clang

On a particular OS X 10.10.1 system, building `r-3.1.2.p0` fails. I'm using git source, branch "develop". This also happens with OS X 10.10 and with Sage 6.4.beta3 and Sage 6.3. I'm using Xcode 6.1.1 and commandlinetoolsosx10.10forxcode6.1.1.

The reason is that `clang` is used to compile R packages, instead of `gcc -std=gnu99`.

Reported in sage-release group under topic "Sage 6.5.beta4 released". Logfile [attachment:r-3.1.2.p0.log] attached.

Problem also occurs on a second system with OS X 10.9.5, Xcode 6.1.1 with comand line tools, when building sage 6.5.beta5.

Issue created by migration from https://trac.sagemath.org/ticket/17572





---

archive/issue_comments_230628.json:
```json
{
    "body": "logs/pkgs/r-3.1.2.p0.log",
    "created_at": "2014-12-31T02:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230628",
    "user": "https://github.com/DrXyzzy"
}
```

logs/pkgs/r-3.1.2.p0.log



---

archive/issue_comments_230629.json:
```json
{
    "body": "Attachment [r-3.1.2.p0.log](tarball://root/attachments/some-uuid/ticket17572/r-3.1.2.p0.log) by @kiwifb created at 2014-12-31 03:05:41\n\nCan we have the config.log for R in /Users/uu1024/Git/sage/local/var/tmp/sage/build/r-3.1.2.p0/src/ ?\nI don't have this problem on my own 10.10.1 machine. I note that clang is used only in some R packages and that's where a failure occurs. I don't appear to get clang anywhere in my logs.",
    "created_at": "2014-12-31T03:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230629",
    "user": "https://github.com/kiwifb"
}
```

Attachment [r-3.1.2.p0.log](tarball://root/attachments/some-uuid/ticket17572/r-3.1.2.p0.log) by @kiwifb created at 2014-12-31 03:05:41

Can we have the config.log for R in /Users/uu1024/Git/sage/local/var/tmp/sage/build/r-3.1.2.p0/src/ ?
I don't have this problem on my own 10.10.1 machine. I note that clang is used only in some R packages and that's where a failure occurs. I don't appear to get clang anywhere in my logs.



---

archive/issue_comments_230630.json:
```json
{
    "body": "./local/var/tmp/sage/build/r-3.1.2.p0/src/config.log",
    "created_at": "2014-12-31T03:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230630",
    "user": "https://github.com/DrXyzzy"
}
```

./local/var/tmp/sage/build/r-3.1.2.p0/src/config.log



---

archive/issue_comments_230631.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket17572/config.log) by @DrXyzzy created at 2014-12-31 04:18:48\n\nconfig.log attached. Do I need to add this comment, or does notification happen when a file is attached?",
    "created_at": "2014-12-31T04:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230631",
    "user": "https://github.com/DrXyzzy"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket17572/config.log) by @DrXyzzy created at 2014-12-31 04:18:48

config.log attached. Do I need to add this comment, or does notification happen when a file is attached?



---

archive/issue_comments_230632.json:
```json
{
    "body": "You most definitely need to comment. Notifications are not sent to me at least when files are attached.",
    "created_at": "2014-12-31T05:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230632",
    "user": "https://github.com/kiwifb"
}
```

You most definitely need to comment. Notifications are not sent to me at least when files are attached.



---

archive/issue_comments_230633.json:
```json
{
    "body": "I am not completely sure at this stage. Furthermore every R package usually has its own configure but it is all automatically erased in case of failure. Nevertheless two things come to mind\n* You have a very long PATH that may contain stuff that interfere. It it difficult to be sure without doing fault isolation.\n* For some reason tcl/tk is not detected while you appear to at least havehad quartz/X11 at some point.\n\nAs I said your PATh is quite long according to configure\n\n```\nPATH: /Users/uu1024/Git/sage/src/bin\nPATH: /Users/uu1024/Git/sage/local/bin\nPATH: /Users/uu1024/Git/sage/src/bin\nPATH: /Users/uu1024/Git/sage/local/bin\nPATH: /opt/local/bin\nPATH: /opt/local/sbin\nPATH: /Users/uu1024/Gcloud/google-cloud-sdk/bin\nPATH: /Users/uu1024/.rvm/gems/ruby-2.0.0-p0/bin\nPATH: /Users/uu1024/.rvm/gems/ruby-2.0.0-p0@global/bin\nPATH: /Users/uu1024/.rvm/rubies/ruby-2.0.0-p0/bin\nPATH: /Users/uu1024/.rvm/bin\nPATH: /Users/uu1024/.rvm/bin\nPATH: /opt/local/bin\nPATH: /opt/local/sbin\nPATH: /opt/local/bin\nPATH: /opt/local/sbin\nPATH: /opt/local/bin\nPATH: /opt/local/sbin\nPATH: /usr/local/bin\nPATH: /usr/bin\nPATH: /bin\nPATH: /usr/sbin\nPATH: /sbin\nPATH: /opt/X11/bin\nPATH: /usr/local/MacGPG2/bin\nPATH: /Applications/Julia-0.2.0-pre-77cc4f1c90.app/Contents/Resources/julia/bin\n```\nWhat's in /opt/local? Is there anything in /usr/local?",
    "created_at": "2014-12-31T08:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230633",
    "user": "https://github.com/kiwifb"
}
```

I am not completely sure at this stage. Furthermore every R package usually has its own configure but it is all automatically erased in case of failure. Nevertheless two things come to mind
* You have a very long PATH that may contain stuff that interfere. It it difficult to be sure without doing fault isolation.
* For some reason tcl/tk is not detected while you appear to at least havehad quartz/X11 at some point.

As I said your PATh is quite long according to configure

```
PATH: /Users/uu1024/Git/sage/src/bin
PATH: /Users/uu1024/Git/sage/local/bin
PATH: /Users/uu1024/Git/sage/src/bin
PATH: /Users/uu1024/Git/sage/local/bin
PATH: /opt/local/bin
PATH: /opt/local/sbin
PATH: /Users/uu1024/Gcloud/google-cloud-sdk/bin
PATH: /Users/uu1024/.rvm/gems/ruby-2.0.0-p0/bin
PATH: /Users/uu1024/.rvm/gems/ruby-2.0.0-p0@global/bin
PATH: /Users/uu1024/.rvm/rubies/ruby-2.0.0-p0/bin
PATH: /Users/uu1024/.rvm/bin
PATH: /Users/uu1024/.rvm/bin
PATH: /opt/local/bin
PATH: /opt/local/sbin
PATH: /opt/local/bin
PATH: /opt/local/sbin
PATH: /opt/local/bin
PATH: /opt/local/sbin
PATH: /usr/local/bin
PATH: /usr/bin
PATH: /bin
PATH: /usr/sbin
PATH: /sbin
PATH: /opt/X11/bin
PATH: /usr/local/MacGPG2/bin
PATH: /Applications/Julia-0.2.0-pre-77cc4f1c90.app/Contents/Resources/julia/bin
```
What's in /opt/local? Is there anything in /usr/local?



---

archive/issue_comments_230634.json:
```json
{
    "body": "The underlying reason is that `clang` is used to build parts of R, not `gcc`.",
    "created_at": "2014-12-31T09:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230634",
    "user": "https://github.com/jdemeyer"
}
```

The underlying reason is that `clang` is used to build parts of R, not `gcc`.



---

archive/issue_comments_230635.json:
```json
{
    "body": "`@`fbissey - \n\n/opt/local is where macports puts everything. But the sage build system tells me to move it aside, so that directory does not exist at all during the build. (I would love to not have to do that.)\n\n/usr/local is for a few third party apps that want to be installed there outside of macports, including octave.\n\ntcl is installed, but it's in macports under /opt/local so is invisible during the build\n\n`@`jdemeyer - is the following relevant?\n[in OS X 10.10]  'GCC' is no longer the real GNU gcc but is clang.\n- http://stackoverflow.com/questions/27308323/osx-10-10-yosemite-clang-gcc-versions",
    "created_at": "2014-12-31T09:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230635",
    "user": "https://github.com/DrXyzzy"
}
```

`@`fbissey - 

/opt/local is where macports puts everything. But the sage build system tells me to move it aside, so that directory does not exist at all during the build. (I would love to not have to do that.)

/usr/local is for a few third party apps that want to be installed there outside of macports, including octave.

tcl is installed, but it's in macports under /opt/local so is invisible during the build

`@`jdemeyer - is the following relevant?
[in OS X 10.10]  'GCC' is no longer the real GNU gcc but is clang.
- http://stackoverflow.com/questions/27308323/osx-10-10-yosemite-clang-gcc-versions



---

archive/issue_comments_230636.json:
```json
{
    "body": "Difficult to know\n\n```\n794\tR is now configured for x86_64-apple-darwin14.0.0\n795\t\n796\t  Source directory:          .\n797\t  Installation directory:    /Users/uu1024/Git/sage/local\n798\t\n799\t  C compiler:                gcc -std=gnu99  -g -O2\n800\t  Fortran 77 compiler:       gfortran  -g -O2\n801\t\n802\t  C++ compiler:              g++  -g -O2\n803\t  C++ 11 compiler:           g++  -std=c++11 -g -O2\n804\t  Fortran 90/95 compiler:    gfortran -g -O2\n805\t  Obj-C compiler:            /usr/bin/cc -g -O2 -fobjc-exceptions\n806\t\n807\t  Interfaces supported:      aqua\n808\t  External libraries:        readline\n809\t  Additional capabilities:   NLS, ICU\n810\t  Options enabled:           shared R library, shared BLAS, R profiling\n811\t\n812\t  Capabilities skipped:      PNG, JPEG, TIFF, cairo\n813\t  Options not enabled:       memory profiling\n814\t\n815\t  Recommended packages:      yes\n```\nOf course gcc could be clang if PATH is misconfigured. But clang only explicitly appears in the log during the compilation of R packages after R is compiled.\n\ngcc should be gnu because we always compile it on OS X so you have an install under $SAGE_LOCAL.",
    "created_at": "2014-12-31T09:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230636",
    "user": "https://github.com/kiwifb"
}
```

Difficult to know

```
794	R is now configured for x86_64-apple-darwin14.0.0
795	
796	  Source directory:          .
797	  Installation directory:    /Users/uu1024/Git/sage/local
798	
799	  C compiler:                gcc -std=gnu99  -g -O2
800	  Fortran 77 compiler:       gfortran  -g -O2
801	
802	  C++ compiler:              g++  -g -O2
803	  C++ 11 compiler:           g++  -std=c++11 -g -O2
804	  Fortran 90/95 compiler:    gfortran -g -O2
805	  Obj-C compiler:            /usr/bin/cc -g -O2 -fobjc-exceptions
806	
807	  Interfaces supported:      aqua
808	  External libraries:        readline
809	  Additional capabilities:   NLS, ICU
810	  Options enabled:           shared R library, shared BLAS, R profiling
811	
812	  Capabilities skipped:      PNG, JPEG, TIFF, cairo
813	  Options not enabled:       memory profiling
814	
815	  Recommended packages:      yes
```
Of course gcc could be clang if PATH is misconfigured. But clang only explicitly appears in the log during the compilation of R packages after R is compiled.

gcc should be gnu because we always compile it on OS X so you have an install under $SAGE_LOCAL.



---

archive/issue_comments_230637.json:
```json
{
    "body": "So you moved macport but you still have the PATH for it defined in your shell?",
    "created_at": "2014-12-31T09:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230637",
    "user": "https://github.com/kiwifb"
}
```

So you moved macport but you still have the PATH for it defined in your shell?



---

archive/issue_comments_230638.json:
```json
{
    "body": "`@`fbissey Right, all I do before checkout and make is sudo mv /opt/local /opt/local0. Extra gunk in PATH is generally harmless. I've been doing it this way for almost a year. Worked til a few weeks ago.\n\nI've pruned PATH anyway and am rebuilding develop branch after make distclean to get a clean start. This takes about 6 hours on a 2.4 GHz Intel Core i5 with 8 GB of RAM. (I've tried parallel make in the past, but it always crashes during build of sage). I'll look into the r config & clang if the error is still there, which I expect.",
    "created_at": "2014-12-31T23:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230638",
    "user": "https://github.com/DrXyzzy"
}
```

`@`fbissey Right, all I do before checkout and make is sudo mv /opt/local /opt/local0. Extra gunk in PATH is generally harmless. I've been doing it this way for almost a year. Worked til a few weeks ago.

I've pruned PATH anyway and am rebuilding develop branch after make distclean to get a clean start. This takes about 6 hours on a 2.4 GHz Intel Core i5 with 8 GB of RAM. (I've tried parallel make in the past, but it always crashes during build of sage). I'll look into the r config & clang if the error is still there, which I expect.



---

archive/issue_comments_230639.json:
```json
{
    "body": "Would you happen to have another, system wide, install of R? In any case could you find and post \"Makeconf\" in the R building hierarchy\n\n```\nfind . -name Makeconf\n```\nfrom /Users/uu1024/Git/sage/local/var/tmp/sage/build/r-3.1.2.p0/src/ should help locate it if it exist.",
    "created_at": "2015-01-01T00:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230639",
    "user": "https://github.com/kiwifb"
}
```

Would you happen to have another, system wide, install of R? In any case could you find and post "Makeconf" in the R building hierarchy

```
find . -name Makeconf
```
from /Users/uu1024/Git/sage/local/var/tmp/sage/build/r-3.1.2.p0/src/ should help locate it if it exist.



---

archive/issue_comments_230640.json:
```json
{
    "body": "> Difficult to know\n> \n> ```\n> 794\tR is now configured for x86_64-apple-darwin14.0.0\n> 795\t\n> 796\t  Source directory:          .\n> 797\t  Installation directory:    /Users/uu1024/Git/sage/local\n> 798\t\n> 799\t  C compiler:                gcc -std=gnu99  -g -O2\n> 800\t  Fortran 77 compiler:       gfortran  -g -O2\n> 801\t\n> 802\t  C++ compiler:              g++  -g -O2\n> 803\t  C++ 11 compiler:           g++  -std=c++11 -g -O2\n> 804\t  Fortran 90/95 compiler:    gfortran -g -O2\n> 805\t  Obj-C compiler:            /usr/bin/cc -g -O2 -fobjc-exceptions\n> 806\t\n> 807\t  Interfaces supported:      aqua\n> 808\t  External libraries:        readline\n> 809\t  Additional capabilities:   NLS, ICU\n> 810\t  Options enabled:           shared R library, shared BLAS, R profiling\n> 811\t\n> 812\t  Capabilities skipped:      PNG, JPEG, TIFF, cairo\n> 813\t  Options not enabled:       memory profiling\n> 814\t\n> 815\t  Recommended packages:      yes\n> ```\n> Of course gcc could be clang if PATH is misconfigured. But clang only explicitly appears in the log during the compilation of R packages after R is compiled.\n\n\nYes, that's strange, `clang` does not appear in the above list. I don't know where R suddenly gets this `clang` from.",
    "created_at": "2015-01-01T11:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230640",
    "user": "https://github.com/jdemeyer"
}
```

> Difficult to know
> 
> ```
> 794	R is now configured for x86_64-apple-darwin14.0.0
> 795	
> 796	  Source directory:          .
> 797	  Installation directory:    /Users/uu1024/Git/sage/local
> 798	
> 799	  C compiler:                gcc -std=gnu99  -g -O2
> 800	  Fortran 77 compiler:       gfortran  -g -O2
> 801	
> 802	  C++ compiler:              g++  -g -O2
> 803	  C++ 11 compiler:           g++  -std=c++11 -g -O2
> 804	  Fortran 90/95 compiler:    gfortran -g -O2
> 805	  Obj-C compiler:            /usr/bin/cc -g -O2 -fobjc-exceptions
> 806	
> 807	  Interfaces supported:      aqua
> 808	  External libraries:        readline
> 809	  Additional capabilities:   NLS, ICU
> 810	  Options enabled:           shared R library, shared BLAS, R profiling
> 811	
> 812	  Capabilities skipped:      PNG, JPEG, TIFF, cairo
> 813	  Options not enabled:       memory profiling
> 814	
> 815	  Recommended packages:      yes
> ```
> Of course gcc could be clang if PATH is misconfigured. But clang only explicitly appears in the log during the compilation of R packages after R is compiled.


Yes, that's strange, `clang` does not appear in the above list. I don't know where R suddenly gets this `clang` from.



---

archive/issue_comments_230641.json:
```json
{
    "body": "Ideally, we should have the log file of a succesfull R build on a similar system and diff them.",
    "created_at": "2015-01-01T11:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230641",
    "user": "https://github.com/jdemeyer"
}
```

Ideally, we should have the log file of a succesfull R build on a similar system and diff them.



---

archive/issue_comments_230642.json:
```json
{
    "body": "Attachment [r-3.1.2.p0.2.log](tarball://root/attachments/some-uuid/ticket17572/r-3.1.2.p0.2.log) by @kiwifb created at 2015-01-01 12:10:00\n\nsuccessful log",
    "created_at": "2015-01-01T12:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230642",
    "user": "https://github.com/kiwifb"
}
```

Attachment [r-3.1.2.p0.2.log](tarball://root/attachments/some-uuid/ticket17572/r-3.1.2.p0.2.log) by @kiwifb created at 2015-01-01 12:10:00

successful log



---

archive/issue_comments_230643.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Ideally, we should have the log file of a succesfull R build on a similar system and diff them.\n\n\nYour wish is granted.",
    "created_at": "2015-01-01T12:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230643",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:12 jdemeyer]:
> Ideally, we should have the log file of a succesfull R build on a similar system and diff them.


Your wish is granted.



---

archive/issue_comments_230644.json:
```json
{
    "body": "The log at least shows that `clang` was *not* used in the good build. The good build uses `gcc -std=gnu99` where the bad build used `clang`.\n\nThe only differences in the logs are support for `tex` and `Tcl/Tk`, different timezones and directories. There is nothing which could indicate how this happened or where the mysterious `clang` came from.",
    "created_at": "2015-01-01T14:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230644",
    "user": "https://github.com/jdemeyer"
}
```

The log at least shows that `clang` was *not* used in the good build. The good build uses `gcc -std=gnu99` where the bad build used `clang`.

The only differences in the logs are support for `tex` and `Tcl/Tk`, different timezones and directories. There is nothing which could indicate how this happened or where the mysterious `clang` came from.



---

archive/issue_comments_230645.json:
```json
{
    "body": "`@`hsnyder: the only possible explanation I see is your environment. What is the output of\n\n```\n./sage --sh -c env\n```",
    "created_at": "2015-01-01T14:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230645",
    "user": "https://github.com/jdemeyer"
}
```

`@`hsnyder: the only possible explanation I see is your environment. What is the output of

```
./sage --sh -c env
```



---

archive/issue_comments_230646.json:
```json
{
    "body": "Attachment [sage-envt.txt](tarball://root/attachments/some-uuid/ticket17572/sage-envt.txt) by @DrXyzzy created at 2015-01-02 02:36:30\n\noutput of ./sage --sh -c env",
    "created_at": "2015-01-02T02:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230646",
    "user": "https://github.com/DrXyzzy"
}
```

Attachment [sage-envt.txt](tarball://root/attachments/some-uuid/ticket17572/sage-envt.txt) by @DrXyzzy created at 2015-01-02 02:36:30

output of ./sage --sh -c env



---

archive/issue_comments_230647.json:
```json
{
    "body": "Output of ./sage --sh -c env attached. The only way I can see clang getting involved is with these two lines:\n\n```\nOBJC=/usr/bin/cc\nOBJCXX=/usr/bin/c++\n```\n\nThe rebuild after cleaning up PATH did not eliminate the error. I also moved renamed /usr/bin/R and /usr/bin/Rscript to XR and XRscript and still got the error.",
    "created_at": "2015-01-02T03:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230647",
    "user": "https://github.com/DrXyzzy"
}
```

Output of ./sage --sh -c env attached. The only way I can see clang getting involved is with these two lines:

```
OBJC=/usr/bin/cc
OBJCXX=/usr/bin/c++
```

The rebuild after cleaning up PATH did not eliminate the error. I also moved renamed /usr/bin/R and /usr/bin/Rscript to XR and XRscript and still got the error.



---

archive/issue_comments_230648.json:
```json
{
    "body": "Did you look for Makeconf? Also is RHOME defined? If it is renaming R and Rscript may not be enough as RHOME may point to a system installed Makeconf.",
    "created_at": "2015-01-02T03:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230648",
    "user": "https://github.com/kiwifb"
}
```

Did you look for Makeconf? Also is RHOME defined? If it is renaming R and Rscript may not be enough as RHOME may point to a system installed Makeconf.



---

archive/issue_comments_230649.json:
```json
{
    "body": "Sorry, I have no more ideas...\n\nIt must be something particular on your system though as this issue was never reported before.",
    "created_at": "2015-01-02T09:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230649",
    "user": "https://github.com/jdemeyer"
}
```

Sorry, I have no more ideas...

It must be something particular on your system though as this issue was never reported before.



---

archive/issue_comments_230650.json:
```json
{
    "body": "I looked for RHOME and R_HOME and didn't see any definitions under local/var/tmp/sage/build/r-3.1.2.p0 outside the sage build directory. The local R installation (including Makeconf) is under /Library/Frameworks/R.framework so I moved that aside and rebuilt and got same error.\n\nClang first shows up in R build console output during the build of r-3.1.2.p0/src/src/library/Recommended. I'll look there a bit.\n\nIs there a way to turn off the build of R completely? There is already a functioning R on the system.",
    "created_at": "2015-01-02T16:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230650",
    "user": "https://github.com/DrXyzzy"
}
```

I looked for RHOME and R_HOME and didn't see any definitions under local/var/tmp/sage/build/r-3.1.2.p0 outside the sage build directory. The local R installation (including Makeconf) is under /Library/Frameworks/R.framework so I moved that aside and rebuilt and got same error.

Clang first shows up in R build console output during the build of r-3.1.2.p0/src/src/library/Recommended. I'll look there a bit.

Is there a way to turn off the build of R completely? There is already a functioning R on the system.



---

archive/issue_comments_230651.json:
```json
{
    "body": "Replying to [comment:20 hsnyder]:\n> Is there a way to turn off the build of R completely? There is already a functioning R on the system.\n\n\nNo. On most platforms it doesn't make sense and it would be difficult because sage includes rpy. Using system wide R leads to a library jungle between the system and sage that is probably unhealthy.\n\nDid you find a Makeconf for the R that sage is building?",
    "created_at": "2015-01-02T19:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230651",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:20 hsnyder]:
> Is there a way to turn off the build of R completely? There is already a functioning R on the system.


No. On most platforms it doesn't make sense and it would be difficult because sage includes rpy. Using system wide R leads to a library jungle between the system and sage that is probably unhealthy.

Did you find a Makeconf for the R that sage is building?



---

archive/issue_comments_230652.json:
```json
{
    "body": "./sage/local/var/tmp/sage/build/r-3.1.2.p0/src/Makeconf",
    "created_at": "2015-01-20T01:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230652",
    "user": "https://github.com/DrXyzzy"
}
```

./sage/local/var/tmp/sage/build/r-3.1.2.p0/src/Makeconf



---

archive/issue_comments_230653.json:
```json
{
    "body": "Attachment [Makeconf](tarball://root/attachments/some-uuid/ticket17572/Makeconf) by @DrXyzzy created at 2015-01-20 01:52:50\n\nI attached ./sage/local/var/tmp/sage/build/r-3.1.2.p0/src/Makeconf from the OS X 10.10.1 Xcode 6.1.1 build. It shows ```CC = gcc -std=gnu99```. \n\nBased on a similar-looking problem reported by homebrew project at https://github.com/Homebrew/homebrew-science/issues/1304 I also tried reverting to Xcode 6.0 and matching command line tools. This was only possible with OS X 10.9.5 because there's no matching set of command line tools for OS X 10.10. Build of the sage R package still fails.\n\nI also tried patching src/configure for the R package to turn off aqua in the build, because of a workaround reported at https://github.com/twelve17/homebrew-science/commit/fced84b20f2854741b7c41d0a1e6a43d80fc677f . That would probably not be a desirable solution, because X11 is already turned off in the sage R package according to comments in spkg-install, but I was curious if the build would complete. It did not.",
    "created_at": "2015-01-20T01:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230653",
    "user": "https://github.com/DrXyzzy"
}
```

Attachment [Makeconf](tarball://root/attachments/some-uuid/ticket17572/Makeconf) by @DrXyzzy created at 2015-01-20 01:52:50

I attached ./sage/local/var/tmp/sage/build/r-3.1.2.p0/src/Makeconf from the OS X 10.10.1 Xcode 6.1.1 build. It shows ```CC = gcc -std=gnu99```. 

Based on a similar-looking problem reported by homebrew project at https://github.com/Homebrew/homebrew-science/issues/1304 I also tried reverting to Xcode 6.0 and matching command line tools. This was only possible with OS X 10.9.5 because there's no matching set of command line tools for OS X 10.10. Build of the sage R package still fails.

I also tried patching src/configure for the R package to turn off aqua in the build, because of a workaround reported at https://github.com/twelve17/homebrew-science/commit/fced84b20f2854741b7c41d0a1e6a43d80fc677f . That would probably not be a desirable solution, because X11 is already turned off in the sage R package according to comments in spkg-install, but I was curious if the build would complete. It did not.



---

archive/issue_comments_230654.json:
```json
{
    "body": "I finally got a build of sage from source to complete on OS X 10.9.5, using a hint from this posting:\u00a0https://support.enthought.com/hc/en-us/articles/204469410-OS-X-GCC-Clang-and-Cython-in-10-9-Mavericks. I checked out current sage source (version 6.7) from\u00a0git://github.com/sagemath/sage.git,\u00a0moved\u00a0MacPorts\u00a0/opt/local to /opt/local0 as usual, then ran make. After about 5 hours the make aborted on the usual error,\u00a0\n\nERROR: compilation failed for package 'mgcv'\n...\nError installing package r-3.2.0.p0\n\nI then did\n\nexport\u00a0SAGE_KEEP_BUILT_SPKGS=yes\nexport CXXFLAGS=\"-mmacosx-version-min=10.6\"\nexport LDFLAGS=\"-mmacosx-version-min=10.6\"\n\nand re-ran make. Make finished in 38 minutes and the resulting sage binary includes r-3.2.0.\n\nI haven't tried a clean make from scratch, nor have I tested it on OS X 10.10.2 yet. The blog posting cited above also suggests compiler and linker flag of \"-stdlib=libstdc++\",\u00a0but this was rejected by sage's gcc in both flags.",
    "created_at": "2015-05-23T13:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230654",
    "user": "https://github.com/DrXyzzy"
}
```

I finally got a build of sage from source to complete on OS X 10.9.5, using a hint from this posting: https://support.enthought.com/hc/en-us/articles/204469410-OS-X-GCC-Clang-and-Cython-in-10-9-Mavericks. I checked out current sage source (version 6.7) from git://github.com/sagemath/sage.git, moved MacPorts /opt/local to /opt/local0 as usual, then ran make. After about 5 hours the make aborted on the usual error, 

ERROR: compilation failed for package 'mgcv'
...
Error installing package r-3.2.0.p0

I then did

export SAGE_KEEP_BUILT_SPKGS=yes
export CXXFLAGS="-mmacosx-version-min=10.6"
export LDFLAGS="-mmacosx-version-min=10.6"

and re-ran make. Make finished in 38 minutes and the resulting sage binary includes r-3.2.0.

I haven't tried a clean make from scratch, nor have I tested it on OS X 10.10.2 yet. The blog posting cited above also suggests compiler and linker flag of "-stdlib=libstdc++", but this was rejected by sage's gcc in both flags.



---

archive/issue_comments_230655.json:
```json
{
    "body": "Clang only gets picked up when compiling R's own packages, which is done using R's own logic. You can trigger it by hand by unpacking the R tarball and running\n\n```\n$ sage -R CMD INSTALL R-3.2.0/src/library/Recommended/MASS.tgz \n* installing to library \u2018/home/vbraun/Code/sage.git/local/lib/R/library\u2019\n* installing *source* package \u2018MASS\u2019 ...\n** package \u2018MASS\u2019 successfully unpacked and MD5 sums checked\n** libs\ngcc -std=gnu99 -I/home/vbraun/Code/sage.git/local/lib/R//include -DNDEBUG      -fpic  -g -O2   -c MASS.c -o MASS.o\ngcc -std=gnu99 -I/home/vbraun/Code/sage.git/local/lib/R//include -DNDEBUG      -fpic  -g -O2   -c lqs.c -o lqs.o\ngcc -std=gnu99 -shared -L/home/vbraun/Code/sage.git/local/lib/R//lib -L/home/vbraun/Code/sage.git/local/lib/ -o MASS.so MASS.o lqs.o -L/home/vbraun/Code/sage.git/local/lib/R//lib -lR\ninstalling to /home/vbraun/Code/sage.git/local/lib/R/library/MASS/libs\n** R\n** data\n*** moving datasets to lazyload DB\n** inst\n** byte-compile and prepare package for lazy loading\n** help\n*** installing help indices\n** building package indices\n** testing if installed package can be loaded\n* DONE (MASS)\n``` \nThe CFLAGS/CXXFLAGS should be equivalent to \n\n```\n$ MACOSX_DEPLOYMENT_TARGET=10.6 sage -R CMD INSTALL R-3.2.0/src/library/Recommended/MASS.tgz\n```\nmaybe you can give this a try?",
    "created_at": "2015-05-23T14:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230655",
    "user": "https://github.com/vbraun"
}
```

Clang only gets picked up when compiling R's own packages, which is done using R's own logic. You can trigger it by hand by unpacking the R tarball and running

```
$ sage -R CMD INSTALL R-3.2.0/src/library/Recommended/MASS.tgz 
* installing to library ‘/home/vbraun/Code/sage.git/local/lib/R/library’
* installing *source* package ‘MASS’ ...
** package ‘MASS’ successfully unpacked and MD5 sums checked
** libs
gcc -std=gnu99 -I/home/vbraun/Code/sage.git/local/lib/R//include -DNDEBUG      -fpic  -g -O2   -c MASS.c -o MASS.o
gcc -std=gnu99 -I/home/vbraun/Code/sage.git/local/lib/R//include -DNDEBUG      -fpic  -g -O2   -c lqs.c -o lqs.o
gcc -std=gnu99 -shared -L/home/vbraun/Code/sage.git/local/lib/R//lib -L/home/vbraun/Code/sage.git/local/lib/ -o MASS.so MASS.o lqs.o -L/home/vbraun/Code/sage.git/local/lib/R//lib -lR
installing to /home/vbraun/Code/sage.git/local/lib/R/library/MASS/libs
** R
** data
*** moving datasets to lazyload DB
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded
* DONE (MASS)
``` 
The CFLAGS/CXXFLAGS should be equivalent to 

```
$ MACOSX_DEPLOYMENT_TARGET=10.6 sage -R CMD INSTALL R-3.2.0/src/library/Recommended/MASS.tgz
```
maybe you can give this a try?



---

archive/issue_comments_230656.json:
```json
{
    "body": "Also, make sure you don't override the compiler in `~/.R/Makevars`",
    "created_at": "2015-05-23T14:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230656",
    "user": "https://github.com/vbraun"
}
```

Also, make sure you don't override the compiler in `~/.R/Makevars`



---

archive/issue_comments_230657.json:
```json
{
    "body": "Thank you. Makevars might be the whole problem.\n\nBoth Macs have ~/.R/Makevars with\nCC=clang\nCXX=clang++\nTimestamps are Oct 4 2014 on the OS X 10.9 system and Oct 1 2014 on the OS X 10.10 system, around the time I first noticed builds failing at the r package. I don't recall setting that file manually, but was trying several ways of building R at the time.\n\nSimply removing ~/.R/Makevars might be all that is needed. I moved aside ~/.R/Makevars, the R package, and its install marker file, unset CXXFLAGS and LDFLAGS, and ran make at the top level of sage git repo. The build ran (starting with r) to completion. Will try a full build next. Those take 6-8 hours.\n\nP.S.: I tried unpacking R and building MASS as you suggested. MASS built and seemed to install successfully, but the build used clang as a compiler, both before and after I moved aside ~/.R/Makevars",
    "created_at": "2015-05-24T13:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230657",
    "user": "https://github.com/DrXyzzy"
}
```

Thank you. Makevars might be the whole problem.

Both Macs have ~/.R/Makevars with
CC=clang
CXX=clang++
Timestamps are Oct 4 2014 on the OS X 10.9 system and Oct 1 2014 on the OS X 10.10 system, around the time I first noticed builds failing at the r package. I don't recall setting that file manually, but was trying several ways of building R at the time.

Simply removing ~/.R/Makevars might be all that is needed. I moved aside ~/.R/Makevars, the R package, and its install marker file, unset CXXFLAGS and LDFLAGS, and ran make at the top level of sage git repo. The build ran (starting with r) to completion. Will try a full build next. Those take 6-8 hours.

P.S.: I tried unpacking R and building MASS as you suggested. MASS built and seemed to install successfully, but the build used clang as a compiler, both before and after I moved aside ~/.R/Makevars



---

archive/issue_comments_230658.json:
```json
{
    "body": "Can you try this branch (with `~/.R/Makevars` in place)?\n\n---\nNew commits:",
    "created_at": "2015-05-24T13:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230658",
    "user": "https://github.com/vbraun"
}
```

Can you try this branch (with `~/.R/Makevars` in place)?

---
New commits:



---

archive/issue_comments_230659.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-24T13:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230659",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230660.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-24T18:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230660",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpswanson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230661.json:
```json
{
    "body": "Works for me, thanks Volker!",
    "created_at": "2015-05-24T18:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230661",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpswanson"
}
```

Works for me, thanks Volker!



---

archive/issue_comments_230662.json:
```json
{
    "body": "Another + review. Commit \u200bbb5c9f3 builds successfully on OS X 10.10.1 with ~/.R/Makevars in place with contents:\nCC=clang\nCXX=clang++\n\nShould the milestone for this ticket be changed from 6.5 to 6.8? What is that trac field used for?\n\nThank you.",
    "created_at": "2015-05-25T01:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230662",
    "user": "https://github.com/DrXyzzy"
}
```

Another + review. Commit ​bb5c9f3 builds successfully on OS X 10.10.1 with ~/.R/Makevars in place with contents:
CC=clang
CXX=clang++

Should the milestone for this ticket be changed from 6.5 to 6.8? What is that trac field used for?

Thank you.



---

archive/issue_comments_230663.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-25T07:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230663",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050434.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-25T07:29:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17572#event-50434"
}
```



---

archive/issue_events_050435.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-05-26T12:22:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17572#event-50435"
}
```



---

archive/issue_comments_230664.json:
```json
{
    "body": "bb5c9f3a2d9a6edcffe787716faa91fa5fd4aed6 breaks the installation of several R packages (among them \"git2r\", on which devtools depends).\n\nBreakage reported as #18691",
    "created_at": "2015-06-12T20:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17572#issuecomment-230664",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

bb5c9f3a2d9a6edcffe787716faa91fa5fd4aed6 breaks the installation of several R packages (among them "git2r", on which devtools depends).

Breakage reported as #18691
