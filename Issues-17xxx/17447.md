# Issue 17447: Clarify and complete documentation of function()

archive/issues_017210.json:
```json
{
    "assignees": [],
    "body": "The documentation of function() is incomplete and confusing.\nFor example, none of the methods described in http://www.sagemath.org/doc/reference/calculus/sage/symbolic/function_factory.html show up when I type:\n\n```\nfunction?\n```\nThe distinction between \n\n```\nf = function('f')\n```\nand\n\n```\nf = function('f', x)\n```\nis also not documented. See also #17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?\nSee the following example, where f is first an expression, then becomes redefined to a function in the background, but does not contain any information about its variables. \n\n```\nsage: f = function('f', x); print type(f)\n<type 'sage.symbolic.expression.Expression'>\nsage: fx = function('f',x); print type(f)\n<class 'sage.symbolic.function_factory.NewSymbolicFunction'>\nsage: f.variables()\n()\nsage: fx.variables()\n(x,)\n\n```\n\nSee http://ask.sagemath.org/question/9932/how-to-substitute-a-function-within-derivatives/?answer=14752#post-id-14752 for a possible start at how to explain this, at least for those writing this.\n\nCC:  @nbruin @kcrisman tmonteil @zimmermann6\n\nBranch/Commit: **[7c029f3](https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b)**\n\nReviewer: **Ralf Stephan, Nils Bruin**\n\nAuthor: **Nils Bruin, Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17447_\n\n",
    "closed_at": "2015-11-11T19:40:44Z",
    "created_at": "2014-12-05T10:43:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Clarify and complete documentation of function()",
    "type": "issue",
    "updated_at": "2015-11-11T19:40:44Z",
    "url": "https://github.com/sagemath/sage/issues/17447",
    "user": "https://github.com/sagetrac-schymans"
}
```
The documentation of function() is incomplete and confusing.
For example, none of the methods described in http://www.sagemath.org/doc/reference/calculus/sage/symbolic/function_factory.html show up when I type:

```
function?
```
The distinction between 

```
f = function('f')
```
and

```
f = function('f', x)
```
is also not documented. See also #17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?
See the following example, where f is first an expression, then becomes redefined to a function in the background, but does not contain any information about its variables. 

```
sage: f = function('f', x); print type(f)
<type 'sage.symbolic.expression.Expression'>
sage: fx = function('f',x); print type(f)
<class 'sage.symbolic.function_factory.NewSymbolicFunction'>
sage: f.variables()
()
sage: fx.variables()
(x,)

```

See http://ask.sagemath.org/question/9932/how-to-substitute-a-function-within-derivatives/?answer=14752#post-id-14752 for a possible start at how to explain this, at least for those writing this.

CC:  @nbruin @kcrisman tmonteil @zimmermann6

Branch/Commit: **[7c029f3](https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b)**

Reviewer: **Ralf Stephan, Nils Bruin**

Author: **Nils Bruin, Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/17447_





---

archive/issue_events_222774.json:
```json
{
    "actor": "https://github.com/sagetrac-schymans",
    "created_at": "2014-12-05T10:43:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222774"
}
```



---

archive/issue_events_222775.json:
```json
{
    "actor": "https://github.com/sagetrac-schymans",
    "created_at": "2014-12-05T10:43:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222775"
}
```



---

archive/issue_events_222776.json:
```json
{
    "actor": "https://github.com/sagetrac-schymans",
    "created_at": "2014-12-05T10:43:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222776"
}
```



---

archive/issue_events_222777.json:
```json
{
    "actor": "https://github.com/sagetrac-schymans",
    "created_at": "2014-12-05T10:43:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222777"
}
```



---

archive/issue_comments_236074.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,7 +14,7 @@\n ```\n f = function('f', x)\n ```\n-is also not documented. See also http://trac.sagemath.org/ticket/17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?\n+is also not documented. See also #17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?\n See the following example, where f is first an expression, then becomes redefined to a function in the background, but does not contain any information about its variables. \n \n ```\n``````\n",
    "created_at": "2014-12-05T14:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236074",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,7 +14,7 @@
 ```
 f = function('f', x)
 ```
-is also not documented. See also http://trac.sagemath.org/ticket/17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?
+is also not documented. See also #17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?
 See the following example, where f is first an expression, then becomes redefined to a function in the background, but does not contain any information about its variables. 
 
 ```
``````




---

archive/issue_comments_236075.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,4 @@\n \n ```\n \n+See http://ask.sagemath.org/question/9932/how-to-substitute-a-function-within-derivatives/?answer=14752#post-id-14752 for a possible start at how to explain this, at least for those writing this.\n``````\n",
    "created_at": "2014-12-05T14:10:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236075",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,4 @@
 
 ```
 
+See http://ask.sagemath.org/question/9932/how-to-substitute-a-function-within-derivatives/?answer=14752#post-id-14752 for a possible start at how to explain this, at least for those writing this.
``````




---

archive/issue_comments_236076.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nFor the question about creation and overwriting:\n\nThe toplevel `function` has the sideeffect of inserting a binding in the global scope, just as the toplevel `var` does.\n\n```\nsage: var('U')\nU\nsage: U\nU\nsage: function('f')\nf\nsage: f\nf\n```\nThe library versions of these routines don't do that:\n\n```\nsage: SR.var('V')\nV\nsage: V\nNameError: name 'V' is not defined\nsage: sage.symbolic.function_factory.function('g')\ng\nsage: g\nNameError: name 'g' is not defined\n```\nThe intended use of the toplevel `function` is *not* to be assigned but to be called as a statement, just as `var`. There is plenty of documentation in sage that was written by people unaware of this fact (or possibly they think they're being helpful by providing code that doesn't return an error when used with the library versions of these functions)\n\nAs a result `x=var('x')` and `fx=function('f',x)` are quite ubiquitous in the docs. The former is fairly inocuous but the second, as you experience, has a rather nasty side effect. We're violating python's convention here: routines with side effects should return None.\n\nI think this is the point where people usually give up fixing this mess (I have). Hopefully you will now follow through.\n\nNote that we can probably not do more than document the issues, which is not going to fix much, because people won't read the doc, but then at least you can point them somewhere when they complain.\n\nI suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\n(this is the kind of issue that earns sage the reputation of \"implement now, design later\")",
    "created_at": "2014-12-05T19:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236076",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'>Comment 3:</a>
For the question about creation and overwriting:

The toplevel `function` has the sideeffect of inserting a binding in the global scope, just as the toplevel `var` does.

```
sage: var('U')
U
sage: U
U
sage: function('f')
f
sage: f
f
```
The library versions of these routines don't do that:

```
sage: SR.var('V')
V
sage: V
NameError: name 'V' is not defined
sage: sage.symbolic.function_factory.function('g')
g
sage: g
NameError: name 'g' is not defined
```
The intended use of the toplevel `function` is *not* to be assigned but to be called as a statement, just as `var`. There is plenty of documentation in sage that was written by people unaware of this fact (or possibly they think they're being helpful by providing code that doesn't return an error when used with the library versions of these functions)

As a result `x=var('x')` and `fx=function('f',x)` are quite ubiquitous in the docs. The former is fairly inocuous but the second, as you experience, has a rather nasty side effect. We're violating python's convention here: routines with side effects should return None.

I think this is the point where people usually give up fixing this mess (I have). Hopefully you will now follow through.

Note that we can probably not do more than document the issues, which is not going to fix much, because people won't read the doc, but then at least you can point them somewhere when they complain.

I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

(this is the kind of issue that earns sage the reputation of "implement now, design later")



---

archive/issue_events_222778.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-25T09:33:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222778"
}
```



---

archive/issue_events_222779.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-25T09:33:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222779"
}
```



---

archive/issue_comments_236077.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nAwesome, thank you, Nils. These things always confused me, so I'm relieved to hear that they should be avoided! Even the documentation of var is full of such examples:\n\n```\nsage: x = var('x', domain=RR); x; x.conjugate()\nx\nx\nsage: y = var('y', domain='real'); y.conjugate()\ny\nsage: y = var('y', domain='positive'); y.abs()\ny\n\nCustom latex expression can be assigned to variable:\n\nsage: x = var('sui', latex_name=\"s_{u,i}\"); x._latex_()\n's_{u,i}'\n\n```\n\nShould we change these examples, too?",
    "created_at": "2015-01-06T22:26:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236077",
    "user": "https://github.com/sagetrac-schymans"
}
```

<a id='comment:5'>Comment 5:</a>
Awesome, thank you, Nils. These things always confused me, so I'm relieved to hear that they should be avoided! Even the documentation of var is full of such examples:

```
sage: x = var('x', domain=RR); x; x.conjugate()
x
x
sage: y = var('y', domain='real'); y.conjugate()
y
sage: y = var('y', domain='positive'); y.abs()
y

Custom latex expression can be assigned to variable:

sage: x = var('sui', latex_name="s_{u,i}"); x._latex_()
's_{u,i}'

```

Should we change these examples, too?



---

archive/issue_comments_236078.json:
```json
{
    "body": "Branch: **[u/nbruin/clarify_and_complete_documentation_of_function__](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/clarify_and_complete_documentation_of_function__)**",
    "created_at": "2015-01-08T22:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236078",
    "user": "https://github.com/nbruin"
}
```

Branch: **[u/nbruin/clarify_and_complete_documentation_of_function__](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/clarify_and_complete_documentation_of_function__)**



---

archive/issue_comments_236079.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nDon't base any other work on this branch just yet, since it's likely to be rebased. I have deprecated the use of `function('f',x)` in favour of using `function('f')(x)`. It's hardly longer to type and much less ambiguous. Otherwise, it seems that the documentation here is actually pretty accurate, apart from being terse. As soon as the objects returned by `function('f')` are consistent, I think users will be forced to learn the (now clear) semantics pretty quickly.\n\nThe object returned by `function(f)` doesn't allow symbolic operations on it, so people will quickly find they need to evaluate it in order to get a symbolic expression.\n\nI haven't changed all doctests to take into account the deprecation, but I've done some files to show the impact of the change (seems relatively minor).",
    "created_at": "2015-01-08T22:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236079",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'>Comment 6:</a>
Don't base any other work on this branch just yet, since it's likely to be rebased. I have deprecated the use of `function('f',x)` in favour of using `function('f')(x)`. It's hardly longer to type and much less ambiguous. Otherwise, it seems that the documentation here is actually pretty accurate, apart from being terse. As soon as the objects returned by `function('f')` are consistent, I think users will be forced to learn the (now clear) semantics pretty quickly.

The object returned by `function(f)` doesn't allow symbolic operations on it, so people will quickly find they need to evaluate it in order to get a symbolic expression.

I haven't changed all doctests to take into account the deprecation, but I've done some files to show the impact of the change (seems relatively minor).



---

archive/issue_comments_236080.json:
```json
{
    "body": "Commit: **[fa3ebd6](https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506)**",
    "created_at": "2015-01-08T23:01:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236080",
    "user": "https://github.com/nbruin"
}
```

Commit: **[fa3ebd6](https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506)**



---

archive/issue_events_222780.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-01-08T23:01:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222780"
}
```



---

archive/issue_comments_236081.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nNot really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b41248b13e18744ab9902adde9b7740832bb1724\">b41248b</a></td><td><code>trac 17447: Deprecation of function('f',x) in favour of function('f')(x)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506\">fa3ebd6</a></td><td><code>trac 17447: Doctest changes to reflect deprecation of function('f',x)</code></td></tr></table>\n\n---\nnote that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`",
    "created_at": "2015-01-08T23:01:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236081",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'>Comment 7:</a>
Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b41248b13e18744ab9902adde9b7740832bb1724">b41248b</a></td><td><code>trac 17447: Deprecation of function('f',x) in favour of function('f')(x)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506">fa3ebd6</a></td><td><code>trac 17447: Doctest changes to reflect deprecation of function('f',x)</code></td></tr></table>

---
note that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`



---

archive/issue_comments_236082.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@nbruin](#comment%3A7):\n> Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.\n> \n> ---\n> New commits:\n> |                                                                                                                                                 |                                                                          |\n> |-------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n> |[b41248b](https://github.com/sagemath/sagetrac-mirror/commit/b41248b13e18744ab9902adde9b7740832bb1724)|`trac 17447: Deprecation of function('f',x) in favour of function('f')(x)`|\n> |[fa3ebd6](https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506)|`trac 17447: Doctest changes to reflect deprecation of function('f',x)`|\n> \n> ---\n> note that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`\n\nThis makes it a lot clearer to me now. Just a minor thing:\nIn one of the examples, I would replace \n\n```\nsage: cr = function('cr')\nsage: f = cr(a)\n```\n\nby\n\n```\nsage: function('cr')\nsage: f = cr(a)\n```\n\nwhich in my understanding does the same but is shorter and makes clear that `function('cr')` does already create a symbolic function called `cr`. Otherwise, one may be surprised to create two functions by typing e.g. `cr1 = function('cr')`.",
    "created_at": "2015-01-11T22:13:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236082",
    "user": "https://github.com/sagetrac-schymans"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@nbruin](#comment%3A7):
> Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.
> 
> ---
> New commits:
> |                                                                                                                                                 |                                                                          |
> |-------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
> |[b41248b](https://github.com/sagemath/sagetrac-mirror/commit/b41248b13e18744ab9902adde9b7740832bb1724)|`trac 17447: Deprecation of function('f',x) in favour of function('f')(x)`|
> |[fa3ebd6](https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506)|`trac 17447: Doctest changes to reflect deprecation of function('f',x)`|
> 
> ---
> note that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`

This makes it a lot clearer to me now. Just a minor thing:
In one of the examples, I would replace 

```
sage: cr = function('cr')
sage: f = cr(a)
```

by

```
sage: function('cr')
sage: f = cr(a)
```

which in my understanding does the same but is shorter and makes clear that `function('cr')` does already create a symbolic function called `cr`. Otherwise, one may be surprised to create two functions by typing e.g. `cr1 = function('cr')`.



---

archive/issue_comments_236083.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [schymans](#comment%3A8):\n> This makes it a lot clearer to me now. Just a minor thing:\n> In one of the examples, I would replace \n> \n> ```\n> sage: cr = function('cr')\n> sage: f = cr(a)\n> ```\n\nAt least one occurrence of that is in the doctest of `sage.symbolic.function_factory.function`, which (now) goes out of its way to import *that* function, which does *not* have the side-effect of mutating the global scope, as documented. So the assignment is actually necessary.\n\nAnother independent point: the top-level `function` does refer to `sage.symbolic.function_factory.function`, but perhaps should do so more explicitly, if possible with a hyperlink. The examples on the latter are a little more elaborate, so someone who wants to read up on `function` (and would probably find the top-level documentation first via `sage: function?`). I don't know how to make hyperlinks to other documentation in sage's docstrings.",
    "created_at": "2015-01-12T00:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236083",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [schymans](#comment%3A8):
> This makes it a lot clearer to me now. Just a minor thing:
> In one of the examples, I would replace 
> 
> ```
> sage: cr = function('cr')
> sage: f = cr(a)
> ```

At least one occurrence of that is in the doctest of `sage.symbolic.function_factory.function`, which (now) goes out of its way to import *that* function, which does *not* have the side-effect of mutating the global scope, as documented. So the assignment is actually necessary.

Another independent point: the top-level `function` does refer to `sage.symbolic.function_factory.function`, but perhaps should do so more explicitly, if possible with a hyperlink. The examples on the latter are a little more elaborate, so someone who wants to read up on `function` (and would probably find the top-level documentation first via `sage: function?`). I don't know how to make hyperlinks to other documentation in sage's docstrings.



---

archive/issue_comments_236084.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThere are broken doctests in the 'doc' folder\n\n```\nsage -t --long prep/Quickstarts/Differential-Equations.rst  # 1 doctest failed\nsage -t --long tutorial/tour_algebra.rst  # 1 doctest failed\nsage -t --long constructions/calculus.rst  # 1 doctest failed\n```\n\nNathann",
    "created_at": "2015-01-13T08:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236084",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'>Comment 10:</a>
There are broken doctests in the 'doc' folder

```
sage -t --long prep/Quickstarts/Differential-Equations.rst  # 1 doctest failed
sage -t --long tutorial/tour_algebra.rst  # 1 doctest failed
sage -t --long constructions/calculus.rst  # 1 doctest failed
```

Nathann



---

archive/issue_events_222781.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-01-13T08:18:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222781"
}
```



---

archive/issue_events_222782.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-01-13T08:18:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222782"
}
```



---

archive/issue_comments_236085.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@nathanncohen](#comment%3A10):\n> There are broken doctests in the 'doc' folder\n\nYes, and that is not the only place. First we need to see if there is any good reason why `function('f',x)` is preferable over `function('f')(x)`, of if we can get away with deprecating this confusing construction. And then someone should take a look at the doc to see if it needs further improvement. You're on a doc revamping binge, so this might just be the task for you!",
    "created_at": "2015-01-13T16:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236085",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@nathanncohen](#comment%3A10):
> There are broken doctests in the 'doc' folder

Yes, and that is not the only place. First we need to see if there is any good reason why `function('f',x)` is preferable over `function('f')(x)`, of if we can get away with deprecating this confusing construction. And then someone should take a look at the doc to see if it needs further improvement. You're on a doc revamping binge, so this might just be the task for you!



---

archive/issue_comments_236086.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\n> You're on a doc revamping binge, so this might just be the task for you!\n\nI am afraid that you will have to find somebody else. I never used Sage's symbolics.\n\nNathann",
    "created_at": "2015-01-13T16:26:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236086",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'>Comment 12:</a>
> You're on a doc revamping binge, so this might just be the task for you!

I am afraid that you will have to find somebody else. I never used Sage's symbolics.

Nathann



---

archive/issue_comments_236087.json:
```json
{
    "body": "Changed branch from **[u/nbruin/clarify_and_complete_documentation_of_function__](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/clarify_and_complete_documentation_of_function__)** to **[public/17447](https://github.com/sagemath/sagetrac-mirror/tree/public/17447)**",
    "created_at": "2015-02-01T16:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236087",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/nbruin/clarify_and_complete_documentation_of_function__](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/clarify_and_complete_documentation_of_function__)** to **[public/17447](https://github.com/sagemath/sagetrac-mirror/tree/public/17447)**



---

archive/issue_comments_236088.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThat fixes the three above marked doctests.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3ef9195793c87d54b088823e06438e647cc6d89\">e3ef919</a></td><td><code>Merge branch 'develop' into t/17447/clarify_and_complete_documentation_of_function__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6a35343e5f712b88a5a9a80abd4e9302879c187\">e6a3534</a></td><td><code>17447: reviewer's patch: fix rst doctests</code></td></tr></table>\n",
    "created_at": "2015-02-01T16:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236088",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'>Comment 15:</a>
That fixes the three above marked doctests.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3ef9195793c87d54b088823e06438e647cc6d89">e3ef919</a></td><td><code>Merge branch 'develop' into t/17447/clarify_and_complete_documentation_of_function__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6a35343e5f712b88a5a9a80abd4e9302879c187">e6a3534</a></td><td><code>17447: reviewer's patch: fix rst doctests</code></td></tr></table>




---

archive/issue_comments_236089.json:
```json
{
    "body": "Changed commit from **[fa3ebd6](https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506)** to **[e6a3534](https://github.com/sagemath/sagetrac-mirror/commit/e6a35343e5f712b88a5a9a80abd4e9302879c187)**",
    "created_at": "2015-02-01T16:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236089",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[fa3ebd6](https://github.com/sagemath/sagetrac-mirror/commit/fa3ebd6645eb2cae45c2218628eaa1d984f16506)** to **[e6a3534](https://github.com/sagemath/sagetrac-mirror/commit/e6a35343e5f712b88a5a9a80abd4e9302879c187)**



---

archive/issue_comments_236090.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4585e74063e81a8c332a500d016e837069edf8eb\">4585e74</a></td><td><code>17447: fix rest of doctests</code></td></tr></table>\n",
    "created_at": "2015-02-02T08:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236090",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4585e74063e81a8c332a500d016e837069edf8eb">4585e74</a></td><td><code>17447: fix rest of doctests</code></td></tr></table>




---

archive/issue_comments_236091.json:
```json
{
    "body": "Changed commit from **[e6a3534](https://github.com/sagemath/sagetrac-mirror/commit/e6a35343e5f712b88a5a9a80abd4e9302879c187)** to **[4585e74](https://github.com/sagemath/sagetrac-mirror/commit/4585e74063e81a8c332a500d016e837069edf8eb)**",
    "created_at": "2015-02-02T08:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236091",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e6a3534](https://github.com/sagemath/sagetrac-mirror/commit/e6a35343e5f712b88a5a9a80abd4e9302879c187)** to **[4585e74](https://github.com/sagemath/sagetrac-mirror/commit/4585e74063e81a8c332a500d016e837069edf8eb)**



---

archive/issue_comments_236092.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2015-02-02T08:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236092",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_236093.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThese are the remaining doctest fixes coming from `make ptestlong`. I have reviewed and found fine the commits up to mine, so following reviewers can skip that.\n> And then someone should take a look at the doc to see if it needs further improvement.",
    "created_at": "2015-02-02T08:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236093",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'>Comment 17:</a>
These are the remaining doctest fixes coming from `make ptestlong`. I have reviewed and found fine the commits up to mine, so following reviewers can skip that.
> And then someone should take a look at the doc to see if it needs further improvement.



---

archive/issue_comments_236094.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\n> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\nCc:ing him for that reason.  Though we have already had a few other discussions on Trac about the need to update our tests while not maintaining exact compatibility.  Since they don't (yet) raise errors, but apparently only the deprecation warning, should we maybe update the tests (in that part only) to have the deprecation warning returned?  Note that I don't believe the deprecation warning is even doctested, which is a no-no :)\n\nAlso, does the current branch actually \"clarify and complete documentation of function\"?  It looks like it mostly fixes doctests.\n\nAnother change not doctested is\n\n```\n     if is_SymbolicVariable(dvar):\n-        raise ValueError(\"You have to declare dependent variable as a function, eg. y=function('y',x)\")\n+        raise ValueError(\"You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)\")\n```\nwhich I think happens twice.\n\nI'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was \"right\" in the sense that one wanted that returned, and have we shown how to get that object?  What about the ask.sagemath question?\n\nAll that to say that nonetheless it will be great to have a unified interface on this, if that is really the right thing to do, which from the comments it apparently is.",
    "created_at": "2015-02-03T01:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236094",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'>Comment 18:</a>
> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

Cc:ing him for that reason.  Though we have already had a few other discussions on Trac about the need to update our tests while not maintaining exact compatibility.  Since they don't (yet) raise errors, but apparently only the deprecation warning, should we maybe update the tests (in that part only) to have the deprecation warning returned?  Note that I don't believe the deprecation warning is even doctested, which is a no-no :)

Also, does the current branch actually "clarify and complete documentation of function"?  It looks like it mostly fixes doctests.

Another change not doctested is

```
     if is_SymbolicVariable(dvar):
-        raise ValueError("You have to declare dependent variable as a function, eg. y=function('y',x)")
+        raise ValueError("You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)")
```
which I think happens twice.

I'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was "right" in the sense that one wanted that returned, and have we shown how to get that object?  What about the ask.sagemath question?

All that to say that nonetheless it will be great to have a unified interface on this, if that is really the right thing to do, which from the comments it apparently is.



---

archive/issue_comments_236095.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@kcrisman](#comment%3A18):\n> Also, does the current branch actually \"clarify and complete documentation of function\"?  It looks like it mostly fixes doctests.\n\nI think there are two things that are/were confusing:\n- `function('f',x)` returns something that is not, according to our definition, a function (e.g., it cannot be evaluated (\"called\") in a non-ambiguous way and hence triggers a deprecation warning)).\n- The top-level `function` makes a binding in the global namespace and returns a value. The two were different.\n\nWith the proposed patch, `function('f',x)` is deprecated, so number 1 gets eliminated and number 2 is less confusing because, while it still injects something in the namespace, the value it returns is always the same as what it injects.\n\nWhen I read the documentation of `sage.symbolic.function_factory.function`, I actually thought it described what happens fairly correctly, and it has good examples. Hence I did not feel the need to add to it. The top-level `function` documentation is rather sparse, so that could use expansion. However, we do not want to repeat ourselves, so perhaps it should just contain a clear pointer (hyperlink?) to the documentation of `sage.symbolic.function_factory.function`. I don't know how to do that, so please go ahead and improve that bit. You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.\n\n> Another change not doctested is\n> \n> ```\n>      if is_SymbolicVariable(dvar):\n> -        raise ValueError(\"You have to declare dependent variable as a function, eg. y=function('y',x)\")\n> +        raise ValueError(\"You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)\")\n> ```\n> which I think happens twice.\n\nThese messages weren't doctested before either. If you feel the projects benefits from such administrations, go ahead.\n\n> I'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was \"right\" in the sense that one wanted that returned, and have we shown how to get that object?\n\nIn my opinion: no. In all cases, `function('f')(x)` is much clearer and not much longer than `function('f',x)`. There are *many* tickets and questions about people getting tripped up by the fact that a function called function doesn't return a function.\n\n> What about the ask.sagemath question?\n\nIn my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.",
    "created_at": "2015-02-03T02:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236095",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@kcrisman](#comment%3A18):
> Also, does the current branch actually "clarify and complete documentation of function"?  It looks like it mostly fixes doctests.

I think there are two things that are/were confusing:
- `function('f',x)` returns something that is not, according to our definition, a function (e.g., it cannot be evaluated ("called") in a non-ambiguous way and hence triggers a deprecation warning)).
- The top-level `function` makes a binding in the global namespace and returns a value. The two were different.

With the proposed patch, `function('f',x)` is deprecated, so number 1 gets eliminated and number 2 is less confusing because, while it still injects something in the namespace, the value it returns is always the same as what it injects.

When I read the documentation of `sage.symbolic.function_factory.function`, I actually thought it described what happens fairly correctly, and it has good examples. Hence I did not feel the need to add to it. The top-level `function` documentation is rather sparse, so that could use expansion. However, we do not want to repeat ourselves, so perhaps it should just contain a clear pointer (hyperlink?) to the documentation of `sage.symbolic.function_factory.function`. I don't know how to do that, so please go ahead and improve that bit. You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.

> Another change not doctested is
> 
> ```
>      if is_SymbolicVariable(dvar):
> -        raise ValueError("You have to declare dependent variable as a function, eg. y=function('y',x)")
> +        raise ValueError("You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)")
> ```
> which I think happens twice.

These messages weren't doctested before either. If you feel the projects benefits from such administrations, go ahead.

> I'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was "right" in the sense that one wanted that returned, and have we shown how to get that object?

In my opinion: no. In all cases, `function('f')(x)` is much clearer and not much longer than `function('f',x)`. There are *many* tickets and questions about people getting tripped up by the fact that a function called function doesn't return a function.

> What about the ask.sagemath question?

In my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.



---

archive/issue_comments_236096.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\n> The top-level function documentation is rather sparse, so that could use expansion.\n\nYes, this is what I meant.  Hyperlink is tricky - not per se, but in command line and even sagenb it's not as useful.  So I figure at least a little more in the top-level and then the hyperlink (assuming that file is in fact already in the documentation!).\n\n> You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.\n\nThat is very kind, I will see; this one is lower on my priority list but definitely important.\n\n> If you feel the projects benefits from such administrations, go ahead.\n\nWell, I've found it does.  I guess I will ask you to review it if I do that :-)\n\n> In my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.\n\nYes.",
    "created_at": "2015-02-03T02:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236096",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'>Comment 20:</a>
> The top-level function documentation is rather sparse, so that could use expansion.

Yes, this is what I meant.  Hyperlink is tricky - not per se, but in command line and even sagenb it's not as useful.  So I figure at least a little more in the top-level and then the hyperlink (assuming that file is in fact already in the documentation!).

> You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.

That is very kind, I will see; this one is lower on my priority list but definitely important.

> If you feel the projects benefits from such administrations, go ahead.

Well, I've found it does.  I guess I will ask you to review it if I do that :-)

> In my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.

Yes.



---

archive/issue_comments_236097.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@kcrisman](#comment%3A18):\n> > I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\n> \n> Cc:ing him for that reason.\n\nthanks, however I gave up trying to maintain compatibility with the book, since there\nare already many examples from the book that we put as doctests in Sage, and which were changed afterwards...",
    "created_at": "2015-02-03T07:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236097",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@kcrisman](#comment%3A18):
> > I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

> 
> Cc:ing him for that reason.

thanks, however I gave up trying to maintain compatibility with the book, since there
are already many examples from the book that we put as doctests in Sage, and which were changed afterwards...



---

archive/issue_comments_236098.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nHere is another example of something confusing.\n\nhttp://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/",
    "created_at": "2015-03-09T23:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236098",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'>Comment 22:</a>
Here is another example of something confusing.

http://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/



---

archive/issue_comments_236099.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@kcrisman](#comment%3A22):\n> Here is another example of something confusing.\n> \n> http://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/\n\nI think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).\n\nInitially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.",
    "created_at": "2015-03-10T01:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236099",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@kcrisman](#comment%3A22):
> Here is another example of something confusing.
> 
> http://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/

I think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).

Initially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.



---

archive/issue_comments_236100.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@nbruin](#comment%3A23):\n> Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.\n\nThat would be awesome! Much more consistent AND flexible. +1 from me.",
    "created_at": "2015-03-11T07:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236100",
    "user": "https://github.com/sagetrac-schymans"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@nbruin](#comment%3A23):
> Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.

That would be awesome! Much more consistent AND flexible. +1 from me.



---

archive/issue_comments_236101.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@nbruin](#comment%3A23):\n> I think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).\n> \n> Initially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.\n\nSee #17958 for `declare_var` and no, this is still a good idea.",
    "created_at": "2015-03-14T15:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236101",
    "user": "https://github.com/rwst"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@nbruin](#comment%3A23):
> I think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).
> 
> Initially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.

See #17958 for `declare_var` and no, this is still a good idea.



---

archive/issue_comments_236102.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@nbruin](#comment%3A3):\n> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\nI'm not sure about `function()` and have little time to check now, but regarding `var()`, I think we tried to always use `x = SR.var('x')`.\n\nAnd IMO, the version of `var` that injects a variable in the global namespace should simply be deprecated, or possibly moved to `sage.ext.inteactive_constructors_c` if someone really care about it.",
    "created_at": "2015-03-15T10:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236102",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@nbruin](#comment%3A3):
> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

I'm not sure about `function()` and have little time to check now, but regarding `var()`, I think we tried to always use `x = SR.var('x')`.

And IMO, the version of `var` that injects a variable in the global namespace should simply be deprecated, or possibly moved to `sage.ext.inteactive_constructors_c` if someone really care about it.



---

archive/issue_events_222783.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-12T15:15:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222783"
}
```



---

archive/issue_events_222784.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-12T15:15:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222784"
}
```



---

archive/issue_events_222785.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-12T15:15:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222785"
}
```



---

archive/issue_events_222786.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-12T15:15:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222786"
}
```



---

archive/issue_comments_236103.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nSo, [comment:17](#comment%3A17) gave part of a review. Can someone please complete it?",
    "created_at": "2015-04-12T15:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236103",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'>Comment 27:</a>
So, [comment:17](#comment%3A17) gave part of a review. Can someone please complete it?



---

archive/issue_comments_236104.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\n\n```\nsage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed\nsage -t --long src/sage/tests/french_book/calculus_doctest.py  # 1 doctest failed\nsage -t --long src/doc/pt/tutorial/tour_algebra.rst  # 1 doctest failed\nsage -t --long src/sage/combinat/integer_vector.py  # 1 doctest failed\n```",
    "created_at": "2015-06-11T07:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236104",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'>Comment 28:</a>

```
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/tests/french_book/calculus_doctest.py  # 1 doctest failed
sage -t --long src/doc/pt/tutorial/tour_algebra.rst  # 1 doctest failed
sage -t --long src/sage/combinat/integer_vector.py  # 1 doctest failed
```



---

archive/issue_events_222787.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-11T07:36:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222787"
}
```



---

archive/issue_events_222788.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-11T07:36:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222788"
}
```



---

archive/issue_comments_236105.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7956412cef63579521e6f8673a096c9952609a38\">7956412</a></td><td><code>Merge branch 'public/17447' of git://trac.sagemath.org/sage into public/17447</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdc154391e7ce6ceca1226f341ab62579bc3f4ee\">bdc1543</a></td><td><code>trac 17447: further doctest adjustments</code></td></tr></table>\n",
    "created_at": "2015-11-09T23:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236105",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7956412cef63579521e6f8673a096c9952609a38">7956412</a></td><td><code>Merge branch 'public/17447' of git://trac.sagemath.org/sage into public/17447</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdc154391e7ce6ceca1226f341ab62579bc3f4ee">bdc1543</a></td><td><code>trac 17447: further doctest adjustments</code></td></tr></table>




---

archive/issue_comments_236106.json:
```json
{
    "body": "Changed commit from **[4585e74](https://github.com/sagemath/sagetrac-mirror/commit/4585e74063e81a8c332a500d016e837069edf8eb)** to **[bdc1543](https://github.com/sagemath/sagetrac-mirror/commit/bdc154391e7ce6ceca1226f341ab62579bc3f4ee)**",
    "created_at": "2015-11-09T23:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236106",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4585e74](https://github.com/sagemath/sagetrac-mirror/commit/4585e74063e81a8c332a500d016e837069edf8eb)** to **[bdc1543](https://github.com/sagemath/sagetrac-mirror/commit/bdc154391e7ce6ceca1226f341ab62579bc3f4ee)**



---

archive/issue_comments_236107.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b\">7c029f3</a></td><td><code>trac 17447: further doctest adjustments</code></td></tr></table>\n",
    "created_at": "2015-11-10T01:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236107",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b">7c029f3</a></td><td><code>trac 17447: further doctest adjustments</code></td></tr></table>




---

archive/issue_comments_236108.json:
```json
{
    "body": "Changed commit from **[bdc1543](https://github.com/sagemath/sagetrac-mirror/commit/bdc154391e7ce6ceca1226f341ab62579bc3f4ee)** to **[7c029f3](https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b)**",
    "created_at": "2015-11-10T01:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236108",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bdc1543](https://github.com/sagemath/sagetrac-mirror/commit/bdc154391e7ce6ceca1226f341ab62579bc3f4ee)** to **[7c029f3](https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b)**



---

archive/issue_events_222789.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-11-10T01:18:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222789"
}
```



---

archive/issue_events_222790.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-11-10T01:18:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222790"
}
```



---

archive/issue_events_222791.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-11-10T18:35:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222791"
}
```



---

archive/issue_events_222792.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-11-10T18:35:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222792"
}
```



---

archive/issue_comments_236109.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nOK, comments #17 and #27 provide a positive review of the first bit. I give a largely positive review to Ralf's doctest adjustments. There was one overcorrection in `french_book/calculus_doctest.py` that I corrected. The other changes were just parallel corrections to different translations of one document that have been introduced since the last time this ticket was updated.\n\npatchbot is happy and I think all code is positively reviewed now. Ready for merge!",
    "created_at": "2015-11-10T18:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236109",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:32'>Comment 32:</a>
OK, comments #17 and #27 provide a positive review of the first bit. I give a largely positive review to Ralf's doctest adjustments. There was one overcorrection in `french_book/calculus_doctest.py` that I corrected. The other changes were just parallel corrections to different translations of one document that have been introduced since the last time this ticket was updated.

patchbot is happy and I think all code is positively reviewed now. Ready for merge!



---

archive/issue_events_222793.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-11-10T18:35:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222793"
}
```



---

archive/issue_events_222794.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-11-10T18:35:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222794"
}
```



---

archive/issue_comments_236110.json:
```json
{
    "body": "Changed author from **schymans** to **Nils Bruin, Ralf Stephan**",
    "created_at": "2015-11-10T18:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236110",
    "user": "https://github.com/nbruin"
}
```

Changed author from **schymans** to **Nils Bruin, Ralf Stephan**



---

archive/issue_comments_236111.json:
```json
{
    "body": "Changed reviewer from **Ralf Stephan** to **Ralf Stephan, Nils Bruin**",
    "created_at": "2015-11-10T18:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236111",
    "user": "https://github.com/nbruin"
}
```

Changed reviewer from **Ralf Stephan** to **Ralf Stephan, Nils Bruin**



---

archive/issue_events_222795.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-11T19:40:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222795"
}
```



---

archive/issue_events_222796.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "36c1b8a22f175f0d796c8f4f87303ee58618ce9a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-11-11T19:40:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17447#event-222796"
}
```



---

archive/issue_comments_236112.json:
```json
{
    "body": "Changed branch from **[public/17447](https://github.com/sagemath/sagetrac-mirror/tree/public/17447)** to **[7c029f3](https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b)**",
    "created_at": "2015-11-11T19:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17447#issuecomment-236112",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/17447](https://github.com/sagemath/sagetrac-mirror/tree/public/17447)** to **[7c029f3](https://github.com/sagemath/sagetrac-mirror/commit/7c029f3c98032a985c2ca0329dfe940271e9b86b)**
