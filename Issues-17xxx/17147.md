# Issue 17147: Overriding checks to generate poset and lattice faster

archive/issues_016910.json:
```json
{
    "assignees": [],
    "body": "This ticket was originally about overriding checks to make poset creation faster. But this is actually already available: instead of `Poset(...)` one can use `FinitePoset(D, ..., category=FinitePosets, ...)`. For some lattices the time saving is huge, as there is no need to compute meet- or join-matrix; think about `BooleanLattice` used as an example of a poset, not as an example of lattice. (This could be documented somehow, \"Advanced [SageMath](../wiki/SageMath) Hacking\" or something like that.)\n\nHowever, currently for example `Posets.ChainPoset(500)` may takes 10 seconds. That is so because the constructors for common posets and lattices do not use this faster construction. Hence the new aim of the ticket is to change thst.\n\n\nCC:  @tscrim\n\nBranch/Commit: **[b0e5686](https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jori M\u00e4ntysalo**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17147_\n\n",
    "closed_at": "2016-11-27T16:46:02Z",
    "created_at": "2014-10-14T10:06:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Overriding checks to generate poset and lattice faster",
    "type": "issue",
    "updated_at": "2016-11-27T16:46:02Z",
    "url": "https://github.com/sagemath/sage/issues/17147",
    "user": "https://github.com/jm58660"
}
```
This ticket was originally about overriding checks to make poset creation faster. But this is actually already available: instead of `Poset(...)` one can use `FinitePoset(D, ..., category=FinitePosets, ...)`. For some lattices the time saving is huge, as there is no need to compute meet- or join-matrix; think about `BooleanLattice` used as an example of a poset, not as an example of lattice. (This could be documented somehow, "Advanced [SageMath](../wiki/SageMath) Hacking" or something like that.)

However, currently for example `Posets.ChainPoset(500)` may takes 10 seconds. That is so because the constructors for common posets and lattices do not use this faster construction. Hence the new aim of the ticket is to change thst.


CC:  @tscrim

Branch/Commit: **[b0e5686](https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae)**

Reviewer: **Travis Scrimshaw**

Author: **Jori Mäntysalo**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/17147_





---

archive/issue_events_244853.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-14T10:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244853"
}
```



---

archive/issue_events_244854.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-14T10:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244854"
}
```



---

archive/issue_events_244855.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-14T10:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244855"
}
```



---

archive/issue_events_244856.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-14T10:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244856"
}
```



---

archive/issue_events_244857.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-26T11:19:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244857"
}
```



---

archive/issue_events_244858.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-26T11:19:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244858"
}
```



---

archive/issue_events_244859.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-26T11:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244859"
}
```



---

archive/issue_comments_227517.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nTravis, I guess we should close this one. But to be sure:\n\nFirst, if I just say `n = 500; L1 = LatticePoset((range(n), [[x,x+1] for x in range(n-1)]))` it takes about two seconds. But if I say\n\n```\nn = 500\nD = DiGraph([range(n), [[x,x+1] for x in range(n-1)]], format='vertices_and_edges')\nfrom sage.combinat.posets.lattices import FiniteLatticePoset\nL2 = FiniteLatticePoset(D, range(n), FiniteLatticePosets(), True)\n```\n\nit takes only 10 or 20 millisecods. Can you confirm that this works, and so there is a way to override check \"is this poset really a poset (i.e. acyclic transitive reduction of graph)\"?\n\nSecond, another possibility is that the code could directly compute le-matrix, M\u00f6bius function matrix etc, and those would be very easy for a chain, diamond and so one. But that is a place for another ticket.\n\nThird, it is unnecessary to re-compute meet- or join-matrix. But that is a duplicate of #20434 or #18776.",
    "created_at": "2016-09-26T11:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227517",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:2" align="right">comment:2</div>

Travis, I guess we should close this one. But to be sure:

First, if I just say `n = 500; L1 = LatticePoset((range(n), [[x,x+1] for x in range(n-1)]))` it takes about two seconds. But if I say

```
n = 500
D = DiGraph([range(n), [[x,x+1] for x in range(n-1)]], format='vertices_and_edges')
from sage.combinat.posets.lattices import FiniteLatticePoset
L2 = FiniteLatticePoset(D, range(n), FiniteLatticePosets(), True)
```

it takes only 10 or 20 millisecods. Can you confirm that this works, and so there is a way to override check "is this poset really a poset (i.e. acyclic transitive reduction of graph)"?

Second, another possibility is that the code could directly compute le-matrix, Möbius function matrix etc, and those would be very easy for a chain, diamond and so one. But that is a place for another ticket.

Third, it is unnecessary to re-compute meet- or join-matrix. But that is a duplicate of #20434 or #18776.



---

archive/issue_events_244860.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-26T11:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244860"
}
```



---

archive/issue_events_244861.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-09-26T13:59:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244861"
}
```



---

archive/issue_events_244862.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-09-26T13:59:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244862"
}
```



---

archive/issue_events_244863.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-09-26T13:59:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244863"
}
```



---

archive/issue_comments_227518.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI am opting for changing the relevant constructors to avoid the checks, which is a separate from #20434 and #18776.",
    "created_at": "2016-09-26T13:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227518",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

I am opting for changing the relevant constructors to avoid the checks, which is a separate from #20434 and #18776.



---

archive/issue_comments_227519.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@tscrim](#comment:3):\n> I am opting for changing the relevant constructors to avoid the checks, which is a separate from #20434 and #18776.\n\nDo you mean only mandatory checks, i.e. `is_poset` and having a join matrix and a bottom element (or meet matrix and top), or more precomputation?",
    "created_at": "2016-09-26T14:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227519",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@tscrim](#comment:3):
> I am opting for changing the relevant constructors to avoid the checks, which is a separate from #20434 and #18776.

Do you mean only mandatory checks, i.e. `is_poset` and having a join matrix and a bottom element (or meet matrix and top), or more precomputation?



---

archive/issue_events_244864.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-26T14:11:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244864"
}
```



---

archive/issue_events_244865.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-26T14:11:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244865"
}
```



---

archive/issue_comments_227520.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI mean replace `LatticePoset` with `FiniteLatticePoset` as in [comment:2](#comment:2) to avoid the input validation checks",
    "created_at": "2016-09-26T14:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227520",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I mean replace `LatticePoset` with `FiniteLatticePoset` as in [comment:2](#comment:2) to avoid the input validation checks



---

archive/issue_comments_227521.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@tscrim](#comment:5):\n> I mean replace `LatticePoset` with `FiniteLatticePoset` as in [comment:2](#comment:2) to avoid the input validation checks\n\nIn specific functions at `lattice_examples.py` that creates, say, `DivisorLattice`?",
    "created_at": "2016-09-26T15:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227521",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@tscrim](#comment:5):
> I mean replace `LatticePoset` with `FiniteLatticePoset` as in [comment:2](#comment:2) to avoid the input validation checks

In specific functions at `lattice_examples.py` that creates, say, `DivisorLattice`?



---

archive/issue_comments_227522.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYes, that's correct.",
    "created_at": "2016-09-26T15:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227522",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Yes, that's correct.



---

archive/issue_comments_227523.json:
```json
{
    "body": "Branch: **[u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster)**",
    "created_at": "2016-09-26T15:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227523",
    "user": "https://github.com/jm58660"
}
```

Branch: **[u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster)**



---

archive/issue_comments_227524.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nLike this?\n\nDoes everything work? I.e. meets, joins, listing elements, linear extension is OK and so on? How about unique representation?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cb4103fa4c56ca1907f2a50ebe7562eaea6cbc9\">1cb4103</a></td><td><code>An example implementation.</code></td></tr></table>\n",
    "created_at": "2016-09-26T15:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227524",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:9" align="right">comment:9</div>

Like this?

Does everything work? I.e. meets, joins, listing elements, linear extension is OK and so on? How about unique representation?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cb4103fa4c56ca1907f2a50ebe7562eaea6cbc9">1cb4103</a></td><td><code>An example implementation.</code></td></tr></table>




---

archive/issue_comments_227525.json:
```json
{
    "body": "Commit: **[1cb4103](https://github.com/sagemath/sagetrac-mirror/commit/1cb4103fa4c56ca1907f2a50ebe7562eaea6cbc9)**",
    "created_at": "2016-09-26T15:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227525",
    "user": "https://github.com/jm58660"
}
```

Commit: **[1cb4103](https://github.com/sagemath/sagetrac-mirror/commit/1cb4103fa4c56ca1907f2a50ebe7562eaea6cbc9)**



---

archive/issue_comments_227526.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jm58660](#comment:9):\n> Like this?\n\nYes.\n\n> Does everything work? I.e. meets, joins, listing elements, linear extension is OK and so on? How about unique representation?\n\nAFAIK, yes, but I don't have time immediately to test it. Unique representation is handled by the `FinitePoset` class and our input is basically the result from going through `Poset`. IIRC, the default for fixed linear extensions is to not have one. The others look like they are naturally the same from going through `Poset` as well.",
    "created_at": "2016-09-26T16:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227526",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jm58660](#comment:9):
> Like this?

Yes.

> Does everything work? I.e. meets, joins, listing elements, linear extension is OK and so on? How about unique representation?

AFAIK, yes, but I don't have time immediately to test it. Unique representation is handled by the `FinitePoset` class and our input is basically the result from going through `Poset`. IIRC, the default for fixed linear extensions is to not have one. The others look like they are naturally the same from going through `Poset` as well.



---

archive/issue_comments_227527.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOK. Then how to create `DivisorLattice` or whatever poset whose elements are not integers `0..n-1`?",
    "created_at": "2016-09-26T16:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227527",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:11" align="right">comment:11</div>

OK. Then how to create `DivisorLattice` or whatever poset whose elements are not integers `0..n-1`?



---

archive/issue_comments_227528.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAh, the \"hasse diagram\" -parameter is not Hasse diagram in a sense that `hasse_diagram.py` defines... I.e. it is just a DiGraph with some properties as an unlabeled graph. So something like this could work:\n\n```\nfrom sage.combinat.posets.lattices import FiniteLatticePoset\nfrom sage.categories.finite_lattice_posets import FiniteLatticePosets\nn = 10^12\nDiv_n = divisors(n)\nD = DiGraph([Div_n, lambda a, b: b%a==0 and is_prime(b//a)])\nL = FiniteLatticePoset(D, elements=Div_n, category=FiniteLatticePosets())\n```\n\nThis is faster than current implementation, but could be made even faster with some thinking. Having a natural linear extension would even make some small examples better; currently `Posets.DivisorLattice(12).join_irreducibles()` will give `[2, 4, 3]`.",
    "created_at": "2016-09-27T04:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227528",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:12" align="right">comment:12</div>

Ah, the "hasse diagram" -parameter is not Hasse diagram in a sense that `hasse_diagram.py` defines... I.e. it is just a DiGraph with some properties as an unlabeled graph. So something like this could work:

```
from sage.combinat.posets.lattices import FiniteLatticePoset
from sage.categories.finite_lattice_posets import FiniteLatticePosets
n = 10^12
Div_n = divisors(n)
D = DiGraph([Div_n, lambda a, b: b%a==0 and is_prime(b//a)])
L = FiniteLatticePoset(D, elements=Div_n, category=FiniteLatticePosets())
```

This is faster than current implementation, but could be made even faster with some thinking. Having a natural linear extension would even make some small examples better; currently `Posets.DivisorLattice(12).join_irreducibles()` will give `[2, 4, 3]`.



---

archive/issue_comments_227529.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIs there something against using distinguished linear extension in general? Slower, eats more memory, something?\n\nI think that `DivisorLattice()` is a good example for some functions like `join_irreducibles()`. But it is more natural if linear extension is ascending. That is, `Posets.DivisorLattice(12).join_irreducibles()` could return `[2, 3, 4]` and not `[2, 4, 3]` like it now does.",
    "created_at": "2016-10-07T12:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227529",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:13" align="right">comment:13</div>

Is there something against using distinguished linear extension in general? Slower, eats more memory, something?

I think that `DivisorLattice()` is a good example for some functions like `join_irreducibles()`. But it is more natural if linear extension is ascending. That is, `Posets.DivisorLattice(12).join_irreducibles()` could return `[2, 3, 4]` and not `[2, 4, 3]` like it now does.



---

archive/issue_comments_227530.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jm58660](#comment:13):\n> Is there something against using distinguished linear extension in general? Slower, eats more memory, something?\n\nNot that I am aware.\n\n> I think that `DivisorLattice()` is a good example for some functions like `join_irreducibles()`. But it is more natural if linear extension is ascending. That is, `Posets.DivisorLattice(12).join_irreducibles()` could return `[2, 3, 4]` and not `[2, 4, 3]` like it now does.\n\nIt is natural in a way, but I don't have any opinion on this.",
    "created_at": "2016-10-07T14:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227530",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jm58660](#comment:13):
> Is there something against using distinguished linear extension in general? Slower, eats more memory, something?

Not that I am aware.

> I think that `DivisorLattice()` is a good example for some functions like `join_irreducibles()`. But it is more natural if linear extension is ascending. That is, `Posets.DivisorLattice(12).join_irreducibles()` could return `[2, 3, 4]` and not `[2, 4, 3]` like it now does.

It is natural in a way, but I don't have any opinion on this.



---

archive/issue_comments_227531.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI did #21666 as a first part for this.",
    "created_at": "2016-10-08T08:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227531",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:15" align="right">comment:15</div>

I did #21666 as a first part for this.



---

archive/issue_events_244866.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-10-10T07:00:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244866"
}
```



---

archive/issue_events_244867.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-10-10T07:00:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244867"
}
```



---

archive/issue_events_244868.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-10-10T07:00:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244868"
}
```



---

archive/issue_events_244869.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-10-10T07:00:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244869"
}
```



---

archive/issue_comments_227532.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Now for example `Posets.ChainPoset(500)` takes about 10 second. It does something like 1) make a list, 2) make a poset from list, checking that list really is acyclic as when read as digraph edges and 3) make a lattice from poset, checking that poset really is lattice. Phase 3 is done by really generating meet- and join-matrix.\n+This ticket was originally about overriding checks to make poset creation faster. But this is actually already available: instead of `Poset(...)` one can use `FinitePoset(D, ..., category=FinitePosets, ...)`. For some lattices the time saving is huge, as there is no need to compute meet- or join-matrix; think about `BooleanLattice` used as an example of a poset, not as an example of lattice. (This could be documented somehow, \"Advanced [SageMath](../wiki/SageMath) Hacking\" or something like that.)\n \n-Poset and lattice creating functions need an option that says \"do not check, trust blindly\".\n+However, currently for example `Posets.ChainPoset(500)` may takes 10 seconds. That is so because the constructors for common posets and lattices do not use this faster construction. Hence the new aim of the ticket is to change thst.\n \n``````\n",
    "created_at": "2016-10-10T07:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227532",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Now for example `Posets.ChainPoset(500)` takes about 10 second. It does something like 1) make a list, 2) make a poset from list, checking that list really is acyclic as when read as digraph edges and 3) make a lattice from poset, checking that poset really is lattice. Phase 3 is done by really generating meet- and join-matrix.
+This ticket was originally about overriding checks to make poset creation faster. But this is actually already available: instead of `Poset(...)` one can use `FinitePoset(D, ..., category=FinitePosets, ...)`. For some lattices the time saving is huge, as there is no need to compute meet- or join-matrix; think about `BooleanLattice` used as an example of a poset, not as an example of lattice. (This could be documented somehow, "Advanced [SageMath](../wiki/SageMath) Hacking" or something like that.)
 
-Poset and lattice creating functions need an option that says "do not check, trust blindly".
+However, currently for example `Posets.ChainPoset(500)` may takes 10 seconds. That is so because the constructors for common posets and lattices do not use this faster construction. Hence the new aim of the ticket is to change thst.
 
``````




---

archive/issue_comments_227533.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae\">b0e5686</a></td><td><code>Faster basic poset structures.</code></td></tr></table>\n",
    "created_at": "2016-11-14T20:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227533",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae">b0e5686</a></td><td><code>Faster basic poset structures.</code></td></tr></table>




---

archive/issue_comments_227534.json:
```json
{
    "body": "Changed commit from **[1cb4103](https://github.com/sagemath/sagetrac-mirror/commit/1cb4103fa4c56ca1907f2a50ebe7562eaea6cbc9)** to **[b0e5686](https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae)**",
    "created_at": "2016-11-14T20:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227534",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1cb4103](https://github.com/sagemath/sagetrac-mirror/commit/1cb4103fa4c56ca1907f2a50ebe7562eaea6cbc9)** to **[b0e5686](https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae)**



---

archive/issue_comments_227535.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nDone for most basic structures. I guess this one can be closed; more complicated structures take more time to create as a digraph, so proportional time change is not that much.",
    "created_at": "2016-11-14T20:29:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227535",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:18" align="right">comment:18</div>

Done for most basic structures. I guess this one can be closed; more complicated structures take more time to create as a digraph, so proportional time change is not that much.



---

archive/issue_comments_227536.json:
```json
{
    "body": "Author: **Jori M\u00e4ntysalo**",
    "created_at": "2016-11-14T20:29:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227536",
    "user": "https://github.com/jm58660"
}
```

Author: **Jori Mäntysalo**



---

archive/issue_events_244870.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-14T20:29:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244870"
}
```



---

archive/issue_events_244871.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-14T20:29:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244871"
}
```



---

archive/issue_comments_227537.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI agree that we can do things incrementally as there is a need. However, I don't agree with this change:\n\n```diff\n-        p.hasse_diagram()._pos = {0:[2,0],1:[0,2],2:[3,1],3:[3,3],4:[2,4]}\n-        return p\n```\nas this is used to make the printing of the poset is \"nice\".",
    "created_at": "2016-11-14T21:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227537",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

I agree that we can do things incrementally as there is a need. However, I don't agree with this change:

```diff
-        p.hasse_diagram()._pos = {0:[2,0],1:[0,2],2:[3,1],3:[3,3],4:[2,4]}
-        return p
```
as this is used to make the printing of the poset is "nice".



---

archive/issue_comments_227538.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@tscrim](#comment:19):\n> I don't agree with this change:\n> \n> ```diff\n> -        p.hasse_diagram()._pos = {0:[2,0],1:[0,2],2:[3,1],3:[3,3],4:[2,4]}\n> -        return p\n> ```\n> as this is used to make the printing of the poset is \"nice\".\n\nPosets are plotted wih `layout='acyclic'`, so that will be overrided in any case.",
    "created_at": "2016-11-15T05:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227538",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@tscrim](#comment:19):
> I don't agree with this change:
> 
> ```diff
> -        p.hasse_diagram()._pos = {0:[2,0],1:[0,2],2:[3,1],3:[3,3],4:[2,4]}
> -        return p
> ```
> as this is used to make the printing of the poset is "nice".

Posets are plotted wih `layout='acyclic'`, so that will be overrided in any case.



---

archive/issue_comments_227539.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nJust pinging. As you can see from\n\n```\ng = DiGraph({0: [1]})\ng._pos={0: [0,0], 1: [1,1]}\ng.show(layout='acyclic')\n```\n\nthe `...pos=...` line does nothing.",
    "created_at": "2016-11-21T07:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227539",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:21" align="right">comment:21</div>

Just pinging. As you can see from

```
g = DiGraph({0: [1]})
g._pos={0: [0,0], 1: [1,1]}
g.show(layout='acyclic')
```

the `...pos=...` line does nothing.



---

archive/issue_events_244872.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-11-22T22:39:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244872"
}
```



---

archive/issue_events_244873.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-11-22T22:39:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244873"
}
```



---

archive/issue_comments_227540.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2016-11-22T22:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227540",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_227541.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nLooking at the code more, the original didn't actually set the `_pos` because it was doing it to a copy of the Hasse diagram. So it is okay I guess...it does have some effect on the `HasseDiagram` when done correctly, but like I said, it wasn't actually doing it correctly anyways.",
    "created_at": "2016-11-22T22:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227541",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

Looking at the code more, the original didn't actually set the `_pos` because it was doing it to a copy of the Hasse diagram. So it is okay I guess...it does have some effect on the `HasseDiagram` when done correctly, but like I said, it wasn't actually doing it correctly anyways.



---

archive/issue_comments_227542.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOK, thanks. I'll continue on sage-devel about `_pos`.",
    "created_at": "2016-11-23T04:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227542",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:23" align="right">comment:23</div>

OK, thanks. I'll continue on sage-devel about `_pos`.



---

archive/issue_comments_227543.json:
```json
{
    "body": "Changed branch from **[u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster)** to **[b0e5686](https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae)**",
    "created_at": "2016-11-27T16:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17147#issuecomment-227543",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/overriding_checks_to_generate_poset_and_lattice_faster)** to **[b0e5686](https://github.com/sagemath/sagetrac-mirror/commit/b0e568636be5546969483c0a3eb6a6b81a9a3dae)**



---

archive/issue_events_244874.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-27T16:46:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244874"
}
```



---

archive/issue_events_244875.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c4df8bbdc0f6960f92b77372ecae82e493b5aebd",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-11-27T16:46:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17147#event-244875"
}
```
