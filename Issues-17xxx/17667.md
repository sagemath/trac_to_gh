# Issue 17667: Maxima parser fails on ==

archive/issues_017430.json:
```json
{
    "body": "There is no `==` operator in Maxima, but on invalid input it does bad things to the C-level stream. On Linux (below) this is caught by gilbc, on OSX the Maxima process hangs indefinitely:\n\n```\n$ sage -maxima\n;;; Loading #P\"/home/vbraun/Code/sage.git/local/lib/ecl/sb-bsd-sockets.fas\"\n;;; Loading #P\"/home/vbraun/Code/sage.git/local/lib/ecl/sockets.fas\"\n;;; Loading #P\"/home/vbraun/Code/sage.git/local/lib/ecl/defsystem.fas\"\n;;; Loading #P\"/home/vbraun/Code/sage.git/local/lib/ecl/cmp.fas\"\nMaxima 5.35.1 http://maxima.sourceforge.net\nusing Lisp ECL 13.5.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) 1 == 1;\n\nMaxima encountered a Lisp error:\n\n Read or write operation signaled an error\nC library explanation: Illegal seek.\n\nAutomatically continuing.\nTo enable the Lisp debugger set *debugger-hook* to nil.\n```\n\nThis syntax error was diagnosed correctly in Maxima-5.34.1:\n\n```\n$ ./sage -maxima\n;;; Loading #P\"/home/vbraun/Sage/git-temp/local/lib/ecl/cmp.fas\"\n;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0\n;;;\n;;; End of Pass 1.\n;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0\n;;;\n;;; End of Pass 1.\n;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0\n;;;\n;;; End of Pass 1.\n;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0\n;;;\n;;; End of Pass 1.\n;;; Loading #P\"/home/vbraun/Sage/git-temp/local/lib/ecl/sb-bsd-sockets.fas\"\n;;; Loading #P\"/home/vbraun/Sage/git-temp/local/lib/ecl/sockets.fas\"\n;;; Loading #P\"/home/vbraun/Sage/git-temp/local/lib/ecl/defsystem.fas\"\nMaxima 5.34.1 http://maxima.sourceforge.net\nusing Lisp ECL 13.5.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) 1 == 1;\nincorrect syntax: = is not a prefix operator\n1 ==\n  ^ \n```\n\nCC:  @kcrisman\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Jeroen Demeyer\n\nAuthor: Volker Braun\n\nBranch: 3e7f09ae9a657433a6d66555bd4c215e1df4e7c5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17667\n\n",
    "closed_at": "2015-02-13T11:11:09Z",
    "created_at": "2015-01-24T19:47:53Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Maxima parser fails on ==",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17667",
    "user": "https://github.com/vbraun"
}
```
There is no `==` operator in Maxima, but on invalid input it does bad things to the C-level stream. On Linux (below) this is caught by gilbc, on OSX the Maxima process hangs indefinitely:

```
$ sage -maxima
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/sb-bsd-sockets.fas"
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/sockets.fas"
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/defsystem.fas"
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/cmp.fas"
Maxima 5.35.1 http://maxima.sourceforge.net
using Lisp ECL 13.5.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) 1 == 1;

Maxima encountered a Lisp error:

 Read or write operation signaled an error
C library explanation: Illegal seek.

Automatically continuing.
To enable the Lisp debugger set *debugger-hook* to nil.
```

This syntax error was diagnosed correctly in Maxima-5.34.1:

```
$ ./sage -maxima
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/cmp.fas"
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/sb-bsd-sockets.fas"
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/sockets.fas"
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/defsystem.fas"
Maxima 5.34.1 http://maxima.sourceforge.net
using Lisp ECL 13.5.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) 1 == 1;
incorrect syntax: = is not a prefix operator
1 ==
  ^ 
```

CC:  @kcrisman

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Jeroen Demeyer

Author: Volker Braun

Branch: 3e7f09ae9a657433a6d66555bd4c215e1df4e7c5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17667





---

archive/issue_comments_232524.json:
```json
{
    "body": "<a id='comment:1'></a>Upstream bug: https://sourceforge.net/p/maxima/bugs/2895/",
    "created_at": "2015-01-24T20:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232524",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Upstream bug: https://sourceforge.net/p/maxima/bugs/2895/



---

archive/issue_comments_232525.json:
```json
{
    "body": "<a id='comment:2'></a>This is apparently a bug in ECL: https://sourceforge.net/p/ecls/bugs/298/",
    "created_at": "2015-01-25T18:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232525",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>This is apparently a bug in ECL: https://sourceforge.net/p/ecls/bugs/298/



---

archive/issue_comments_232526.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 vbraun]:\n> This is apparently a bug in ECL: https://sourceforge.net/p/ecls/bugs/298/\n\nThere's a proposed almost trivial patch there now. If we need this bug solved in Sage, we can patch our ECL.\n\nThere is a good chance that Maxima/SBCL on OSX has the same problem as Maxima/ECL, since the underlying problem is a rather unfortunate interpretation of POSIX mandated behaviour of lseek on terminal streams. It might be worth trying that, because if the problem surfaces there too, then the Maxima developers might want to avoid depending on the behaviour of the \"file-position\" lisp function that ends up wrapping lseek. (Similarly for other lisps for which Maxima is supported).",
    "created_at": "2015-01-31T16:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232526",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'></a>Replying to [comment:2 vbraun]:
> This is apparently a bug in ECL: https://sourceforge.net/p/ecls/bugs/298/

There's a proposed almost trivial patch there now. If we need this bug solved in Sage, we can patch our ECL.

There is a good chance that Maxima/SBCL on OSX has the same problem as Maxima/ECL, since the underlying problem is a rather unfortunate interpretation of POSIX mandated behaviour of lseek on terminal streams. It might be worth trying that, because if the problem surfaces there too, then the Maxima developers might want to avoid depending on the behaviour of the "file-position" lisp function that ends up wrapping lseek. (Similarly for other lisps for which Maxima is supported).



---

archive/issue_comments_232527.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-02-13T09:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232527",
    "user": "https://github.com/vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_232528.json:
```json
{
    "body": "<a id='comment:6'></a>We should put the backported fix into 6.5, too\n\n---\nNew commits:",
    "created_at": "2015-02-13T09:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232528",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>We should put the backported fix into 6.5, too

---
New commits:



---

archive/issue_comments_232529.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-13T09:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232529",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232530.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-13T09:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232530",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232531.json:
```json
{
    "body": "<a id='comment:7'></a>Hang on...",
    "created_at": "2015-02-13T09:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232531",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Hang on...



---

archive/issue_comments_232532.json:
```json
{
    "body": "<a id='comment:8'></a>The patch doesn't actually apply due to mismatched TABS/spaces.",
    "created_at": "2015-02-13T09:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232532",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>The patch doesn't actually apply due to mismatched TABS/spaces.



---

archive/issue_comments_232533.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-13T09:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232534.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-13T09:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232534",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232535.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-13T09:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232536.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-13T09:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232536",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232537.json:
```json
{
    "body": "<a id='comment:14'></a>lgtm",
    "created_at": "2015-02-13T09:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232537",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>lgtm



---

archive/issue_comments_232538.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-13T11:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232538",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050595.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-13T11:11:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17667#event-50595"
}
```



---

archive/issue_comments_232539.json:
```json
{
    "body": "<a id='comment:16'></a>ECL devs merged Nils' pull request http://sourceforge.net/p/ecls/ecl/merge-requests/1",
    "created_at": "2015-02-22T08:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17667#issuecomment-232539",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>ECL devs merged Nils' pull request http://sourceforge.net/p/ecls/ecl/merge-requests/1
