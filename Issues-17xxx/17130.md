# Issue 17130: Fix coercion bugs in symbolic functions

archive/issues_016893.json:
```json
{
    "assignees": [],
    "body": "This uses coercion correctly:\n\n```\nsage: bessel_Y._eval_(RealField(300)(1), 1.0)\n-0.781212821300289\n```\n\nHowever, it seems that `__call__()` coerces this result back to the first parent, giving false precision:\n\n```\nsage: bessel_Y(RealField(300)(1), 1.0)\n-0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000\n```\n\nSame issue with functions which are evaluated using Maxima, which does not support arbitrary precision:\n\n```\nsage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))\n0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000\n```\n\nThe `gamma_inc()` function also mishandles parents:\n\n```\nsage: gamma_inc(float(0), float(1))\nAttributeError: type object 'float' has no attribute 'precision'\n```\n\n---\n\nApart from this, this branch also removes lots of boilerplate from `_eval_` like\n\n```\nif not isinstance(x, Expression) and not isinstance(y, Expression) and \\\n        (is_inexact(x) or is_inexact(y)):\n    x, y = coercion_model.canonical_coercion(x, y)\n    return self._evalf_(x, y, s_parent(x))\n```\nby wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.\n\n---\n\nPossible follow-ups: #10133, #14766, #16587, #17122, #15200\n\nDepends on #17131\nDepends on #17133\n\nCC:  @burcin @rwst\n\nBranch: **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17130_\n\n",
    "closed_at": "2014-11-30T14:17:28Z",
    "created_at": "2014-10-10T09:22:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix coercion bugs in symbolic functions",
    "type": "issue",
    "updated_at": "2014-12-02T18:47:52Z",
    "url": "https://github.com/sagemath/sage/issues/17130",
    "user": "https://github.com/jdemeyer"
}
```
This uses coercion correctly:

```
sage: bessel_Y._eval_(RealField(300)(1), 1.0)
-0.781212821300289
```

However, it seems that `__call__()` coerces this result back to the first parent, giving false precision:

```
sage: bessel_Y(RealField(300)(1), 1.0)
-0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000
```

Same issue with functions which are evaluated using Maxima, which does not support arbitrary precision:

```
sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))
0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000
```

The `gamma_inc()` function also mishandles parents:

```
sage: gamma_inc(float(0), float(1))
AttributeError: type object 'float' has no attribute 'precision'
```

---

Apart from this, this branch also removes lots of boilerplate from `_eval_` like

```
if not isinstance(x, Expression) and not isinstance(y, Expression) and \
        (is_inexact(x) or is_inexact(y)):
    x, y = coercion_model.canonical_coercion(x, y)
    return self._evalf_(x, y, s_parent(x))
```
by wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.

---

Possible follow-ups: #10133, #14766, #16587, #17122, #15200

Depends on #17131
Depends on #17133

CC:  @burcin @rwst

Branch: **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**

Reviewer: **Ralf Stephan**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/17130_





---

archive/issue_events_218823.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218823"
}
```



---

archive/issue_events_218824.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218824"
}
```



---

archive/issue_events_218825.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218825"
}
```



---

archive/issue_events_218826.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218826"
}
```



---

archive/issue_comments_229685.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nJust to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? \n\nMy guess is that [this line](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/function.pyx#n919) is to blame. \n\n```\n        # we want to convert the result to the original parent if the input\n        # is not exact, so we store the parent here\n        org_parent = parent_c(args[0])\n```\nI don't have time right now to check this out, but I would not be at all surprised.  Or it's the `super` call just above that, I don't myself 100% understand how the inheritance works, and I keep forgetting when `eval` versus `call` are called in the functions.  You could try other functions with multiple arguments and see if the same problem happens, or try to reverse the precisions and see what happens to test this hypothesis.",
    "created_at": "2014-10-10T09:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229685",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'>Comment 1:</a>
Just to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? 

My guess is that [this line](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/function.pyx#n919) is to blame. 

```
        # we want to convert the result to the original parent if the input
        # is not exact, so we store the parent here
        org_parent = parent_c(args[0])
```
I don't have time right now to check this out, but I would not be at all surprised.  Or it's the `super` call just above that, I don't myself 100% understand how the inheritance works, and I keep forgetting when `eval` versus `call` are called in the functions.  You could try other functions with multiple arguments and see if the same problem happens, or try to reverse the precisions and see what happens to test this hypothesis.



---

archive/issue_comments_229686.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nReplying to [@kcrisman](#comment%3A1):\n> Just to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? \n\nYes, the less-precise result is converted to the more-precise parent.",
    "created_at": "2014-10-10T09:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229686",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'>Comment 2:</a>
Replying to [@kcrisman](#comment%3A1):
> Just to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? 

Yes, the less-precise result is converted to the more-precise parent.



---

archive/issue_comments_229687.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nReplying to [@kcrisman](#comment%3A1):\n> \n> ```\n>         # we want to convert the result to the original parent if the input\n>         # is not exact, so we store the parent here\n>         org_parent = parent_c(args[0])\n> ```\n\nEspecially the `args[0]` is very suspicious indeed.",
    "created_at": "2014-10-10T10:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229687",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'>Comment 3:</a>
Replying to [@kcrisman](#comment%3A1):
> 
> ```
>         # we want to convert the result to the original parent if the input
>         # is not exact, so we store the parent here
>         org_parent = parent_c(args[0])
> ```

Especially the `args[0]` is very suspicious indeed.



---

archive/issue_comments_229688.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThe following patch fixes the problem\n\n```diff\ndiff --git a/src/sage/symbolic/function.pyx b/src/sage/symbolic/function.pyx\nindex 408b6da..5beb01d 100644\n--- a/src/sage/symbolic/function.pyx\n+++ b/src/sage/symbolic/function.pyx\n@@ -914,38 +914,6 @@ cdef class BuiltinFunction(Function):\n         res = super(BuiltinFunction, self).__call__(\n                         *args, coerce=coerce, hold=hold)\n \n-        # we want to convert the result to the original parent if the input\n-        # is not exact, so we store the parent here\n-        org_parent = parent_c(args[0])\n-\n-        # convert the result back to the original parent previously stored\n-        # otherwise we end up with\n-        #     sage: arctan(RR(1))\n-        #     1/4*pi\n-        # which is surprising, to say the least...\n-        if org_parent is not SR and \\\n-                (org_parent is float or org_parent is complex or \\\n-                (PY_TYPE_CHECK(org_parent, Parent) and \\\n-                    not org_parent.is_exact())):\n-            try:\n-                return org_parent(res)\n-            except (TypeError, ValueError):\n-                pass\n-\n-            # conversion to the original parent failed\n-            # we try if it works with the corresponding complex domain\n-            if org_parent is float or org_parent is complex:\n-                try:\n-                    from sage.rings.complex_double import CDF\n-                    return complex(CDF(res))\n-                except (TypeError, ValueError):\n-                    pass\n-            elif hasattr(org_parent, 'complex_field'):\n-                try:\n-                    return org_parent.complex_field()(res)\n-                except (TypeError, ValueError):\n-                    pass\n-\n         return res\n \n     cdef _is_registered(self):\n```\nbut with quite a bit of doctest failures.",
    "created_at": "2014-10-10T10:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229688",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
The following patch fixes the problem

```diff
diff --git a/src/sage/symbolic/function.pyx b/src/sage/symbolic/function.pyx
index 408b6da..5beb01d 100644
--- a/src/sage/symbolic/function.pyx
+++ b/src/sage/symbolic/function.pyx
@@ -914,38 +914,6 @@ cdef class BuiltinFunction(Function):
         res = super(BuiltinFunction, self).__call__(
                         *args, coerce=coerce, hold=hold)
 
-        # we want to convert the result to the original parent if the input
-        # is not exact, so we store the parent here
-        org_parent = parent_c(args[0])
-
-        # convert the result back to the original parent previously stored
-        # otherwise we end up with
-        #     sage: arctan(RR(1))
-        #     1/4*pi
-        # which is surprising, to say the least...
-        if org_parent is not SR and \
-                (org_parent is float or org_parent is complex or \
-                (PY_TYPE_CHECK(org_parent, Parent) and \
-                    not org_parent.is_exact())):
-            try:
-                return org_parent(res)
-            except (TypeError, ValueError):
-                pass
-
-            # conversion to the original parent failed
-            # we try if it works with the corresponding complex domain
-            if org_parent is float or org_parent is complex:
-                try:
-                    from sage.rings.complex_double import CDF
-                    return complex(CDF(res))
-                except (TypeError, ValueError):
-                    pass
-            elif hasattr(org_parent, 'complex_field'):
-                try:
-                    return org_parent.complex_field()(res)
-                except (TypeError, ValueError):
-                    pass
-
         return res
 
     cdef _is_registered(self):
```
but with quite a bit of doctest failures.



---

archive/issue_comments_229689.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,10 @@\n sage: bessel_Y(RealField(300)(1), 1.0)\n -0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000\n ```\n+\n+Same issue with functions which are evaluated using Maxima, which does not support arbitrary precision:\n+\n+```\n+sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))\n+0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000\n+```\n``````\n",
    "created_at": "2014-10-10T10:15:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229689",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,10 @@
 sage: bessel_Y(RealField(300)(1), 1.0)
 -0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000
 ```
+
+Same issue with functions which are evaluated using Maxima, which does not support arbitrary precision:
+
+```
+sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))
+0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000
+```
``````




---

archive/issue_comments_229690.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI think a correct result with the wrong parent is better than a wrong result with the correct parent, so I'm inclined to really remove that block of code and fix individual functions instead.",
    "created_at": "2014-10-10T10:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229690",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>Comment 6:</a>
I think a correct result with the wrong parent is better than a wrong result with the correct parent, so I'm inclined to really remove that block of code and fix individual functions instead.



---

archive/issue_comments_229691.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI'm not surprised - the problem is that this kind of code was added at various times to handle certain cases where the output was not the same type as the input (e.g., complex output for real/float input). For instance, does the example mentioned in the code\n\n```\narctan(RR(1)) \n```\nwork properly with this patch? Again, I'm sorry I don't have time to do more than read code for five minutes at this point :(\n\nEdit: I see your most recent comment - yes, that would certainly be helpful, though I have a feeling a LOT of functions would have to be fixed... because some probably implicitly rely on this block but aren't thoroughly tested for unusual input/output.\n\nEdit by jdemeyer: Sorry, edit instead of reply",
    "created_at": "2014-10-10T10:22:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229691",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'>Comment 7:</a>
I'm not surprised - the problem is that this kind of code was added at various times to handle certain cases where the output was not the same type as the input (e.g., complex output for real/float input). For instance, does the example mentioned in the code

```
arctan(RR(1)) 
```
work properly with this patch? Again, I'm sorry I don't have time to do more than read code for five minutes at this point :(

Edit: I see your most recent comment - yes, that would certainly be helpful, though I have a feeling a LOT of functions would have to be fixed... because some probably implicitly rely on this block but aren't thoroughly tested for unusual input/output.

Edit by jdemeyer: Sorry, edit instead of reply



---

archive/issue_comments_229692.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nPerhaps one could take the coercion mutual parents of all args instead for a minimal change?  (Would that work?)  I think in principle it's better to handle this all at once rather than having things in each individual function - if possible, of course.",
    "created_at": "2014-10-10T10:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229692",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'>Comment 8:</a>
Perhaps one could take the coercion mutual parents of all args instead for a minimal change?  (Would that work?)  I think in principle it's better to handle this all at once rather than having things in each individual function - if possible, of course.



---

archive/issue_comments_229693.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@kcrisman](#comment%3A7):\n> \n> ```\n> arctan(RR(1)) \n> ```\n> work properly with this patch?\n\nThis works as it should, many doctest failures involve Python types:\n\n```\nsage: arctan(float(1))\n1/4*pi\n```\n(I guess this goes through Pynac)",
    "created_at": "2014-10-10T10:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229693",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@kcrisman](#comment%3A7):
> 
> ```
> arctan(RR(1)) 
> ```
> work properly with this patch?

This works as it should, many doctest failures involve Python types:

```
sage: arctan(float(1))
1/4*pi
```
(I guess this goes through Pynac)



---

archive/issue_comments_229694.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@kcrisman](#comment%3A8):\n> Perhaps one could take the coercion mutual parents of all args instead for a minimal change?\n\nThat still wouldn't fix the case where the function is computed to less precision than the inputs.\n\nI think the following would fix most issues:\n- before calling the function, convert all Python types to the corresponding Sage types (`float` -> `RDF` and so on)\n- after calling the function, convert back if needed",
    "created_at": "2014-10-10T10:33:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229694",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@kcrisman](#comment%3A8):
> Perhaps one could take the coercion mutual parents of all args instead for a minimal change?

That still wouldn't fix the case where the function is computed to less precision than the inputs.

I think the following would fix most issues:
- before calling the function, convert all Python types to the corresponding Sage types (`float` -> `RDF` and so on)
- after calling the function, convert back if needed



---

archive/issue_comments_229695.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nNot all arguments need to be floating point types, there could be integer or string parameters. So you can't indiscriminately coerce.\n\nIMHO we should just add a clause that if output is float and of lower precision then use that lower precision. In an ideal world we would be able to evaluate everything to arbitrary precision, of course.",
    "created_at": "2014-10-10T10:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229695",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'>Comment 11:</a>
Not all arguments need to be floating point types, there could be integer or string parameters. So you can't indiscriminately coerce.

IMHO we should just add a clause that if output is float and of lower precision then use that lower precision. In an ideal world we would be able to evaluate everything to arbitrary precision, of course.



---

archive/issue_comments_229696.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,10 @@\n sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))\n 0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000\n ```\n+\n+The `gamma_inc()` function also mishandles parents:\n+\n+```\n+sage: gamma_inc(float(0), float(1))\n+AttributeError: type object 'float' has no attribute 'precision'\n+```\n``````\n",
    "created_at": "2014-10-10T13:05:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229696",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,10 @@
 sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))
 0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000
 ```
+
+The `gamma_inc()` function also mishandles parents:
+
+```
+sage: gamma_inc(float(0), float(1))
+AttributeError: type object 'float' has no attribute 'precision'
+```
``````




---

archive/issue_comments_229697.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2014-10-10T21:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229697",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_229698.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**",
    "created_at": "2014-10-11T11:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229698",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**



---

archive/issue_comments_229699.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d\">6d10729</a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr></table>\n",
    "created_at": "2014-10-11T12:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229699",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d">6d10729</a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr></table>




---

archive/issue_comments_229700.json:
```json
{
    "body": "Commit: **[6d10729](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)**",
    "created_at": "2014-10-11T12:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229700",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[6d10729](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)**



---

archive/issue_comments_229701.json:
```json
{
    "body": "Dependencies: **#17131**",
    "created_at": "2014-10-11T12:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229701",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#17131**



---

archive/issue_comments_229702.json:
```json
{
    "body": "Changed dependencies from **#17131** to **#17131, #17133**",
    "created_at": "2014-10-11T13:17:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229702",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17131** to **#17131, #17133**



---

archive/issue_comments_229703.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0001941d064c6f1b1c0be2aea078eae0fb232b21\">0001941</a></td><td><code>Improve accuracy of polytopes.regular_polygon()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24020fe82a0e23afac5d689e2954c58b33efa556\">24020fe</a></td><td><code>Partition().to_exp() should return Sage Integers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf\">b6e1ed4</a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr></table>\n",
    "created_at": "2014-10-11T13:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229703",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0001941d064c6f1b1c0be2aea078eae0fb232b21">0001941</a></td><td><code>Improve accuracy of polytopes.regular_polygon()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24020fe82a0e23afac5d689e2954c58b33efa556">24020fe</a></td><td><code>Partition().to_exp() should return Sage Integers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf">b6e1ed4</a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr></table>




---

archive/issue_comments_229704.json:
```json
{
    "body": "Changed commit from **[6d10729](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)** to **[b6e1ed4](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)**",
    "created_at": "2014-10-11T13:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6d10729](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)** to **[b6e1ed4](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)**



---

archive/issue_events_218827.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-11T14:01:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218827"
}
```



---

archive/issue_events_218828.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-13T08:03:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "title_is": "Fix coercion bugs in symbolic functions",
    "title_was": "Coercion after _eval_() in symbolic functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218828"
}
```



---

archive/issue_comments_229705.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,3 +25,5 @@\n sage: gamma_inc(float(0), float(1))\n AttributeError: type object 'float' has no attribute 'precision'\n ```\n+\n+Possible follow-ups: #10133, #14766\n``````\n",
    "created_at": "2014-10-13T08:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229705",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,3 +25,5 @@
 sage: gamma_inc(float(0), float(1))
 AttributeError: type object 'float' has no attribute 'precision'
 ```
+
+Possible follow-ups: #10133, #14766
``````




---

archive/issue_comments_229706.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nWow, that first commit is a nice patch bomb.  I hesitate to make so much change to how symbolic functions are evaluated without taking a pretty close look, my apologies for not trying to do that immediately.  Also, I think there was an actual reason for calling it `inexact` and not `numerical`, though I don't remember offhand.",
    "created_at": "2014-10-22T18:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229706",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'>Comment 21:</a>
Wow, that first commit is a nice patch bomb.  I hesitate to make so much change to how symbolic functions are evaluated without taking a pretty close look, my apologies for not trying to do that immediately.  Also, I think there was an actual reason for calling it `inexact` and not `numerical`, though I don't remember offhand.



---

archive/issue_comments_229707.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@kcrisman](#comment%3A21):\n> Wow, that first commit is a nice patch bomb.\n\nWould you be more willing to review the patch if it would be split up? I could try to do that but only if I have confirmation that it will increase the chances of this ticket being reviewed.",
    "created_at": "2014-10-23T07:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229707",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@kcrisman](#comment%3A21):
> Wow, that first commit is a nice patch bomb.

Would you be more willing to review the patch if it would be split up? I could try to do that but only if I have confirmation that it will increase the chances of this ticket being reviewed.



---

archive/issue_comments_229708.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI don't think it is overly long, nor is there a good way of splitting it up. Patch looks good to me.\n\nIts somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics \"floating point\" in this case). \n\nIs it possible to replace `is_inexact` with `is_numerical` everywhere? The difference is\n\n```\nsage: is_inexact(pi)\nTrue\nsage: sin._is_numerical(pi)\nFalse\n```\nI'm not super happy with pi being \"inexact\", though perhaps there is a technical reason for why we need it.",
    "created_at": "2014-10-23T10:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229708",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'>Comment 23:</a>
I don't think it is overly long, nor is there a good way of splitting it up. Patch looks good to me.

Its somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics "floating point" in this case). 

Is it possible to replace `is_inexact` with `is_numerical` everywhere? The difference is

```
sage: is_inexact(pi)
True
sage: sin._is_numerical(pi)
False
```
I'm not super happy with pi being "inexact", though perhaps there is a technical reason for why we need it.



---

archive/issue_comments_229709.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\n* Deprecation, folks.  \n* No, it isn't long, but I at least need to think about the mechanism by which things are evaluated and want to make sure we don't miss any odd cases.  `_eval_` has been fairly standard for quite some time.\n* I agree that the naming is problematic no matter what name you choose.  I think the rings folks had some good reasons for their choices:\n\n```\n    cpdef bint is_exact(self) except -2:\n        \"\"\"\n        Test whether the ring is exact.\n\n        .. NOTE::\n\n            This defaults to true, so even if it does return ``True``\n            you have no guarantee (unless the ring has properly\n            overloaded this).\n\n        OUTPUT:\n\n        Return True if elements of this ring are represented exactly, i.e.,\n        there is no precision loss when doing arithmetic.\n\n        EXAMPLES::\n\n            sage: QQ.is_exact()\n            True\n            sage: ZZ.is_exact()\n            True\n            sage: Qp(7).is_exact()\n            False\n            sage: Zp(7, type='capped-abs').is_exact()\n            False\n        \"\"\"\n        return True\n```\n  but the symbolic ring might have inexact stuff in it, so \n\n```\n\nDefinition:     SR.is_exact(self)\nSource:\n    cpdef bint is_exact(self) except -2:\n        \"\"\"\n        Return False, because there are approximate elements in the\n        symbolic ring.\n\n        EXAMPLES::\n\n            sage: SR.is_exact()\n            False\n\n        Here is an inexact element.\n\n        ::\n\n            sage: SR(1.9393)\n            1.93930000000000\n        \"\"\"\n        return False\n```\n  does that make sense?",
    "created_at": "2014-10-23T14:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229709",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'>Comment 24:</a>
* Deprecation, folks.  
* No, it isn't long, but I at least need to think about the mechanism by which things are evaluated and want to make sure we don't miss any odd cases.  `_eval_` has been fairly standard for quite some time.
* I agree that the naming is problematic no matter what name you choose.  I think the rings folks had some good reasons for their choices:

```
    cpdef bint is_exact(self) except -2:
        """
        Test whether the ring is exact.

        .. NOTE::

            This defaults to true, so even if it does return ``True``
            you have no guarantee (unless the ring has properly
            overloaded this).

        OUTPUT:

        Return True if elements of this ring are represented exactly, i.e.,
        there is no precision loss when doing arithmetic.

        EXAMPLES::

            sage: QQ.is_exact()
            True
            sage: ZZ.is_exact()
            True
            sage: Qp(7).is_exact()
            False
            sage: Zp(7, type='capped-abs').is_exact()
            False
        """
        return True
```
  but the symbolic ring might have inexact stuff in it, so 

```

Definition:     SR.is_exact(self)
Source:
    cpdef bint is_exact(self) except -2:
        """
        Return False, because there are approximate elements in the
        symbolic ring.

        EXAMPLES::

            sage: SR.is_exact()
            False

        Here is an inexact element.

        ::

            sage: SR(1.9393)
            1.93930000000000
        """
        return False
```
  does that make sense?



---

archive/issue_comments_229710.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@kcrisman](#comment%3A24):\n> * Deprecation, folks.\n\nWhat should be deprecated? Is there something which used to work and no longer works now and should be deprecated?",
    "created_at": "2014-10-23T14:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229710",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@kcrisman](#comment%3A24):
> * Deprecation, folks.

What should be deprecated? Is there something which used to work and no longer works now and should be deprecated?



---

archive/issue_comments_229711.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\n> > * Deprecation, folks.\n\n> What should be deprecated? Is there something which used to work and no longer works now and should be deprecated?\n\nI just meant if one changed the name completely, that's all.",
    "created_at": "2014-10-23T14:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229711",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:26'>Comment 26:</a>
> > * Deprecation, folks.

> What should be deprecated? Is there something which used to work and no longer works now and should be deprecated?

I just meant if one changed the name completely, that's all.



---

archive/issue_comments_229712.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@vbraun](#comment%3A23):\n> Its somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics \"floating point\" in this case).\n\nI like none of those 3 alternatives, as there are valid cases for exact integers being \"numerical\": this isn't yet implemented on this ticket, but for number theoretical functions (`binomial`, `factorial`) it absolutely makes sense to consider integers \"numerical\". So the name should not obviously exclude integers.\n\nIn fact, this was one of the reasons to make `_is_numerical` a method of the function and not a global function (possible support of `p`-adics is indeed another reason).",
    "created_at": "2014-10-23T14:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229712",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@vbraun](#comment%3A23):
> Its somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics "floating point" in this case).

I like none of those 3 alternatives, as there are valid cases for exact integers being "numerical": this isn't yet implemented on this ticket, but for number theoretical functions (`binomial`, `factorial`) it absolutely makes sense to consider integers "numerical". So the name should not obviously exclude integers.

In fact, this was one of the reasons to make `_is_numerical` a method of the function and not a global function (possible support of `p`-adics is indeed another reason).



---

archive/issue_comments_229713.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@kcrisman](#comment%3A26):\n> I just meant if one changed the name completely, that's all.\n\nIf you show me a concrete instance where a deprecation is needed, I'll happily add it.",
    "created_at": "2014-10-23T14:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229713",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@kcrisman](#comment%3A26):
> I just meant if one changed the name completely, that's all.

If you show me a concrete instance where a deprecation is needed, I'll happily add it.



---

archive/issue_comments_229714.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\n> > I just meant if one changed the name completely, that's all.\n\n> If you show me a concrete instance where a deprecation is needed, I'll happily add it.\n\nSo far it isn't!  I was being a little preemptive in terms of the `is_*` guys.  No worries.",
    "created_at": "2014-10-23T14:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229714",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:29'>Comment 29:</a>
> > I just meant if one changed the name completely, that's all.

> If you show me a concrete instance where a deprecation is needed, I'll happily add it.

So far it isn't!  I was being a little preemptive in terms of the `is_*` guys.  No worries.



---

archive/issue_comments_229715.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,4 +26,18 @@\n AttributeError: type object 'float' has no attribute 'precision'\n ```\n \n+---\n+\n+Apart from this, this branch also removes lots of boilerplate from `_eval_` like\n+\n+```\n+if not isinstance(x, Expression) and not isinstance(y, Expression) and \\\n+        (is_inexact(x) or is_inexact(y)):\n+    x, y = coercion_model.canonical_coercion(x, y)\n+    return self._evalf_(x, y, s_parent(x))\n+```\n+by wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.\n+\n+---\n+\n Possible follow-ups: #10133, #14766\n``````\n",
    "created_at": "2014-10-30T10:48:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229715",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,4 +26,18 @@
 AttributeError: type object 'float' has no attribute 'precision'
 ```
 
+---
+
+Apart from this, this branch also removes lots of boilerplate from `_eval_` like
+
+```
+if not isinstance(x, Expression) and not isinstance(y, Expression) and \
+        (is_inexact(x) or is_inexact(y)):
+    x, y = coercion_model.canonical_coercion(x, y)
+    return self._evalf_(x, y, s_parent(x))
+```
+by wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.
+
+---
+
 Possible follow-ups: #10133, #14766
``````




---

archive/issue_comments_229716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766\n+Possible follow-ups: #10133, #14766, #17285, #16587\n``````\n",
    "created_at": "2014-11-04T10:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229716",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766
+Possible follow-ups: #10133, #14766, #17285, #16587
``````




---

archive/issue_comments_229717.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766, #17285, #16587\n+Possible follow-ups: #10133, #14766, #16587\n``````\n",
    "created_at": "2014-11-05T20:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229717",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766, #17285, #16587
+Possible follow-ups: #10133, #14766, #16587
``````




---

archive/issue_comments_229718.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nI have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further, maybe by adding it to this patch, too?",
    "created_at": "2014-11-09T17:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229718",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'>Comment 34:</a>
I have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further, maybe by adding it to this patch, too?



---

archive/issue_comments_229719.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nReplying to [@rwst](#comment%3A34):\n> I have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further\n\nMost likely it can be reduced further (why not simply take the parent of `x`?). I also don't like the name `real_parent` since it can be complex too.\n\n> maybe by adding it to this patch, too?\n\nNo. People are already complaining that this patch is too big. But a follow-up ticket certainly makes sense.",
    "created_at": "2014-11-12T22:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229719",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>Comment 35:</a>
Replying to [@rwst](#comment%3A34):
> I have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further

Most likely it can be reduced further (why not simply take the parent of `x`?). I also don't like the name `real_parent` since it can be complex too.

> maybe by adding it to this patch, too?

No. People are already complaining that this patch is too big. But a follow-up ticket certainly makes sense.



---

archive/issue_comments_229720.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nSomething else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.",
    "created_at": "2014-11-17T17:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229720",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:36'>Comment 36:</a>
Something else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.



---

archive/issue_comments_229721.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nReplying to [@kcrisman](#comment%3A36):\n> Something else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.\n\nI don't think anything needs updating. But it would be good though to think more generally about what the API should be for symbolic functions. I consider this ticket as a first step in the right direction.",
    "created_at": "2014-11-18T07:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'>Comment 37:</a>
Replying to [@kcrisman](#comment%3A36):
> Something else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.

I don't think anything needs updating. But it would be good though to think more generally about what the API should be for symbolic functions. I consider this ticket as a first step in the right direction.



---

archive/issue_comments_229722.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)**",
    "created_at": "2014-11-25T16:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229722",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)**



---

archive/issue_comments_229723.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThis is very useful for upcoming code of symbolic functions and contains fixes to `functions` too. I think I can follow what you do in `symbolic`. So apart from the doctest fails it's positive from me.\n\n`make ptestlong`:\n\n```\nsage -t --long src/sage/modular/modform_hecketriangle/abstract_space.py  # 12 doctests failed\nsage -t --long src/sage/modular/modform_hecketriangle/readme.py  # 7 doctests failed\nsage -t --long src/sage/functions/other.py  # 3 doctests failed\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/382f97a71989fb04131c0720918e9b66b19c125b\">382f97a</a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into 6.5beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546\">7265989</a></td><td><code>17130: reviewer's patch: fix typo</code></td></tr></table>\n",
    "created_at": "2014-11-25T17:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229723",
    "user": "https://github.com/rwst"
}
```

<a id='comment:39'>Comment 39:</a>
This is very useful for upcoming code of symbolic functions and contains fixes to `functions` too. I think I can follow what you do in `symbolic`. So apart from the doctest fails it's positive from me.

`make ptestlong`:

```
sage -t --long src/sage/modular/modform_hecketriangle/abstract_space.py  # 12 doctests failed
sage -t --long src/sage/modular/modform_hecketriangle/readme.py  # 7 doctests failed
sage -t --long src/sage/functions/other.py  # 3 doctests failed
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/382f97a71989fb04131c0720918e9b66b19c125b">382f97a</a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into 6.5beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546">7265989</a></td><td><code>17130: reviewer's patch: fix typo</code></td></tr></table>




---

archive/issue_comments_229724.json:
```json
{
    "body": "Changed commit from **[b6e1ed4](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)** to **[7265989](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)**",
    "created_at": "2014-11-25T17:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229724",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[b6e1ed4](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)** to **[7265989](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)**



---

archive/issue_events_218829.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-25T17:02:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218829"
}
```



---

archive/issue_events_218830.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-25T17:02:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218830"
}
```



---

archive/issue_comments_229725.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2014-11-25T17:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229725",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_229726.json:
```json
{
    "body": "Changed branch from **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)** to **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**",
    "created_at": "2014-11-26T08:23:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229726",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)** to **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**



---

archive/issue_events_218831.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-26T08:23:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218831"
}
```



---

archive/issue_events_218832.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-26T08:23:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218832"
}
```



---

archive/issue_comments_229727.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c47dbd49b0e5ebb89b3d7afa694478c3d572866f\">c47dbd4</a></td><td><code>Fix Trac #17328 again in a better way</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a\">a486db2</a></td><td><code>Call the factorial() method of an Integer</code></td></tr></table>\n",
    "created_at": "2014-11-26T08:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229727",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'>Comment 41:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c47dbd49b0e5ebb89b3d7afa694478c3d572866f">c47dbd4</a></td><td><code>Fix Trac #17328 again in a better way</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a">a486db2</a></td><td><code>Call the factorial() method of an Integer</code></td></tr></table>




---

archive/issue_comments_229728.json:
```json
{
    "body": "Changed commit from **[7265989](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)** to **[a486db2](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)**",
    "created_at": "2014-11-26T08:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229728",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[7265989](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)** to **[a486db2](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)**



---

archive/issue_comments_229729.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nPasses previously failed tests.",
    "created_at": "2014-11-26T09:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229729",
    "user": "https://github.com/rwst"
}
```

<a id='comment:42'>Comment 42:</a>
Passes previously failed tests.



---

archive/issue_events_218833.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-26T09:08:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218833"
}
```



---

archive/issue_events_218834.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-26T09:08:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218834"
}
```



---

archive/issue_comments_229730.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766, #16587\n+Possible follow-ups: #10133, #14766, #16587, #17122\n``````\n",
    "created_at": "2014-11-26T14:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229730",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766, #16587
+Possible follow-ups: #10133, #14766, #16587, #17122
``````




---

archive/issue_comments_229731.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nPatchbot failed because of `[tutorial ] IOError: [Errno 28] No space left on device`",
    "created_at": "2014-11-26T14:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229731",
    "user": "https://github.com/rwst"
}
```

<a id='comment:44'>Comment 44:</a>
Patchbot failed because of `[tutorial ] IOError: [Errno 28] No space left on device`



---

archive/issue_comments_229732.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766, #16587, #17122\n+Possible follow-ups: #10133, #14766, #16587, #17122, #15200\n``````\n",
    "created_at": "2014-11-27T19:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229732",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766, #16587, #17122
+Possible follow-ups: #10133, #14766, #16587, #17122, #15200
``````




---

archive/issue_comments_229733.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nI get more numerical noise\n\n```\nsage -t --long src/sage/functions/hyperbolic.py\n**********************************************************************\nFile \"src/sage/functions/hyperbolic.py\", line 546, in sage.functions.hyperbolic.Function_arccoth.__init__\nFailed example:\n    float(arccoth(2))\nExpected:\n    0.5493061443340548\nGot:\n    0.5493061443340549\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.functions.hyperbolic.Function_arccoth.__init__\n    [156 tests, 1 failure, 1.22 s]\nsage -t --long src/sage/functions/hypergeometric.py\n    [143 tests, 5.23 s]\nsage -t --long src/sage/functions/jacobi.py\n    [188 tests, 4.02 s]\nsage -t --long src/sage/functions/log.py\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 661, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(RDF(-1))\nExpected:\n    -0.3181315052047642 + 1.3372357014306895*I\nGot:\n    -0.31813150520476413 + 1.3372357014306895*I\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 663, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(float(-1))\nExpected:\n    (-0.3181315052047642+1.3372357014306895j)\nGot:\n    (-0.31813150520476413+1.3372357014306895j)\n**********************************************************************\n1 item had failures:\n   2 of   9 in sage.functions.log.Function_lambert_w._evalf_\nsage -t --long src/sage/functions/special.py\n**********************************************************************\nFile \"src/sage/functions/special.py\", line 355, in sage.functions.special.MaximaFunction._evalf_\nFailed example:\n    f._evalf_(1, I, parent=CDF)\nExpected:\n    0.8483795707591759 - 0.0742924734216079*I\nGot:\n    0.8483795707591759 - 0.07429247342160791*I\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.functions.special.MaximaFunction._evalf_\n    [116 tests, 1 failure, 2.35 s]\n```",
    "created_at": "2014-11-27T22:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229733",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:46'>Comment 46:</a>
I get more numerical noise

```
sage -t --long src/sage/functions/hyperbolic.py
**********************************************************************
File "src/sage/functions/hyperbolic.py", line 546, in sage.functions.hyperbolic.Function_arccoth.__init__
Failed example:
    float(arccoth(2))
Expected:
    0.5493061443340548
Got:
    0.5493061443340549
**********************************************************************
1 item had failures:
   1 of   9 in sage.functions.hyperbolic.Function_arccoth.__init__
    [156 tests, 1 failure, 1.22 s]
sage -t --long src/sage/functions/hypergeometric.py
    [143 tests, 5.23 s]
sage -t --long src/sage/functions/jacobi.py
    [188 tests, 4.02 s]
sage -t --long src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 661, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(RDF(-1))
Expected:
    -0.3181315052047642 + 1.3372357014306895*I
Got:
    -0.31813150520476413 + 1.3372357014306895*I
**********************************************************************
File "src/sage/functions/log.py", line 663, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(float(-1))
Expected:
    (-0.3181315052047642+1.3372357014306895j)
Got:
    (-0.31813150520476413+1.3372357014306895j)
**********************************************************************
1 item had failures:
   2 of   9 in sage.functions.log.Function_lambert_w._evalf_
sage -t --long src/sage/functions/special.py
**********************************************************************
File "src/sage/functions/special.py", line 355, in sage.functions.special.MaximaFunction._evalf_
Failed example:
    f._evalf_(1, I, parent=CDF)
Expected:
    0.8483795707591759 - 0.0742924734216079*I
Got:
    0.8483795707591759 - 0.07429247342160791*I
**********************************************************************
1 item had failures:
   1 of  13 in sage.functions.special.MaximaFunction._evalf_
    [116 tests, 1 failure, 2.35 s]
```



---

archive/issue_events_218835.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-27T22:24:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218835"
}
```



---

archive/issue_events_218836.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-27T22:24:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218836"
}
```



---

archive/issue_comments_229734.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nReplying to [@vbraun](#comment%3A46):\n> I get more numerical noise\n\nAppears to be system dependent, as all tests in `functions/` pass here (OpenSUSE 12.3)",
    "created_at": "2014-11-28T09:26:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229734",
    "user": "https://github.com/rwst"
}
```

<a id='comment:48'>Comment 48:</a>
Replying to [@vbraun](#comment%3A46):
> I get more numerical noise

Appears to be system dependent, as all tests in `functions/` pass here (OpenSUSE 12.3)



---

archive/issue_comments_229735.json:
```json
{
    "body": "Changed commit from **[a486db2](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)** to **[9d3cbbd](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)**",
    "created_at": "2014-11-28T09:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a486db2](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)** to **[9d3cbbd](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)**



---

archive/issue_comments_229736.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30\">9d3cbbd</a></td><td><code>Fix numerical noise</code></td></tr></table>\n",
    "created_at": "2014-11-28T09:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229736",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:49'>Comment 49:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30">9d3cbbd</a></td><td><code>Fix numerical noise</code></td></tr></table>




---

archive/issue_events_218837.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-28T09:50:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218837"
}
```



---

archive/issue_events_218838.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-28T09:50:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218838"
}
```



---

archive/issue_comments_229737.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nStill passes tests in `functions/` here.",
    "created_at": "2014-11-28T10:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229737",
    "user": "https://github.com/rwst"
}
```

<a id='comment:51'>Comment 51:</a>
Still passes tests in `functions/` here.



---

archive/issue_events_218839.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-28T10:03:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218839"
}
```



---

archive/issue_events_218840.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-28T10:03:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218840"
}
```



---

archive/issue_events_218841.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-29T01:06:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218841"
}
```



---

archive/issue_events_218842.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-29T01:06:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218842"
}
```



---

archive/issue_comments_229738.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\n\n```\nsage -t --long src/sage/functions/log.py\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 661, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(RDF(-1))  # abs tol 1e-16\nExpected:\n    -0.31813150520476413 + 1.3372357014306895*I\nGot:\n    -0.31813150520476413 + 1.3372357014306893*I\nTolerance exceeded in 1 of 2:\n    + 1.3372357014306895 vs + 1.3372357014306893, tolerance 2e-16 > 1e-16\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 663, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(float(-1))  # abs tol 1e-16\nExpected:\n    (-0.31813150520476413+1.3372357014306895j)\nGot:\n    (-0.31813150520476413+1.3372357014306893j)\nTolerance exceeded in 1 of 2:\n    +1.3372357014306895 vs +1.3372357014306893, tolerance 2e-16 > 1e-16\n**********************************************************************\n1 item had failures:\n   2 of   9 in sage.functions.log.Function_lambert_w._evalf_\n    [171 tests, 2 failures, 2.51 s]\n```",
    "created_at": "2014-11-29T01:06:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229738",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:52'>Comment 52:</a>

```
sage -t --long src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 661, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(RDF(-1))  # abs tol 1e-16
Expected:
    -0.31813150520476413 + 1.3372357014306895*I
Got:
    -0.31813150520476413 + 1.3372357014306893*I
Tolerance exceeded in 1 of 2:
    + 1.3372357014306895 vs + 1.3372357014306893, tolerance 2e-16 > 1e-16
**********************************************************************
File "src/sage/functions/log.py", line 663, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(float(-1))  # abs tol 1e-16
Expected:
    (-0.31813150520476413+1.3372357014306895j)
Got:
    (-0.31813150520476413+1.3372357014306893j)
Tolerance exceeded in 1 of 2:
    +1.3372357014306895 vs +1.3372357014306893, tolerance 2e-16 > 1e-16
**********************************************************************
1 item had failures:
   2 of   9 in sage.functions.log.Function_lambert_w._evalf_
    [171 tests, 2 failures, 2.51 s]
```



---

archive/issue_comments_229739.json:
```json
{
    "body": "Changed commit from **[9d3cbbd](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)** to **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**",
    "created_at": "2014-11-29T09:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229739",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9d3cbbd](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)** to **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**



---

archive/issue_comments_229740.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a\">abab222</a></td><td><code>Fix more numerical noise</code></td></tr></table>\n",
    "created_at": "2014-11-29T09:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229740",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:53'>Comment 53:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a">abab222</a></td><td><code>Fix more numerical noise</code></td></tr></table>




---

archive/issue_events_218843.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-29T09:06:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218843"
}
```



---

archive/issue_events_218844.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-29T09:06:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218844"
}
```



---

archive/issue_comments_229741.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nThere may be a followup in a later ticket to deal with an inconsistency, if you agree that the following discrepancy between functions with one and two parameters needs addressing:\n\n```\nsage: i = ComplexField(30).0\nsage: gamma(i)\n-0.15494983 - 0.49801567*I\nsage: gamma(1.0*I)\n-0.154949828301811 - 0.498015668118356*I\nsage: jacobi_am(2., 2)\n0.549820282407325\nsage: jacobi_am(2., i)\njacobi_am(2.00000000000000, 1.0000000*I)\nsage: jacobi_am(2., 1.0*I)\njacobi_am(2.00000000000000, 1.00000000000000*I)\n```\n\nEDIT: Ah, never mind, `jacobi_am` takes only reals.",
    "created_at": "2014-11-30T07:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229741",
    "user": "https://github.com/rwst"
}
```

<a id='comment:55'>Comment 55:</a>
There may be a followup in a later ticket to deal with an inconsistency, if you agree that the following discrepancy between functions with one and two parameters needs addressing:

```
sage: i = ComplexField(30).0
sage: gamma(i)
-0.15494983 - 0.49801567*I
sage: gamma(1.0*I)
-0.154949828301811 - 0.498015668118356*I
sage: jacobi_am(2., 2)
0.549820282407325
sage: jacobi_am(2., i)
jacobi_am(2.00000000000000, 1.0000000*I)
sage: jacobi_am(2., 1.0*I)
jacobi_am(2.00000000000000, 1.00000000000000*I)
```

EDIT: Ah, never mind, `jacobi_am` takes only reals.



---

archive/issue_events_218845.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-30T14:17:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218845"
}
```



---

archive/issue_events_218846.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7cde1caa68a8782a2662b6085be29852cb0da94c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-11-30T14:17:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-218846"
}
```



---

archive/issue_comments_229742.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**",
    "created_at": "2014-11-30T14:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229742",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**



---

archive/issue_comments_229743.json:
```json
{
    "body": "Changed commit from **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)** to none",
    "created_at": "2014-12-02T15:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229743",
    "user": "https://github.com/kcrisman"
}
```

Changed commit from **[abab222](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)** to none



---

archive/issue_comments_229744.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nQuestion for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?   I'd be happy to open a followup if need be.",
    "created_at": "2014-12-02T15:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229744",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:57'>Comment 57:</a>
Question for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?   I'd be happy to open a followup if need be.



---

archive/issue_comments_229745.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nReplying to [@kcrisman](#comment%3A57):\n> Question for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?\n\nNo, this is only about `BuiltinFunction`s, there are no functional changes to user-defined functions.",
    "created_at": "2014-12-02T18:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-229745",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'>Comment 58:</a>
Replying to [@kcrisman](#comment%3A57):
> Question for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?

No, this is only about `BuiltinFunction`s, there are no functional changes to user-defined functions.
