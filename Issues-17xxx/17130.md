# Issue 17130: Fix coercion bugs in symbolic functions

archive/issues_016893.json:
```json
{
    "assignees": [],
    "body": "This uses coercion correctly:\n\n```\nsage: bessel_Y._eval_(RealField(300)(1), 1.0)\n-0.781212821300289\n```\n\nHowever, it seems that `__call__()` coerces this result back to the first parent, giving false precision:\n\n```\nsage: bessel_Y(RealField(300)(1), 1.0)\n-0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000\n```\n\nSame issue with functions which are evaluated using Maxima, which does not support arbitrary precision:\n\n```\nsage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))\n0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000\n```\n\nThe `gamma_inc()` function also mishandles parents:\n\n```\nsage: gamma_inc(float(0), float(1))\nAttributeError: type object 'float' has no attribute 'precision'\n```\n\n---\n\nApart from this, this branch also removes lots of boilerplate from `_eval_` like\n\n```\nif not isinstance(x, Expression) and not isinstance(y, Expression) and \\\n        (is_inexact(x) or is_inexact(y)):\n    x, y = coercion_model.canonical_coercion(x, y)\n    return self._evalf_(x, y, s_parent(x))\n```\nby wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.\n\n---\n\nPossible follow-ups: #10133, #14766, #16587, #17122, #15200\n\nDepends on #17131\nDepends on #17133\n\nCC:  @burcin @rwst\n\nBranch: **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17130_\n\n",
    "closed_at": "2014-11-30T14:17:28Z",
    "created_at": "2014-10-10T09:22:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix coercion bugs in symbolic functions",
    "type": "issue",
    "updated_at": "2014-12-02T18:47:52Z",
    "url": "https://github.com/sagemath/sage/issues/17130",
    "user": "https://github.com/jdemeyer"
}
```
This uses coercion correctly:

```
sage: bessel_Y._eval_(RealField(300)(1), 1.0)
-0.781212821300289
```

However, it seems that `__call__()` coerces this result back to the first parent, giving false precision:

```
sage: bessel_Y(RealField(300)(1), 1.0)
-0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000
```

Same issue with functions which are evaluated using Maxima, which does not support arbitrary precision:

```
sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))
0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000
```

The `gamma_inc()` function also mishandles parents:

```
sage: gamma_inc(float(0), float(1))
AttributeError: type object 'float' has no attribute 'precision'
```

---

Apart from this, this branch also removes lots of boilerplate from `_eval_` like

```
if not isinstance(x, Expression) and not isinstance(y, Expression) and \
        (is_inexact(x) or is_inexact(y)):
    x, y = coercion_model.canonical_coercion(x, y)
    return self._evalf_(x, y, s_parent(x))
```
by wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.

---

Possible follow-ups: #10133, #14766, #16587, #17122, #15200

Depends on #17131
Depends on #17133

CC:  @burcin @rwst

Branch: **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**

Reviewer: **Ralf Stephan**

Author: **Jeroen Demeyer**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/17130_





---

archive/issue_events_244626.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244626"
}
```



---

archive/issue_events_244627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244627"
}
```



---

archive/issue_events_244628.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244628"
}
```



---

archive/issue_events_244629.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-10T09:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244629"
}
```



---

archive/issue_comments_227198.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nJust to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? \n\nMy guess is that [this line](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/function.pyx#n919) is to blame. \n\n```\n        # we want to convert the result to the original parent if the input\n        # is not exact, so we store the parent here\n        org_parent = parent_c(args[0])\n```\nI don't have time right now to check this out, but I would not be at all surprised.  Or it's the `super` call just above that, I don't myself 100% understand how the inheritance works, and I keep forgetting when `eval` versus `call` are called in the functions.  You could try other functions with multiple arguments and see if the same problem happens, or try to reverse the precisions and see what happens to test this hypothesis.",
    "created_at": "2014-10-10T09:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227198",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

Just to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? 

My guess is that [this line](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/function.pyx#n919) is to blame. 

```
        # we want to convert the result to the original parent if the input
        # is not exact, so we store the parent here
        org_parent = parent_c(args[0])
```
I don't have time right now to check this out, but I would not be at all surprised.  Or it's the `super` call just above that, I don't myself 100% understand how the inheritance works, and I keep forgetting when `eval` versus `call` are called in the functions.  You could try other functions with multiple arguments and see if the same problem happens, or try to reverse the precisions and see what happens to test this hypothesis.



---

archive/issue_comments_227199.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@kcrisman](#comment:1):\n> Just to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? \n\nYes, the less-precise result is converted to the more-precise parent.",
    "created_at": "2014-10-10T09:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227199",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@kcrisman](#comment:1):
> Just to clarify, you mean that the precision of the less precise input (`1.0`) is used, but then for some reason this is sent back to the precision of the first one? 

Yes, the less-precise result is converted to the more-precise parent.



---

archive/issue_comments_227200.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@kcrisman](#comment:1):\n> \n> ```\n>         # we want to convert the result to the original parent if the input\n>         # is not exact, so we store the parent here\n>         org_parent = parent_c(args[0])\n> ```\n\nEspecially the `args[0]` is very suspicious indeed.",
    "created_at": "2014-10-10T10:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227200",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@kcrisman](#comment:1):
> 
> ```
>         # we want to convert the result to the original parent if the input
>         # is not exact, so we store the parent here
>         org_parent = parent_c(args[0])
> ```

Especially the `args[0]` is very suspicious indeed.



---

archive/issue_comments_227201.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe following patch fixes the problem\n\n```diff\ndiff --git a/src/sage/symbolic/function.pyx b/src/sage/symbolic/function.pyx\nindex 408b6da..5beb01d 100644\n--- a/src/sage/symbolic/function.pyx\n+++ b/src/sage/symbolic/function.pyx\n@@ -914,38 +914,6 @@ cdef class BuiltinFunction(Function):\n         res = super(BuiltinFunction, self).__call__(\n                         *args, coerce=coerce, hold=hold)\n \n-        # we want to convert the result to the original parent if the input\n-        # is not exact, so we store the parent here\n-        org_parent = parent_c(args[0])\n-\n-        # convert the result back to the original parent previously stored\n-        # otherwise we end up with\n-        #     sage: arctan(RR(1))\n-        #     1/4*pi\n-        # which is surprising, to say the least...\n-        if org_parent is not SR and \\\n-                (org_parent is float or org_parent is complex or \\\n-                (PY_TYPE_CHECK(org_parent, Parent) and \\\n-                    not org_parent.is_exact())):\n-            try:\n-                return org_parent(res)\n-            except (TypeError, ValueError):\n-                pass\n-\n-            # conversion to the original parent failed\n-            # we try if it works with the corresponding complex domain\n-            if org_parent is float or org_parent is complex:\n-                try:\n-                    from sage.rings.complex_double import CDF\n-                    return complex(CDF(res))\n-                except (TypeError, ValueError):\n-                    pass\n-            elif hasattr(org_parent, 'complex_field'):\n-                try:\n-                    return org_parent.complex_field()(res)\n-                except (TypeError, ValueError):\n-                    pass\n-\n         return res\n \n     cdef _is_registered(self):\n```\nbut with quite a bit of doctest failures.",
    "created_at": "2014-10-10T10:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227201",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

The following patch fixes the problem

```diff
diff --git a/src/sage/symbolic/function.pyx b/src/sage/symbolic/function.pyx
index 408b6da..5beb01d 100644
--- a/src/sage/symbolic/function.pyx
+++ b/src/sage/symbolic/function.pyx
@@ -914,38 +914,6 @@ cdef class BuiltinFunction(Function):
         res = super(BuiltinFunction, self).__call__(
                         *args, coerce=coerce, hold=hold)
 
-        # we want to convert the result to the original parent if the input
-        # is not exact, so we store the parent here
-        org_parent = parent_c(args[0])
-
-        # convert the result back to the original parent previously stored
-        # otherwise we end up with
-        #     sage: arctan(RR(1))
-        #     1/4*pi
-        # which is surprising, to say the least...
-        if org_parent is not SR and \
-                (org_parent is float or org_parent is complex or \
-                (PY_TYPE_CHECK(org_parent, Parent) and \
-                    not org_parent.is_exact())):
-            try:
-                return org_parent(res)
-            except (TypeError, ValueError):
-                pass
-
-            # conversion to the original parent failed
-            # we try if it works with the corresponding complex domain
-            if org_parent is float or org_parent is complex:
-                try:
-                    from sage.rings.complex_double import CDF
-                    return complex(CDF(res))
-                except (TypeError, ValueError):
-                    pass
-            elif hasattr(org_parent, 'complex_field'):
-                try:
-                    return org_parent.complex_field()(res)
-                except (TypeError, ValueError):
-                    pass
-
         return res
 
     cdef _is_registered(self):
```
but with quite a bit of doctest failures.



---

archive/issue_comments_227202.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,10 @@\n sage: bessel_Y(RealField(300)(1), 1.0)\n -0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000\n ```\n+\n+Same issue with functions which are evaluated using Maxima, which does not support arbitrary precision:\n+\n+```\n+sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))\n+0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000\n+```\n``````\n",
    "created_at": "2014-10-10T10:15:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227202",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,10 @@
 sage: bessel_Y(RealField(300)(1), 1.0)
 -0.781212821300288684511770043172873556613922119140625000000000000000000000000000000000000000
 ```
+
+Same issue with functions which are evaluated using Maxima, which does not support arbitrary precision:
+
+```
+sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))
+0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000
+```
``````




---

archive/issue_comments_227203.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think a correct result with the wrong parent is better than a wrong result with the correct parent, so I'm inclined to really remove that block of code and fix individual functions instead.",
    "created_at": "2014-10-10T10:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227203",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

I think a correct result with the wrong parent is better than a wrong result with the correct parent, so I'm inclined to really remove that block of code and fix individual functions instead.



---

archive/issue_comments_227204.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'm not surprised - the problem is that this kind of code was added at various times to handle certain cases where the output was not the same type as the input (e.g., complex output for real/float input). For instance, does the example mentioned in the code\n\n```\narctan(RR(1)) \n```\nwork properly with this patch? Again, I'm sorry I don't have time to do more than read code for five minutes at this point :(\n\nEdit: I see your most recent comment - yes, that would certainly be helpful, though I have a feeling a LOT of functions would have to be fixed... because some probably implicitly rely on this block but aren't thoroughly tested for unusual input/output.\n\nEdit by jdemeyer: Sorry, edit instead of reply",
    "created_at": "2014-10-10T10:22:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227204",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

I'm not surprised - the problem is that this kind of code was added at various times to handle certain cases where the output was not the same type as the input (e.g., complex output for real/float input). For instance, does the example mentioned in the code

```
arctan(RR(1)) 
```
work properly with this patch? Again, I'm sorry I don't have time to do more than read code for five minutes at this point :(

Edit: I see your most recent comment - yes, that would certainly be helpful, though I have a feeling a LOT of functions would have to be fixed... because some probably implicitly rely on this block but aren't thoroughly tested for unusual input/output.

Edit by jdemeyer: Sorry, edit instead of reply



---

archive/issue_comments_227205.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nPerhaps one could take the coercion mutual parents of all args instead for a minimal change?  (Would that work?)  I think in principle it's better to handle this all at once rather than having things in each individual function - if possible, of course.",
    "created_at": "2014-10-10T10:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227205",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">comment:8</div>

Perhaps one could take the coercion mutual parents of all args instead for a minimal change?  (Would that work?)  I think in principle it's better to handle this all at once rather than having things in each individual function - if possible, of course.



---

archive/issue_comments_227206.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@kcrisman](#comment:7):\n> \n> ```\n> arctan(RR(1)) \n> ```\n> work properly with this patch?\n\nThis works as it should, many doctest failures involve Python types:\n\n```\nsage: arctan(float(1))\n1/4*pi\n```\n(I guess this goes through Pynac)",
    "created_at": "2014-10-10T10:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227206",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@kcrisman](#comment:7):
> 
> ```
> arctan(RR(1)) 
> ```
> work properly with this patch?

This works as it should, many doctest failures involve Python types:

```
sage: arctan(float(1))
1/4*pi
```
(I guess this goes through Pynac)



---

archive/issue_comments_227207.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@kcrisman](#comment:8):\n> Perhaps one could take the coercion mutual parents of all args instead for a minimal change?\n\nThat still wouldn't fix the case where the function is computed to less precision than the inputs.\n\nI think the following would fix most issues:\n- before calling the function, convert all Python types to the corresponding Sage types (`float` -> `RDF` and so on)\n- after calling the function, convert back if needed",
    "created_at": "2014-10-10T10:33:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227207",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@kcrisman](#comment:8):
> Perhaps one could take the coercion mutual parents of all args instead for a minimal change?

That still wouldn't fix the case where the function is computed to less precision than the inputs.

I think the following would fix most issues:
- before calling the function, convert all Python types to the corresponding Sage types (`float` -> `RDF` and so on)
- after calling the function, convert back if needed



---

archive/issue_comments_227208.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nNot all arguments need to be floating point types, there could be integer or string parameters. So you can't indiscriminately coerce.\n\nIMHO we should just add a clause that if output is float and of lower precision then use that lower precision. In an ideal world we would be able to evaluate everything to arbitrary precision, of course.",
    "created_at": "2014-10-10T10:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227208",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

Not all arguments need to be floating point types, there could be integer or string parameters. So you can't indiscriminately coerce.

IMHO we should just add a clause that if output is float and of lower precision then use that lower precision. In an ideal world we would be able to evaluate everything to arbitrary precision, of course.



---

archive/issue_comments_227209.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,10 @@\n sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))\n 0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000\n ```\n+\n+The `gamma_inc()` function also mishandles parents:\n+\n+```\n+sage: gamma_inc(float(0), float(1))\n+AttributeError: type object 'float' has no attribute 'precision'\n+```\n``````\n",
    "created_at": "2014-10-10T13:05:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227209",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,10 @@
 sage: R=RealField(300); elliptic_eu(R(1/2), R(1/8))
 0.495073732023201484864216581627260893583297729492187500000000000000000000000000000000000000
 ```
+
+The `gamma_inc()` function also mishandles parents:
+
+```
+sage: gamma_inc(float(0), float(1))
+AttributeError: type object 'float' has no attribute 'precision'
+```
``````




---

archive/issue_comments_227210.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2014-10-10T21:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227210",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_227211.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**",
    "created_at": "2014-10-11T11:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227211",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**



---

archive/issue_comments_227212.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d\">6d10729</a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr></table>\n",
    "created_at": "2014-10-11T12:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227212",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d">6d10729</a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr></table>




---

archive/issue_comments_227213.json:
```json
{
    "body": "Commit: **[`6d10729`](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)**",
    "created_at": "2014-10-11T12:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227213",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`6d10729`](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)**



---

archive/issue_comments_227214.json:
```json
{
    "body": "Dependencies: **#17131**",
    "created_at": "2014-10-11T12:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227214",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#17131**



---

archive/issue_comments_227215.json:
```json
{
    "body": "Changed dependencies from **#17131** to **#17131, #17133**",
    "created_at": "2014-10-11T13:17:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227215",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17131** to **#17131, #17133**



---

archive/issue_comments_227216.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0001941d064c6f1b1c0be2aea078eae0fb232b21\">0001941</a></td><td><code>Improve accuracy of polytopes.regular_polygon()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24020fe82a0e23afac5d689e2954c58b33efa556\">24020fe</a></td><td><code>Partition().to_exp() should return Sage Integers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf\">b6e1ed4</a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr></table>\n",
    "created_at": "2014-10-11T13:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227216",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0001941d064c6f1b1c0be2aea078eae0fb232b21">0001941</a></td><td><code>Improve accuracy of polytopes.regular_polygon()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24020fe82a0e23afac5d689e2954c58b33efa556">24020fe</a></td><td><code>Partition().to_exp() should return Sage Integers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf">b6e1ed4</a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr></table>




---

archive/issue_comments_227217.json:
```json
{
    "body": "Changed commit from **[`6d10729`](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)** to **[`b6e1ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)**",
    "created_at": "2014-10-11T13:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227217",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d10729`](https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d)** to **[`b6e1ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)**



---

archive/issue_events_244630.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-11T14:01:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244630"
}
```



---

archive/issue_events_244631.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-13T08:03:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "title_is": "Fix coercion bugs in symbolic functions",
    "title_was": "Coercion after _eval_() in symbolic functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244631"
}
```



---

archive/issue_comments_227218.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,3 +25,5 @@\n sage: gamma_inc(float(0), float(1))\n AttributeError: type object 'float' has no attribute 'precision'\n ```\n+\n+Possible follow-ups: #10133, #14766\n``````\n",
    "created_at": "2014-10-13T08:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227218",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,3 +25,5 @@
 sage: gamma_inc(float(0), float(1))
 AttributeError: type object 'float' has no attribute 'precision'
 ```
+
+Possible follow-ups: #10133, #14766
``````




---

archive/issue_comments_227219.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWow, that first commit is a nice patch bomb.  I hesitate to make so much change to how symbolic functions are evaluated without taking a pretty close look, my apologies for not trying to do that immediately.  Also, I think there was an actual reason for calling it `inexact` and not `numerical`, though I don't remember offhand.",
    "created_at": "2014-10-22T18:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227219",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

Wow, that first commit is a nice patch bomb.  I hesitate to make so much change to how symbolic functions are evaluated without taking a pretty close look, my apologies for not trying to do that immediately.  Also, I think there was an actual reason for calling it `inexact` and not `numerical`, though I don't remember offhand.



---

archive/issue_comments_227220.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@kcrisman](#comment:21):\n> Wow, that first commit is a nice patch bomb.\n\nWould you be more willing to review the patch if it would be split up? I could try to do that but only if I have confirmation that it will increase the chances of this ticket being reviewed.",
    "created_at": "2014-10-23T07:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@kcrisman](#comment:21):
> Wow, that first commit is a nice patch bomb.

Would you be more willing to review the patch if it would be split up? I could try to do that but only if I have confirmation that it will increase the chances of this ticket being reviewed.



---

archive/issue_comments_227221.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI don't think it is overly long, nor is there a good way of splitting it up. Patch looks good to me.\n\nIts somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics \"floating point\" in this case). \n\nIs it possible to replace `is_inexact` with `is_numerical` everywhere? The difference is\n\n```\nsage: is_inexact(pi)\nTrue\nsage: sin._is_numerical(pi)\nFalse\n```\nI'm not super happy with pi being \"inexact\", though perhaps there is a technical reason for why we need it.",
    "created_at": "2014-10-23T10:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227221",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

I don't think it is overly long, nor is there a good way of splitting it up. Patch looks good to me.

Its somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics "floating point" in this case). 

Is it possible to replace `is_inexact` with `is_numerical` everywhere? The difference is

```
sage: is_inexact(pi)
True
sage: sin._is_numerical(pi)
False
```
I'm not super happy with pi being "inexact", though perhaps there is a technical reason for why we need it.



---

archive/issue_comments_227222.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n* Deprecation, folks.  \n* No, it isn't long, but I at least need to think about the mechanism by which things are evaluated and want to make sure we don't miss any odd cases.  `_eval_` has been fairly standard for quite some time.\n* I agree that the naming is problematic no matter what name you choose.  I think the rings folks had some good reasons for their choices:\n\n```\n    cpdef bint is_exact(self) except -2:\n        \"\"\"\n        Test whether the ring is exact.\n\n        .. NOTE::\n\n            This defaults to true, so even if it does return ``True``\n            you have no guarantee (unless the ring has properly\n            overloaded this).\n\n        OUTPUT:\n\n        Return True if elements of this ring are represented exactly, i.e.,\n        there is no precision loss when doing arithmetic.\n\n        EXAMPLES::\n\n            sage: QQ.is_exact()\n            True\n            sage: ZZ.is_exact()\n            True\n            sage: Qp(7).is_exact()\n            False\n            sage: Zp(7, type='capped-abs').is_exact()\n            False\n        \"\"\"\n        return True\n```\n  but the symbolic ring might have inexact stuff in it, so \n\n```\n\nDefinition:     SR.is_exact(self)\nSource:\n    cpdef bint is_exact(self) except -2:\n        \"\"\"\n        Return False, because there are approximate elements in the\n        symbolic ring.\n\n        EXAMPLES::\n\n            sage: SR.is_exact()\n            False\n\n        Here is an inexact element.\n\n        ::\n\n            sage: SR(1.9393)\n            1.93930000000000\n        \"\"\"\n        return False\n```\n  does that make sense?",
    "created_at": "2014-10-23T14:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227222",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:24" align="right">comment:24</div>

* Deprecation, folks.  
* No, it isn't long, but I at least need to think about the mechanism by which things are evaluated and want to make sure we don't miss any odd cases.  `_eval_` has been fairly standard for quite some time.
* I agree that the naming is problematic no matter what name you choose.  I think the rings folks had some good reasons for their choices:

```
    cpdef bint is_exact(self) except -2:
        """
        Test whether the ring is exact.

        .. NOTE::

            This defaults to true, so even if it does return ``True``
            you have no guarantee (unless the ring has properly
            overloaded this).

        OUTPUT:

        Return True if elements of this ring are represented exactly, i.e.,
        there is no precision loss when doing arithmetic.

        EXAMPLES::

            sage: QQ.is_exact()
            True
            sage: ZZ.is_exact()
            True
            sage: Qp(7).is_exact()
            False
            sage: Zp(7, type='capped-abs').is_exact()
            False
        """
        return True
```
  but the symbolic ring might have inexact stuff in it, so 

```

Definition:     SR.is_exact(self)
Source:
    cpdef bint is_exact(self) except -2:
        """
        Return False, because there are approximate elements in the
        symbolic ring.

        EXAMPLES::

            sage: SR.is_exact()
            False

        Here is an inexact element.

        ::

            sage: SR(1.9393)
            1.93930000000000
        """
        return False
```
  does that make sense?



---

archive/issue_comments_227223.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@kcrisman](#comment:24):\n> * Deprecation, folks.\n\nWhat should be deprecated? Is there something which used to work and no longer works now and should be deprecated?",
    "created_at": "2014-10-23T14:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227223",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@kcrisman](#comment:24):
> * Deprecation, folks.

What should be deprecated? Is there something which used to work and no longer works now and should be deprecated?



---

archive/issue_comments_227224.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n> > * Deprecation, folks.\n\n> What should be deprecated? Is there something which used to work and no longer works now and should be deprecated?\n\nI just meant if one changed the name completely, that's all.",
    "created_at": "2014-10-23T14:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227224",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:26" align="right">comment:26</div>

> > * Deprecation, folks.

> What should be deprecated? Is there something which used to work and no longer works now and should be deprecated?

I just meant if one changed the name completely, that's all.



---

archive/issue_comments_227225.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@vbraun](#comment:23):\n> Its somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics \"floating point\" in this case).\n\nI like none of those 3 alternatives, as there are valid cases for exact integers being \"numerical\": this isn't yet implemented on this ticket, but for number theoretical functions (`binomial`, `factorial`) it absolutely makes sense to consider integers \"numerical\". So the name should not obviously exclude integers.\n\nIn fact, this was one of the reasons to make `_is_numerical` a method of the function and not a global function (possible support of `p`-adics is indeed another reason).",
    "created_at": "2014-10-23T14:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227225",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@vbraun](#comment:23):
> Its somewhat confusing that `is_numerical` is completely different from `GiNaC::numeric`. How about `is_approximate`, `is_limited_precision`, or `is_floating_point` (I'd be happy to call padics "floating point" in this case).

I like none of those 3 alternatives, as there are valid cases for exact integers being "numerical": this isn't yet implemented on this ticket, but for number theoretical functions (`binomial`, `factorial`) it absolutely makes sense to consider integers "numerical". So the name should not obviously exclude integers.

In fact, this was one of the reasons to make `_is_numerical` a method of the function and not a global function (possible support of `p`-adics is indeed another reason).



---

archive/issue_comments_227226.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@kcrisman](#comment:26):\n> I just meant if one changed the name completely, that's all.\n\nIf you show me a concrete instance where a deprecation is needed, I'll happily add it.",
    "created_at": "2014-10-23T14:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227226",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@kcrisman](#comment:26):
> I just meant if one changed the name completely, that's all.

If you show me a concrete instance where a deprecation is needed, I'll happily add it.



---

archive/issue_comments_227227.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n> > I just meant if one changed the name completely, that's all.\n\n> If you show me a concrete instance where a deprecation is needed, I'll happily add it.\n\nSo far it isn't!  I was being a little preemptive in terms of the `is_*` guys.  No worries.",
    "created_at": "2014-10-23T14:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227227",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:29" align="right">comment:29</div>

> > I just meant if one changed the name completely, that's all.

> If you show me a concrete instance where a deprecation is needed, I'll happily add it.

So far it isn't!  I was being a little preemptive in terms of the `is_*` guys.  No worries.



---

archive/issue_comments_227228.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,4 +26,18 @@\n AttributeError: type object 'float' has no attribute 'precision'\n ```\n \n+---\n+\n+Apart from this, this branch also removes lots of boilerplate from `_eval_` like\n+\n+```\n+if not isinstance(x, Expression) and not isinstance(y, Expression) and \\\n+        (is_inexact(x) or is_inexact(y)):\n+    x, y = coercion_model.canonical_coercion(x, y)\n+    return self._evalf_(x, y, s_parent(x))\n+```\n+by wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.\n+\n+---\n+\n Possible follow-ups: #10133, #14766\n``````\n",
    "created_at": "2014-10-30T10:48:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227228",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,4 +26,18 @@
 AttributeError: type object 'float' has no attribute 'precision'
 ```
 
+---
+
+Apart from this, this branch also removes lots of boilerplate from `_eval_` like
+
+```
+if not isinstance(x, Expression) and not isinstance(y, Expression) and \
+        (is_inexact(x) or is_inexact(y)):
+    x, y = coercion_model.canonical_coercion(x, y)
+    return self._evalf_(x, y, s_parent(x))
+```
+by wrapping `_eval_` inside the new method `_evalf_or_eval_` which automatically does this boilerplate.
+
+---
+
 Possible follow-ups: #10133, #14766
``````




---

archive/issue_comments_227229.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766\n+Possible follow-ups: #10133, #14766, #17285, #16587\n``````\n",
    "created_at": "2014-11-04T10:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227229",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766
+Possible follow-ups: #10133, #14766, #17285, #16587
``````




---

archive/issue_comments_227230.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766, #17285, #16587\n+Possible follow-ups: #10133, #14766, #16587\n``````\n",
    "created_at": "2014-11-05T20:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227230",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766, #17285, #16587
+Possible follow-ups: #10133, #14766, #16587
``````




---

archive/issue_comments_227231.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further, maybe by adding it to this patch, too?",
    "created_at": "2014-11-09T17:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227231",
    "user": "https://github.com/rwst"
}
```

<div id="comment:34" align="right">comment:34</div>

I have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further, maybe by adding it to this patch, too?



---

archive/issue_comments_227232.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@rwst](#comment:34):\n> I have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further\n\nMost likely it can be reduced further (why not simply take the parent of `x`?). I also don't like the name `real_parent` since it can be complex too.\n\n> maybe by adding it to this patch, too?\n\nNo. People are already complaining that this patch is too big. But a follow-up ticket certainly makes sense.",
    "created_at": "2014-11-12T22:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227232",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@rwst](#comment:34):
> I have implemented #17151 on top of this patch. Could you please comment on if the code in `Func_laguerre._evalf_()` needed to determine `real_parent` can be reduced further

Most likely it can be reduced further (why not simply take the parent of `x`?). I also don't like the name `real_parent` since it can be complex too.

> maybe by adding it to this patch, too?

No. People are already complaining that this patch is too big. But a follow-up ticket certainly makes sense.



---

archive/issue_comments_227233.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nSomething else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.",
    "created_at": "2014-11-17T17:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227233",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:36" align="right">comment:36</div>

Something else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.



---

archive/issue_comments_227234.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@kcrisman](#comment:36):\n> Something else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.\n\nI don't think anything needs updating. But it would be good though to think more generally about what the API should be for symbolic functions. I consider this ticket as a first step in the right direction.",
    "created_at": "2014-11-18T07:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227234",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@kcrisman](#comment:36):
> Something else to note (very minor) is that if the top of http://trac.sagemath.org/wiki/symbolics/functions needed some slight updating in order to still be useful, it would be good to do that at the time this was resolved.

I don't think anything needs updating. But it would be good though to think more generally about what the API should be for symbolic functions. I consider this ticket as a first step in the right direction.



---

archive/issue_comments_227235.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)**",
    "created_at": "2014-11-25T16:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227235",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)**



---

archive/issue_comments_227236.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThis is very useful for upcoming code of symbolic functions and contains fixes to `functions` too. I think I can follow what you do in `symbolic`. So apart from the doctest fails it's positive from me.\n\n`make ptestlong`:\n\n```\nsage -t --long src/sage/modular/modform_hecketriangle/abstract_space.py  # 12 doctests failed\nsage -t --long src/sage/modular/modform_hecketriangle/readme.py  # 7 doctests failed\nsage -t --long src/sage/functions/other.py  # 3 doctests failed\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/382f97a71989fb04131c0720918e9b66b19c125b\">382f97a</a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into 6.5beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546\">7265989</a></td><td><code>17130: reviewer's patch: fix typo</code></td></tr></table>\n",
    "created_at": "2014-11-25T17:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227236",
    "user": "https://github.com/rwst"
}
```

<div id="comment:39" align="right">comment:39</div>

This is very useful for upcoming code of symbolic functions and contains fixes to `functions` too. I think I can follow what you do in `symbolic`. So apart from the doctest fails it's positive from me.

`make ptestlong`:

```
sage -t --long src/sage/modular/modform_hecketriangle/abstract_space.py  # 12 doctests failed
sage -t --long src/sage/modular/modform_hecketriangle/readme.py  # 7 doctests failed
sage -t --long src/sage/functions/other.py  # 3 doctests failed
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/382f97a71989fb04131c0720918e9b66b19c125b">382f97a</a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into 6.5beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546">7265989</a></td><td><code>17130: reviewer's patch: fix typo</code></td></tr></table>




---

archive/issue_comments_227237.json:
```json
{
    "body": "Changed commit from **[`b6e1ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)** to **[`7265989`](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)**",
    "created_at": "2014-11-25T17:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227237",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`b6e1ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf)** to **[`7265989`](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)**



---

archive/issue_events_244632.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-25T17:02:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244632"
}
```



---

archive/issue_events_244633.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-25T17:02:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244633"
}
```



---

archive/issue_comments_227238.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2014-11-25T17:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227238",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_227239.json:
```json
{
    "body": "Changed branch from **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)** to **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**",
    "created_at": "2014-11-26T08:23:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227239",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[public/17130](https://github.com/sagemath/sagetrac-mirror/tree/public/17130)** to **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)**



---

archive/issue_events_244634.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-26T08:23:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244634"
}
```



---

archive/issue_events_244635.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-26T08:23:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244635"
}
```



---

archive/issue_comments_227240.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c47dbd49b0e5ebb89b3d7afa694478c3d572866f\">c47dbd4</a></td><td><code>Fix Trac #17328 again in a better way</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a\">a486db2</a></td><td><code>Call the factorial() method of an Integer</code></td></tr></table>\n",
    "created_at": "2014-11-26T08:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227240",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c47dbd49b0e5ebb89b3d7afa694478c3d572866f">c47dbd4</a></td><td><code>Fix Trac #17328 again in a better way</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a">a486db2</a></td><td><code>Call the factorial() method of an Integer</code></td></tr></table>




---

archive/issue_comments_227241.json:
```json
{
    "body": "Changed commit from **[`7265989`](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)** to **[`a486db2`](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)**",
    "created_at": "2014-11-26T08:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227241",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`7265989`](https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546)** to **[`a486db2`](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)**



---

archive/issue_comments_227242.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nPasses previously failed tests.",
    "created_at": "2014-11-26T09:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227242",
    "user": "https://github.com/rwst"
}
```

<div id="comment:42" align="right">comment:42</div>

Passes previously failed tests.



---

archive/issue_events_244636.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-26T09:08:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244636"
}
```



---

archive/issue_events_244637.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-26T09:08:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244637"
}
```



---

archive/issue_comments_227243.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766, #16587\n+Possible follow-ups: #10133, #14766, #16587, #17122\n``````\n",
    "created_at": "2014-11-26T14:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227243",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766, #16587
+Possible follow-ups: #10133, #14766, #16587, #17122
``````




---

archive/issue_comments_227244.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nPatchbot failed because of `[tutorial ] IOError: [Errno 28] No space left on device`",
    "created_at": "2014-11-26T14:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227244",
    "user": "https://github.com/rwst"
}
```

<div id="comment:44" align="right">comment:44</div>

Patchbot failed because of `[tutorial ] IOError: [Errno 28] No space left on device`



---

archive/issue_comments_227245.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n ---\n \n-Possible follow-ups: #10133, #14766, #16587, #17122\n+Possible follow-ups: #10133, #14766, #16587, #17122, #15200\n``````\n",
    "created_at": "2014-11-27T19:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227245",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 ---
 
-Possible follow-ups: #10133, #14766, #16587, #17122
+Possible follow-ups: #10133, #14766, #16587, #17122, #15200
``````




---

archive/issue_comments_227246.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI get more numerical noise\n\n```\nsage -t --long src/sage/functions/hyperbolic.py\n**********************************************************************\nFile \"src/sage/functions/hyperbolic.py\", line 546, in sage.functions.hyperbolic.Function_arccoth.__init__\nFailed example:\n    float(arccoth(2))\nExpected:\n    0.5493061443340548\nGot:\n    0.5493061443340549\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.functions.hyperbolic.Function_arccoth.__init__\n    [156 tests, 1 failure, 1.22 s]\nsage -t --long src/sage/functions/hypergeometric.py\n    [143 tests, 5.23 s]\nsage -t --long src/sage/functions/jacobi.py\n    [188 tests, 4.02 s]\nsage -t --long src/sage/functions/log.py\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 661, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(RDF(-1))\nExpected:\n    -0.3181315052047642 + 1.3372357014306895*I\nGot:\n    -0.31813150520476413 + 1.3372357014306895*I\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 663, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(float(-1))\nExpected:\n    (-0.3181315052047642+1.3372357014306895j)\nGot:\n    (-0.31813150520476413+1.3372357014306895j)\n**********************************************************************\n1 item had failures:\n   2 of   9 in sage.functions.log.Function_lambert_w._evalf_\nsage -t --long src/sage/functions/special.py\n**********************************************************************\nFile \"src/sage/functions/special.py\", line 355, in sage.functions.special.MaximaFunction._evalf_\nFailed example:\n    f._evalf_(1, I, parent=CDF)\nExpected:\n    0.8483795707591759 - 0.0742924734216079*I\nGot:\n    0.8483795707591759 - 0.07429247342160791*I\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.functions.special.MaximaFunction._evalf_\n    [116 tests, 1 failure, 2.35 s]\n```",
    "created_at": "2014-11-27T22:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227246",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:46" align="right">comment:46</div>

I get more numerical noise

```
sage -t --long src/sage/functions/hyperbolic.py
**********************************************************************
File "src/sage/functions/hyperbolic.py", line 546, in sage.functions.hyperbolic.Function_arccoth.__init__
Failed example:
    float(arccoth(2))
Expected:
    0.5493061443340548
Got:
    0.5493061443340549
**********************************************************************
1 item had failures:
   1 of   9 in sage.functions.hyperbolic.Function_arccoth.__init__
    [156 tests, 1 failure, 1.22 s]
sage -t --long src/sage/functions/hypergeometric.py
    [143 tests, 5.23 s]
sage -t --long src/sage/functions/jacobi.py
    [188 tests, 4.02 s]
sage -t --long src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 661, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(RDF(-1))
Expected:
    -0.3181315052047642 + 1.3372357014306895*I
Got:
    -0.31813150520476413 + 1.3372357014306895*I
**********************************************************************
File "src/sage/functions/log.py", line 663, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(float(-1))
Expected:
    (-0.3181315052047642+1.3372357014306895j)
Got:
    (-0.31813150520476413+1.3372357014306895j)
**********************************************************************
1 item had failures:
   2 of   9 in sage.functions.log.Function_lambert_w._evalf_
sage -t --long src/sage/functions/special.py
**********************************************************************
File "src/sage/functions/special.py", line 355, in sage.functions.special.MaximaFunction._evalf_
Failed example:
    f._evalf_(1, I, parent=CDF)
Expected:
    0.8483795707591759 - 0.0742924734216079*I
Got:
    0.8483795707591759 - 0.07429247342160791*I
**********************************************************************
1 item had failures:
   1 of  13 in sage.functions.special.MaximaFunction._evalf_
    [116 tests, 1 failure, 2.35 s]
```



---

archive/issue_events_244638.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-27T22:24:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244638"
}
```



---

archive/issue_events_244639.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-27T22:24:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244639"
}
```



---

archive/issue_comments_227247.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@vbraun](#comment:46):\n> I get more numerical noise\n\nAppears to be system dependent, as all tests in `functions/` pass here (OpenSUSE 12.3)",
    "created_at": "2014-11-28T09:26:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227247",
    "user": "https://github.com/rwst"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@vbraun](#comment:46):
> I get more numerical noise

Appears to be system dependent, as all tests in `functions/` pass here (OpenSUSE 12.3)



---

archive/issue_comments_227248.json:
```json
{
    "body": "Changed commit from **[`a486db2`](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)** to **[`9d3cbbd`](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)**",
    "created_at": "2014-11-28T09:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227248",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a486db2`](https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a)** to **[`9d3cbbd`](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)**



---

archive/issue_comments_227249.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30\">9d3cbbd</a></td><td><code>Fix numerical noise</code></td></tr></table>\n",
    "created_at": "2014-11-28T09:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227249",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30">9d3cbbd</a></td><td><code>Fix numerical noise</code></td></tr></table>




---

archive/issue_events_244640.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-28T09:50:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244640"
}
```



---

archive/issue_events_244641.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-28T09:50:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244641"
}
```



---

archive/issue_comments_227250.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nStill passes tests in `functions/` here.",
    "created_at": "2014-11-28T10:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227250",
    "user": "https://github.com/rwst"
}
```

<div id="comment:51" align="right">comment:51</div>

Still passes tests in `functions/` here.



---

archive/issue_events_244642.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-28T10:03:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244642"
}
```



---

archive/issue_events_244643.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-28T10:03:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244643"
}
```



---

archive/issue_events_244644.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-29T01:06:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244644"
}
```



---

archive/issue_events_244645.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-29T01:06:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244645"
}
```



---

archive/issue_comments_227251.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\n\n```\nsage -t --long src/sage/functions/log.py\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 661, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(RDF(-1))  # abs tol 1e-16\nExpected:\n    -0.31813150520476413 + 1.3372357014306895*I\nGot:\n    -0.31813150520476413 + 1.3372357014306893*I\nTolerance exceeded in 1 of 2:\n    + 1.3372357014306895 vs + 1.3372357014306893, tolerance 2e-16 > 1e-16\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 663, in sage.functions.log.Function_lambert_w._evalf_\nFailed example:\n    lambert_w(float(-1))  # abs tol 1e-16\nExpected:\n    (-0.31813150520476413+1.3372357014306895j)\nGot:\n    (-0.31813150520476413+1.3372357014306893j)\nTolerance exceeded in 1 of 2:\n    +1.3372357014306895 vs +1.3372357014306893, tolerance 2e-16 > 1e-16\n**********************************************************************\n1 item had failures:\n   2 of   9 in sage.functions.log.Function_lambert_w._evalf_\n    [171 tests, 2 failures, 2.51 s]\n```",
    "created_at": "2014-11-29T01:06:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227251",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:52" align="right">comment:52</div>


```
sage -t --long src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 661, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(RDF(-1))  # abs tol 1e-16
Expected:
    -0.31813150520476413 + 1.3372357014306895*I
Got:
    -0.31813150520476413 + 1.3372357014306893*I
Tolerance exceeded in 1 of 2:
    + 1.3372357014306895 vs + 1.3372357014306893, tolerance 2e-16 > 1e-16
**********************************************************************
File "src/sage/functions/log.py", line 663, in sage.functions.log.Function_lambert_w._evalf_
Failed example:
    lambert_w(float(-1))  # abs tol 1e-16
Expected:
    (-0.31813150520476413+1.3372357014306895j)
Got:
    (-0.31813150520476413+1.3372357014306893j)
Tolerance exceeded in 1 of 2:
    +1.3372357014306895 vs +1.3372357014306893, tolerance 2e-16 > 1e-16
**********************************************************************
1 item had failures:
   2 of   9 in sage.functions.log.Function_lambert_w._evalf_
    [171 tests, 2 failures, 2.51 s]
```



---

archive/issue_comments_227252.json:
```json
{
    "body": "Changed commit from **[`9d3cbbd`](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)** to **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**",
    "created_at": "2014-11-29T09:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227252",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9d3cbbd`](https://github.com/sagemath/sagetrac-mirror/commit/9d3cbbdbafb12d1da899abafe0137b4a5639de30)** to **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**



---

archive/issue_comments_227253.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a\">abab222</a></td><td><code>Fix more numerical noise</code></td></tr></table>\n",
    "created_at": "2014-11-29T09:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227253",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a">abab222</a></td><td><code>Fix more numerical noise</code></td></tr></table>




---

archive/issue_events_244646.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-29T09:06:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244646"
}
```



---

archive/issue_events_244647.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-29T09:06:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244647"
}
```



---

archive/issue_comments_227254.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThere may be a followup in a later ticket to deal with an inconsistency, if you agree that the following discrepancy between functions with one and two parameters needs addressing:\n\n```\nsage: i = ComplexField(30).0\nsage: gamma(i)\n-0.15494983 - 0.49801567*I\nsage: gamma(1.0*I)\n-0.154949828301811 - 0.498015668118356*I\nsage: jacobi_am(2., 2)\n0.549820282407325\nsage: jacobi_am(2., i)\njacobi_am(2.00000000000000, 1.0000000*I)\nsage: jacobi_am(2., 1.0*I)\njacobi_am(2.00000000000000, 1.00000000000000*I)\n```\n\nEDIT: Ah, never mind, `jacobi_am` takes only reals.",
    "created_at": "2014-11-30T07:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227254",
    "user": "https://github.com/rwst"
}
```

<div id="comment:55" align="right">comment:55</div>

There may be a followup in a later ticket to deal with an inconsistency, if you agree that the following discrepancy between functions with one and two parameters needs addressing:

```
sage: i = ComplexField(30).0
sage: gamma(i)
-0.15494983 - 0.49801567*I
sage: gamma(1.0*I)
-0.154949828301811 - 0.498015668118356*I
sage: jacobi_am(2., 2)
0.549820282407325
sage: jacobi_am(2., i)
jacobi_am(2.00000000000000, 1.0000000*I)
sage: jacobi_am(2., 1.0*I)
jacobi_am(2.00000000000000, 1.00000000000000*I)
```

EDIT: Ah, never mind, `jacobi_am` takes only reals.



---

archive/issue_events_244648.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-30T14:17:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244648"
}
```



---

archive/issue_events_244649.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7cde1caa68a8782a2662b6085be29852cb0da94c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-11-30T14:17:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17130#event-244649"
}
```



---

archive/issue_comments_227255.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**",
    "created_at": "2014-11-30T14:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227255",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17130](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17130)** to **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)**



---

archive/issue_comments_227256.json:
```json
{
    "body": "Changed commit from **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)** to none",
    "created_at": "2014-12-02T15:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227256",
    "user": "https://github.com/kcrisman"
}
```

Changed commit from **[`abab222`](https://github.com/sagemath/sagetrac-mirror/commit/abab222e67040518acee766f747c161a7445bc0a)** to none



---

archive/issue_comments_227257.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nQuestion for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?   I'd be happy to open a followup if need be.",
    "created_at": "2014-12-02T15:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227257",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:57" align="right">comment:57</div>

Question for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?   I'd be happy to open a followup if need be.



---

archive/issue_comments_227258.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@kcrisman](#comment:57):\n> Question for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?\n\nNo, this is only about `BuiltinFunction`s, there are no functional changes to user-defined functions.",
    "created_at": "2014-12-02T18:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17130#issuecomment-227258",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@kcrisman](#comment:57):
> Question for Jeroen and Ralf - any updating needed in the documentation in sage/symbolic/function_factory.py function `function` as a result of this ticket?

No, this is only about `BuiltinFunction`s, there are no functional changes to user-defined functions.
