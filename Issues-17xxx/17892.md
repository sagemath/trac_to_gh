# Issue 17892: Doctest handling of Maxima's one-sided symbolic limits

archive/issues_017655.json:
```json
{
    "body": "Maxima gives back limit expressions in some integral computation but Sage has no idea what that is. Consequently, working with the expression leads to failure:\n\n```\nsage: var('a,b,t,s,k');\nsage: u(t) = exp(-(t-a)^2/(2*s^2)) + exp(-(t-b)^2/(2*s^2)) ;\nsage: I=integral(u(t)*exp(-I*k*t), t, -infinity, +infinity); I\n-limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus) + limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, +Infinity, minus)\nsage: I.simplify_full()\n...\nTypeError: ECL says: Error executing code in Maxima: \n```\nPresumably a symbolic limit function would be necessary, and to connect it with what Maxima gives back.\n\nIs there a smaller example?\n\nThis is from http://ask.sagemath.org/question/26004/sage-65-maxima-simplify_full-error/\n\nStatus: needs_work\n\nIssue created by migration from https://trac.sagemath.org/ticket/17892\n\n",
    "created_at": "2015-03-04T15:36:19Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Doctest handling of Maxima's one-sided symbolic limits",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17892",
    "user": "https://github.com/rwst"
}
```
Maxima gives back limit expressions in some integral computation but Sage has no idea what that is. Consequently, working with the expression leads to failure:

```
sage: var('a,b,t,s,k');
sage: u(t) = exp(-(t-a)^2/(2*s^2)) + exp(-(t-b)^2/(2*s^2)) ;
sage: I=integral(u(t)*exp(-I*k*t), t, -infinity, +infinity); I
-limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus) + limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, +Infinity, minus)
sage: I.simplify_full()
...
TypeError: ECL says: Error executing code in Maxima: 
```
Presumably a symbolic limit function would be necessary, and to connect it with what Maxima gives back.

Is there a smaller example?

This is from http://ask.sagemath.org/question/26004/sage-65-maxima-simplify_full-error/

Status: needs_work

Issue created by migration from https://trac.sagemath.org/ticket/17892





---

archive/issue_comments_250998.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -12,6 +12,8 @@\n \n Is there a smaller example?\n \n+This is from http://ask.sagemath.org/question/26004/sage-65-maxima-simplify_full-error/\n+\n Comment: 1\n \n Summary: Sage cannot work with Maxima's symbolic limit\n```\n",
    "created_at": "2015-03-04T15:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-250998",
    "user": "https://github.com/rwst"
}
```

Description changed:
```diff
--- 
+++ 
@@ -12,6 +12,8 @@
 
 Is there a smaller example?
 
+This is from http://ask.sagemath.org/question/26004/sage-65-maxima-simplify_full-error/
+
 Comment: 1
 
 Summary: Sage cannot work with Maxima's symbolic limit
```




---

archive/issue_comments_250999.json:
```json
{
    "body": "<a id='comment:2'></a>Funnily enough it's not the limit placeholder that seems to be the primary issue. For the most part, the generic stuff just works for that. It's the \"plus\" or \"minus\" keyword that confuses things.\n\n```\nsage: L=I.operands()[0].operands()[0]\nlimit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus)\nsage: Ls=L.operator()(*L.operands()[:-1]); Ls\nlimit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity)\nsage: Ls.simplify_full()\n1/2*sqrt(pi)*e^(-1/2*k^2*s^2 - I*a*k - I*b*k)*limit(sqrt(2)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(I*a*k) + sqrt(2)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(I*b*k), t, -Infinity)\n```\ni.e., the direct problem is that the keyword \"plus\" does not get translated appropriately. In fact:\n\n```\nsage: L.operands()[-1].is_symbol()\nTrue\nsage: L.operands()[-1]._maxima_()\n_SAGE_VAR_plus\n```\nas you can see, the maxima symbol \"plus\" got translated to a symbolic variable, which doesn't round-trip properly. It would have been nice to recognize \"plus\" on the maxima side not into a variable.\n\nFor the rest:\n\n```\nsage: limit(L.operands()[0],t=-oo,dir='+')\nlimit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus)\n```\nwhich gives a bit of a pointer to the sage user interface (we shouldn't use that as \"placeholder\", though: it punts to maxima by default, so it shouldn't be called for interpreting the result that comes back).",
    "created_at": "2015-03-05T00:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-250999",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>Funnily enough it's not the limit placeholder that seems to be the primary issue. For the most part, the generic stuff just works for that. It's the "plus" or "minus" keyword that confuses things.

```
sage: L=I.operands()[0].operands()[0]
limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus)
sage: Ls=L.operator()(*L.operands()[:-1]); Ls
limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity)
sage: Ls.simplify_full()
1/2*sqrt(pi)*e^(-1/2*k^2*s^2 - I*a*k - I*b*k)*limit(sqrt(2)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(I*a*k) + sqrt(2)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(I*b*k), t, -Infinity)
```
i.e., the direct problem is that the keyword "plus" does not get translated appropriately. In fact:

```
sage: L.operands()[-1].is_symbol()
True
sage: L.operands()[-1]._maxima_()
_SAGE_VAR_plus
```
as you can see, the maxima symbol "plus" got translated to a symbolic variable, which doesn't round-trip properly. It would have been nice to recognize "plus" on the maxima side not into a variable.

For the rest:

```
sage: limit(L.operands()[0],t=-oo,dir='+')
limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus)
```
which gives a bit of a pointer to the sage user interface (we shouldn't use that as "placeholder", though: it punts to maxima by default, so it shouldn't be called for interpreting the result that comes back).



---

archive/issue_comments_251000.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Maxima gives back limit expressions in some integral computation but Sage has no idea what that is. Consequently, working with the expression leads to failure:\n \n+```\n+sage: var('a,b,t,s,k');\n+sage: u(t) = exp(-(t-a)^2/(2*s^2)) + exp(-(t-b)^2/(2*s^2)) ;\n+sage: I=integral(u(t)*exp(-I*k*t), t, -infinity, +infinity); I\n+-limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus) + limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, +Infinity, minus)\n+sage: I.simplify_full()\n+...\n+TypeError: ECL says: Error executing code in Maxima: \n+```\n+Presumably a symbolic limit function would be necessary, and to connect it with what Maxima gives back.\n+\n+Is there a smaller example?\n+\n+This is from http://ask.sagemath.org/question/26004/sage-65-maxima-simplify_full-error/\n \n Comment: 1\n \n```\n",
    "created_at": "2015-03-05T00:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251000",
    "user": "https://github.com/nbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Maxima gives back limit expressions in some integral computation but Sage has no idea what that is. Consequently, working with the expression leads to failure:
 
+```
+sage: var('a,b,t,s,k');
+sage: u(t) = exp(-(t-a)^2/(2*s^2)) + exp(-(t-b)^2/(2*s^2)) ;
+sage: I=integral(u(t)*exp(-I*k*t), t, -infinity, +infinity); I
+-limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus) + limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, +Infinity, minus)
+sage: I.simplify_full()
+...
+TypeError: ECL says: Error executing code in Maxima: 
+```
+Presumably a symbolic limit function would be necessary, and to connect it with what Maxima gives back.
+
+Is there a smaller example?
+
+This is from http://ask.sagemath.org/question/26004/sage-65-maxima-simplify_full-error/
 
 Comment: 1
 
```




---

archive/issue_comments_251001.json:
```json
{
    "body": "<a id='comment:3'></a>Conceivably related: #19203",
    "created_at": "2015-09-14T01:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251001",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>Conceivably related: #19203



---

archive/issue_comments_251002.json:
```json
{
    "body": "<a id='comment:4'></a>The limit part appears to work now, i.e. the limit is evaluated and gives `sqrt(2)*sqrt(pi)*s*e<sup>(-1/2*k</sup>2*s^2 - I*a*k) + sqrt(2)*sqrt(pi)*s*e<sup>(-1/2*k</sup>2*s^2 - I*b*k)`. This means the simplify part is no longer in a code path. I propose to close the original issue. Is there something left?",
    "created_at": "2017-06-08T16:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251002",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>The limit part appears to work now, i.e. the limit is evaluated and gives `sqrt(2)*sqrt(pi)*s*e<sup>(-1/2*k</sup>2*s^2 - I*a*k) + sqrt(2)*sqrt(pi)*s*e<sup>(-1/2*k</sup>2*s^2 - I*b*k)`. This means the simplify part is no longer in a code path. I propose to close the original issue. Is there something left?



---

archive/issue_comments_251003.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-08T16:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251003",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_events_050956.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-06-08T16:21:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17892#event-50956"
}
```



---

archive/issue_events_050957.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-26T14:35:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17892#event-50957"
}
```



---

archive/issue_events_050958.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-26T14:35:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17892#event-50958"
}
```



---

archive/issue_comments_251004.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-26T14:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251004",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_251005.json:
```json
{
    "body": "<a id='comment:5'></a>No, rather this ticket should add an example calling Maxima's integral that is guaranteed to return a one-sided limit.",
    "created_at": "2017-12-26T14:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251005",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'></a>No, rather this ticket should add an example calling Maxima's integral that is guaranteed to return a one-sided limit.



---

archive/issue_comments_251006.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 rws]:\n> No, rather this ticket should add an example calling Maxima's integral that is guaranteed to return a one-sided limit.\n\n\nAlso, the interface to Maxima wrt plus/minus is broken with the placeholder function as well:\n\n```\nsage: from sage.functions.other import symbolic_limit as slimit\nsage: _ = var('plus')\nsage: slimit(1/x, x, 0, plus)\nlimit(1/x, x, 0, plus)\nsage: maxima(_)\n...\nTypeError: Error executing code in Maxima\nCODE:\n\tsage4 : limit((_SAGE_VAR_x)^(-1),_SAGE_VAR_x,0,_SAGE_VAR_plus)$\nMaxima ERROR:\n\t\nlimit: direction must be either 'plus' or 'minus'; found: _SAGE_VAR_plus\n -- an error. To debug this try: debugmode(true);\n```",
    "created_at": "2018-01-10T14:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17892#issuecomment-251006",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>Replying to [comment:5 rws]:
> No, rather this ticket should add an example calling Maxima's integral that is guaranteed to return a one-sided limit.


Also, the interface to Maxima wrt plus/minus is broken with the placeholder function as well:

```
sage: from sage.functions.other import symbolic_limit as slimit
sage: _ = var('plus')
sage: slimit(1/x, x, 0, plus)
limit(1/x, x, 0, plus)
sage: maxima(_)
...
TypeError: Error executing code in Maxima
CODE:
	sage4 : limit((_SAGE_VAR_x)^(-1),_SAGE_VAR_x,0,_SAGE_VAR_plus)$
Maxima ERROR:
	
limit: direction must be either 'plus' or 'minus'; found: _SAGE_VAR_plus
 -- an error. To debug this try: debugmode(true);
```
