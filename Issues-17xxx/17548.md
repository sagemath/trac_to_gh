# Issue 17548: Partitions() is buggy

archive/issues_017311.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-ferriszorro"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nThere are various bugs in `Partitions`/`Compositions`, especially when many constraints are combined:\n\n```\nsage: C = Partitions(10, min_part=2, max_slope=-1)\nsage: [5,3,2] in C\nTrue\nsage: C.list()\n[[10], [8, 2], [7, 3], [6, 4]]\n```\n\n```\nsage: C = Compositions(5, max_part=2, min_slope=1, inner=[2])\nsage: [2,1,2] in C\nFalse\nsage: C.list()\n[[2, 1, 2]]\n```\n\nWhen slopes are equal, things often go wrong:\n\n```\nsage: C = Compositions(4, min_slope=0, max_slope=0)\nsage: [1,1,1,1] in C\nTrue\nsage: C.list()\n[[4], [2, 2]]\n```\n\n```\nsage: C = Partitions(6, min_slope=-1, max_slope=-1)\nsage: [3,2,1] in C\nTrue\nsage: C.list()\n[[6]]\n```\n\nContradictory length bounds still give results:\n\n```\nsage: C = Compositions(6, min_length=3, max_length=2)\nsage: [4,1,1] in C\nFalse\nsage: C.list()[0]\n[4, 1, 1]\n```\n\n```\nsage: C = Compositions(3, max_length=2, inner=[1,1,1])\nsage: [1,1,1] in C\nFalse\nsage: C.list()\n[[1, 1, 1]]\n```\n\n```\nsage: C = Compositions(10, outer=[4], inner=[1,1])\nsage: [4,6] in C\nFalse\nsage: C.list()\n[[4, 6], [3, 7], [2, 8], [1, 9]]\n```\n\n`max_part` is not respected:\n\n```\nsage: C = Compositions(4, max_part=2, min_slope=1)\nsage: [1,3] in C\nFalse\nsage: C.list()\n[[1, 3]]\n```\n\nThis is horribly wrong:\n\n```\nsage: Compositions(7, max_part=4, inner=[1], min_slope=1).list()\n[[3, 5], [1, 3, 4]]\n```\n\nThe following command hangs:\n\n```\nsage: Compositions(4, inner=[2], outer=[2,2], min_slope=0).list()\n...\n```\n\nStrange exception which really shouldn't be an exception:\n\n```\nsage: Compositions(10, inner=[1,1], max_slope=-1)\n...\nValueError: floor does not satisfy the max slope condition\n```\n\nOne possible fix is given by #17920.\n\nCC:  @sagetrac-jakobkroeker @anneschilling\n\nComponent: **combinatorics**\n\nKeywords: **Partitions**\n\nStopgaps: **#17637, #17956**\n\nBranch/Commit: **[public/combinat/equal_min_max_slope_fix](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/equal_min_max_slope_fix) @ [`44d1cfb`](https://github.com/sagemath/sagetrac-mirror/commit/44d1cfb45c137d7d8ac6eb481bf6145ec57c12e4)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17548_\n\n",
    "closed_at": "2015-04-13T17:47:22Z",
    "created_at": "2014-12-25T05:21:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Partitions() is buggy",
    "type": "issue",
    "updated_at": "2015-04-13T17:47:22Z",
    "url": "https://github.com/sagemath/sage/issues/17548",
    "user": "https://github.com/sagetrac-ferriszorro"
}
```
<div id="comment:0"></div>

There are various bugs in `Partitions`/`Compositions`, especially when many constraints are combined:

```
sage: C = Partitions(10, min_part=2, max_slope=-1)
sage: [5,3,2] in C
True
sage: C.list()
[[10], [8, 2], [7, 3], [6, 4]]
```

```
sage: C = Compositions(5, max_part=2, min_slope=1, inner=[2])
sage: [2,1,2] in C
False
sage: C.list()
[[2, 1, 2]]
```

When slopes are equal, things often go wrong:

```
sage: C = Compositions(4, min_slope=0, max_slope=0)
sage: [1,1,1,1] in C
True
sage: C.list()
[[4], [2, 2]]
```

```
sage: C = Partitions(6, min_slope=-1, max_slope=-1)
sage: [3,2,1] in C
True
sage: C.list()
[[6]]
```

Contradictory length bounds still give results:

```
sage: C = Compositions(6, min_length=3, max_length=2)
sage: [4,1,1] in C
False
sage: C.list()[0]
[4, 1, 1]
```

```
sage: C = Compositions(3, max_length=2, inner=[1,1,1])
sage: [1,1,1] in C
False
sage: C.list()
[[1, 1, 1]]
```

```
sage: C = Compositions(10, outer=[4], inner=[1,1])
sage: [4,6] in C
False
sage: C.list()
[[4, 6], [3, 7], [2, 8], [1, 9]]
```

`max_part` is not respected:

```
sage: C = Compositions(4, max_part=2, min_slope=1)
sage: [1,3] in C
False
sage: C.list()
[[1, 3]]
```

This is horribly wrong:

```
sage: Compositions(7, max_part=4, inner=[1], min_slope=1).list()
[[3, 5], [1, 3, 4]]
```

The following command hangs:

```
sage: Compositions(4, inner=[2], outer=[2,2], min_slope=0).list()
...
```

Strange exception which really shouldn't be an exception:

```
sage: Compositions(10, inner=[1,1], max_slope=-1)
...
ValueError: floor does not satisfy the max slope condition
```

One possible fix is given by #17920.

CC:  @sagetrac-jakobkroeker @anneschilling

Component: **combinatorics**

Keywords: **Partitions**

Stopgaps: **#17637, #17956**

Branch/Commit: **[public/combinat/equal_min_max_slope_fix](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/equal_min_max_slope_fix) @ [`44d1cfb`](https://github.com/sagemath/sagetrac-mirror/commit/44d1cfb45c137d7d8ac6eb481bf6145ec57c12e4)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/17548_





---

archive/issue_events_247790.json:
```json
{
    "actor": "https://github.com/sagetrac-ferriszorro",
    "created_at": "2014-12-25T05:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247790"
}
```



---

archive/issue_events_247791.json:
```json
{
    "actor": "https://github.com/sagetrac-ferriszorro",
    "created_at": "2014-12-25T05:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247791"
}
```



---

archive/issue_events_247792.json:
```json
{
    "actor": "https://github.com/sagetrac-ferriszorro",
    "created_at": "2014-12-25T05:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247792"
}
```



---

archive/issue_events_247793.json:
```json
{
    "actor": "https://github.com/sagetrac-ferriszorro",
    "created_at": "2014-12-25T05:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247793"
}
```



---

archive/issue_comments_235352.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPartitions error",
    "created_at": "2014-12-25T05:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235352",
    "user": "https://github.com/sagetrac-ferriszorro"
}
```

<div id="comment:1" align="right">comment:1</div>

Partitions error



---

archive/issue_events_247794.json:
```json
{
    "actor": "https://github.com/sagetrac-ferriszorro",
    "created_at": "2014-12-25T05:24:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "subject": "https://github.com/sagetrac-ferriszorro",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247794"
}
```



---

archive/issue_comments_235353.json:
```json
{
    "body": "\n```diff # HG changeset patch # Date 1300721936 0 foo  diff --git a/bar b/bar --- a/bar +++ b/bar @@ -1,2 +1,3 @@  baz  quux +xyzzy }}}\n```",
    "created_at": "2014-12-25T05:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235353",
    "user": "https://github.com/sagetrac-ferriszorro"
}
```


```diff # HG changeset patch # Date 1300721936 0 foo  diff --git a/bar b/bar --- a/bar +++ b/bar @@ -1,2 +1,3 @@  baz  quux +xyzzy }}}
```



---

archive/issue_comments_235354.json:
```json
{
    "body": "Changed branch from **[v5.7](https://github.com/sagemath/sagetrac-mirror/tree/v5.7)** to none",
    "created_at": "2014-12-25T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235354",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[v5.7](https://github.com/sagemath/sagetrac-mirror/tree/v5.7)** to none



---

archive/issue_comments_235355.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[patch.gz](https://github.com/sagemath/sage/files/ticket17548/patch.gz)**",
    "created_at": "2014-12-25T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235355",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[patch.gz](https://github.com/sagemath/sage/files/ticket17548/patch.gz)**



---

archive/issue_comments_235356.json:
```json
{
    "body": "Changed dependencies from **sage 5.7** to none",
    "created_at": "2014-12-25T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235356",
    "user": "https://github.com/fchapoton"
}
```

Changed dependencies from **sage 5.7** to none



---

archive/issue_events_247795.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2014-12-25T08:43:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247795"
}
```



---

archive/issue_comments_235357.json:
```json
{
    "body": "Changed author from **z** to none",
    "created_at": "2014-12-25T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235357",
    "user": "https://github.com/fchapoton"
}
```

Changed author from **z** to none



---

archive/issue_events_247796.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2014-12-25T08:43:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247796"
}
```



---

archive/issue_comments_235358.json:
```json
{
    "body": "Changed reviewer from **f** to none",
    "created_at": "2014-12-25T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235358",
    "user": "https://github.com/fchapoton"
}
```

Changed reviewer from **f** to none



---

archive/issue_comments_235359.json:
```json
{
    "body": "Changed merged from **sage5.7** to none",
    "created_at": "2014-12-25T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235359",
    "user": "https://github.com/fchapoton"
}
```

Changed merged from **sage5.7** to none



---

archive/issue_events_247797.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-12-25T08:57:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247797"
}
```



---

archive/issue_events_247798.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-12-25T08:57:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247798"
}
```



---

archive/issue_comments_235360.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFr\u00e9d\u00e9ric: the wontfix tickets should be set to 'positive review', otherwise Volker will not see them.\n\n\"Merry Christmas\",\n\nNathann",
    "created_at": "2014-12-25T08:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235360",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

Frédéric: the wontfix tickets should be set to 'positive review', otherwise Volker will not see them.

"Merry Christmas",

Nathann



---

archive/issue_comments_235361.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis being said this bug report is a real bug report `O_o`",
    "created_at": "2014-12-25T08:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235361",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:5" align="right">comment:5</div>

This being said this bug report is a real bug report `O_o`



---

archive/issue_events_247799.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2014-12-25T17:31:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "title_is": "Partitions() involving min_slope argument is buggy",
    "title_was": "sage5.7 Partitions() error",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247799"
}
```



---

archive/issue_events_247800.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2014-12-25T17:31:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247800"
}
```



---

archive/issue_events_247801.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2014-12-25T17:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247801"
}
```



---

archive/issue_events_247802.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2014-12-25T17:31:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247802"
}
```



---

archive/issue_comments_235362.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI was very puzzled when i saw this ticket, since my Turing tests were not able to conclude (unless we just reached the singularity). I propose to reopen the ticket since the report is correct.\n\nBy the way, i am not sure the following is a correct behaviour:\n\n```\nsage: P = Partitions(5, min_slope=2)\nsage: Q = Partitions(5)\nsage: Q[0] \n[5]\nsage: Q[0] in P\nFalse\n```",
    "created_at": "2014-12-25T17:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235362",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:6" align="right">comment:6</div>

I was very puzzled when i saw this ticket, since my Turing tests were not able to conclude (unless we just reached the singularity). I propose to reopen the ticket since the report is correct.

By the way, i am not sure the following is a correct behaviour:

```
sage: P = Partitions(5, min_slope=2)
sage: Q = Partitions(5)
sage: Q[0] 
[5]
sage: Q[0] in P
False
```



---

archive/issue_events_247803.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2014-12-25T17:31:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247803"
}
```



---

archive/issue_events_247804.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2014-12-25T17:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247804"
}
```



---

archive/issue_comments_235363.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,17 @@\n-sage: Partitions(5,min_slope=1).list()\n-[[5], [2, 4]]\n+The following bug was reported by an humanoid:\n+\n+```\n+sage: Partitions(5, min_slope=1).list()\n+ValueError: [2, 4] is not a valid partition\n+```\n+\n+Even worse (since silent):\n+\n+```\n+sage: Partitions(5, min_slope=2).list()\n+[[5]]\n+```\n+\n+Or\n+\n+\n``````\n",
    "created_at": "2014-12-25T17:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235363",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,17 @@
-sage: Partitions(5,min_slope=1).list()
-[[5], [2, 4]]
+The following bug was reported by an humanoid:
+
+```
+sage: Partitions(5, min_slope=1).list()
+ValueError: [2, 4] is not a valid partition
+```
+
+Even worse (since silent):
+
+```
+sage: Partitions(5, min_slope=2).list()
+[[5]]
+```
+
+Or
+
+
``````




---

archive/issue_events_247805.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-12-26T19:18:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247805"
}
```



---

archive/issue_events_247806.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-12-26T19:18:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247806"
}
```



---

archive/issue_comments_235364.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:\n\n```\n- ``min_slope=k`` specifies that the partitions have slope at least\n  `k`; the slope is the difference between successive parts.\n```\nThe second input is actually correct, that is the only partition of 5 with a positive slope (provided you don't count trailing 0's, which is how Sage currently behaves). With that being said, the internal assumptions of `IntegerListsLex` are also being broken with `min_slope > max_slope == 0`, so it's no surprise bad data is being returned. So this should be a wontfix.",
    "created_at": "2014-12-26T19:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235364",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:

```
- ``min_slope=k`` specifies that the partitions have slope at least
  `k`; the slope is the difference between successive parts.
```
The second input is actually correct, that is the only partition of 5 with a positive slope (provided you don't count trailing 0's, which is how Sage currently behaves). With that being said, the internal assumptions of `IntegerListsLex` are also being broken with `min_slope > max_slope == 0`, so it's no surprise bad data is being returned. So this should be a wontfix.



---

archive/issue_events_247807.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-12-26T19:18:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247807"
}
```



---

archive/issue_comments_235365.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nDoes this also qualify as bad input ?\n\n```\nsage: list(Partitions(5,length=4,min_slope=0))\n...\nValueError: [1, 1, 1, 2] is not a valid partition\n```\n\nNathann",
    "created_at": "2014-12-27T02:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235365",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:8" align="right">comment:8</div>

Does this also qualify as bad input ?

```
sage: list(Partitions(5,length=4,min_slope=0))
...
ValueError: [1, 1, 1, 2] is not a valid partition
```

Nathann



---

archive/issue_comments_235366.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nCurrently yes. From the doc of `IntegerListsLex` (which is the underlying class):\n\n```\n   Note: Caveat: with the current implementation, the constraints\n     should satisfy the following conditions:\n\n     * The upper and lower bounds themselves should satisfy the\n       slope constraints.\n\n     * The maximal and minimal slopes values should not be equal.\n\n     * The maximal and minimal part values should not be equal.\n```",
    "created_at": "2014-12-27T03:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235366",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):

```
   Note: Caveat: with the current implementation, the constraints
     should satisfy the following conditions:

     * The upper and lower bounds themselves should satisfy the
       slope constraints.

     * The maximal and minimal slopes values should not be equal.

     * The maximal and minimal part values should not be equal.
```



---

archive/issue_comments_235367.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):\n\nCool. So the strategy is to close as wontfix the attempts to change that because, after all, it is not a bug ?\n\nNathann",
    "created_at": "2014-12-27T03:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235367",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

> Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):

Cool. So the strategy is to close as wontfix the attempts to change that because, after all, it is not a bug ?

Nathann



---

archive/issue_comments_235368.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe other option would be to recycle this ticket to use for rewriting `IntegerListsLex`, but in terms of historical documentation, I think this would best done on a new ticket.",
    "created_at": "2014-12-27T04:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235368",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

The other option would be to recycle this ticket to use for rewriting `IntegerListsLex`, but in terms of historical documentation, I think this would best done on a new ticket.



---

archive/issue_comments_235369.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOK, this ticket should be closed",
    "created_at": "2014-12-27T07:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235369",
    "user": "https://github.com/sagetrac-ferriszorro"
}
```

<div id="comment:12" align="right">comment:12</div>

OK, this ticket should be closed



---

archive/issue_comments_235370.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@tscrim](#comment%3A7):\n> This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:\n> \n> ```\n> - ``min_slope=k`` specifies that the partitions have slope at least\n>   `k`; the slope is the difference between successive parts.\n> ```\n\nThis is confusing: the difference between `a` and `b` is `a-b` and not `b-a`. But hopefully, it is clear in the doctest.",
    "created_at": "2014-12-28T11:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235370",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@tscrim](#comment%3A7):
> This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:
> 
> ```
> - ``min_slope=k`` specifies that the partitions have slope at least
>   `k`; the slope is the difference between successive parts.
> ```

This is confusing: the difference between `a` and `b` is `a-b` and not `b-a`. But hopefully, it is clear in the doctest.



---

archive/issue_events_247808.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-01-15T12:46:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247808"
}
```



---

archive/issue_comments_235371.json:
```json
{
    "body": "Author: **Nathann Cohen**",
    "created_at": "2015-01-15T12:46:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235371",
    "user": "https://github.com/nathanncohen"
}
```

Author: **Nathann Cohen**



---

archive/issue_comments_235372.json:
```json
{
    "body": "Branch: **[u/ncohen/17548](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/17548)**",
    "created_at": "2015-01-15T12:46:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235372",
    "user": "https://github.com/nathanncohen"
}
```

Branch: **[u/ncohen/17548](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/17548)**



---

archive/issue_comments_235373.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87fb1030cd271861aafe2fb42e58ab03df87e34a\"><code>87fb103</code></a></td><td><code>17507: change error msg, add doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd71e2b56165de90ef0021e406e07a009878171d\"><code>cd71e2b</code></a></td><td><code>Merge branch 'u/rws/minor_error_with_integral_n__' of trac.sagemath.org:sage into tmp</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2edddbb2212b7c617576dcd35f1437fdaa26f834\"><code>2edddbb</code></a></td><td><code>trac #17548: Partitions() involving min_slope argument is buggy</code></td></tr></table>\n",
    "created_at": "2015-01-15T12:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235373",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87fb1030cd271861aafe2fb42e58ab03df87e34a"><code>87fb103</code></a></td><td><code>17507: change error msg, add doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd71e2b56165de90ef0021e406e07a009878171d"><code>cd71e2b</code></a></td><td><code>Merge branch 'u/rws/minor_error_with_integral_n__' of trac.sagemath.org:sage into tmp</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2edddbb2212b7c617576dcd35f1437fdaa26f834"><code>2edddbb</code></a></td><td><code>trac #17548: Partitions() involving min_slope argument is buggy</code></td></tr></table>




---

archive/issue_comments_235374.json:
```json
{
    "body": "Commit: **[`2edddbb`](https://github.com/sagemath/sagetrac-mirror/commit/2edddbb2212b7c617576dcd35f1437fdaa26f834)**",
    "created_at": "2015-01-15T12:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235374",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`2edddbb`](https://github.com/sagemath/sagetrac-mirror/commit/2edddbb2212b7c617576dcd35f1437fdaa26f834)**



---

archive/issue_comments_235375.json:
```json
{
    "body": "Changed commit from **[`2edddbb`](https://github.com/sagemath/sagetrac-mirror/commit/2edddbb2212b7c617576dcd35f1437fdaa26f834)** to **[`0919653`](https://github.com/sagemath/sagetrac-mirror/commit/0919653ddd6b387f9fc7e409dac55dfc3a5128ce)**",
    "created_at": "2015-01-15T12:47:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235375",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2edddbb`](https://github.com/sagemath/sagetrac-mirror/commit/2edddbb2212b7c617576dcd35f1437fdaa26f834)** to **[`0919653`](https://github.com/sagemath/sagetrac-mirror/commit/0919653ddd6b387f9fc7e409dac55dfc3a5128ce)**



---

archive/issue_comments_235376.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0919653ddd6b387f9fc7e409dac55dfc3a5128ce\"><code>0919653</code></a></td><td><code>trac #17548: Partitions() involving min_slope argument is buggy</code></td></tr></table>\n",
    "created_at": "2015-01-15T12:47:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235376",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0919653ddd6b387f9fc7e409dac55dfc3a5128ce"><code>0919653</code></a></td><td><code>trac #17548: Partitions() involving min_slope argument is buggy</code></td></tr></table>




---

archive/issue_comments_235377.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAahahahahah.\n\nOkay, I spent the last 2h30 hours writing all the equations needed to ensure that there is a solution, and with all possibilities that there are I give up.\n\nI will add a stopgap for this feature as it returns wrong results.\n\nNathann",
    "created_at": "2015-01-15T15:39:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235377",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

Aahahahahah.

Okay, I spent the last 2h30 hours writing all the equations needed to ensure that there is a solution, and with all possibilities that there are I give up.

I will add a stopgap for this feature as it returns wrong results.

Nathann



---

archive/issue_comments_235378.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nStopgap created at #17637.\n\nNathann",
    "created_at": "2015-01-15T15:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235378",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:18" align="right">comment:18</div>

Stopgap created at #17637.

Nathann



---

archive/issue_comments_235379.json:
```json
{
    "body": "Stopgaps: **#17637**",
    "created_at": "2015-01-15T15:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235379",
    "user": "https://github.com/nathanncohen"
}
```

Stopgaps: **#17637**



---

archive/issue_comments_235380.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIt's not a wrong result, it's invalid input because it violates the assumptions.",
    "created_at": "2015-01-15T16:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235380",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

It's not a wrong result, it's invalid input because it violates the assumptions.



---

archive/issue_comments_235381.json:
```json
{
    "body": "Changed branch from **[u/ncohen/17548](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/17548)** to none",
    "created_at": "2015-01-16T04:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235381",
    "user": "https://github.com/nathanncohen"
}
```

Changed branch from **[u/ncohen/17548](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/17548)** to none



---

archive/issue_comments_235382.json:
```json
{
    "body": "Changed commit from **[`0919653`](https://github.com/sagemath/sagetrac-mirror/commit/0919653ddd6b387f9fc7e409dac55dfc3a5128ce)** to none",
    "created_at": "2015-01-16T04:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235382",
    "user": "https://github.com/nathanncohen"
}
```

Changed commit from **[`0919653`](https://github.com/sagemath/sagetrac-mirror/commit/0919653ddd6b387f9fc7e409dac55dfc3a5128ce)** to none



---

archive/issue_comments_235383.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n(the branch does not actually contain useful code. Switching this to `needs_work`)\n\n> It's not a wrong result, it's invalid input because it violates the assumptions.\n\nI was not able to write a patch that checks all assumptions and returns an exception in this case. If these assumptions are so complicated to check we cannot ask the users to check them for themselves before calling the function. Some of them are probably calling this function on bad input, and they are taking a big risk.\n\nNathann",
    "created_at": "2015-01-16T04:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235383",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:20" align="right">comment:20</div>

(the branch does not actually contain useful code. Switching this to `needs_work`)

> It's not a wrong result, it's invalid input because it violates the assumptions.

I was not able to write a patch that checks all assumptions and returns an exception in this case. If these assumptions are so complicated to check we cannot ask the users to check them for themselves before calling the function. Some of them are probably calling this function on bad input, and they are taking a big risk.

Nathann



---

archive/issue_events_247809.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-01-21T09:04:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247809"
}
```



---

archive/issue_events_247810.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-01-21T09:04:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247810"
}
```



---

archive/issue_comments_235384.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n(there is nothing to review here)",
    "created_at": "2015-01-21T09:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235384",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:21" align="right">comment:21</div>

(there is nothing to review here)



---

archive/issue_comments_235385.json:
```json
{
    "body": "Changed author from **Nathann Cohen** to none",
    "created_at": "2015-01-21T09:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235385",
    "user": "https://github.com/nathanncohen"
}
```

Changed author from **Nathann Cohen** to none



---

archive/issue_comments_235386.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,3 @@\n sage: Partitions(5, min_slope=2).list()\n [[5]]\n ```\n-\n-Or\n-\n-\n``````\n",
    "created_at": "2015-02-07T16:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235386",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,3 @@
 sage: Partitions(5, min_slope=2).list()
 [[5]]
 ```
-
-Or
-
-
``````




---

archive/issue_events_247811.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-07T16:22:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "title_is": "Partitions() is buggy",
    "title_was": "Partitions() involving min_slope argument is buggy",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247811"
}
```



---

archive/issue_comments_235387.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nHello,\n\nTwo bug-feature report.\n\n1. Depending on the input, the floor is sometimes `0` and sometimes `1`:\n\n```python\nsage: IntegerListsLex(5, length=3).list()               # ok: it is 0\n[[5, 0, 0],\n [4, 1, 0],\n [4, 0, 1],\n...\n [0, 2, 3],\n [0, 1, 4],\n [0, 0, 5]]\nsage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0\n[[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]\nsage: IntegerListsLex(5, max_slope=0).list()             # now it is 1\n[[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]\n```\n\n2. The iterator is sometimes completely wrong when the set is infinite:\n\n```python\nsage: it = iter(IntegerListsLex(5))\nsage: for _ in range(10): print it.next()\n[5]\n[4, 1]\n[4, 0, 1]\n[4, 0, 0, 1]\n[4, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n```",
    "created_at": "2015-02-22T10:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235387",
    "user": "https://github.com/videlec"
}
```

<div id="comment:25" align="right">comment:25</div>

Hello,

Two bug-feature report.

1. Depending on the input, the floor is sometimes `0` and sometimes `1`:

```python
sage: IntegerListsLex(5, length=3).list()               # ok: it is 0
[[5, 0, 0],
 [4, 1, 0],
 [4, 0, 1],
...
 [0, 2, 3],
 [0, 1, 4],
 [0, 0, 5]]
sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0
[[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]
sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1
[[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]
```

2. The iterator is sometimes completely wrong when the set is infinite:

```python
sage: it = iter(IntegerListsLex(5))
sage: for _ in range(10): print it.next()
[5]
[4, 1]
[4, 0, 1]
[4, 0, 0, 1]
[4, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
```



---

archive/issue_comments_235388.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThis function should be replaced by smaller, more dedicated functions. Making it all fit in something so general makes it very hard to manage.\n\nAnd wrong, too.\n\nNathann",
    "created_at": "2015-02-22T17:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235388",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">comment:26</div>

This function should be replaced by smaller, more dedicated functions. Making it all fit in something so general makes it very hard to manage.

And wrong, too.

Nathann



---

archive/issue_comments_235389.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@videlec](#comment%3A25):\n> 1. Depending on the input, the floor is sometimes `0` and sometimes `1`:\n> \n> ```python\n> sage: IntegerListsLex(5, length=3).list()               # ok: it is 0\n> [[5, 0, 0],\n>  [4, 1, 0],\n>  [4, 0, 1],\n> ...\n>  [0, 2, 3],\n>  [0, 1, 4],\n>  [0, 0, 5]]\n> sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0\n> [[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]\n> sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1\n> [[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]\n> ```\n\nThis is not a bug because this has trailing 0's and there is no way to have a non-trailing 0 in the last output. See this part of the documentation:\n\n```\nTwo valid integer lists are considered equivalent if they only\ndiffer by trailing zeroes. In this case, only the list with the\nleast number of trailing zeroes will be produced.\n```\nIt's subtle, but again, not a bug.\n\n> 2. The iterator is sometimes completely wrong when the set is infinite:\n> \n> ```python\n> sage: it = iter(IntegerListsLex(5))\n> sage: for _ in range(10): print it.next()\n> [5]\n> [4, 1]\n> [4, 0, 1]\n> [4, 0, 0, 1]\n> [4, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> ```\n\nThis is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.",
    "created_at": "2015-03-04T23:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235389",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@videlec](#comment%3A25):
> 1. Depending on the input, the floor is sometimes `0` and sometimes `1`:
> 
> ```python
> sage: IntegerListsLex(5, length=3).list()               # ok: it is 0
> [[5, 0, 0],
>  [4, 1, 0],
>  [4, 0, 1],
> ...
>  [0, 2, 3],
>  [0, 1, 4],
>  [0, 0, 5]]
> sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0
> [[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]
> sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1
> [[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]
> ```

This is not a bug because this has trailing 0's and there is no way to have a non-trailing 0 in the last output. See this part of the documentation:

```
Two valid integer lists are considered equivalent if they only
differ by trailing zeroes. In this case, only the list with the
least number of trailing zeroes will be produced.
```
It's subtle, but again, not a bug.

> 2. The iterator is sometimes completely wrong when the set is infinite:
> 
> ```python
> sage: it = iter(IntegerListsLex(5))
> sage: for _ in range(10): print it.next()
> [5]
> [4, 1]
> [4, 0, 1]
> [4, 0, 0, 1]
> [4, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> ```

This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.



---

archive/issue_comments_235390.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@tscrim](#comment%3A27):\n> > 2. The iterator is sometimes completely wrong when the set is infinite:\n> > \n> > ```python\n> > sage: it = iter(IntegerListsLex(5))\n> > sage: for _ in range(10): print it.next()\n> > [5]\n> > [4, 1]\n> > [4, 0, 1]\n> > [4, 0, 0, 1]\n> > [4, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> > ```\n> \n> \n> This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.\n\nThis is a bug! An iterator (finite or infinite) must eventually return every element of the set.",
    "created_at": "2015-03-05T12:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235390",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@tscrim](#comment%3A27):
> > 2. The iterator is sometimes completely wrong when the set is infinite:
> > 
> > ```python
> > sage: it = iter(IntegerListsLex(5))
> > sage: for _ in range(10): print it.next()
> > [5]
> > [4, 1]
> > [4, 0, 1]
> > [4, 0, 0, 1]
> > [4, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> > ```
> 
> 
> This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.

This is a bug! An iterator (finite or infinite) must eventually return every element of the set.



---

archive/issue_comments_235391.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment%3A29):\n> > This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.\n> \n> \n> This is a bug! An iterator (finite or infinite) must eventually return every element of the set.\n\nIt does, but it is doing it by lex ordering, which is different than by length-then-lex ordering. Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?",
    "created_at": "2015-03-05T17:56:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235391",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment%3A29):
> > This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.
> 
> 
> This is a bug! An iterator (finite or infinite) must eventually return every element of the set.

It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering. Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?



---

archive/issue_comments_235392.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n> Is that a bug to you then too?\n\nformally not, but the design is unfortunate.\nI suggest to change the behaviour.\n\n\nJakob",
    "created_at": "2015-03-05T17:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235392",
    "user": "https://github.com/sagetrac-jakobkroeker"
}
```

<div id="comment:31" align="right">comment:31</div>

> Is that a bug to you then too?

formally not, but the design is unfortunate.
I suggest to change the behaviour.


Jakob



---

archive/issue_comments_235393.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@tscrim](#comment%3A30):\n> It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.\n\nOK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.\n\n> Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?\n\nOf course that's a bug.",
    "created_at": "2015-03-06T08:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235393",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@tscrim](#comment%3A30):
> It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.

OK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.

> Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?

Of course that's a bug.



---

archive/issue_comments_235394.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,21 @@\n-The following bug was reported by an humanoid:\n+There are various bugs in `Partitions`/`Compositions`, especially when many constraints are combined:\n \n ```\n sage: Partitions(5, min_slope=1).list()\n ValueError: [2, 4] is not a valid partition\n ```\n \n-Even worse (since silent):\n+```\n+sage: Partitions(6, outer=[4,2], inner=[3,3]).list()\n+[[3, 3]]\n+```\n \n ```\n-sage: Partitions(5, min_slope=2).list()\n-[[5]]\n+sage: Compositions(4, length=3, min_slope=1).list()\n+[[1, 2, 4]]\n ```\n+\n+```\n+sage: Compositions(6, max_part=3, max_slope=-1).list()\n+[[3, 3], [3, 2, 1]]\n+```\n``````\n",
    "created_at": "2015-03-09T14:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235394",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,21 @@
-The following bug was reported by an humanoid:
+There are various bugs in `Partitions`/`Compositions`, especially when many constraints are combined:
 
 ```
 sage: Partitions(5, min_slope=1).list()
 ValueError: [2, 4] is not a valid partition
 ```
 
-Even worse (since silent):
+```
+sage: Partitions(6, outer=[4,2], inner=[3,3]).list()
+[[3, 3]]
+```
 
 ```
-sage: Partitions(5, min_slope=2).list()
-[[5]]
+sage: Compositions(4, length=3, min_slope=1).list()
+[[1, 2, 4]]
 ```
+
+```
+sage: Compositions(6, max_part=3, max_slope=-1).list()
+[[3, 3], [3, 2, 1]]
+```
``````




---

archive/issue_events_247812.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T14:04:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247812"
}
```



---

archive/issue_events_247813.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T14:04:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247813"
}
```



---

archive/issue_comments_235395.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jdemeyer](#comment%3A32):\n> Replying to [@tscrim](#comment%3A30):\n> > It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.\n> \n> OK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.\n> \n> > Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?\n> \n> Of course that's a bug.\n\n+1 -- It is a reasonable basic principle that when iterating over a set S, for every x in S the iterator must eventually return x, as (Jereon said above).  If this is impossible due to constraints on the order of iteration, there should be an error...",
    "created_at": "2015-03-09T14:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235395",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jdemeyer](#comment%3A32):
> Replying to [@tscrim](#comment%3A30):
> > It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.
> 
> OK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.
> 
> > Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?
> 
> Of course that's a bug.

+1 -- It is a reasonable basic principle that when iterating over a set S, for every x in S the iterator must eventually return x, as (Jereon said above).  If this is impossible due to constraints on the order of iteration, there should be an error...



---

archive/issue_comments_235396.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,3 +19,8 @@\n sage: Compositions(6, max_part=3, max_slope=-1).list()\n [[3, 3], [3, 2, 1]]\n ```\n+\n+```\n+sage: Partitions(6, max_part=3, max_slope=-4).list()\n+[[5, 1]]\n+```\n``````\n",
    "created_at": "2015-03-09T17:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235396",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,3 +19,8 @@
 sage: Compositions(6, max_part=3, max_slope=-1).list()
 [[3, 3], [3, 2, 1]]
 ```
+
+```
+sage: Partitions(6, max_part=3, max_slope=-4).list()
+[[5, 1]]
+```
``````




---

archive/issue_comments_235397.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,26 +1,33 @@\n There are various bugs in `Partitions`/`Compositions`, especially when many constraints are combined:\n \n ```\n-sage: Partitions(5, min_slope=1).list()\n-ValueError: [2, 4] is not a valid partition\n+sage: C = Partitions(10, min_part=2, max_slope=-1)\n+sage: [5,3,2] in C\n+True\n+sage: C.list()\n+[[10], [8, 2], [7, 3], [6, 4]]\n ```\n \n ```\n-sage: Partitions(6, outer=[4,2], inner=[3,3]).list()\n-[[3, 3]]\n+sage: C = Compositions(4, min_slope=0, max_slope=0)\n+sage: [1,1,1,1] in C\n+True\n+sage: C.list()\n+[[4], [2, 2]]\n ```\n \n ```\n-sage: Compositions(4, length=3, min_slope=1).list()\n-[[1, 2, 4]]\n+sage: C = Compositions(6, min_length=3, max_length=2)\n+sage: [4,1,1] in C\n+False\n+sage: C.list()[0]\n+[4, 1, 1]\n ```\n \n ```\n-sage: Compositions(6, max_part=3, max_slope=-1).list()\n-[[3, 3], [3, 2, 1]]\n+sage: C = Compositions(4, max_part=2, min_slope=1)\n+sage: [1,3] in C\n+False\n+sage: C.list()\n+[[1, 3]]\n ```\n-\n-```\n-sage: Partitions(6, max_part=3, max_slope=-4).list()\n-[[5, 1]]\n-```\n``````\n",
    "created_at": "2015-03-14T13:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235397",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,26 +1,33 @@
 There are various bugs in `Partitions`/`Compositions`, especially when many constraints are combined:
 
 ```
-sage: Partitions(5, min_slope=1).list()
-ValueError: [2, 4] is not a valid partition
+sage: C = Partitions(10, min_part=2, max_slope=-1)
+sage: [5,3,2] in C
+True
+sage: C.list()
+[[10], [8, 2], [7, 3], [6, 4]]
 ```
 
 ```
-sage: Partitions(6, outer=[4,2], inner=[3,3]).list()
-[[3, 3]]
+sage: C = Compositions(4, min_slope=0, max_slope=0)
+sage: [1,1,1,1] in C
+True
+sage: C.list()
+[[4], [2, 2]]
 ```
 
 ```
-sage: Compositions(4, length=3, min_slope=1).list()
-[[1, 2, 4]]
+sage: C = Compositions(6, min_length=3, max_length=2)
+sage: [4,1,1] in C
+False
+sage: C.list()[0]
+[4, 1, 1]
 ```
 
 ```
-sage: Compositions(6, max_part=3, max_slope=-1).list()
-[[3, 3], [3, 2, 1]]
+sage: C = Compositions(4, max_part=2, min_slope=1)
+sage: [1,3] in C
+False
+sage: C.list()
+[[1, 3]]
 ```
-
-```
-sage: Partitions(6, max_part=3, max_slope=-4).list()
-[[5, 1]]
-```
``````




---

archive/issue_comments_235398.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,8 @@\n [[10], [8, 2], [7, 3], [6, 4]]\n ```\n \n+When slopes are equal, things often go wrong:\n+\n ```\n sage: C = Compositions(4, min_slope=0, max_slope=0)\n sage: [1,1,1,1] in C\n@@ -15,6 +17,8 @@\n sage: C.list()\n [[4], [2, 2]]\n ```\n+\n+Contradictory length bounds still give results:\n \n ```\n sage: C = Compositions(6, min_length=3, max_length=2)\n@@ -24,6 +28,8 @@\n [4, 1, 1]\n ```\n \n+`max_part` is not respected:\n+\n ```\n sage: C = Compositions(4, max_part=2, min_slope=1)\n sage: [1,3] in C\n@@ -31,3 +37,11 @@\n sage: C.list()\n [[1, 3]]\n ```\n+\n+Strange exception which really shouldn't be an exception:\n+\n+```\n+sage: Compositions(10, inner=[1,1], max_slope=-1)\n+...\n+ValueError: floor does not satisfy the max slope condition\n+```\n``````\n",
    "created_at": "2015-03-14T13:49:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235398",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,8 @@
 [[10], [8, 2], [7, 3], [6, 4]]
 ```
 
+When slopes are equal, things often go wrong:
+
 ```
 sage: C = Compositions(4, min_slope=0, max_slope=0)
 sage: [1,1,1,1] in C
@@ -15,6 +17,8 @@
 sage: C.list()
 [[4], [2, 2]]
 ```
+
+Contradictory length bounds still give results:
 
 ```
 sage: C = Compositions(6, min_length=3, max_length=2)
@@ -24,6 +28,8 @@
 [4, 1, 1]
 ```
 
+`max_part` is not respected:
+
 ```
 sage: C = Compositions(4, max_part=2, min_slope=1)
 sage: [1,3] in C
@@ -31,3 +37,11 @@
 sage: C.list()
 [[1, 3]]
 ```
+
+Strange exception which really shouldn't be an exception:
+
+```
+sage: Compositions(10, inner=[1,1], max_slope=-1)
+...
+ValueError: floor does not satisfy the max slope condition
+```
``````




---

archive/issue_comments_235399.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,14 @@\n True\n sage: C.list()\n [[10], [8, 2], [7, 3], [6, 4]]\n+```\n+\n+```\n+sage: C = Compositions(5, max_part=2, min_slope=1, inner=[2])\n+sage: [2,1,2] in C\n+False\n+sage: C.list()\n+[[2, 1, 2]]\n ```\n \n When slopes are equal, things often go wrong:\n@@ -28,6 +36,14 @@\n [4, 1, 1]\n ```\n \n+```\n+sage: C = Compositions(3, max_length=2, inner=[1,1,1])\n+sage: [1,1,1] in C\n+False\n+sage: C.list()\n+[[1, 1, 1]]\n+```\n+\n `max_part` is not respected:\n \n ```\n``````\n",
    "created_at": "2015-03-14T13:57:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235399",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,14 @@
 True
 sage: C.list()
 [[10], [8, 2], [7, 3], [6, 4]]
+```
+
+```
+sage: C = Compositions(5, max_part=2, min_slope=1, inner=[2])
+sage: [2,1,2] in C
+False
+sage: C.list()
+[[2, 1, 2]]
 ```
 
 When slopes are equal, things often go wrong:
@@ -28,6 +36,14 @@
 [4, 1, 1]
 ```
 
+```
+sage: C = Compositions(3, max_length=2, inner=[1,1,1])
+sage: [1,1,1] in C
+False
+sage: C.list()
+[[1, 1, 1]]
+```
+
 `max_part` is not respected:
 
 ```
``````




---

archive/issue_comments_235400.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -54,6 +54,13 @@\n [[1, 3]]\n ```\n \n+This is horribly wrong:\n+\n+```\n+sage: Compositions(7, max_part=4, inner=[1], min_slope=1).list()\n+[[3, 5], [1, 3, 4]]\n+```\n+\n Strange exception which really shouldn't be an exception:\n \n ```\n``````\n",
    "created_at": "2015-03-14T14:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235400",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -54,6 +54,13 @@
 [[1, 3]]
 ```
 
+This is horribly wrong:
+
+```
+sage: Compositions(7, max_part=4, inner=[1], min_slope=1).list()
+[[3, 5], [1, 3, 4]]
+```
+
 Strange exception which really shouldn't be an exception:
 
 ```
``````




---

archive/issue_comments_235401.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,6 +24,14 @@\n True\n sage: C.list()\n [[4], [2, 2]]\n+```\n+\n+```\n+sage: C = Partitions(6, min_slope=-1, max_slope=-1)\n+sage: [3,2,1] in C\n+True\n+sage: C.list()\n+[[6]]\n ```\n \n Contradictory length bounds still give results:\n``````\n",
    "created_at": "2015-03-14T14:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235401",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,6 +24,14 @@
 True
 sage: C.list()
 [[4], [2, 2]]
+```
+
+```
+sage: C = Partitions(6, min_slope=-1, max_slope=-1)
+sage: [3,2,1] in C
+True
+sage: C.list()
+[[6]]
 ```
 
 Contradictory length bounds still give results:
``````




---

archive/issue_comments_235402.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -52,6 +52,14 @@\n [[1, 1, 1]]\n ```\n \n+```\n+sage: C = Compositions(10, outer=[4], inner=[1,1])\n+sage: [4,6] in C\n+False\n+sage: C.list()\n+[[4, 6], [3, 7], [2, 8], [1, 9]]\n+```\n+\n `max_part` is not respected:\n \n ```\n``````\n",
    "created_at": "2015-03-14T14:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235402",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -52,6 +52,14 @@
 [[1, 1, 1]]
 ```
 
+```
+sage: C = Compositions(10, outer=[4], inner=[1,1])
+sage: [4,6] in C
+False
+sage: C.list()
+[[4, 6], [3, 7], [2, 8], [1, 9]]
+```
+
 `max_part` is not respected:
 
 ```
``````




---

archive/issue_comments_235403.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -77,6 +77,13 @@\n [[3, 5], [1, 3, 4]]\n ```\n \n+The following command hangs:\n+\n+```\n+sage: Compositions(4, inner=[2], outer=[2,2], min_slope=0).list()\n+...\n+```\n+\n Strange exception which really shouldn't be an exception:\n \n ```\n``````\n",
    "created_at": "2015-03-14T14:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235403",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -77,6 +77,13 @@
 [[3, 5], [1, 3, 4]]
 ```
 
+The following command hangs:
+
+```
+sage: Compositions(4, inner=[2], outer=[2,2], min_slope=0).list()
+...
+```
+
 Strange exception which really shouldn't be an exception:
 
 ```
``````




---

archive/issue_comments_235404.json:
```json
{
    "body": "Changed stopgaps from **#17637** to **#17637, #17956**",
    "created_at": "2015-03-14T14:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235404",
    "user": "https://github.com/jdemeyer"
}
```

Changed stopgaps from **#17637** to **#17637, #17956**



---

archive/issue_comments_235405.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -91,3 +91,5 @@\n ...\n ValueError: floor does not satisfy the max slope condition\n ```\n+\n+One possible fix is given by #17920.\n``````\n",
    "created_at": "2015-03-15T15:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235405",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -91,3 +91,5 @@
 ...
 ValueError: floor does not satisfy the max slope condition
 ```
+
+One possible fix is given by #17920.
``````




---

archive/issue_comments_235406.json:
```json
{
    "body": "Branch: **[public/combinat/equal_min_max_slope_fix](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/equal_min_max_slope_fix)**",
    "created_at": "2015-03-16T05:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235406",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/combinat/equal_min_max_slope_fix](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/equal_min_max_slope_fix)**



---

archive/issue_comments_235407.json:
```json
{
    "body": "Commit: **[`52db42b`](https://github.com/sagemath/sagetrac-mirror/commit/52db42b01c1b86c752652a09533e50dd0d899ab3)**",
    "created_at": "2015-03-16T05:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235407",
    "user": "https://github.com/tscrim"
}
```

Commit: **[`52db42b`](https://github.com/sagemath/sagetrac-mirror/commit/52db42b01c1b86c752652a09533e50dd0d899ab3)**



---

archive/issue_comments_235408.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThe branch I've attached fixes the length bounds and when `min_slope == max_slope`. However these violate the internal assumptions:\n\n```\nsage: C = Compositions(4, max_part=2, min_slope=1)\nsage: Compositions(7, max_part=4, inner=[1], min_slope=1)\n```\nsince the ceiling defaults to `max_part`, which is always 2/4 and has a slope of 0 and violates the `min_slope` condition (i.e., the ceiling must be increasing).\n\nAlso FTR, the last one in the description is the error message that was wanted (precisely because it violates the conditions).",
    "created_at": "2015-03-16T05:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235408",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

The branch I've attached fixes the length bounds and when `min_slope == max_slope`. However these violate the internal assumptions:

```
sage: C = Compositions(4, max_part=2, min_slope=1)
sage: Compositions(7, max_part=4, inner=[1], min_slope=1)
```
since the ceiling defaults to `max_part`, which is always 2/4 and has a slope of 0 and violates the `min_slope` condition (i.e., the ceiling must be increasing).

Also FTR, the last one in the description is the error message that was wanted (precisely because it violates the conditions).



---

archive/issue_comments_235409.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44d1cfb45c137d7d8ac6eb481bf6145ec57c12e4\"><code>44d1cfb</code></a></td><td><code>Fixes for min_slope == max_slope and length conditions.</code></td></tr></table>\n",
    "created_at": "2015-03-16T05:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235409",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44d1cfb45c137d7d8ac6eb481bf6145ec57c12e4"><code>44d1cfb</code></a></td><td><code>Fixes for min_slope == max_slope and length conditions.</code></td></tr></table>




---

archive/issue_comments_235410.json:
```json
{
    "body": "Changed commit from **[`52db42b`](https://github.com/sagemath/sagetrac-mirror/commit/52db42b01c1b86c752652a09533e50dd0d899ab3)** to **[`44d1cfb`](https://github.com/sagemath/sagetrac-mirror/commit/44d1cfb45c137d7d8ac6eb481bf6145ec57c12e4)**",
    "created_at": "2015-03-16T05:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235410",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`52db42b`](https://github.com/sagemath/sagetrac-mirror/commit/52db42b01c1b86c752652a09533e50dd0d899ab3)** to **[`44d1cfb`](https://github.com/sagemath/sagetrac-mirror/commit/44d1cfb45c137d7d8ac6eb481bf6145ec57c12e4)**



---

archive/issue_comments_235411.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@tscrim](#comment%3A45):\n> the last one in the description is the error message that was wanted (precisely because it violates the conditions).\n\nMy point with the last one is that it should simply be allowed input. There is no fundamental reason why\n\n```\nsage: Compositions(10, inner=[1,1], max_slope=-1)\n```\nshouldn't \"just work\".",
    "created_at": "2015-03-16T07:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235411",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@tscrim](#comment%3A45):
> the last one in the description is the error message that was wanted (precisely because it violates the conditions).

My point with the last one is that it should simply be allowed input. There is no fundamental reason why

```
sage: Compositions(10, inner=[1,1], max_slope=-1)
```
shouldn't "just work".



---

archive/issue_comments_235412.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@tscrim](#comment%3A45):\n> These violate the internal assumptions\n\nThen you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.\n\nBut even better would be to just allow such input.",
    "created_at": "2015-03-16T07:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235412",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@tscrim](#comment%3A45):
> These violate the internal assumptions

Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.

But even better would be to just allow such input.



---

archive/issue_comments_235413.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@jdemeyer](#comment%3A48):\n> Replying to [@tscrim](#comment%3A45):\n> > These violate the internal assumptions\n> \n> Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.\n> \n> But even better would be to just allow such input.\n\nIn principle, all these bugs should now be fixed with #17979. Please check!",
    "created_at": "2015-03-24T03:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235413",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@jdemeyer](#comment%3A48):
> Replying to [@tscrim](#comment%3A45):
> > These violate the internal assumptions
> 
> Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.
> 
> But even better would be to just allow such input.

In principle, all these bugs should now be fixed with #17979. Please check!



---

archive/issue_events_247814.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-13T12:47:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247814"
}
```



---

archive/issue_events_247815.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-13T12:47:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247815"
}
```



---

archive/issue_events_247816.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-13T12:47:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247816"
}
```



---

archive/issue_comments_235414.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-04-13T12:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17548#issuecomment-235414",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_247817.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-13T17:47:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247817"
}
```



---

archive/issue_events_247818.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-13T17:47:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247818"
}
```



---

archive/issue_events_247819.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-13T17:47:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247819"
}
```



---

archive/issue_events_247820.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-13T17:47:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17548",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "c6c6c6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17548#event-247820"
}
```
