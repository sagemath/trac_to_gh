# Issue 17587: ToricLattice: fix use of span() and span_of_basis()

archive/issues_017350.json:
```json
{
    "body": "The methods `span` and `span_of_basis` of `ToricLattice_generic` should work when given a `base_ring` and such a `base_ring` must be given whenever the elements of the basis are not integers.\n\nThis is needed in preparation of #17585, where\n\n```\nsage: N = ToricLattice(3)\nsage: Ns = N.span_of_basis([(1,2,3)])\nsage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])\n```\nwill become an error, since `ToricLattice_generic` explicitly has\n\n```\nElement = ToricLatticeElement\n```\nwhich derives from `Vector_integer_dense`.\n\nCurrent code overrides the element class if needed, after #17585 that will no longer work.\n\nCC:  @vbraun @novoselt\n\nBranch/Commit: d941a1762c4cfd4da9d186992d19a80e572b6c4d\n\nReviewer: Jeroen Demeyer\n\nAuthor: Andrey Novoseltsev\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17587\n\n",
    "closed_at": "2015-01-24T13:18:59Z",
    "created_at": "2015-01-05T18:41:05Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "ToricLattice: fix use of span() and span_of_basis()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17587",
    "user": "https://github.com/jdemeyer"
}
```
The methods `span` and `span_of_basis` of `ToricLattice_generic` should work when given a `base_ring` and such a `base_ring` must be given whenever the elements of the basis are not integers.

This is needed in preparation of #17585, where

```
sage: N = ToricLattice(3)
sage: Ns = N.span_of_basis([(1,2,3)])
sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])
```
will become an error, since `ToricLattice_generic` explicitly has

```
Element = ToricLatticeElement
```
which derives from `Vector_integer_dense`.

Current code overrides the element class if needed, after #17585 that will no longer work.

CC:  @vbraun @novoselt

Branch/Commit: d941a1762c4cfd4da9d186992d19a80e572b6c4d

Reviewer: Jeroen Demeyer

Author: Andrey Novoseltsev

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17587





---

archive/issue_comments_245861.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,11 +5,16 @@\n ```\n sage: N = ToricLattice(3)\n sage: Ns = N.span_of_basis([(1,2,3)])\n-sage: Ns.span_of_basis([(2,4,0)])\n-Sublattice <N(2, 4, 0)>\n sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])\n ```\n-will become an error, since the ring is assumed to be `ZZ` but the elements are actually rationals.\n+will become an error, since `ToricLattice_generic` explicitly has\n+\n+```\n+Element = ToricLatticeElement\n+```\n+which derives from `Vector_integer_dense`.\n+\n+Current code overrides the element class if needed, after #17585 that will no longer work.\n \n Author: Jeroen Demeyer\n \n``````\n",
    "created_at": "2015-01-05T18:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245861",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,11 +5,16 @@
 ```
 sage: N = ToricLattice(3)
 sage: Ns = N.span_of_basis([(1,2,3)])
-sage: Ns.span_of_basis([(2,4,0)])
-Sublattice <N(2, 4, 0)>
 sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])
 ```
-will become an error, since the ring is assumed to be `ZZ` but the elements are actually rationals.
+will become an error, since `ToricLattice_generic` explicitly has
+
+```
+Element = ToricLatticeElement
+```
+which derives from `Vector_integer_dense`.
+
+Current code overrides the element class if needed, after #17585 that will no longer work.
 
 Author: Jeroen Demeyer
 
``````




---

archive/issue_comments_245862.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-05T18:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245862",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245863.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2015-01-05T18:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245863",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_245864.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-01-05T19:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245864",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_245865.json:
```json
{
    "body": "<a id='comment:4'></a>Why QQ was added in the last line? It seems to me that a saturated sublattice should be constructed there, without any fractional generators.",
    "created_at": "2015-01-05T19:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245865",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>Why QQ was added in the last line? It seems to me that a saturated sublattice should be constructed there, without any fractional generators.



---

archive/issue_comments_245866.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 novoselt]:\n> Why QQ was added in the last line? It seems to me that a saturated sublattice should be constructed there, without any fractional generators.\n\n\nI don't completely understand what you mean, but the problem is that `base_cone_preimg` can have coefficients in `QQ`. So either we add `QQ` there, or we change the `span()` method to not default to `ZZ`.",
    "created_at": "2015-01-05T22:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245866",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:4 novoselt]:
> Why QQ was added in the last line? It seems to me that a saturated sublattice should be constructed there, without any fractional generators.


I don't completely understand what you mean, but the problem is that `base_cone_preimg` can have coefficients in `QQ`. So either we add `QQ` there, or we change the `span()` method to not default to `ZZ`.



---

archive/issue_comments_245867.json:
```json
{
    "body": "<a id='comment:6'></a>But the module is over ZZ for the sake of using saturation, which works differently for QQ:\n\n```\nsage: M = ZZ^3\nsage: M.span_of_basis([(1,1/2,1/3)])\nFree module of degree 3 and rank 1 over Integer Ring\nUser basis matrix:\n[  1 1/2 1/3]\nsage: _.saturation()\nFree module of degree 3 and rank 1 over Integer Ring\nEchelon basis matrix:\n[6 3 2]\nsage: M.span_of_basis([(1,1/2,1/3)], QQ)\nVector space of degree 3 and dimension 1 over Rational Field\nUser basis matrix:\n[  1 1/2 1/3]\nsage: _.saturation()\nVector space of degree 3 and dimension 1 over Rational Field\nUser basis matrix:\n[  1 1/2 1/3]\n```",
    "created_at": "2015-01-05T22:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245867",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>But the module is over ZZ for the sake of using saturation, which works differently for QQ:

```
sage: M = ZZ^3
sage: M.span_of_basis([(1,1/2,1/3)])
Free module of degree 3 and rank 1 over Integer Ring
User basis matrix:
[  1 1/2 1/3]
sage: _.saturation()
Free module of degree 3 and rank 1 over Integer Ring
Echelon basis matrix:
[6 3 2]
sage: M.span_of_basis([(1,1/2,1/3)], QQ)
Vector space of degree 3 and dimension 1 over Rational Field
User basis matrix:
[  1 1/2 1/3]
sage: _.saturation()
Vector space of degree 3 and dimension 1 over Rational Field
User basis matrix:
[  1 1/2 1/3]
```



---

archive/issue_comments_245868.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-06T08:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245869.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-01-06T08:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245869",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_245870.json:
```json
{
    "body": "<a id='comment:8'></a>I think this is a better solution then.",
    "created_at": "2015-01-06T08:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245870",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I think this is a better solution then.



---

archive/issue_comments_245871.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-06T08:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245872.json:
```json
{
    "body": "<a id='comment:10'></a>I don't think such complications are necessary and what exactly is the point of this ticket? The example from the descriptions currently gives\n\n```\nsage: sage: N = ToricLattice(3)\nsage: sage: Ns = N.span_of_basis([(1,2,3)])\nsage: sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])\nSublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>\n```\nand perhaps this can be claimed as a bug unrelated to any coming changes - there is nothing wrong with the span call on fractional vectors, but calling it a sublattice is strange/wrong (even if it looks to me that I am the one who allowed it). The solution should be, I think: try to return a sublattice and if it does not work because given vectors are not integral or a different ring is requested - return a free module with the same dimension etc.\n\nIn particular there will be no need to mess with the morphism code at all.\n\nIt is a bit unfortunate that we have\n\n```\nsage: N.change_ring(QQ) is N.dual().change_ring(QQ)\nTrue\n```\nbut fixing it is quite a bit of work, since basically I want named modules which are isomorphic but have no canonical isomorphism, as it is the case with ``N`` and ``N.dual()``.",
    "created_at": "2015-01-07T20:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245872",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>I don't think such complications are necessary and what exactly is the point of this ticket? The example from the descriptions currently gives

```
sage: sage: N = ToricLattice(3)
sage: sage: Ns = N.span_of_basis([(1,2,3)])
sage: sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])
Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>
```
and perhaps this can be claimed as a bug unrelated to any coming changes - there is nothing wrong with the span call on fractional vectors, but calling it a sublattice is strange/wrong (even if it looks to me that I am the one who allowed it). The solution should be, I think: try to return a sublattice and if it does not work because given vectors are not integral or a different ring is requested - return a free module with the same dimension etc.

In particular there will be no need to mess with the morphism code at all.

It is a bit unfortunate that we have

```
sage: N.change_ring(QQ) is N.dual().change_ring(QQ)
True
```
but fixing it is quite a bit of work, since basically I want named modules which are isomorphic but have no canonical isomorphism, as it is the case with ``N`` and ``N.dual()``.



---

archive/issue_comments_245873.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 novoselt]:\n> I don't think such complications are necessary and what exactly is the point of this ticket? The example from the descriptions currently gives\n> \n> ```\n> sage: sage: N = ToricLattice(3)\n> sage: sage: Ns = N.span_of_basis([(1,2,3)])\n> sage: sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])\n> Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>\n> ```\n> and perhaps this can be claimed as a bug unrelated to any coming changes - there is nothing wrong with the span call on fractional vectors, but calling it a sublattice is strange/wrong (even if it looks to me that I am the one who allowed it).\n\nWhat's wrong is this:\n\n```\nsage: N = ToricLattice(3)\nsage: Ns = N.span_of_basis([(1,2,3)])\nsage: M1 = Ns.span_of_basis([(1,2,0), (1,1,0)])\nsage: type(M1.basis()[0])\n<type 'sage.geometry.toric_lattice_element.ToricLatticeElement'>\nsage: M2 = Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])\nsage: type(M2.basis()[0])\n<type 'sage.modules.vector_rational_dense.Vector_rational_dense'>\n```\nYou have a `ToricLattice_generic`, but the basis consists simply of rational vectors, having nothing to do with lattices. The fact that this does *not* raise an exception is a bug which I'm fixing in #17585: if `ToricLattice_generic` states `Element = ToricLatticeElement`, the module code shouldn't change this.\n\n> The solution should be, I think: try to return a sublattice and if it does not work because given vectors are not integral or a different ring is requested - return a free module with the same dimension etc.\n\nThat *could* be a solution, but I prefer to be explicit. With my solution, you at least know and expect that the result won't be a toric lattice.",
    "created_at": "2015-01-07T21:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245873",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 novoselt]:
> I don't think such complications are necessary and what exactly is the point of this ticket? The example from the descriptions currently gives
> 
> ```
> sage: sage: N = ToricLattice(3)
> sage: sage: Ns = N.span_of_basis([(1,2,3)])
> sage: sage: Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])
> Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>
> ```
> and perhaps this can be claimed as a bug unrelated to any coming changes - there is nothing wrong with the span call on fractional vectors, but calling it a sublattice is strange/wrong (even if it looks to me that I am the one who allowed it).

What's wrong is this:

```
sage: N = ToricLattice(3)
sage: Ns = N.span_of_basis([(1,2,3)])
sage: M1 = Ns.span_of_basis([(1,2,0), (1,1,0)])
sage: type(M1.basis()[0])
<type 'sage.geometry.toric_lattice_element.ToricLatticeElement'>
sage: M2 = Ns.span_of_basis([(1/5,2/5,0), (1/7,1/7,0)])
sage: type(M2.basis()[0])
<type 'sage.modules.vector_rational_dense.Vector_rational_dense'>
```
You have a `ToricLattice_generic`, but the basis consists simply of rational vectors, having nothing to do with lattices. The fact that this does *not* raise an exception is a bug which I'm fixing in #17585: if `ToricLattice_generic` states `Element = ToricLatticeElement`, the module code shouldn't change this.

> The solution should be, I think: try to return a sublattice and if it does not work because given vectors are not integral or a different ring is requested - return a free module with the same dimension etc.

That *could* be a solution, but I prefer to be explicit. With my solution, you at least know and expect that the result won't be a toric lattice.



---

archive/issue_comments_245874.json:
```json
{
    "body": "<a id='comment:12'></a>The span of given vectors over given field should either exist or not, and what it is should not depend on some strange keyword parameter whose existence is impossible to guess (and documenting them is not quite a solution - who will read `span` documentation for each class they use???\n\nToric lattices were designed to implement \"named\" copies of `ZZ^n` and their sublattices and (free) quotients. `Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>` or some generic toric lattice on these vectors most probably just should not exist.",
    "created_at": "2015-01-07T22:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245874",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:12'></a>The span of given vectors over given field should either exist or not, and what it is should not depend on some strange keyword parameter whose existence is impossible to guess (and documenting them is not quite a solution - who will read `span` documentation for each class they use???

Toric lattices were designed to implement "named" copies of `ZZ^n` and their sublattices and (free) quotients. `Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>` or some generic toric lattice on these vectors most probably just should not exist.



---

archive/issue_comments_245875.json:
```json
{
    "body": "<a id='comment:13'></a>Volker, do you have any preferences about it?",
    "created_at": "2015-01-07T22:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245875",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:13'></a>Volker, do you have any preferences about it?



---

archive/issue_comments_245876.json:
```json
{
    "body": "<a id='comment:14'></a>Whats the question?\n* If possible then `M.span()` should raise an error if the given vectors do not lie in `M`\n* I don't mind a shortcut `M.span(..., base_ring=QQ)` for `M.change_ring(QQ).span(...)`.",
    "created_at": "2015-01-08T00:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245876",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>Whats the question?
* If possible then `M.span()` should raise an error if the given vectors do not lie in `M`
* I don't mind a shortcut `M.span(..., base_ring=QQ)` for `M.change_ring(QQ).span(...)`.



---

archive/issue_comments_245877.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 vbraun]:\n> Whats the question?\n> * If possible then `M.span()` should raise an error if the given vectors do not lie in `M`\n> * I don't mind a shortcut `M.span(..., base_ring=QQ)` for `M.change_ring(QQ).span(...)`.\n\n\nMy objection is to `toric` in `M.span(..., toric=True/False)` as obscure.\n\nWhether it is OK to call `M.span(...)` for vectors not in `M` but in `M.change_ring(QQ)` is a more general question. Certainly it should be possible to make a module of integral combinations of rational vectors. The question is what should be the interface for it.",
    "created_at": "2015-01-08T00:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245877",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'></a>Replying to [comment:14 vbraun]:
> Whats the question?
> * If possible then `M.span()` should raise an error if the given vectors do not lie in `M`
> * I don't mind a shortcut `M.span(..., base_ring=QQ)` for `M.change_ring(QQ).span(...)`.


My objection is to `toric` in `M.span(..., toric=True/False)` as obscure.

Whether it is OK to call `M.span(...)` for vectors not in `M` but in `M.change_ring(QQ)` is a more general question. Certainly it should be possible to make a module of integral combinations of rational vectors. The question is what should be the interface for it.



---

archive/issue_comments_245878.json:
```json
{
    "body": "<a id='comment:16'></a>Oh ok, I don't like the toric=True option either. \n\nCan we (easily) change the toric code so that we don't have to rely on `M_ZZ.span(QQ-vectors)` at all?",
    "created_at": "2015-01-08T01:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245878",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>Oh ok, I don't like the toric=True option either. 

Can we (easily) change the toric code so that we don't have to rely on `M_ZZ.span(QQ-vectors)` at all?



---

archive/issue_comments_245879.json:
```json
{
    "body": "<a id='comment:17'></a>I think so - for the morphism code we care about directions only, as we are taking saturation in the end. A call to `normalize_rays` should work there without much performance loss. Will try to write a patch tomorrow - got to catch a bus!",
    "created_at": "2015-01-08T01:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245879",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:17'></a>I think so - for the morphism code we care about directions only, as we are taking saturation in the end. A call to `normalize_rays` should work there without much performance loss. Will try to write a patch tomorrow - got to catch a bus!



---

archive/issue_comments_245880.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:12 novoselt]:\n> `Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>` or some generic toric lattice on these vectors most probably just should not exist.\n\nAfter #17585 it won't exist anymore.",
    "created_at": "2015-01-08T08:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245880",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:12 novoselt]:
> `Sublattice <(1/5, 2/5, 0), (1/7, 1/7, 0)>` or some generic toric lattice on these vectors most probably just should not exist.

After #17585 it won't exist anymore.



---

archive/issue_comments_245881.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-08T20:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245881",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_245882.json:
```json
{
    "body": "<a id='comment:21'></a>The commit just points to\n\n```\ncommit 9e13c1b5422e475827e3c3d3a5daf61a4b0ebc57\nAuthor: Volker Braun <vbraun.name@gmail.com>\nDate:   Mon Jan 5 22:57:05 2015 +0100\n\n    Updated Sage version to 6.5.beta5\n```",
    "created_at": "2015-01-08T20:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245882",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>The commit just points to

```
commit 9e13c1b5422e475827e3c3d3a5daf61a4b0ebc57
Author: Volker Braun <vbraun.name@gmail.com>
Date:   Mon Jan 5 22:57:05 2015 +0100

    Updated Sage version to 6.5.beta5
```



---

archive/issue_comments_245883.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-08T21:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245884.json:
```json
{
    "body": "<a id='comment:23'></a>Yes, I forgot to commit, but then though of a simpler way. Basically, I just create now generic module instead of a toric sublattice when generators are not integral. This is in line with how other `span` methods work and hopefully will be sufficient for the switch you are working on.",
    "created_at": "2015-01-08T21:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245884",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:23'></a>Yes, I forgot to commit, but then though of a simpler way. Basically, I just create now generic module instead of a toric sublattice when generators are not integral. This is in line with how other `span` methods work and hopefully will be sufficient for the switch you are working on.



---

archive/issue_comments_245885.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-01-09T05:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245885",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245886.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-21T16:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245886",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245887.json:
```json
{
    "body": "<a id='comment:25'></a>I don't really like the solution, but it works and that suffices for me.",
    "created_at": "2015-01-21T16:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245887",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>I don't really like the solution, but it works and that suffices for me.



---

archive/issue_comments_245888.json:
```json
{
    "body": "<a id='comment:26'></a>What exactly is the problem? I see two:\n1. `N.span` works at all for elements that do not generate a submodule of `N`.\n2. `N.span` for a toric lattice returns a non-toric thing.\nBut 1 is the way Sage works, so if it is changed it is better be changed everywhere and it will break a lot of user code too. As for 2 - writing custom classes for `N \\otimes QQ` and its submodule would be useful, but is not the top priority for me personally and we managed to go a long way in toric stuff without implementing it...",
    "created_at": "2015-01-21T18:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245888",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:26'></a>What exactly is the problem? I see two:
1. `N.span` works at all for elements that do not generate a submodule of `N`.
2. `N.span` for a toric lattice returns a non-toric thing.
But 1 is the way Sage works, so if it is changed it is better be changed everywhere and it will break a lot of user code too. As for 2 - writing custom classes for `N \otimes QQ` and its submodule would be useful, but is not the top priority for me personally and we managed to go a long way in toric stuff without implementing it...



---

archive/issue_comments_245889.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 novoselt]:\n> What exactly is the problem?\n\nMainly the fact that the difference between returning a toric lattice and a free module is done very implicitly. In particular, there is no way to force the returning of a free module (as opposed to a toric lattice).\n\nSage is supposed to have the philosophy that the *type* of the output should only depend on the *type* of the input, not the *values* of the input.",
    "created_at": "2015-01-21T19:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245889",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:26 novoselt]:
> What exactly is the problem?

Mainly the fact that the difference between returning a toric lattice and a free module is done very implicitly. In particular, there is no way to force the returning of a free module (as opposed to a toric lattice).

Sage is supposed to have the philosophy that the *type* of the output should only depend on the *type* of the input, not the *values* of the input.



---

archive/issue_comments_245890.json:
```json
{
    "body": "<a id='comment:28'></a>In what situations will you **want** a non-toric output from a toric span? The reason for its current presence at all is that we don't have a toric implementation for the ambient vector space. One it is implemented, there will be no non-toric output at all. A technically clean resolution to it meanwhile is to raise `NotImplementedError` for some input, but I'd rather not.",
    "created_at": "2015-01-21T19:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245890",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:28'></a>In what situations will you **want** a non-toric output from a toric span? The reason for its current presence at all is that we don't have a toric implementation for the ambient vector space. One it is implemented, there will be no non-toric output at all. A technically clean resolution to it meanwhile is to raise `NotImplementedError` for some input, but I'd rather not.



---

archive/issue_comments_245891.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 novoselt]:\n> In what situations will you **want** a non-toric output from a toric span?\n\nI have no idea, I don't use this code, I only created this ticket because it broke #17585.",
    "created_at": "2015-01-21T19:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245891",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>Replying to [comment:28 novoselt]:
> In what situations will you **want** a non-toric output from a toric span?

I have no idea, I don't use this code, I only created this ticket because it broke #17585.



---

archive/issue_comments_245892.json:
```json
{
    "body": "<a id='comment:30'></a>Author name is missing",
    "created_at": "2015-01-23T23:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245892",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>Author name is missing



---

archive/issue_comments_245893.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-01-23T23:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245893",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_245894.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-01-23T23:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245894",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_050451.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-24T13:18:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17587#event-50451"
}
```



---

archive/issue_comments_245895.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-24T13:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17587#issuecomment-245895",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
