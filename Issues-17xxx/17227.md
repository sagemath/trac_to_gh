# Issue 17227: Add new cutting rules for computing hyperbolicity

archive/issues_016990.json:
```json
{
    "body": "This patch adds two cutting rules, one for the `'basic'` algorithm and one for the `'cuts'` algorithm.\n* the new `'basic+'` algorithm uses the new cutting rule and is always faster than the `'basic'` one.\n* the `'cuts+'` algorithm is now an exact algorithm using the notion of far-apart pairs to reduce the size of the search space. It is sometimes faster than the `'cuts'` algorithm although it has a longer pre-processing time. It is faster for instance on rectangular grids, petersen, and on graphs such that the hyperbolicity is small compared to the diameter/2.\n\n\n**CC:**  @nathanncohen\n\n**Branch/Commit:** [1b35416e8b5cdb792573d28fd4c4ce161d5a52aa](https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa)\n\n**Reviewer:** Nathann Cohen\n\n**Author:** David Coudert\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17227\n\n",
    "closed_at": "2015-01-02T22:12:40Z",
    "created_at": "2014-10-26T16:08:15Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Add new cutting rules for computing hyperbolicity",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17227",
    "user": "https://github.com/dcoudert"
}
```
This patch adds two cutting rules, one for the `'basic'` algorithm and one for the `'cuts'` algorithm.
* the new `'basic+'` algorithm uses the new cutting rule and is always faster than the `'basic'` one.
* the `'cuts+'` algorithm is now an exact algorithm using the notion of far-apart pairs to reduce the size of the search space. It is sometimes faster than the `'cuts'` algorithm although it has a longer pre-processing time. It is faster for instance on rectangular grids, petersen, and on graphs such that the hyperbolicity is small compared to the diameter/2.


**CC:**  @nathanncohen

**Branch/Commit:** [1b35416e8b5cdb792573d28fd4c4ce161d5a52aa](https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa)

**Reviewer:** Nathann Cohen

**Author:** David Coudert

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/17227





---

archive/issue_comments_295182.json:
```json
{
    "body": "**Author:** David Coudert",
    "created_at": "2014-10-26T16:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295182",
    "user": "https://github.com/dcoudert"
}
```

**Author:** David Coudert



---

archive/issue_comments_295183.json:
```json
{
    "body": "**Branch:** [u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity)",
    "created_at": "2014-10-26T17:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295183",
    "user": "https://github.com/dcoudert"
}
```

**Branch:** [u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity)



---

archive/issue_comments_295184.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-10-26T18:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295184",
    "user": "https://github.com/dcoudert"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_295185.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n+This patch adds two cutting rules, one for the `'basic'` algorithm and one for the `'cuts'` algorithm.\n+* the new `'basic+'` algorithm uses the new cutting rule and is always faster than the `'basic'` one.\n+* the `'cuts+'` algorithm is now an exact algorithm using the notion of far-apart pairs to reduce the size of the search space. It is sometimes faster than the `'cuts'` algorithm although it has a longer pre-processing time. It is faster for instance on rectangular grids, petersen, and on graphs such that the hyperbolicity is small compared to the diameter/2.\n \n``````\n",
    "created_at": "2014-10-26T18:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295185",
    "user": "https://github.com/dcoudert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,4 @@
+This patch adds two cutting rules, one for the `'basic'` algorithm and one for the `'cuts'` algorithm.
+* the new `'basic+'` algorithm uses the new cutting rule and is always faster than the `'basic'` one.
+* the `'cuts+'` algorithm is now an exact algorithm using the notion of far-apart pairs to reduce the size of the search space. It is sometimes faster than the `'cuts'` algorithm although it has a longer pre-processing time. It is faster for instance on rectangular grids, petersen, and on graphs such that the hyperbolicity is small compared to the diameter/2.
 
``````




---

archive/issue_comments_295186.json:
```json
{
    "body": "**Commit:** [ee216e2669de1aff1cc91e6a7b0c47c46a3159a9](https://github.com/sagemath/sagetrac-mirror/commit/ee216e2669de1aff1cc91e6a7b0c47c46a3159a9)",
    "created_at": "2014-10-26T18:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295186",
    "user": "https://github.com/dcoudert"
}
```

**Commit:** [ee216e2669de1aff1cc91e6a7b0c47c46a3159a9](https://github.com/sagemath/sagetrac-mirror/commit/ee216e2669de1aff1cc91e6a7b0c47c46a3159a9)



---

archive/issue_comments_295187.json:
```json
{
    "body": "<a id='comment:3'></a>\nSome examples\n\n```\nsage: from sage.graphs.hyperbolicity import hyperbolicity\nsage: G = graphs.PetersenGraph()\nsage: %time hyperbolicity(G, algorithm='basic')\nCPU times: user 2 ms, sys: 0 ns, total: 2 ms\nWall time: 1.16 ms\n(1/2, [0, 1, 2, 3], 1/2)\nsage: %time hyperbolicity(G, algorithm='basic+')\nCPU times: user 1 ms, sys: 0 ns, total: 1 ms\nWall time: 1.13 ms\n(1/2, [0, 1, 2, 3], 1/2)\nsage: %time hyperbolicity(G, algorithm='cuts')\nCPU times: user 2 ms, sys: 0 ns, total: 2 ms\nWall time: 1.19 ms\n(1/2, [0, 1, 2, 3], 1/2)\nsage: %time hyperbolicity(G, algorithm='cuts+')\nCPU times: user 1e+03 \u00b5s, sys: 0 ns, total: 1e+03 \u00b5s\nWall time: 776 \u00b5s\n(1/2, [0, 1, 2, 3], 1/2)\n```\n\n```\nsage: G = graphs.Grid2dGraph(20,10)\nsage: %time hyperbolicity(G, algorithm='basic')\nCPU times: user 681 ms, sys: 3 ms, total: 684 ms\nWall time: 682 ms\n(9, [(0, 0), (0, 9), (9, 0), (9, 9)], 9)\nsage: %time hyperbolicity(G, algorithm='basic+')\nCPU times: user 52 ms, sys: 0 ns, total: 52 ms\nWall time: 49 ms\n(9, [(0, 0), (0, 9), (9, 0), (9, 9)], 9)\nsage: %time hyperbolicity(G, algorithm='cuts')\nCPU times: user 22 ms, sys: 1 ms, total: 23 ms\nWall time: 21.5 ms\n(9, [(0, 0), (0, 9), (19, 0), (19, 9)], 9)\nsage: %time hyperbolicity(G, algorithm='cuts+')\nCPU times: user 17 ms, sys: 2 ms, total: 19 ms\nWall time: 16.2 ms\n(9, [(0, 0), (0, 9), (19, 0), (19, 9)], 9)\n```\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee216e2669de1aff1cc91e6a7b0c47c46a3159a9\">ee216e2</a></td><td><code>#17227: adds far apart pairs and cleanup the code</code></td></tr></table>\n",
    "created_at": "2014-10-26T18:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295187",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>
Some examples

```
sage: from sage.graphs.hyperbolicity import hyperbolicity
sage: G = graphs.PetersenGraph()
sage: %time hyperbolicity(G, algorithm='basic')
CPU times: user 2 ms, sys: 0 ns, total: 2 ms
Wall time: 1.16 ms
(1/2, [0, 1, 2, 3], 1/2)
sage: %time hyperbolicity(G, algorithm='basic+')
CPU times: user 1 ms, sys: 0 ns, total: 1 ms
Wall time: 1.13 ms
(1/2, [0, 1, 2, 3], 1/2)
sage: %time hyperbolicity(G, algorithm='cuts')
CPU times: user 2 ms, sys: 0 ns, total: 2 ms
Wall time: 1.19 ms
(1/2, [0, 1, 2, 3], 1/2)
sage: %time hyperbolicity(G, algorithm='cuts+')
CPU times: user 1e+03 µs, sys: 0 ns, total: 1e+03 µs
Wall time: 776 µs
(1/2, [0, 1, 2, 3], 1/2)
```

```
sage: G = graphs.Grid2dGraph(20,10)
sage: %time hyperbolicity(G, algorithm='basic')
CPU times: user 681 ms, sys: 3 ms, total: 684 ms
Wall time: 682 ms
(9, [(0, 0), (0, 9), (9, 0), (9, 9)], 9)
sage: %time hyperbolicity(G, algorithm='basic+')
CPU times: user 52 ms, sys: 0 ns, total: 52 ms
Wall time: 49 ms
(9, [(0, 0), (0, 9), (9, 0), (9, 9)], 9)
sage: %time hyperbolicity(G, algorithm='cuts')
CPU times: user 22 ms, sys: 1 ms, total: 23 ms
Wall time: 21.5 ms
(9, [(0, 0), (0, 9), (19, 0), (19, 9)], 9)
sage: %time hyperbolicity(G, algorithm='cuts+')
CPU times: user 17 ms, sys: 2 ms, total: 19 ms
Wall time: 16.2 ms
(9, [(0, 0), (0, 9), (19, 0), (19, 9)], 9)
```

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee216e2669de1aff1cc91e6a7b0c47c46a3159a9">ee216e2</a></td><td><code>#17227: adds far apart pairs and cleanup the code</code></td></tr></table>




---

archive/issue_comments_295188.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-10-26T22:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295188",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_295189.json:
```json
{
    "body": "<a id='comment:4'></a>\nPlease split this commit into thematic changes. Reviewing code like that takes a *lot* of time and you make it more complicated by doing everything at once.\n\nAs I do not know what exactly you do in this patch, all I can do is look at the diff, and try to understand. Please look at this diff, you will see what the reviewer has to go through.\n\nThanks,\n\nNathann",
    "created_at": "2014-10-26T22:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295189",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Please split this commit into thematic changes. Reviewing code like that takes a *lot* of time and you make it more complicated by doing everything at once.

As I do not know what exactly you do in this patch, all I can do is look at the diff, and try to understand. Please look at this diff, you will see what the reviewer has to go through.

Thanks,

Nathann



---

archive/issue_comments_295190.json:
```json
{
    "body": "**Changing commit** from \"[ee216e2669de1aff1cc91e6a7b0c47c46a3159a9](https://github.com/sagemath/sagetrac-mirror/commit/ee216e2669de1aff1cc91e6a7b0c47c46a3159a9)\" to \"[5529a33923e3c8c45c0ef28d4b5fac2783050561](https://github.com/sagemath/sagetrac-mirror/commit/5529a33923e3c8c45c0ef28d4b5fac2783050561)\".",
    "created_at": "2014-11-11T18:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ee216e2669de1aff1cc91e6a7b0c47c46a3159a9](https://github.com/sagemath/sagetrac-mirror/commit/ee216e2669de1aff1cc91e6a7b0c47c46a3159a9)" to "[5529a33923e3c8c45c0ef28d4b5fac2783050561](https://github.com/sagemath/sagetrac-mirror/commit/5529a33923e3c8c45c0ef28d4b5fac2783050561)".



---

archive/issue_comments_295191.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6ad07dd076109edea0b923bdeb3427a4b2e4f33\">f6ad07d</a></td><td><code>trac #17227: update module documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0c2006e167ed33423fa7a988a30bd72eef88a19\">b0c2006</a></td><td><code>trac #17227: adds basic+ algorithm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7de77a47368fd99ebddb73e3d1c8bc37ef05587\">d7de77a</a></td><td><code>trac #17227: adds verbose parameter to greedy dominating set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b61e14de6a423bbfb221eecbbb155aa1311b534\">6b61e14</a></td><td><code>trac #17227: add a method to compute both distances and far-apart pairs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18dfcf29b236bec025925468998fd73f72d1d785\">18dfcf2</a></td><td><code>trac #17227: change the behavior of the cuts+ method that now uses far-apart pairs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/632bbb68bbd1e4e1a6b186b2f17197fe01c418aa\">632bbb6</a></td><td><code>trac #17227: remove methods that are no longer used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/329e8bfa63b0a95cdc7d226fc0a62b301629f1f0\">329e8bf</a></td><td><code>trac #17227: remove other methods that are no longer used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5529a33923e3c8c45c0ef28d4b5fac2783050561\">5529a33</a></td><td><code>trac #17227: fix various indentation errors and small bugs</code></td></tr></table>\n",
    "created_at": "2014-11-11T18:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6ad07dd076109edea0b923bdeb3427a4b2e4f33">f6ad07d</a></td><td><code>trac #17227: update module documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0c2006e167ed33423fa7a988a30bd72eef88a19">b0c2006</a></td><td><code>trac #17227: adds basic+ algorithm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7de77a47368fd99ebddb73e3d1c8bc37ef05587">d7de77a</a></td><td><code>trac #17227: adds verbose parameter to greedy dominating set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b61e14de6a423bbfb221eecbbb155aa1311b534">6b61e14</a></td><td><code>trac #17227: add a method to compute both distances and far-apart pairs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18dfcf29b236bec025925468998fd73f72d1d785">18dfcf2</a></td><td><code>trac #17227: change the behavior of the cuts+ method that now uses far-apart pairs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/632bbb68bbd1e4e1a6b186b2f17197fe01c418aa">632bbb6</a></td><td><code>trac #17227: remove methods that are no longer used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/329e8bfa63b0a95cdc7d226fc0a62b301629f1f0">329e8bf</a></td><td><code>trac #17227: remove other methods that are no longer used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5529a33923e3c8c45c0ef28d4b5fac2783050561">5529a33</a></td><td><code>trac #17227: fix various indentation errors and small bugs</code></td></tr></table>




---

archive/issue_comments_295192.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello Nathann.\n\nI hope this patch will be easier to review now. I tried to do more thematic commits.\n\nI'm still having a hard time with git. I had to force the push... but it should be ok now.\n\nThanks.",
    "created_at": "2014-11-11T18:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295192",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
Hello Nathann.

I hope this patch will be easier to review now. I tried to do more thematic commits.

I'm still having a hard time with git. I had to force the push... but it should be ok now.

Thanks.



---

archive/issue_comments_295193.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2014-11-11T18:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295193",
    "user": "https://github.com/dcoudert"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_295194.json:
```json
{
    "body": "<a id='comment:7'></a>\nHello !\n\nIt is normal that you had to force the update, no problem there. Git only accepts \"additional commits\" without complaints, for everything else you have to push.\n\nI am backpacking in Mumbai right now but I go home (=Chennai) tomorrow and I will be back to work next Monday, and on this review in particular.\n\nAlso, note that your branch does not merge with the latest release.\n\nNathann",
    "created_at": "2014-11-14T04:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295194",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
Hello !

It is normal that you had to force the update, no problem there. Git only accepts "additional commits" without complaints, for everything else you have to push.

I am backpacking in Mumbai right now but I go home (=Chennai) tomorrow and I will be back to work next Monday, and on this review in particular.

Also, note that your branch does not merge with the latest release.

Nathann



---

archive/issue_comments_295195.json:
```json
{
    "body": "<a id='comment:8'></a>\nI unsuccessfully tried to rebase on up-to-date develop branch :(\nHow can I solve this problem??",
    "created_at": "2014-11-14T10:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295195",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>
I unsuccessfully tried to rebase on up-to-date develop branch :(
How can I solve this problem??



---

archive/issue_comments_295196.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe conflict is only an import statement at the beginning of `distance_all_pairs`, so no problem, you can just merge your branch with the latest beta.\n\nIf you want to know how your rebasing problem can be solved I need more than \"I unsuccesfully tried\", though.\n\nNathann",
    "created_at": "2014-11-16T10:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295196",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>
The conflict is only an import statement at the beginning of `distance_all_pairs`, so no problem, you can just merge your branch with the latest beta.

If you want to know how your rebasing problem can be solved I need more than "I unsuccesfully tried", though.

Nathann



---

archive/issue_comments_295197.json:
```json
{
    "body": "**Changing branch** from \"[u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity)\" to \"[public/17227](https://github.com/sagemath/sagetrac-mirror/tree/public/17227)\".",
    "created_at": "2014-11-22T15:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295197",
    "user": "https://github.com/nathanncohen"
}
```

**Changing branch** from "[u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/add_new_cutting_rules_for_computing_hyperbolicity)" to "[public/17227](https://github.com/sagemath/sagetrac-mirror/tree/public/17227)".



---

archive/issue_comments_295198.json:
```json
{
    "body": "**Changing commit** from \"[5529a33923e3c8c45c0ef28d4b5fac2783050561](https://github.com/sagemath/sagetrac-mirror/commit/5529a33923e3c8c45c0ef28d4b5fac2783050561)\" to \"[70d5c4f7073da07cb130a0c6ae807880bcee9edb](https://github.com/sagemath/sagetrac-mirror/commit/70d5c4f7073da07cb130a0c6ae807880bcee9edb)\".",
    "created_at": "2014-11-22T15:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295198",
    "user": "https://github.com/nathanncohen"
}
```

**Changing commit** from "[5529a33923e3c8c45c0ef28d4b5fac2783050561](https://github.com/sagemath/sagetrac-mirror/commit/5529a33923e3c8c45c0ef28d4b5fac2783050561)" to "[70d5c4f7073da07cb130a0c6ae807880bcee9edb](https://github.com/sagemath/sagetrac-mirror/commit/70d5c4f7073da07cb130a0c6ae807880bcee9edb)".



---

archive/issue_comments_295199.json:
```json
{
    "body": "<a id='comment:10'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70d5c4f7073da07cb130a0c6ae807880bcee9edb\">70d5c4f</a></td><td><code>trac #17227: Merged with 6.5.beta0</code></td></tr></table>\n",
    "created_at": "2014-11-22T15:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295199",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70d5c4f7073da07cb130a0c6ae807880bcee9edb">70d5c4f</a></td><td><code>trac #17227: Merged with 6.5.beta0</code></td></tr></table>




---

archive/issue_comments_295200.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b87328ca22c9fd041ee9264b43de4eba60037c1\">4b87328</a></td><td><code>trac #17227: change include bitset to comply with patch 17196</code></td></tr></table>\n",
    "created_at": "2014-11-22T23:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b87328ca22c9fd041ee9264b43de4eba60037c1">4b87328</a></td><td><code>trac #17227: change include bitset to comply with patch 17196</code></td></tr></table>




---

archive/issue_comments_295201.json:
```json
{
    "body": "**Changing commit** from \"[70d5c4f7073da07cb130a0c6ae807880bcee9edb](https://github.com/sagemath/sagetrac-mirror/commit/70d5c4f7073da07cb130a0c6ae807880bcee9edb)\" to \"[4b87328ca22c9fd041ee9264b43de4eba60037c1](https://github.com/sagemath/sagetrac-mirror/commit/4b87328ca22c9fd041ee9264b43de4eba60037c1)\".",
    "created_at": "2014-11-22T23:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[70d5c4f7073da07cb130a0c6ae807880bcee9edb](https://github.com/sagemath/sagetrac-mirror/commit/70d5c4f7073da07cb130a0c6ae807880bcee9edb)" to "[4b87328ca22c9fd041ee9264b43de4eba60037c1](https://github.com/sagemath/sagetrac-mirror/commit/4b87328ca22c9fd041ee9264b43de4eba60037c1)".



---

archive/issue_comments_295202.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks a lot Nathann for resolving my problem. The terms used for git are not obvious for me, and so all actions are complicated.\n\nDavid.",
    "created_at": "2014-11-22T23:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295202",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>
Thanks a lot Nathann for resolving my problem. The terms used for git are not obvious for me, and so all actions are complicated.

David.



---

archive/issue_comments_295203.json:
```json
{
    "body": "**Changing commit** from \"[4b87328ca22c9fd041ee9264b43de4eba60037c1](https://github.com/sagemath/sagetrac-mirror/commit/4b87328ca22c9fd041ee9264b43de4eba60037c1)\" to \"[48345733408db3721c5bbeba3031b2f4c0673492](https://github.com/sagemath/sagetrac-mirror/commit/48345733408db3721c5bbeba3031b2f4c0673492)\".",
    "created_at": "2014-11-30T11:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4b87328ca22c9fd041ee9264b43de4eba60037c1](https://github.com/sagemath/sagetrac-mirror/commit/4b87328ca22c9fd041ee9264b43de4eba60037c1)" to "[48345733408db3721c5bbeba3031b2f4c0673492](https://github.com/sagemath/sagetrac-mirror/commit/48345733408db3721c5bbeba3031b2f4c0673492)".



---

archive/issue_comments_295204.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ffeb6850866ec6170771c6cf8722658e291a977\">1ffeb68</a></td><td><code>trac #17227: Merged with 6.5.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48345733408db3721c5bbeba3031b2f4c0673492\">4834573</a></td><td><code>trac #17227: Reviewer's commit</code></td></tr></table>\n",
    "created_at": "2014-11-30T11:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ffeb6850866ec6170771c6cf8722658e291a977">1ffeb68</a></td><td><code>trac #17227: Merged with 6.5.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48345733408db3721c5bbeba3031b2f4c0673492">4834573</a></td><td><code>trac #17227: Reviewer's commit</code></td></tr></table>




---

archive/issue_comments_295205.json:
```json
{
    "body": "<a id='comment:14'></a>\nYo David !\n\nI just finished the first review. It is 16h38 right now, and I have been working\non this code for the last 4h hours. It is too much. This ticket should have been\nimplemented into several small tickets. It is also very very difficult to keep\ntrack of what is happening, as the main functions handle many different\nalgorithms at the same time. Please think for a while about how you could make\nit more modular, so that it becomes easier to understand in the future.\n\nBesides: the function `hyperbolicity` contains the following algorithms:\n\n```\n\"'basic'\", \"'basic+'\", \"'cuts'\", \"'cuts+'\", \"'dom'\"}}}. Not only the names\nare unclear, but that is probably too much. I do not expect that all will be\nuseful to users, or useful for us to keep, especially when handling them all\nmakes the code so complicated. Could you think about those we do not really\nneed, to remove them in another ticket ?\n\nBesides making the comments below, I implemented some modifications to\nunderstand the code a bit better. The most important changes, in terms of lines\nof code, only move \"malloc\" together, so that memory allocation problems are all\nchecked at the same time.\n\nHere is the review:\n\n- For each of the three methods explained in the section \"Algorithms and\n  complexity\" of the module header, could you mention the corresponding flag of\n  `hyperbolicity` ?\n\n- `basic+` : you should have kept this for a different patch. It is not\n  necessary to implement it with the rest and it makes the review of the big\n  thing harder.\n\n- You say in the doc that Soto proved that `hyp(a,b,c,d)<= dist(a,b)/2` but in\n  the code we have\n\n  {{{\n  if 2*distances[a][b] <= h_LB:\n     continue\n  }}}\n\n  I expected `distances[a][b]/2 <= h_LB`. Or actually, maybe the bound proved by\n  Soto was actually `hyp(a,b,c,d)<= 2*dist(a,b)` (in which case the code is\n  correct and the doc is wrong), as otherwise his bound is better than ours.\n\n- It is more compact to make all memory allocations at the same place, and only\n  have one block of code to free everything if there was a problem. `free(NULL)`\n  is valid.\n\n- your `unsigned short ** c_far_apart` only stores 0s and 1 (the amount of\n  unused memory is `15/16=93%` `:-P`). We have something in `mic/binary_matrix`\n  that you may like (though it may not be worth the extra complexity in this\n  case).\n\n- The function which returns all far-apart pairs considers points in different\n  connected components to be a far-away pair. Is that what you want ? Either\n  way, please document it.\n\n- The documentation of __hyperbolicity__ claims that the function implements an\n  algorithm from CCL12. Also, the comment just above the function talks about a\n  decreasing pair ordering.\n\n- There are many variables that you specialise to uint32_t when actually nobody\n  cares. The code would be easier to read if they were int variables.\n\n- `__hyperbolicity__` is only meant for connected graphs (you ask for a\n  diameter) -- could you write this explicitly somewhere ?\n\n... after something like two hours of review: this patch is too big.\n\n- What about renaming this \"STOP\" thing to \"GOTO_RETURN\" ?\n\n- Please do not write a commit that changes the indentation of a block of\n  code. Modify the first commit itself.\n\n- Is there any reason why this block\n\n  {{{\n  # Termination if required approximation is found\n  }}}\n\n  Is not on the same level as\n\n  {{{\n  # If we cannot improve further, we stop\n  }}}\n\n  It feels like the two play the same role in the algorithm.\n\n- You define two values for 'STOP' but you never use them. Was that meant to\n  only leave one loop instead or two, and remove one of the two copies of the\n  blocks:\n\n  {{{\n  # If we cannot improve further, we stop\n  # Termination if required approximation is found\n  }}}\n\n  It would be a nice change indeed, the implementation is already sufficiently\n  complicated.\n\n- {{{h_UB if STOP==2 else h}}} : why don't you just set the right value of h_UB\n  right before setting `STOP==2` ?\n\n- In \"hyperbolicity\" a large portion of the code deals with the\n  block-decomposition. Why couldn't you just call hyperbolicity on each block ?\n  You would not have to allocate memory in a loop, and the is_clique test would\n  be done automatically too (+the others)... You may lose a bit of time as the\n  block_decomposition would be recomputed on each block, but I do not think that\n  it is such a big problem compared to the cost of the algorithm. Actually, I\n  doubt that many real instances have a cut-vertex. That would remove a big\n  chunck of code, too.\n\n- {{{while len(DOM)<4: DOM.append(H.random_vertex())}}} what if that new vertex\n  was in {{{DOM}}} already ?\n\nNathann",
    "created_at": "2014-11-30T11:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295205",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>
Yo David !

I just finished the first review. It is 16h38 right now, and I have been working
on this code for the last 4h hours. It is too much. This ticket should have been
implemented into several small tickets. It is also very very difficult to keep
track of what is happening, as the main functions handle many different
algorithms at the same time. Please think for a while about how you could make
it more modular, so that it becomes easier to understand in the future.

Besides: the function `hyperbolicity` contains the following algorithms:

```
"'basic'", "'basic+'", "'cuts'", "'cuts+'", "'dom'"}}}. Not only the names
are unclear, but that is probably too much. I do not expect that all will be
useful to users, or useful for us to keep, especially when handling them all
makes the code so complicated. Could you think about those we do not really
need, to remove them in another ticket ?

Besides making the comments below, I implemented some modifications to
understand the code a bit better. The most important changes, in terms of lines
of code, only move "malloc" together, so that memory allocation problems are all
checked at the same time.

Here is the review:

- For each of the three methods explained in the section "Algorithms and
  complexity" of the module header, could you mention the corresponding flag of
  `hyperbolicity` ?

- `basic+` : you should have kept this for a different patch. It is not
  necessary to implement it with the rest and it makes the review of the big
  thing harder.

- You say in the doc that Soto proved that `hyp(a,b,c,d)<= dist(a,b)/2` but in
  the code we have

  {{{
  if 2*distances[a][b] <= h_LB:
     continue
  }}}

  I expected `distances[a][b]/2 <= h_LB`. Or actually, maybe the bound proved by
  Soto was actually `hyp(a,b,c,d)<= 2*dist(a,b)` (in which case the code is
  correct and the doc is wrong), as otherwise his bound is better than ours.

- It is more compact to make all memory allocations at the same place, and only
  have one block of code to free everything if there was a problem. `free(NULL)`
  is valid.

- your `unsigned short ** c_far_apart` only stores 0s and 1 (the amount of
  unused memory is `15/16=93%` `:-P`). We have something in `mic/binary_matrix`
  that you may like (though it may not be worth the extra complexity in this
  case).

- The function which returns all far-apart pairs considers points in different
  connected components to be a far-away pair. Is that what you want ? Either
  way, please document it.

- The documentation of __hyperbolicity__ claims that the function implements an
  algorithm from CCL12. Also, the comment just above the function talks about a
  decreasing pair ordering.

- There are many variables that you specialise to uint32_t when actually nobody
  cares. The code would be easier to read if they were int variables.

- `__hyperbolicity__` is only meant for connected graphs (you ask for a
  diameter) -- could you write this explicitly somewhere ?

... after something like two hours of review: this patch is too big.

- What about renaming this "STOP" thing to "GOTO_RETURN" ?

- Please do not write a commit that changes the indentation of a block of
  code. Modify the first commit itself.

- Is there any reason why this block

  {{{
  # Termination if required approximation is found
  }}}

  Is not on the same level as

  {{{
  # If we cannot improve further, we stop
  }}}

  It feels like the two play the same role in the algorithm.

- You define two values for 'STOP' but you never use them. Was that meant to
  only leave one loop instead or two, and remove one of the two copies of the
  blocks:

  {{{
  # If we cannot improve further, we stop
  # Termination if required approximation is found
  }}}

  It would be a nice change indeed, the implementation is already sufficiently
  complicated.

- {{{h_UB if STOP==2 else h}}} : why don't you just set the right value of h_UB
  right before setting `STOP==2` ?

- In "hyperbolicity" a large portion of the code deals with the
  block-decomposition. Why couldn't you just call hyperbolicity on each block ?
  You would not have to allocate memory in a loop, and the is_clique test would
  be done automatically too (+the others)... You may lose a bit of time as the
  block_decomposition would be recomputed on each block, but I do not think that
  it is such a big problem compared to the cost of the algorithm. Actually, I
  doubt that many real instances have a cut-vertex. That would remove a big
  chunck of code, too.

- {{{while len(DOM)<4: DOM.append(H.random_vertex())}}} what if that new vertex
  was in {{{DOM}}} already ?

Nathann



---

archive/issue_comments_295206.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-11-30T11:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295206",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_295207.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2014-12-15T00:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295207",
    "user": "https://github.com/dcoudert"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_295208.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [ncohen](#comment%3A14):\n> Yo David !\n> \n> I just finished the first review. It is 16h38 right now, and I have been working\n> on this code for the last 4h hours. It is too much. This ticket should have been\n> implemented into several small tickets. It is also very very difficult to keep\n> track of what is happening, as the main functions handle many different\n> algorithms at the same time. Please think for a while about how you could make\n> it more modular, so that it becomes easier to understand in the future.\n\n\nReally sorry about that. Next time I will try to make small patches only, although it is not always easy to do.\n\n> Besides: the function `hyperbolicity` contains the following algorithms:\n> \n> ```\n> \"'basic'\", \"'basic+'\", \"'cuts'\", \"'cuts+'\", \"'dom'\"}}}. Not only the names\n> are unclear, but that is probably too much. I do not expect that all will be\n> useful to users, or useful for us to keep, especially when handling them all\n> makes the code so complicated. Could you think about those we do not really\n> need, to remove them in another ticket ?\n\n\nWell, since we have 'basic+', we don't need 'basic' anymore.\nWe could also rename 'cuts' as 'CCL', but I don't know if it is more explicit...\nWe can try in another ticket.\n  \n> Besides making the comments below, I implemented some modifications to\n> understand the code a bit better. The most important changes, in terms of lines\n> of code, only move \"malloc\" together, so that memory allocation problems are all\n> checked at the same time.\n> \n> Here is the review:\n> \n> - For each of the three methods explained in the section \"Algorithms and\n>   complexity\" of the module header, could you mention the corresponding flag of\n>   `hyperbolicity` ?\n\ndone\n\n \n> - You say in the doc that Soto proved that `hyp(a,b,c,d)<= dist(a,b)/2` but in\n>   the code we have\n> \n>   {{{\n>   if 2*distances[a][b] <= h_LB:\n>      continue\n>   }}}\n> \n>   I expected `distances[a][b]/2 <= h_LB`. Or actually, maybe the bound proved by\n>   Soto was actually `hyp(a,b,c,d)<= 2*dist(a,b)` (in which case the code is\n>   correct and the doc is wrong), as otherwise his bound is better than ours.\n\nI have corrected the documentation. Soto proved that `hyp(a,b,c,d) <= 2*dist(a,b)`.\nSo we can skip 4-tuples such that `2*dist(a,b) <= h_LB`.\n\n \n> - It is more compact to make all memory allocations at the same place, and only\n>   have one block of code to free everything if there was a problem. `free(NULL)`\n>   is valid.\n> \n> - your `unsigned short ** c_far_apart` only stores 0s and 1 (the amount of\n>   unused memory is `15/16=93%` `:-P`). We have something in `mic/binary_matrix`\n>   that you may like (though it may not be worth the extra complexity in this\n>   case).\n\nI'm clearly consuming much more memory than necessary.\nIf the extra cost is not too high, I may propose the modification in another patch.\n\n \n> - The function which returns all far-apart pairs considers points in different\n>   connected components to be a far-away pair. Is that what you want ? Either\n>   way, please document it.\n\nfar-apart pairs are defined only in connected graphs. I have updated the\ndocumentation of the method to precise that it assumes that the input graph is connected.\n \n\n> - The documentation of __hyperbolicity__ claims that the function implements an\n>   algorithm from CCL12. Also, the comment just above the function talks about a\n>   decreasing pair ordering.\n\nI have changed the comment to `Compute the hyperbolicity using a the algorithm of [CCL12]_`.\n \n\n> - There are many variables that you specialise to uint32_t when actually nobody\n>   cares. The code would be easier to read if they were int variables.\n> \n> - `__hyperbolicity__` is only meant for connected graphs (you ask for a\n>   diameter) -- could you write this explicitly somewhere ?\n\nI added a comment.\n\n \n> ... after something like two hours of review: this patch is too big.\n\nReally, really, really, sorry about that.\n \n\n> - What about renaming this \"STOP\" thing to \"GOTO_RETURN\" ?\n> \n> - Please do not write a commit that changes the indentation of a block of\n>   code. Modify the first commit itself.\n> \n> - Is there any reason why this block\n> \n>   {{{\n>   # Termination if required approximation is found\n>   }}}\n> \n>   Is not on the same level as\n> \n>   {{{\n>   # If we cannot improve further, we stop\n>   }}}\n> \n>   It feels like the two play the same role in the algorithm.\n> \n> - You define two values for 'STOP' but you never use them. Was that meant to\n>   only leave one loop instead or two, and remove one of the two copies of the\n>   blocks:\n> \n>   {{{\n>   # If we cannot improve further, we stop\n>   # Termination if required approximation is found\n>   }}}\n> \n>   It would be a nice change indeed, the implementation is already sufficiently\n>   complicated.\n> \n> - {{{h_UB if STOP==2 else h}}} : why don't you just set the right value of h_UB\n>   right before setting `STOP==2` ?\n\nFollowing your comments, I have:\n* renamed \"STOP\" to \"GOTO_RETURN\".\n* Remove the `STOP==2` test by setting `h_UB = h` when optimality is proven.\n* Put some tests at same level. \n\nI don't see how to remove one of the two blocks of tests since one is used each time the upper bound is reduced and the other each time the lower bound is improved.\n\n \n> - In \"hyperbolicity\" a large portion of the code deals with the\n>   block-decomposition. Why couldn't you just call hyperbolicity on each block ?\n>   You would not have to allocate memory in a loop, and the is_clique test would\n>   be done automatically too (+the others)... You may lose a bit of time as the\n>   block_decomposition would be recomputed on each block, but I do not think that\n>   it is such a big problem compared to the cost of the algorithm. Actually, I\n>   doubt that many real instances have a cut-vertex. That would remove a big\n>   chunck of code, too.\n\nActually, many real instances have many cut-vertices! For instance, the graphs of the autonomous systems of the Internet collected by CAIDA have a large number of cut-vertices. The largest 2-connected component has 2/3 of the vertices only. The same hold for co-authors graphs and so on.\n\nI have however modified the method. This is easier to read this way.\nIt is also faster when the input graph is 2-connected since we avoid a useless copy of the graph.\n\n \n> - {{{while len(DOM)<4: DOM.append(H.random_vertex())}}} what if that new vertex\n>   was in {{{DOM}}} already ?\n\nI fixed this issue using a set instead of a list for DOM.\n \n \n> Nathann\n\nMany, many thanks Nathann.\n\nDavid.\n\nPS: sorry for the multiple commits. I'm still lost with git. For instance, I don't know how to modify a commit without creating a new commit.",
    "created_at": "2014-12-15T00:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295208",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>
Replying to [ncohen](#comment%3A14):
> Yo David !
> 
> I just finished the first review. It is 16h38 right now, and I have been working
> on this code for the last 4h hours. It is too much. This ticket should have been
> implemented into several small tickets. It is also very very difficult to keep
> track of what is happening, as the main functions handle many different
> algorithms at the same time. Please think for a while about how you could make
> it more modular, so that it becomes easier to understand in the future.


Really sorry about that. Next time I will try to make small patches only, although it is not always easy to do.

> Besides: the function `hyperbolicity` contains the following algorithms:
> 
> ```
> "'basic'", "'basic+'", "'cuts'", "'cuts+'", "'dom'"}}}. Not only the names
> are unclear, but that is probably too much. I do not expect that all will be
> useful to users, or useful for us to keep, especially when handling them all
> makes the code so complicated. Could you think about those we do not really
> need, to remove them in another ticket ?


Well, since we have 'basic+', we don't need 'basic' anymore.
We could also rename 'cuts' as 'CCL', but I don't know if it is more explicit...
We can try in another ticket.
  
> Besides making the comments below, I implemented some modifications to
> understand the code a bit better. The most important changes, in terms of lines
> of code, only move "malloc" together, so that memory allocation problems are all
> checked at the same time.
> 
> Here is the review:
> 
> - For each of the three methods explained in the section "Algorithms and
>   complexity" of the module header, could you mention the corresponding flag of
>   `hyperbolicity` ?

done

 
> - You say in the doc that Soto proved that `hyp(a,b,c,d)<= dist(a,b)/2` but in
>   the code we have
> 
>   {{{
>   if 2*distances[a][b] <= h_LB:
>      continue
>   }}}
> 
>   I expected `distances[a][b]/2 <= h_LB`. Or actually, maybe the bound proved by
>   Soto was actually `hyp(a,b,c,d)<= 2*dist(a,b)` (in which case the code is
>   correct and the doc is wrong), as otherwise his bound is better than ours.

I have corrected the documentation. Soto proved that `hyp(a,b,c,d) <= 2*dist(a,b)`.
So we can skip 4-tuples such that `2*dist(a,b) <= h_LB`.

 
> - It is more compact to make all memory allocations at the same place, and only
>   have one block of code to free everything if there was a problem. `free(NULL)`
>   is valid.
> 
> - your `unsigned short ** c_far_apart` only stores 0s and 1 (the amount of
>   unused memory is `15/16=93%` `:-P`). We have something in `mic/binary_matrix`
>   that you may like (though it may not be worth the extra complexity in this
>   case).

I'm clearly consuming much more memory than necessary.
If the extra cost is not too high, I may propose the modification in another patch.

 
> - The function which returns all far-apart pairs considers points in different
>   connected components to be a far-away pair. Is that what you want ? Either
>   way, please document it.

far-apart pairs are defined only in connected graphs. I have updated the
documentation of the method to precise that it assumes that the input graph is connected.
 

> - The documentation of __hyperbolicity__ claims that the function implements an
>   algorithm from CCL12. Also, the comment just above the function talks about a
>   decreasing pair ordering.

I have changed the comment to `Compute the hyperbolicity using a the algorithm of [CCL12]_`.
 

> - There are many variables that you specialise to uint32_t when actually nobody
>   cares. The code would be easier to read if they were int variables.
> 
> - `__hyperbolicity__` is only meant for connected graphs (you ask for a
>   diameter) -- could you write this explicitly somewhere ?

I added a comment.

 
> ... after something like two hours of review: this patch is too big.

Really, really, really, sorry about that.
 

> - What about renaming this "STOP" thing to "GOTO_RETURN" ?
> 
> - Please do not write a commit that changes the indentation of a block of
>   code. Modify the first commit itself.
> 
> - Is there any reason why this block
> 
>   {{{
>   # Termination if required approximation is found
>   }}}
> 
>   Is not on the same level as
> 
>   {{{
>   # If we cannot improve further, we stop
>   }}}
> 
>   It feels like the two play the same role in the algorithm.
> 
> - You define two values for 'STOP' but you never use them. Was that meant to
>   only leave one loop instead or two, and remove one of the two copies of the
>   blocks:
> 
>   {{{
>   # If we cannot improve further, we stop
>   # Termination if required approximation is found
>   }}}
> 
>   It would be a nice change indeed, the implementation is already sufficiently
>   complicated.
> 
> - {{{h_UB if STOP==2 else h}}} : why don't you just set the right value of h_UB
>   right before setting `STOP==2` ?

Following your comments, I have:
* renamed "STOP" to "GOTO_RETURN".
* Remove the `STOP==2` test by setting `h_UB = h` when optimality is proven.
* Put some tests at same level. 

I don't see how to remove one of the two blocks of tests since one is used each time the upper bound is reduced and the other each time the lower bound is improved.

 
> - In "hyperbolicity" a large portion of the code deals with the
>   block-decomposition. Why couldn't you just call hyperbolicity on each block ?
>   You would not have to allocate memory in a loop, and the is_clique test would
>   be done automatically too (+the others)... You may lose a bit of time as the
>   block_decomposition would be recomputed on each block, but I do not think that
>   it is such a big problem compared to the cost of the algorithm. Actually, I
>   doubt that many real instances have a cut-vertex. That would remove a big
>   chunck of code, too.

Actually, many real instances have many cut-vertices! For instance, the graphs of the autonomous systems of the Internet collected by CAIDA have a large number of cut-vertices. The largest 2-connected component has 2/3 of the vertices only. The same hold for co-authors graphs and so on.

I have however modified the method. This is easier to read this way.
It is also faster when the input graph is 2-connected since we avoid a useless copy of the graph.

 
> - {{{while len(DOM)<4: DOM.append(H.random_vertex())}}} what if that new vertex
>   was in {{{DOM}}} already ?

I fixed this issue using a set instead of a list for DOM.
 
 
> Nathann

Many, many thanks Nathann.

David.

PS: sorry for the multiple commits. I'm still lost with git. For instance, I don't know how to modify a commit without creating a new commit.



---

archive/issue_comments_295209.json:
```json
{
    "body": "**Reviewer:** Nathann Cohen",
    "created_at": "2014-12-15T00:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295209",
    "user": "https://github.com/dcoudert"
}
```

**Reviewer:** Nathann Cohen



---

archive/issue_comments_295210.json:
```json
{
    "body": "**Changing commit** from \"[48345733408db3721c5bbeba3031b2f4c0673492](https://github.com/sagemath/sagetrac-mirror/commit/48345733408db3721c5bbeba3031b2f4c0673492)\" to \"[6f5df4ae85820ac3235c21134f79c07b27710184](https://github.com/sagemath/sagetrac-mirror/commit/6f5df4ae85820ac3235c21134f79c07b27710184)\".",
    "created_at": "2014-12-15T00:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[48345733408db3721c5bbeba3031b2f4c0673492](https://github.com/sagemath/sagetrac-mirror/commit/48345733408db3721c5bbeba3031b2f4c0673492)" to "[6f5df4ae85820ac3235c21134f79c07b27710184](https://github.com/sagemath/sagetrac-mirror/commit/6f5df4ae85820ac3235c21134f79c07b27710184)".



---

archive/issue_comments_295211.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e9e2b2f0347f8f71669e4944a8095e5147fdb64\">2e9e2b2</a></td><td><code>trac #17227: improve module documentation.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21b84e4a292aed361573100640ec7129e7817f3d\">21b84e4</a></td><td><code>trac #17227: clarify the inputs of the method computing far-apart pairs.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cf7f5641ea5fcb95bf1bafeb2e0d4e2f5e2db48\">9cf7f56</a></td><td><code>trac #17227: simplify tests in __hyperbolicity__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40a70387c2bd59dcf57a02df1b79d5f26e103f67\">40a7038</a></td><td><code>trac #17227: reshape method hyperbolicity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ca92d11c1d927ca8c11d908c701e46c9f441a09\">7ca92d1</a></td><td><code>trac #17227: fix issue with greedy dominating set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8968caac705e06da24584e13cf11e40cd9f12ea\">e8968ca</a></td><td><code>trac #17227: fix upper bound with cuts+</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f5df4ae85820ac3235c21134f79c07b27710184\">6f5df4a</a></td><td><code>trac #17227: fix another problem with approximations and DOM</code></td></tr></table>\n",
    "created_at": "2014-12-15T00:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e9e2b2f0347f8f71669e4944a8095e5147fdb64">2e9e2b2</a></td><td><code>trac #17227: improve module documentation.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21b84e4a292aed361573100640ec7129e7817f3d">21b84e4</a></td><td><code>trac #17227: clarify the inputs of the method computing far-apart pairs.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cf7f5641ea5fcb95bf1bafeb2e0d4e2f5e2db48">9cf7f56</a></td><td><code>trac #17227: simplify tests in __hyperbolicity__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40a70387c2bd59dcf57a02df1b79d5f26e103f67">40a7038</a></td><td><code>trac #17227: reshape method hyperbolicity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ca92d11c1d927ca8c11d908c701e46c9f441a09">7ca92d1</a></td><td><code>trac #17227: fix issue with greedy dominating set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8968caac705e06da24584e13cf11e40cd9f12ea">e8968ca</a></td><td><code>trac #17227: fix upper bound with cuts+</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f5df4ae85820ac3235c21134f79c07b27710184">6f5df4a</a></td><td><code>trac #17227: fix another problem with approximations and DOM</code></td></tr></table>




---

archive/issue_comments_295212.json:
```json
{
    "body": "<a id='comment:17'></a>\n> PS: sorry for the multiple commits. I'm still lost with git. For instance, I don't know how to modify a commit without creating a new commit.\n\n\n1) If you want to merge the current (staged) modifications to the last commit, do \"git commit --amend\" (or \"git commit -a --amend\" to include all changes, as usual)\n\n2) If you want to merge some commits on an existing branch, checkout this branch then \"git rebase -i the_older_commit_of_the_branch\"\n\nNote that both do what is called \"rewriting history\". If you then want to push your changes to a Sage branch you will need to add a '-f' flag to 'git push'.\n\nNathann",
    "created_at": "2014-12-15T01:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295212",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>
> PS: sorry for the multiple commits. I'm still lost with git. For instance, I don't know how to modify a commit without creating a new commit.


1) If you want to merge the current (staged) modifications to the last commit, do "git commit --amend" (or "git commit -a --amend" to include all changes, as usual)

2) If you want to merge some commits on an existing branch, checkout this branch then "git rebase -i the_older_commit_of_the_branch"

Note that both do what is called "rewriting history". If you then want to push your changes to a Sage branch you will need to add a '-f' flag to 'git push'.

Nathann



---

archive/issue_comments_295213.json:
```json
{
    "body": "<a id='comment:18'></a>\nHello David !\n\n> Well, since we have 'basic+', we don't need 'basic' anymore.\n\n\n+1\n\n> I have corrected the documentation. Soto proved that `hyp(a,b,c,d) <= 2*dist(a,b)`\n\n\nIt seems that you only fixed the text and not the math formula that follows.\n\n> I'm clearly consuming much more memory than necessary.\n> If the extra cost is not too high, I may propose the modification in another patch.\n\n\nOkay. Perhaps the removal of 'basic' will make things slightly clearer already.\n\n> I have updated the documentation of the method to precise that it assumes that\n> the input graph is connected.\n\n\nWould you be willing to add a check right at the beginning of the function, just\nin case the graph is not connected ? The complexity of the algorithm will not be\nhurt by one more BFS ^^;\n\n> I have changed the comment to `Compute the hyperbolicity using a the algorithm of [CCL12]_`\n\n\nSorry, my remark was not very clear: what I meant is that the function that\nfollows does not only implement the algorithm from CCL12. It also deals with\nfar-apart pairs, and unless I make a mistake there was no mention of them in\nthat paper. The second line of the function's doc say the same.\n\nOther comments:\n\n- In this block of code:\n\n  ```\n  if hh > hyp or (hh==hyp and not certificate):\n      hyp = hh\n      hyp_UB = hh_UB\n      certificate = certif\n  ```\n\n  Shouldn't we have `hyp_UB = max(hyp_UB,hh_UB)` instead ? Or is it always\n  correct for some other reason ? Also, if the 'min' is necessary, could there\n  be a situation in which `hh < hyp` but `hh_UB > hyp_UB` ? In that case the\n  upper bound would need to be updated, but not `hyp`.\n\n- About `return (h, certificate, h_UB if GOTO_RETURN else h)`: note that in\n  Python you can have a for/else:\n\n  ```\n  sage: for i in range(40):\n  ....:     pass\n  ....: else:\n  ....:     print \"Hey\"\n  ....:\n  Hey\n  sage: for i in range(40):\n  ....:     break\n  ....: else:\n  ....:     print \"Hey\"\n  ....:\n  sage:\n  ```\n\nBy the way, thank you for adressing all those remarks methodically and answering\non each point. While the branch is heavy it makes this review less painful than\nothers in which the authors \"forget\" some questions `:-P`\n\nCheers,\n\nNathann",
    "created_at": "2014-12-18T12:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295213",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>
Hello David !

> Well, since we have 'basic+', we don't need 'basic' anymore.


+1

> I have corrected the documentation. Soto proved that `hyp(a,b,c,d) <= 2*dist(a,b)`


It seems that you only fixed the text and not the math formula that follows.

> I'm clearly consuming much more memory than necessary.
> If the extra cost is not too high, I may propose the modification in another patch.


Okay. Perhaps the removal of 'basic' will make things slightly clearer already.

> I have updated the documentation of the method to precise that it assumes that
> the input graph is connected.


Would you be willing to add a check right at the beginning of the function, just
in case the graph is not connected ? The complexity of the algorithm will not be
hurt by one more BFS ^^;

> I have changed the comment to `Compute the hyperbolicity using a the algorithm of [CCL12]_`


Sorry, my remark was not very clear: what I meant is that the function that
follows does not only implement the algorithm from CCL12. It also deals with
far-apart pairs, and unless I make a mistake there was no mention of them in
that paper. The second line of the function's doc say the same.

Other comments:

- In this block of code:

  ```
  if hh > hyp or (hh==hyp and not certificate):
      hyp = hh
      hyp_UB = hh_UB
      certificate = certif
  ```

  Shouldn't we have `hyp_UB = max(hyp_UB,hh_UB)` instead ? Or is it always
  correct for some other reason ? Also, if the 'min' is necessary, could there
  be a situation in which `hh < hyp` but `hh_UB > hyp_UB` ? In that case the
  upper bound would need to be updated, but not `hyp`.

- About `return (h, certificate, h_UB if GOTO_RETURN else h)`: note that in
  Python you can have a for/else:

  ```
  sage: for i in range(40):
  ....:     pass
  ....: else:
  ....:     print "Hey"
  ....:
  Hey
  sage: for i in range(40):
  ....:     break
  ....: else:
  ....:     print "Hey"
  ....:
  sage:
  ```

By the way, thank you for adressing all those remarks methodically and answering
on each point. While the branch is heavy it makes this review less painful than
others in which the authors "forget" some questions `:-P`

Cheers,

Nathann



---

archive/issue_comments_295214.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-12-18T12:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295214",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_295215.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c\">e44ca66</a></td><td><code>trac #17227: small corrections for comment 18</code></td></tr></table>\n",
    "created_at": "2014-12-31T13:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c">e44ca66</a></td><td><code>trac #17227: small corrections for comment 18</code></td></tr></table>




---

archive/issue_comments_295216.json:
```json
{
    "body": "**Changing commit** from \"[6f5df4ae85820ac3235c21134f79c07b27710184](https://github.com/sagemath/sagetrac-mirror/commit/6f5df4ae85820ac3235c21134f79c07b27710184)\" to \"[e44ca66fc938dbedc653fc23e88a23618d79366c](https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c)\".",
    "created_at": "2014-12-31T13:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6f5df4ae85820ac3235c21134f79c07b27710184](https://github.com/sagemath/sagetrac-mirror/commit/6f5df4ae85820ac3235c21134f79c07b27710184)" to "[e44ca66fc938dbedc653fc23e88a23618d79366c](https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c)".



---

archive/issue_comments_295217.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [ncohen](#comment%3A18):\n> Hello David !\n> \n> > Well, since we have 'basic+', we don't need 'basic' anymore.\n\n> \n> +1\n> \n> > I have corrected the documentation. Soto proved that `hyp(a,b,c,d) <= 2*dist(a,b)`\n\n> \n> It seems that you only fixed the text and not the math formula that follows.\n\n\nCorrected.\n \n> > I'm clearly consuming much more memory than necessary.\n> > If the extra cost is not too high, I may propose the modification in another patch.\n\n> \n> Okay. Perhaps the removal of 'basic' will make things slightly clearer already.\n> \n> > I have updated the documentation of the method to precise that it assumes that\n> > the input graph is connected.\n\n> \n> Would you be willing to add a check right at the beginning of the function, just\n> in case the graph is not connected ? The complexity of the algorithm will not be\n> hurt by one more BFS ^^;\n\n\nMethod `__hyperbolicity__` takes as input the distance matrix but not the graph itself. So the only way to check that the graph is connected would be to check that all distances from node 0 in the distance matrix are in the range [0,N-1].\nShould I add such a test?\n\n \n> > I have changed the comment to `Compute the hyperbolicity using a the algorithm of [CCL12]_`\n\n> \n> Sorry, my remark was not very clear: what I meant is that the function that\n> follows does not only implement the algorithm from CCL12. It also deals with\n> far-apart pairs, and unless I make a mistake there was no mention of them in\n> that paper. The second line of the function's doc say the same.\n\n\nIn fact all details are in a paper under submission. We can wait until the paper get accepted to replace the reference. This can be done in the patch removing the 'basic' method.\n \n> Other comments:\n> \n> - In this block of code:\n> \n>   ```\n>   if hh > hyp or (hh==hyp and not certificate):\n>       hyp = hh\n>       hyp_UB = hh_UB\n>       certificate = certif\n>   ```\n> \n>   Shouldn't we have `hyp_UB = max(hyp_UB,hh_UB)` instead ? Or is it always\n>   correct for some other reason ? Also, if the 'min' is necessary, could there\n>   be a situation in which `hh < hyp` but `hh_UB > hyp_UB` ? In that case the\n>   upper bound would need to be updated, but not `hyp`.\n\n\nRight. I have changed to `hyp_UB = max(hyp_UB,hh_UB)`.\n  \n> - About `return (h, certificate, h_UB if GOTO_RETURN else h)`: note that in\n>   Python you can have a for/else:\n> \n> \n>   ```\n>   sage: for i in range(40):\n>   ....:     pass\n>   ....: else:\n>   ....:     print \"Hey\"\n>   ....:\n>   Hey\n>   sage: for i in range(40):\n>   ....:     break\n>   ....: else:\n>   ....:     print \"Hey\"\n>   ....:\n>   sage:\n>   ```\n \nI know that, but I don't know how it can be used to simplify the code. Indeed, the `else` part will always be executed, even without `pass` or `break`.\n  \nThanks Nathann.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c\">e44ca66</a></td><td><code>trac #17227: small corrections for comment 18</code></td></tr></table>\n",
    "created_at": "2014-12-31T13:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295217",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:20'></a>
Replying to [ncohen](#comment%3A18):
> Hello David !
> 
> > Well, since we have 'basic+', we don't need 'basic' anymore.

> 
> +1
> 
> > I have corrected the documentation. Soto proved that `hyp(a,b,c,d) <= 2*dist(a,b)`

> 
> It seems that you only fixed the text and not the math formula that follows.


Corrected.
 
> > I'm clearly consuming much more memory than necessary.
> > If the extra cost is not too high, I may propose the modification in another patch.

> 
> Okay. Perhaps the removal of 'basic' will make things slightly clearer already.
> 
> > I have updated the documentation of the method to precise that it assumes that
> > the input graph is connected.

> 
> Would you be willing to add a check right at the beginning of the function, just
> in case the graph is not connected ? The complexity of the algorithm will not be
> hurt by one more BFS ^^;


Method `__hyperbolicity__` takes as input the distance matrix but not the graph itself. So the only way to check that the graph is connected would be to check that all distances from node 0 in the distance matrix are in the range [0,N-1].
Should I add such a test?

 
> > I have changed the comment to `Compute the hyperbolicity using a the algorithm of [CCL12]_`

> 
> Sorry, my remark was not very clear: what I meant is that the function that
> follows does not only implement the algorithm from CCL12. It also deals with
> far-apart pairs, and unless I make a mistake there was no mention of them in
> that paper. The second line of the function's doc say the same.


In fact all details are in a paper under submission. We can wait until the paper get accepted to replace the reference. This can be done in the patch removing the 'basic' method.
 
> Other comments:
> 
> - In this block of code:
> 
>   ```
>   if hh > hyp or (hh==hyp and not certificate):
>       hyp = hh
>       hyp_UB = hh_UB
>       certificate = certif
>   ```
> 
>   Shouldn't we have `hyp_UB = max(hyp_UB,hh_UB)` instead ? Or is it always
>   correct for some other reason ? Also, if the 'min' is necessary, could there
>   be a situation in which `hh < hyp` but `hh_UB > hyp_UB` ? In that case the
>   upper bound would need to be updated, but not `hyp`.


Right. I have changed to `hyp_UB = max(hyp_UB,hh_UB)`.
  
> - About `return (h, certificate, h_UB if GOTO_RETURN else h)`: note that in
>   Python you can have a for/else:
> 
> 
>   ```
>   sage: for i in range(40):
>   ....:     pass
>   ....: else:
>   ....:     print "Hey"
>   ....:
>   Hey
>   sage: for i in range(40):
>   ....:     break
>   ....: else:
>   ....:     print "Hey"
>   ....:
>   sage:
>   ```
 
I know that, but I don't know how it can be used to simplify the code. Indeed, the `else` part will always be executed, even without `pass` or `break`.
  
Thanks Nathann.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c">e44ca66</a></td><td><code>trac #17227: small corrections for comment 18</code></td></tr></table>




---

archive/issue_comments_295218.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2014-12-31T13:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295218",
    "user": "https://github.com/dcoudert"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_295219.json:
```json
{
    "body": "<a id='comment:21'></a>\nHelloooooo !\n\n> Method `__hyperbolicity__` takes as input the distance matrix but not the graph itself. So the only way to check that the graph is connected would be to check that all distances from node 0 in the distance matrix are in the range [0,N-1].\n> Should I add such a test?\n\n\nYes, please. It will only be a l-dimension loop, so it will really be cheap.\n\n> In fact all details are in a paper under submission. We can wait until the paper get accepted to replace the reference. This can be done in the patch removing the 'basic' method.\n\n\nOkay, +1.\n\n> >   Shouldn't we have `hyp_UB = max(hyp_UB,hh_UB)` instead ? Or is it always\n> >   correct for some other reason ? Also, if the 'min' is necessary, could there\n> >   be a situation in which `hh < hyp` but `hh_UB > hyp_UB` ? In that case the\n> >   upper bound would need to be updated, but not `hyp`.\n\n> \n> Right. I have changed to `hyp_UB = max(hyp_UB,hh_UB)`.\n\n\nOkay. My question had a second part, however: is it possible that even though `hh < hyp` we have `hh_UB > hyp_UB` ? In this situation the upper bound would need to be updated, even though `hyp` would stay the same.\n\n> I know that, but I don't know how it can be used to simplify the code. Indeed, the `else` part will always be executed, even without `pass` or `break`.\n\n\nSorry sorry, I just meant this as a general remark. While it could be used in this code, it is already sufficiently complicated to not use Python-specific instructions unless there is a good reason (that I do not see here).\n\nI set the ticket to `needs_work`, because of the connectivity test and the question related to the upper bound. We will be done soon.\n\nNathann",
    "created_at": "2015-01-01T13:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295219",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'></a>
Helloooooo !

> Method `__hyperbolicity__` takes as input the distance matrix but not the graph itself. So the only way to check that the graph is connected would be to check that all distances from node 0 in the distance matrix are in the range [0,N-1].
> Should I add such a test?


Yes, please. It will only be a l-dimension loop, so it will really be cheap.

> In fact all details are in a paper under submission. We can wait until the paper get accepted to replace the reference. This can be done in the patch removing the 'basic' method.


Okay, +1.

> >   Shouldn't we have `hyp_UB = max(hyp_UB,hh_UB)` instead ? Or is it always
> >   correct for some other reason ? Also, if the 'min' is necessary, could there
> >   be a situation in which `hh < hyp` but `hh_UB > hyp_UB` ? In that case the
> >   upper bound would need to be updated, but not `hyp`.

> 
> Right. I have changed to `hyp_UB = max(hyp_UB,hh_UB)`.


Okay. My question had a second part, however: is it possible that even though `hh < hyp` we have `hh_UB > hyp_UB` ? In this situation the upper bound would need to be updated, even though `hyp` would stay the same.

> I know that, but I don't know how it can be used to simplify the code. Indeed, the `else` part will always be executed, even without `pass` or `break`.


Sorry sorry, I just meant this as a general remark. While it could be used in this code, it is already sufficiently complicated to not use Python-specific instructions unless there is a good reason (that I do not see here).

I set the ticket to `needs_work`, because of the connectivity test and the question related to the upper bound. We will be done soon.

Nathann



---

archive/issue_comments_295220.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-01-01T13:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295220",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_295221.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [ncohen](#comment%3A21):\n> Helloooooo !\n> \n> > Method `__hyperbolicity__` takes as input the distance matrix but not the graph itself. So the only way to check that the graph is connected would be to check that all distances from node 0 in the distance matrix are in the range [0,N-1].\n> > Should I add such a test?\n\n> \n> Yes, please. It will only be a l-dimension loop, so it will really be cheap.\n\n\nI have added a test at the beginning of method `__hyperbolicity__`. I have also forced initialization of distances to largest possible value in method `distances_and_far_apart_pairs`, although it is clearly written that this method ensures a connected graph. Now we should be on the safe side. \n  \n\n> Okay. My question had a second part, however: is it possible that even though `hh < hyp` we have `hh_UB > hyp_UB` ? In this situation the upper bound would need to be updated, even though `hyp` would stay the same.\n\n\nYou are right, such situation may happen. Suppose for instance that the graph has 2 biconnected components, a (k+1)*(k+1)-grid and a k-hyperbolic graph with large diameter and plenty of far-apart pairs with various distances. The upper bound for the grid will be k, but for the other component the upper bound could be large (c*k or k+c).\n\nI have moved the update of the upper bound (`hyp_UB = max(hyp_UB, hh_UB)`) outside of the `if...` to address such case.\n  \n> I set the ticket to `needs_work`, because of the connectivity test and the question related to the upper bound. We will be done soon.\n> \n> Nathann\n\n\nI hope it's better now.",
    "created_at": "2015-01-01T18:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295221",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'></a>
Replying to [ncohen](#comment%3A21):
> Helloooooo !
> 
> > Method `__hyperbolicity__` takes as input the distance matrix but not the graph itself. So the only way to check that the graph is connected would be to check that all distances from node 0 in the distance matrix are in the range [0,N-1].
> > Should I add such a test?

> 
> Yes, please. It will only be a l-dimension loop, so it will really be cheap.


I have added a test at the beginning of method `__hyperbolicity__`. I have also forced initialization of distances to largest possible value in method `distances_and_far_apart_pairs`, although it is clearly written that this method ensures a connected graph. Now we should be on the safe side. 
  

> Okay. My question had a second part, however: is it possible that even though `hh < hyp` we have `hh_UB > hyp_UB` ? In this situation the upper bound would need to be updated, even though `hyp` would stay the same.


You are right, such situation may happen. Suppose for instance that the graph has 2 biconnected components, a (k+1)*(k+1)-grid and a k-hyperbolic graph with large diameter and plenty of far-apart pairs with various distances. The upper bound for the grid will be k, but for the other component the upper bound could be large (c*k or k+c).

I have moved the update of the upper bound (`hyp_UB = max(hyp_UB, hh_UB)`) outside of the `if...` to address such case.
  
> I set the ticket to `needs_work`, because of the connectivity test and the question related to the upper bound. We will be done soon.
> 
> Nathann


I hope it's better now.



---

archive/issue_comments_295222.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa\">1b35416</a></td><td><code>trac #17227: small corrections for comment 21</code></td></tr></table>\n",
    "created_at": "2015-01-01T18:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa">1b35416</a></td><td><code>trac #17227: small corrections for comment 21</code></td></tr></table>




---

archive/issue_comments_295223.json:
```json
{
    "body": "**Changing commit** from \"[e44ca66fc938dbedc653fc23e88a23618d79366c](https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c)\" to \"[1b35416e8b5cdb792573d28fd4c4ce161d5a52aa](https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa)\".",
    "created_at": "2015-01-01T18:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e44ca66fc938dbedc653fc23e88a23618d79366c](https://github.com/sagemath/sagetrac-mirror/commit/e44ca66fc938dbedc653fc23e88a23618d79366c)" to "[1b35416e8b5cdb792573d28fd4c4ce161d5a52aa](https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa)".



---

archive/issue_comments_295224.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-01-01T18:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295224",
    "user": "https://github.com/dcoudert"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_295225.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-01-02T06:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295225",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_295226.json:
```json
{
    "body": "<a id='comment:25'></a>\n> I hope it's better now.\n\n\nYep ! At long last, this ticket is...positively reviewed `:-P`\n\nNathann",
    "created_at": "2015-01-02T06:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295226",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:25'></a>
> I hope it's better now.


Yep ! At long last, this ticket is...positively reviewed `:-P`

Nathann



---

archive/issue_comments_295227.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks a lot Nathann!",
    "created_at": "2015-01-02T09:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295227",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:26'></a>
Thanks a lot Nathann!



---

archive/issue_events_056714.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-02T22:12:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17227#event-56714"
}
```



---

archive/issue_comments_295228.json:
```json
{
    "body": "**Changing branch** from \"[public/17227](https://github.com/sagemath/sagetrac-mirror/tree/public/17227)\" to \"[1b35416e8b5cdb792573d28fd4c4ce161d5a52aa](https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa)\".",
    "created_at": "2015-01-02T22:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295228",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/17227](https://github.com/sagemath/sagetrac-mirror/tree/public/17227)" to "[1b35416e8b5cdb792573d28fd4c4ce161d5a52aa](https://github.com/sagemath/sagetrac-mirror/commit/1b35416e8b5cdb792573d28fd4c4ce161d5a52aa)".



---

archive/issue_comments_295229.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-01-02T22:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17227#issuecomment-295229",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
