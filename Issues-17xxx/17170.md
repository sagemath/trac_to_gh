# Issue 17170: Sagenb graphics displayhook

archive/issues_016933.json:
```json
{
    "body": "The displayhook does not do the right thing in the sagenb notebook.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17170\n\n",
    "closed_at": "2014-10-29T10:39:31Z",
    "created_at": "2014-10-17T18:37:23Z",
    "labels": [
        "component: graphics",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Sagenb graphics displayhook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17170",
    "user": "https://github.com/vbraun"
}
```
The displayhook does not do the right thing in the sagenb notebook.

Issue created by migration from https://trac.sagemath.org/ticket/17170





---

archive/issue_comments_224083.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-10-17T19:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224083",
    "user": "https://github.com/kcrisman"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_224084.json:
```json
{
    "body": "This breaks all sagenb graphics done without `show(...)`, so blocker.",
    "created_at": "2014-10-17T19:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224084",
    "user": "https://github.com/kcrisman"
}
```

This breaks all sagenb graphics done without `show(...)`, so blocker.



---

archive/issue_comments_224085.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-17T23:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224085",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224086.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-17T23:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224086",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_224087.json:
```json
{
    "body": "Seems to work properly in command line and for 2d in the notebook.  It'll be a moment before I can try with 3d (at least jmol, didn't think about tachyon) with the union of this and the new jmol, though the \"static\" image turned up okay, so I guess this works that way too.\n\nDoesn't\n\n```\nif isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):\n```\ncover both 2d and 3d graphics?  \n\nAlso, you probably should do at least a minimal doctest for `sagenb_embedding` and `save_as`.\n\nFinally, what with all the changes to display stuff I think that it would be well worth asking for a little extra testing of any rc for this series *visually*.",
    "created_at": "2014-10-20T14:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224087",
    "user": "https://github.com/kcrisman"
}
```

Seems to work properly in command line and for 2d in the notebook.  It'll be a moment before I can try with 3d (at least jmol, didn't think about tachyon) with the union of this and the new jmol, though the "static" image turned up okay, so I guess this works that way too.

Doesn't

```
if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):
```
cover both 2d and 3d graphics?  

Also, you probably should do at least a minimal doctest for `sagenb_embedding` and `save_as`.

Finally, what with all the changes to display stuff I think that it would be well worth asking for a little extra testing of any rc for this series *visually*.



---

archive/issue_comments_224088.json:
```json
{
    "body": "Also, you should probably have someone test on Linux and definitely have someone test who hasn't been messing around with different sagenb branches and possibly got something mixed up because of that :)",
    "created_at": "2014-10-20T14:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224088",
    "user": "https://github.com/kcrisman"
}
```

Also, you should probably have someone test on Linux and definitely have someone test who hasn't been messing around with different sagenb branches and possibly got something mixed up because of that :)



---

archive/issue_comments_224089.json:
```json
{
    "body": "Hmm, I have a question here.  Probably due to the change in the way 3d is handled?\n* If you make a standard 2d plot like `plot(1-x,(x,0,1))`, evaluate, and then go back to *that same cell* and change it to something else like `plot(1-x^2,(x,0,1))`, the graphic changes.  But:\n* Try doing a Jsmol, and then try changing *that* notebook cell and re-evaluating.  If you don't have the \"Load 3D Live\" checkbox clicked, you'll think you changed it - but you didn't!  As soon as you make it live, it's the exact same one as before.  If you have the live checkbox clicked (this refers to #16004, for those who come new to this) then this is quite obvious.\n\nIf it helps, the filenames are definitely changing:\n\n```\n$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82\nsage0-size500-155928955.jmol.zip\tsage0-size500.jmol\n$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82\nsage0-size500-938371752.jmol.zip\tsage0-size500.jmol\n$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82\nsage0-size500-522166844.jmol.zip\tsage0-size500.jmol\n$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82\nsage0-size500-996347389.jmol.zip\tsage0-size500.jmol\n```\nbut I suspect that something is *not* being overwritten somewhere.",
    "created_at": "2014-10-20T19:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224089",
    "user": "https://github.com/kcrisman"
}
```

Hmm, I have a question here.  Probably due to the change in the way 3d is handled?
* If you make a standard 2d plot like `plot(1-x,(x,0,1))`, evaluate, and then go back to *that same cell* and change it to something else like `plot(1-x^2,(x,0,1))`, the graphic changes.  But:
* Try doing a Jsmol, and then try changing *that* notebook cell and re-evaluating.  If you don't have the "Load 3D Live" checkbox clicked, you'll think you changed it - but you didn't!  As soon as you make it live, it's the exact same one as before.  If you have the live checkbox clicked (this refers to #16004, for those who come new to this) then this is quite obvious.

If it helps, the filenames are definitely changing:

```
$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82
sage0-size500-155928955.jmol.zip	sage0-size500.jmol
$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82
sage0-size500-938371752.jmol.zip	sage0-size500.jmol
$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82
sage0-size500-522166844.jmol.zip	sage0-size500.jmol
$ ls .sage/sage_notebook.sagenb/home/admin/264/cells/82
sage0-size500-996347389.jmol.zip	sage0-size500.jmol
```
but I suspect that something is *not* being overwritten somewhere.



---

archive/issue_comments_224090.json:
```json
{
    "body": "> Hmm, I have a question here.  Probably due to the change in the way 3d is handled?\n\nOkay, I can confirm this problem is unrelated to this change.",
    "created_at": "2014-10-20T20:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224090",
    "user": "https://github.com/kcrisman"
}
```

> Hmm, I have a question here.  Probably due to the change in the way 3d is handled?

Okay, I can confirm this problem is unrelated to this change.



---

archive/issue_comments_224091.json:
```json
{
    "body": "This is very odd.  My test of Jmol/JSmol does not reproduce the problem you report. I am using the latest from #17020 and #16004.  Something must be out of wack.",
    "created_at": "2014-10-20T20:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224091",
    "user": "https://github.com/gutow"
}
```

This is very odd.  My test of Jmol/JSmol does not reproduce the problem you report. I am using the latest from #17020 and #16004.  Something must be out of wack.



---

archive/issue_comments_224092.json:
```json
{
    "body": ">>>Hmm, I have a question here. Probably due to the change in the way 3d is handled?\n\n>> Okay, I can confirm this problem is unrelated to this change.\n> This is very odd.  My test of Jmol/JSmol does not reproduce the problem you report. I am using the latest from #17020 and #16004.  Something must be out of wack.\n\nIs it using this ticket, I assume?  If you're not using the latest development Sage + this ticket, and you are NOT experiencing this problem, then maybe this ticket is the problem after all, though I thought I had ruled it out.",
    "created_at": "2014-10-20T20:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224092",
    "user": "https://github.com/kcrisman"
}
```

>>>Hmm, I have a question here. Probably due to the change in the way 3d is handled?

>> Okay, I can confirm this problem is unrelated to this change.
> This is very odd.  My test of Jmol/JSmol does not reproduce the problem you report. I am using the latest from #17020 and #16004.  Something must be out of wack.

Is it using this ticket, I assume?  If you're not using the latest development Sage + this ticket, and you are NOT experiencing this problem, then maybe this ticket is the problem after all, though I thought I had ruled it out.



---

archive/issue_comments_224093.json:
```json
{
    "body": "I have a feeling that this patch has exposed a latent caching issue (see [comment:118:ticket:16004 this comment]) in the way the notebook handles the script that actually launches the jmol.  I believe I have two different fixes at that ticket ([comment:125:ticket:16004 here] and [comment:126:ticket16004 here]), so I think we can go ahead and have people review this - especially it would be helpful for people who have NOT been involved with the jsmol transition to just confirm that this doesn't cause caching problems for 3d plots in the current Sage.\n\nNeeds work for the doctesting.",
    "created_at": "2014-10-21T16:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224093",
    "user": "https://github.com/kcrisman"
}
```

I have a feeling that this patch has exposed a latent caching issue (see [comment:118:ticket:16004 this comment]) in the way the notebook handles the script that actually launches the jmol.  I believe I have two different fixes at that ticket ([comment:125:ticket:16004 here] and [comment:126:ticket16004 here]), so I think we can go ahead and have people review this - especially it would be helpful for people who have NOT been involved with the jsmol transition to just confirm that this doesn't cause caching problems for 3d plots in the current Sage.

Needs work for the doctesting.



---

archive/issue_comments_224094.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-21T16:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224094",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224095.json:
```json
{
    "body": "I'm not going to add doctests to `graphics_file.py`, that needs to be rewritten in a future ticket anyways.",
    "created_at": "2014-10-22T16:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224095",
    "user": "https://github.com/vbraun"
}
```

I'm not going to add doctests to `graphics_file.py`, that needs to be rewritten in a future ticket anyways.



---

archive/issue_comments_224096.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-22T16:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224096",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_224097.json:
```json
{
    "body": "Umm... but the big unbreakable rule?  I could apply that argument to LOTS of files that need to be rewritten!",
    "created_at": "2014-10-22T16:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224097",
    "user": "https://github.com/kcrisman"
}
```

Umm... but the big unbreakable rule?  I could apply that argument to LOTS of files that need to be rewritten!



---

archive/issue_comments_224098.json:
```json
{
    "body": "See #16996",
    "created_at": "2014-10-22T17:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224098",
    "user": "https://github.com/vbraun"
}
```

See #16996



---

archive/issue_comments_224099.json:
```json
{
    "body": "> See #16996\n\nDo you mean [comment:49:ticket:16996 this comment]?    But note that said ticket hasn't even been opened (see [comment:51:ticket:16996 here]).",
    "created_at": "2014-10-22T17:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224099",
    "user": "https://github.com/kcrisman"
}
```

> See #16996

Do you mean [comment:49:ticket:16996 this comment]?    But note that said ticket hasn't even been opened (see [comment:51:ticket:16996 here]).



---

archive/issue_comments_224100.json:
```json
{
    "body": "Feel free to open a ticket...",
    "created_at": "2014-10-24T10:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224100",
    "user": "https://github.com/vbraun"
}
```

Feel free to open a ticket...



---

archive/issue_comments_224101.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-27T22:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224101",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224102.json:
```json
{
    "body": "Passes all doctests and plots work again. Why is this not positive review?",
    "created_at": "2014-10-27T22:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224102",
    "user": "https://github.com/ppurka"
}
```

Passes all doctests and plots work again. Why is this not positive review?



---

archive/issue_comments_224103.json:
```json
{
    "body": "> Passes all doctests and plots work again. Why is this not positive review?\n\nBecause we needed a reviewer, and I didn't have time to actually read the code in detail in this area I am less familiar with.  But several others have tested it as well.",
    "created_at": "2014-10-28T00:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224103",
    "user": "https://github.com/kcrisman"
}
```

> Passes all doctests and plots work again. Why is this not positive review?

Because we needed a reviewer, and I didn't have time to actually read the code in detail in this area I am less familiar with.  But several others have tested it as well.



---

archive/issue_events_049782.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-29T10:39:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17170#event-49782"
}
```



---

archive/issue_comments_224104.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-29T10:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224104",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_224105.json:
```json
{
    "body": "Do we need the\n\n```\nif sage.doctest.DOCTEST_MODE:\n    return\n```\nlines in `sagenb_embedding`? I'm removing them in #16640 and it doesn't seem to break anything.",
    "created_at": "2014-10-31T18:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224105",
    "user": "https://github.com/jdemeyer"
}
```

Do we need the

```
if sage.doctest.DOCTEST_MODE:
    return
```
lines in `sagenb_embedding`? I'm removing them in #16640 and it doesn't seem to break anything.



---

archive/issue_comments_224106.json:
```json
{
    "body": "Probably not needed.",
    "created_at": "2014-10-31T18:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17170#issuecomment-224106",
    "user": "https://github.com/vbraun"
}
```

Probably not needed.
