# Issue 17584: Simplify numpy import in vectors

archive/issues_017347.json:
```json
{
    "body": "In `src/sage/modules/vector_double_dense.pyx` there is a lot of code like\n\n```\n        global numpy\n        if numpy is None:\n            import numpy\n```\n\nHowever, since the whole module is not imported at startup, we might as well just put a global\n\n```\ncimport numpy\nimport numpy\n```\nand be done with it (we really need both the `cimport` and the `import` since the `.pxd` file comes from Cython which declares only the C API, not all numpy Python functions).\n\nIssue created by migration from https://trac.sagemath.org/ticket/17584\n\n",
    "closed_at": "2015-02-18T08:53:19Z",
    "created_at": "2015-01-05T13:29:21Z",
    "labels": [
        "component: linear algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Simplify numpy import in vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17584",
    "user": "https://github.com/jdemeyer"
}
```
In `src/sage/modules/vector_double_dense.pyx` there is a lot of code like

```
        global numpy
        if numpy is None:
            import numpy
```

However, since the whole module is not imported at startup, we might as well just put a global

```
cimport numpy
import numpy
```
and be done with it (we really need both the `cimport` and the `import` since the `.pxd` file comes from Cython which declares only the C API, not all numpy Python functions).

Issue created by migration from https://trac.sagemath.org/ticket/17584





---

archive/issue_comments_230836.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-05T14:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230836",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_230837.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-05T14:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230837",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230838.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-14T09:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_230839.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-14T10:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230839",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230840.json:
```json
{
    "body": "Looks good to me. Note that cimporting numpy will (indirectly) import it anyway to get the numpy.ndarray type. \n\nI am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?",
    "created_at": "2015-02-14T10:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230840",
    "user": "https://github.com/robertwb"
}
```

Looks good to me. Note that cimporting numpy will (indirectly) import it anyway to get the numpy.ndarray type. 

I am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?



---

archive/issue_comments_230841.json:
```json
{
    "body": "Replying to [comment:6 robertwb]:\n> I am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?\n\n\n```\ncimport numpy\ncdef class numpy_test:\n    def numpy(self):\n        pass\n    cdef foo(self, numpy.dtype dtype):\n        pass\n```\ngives\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\ncimport numpy\ncdef class numpy_test:\n    def numpy(self):\n        pass\n    cdef foo(self, numpy.dtype dtype):\n                  ^\n------------------------------------------------------------\n\nsage/modules/vector_double_dense_test.pyx:5:19: 'numpy' is not a cimported module\n```\n\nIs this a bug?",
    "created_at": "2015-02-14T17:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230841",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 robertwb]:
> I am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?


```
cimport numpy
cdef class numpy_test:
    def numpy(self):
        pass
    cdef foo(self, numpy.dtype dtype):
        pass
```
gives

```
Error compiling Cython file:
------------------------------------------------------------
...
cimport numpy
cdef class numpy_test:
    def numpy(self):
        pass
    cdef foo(self, numpy.dtype dtype):
                  ^
------------------------------------------------------------

sage/modules/vector_double_dense_test.pyx:5:19: 'numpy' is not a cimported module
```

Is this a bug?



---

archive/issue_comments_230842.json:
```json
{
    "body": "Yes, that's a bug.",
    "created_at": "2015-02-14T18:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230842",
    "user": "https://github.com/robertwb"
}
```

Yes, that's a bug.



---

archive/issue_comments_230843.json:
```json
{
    "body": "Could you report the bug, it would be nice to reference the bug in the Sage code.",
    "created_at": "2015-02-15T13:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230843",
    "user": "https://github.com/jdemeyer"
}
```

Could you report the bug, it would be nice to reference the bug in the Sage code.



---

archive/issue_events_050447.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-18T08:53:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17584#event-50447"
}
```



---

archive/issue_comments_230844.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-18T08:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-230844",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
