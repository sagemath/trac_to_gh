# Issue 17584: Simplify numpy import in vectors

archive/issues_017347.json:
```json
{
    "body": "In `src/sage/modules/vector_double_dense.pyx` there is a lot of code like\n\n```\n        global numpy\n        if numpy is None:\n            import numpy\n```\n\nHowever, since the whole module is not imported at startup, we might as well just put a global\n\n```\ncimport numpy\nimport numpy\n```\nand be done with it (we really need both the `cimport` and the `import` since the `.pxd` file comes from Cython which declares only the C API, not all numpy Python functions).\n\nBranch/Commit: 35a6d5f36bc7fe4b511bb2fcd780e5b685852fe9\n\nReviewer: Robert Bradshaw\n\nAuthor: Jeroen Demeyer\n\nDependencies: #13081\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17584\n\n",
    "closed_at": "2015-02-18T08:53:19Z",
    "created_at": "2015-01-05T13:29:21Z",
    "labels": [
        "component: linear algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Simplify numpy import in vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17584",
    "user": "https://github.com/jdemeyer"
}
```
In `src/sage/modules/vector_double_dense.pyx` there is a lot of code like

```
        global numpy
        if numpy is None:
            import numpy
```

However, since the whole module is not imported at startup, we might as well just put a global

```
cimport numpy
import numpy
```
and be done with it (we really need both the `cimport` and the `import` since the `.pxd` file comes from Cython which declares only the C API, not all numpy Python functions).

Branch/Commit: 35a6d5f36bc7fe4b511bb2fcd780e5b685852fe9

Reviewer: Robert Bradshaw

Author: Jeroen Demeyer

Dependencies: #13081

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17584





---

archive/issue_comments_245820.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2015-01-05T14:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245820",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_245821.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n \n \\`\\`\\`\n cimport numpy\n+import numpy\n \\`\\`\\`\n and be done with it.\n \n```\n",
    "created_at": "2015-01-05T14:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245821",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -10,6 +10,7 @@
 
 \`\`\`
 cimport numpy
+import numpy
 \`\`\`
 and be done with it.
 
```




---

archive/issue_comments_245822.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-05T14:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245822",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245823.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-14T09:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245824.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n+In \\`src/sage/modules/vector_double_dense.pyx\\` there is a lot of code like\n \n+\\`\\`\\`\n+        global numpy\n+        if numpy is None:\n+            import numpy\n+\\`\\`\\`\n+\n+However, since the whole module is not imported at startup, we might as well just put a global\n+\n+\\`\\`\\`\n+cimport numpy\n+import numpy\n+\\`\\`\\`\n+and be done with it (we really need both the \\`cimport\\` and the \\`import\\` since the \\`.pxd\\` file comes from Cython which declares only the C API, not all numpy Python functions).\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2015-02-14T09:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245824",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,18 @@
+In \`src/sage/modules/vector_double_dense.pyx\` there is a lot of code like
 
+\`\`\`
+        global numpy
+        if numpy is None:
+            import numpy
+\`\`\`
+
+However, since the whole module is not imported at startup, we might as well just put a global
+
+\`\`\`
+cimport numpy
+import numpy
+\`\`\`
+and be done with it (we really need both the \`cimport\` and the \`import\` since the \`.pxd\` file comes from Cython which declares only the C API, not all numpy Python functions).
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_245825.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-14T10:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245825",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245826.json:
```json
{
    "body": "<a id='comment:6'></a>Looks good to me. Note that cimporting numpy will (indirectly) import it anyway to get the numpy.ndarray type. \n\nI am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?",
    "created_at": "2015-02-14T10:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245826",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>Looks good to me. Note that cimporting numpy will (indirectly) import it anyway to get the numpy.ndarray type. 

I am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?



---

archive/issue_comments_245827.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 robertwb]:\n> I am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?\n\n\n```\ncimport numpy\ncdef class numpy_test:\n    def numpy(self):\n        pass\n    cdef foo(self, numpy.dtype dtype):\n        pass\n```\ngives\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\ncimport numpy\ncdef class numpy_test:\n    def numpy(self):\n        pass\n    cdef foo(self, numpy.dtype dtype):\n                  ^\n------------------------------------------------------------\n\nsage/modules/vector_double_dense_test.pyx:5:19: 'numpy' is not a cimported module\n```\n\nIs this a bug?",
    "created_at": "2015-02-14T17:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245827",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:6 robertwb]:
> I am curious about the commend that the numpy method must be last... do you have a minimal example for that bug?


```
cimport numpy
cdef class numpy_test:
    def numpy(self):
        pass
    cdef foo(self, numpy.dtype dtype):
        pass
```
gives

```
Error compiling Cython file:
------------------------------------------------------------
...
cimport numpy
cdef class numpy_test:
    def numpy(self):
        pass
    cdef foo(self, numpy.dtype dtype):
                  ^
------------------------------------------------------------

sage/modules/vector_double_dense_test.pyx:5:19: 'numpy' is not a cimported module
```

Is this a bug?



---

archive/issue_comments_245828.json:
```json
{
    "body": "<a id='comment:8'></a>Yes, that's a bug.",
    "created_at": "2015-02-14T18:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245828",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>Yes, that's a bug.



---

archive/issue_comments_245829.json:
```json
{
    "body": "<a id='comment:9'></a>Could you report the bug, it would be nice to reference the bug in the Sage code.",
    "created_at": "2015-02-15T13:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245829",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Could you report the bug, it would be nice to reference the bug in the Sage code.



---

archive/issue_events_050447.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-18T08:53:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17584#event-50447"
}
```



---

archive/issue_comments_245830.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-18T08:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17584#issuecomment-245830",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
