# Issue 17122: bessel_Y is off by 3 ulps

archive/issues_016885.json:
```json
{
    "body": "consider the following with Sage 6.0:\n\n```\nsage: R=RealField(113)\nsage: a=R(\"8.935761195587725798762818805462843676e-01\")\nsage: b=bessel_Y(0,a)\nsage: c=R(bessel_Y(0,RealField(200)(a)))\nsage: (b-c)/c.ulp()\n-3.00000000000000000000000000000000\nsage: b\n-7.44623881999333920107530266264974e-7\nsage: c\n-7.44623881999333920107530266264973e-7\n```\nGiven that MPFR provides correct rounding for bessel_Y (mpfr_y0) this should not happen.\n\n**Branch/Commit:** [bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c)\n\n**Reviewer:** Paul Zimmermann\n\n**Author:** Jeroen Demeyer\n\n**Dependencies:** #17130\n\nIssue created by migration from https://trac.sagemath.org/ticket/17122\n\n",
    "closed_at": "2014-12-12T12:29:24Z",
    "created_at": "2014-10-09T14:58:37Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "bessel_Y is off by 3 ulps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17122",
    "user": "https://github.com/zimmermann6"
}
```
consider the following with Sage 6.0:

```
sage: R=RealField(113)
sage: a=R("8.935761195587725798762818805462843676e-01")
sage: b=bessel_Y(0,a)
sage: c=R(bessel_Y(0,RealField(200)(a)))
sage: (b-c)/c.ulp()
-3.00000000000000000000000000000000
sage: b
-7.44623881999333920107530266264974e-7
sage: c
-7.44623881999333920107530266264973e-7
```
Given that MPFR provides correct rounding for bessel_Y (mpfr_y0) this should not happen.

**Branch/Commit:** [bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c)

**Reviewer:** Paul Zimmermann

**Author:** Jeroen Demeyer

**Dependencies:** #17130

Issue created by migration from https://trac.sagemath.org/ticket/17122





---

archive/issue_comments_276894.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe example is wrong, I get\n\n```\nsage: R = RealField(113)\nsage: a = R(\"1.414213562373095048801688724209698177\")\nsage: b = bessel_Y(0,a)\nsage: c = R(bessel_Y(0,RealField(200)(a)))\nsage: (b-c)/c.ulp()\n0.000000000000000000000000000000000\nsage: b\n0.344636931299712753154578621698097\nsage: c\n0.344636931299712753154578621698097\n```\n\nAnyway, numerical evaluation of Bessel functions is done using mpmath, not mpfr. I guess the reason is that mpfr can only compute `Y(n,x)` for *integers* n, while mpmath supports more general complex numbers for `n`.\n\nNote that you can access the mpfr functions directly using\n\n```\nsage: R = RealField(113)\nsage: a = R(\"1.414213562373095048801688724209698177\")\nsage: a.y0()\n0.344636931299712753154578621698097\n```",
    "created_at": "2014-10-09T15:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276894",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
The example is wrong, I get

```
sage: R = RealField(113)
sage: a = R("1.414213562373095048801688724209698177")
sage: b = bessel_Y(0,a)
sage: c = R(bessel_Y(0,RealField(200)(a)))
sage: (b-c)/c.ulp()
0.000000000000000000000000000000000
sage: b
0.344636931299712753154578621698097
sage: c
0.344636931299712753154578621698097
```

Anyway, numerical evaluation of Bessel functions is done using mpmath, not mpfr. I guess the reason is that mpfr can only compute `Y(n,x)` for *integers* n, while mpmath supports more general complex numbers for `n`.

Note that you can access the mpfr functions directly using

```
sage: R = RealField(113)
sage: a = R("1.414213562373095048801688724209698177")
sage: a.y0()
0.344636931299712753154578621698097
```



---

archive/issue_comments_276895.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ```\n sage: R=RealField(113)\n-sage: a=R(\"1.414213562373095048801688724209698177\")\n+sage: a=R(\"8.935761195587725798762818805462843676e-01\")\n sage: b=bessel_Y(0,a)\n sage: c=R(bessel_Y(0,RealField(200)(a)))\n sage: (b-c)/c.ulp()\n``````\n",
    "created_at": "2014-10-09T15:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276895",
    "user": "https://github.com/zimmermann6"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ```
 sage: R=RealField(113)
-sage: a=R("1.414213562373095048801688724209698177")
+sage: a=R("8.935761195587725798762818805462843676e-01")
 sage: b=bessel_Y(0,a)
 sage: c=R(bessel_Y(0,RealField(200)(a)))
 sage: (b-c)/c.ulp()
``````




---

archive/issue_comments_276896.json:
```json
{
    "body": "<a id='comment:2'></a>\nsorry, the value of `a` was wrong, I changed it in the description.\n\nIndeed MPFR can only handle integer n for Y(n,x), but it would better to call it in that case,\nsince it guarantees correct rounding (and thus numerical reproducibility).",
    "created_at": "2014-10-09T15:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276896",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:2'></a>
sorry, the value of `a` was wrong, I changed it in the description.

Indeed MPFR can only handle integer n for Y(n,x), but it would better to call it in that case,
since it guarantees correct rounding (and thus numerical reproducibility).



---

archive/issue_comments_276897.json:
```json
{
    "body": "<a id='comment:3'></a>\nmpfr is also much faster...",
    "created_at": "2014-10-09T20:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276897",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
mpfr is also much faster...



---

archive/issue_comments_276898.json:
```json
{
    "body": "<a id='comment:4'></a>\nIs there an MPFR function which can check if an `mpfr_t` is an exact integer? Or which acts like `mpfr_get_si` but *without rounding*, just converting if the number already was an exact integer (and returning an error otherwise). Or alternatively, which acts like `mpfr_get_z` and returns a ternary value.",
    "created_at": "2014-10-09T20:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276898",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Is there an MPFR function which can check if an `mpfr_t` is an exact integer? Or which acts like `mpfr_get_si` but *without rounding*, just converting if the number already was an exact integer (and returning an error otherwise). Or alternatively, which acts like `mpfr_get_z` and returns a ternary value.



---

archive/issue_comments_276899.json:
```json
{
    "body": "<a id='comment:5'></a>\nthere is `mpfr_integer_p`, but you also want `mpfr_fits_slong_p` if you want to convert the (integer) argument to a long before giving it to say `mpfr_yn`.",
    "created_at": "2014-10-09T21:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276899",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
there is `mpfr_integer_p`, but you also want `mpfr_fits_slong_p` if you want to convert the (integer) argument to a long before giving it to say `mpfr_yn`.



---

archive/issue_comments_276900.json:
```json
{
    "body": "<a id='comment:6'></a>\nI bumped into #17130 which I think should be fixed first (not by me).",
    "created_at": "2014-10-10T09:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276900",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
I bumped into #17130 which I think should be fixed first (not by me).



---

archive/issue_comments_276901.json:
```json
{
    "body": "**Dependencies:** #17130",
    "created_at": "2014-10-10T09:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276901",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #17130



---

archive/issue_comments_276902.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/17122](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17122)",
    "created_at": "2014-11-26T16:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276902",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/17122](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17122)



---

archive/issue_comments_276903.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2014-11-26T16:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276903",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_276904.json:
```json
{
    "body": "**Commit:** [bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c)",
    "created_at": "2014-11-26T16:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276904",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c)



---

archive/issue_comments_276905.json:
```json
{
    "body": "<a id='comment:8'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d\">6d10729</a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf\">b6e1ed4</a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/382f97a71989fb04131c0720918e9b66b19c125b\">382f97a</a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into 6.5beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546\">7265989</a></td><td><code>17130: reviewer's patch: fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c47dbd49b0e5ebb89b3d7afa694478c3d572866f\">c47dbd4</a></td><td><code>Fix Trac #17328 again in a better way</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a\">a486db2</a></td><td><code>Call the factorial() method of an Integer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c\">bce4fb0</a></td><td><code>Use mpfr for Bessel functions if possible</code></td></tr></table>\n",
    "created_at": "2014-11-26T16:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276905",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d">6d10729</a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf">b6e1ed4</a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/382f97a71989fb04131c0720918e9b66b19c125b">382f97a</a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into 6.5beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72659895c652ce20ed1373f95bfea378d9cbe546">7265989</a></td><td><code>17130: reviewer's patch: fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c47dbd49b0e5ebb89b3d7afa694478c3d572866f">c47dbd4</a></td><td><code>Fix Trac #17328 again in a better way</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a486db2b801f528a1a00b0dadb4c4c522f21654a">a486db2</a></td><td><code>Call the factorial() method of an Integer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c">bce4fb0</a></td><td><code>Use mpfr for Bessel functions if possible</code></td></tr></table>




---

archive/issue_comments_276906.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-11-26T16:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276906",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_276907.json:
```json
{
    "body": "<a id='comment:9'></a>\nI wish I could review that patch, but unfortunately since the change to git I don't know any more how\nto do...\n\nPaul",
    "created_at": "2014-11-26T19:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276907",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:9'></a>
I wish I could review that patch, but unfortunately since the change to git I don't know any more how
to do...

Paul



---

archive/issue_comments_276908.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think it's sufficient to look at [https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c) (the other commits come from #17130).",
    "created_at": "2014-11-26T21:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276908",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
I think it's sufficient to look at [https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c) (the other commits come from #17130).



---

archive/issue_comments_276909.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-12-05T17:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276909",
    "user": "https://github.com/zimmermann6"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_276910.json:
```json
{
    "body": "**Reviewer:** Paul Zimmermann",
    "created_at": "2014-12-05T17:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276910",
    "user": "https://github.com/zimmermann6"
}
```

**Reviewer:** Paul Zimmermann



---

archive/issue_comments_276911.json:
```json
{
    "body": "<a id='comment:11'></a>\nthis commit looks correct to me. Positive review.\n\nPaul",
    "created_at": "2014-12-05T17:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276911",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:11'></a>
this commit looks correct to me. Positive review.

Paul



---

archive/issue_comments_276912.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/17122](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17122)\" to \"[bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c)\".",
    "created_at": "2014-12-12T12:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17122#issuecomment-276912",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/17122](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17122)" to "[bce4fb0c1665025c98ec15d89c1345a0a67e925c](https://github.com/sagemath/sagetrac-mirror/commit/bce4fb0c1665025c98ec15d89c1345a0a67e925c)".



---

archive/issue_events_056127.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-12T12:29:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17122",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17122#event-56127"
}
```
