# Issue 17692: The default __invert__ method of an element should avoid coercion

archive/issues_017455.json:
```json
{
    "body": "Currently, the `__invert__` methods in element.pyx do\n\n```\n    return 1/self\n```\n\nThis results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do\n\n```\n    return self.parent().one() / self\n```\n\nAdditionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.\n\nCC:  @videlec @tscrim\n\nBranch: [u/vdelecroix/17692](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17692)\n\nReviewer: Travis Scrimshaw\n\nDependencies: #17694, #17740, #17741\n\nCommit: 310f284e92526d4b569a7044bc1883cd3190b088\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/17692\n\n",
    "closed_at": "2022-11-14T19:36:43Z",
    "created_at": "2015-01-29T21:17:18Z",
    "labels": [
        "component: basic arithmetic",
        "trivial"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "The default __invert__ method of an element should avoid coercion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17692",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```
Currently, the `__invert__` methods in element.pyx do

```
    return 1/self
```

This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do

```
    return self.parent().one() / self
```

Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.

CC:  @videlec @tscrim

Branch: [u/vdelecroix/17692](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17692)

Reviewer: Travis Scrimshaw

Dependencies: #17694, #17740, #17741

Commit: 310f284e92526d4b569a7044bc1883cd3190b088

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/17692





---

archive/issue_comments_306891.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Currently, the __invert__ methods in element.pyx do\n+Currently, the `__invert__` methods in element.pyx do\n \n ```\n     return 1/self\n@@ -10,4 +10,4 @@\n     return self.parent().one_element() / self\n ```\n \n-Additionally, the __invert__ method in MultiplicativeGroupElement relies on a method is_one() that is not provided by the class itself.\n+Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.\n``````\n",
    "created_at": "2015-01-30T07:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306891",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Currently, the __invert__ methods in element.pyx do
+Currently, the `__invert__` methods in element.pyx do
 
 ```
     return 1/self
@@ -10,4 +10,4 @@
     return self.parent().one_element() / self
 ```
 
-Additionally, the __invert__ method in MultiplicativeGroupElement relies on a method is_one() that is not provided by the class itself.
+Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.
``````




---

archive/issue_comments_306892.json:
```json
{
    "body": "<a id='comment:1'></a>\ncc'ing me (+ formatting in the description)",
    "created_at": "2015-01-30T07:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306892",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
cc'ing me (+ formatting in the description)



---

archive/issue_comments_306893.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[d3e1ad5](https://github.com/sagemath/sagetrac-mirror/commit/d3e1ad57a0c4f27e42dc1a5044644763d823d369)|`trac #17694: upgrade the category of polyhedra`|\n|[c0a0bbb](https://github.com/sagemath/sagetrac-mirror/commit/c0a0bbbe64c8524c98c88f342c62cc426c604260)|`trac #17694: one_element->one and zero_element->zero`|\n|[e3aa703](https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04)|`trac #17692: rewrite __invert__ (and delete some)`|",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306893",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[d3e1ad5](https://github.com/sagemath/sagetrac-mirror/commit/d3e1ad57a0c4f27e42dc1a5044644763d823d369)|`trac #17694: upgrade the category of polyhedra`|
|[c0a0bbb](https://github.com/sagemath/sagetrac-mirror/commit/c0a0bbbe64c8524c98c88f342c62cc426c604260)|`trac #17694: one_element->one and zero_element->zero`|
|[e3aa703](https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04)|`trac #17692: rewrite __invert__ (and delete some)`|



---

archive/issue_comments_306894.json:
```json
{
    "body": "Changing commit from \"\" to \"e3aa70371159bf5faf231260e8d6e766665f5c04\"",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306894",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "e3aa70371159bf5faf231260e8d6e766665f5c04"



---

archive/issue_comments_306895.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/17692\"",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306895",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/17692"



---

archive/issue_comments_306896.json:
```json
{
    "body": "Changing author from \"\" to \"Vincent Delecroix\"",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306896",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Vincent Delecroix"



---

archive/issue_comments_306897.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#17694\"",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306897",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "" to "#17694"



---

archive/issue_comments_306898.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306898",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_306899.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do\n \n ```\n-    return self.parent().one_element() / self\n+    return self.parent().one() / self\n ```\n \n Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.\n``````\n",
    "created_at": "2015-01-31T14:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306899",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do
 
 ```
-    return self.parent().one_element() / self
+    return self.parent().one() / self
 ```
 
 Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.
``````




---

archive/issue_comments_306900.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhy do you add\n\n```\nif self.is_zero():\n    raise ZeroDivisionError(\"division by zero in a ring\")\n```\n\nI would say it's the division code which should raise this error, not `__invert__`.",
    "created_at": "2015-02-03T15:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306900",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Why do you add

```
if self.is_zero():
    raise ZeroDivisionError("division by zero in a ring")
```

I would say it's the division code which should raise this error, not `__invert__`.



---

archive/issue_comments_306901.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[387ff8f](https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9)|`trac #17692: remove zero test + override -> overwrite`|",
    "created_at": "2015-02-04T13:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[387ff8f](https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9)|`trac #17692: remove zero test + override -> overwrite`|



---

archive/issue_comments_306902.json:
```json
{
    "body": "Changing commit from \"e3aa70371159bf5faf231260e8d6e766665f5c04\" to \"387ff8f217a41cbe64738048cef7bae8cd7167c9\"",
    "created_at": "2015-02-04T13:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306902",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e3aa70371159bf5faf231260e8d6e766665f5c04" to "387ff8f217a41cbe64738048cef7bae8cd7167c9"



---

archive/issue_comments_306903.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Why do you add\n>  ...\n> I would say it's the division code which should raise this error, not `__invert__`.\n\n\nRight. Removed in the last commit.",
    "created_at": "2015-02-04T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306903",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Replying to [jdemeyer](#comment%3A4):
> Why do you add
>  ...
> I would say it's the division code which should raise this error, not `__invert__`.


Right. Removed in the last commit.



---

archive/issue_comments_306904.json:
```json
{
    "body": "<a id='comment:7'></a>\n\n```\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 463, in sage.structure.coerce.CoercionModel_cache_maps.explain\nFailed example:\n    cm.explain(ZZ['x'], QQ['x'], operator.div)\nExpected:\n    Coercion on left operand via\n        Ring morphism:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Polynomial Ring in x over Rational Field\n          Defn: Induced from base ring by\n                Natural morphism:\n                  From: Integer Ring\n                  To:   Rational Field\n    Arithmetic performed after coercions.\n    Result lives in Fraction Field of Univariate Polynomial Ring in x over Rational Field\n    Fraction Field of Univariate Polynomial Ring in x over Rational Field\nGot:\n    Coercion on left operand via\n        Ring morphism:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Polynomial Ring in x over Rational Field\n          Defn: Induced from base ring by\n                Natural morphism:\n                  From: Integer Ring\n                  To:   Rational Field\n    Arithmetic performed after coercions.\n    Result lives in Univariate Polynomial Ring in x over Rational Field\n    Univariate Polynomial Ring in x over Rational Field\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 684, in sage.structure.coerce.CoercionModel_cache_maps.division_parent\nFailed example:\n    cm.division_parent(ZZ['x'])\nExpected:\n    Fraction Field of Univariate Polynomial Ring in x over Integer Ring\nGot:\n    Univariate Polynomial Ring in x over Integer Ring\n**********************************************************************\n```\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/maxima_abstract.py\", line 2299, in sage.interfaces.maxima_abstract.MaximaAbstractElementFunction.__inv__\nFailed example:\n    ~f\nExpected:\n    1/sin(x)\nGot:\n    one()/sin(x)\n**********************************************************************\n```\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/r.py\", line 22, in sage.interfaces.r\nFailed example:\n    ~x\nExpected:\n    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295\nGot:\n    [1] 0 0 0 0 0\n**********************************************************************\n```",
    "created_at": "2015-02-05T08:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306904",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'></a>

```
**********************************************************************
File "src/sage/structure/coerce.pyx", line 463, in sage.structure.coerce.CoercionModel_cache_maps.explain
Failed example:
    cm.explain(ZZ['x'], QQ['x'], operator.div)
Expected:
    Coercion on left operand via
        Ring morphism:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Polynomial Ring in x over Rational Field
          Defn: Induced from base ring by
                Natural morphism:
                  From: Integer Ring
                  To:   Rational Field
    Arithmetic performed after coercions.
    Result lives in Fraction Field of Univariate Polynomial Ring in x over Rational Field
    Fraction Field of Univariate Polynomial Ring in x over Rational Field
Got:
    Coercion on left operand via
        Ring morphism:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Polynomial Ring in x over Rational Field
          Defn: Induced from base ring by
                Natural morphism:
                  From: Integer Ring
                  To:   Rational Field
    Arithmetic performed after coercions.
    Result lives in Univariate Polynomial Ring in x over Rational Field
    Univariate Polynomial Ring in x over Rational Field
**********************************************************************
File "src/sage/structure/coerce.pyx", line 684, in sage.structure.coerce.CoercionModel_cache_maps.division_parent
Failed example:
    cm.division_parent(ZZ['x'])
Expected:
    Fraction Field of Univariate Polynomial Ring in x over Integer Ring
Got:
    Univariate Polynomial Ring in x over Integer Ring
**********************************************************************
```

```
**********************************************************************
File "src/sage/interfaces/maxima_abstract.py", line 2299, in sage.interfaces.maxima_abstract.MaximaAbstractElementFunction.__inv__
Failed example:
    ~f
Expected:
    1/sin(x)
Got:
    one()/sin(x)
**********************************************************************
```

```
**********************************************************************
File "src/sage/interfaces/r.py", line 22, in sage.interfaces.r
Failed example:
    ~x
Expected:
    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295
Got:
    [1] 0 0 0 0 0
**********************************************************************
```



---

archive/issue_comments_306905.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T08:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306905",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_306906.json:
```json
{
    "body": "Changing commit from \"387ff8f217a41cbe64738048cef7bae8cd7167c9\" to \"16f36b07f37fae901bdcc8aa29cd98bab1021e82\"",
    "created_at": "2015-02-05T13:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "387ff8f217a41cbe64738048cef7bae8cd7167c9" to "16f36b07f37fae901bdcc8aa29cd98bab1021e82"



---

archive/issue_comments_306907.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[06af245](https://github.com/sagemath/sagetrac-mirror/commit/06af24514d0fc57e3f592ab4866287cb49fbf1e7)|`trac #17692: fix interfaces`|\n|[16f36b0](https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82)|`trac #17692: remove a special case (for coercion)`|",
    "created_at": "2015-02-05T13:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306907",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[06af245](https://github.com/sagemath/sagetrac-mirror/commit/06af24514d0fc57e3f592ab4866287cb49fbf1e7)|`trac #17692: fix interfaces`|
|[16f36b0](https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82)|`trac #17692: remove a special case (for coercion)`|



---

archive/issue_comments_306908.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-05T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306908",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_306909.json:
```json
{
    "body": "<a id='comment:10'></a>\nWouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?",
    "created_at": "2015-02-05T13:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306909",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?



---

archive/issue_comments_306910.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T13:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306910",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_306911.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jdemeyer](#comment%3A10):\n> Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?\n\n\nTrue. Will do.",
    "created_at": "2015-02-05T13:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306911",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Replying to [jdemeyer](#comment%3A10):
> Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?


True. Will do.



---

archive/issue_comments_306912.json:
```json
{
    "body": "Changing commit from \"16f36b07f37fae901bdcc8aa29cd98bab1021e82\" to \"310f284e92526d4b569a7044bc1883cd3190b088\"",
    "created_at": "2015-02-05T13:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "16f36b07f37fae901bdcc8aa29cd98bab1021e82" to "310f284e92526d4b569a7044bc1883cd3190b088"



---

archive/issue_comments_306913.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[310f284](https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088)|`trac #17692: move .one and .zero into Interface`|",
    "created_at": "2015-02-05T13:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[310f284](https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088)|`trac #17692: move .one and .zero into Interface`|



---

archive/issue_comments_306914.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-05T13:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306914",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_306915.json:
```json
{
    "body": "<a id='comment:14'></a>\nMore doctest failures.\n\n```\n**********************************************************************\nFile \"src/sage/rings/infinity.py\", line 93, in sage.rings.infinity\nFailed example:\n    unsigned_oo/0\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: unsigned oo times smaller number not defined\nGot:\n      ...\n      File \"sage/structure/coerce.pyx\", line 798, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7153)\n        return PyObject_CallObject(op, xy)\n      File \"sage/structure/element.pyx\", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)\n        return (<RingElement>self)._div_(<RingElement>right)\n      File \"sage/structure/element.pyx\", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)\n        cpdef RingElement _div_(self, RingElement right):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 458, in _div_\n        return self * ~other\n      File \"sage/structure/element.pyx\", line 2073, in sage.structure.element.RingElement.__invert__ (build/cythonized/sage/structure/element.c:19009)\n        return self._parent.one() / self\n      File \"sage/structure/element.pyx\", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)\n        return (<RingElement>self)._div_(<RingElement>right)\n      File \"sage/structure/element.pyx\", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)\n        cpdef RingElement _div_(self, RingElement right):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 814, in _div_\n        raise ValueError(\"quotient of number < oo by number < oo not defined\")\n    ValueError: quotient of number < oo by number < oo not defined\n**********************************************************************\n```\n\n```\nsage -t --warn-long 30.1 src/sage/schemes/elliptic_curves/formal_group.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/formal_group.py\", line 431, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.inverse\nFailed example:\n    F = E.formal_group().group_law(6)\nException raised:\n    ...\n    TypeError: unsupported operand parent(s) for '*': 'Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Rational Field' and 'Multivariate Polynomial Ring in t1, t2 over Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Integer Ring'\n**********************************************************************\n```\n\n```\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/formal_group.py\", line 523, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.group_law\nFailed example:\n    F(t1, 0)\nExpected:\n    t1 + O(t1, t2)^5\nGot:\n    t1 + O(t1, t2)^7\n**********************************************************************\n```",
    "created_at": "2015-02-05T16:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306915",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:14'></a>
More doctest failures.

```
**********************************************************************
File "src/sage/rings/infinity.py", line 93, in sage.rings.infinity
Failed example:
    unsigned_oo/0
Expected:
    Traceback (most recent call last):
    ...
    ValueError: unsigned oo times smaller number not defined
Got:
      ...
      File "sage/structure/coerce.pyx", line 798, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7153)
        return PyObject_CallObject(op, xy)
      File "sage/structure/element.pyx", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)
        return (<RingElement>self)._div_(<RingElement>right)
      File "sage/structure/element.pyx", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)
        cpdef RingElement _div_(self, RingElement right):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 458, in _div_
        return self * ~other
      File "sage/structure/element.pyx", line 2073, in sage.structure.element.RingElement.__invert__ (build/cythonized/sage/structure/element.c:19009)
        return self._parent.one() / self
      File "sage/structure/element.pyx", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)
        return (<RingElement>self)._div_(<RingElement>right)
      File "sage/structure/element.pyx", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)
        cpdef RingElement _div_(self, RingElement right):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 814, in _div_
        raise ValueError("quotient of number < oo by number < oo not defined")
    ValueError: quotient of number < oo by number < oo not defined
**********************************************************************
```

```
sage -t --warn-long 30.1 src/sage/schemes/elliptic_curves/formal_group.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/formal_group.py", line 431, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.inverse
Failed example:
    F = E.formal_group().group_law(6)
Exception raised:
    ...
    TypeError: unsupported operand parent(s) for '*': 'Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Rational Field' and 'Multivariate Polynomial Ring in t1, t2 over Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Integer Ring'
**********************************************************************
```

```
**********************************************************************
File "src/sage/schemes/elliptic_curves/formal_group.py", line 523, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.group_law
Failed example:
    F(t1, 0)
Expected:
    t1 + O(t1, t2)^5
Got:
    t1 + O(t1, t2)^7
**********************************************************************
```



---

archive/issue_comments_306916.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T16:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306916",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_306917.json:
```json
{
    "body": "<a id='comment:16'></a>\nHello,\n\nIndeed! The coercion with polynomial is to blame here... see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/3wduVqhoLWg). Several people fixed some issue locally (e.g. #7711). In order to go further, I need the coercion to be fixed. I will open a subsequent ticket if it is not yet here.\n\nVincent",
    "created_at": "2015-02-05T18:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306917",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
Hello,

Indeed! The coercion with polynomial is to blame here... see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/3wduVqhoLWg). Several people fixed some issue locally (e.g. #7711). In order to go further, I need the coercion to be fixed. I will open a subsequent ticket if it is not yet here.

Vincent



---

archive/issue_comments_306918.json:
```json
{
    "body": "Changing dependencies from \"#17694\" to \"#17694, #17740, #17741\"",
    "created_at": "2015-02-08T11:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306918",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "#17694" to "#17694, #17740, #17741"



---

archive/issue_comments_306919.json:
```json
{
    "body": "<a id='comment:18'></a>\nI actually propose to close this as \"wontfix\" since we need to get rid of `__invert__` anyway.",
    "created_at": "2016-06-05T08:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306919",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
I actually propose to close this as "wontfix" since we need to get rid of `__invert__` anyway.



---

archive/issue_comments_306920.json:
```json
{
    "body": "<a id='comment:19'></a>\nWhy? Where?",
    "created_at": "2016-06-05T08:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306920",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
Why? Where?



---

archive/issue_comments_306921.json:
```json
{
    "body": "<a id='comment:20'></a>\nWell, everywhere really because `__invert__` is supposed to return the bitwise inverse, not the mathematical inverse. It's the whole reason why I came up with the idea of a unary division.",
    "created_at": "2016-06-05T12:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306921",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Well, everywhere really because `__invert__` is supposed to return the bitwise inverse, not the mathematical inverse. It's the whole reason why I came up with the idea of a unary division.



---

archive/issue_events_057592.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-18T02:20:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17692#event-57592"
}
```



---

archive/issue_comments_306922.json:
```json
{
    "body": "<a id='comment:21'></a>\nClosing suggested in #17965#comment:57",
    "created_at": "2022-09-18T02:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Closing suggested in #17965#comment:57



---

archive/issue_comments_306923.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-09-18T02:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306923",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_306924.json:
```json
{
    "body": "Changing author from \"Vincent Delecroix\" to \"\"",
    "created_at": "2022-09-18T02:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306924",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Vincent Delecroix" to ""



---

archive/issue_comments_306925.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2022-09-18T02:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306925",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_306926.json:
```json
{
    "body": "<a id='comment:22'></a>\nIndeed, this seems to have already been done elsewhere.\n\nThere are still a few instances where it does use coercion, but they are all look specific:\n\n```\ntravis@apricot:~/sage-build/src/sage/rings$ grep -R --include \\*.p\\* \"1 */ *self\" ../*\n../manifolds/chart_func.py:            # NB: self._express.__invert__() would return 1/self._express\n../manifolds/chart_func.py:                          expression=self._simplify(1 / self.expr()),\n../modular/overconvergent/weightspace.py:            return 1 / self.Lvalue()\n../modular/local_comp/smoothchar.py:        return self.character(0, [1/self.ideal(1).residue_field().cardinality()])\n../modular/btquotients/pautomorphicform.py:            A = data.parent()._Sigma0(Matrix(QQ,2,2,[0,1/self.prime(),1,0]),check=False)\n../modular/modform_hecketriangle/abstract_ring.py:                d = 1 / self.base_ring()(1/d)\n../modular/modform_hecketriangle/abstract_ring.py:            return   1/self._group.n() * (X*Z-Y) * dX\\\n../modular/modform_hecketriangle/abstract_ring.py:            return - 1/self._group.n() * Y*dX\\\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.x = 1/self.eval_scale.x\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.y = 1/self.eval_scale.y\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.z = 1/self.eval_scale.z\n../rings/qqbar.py:        1/self.\n../rings/qqbar.py:        1/self.\n../rings/qqbar.py:        1/self.\n../rings/function_field/order.py:        return 1/self.function_field().gen()\n../rings/function_field/order.py:        return self.ideal( 1/self.function_field().gen() )\n../rings/real_double_element_gsl.pyx:        return 1/self.cosh()\n../rings/real_double_element_gsl.pyx:        return 1/self.sinh()\n../rings/rational_field.py:        yield 1/self.an_element()\n../rings/rational_field.py:        yield -1/self.an_element()\n../rings/puiseux_series_ring_element.pyx:        # use x.nth_root since x**(1/self._e) returns oo when x = 0\nBinary file ../rings/__pycache__/qqbar.cpython-310.pyc matches\n../rings/padics/padic_lattice_element.py:        # dx = -(1/self^2)*dself\n../rings/padics/padic_extension_generic.py:    #    u = 1 / self(1 - q, prec)\n../schemes/riemann_surfaces/riemann_surface.py:                M_tilde = 2*max((m[i].abs())**(1/self._RR(l-i))\n../schemes/cyclic_covers/cycliccover_finite_field.py:        iD = 1 / self._Zq0(D.lift() / self._p)\n../schemes/cyclic_covers/cycliccover_finite_field.py:                    iD = 1 / self._Zq(D.lift() / self._p)\n../schemes/elliptic_curves/padic_lseries.py:                L *= (1-1/self.alpha())**2\n../schemes/elliptic_curves/ell_tate_curve.py:        qE = q_in_terms_of_jinv(R(1 / self._E.j_invariant()))\n../schemes/projective/projective_point.py:        self.scale_by(1/self[index])\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center())\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center(), RR(radius / (self._custom_abs(self.center())**2)))\n../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i]\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0])\n../schemes/berkovich/berkovich_cp_element.py:                return self.parent()(ZZ(0), 1 / self.radius())\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0], self.radius() / (self._custom_abs(self.center()[0])**2))\n../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i][0]\n../symbolic/expression.pyx:        return 1/self\n```",
    "created_at": "2022-09-18T02:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306926",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
Indeed, this seems to have already been done elsewhere.

There are still a few instances where it does use coercion, but they are all look specific:

```
travis@apricot:~/sage-build/src/sage/rings$ grep -R --include \*.p\* "1 */ *self" ../*
../manifolds/chart_func.py:            # NB: self._express.__invert__() would return 1/self._express
../manifolds/chart_func.py:                          expression=self._simplify(1 / self.expr()),
../modular/overconvergent/weightspace.py:            return 1 / self.Lvalue()
../modular/local_comp/smoothchar.py:        return self.character(0, [1/self.ideal(1).residue_field().cardinality()])
../modular/btquotients/pautomorphicform.py:            A = data.parent()._Sigma0(Matrix(QQ,2,2,[0,1/self.prime(),1,0]),check=False)
../modular/modform_hecketriangle/abstract_ring.py:                d = 1 / self.base_ring()(1/d)
../modular/modform_hecketriangle/abstract_ring.py:            return   1/self._group.n() * (X*Z-Y) * dX\
../modular/modform_hecketriangle/abstract_ring.py:            return - 1/self._group.n() * Y*dX\
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.x = 1/self.eval_scale.x
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.y = 1/self.eval_scale.y
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.z = 1/self.eval_scale.z
../rings/qqbar.py:        1/self.
../rings/qqbar.py:        1/self.
../rings/qqbar.py:        1/self.
../rings/function_field/order.py:        return 1/self.function_field().gen()
../rings/function_field/order.py:        return self.ideal( 1/self.function_field().gen() )
../rings/real_double_element_gsl.pyx:        return 1/self.cosh()
../rings/real_double_element_gsl.pyx:        return 1/self.sinh()
../rings/rational_field.py:        yield 1/self.an_element()
../rings/rational_field.py:        yield -1/self.an_element()
../rings/puiseux_series_ring_element.pyx:        # use x.nth_root since x**(1/self._e) returns oo when x = 0
Binary file ../rings/__pycache__/qqbar.cpython-310.pyc matches
../rings/padics/padic_lattice_element.py:        # dx = -(1/self^2)*dself
../rings/padics/padic_extension_generic.py:    #    u = 1 / self(1 - q, prec)
../schemes/riemann_surfaces/riemann_surface.py:                M_tilde = 2*max((m[i].abs())**(1/self._RR(l-i))
../schemes/cyclic_covers/cycliccover_finite_field.py:        iD = 1 / self._Zq0(D.lift() / self._p)
../schemes/cyclic_covers/cycliccover_finite_field.py:                    iD = 1 / self._Zq(D.lift() / self._p)
../schemes/elliptic_curves/padic_lseries.py:                L *= (1-1/self.alpha())**2
../schemes/elliptic_curves/ell_tate_curve.py:        qE = q_in_terms_of_jinv(R(1 / self._E.j_invariant()))
../schemes/projective/projective_point.py:        self.scale_by(1/self[index])
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center())
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center(), RR(radius / (self._custom_abs(self.center())**2)))
../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i]
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0])
../schemes/berkovich/berkovich_cp_element.py:                return self.parent()(ZZ(0), 1 / self.radius())
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0], self.radius() / (self._custom_abs(self.center()[0])**2))
../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i][0]
../symbolic/expression.pyx:        return 1/self
```



---

archive/issue_comments_306927.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-18T02:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306927",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057593.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17692#event-57593"
}
```



---

archive/issue_comments_306928.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-11-14T19:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17692#issuecomment-306928",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
