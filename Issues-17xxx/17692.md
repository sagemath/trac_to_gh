# Issue 17692: The default __invert__ method of an element should avoid coercion

archive/issues_017455.json:
```json
{
    "assignees": [],
    "body": "Currently, the `__invert__` methods in element.pyx do\n\n```\n    return 1/self\n```\n\nThis results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do\n\n```\n    return self.parent().one() / self\n```\n\nAdditionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.\n\nDepends on #17694\nDepends on #17740\nDepends on #17741\n\nCC:  @videlec @tscrim\n\nBranch/Commit: **[u/vdelecroix/17692](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17692) @ [`310f284`](https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088)**\n\nReviewer: **Travis Scrimshaw**\n\nComponent: **basic arithmetic**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17692_\n\n",
    "closed_at": "2022-11-14T19:36:43Z",
    "created_at": "2015-01-29T21:17:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "The default __invert__ method of an element should avoid coercion",
    "type": "issue",
    "updated_at": "2022-11-14T19:36:43Z",
    "url": "https://github.com/sagemath/sage/issues/17692",
    "user": "https://github.com/sagetrac-Stefan"
}
```
Currently, the `__invert__` methods in element.pyx do

```
    return 1/self
```

This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do

```
    return self.parent().one() / self
```

Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.

Depends on #17694
Depends on #17740
Depends on #17741

CC:  @videlec @tscrim

Branch/Commit: **[u/vdelecroix/17692](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17692) @ [`310f284`](https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088)**

Reviewer: **Travis Scrimshaw**

Component: **basic arithmetic**

_Issue created by migration from https://trac.sagemath.org/ticket/17692_





---

archive/issue_events_252093.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-01-29T21:17:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252093"
}
```



---

archive/issue_events_252094.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-01-29T21:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252094"
}
```



---

archive/issue_events_252095.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-01-29T21:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/p%3A%205%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p: 5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252095"
}
```



---

archive/issue_events_252096.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-01-29T21:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252096"
}
```



---

archive/issue_comments_238902.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n     return self.parent().one_element() / self\n ```\n \n-Additionally, the `__invert__` method in MultiplicativeGroupElement relies on a method is_one() that is not provided by the class itself.\n+Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.\n``````\n",
    "created_at": "2015-01-30T07:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238902",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
     return self.parent().one_element() / self
 ```
 
-Additionally, the `__invert__` method in MultiplicativeGroupElement relies on a method is_one() that is not provided by the class itself.
+Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.
``````




---

archive/issue_comments_238903.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\ncc'ing me (+ formatting in the description)",
    "created_at": "2015-01-30T07:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238903",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1" align="right">comment:1</div>

cc'ing me (+ formatting in the description)



---

archive/issue_comments_238904.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3e1ad57a0c4f27e42dc1a5044644763d823d369\">d3e1ad5</a></td><td><code>trac #17694: upgrade the category of polyhedra</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0a0bbbe64c8524c98c88f342c62cc426c604260\">c0a0bbb</a></td><td><code>trac #17694: one_element->one and zero_element->zero</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04\">e3aa703</a></td><td><code>trac #17692: rewrite `__invert__` (and delete some)</code></td></tr></table>\n",
    "created_at": "2015-01-31T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238904",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3e1ad57a0c4f27e42dc1a5044644763d823d369">d3e1ad5</a></td><td><code>trac #17694: upgrade the category of polyhedra</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0a0bbbe64c8524c98c88f342c62cc426c604260">c0a0bbb</a></td><td><code>trac #17694: one_element->one and zero_element->zero</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04">e3aa703</a></td><td><code>trac #17692: rewrite `__invert__` (and delete some)</code></td></tr></table>




---

archive/issue_comments_238905.json:
```json
{
    "body": "Commit: **[`e3aa703`](https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04)**",
    "created_at": "2015-01-31T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238905",
    "user": "https://github.com/videlec"
}
```

Commit: **[`e3aa703`](https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04)**



---

archive/issue_comments_238906.json:
```json
{
    "body": "Branch: **[u/vdelecroix/17692](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17692)**",
    "created_at": "2015-01-31T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238906",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/17692](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17692)**



---

archive/issue_comments_238907.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2015-01-31T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238907",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_238908.json:
```json
{
    "body": "Dependencies: **#17694**",
    "created_at": "2015-01-31T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238908",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#17694**



---

archive/issue_events_252097.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-01-31T14:49:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252097"
}
```



---

archive/issue_comments_238909.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do\n \n ```\n-    return self.parent().one_element() / self\n+    return self.parent().one() / self\n ```\n \n Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.\n``````\n",
    "created_at": "2015-01-31T14:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238909",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do
 
 ```
-    return self.parent().one_element() / self
+    return self.parent().one() / self
 ```
 
 Additionally, the `__invert__` method in `MultiplicativeGroupElement` relies on a method `is_one()` that is not provided by the class itself.
``````




---

archive/issue_comments_238910.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWhy do you add\n\n```\nif self.is_zero():\n    raise ZeroDivisionError(\"division by zero in a ring\")\n```\n\nI would say it's the division code which should raise this error, not `__invert__`.",
    "created_at": "2015-02-03T15:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238910",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Why do you add

```
if self.is_zero():
    raise ZeroDivisionError("division by zero in a ring")
```

I would say it's the division code which should raise this error, not `__invert__`.



---

archive/issue_comments_238911.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9\">387ff8f</a></td><td><code>trac #17692: remove zero test + override -> overwrite</code></td></tr></table>\n",
    "created_at": "2015-02-04T13:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238911",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9">387ff8f</a></td><td><code>trac #17692: remove zero test + override -> overwrite</code></td></tr></table>




---

archive/issue_comments_238912.json:
```json
{
    "body": "Changed commit from **[`e3aa703`](https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04)** to **[`387ff8f`](https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9)**",
    "created_at": "2015-02-04T13:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238912",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e3aa703`](https://github.com/sagemath/sagetrac-mirror/commit/e3aa70371159bf5faf231260e8d6e766665f5c04)** to **[`387ff8f`](https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9)**



---

archive/issue_comments_238913.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jdemeyer](#comment:4):\n> Why do you add\n>  ...\n> I would say it's the division code which should raise this error, not `__invert__`.\n\nRight. Removed in the last commit.",
    "created_at": "2015-02-04T13:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238913",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jdemeyer](#comment:4):
> Why do you add
>  ...
> I would say it's the division code which should raise this error, not `__invert__`.

Right. Removed in the last commit.



---

archive/issue_comments_238914.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n\n```\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 463, in sage.structure.coerce.CoercionModel_cache_maps.explain\nFailed example:\n    cm.explain(ZZ['x'], QQ['x'], operator.div)\nExpected:\n    Coercion on left operand via\n        Ring morphism:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Polynomial Ring in x over Rational Field\n          Defn: Induced from base ring by\n                Natural morphism:\n                  From: Integer Ring\n                  To:   Rational Field\n    Arithmetic performed after coercions.\n    Result lives in Fraction Field of Univariate Polynomial Ring in x over Rational Field\n    Fraction Field of Univariate Polynomial Ring in x over Rational Field\nGot:\n    Coercion on left operand via\n        Ring morphism:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Polynomial Ring in x over Rational Field\n          Defn: Induced from base ring by\n                Natural morphism:\n                  From: Integer Ring\n                  To:   Rational Field\n    Arithmetic performed after coercions.\n    Result lives in Univariate Polynomial Ring in x over Rational Field\n    Univariate Polynomial Ring in x over Rational Field\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 684, in sage.structure.coerce.CoercionModel_cache_maps.division_parent\nFailed example:\n    cm.division_parent(ZZ['x'])\nExpected:\n    Fraction Field of Univariate Polynomial Ring in x over Integer Ring\nGot:\n    Univariate Polynomial Ring in x over Integer Ring\n**********************************************************************\n```\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/maxima_abstract.py\", line 2299, in sage.interfaces.maxima_abstract.MaximaAbstractElementFunction.__inv__\nFailed example:\n    ~f\nExpected:\n    1/sin(x)\nGot:\n    one()/sin(x)\n**********************************************************************\n```\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/r.py\", line 22, in sage.interfaces.r\nFailed example:\n    ~x\nExpected:\n    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295\nGot:\n    [1] 0 0 0 0 0\n**********************************************************************\n```",
    "created_at": "2015-02-05T08:38:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238914",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:7" align="right">comment:7</div>


```
**********************************************************************
File "src/sage/structure/coerce.pyx", line 463, in sage.structure.coerce.CoercionModel_cache_maps.explain
Failed example:
    cm.explain(ZZ['x'], QQ['x'], operator.div)
Expected:
    Coercion on left operand via
        Ring morphism:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Polynomial Ring in x over Rational Field
          Defn: Induced from base ring by
                Natural morphism:
                  From: Integer Ring
                  To:   Rational Field
    Arithmetic performed after coercions.
    Result lives in Fraction Field of Univariate Polynomial Ring in x over Rational Field
    Fraction Field of Univariate Polynomial Ring in x over Rational Field
Got:
    Coercion on left operand via
        Ring morphism:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Polynomial Ring in x over Rational Field
          Defn: Induced from base ring by
                Natural morphism:
                  From: Integer Ring
                  To:   Rational Field
    Arithmetic performed after coercions.
    Result lives in Univariate Polynomial Ring in x over Rational Field
    Univariate Polynomial Ring in x over Rational Field
**********************************************************************
File "src/sage/structure/coerce.pyx", line 684, in sage.structure.coerce.CoercionModel_cache_maps.division_parent
Failed example:
    cm.division_parent(ZZ['x'])
Expected:
    Fraction Field of Univariate Polynomial Ring in x over Integer Ring
Got:
    Univariate Polynomial Ring in x over Integer Ring
**********************************************************************
```

```
**********************************************************************
File "src/sage/interfaces/maxima_abstract.py", line 2299, in sage.interfaces.maxima_abstract.MaximaAbstractElementFunction.__inv__
Failed example:
    ~f
Expected:
    1/sin(x)
Got:
    one()/sin(x)
**********************************************************************
```

```
**********************************************************************
File "src/sage/interfaces/r.py", line 22, in sage.interfaces.r
Failed example:
    ~x
Expected:
    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295
Got:
    [1] 0 0 0 0 0
**********************************************************************
```



---

archive/issue_events_252098.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-05T08:38:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252098"
}
```



---

archive/issue_events_252099.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-05T08:38:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252099"
}
```



---

archive/issue_comments_238915.json:
```json
{
    "body": "Changed commit from **[`387ff8f`](https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9)** to **[`16f36b0`](https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82)**",
    "created_at": "2015-02-05T13:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238915",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`387ff8f`](https://github.com/sagemath/sagetrac-mirror/commit/387ff8f217a41cbe64738048cef7bae8cd7167c9)** to **[`16f36b0`](https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82)**



---

archive/issue_comments_238916.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06af24514d0fc57e3f592ab4866287cb49fbf1e7\">06af245</a></td><td><code>trac #17692: fix interfaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82\">16f36b0</a></td><td><code>trac #17692: remove a special case (for coercion)</code></td></tr></table>\n",
    "created_at": "2015-02-05T13:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238916",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06af24514d0fc57e3f592ab4866287cb49fbf1e7">06af245</a></td><td><code>trac #17692: fix interfaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82">16f36b0</a></td><td><code>trac #17692: remove a special case (for coercion)</code></td></tr></table>




---

archive/issue_events_252100.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-05T13:11:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252100"
}
```



---

archive/issue_events_252101.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-05T13:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252101"
}
```



---

archive/issue_comments_238917.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?",
    "created_at": "2015-02-05T13:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238917",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?



---

archive/issue_events_252102.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-05T13:22:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252102"
}
```



---

archive/issue_events_252103.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-05T13:22:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252103"
}
```



---

archive/issue_comments_238918.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jdemeyer](#comment:10):\n> Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?\n\nTrue. Will do.",
    "created_at": "2015-02-05T13:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238918",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jdemeyer](#comment:10):
> Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?

True. Will do.



---

archive/issue_comments_238919.json:
```json
{
    "body": "Changed commit from **[`16f36b0`](https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82)** to **[`310f284`](https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088)**",
    "created_at": "2015-02-05T13:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238919",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`16f36b0`](https://github.com/sagemath/sagetrac-mirror/commit/16f36b07f37fae901bdcc8aa29cd98bab1021e82)** to **[`310f284`](https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088)**



---

archive/issue_comments_238920.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088\">310f284</a></td><td><code>trac #17692: move .one and .zero into Interface</code></td></tr></table>\n",
    "created_at": "2015-02-05T13:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238920",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/310f284e92526d4b569a7044bc1883cd3190b088">310f284</a></td><td><code>trac #17692: move .one and .zero into Interface</code></td></tr></table>




---

archive/issue_events_252104.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-05T13:46:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252104"
}
```



---

archive/issue_events_252105.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-05T13:46:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252105"
}
```



---

archive/issue_comments_238921.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nMore doctest failures.\n\n```\n**********************************************************************\nFile \"src/sage/rings/infinity.py\", line 93, in sage.rings.infinity\nFailed example:\n    unsigned_oo/0\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: unsigned oo times smaller number not defined\nGot:\n      ...\n      File \"sage/structure/coerce.pyx\", line 798, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7153)\n        return PyObject_CallObject(op, xy)\n      File \"sage/structure/element.pyx\", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)\n        return (<RingElement>self)._div_(<RingElement>right)\n      File \"sage/structure/element.pyx\", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)\n        cpdef RingElement _div_(self, RingElement right):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 458, in _div_\n        return self * ~other\n      File \"sage/structure/element.pyx\", line 2073, in sage.structure.element.RingElement.__invert__ (build/cythonized/sage/structure/element.c:19009)\n        return self._parent.one() / self\n      File \"sage/structure/element.pyx\", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)\n        return (<RingElement>self)._div_(<RingElement>right)\n      File \"sage/structure/element.pyx\", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)\n        cpdef RingElement _div_(self, RingElement right):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 814, in _div_\n        raise ValueError(\"quotient of number < oo by number < oo not defined\")\n    ValueError: quotient of number < oo by number < oo not defined\n**********************************************************************\n```\n\n```\nsage -t --warn-long 30.1 src/sage/schemes/elliptic_curves/formal_group.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/formal_group.py\", line 431, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.inverse\nFailed example:\n    F = E.formal_group().group_law(6)\nException raised:\n    ...\n    TypeError: unsupported operand parent(s) for '*': 'Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Rational Field' and 'Multivariate Polynomial Ring in t1, t2 over Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Integer Ring'\n**********************************************************************\n```\n\n```\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/formal_group.py\", line 523, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.group_law\nFailed example:\n    F(t1, 0)\nExpected:\n    t1 + O(t1, t2)^5\nGot:\n    t1 + O(t1, t2)^7\n**********************************************************************\n```",
    "created_at": "2015-02-05T16:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238921",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:14" align="right">comment:14</div>

More doctest failures.

```
**********************************************************************
File "src/sage/rings/infinity.py", line 93, in sage.rings.infinity
Failed example:
    unsigned_oo/0
Expected:
    Traceback (most recent call last):
    ...
    ValueError: unsigned oo times smaller number not defined
Got:
      ...
      File "sage/structure/coerce.pyx", line 798, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7153)
        return PyObject_CallObject(op, xy)
      File "sage/structure/element.pyx", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)
        return (<RingElement>self)._div_(<RingElement>right)
      File "sage/structure/element.pyx", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)
        cpdef RingElement _div_(self, RingElement right):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 458, in _div_
        return self * ~other
      File "sage/structure/element.pyx", line 2073, in sage.structure.element.RingElement.__invert__ (build/cythonized/sage/structure/element.c:19009)
        return self._parent.one() / self
      File "sage/structure/element.pyx", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)
        return (<RingElement>self)._div_(<RingElement>right)
      File "sage/structure/element.pyx", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)
        cpdef RingElement _div_(self, RingElement right):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 814, in _div_
        raise ValueError("quotient of number < oo by number < oo not defined")
    ValueError: quotient of number < oo by number < oo not defined
**********************************************************************
```

```
sage -t --warn-long 30.1 src/sage/schemes/elliptic_curves/formal_group.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/formal_group.py", line 431, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.inverse
Failed example:
    F = E.formal_group().group_law(6)
Exception raised:
    ...
    TypeError: unsupported operand parent(s) for '*': 'Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Rational Field' and 'Multivariate Polynomial Ring in t1, t2 over Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Integer Ring'
**********************************************************************
```

```
**********************************************************************
File "src/sage/schemes/elliptic_curves/formal_group.py", line 523, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.group_law
Failed example:
    F(t1, 0)
Expected:
    t1 + O(t1, t2)^5
Got:
    t1 + O(t1, t2)^7
**********************************************************************
```



---

archive/issue_events_252106.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-05T16:15:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252106"
}
```



---

archive/issue_events_252107.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-05T16:15:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252107"
}
```



---

archive/issue_comments_238922.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHello,\n\nIndeed! The coercion with polynomial is to blame here... see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/3wduVqhoLWg). Several people fixed some issue locally (e.g. #7711). In order to go further, I need the coercion to be fixed. I will open a subsequent ticket if it is not yet here.\n\nVincent",
    "created_at": "2015-02-05T18:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238922",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

Hello,

Indeed! The coercion with polynomial is to blame here... see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/3wduVqhoLWg). Several people fixed some issue locally (e.g. #7711). In order to go further, I need the coercion to be fixed. I will open a subsequent ticket if it is not yet here.

Vincent



---

archive/issue_comments_238923.json:
```json
{
    "body": "Changed dependencies from **#17694** to **#17694, #17740, #17741**",
    "created_at": "2015-02-08T11:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238923",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#17694** to **#17694, #17740, #17741**



---

archive/issue_comments_238924.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI actually propose to close this as \"wontfix\" since we need to get rid of `__invert__` anyway.",
    "created_at": "2016-06-05T08:34:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238924",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

I actually propose to close this as "wontfix" since we need to get rid of `__invert__` anyway.



---

archive/issue_comments_238925.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWhy? Where?",
    "created_at": "2016-06-05T08:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238925",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Why? Where?



---

archive/issue_comments_238926.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWell, everywhere really because `__invert__` is supposed to return the bitwise inverse, not the mathematical inverse. It's the whole reason why I came up with the idea of a unary division.",
    "created_at": "2016-06-05T12:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238926",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Well, everywhere really because `__invert__` is supposed to return the bitwise inverse, not the mathematical inverse. It's the whole reason why I came up with the idea of a unary division.



---

archive/issue_events_252108.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-18T02:20:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252108"
}
```



---

archive/issue_events_252109.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-18T02:20:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/p%3A%205%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p: 5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252109"
}
```



---

archive/issue_events_252110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-18T02:20:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252110"
}
```



---

archive/issue_comments_238927.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nClosing suggested in [#17965 comment:57](https://github.com/sagemath/sage/issues/17965#comment:57)",
    "created_at": "2022-09-18T02:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238927",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Closing suggested in [#17965 comment:57](https://github.com/sagemath/sage/issues/17965#comment:57)



---

archive/issue_events_252111.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-18T02:20:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252111"
}
```



---

archive/issue_events_252112.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-18T02:20:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252112"
}
```



---

archive/issue_comments_238928.json:
```json
{
    "body": "Changed author from **Vincent Delecroix** to none",
    "created_at": "2022-09-18T02:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238928",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Vincent Delecroix** to none



---

archive/issue_comments_238929.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2022-09-18T02:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238929",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_238930.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nIndeed, this seems to have already been done elsewhere.\n\nThere are still a few instances where it does use coercion, but they are all look specific:\n\n```\ntravis@apricot:~/sage-build/src/sage/rings$ grep -R --include \\*.p\\* \"1 */ *self\" ../*\n../manifolds/chart_func.py:            # NB: self._express.__invert__() would return 1/self._express\n../manifolds/chart_func.py:                          expression=self._simplify(1 / self.expr()),\n../modular/overconvergent/weightspace.py:            return 1 / self.Lvalue()\n../modular/local_comp/smoothchar.py:        return self.character(0, [1/self.ideal(1).residue_field().cardinality()])\n../modular/btquotients/pautomorphicform.py:            A = data.parent()._Sigma0(Matrix(QQ,2,2,[0,1/self.prime(),1,0]),check=False)\n../modular/modform_hecketriangle/abstract_ring.py:                d = 1 / self.base_ring()(1/d)\n../modular/modform_hecketriangle/abstract_ring.py:            return   1/self._group.n() * (X*Z-Y) * dX\\\n../modular/modform_hecketriangle/abstract_ring.py:            return - 1/self._group.n() * Y*dX\\\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.x = 1/self.eval_scale.x\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.y = 1/self.eval_scale.y\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.z = 1/self.eval_scale.z\n../rings/qqbar.py:        1/self.\n../rings/qqbar.py:        1/self.\n../rings/qqbar.py:        1/self.\n../rings/function_field/order.py:        return 1/self.function_field().gen()\n../rings/function_field/order.py:        return self.ideal( 1/self.function_field().gen() )\n../rings/real_double_element_gsl.pyx:        return 1/self.cosh()\n../rings/real_double_element_gsl.pyx:        return 1/self.sinh()\n../rings/rational_field.py:        yield 1/self.an_element()\n../rings/rational_field.py:        yield -1/self.an_element()\n../rings/puiseux_series_ring_element.pyx:        # use x.nth_root since x**(1/self._e) returns oo when x = 0\nBinary file ../rings/__pycache__/qqbar.cpython-310.pyc matches\n../rings/padics/padic_lattice_element.py:        # dx = -(1/self^2)*dself\n../rings/padics/padic_extension_generic.py:    #    u = 1 / self(1 - q, prec)\n../schemes/riemann_surfaces/riemann_surface.py:                M_tilde = 2*max((m[i].abs())**(1/self._RR(l-i))\n../schemes/cyclic_covers/cycliccover_finite_field.py:        iD = 1 / self._Zq0(D.lift() / self._p)\n../schemes/cyclic_covers/cycliccover_finite_field.py:                    iD = 1 / self._Zq(D.lift() / self._p)\n../schemes/elliptic_curves/padic_lseries.py:                L *= (1-1/self.alpha())**2\n../schemes/elliptic_curves/ell_tate_curve.py:        qE = q_in_terms_of_jinv(R(1 / self._E.j_invariant()))\n../schemes/projective/projective_point.py:        self.scale_by(1/self[index])\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center())\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center(), RR(radius / (self._custom_abs(self.center())**2)))\n../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i]\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0])\n../schemes/berkovich/berkovich_cp_element.py:                return self.parent()(ZZ(0), 1 / self.radius())\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0], self.radius() / (self._custom_abs(self.center()[0])**2))\n../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i][0]\n../symbolic/expression.pyx:        return 1/self\n```",
    "created_at": "2022-09-18T02:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17692#issuecomment-238930",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

Indeed, this seems to have already been done elsewhere.

There are still a few instances where it does use coercion, but they are all look specific:

```
travis@apricot:~/sage-build/src/sage/rings$ grep -R --include \*.p\* "1 */ *self" ../*
../manifolds/chart_func.py:            # NB: self._express.__invert__() would return 1/self._express
../manifolds/chart_func.py:                          expression=self._simplify(1 / self.expr()),
../modular/overconvergent/weightspace.py:            return 1 / self.Lvalue()
../modular/local_comp/smoothchar.py:        return self.character(0, [1/self.ideal(1).residue_field().cardinality()])
../modular/btquotients/pautomorphicform.py:            A = data.parent()._Sigma0(Matrix(QQ,2,2,[0,1/self.prime(),1,0]),check=False)
../modular/modform_hecketriangle/abstract_ring.py:                d = 1 / self.base_ring()(1/d)
../modular/modform_hecketriangle/abstract_ring.py:            return   1/self._group.n() * (X*Z-Y) * dX\
../modular/modform_hecketriangle/abstract_ring.py:            return - 1/self._group.n() * Y*dX\
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.x = 1/self.eval_scale.x
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.y = 1/self.eval_scale.y
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.z = 1/self.eval_scale.z
../rings/qqbar.py:        1/self.
../rings/qqbar.py:        1/self.
../rings/qqbar.py:        1/self.
../rings/function_field/order.py:        return 1/self.function_field().gen()
../rings/function_field/order.py:        return self.ideal( 1/self.function_field().gen() )
../rings/real_double_element_gsl.pyx:        return 1/self.cosh()
../rings/real_double_element_gsl.pyx:        return 1/self.sinh()
../rings/rational_field.py:        yield 1/self.an_element()
../rings/rational_field.py:        yield -1/self.an_element()
../rings/puiseux_series_ring_element.pyx:        # use x.nth_root since x**(1/self._e) returns oo when x = 0
Binary file ../rings/__pycache__/qqbar.cpython-310.pyc matches
../rings/padics/padic_lattice_element.py:        # dx = -(1/self^2)*dself
../rings/padics/padic_extension_generic.py:    #    u = 1 / self(1 - q, prec)
../schemes/riemann_surfaces/riemann_surface.py:                M_tilde = 2*max((m[i].abs())**(1/self._RR(l-i))
../schemes/cyclic_covers/cycliccover_finite_field.py:        iD = 1 / self._Zq0(D.lift() / self._p)
../schemes/cyclic_covers/cycliccover_finite_field.py:                    iD = 1 / self._Zq(D.lift() / self._p)
../schemes/elliptic_curves/padic_lseries.py:                L *= (1-1/self.alpha())**2
../schemes/elliptic_curves/ell_tate_curve.py:        qE = q_in_terms_of_jinv(R(1 / self._E.j_invariant()))
../schemes/projective/projective_point.py:        self.scale_by(1/self[index])
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center())
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center(), RR(radius / (self._custom_abs(self.center())**2)))
../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i]
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0])
../schemes/berkovich/berkovich_cp_element.py:                return self.parent()(ZZ(0), 1 / self.radius())
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0], self.radius() / (self._custom_abs(self.center()[0])**2))
../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i][0]
../symbolic/expression.pyx:        return 1/self
```



---

archive/issue_events_252113.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-09-18T02:31:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252113"
}
```



---

archive/issue_events_252114.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-09-18T02:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252114"
}
```



---

archive/issue_events_252115.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252115"
}
```



---

archive/issue_events_252116.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17692",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17692#event-252116"
}
```
