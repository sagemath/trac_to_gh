# Issue 17019: Make sure preparser for .sage files respects module docstrings

archive/issues_016782.json:
```json
{
    "body": "Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n\nThere are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).\n\n**Keywords:** docstring, preparse\n\n**Branch:** [f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)\n\n**Reviewer:** Jeroen Demeyer, Volker Braun\n\n**Author:** Johan Sebastian Rosenkilde Nielsen\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17019\n\n",
    "closed_at": "2016-05-31T07:29:31Z",
    "created_at": "2014-09-20T19:16:12Z",
    "labels": [
        "component: misc",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make sure preparser for .sage files respects module docstrings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17019",
    "user": "https://github.com/johanrosenkilde"
}
```
Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.

There are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).

**Keywords:** docstring, preparse

**Branch:** [f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)

**Reviewer:** Jeroen Demeyer, Volker Braun

**Author:** Johan Sebastian Rosenkilde Nielsen

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/17019





---

archive/issue_comments_290260.json:
```json
{
    "body": "**Branch:** [u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)",
    "created_at": "2014-09-20T19:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290260",
    "user": "https://github.com/johanrosenkilde"
}
```

**Branch:** [u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)



---

archive/issue_comments_290261.json:
```json
{
    "body": "**Commit:** [9f82a15e2090509b66987a7e3705348dcfa05e0e](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)",
    "created_at": "2014-09-20T19:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290261",
    "user": "https://github.com/johanrosenkilde"
}
```

**Commit:** [9f82a15e2090509b66987a7e3705348dcfa05e0e](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)



---

archive/issue_comments_290262.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-09-20T19:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290262",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_290263.json:
```json
{
    "body": "<a id='comment:2'></a>\nSince the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9f97275846d8a6ad94ddec08f294f592f553bfb\">f9f9727</a></td><td><code>Simple change to sage-preparse to make sure the module docstring is put first</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e\">9f82a15</a></td><td><code>Merge w. atomic_write change from 6.3</code></td></tr></table>\n",
    "created_at": "2014-09-20T19:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290263",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:2'></a>
Since the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9f97275846d8a6ad94ddec08f294f592f553bfb">f9f9727</a></td><td><code>Simple change to sage-preparse to make sure the module docstring is put first</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e">9f82a15</a></td><td><code>Merge w. atomic_write change from 6.3</code></td></tr></table>




---

archive/issue_comments_290264.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-09-21T20:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290264",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_290265.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [jsrn](#comment%3A2):\n> Since the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).\n\nThere are doctest (even for `sage-preparse`) in `src/sage/tests/cmdline.py` and I think you should add a doctest for this (needs_work because of this).",
    "created_at": "2014-09-21T20:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290265",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Replying to [jsrn](#comment%3A2):
> Since the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).

There are doctest (even for `sage-preparse`) in `src/sage/tests/cmdline.py` and I think you should add a doctest for this (needs_work because of this).



---

archive/issue_comments_290266.json:
```json
{
    "body": "<a id='comment:4'></a>\nAlso, you don't need an additional\n\n```\nfrom sage.misc.preparser import preparse_file\n```",
    "created_at": "2014-09-21T20:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290266",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Also, you don't need an additional

```
from sage.misc.preparser import preparse_file
```



---

archive/issue_comments_290267.json:
```json
{
    "body": "**Changing commit** from \"[9f82a15e2090509b66987a7e3705348dcfa05e0e](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)\" to \"[df1d574405ea5f0f84a96bb85138862bafa9785e](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)\".",
    "created_at": "2014-09-22T09:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9f82a15e2090509b66987a7e3705348dcfa05e0e](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)" to "[df1d574405ea5f0f84a96bb85138862bafa9785e](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)".



---

archive/issue_comments_290268.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e\">df1d574</a></td><td><code>Added doctest. Rm unneccessary  import line</code></td></tr></table>\n",
    "created_at": "2014-09-22T09:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e">df1d574</a></td><td><code>Added doctest. Rm unneccessary  import line</code></td></tr></table>




---

archive/issue_comments_290269.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2014-09-22T09:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290269",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_290270.json:
```json
{
    "body": "<a id='comment:6'></a>\nOk, I've added a doctest for this.",
    "created_at": "2014-09-22T09:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290270",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:6'></a>
Ok, I've added a doctest for this.



---

archive/issue_comments_290271.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe Build-bot's doctests failing is in some numerical stability tests, and seem to have nothing to do with this patch.",
    "created_at": "2014-09-23T08:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290271",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:7'></a>
The Build-bot's doctests failing is in some numerical stability tests, and seem to have nothing to do with this patch.



---

archive/issue_comments_290272.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-09-25T11:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290272",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_290273.json:
```json
{
    "body": "<a id='comment:8'></a>\nSorry to bother again, but you should rebase this over #16955.",
    "created_at": "2014-09-25T11:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290273",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Sorry to bother again, but you should rebase this over #16955.



---

archive/issue_comments_290274.json:
```json
{
    "body": "<a id='comment:9'></a>\n...and instead of adding a completely new doctest, why not simply change the old test for `sage --preparse`?",
    "created_at": "2014-09-25T11:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290274",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
...and instead of adding a completely new doctest, why not simply change the old test for `sage --preparse`?



---

archive/issue_comments_290275.json:
```json
{
    "body": "<a id='comment:10'></a>\nYou removed support for `coding`.",
    "created_at": "2014-09-25T11:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290275",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
You removed support for `coding`.



---

archive/issue_comments_290276.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4004f1ffb0f6fa8eabd0f3d946305a73c0fe2942\">4004f1f</a></td><td><code>Merge branch 'u/jdemeyer/ticket/16827' of git://trac.sagemath.org/sage into ticket/16955</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17ad642b0f01e6411b2edf444ce53ea1813bacf3\">17ad642</a></td><td><code>Preparse file foo.sage to foo.sage.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/255b55edaa52f5ec53fa86cca9f8e154f75b29b1\">255b55e</a></td><td><code>Merge commit '17ad642b0f01e6411b2edf444ce53ea1813bacf3' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926\">bedc186</a></td><td><code>Fixed according to 16995</code></td></tr></table>\n",
    "created_at": "2014-09-25T12:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4004f1ffb0f6fa8eabd0f3d946305a73c0fe2942">4004f1f</a></td><td><code>Merge branch 'u/jdemeyer/ticket/16827' of git://trac.sagemath.org/sage into ticket/16955</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17ad642b0f01e6411b2edf444ce53ea1813bacf3">17ad642</a></td><td><code>Preparse file foo.sage to foo.sage.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/255b55edaa52f5ec53fa86cca9f8e154f75b29b1">255b55e</a></td><td><code>Merge commit '17ad642b0f01e6411b2edf444ce53ea1813bacf3' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926">bedc186</a></td><td><code>Fixed according to 16995</code></td></tr></table>




---

archive/issue_comments_290277.json:
```json
{
    "body": "**Changing commit** from \"[df1d574405ea5f0f84a96bb85138862bafa9785e](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)\" to \"[bedc186917b9f9719edf4f3de3cebd71d5aa1926](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)\".",
    "created_at": "2014-09-25T12:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[df1d574405ea5f0f84a96bb85138862bafa9785e](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)" to "[bedc186917b9f9719edf4f3de3cebd71d5aa1926](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)".



---

archive/issue_comments_290278.json:
```json
{
    "body": "<a id='comment:12'></a>\nI tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?\n\nI don't know what you mean with \"removed support for `coding`\".\n\nI added a new doctest instead of making the old one bigger because I didn't want the old one to be too large and confusing (as it is, it is hard to read). In the new doc-test is an `import inspect` and a strange line printing out the doc string.",
    "created_at": "2014-09-25T12:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290278",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:12'></a>
I tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?

I don't know what you mean with "removed support for `coding`".

I added a new doctest instead of making the old one bigger because I didn't want the old one to be too large and confusing (as it is, it is hard to read). In the new doc-test is an `import inspect` and a strange line printing out the doc string.



---

archive/issue_comments_290279.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jsrn](#comment%3A12):\n> I tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?\n\nI guess so, at least I don't see anything obviously bad.\n\n> \n> I don't know what you mean with \"removed support for `coding`\".\n\ngrep `src/bin/sage-preparse` for `coding` and you will see what I mean.",
    "created_at": "2014-09-25T12:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290279",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [jsrn](#comment%3A12):
> I tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?

I guess so, at least I don't see anything obviously bad.

> 
> I don't know what you mean with "removed support for `coding`".

grep `src/bin/sage-preparse` for `coding` and you will see what I mean.



---

archive/issue_comments_290280.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf\">88eee97</a></td><td><code>Write out the coding line</code></td></tr></table>\n",
    "created_at": "2014-09-25T12:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf">88eee97</a></td><td><code>Write out the coding line</code></td></tr></table>




---

archive/issue_comments_290281.json:
```json
{
    "body": "**Changing commit** from \"[bedc186917b9f9719edf4f3de3cebd71d5aa1926](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)\" to \"[88eee97d19a281d4ff00d0a8eba0992ce989f4bf](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)\".",
    "created_at": "2014-09-25T12:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bedc186917b9f9719edf4f3de3cebd71d5aa1926](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)" to "[88eee97d19a281d4ff00d0a8eba0992ce989f4bf](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)".



---

archive/issue_comments_290282.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784\">04bc257</a></td><td><code>Also test coding is preserved, and coalesce into one simpler test for --preparse</code></td></tr></table>\n",
    "created_at": "2014-09-25T12:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784">04bc257</a></td><td><code>Also test coding is preserved, and coalesce into one simpler test for --preparse</code></td></tr></table>




---

archive/issue_comments_290283.json:
```json
{
    "body": "**Changing commit** from \"[88eee97d19a281d4ff00d0a8eba0992ce989f4bf](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)\" to \"[04bc257623d0c78d1799372c0e4351292c6fc784](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)\".",
    "created_at": "2014-09-25T12:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[88eee97d19a281d4ff00d0a8eba0992ce989f4bf](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)" to "[04bc257623d0c78d1799372c0e4351292c6fc784](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)".



---

archive/issue_comments_290284.json:
```json
{
    "body": "<a id='comment:16'></a>\nGood catch with the coding line. I reinstated it, and added it to the doctest.\n\nI also simplified the doctest and simply examine the produced file directly instead of doing strange reflection stuff.",
    "created_at": "2014-09-25T12:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290284",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:16'></a>
Good catch with the coding line. I reinstated it, and added it to the doctest.

I also simplified the doctest and simply examine the produced file directly instead of doing strange reflection stuff.



---

archive/issue_comments_290285.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2014-09-25T12:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290285",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_290286.json:
```json
{
    "body": "**Changing branch** from \"[u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)\" to \"[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)\".",
    "created_at": "2014-10-07T12:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290286",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)" to "[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)".



---

archive/issue_comments_290287.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386\">86350b3</a></td><td><code>Fix doctest formatting</code></td></tr></table>\n",
    "created_at": "2014-10-07T12:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386">86350b3</a></td><td><code>Fix doctest formatting</code></td></tr></table>




---

archive/issue_comments_290288.json:
```json
{
    "body": "**Changing commit** from \"[04bc257623d0c78d1799372c0e4351292c6fc784](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)\" to \"[86350b34b6c40240becb3a4adfc9025fbaba4386](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)\".",
    "created_at": "2014-10-07T12:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[04bc257623d0c78d1799372c0e4351292c6fc784](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)" to "[86350b34b6c40240becb3a4adfc9025fbaba4386](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)".



---

archive/issue_comments_290289.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-10-07T12:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290289",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_290290.json:
```json
{
    "body": "<a id='comment:19'></a>\nI think the doctest is not good enough, since it passes even *without the changes* to `sage-preparse`. If you want to convince me that this ticket is needed, show me a doctest which failed before and passes now.",
    "created_at": "2014-10-07T12:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290290",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
I think the doctest is not good enough, since it passes even *without the changes* to `sage-preparse`. If you want to convince me that this ticket is needed, show me a doctest which failed before and passes now.



---

archive/issue_comments_290291.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2014-10-07T12:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290291",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_290292.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)\" to \"[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)\".",
    "created_at": "2014-10-08T08:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290292",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing branch** from "[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)" to "[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)".



---

archive/issue_comments_290293.json:
```json
{
    "body": "<a id='comment:21'></a>\nNo need to get snappy -- obviously the problem was there or I wouldn't waste my time on this. It seems, however, that somewhere between 6.2 and 6.3 the generation of the `_sage_const_`X lines were moved, and this presents an alternative solution to the problem (those lines were previously put before the module doc-string).\n\nNow for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment. The doc-test changes could be retained since it actually tests something which was not tested before. The latest test that you saw was however rather silly, since I forgot to reinstate a constant in the code after I merged the two doctests into one. I've fixed the doc test...",
    "created_at": "2014-10-08T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290293",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:21'></a>
No need to get snappy -- obviously the problem was there or I wouldn't waste my time on this. It seems, however, that somewhere between 6.2 and 6.3 the generation of the `_sage_const_`X lines were moved, and this presents an alternative solution to the problem (those lines were previously put before the module doc-string).

Now for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment. The doc-test changes could be retained since it actually tests something which was not tested before. The latest test that you saw was however rather silly, since I forgot to reinstate a constant in the code after I merged the two doctests into one. I've fixed the doc test...



---

archive/issue_comments_290294.json:
```json
{
    "body": "**Changing branch** from \"[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)\" to \"[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)\".",
    "created_at": "2014-10-08T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290294",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing branch** from "[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)" to "[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)".



---

archive/issue_comments_290295.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2014-10-08T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290295",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_290296.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [jsrn](#comment%3A21):\n> Now for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment.\n\nI didn't say the changes were bad, in fact I do think they make sense. I only said that I could not check whether they solved the problem mentioned in this ticket.",
    "created_at": "2014-10-08T09:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290296",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [jsrn](#comment%3A21):
> Now for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment.

I didn't say the changes were bad, in fact I do think they make sense. I only said that I could not check whether they solved the problem mentioned in this ticket.



---

archive/issue_comments_290297.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jsrn](#comment%3A21):\n> I've fixed the doc test...\n\nThen please push your branch...\n\nAlso: can you update the ticket description please, since the problem is no longer applicable.",
    "created_at": "2014-10-08T09:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290297",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [jsrn](#comment%3A21):
> I've fixed the doc test...

Then please push your branch...

Also: can you update the ticket description please, since the problem is no longer applicable.



---

archive/issue_comments_290298.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)\" to \"[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)\".",
    "created_at": "2014-10-08T09:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290298",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing branch** from "[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)" to "[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)".



---

archive/issue_events_056339.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "rename": {
        "from": "preparser for .sage files no longer respects module docstrings",
        "to": "Make sure preparser for .sage files respects module docstrings"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17019#event-56339"
}
```



---

archive/issue_comments_290299.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n \n-There are some lines to handle this in sage-preparse. However, it is not handled properly, as a call to sage.misc.preparse.preparse_file earlier on might already then add some lines before the original docstring.\n+There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).\n``````\n",
    "created_at": "2014-10-08T09:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290299",
    "user": "https://github.com/johanrosenkilde"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.
 
-There are some lines to handle this in sage-preparse. However, it is not handled properly, as a call to sage.misc.preparse.preparse_file earlier on might already then add some lines before the original docstring.
+There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).
``````




---

archive/issue_comments_290300.json:
```json
{
    "body": "**Changing commit** from \"[86350b34b6c40240becb3a4adfc9025fbaba4386](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)\" to \"[6d8a3303e88859a78a3809d7dc12bcff4306440f](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)\".",
    "created_at": "2014-10-08T09:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290300",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing commit** from "[86350b34b6c40240becb3a4adfc9025fbaba4386](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)" to "[6d8a3303e88859a78a3809d7dc12bcff4306440f](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)".



---

archive/issue_comments_290301.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2014-10-08T09:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290301",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_290302.json:
```json
{
    "body": "<a id='comment:25'></a>\nI'm sorry but I'm completely lost in these branches. I'm working on branch t/17019/ticket/17019 but if I try to push with **git push trac t/17019/ticket/17019**, I get the following error\n\n```\nTotal 0 (delta 0), reused 0 (delta 0)\nremote: FATAL: W refs/heads/t/17019/ticket/17019 sage jsrn DENIED by fallthru\nremote: error: hook declined to update refs/heads/t/17019/ticket/17019\nTo git@trac.sagemath.org:sage.git\n ! [remote rejected] t/17019/ticket/17019 -> t/17019/ticket/17019 (hook declined)\nerror: failed to push some refs to 'git@trac.sagemath.org:sage.git'\n```\n\nIf I try to push with **git trac push**, it works fine but pushes to **u/jsrn/ticket/17019**, which doesn't seem to put my code into this ticket (but it does add the message \"Branch changed from bla-bla-bla\" which appears twice above).\n\nWhat do I do?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f\">6d8a330</a></td><td><code>Put a constant in the test</code></td></tr></table>\n",
    "created_at": "2014-10-08T09:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290302",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:25'></a>
I'm sorry but I'm completely lost in these branches. I'm working on branch t/17019/ticket/17019 but if I try to push with **git push trac t/17019/ticket/17019**, I get the following error

```
Total 0 (delta 0), reused 0 (delta 0)
remote: FATAL: W refs/heads/t/17019/ticket/17019 sage jsrn DENIED by fallthru
remote: error: hook declined to update refs/heads/t/17019/ticket/17019
To git@trac.sagemath.org:sage.git
 ! [remote rejected] t/17019/ticket/17019 -> t/17019/ticket/17019 (hook declined)
error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
```

If I try to push with **git trac push**, it works fine but pushes to **u/jsrn/ticket/17019**, which doesn't seem to put my code into this ticket (but it does add the message "Branch changed from bla-bla-bla" which appears twice above).

What do I do?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f">6d8a330</a></td><td><code>Put a constant in the test</code></td></tr></table>




---

archive/issue_comments_290303.json:
```json
{
    "body": "<a id='comment:26'></a>\nOk, now I'm really confused: with 6 minutes delay the commit came through??? Did I do it right or was I just lucky and abusive towards the system?",
    "created_at": "2014-10-08T09:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290303",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:26'></a>
Ok, now I'm really confused: with 6 minutes delay the commit came through??? Did I do it right or was I just lucky and abusive towards the system?



---

archive/issue_comments_290304.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/baec18cd4876ebec6034e62316224384a32b3cae\">baec18c</a></td><td><code>Merge branch 'u/jsrn/ticket/17019' of git://trac.sagemath.org/sage into 17019_preparser_docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa\">f21f386</a></td><td><code>upd fix date</code></td></tr></table>\n",
    "created_at": "2015-11-06T15:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/baec18cd4876ebec6034e62316224384a32b3cae">baec18c</a></td><td><code>Merge branch 'u/jsrn/ticket/17019' of git://trac.sagemath.org/sage into 17019_preparser_docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa">f21f386</a></td><td><code>upd fix date</code></td></tr></table>




---

archive/issue_comments_290305.json:
```json
{
    "body": "**Changing commit** from \"[6d8a3303e88859a78a3809d7dc12bcff4306440f](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)\" to \"[f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)\".",
    "created_at": "2015-11-06T15:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6d8a3303e88859a78a3809d7dc12bcff4306440f](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)" to "[f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)".



---

archive/issue_comments_290306.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-11-06T15:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290306",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_290307.json:
```json
{
    "body": "<a id='comment:28'></a>\nI'm reviving this: Sage has displayed the doc-mangling behaviour after preprocessing in more or less all releases since this ticket was last discussed, possibly except the one Jeroen tested on a year ago. I don't know why that was.\n\nAt least, I've just tested that the doctest in this ticket fails if it's tested on the current beta, and that this patch fixes it.",
    "created_at": "2015-11-06T15:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290307",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:28'></a>
I'm reviving this: Sage has displayed the doc-mangling behaviour after preprocessing in more or less all releases since this ticket was last discussed, possibly except the one Jeroen tested on a year ago. I don't know why that was.

At least, I've just tested that the doctest in this ticket fails if it's tested on the current beta, and that this patch fixes it.



---

archive/issue_comments_290308.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n+Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n \n-There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).\n+There are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).\n``````\n",
    "created_at": "2015-11-06T15:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290308",
    "user": "https://github.com/johanrosenkilde"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.
+Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.
 
-There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).
+There are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).
``````




---

archive/issue_comments_290309.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Volker Braun\".",
    "created_at": "2016-05-30T09:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290309",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Volker Braun".



---

archive/issue_comments_290310.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-05-30T09:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290310",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_290311.json:
```json
{
    "body": "<a id='comment:30'></a>\nNecro-review -- thanks! :-)",
    "created_at": "2016-05-30T09:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290311",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:30'></a>
Necro-review -- thanks! :-)



---

archive/issue_comments_290312.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-05-31T07:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290312",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_290313.json:
```json
{
    "body": "**Changing branch** from \"[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)\" to \"[f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)\".",
    "created_at": "2016-05-31T07:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290313",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)" to "[f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)".



---

archive/issue_events_056340.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-31T07:29:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17019#event-56340"
}
```



---

archive/issue_comments_290314.json:
```json
{
    "body": "**Changing commit** from \"[f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)\" to \"\".",
    "created_at": "2016-08-07T20:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290314",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[f21f3862591b3de7968f8d552f641f02ab8f28fa](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)" to "".



---

archive/issue_comments_290315.json:
```json
{
    "body": "**Changing author** from \"Johan S. R. Nielsen\" to \"Johan Sebastian Rosenkilde Nielsen\".",
    "created_at": "2016-08-07T20:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17019#issuecomment-290315",
    "user": "https://github.com/fchapoton"
}
```

**Changing author** from "Johan S. R. Nielsen" to "Johan Sebastian Rosenkilde Nielsen".
