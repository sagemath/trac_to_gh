# Issue 17019: Make sure preparser for .sage files respects module docstrings

archive/issues_016782.json:
```json
{
    "assignees": [],
    "body": "Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n\nThere are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).\n\nKeywords: **preparse**\n\nBranch: **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)**\n\nReviewer: **Jeroen Demeyer, Volker Braun**\n\nAuthor: **Johan Sebastian Rosenkilde Nielsen**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17019_\n\n",
    "closed_at": "2016-05-31T07:29:31Z",
    "created_at": "2014-09-20T19:16:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20documentation"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make sure preparser for .sage files respects module docstrings",
    "type": "issue",
    "updated_at": "2016-08-07T20:07:15Z",
    "url": "https://github.com/sagemath/sage/issues/17019",
    "user": "https://github.com/johanrosenkilde"
}
```
Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.

There are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).

Keywords: **preparse**

Branch: **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)**

Reviewer: **Jeroen Demeyer, Volker Braun**

Author: **Johan Sebastian Rosenkilde Nielsen**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/17019_





---

archive/issue_events_240980.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-20T19:16:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240980"
}
```



---

archive/issue_events_240981.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-20T19:16:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240981"
}
```



---

archive/issue_events_240982.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-20T19:16:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240982"
}
```



---

archive/issue_events_240983.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-20T19:16:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240983"
}
```



---

archive/issue_comments_225039.json:
```json
{
    "body": "Branch: **[u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)**",
    "created_at": "2014-09-20T19:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225039",
    "user": "https://github.com/johanrosenkilde"
}
```

Branch: **[u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)**



---

archive/issue_comments_225040.json:
```json
{
    "body": "Commit: **[`9f82a15`](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)**",
    "created_at": "2014-09-20T19:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225040",
    "user": "https://github.com/johanrosenkilde"
}
```

Commit: **[`9f82a15`](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)**



---

archive/issue_events_240984.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-20T19:43:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240984"
}
```



---

archive/issue_comments_225041.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSince the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9f97275846d8a6ad94ddec08f294f592f553bfb\"><code>f9f9727</code></a></td><td><code>Simple change to sage-preparse to make sure the module docstring is put first</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e\"><code>9f82a15</code></a></td><td><code>Merge w. atomic_write change from 6.3</code></td></tr></table>\n",
    "created_at": "2014-09-20T19:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225041",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:2" align="right">comment:2</div>

Since the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9f97275846d8a6ad94ddec08f294f592f553bfb"><code>f9f9727</code></a></td><td><code>Simple change to sage-preparse to make sure the module docstring is put first</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e"><code>9f82a15</code></a></td><td><code>Merge w. atomic_write change from 6.3</code></td></tr></table>




---

archive/issue_events_240985.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-21T20:43:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240985"
}
```



---

archive/issue_events_240986.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-21T20:43:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240986"
}
```



---

archive/issue_comments_225042.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@johanrosenkilde](#comment%3A2):\n> Since the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).\n\nThere are doctest (even for `sage-preparse`) in `src/sage/tests/cmdline.py` and I think you should add a doctest for this (needs_work because of this).",
    "created_at": "2014-09-21T20:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225042",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@johanrosenkilde](#comment%3A2):
> Since the patch is on a python file outside the usual Sage tree, I am not aware of doc-test rules etc. I wouldn't even know how to make a doctest for this (and there are no other doctests in sage-preparse).

There are doctest (even for `sage-preparse`) in `src/sage/tests/cmdline.py` and I think you should add a doctest for this (needs_work because of this).



---

archive/issue_comments_225043.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAlso, you don't need an additional\n\n```\nfrom sage.misc.preparser import preparse_file\n```",
    "created_at": "2014-09-21T20:44:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225043",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Also, you don't need an additional

```
from sage.misc.preparser import preparse_file
```



---

archive/issue_comments_225044.json:
```json
{
    "body": "Changed commit from **[`9f82a15`](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)** to **[`df1d574`](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)**",
    "created_at": "2014-09-22T09:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225044",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9f82a15`](https://github.com/sagemath/sagetrac-mirror/commit/9f82a15e2090509b66987a7e3705348dcfa05e0e)** to **[`df1d574`](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)**



---

archive/issue_comments_225045.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e\"><code>df1d574</code></a></td><td><code>Added doctest. Rm unneccessary  import line</code></td></tr></table>\n",
    "created_at": "2014-09-22T09:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225045",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e"><code>df1d574</code></a></td><td><code>Added doctest. Rm unneccessary  import line</code></td></tr></table>




---

archive/issue_events_240987.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-22T09:46:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240987"
}
```



---

archive/issue_events_240988.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-22T09:46:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240988"
}
```



---

archive/issue_comments_225046.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOk, I've added a doctest for this.",
    "created_at": "2014-09-22T09:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225046",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:6" align="right">comment:6</div>

Ok, I've added a doctest for this.



---

archive/issue_comments_225047.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe Build-bot's doctests failing is in some numerical stability tests, and seem to have nothing to do with this patch.",
    "created_at": "2014-09-23T08:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225047",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:7" align="right">comment:7</div>

The Build-bot's doctests failing is in some numerical stability tests, and seem to have nothing to do with this patch.



---

archive/issue_events_240989.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-25T11:20:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240989"
}
```



---

archive/issue_events_240990.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-25T11:20:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240990"
}
```



---

archive/issue_comments_225048.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSorry to bother again, but you should rebase this over #16955.",
    "created_at": "2014-09-25T11:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225048",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Sorry to bother again, but you should rebase this over #16955.



---

archive/issue_comments_225049.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n...and instead of adding a completely new doctest, why not simply change the old test for `sage --preparse`?",
    "created_at": "2014-09-25T11:30:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225049",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

...and instead of adding a completely new doctest, why not simply change the old test for `sage --preparse`?



---

archive/issue_comments_225050.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYou removed support for `coding`.",
    "created_at": "2014-09-25T11:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225050",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

You removed support for `coding`.



---

archive/issue_comments_225051.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4004f1ffb0f6fa8eabd0f3d946305a73c0fe2942\"><code>4004f1f</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/16827' of git://trac.sagemath.org/sage into ticket/16955</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17ad642b0f01e6411b2edf444ce53ea1813bacf3\"><code>17ad642</code></a></td><td><code>Preparse file foo.sage to foo.sage.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/255b55edaa52f5ec53fa86cca9f8e154f75b29b1\"><code>255b55e</code></a></td><td><code>Merge commit '17ad642b0f01e6411b2edf444ce53ea1813bacf3' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926\"><code>bedc186</code></a></td><td><code>Fixed according to 16995</code></td></tr></table>\n",
    "created_at": "2014-09-25T12:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225051",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4004f1ffb0f6fa8eabd0f3d946305a73c0fe2942"><code>4004f1f</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/16827' of git://trac.sagemath.org/sage into ticket/16955</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17ad642b0f01e6411b2edf444ce53ea1813bacf3"><code>17ad642</code></a></td><td><code>Preparse file foo.sage to foo.sage.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/255b55edaa52f5ec53fa86cca9f8e154f75b29b1"><code>255b55e</code></a></td><td><code>Merge commit '17ad642b0f01e6411b2edf444ce53ea1813bacf3' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926"><code>bedc186</code></a></td><td><code>Fixed according to 16995</code></td></tr></table>




---

archive/issue_comments_225052.json:
```json
{
    "body": "Changed commit from **[`df1d574`](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)** to **[`bedc186`](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)**",
    "created_at": "2014-09-25T12:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225052",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`df1d574`](https://github.com/sagemath/sagetrac-mirror/commit/df1d574405ea5f0f84a96bb85138862bafa9785e)** to **[`bedc186`](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)**



---

archive/issue_comments_225053.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?\n\nI don't know what you mean with \"removed support for `coding`\".\n\nI added a new doctest instead of making the old one bigger because I didn't want the old one to be too large and confusing (as it is, it is hard to read). In the new doc-test is an `import inspect` and a strange line printing out the doc string.",
    "created_at": "2014-09-25T12:08:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225053",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:12" align="right">comment:12</div>

I tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?

I don't know what you mean with "removed support for `coding`".

I added a new doctest instead of making the old one bigger because I didn't want the old one to be too large and confusing (as it is, it is hard to read). In the new doc-test is an `import inspect` and a strange line printing out the doc string.



---

archive/issue_comments_225054.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@johanrosenkilde](#comment%3A12):\n> I tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?\n\nI guess so, at least I don't see anything obviously bad.\n\n> \n> I don't know what you mean with \"removed support for `coding`\".\n\ngrep `src/bin/sage-preparse` for `coding` and you will see what I mean.",
    "created_at": "2014-09-25T12:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225054",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@johanrosenkilde](#comment%3A12):
> I tried to do the rebase, but the instructions in the documentation were not clear to me on this use-case. Did I do it right?

I guess so, at least I don't see anything obviously bad.

> 
> I don't know what you mean with "removed support for `coding`".

grep `src/bin/sage-preparse` for `coding` and you will see what I mean.



---

archive/issue_comments_225055.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf\"><code>88eee97</code></a></td><td><code>Write out the coding line</code></td></tr></table>\n",
    "created_at": "2014-09-25T12:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225055",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf"><code>88eee97</code></a></td><td><code>Write out the coding line</code></td></tr></table>




---

archive/issue_comments_225056.json:
```json
{
    "body": "Changed commit from **[`bedc186`](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)** to **[`88eee97`](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)**",
    "created_at": "2014-09-25T12:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225056",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bedc186`](https://github.com/sagemath/sagetrac-mirror/commit/bedc186917b9f9719edf4f3de3cebd71d5aa1926)** to **[`88eee97`](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)**



---

archive/issue_comments_225057.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784\"><code>04bc257</code></a></td><td><code>Also test coding is preserved, and coalesce into one simpler test for --preparse</code></td></tr></table>\n",
    "created_at": "2014-09-25T12:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225057",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784"><code>04bc257</code></a></td><td><code>Also test coding is preserved, and coalesce into one simpler test for --preparse</code></td></tr></table>




---

archive/issue_comments_225058.json:
```json
{
    "body": "Changed commit from **[`88eee97`](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)** to **[`04bc257`](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)**",
    "created_at": "2014-09-25T12:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225058",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`88eee97`](https://github.com/sagemath/sagetrac-mirror/commit/88eee97d19a281d4ff00d0a8eba0992ce989f4bf)** to **[`04bc257`](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)**



---

archive/issue_comments_225059.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nGood catch with the coding line. I reinstated it, and added it to the doctest.\n\nI also simplified the doctest and simply examine the produced file directly instead of doing strange reflection stuff.",
    "created_at": "2014-09-25T12:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225059",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:16" align="right">comment:16</div>

Good catch with the coding line. I reinstated it, and added it to the doctest.

I also simplified the doctest and simply examine the produced file directly instead of doing strange reflection stuff.



---

archive/issue_events_240991.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-25T12:36:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240991"
}
```



---

archive/issue_events_240992.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-09-25T12:36:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240992"
}
```



---

archive/issue_comments_225060.json:
```json
{
    "body": "Changed branch from **[u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)** to **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)**",
    "created_at": "2014-10-07T12:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225060",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/preparser_for__sage_files_no_longer_respects_module_docstrings)** to **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)**



---

archive/issue_comments_225061.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386\"><code>86350b3</code></a></td><td><code>Fix doctest formatting</code></td></tr></table>\n",
    "created_at": "2014-10-07T12:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225061",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386"><code>86350b3</code></a></td><td><code>Fix doctest formatting</code></td></tr></table>




---

archive/issue_comments_225062.json:
```json
{
    "body": "Changed commit from **[`04bc257`](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)** to **[`86350b3`](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)**",
    "created_at": "2014-10-07T12:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225062",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`04bc257`](https://github.com/sagemath/sagetrac-mirror/commit/04bc257623d0c78d1799372c0e4351292c6fc784)** to **[`86350b3`](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)**



---

archive/issue_events_240993.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-07T12:47:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240993"
}
```



---

archive/issue_events_240994.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-10-07T12:47:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240994"
}
```



---

archive/issue_comments_225063.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI think the doctest is not good enough, since it passes even *without the changes* to `sage-preparse`. If you want to convince me that this ticket is needed, show me a doctest which failed before and passes now.",
    "created_at": "2014-10-07T12:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225063",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I think the doctest is not good enough, since it passes even *without the changes* to `sage-preparse`. If you want to convince me that this ticket is needed, show me a doctest which failed before and passes now.



---

archive/issue_comments_225064.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2014-10-07T12:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225064",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_225065.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)** to **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)**",
    "created_at": "2014-10-08T08:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225065",
    "user": "https://github.com/johanrosenkilde"
}
```

Changed branch from **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)** to **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)**



---

archive/issue_comments_225066.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNo need to get snappy -- obviously the problem was there or I wouldn't waste my time on this. It seems, however, that somewhere between 6.2 and 6.3 the generation of the _sage_const_X lines were moved, and this presents an alternative solution to the problem (those lines were previously put before the module doc-string).\n\nNow for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment. The doc-test changes could be retained since it actually tests something which was not tested before. The latest test that you saw was however rather silly, since I forgot to reinstate a constant in the code after I merged the two doctests into one. I've fixed the doc test...",
    "created_at": "2014-10-08T08:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225066",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:21" align="right">comment:21</div>

No need to get snappy -- obviously the problem was there or I wouldn't waste my time on this. It seems, however, that somewhere between 6.2 and 6.3 the generation of the _sage_const_X lines were moved, and this presents an alternative solution to the problem (those lines were previously put before the module doc-string).

Now for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment. The doc-test changes could be retained since it actually tests something which was not tested before. The latest test that you saw was however rather silly, since I forgot to reinstate a constant in the code after I merged the two doctests into one. I've fixed the doc test...



---

archive/issue_comments_225067.json:
```json
{
    "body": "Changed branch from **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)** to **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)**",
    "created_at": "2014-10-08T08:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225067",
    "user": "https://github.com/johanrosenkilde"
}
```

Changed branch from **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)** to **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)**



---

archive/issue_events_240995.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T08:58:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240995"
}
```



---

archive/issue_events_240996.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T08:58:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240996"
}
```



---

archive/issue_comments_225068.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@johanrosenkilde](#comment%3A21):\n> Now for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment.\n\nI didn't say the changes were bad, in fact I do think they make sense. I only said that I could not check whether they solved the problem mentioned in this ticket.",
    "created_at": "2014-10-08T09:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225068",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@johanrosenkilde](#comment%3A21):
> Now for this ticket: the change in sage-preparse could be rolled back since it is not necessary for the moment.

I didn't say the changes were bad, in fact I do think they make sense. I only said that I could not check whether they solved the problem mentioned in this ticket.



---

archive/issue_comments_225069.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@johanrosenkilde](#comment%3A21):\n> I've fixed the doc test...\n\nThen please push your branch...\n\nAlso: can you update the ticket description please, since the problem is no longer applicable.",
    "created_at": "2014-10-08T09:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225069",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@johanrosenkilde](#comment%3A21):
> I've fixed the doc test...

Then please push your branch...

Also: can you update the ticket description please, since the problem is no longer applicable.



---

archive/issue_comments_225070.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)** to **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)**",
    "created_at": "2014-10-08T09:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225070",
    "user": "https://github.com/johanrosenkilde"
}
```

Changed branch from **[u/jdemeyer/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17019)** to **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)**



---

archive/issue_events_240997.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T09:53:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "title_is": "Make sure preparser for .sage files respects module docstrings",
    "title_was": "preparser for .sage files no longer respects module docstrings",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240997"
}
```



---

archive/issue_comments_225071.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n \n-There are some lines to handle this in sage-preparse. However, it is not handled properly, as a call to sage.misc.preparse.preparse_file earlier on might already then add some lines before the original docstring.\n+There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).\n``````\n",
    "created_at": "2014-10-08T09:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225071",
    "user": "https://github.com/johanrosenkilde"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.
 
-There are some lines to handle this in sage-preparse. However, it is not handled properly, as a call to sage.misc.preparse.preparse_file earlier on might already then add some lines before the original docstring.
+There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).
``````




---

archive/issue_comments_225072.json:
```json
{
    "body": "Changed commit from **[`86350b3`](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)** to **[`6d8a330`](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)**",
    "created_at": "2014-10-08T09:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225072",
    "user": "https://github.com/johanrosenkilde"
}
```

Changed commit from **[`86350b3`](https://github.com/sagemath/sagetrac-mirror/commit/86350b34b6c40240becb3a4adfc9025fbaba4386)** to **[`6d8a330`](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)**



---

archive/issue_events_240998.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T09:53:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240998"
}
```



---

archive/issue_events_240999.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T09:53:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-240999"
}
```



---

archive/issue_events_241000.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T09:53:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241000"
}
```



---

archive/issue_events_241001.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2014-10-08T09:53:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241001"
}
```



---

archive/issue_comments_225073.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI'm sorry but I'm completely lost in these branches. I'm working on branch t/17019/ticket/17019 but if I try to push with **git push trac t/17019/ticket/17019**, I get the following error\n\n```\nTotal 0 (delta 0), reused 0 (delta 0)\nremote: FATAL: W refs/heads/t/17019/ticket/17019 sage jsrn DENIED by fallthru\nremote: error: hook declined to update refs/heads/t/17019/ticket/17019\nTo git@trac.sagemath.org:sage.git\n ! [remote rejected] t/17019/ticket/17019 -> t/17019/ticket/17019 (hook declined)\nerror: failed to push some refs to 'git@trac.sagemath.org:sage.git'\n```\n\nIf I try to push with **git trac push**, it works fine but pushes to **u/jsrn/ticket/17019**, which doesn't seem to put my code into this ticket (but it does add the message \"Branch changed from bla-bla-bla\" which appears twice above).\n\nWhat do I do?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f\"><code>6d8a330</code></a></td><td><code>Put a constant in the test</code></td></tr></table>\n",
    "created_at": "2014-10-08T09:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225073",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:25" align="right">comment:25</div>

I'm sorry but I'm completely lost in these branches. I'm working on branch t/17019/ticket/17019 but if I try to push with **git push trac t/17019/ticket/17019**, I get the following error

```
Total 0 (delta 0), reused 0 (delta 0)
remote: FATAL: W refs/heads/t/17019/ticket/17019 sage jsrn DENIED by fallthru
remote: error: hook declined to update refs/heads/t/17019/ticket/17019
To git@trac.sagemath.org:sage.git
 ! [remote rejected] t/17019/ticket/17019 -> t/17019/ticket/17019 (hook declined)
error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
```

If I try to push with **git trac push**, it works fine but pushes to **u/jsrn/ticket/17019**, which doesn't seem to put my code into this ticket (but it does add the message "Branch changed from bla-bla-bla" which appears twice above).

What do I do?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f"><code>6d8a330</code></a></td><td><code>Put a constant in the test</code></td></tr></table>




---

archive/issue_comments_225074.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOk, now I'm really confused: with 6 minutes delay the commit came through??? Did I do it right or was I just lucky and abusive towards the system?",
    "created_at": "2014-10-08T09:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225074",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:26" align="right">comment:26</div>

Ok, now I'm really confused: with 6 minutes delay the commit came through??? Did I do it right or was I just lucky and abusive towards the system?



---

archive/issue_comments_225075.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/baec18cd4876ebec6034e62316224384a32b3cae\"><code>baec18c</code></a></td><td><code>Merge branch 'u/jsrn/ticket/17019' of git://trac.sagemath.org/sage into 17019_preparser_docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa\"><code>f21f386</code></a></td><td><code>upd fix date</code></td></tr></table>\n",
    "created_at": "2015-11-06T15:00:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225075",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/baec18cd4876ebec6034e62316224384a32b3cae"><code>baec18c</code></a></td><td><code>Merge branch 'u/jsrn/ticket/17019' of git://trac.sagemath.org/sage into 17019_preparser_docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa"><code>f21f386</code></a></td><td><code>upd fix date</code></td></tr></table>




---

archive/issue_comments_225076.json:
```json
{
    "body": "Changed commit from **[`6d8a330`](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)** to **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)**",
    "created_at": "2015-11-06T15:00:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225076",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d8a330`](https://github.com/sagemath/sagetrac-mirror/commit/6d8a3303e88859a78a3809d7dc12bcff4306440f)** to **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)**



---

archive/issue_events_241002.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2015-11-06T15:04:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241002"
}
```



---

archive/issue_events_241003.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2015-11-06T15:04:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241003"
}
```



---

archive/issue_comments_225077.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI'm reviving this: Sage has displayed the doc-mangling behaviour after preprocessing in more or less all releases since this ticket was last discussed, possibly except the one Jeroen tested on a year ago. I don't know why that was.\n\nAt least, I've just tested that the doctest in this ticket fails if it's tested on the current beta, and that this patch fixes it.",
    "created_at": "2015-11-06T15:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225077",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:28" align="right">comment:28</div>

I'm reviving this: Sage has displayed the doc-mangling behaviour after preprocessing in more or less all releases since this ticket was last discussed, possibly except the one Jeroen tested on a year ago. I don't know why that was.

At least, I've just tested that the doctest in this ticket fails if it's tested on the current beta, and that this patch fixes it.



---

archive/issue_comments_225078.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n+Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.\n \n-There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).\n+There are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).\n``````\n",
    "created_at": "2015-11-06T15:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225078",
    "user": "https://github.com/johanrosenkilde"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Running ./sage --preparse on a .sage produces a .py file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.
+Running `./sage --preparse` on a `.sage` produces a `.py` file such that this is a proper Python file. If the .sage file contains a module docstring, then this should be present as the module docstring of the resulting .py file. This means that no code-lines (non-comment, non-blank) may be added before this module docstring.
 
-There are no doc-tests for this (and incidentally, also no doc-tests that sage --preparse respects the encoding line), and the way sage-preparse is currently written is quite fragile with respect to changes in called code (in sage.misc.preparser).
+There are no doc-tests for this (and incidentally, also no doc-tests that `sage --preparse` respects the encoding line), and the way `sage-preparse` is currently written is quite fragile with respect to changes in called code (in `sage.misc.preparser`).
``````




---

archive/issue_comments_225079.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Volker Braun**",
    "created_at": "2016-05-30T09:53:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225079",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Volker Braun**



---

archive/issue_events_241004.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-30T09:53:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241004"
}
```



---

archive/issue_events_241005.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-30T09:53:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241005"
}
```



---

archive/issue_comments_225080.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nNecro-review -- thanks! :-)",
    "created_at": "2016-05-30T09:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225080",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:30" align="right">comment:30</div>

Necro-review -- thanks! :-)



---

archive/issue_comments_225081.json:
```json
{
    "body": "Changed branch from **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)** to **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)**",
    "created_at": "2016-05-31T07:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225081",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jsrn/ticket/17019](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/ticket/17019)** to **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)**



---

archive/issue_events_241006.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-31T07:29:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241006"
}
```



---

archive/issue_events_241007.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2f686192186d2706aef5264b8e58ce80930c38d9",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-05-31T07:29:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17019#event-241007"
}
```



---

archive/issue_comments_225082.json:
```json
{
    "body": "Changed commit from **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)** to none",
    "created_at": "2016-08-07T20:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225082",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`f21f386`](https://github.com/sagemath/sagetrac-mirror/commit/f21f3862591b3de7968f8d552f641f02ab8f28fa)** to none



---

archive/issue_comments_225083.json:
```json
{
    "body": "Changed author from **Johan S. R. Nielsen** to **Johan Sebastian Rosenkilde Nielsen**",
    "created_at": "2016-08-07T20:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17019#issuecomment-225083",
    "user": "https://github.com/fchapoton"
}
```

Changed author from **Johan S. R. Nielsen** to **Johan Sebastian Rosenkilde Nielsen**
