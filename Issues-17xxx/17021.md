# Issue 17021: Faster creation of words by the parent

archive/issues_016784.json:
```json
{
    "body": "1. Move the code of `_construct_word` into `__call__` method.\n\n2. Create `_word_from_list` methods which are shortcuts for `__call__` when we know the datatype.\n\nHere are some benchmarks:\n\nlist:\n\n```\nsage: W = Words()\nsage: L = range(1000)\nsage: %timeit W.call__old(L)             # before\n10000 loops, best of 3: 45.1 \u00b5s per loop\n\nsage: %timeit W(L)                       # after\n10000 loops, best of 3: 17.1 \u00b5s per loop  \nsage: %timeit W(L, check=False)     \n100000 loops, best of 3: 2.21 \u00b5s per loop \nsage: %timeit W._word_from_list(L)  \n1000000 loops, best of 3: 1.33 \u00b5s per loop\n```\n\nstr:\n\n```\nsage: W = Words()\nsage: s = 'a'*1000\nsage: %timeit W.call__old(s)              # before\n10000 loops, best of 3: 45.7 \u00b5s per loop   \nsage: %timeit W(s)                        # after\n10000 loops, best of 3: 18.4 \u00b5s per loop  \nsage: %timeit W(s, check=False)           \n100000 loops, best of 3: 2.62 \u00b5s per loop\nsage: %timeit W._word_from_str(s)         \n1000000 loops, best of 3: 1.23 \u00b5s per loop\n```\n\ntuple:\n\n```\nsage: t = tuple(L)\nsage: %timeit W.call__old(t)             # before\n10000 loops, best of 3: 45.9 \u00b5s per loop \nsage: %timeit W(t)                       # after\n10000 loops, best of 3: 18.6 \u00b5s per loop \nsage: %timeit W(t,check=False)           \n100000 loops, best of 3: 3.25 \u00b5s per loop\nsage: %timeit W._word_from_tuple(t)      \n1000000 loops, best of 3: 1.3 \u00b5s per loop\n```\n\nchar (here creation is longer than str, tuple or list because a copy of data is performed):\n\n```\nsage: W = Words([0,1,2])\nsage: L = [0,1,1,2]*1000\nsage: type(W(L))\n<class 'sage.combinat.words.word.FiniteWord_char'>\nsage: %timeit W.call__old(L)           # before\n1000 loops, best of 3: 322 \u00b5s per loop\nsage: %timeit W(L)                     # after\n1000 loops, best of 3: 292 \u00b5s per loop\nsage: %timeit W(L, check=False)       \n1000 loops, best of 3: 248 \u00b5s per loop\nsage: %timeit W._word_from_char(L)    \n1000 loops, best of 3: 245 \u00b5s per loop\n```\n\nBEFORE:\n\n```\nsage: W = Words(range(5))\nsage: %time L = list(W.iterate_by_length(7))\nCPU times: user 4.6 s, sys: 54.7 ms, total: 4.66 s\nWall time: 4.68 s\n```\n\nAFTER (about 20 times faster):\n\n```\nsage: W = Words(range(5))\nsage: %time L = list(W.iterate_by_length(7))\nCPU times: user 235 ms, sys: 29.1 ms, total: 264 ms\nWall time: 259 ms                                  \n```\n\n\nCC:  @videlec @staroste\n\nBranch/Commit: 7b5b64c2f5af5dc976439b9d84ac6030ac94290c\n\nReviewer: Vincent Delecroix\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17021\n\n",
    "closed_at": "2014-10-02T16:22:04Z",
    "created_at": "2014-09-20T23:47:34Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Faster creation of words by the parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17021",
    "user": "https://github.com/seblabbe"
}
```
1. Move the code of `_construct_word` into `__call__` method.

2. Create `_word_from_list` methods which are shortcuts for `__call__` when we know the datatype.

Here are some benchmarks:

list:

```
sage: W = Words()
sage: L = range(1000)
sage: %timeit W.call__old(L)             # before
10000 loops, best of 3: 45.1 µs per loop

sage: %timeit W(L)                       # after
10000 loops, best of 3: 17.1 µs per loop  
sage: %timeit W(L, check=False)     
100000 loops, best of 3: 2.21 µs per loop 
sage: %timeit W._word_from_list(L)  
1000000 loops, best of 3: 1.33 µs per loop
```

str:

```
sage: W = Words()
sage: s = 'a'*1000
sage: %timeit W.call__old(s)              # before
10000 loops, best of 3: 45.7 µs per loop   
sage: %timeit W(s)                        # after
10000 loops, best of 3: 18.4 µs per loop  
sage: %timeit W(s, check=False)           
100000 loops, best of 3: 2.62 µs per loop
sage: %timeit W._word_from_str(s)         
1000000 loops, best of 3: 1.23 µs per loop
```

tuple:

```
sage: t = tuple(L)
sage: %timeit W.call__old(t)             # before
10000 loops, best of 3: 45.9 µs per loop 
sage: %timeit W(t)                       # after
10000 loops, best of 3: 18.6 µs per loop 
sage: %timeit W(t,check=False)           
100000 loops, best of 3: 3.25 µs per loop
sage: %timeit W._word_from_tuple(t)      
1000000 loops, best of 3: 1.3 µs per loop
```

char (here creation is longer than str, tuple or list because a copy of data is performed):

```
sage: W = Words([0,1,2])
sage: L = [0,1,1,2]*1000
sage: type(W(L))
<class 'sage.combinat.words.word.FiniteWord_char'>
sage: %timeit W.call__old(L)           # before
1000 loops, best of 3: 322 µs per loop
sage: %timeit W(L)                     # after
1000 loops, best of 3: 292 µs per loop
sage: %timeit W(L, check=False)       
1000 loops, best of 3: 248 µs per loop
sage: %timeit W._word_from_char(L)    
1000 loops, best of 3: 245 µs per loop
```

BEFORE:

```
sage: W = Words(range(5))
sage: %time L = list(W.iterate_by_length(7))
CPU times: user 4.6 s, sys: 54.7 ms, total: 4.66 s
Wall time: 4.68 s
```

AFTER (about 20 times faster):

```
sage: W = Words(range(5))
sage: %time L = list(W.iterate_by_length(7))
CPU times: user 235 ms, sys: 29.1 ms, total: 264 ms
Wall time: 259 ms                                  
```


CC:  @videlec @staroste

Branch/Commit: 7b5b64c2f5af5dc976439b9d84ac6030ac94290c

Reviewer: Vincent Delecroix

Author: Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17021





---

archive/issue_comments_236302.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-20T23:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236302",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_236303.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2014-09-20T23:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236303",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_236304.json:
```json
{
    "body": "<a id='comment:2'></a>I based my branch on top of #17013 who just got positive reviewed. I hope it is okay.",
    "created_at": "2014-09-20T23:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236304",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>I based my branch on top of #17013 who just got positive reviewed. I hope it is okay.



---

archive/issue_comments_236305.json:
```json
{
    "body": "<a id='comment:3'></a>Hello,\n\n1) what is the point of\n\n```\n+        word_classes = self._element_classes\n+        cls_str = 'FiniteWord_list'\n+        return word_classes[cls_str](parent=self, data=data)\n```\ninstead of\n\n```\n+        return self._element_classes['FiniteWord_list'](parent, data)\n```\n\n2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. Doing that you impose the return type to be `FiniteWord_list` or `FiniteWord_tuple` (you might prefer a `FiniteWord_char` sometimes). Instead of using directly those, I would rather introduce a `check` argument in `__call__` and do not use them in methods of `FiniteWord`.\n\nVincent",
    "created_at": "2014-09-24T10:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236305",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>Hello,

1) what is the point of

```
+        word_classes = self._element_classes
+        cls_str = 'FiniteWord_list'
+        return word_classes[cls_str](parent=self, data=data)
```
instead of

```
+        return self._element_classes['FiniteWord_list'](parent, data)
```

2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. Doing that you impose the return type to be `FiniteWord_list` or `FiniteWord_tuple` (you might prefer a `FiniteWord_char` sometimes). Instead of using directly those, I would rather introduce a `check` argument in `__call__` and do not use them in methods of `FiniteWord`.

Vincent



---

archive/issue_comments_236306.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-09-24T10:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236306",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_236307.json:
```json
{
    "body": "<a id='comment:4'></a>> 1) what is the point of\n\n\nYou are right, I will change that.\n\n> 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. \n\n\nOkay, I see and agree.\n\nBut still `__call__` is much slower because it guesses the datatype. I will check with a check argument whether it is better...",
    "created_at": "2014-09-24T22:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236307",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>> 1) what is the point of


You are right, I will change that.

> 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. 


Okay, I see and agree.

But still `__call__` is much slower because it guesses the datatype. I will check with a check argument whether it is better...



---

archive/issue_comments_236308.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2014-09-24T22:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236308",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_236309.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 slabbe]:\n> > 1) what is the point of\n\n> \n> You are right, I will change that.\n> \n> > 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. \n\n> \n> Okay, I see and agree.\n> \n> But still `__call__` is much slower because it guesses the datatype. I will check with a check argument whether it is better...\n\n\nNot if `datatype` is properly set in input, no? You can assume that with a `check=False`, if the datatype is provided then there is no need to check that the data fits.\n\nVincent",
    "created_at": "2014-09-25T07:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236309",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Replying to [comment:4 slabbe]:
> > 1) what is the point of

> 
> You are right, I will change that.
> 
> > 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. 

> 
> Okay, I see and agree.
> 
> But still `__call__` is much slower because it guesses the datatype. I will check with a check argument whether it is better...


Not if `datatype` is properly set in input, no? You can assume that with a `check=False`, if the datatype is provided then there is no need to check that the data fits.

Vincent



---

archive/issue_comments_236310.json:
```json
{
    "body": "<a id='comment:7'></a>> 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. Doing that you impose the return type to be `FiniteWord_list` or `FiniteWord_tuple` (you might prefer a `FiniteWord_char` sometimes). \n\n\nWhat do you think if we do the following (automatically use char instead of list)?\n\n```diff\n    @lazy_attribute\n    def _element_classes(self):\n\n        [...]\n\n        # test whether or not we can use the class Finiteword_char\n        if (self.alphabet().cardinality() <= 256 and\n                all(isinstance(i, (int,Integer)) and 0 <= i < 256 for i in self.alphabet())):\n            L = self.alphabet().list()\n            if (all(L[i] < L[i+1] for i in range(len(L)-1)) and\n                    all(self.cmp_letters(L[i],L[i+1]) == -1 for i in range(len(L)-1))):\n                classes['FiniteWord_char'] = word.FiniteWord_char\n+               classes['FiniteWord_list'] = word.FiniteWord_char\n```\n\nWell, maybe it is bad since we won't be able to compare char with list anymore...",
    "created_at": "2014-09-26T10:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236310",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>> 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. Doing that you impose the return type to be `FiniteWord_list` or `FiniteWord_tuple` (you might prefer a `FiniteWord_char` sometimes). 


What do you think if we do the following (automatically use char instead of list)?

```diff
    @lazy_attribute
    def _element_classes(self):

        [...]

        # test whether or not we can use the class Finiteword_char
        if (self.alphabet().cardinality() <= 256 and
                all(isinstance(i, (int,Integer)) and 0 <= i < 256 for i in self.alphabet())):
            L = self.alphabet().list()
            if (all(L[i] < L[i+1] for i in range(len(L)-1)) and
                    all(self.cmp_letters(L[i],L[i+1]) == -1 for i in range(len(L)-1))):
                classes['FiniteWord_char'] = word.FiniteWord_char
+               classes['FiniteWord_list'] = word.FiniteWord_char
```

Well, maybe it is bad since we won't be able to compare char with list anymore...



---

archive/issue_comments_236311.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 slabbe]:\n> > 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. Doing that you impose the return type to be `FiniteWord_list` or `FiniteWord_tuple` (you might prefer a `FiniteWord_char` sometimes). \n\n> \n> What do you think if we do the following (automatically use char instead of list)?\n\n>\n> [...]\n\n \nI already proposed that and you answered: \"and what if I really want a `Word_list`?\" If you want to go that way, we can even remove all the classes and always return `Word_char` whatever the input is. It is definitely the simplest but of course only concerns alphabet included in [0,255[.\n\nVincent",
    "created_at": "2014-09-26T13:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236311",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Replying to [comment:7 slabbe]:
> > 2) Calling directly `.finite_word_tuple()` or `.finite_word_list()` from the methods in `FiniteWord` is bad. Doing that you impose the return type to be `FiniteWord_list` or `FiniteWord_tuple` (you might prefer a `FiniteWord_char` sometimes). 

> 
> What do you think if we do the following (automatically use char instead of list)?

>
> [...]

 
I already proposed that and you answered: "and what if I really want a `Word_list`?" If you want to go that way, we can even remove all the classes and always return `Word_char` whatever the input is. It is definitely the simplest but of course only concerns alphabet included in [0,255[.

Vincent



---

archive/issue_comments_236312.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n 1. Move the code of `_construct_word` into `__call__` method.\n \n-2. Create `finite_word_list` methods which are shortcuts for `__call__` when we know the datatype.\n+2. Create `_word_from_list` methods which are shortcuts for `__call__` when we know the datatype.\n \n Here are some benchmarks:\n \n@@ -9,10 +9,15 @@\n ```\n sage: W = Words()\n sage: L = range(1000)\n-sage: %timeit W(L)\n-10000 loops, best of 3: 45.5 \u00b5s per loop\n-sage: %timeit W.finite_word_list(L)\n-1000000 loops, best of 3: 1.29 \u00b5s per loop\n+sage: %timeit W.call__old(L)             # before\n+10000 loops, best of 3: 45.1 \u00b5s per loop\n+\n+sage: %timeit W(L)                       # after\n+10000 loops, best of 3: 17.1 \u00b5s per loop  \n+sage: %timeit W(L, check=False)     \n+100000 loops, best of 3: 2.21 \u00b5s per loop \n+sage: %timeit W._word_from_list(L)  \n+1000000 loops, best of 3: 1.33 \u00b5s per loop\n ```\n \n str:\n@@ -20,33 +25,45 @@\n ```\n sage: W = Words()\n sage: s = 'a'*1000\n-sage: %timeit W(s)\n-10000 loops, best of 3: 45.2 \u00b5s per loop\n-sage: %timeit W.finite_word_str(s)\n-1000000 loops, best of 3: 1.27 \u00b5s per loop\n+sage: %timeit W.call__old(s)              # before\n+10000 loops, best of 3: 45.7 \u00b5s per loop   \n+sage: %timeit W(s)                        # after\n+10000 loops, best of 3: 18.4 \u00b5s per loop  \n+sage: %timeit W(s, check=False)           \n+100000 loops, best of 3: 2.62 \u00b5s per loop\n+sage: %timeit W._word_from_str(s)         \n+1000000 loops, best of 3: 1.23 \u00b5s per loop\n ```\n \n tuple:\n \n ```\n sage: t = tuple(L)\n-sage: %timeit W(t)\n-10000 loops, best of 3: 46 \u00b5s per loop\n-sage: %timeit W.finite_word_tuple(t)\n-1000000 loops, best of 3: 1.39 \u00b5s per loop\n+sage: %timeit W.call__old(t)             # before\n+10000 loops, best of 3: 45.9 \u00b5s per loop \n+sage: %timeit W(t)                       # after\n+10000 loops, best of 3: 18.6 \u00b5s per loop \n+sage: %timeit W(t,check=False)           \n+100000 loops, best of 3: 3.25 \u00b5s per loop\n+sage: %timeit W._word_from_tuple(t)      \n+1000000 loops, best of 3: 1.3 \u00b5s per loop\n ```\n \n-char (why creation is so longer than str, tuple or list?):\n+char (here creation is longer than str, tuple or list because a copy of data is performed):\n \n ```\n sage: W = Words([0,1,2])\n sage: L = [0,1,1,2]*1000\n sage: type(W(L))\n <class 'sage.combinat.words.word.FiniteWord_char'>\n-sage: %timeit W(L)\n-1000 loops, best of 3: 336 \u00b5s per loop\n-sage: %timeit W.finite_word_char(L)\n-1000 loops, best of 3: 246 \u00b5s per loop\n+sage: %timeit W.call__old(L)           # before\n+1000 loops, best of 3: 322 \u00b5s per loop\n+sage: %timeit W(L)                     # after\n+1000 loops, best of 3: 292 \u00b5s per loop\n+sage: %timeit W(L, check=False)       \n+1000 loops, best of 3: 248 \u00b5s per loop\n+sage: %timeit W._word_from_char(L)    \n+1000 loops, best of 3: 245 \u00b5s per loop\n ```\n \n BEFORE:\n@@ -58,14 +75,15 @@\n Wall time: 4.68 s\n ```\n \n-AFTER:\n+AFTER (about 20 times faster):\n \n ```\n sage: W = Words(range(5))\n sage: %time L = list(W.iterate_by_length(7))\n-CPU times: user 940 ms, sys: 80.4 ms, total: 1.02 s\n-Wall time: 1.02 s\n+CPU times: user 235 ms, sys: 29.1 ms, total: 264 ms\n+Wall time: 259 ms                                  \n ```\n+\n \n Author: S\u00e9bastien Labb\u00e9\n \n``````\n",
    "created_at": "2014-09-28T13:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236312",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 1. Move the code of `_construct_word` into `__call__` method.
 
-2. Create `finite_word_list` methods which are shortcuts for `__call__` when we know the datatype.
+2. Create `_word_from_list` methods which are shortcuts for `__call__` when we know the datatype.
 
 Here are some benchmarks:
 
@@ -9,10 +9,15 @@
 ```
 sage: W = Words()
 sage: L = range(1000)
-sage: %timeit W(L)
-10000 loops, best of 3: 45.5 µs per loop
-sage: %timeit W.finite_word_list(L)
-1000000 loops, best of 3: 1.29 µs per loop
+sage: %timeit W.call__old(L)             # before
+10000 loops, best of 3: 45.1 µs per loop
+
+sage: %timeit W(L)                       # after
+10000 loops, best of 3: 17.1 µs per loop  
+sage: %timeit W(L, check=False)     
+100000 loops, best of 3: 2.21 µs per loop 
+sage: %timeit W._word_from_list(L)  
+1000000 loops, best of 3: 1.33 µs per loop
 ```
 
 str:
@@ -20,33 +25,45 @@
 ```
 sage: W = Words()
 sage: s = 'a'*1000
-sage: %timeit W(s)
-10000 loops, best of 3: 45.2 µs per loop
-sage: %timeit W.finite_word_str(s)
-1000000 loops, best of 3: 1.27 µs per loop
+sage: %timeit W.call__old(s)              # before
+10000 loops, best of 3: 45.7 µs per loop   
+sage: %timeit W(s)                        # after
+10000 loops, best of 3: 18.4 µs per loop  
+sage: %timeit W(s, check=False)           
+100000 loops, best of 3: 2.62 µs per loop
+sage: %timeit W._word_from_str(s)         
+1000000 loops, best of 3: 1.23 µs per loop
 ```
 
 tuple:
 
 ```
 sage: t = tuple(L)
-sage: %timeit W(t)
-10000 loops, best of 3: 46 µs per loop
-sage: %timeit W.finite_word_tuple(t)
-1000000 loops, best of 3: 1.39 µs per loop
+sage: %timeit W.call__old(t)             # before
+10000 loops, best of 3: 45.9 µs per loop 
+sage: %timeit W(t)                       # after
+10000 loops, best of 3: 18.6 µs per loop 
+sage: %timeit W(t,check=False)           
+100000 loops, best of 3: 3.25 µs per loop
+sage: %timeit W._word_from_tuple(t)      
+1000000 loops, best of 3: 1.3 µs per loop
 ```
 
-char (why creation is so longer than str, tuple or list?):
+char (here creation is longer than str, tuple or list because a copy of data is performed):
 
 ```
 sage: W = Words([0,1,2])
 sage: L = [0,1,1,2]*1000
 sage: type(W(L))
 <class 'sage.combinat.words.word.FiniteWord_char'>
-sage: %timeit W(L)
-1000 loops, best of 3: 336 µs per loop
-sage: %timeit W.finite_word_char(L)
-1000 loops, best of 3: 246 µs per loop
+sage: %timeit W.call__old(L)           # before
+1000 loops, best of 3: 322 µs per loop
+sage: %timeit W(L)                     # after
+1000 loops, best of 3: 292 µs per loop
+sage: %timeit W(L, check=False)       
+1000 loops, best of 3: 248 µs per loop
+sage: %timeit W._word_from_char(L)    
+1000 loops, best of 3: 245 µs per loop
 ```
 
 BEFORE:
@@ -58,14 +75,15 @@
 Wall time: 4.68 s
 ```
 
-AFTER:
+AFTER (about 20 times faster):
 
 ```
 sage: W = Words(range(5))
 sage: %time L = list(W.iterate_by_length(7))
-CPU times: user 940 ms, sys: 80.4 ms, total: 1.02 s
-Wall time: 1.02 s
+CPU times: user 235 ms, sys: 29.1 ms, total: 264 ms
+Wall time: 259 ms                                  
 ```
+
 
 Author: Sébastien Labbé
 
``````




---

archive/issue_comments_236313.json:
```json
{
    "body": "<a id='comment:10'></a>There is no new commit, is that ok?",
    "created_at": "2014-09-28T14:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236313",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>There is no new commit, is that ok?



---

archive/issue_comments_236314.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-28T14:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236315.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-28T14:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236315",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_236316.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-09-28T16:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236316",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_236317.json:
```json
{
    "body": "<a id='comment:13'></a>Hello,\n\nMuch cleaner than before! Great!\n\nAre you sure this is worth it\n\n```\nsage: W = Words([0,1,2])\nsage: l = [0,1,0]*100\nsage: timeit(\"w = W(l, datatype='list', check=False)\", number=2000)\n2000 loops, best of 3: 2.17 \u00b5s per loop\nsage: timeit(\"w = W._word_from_list(l)\", number=2000)\n2000 loops, best of 3: 1.55 \u00b5s per loop\nsage: cls = W._element_classes['FiniteWord_list']\nsage: timeit(\"w = cls(W,l)\", number=2000)\n2000 loops, best of 3: 717 ns per loop\n```\nHaving 20% gain with a method that is twice slower than calling the class constructor looks useless. If you want speed, use the classes themselves.\n\nThe name `_word_from_list_or_char` is more than confusing. For me `from` is about the input not the output. I have nothing against a method `_word_from_list` which return whatever it wants, but I would expect it to raise an Error if the input is not a list.\n\nSometimes you use `MyWordClass(parent=self, data=data)` and sometimes `MyWordClass(parent, data)`. Is there a reason why?\n\nVincent",
    "created_at": "2014-09-28T16:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236317",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Hello,

Much cleaner than before! Great!

Are you sure this is worth it

```
sage: W = Words([0,1,2])
sage: l = [0,1,0]*100
sage: timeit("w = W(l, datatype='list', check=False)", number=2000)
2000 loops, best of 3: 2.17 µs per loop
sage: timeit("w = W._word_from_list(l)", number=2000)
2000 loops, best of 3: 1.55 µs per loop
sage: cls = W._element_classes['FiniteWord_list']
sage: timeit("w = cls(W,l)", number=2000)
2000 loops, best of 3: 717 ns per loop
```
Having 20% gain with a method that is twice slower than calling the class constructor looks useless. If you want speed, use the classes themselves.

The name `_word_from_list_or_char` is more than confusing. For me `from` is about the input not the output. I have nothing against a method `_word_from_list` which return whatever it wants, but I would expect it to raise an Error if the input is not a list.

Sometimes you use `MyWordClass(parent=self, data=data)` and sometimes `MyWordClass(parent, data)`. Is there a reason why?

Vincent



---

archive/issue_comments_236318.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-28T18:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236319.json:
```json
{
    "body": "<a id='comment:15'></a>I kept `_word_from_word`, `_word_from_iter` and `_word_from_callable` because their code takes more than one line and the latter two are used two or three times in the `__call__` method.",
    "created_at": "2014-09-28T18:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236319",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:15'></a>I kept `_word_from_word`, `_word_from_iter` and `_word_from_callable` because their code takes more than one line and the latter two are used two or three times in the `__call__` method.



---

archive/issue_comments_236320.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-09-28T18:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236320",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_236321.json:
```json
{
    "body": "<a id='comment:16'></a>Hi Sebastien,\n\nI added a commit which removes some trailing whitespaces and allow to use `Word_char` when the input data is a tuple.\n\nIf you are happy with it, set to positive review.\n\nVincent\n\n---\nNew commits:",
    "created_at": "2014-09-28T22:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236321",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>Hi Sebastien,

I added a commit which removes some trailing whitespaces and allow to use `Word_char` when the input data is a tuple.

If you are happy with it, set to positive review.

Vincent

---
New commits:



---

archive/issue_comments_236322.json:
```json
{
    "body": "<a id='comment:17'></a>okay!",
    "created_at": "2014-09-28T22:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236322",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:17'></a>okay!



---

archive/issue_comments_236323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-28T22:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236323",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_236324.json:
```json
{
    "body": "<a id='comment:18'></a>\n```\nsage -t --long --warn-long 62.5 src/sage/combinat/permutation.py  # 1 doctest failed\nsage -t --long --warn-long 62.5 src/sage/combinat/parking_functions.py  # 62 doctests failed\n```",
    "created_at": "2014-09-29T13:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236324",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
```
sage -t --long --warn-long 62.5 src/sage/combinat/permutation.py  # 1 doctest failed
sage -t --long --warn-long 62.5 src/sage/combinat/parking_functions.py  # 62 doctests failed
```



---

archive/issue_comments_236325.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-09-29T13:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236325",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_236326.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-29T14:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236327.json:
```json
{
    "body": "<a id='comment:20'></a>Hi Sebastien,\n\nSo `CombinatorialObject` is still used as input ;-( I added a special case for it in the `__call__`.\n\nVincent",
    "created_at": "2014-09-29T14:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236327",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>Hi Sebastien,

So `CombinatorialObject` is still used as input ;-( I added a special case for it in the `__call__`.

Vincent



---

archive/issue_comments_236328.json:
```json
{
    "body": "<a id='comment:21'></a>`import is_iterator` ?",
    "created_at": "2014-09-29T14:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236328",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:21'></a>`import is_iterator` ?



---

archive/issue_comments_236329.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-29T15:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_236330.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-29T15:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_236331.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-29T16:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236331",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_236332.json:
```json
{
    "body": "<a id='comment:25'></a>Hey Sebastien,\n\nAre you happy with that version? The tests in combinat pass at home.\n\nVincent",
    "created_at": "2014-09-29T16:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236332",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>Hey Sebastien,

Are you happy with that version? The tests in combinat pass at home.

Vincent



---

archive/issue_comments_236333.json:
```json
{
    "body": "<a id='comment:26'></a>Test in combinat pass here too. I was waiting for the buildbot. It says \"success\", but I can not check if all of tests in the sage library passed. Can you see it?\n\nS\u00e9bastien",
    "created_at": "2014-09-29T16:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236333",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:26'></a>Test in combinat pass here too. I was waiting for the buildbot. It says "success", but I can not check if all of tests in the sage library passed. Can you see it?

Sébastien



---

archive/issue_comments_236334.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-29T16:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236334",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_236335.json:
```json
{
    "body": "<a id='comment:27'></a>Nope. But at least it pass where it failed before... I set to positive review.\n\nI do not know whether the build bot runs the test or only try to compile and run.\n\nVincent",
    "created_at": "2014-09-29T16:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236335",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>Nope. But at least it pass where it failed before... I set to positive review.

I do not know whether the build bot runs the test or only try to compile and run.

Vincent



---

archive/issue_comments_236336.json:
```json
{
    "body": "<a id='comment:28'></a>I tried `make doc-clean` and `sage -docbuild reference html` and I get the following error:\n\n```\n...\n[combinat ] writing output... [ 98%] sage/databases/oeis                                               \n[combinat ] writing output... [ 98%] species                                                           \n[combinat ] writing output... [ 99%] symmetric_functions                                               \n[combinat ] writing output... [ 99%] tableaux                                                          \n[combinat ] writing output... [100%] words                                                             \n[combinat ] None:38: WARNING: citation not found: Schiffmann                                           \nError building the documentation.                                                                      \nTraceback (most recent call last):                                                                     \n  File \"/Users/slabbe/Applications/sage-git/src/doc/common/builder.py\", line 1491, in <module>         \n    getattr(get_builder(name), type)()                                                                 \n  File \"/Users/slabbe/Applications/sage-git/src/doc/common/builder.py\", line 503, in _wrapper          \n    x.get(99999)                                                                                       \n  File \"/Users/slabbe/Applications/sage-git/local/lib/python/multiprocessing/pool.py\", line 558, in get\n    raise self._value                                                                                  \nOSError: [combinat ] None:38: WARNING: citation not found: Schiffmann\n```\n\nBut I get the same error on a clean version of `sage-6.4.beta4`. So it is not related to us. Also:\n\n```\nsage: search_src('Schiffman')      \nalgebras/hall_algebra.py:114:    See section 2.3 in [Schiffmann]_, and sections II.2 and III.3     \nalgebras/hall_algebra.py:211:    .. [Schiffmann] Oliver Schiffmann. *Lectures on Hall algebras*.   \nalgebras/hall_algebra.py:465:            corresponding to `\\lambda`. See Lemma 2.8 in [Schiffmann]_\ncombinat/hall_polynomial.py:66:    in [Schiffmann]_):                                              \n```\n\nThe part on words did not raised any warning or errors. So still positive review.",
    "created_at": "2014-09-29T17:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236336",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:28'></a>I tried `make doc-clean` and `sage -docbuild reference html` and I get the following error:

```
...
[combinat ] writing output... [ 98%] sage/databases/oeis                                               
[combinat ] writing output... [ 98%] species                                                           
[combinat ] writing output... [ 99%] symmetric_functions                                               
[combinat ] writing output... [ 99%] tableaux                                                          
[combinat ] writing output... [100%] words                                                             
[combinat ] None:38: WARNING: citation not found: Schiffmann                                           
Error building the documentation.                                                                      
Traceback (most recent call last):                                                                     
  File "/Users/slabbe/Applications/sage-git/src/doc/common/builder.py", line 1491, in <module>         
    getattr(get_builder(name), type)()                                                                 
  File "/Users/slabbe/Applications/sage-git/src/doc/common/builder.py", line 503, in _wrapper          
    x.get(99999)                                                                                       
  File "/Users/slabbe/Applications/sage-git/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value                                                                                  
OSError: [combinat ] None:38: WARNING: citation not found: Schiffmann
```

But I get the same error on a clean version of `sage-6.4.beta4`. So it is not related to us. Also:

```
sage: search_src('Schiffman')      
algebras/hall_algebra.py:114:    See section 2.3 in [Schiffmann]_, and sections II.2 and III.3     
algebras/hall_algebra.py:211:    .. [Schiffmann] Oliver Schiffmann. *Lectures on Hall algebras*.   
algebras/hall_algebra.py:465:            corresponding to `\lambda`. See Lemma 2.8 in [Schiffmann]_
combinat/hall_polynomial.py:66:    in [Schiffmann]_):                                              
```

The part on words did not raised any warning or errors. So still positive review.



---

archive/issue_comments_236337.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-02T16:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17021#issuecomment-236337",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049547.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-02T16:22:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17021",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17021#event-49547"
}
```
