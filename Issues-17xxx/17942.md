# Issue 17942: save() should download files in the notebook

archive/issues_017705.json:
```json
{
    "body": "In a browser-based notebook an object's `save()` method should automatically download the saved file and not just let it linger on the remote server.\n\nI'm proposing to do this by returning, from `save()`, a `SavedFile` object instead of nothing. The `SavedFile._rich_repr_` method then returns a custom rich representation which gives browser-based display backends a hook to do something with the saved file. Also, nothing happens if you call save() from within code---only if it hits the displayhook:\n\n```\nsage: my_plot.save()        # yes, download\nsage: _ = my_plot.save()    # no automatic download\nsage: for i in range(10):\n....:     my_plot.save()    # depends\nsage: for i in range(10):\n....:     my_plot.save()    # no\n....:     x = x + i\n```\n\n![](http://boxen.math.washington.edu/home/vbraun/www/ipython-download-link.png)\n\nCC:  @gagern @kcrisman\n\nAuthor: Volker Braun\n\nBranch: u/vbraun/save_should_download_files\n\nStatus: needs_work\n\nCommit: b3a066a6e206efdbf92d84c5405ffcdfae88866e\n\nIssue created by migration from https://trac.sagemath.org/ticket/17942\n\n",
    "created_at": "2015-03-12T23:41:20Z",
    "labels": [
        "component: user interface",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "save() should download files in the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17942",
    "user": "https://github.com/vbraun"
}
```
In a browser-based notebook an object's `save()` method should automatically download the saved file and not just let it linger on the remote server.

I'm proposing to do this by returning, from `save()`, a `SavedFile` object instead of nothing. The `SavedFile._rich_repr_` method then returns a custom rich representation which gives browser-based display backends a hook to do something with the saved file. Also, nothing happens if you call save() from within code---only if it hits the displayhook:

```
sage: my_plot.save()        # yes, download
sage: _ = my_plot.save()    # no automatic download
sage: for i in range(10):
....:     my_plot.save()    # depends
sage: for i in range(10):
....:     my_plot.save()    # no
....:     x = x + i
```

![](http://boxen.math.washington.edu/home/vbraun/www/ipython-download-link.png)

CC:  @gagern @kcrisman

Author: Volker Braun

Branch: u/vbraun/save_should_download_files

Status: needs_work

Commit: b3a066a6e206efdbf92d84c5405ffcdfae88866e

Issue created by migration from https://trac.sagemath.org/ticket/17942





---

archive/issue_comments_251857.json:
```json
{
    "body": "<a id='comment:1'></a>The `SavedFile` object could itself have a `show()` method, which may or may not show the file (depending on the display backend capabilities and the saved file):\n\n```\nsage: my_plot.save(**complicated_options).show()\nThe Foo Notebook cannot display $complicated_graphics_format\n```",
    "created_at": "2015-03-12T23:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251857",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>The `SavedFile` object could itself have a `show()` method, which may or may not show the file (depending on the display backend capabilities and the saved file):

```
sage: my_plot.save(**complicated_options).show()
The Foo Notebook cannot display $complicated_graphics_format
```



---

archive/issue_comments_251858.json:
```json
{
    "body": "Replying to [ticket:17942 vbraun]:\n> In a browser-based notebook an object's `save()` method should automatically download the saved file\n\n\nI'm not sure that I agree with this. You might want to `save()` the object on the server to `load()` it in some Sage session later.\n\nIf you want download functionality, I would prefer to use a new `.download()` method for that.",
    "created_at": "2015-03-13T08:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251858",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:17942 vbraun]:
> In a browser-based notebook an object's `save()` method should automatically download the saved file


I'm not sure that I agree with this. You might want to `save()` the object on the server to `load()` it in some Sage session later.

If you want download functionality, I would prefer to use a new `.download()` method for that.



---

archive/issue_comments_251859.json:
```json
{
    "body": "<a id='comment:3'></a>Just to clarify, save() should of course still save the file on the remote file system. It just should **in addition** get the file to the client.\n\nTying it to the displayhook already gives you a means to control whether or not the file is downloaded. Also, if you really just save a temporary file on the server you are more likely to do that form within code so it wouldn't be downloaded anyway. There could be other switches, maybe `foo.save(download=False)` or `%download [on|off]`. But just `foo.save()` should by default do something sensible. If you don't like the default you can then look into the docs. But if you only notice that `save()` doesn't result in a file on your laptop then the user is going to assume that this is the way it is.",
    "created_at": "2015-03-13T09:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251859",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>Just to clarify, save() should of course still save the file on the remote file system. It just should **in addition** get the file to the client.

Tying it to the displayhook already gives you a means to control whether or not the file is downloaded. Also, if you really just save a temporary file on the server you are more likely to do that form within code so it wouldn't be downloaded anyway. There could be other switches, maybe `foo.save(download=False)` or `%download [on|off]`. But just `foo.save()` should by default do something sensible. If you don't like the default you can then look into the docs. But if you only notice that `save()` doesn't result in a file on your laptop then the user is going to assume that this is the way it is.



---

archive/issue_comments_251860.json:
```json
{
    "body": "<a id='comment:4'></a>With cloud applications (let's consider sagenb as such an application), \"save\" usually means \"save on the remote system\". The notebook interface has \"Save\" and \"Save & quit\" buttons, neither of these result in a downloaded file.",
    "created_at": "2015-03-13T09:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251860",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>With cloud applications (let's consider sagenb as such an application), "save" usually means "save on the remote system". The notebook interface has "Save" and "Save & quit" buttons, neither of these result in a downloaded file.



---

archive/issue_comments_251861.json:
```json
{
    "body": "<a id='comment:5'></a>From a user these are two different activities:\n* checkpointing the current worksheet\n\n* creating a media file to be used elsewhere\nI agree that its confusing that both are called \"save\", and it all goes back to the time when Word would crash every 30 minutes so you better save your document to three different floppies. Now we still call it save and we often even have a little picture of a floppy disc under it (anyone remember these?), but its really just a pragmatic idiom for checkpointing nowadays (see also https://github.com/ipython/ipython/wiki/IPEP-15:-Autosaving-the-IPython-Notebook).",
    "created_at": "2015-03-13T20:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251861",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>From a user these are two different activities:
* checkpointing the current worksheet

* creating a media file to be used elsewhere
I agree that its confusing that both are called "save", and it all goes back to the time when Word would crash every 30 minutes so you better save your document to three different floppies. Now we still call it save and we often even have a little picture of a floppy disc under it (anyone remember these?), but its really just a pragmatic idiom for checkpointing nowadays (see also https://github.com/ipython/ipython/wiki/IPEP-15:-Autosaving-the-IPython-Notebook).



---

archive/issue_comments_251862.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -12,6 +12,8 @@\n ....:     x = x + i\n \\`\\`\\`\n \n+![](http://boxen.math.washington.edu/home/vbraun/www/ipython-download-link.png)\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/17942\n```\n",
    "created_at": "2015-03-15T00:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251862",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -12,6 +12,8 @@
 ....:     x = x + i
 \`\`\`
 
+![](http://boxen.math.washington.edu/home/vbraun/www/ipython-download-link.png)
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/17942
```




---

archive/issue_comments_251863.json:
```json
{
    "body": "<a id='comment:7'></a>Apparently not so easy in IPython (https://github.com/ipython/ipython/issues/8053), I implemented a moderately hackish workaround.",
    "created_at": "2015-03-15T00:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251863",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Apparently not so easy in IPython (https://github.com/ipython/ipython/issues/8053), I implemented a moderately hackish workaround.



---

archive/issue_comments_251864.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-15T23:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251865.json:
```json
{
    "body": "<a id='comment:9'></a>SageNB often replaces the cell dom with the saved part even for cells that you don't currently work on. So javascript inside the cell can't really initiate the download or it would do it again all the time. So its just a download link in SageNB.",
    "created_at": "2015-03-15T23:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251865",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>SageNB often replaces the cell dom with the saved part even for cells that you don't currently work on. So javascript inside the cell can't really initiate the download or it would do it again all the time. So its just a download link in SageNB.



---

archive/issue_comments_251866.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-15T23:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251866",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_251867.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-15T23:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251868.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T19:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251869.json:
```json
{
    "body": "<a id='comment:12'></a>This works now in both notebooks, imho it is the cleanest way of expressing what you want to do:\n\n```\nplot(f).save('/tmp/foo.png').show()\n```",
    "created_at": "2015-03-21T20:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251869",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>This works now in both notebooks, imho it is the cleanest way of expressing what you want to do:

```
plot(f).save('/tmp/foo.png').show()
```



---

archive/issue_comments_251870.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-22T03:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251871.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-22T14:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251872.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-22T14:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251873.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-23T02:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251874.json:
```json
{
    "body": "<a id='comment:17'></a>does not apply, needs rebase",
    "created_at": "2015-08-09T08:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251874",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>does not apply, needs rebase



---

archive/issue_comments_251875.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-09T08:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251875",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_251876.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-16T11:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251877.json:
```json
{
    "body": "<a id='comment:20'></a>Fixed",
    "created_at": "2015-08-16T11:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251877",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>Fixed



---

archive/issue_comments_251878.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-16T11:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251878",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_251879.json:
```json
{
    "body": "<a id='comment:21'></a>does not apply",
    "created_at": "2015-09-03T14:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251879",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>does not apply



---

archive/issue_comments_251880.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-03T14:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251880",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_251881.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T19:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251881",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251882.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-10T03:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251882",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_251883.json:
```json
{
    "body": "<a id='comment:24'></a>This looks pretty robust.  Should we expect any other `.save()` methods to implement this `SavedFile` type?  Such as the usual `.sobj` saving... I assume not, but just checking.\n\nAlso, this doesn't appear to require any changes in sagenb; I ask because I'm looking at that right now, but I don't see anything that does.",
    "created_at": "2015-11-18T01:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251883",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'></a>This looks pretty robust.  Should we expect any other `.save()` methods to implement this `SavedFile` type?  Such as the usual `.sobj` saving... I assume not, but just checking.

Also, this doesn't appear to require any changes in sagenb; I ask because I'm looking at that right now, but I don't see anything that does.



---

archive/issue_comments_251884.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 kcrisman]:\n> This looks pretty robust.  Should we expect any other `.save()` methods to implement this `SavedFile` type?  Such as the usual `.sobj` saving... I assume not, but just checking.\n\n\nI don't really have an opinion either way; We could.\n\n> Also, this doesn't appear to require any changes in sagenb; I ask because I'm looking at that right now, but I don't see anything that does.\n\n\nNo changes to SageNB required.",
    "created_at": "2015-11-19T14:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251884",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Replying to [comment:24 kcrisman]:
> This looks pretty robust.  Should we expect any other `.save()` methods to implement this `SavedFile` type?  Such as the usual `.sobj` saving... I assume not, but just checking.


I don't really have an opinion either way; We could.

> Also, this doesn't appear to require any changes in sagenb; I ask because I'm looking at that right now, but I don't see anything that does.


No changes to SageNB required.



---

archive/issue_comments_251885.json:
```json
{
    "body": "<a id='comment:26'></a>Great, I didn't think so.  I guess as long as this does what we intend for now (does it make a link for non-graphics files too? just curious) then this would be a good addition.",
    "created_at": "2015-11-19T15:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251885",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:26'></a>Great, I didn't think so.  I guess as long as this does what we intend for now (does it make a link for non-graphics files too? just curious) then this would be a good addition.



---

archive/issue_comments_251886.json:
```json
{
    "body": "<a id='comment:27'></a>It always makes a link regardless of the file type",
    "created_at": "2015-11-19T15:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251886",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>It always makes a link regardless of the file type



---

archive/issue_comments_251887.json:
```json
{
    "body": "<a id='comment:28'></a>does not apply",
    "created_at": "2016-07-28T08:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251887",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'></a>does not apply



---

archive/issue_comments_251888.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-28T08:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17942#issuecomment-251888",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.
