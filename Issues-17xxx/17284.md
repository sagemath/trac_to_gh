# Issue 17284: Fix command-line plotting keywords

archive/issues_017047.json:
```json
{
    "assignees": [],
    "body": "This should open a Tachyon-rendered plot (and this worked until very recently):\n\n```\nsage: cube(viewer=\"tachyon\")\n```\n\nThe following patch fixes the problem (but probably not in the correct way):\n\n```diff\ndiff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py\nindex 670d208..a352a54 100644\n--- a/src/sage/repl/display/formatter.py\n+++ b/src/sage/repl/display/formatter.py\n@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):\n         \"\"\"\n         from sage.structure.sage_object import SageObject\n         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):\n-            gfx = obj._graphics_()\n-            if gfx: \n-                gfx.launch_viewer()\n-                return ''\n+            obj.show()\n+            return ''\n         return super(SageConsoleTextFormatter, self).__call__(obj)\n```\n\nCC:  @vbraun @kcrisman @strogdon\n\nBranch/Commit: **[c84805c](https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f)**\n\nReviewer: **Steven Trogdon, Karl-Dieter Crisman, Jeroen Demeyer, Martin von Gagern**\n\nAuthor: **Volker Braun**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17284_\n\n",
    "closed_at": "2014-11-11T17:00:07Z",
    "created_at": "2014-11-04T07:31:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix command-line plotting keywords",
    "type": "issue",
    "updated_at": "2014-11-11T17:00:07Z",
    "url": "https://github.com/sagemath/sage/issues/17284",
    "user": "https://github.com/jdemeyer"
}
```
This should open a Tachyon-rendered plot (and this worked until very recently):

```
sage: cube(viewer="tachyon")
```

The following patch fixes the problem (but probably not in the correct way):

```diff
diff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py
index 670d208..a352a54 100644
--- a/src/sage/repl/display/formatter.py
+++ b/src/sage/repl/display/formatter.py
@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):
         """
         from sage.structure.sage_object import SageObject
         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):
-            gfx = obj._graphics_()
-            if gfx: 
-                gfx.launch_viewer()
-                return ''
+            obj.show()
+            return ''
         return super(SageConsoleTextFormatter, self).__call__(obj)
```

CC:  @vbraun @kcrisman @strogdon

Branch/Commit: **[c84805c](https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f)**

Reviewer: **Steven Trogdon, Karl-Dieter Crisman, Jeroen Demeyer, Martin von Gagern**

Author: **Volker Braun**

_Issue created by migration from https://trac.sagemath.org/ticket/17284_





---

archive/issue_events_220815.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T07:31:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220815"
}
```



---

archive/issue_events_220816.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T07:31:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "component: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220816"
}
```



---

archive/issue_events_220817.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T07:31:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220817"
}
```



---

archive/issue_events_220818.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-04T07:31:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220818"
}
```



---

archive/issue_comments_233328.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,9 +4,22 @@\n sage: cube(viewer=\"tachyon\")\n ```\n \n-The following still works:\n+The following patch fixes the problem (but probably not in the correct way):\n \n+```diff\n+diff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py\n+index 670d208..a352a54 100644\n+--- a/src/sage/repl/display/formatter.py\n++++ b/src/sage/repl/display/formatter.py\n+@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):\n+         \"\"\"\n+         from sage.structure.sage_object import SageObject\n+         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):\n+-            gfx = obj._graphics_()\n+-            if gfx: \n+-                gfx.launch_viewer()\n+-                return ''\n++            obj.show()\n++            return ''\n+         return super(SageConsoleTextFormatter, self).__call__(obj)\n ```\n-sage: cube(viewer=\"tachyon\").show()\n-```\n-\n``````\n",
    "created_at": "2014-11-04T07:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233328",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,9 +4,22 @@
 sage: cube(viewer="tachyon")
 ```
 
-The following still works:
+The following patch fixes the problem (but probably not in the correct way):
 
+```diff
+diff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py
+index 670d208..a352a54 100644
+--- a/src/sage/repl/display/formatter.py
++++ b/src/sage/repl/display/formatter.py
+@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):
+         """
+         from sage.structure.sage_object import SageObject
+         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):
+-            gfx = obj._graphics_()
+-            if gfx: 
+-                gfx.launch_viewer()
+-                return ''
++            obj.show()
++            return ''
+         return super(SageConsoleTextFormatter, self).__call__(obj)
 ```
-sage: cube(viewer="tachyon").show()
-```
-
``````




---

archive/issue_comments_233329.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nYeah, I think that was more or less the previous code, huh?  But would it break showing graphics correctly in sagenb or ipynb?",
    "created_at": "2014-11-04T14:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233329",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'>Comment 2:</a>
Yeah, I think that was more or less the previous code, huh?  But would it break showing graphics correctly in sagenb or ipynb?



---

archive/issue_comments_233330.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThis does work here from the command line. The notebook also seems OK. However, the ipynb seems to be malfunctioning. The default in ipynb is Tachyon, i.e. `cube()` returns a Tachyon rendered image. And `cube(viewer='jmol')` also returns a Tachyon image. `cube().show(viewer='jmol')` does return a jmol rendered image in the jmol viewer.",
    "created_at": "2014-11-04T16:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233330",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:3'>Comment 3:</a>
This does work here from the command line. The notebook also seems OK. However, the ipynb seems to be malfunctioning. The default in ipynb is Tachyon, i.e. `cube()` returns a Tachyon rendered image. And `cube(viewer='jmol')` also returns a Tachyon image. `cube().show(viewer='jmol')` does return a jmol rendered image in the jmol viewer.



---

archive/issue_comments_233331.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nIPython notebook doesn't support 3d plots yet.",
    "created_at": "2014-11-04T17:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233331",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'>Comment 4:</a>
IPython notebook doesn't support 3d plots yet.



---

archive/issue_comments_233332.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI may be mistaken but on a previous trying of the IPython notebook (when I can't remember) something like `cube()` would spawn the external jmol viewer, which is not the case now.",
    "created_at": "2014-11-04T18:07:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233332",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'>Comment 5:</a>
I may be mistaken but on a previous trying of the IPython notebook (when I can't remember) something like `cube()` would spawn the external jmol viewer, which is not the case now.



---

archive/issue_comments_233333.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nTrue, but neither is the desired outcome",
    "created_at": "2014-11-04T18:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233333",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'>Comment 6:</a>
True, but neither is the desired outcome



---

archive/issue_comments_233334.json:
```json
{
    "body": "Branch: **[u/vbraun/fix_command_line_plotting_keywords](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/fix_command_line_plotting_keywords)**",
    "created_at": "2014-11-04T20:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233334",
    "user": "https://github.com/vbraun"
}
```

Branch: **[u/vbraun/fix_command_line_plotting_keywords](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/fix_command_line_plotting_keywords)**



---

archive/issue_events_220819.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-04T20:23:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220819"
}
```



---

archive/issue_comments_233335.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2915e6213674568d4317183adddb2ba520d04f43\">2915e62</a></td><td><code>Also use the viewer=... option to decide on 3d graphics output</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6c090e5bd8fcbed1d6f624d37e95c6c5a16093c\">c6c090e</a></td><td><code>Make sure that _extra_kwds is always a dictionary</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f\">c84805c</a></td><td><code>Warn about invalid viewer options</code></td></tr></table>\n",
    "created_at": "2014-11-04T20:23:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233335",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'>Comment 8:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2915e6213674568d4317183adddb2ba520d04f43">2915e62</a></td><td><code>Also use the viewer=... option to decide on 3d graphics output</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6c090e5bd8fcbed1d6f624d37e95c6c5a16093c">c6c090e</a></td><td><code>Make sure that _extra_kwds is always a dictionary</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f">c84805c</a></td><td><code>Warn about invalid viewer options</code></td></tr></table>




---

archive/issue_comments_233336.json:
```json
{
    "body": "Commit: **[c84805c](https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f)**",
    "created_at": "2014-11-04T20:23:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233336",
    "user": "https://github.com/vbraun"
}
```

Commit: **[c84805c](https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f)**



---

archive/issue_comments_233337.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2014-11-04T20:23:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233337",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_233338.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI can't test it out immediately because I don't have time to compile up to rc1 right now, but this seems okay.  \n\nOnly one question - there are other viewers (e.g. canvas3d) available in the notebook, so I assume this code will only be reached in the command line?  Currently we get, in the command line,\n\n```\n\nsage: cube().show(viewer='canvas3d')\n---------------------------------------------------------------------------\n<snip>\nUnboundLocalError: local variable 'viewer_app' referenced before assignment\n```\nwhich isn't all that helpful either, I have to admit.",
    "created_at": "2014-11-04T20:38:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233338",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'>Comment 9:</a>
I can't test it out immediately because I don't have time to compile up to rc1 right now, but this seems okay.  

Only one question - there are other viewers (e.g. canvas3d) available in the notebook, so I assume this code will only be reached in the command line?  Currently we get, in the command line,

```

sage: cube().show(viewer='canvas3d')
---------------------------------------------------------------------------
<snip>
UnboundLocalError: local variable 'viewer_app' referenced before assignment
```
which isn't all that helpful either, I have to admit.



---

archive/issue_comments_233339.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThis shouldn't change anything on SageNB.\n\nOther viewers are not supported on the command line, nothing changed there:\n\n```\nsage: cube(viewer='canvas3d')\n/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=canvas3d is not supported\n  gfx = obj._graphics_()\n```\nReally, the issue is the code quality in the 3d plots. Everything and their dog is lumped in a giant `show()` method with tons of if-branches, behaving slightly different depending on some global variables. I'll break all that up into separate methods in #17234.",
    "created_at": "2014-11-04T21:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233339",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'>Comment 10:</a>
This shouldn't change anything on SageNB.

Other viewers are not supported on the command line, nothing changed there:

```
sage: cube(viewer='canvas3d')
/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=canvas3d is not supported
  gfx = obj._graphics_()
```
Really, the issue is the code quality in the 3d plots. Everything and their dog is lumped in a giant `show()` method with tons of if-branches, behaving slightly different depending on some global variables. I'll break all that up into separate methods in #17234.



---

archive/issue_comments_233340.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nWhy do we reinvent the `show()` wheel inside `_graphics_()`?",
    "created_at": "2014-11-04T21:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233340",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
Why do we reinvent the `show()` wheel inside `_graphics_()`?



---

archive/issue_comments_233341.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nIn other words, what's wrong with:\n\n```\ndef _graphics_(self, **kwds):\n    self.show(**kwds)\n```\n\nEven if there is something wrong with the above, perhaps the right solution is to fix `show()` instead of inventing a new function `_graphics_` doing mostly the same.",
    "created_at": "2014-11-04T21:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233341",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'>Comment 12:</a>
In other words, what's wrong with:

```
def _graphics_(self, **kwds):
    self.show(**kwds)
```

Even if there is something wrong with the above, perhaps the right solution is to fix `show()` instead of inventing a new function `_graphics_` doing mostly the same.



---

archive/issue_comments_233342.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@kcrisman](#comment%3A9):\n> Currently we get, in the command line,\n> \n> ```\n> \n> sage: cube().show(viewer='canvas3d')\n> ---------------------------------------------------------------------------\n> <snip>\n> UnboundLocalError: local variable 'viewer_app' referenced before assignment\n> ```\n\nThis is fixed in #16640 by raising a better error message.",
    "created_at": "2014-11-04T22:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233342",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@kcrisman](#comment%3A9):
> Currently we get, in the command line,
> 
> ```
> 
> sage: cube().show(viewer='canvas3d')
> ---------------------------------------------------------------------------
> <snip>
> UnboundLocalError: local variable 'viewer_app' referenced before assignment
> ```

This is fixed in #16640 by raising a better error message.



---

archive/issue_comments_233343.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\n`_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. \n\nEverything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.",
    "created_at": "2014-11-04T22:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233343",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'>Comment 14:</a>
`_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. 

Everything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.



---

archive/issue_comments_233344.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@vbraun](#comment%3A14):\n> `_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. \n> \n> Everything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.\n\nIf your solution is to *move* stuff from `show` to somewhere else, I agree. Just don't \"fix\" `show` by re-inventing its functionality.\n\n(I have seen the following too often: X is broken. Instead of fixing X, somebody invents Y which is similar to X but with other bugs)",
    "created_at": "2014-11-04T22:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233344",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@vbraun](#comment%3A14):
> `_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. 
> 
> Everything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.

If your solution is to *move* stuff from `show` to somewhere else, I agree. Just don't "fix" `show` by re-inventing its functionality.

(I have seen the following too often: X is broken. Instead of fixing X, somebody invents Y which is similar to X but with other bugs)



---

archive/issue_comments_233345.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThe whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time. There needs to be some infrastructure to arbitrate between backend capabilities and user preferences. But I sure as hell don't want to reinvent how `show()` works, I'm getting PTSD whenever I look in there.",
    "created_at": "2014-11-04T23:27:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233345",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'>Comment 16:</a>
The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time. There needs to be some infrastructure to arbitrate between backend capabilities and user preferences. But I sure as hell don't want to reinvent how `show()` works, I'm getting PTSD whenever I look in there.



---

archive/issue_comments_233346.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nIs this the intended behavior? From the notebook\n\n```\nsphere(viewer='java')\n```       \t\n\n```\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\\\ns/IPython/core/formatters.py:239: FormatterWarning: Exception in\ntext/plain formatter: Unknown 3d plot type: java\n  FormatterWarning,\nNone\n```\n\nwith no output, which is what I would expect. But from the Sage prompt\n\n```\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=java is not supported\n  gfx = obj._graphics_()\n```\n\nand the jmol viewer is spawned. And if `sphere(viewer='java')` is typed again there is no warning and the jmol viewer is spawned.",
    "created_at": "2014-11-04T23:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233346",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:17'>Comment 17:</a>
Is this the intended behavior? From the notebook

```
sphere(viewer='java')
```       	

```
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\
s/IPython/core/formatters.py:239: FormatterWarning: Exception in
text/plain formatter: Unknown 3d plot type: java
  FormatterWarning,
None
```

with no output, which is what I would expect. But from the Sage prompt

```
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=java is not supported
  gfx = obj._graphics_()
```

and the jmol viewer is spawned. And if `sphere(viewer='java')` is typed again there is no warning and the jmol viewer is spawned.



---

archive/issue_comments_233347.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@vbraun](#comment%3A16):\n> The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time.\n\nI never said that `show()` was good, I'm just warning: don't make it worse! IMHO, the introduction of `_graphics_` *did* make things worse but maybe that's just a local minimum.",
    "created_at": "2014-11-05T07:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233347",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@vbraun](#comment%3A16):
> The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time.

I never said that `show()` was good, I'm just warning: don't make it worse! IMHO, the introduction of `_graphics_` *did* make things worse but maybe that's just a local minimum.



---

archive/issue_comments_233348.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nHad I tacked on the IPython notebook with yet another global variable and extra if branches then it would have caused bugs, too...",
    "created_at": "2014-11-05T10:14:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233348",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'>Comment 19:</a>
Had I tacked on the IPython notebook with yet another global variable and extra if branches then it would have caused bugs, too...



---

archive/issue_comments_233349.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@strogdon](#comment%3A17):\n> Is this the intended behavior? From the notebook\n> \n> ```\n> sphere(viewer='java')\n> /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\\\n> s/IPython/core/formatters.py:239: FormatterWarning: Exception in\n> text/plain formatter: Unknown 3d plot type: java\n>   FormatterWarning,\n> None\n> ```\n\nAs far as I'm concerned, this is the regrettable state of current affairs but not really on-topic for this ticket. Sphere should validate input when the graphics object is created, not fall flat on its face later on when it is about to be drawn.",
    "created_at": "2014-11-05T10:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233349",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@strogdon](#comment%3A17):
> Is this the intended behavior? From the notebook
> 
> ```
> sphere(viewer='java')
> /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\
> s/IPython/core/formatters.py:239: FormatterWarning: Exception in
> text/plain formatter: Unknown 3d plot type: java
>   FormatterWarning,
> None
> ```

As far as I'm concerned, this is the regrettable state of current affairs but not really on-topic for this ticket. Sphere should validate input when the graphics object is created, not fall flat on its face later on when it is about to be drawn.



---

archive/issue_comments_233350.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nTwo comments that hopefully will keep us on target:\n> Is this the intended behavior? From the notebook `sphere(viewer='java')` ...\n\nNo, but I think this was already the case earlier, although the error messages probably will have changed.  We can't necessarily validate EVERY input, as I've been told when I've attempted to on many other tickets... incidentally, there is the `java3d` viewer or something like it, but again that only works (actually, doesn't, there is a ticket for that too) in the notebook.\n> Why do we reinvent the show() wheel inside _graphics_()?  <and that discussion>\n\nThis is a noble goal and I totally agree that the 3d graphics show code is miserable due to accretion of layers over the years, but I think it probably isn't really worth the effort to fix that *right now* because it will be pretty hard to test for all possible bugs easily.  On the other hand, putting something like that in an early beta someday when there aren't actual bugs to fix seems fine.\n\nIt's also worth pointing out that one reason that is so messy is because the actual creation of most plots is viewer-agnostic, which was deemed to be \"a good thing\" by TBDFL.",
    "created_at": "2014-11-05T13:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233350",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'>Comment 21:</a>
Two comments that hopefully will keep us on target:
> Is this the intended behavior? From the notebook `sphere(viewer='java')` ...

No, but I think this was already the case earlier, although the error messages probably will have changed.  We can't necessarily validate EVERY input, as I've been told when I've attempted to on many other tickets... incidentally, there is the `java3d` viewer or something like it, but again that only works (actually, doesn't, there is a ticket for that too) in the notebook.
> Why do we reinvent the show() wheel inside _graphics_()?  <and that discussion>

This is a noble goal and I totally agree that the 3d graphics show code is miserable due to accretion of layers over the years, but I think it probably isn't really worth the effort to fix that *right now* because it will be pretty hard to test for all possible bugs easily.  On the other hand, putting something like that in an early beta someday when there aren't actual bugs to fix seems fine.

It's also worth pointing out that one reason that is so messy is because the actual creation of most plots is viewer-agnostic, which was deemed to be "a good thing" by TBDFL.



---

archive/issue_comments_233351.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nCreation of plots should of course be viewer-agnostic. The problem is that the modularity stops there and drops into a monolithic if-branch thicket (that is moreover hard to test). There are more modular problems here, like creating the rendering / viewer files, what to do with the output files, arbitrating capabilities versus user preferences.",
    "created_at": "2014-11-05T13:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233351",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'>Comment 22:</a>
Creation of plots should of course be viewer-agnostic. The problem is that the modularity stops there and drops into a monolithic if-branch thicket (that is moreover hard to test). There are more modular problems here, like creating the rendering / viewer files, what to do with the output files, arbitrating capabilities versus user preferences.



---

archive/issue_comments_233352.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI guess you already know the following; I'm just posting for the sake of completeness. The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker. Which is not surprising in hindsight: it changed the `_graphics_` implementation from `self.show()` to something which does `self.save(filename)` with a JMOL file unless some different `mime_types` gets passed. Which is exactly the location Volker's current branch here is tweaking.",
    "created_at": "2014-11-05T13:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233352",
    "user": "https://github.com/gagern"
}
```

<a id='comment:23'>Comment 23:</a>
I guess you already know the following; I'm just posting for the sake of completeness. The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker. Which is not surprising in hindsight: it changed the `_graphics_` implementation from `self.show()` to something which does `self.save(filename)` with a JMOL file unless some different `mime_types` gets passed. Which is exactly the location Volker's current branch here is tweaking.



---

archive/issue_comments_233353.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\n> I guess you already know the following; I'm just posting for the sake of completeness. \n\nThanks for confirming this.\n\nIf you have already tried this and are satisfied with the code and behavior, feel free to put positive review - I haven't been able to upgrade Sage to the right place yet.",
    "created_at": "2014-11-05T13:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233353",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'>Comment 24:</a>
> I guess you already know the following; I'm just posting for the sake of completeness. 

Thanks for confirming this.

If you have already tried this and are satisfied with the code and behavior, feel free to put positive review - I haven't been able to upgrade Sage to the right place yet.



---

archive/issue_comments_233354.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@gagern](#comment%3A23):\n> The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.\n\nWhich is also precisely why the current `show()` is such a pile of shit: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.",
    "created_at": "2014-11-05T14:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233354",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@gagern](#comment%3A23):
> The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.

Which is also precisely why the current `show()` is such a pile of shit: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.



---

archive/issue_comments_233355.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\n> > The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.\n\n> \n> Which is also precisely why the current `show()` is such a pile of ****: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.\n\nTrue, though that *still* might not make dealing with it worth the while as compared to other things one could spend time on.  That's why I always visually tested output when I reviewed changes in things related to it, though probably one would want to do so in any case - esp. given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.",
    "created_at": "2014-11-05T14:31:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233355",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:26'>Comment 26:</a>
> > The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.

> 
> Which is also precisely why the current `show()` is such a pile of ****: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.

True, though that *still* might not make dealing with it worth the while as compared to other things one could spend time on.  That's why I always visually tested output when I reviewed changes in things related to it, though probably one would want to do so in any case - esp. given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.



---

archive/issue_comments_233356.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@kcrisman](#comment%3A26):\n> given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.\n\nWe could in theory hash the resulting PNG file and check that in a doctest. However, I don't know how workable that would be in practice.",
    "created_at": "2014-11-05T14:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233356",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@kcrisman](#comment%3A26):
> given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.

We could in theory hash the resulting PNG file and check that in a doctest. However, I don't know how workable that would be in practice.



---

archive/issue_comments_233357.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nApart from testing that the output pipeline ends in the place we thought it ends, we should also compare with the resulting rastered image (though was not what I was talking about previously). We can't do pixel comparisons because that might depend on rounding, installed fonts, and/or freetype version. The classical algorithm for that is to break up your picture in a grid (say, 10x10) and compare the color histogram in each sector with a small tolerance.",
    "created_at": "2014-11-05T14:48:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233357",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'>Comment 28:</a>
Apart from testing that the output pipeline ends in the place we thought it ends, we should also compare with the resulting rastered image (though was not what I was talking about previously). We can't do pixel comparisons because that might depend on rounding, installed fonts, and/or freetype version. The classical algorithm for that is to break up your picture in a grid (say, 10x10) and compare the color histogram in each sector with a small tolerance.



---

archive/issue_comments_233358.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\n> This shouldn't change anything on SageNB.\n\nYup, looks good there now that I had a chance, and this does indeed fix the previous problem.",
    "created_at": "2014-11-05T17:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233358",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:29'>Comment 29:</a>
> This shouldn't change anything on SageNB.

Yup, looks good there now that I had a chance, and this does indeed fix the previous problem.



---

archive/issue_comments_233359.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nSince several people have commented here, I'm reluctant to be the final one to set to positive review.  But FWIW I don't hear any complaints about the code itself, just that Sage and show need help and that some undesirable behavior that isn't documented is or isn't still happening.  But the issue at hand seems to be fixed.",
    "created_at": "2014-11-06T14:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233359",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:30'>Comment 30:</a>
Since several people have commented here, I'm reluctant to be the final one to set to positive review.  But FWIW I don't hear any complaints about the code itself, just that Sage and show need help and that some undesirable behavior that isn't documented is or isn't still happening.  But the issue at hand seems to be fixed.



---

archive/issue_comments_233360.json:
```json
{
    "body": "Reviewer: **Steven Trogdon, Karl-Dieter Crisman, Jeroen Demeyer, Martin von Gagern**",
    "created_at": "2014-11-06T14:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233360",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Steven Trogdon, Karl-Dieter Crisman, Jeroen Demeyer, Martin von Gagern**



---

archive/issue_comments_233361.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nCan somebody grow a pair and set this to positive review already?",
    "created_at": "2014-11-09T12:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233361",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'>Comment 31:</a>
Can somebody grow a pair and set this to positive review already?



---

archive/issue_events_220820.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2014-11-10T23:31:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220820"
}
```



---

archive/issue_events_220821.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2014-11-10T23:31:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220821"
}
```



---

archive/issue_comments_233362.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nI think all the people commenting here didn't really have a problem with the code, since you don't want to push the button yourself Volker I'll do it on behalf of all those commentators.",
    "created_at": "2014-11-10T23:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233362",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'>Comment 32:</a>
I think all the people commenting here didn't really have a problem with the code, since you don't want to push the button yourself Volker I'll do it on behalf of all those commentators.



---

archive/issue_events_220822.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-11T17:00:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220822"
}
```



---

archive/issue_events_220823.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f02afd1d98d5712f3250a9ba49c2f32d46b7aad0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-11-11T17:00:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17284#event-220823"
}
```



---

archive/issue_comments_233363.json:
```json
{
    "body": "Changed branch from **[u/vbraun/fix_command_line_plotting_keywords](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/fix_command_line_plotting_keywords)** to **[c84805c](https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f)**",
    "created_at": "2014-11-11T17:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17284#issuecomment-233363",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vbraun/fix_command_line_plotting_keywords](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/fix_command_line_plotting_keywords)** to **[c84805c](https://github.com/sagemath/sagetrac-mirror/commit/c84805cafa9c5d1310145c9e31cd59e31fb7668f)**
