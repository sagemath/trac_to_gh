# Issue 17284: Fix command-line plotting keywords

archive/issues_017047.json:
```json
{
    "body": "This should open a Tachyon-rendered plot (and this worked until very recently):\n\n```\nsage: cube(viewer=\"tachyon\")\n```\n\nThe following patch fixes the problem (but probably not in the correct way):\n\n```diff\ndiff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py\nindex 670d208..a352a54 100644\n--- a/src/sage/repl/display/formatter.py\n+++ b/src/sage/repl/display/formatter.py\n@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):\n         \"\"\"\n         from sage.structure.sage_object import SageObject\n         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):\n-            gfx = obj._graphics_()\n-            if gfx: \n-                gfx.launch_viewer()\n-                return ''\n+            obj.show()\n+            return ''\n         return super(SageConsoleTextFormatter, self).__call__(obj)\n```\n\nCC:  @vbraun @kcrisman @strogdon\n\nBranch/Commit: c84805cafa9c5d1310145c9e31cd59e31fb7668f\n\nReviewer: Steven Trogdon, Karl-Dieter Crisman, Jeroen Demeyer, Martin von Gagern\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17284\n\n",
    "closed_at": "2014-11-11T17:00:07Z",
    "created_at": "2014-11-04T07:31:06Z",
    "labels": [
        "component: graphics",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Fix command-line plotting keywords",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17284",
    "user": "https://github.com/jdemeyer"
}
```
This should open a Tachyon-rendered plot (and this worked until very recently):

```
sage: cube(viewer="tachyon")
```

The following patch fixes the problem (but probably not in the correct way):

```diff
diff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py
index 670d208..a352a54 100644
--- a/src/sage/repl/display/formatter.py
+++ b/src/sage/repl/display/formatter.py
@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):
         """
         from sage.structure.sage_object import SageObject
         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):
-            gfx = obj._graphics_()
-            if gfx: 
-                gfx.launch_viewer()
-                return ''
+            obj.show()
+            return ''
         return super(SageConsoleTextFormatter, self).__call__(obj)
```

CC:  @vbraun @kcrisman @strogdon

Branch/Commit: c84805cafa9c5d1310145c9e31cd59e31fb7668f

Reviewer: Steven Trogdon, Karl-Dieter Crisman, Jeroen Demeyer, Martin von Gagern

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17284





---

archive/issue_comments_241157.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -4,10 +4,24 @@\n sage: cube(viewer=\"tachyon\")\n \\`\\`\\`\n \n-The following still works:\n+The following patch fixes the problem (but probably not in the correct way):\n \n-\\`\\`\\`\n-sage: cube(viewer=\"tachyon\").show()\n+\\`\\`\\`diff\n+diff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py\n+index 670d208..a352a54 100644\n+--- a/src/sage/repl/display/formatter.py\n++++ b/src/sage/repl/display/formatter.py\n+@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):\n+         \"\"\"\n+         from sage.structure.sage_object import SageObject\n+         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):\n+-            gfx = obj._graphics_()\n+-            if gfx: \n+-                gfx.launch_viewer()\n+-                return ''\n++            obj.show()\n++            return ''\n+         return super(SageConsoleTextFormatter, self).__call__(obj)\n \\`\\`\\`\n \n Comment: 1\n```\n",
    "created_at": "2014-11-04T07:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241157",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -4,10 +4,24 @@
 sage: cube(viewer="tachyon")
 \`\`\`
 
-The following still works:
+The following patch fixes the problem (but probably not in the correct way):
 
-\`\`\`
-sage: cube(viewer="tachyon").show()
+\`\`\`diff
+diff --git a/src/sage/repl/display/formatter.py b/src/sage/repl/display/formatter.py
+index 670d208..a352a54 100644
+--- a/src/sage/repl/display/formatter.py
++++ b/src/sage/repl/display/formatter.py
+@@ -377,8 +377,6 @@ class SageConsoleTextFormatter(SagePlainTextFormatter):
+         """
+         from sage.structure.sage_object import SageObject
+         if isinstance(obj, SageObject) and hasattr(obj, '_graphics_'):
+-            gfx = obj._graphics_()
+-            if gfx: 
+-                gfx.launch_viewer()
+-                return ''
++            obj.show()
++            return ''
+         return super(SageConsoleTextFormatter, self).__call__(obj)
 \`\`\`
 
 Comment: 1
```




---

archive/issue_comments_241158.json:
```json
{
    "body": "<a id='comment:2'></a>Yeah, I think that was more or less the previous code, huh?  But would it break showing graphics correctly in sagenb or ipynb?",
    "created_at": "2014-11-04T14:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241158",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>Yeah, I think that was more or less the previous code, huh?  But would it break showing graphics correctly in sagenb or ipynb?



---

archive/issue_comments_241159.json:
```json
{
    "body": "<a id='comment:3'></a>This does work here from the command line. The notebook also seems OK. However, the ipynb seems to be malfunctioning. The default in ipynb is Tachyon, i.e. `cube()` returns a Tachyon rendered image. And `cube(viewer='jmol')` also returns a Tachyon image. `cube().show(viewer='jmol')` does return a jmol rendered image in the jmol viewer.",
    "created_at": "2014-11-04T16:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241159",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:3'></a>This does work here from the command line. The notebook also seems OK. However, the ipynb seems to be malfunctioning. The default in ipynb is Tachyon, i.e. `cube()` returns a Tachyon rendered image. And `cube(viewer='jmol')` also returns a Tachyon image. `cube().show(viewer='jmol')` does return a jmol rendered image in the jmol viewer.



---

archive/issue_comments_241160.json:
```json
{
    "body": "<a id='comment:4'></a>IPython notebook doesn't support 3d plots yet.",
    "created_at": "2014-11-04T17:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241160",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>IPython notebook doesn't support 3d plots yet.



---

archive/issue_comments_241161.json:
```json
{
    "body": "<a id='comment:5'></a>I may be mistaken but on a previous trying of the IPython notebook (when I can't remember) something like `cube()` would spawn the external jmol viewer, which is not the case now.",
    "created_at": "2014-11-04T18:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241161",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>I may be mistaken but on a previous trying of the IPython notebook (when I can't remember) something like `cube()` would spawn the external jmol viewer, which is not the case now.



---

archive/issue_comments_241162.json:
```json
{
    "body": "<a id='comment:6'></a>True, but neither is the desired outcome",
    "created_at": "2014-11-04T18:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241162",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>True, but neither is the desired outcome



---

archive/issue_comments_241163.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-04T20:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241163",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_241164.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2014-11-04T20:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241164",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_241165.json:
```json
{
    "body": "<a id='comment:9'></a>I can't test it out immediately because I don't have time to compile up to rc1 right now, but this seems okay.  \n\nOnly one question - there are other viewers (e.g. canvas3d) available in the notebook, so I assume this code will only be reached in the command line?  Currently we get, in the command line,\n\n```\n\nsage: cube().show(viewer='canvas3d')\n---------------------------------------------------------------------------\n<snip>\nUnboundLocalError: local variable 'viewer_app' referenced before assignment\n```\nwhich isn't all that helpful either, I have to admit.",
    "created_at": "2014-11-04T20:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241165",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>I can't test it out immediately because I don't have time to compile up to rc1 right now, but this seems okay.  

Only one question - there are other viewers (e.g. canvas3d) available in the notebook, so I assume this code will only be reached in the command line?  Currently we get, in the command line,

```

sage: cube().show(viewer='canvas3d')
---------------------------------------------------------------------------
<snip>
UnboundLocalError: local variable 'viewer_app' referenced before assignment
```
which isn't all that helpful either, I have to admit.



---

archive/issue_comments_241166.json:
```json
{
    "body": "<a id='comment:10'></a>This shouldn't change anything on SageNB.\n\nOther viewers are not supported on the command line, nothing changed there:\n\n```\nsage: cube(viewer='canvas3d')\n/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=canvas3d is not supported\n  gfx = obj._graphics_()\n```\nReally, the issue is the code quality in the 3d plots. Everything and their dog is lumped in a giant `show()` method with tons of if-branches, behaving slightly different depending on some global variables. I'll break all that up into separate methods in #17234.",
    "created_at": "2014-11-04T21:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241166",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>This shouldn't change anything on SageNB.

Other viewers are not supported on the command line, nothing changed there:

```
sage: cube(viewer='canvas3d')
/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=canvas3d is not supported
  gfx = obj._graphics_()
```
Really, the issue is the code quality in the 3d plots. Everything and their dog is lumped in a giant `show()` method with tons of if-branches, behaving slightly different depending on some global variables. I'll break all that up into separate methods in #17234.



---

archive/issue_comments_241167.json:
```json
{
    "body": "<a id='comment:11'></a>Why do we reinvent the `show()` wheel inside `_graphics_()`?",
    "created_at": "2014-11-04T21:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241167",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Why do we reinvent the `show()` wheel inside `_graphics_()`?



---

archive/issue_comments_241168.json:
```json
{
    "body": "<a id='comment:12'></a>In other words, what's wrong with:\n\n```\ndef _graphics_(self, **kwds):\n    self.show(**kwds)\n```\n\nEven if there is something wrong with the above, perhaps the right solution is to fix `show()` instead of inventing a new function `_graphics_` doing mostly the same.",
    "created_at": "2014-11-04T21:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241168",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>In other words, what's wrong with:

```
def _graphics_(self, **kwds):
    self.show(**kwds)
```

Even if there is something wrong with the above, perhaps the right solution is to fix `show()` instead of inventing a new function `_graphics_` doing mostly the same.



---

archive/issue_comments_241169.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:9 kcrisman]:\n> Currently we get, in the command line,\n> \n> ```\n> \n> sage: cube().show(viewer='canvas3d')\n> ---------------------------------------------------------------------------\n> <snip>\n> UnboundLocalError: local variable 'viewer_app' referenced before assignment\n> ```\n\n\nThis is fixed in #16640 by raising a better error message.",
    "created_at": "2014-11-04T22:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241169",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:9 kcrisman]:
> Currently we get, in the command line,
> 
> ```
> 
> sage: cube().show(viewer='canvas3d')
> ---------------------------------------------------------------------------
> <snip>
> UnboundLocalError: local variable 'viewer_app' referenced before assignment
> ```


This is fixed in #16640 by raising a better error message.



---

archive/issue_comments_241170.json:
```json
{
    "body": "<a id='comment:14'></a>`_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. \n\nEverything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.",
    "created_at": "2014-11-04T22:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241170",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>`_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. 

Everything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.



---

archive/issue_comments_241171.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 vbraun]:\n> `_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. \n> \n> Everything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.\n\nIf your solution is to *move* stuff from `show` to somewhere else, I agree. Just don't \"fix\" `show` by re-inventing its functionality.\n\n(I have seen the following too often: X is broken. Instead of fixing X, somebody invents Y which is similar to X but with other bugs)",
    "created_at": "2014-11-04T22:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241171",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Replying to [comment:14 vbraun]:
> `_graphics_` only handles finding the appropriate output. The actual generation of graphics files is dispatched elsewhere. And no global variables allowed. 
> 
> Everything is wrong with `show`, its a giant pile of shite. I'm slowly refactoring it into something maintainable if we have 3+ separate output channels.

If your solution is to *move* stuff from `show` to somewhere else, I agree. Just don't "fix" `show` by re-inventing its functionality.

(I have seen the following too often: X is broken. Instead of fixing X, somebody invents Y which is similar to X but with other bugs)



---

archive/issue_comments_241172.json:
```json
{
    "body": "<a id='comment:16'></a>The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time. There needs to be some infrastructure to arbitrate between backend capabilities and user preferences. But I sure as hell don't want to reinvent how `show()` works, I'm getting PTSD whenever I look in there.",
    "created_at": "2014-11-04T23:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241172",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time. There needs to be some infrastructure to arbitrate between backend capabilities and user preferences. But I sure as hell don't want to reinvent how `show()` works, I'm getting PTSD whenever I look in there.



---

archive/issue_comments_241173.json:
```json
{
    "body": "<a id='comment:17'></a>Is this the intended behavior? From the notebook\n\n```\nsphere(viewer='java')\n```       \t\n\n```\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\\\ns/IPython/core/formatters.py:239: FormatterWarning: Exception in\ntext/plain formatter: Unknown 3d plot type: java\n  FormatterWarning,\nNone\n```\n\nwith no output, which is what I would expect. But from the Sage prompt\n\n```\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=java is not supported\n  gfx = obj._graphics_()\n```\n\nand the jmol viewer is spawned. And if `sphere(viewer='java')` is typed again there is no warning and the jmol viewer is spawned.",
    "created_at": "2014-11-04T23:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241173",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:17'></a>Is this the intended behavior? From the notebook

```
sphere(viewer='java')
```       	

```
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\
s/IPython/core/formatters.py:239: FormatterWarning: Exception in
text/plain formatter: Unknown 3d plot type: java
  FormatterWarning,
None
```

with no output, which is what I would expect. But from the Sage prompt

```
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py:380: UserWarning: viewer=java is not supported
  gfx = obj._graphics_()
```

and the jmol viewer is spawned. And if `sphere(viewer='java')` is typed again there is no warning and the jmol viewer is spawned.



---

archive/issue_comments_241174.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 vbraun]:\n> The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time.\n\nI never said that `show()` was good, I'm just warning: don't make it worse! IMHO, the introduction of `_graphics_` *did* make things worse but maybe that's just a local minimum.",
    "created_at": "2014-11-05T07:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241174",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:16 vbraun]:
> The whole premise of using a handful of global variables to steer the output pipeline is IMHO utter crap. It didn't work well when we had a single Notebook, and it sure as hell is a nightmare if we want to deal with 3 different notebooks at the same time.

I never said that `show()` was good, I'm just warning: don't make it worse! IMHO, the introduction of `_graphics_` *did* make things worse but maybe that's just a local minimum.



---

archive/issue_comments_241175.json:
```json
{
    "body": "<a id='comment:19'></a>Had I tacked on the IPython notebook with yet another global variable and extra if branches then it would have caused bugs, too...",
    "created_at": "2014-11-05T10:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241175",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>Had I tacked on the IPython notebook with yet another global variable and extra if branches then it would have caused bugs, too...



---

archive/issue_comments_241176.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:17 strogdon]:\n> Is this the intended behavior? From the notebook\n> \n> ```\n> sphere(viewer='java')\n> /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\\\n> s/IPython/core/formatters.py:239: FormatterWarning: Exception in\n> text/plain formatter: Unknown 3d plot type: java\n>   FormatterWarning,\n> None\n> ```\n\n\nAs far as I'm concerned, this is the regrettable state of current affairs but not really on-topic for this ticket. Sphere should validate input when the graphics object is created, not fall flat on its face later on when it is about to be drawn.",
    "created_at": "2014-11-05T10:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241176",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>Replying to [comment:17 strogdon]:
> Is this the intended behavior? From the notebook
> 
> ```
> sphere(viewer='java')
> /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-package\
> s/IPython/core/formatters.py:239: FormatterWarning: Exception in
> text/plain formatter: Unknown 3d plot type: java
>   FormatterWarning,
> None
> ```


As far as I'm concerned, this is the regrettable state of current affairs but not really on-topic for this ticket. Sphere should validate input when the graphics object is created, not fall flat on its face later on when it is about to be drawn.



---

archive/issue_comments_241177.json:
```json
{
    "body": "<a id='comment:21'></a>Two comments that hopefully will keep us on target:\n> Is this the intended behavior? From the notebook `sphere(viewer='java')` ...\n\nNo, but I think this was already the case earlier, although the error messages probably will have changed.  We can't necessarily validate EVERY input, as I've been told when I've attempted to on many other tickets... incidentally, there is the `java3d` viewer or something like it, but again that only works (actually, doesn't, there is a ticket for that too) in the notebook.\n> Why do we reinvent the show() wheel inside _graphics_()?  <and that discussion>\n\nThis is a noble goal and I totally agree that the 3d graphics show code is miserable due to accretion of layers over the years, but I think it probably isn't really worth the effort to fix that *right now* because it will be pretty hard to test for all possible bugs easily.  On the other hand, putting something like that in an early beta someday when there aren't actual bugs to fix seems fine.\n\nIt's also worth pointing out that one reason that is so messy is because the actual creation of most plots is viewer-agnostic, which was deemed to be \"a good thing\" by TBDFL.",
    "created_at": "2014-11-05T13:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241177",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>Two comments that hopefully will keep us on target:
> Is this the intended behavior? From the notebook `sphere(viewer='java')` ...

No, but I think this was already the case earlier, although the error messages probably will have changed.  We can't necessarily validate EVERY input, as I've been told when I've attempted to on many other tickets... incidentally, there is the `java3d` viewer or something like it, but again that only works (actually, doesn't, there is a ticket for that too) in the notebook.
> Why do we reinvent the show() wheel inside _graphics_()?  <and that discussion>

This is a noble goal and I totally agree that the 3d graphics show code is miserable due to accretion of layers over the years, but I think it probably isn't really worth the effort to fix that *right now* because it will be pretty hard to test for all possible bugs easily.  On the other hand, putting something like that in an early beta someday when there aren't actual bugs to fix seems fine.

It's also worth pointing out that one reason that is so messy is because the actual creation of most plots is viewer-agnostic, which was deemed to be "a good thing" by TBDFL.



---

archive/issue_comments_241178.json:
```json
{
    "body": "<a id='comment:22'></a>Creation of plots should of course be viewer-agnostic. The problem is that the modularity stops there and drops into a monolithic if-branch thicket (that is moreover hard to test). There are more modular problems here, like creating the rendering / viewer files, what to do with the output files, arbitrating capabilities versus user preferences.",
    "created_at": "2014-11-05T13:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241178",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>Creation of plots should of course be viewer-agnostic. The problem is that the modularity stops there and drops into a monolithic if-branch thicket (that is moreover hard to test). There are more modular problems here, like creating the rendering / viewer files, what to do with the output files, arbitrating capabilities versus user preferences.



---

archive/issue_comments_241179.json:
```json
{
    "body": "<a id='comment:23'></a>I guess you already know the following; I'm just posting for the sake of completeness. The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](http://git.sagemath.org/sage.git/commit/?id=e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker. Which is not surprising in hindsight: it changed the `_graphics_` implementation from `self.show()` to something which does `self.save(filename)` with a JMOL file unless some different `mime_types` gets passed. Which is exactly the location Volker's current branch here is tweaking.",
    "created_at": "2014-11-05T13:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241179",
    "user": "https://github.com/gagern"
}
```

<a id='comment:23'></a>I guess you already know the following; I'm just posting for the sake of completeness. The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](http://git.sagemath.org/sage.git/commit/?id=e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker. Which is not surprising in hindsight: it changed the `_graphics_` implementation from `self.show()` to something which does `self.save(filename)` with a JMOL file unless some different `mime_types` gets passed. Which is exactly the location Volker's current branch here is tweaking.



---

archive/issue_comments_241180.json:
```json
{
    "body": "<a id='comment:24'></a>> I guess you already know the following; I'm just posting for the sake of completeness. \n\nThanks for confirming this.\n\nIf you have already tried this and are satisfied with the code and behavior, feel free to put positive review - I haven't been able to upgrade Sage to the right place yet.",
    "created_at": "2014-11-05T13:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241180",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'></a>> I guess you already know the following; I'm just posting for the sake of completeness. 

Thanks for confirming this.

If you have already tried this and are satisfied with the code and behavior, feel free to put positive review - I haven't been able to upgrade Sage to the right place yet.



---

archive/issue_comments_241181.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:23 gagern]:\n> The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](http://git.sagemath.org/sage.git/commit/?id=e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.\n\n\nWhich is also precisely why the current `show()` is such a pile of shit: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.",
    "created_at": "2014-11-05T14:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241181",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Replying to [comment:23 gagern]:
> The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](http://git.sagemath.org/sage.git/commit/?id=e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.


Which is also precisely why the current `show()` is such a pile of shit: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.



---

archive/issue_comments_241182.json:
```json
{
    "body": "<a id='comment:26'></a>> > The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](http://git.sagemath.org/sage.git/commit/?id=e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.\n\n> \n> Which is also precisely why the current `show()` is such a pile of ****: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.\n\n\nTrue, though that *still* might not make dealing with it worth the while as compared to other things one could spend time on.  That's why I always visually tested output when I reviewed changes in things related to it, though probably one would want to do so in any case - esp. given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.",
    "created_at": "2014-11-05T14:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241182",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:26'></a>> > The commit which caused the originally reported problem, i.e. opening JMOL instead of a PNG viewer, was caused by commit [e7e7f9c](http://git.sagemath.org/sage.git/commit/?id=e7e7f9ce036343c4eb414434c93265461f3bced5) by Volker.

> 
> Which is also precisely why the current `show()` is such a pile of ****: virtually no meaningful doctests, any time you touch something it is almost guaranteed to cause an error somewhere.


True, though that *still* might not make dealing with it worth the while as compared to other things one could spend time on.  That's why I always visually tested output when I reviewed changes in things related to it, though probably one would want to do so in any case - esp. given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.



---

archive/issue_comments_241183.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 kcrisman]:\n> given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.\n\nWe could in theory hash the resulting PNG file and check that in a doctest. However, I don't know how workable that would be in practice.",
    "created_at": "2014-11-05T14:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241183",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:26 kcrisman]:
> given that we can't do like mpl and have pre-existing files to test against, at least I don't think so.

We could in theory hash the resulting PNG file and check that in a doctest. However, I don't know how workable that would be in practice.



---

archive/issue_comments_241184.json:
```json
{
    "body": "<a id='comment:28'></a>Apart from testing that the output pipeline ends in the place we thought it ends, we should also compare with the resulting rastered image (though was not what I was talking about previously). We can't do pixel comparisons because that might depend on rounding, installed fonts, and/or freetype version. The classical algorithm for that is to break up your picture in a grid (say, 10x10) and compare the color histogram in each sector with a small tolerance.",
    "created_at": "2014-11-05T14:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241184",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>Apart from testing that the output pipeline ends in the place we thought it ends, we should also compare with the resulting rastered image (though was not what I was talking about previously). We can't do pixel comparisons because that might depend on rounding, installed fonts, and/or freetype version. The classical algorithm for that is to break up your picture in a grid (say, 10x10) and compare the color histogram in each sector with a small tolerance.



---

archive/issue_comments_241185.json:
```json
{
    "body": "<a id='comment:29'></a>> This shouldn't change anything on SageNB.\n\nYup, looks good there now that I had a chance, and this does indeed fix the previous problem.",
    "created_at": "2014-11-05T17:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241185",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:29'></a>> This shouldn't change anything on SageNB.

Yup, looks good there now that I had a chance, and this does indeed fix the previous problem.



---

archive/issue_comments_241186.json:
```json
{
    "body": "<a id='comment:30'></a>Since several people have commented here, I'm reluctant to be the final one to set to positive review.  But FWIW I don't hear any complaints about the code itself, just that Sage and show need help and that some undesirable behavior that isn't documented is or isn't still happening.  But the issue at hand seems to be fixed.",
    "created_at": "2014-11-06T14:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241186",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:30'></a>Since several people have commented here, I'm reluctant to be the final one to set to positive review.  But FWIW I don't hear any complaints about the code itself, just that Sage and show need help and that some undesirable behavior that isn't documented is or isn't still happening.  But the issue at hand seems to be fixed.



---

archive/issue_comments_241187.json:
```json
{
    "body": "<a id='comment:31'></a>Can somebody grow a pair and set this to positive review already?",
    "created_at": "2014-11-09T12:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241187",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>Can somebody grow a pair and set this to positive review already?



---

archive/issue_comments_241188.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-10T23:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241188",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_241189.json:
```json
{
    "body": "<a id='comment:32'></a>I think all the people commenting here didn't really have a problem with the code, since you don't want to push the button yourself Volker I'll do it on behalf of all those commentators.",
    "created_at": "2014-11-10T23:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241189",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>I think all the people commenting here didn't really have a problem with the code, since you don't want to push the button yourself Volker I'll do it on behalf of all those commentators.



---

archive/issue_comments_241190.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-11T17:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17284#issuecomment-241190",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049969.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-11T17:00:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17284",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17284#event-49969"
}
```
