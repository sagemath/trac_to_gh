# Issue 17132: Perfect Matchings for Graphs

archive/issues_016895.json:
```json
{
    "assignees": [],
    "body": "I would like to implement and use an efficient program for the calculation of perfect matchings (aka 1-factors) of graphs. I know that a class called `PerfectMatchings` has been created, but there does not seem to be any program there to compute perfect matchings of graphs. There also seem to be programs for computing matching polynomials of graphs, but the algorithms for it are very different.\n\nI have written a simple program using induction, but I'm not sure where it should be placed (ie. combinat/ or graphs/). For now, I have placed the file \"perfect_matchings.py\" in the graphs/ directory, but we can move it somewhere else if needed. \n\nI need help with certain things since I am new to this.\n\n1. Proper formatting, of course. (I can work on this by looking at other files, but I'll need some supervision.)\n\n2. How do I make sure that tab-completion works? That is, if `G` is a graph, `G.perf<tab>` should auto-fill it?\n\n3. Is it worth treating the output as a member of the `PerfectMatchings` class?\n\nCC:  @tscrim @sagetrac-vferay @nthiery @sagetrac-dperkinson @nathanncohen\n\nKeywords: **perfect matchings, graphs**\n\nBranch/Commit: **[public/ayyer/perfect_matchings](https://github.com/sagemath/sagetrac-mirror/tree/public/ayyer/perfect_matchings) @ [88e5862](https://github.com/sagemath/sagetrac-mirror/commit/88e58625775dfa5cea13db7336dc5f5371ab3768)**\n\nReviewer: **David Coudert**\n\nAuthor: **Arvind Ayyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17132_\n\n",
    "closed_at": "2021-09-10T04:50:10Z",
    "created_at": "2014-10-11T12:43:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Perfect Matchings for Graphs",
    "type": "issue",
    "updated_at": "2021-09-10T04:50:10Z",
    "url": "https://github.com/sagemath/sage/issues/17132",
    "user": "https://github.com/ayyer"
}
```
I would like to implement and use an efficient program for the calculation of perfect matchings (aka 1-factors) of graphs. I know that a class called `PerfectMatchings` has been created, but there does not seem to be any program there to compute perfect matchings of graphs. There also seem to be programs for computing matching polynomials of graphs, but the algorithms for it are very different.

I have written a simple program using induction, but I'm not sure where it should be placed (ie. combinat/ or graphs/). For now, I have placed the file "perfect_matchings.py" in the graphs/ directory, but we can move it somewhere else if needed. 

I need help with certain things since I am new to this.

1. Proper formatting, of course. (I can work on this by looking at other files, but I'll need some supervision.)

2. How do I make sure that tab-completion works? That is, if `G` is a graph, `G.perf<tab>` should auto-fill it?

3. Is it worth treating the output as a member of the `PerfectMatchings` class?

CC:  @tscrim @sagetrac-vferay @nthiery @sagetrac-dperkinson @nathanncohen

Keywords: **perfect matchings, graphs**

Branch/Commit: **[public/ayyer/perfect_matchings](https://github.com/sagemath/sagetrac-mirror/tree/public/ayyer/perfect_matchings) @ [88e5862](https://github.com/sagemath/sagetrac-mirror/commit/88e58625775dfa5cea13db7336dc5f5371ab3768)**

Reviewer: **David Coudert**

Author: **Arvind Ayyer**

_Issue created by migration from https://trac.sagemath.org/ticket/17132_





---

archive/issue_events_227019.json:
```json
{
    "actor": "https://github.com/ayyer",
    "created_at": "2014-10-11T12:43:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227019"
}
```



---

archive/issue_events_227020.json:
```json
{
    "actor": "https://github.com/ayyer",
    "created_at": "2014-10-11T12:43:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227020"
}
```



---

archive/issue_events_227021.json:
```json
{
    "actor": "https://github.com/ayyer",
    "created_at": "2014-10-11T12:43:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227021"
}
```



---

archive/issue_comments_229752.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nI'm stuck trying to fix (2) above. The function `perfect_matchings(G)` works perfectly if I attach the file, like so.\n\n```\nsage: G = graphs.GridGraph([3,2])\nsage: attach(\"src/sage/graphs/perfect_matchings.py\")\nsage: perfect_matchings(G)\n[[((1, 1), (2, 1)), ((1, 0), (2, 0)), ((0, 0), (0, 1))],\n [((2, 0), (2, 1)), ((1, 0), (1, 1)), ((0, 0), (0, 1))],\n [((2, 0), (2, 1)), ((0, 1), (1, 1)), ((0, 0), (1, 0))]]\n```\n\nBut I get funny errors if I try to modify the file *src/sage/graphs/all.py* in any reasonable way. For example, if I add the line `from sage.graphs.perfect_matchings import *`, I get the following strange error.\n\n```\nsage: perfect_matchings(G)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-2-a5bbd0fdbb1c> in <module>()\n----> 1 perfect_matchings(G)\n\n/opt/sage/sage-git/local/lib/python2.7/site-packages/sage/graphs/perfect_matchings.pyc in perfect_matchings(G)\n     46     PP = []\n     47     for h in N:\n---> 48         H = copy(G)\n     49         H.delete_vertices([g,h])\n     50         P = perfect_matchings(H)\n\nNameError: global name 'copy' is not defined\n```\n\nOn the other hand, if I try `import sage.graphs.perfect_matchings`, I get\n\n```\nsage: perfect_matchings(G)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-2-a5bbd0fdbb1c> in <module>()\n----> 1 perfect_matchings(G)\n\nNameError: name 'perfect_matchings' is not defined\n```\nI have no idea what to do at this stage. Could someone help? Thanks a lot.",
    "created_at": "2014-10-16T09:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229752",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

I'm stuck trying to fix (2) above. The function `perfect_matchings(G)` works perfectly if I attach the file, like so.

```
sage: G = graphs.GridGraph([3,2])
sage: attach("src/sage/graphs/perfect_matchings.py")
sage: perfect_matchings(G)
[[((1, 1), (2, 1)), ((1, 0), (2, 0)), ((0, 0), (0, 1))],
 [((2, 0), (2, 1)), ((1, 0), (1, 1)), ((0, 0), (0, 1))],
 [((2, 0), (2, 1)), ((0, 1), (1, 1)), ((0, 0), (1, 0))]]
```

But I get funny errors if I try to modify the file *src/sage/graphs/all.py* in any reasonable way. For example, if I add the line `from sage.graphs.perfect_matchings import *`, I get the following strange error.

```
sage: perfect_matchings(G)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-2-a5bbd0fdbb1c> in <module>()
----> 1 perfect_matchings(G)

/opt/sage/sage-git/local/lib/python2.7/site-packages/sage/graphs/perfect_matchings.pyc in perfect_matchings(G)
     46     PP = []
     47     for h in N:
---> 48         H = copy(G)
     49         H.delete_vertices([g,h])
     50         P = perfect_matchings(H)

NameError: global name 'copy' is not defined
```

On the other hand, if I try `import sage.graphs.perfect_matchings`, I get

```
sage: perfect_matchings(G)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-2-a5bbd0fdbb1c> in <module>()
----> 1 perfect_matchings(G)

NameError: name 'perfect_matchings' is not defined
```
I have no idea what to do at this stage. Could someone help? Thanks a lot.



---

archive/issue_comments_229753.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nHello !\n\nYou do not need fo create a new file for a function like that. Add it in `graph.py`, it will be easier.\n\nAbout your bugs\n\n1) When in the console 'copy' is automatically imported, but this is not the case in Sage code. You need either to import it before you use it with \"from copy import copy\" or else use the 'copy' methods defined on graphs, i.e. `H=G.copy()`\n\n2) What you want to do is `from sage.graphs.perfect_matchings import perfect_matchings`. You want to import the function `perfect_matchings` defined in the module `sage.graphs.perfect_matchings`\n\nNathann",
    "created_at": "2014-10-16T09:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229753",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:3" align="right">Comment 3</div>

Hello !

You do not need fo create a new file for a function like that. Add it in `graph.py`, it will be easier.

About your bugs

1) When in the console 'copy' is automatically imported, but this is not the case in Sage code. You need either to import it before you use it with "from copy import copy" or else use the 'copy' methods defined on graphs, i.e. `H=G.copy()`

2) What you want to do is `from sage.graphs.perfect_matchings import perfect_matchings`. You want to import the function `perfect_matchings` defined in the module `sage.graphs.perfect_matchings`

Nathann



---

archive/issue_comments_229754.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThanks, Nathann. Your explanation was very helpful. The method works!\n\nThe only reason I created a new file because people like *vferay* might feel it belongs naturally in the *combinat* directory instead and it will be easier to move it around.\n\nUnfortunately, tab completion still does not work.\n\nArvind",
    "created_at": "2014-10-16T10:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229754",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:4" align="right">Comment 4</div>

Thanks, Nathann. Your explanation was very helpful. The method works!

The only reason I created a new file because people like *vferay* might feel it belongs naturally in the *combinat* directory instead and it will be easier to move it around.

Unfortunately, tab completion still does not work.

Arvind



---

archive/issue_comments_229755.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d62f2c58fc66c4e91826b2b5e27409dcb58f651\">3d62f2c</a></td><td><code>imported perfect_matchings.py in all.py</code></td></tr></table>\n",
    "created_at": "2014-10-16T10:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229755",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d62f2c58fc66c4e91826b2b5e27409dcb58f651">3d62f2c</a></td><td><code>imported perfect_matchings.py in all.py</code></td></tr></table>




---

archive/issue_comments_229756.json:
```json
{
    "body": "Changed commit from **[18d6418](https://github.com/sagemath/sagetrac-mirror/commit/18d641858474d73a3e7dd3e5c02e2baecca2aa14)** to **[3d62f2c](https://github.com/sagemath/sagetrac-mirror/commit/3d62f2c58fc66c4e91826b2b5e27409dcb58f651)**",
    "created_at": "2014-10-16T10:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229756",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[18d6418](https://github.com/sagemath/sagetrac-mirror/commit/18d641858474d73a3e7dd3e5c02e2baecca2aa14)** to **[3d62f2c](https://github.com/sagemath/sagetrac-mirror/commit/3d62f2c58fc66c4e91826b2b5e27409dcb58f651)**



---

archive/issue_comments_229757.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nHello !\n\n> Thanks, Nathann. Your explanation was very helpful. The method works!\n\nNice ! \n\n> The only reason I created a new file because people like *vferay* might feel it belongs naturally in the *combinat* directory instead and it will be easier to move it around.\n\nA method which enumerates the perfect matchings of a graph is a graph method. You might be right if you think that all graphs belong to the combinat folder, but that's a different issue.\n\n> Unfortunately, tab completion still does not work.\n\nDo you mean `g.perfect_matching` ? If so, that would only work if `perfect_matching` is a graph method.\n\nNathann",
    "created_at": "2014-10-16T10:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229757",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:6" align="right">Comment 6</div>

Hello !

> Thanks, Nathann. Your explanation was very helpful. The method works!

Nice ! 

> The only reason I created a new file because people like *vferay* might feel it belongs naturally in the *combinat* directory instead and it will be easier to move it around.

A method which enumerates the perfect matchings of a graph is a graph method. You might be right if you think that all graphs belong to the combinat folder, but that's a different issue.

> Unfortunately, tab completion still does not work.

Do you mean `g.perfect_matching` ? If so, that would only work if `perfect_matching` is a graph method.

Nathann



---

archive/issue_comments_229758.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\n> A method which enumerates the perfect matchings of a graph is a graph method. \n\nOkay, I can move this method to `graph.py` eventually.\n\n> Do you mean `g.perfect_matching`? If so, that would only work if `perfect_matching` is a graph method.\n\nBut I thought that since it is the *graphs* directory, it automatically becomes a graph method. How do I force it to be a graph method? Thanks.\n\nArvind",
    "created_at": "2014-10-16T11:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229758",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

> A method which enumerates the perfect matchings of a graph is a graph method. 

Okay, I can move this method to `graph.py` eventually.

> Do you mean `g.perfect_matching`? If so, that would only work if `perfect_matching` is a graph method.

But I thought that since it is the *graphs* directory, it automatically becomes a graph method. How do I force it to be a graph method? Thanks.

Arvind



---

archive/issue_comments_229759.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\n> But I thought that since it is the *graphs* directory, it automatically becomes a graph method. How do I force it to be a graph method? Thanks.\n\nBy writing it in the `graph.py` file, next to all others, as a method of the `Graph` class.\n\nNathann",
    "created_at": "2014-10-16T12:01:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229759",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:8" align="right">Comment 8</div>

> But I thought that since it is the *graphs* directory, it automatically becomes a graph method. How do I force it to be a graph method? Thanks.

By writing it in the `graph.py` file, next to all others, as a method of the `Graph` class.

Nathann



---

archive/issue_comments_229760.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\n> By writing it in the graph.py file, next to all others, as a method of the Graph class.\n\nDamn! I guess I'm forced to do that. But I'm curious. Is there no other (simple) way to include methods of a certain class in a different file?\n\nArvind",
    "created_at": "2014-10-16T12:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229760",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

> By writing it in the graph.py file, next to all others, as a method of the Graph class.

Damn! I guess I'm forced to do that. But I'm curious. Is there no other (simple) way to include methods of a certain class in a different file?

Arvind



---

archive/issue_comments_229761.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\n> Damn! I guess I'm forced to do that. But I'm curious. Is there no other (simple) way to include methods of a certain class in a different file?\n\nThere is. Open `graph.py` and look at the bottom of the file. That's where it happens.\n\nNathann",
    "created_at": "2014-10-16T12:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229761",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">Comment 10</div>

> Damn! I guess I'm forced to do that. But I'm curious. Is there no other (simple) way to include methods of a certain class in a different file?

There is. Open `graph.py` and look at the bottom of the file. That's where it happens.

Nathann



---

archive/issue_comments_229762.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nGot it! For now, I've kept it in a separate file because I want to eventually add more methods. Thanks a lot for your patient answers.\n\nArvind",
    "created_at": "2014-10-16T12:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229762",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:11" align="right">Comment 11</div>

Got it! For now, I've kept it in a separate file because I want to eventually add more methods. Thanks a lot for your patient answers.

Arvind



---

archive/issue_comments_229763.json:
```json
{
    "body": "Changed commit from **[3d62f2c](https://github.com/sagemath/sagetrac-mirror/commit/3d62f2c58fc66c4e91826b2b5e27409dcb58f651)** to **[36fd115](https://github.com/sagemath/sagetrac-mirror/commit/36fd1151164215523d7d24c6713a53deae5c3b90)**",
    "created_at": "2014-10-16T12:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229763",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3d62f2c](https://github.com/sagemath/sagetrac-mirror/commit/3d62f2c58fc66c4e91826b2b5e27409dcb58f651)** to **[36fd115](https://github.com/sagemath/sagetrac-mirror/commit/36fd1151164215523d7d24c6713a53deae5c3b90)**



---

archive/issue_comments_229764.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36fd1151164215523d7d24c6713a53deae5c3b90\">36fd115</a></td><td><code>made perfect_matchings a graph method</code></td></tr></table>\n",
    "created_at": "2014-10-16T12:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229764",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12" align="right">Comment 12</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36fd1151164215523d7d24c6713a53deae5c3b90">36fd115</a></td><td><code>made perfect_matchings a graph method</code></td></tr></table>




---

archive/issue_comments_229765.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBased on email exchanges with *nathann* and *vferay*, I want to give an option for the output to be treated as an element of the class `PerfectMatchings` (point (3) in the ticket). So I was playing with forcing the conversion.\n\n```\nsage: G = graphs.Grid2dGraph(3,2)\nsage: PM = G.perfect_matchings()\nsage: PM\n[[((1, 1), (2, 1)), ((1, 0), (2, 0)), ((0, 0), (0, 1))],\n [((2, 0), (2, 1)), ((1, 0), (1, 1)), ((0, 0), (0, 1))],\n [((2, 0), (2, 1)), ((0, 1), (1, 1)), ((0, 0), (1, 0))]]\n```\nHowever, this seems to give some funny errors. If I try to force each list to be an element of the class, I get\n\n```\nsage: [PerfectMatching(p) for p in PM]\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-13-a4d340e78f6e> in <module>()\n----> 1 [PerfectMatching(p) for p in PM]\n\n/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1282)()\n\n/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/combinat/perfect_matching.pyc in __classcall_private__(cls, p)\n    182             if len(objects) < 2*len(data):\n    183                 raise ValueError(\"%s is not a valid perfect matching:\\n\"\n--> 184                                  \"there are some repetitions\" % p)\n    185         # Second case: p is a permutation or a list of integers, we have to\n    186         # check if it is a fix-point-free involution.\n\nValueError: [((1, 1), (2, 1)), ((1, 0), (2, 0)), ((0, 0), (0, 1))] is not a valid perfect matching:\nthere are some repetitions\n```\nIf I first force it to be a tuple, I get another error\n\n```\nsage: [PerfectMatching(tuple(p)) for p in PM]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-12-a67059f6b75f> in <module>()\n----> 1 [PerfectMatching(tuple(p)) for p in PM]\n\n/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1282)()\n\n/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/combinat/perfect_matching.pyc in __classcall_private__(cls, p)\n    182             if len(objects) < 2*len(data):\n    183                 raise ValueError(\"%s is not a valid perfect matching:\\n\"\n--> 184                                  \"there are some repetitions\" % p)\n    185         # Second case: p is a permutation or a list of integers, we have to\n    186         # check if it is a fix-point-free involution.\n\nTypeError: not all arguments converted during string formatting\n```\nCan someone take a look?",
    "created_at": "2014-10-19T17:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229765",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:13" align="right">Comment 13</div>

Based on email exchanges with *nathann* and *vferay*, I want to give an option for the output to be treated as an element of the class `PerfectMatchings` (point (3) in the ticket). So I was playing with forcing the conversion.

```
sage: G = graphs.Grid2dGraph(3,2)
sage: PM = G.perfect_matchings()
sage: PM
[[((1, 1), (2, 1)), ((1, 0), (2, 0)), ((0, 0), (0, 1))],
 [((2, 0), (2, 1)), ((1, 0), (1, 1)), ((0, 0), (0, 1))],
 [((2, 0), (2, 1)), ((0, 1), (1, 1)), ((0, 0), (1, 0))]]
```
However, this seems to give some funny errors. If I try to force each list to be an element of the class, I get

```
sage: [PerfectMatching(p) for p in PM]
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-13-a4d340e78f6e> in <module>()
----> 1 [PerfectMatching(p) for p in PM]

/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1282)()

/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/combinat/perfect_matching.pyc in __classcall_private__(cls, p)
    182             if len(objects) < 2*len(data):
    183                 raise ValueError("%s is not a valid perfect matching:\n"
--> 184                                  "there are some repetitions" % p)
    185         # Second case: p is a permutation or a list of integers, we have to
    186         # check if it is a fix-point-free involution.

ValueError: [((1, 1), (2, 1)), ((1, 0), (2, 0)), ((0, 0), (0, 1))] is not a valid perfect matching:
there are some repetitions
```
If I first force it to be a tuple, I get another error

```
sage: [PerfectMatching(tuple(p)) for p in PM]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-12-a67059f6b75f> in <module>()
----> 1 [PerfectMatching(tuple(p)) for p in PM]

/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1282)()

/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/combinat/perfect_matching.pyc in __classcall_private__(cls, p)
    182             if len(objects) < 2*len(data):
    183                 raise ValueError("%s is not a valid perfect matching:\n"
--> 184                                  "there are some repetitions" % p)
    185         # Second case: p is a permutation or a list of integers, we have to
    186         # check if it is a fix-point-free involution.

TypeError: not all arguments converted during string formatting
```
Can someone take a look?



---

archive/issue_comments_229766.json:
```json
{
    "body": "Changed commit from **[36fd115](https://github.com/sagemath/sagetrac-mirror/commit/36fd1151164215523d7d24c6713a53deae5c3b90)** to **[6091b96](https://github.com/sagemath/sagetrac-mirror/commit/6091b96904f172d6aea9e4926cb14257850c77ea)**",
    "created_at": "2014-10-19T17:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229766",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[36fd115](https://github.com/sagemath/sagetrac-mirror/commit/36fd1151164215523d7d24c6713a53deae5c3b90)** to **[6091b96](https://github.com/sagemath/sagetrac-mirror/commit/6091b96904f172d6aea9e4926cb14257850c77ea)**



---

archive/issue_comments_229767.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6091b96904f172d6aea9e4926cb14257850c77ea\">6091b96</a></td><td><code>Minor fixes</code></td></tr></table>\n",
    "created_at": "2014-10-19T17:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229767",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14" align="right">Comment 14</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6091b96904f172d6aea9e4926cb14257850c77ea">6091b96</a></td><td><code>Minor fixes</code></td></tr></table>




---

archive/issue_comments_229768.json:
```json
{
    "body": "Changed merged from **6.3** to none",
    "created_at": "2014-10-19T18:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229768",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **6.3** to none



---

archive/issue_comments_229769.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nYou should respect [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) and [http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings](http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings)",
    "created_at": "2014-10-19T18:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229769",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

You should respect [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) and [http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings](http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings)



---

archive/issue_comments_229770.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@ayyer](#comment%3A13):\n\n> If I first force it to be a tuple, I get another error\n> \n> ```\n> sage: [PerfectMatching(tuple(p)) for p in PM]\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> <ipython-input-12-a67059f6b75f> in <module>()\n> ----> 1 [PerfectMatching(tuple(p)) for p in PM]\n> ```\n> /Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1282)()\n\n>\n> /Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/combinat/perfect_matching.pyc in __classcall_private__(cls, p)\n>     182             if len(objects) < 2*len(data):\n>     183                 raise ValueError(\"%s is not a valid perfect matching:\\n\"\n> --> 184                                  \"there are some repetitions\" % p)\n>     185         # Second case: p is a permutation or a list of integers, we have to\n>     186         # check if it is a fix-point-free involution.\n>\n> TypeError: not all arguments converted during string formatting\n> }}}\n> Can someone take a look?\n\nHi Arvind,\n\nthe bug comes from the perfect matching library: when elements of the base set are themselves pairs of integers, the function 'flatten' goes too far... I guess that adding the optional argument 'max_level=1' to all 'flatten' functions in the PerfectMatching library should solve the problem.\n\nNow the question is (perhaps for Nathan): should that be a separate post on the trac/patch ?\n\nI have another question : for the moment, you return perfect matchings as a list of pairs. Mathematically, I think it is more logical to treat it as a set of sets (two perfect matchings which differ by a permutations of the pairs are equal). But perhaps turning it into a set in sage would imply unnecessary copies/tests, so I wonder what is the best choice...\n\nBest,\nValentin",
    "created_at": "2014-10-20T08:32:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229770",
    "user": "https://github.com/sagetrac-vferay"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@ayyer](#comment%3A13):

> If I first force it to be a tuple, I get another error
> 
> ```
> sage: [PerfectMatching(tuple(p)) for p in PM]
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> <ipython-input-12-a67059f6b75f> in <module>()
> ----> 1 [PerfectMatching(tuple(p)) for p in PM]
> ```
> /Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1282)()

>
> /Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/combinat/perfect_matching.pyc in __classcall_private__(cls, p)
>     182             if len(objects) < 2*len(data):
>     183                 raise ValueError("%s is not a valid perfect matching:\n"
> --> 184                                  "there are some repetitions" % p)
>     185         # Second case: p is a permutation or a list of integers, we have to
>     186         # check if it is a fix-point-free involution.
>
> TypeError: not all arguments converted during string formatting
> }}}
> Can someone take a look?

Hi Arvind,

the bug comes from the perfect matching library: when elements of the base set are themselves pairs of integers, the function 'flatten' goes too far... I guess that adding the optional argument 'max_level=1' to all 'flatten' functions in the PerfectMatching library should solve the problem.

Now the question is (perhaps for Nathan): should that be a separate post on the trac/patch ?

I have another question : for the moment, you return perfect matchings as a list of pairs. Mathematically, I think it is more logical to treat it as a set of sets (two perfect matchings which differ by a permutations of the pairs are equal). But perhaps turning it into a set in sage would imply unnecessary copies/tests, so I wonder what is the best choice...

Best,
Valentin



---

archive/issue_comments_229771.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nHello !\n\n> Now the question is (perhaps for Nathan): should that be a separate post on the trac/patch ?\n\nIt can be the same if you think that this patch will quickly be finished and reviewed, it can be an independent one otherwise. You are free to do whatever you like here !\n\n> I have another question : for the moment, you return perfect matchings as a list of pairs. Mathematically, I think it is more logical to treat it as a set of sets (two perfect matchings which differ by a permutations of the pairs are equal). But perhaps turning it into a set in sage would imply unnecessary copies/tests, so I wonder what is the best choice...\n\nWell, edges of a graph are pairs at the moment, so it would not be inconsistent with what we already do. I also prefer simple data structures, but several can be available if you like.\n\nNathann",
    "created_at": "2014-10-20T09:50:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229771",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">Comment 17</div>

Hello !

> Now the question is (perhaps for Nathan): should that be a separate post on the trac/patch ?

It can be the same if you think that this patch will quickly be finished and reviewed, it can be an independent one otherwise. You are free to do whatever you like here !

> I have another question : for the moment, you return perfect matchings as a list of pairs. Mathematically, I think it is more logical to treat it as a set of sets (two perfect matchings which differ by a permutations of the pairs are equal). But perhaps turning it into a set in sage would imply unnecessary copies/tests, so I wonder what is the best choice...

Well, edges of a graph are pairs at the moment, so it would not be inconsistent with what we already do. I also prefer simple data structures, but several can be available if you like.

Nathann



---

archive/issue_comments_229772.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@jdemeyer](#comment%3A15):\n> You should respect [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) and [http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings](http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings)\n\nThanks for the links. As I explained in the ticket, I am a new contributor to Sage. I am happy to respect everyone and everything, but I am not quite clear on what the objection is. Since I cut-pasted this from an existing file, I assumed that I am following the proper protocols. Could you explain what I need to do in more precise terms?\n\nIf you mean that I need to add examples, I will certainly do that once I have more methods. Please note that the file is at a very rudimentary stage at this moment.",
    "created_at": "2014-10-20T16:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229772",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@jdemeyer](#comment%3A15):
> You should respect [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) and [http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings](http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings)

Thanks for the links. As I explained in the ticket, I am a new contributor to Sage. I am happy to respect everyone and everything, but I am not quite clear on what the objection is. Since I cut-pasted this from an existing file, I assumed that I am following the proper protocols. Could you explain what I need to do in more precise terms?

If you mean that I need to add examples, I will certainly do that once I have more methods. Please note that the file is at a very rudimentary stage at this moment.



---

archive/issue_comments_229773.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@sagetrac-vferay](#comment%3A16):\n> the bug comes from the perfect matching library: when elements of the base set are themselves pairs of integers, the function 'flatten' goes too far... I guess that adding the optional argument 'max_level=1' to all 'flatten' functions in the PerfectMatching library should solve the problem.\n\nOh I see. Let me know if you want me to open a new ticket. I can review it too if you like.\n \n> I have another question : for the moment, you return perfect matchings as a list of pairs. Mathematically, I think it is more logical to treat it as a set of sets (two perfect matchings which differ by a permutations of the pairs are equal). But perhaps turning it into a set in sage would imply unnecessary copies/tests, so I wonder what is the best choice...\n\nI am more familiar with Maple, where I would have indeed treated the object as a set of sets. I also find it natural to think of undirected edges as sets and directed ones as lists, but that doesn't seem to be the system followed here. In my short time with Sage, I find lists to be easier to manipulate overall. \n\nDoes the class `PerfectMatchings` treat the object as a set of sets? If so, the user can choose what he/she prefers, once I add the option.",
    "created_at": "2014-10-20T16:47:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229773",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@sagetrac-vferay](#comment%3A16):
> the bug comes from the perfect matching library: when elements of the base set are themselves pairs of integers, the function 'flatten' goes too far... I guess that adding the optional argument 'max_level=1' to all 'flatten' functions in the PerfectMatching library should solve the problem.

Oh I see. Let me know if you want me to open a new ticket. I can review it too if you like.
 
> I have another question : for the moment, you return perfect matchings as a list of pairs. Mathematically, I think it is more logical to treat it as a set of sets (two perfect matchings which differ by a permutations of the pairs are equal). But perhaps turning it into a set in sage would imply unnecessary copies/tests, so I wonder what is the best choice...

I am more familiar with Maple, where I would have indeed treated the object as a set of sets. I also find it natural to think of undirected edges as sets and directed ones as lists, but that doesn't seem to be the system followed here. In my short time with Sage, I find lists to be easier to manipulate overall. 

Does the class `PerfectMatchings` treat the object as a set of sets? If so, the user can choose what he/she prefers, once I add the option.



---

archive/issue_comments_229774.json:
```json
{
    "body": "Changed commit from **[6091b96](https://github.com/sagemath/sagetrac-mirror/commit/6091b96904f172d6aea9e4926cb14257850c77ea)** to **[2640dfc](https://github.com/sagemath/sagetrac-mirror/commit/2640dfc7a5d9ee85881eb9f08a219a6c9456d015)**",
    "created_at": "2014-11-07T03:40:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229774",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6091b96](https://github.com/sagemath/sagetrac-mirror/commit/6091b96904f172d6aea9e4926cb14257850c77ea)** to **[2640dfc](https://github.com/sagemath/sagetrac-mirror/commit/2640dfc7a5d9ee85881eb9f08a219a6c9456d015)**



---

archive/issue_comments_229775.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f73cc558b7da01511180091850a75f61455a608\">9f73cc5</a></td><td><code>formatted the header of the file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2640dfc7a5d9ee85881eb9f08a219a6c9456d015\">2640dfc</a></td><td><code>no changes</code></td></tr></table>\n",
    "created_at": "2014-11-07T03:40:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229775",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20" align="right">Comment 20</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f73cc558b7da01511180091850a75f61455a608">9f73cc5</a></td><td><code>formatted the header of the file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2640dfc7a5d9ee85881eb9f08a219a6c9456d015">2640dfc</a></td><td><code>no changes</code></td></tr></table>




---

archive/issue_comments_229776.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88e58625775dfa5cea13db7336dc5f5371ab3768\">88e5862</a></td><td><code>trac #17132: Merged with latest release</code></td></tr></table>\n",
    "created_at": "2014-11-16T10:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229776",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88e58625775dfa5cea13db7336dc5f5371ab3768">88e5862</a></td><td><code>trac #17132: Merged with latest release</code></td></tr></table>




---

archive/issue_comments_229777.json:
```json
{
    "body": "Changed commit from **[2640dfc](https://github.com/sagemath/sagetrac-mirror/commit/2640dfc7a5d9ee85881eb9f08a219a6c9456d015)** to **[88e5862](https://github.com/sagemath/sagetrac-mirror/commit/88e58625775dfa5cea13db7336dc5f5371ab3768)**",
    "created_at": "2014-11-16T10:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229777",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2640dfc](https://github.com/sagemath/sagetrac-mirror/commit/2640dfc7a5d9ee85881eb9f08a219a6c9456d015)** to **[88e5862](https://github.com/sagemath/sagetrac-mirror/commit/88e58625775dfa5cea13db7336dc5f5371ab3768)**



---

archive/issue_comments_229778.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nHello !\n\nI was thinking of this ticket again: instead of creating copies of the graph, it may be cheaper to remove the two vertices before calling the subprocedure, and to add them back when the subprocedure returns. Depends on the actual timings.\n\nNathann",
    "created_at": "2014-11-16T11:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229778",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">Comment 22</div>

Hello !

I was thinking of this ticket again: instead of creating copies of the graph, it may be cheaper to remove the two vertices before calling the subprocedure, and to add them back when the subprocedure returns. Depends on the actual timings.

Nathann



---

archive/issue_comments_229779.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nHi Nathann,\n\n> I was thinking of this ticket again: instead of creating copies of the graph, it may be cheaper to remove the two vertices before calling the subprocedure, and to add them back when the subprocedure returns. Depends on the actual timings.\n\nHere's what I tried. I replaced the three lines\n\n```\nH = G.copy()\nH.delete_vertices([g,h])\nP = perfect_matchings(H)\n```\nby the single line\n\n```\nP = perfect_matchings(G.delete_vertices([g,h]))\n```\nBut that gives me the following error:\n\n```\nAttributeError                            Traceback (most recent call last)\n<ipython-input-4-7551fac4dada> in <module>()\n----> 1 G.perfect_matchings()\n\n/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/graphs/perfect_matchings.pyc in perfect_matchings(G)\n     72 #        H = G.copy()\n     73 #        H.delete_vertices([g,h])\n---> 74         P = perfect_matchings(G.delete_vertices([g,h]))\n     75         for p in P:\n     76             p.append((g,h))\n\n/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/graphs/perfect_matchings.pyc in perfect_matchings(G)\n     59     ValueError: there is no perfect matching for a graph with an odd number of vertices\n     60     \"\"\"\n---> 61     n = G.num_verts()\n     62 \n     63     if n == 0:\n\nAttributeError: 'NoneType' object has no attribute 'num_verts'\n```\n\nIt looks like it treats `G.delete_vertices([g,h])` as a `NoneType` object. But on the sage command line, `G.delete_vertices([g,h])` actually returns the modified graph. How else can I do this without making a copy? Thanks!",
    "created_at": "2014-11-22T05:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229779",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:23" align="right">Comment 23</div>

Hi Nathann,

> I was thinking of this ticket again: instead of creating copies of the graph, it may be cheaper to remove the two vertices before calling the subprocedure, and to add them back when the subprocedure returns. Depends on the actual timings.

Here's what I tried. I replaced the three lines

```
H = G.copy()
H.delete_vertices([g,h])
P = perfect_matchings(H)
```
by the single line

```
P = perfect_matchings(G.delete_vertices([g,h]))
```
But that gives me the following error:

```
AttributeError                            Traceback (most recent call last)
<ipython-input-4-7551fac4dada> in <module>()
----> 1 G.perfect_matchings()

/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/graphs/perfect_matchings.pyc in perfect_matchings(G)
     72 #        H = G.copy()
     73 #        H.delete_vertices([g,h])
---> 74         P = perfect_matchings(G.delete_vertices([g,h]))
     75         for p in P:
     76             p.append((g,h))

/Applications/Sage-6.2.app/Contents/Resources/sage/local/lib/python2.7/site-packages/sage/graphs/perfect_matchings.pyc in perfect_matchings(G)
     59     ValueError: there is no perfect matching for a graph with an odd number of vertices
     60     """
---> 61     n = G.num_verts()
     62 
     63     if n == 0:

AttributeError: 'NoneType' object has no attribute 'num_verts'
```

It looks like it treats `G.delete_vertices([g,h])` as a `NoneType` object. But on the sage command line, `G.delete_vertices([g,h])` actually returns the modified graph. How else can I do this without making a copy? Thanks!



---

archive/issue_comments_229780.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nHelloooooo !\n\nWell, it is indeed because \"delete vertices\" modifies the graph in-place. You should:\n\n1) Delete vertices from the graph\n2) List its perfect matchings\n\nIn particular it is odd that you saw it return anything, as the code of `Graph.delete_vertices` does not even contain a return statement.\n\nNathann",
    "created_at": "2014-11-22T05:13:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229780",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:24" align="right">Comment 24</div>

Helloooooo !

Well, it is indeed because "delete vertices" modifies the graph in-place. You should:

1) Delete vertices from the graph
2) List its perfect matchings

In particular it is odd that you saw it return anything, as the code of `Graph.delete_vertices` does not even contain a return statement.

Nathann



---

archive/issue_comments_229781.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\n> In particular it is odd that you saw it return anything, as the code of `Graph.delete_vertices` does not even contain a return statement.\n\nSorry, that was sloppy. I just meant that it `G.delete_vertices()` still leaves G as a graph with some vertices removed. If I set `H = G.delete_vertices()`, then H is of `NoneType`.\n\n> Well, it is indeed because \"delete vertices\" modifies the graph in-place. You should:\n> \n> 1) Delete vertices from the graph\n> 2) List its perfect matchings\n\nBut since it modifies the graph in-place, I don't want to modify the original `G` since I am running a loop over all neighbours of the vertex `g` in `G` and calling the method recusively. I only want to \"temporarily delete\" vertices within the loop.\n\nArvind",
    "created_at": "2014-11-22T05:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229781",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:25" align="right">Comment 25</div>

> In particular it is odd that you saw it return anything, as the code of `Graph.delete_vertices` does not even contain a return statement.

Sorry, that was sloppy. I just meant that it `G.delete_vertices()` still leaves G as a graph with some vertices removed. If I set `H = G.delete_vertices()`, then H is of `NoneType`.

> Well, it is indeed because "delete vertices" modifies the graph in-place. You should:
> 
> 1) Delete vertices from the graph
> 2) List its perfect matchings

But since it modifies the graph in-place, I don't want to modify the original `G` since I am running a loop over all neighbours of the vertex `g` in `G` and calling the method recusively. I only want to "temporarily delete" vertices within the loop.

Arvind



---

archive/issue_comments_229782.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nHello !\n\n> But since it modifies the graph in-place, I don't want to modify the original `G` since I am running a loop over all neighbours of the vertex `g` in `G` and calling the method recusively. I only want to \"temporarily delete\" vertices within the loop.\n\nThis why the technique is to remove the vertices before calling the subfunction, and to add them back (with their edges) right after the subfunction call. This is a way to avoid having many copies of the whole graph, when all you need is -- as you say -- to have a temporarily smaller graph.\n\nNathann",
    "created_at": "2014-11-22T05:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229782",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">Comment 26</div>

Hello !

> But since it modifies the graph in-place, I don't want to modify the original `G` since I am running a loop over all neighbours of the vertex `g` in `G` and calling the method recusively. I only want to "temporarily delete" vertices within the loop.

This why the technique is to remove the vertices before calling the subfunction, and to add them back (with their edges) right after the subfunction call. This is a way to avoid having many copies of the whole graph, when all you need is -- as you say -- to have a temporarily smaller graph.

Nathann



---

archive/issue_comments_229783.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\n> This why the technique is to remove the vertices before calling the subfunction, and to add them back (with their edges) right after the subfunction call. This is a way to avoid having many copies of the whole graph, when all you need is -- as you say -- to have a temporarily smaller graph.\n\nOh, I see now! You want me to create another function which will delete the vertices without creating a copy. Here's what I did, and it seems to work. It seems a bit long though...\n\n```\nP = perfect_matchings(Graph([e for e in G.edges() if e[0] != g and e[0] != h and e[1] != g and e[1] != h]))\n```\nIs this acceptable? It seems that if `G.delete_vertices()` returned the graph instead of removing it in-place, it would have been much easier to return the graph. I suppose there were good reasons for doing it this way. Oh well!\n\nArvind",
    "created_at": "2014-11-22T06:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229783",
    "user": "https://github.com/ayyer"
}
```

<div id="comment:27" align="right">Comment 27</div>

> This why the technique is to remove the vertices before calling the subfunction, and to add them back (with their edges) right after the subfunction call. This is a way to avoid having many copies of the whole graph, when all you need is -- as you say -- to have a temporarily smaller graph.

Oh, I see now! You want me to create another function which will delete the vertices without creating a copy. Here's what I did, and it seems to work. It seems a bit long though...

```
P = perfect_matchings(Graph([e for e in G.edges() if e[0] != g and e[0] != h and e[1] != g and e[1] != h]))
```
Is this acceptable? It seems that if `G.delete_vertices()` returned the graph instead of removing it in-place, it would have been much easier to return the graph. I suppose there were good reasons for doing it this way. Oh well!

Arvind



---

archive/issue_comments_229784.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nHello !\n\n> Oh, I see now! You want me to create another function which will delete the vertices without creating a copy. Here's what I did, and it seems to work. It seems a bit long though...\n\nAhahah. Well, actually this code creates a copy too, you even call the graph constructor !\n\nI was thinking of this code:\n\n```\ndef matchings(G):\n    if G.order() == 0:\n\tyield []\n\treturn\n    v = G.vertex_iterator().next()\n    Nv = G.neighbors(v)\n    G.delete_vertex(v)  \n    for u in Nv:\n\tNu = G.neighbors(u)\n\tG.delete_vertex(u)\n        for partial_matching in matchings(G):\n            partial_matching.append((u,v))\n            yield partial_matching\n        G.add_vertex(u) \n\tG.add_edges((u,nu) for nu in Nu)\n    G.add_vertex(v)\n    G.add_edges((v,nv) for nv in Nv)\n\nsage: abs(graphs.PetersenGraph().matching_polynomial()(0))\n6\nsage: len(list(matchings(graphs.PetersenGraph())))\n6\nsage: abs(graphs.ChvatalGraph().matching_polynomial()(0))\n52\nsage: len(list(matchings(graphs.ChvatalGraph())))\n52\n```\n\nNote that it can be made more efficient by branching when it is not connected, which would lead to a check that all connected components are of even size, etc, etc...  But then it depends on the size of the graphs that are of interest to you, as those optimization can cost a lot on small instances.\n\nNathann",
    "created_at": "2014-11-22T14:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229784",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:28" align="right">Comment 28</div>

Hello !

> Oh, I see now! You want me to create another function which will delete the vertices without creating a copy. Here's what I did, and it seems to work. It seems a bit long though...

Ahahah. Well, actually this code creates a copy too, you even call the graph constructor !

I was thinking of this code:

```
def matchings(G):
    if G.order() == 0:
	yield []
	return
    v = G.vertex_iterator().next()
    Nv = G.neighbors(v)
    G.delete_vertex(v)  
    for u in Nv:
	Nu = G.neighbors(u)
	G.delete_vertex(u)
        for partial_matching in matchings(G):
            partial_matching.append((u,v))
            yield partial_matching
        G.add_vertex(u) 
	G.add_edges((u,nu) for nu in Nu)
    G.add_vertex(v)
    G.add_edges((v,nv) for nv in Nv)

sage: abs(graphs.PetersenGraph().matching_polynomial()(0))
6
sage: len(list(matchings(graphs.PetersenGraph())))
6
sage: abs(graphs.ChvatalGraph().matching_polynomial()(0))
52
sage: len(list(matchings(graphs.ChvatalGraph())))
52
```

Note that it can be made more efficient by branching when it is not connected, which would lead to a check that all connected components are of even size, etc, etc...  But then it depends on the size of the graphs that are of interest to you, as those optimization can cost a lot on small instances.

Nathann



---

archive/issue_events_227022.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-09-05T17:09:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227022"
}
```



---

archive/issue_events_227023.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-09-05T17:09:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227023"
}
```



---

archive/issue_events_227024.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-09-05T17:09:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227024"
}
```



---

archive/issue_events_227025.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-09-05T17:09:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227025"
}
```



---

archive/issue_comments_229785.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nAn iterator of perfect matchings for graphs has been added with #20061. So we can close this ticket.\n\nHowever, using the shape of the algorithm proposed in #comment:28, we are able to speed up the current method. So I'm opening #32475 for this improvement.",
    "created_at": "2021-09-05T17:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229785",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:29" align="right">Comment 29</div>

An iterator of perfect matchings for graphs has been added with #20061. So we can close this ticket.

However, using the shape of the algorithm proposed in #comment:28, we are able to speed up the current method. So I'm opening #32475 for this improvement.



---

archive/issue_events_227026.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-09-05T17:12:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227026"
}
```



---

archive/issue_events_227027.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-09-05T17:12:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227027"
}
```



---

archive/issue_comments_229786.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2021-09-05T17:12:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17132#issuecomment-229786",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_events_227028.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-10T04:50:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227028"
}
```



---

archive/issue_events_227029.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-10T04:50:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17132",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17132#event-227029"
}
```
