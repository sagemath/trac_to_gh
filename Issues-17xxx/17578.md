# Issue 17578: Use Parent/Element for Manin symbols

archive/issues_017341.json:
```json
{
    "body": "CC:  @jdemeyer jpflori @williamstein\n\nKeywords: Manin symbol\n\nThe classes `ManinSymbolList` and `ManinSymbol` (in `sage.modular.modsym.manin_symbols`) do not inherit from `Parent` and `Element`.  We fix this and make `ManinSymbolList` a parent in the category `FiniteEnumeratedSets`.\n\nTo prevent a measurable slowdown, the class `ManinSymbol` is converted to Cython.\n\nThis is a dependency of #10513.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17578\n\n",
    "closed_at": "2015-03-21T12:37:53Z",
    "created_at": "2015-01-02T19:17:37Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Use Parent/Element for Manin symbols",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17578",
    "user": "https://github.com/pjbruin"
}
```
CC:  @jdemeyer jpflori @williamstein

Keywords: Manin symbol

The classes `ManinSymbolList` and `ManinSymbol` (in `sage.modular.modsym.manin_symbols`) do not inherit from `Parent` and `Element`.  We fix this and make `ManinSymbolList` a parent in the category `FiniteEnumeratedSets`.

To prevent a measurable slowdown, the class `ManinSymbol` is converted to Cython.

This is a dependency of #10513.


Issue created by migration from https://trac.sagemath.org/ticket/17578





---

archive/issue_comments_230745.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-02T19:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230745",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230746.json:
```json
{
    "body": "The only real changes are in commit `a9da048`; the first two move the class `ManinSymbol` up in the file to allow `Element = ManinSymbol` in `ManinSymbolList`.",
    "created_at": "2015-01-02T19:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230746",
    "user": "https://github.com/pjbruin"
}
```

The only real changes are in commit `a9da048`; the first two move the class `ManinSymbol` up in the file to allow `Element = ManinSymbol` in `ManinSymbolList`.



---

archive/issue_comments_230747.json:
```json
{
    "body": "I've made some more substantial changes making `ManinSymbolList` a proper parent in `FiniteEnumeratedSets`. In particular, there is a backwards incompatible change in that `m[i]` returns a `ManinSymbol` instance (of `m`) rather than a tuple. Also I changed the `_list` attribute to `_symbol_list` since `FiniteEnumeratedSets` uses `_list` internally. Lastly I've added a method `symbol_list` to get the explicit list of symbols (the indexing tuples).\n\nI'm thinking we should post something to sage-devel stating this (proposed) change. Sound good?\n\n---\nNew commits:",
    "created_at": "2015-01-02T21:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230747",
    "user": "https://github.com/tscrim"
}
```

I've made some more substantial changes making `ManinSymbolList` a proper parent in `FiniteEnumeratedSets`. In particular, there is a backwards incompatible change in that `m[i]` returns a `ManinSymbol` instance (of `m`) rather than a tuple. Also I changed the `_list` attribute to `_symbol_list` since `FiniteEnumeratedSets` uses `_list` internally. Lastly I've added a method `symbol_list` to get the explicit list of symbols (the indexing tuples).

I'm thinking we should post something to sage-devel stating this (proposed) change. Sound good?

---
New commits:



---

archive/issue_comments_230748.json:
```json
{
    "body": "Replying to [comment:2 tscrim]:\n> I've made some more substantial changes making `ManinSymbolList` a proper parent in `FiniteEnumeratedSets`. In particular, there is a backwards incompatible change in that `m[i]` returns a `ManinSymbol` instance (of `m`) rather than a tuple. Also I changed the `_list` attribute to `_symbol_list` since `FiniteEnumeratedSets` uses `_list` internally. Lastly I've added a method `symbol_list` to get the explicit list of symbols (the indexing tuples).\n> \n> I'm thinking we should post something to sage-devel stating this (proposed) change. Sound good?\n\nI don't mind too much, but given that this ticket is a dependency of #10513, which already has positive review, wouldn't it make sense to do this on a different ticket?  (I currently don't have enough time to review your changes.)",
    "created_at": "2015-01-03T08:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230748",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:2 tscrim]:
> I've made some more substantial changes making `ManinSymbolList` a proper parent in `FiniteEnumeratedSets`. In particular, there is a backwards incompatible change in that `m[i]` returns a `ManinSymbol` instance (of `m`) rather than a tuple. Also I changed the `_list` attribute to `_symbol_list` since `FiniteEnumeratedSets` uses `_list` internally. Lastly I've added a method `symbol_list` to get the explicit list of symbols (the indexing tuples).
> 
> I'm thinking we should post something to sage-devel stating this (proposed) change. Sound good?

I don't mind too much, but given that this ticket is a dependency of #10513, which already has positive review, wouldn't it make sense to do this on a different ticket?  (I currently don't have enough time to review your changes.)



---

archive/issue_comments_230749.json:
```json
{
    "body": "This will almost certainly conflict with the already-merged #15015.",
    "created_at": "2015-01-03T10:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230749",
    "user": "https://github.com/jdemeyer"
}
```

This will almost certainly conflict with the already-merged #15015.



---

archive/issue_comments_230750.json:
```json
{
    "body": "I moved the \"moving\" part to #17579 (merging #15015). I'll let you decide which commits from here to cherry-pick on top of #17579.",
    "created_at": "2015-01-03T15:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230750",
    "user": "https://github.com/jdemeyer"
}
```

I moved the "moving" part to #17579 (merging #15015). I'll let you decide which commits from here to cherry-pick on top of #17579.



---

archive/issue_comments_230751.json:
```json
{
    "body": "sage-devel: http://groups.google.com/forum/#!topic/sage-devel/JlPnmjA1PCg",
    "created_at": "2015-01-04T07:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230751",
    "user": "https://github.com/tscrim"
}
```

sage-devel: http://groups.google.com/forum/#!topic/sage-devel/JlPnmjA1PCg



---

archive/issue_comments_230752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-01-04T07:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_230753.json:
```json
{
    "body": "I merged in #17579, but kept the version from here.",
    "created_at": "2015-01-04T07:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230753",
    "user": "https://github.com/tscrim"
}
```

I merged in #17579, but kept the version from here.



---

archive/issue_comments_230754.json:
```json
{
    "body": "In the meantime I already rebased the branch (I think this is a better solution than merging in this case) and reverted the more substantial changes from Travis's commit, so that this ticket can be merged as soon as possible in view of #10513.",
    "created_at": "2015-01-04T08:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230754",
    "user": "https://github.com/pjbruin"
}
```

In the meantime I already rebased the branch (I think this is a better solution than merging in this case) and reverted the more substantial changes from Travis's commit, so that this ticket can be merged as soon as possible in view of #10513.



---

archive/issue_comments_230755.json:
```json
{
    "body": "I strongly disagree with doing this (IMO) dirty hack of parents just to merge it quickly. It creates parents without a category and elements not created from the parent, both of which are abuses of `Parent`.\n\nAlso from my understanding, since this branch was published and I based my branch on it, it was not good to rebase the branch. Merge commits don't hurt anyone.",
    "created_at": "2015-01-04T14:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230755",
    "user": "https://github.com/tscrim"
}
```

I strongly disagree with doing this (IMO) dirty hack of parents just to merge it quickly. It creates parents without a category and elements not created from the parent, both of which are abuses of `Parent`.

Also from my understanding, since this branch was published and I based my branch on it, it was not good to rebase the branch. Merge commits don't hurt anyone.



---

archive/issue_comments_230756.json:
```json
{
    "body": "I'm creating the following for the test:\n\n```\nsage: from sage.modular.modsym.manin_symbols import ManinSymbolList_gamma0\nsage: m = ManinSymbolList_gamma0(5,8)\n```\nPreviously we have:\n\n```\nsage: %time L = m.manin_symbol_list()\nCPU times: user 560 \u00b5s, sys: 84 \u00b5s, total: 644 \u00b5s\nWall time: 494 \u00b5s\nsage: %time L = m.manin_symbol_list()\nCPU times: user 48 \u00b5s, sys: 4 \u00b5s, total: 52 \u00b5s\nWall time: 68.9 \u00b5s\n```\nWith my branch:\n\n```\nsage: %time L = m.manin_symbol_list()\nCPU times: user 644 \u00b5s, sys: 90 \u00b5s, total: 734 \u00b5s\nWall time: 747 \u00b5s\nsage: %time L = m.manin_symbol_list()\nCPU times: user 56 \u00b5s, sys: 7 \u00b5s, total: 63 \u00b5s\nWall time: 64.8 \u00b5s\n```\nWith Peter's branch:\n\n```\nsage: %time L = m.manin_symbol_list()\nCPU times: user 792 \u00b5s, sys: 99 \u00b5s, total: 891 \u00b5s\nWall time: 828 \u00b5s\nsage: %time L = m.manin_symbol_list()\nCPU times: user 49 \u00b5s, sys: 6 \u00b5s, total: 55 \u00b5s\nWall time: 66 \u00b5s\n```\nSo there is a slowdown with creating the instances of `ManinSymbol` that comes from the new branch and Peters by creating instances of `Element`. Hence this is a slowdown we might just have to deal with (assuming one is actually wanting the `ManinSymbol`, not the indexing tuple which can be grabbed by `symbol_list`).\n\n---\nNew commits:",
    "created_at": "2015-01-15T20:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230756",
    "user": "https://github.com/tscrim"
}
```

I'm creating the following for the test:

```
sage: from sage.modular.modsym.manin_symbols import ManinSymbolList_gamma0
sage: m = ManinSymbolList_gamma0(5,8)
```
Previously we have:

```
sage: %time L = m.manin_symbol_list()
CPU times: user 560 µs, sys: 84 µs, total: 644 µs
Wall time: 494 µs
sage: %time L = m.manin_symbol_list()
CPU times: user 48 µs, sys: 4 µs, total: 52 µs
Wall time: 68.9 µs
```
With my branch:

```
sage: %time L = m.manin_symbol_list()
CPU times: user 644 µs, sys: 90 µs, total: 734 µs
Wall time: 747 µs
sage: %time L = m.manin_symbol_list()
CPU times: user 56 µs, sys: 7 µs, total: 63 µs
Wall time: 64.8 µs
```
With Peter's branch:

```
sage: %time L = m.manin_symbol_list()
CPU times: user 792 µs, sys: 99 µs, total: 891 µs
Wall time: 828 µs
sage: %time L = m.manin_symbol_list()
CPU times: user 49 µs, sys: 6 µs, total: 55 µs
Wall time: 66 µs
```
So there is a slowdown with creating the instances of `ManinSymbol` that comes from the new branch and Peters by creating instances of `Element`. Hence this is a slowdown we might just have to deal with (assuming one is actually wanting the `ManinSymbol`, not the indexing tuple which can be grabbed by `symbol_list`).

---
New commits:



---

archive/issue_comments_230757.json:
```json
{
    "body": "If I'm reading your test, that's not just \"a slowdown...we might just have to deal with\", it's an **epic slowdown**, by a full factor of 10.   Am I reading that right?  If so, then this is definitely seriously worrisome.",
    "created_at": "2015-01-15T21:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230757",
    "user": "https://github.com/williamstein"
}
```

If I'm reading your test, that's not just "a slowdown...we might just have to deal with", it's an **epic slowdown**, by a full factor of 10.   Am I reading that right?  If so, then this is definitely seriously worrisome.



---

archive/issue_comments_230758.json:
```json
{
    "body": "Replying to [comment:13 was]:\n> If I'm reading your test, that's not just \"a slowdown...we might just have to deal with\", it's an **epic slowdown**, by a full factor of 10.   Am I reading that right?  If so, then this is definitely seriously worrisome.\n\n\nThe first line is the actual creation, the second is when the caching comes into effect. However the slowdown is by ~1.4x due to the overhead. Thus if we want to fix the probthese without the overhead from the category, we need an entirely different approach. Do you think you could run a timing in a more realistic computation or post such a computation?",
    "created_at": "2015-01-15T21:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230758",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:13 was]:
> If I'm reading your test, that's not just "a slowdown...we might just have to deal with", it's an **epic slowdown**, by a full factor of 10.   Am I reading that right?  If so, then this is definitely seriously worrisome.


The first line is the actual creation, the second is when the caching comes into effect. However the slowdown is by ~1.4x due to the overhead. Thus if we want to fix the probthese without the overhead from the category, we need an entirely different approach. Do you think you could run a timing in a more realistic computation or post such a computation?



---

archive/issue_comments_230759.json:
```json
{
    "body": "Here is a new branch incorporating my original fix, Travis's improvements, and a restructuring of the module `sage.modular.modsym.manin_symbols` into two new modules `sage.modular.modsym.manin_symbol` (Cython) and `sage.modular.modsym.manin_symbol` (Python).\n\nThe creation of the list in Travis's example goes down from 191 \u00b5s to 150 \u00b5s on the system on which I tested this.\n\n(I have decided to rebase my branch; it has been inactive for months and I wanted to start with a clean slate.  In particular, I found the duplicate commits in the Git history extremely annoying.)",
    "created_at": "2015-03-20T13:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230759",
    "user": "https://github.com/pjbruin"
}
```

Here is a new branch incorporating my original fix, Travis's improvements, and a restructuring of the module `sage.modular.modsym.manin_symbols` into two new modules `sage.modular.modsym.manin_symbol` (Cython) and `sage.modular.modsym.manin_symbol` (Python).

The creation of the list in Travis's example goes down from 191 µs to 150 µs on the system on which I tested this.

(I have decided to rebase my branch; it has been inactive for months and I wanted to start with a clean slate.  In particular, I found the duplicate commits in the Git history extremely annoying.)



---

archive/issue_comments_230760.json:
```json
{
    "body": "Overall I'm happy with the changes (especially the speedup, which was the sticking point for getting this in). Quick question, could any of those methods for the `ManinSymbol` class be declared `cpdef` and get a speed boost? If not (or you don't think it's necessary to do now), you can set this to a positive review.",
    "created_at": "2015-03-20T16:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230760",
    "user": "https://github.com/tscrim"
}
```

Overall I'm happy with the changes (especially the speedup, which was the sticking point for getting this in). Quick question, could any of those methods for the `ManinSymbol` class be declared `cpdef` and get a speed boost? If not (or you don't think it's necessary to do now), you can set this to a positive review.



---

archive/issue_comments_230761.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> Overall I'm happy with the changes (especially the speedup, which was the sticking point for getting this in).\n\nThanks!\n> Quick question, could any of those methods for the `ManinSymbol` class be declared `cpdef` and get a speed boost? If not (or you don't think it's necessary to do now), you can set this to a positive review.\n\nI prefer to do this later if and when it becomes necessary.",
    "created_at": "2015-03-20T20:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230761",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:16 tscrim]:
> Overall I'm happy with the changes (especially the speedup, which was the sticking point for getting this in).

Thanks!
> Quick question, could any of those methods for the `ManinSymbol` class be declared `cpdef` and get a speed boost? If not (or you don't think it's necessary to do now), you can set this to a positive review.

I prefer to do this later if and when it becomes necessary.



---

archive/issue_comments_230762.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-20T20:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230762",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230763.json:
```json
{
    "body": "Alright. Thanks for your work on this (and on improving the modules!!!).",
    "created_at": "2015-03-20T20:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230763",
    "user": "https://github.com/tscrim"
}
```

Alright. Thanks for your work on this (and on improving the modules!!!).



---

archive/issue_events_050441.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-21T12:37:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17578#event-50441"
}
```



---

archive/issue_comments_230764.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-21T12:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17578",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17578#issuecomment-230764",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
