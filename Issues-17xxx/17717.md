# Issue 17717: Failure to reduce int modulo large prime

archive/issues_017480.json:
```json
{
    "body": "Keywords: modular arithmetic\n\n```\nsage: p = next_prime(2^32)\nsage: p\n4294967311\nsage: GF(p)(int(p+1))\n4294967312\nsage: GF(p)(p+1)\n1\n```\n\nThe issue arises in \nsage/rings/finite_rings/integer_mod.pyx\n\nclass method\nIntegerMod_gmp.set_from_long\n\nOn line 1732, the code reduces value (mod modulus) when value < 0 or ( value < modulus ). The latter condition is backward. It should be replaced with ( modulus < value). \n\nReplace line 1732\n        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) >= 0:`\nwith\n        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) <= 0:`\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17717\n\n",
    "closed_at": "2015-02-18T23:22:40Z",
    "created_at": "2015-02-03T02:06:47Z",
    "labels": [
        "component: finite rings",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Failure to reduce int modulo large prime",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17717",
    "user": "https://trac.sagemath.org/admin/accounts/users/xander.faber"
}
```
Keywords: modular arithmetic

```
sage: p = next_prime(2^32)
sage: p
4294967311
sage: GF(p)(int(p+1))
4294967312
sage: GF(p)(p+1)
1
```

The issue arises in 
sage/rings/finite_rings/integer_mod.pyx

class method
IntegerMod_gmp.set_from_long

On line 1732, the code reduces value (mod modulus) when value < 0 or ( value < modulus ). The latter condition is backward. It should be replaced with ( modulus < value). 

Replace line 1732
        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) >= 0:`
with
        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) <= 0:`



Issue created by migration from https://trac.sagemath.org/ticket/17717





---

archive/issue_comments_233273.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-10T01:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233274.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-10T01:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233274",
    "user": "https://trac.sagemath.org/admin/accounts/users/xander.faber"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233275.json:
```json
{
    "body": "Yes, those are indeed the other way around. I think the more consistent solution (at least with `set_from_mpz` above it) is\n\n```python\nif value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0\n```\nand then if you could also add a doctest to that method\n\n```\n\"\"\"\nEXAMPLES::\n\n    sage: p = next_prime(2^32)\n    sage: GF(p)(int(p+1))\n    1\n\"\"\"\n```\nThanks.",
    "created_at": "2015-02-10T08:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233275",
    "user": "https://github.com/tscrim"
}
```

Yes, those are indeed the other way around. I think the more consistent solution (at least with `set_from_mpz` above it) is

```python
if value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0
```
and then if you could also add a doctest to that method

```
"""
EXAMPLES::

    sage: p = next_prime(2^32)
    sage: GF(p)(int(p+1))
    1
"""
```
Thanks.



---

archive/issue_comments_233276.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-12T01:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233277.json:
```json
{
    "body": "tscrim - The fix you suggest has the wrong syntax for gmp. The mpz_t must be the first argument. \n\nDoctest added\n\n---\nNew commits:\n|                                                                                                                                          |               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[c962120](http://git.sagemath.org/sage.git/commit/?id=c962120feca71975f1cb72f9d095058a2f854c3a)|`Doctest added`|\n---\nNew commits:",
    "created_at": "2015-02-12T01:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233277",
    "user": "https://trac.sagemath.org/admin/accounts/users/xander.faber"
}
```

tscrim - The fix you suggest has the wrong syntax for gmp. The mpz_t must be the first argument. 

Doctest added

---
New commits:
|                                                                                                                                          |               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[c962120](http://git.sagemath.org/sage.git/commit/?id=c962120feca71975f1cb72f9d095058a2f854c3a)|`Doctest added`|
---
New commits:



---

archive/issue_comments_233278.json:
```json
{
    "body": "Ah, I see, it's a different function. You need to indent the code within the `EXAMPLES::` block one more, and once you do that, you can set a positive review on my behalf. Thanks.",
    "created_at": "2015-02-12T05:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233278",
    "user": "https://github.com/tscrim"
}
```

Ah, I see, it's a different function. You need to indent the code within the `EXAMPLES::` block one more, and once you do that, you can set a positive review on my behalf. Thanks.



---

archive/issue_comments_233279.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-12T09:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233279",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-12T11:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233281.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-02-12T11:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233281",
    "user": "https://trac.sagemath.org/admin/accounts/users/xander.faber"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_050691.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-18T23:22:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17717#event-50691"
}
```



---

archive/issue_comments_233282.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-18T23:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17717#issuecomment-233282",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
