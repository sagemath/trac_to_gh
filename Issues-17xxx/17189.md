# Issue 17189: Upon the first pass of the documentation compilation, undefined label warnings should not trigger an exception

archive/issues_016952.json:
```json
{
    "body": "Currently, any warning during the documentation compilation causes an exception which stops the compilation. \n\nThis prevents adding certain cross links in the reference\nmanual. Indeed an undefined warning is issued during the first pass of\nthe compilation whenever some document A cross links to some document\nB while A happens to be compiled before document B.\n\nWith this ticket, warnings during the first pass of compilation don't\ntrigger an exception any more. This ticket also adds a cross link from\nsage.dynamics to sage.combinat to illustrate and test the issue.\n\n\nCC:  @hivert @jhpalmieri sage-combinat @vbraun\n\nReviewer: John Palmieri\n\nAuthor: Florent Hivert, Nicolas M. Thi\u00e9ry\n\nBranch: fb43b1946ab3f7e5de66e0bc1eb885c9173ba2c3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17189\n\n",
    "closed_at": "2014-10-24T10:14:39Z",
    "created_at": "2014-10-21T15:48:16Z",
    "labels": [
        "component: documentation",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Upon the first pass of the documentation compilation, undefined label warnings should not trigger an exception",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17189",
    "user": "https://github.com/nthiery"
}
```
Currently, any warning during the documentation compilation causes an exception which stops the compilation. 

This prevents adding certain cross links in the reference
manual. Indeed an undefined warning is issued during the first pass of
the compilation whenever some document A cross links to some document
B while A happens to be compiled before document B.

With this ticket, warnings during the first pass of compilation don't
trigger an exception any more. This ticket also adds a cross link from
sage.dynamics to sage.combinat to illustrate and test the issue.


CC:  @hivert @jhpalmieri sage-combinat @vbraun

Reviewer: John Palmieri

Author: Florent Hivert, Nicolas M. Thi√©ry

Branch: fb43b1946ab3f7e5de66e0bc1eb885c9173ba2c3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17189





---

archive/issue_comments_239075.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to documentation.",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239075",
    "user": "https://github.com/nthiery"
}
```

Changing component from PLEASE CHANGE to documentation.



---

archive/issue_comments_239076.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239076",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_239077.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+Currently, any warning during the documentation compilation causes an exception which stops the compilation. \n+\n+This prevents adding certain cross links in the reference\n+manual. Indeed an undefined warning is issued during the first pass of\n+the compilation whenever some document A cross links to some document\n+B while A happens to be compiled before document B.\n+\n+With this ticket, warnings during the first pass of compilation don't\n+trigger an exception any more. This ticket also adds a cross link from\n+sage.dynamics to sage.combinat to illustrate and test the issue.\n \n \n Comment: 1\n```\n",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239077",
    "user": "https://github.com/nthiery"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,13 @@
+Currently, any warning during the documentation compilation causes an exception which stops the compilation. 
+
+This prevents adding certain cross links in the reference
+manual. Indeed an undefined warning is issued during the first pass of
+the compilation whenever some document A cross links to some document
+B while A happens to be compiled before document B.
+
+With this ticket, warnings during the first pass of compilation don't
+trigger an exception any more. This ticket also adds a cross link from
+sage.dynamics to sage.combinat to illustrate and test the issue.
 
 
 Comment: 1
```




---

archive/issue_comments_239078.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239078",
    "user": "https://github.com/nthiery"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_239079.json:
```json
{
    "body": "<a id='comment:3'></a>This is needed for #16256.",
    "created_at": "2014-10-21T16:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239079",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>This is needed for #16256.



---

archive/issue_comments_239080.json:
```json
{
    "body": "<a id='comment:5'></a>When read aloud in French, this is a revolutionary ticket number :-)\n\n---\nNew commits:",
    "created_at": "2014-10-21T16:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239080",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>When read aloud in French, this is a revolutionary ticket number :-)

---
New commits:



---

archive/issue_comments_239081.json:
```json
{
    "body": "<a id='comment:6'></a>The problem with ignoring warnings is that you're ignoring warnings, so badly formatted documentation builds without an error. I tested by misformatting some documentation and running `make`. In the docbuilding log, I saw a line like\n\n```\nWARNING: Block quote ends without a blank line; unexpected unindent.\n```\non the first pass, not the second, and as a result, the documentation claimed to build successfully. How about something like this instead:\n\n```diff\ndiff --git a/src/doc/common/custom-sphinx-build.py b/src/doc/common/custom-sphinx-build.py\nindex 712694e..f1b48fa 100644\n--- a/src/doc/common/custom-sphinx-build.py\n+++ b/src/doc/common/custom-sphinx-build.py\n@@ -58,9 +58,12 @@ warnings = (re.compile('Segmentation fault'),\n # Unless this is the first pass of the compilation (where some cross\n # links may not be resolvable yet), or we are compiling the latex\n # documentation, we want all warnings to raise an exception.\n-if 'multidoc_first_pass=1' not in sys.argv and 'latex' not in sys.argv:\n-    warnings += (re.compile('WARNING'),)\n-\n+if 'latex' not in sys.argv:\n+    if 'multidoc_first_pass=1' in sys.argv:\n+        # Catch all warnings except 'WARNING: undefined label'\n+        warnings += (re.compile('WARNING: (?!undefined label)'),)\n+    else:\n+        warnings += (re.compile('WARNING:'),)\n \n # Do not error out at the first warning, sometimes there is more\n # information. So we run until the end of the file and only then raise\n```\nThe `(?!STRING)` syntax matches anything except for `STRING`: see https://docs.python.org/2/library/re.html.",
    "created_at": "2014-10-21T19:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239081",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>The problem with ignoring warnings is that you're ignoring warnings, so badly formatted documentation builds without an error. I tested by misformatting some documentation and running `make`. In the docbuilding log, I saw a line like

```
WARNING: Block quote ends without a blank line; unexpected unindent.
```
on the first pass, not the second, and as a result, the documentation claimed to build successfully. How about something like this instead:

```diff
diff --git a/src/doc/common/custom-sphinx-build.py b/src/doc/common/custom-sphinx-build.py
index 712694e..f1b48fa 100644
--- a/src/doc/common/custom-sphinx-build.py
+++ b/src/doc/common/custom-sphinx-build.py
@@ -58,9 +58,12 @@ warnings = (re.compile('Segmentation fault'),
 # Unless this is the first pass of the compilation (where some cross
 # links may not be resolvable yet), or we are compiling the latex
 # documentation, we want all warnings to raise an exception.
-if 'multidoc_first_pass=1' not in sys.argv and 'latex' not in sys.argv:
-    warnings += (re.compile('WARNING'),)
-
+if 'latex' not in sys.argv:
+    if 'multidoc_first_pass=1' in sys.argv:
+        # Catch all warnings except 'WARNING: undefined label'
+        warnings += (re.compile('WARNING: (?!undefined label)'),)
+    else:
+        warnings += (re.compile('WARNING:'),)
 
 # Do not error out at the first warning, sometimes there is more
 # information. So we run until the end of the file and only then raise
```
The `(?!STRING)` syntax matches anything except for `STRING`: see https://docs.python.org/2/library/re.html.



---

archive/issue_comments_239082.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-21T19:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239082",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_239083.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T21:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239084.json:
```json
{
    "body": "<a id='comment:8'></a>Ah, good catch, I thought those warnings would be reissued upon the second pass. In that case, sure, this looks good.\n\n---\nNew commits:",
    "created_at": "2014-10-21T21:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239084",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>Ah, good catch, I thought those warnings would be reissued upon the second pass. In that case, sure, this looks good.

---
New commits:



---

archive/issue_comments_239085.json:
```json
{
    "body": "<a id='comment:9'></a>I think this looks good now. Any objections from anyone else?",
    "created_at": "2014-10-22T04:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239085",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>I think this looks good now. Any objections from anyone else?



---

archive/issue_comments_239086.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-23T03:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239086",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_049813.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-24T10:14:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17189#event-49813"
}
```



---

archive/issue_comments_239087.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-24T10:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239087",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_239088.json:
```json
{
    "body": "<a id='comment:12'></a>Forgot your own middle initial, sir.",
    "created_at": "2014-11-14T18:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17189#issuecomment-239088",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>Forgot your own middle initial, sir.
