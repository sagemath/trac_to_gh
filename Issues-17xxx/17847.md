# Issue 17847: Cython: embed signatures in docstrings of Sage library code

archive/issues_017610.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nBefore:\n\n```\nsage: print GF(5).factored_unit_order.__doc__\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)\n\n        Returns the factorization of ``self.order()-1``, as a 1-element list.\n\n        The format is for compatibility with\n        :mod:`~sage.rings.finite_rings.integer_mod_ring`.\n\n        EXAMPLES::\n\n            sage: GF(7^2,'a').factored_unit_order()\n            [2^4 * 3]\n        \n```\n\nAfter:\n\n```\nsage: print GF(5).factored_unit_order.__doc__\nFiniteField.factored_unit_order(self)\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)\n\n        Returns the factorization of ``self.order()-1``, as a 1-element list.\n\n        The format is for compatibility with\n        :mod:`~sage.rings.finite_rings.integer_mod_ring`.\n\n        EXAMPLES::\n\n            sage: GF(7^2,'a').factored_unit_order()\n            [2^4 * 3]\n        \n```\n\n**Upstream bug** which will be fixed in Cython 0.23:\n* [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nCC:  @simon-king-jena\n\nComponent: **cython**\n\nAuthor: **Jeroen Demeyer, Simon King**\n\nBranch/Commit: **[`cc9e9f6`](https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90)**\n\nReviewer: **Simon King, Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17847_\n\n",
    "closed_at": "2015-04-14T19:43:56Z",
    "created_at": "2015-02-24T10:39:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Cython: embed signatures in docstrings of Sage library code",
    "type": "issue",
    "updated_at": "2015-04-14T19:43:56Z",
    "url": "https://github.com/sagemath/sage/issues/17847",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

Before:

```
sage: print GF(5).factored_unit_order.__doc__
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)

        Returns the factorization of ``self.order()-1``, as a 1-element list.

        The format is for compatibility with
        :mod:`~sage.rings.finite_rings.integer_mod_ring`.

        EXAMPLES::

            sage: GF(7^2,'a').factored_unit_order()
            [2^4 * 3]
        
```

After:

```
sage: print GF(5).factored_unit_order.__doc__
FiniteField.factored_unit_order(self)
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)

        Returns the factorization of ``self.order()-1``, as a 1-element list.

        The format is for compatibility with
        :mod:`~sage.rings.finite_rings.integer_mod_ring`.

        EXAMPLES::

            sage: GF(7^2,'a').factored_unit_order()
            [2^4 * 3]
        
```

**Upstream bug** which will be fixed in Cython 0.23:
* [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)

Upstream: **Fixed upstream, but not in a stable release.**

CC:  @simon-king-jena

Component: **cython**

Author: **Jeroen Demeyer, Simon King**

Branch/Commit: **[`cc9e9f6`](https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90)**

Reviewer: **Simon King, Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/17847_





---

archive/issue_events_251695.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-24T10:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251695"
}
```



---

archive/issue_events_251696.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-24T10:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "0000b0",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251696"
}
```



---

archive/issue_events_251697.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-24T10:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251697"
}
```



---

archive/issue_events_251698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-24T10:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251698"
}
```



---

archive/issue_comments_241337.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,36 @@\n+Before:\n \n+```\n+sage: print GF(5).factored_unit_order.__doc__\n+File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)\n+\n+        Returns the factorization of ``self.order()-1``, as a 1-element list.\n+\n+        The format is for compatibility with\n+        :mod:`~sage.rings.finite_rings.integer_mod_ring`.\n+\n+        EXAMPLES::\n+\n+            sage: GF(7^2,'a').factored_unit_order()\n+            [2^4 * 3]\n+        \n+```\n+\n+After:\n+\n+```\n+sage: print GF(5).factored_unit_order.__doc__\n+FiniteField.factored_unit_order(self)\n+File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)\n+\n+        Returns the factorization of ``self.order()-1``, as a 1-element list.\n+\n+        The format is for compatibility with\n+        :mod:`~sage.rings.finite_rings.integer_mod_ring`.\n+\n+        EXAMPLES::\n+\n+            sage: GF(7^2,'a').factored_unit_order()\n+            [2^4 * 3]\n+        \n+```\n``````\n",
    "created_at": "2015-02-24T10:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241337",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,36 @@
+Before:
 
+```
+sage: print GF(5).factored_unit_order.__doc__
+File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)
+
+        Returns the factorization of ``self.order()-1``, as a 1-element list.
+
+        The format is for compatibility with
+        :mod:`~sage.rings.finite_rings.integer_mod_ring`.
+
+        EXAMPLES::
+
+            sage: GF(7^2,'a').factored_unit_order()
+            [2^4 * 3]
+        
+```
+
+After:
+
+```
+sage: print GF(5).factored_unit_order.__doc__
+FiniteField.factored_unit_order(self)
+File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 729)
+
+        Returns the factorization of ``self.order()-1``, as a 1-element list.
+
+        The format is for compatibility with
+        :mod:`~sage.rings.finite_rings.integer_mod_ring`.
+
+        EXAMPLES::
+
+            sage: GF(7^2,'a').factored_unit_order()
+            [2^4 * 3]
+        
+```
``````




---

archive/issue_comments_241338.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,6 @@\n             [2^4 * 3]\n         \n ```\n+\n+**Upstream bugs** which need to be fixed first:\n+* [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)\n``````\n",
    "created_at": "2015-02-24T11:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241338",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,6 @@
             [2^4 * 3]
         
 ```
+
+**Upstream bugs** which need to be fixed first:
+* [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)
``````




---

archive/issue_comments_241339.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2015-02-24T11:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241339",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_241340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,5 +35,5 @@\n         \n ```\n \n-**Upstream bugs** which need to be fixed first:\n+**Upstream bugs** which we work around:\n * [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)\n``````\n",
    "created_at": "2015-02-24T11:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241340",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,5 +35,5 @@
         
 ```
 
-**Upstream bugs** which need to be fixed first:
+**Upstream bugs** which we work around:
 * [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)
``````




---

archive/issue_comments_241341.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,5 +35,6 @@\n         \n ```\n \n-**Upstream bugs** which we work around:\n+**Upstream bugs** which we need to work around:\n * [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)\n+* [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)\n``````\n",
    "created_at": "2015-02-24T11:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241341",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,5 +35,6 @@
         
 ```
 
-**Upstream bugs** which we work around:
+**Upstream bugs** which we need to work around:
 * [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)
+* [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)
``````




---

archive/issue_comments_241342.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**",
    "created_at": "2015-02-24T14:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241342",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**



---

archive/issue_comments_241343.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to none",
    "created_at": "2015-02-24T14:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241343",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to none



---

archive/issue_comments_241344.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe attached branch mostly works, but there are still issues in `src/sage/misc/sageinspect.py`\n\nIn particular, I need help with navigating this maze:\n\n```python\ndef _sage_getsourcelines_name_with_dot(object):\n    r\"\"\"\n    [...]\n    AUTHOR:\n\n    - Simon King (2011-09)\n    \"\"\"\n    # First, split the name:\n    if '.' in object.__name__:\n        splitted_name = object.__name__.split('.')\n    elif hasattr(object,'__qualname__'):\n        splitted_name = object.__qualname__.split('.')\n    else:\n        splitted_name = object.__name__\n    path = object.__module__.split('.')+splitted_name[:-1]\n    name = splitted_name[-1]\n    try:\n        M = __import__(path.pop(0))\n    except ImportError:\n        try:\n            B = object.__base__\n            if B is None:\n                raise AttributeError\n        except AttributeError:\n            raise IOError(\"could not get source code\")\n        return sage_getsourcelines(B)\n    # M should just be the top-most module.\n    # Hence, normally it is just 'sage'\n    try:\n        while path:\n            M = getattr(M, path.pop(0))\n    except AttributeError:\n        try:\n            B = object.__base__\n            if B is None:\n                raise AttributeError\n        except AttributeError:\n            raise IOError(\"could not get source code\")\n        return sage_getsourcelines(B)\n\n    lines, base_lineno = sage_getsourcelines(M)\n    [...]\n```",
    "created_at": "2015-02-24T14:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241344",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

The attached branch mostly works, but there are still issues in `src/sage/misc/sageinspect.py`

In particular, I need help with navigating this maze:

```python
def _sage_getsourcelines_name_with_dot(object):
    r"""
    [...]
    AUTHOR:

    - Simon King (2011-09)
    """
    # First, split the name:
    if '.' in object.__name__:
        splitted_name = object.__name__.split('.')
    elif hasattr(object,'__qualname__'):
        splitted_name = object.__qualname__.split('.')
    else:
        splitted_name = object.__name__
    path = object.__module__.split('.')+splitted_name[:-1]
    name = splitted_name[-1]
    try:
        M = __import__(path.pop(0))
    except ImportError:
        try:
            B = object.__base__
            if B is None:
                raise AttributeError
        except AttributeError:
            raise IOError("could not get source code")
        return sage_getsourcelines(B)
    # M should just be the top-most module.
    # Hence, normally it is just 'sage'
    try:
        while path:
            M = getattr(M, path.pop(0))
    except AttributeError:
        try:
            B = object.__base__
            if B is None:
                raise AttributeError
        except AttributeError:
            raise IOError("could not get source code")
        return sage_getsourcelines(B)

    lines, base_lineno = sage_getsourcelines(M)
    [...]
```



---

archive/issue_comments_241345.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**",
    "created_at": "2015-02-24T14:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241345",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**



---

archive/issue_comments_241346.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d2b63ada25df1241cca248d26a4df51e3a5be5b\"><code>6d2b63a</code></a></td><td><code>Cython: embed signatures in docstrings</code></td></tr></table>\n",
    "created_at": "2015-02-24T14:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241346",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d2b63ada25df1241cca248d26a4df51e3a5be5b"><code>6d2b63a</code></a></td><td><code>Cython: embed signatures in docstrings</code></td></tr></table>




---

archive/issue_comments_241347.json:
```json
{
    "body": "Commit: **[`6d2b63a`](https://github.com/sagemath/sagetrac-mirror/commit/6d2b63ada25df1241cca248d26a4df51e3a5be5b)**",
    "created_at": "2015-02-24T14:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241347",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`6d2b63a`](https://github.com/sagemath/sagetrac-mirror/commit/6d2b63ada25df1241cca248d26a4df51e3a5be5b)**



---

archive/issue_comments_241348.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n> The attached branch mostly works, but there are still issues in `src/sage/misc/sageinspect.py`\n> \n> In particular, I need help with navigating this maze:\n> \n> ```python\n> def _sage_getsourcelines_name_with_dot(object):\n> ```\n\nThat's for dynamic classes, hence, it is pure Python, and the embedding in docstrings isn't relevant here.\n\nDetails: In the category framework we have all these nested dynamic classes which get a name that is formed by the name of a class they will be attribute of. Hence:\n\n```python\nclass Modules(Category):\n    def __init__(...):\n        ...\n    class Homset(Homset_generic):\n        def __init__(...)\n```\nHence, you have a class `Modules` and you have an attribute `Modules.Homset` that itself is a class (nested classes). Now, you will find:\n\n```\nsage: Modules.Homset.__name__\n'Modules.Homset'\n```\n\nHence, you will NOT find the source code of the class by searching the name in the source file. But the name does give you a possibility to find the code, namely by first searching for the source of the class `Modules` in the source file and then searching for the source of the class `Homset` in the source of `Modules`.\n\nIt isn't relevant for Cython classes, since there is a metaclass at work (and you can't have metaclass for Cython classes). It *could* perhaps be in a cython file, though.",
    "created_at": "2015-02-24T15:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241348",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment%3A6):
> The attached branch mostly works, but there are still issues in `src/sage/misc/sageinspect.py`
> 
> In particular, I need help with navigating this maze:
> 
> ```python
> def _sage_getsourcelines_name_with_dot(object):
> ```

That's for dynamic classes, hence, it is pure Python, and the embedding in docstrings isn't relevant here.

Details: In the category framework we have all these nested dynamic classes which get a name that is formed by the name of a class they will be attribute of. Hence:

```python
class Modules(Category):
    def __init__(...):
        ...
    class Homset(Homset_generic):
        def __init__(...)
```
Hence, you have a class `Modules` and you have an attribute `Modules.Homset` that itself is a class (nested classes). Now, you will find:

```
sage: Modules.Homset.__name__
'Modules.Homset'
```

Hence, you will NOT find the source code of the class by searching the name in the source file. But the name does give you a possibility to find the code, namely by first searching for the source of the class `Modules` in the source file and then searching for the source of the class `Homset` in the source of `Modules`.

It isn't relevant for Cython classes, since there is a metaclass at work (and you can't have metaclass for Cython classes). It *could* perhaps be in a cython file, though.



---

archive/issue_comments_241349.json:
```json
{
    "body": "Dependencies: **#17851**",
    "created_at": "2015-02-25T07:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241349",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#17851**



---

archive/issue_comments_241350.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,6 +35,5 @@\n         \n ```\n \n-**Upstream bugs** which we need to work around:\n-* [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)\n+**Upstream bug** which we need to work around:\n * [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)\n``````\n",
    "created_at": "2015-02-25T07:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241350",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,6 +35,5 @@
         
 ```
 
-**Upstream bugs** which we need to work around:
-* [http://trac.cython.org/ticket/842](http://trac.cython.org/ticket/842)
+**Upstream bug** which we need to work around:
 * [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)
``````




---

archive/issue_comments_241351.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98a581300ec495b9c39ebe3484f407a491f8bb95\"><code>98a5813</code></a></td><td><code>Nuke Cython cache when Cython version changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cd65e13a5ab68dc0da005240e2686bb6b63bda2\"><code>9cd65e1</code></a></td><td><code>Merge commit '98a581300ec495b9c39ebe3484f407a491f8bb95' into t/17847/ticket/17847</code></td></tr></table>\n",
    "created_at": "2015-02-25T08:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241351",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98a581300ec495b9c39ebe3484f407a491f8bb95"><code>98a5813</code></a></td><td><code>Nuke Cython cache when Cython version changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cd65e13a5ab68dc0da005240e2686bb6b63bda2"><code>9cd65e1</code></a></td><td><code>Merge commit '98a581300ec495b9c39ebe3484f407a491f8bb95' into t/17847/ticket/17847</code></td></tr></table>




---

archive/issue_comments_241352.json:
```json
{
    "body": "Changed commit from **[`6d2b63a`](https://github.com/sagemath/sagetrac-mirror/commit/6d2b63ada25df1241cca248d26a4df51e3a5be5b)** to **[`9cd65e1`](https://github.com/sagemath/sagetrac-mirror/commit/9cd65e13a5ab68dc0da005240e2686bb6b63bda2)**",
    "created_at": "2015-02-25T08:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241352",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d2b63a`](https://github.com/sagemath/sagetrac-mirror/commit/6d2b63ada25df1241cca248d26a4df51e3a5be5b)** to **[`9cd65e1`](https://github.com/sagemath/sagetrac-mirror/commit/9cd65e13a5ab68dc0da005240e2686bb6b63bda2)**



---

archive/issue_comments_241353.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@simon-king-jena](#comment%3A9):\n> Replying to [@jdemeyer](#comment%3A6):\n> > The attached branch mostly works, but there are still issues in `src/sage/misc/sageinspect.py`\n> > \n> > In particular, I need help with navigating this maze:\n> > \n> > ```python\n> > def _sage_getsourcelines_name_with_dot(object):\n> > ```\n> \n> \n> That's for dynamic classes, hence, it is pure Python, and the embedding in docstrings isn't relevant here.\n\nApparently it *is* relevant, since I'm getting doctest failures in this function:\n\n```\nsage -t src/sage/misc/nested_class_test.py\n**********************************************************************\nFile \"src/sage/misc/nested_class_test.py\", line 215, in sage.misc.nested_class_test.TestNestedParent\nFailed example:\n    print sage_getsource(E)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 850, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.nested_class_test.TestNestedParent[5]>\", line 1, in <module>\n        print sage_getsource(E)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py\", line 1641, in sage_getsource\n        t = sage_getsourcelines(obj, is_binary)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py\", line 1895, in sage_getsourcelines\n        return obj._sage_src_lines_()\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/dynamic_class.py\", line 392, in _sage_src_lines\n        return sage_getsourcelines(doccls)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py\", line 1921, in sage_getsourcelines\n        return _sage_getsourcelines_name_with_dot(obj)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py\", line 1755, in _sage_getsourcelines_name_with_dot\n        raise IOError('could not find class definition')\n    IOError: could not find class definition\n**********************************************************************\n```",
    "created_at": "2015-02-25T09:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241353",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@simon-king-jena](#comment%3A9):
> Replying to [@jdemeyer](#comment%3A6):
> > The attached branch mostly works, but there are still issues in `src/sage/misc/sageinspect.py`
> > 
> > In particular, I need help with navigating this maze:
> > 
> > ```python
> > def _sage_getsourcelines_name_with_dot(object):
> > ```
> 
> 
> That's for dynamic classes, hence, it is pure Python, and the embedding in docstrings isn't relevant here.

Apparently it *is* relevant, since I'm getting doctest failures in this function:

```
sage -t src/sage/misc/nested_class_test.py
**********************************************************************
File "src/sage/misc/nested_class_test.py", line 215, in sage.misc.nested_class_test.TestNestedParent
Failed example:
    print sage_getsource(E)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 850, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.nested_class_test.TestNestedParent[5]>", line 1, in <module>
        print sage_getsource(E)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py", line 1641, in sage_getsource
        t = sage_getsourcelines(obj, is_binary)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py", line 1895, in sage_getsourcelines
        return obj._sage_src_lines_()
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/dynamic_class.py", line 392, in _sage_src_lines
        return sage_getsourcelines(doccls)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py", line 1921, in sage_getsourcelines
        return _sage_getsourcelines_name_with_dot(obj)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/misc/sageinspect.py", line 1755, in _sage_getsourcelines_name_with_dot
        raise IOError('could not find class definition')
    IOError: could not find class definition
**********************************************************************
```



---

archive/issue_comments_241354.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe `TestNestedParent` does inherit from the Cython class `Parent`, perhaps that's how Cython comes in.",
    "created_at": "2015-02-25T09:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241354",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

The `TestNestedParent` does inherit from the Cython class `Parent`, perhaps that's how Cython comes in.



---

archive/issue_comments_241355.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,5 +35,5 @@\n         \n ```\n \n-**Upstream bug** which we need to work around:\n+**Upstream bug** which will be fixed in Cython 0.23:\n * [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)\n``````\n",
    "created_at": "2015-04-07T08:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241355",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,5 +35,5 @@
         
 ```
 
-**Upstream bug** which we need to work around:
+**Upstream bug** which will be fixed in Cython 0.23:
 * [http://trac.cython.org/ticket/843](http://trac.cython.org/ticket/843)
``````




---

archive/issue_comments_241356.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2015-04-07T08:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241356",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_241357.json:
```json
{
    "body": "Changed dependencies from **#17851** to none",
    "created_at": "2015-04-07T08:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241357",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17851** to none



---

archive/issue_comments_241358.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2015-04-07T08:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241358",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_241359.json:
```json
{
    "body": "Changed commit from **[`9cd65e1`](https://github.com/sagemath/sagetrac-mirror/commit/9cd65e13a5ab68dc0da005240e2686bb6b63bda2)** to **[`1a36cc9`](https://github.com/sagemath/sagetrac-mirror/commit/1a36cc96d1e9ebd5d46a3dd9c027a41e89da2ebc)**",
    "created_at": "2015-04-07T09:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241359",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9cd65e1`](https://github.com/sagemath/sagetrac-mirror/commit/9cd65e13a5ab68dc0da005240e2686bb6b63bda2)** to **[`1a36cc9`](https://github.com/sagemath/sagetrac-mirror/commit/1a36cc96d1e9ebd5d46a3dd9c027a41e89da2ebc)**



---

archive/issue_comments_241360.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a36cc96d1e9ebd5d46a3dd9c027a41e89da2ebc\"><code>1a36cc9</code></a></td><td><code>Cython: embed signatures in docstrings</code></td></tr></table>\n",
    "created_at": "2015-04-07T09:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241360",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a36cc96d1e9ebd5d46a3dd9c027a41e89da2ebc"><code>1a36cc9</code></a></td><td><code>Cython: embed signatures in docstrings</code></td></tr></table>




---

archive/issue_comments_241361.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nRebased and included upstream Cython patch, but it still doesn't work due to the issue with `_sage_getsourcelines_name_with_dot()`",
    "created_at": "2015-04-07T09:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241361",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Rebased and included upstream Cython patch, but it still doesn't work due to the issue with `_sage_getsourcelines_name_with_dot()`



---

archive/issue_comments_241362.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOK, I'll have a look.\n\nDo I need to do \"sage -ba\" to build it, or is that done automatically because of dependency checking?\n\nBest regards,\nSimon",
    "created_at": "2015-04-07T10:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241362",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

OK, I'll have a look.

Do I need to do "sage -ba" to build it, or is that done automatically because of dependency checking?

Best regards,
Simon



---

archive/issue_comments_241363.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n\n```\nError building Sage.\n\nThe following package(s) may have failed to build:\n\npackage: sagenb-0.11.4\nlog file: /home/king/Sage/git/sage/logs/pkgs/sagenb-0.11.4.log\nbuild directory: /home/king/Sage/git/sage/local/var/tmp/sage/build/sagenb-0.11.4\n\nThe build directory may contain configuration files and other potentially\nhelpful information. WARNING: if you now run 'make' again, the build\ndirectory will, by default, be deleted. Set the environment variable\nSAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.\n\nMakefile:19: recipe for target 'build' failed\nmake: *** [build] Error 1\n```\n\nReason:\n\n```\nTraceback (most recent call last):\n  File \"/home/king/Sage/git/sage/local/bin/pip\", line 9, in <module>\n    load_entry_point('pip==1.5.6', 'console_scripts', 'pip')()\n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 521, in load_entry_point\n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 2632, in load_entry_point\n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 2312, in load\n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 2318, in resolve\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/__init__.py\", l\nine 10, in <module>\n    from pip.util import get_installed_distributions, get_prog\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/util.py\", line \n18, in <module>\n    from pip._vendor.distlib import version\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/_vendor/distlib\n/version.py\", line 14, in <module>\n    from .compat import string_types\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/_vendor/distlib\n/compat.py\", line 31, in <module>\n    from urllib2 import (Request, urlopen, URLError, HTTPError,\nImportError: cannot import name HTTPSHandler\nError: Installing SageNB failed.\n```\nWhy does pip come into play here? Isn't pip optional?",
    "created_at": "2015-04-07T10:37:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241363",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">comment:20</div>


```
Error building Sage.

The following package(s) may have failed to build:

package: sagenb-0.11.4
log file: /home/king/Sage/git/sage/logs/pkgs/sagenb-0.11.4.log
build directory: /home/king/Sage/git/sage/local/var/tmp/sage/build/sagenb-0.11.4

The build directory may contain configuration files and other potentially
helpful information. WARNING: if you now run 'make' again, the build
directory will, by default, be deleted. Set the environment variable
SAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.

Makefile:19: recipe for target 'build' failed
make: *** [build] Error 1
```

Reason:

```
Traceback (most recent call last):
  File "/home/king/Sage/git/sage/local/bin/pip", line 9, in <module>
    load_entry_point('pip==1.5.6', 'console_scripts', 'pip')()
  File "build/bdist.linux-x86_64/egg/pkg_resources/__init__.py", line 521, in load_entry_point
  File "build/bdist.linux-x86_64/egg/pkg_resources/__init__.py", line 2632, in load_entry_point
  File "build/bdist.linux-x86_64/egg/pkg_resources/__init__.py", line 2312, in load
  File "build/bdist.linux-x86_64/egg/pkg_resources/__init__.py", line 2318, in resolve
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/__init__.py", l
ine 10, in <module>
    from pip.util import get_installed_distributions, get_prog
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/util.py", line 
18, in <module>
    from pip._vendor.distlib import version
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/_vendor/distlib
/version.py", line 14, in <module>
    from .compat import string_types
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pip-1.5.6-py2.7.egg/pip/_vendor/distlib
/compat.py", line 31, in <module>
    from urllib2 import (Request, urlopen, URLError, HTTPError,
ImportError: cannot import name HTTPSHandler
Error: Installing SageNB failed.
```
Why does pip come into play here? Isn't pip optional?



---

archive/issue_comments_241364.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNote that I do have pip installed in Sage.",
    "created_at": "2015-04-07T10:42:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241364",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">comment:21</div>

Note that I do have pip installed in Sage.



---

archive/issue_comments_241365.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@simon-king-jena](#comment%3A19):\n> Do I need to do \"sage -ba\" to build it\n\nNo (and if you do, that's a bug).",
    "created_at": "2015-04-07T11:40:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241365",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@simon-king-jena](#comment%3A19):
> Do I need to do "sage -ba" to build it

No (and if you do, that's a bug).



---

archive/issue_comments_241366.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@simon-king-jena](#comment%3A20):\n> Why does pip come into play here?\n\nThis is #18131.\n\n> Isn't pip optional?\n\nNot anymore.",
    "created_at": "2015-04-07T11:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241366",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@simon-king-jena](#comment%3A20):
> Why does pip come into play here?

This is #18131.

> Isn't pip optional?

Not anymore.



---

archive/issue_comments_241367.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nFirst observation: The underlying problem appears to not be in `_sage_getsourcelines_name_with_dot`.\n\nNamely, the reason why the element class' source can not be found is that the \"parent\" class can not be found:\n\n```\nsage: from sage.misc.sageinspect import sage_getsourcelines\nsage: from sage.misc.nested_class_test import TestNestedParent\nsage: sage_getsourcelines(TestNestedParent)[0][0]\n'cdef class Parent(category_object.CategoryObject):\\n'\n```\nSo, we need to find out why `sage_getsourcelines` returns the sources of `Parent` (a super-class of `TestNestedParent`).\n\n```\nsage: from sage.misc.sageinspect import sage_getfile\nsage: sage_getfile(TestNestedParent)\n'/home/king/Sage/git/sage/src/sage/structure/parent.pyx'\n```\nOK, that's wrong.",
    "created_at": "2015-04-07T17:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241367",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">comment:24</div>

First observation: The underlying problem appears to not be in `_sage_getsourcelines_name_with_dot`.

Namely, the reason why the element class' source can not be found is that the "parent" class can not be found:

```
sage: from sage.misc.sageinspect import sage_getsourcelines
sage: from sage.misc.nested_class_test import TestNestedParent
sage: sage_getsourcelines(TestNestedParent)[0][0]
'cdef class Parent(category_object.CategoryObject):\n'
```
So, we need to find out why `sage_getsourcelines` returns the sources of `Parent` (a super-class of `TestNestedParent`).

```
sage: from sage.misc.sageinspect import sage_getfile
sage: sage_getfile(TestNestedParent)
'/home/king/Sage/git/sage/src/sage/structure/parent.pyx'
```
OK, that's wrong.



---

archive/issue_comments_241368.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n`sage_getfile` relatively early tries to extract the file from the docstring --- and when it fails, then it tries to extract it from the `__init__` of the object!\n\nSo, since `TestNestedParent.__init__` is the same as `Parent.__init__`, things become wrong.",
    "created_at": "2015-04-07T17:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241368",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">comment:25</div>

`sage_getfile` relatively early tries to extract the file from the docstring --- and when it fails, then it tries to extract it from the `__init__` of the object!

So, since `TestNestedParent.__init__` is the same as `Parent.__init__`, things become wrong.



---

archive/issue_comments_241369.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNote that in the present case, Python's `inspect.getfile` returns the right thing.",
    "created_at": "2015-04-07T17:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241369",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:26" align="right">comment:26</div>

Note that in the present case, Python's `inspect.getfile` returns the right thing.



---

archive/issue_comments_241370.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOops:\n\n```\nsage: from sage.misc.sageinspect import _sage_getdoc_unformatted\nsage: print _sage_getdoc_unformatted(TestNestedParent)\nFile: sage/structure/parent.pyx (starting at line 228)\n\n        Base class for all parents.\n\n        Parents are the Sage/mathematical analogues of container\n        objects in computer science.\n\n...\n```\nSo, even though `TestNestedParent` has its own docstring, `_sage_getdoc_unformatted` ignores it.",
    "created_at": "2015-04-07T18:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241370",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">comment:27</div>

Oops:

```
sage: from sage.misc.sageinspect import _sage_getdoc_unformatted
sage: print _sage_getdoc_unformatted(TestNestedParent)
File: sage/structure/parent.pyx (starting at line 228)

        Base class for all parents.

        Parents are the Sage/mathematical analogues of container
        objects in computer science.

...
```
So, even though `TestNestedParent` has its own docstring, `_sage_getdoc_unformatted` ignores it.



---

archive/issue_comments_241371.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n... and that's on purpose, according to the documentation of `_sage_getdoc_unformatted`:\n\n```\nIf ``__init__`` has embedding information, we prefer that::\n\n        sage: C = QQ['x', 'y'].__class__\n        sage: print C.__doc__\n        MPolynomialRing_libsingular(base_ring, n, names, order='degrevlex')\n        sage: print C.__init__.__doc__\n        File: sage/rings/polynomial/multi_polynomial_libsingular.pyx (starting at line ...)\n        <BLANKLINE>\n                Construct a multivariate polynomial ring...\n        sage: print _sage_getdoc_unformatted(C)\n        File: sage/rings/polynomial/multi_polynomial_libsingular.pyx (starting at line ...)\n        <BLANKLINE>\n                Construct a multivariate polynomial ring...\n```\nThus, `_sage_getdoc_unformatted` is the wrong tool for our purpose, since we do *not* want to prefer the doc of `__init__`.\n\nAlso: What happens if a class derived from `Parent` has no docstring?",
    "created_at": "2015-04-07T18:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241371",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">comment:28</div>

... and that's on purpose, according to the documentation of `_sage_getdoc_unformatted`:

```
If ``__init__`` has embedding information, we prefer that::

        sage: C = QQ['x', 'y'].__class__
        sage: print C.__doc__
        MPolynomialRing_libsingular(base_ring, n, names, order='degrevlex')
        sage: print C.__init__.__doc__
        File: sage/rings/polynomial/multi_polynomial_libsingular.pyx (starting at line ...)
        <BLANKLINE>
                Construct a multivariate polynomial ring...
        sage: print _sage_getdoc_unformatted(C)
        File: sage/rings/polynomial/multi_polynomial_libsingular.pyx (starting at line ...)
        <BLANKLINE>
                Construct a multivariate polynomial ring...
```
Thus, `_sage_getdoc_unformatted` is the wrong tool for our purpose, since we do *not* want to prefer the doc of `__init__`.

Also: What happens if a class derived from `Parent` has no docstring?



---

archive/issue_comments_241372.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAt the moment, I try to find out what happens if `_sage_getdoc_unformatted` would *not* prefer the doc of `__init__` if an embedding information is missing.",
    "created_at": "2015-04-07T19:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241372",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:29" align="right">comment:29</div>

At the moment, I try to find out what happens if `_sage_getdoc_unformatted` would *not* prefer the doc of `__init__` if an embedding information is missing.



---

archive/issue_comments_241373.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@simon-king-jena](#comment%3A29):\n> At the moment, I try to find out what happens if `_sage_getdoc_unformatted` would *not* prefer the doc of `__init__` if an embedding information is missing.\n\nIt does solve the current problem. And after all, I think it is not the job of `_sage_getdoc_unformatted` to search for embedding information. If some functions absolutely want to get embedding information, then it is *their* job to search the information. Of course I need to see how much would break.",
    "created_at": "2015-04-07T19:17:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241373",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@simon-king-jena](#comment%3A29):
> At the moment, I try to find out what happens if `_sage_getdoc_unformatted` would *not* prefer the doc of `__init__` if an embedding information is missing.

It does solve the current problem. And after all, I think it is not the job of `_sage_getdoc_unformatted` to search for embedding information. If some functions absolutely want to get embedding information, then it is *their* job to search the information. Of course I need to see how much would break.



---

archive/issue_comments_241374.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nNote that the following crashes:\n\n```\n    sage: class Foo:\n    ....:     def __init__(self):\n    ....:         'docstring'\n    ....:         pass\n    sage: import inspect\n    sage: inspect.getsource(Foo)\n```\nThat's strange, since it is all pure Python, and since\n\n```\nsage: inspect.getsource(Foo.__init__)\n```\nworks.\n\nEven more strange: In `getsource(Foo.__init__)`, the whole source of `Foo` is determined. Hence, it *it* possible to get the source of `Foo`. That's a bug in Python's inspect.getsource.\n\nI wonder if we should fix that. Certainly not here, though.",
    "created_at": "2015-04-07T20:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241374",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">comment:31</div>

Note that the following crashes:

```
    sage: class Foo:
    ....:     def __init__(self):
    ....:         'docstring'
    ....:         pass
    sage: import inspect
    sage: inspect.getsource(Foo)
```
That's strange, since it is all pure Python, and since

```
sage: inspect.getsource(Foo.__init__)
```
works.

Even more strange: In `getsource(Foo.__init__)`, the whole source of `Foo` is determined. Hence, it *it* possible to get the source of `Foo`. That's a bug in Python's inspect.getsource.

I wonder if we should fix that. Certainly not here, though.



---

archive/issue_comments_241375.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nMeanwhile I became aware that the it was in your commits that `_sage_getdoc_unformatted` was changed to actively search for docstrings with embedding information. I am preparing a commit that reverts it. \n\nI really think the job of `_sage_getdoc_unformatted(obj)` is to get the docstring of `obj` without formatting. The user of `_sage_getdoc_unformatted` has to decide for him or herself whether `obj.__init__.__doc__` would be more useful than `obj.__doc__`.\n\nSomething else: Do I see that correctly that you did not change `sage_getargspec` to using the new embedded information on the argspec? Or is Python's `inspect.getargspec` using that information, so that we will benefit from it implicitly?",
    "created_at": "2015-04-07T21:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241375",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

Meanwhile I became aware that the it was in your commits that `_sage_getdoc_unformatted` was changed to actively search for docstrings with embedding information. I am preparing a commit that reverts it. 

I really think the job of `_sage_getdoc_unformatted(obj)` is to get the docstring of `obj` without formatting. The user of `_sage_getdoc_unformatted` has to decide for him or herself whether `obj.__init__.__doc__` would be more useful than `obj.__doc__`.

Something else: Do I see that correctly that you did not change `sage_getargspec` to using the new embedded information on the argspec? Or is Python's `inspect.getargspec` using that information, so that we will benefit from it implicitly?



---

archive/issue_comments_241376.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSomething else is not good. The purpose of this ticket is to embed signatures into docstrings. Well, it isn't done even with the ticket branch:\n\n```\nsage: cython(\"\"\"\n....: class Foo:\n....:     def __init__(self, bla, int x):\n....:         pass\n....: \"\"\")\nsage: Foo.__init__.__doc__\n'File: _home_king__sage_temp_linux_va3e_site_18607_tmp_QtW4tF_spyx_0.pyx (starting at line 8)'\n```\nIn other words, the file information is in the docstring, but the signature is missing.\n\nWhy is that?",
    "created_at": "2015-04-07T21:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241376",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:33" align="right">comment:33</div>

Something else is not good. The purpose of this ticket is to embed signatures into docstrings. Well, it isn't done even with the ticket branch:

```
sage: cython("""
....: class Foo:
....:     def __init__(self, bla, int x):
....:         pass
....: """)
sage: Foo.__init__.__doc__
'File: _home_king__sage_temp_linux_va3e_site_18607_tmp_QtW4tF_spyx_0.pyx (starting at line 8)'
```
In other words, the file information is in the docstring, but the signature is missing.

Why is that?



---

archive/issue_comments_241377.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**",
    "created_at": "2015-04-07T21:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241377",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**



---

archive/issue_comments_241378.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to **Jeroen Demeyer, Simon King**",
    "created_at": "2015-04-07T21:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241378",
    "user": "https://github.com/simon-king-jena"
}
```

Changed author from **Jeroen Demeyer** to **Jeroen Demeyer, Simon King**



---

archive/issue_comments_241379.json:
```json
{
    "body": "Reviewer: **Simon King**",
    "created_at": "2015-04-07T21:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241379",
    "user": "https://github.com/simon-king-jena"
}
```

Reviewer: **Simon King**



---

archive/issue_comments_241380.json:
```json
{
    "body": "Work Issues: **Embed signatures for interactive Cython code; USE the embedded signature**",
    "created_at": "2015-04-07T21:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241380",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **Embed signatures for interactive Cython code; USE the embedded signature**



---

archive/issue_comments_241381.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe doctests pass with my new commit.\n\nHowever, two issues should be addressed:\n- The signature for interactively defined Cython methods (I don't know if \"interactive\" is the reason why it fails) should be embedded, too\n- The embedded signature should be used in sage_getargspec. There should be a function that extracts both the method/function name and the argspec from the embedded signature.\n \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fb0b34316949cdfbe5d369ebba2c9205f2a4014\"><code>0fb0b34</code></a></td><td><code>Streamline the logic of sage_getsourcelines</code></td></tr></table>\n",
    "created_at": "2015-04-07T21:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241381",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:35" align="right">comment:35</div>

The doctests pass with my new commit.

However, two issues should be addressed:
- The signature for interactively defined Cython methods (I don't know if "interactive" is the reason why it fails) should be embedded, too
- The embedded signature should be used in sage_getargspec. There should be a function that extracts both the method/function name and the argspec from the embedded signature.
 
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fb0b34316949cdfbe5d369ebba2c9205f2a4014"><code>0fb0b34</code></a></td><td><code>Streamline the logic of sage_getsourcelines</code></td></tr></table>




---

archive/issue_comments_241382.json:
```json
{
    "body": "Changed commit from **[`1a36cc9`](https://github.com/sagemath/sagetrac-mirror/commit/1a36cc96d1e9ebd5d46a3dd9c027a41e89da2ebc)** to **[`0fb0b34`](https://github.com/sagemath/sagetrac-mirror/commit/0fb0b34316949cdfbe5d369ebba2c9205f2a4014)**",
    "created_at": "2015-04-07T21:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241382",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[`1a36cc9`](https://github.com/sagemath/sagetrac-mirror/commit/1a36cc96d1e9ebd5d46a3dd9c027a41e89da2ebc)** to **[`0fb0b34`](https://github.com/sagemath/sagetrac-mirror/commit/0fb0b34316949cdfbe5d369ebba2c9205f2a4014)**



---

archive/issue_comments_241383.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThere is some more error in `sage -t src/sage/sets/set_from_iterator.py`, which is caused by additional blank lines at the beginning of what `sage_getdoc` returns. Ought to be fixed one way or another (tomorrow).",
    "created_at": "2015-04-07T21:36:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241383",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:36" align="right">comment:36</div>

There is some more error in `sage -t src/sage/sets/set_from_iterator.py`, which is caused by additional blank lines at the beginning of what `sage_getdoc` returns. Ought to be fixed one way or another (tomorrow).



---

archive/issue_comments_241384.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@simon-king-jena](#comment%3A33):\n> Why is that?\n\nMost likely, it is because `cython()` works completely independently from `./sage -b` (this is certainly a bug, but outside the scope of this ticket)",
    "created_at": "2015-04-08T06:09:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241384",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@simon-king-jena](#comment%3A33):
> Why is that?

Most likely, it is because `cython()` works completely independently from `./sage -b` (this is certainly a bug, but outside the scope of this ticket)



---

archive/issue_comments_241385.json:
```json
{
    "body": "Changed work issues from **Embed signatures for interactive Cython code; USE the embedded signature** to none",
    "created_at": "2015-04-08T06:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241385",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **Embed signatures for interactive Cython code; USE the embedded signature** to none



---

archive/issue_comments_241386.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nBoth these issues are outside the scope of this ticket.",
    "created_at": "2015-04-08T06:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241386",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Both these issues are outside the scope of this ticket.



---

archive/issue_comments_241387.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@jdemeyer](#comment%3A37):\n> Replying to [@simon-king-jena](#comment%3A33):\n> > Why is that?\n> \n> Most likely, it is because `cython()` works completely independently from `./sage -b` (this is certainly a bug, but outside the scope of this ticket)\n\nWhy do you think it is outside the scope of this ticket? It is about Cython embedding the signature into docstring, and I don't see why Cython should distinguish `sage -b` from compilation of interactive code.\n\nFor sure, we can only use the embedded signature when it is *uniformely* embedded. Otherwise I don't see the point of embedding.\n\nWhat about the additional blank line in a doc string? Do you think we should simply insert it into the failing test in `src/sage/sets/set_from_iterator.py`, or make it so that there is no additional blankline?",
    "created_at": "2015-04-08T08:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241387",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@jdemeyer](#comment%3A37):
> Replying to [@simon-king-jena](#comment%3A33):
> > Why is that?
> 
> Most likely, it is because `cython()` works completely independently from `./sage -b` (this is certainly a bug, but outside the scope of this ticket)

Why do you think it is outside the scope of this ticket? It is about Cython embedding the signature into docstring, and I don't see why Cython should distinguish `sage -b` from compilation of interactive code.

For sure, we can only use the embedded signature when it is *uniformely* embedded. Otherwise I don't see the point of embedding.

What about the additional blank line in a doc string? Do you think we should simply insert it into the failing test in `src/sage/sets/set_from_iterator.py`, or make it so that there is no additional blankline?



---

archive/issue_comments_241388.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@simon-king-jena](#comment%3A39):\n> Why do you think it is outside the scope of this ticket?\n\nBecause the actual bug is that `cython()` works differently from `./sage -b`. This issue has nothing to do with `embedsignature` and it is also much broader than `embedsignature`. Did you know that even `print -1/3` behaves differently in `cython()` than in Sage library Cython code?\n\nFixing this has been on my Cython TODO list for a long time, but I currently have too many tickets related to Cython that they would surely conflict.",
    "created_at": "2015-04-08T09:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241388",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@simon-king-jena](#comment%3A39):
> Why do you think it is outside the scope of this ticket?

Because the actual bug is that `cython()` works differently from `./sage -b`. This issue has nothing to do with `embedsignature` and it is also much broader than `embedsignature`. Did you know that even `print -1/3` behaves differently in `cython()` than in Sage library Cython code?

Fixing this has been on my Cython TODO list for a long time, but I currently have too many tickets related to Cython that they would surely conflict.



---

archive/issue_events_251699.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-08T09:28:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "title_is": "Cython: embed signatures in docstrings of Sage library code",
    "title_was": "Cython: embed signatures in docstrings",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251699"
}
```



---

archive/issue_comments_241389.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**",
    "created_at": "2015-04-08T10:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241389",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**



---

archive/issue_comments_241390.json:
```json
{
    "body": "Changed commit from **[`0fb0b34`](https://github.com/sagemath/sagetrac-mirror/commit/0fb0b34316949cdfbe5d369ebba2c9205f2a4014)** to **[`21ecfad`](https://github.com/sagemath/sagetrac-mirror/commit/21ecfada11dda015de204cb92c27916e561c726a)**",
    "created_at": "2015-04-08T10:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241390",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`0fb0b34`](https://github.com/sagemath/sagetrac-mirror/commit/0fb0b34316949cdfbe5d369ebba2c9205f2a4014)** to **[`21ecfad`](https://github.com/sagemath/sagetrac-mirror/commit/21ecfada11dda015de204cb92c27916e561c726a)**



---

archive/issue_comments_241391.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@simon-king-jena](#comment%3A39):\n> What about the additional blank line in a doc string?\n\nFixed by this extra commit.\n\nNote however that `make doc` still fails...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21ecfada11dda015de204cb92c27916e561c726a\"><code>21ecfad</code></a></td><td><code>_extract_embedded_position() needs the whole docstring</code></td></tr></table>\n",
    "created_at": "2015-04-08T10:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241391",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@simon-king-jena](#comment%3A39):
> What about the additional blank line in a doc string?

Fixed by this extra commit.

Note however that `make doc` still fails...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21ecfada11dda015de204cb92c27916e561c726a"><code>21ecfad</code></a></td><td><code>_extract_embedded_position() needs the whole docstring</code></td></tr></table>




---

archive/issue_comments_241392.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\n\n```\nsage -t src/doc/en/developer/coding_basics.rst\n**********************************************************************\nFile \"src/doc/en/developer/coding_basics.rst\", line 501, in doc.en.developer.coding_basics\nFailed example:\n    sage_getdoc(foo)              # class docstring\nExpected:\n    'Construct a Foo.\\n'\nGot:\n    ''\n**********************************************************************\n```",
    "created_at": "2015-04-08T12:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241392",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>


```
sage -t src/doc/en/developer/coding_basics.rst
**********************************************************************
File "src/doc/en/developer/coding_basics.rst", line 501, in doc.en.developer.coding_basics
Failed example:
    sage_getdoc(foo)              # class docstring
Expected:
    'Construct a Foo.\n'
Got:
    ''
**********************************************************************
```



---

archive/issue_comments_241393.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jdemeyer](#comment%3A44):\n> sage -t src/doc/en/developer/coding_basics.rst\n\nStrange, I didn't notice this one.\n\nAnyway, I suppose if make doc fails, that's more serious.",
    "created_at": "2015-04-08T14:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241393",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jdemeyer](#comment%3A44):
> sage -t src/doc/en/developer/coding_basics.rst

Strange, I didn't notice this one.

Anyway, I suppose if make doc fails, that's more serious.



---

archive/issue_comments_241394.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThe make doc error says:\n\n```\nOSError: [polynomia] docstring of sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_mpair.derivative:1: WARNING: Inline emphasis start-string without end-string.\n```\n\nThe doc string is:\n\n```\nsage: print sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_mpair.derivative.__doc__\nLaurentPolynomial_mpair.derivative(self, *args)\nFile: sage/rings/polynomial/laurent_polynomial.pyx (starting at line 2283)\n\n        The formal derivative of this Laurent polynomial, with respect\n        to variables supplied in args.\n\n        Multiple variables and iteration counts may be supplied; see\n        documentation for the global derivative() function for more\n        details.\n\n        .. seealso::\n\n           :meth:`_derivative`\n\n        EXAMPLES::\n\n            sage: R = LaurentPolynomialRing(ZZ,'x, y')\n            sage: x, y = R.gens()\n            sage: t = x**4*y+x*y+y+x**(-1)+y**(-3)\n            sage: t.derivative(x, x)\n            12*x^2*y + 2*x^-3\n            sage: t.derivative(y, 2)\n            12*y^-5\n```\n`*args` would be interpreted as an emphasis to the text of the docstring, which indeed isn't ended by another `*`.\n\nBut isn't sage_getdoc called for creating the docs? It *does* strip the embedded information!\n\n```\nsage: print sage.misc.sageinspect.sage_getdoc(sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_mpair.derivative)\n   The formal derivative of this Laurent polynomial, with respect to\n   variables supplied in args.\n\n   Multiple variables and iteration counts may be supplied; see\n   documentation for the global derivative() function for more\n   details.\n\n   See also: \"_derivative()\"\n\n   EXAMPLES:\n\n      sage: R = LaurentPolynomialRing(ZZ,'x, y')\n      sage: x, y = R.gens()\n      sage: t = x**4*y+x*y+y+x**(-1)+y**(-3)\n      sage: t.derivative(x, x)\n      12*x^2*y + 2*x^-3\n      sage: t.derivative(y, 2)\n      12*y^-5\n```\nOr is `_sage_getdoc_unformatted` used to build the docs?",
    "created_at": "2015-04-08T15:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241394",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">comment:46</div>

The make doc error says:

```
OSError: [polynomia] docstring of sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_mpair.derivative:1: WARNING: Inline emphasis start-string without end-string.
```

The doc string is:

```
sage: print sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_mpair.derivative.__doc__
LaurentPolynomial_mpair.derivative(self, *args)
File: sage/rings/polynomial/laurent_polynomial.pyx (starting at line 2283)

        The formal derivative of this Laurent polynomial, with respect
        to variables supplied in args.

        Multiple variables and iteration counts may be supplied; see
        documentation for the global derivative() function for more
        details.

        .. seealso::

           :meth:`_derivative`

        EXAMPLES::

            sage: R = LaurentPolynomialRing(ZZ,'x, y')
            sage: x, y = R.gens()
            sage: t = x**4*y+x*y+y+x**(-1)+y**(-3)
            sage: t.derivative(x, x)
            12*x^2*y + 2*x^-3
            sage: t.derivative(y, 2)
            12*y^-5
```
`*args` would be interpreted as an emphasis to the text of the docstring, which indeed isn't ended by another `*`.

But isn't sage_getdoc called for creating the docs? It *does* strip the embedded information!

```
sage: print sage.misc.sageinspect.sage_getdoc(sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_mpair.derivative)
   The formal derivative of this Laurent polynomial, with respect to
   variables supplied in args.

   Multiple variables and iteration counts may be supplied; see
   documentation for the global derivative() function for more
   details.

   See also: "_derivative()"

   EXAMPLES:

      sage: R = LaurentPolynomialRing(ZZ,'x, y')
      sage: x, y = R.gens()
      sage: t = x**4*y+x*y+y+x**(-1)+y**(-3)
      sage: t.derivative(x, x)
      12*x^2*y + 2*x^-3
      sage: t.derivative(y, 2)
      12*y^-5
```
Or is `_sage_getdoc_unformatted` used to build the docs?



---

archive/issue_comments_241395.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@simon-king-jena](#comment%3A46):\n> Or is `_sage_getdoc_unformatted` used to build the docs?\n\nThat's certainly the intention of `src/doc/common/sage_autodoc.py`",
    "created_at": "2015-04-08T15:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241395",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@simon-king-jena](#comment%3A46):
> Or is `_sage_getdoc_unformatted` used to build the docs?

That's certainly the intention of `src/doc/common/sage_autodoc.py`



---

archive/issue_comments_241396.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@jdemeyer](#comment%3A47):\n> Replying to [@simon-king-jena](#comment%3A46):\n> > Or is `_sage_getdoc_unformatted` used to build the docs?\n> \n> \n> That's certainly the intention of `src/doc/common/sage_autodoc.py`\n\nThanks! Shouldn't sage_getdoc be used instead? Anyway, the embedded information does in my opinion not belong into the reference manual. Hence, it needs to be stripped one way or another. And if sage_autodoc has a custom way of stripping, then either the custom way should be changed to take into account the new embedded signature, or it should use a specialised tool (namely sage_getdoc) right away.",
    "created_at": "2015-04-08T15:44:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241396",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@jdemeyer](#comment%3A47):
> Replying to [@simon-king-jena](#comment%3A46):
> > Or is `_sage_getdoc_unformatted` used to build the docs?
> 
> 
> That's certainly the intention of `src/doc/common/sage_autodoc.py`

Thanks! Shouldn't sage_getdoc be used instead? Anyway, the embedded information does in my opinion not belong into the reference manual. Hence, it needs to be stripped one way or another. And if sage_autodoc has a custom way of stripping, then either the custom way should be changed to take into account the new embedded signature, or it should use a specialised tool (namely sage_getdoc) right away.



---

archive/issue_comments_241397.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI agree, let me work on a fix.",
    "created_at": "2015-04-08T15:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241397",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49" align="right">comment:49</div>

I agree, let me work on a fix.



---

archive/issue_comments_241398.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nAm I right that stripping the old embedding information is stripped by stuff from `sphinx.util`?",
    "created_at": "2015-04-08T15:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241398",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:50" align="right">comment:50</div>

Am I right that stripping the old embedding information is stripped by stuff from `sphinx.util`?



---

archive/issue_comments_241399.json:
```json
{
    "body": "Changed commit from **[`21ecfad`](https://github.com/sagemath/sagetrac-mirror/commit/21ecfada11dda015de204cb92c27916e561c726a)** to **[`a33fac0`](https://github.com/sagemath/sagetrac-mirror/commit/a33fac03c4ac766fde206bcbb387560fba2ac5fb)**",
    "created_at": "2015-04-08T16:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241399",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`21ecfad`](https://github.com/sagemath/sagetrac-mirror/commit/21ecfada11dda015de204cb92c27916e561c726a)** to **[`a33fac0`](https://github.com/sagemath/sagetrac-mirror/commit/a33fac03c4ac766fde206bcbb387560fba2ac5fb)**



---

archive/issue_comments_241400.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a33fac03c4ac766fde206bcbb387560fba2ac5fb\"><code>a33fac0</code></a></td><td><code>Add new function sage_getdoc_original() which strips embedding information</code></td></tr></table>\n",
    "created_at": "2015-04-08T16:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241400",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a33fac03c4ac766fde206bcbb387560fba2ac5fb"><code>a33fac0</code></a></td><td><code>Add new function sage_getdoc_original() which strips embedding information</code></td></tr></table>




---

archive/issue_comments_241401.json:
```json
{
    "body": "<div id=\"comment:52\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/104837abe3c6d5e0204f4d0ffa49293f14f885d6\"><code>104837a</code></a></td><td><code>sage_getdoc_original() does not return None</code></td></tr></table>\n",
    "created_at": "2015-04-08T16:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241401",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:52"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/104837abe3c6d5e0204f4d0ffa49293f14f885d6"><code>104837a</code></a></td><td><code>sage_getdoc_original() does not return None</code></td></tr></table>




---

archive/issue_comments_241402.json:
```json
{
    "body": "Changed commit from **[`a33fac0`](https://github.com/sagemath/sagetrac-mirror/commit/a33fac03c4ac766fde206bcbb387560fba2ac5fb)** to **[`104837a`](https://github.com/sagemath/sagetrac-mirror/commit/104837abe3c6d5e0204f4d0ffa49293f14f885d6)**",
    "created_at": "2015-04-08T16:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241402",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a33fac0`](https://github.com/sagemath/sagetrac-mirror/commit/a33fac03c4ac766fde206bcbb387560fba2ac5fb)** to **[`104837a`](https://github.com/sagemath/sagetrac-mirror/commit/104837abe3c6d5e0204f4d0ffa49293f14f885d6)**



---

archive/issue_comments_241403.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nIt looks like there is still an issue with cached functions:\n\n```\nsage: from sage.misc.sageinspect import _sage_getdoc_unformatted\nsage: print _sage_getdoc_unformatted(sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure)\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)\nFiniteField.algebraic_closure(self, name='z', **kwds)\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)\n\n        Return an algebraic closure of ``self``.\n...\n```",
    "created_at": "2015-04-08T16:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241403",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

It looks like there is still an issue with cached functions:

```
sage: from sage.misc.sageinspect import _sage_getdoc_unformatted
sage: print _sage_getdoc_unformatted(sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure)
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)
FiniteField.algebraic_closure(self, name='z', **kwds)
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)

        Return an algebraic closure of ``self``.
...
```



---

archive/issue_comments_241404.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\n`make doc` still fails. I see several errors.\n\nOne error looks like this:\n\n```\n[combinat ] /home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/combinat/__init__.py:docstring of sage.combinat:39: WARNING: undefined label: sage.coding (if the link has no caption the label must precede a section header)\n```\nNo idea what that means.\n\nAnother error:\n\n```\n[finite_ri] docstring of sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure:1: WARNING: Inline strong start-string without end-string.\n```\nThat again seems like a failing removal of `**kwds` from the signature, or similar problems.\nIndeed:\n\n```\nsage: print sage_getdoc_original(sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure)\nFiniteField.algebraic_closure(self, name='z', **kwds)\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)\n\n        Return an algebraic closure of ``self``.\n\n        INPUT:\n...\n```\nSo, although `sage_getdoc_original` is supposed to strip the embedding information, it doesn't!\n\nYou are right, it seems to be a problem with cached methods.",
    "created_at": "2015-04-08T16:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241404",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:54" align="right">comment:54</div>

`make doc` still fails. I see several errors.

One error looks like this:

```
[combinat ] /home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/combinat/__init__.py:docstring of sage.combinat:39: WARNING: undefined label: sage.coding (if the link has no caption the label must precede a section header)
```
No idea what that means.

Another error:

```
[finite_ri] docstring of sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure:1: WARNING: Inline strong start-string without end-string.
```
That again seems like a failing removal of `**kwds` from the signature, or similar problems.
Indeed:

```
sage: print sage_getdoc_original(sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure)
FiniteField.algebraic_closure(self, name='z', **kwds)
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)

        Return an algebraic closure of ``self``.

        INPUT:
...
```
So, although `sage_getdoc_original` is supposed to strip the embedding information, it doesn't!

You are right, it seems to be a problem with cached methods.



---

archive/issue_comments_241405.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nAha, the embedding information is inserted twice:\n\n```\nsage: obj = sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure\nsage: s = _sage_getdoc_unformatted(obj)\nsage: print s\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)\nFiniteField.algebraic_closure(self, name='z', **kwds)\nFile: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)\n...\n```\nI guess that happens in the cached_method's `_sage_doc_` method.",
    "created_at": "2015-04-08T16:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241405",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:55" align="right">comment:55</div>

Aha, the embedding information is inserted twice:

```
sage: obj = sage.rings.finite_rings.finite_field_base.FiniteField.algebraic_closure
sage: s = _sage_getdoc_unformatted(obj)
sage: print s
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)
FiniteField.algebraic_closure(self, name='z', **kwds)
File: sage/rings/finite_rings/finite_field_base.pyx (starting at line 1278)
...
```
I guess that happens in the cached_method's `_sage_doc_` method.



---

archive/issue_comments_241406.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nYep, I found the problem: cached_method's `_sage_doc_` only looks for the first line of the original docstring to extract information from. Instead, the whole docstring should be passed to _extract_embedded_position.\n\nLet me fix it, please, I guess I'll be done in 5 minutes.",
    "created_at": "2015-04-08T17:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241406",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:56" align="right">comment:56</div>

Yep, I found the problem: cached_method's `_sage_doc_` only looks for the first line of the original docstring to extract information from. Instead, the whole docstring should be passed to _extract_embedded_position.

Let me fix it, please, I guess I'll be done in 5 minutes.



---

archive/issue_comments_241407.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31fd5e5c1323610539b85c7d5671601dfa32f2f4\"><code>31fd5e5</code></a></td><td><code>Fix doc of cached functions</code></td></tr></table>\n",
    "created_at": "2015-04-08T17:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241407",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31fd5e5c1323610539b85c7d5671601dfa32f2f4"><code>31fd5e5</code></a></td><td><code>Fix doc of cached functions</code></td></tr></table>




---

archive/issue_comments_241408.json:
```json
{
    "body": "Changed commit from **[`104837a`](https://github.com/sagemath/sagetrac-mirror/commit/104837abe3c6d5e0204f4d0ffa49293f14f885d6)** to **[`31fd5e5`](https://github.com/sagemath/sagetrac-mirror/commit/31fd5e5c1323610539b85c7d5671601dfa32f2f4)**",
    "created_at": "2015-04-08T17:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241408",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`104837a`](https://github.com/sagemath/sagetrac-mirror/commit/104837abe3c6d5e0204f4d0ffa49293f14f885d6)** to **[`31fd5e5`](https://github.com/sagemath/sagetrac-mirror/commit/31fd5e5c1323610539b85c7d5671601dfa32f2f4)**



---

archive/issue_comments_241409.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@simon-king-jena](#comment%3A56):\n> Yep, I found the problem: cached_method's `_sage_doc_` only looks for the first line of the original docstring to extract information from. Instead, the whole docstring should be passed to _extract_embedded_position.\n> \n> Let me fix it, please, I guess I'll be done in 5 minutes.\n\nToo late...",
    "created_at": "2015-04-08T17:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241409",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@simon-king-jena](#comment%3A56):
> Yep, I found the problem: cached_method's `_sage_doc_` only looks for the first line of the original docstring to extract information from. Instead, the whole docstring should be passed to _extract_embedded_position.
> 
> Let me fix it, please, I guess I'll be done in 5 minutes.

Too late...



---

archive/issue_comments_241410.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThis is the reason why the docstring of `__init__` was preferred when `__doc__` contains no embedding information:\n\n```\nsage: print sage.structure.parent.Parent.__doc__\nParent(base=None, category=None, *, element_constructor=None, gens=None, names=None, normalize=True, facade=None, **kwds)\n```\n\nThis should be fixed since now this causes `make doc` to fail.\n\nI'll leave this ticket alone for today, so you can make changes if you want.",
    "created_at": "2015-04-08T17:08:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241410",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

This is the reason why the docstring of `__init__` was preferred when `__doc__` contains no embedding information:

```
sage: print sage.structure.parent.Parent.__doc__
Parent(base=None, category=None, *, element_constructor=None, gens=None, names=None, normalize=True, facade=None, **kwds)
```

This should be fixed since now this causes `make doc` to fail.

I'll leave this ticket alone for today, so you can make changes if you want.



---

archive/issue_comments_241411.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**",
    "created_at": "2015-04-08T17:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241411",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**



---

archive/issue_comments_241412.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@jdemeyer](#comment%3A58):\n> Replying to [@simon-king-jena](#comment%3A56):\n> > Yep, I found the problem: cached_method's `_sage_doc_` only looks for the first line of the original docstring to extract information from. Instead, the whole docstring should be passed to _extract_embedded_position.\n> > \n> > Let me fix it, please, I guess I'll be done in 5 minutes.\n> \n> Too late...\n\nBad. I just pushed it.\n  \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19135c15db9122693b8d8d023fe59749eb1a1d64\"><code>19135c1</code></a></td><td><code>Fix extraction of embedding information in CachedFunction._sage_doc_</code></td></tr></table>\n",
    "created_at": "2015-04-08T17:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241412",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@jdemeyer](#comment%3A58):
> Replying to [@simon-king-jena](#comment%3A56):
> > Yep, I found the problem: cached_method's `_sage_doc_` only looks for the first line of the original docstring to extract information from. Instead, the whole docstring should be passed to _extract_embedded_position.
> > 
> > Let me fix it, please, I guess I'll be done in 5 minutes.
> 
> Too late...

Bad. I just pushed it.
  
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19135c15db9122693b8d8d023fe59749eb1a1d64"><code>19135c1</code></a></td><td><code>Fix extraction of embedding information in CachedFunction._sage_doc_</code></td></tr></table>




---

archive/issue_comments_241413.json:
```json
{
    "body": "Changed commit from **[`31fd5e5`](https://github.com/sagemath/sagetrac-mirror/commit/31fd5e5c1323610539b85c7d5671601dfa32f2f4)** to **[`19135c1`](https://github.com/sagemath/sagetrac-mirror/commit/19135c15db9122693b8d8d023fe59749eb1a1d64)**",
    "created_at": "2015-04-08T17:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241413",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[`31fd5e5`](https://github.com/sagemath/sagetrac-mirror/commit/31fd5e5c1323610539b85c7d5671601dfa32f2f4)** to **[`19135c1`](https://github.com/sagemath/sagetrac-mirror/commit/19135c15db9122693b8d8d023fe59749eb1a1d64)**



---

archive/issue_comments_241414.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nActually I don't like your way of fixing it. If I understand correctly, we *do* want to insert embedding information into the doc of a cached function, even if the embedding information is missing in the doc of the wrapped function.\n\nSo, I suggest we work on top of the now attached branch.\n\nIn any case, the `Parent` problem persists.",
    "created_at": "2015-04-08T17:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241414",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:62" align="right">comment:62</div>

Actually I don't like your way of fixing it. If I understand correctly, we *do* want to insert embedding information into the doc of a cached function, even if the embedding information is missing in the doc of the wrapped function.

So, I suggest we work on top of the now attached branch.

In any case, the `Parent` problem persists.



---

archive/issue_comments_241415.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jdemeyer](#comment%3A59):\n> This is the reason why the docstring of `__init__` was preferred when `__doc__` contains no embedding information:\n> \n> ```\n> sage: print sage.structure.parent.Parent.__doc__\n> Parent(base=None, category=None, *, element_constructor=None, gens=None, names=None, normalize=True, facade=None, **kwds)\n> ```\n\nWhy is that? If there is no doc string, shouldn't Cython change it so that it consists of the signature and the embedding information? Why is the embedding information not inserted?",
    "created_at": "2015-04-08T17:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241415",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jdemeyer](#comment%3A59):
> This is the reason why the docstring of `__init__` was preferred when `__doc__` contains no embedding information:
> 
> ```
> sage: print sage.structure.parent.Parent.__doc__
> Parent(base=None, category=None, *, element_constructor=None, gens=None, names=None, normalize=True, facade=None, **kwds)
> ```

Why is that? If there is no doc string, shouldn't Cython change it so that it consists of the signature and the embedding information? Why is the embedding information not inserted?



---

archive/issue_comments_241416.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [@simon-king-jena](#comment%3A62):\n> If I understand correctly, we *do* want to insert embedding information into the doc of a cached function\n\nWhy should the cached function change *anything* to the doc? I think it should just pass through the original documentation unchanged.",
    "created_at": "2015-04-08T17:24:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241416",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [@simon-king-jena](#comment%3A62):
> If I understand correctly, we *do* want to insert embedding information into the doc of a cached function

Why should the cached function change *anything* to the doc? I think it should just pass through the original documentation unchanged.



---

archive/issue_comments_241417.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI'd suggest that the signature should not be inserted. There is no reason to insert the signature of `Parent.__init__` into `Parent.__doc__`, since the same signature is also inserted into `Parent.__init__.__doc__`, where it belongs.\n\nWhen we will be using the inserted signature in a new version of `sage_getargspec`, we will be considering `__init__` anyway when it is used on a class.\n\nI'll try to figure out how it works.",
    "created_at": "2015-04-08T17:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241417",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:65" align="right">comment:65</div>

I'd suggest that the signature should not be inserted. There is no reason to insert the signature of `Parent.__init__` into `Parent.__doc__`, since the same signature is also inserted into `Parent.__init__.__doc__`, where it belongs.

When we will be using the inserted signature in a new version of `sage_getargspec`, we will be considering `__init__` anyway when it is used on a class.

I'll try to figure out how it works.



---

archive/issue_comments_241418.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@jdemeyer](#comment%3A64):\n> Why should the cached function change *anything* to the doc? I think it should just pass through the original documentation unchanged.\n\nFor the same reason that Cython inserts additional information to the doc. It helps to retrieve file information. As you have observed, we have no `_sage_file_` method, but only have `_sage_doc_` and `_sage_argspec_`. We would need to have such method, if we would not insert the embedding information of the *original function* into the doc of the *cached function*.\n\nActually, having the signature embedded may help to remove the `_sage_argspec_` method!",
    "created_at": "2015-04-08T17:27:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241418",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@jdemeyer](#comment%3A64):
> Why should the cached function change *anything* to the doc? I think it should just pass through the original documentation unchanged.

For the same reason that Cython inserts additional information to the doc. It helps to retrieve file information. As you have observed, we have no `_sage_file_` method, but only have `_sage_doc_` and `_sage_argspec_`. We would need to have such method, if we would not insert the embedding information of the *original function* into the doc of the *cached function*.

Actually, having the signature embedded may help to remove the `_sage_argspec_` method!



---

archive/issue_comments_241419.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@simon-king-jena](#comment%3A65):\n> I'd suggest that the signature should not be inserted. There is no reason to insert the signature of `Parent.__init__` into `Parent.__doc__`, since the same signature is also inserted into `Parent.__init__.__doc__`, where it belongs.\n> \n> When we will be using the inserted signature in a new version of `sage_getargspec`, we will be considering `__init__` anyway when it is used on a class.\n> \n> I'll try to figure out how it works.\n\nHm. `__init__` is not explicitly considered in your patch. So, I can't figure out what needs to be done.\n\nDo we have a possibility to convince Cython to either not use `Foo.__init__` for inserting the signature into `Foo.__doc__`, or to add the embedding information in addition to the signature into `Foo.__doc__`?",
    "created_at": "2015-04-08T17:33:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241419",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@simon-king-jena](#comment%3A65):
> I'd suggest that the signature should not be inserted. There is no reason to insert the signature of `Parent.__init__` into `Parent.__doc__`, since the same signature is also inserted into `Parent.__init__.__doc__`, where it belongs.
> 
> When we will be using the inserted signature in a new version of `sage_getargspec`, we will be considering `__init__` anyway when it is used on a class.
> 
> I'll try to figure out how it works.

Hm. `__init__` is not explicitly considered in your patch. So, I can't figure out what needs to be done.

Do we have a possibility to convince Cython to either not use `Foo.__init__` for inserting the signature into `Foo.__doc__`, or to add the embedding information in addition to the signature into `Foo.__doc__`?



---

archive/issue_comments_241420.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nStrangely, when I remove the signature information (admittedly I do so using a heuristics, I get the error\n\n```\nOSError: [combinat ] None:4: WARNING: citation not found: BBSSZ2012\n```\nWhy is that? Clearly the citation is defined in `src/sage/combinat/ncsf_qsym/qsym.py`.\n\nI am frustrated, since I don't see how it could be related with the change I did.",
    "created_at": "2015-04-08T19:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241420",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:68" align="right">comment:68</div>

Strangely, when I remove the signature information (admittedly I do so using a heuristics, I get the error

```
OSError: [combinat ] None:4: WARNING: citation not found: BBSSZ2012
```
Why is that? Clearly the citation is defined in `src/sage/combinat/ncsf_qsym/qsym.py`.

I am frustrated, since I don't see how it could be related with the change I did.



---

archive/issue_comments_241421.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nHang on, now I see it! The citation is defined in `dualImmaculate.__init__`, whereas `dualImmaculate` has no docstring at all. In such a situation, I guess we want to use the documentation of the `__init__` method instead.",
    "created_at": "2015-04-08T19:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241421",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:69" align="right">comment:69</div>

Hang on, now I see it! The citation is defined in `dualImmaculate.__init__`, whereas `dualImmaculate` has no docstring at all. In such a situation, I guess we want to use the documentation of the `__init__` method instead.



---

archive/issue_comments_241422.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nIntrospection is a can of worms, and I hate it. After inserting the docstring of `__init__` in case that the class' docstring is empty, I now get\n\n```\nOSError: [graphs   ] /home/king/Sage/git/sage/src/doc/en/reference/graphs/sage/graphs/isgci.rst:11: WARNING: error while formatting signature for sage.graphs.isgci.graph_classes: obj is not a code object\n```",
    "created_at": "2015-04-08T20:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241422",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:70" align="right">comment:70</div>

Introspection is a can of worms, and I hate it. After inserting the docstring of `__init__` in case that the class' docstring is empty, I now get

```
OSError: [graphs   ] /home/king/Sage/git/sage/src/doc/en/reference/graphs/sage/graphs/isgci.rst:11: WARNING: error while formatting signature for sage.graphs.isgci.graph_classes: obj is not a code object
```



---

archive/issue_comments_241423.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nAha! `sage.graphs.isgci.graph_classes.__init__` is obtained from `object.__init__` (even though `sage.graphs.isgci.graph_classes.__init__==object.__init__` returns False), and the docstring of `sage.graphs.isgci.graph_classes` is empty.\n\nSince the doc of the inherited init method is then used (with my not-yet-commited changes), it is also attempted to insert the argspec of `sage.graphs.isgci.graph_classes`. And big surprise:\n\n```\nsage: callable(sage.graphs.isgci.graph_classes)\nFalse\nsage: callable(object)\nTrue\n```\nSince `sage.graphs.isgci.graph_classes` surprisingly isn't callable, `sage_getargspec` raises an error.\n\nIn any case, I think it is slightly cleaner to use `obj.__init__.__doc__` only if obj is a class, `obj.__doc__` is essentially empty (up to embedding information), **and** if `obj.__init__.__objclass__==obj`.",
    "created_at": "2015-04-08T20:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241423",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:71" align="right">comment:71</div>

Aha! `sage.graphs.isgci.graph_classes.__init__` is obtained from `object.__init__` (even though `sage.graphs.isgci.graph_classes.__init__==object.__init__` returns False), and the docstring of `sage.graphs.isgci.graph_classes` is empty.

Since the doc of the inherited init method is then used (with my not-yet-commited changes), it is also attempted to insert the argspec of `sage.graphs.isgci.graph_classes`. And big surprise:

```
sage: callable(sage.graphs.isgci.graph_classes)
False
sage: callable(object)
True
```
Since `sage.graphs.isgci.graph_classes` surprisingly isn't callable, `sage_getargspec` raises an error.

In any case, I think it is slightly cleaner to use `obj.__init__.__doc__` only if obj is a class, `obj.__doc__` is essentially empty (up to embedding information), **and** if `obj.__init__.__objclass__==obj`.



---

archive/issue_comments_241424.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nI am in \"WTF\" mood. With my current changes, INSTANCES of `sage.plot.colors.Color` are attempted to be inserted into the reference manual, which fails since they are not callable, hence, their argspec can not be determined. It is a mess. Time to call it a day.",
    "created_at": "2015-04-08T21:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241424",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:72" align="right">comment:72</div>

I am in "WTF" mood. With my current changes, INSTANCES of `sage.plot.colors.Color` are attempted to be inserted into the reference manual, which fails since they are not callable, hence, their argspec can not be determined. It is a mess. Time to call it a day.



---

archive/issue_comments_241425.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nI don't get it. With my current (unpushed) branch, I get\n\n```\nsage: sage_getdoc_original(sage.plot.colors.aliceblue)\n''\n```\nNonetheless, `aliceblue`, which is an instance (!) of `sage.plot.colors.Color`, is attempted to be inserted into the reference manual, which currently is not the case.\n\nWhy could that be?",
    "created_at": "2015-04-09T07:54:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241425",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:73" align="right">comment:73</div>

I don't get it. With my current (unpushed) branch, I get

```
sage: sage_getdoc_original(sage.plot.colors.aliceblue)
''
```
Nonetheless, `aliceblue`, which is an instance (!) of `sage.plot.colors.Color`, is attempted to be inserted into the reference manual, which currently is not the case.

Why could that be?



---

archive/issue_comments_241426.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nMeanwhile it looks a bit better. I think the key is to treat a class and and instance of that class in the same way when determining the docstring. Now, I return the doc of `obj.__init__` if the docstring of `obj` is empty after stripping signature and embedding. Before, I only did so if `obj` is a class. Problem: The doc builder removes duplicates, and thus it will only document a class instance in addition to the class if it has its *own* docstring. Hence, docstrings of classes and instances must be treated equal.",
    "created_at": "2015-04-09T08:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241426",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:74" align="right">comment:74</div>

Meanwhile it looks a bit better. I think the key is to treat a class and and instance of that class in the same way when determining the docstring. Now, I return the doc of `obj.__init__` if the docstring of `obj` is empty after stripping signature and embedding. Before, I only did so if `obj` is a class. Problem: The doc builder removes duplicates, and thus it will only document a class instance in addition to the class if it has its *own* docstring. Hence, docstrings of classes and instances must be treated equal.



---

archive/issue_comments_241427.json:
```json
{
    "body": "<div id=\"comment:75\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cced81b8c06b2eeb436c7876e5fed356e868e334\"><code>cced81b</code></a></td><td><code>Strip signature and embedding off docstring; use `__init__` docstring, if the stripped docstring is empty</code></td></tr></table>\n",
    "created_at": "2015-04-09T10:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241427",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cced81b8c06b2eeb436c7876e5fed356e868e334"><code>cced81b</code></a></td><td><code>Strip signature and embedding off docstring; use `__init__` docstring, if the stripped docstring is empty</code></td></tr></table>




---

archive/issue_comments_241428.json:
```json
{
    "body": "Changed commit from **[`19135c1`](https://github.com/sagemath/sagetrac-mirror/commit/19135c15db9122693b8d8d023fe59749eb1a1d64)** to **[`cced81b`](https://github.com/sagemath/sagetrac-mirror/commit/cced81b8c06b2eeb436c7876e5fed356e868e334)**",
    "created_at": "2015-04-09T10:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241428",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`19135c1`](https://github.com/sagemath/sagetrac-mirror/commit/19135c15db9122693b8d8d023fe59749eb1a1d64)** to **[`cced81b`](https://github.com/sagemath/sagetrac-mirror/commit/cced81b8c06b2eeb436c7876e5fed356e868e334)**



---

archive/issue_comments_241429.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nWith the new commit, the documentation builds. I hope it builds fine. Actually I think there should be no change to how it has previously looked like. I didn't finish all tests yet.\n\nComments on the commits:\n\nAs I said, it is essential for source code inspection that embedding information of a function is available in the docstring of a cached version of that function. That's why I did not work on top of your branch.\n\nHere are a couple of reasons for what I did:\n\n- The signature is sometimes not understood by sphinx, as for sphinx both `*` and `**` have different meanings than for the embedded signature. Hence, the signature should be stripped from the documentation. I used a heuristics for stripping the signature, assuming that\n  - the signature appears in the first line\n  - it starts with the undotted name of the object resp. of its class, followed by an opening bracket.\n\n  If this pattern is found, the first line will be removed. Note that if there is embedding information then the signature information will be cut off anyway by `_extract_embedded_position`.\n\n- When the signature is inserted, a previously empty docstring becomes non-empty, which means that an object would appear in the documentation that previously didn't. Worse: When an object's docstring is empty, its `__init__` docstring was used for documentation instead. There are cases (mainly in sage.combinat) providing documentation AND references in the `__init__` docstring. Hence, it is essential to have them, since otherwise the doc doesn't build. So, I let `sage_getdoc_original` use `__init__` when nothing else is found after stripping *both* signature and embedding information.\n\n- It is important that `sage_getdoc_unformatted` returns the same docstring for a class and for an instance of the class (unless the instance explicitly has its own `__doc__` attribute). Otherwise, each of such instance found in a module would appear in the reference manual.\n\nI documented my changes, and so far the tests have passed. Hence: Needs review!",
    "created_at": "2015-04-09T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241429",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:76" align="right">comment:76</div>

With the new commit, the documentation builds. I hope it builds fine. Actually I think there should be no change to how it has previously looked like. I didn't finish all tests yet.

Comments on the commits:

As I said, it is essential for source code inspection that embedding information of a function is available in the docstring of a cached version of that function. That's why I did not work on top of your branch.

Here are a couple of reasons for what I did:

- The signature is sometimes not understood by sphinx, as for sphinx both `*` and `**` have different meanings than for the embedded signature. Hence, the signature should be stripped from the documentation. I used a heuristics for stripping the signature, assuming that
  - the signature appears in the first line
  - it starts with the undotted name of the object resp. of its class, followed by an opening bracket.

  If this pattern is found, the first line will be removed. Note that if there is embedding information then the signature information will be cut off anyway by `_extract_embedded_position`.

- When the signature is inserted, a previously empty docstring becomes non-empty, which means that an object would appear in the documentation that previously didn't. Worse: When an object's docstring is empty, its `__init__` docstring was used for documentation instead. There are cases (mainly in sage.combinat) providing documentation AND references in the `__init__` docstring. Hence, it is essential to have them, since otherwise the doc doesn't build. So, I let `sage_getdoc_original` use `__init__` when nothing else is found after stripping *both* signature and embedding information.

- It is important that `sage_getdoc_unformatted` returns the same docstring for a class and for an instance of the class (unless the instance explicitly has its own `__doc__` attribute). Otherwise, each of such instance found in a module would appear in the reference manual.

I documented my changes, and so far the tests have passed. Hence: Needs review!



---

archive/issue_events_251700.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-04-09T10:35:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251700"
}
```



---

archive/issue_comments_241430.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nSimon, I assume that \"needs_review\" implies that you agree with the commits on this branch that I made?",
    "created_at": "2015-04-09T10:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241430",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:77" align="right">comment:77</div>

Simon, I assume that "needs_review" implies that you agree with the commits on this branch that I made?



---

archive/issue_comments_241431.json:
```json
{
    "body": "Changed reviewer from **Simon King** to **Simon King, Jeroen Demeyer**",
    "created_at": "2015-04-09T10:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241431",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Simon King** to **Simon King, Jeroen Demeyer**



---

archive/issue_comments_241432.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@jdemeyer](#comment%3A77):\n> Simon, I assume that \"needs_review\" implies that you agree with the commits on this branch that I made?\n\nThat's why I inserted my name as a reviewer `:-)`\n\nBut I must admit that I don't understand *why* your changes result in inserting the signature into the docstring. I just see that they *do*. And I see that we can cope with it, and shall eventually be able to use the new information.\n\nSo, perhaps you can explain how your changes really work, so that I'd really qualify as a reviewer...",
    "created_at": "2015-04-09T10:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241432",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@jdemeyer](#comment%3A77):
> Simon, I assume that "needs_review" implies that you agree with the commits on this branch that I made?

That's why I inserted my name as a reviewer `:-)`

But I must admit that I don't understand *why* your changes result in inserting the signature into the docstring. I just see that they *do*. And I see that we can cope with it, and shall eventually be able to use the new information.

So, perhaps you can explain how your changes really work, so that I'd really qualify as a reviewer...



---

archive/issue_comments_241433.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\n> I don't understand *why* your changes result in inserting the signature into the docstring.\n\nEasy: Cython has a [compiler directive](http://docs.cython.org/src/reference/compilation.html#compiler-directives) `embedsignature=True` which does this and all I did was enabling this flag (plus add a patch from upstream to fix a bug when `embedsignature` is True)",
    "created_at": "2015-04-09T10:56:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241433",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:79" align="right">comment:79</div>

> I don't understand *why* your changes result in inserting the signature into the docstring.

Easy: Cython has a [compiler directive](http://docs.cython.org/src/reference/compilation.html#compiler-directives) `embedsignature=True` which does this and all I did was enabling this flag (plus add a patch from upstream to fix a bug when `embedsignature` is True)



---

archive/issue_events_251701.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-09T11:06:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251701"
}
```



---

archive/issue_events_251702.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-09T11:06:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251702"
}
```



---

archive/issue_comments_241434.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nShouldn't this give the docstring of `__init__`?\n\n```\nsage: sage_getdoc_original(sage.symbolic.callable.CallableSymbolicExpressionRingFactory)\n''\n```",
    "created_at": "2015-04-09T11:06:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241434",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:80" align="right">comment:80</div>

Shouldn't this give the docstring of `__init__`?

```
sage: sage_getdoc_original(sage.symbolic.callable.CallableSymbolicExpressionRingFactory)
''
```



---

archive/issue_events_251703.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-09T11:09:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251703"
}
```



---

archive/issue_events_251704.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-09T11:09:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251704"
}
```



---

archive/issue_comments_241435.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nReplying to [@jdemeyer](#comment%3A80):\n> Shouldn't this give the docstring of `__init__`?\n> \n> ```\n> sage: sage_getdoc_original(sage.symbolic.callable.CallableSymbolicExpressionRingFactory)\n> ''\n> ```\n\nYes, it should. I'll see after lunch why it doesn't.",
    "created_at": "2015-04-09T11:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241435",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:82" align="right">comment:82</div>

Replying to [@jdemeyer](#comment%3A80):
> Shouldn't this give the docstring of `__init__`?
> 
> ```
> sage: sage_getdoc_original(sage.symbolic.callable.CallableSymbolicExpressionRingFactory)
> ''
> ```

Yes, it should. I'll see after lunch why it doesn't.



---

archive/issue_comments_241436.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nFalse alarm, `sage.symbolic.callable.CallableSymbolicExpressionRingFactory.__init__` is just `UniqueFactory.__init__` so your code is correct.",
    "created_at": "2015-04-09T11:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241436",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:83" align="right">comment:83</div>

False alarm, `sage.symbolic.callable.CallableSymbolicExpressionRingFactory.__init__` is just `UniqueFactory.__init__` so your code is correct.



---

archive/issue_comments_241437.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nI'm diffing the old and new HTML manual, and things look good. The newer manual seems to omit docstrings, but that's just because you're no longer displaying the `__init__` methods of base classes. Interestingly, I also see changes of the form\n\n```diff\n-<a class=\"reference external\" href=\"../../../rings/sage/rings/quotient_ring.html#modulesage.rings.quotient_ring\" title=\"(in Sage Reference Manual v6.6.rc2)\"><tt class=\"xref py py-mod docutils literal\"><span class=\"pre\">quotient_ring</span></tt></a>.</p>\n+<a class=\"reference external\" href=\"../../../rings/sage/rings/quotient_ring.html#modulesage.rings.quotient_ring\" title=\"(in Sage Reference Manual: General Rings, Ideals, and Morphisms v6.6.rc2)\"><tt class=\"xref py py-mod docutils literal\"><span class=\"pre\">quotient_ring</span></tt></a>.</p>\n```\nwhich are good but I cannot explain.",
    "created_at": "2015-04-09T11:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241437",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:84" align="right">comment:84</div>

I'm diffing the old and new HTML manual, and things look good. The newer manual seems to omit docstrings, but that's just because you're no longer displaying the `__init__` methods of base classes. Interestingly, I also see changes of the form

```diff
-<a class="reference external" href="../../../rings/sage/rings/quotient_ring.html#modulesage.rings.quotient_ring" title="(in Sage Reference Manual v6.6.rc2)"><tt class="xref py py-mod docutils literal"><span class="pre">quotient_ring</span></tt></a>.</p>
+<a class="reference external" href="../../../rings/sage/rings/quotient_ring.html#modulesage.rings.quotient_ring" title="(in Sage Reference Manual: General Rings, Ideals, and Morphisms v6.6.rc2)"><tt class="xref py py-mod docutils literal"><span class="pre">quotient_ring</span></tt></a>.</p>
```
which are good but I cannot explain.



---

archive/issue_comments_241438.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**",
    "created_at": "2015-04-09T12:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241438",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**



---

archive/issue_comments_241439.json:
```json
{
    "body": "<div id=\"comment:86\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d37922950e682d81bd577f3eae2c9230fbb65675\"><code>d379229</code></a></td><td><code>Support old-style classes</code></td></tr></table>\n",
    "created_at": "2015-04-09T12:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241439",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:86"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d37922950e682d81bd577f3eae2c9230fbb65675"><code>d379229</code></a></td><td><code>Support old-style classes</code></td></tr></table>




---

archive/issue_comments_241440.json:
```json
{
    "body": "Changed commit from **[`cced81b`](https://github.com/sagemath/sagetrac-mirror/commit/cced81b8c06b2eeb436c7876e5fed356e868e334)** to **[`d379229`](https://github.com/sagemath/sagetrac-mirror/commit/d37922950e682d81bd577f3eae2c9230fbb65675)**",
    "created_at": "2015-04-09T12:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241440",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`cced81b`](https://github.com/sagemath/sagetrac-mirror/commit/cced81b8c06b2eeb436c7876e5fed356e868e334)** to **[`d379229`](https://github.com/sagemath/sagetrac-mirror/commit/d37922950e682d81bd577f3eae2c9230fbb65675)**



---

archive/issue_comments_241441.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nHang on, it seems old-style classes might not have an `__init__` method...",
    "created_at": "2015-04-09T12:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241441",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:87" align="right">comment:87</div>

Hang on, it seems old-style classes might not have an `__init__` method...



---

archive/issue_comments_241442.json:
```json
{
    "body": "Changed commit from **[`d379229`](https://github.com/sagemath/sagetrac-mirror/commit/d37922950e682d81bd577f3eae2c9230fbb65675)** to **[`23390a1`](https://github.com/sagemath/sagetrac-mirror/commit/23390a1d85791bfe3a6f12ef667cf27d7bbf69a2)**",
    "created_at": "2015-04-09T12:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241442",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d379229`](https://github.com/sagemath/sagetrac-mirror/commit/d37922950e682d81bd577f3eae2c9230fbb65675)** to **[`23390a1`](https://github.com/sagemath/sagetrac-mirror/commit/23390a1d85791bfe3a6f12ef667cf27d7bbf69a2)**



---

archive/issue_comments_241443.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23390a1d85791bfe3a6f12ef667cf27d7bbf69a2\"><code>23390a1</code></a></td><td><code>Support old-style classes without `__init__` method</code></td></tr></table>\n",
    "created_at": "2015-04-09T12:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241443",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23390a1d85791bfe3a6f12ef667cf27d7bbf69a2"><code>23390a1</code></a></td><td><code>Support old-style classes without `__init__` method</code></td></tr></table>




---

archive/issue_comments_241444.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nReplying to [@jdemeyer](#comment%3A84):\n> I'm diffing the old and new HTML manual, and things look good. The newer manual seems to omit docstrings, but that's just because you're no longer displaying the `__init__` methods of base classes.\n\nDo we want to keep these?\n\nYour new changes seem good to me. Let's do tests.",
    "created_at": "2015-04-09T12:40:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241444",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:89" align="right">comment:89</div>

Replying to [@jdemeyer](#comment%3A84):
> I'm diffing the old and new HTML manual, and things look good. The newer manual seems to omit docstrings, but that's just because you're no longer displaying the `__init__` methods of base classes.

Do we want to keep these?

Your new changes seem good to me. Let's do tests.



---

archive/issue_comments_241445.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@simon-king-jena](#comment%3A89):\n> Replying to [@jdemeyer](#comment%3A84):\n> > I'm diffing the old and new HTML manual, and things look good. The newer manual seems to omit docstrings, but that's just because you're no longer displaying the `__init__` methods of base classes.\n> \n> \n> Do we want to keep these?\n\nNo, I think the output is good. I was commenting. There are annoying cases where both the class and `__init__` have non-trivial docstrings, that really should be discouraged.",
    "created_at": "2015-04-09T12:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241445",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@simon-king-jena](#comment%3A89):
> Replying to [@jdemeyer](#comment%3A84):
> > I'm diffing the old and new HTML manual, and things look good. The newer manual seems to omit docstrings, but that's just because you're no longer displaying the `__init__` methods of base classes.
> 
> 
> Do we want to keep these?

No, I think the output is good. I was commenting. There are annoying cases where both the class and `__init__` have non-trivial docstrings, that really should be discouraged.



---

archive/issue_comments_241446.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nCan we remove the support for embedding information from `sagedoc.format`? I think that `format()` should take only \"original\" docstrings as input, i.e. without embedding information.",
    "created_at": "2015-04-09T13:06:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241446",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:91" align="right">comment:91</div>

Can we remove the support for embedding information from `sagedoc.format`? I think that `format()` should take only "original" docstrings as input, i.e. without embedding information.



---

archive/issue_comments_241447.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nReplying to [@jdemeyer](#comment%3A90):\n> There are annoying cases where both the class and `__init__` have non-trivial docstrings, that really should be discouraged.\n\nI guess I am responsible for some of them. When I have a class whose instances are supposed to be created by a factory, I would document the \"expected\" way of using the class in the class' docstring. In the `__init__` docstring, I would provide technical details that are normally taken care of by the factory. In that way, the details are available to developers, but are hidden from (and can thus not confuse) the casual users.",
    "created_at": "2015-04-09T13:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241447",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:92" align="right">comment:92</div>

Replying to [@jdemeyer](#comment%3A90):
> There are annoying cases where both the class and `__init__` have non-trivial docstrings, that really should be discouraged.

I guess I am responsible for some of them. When I have a class whose instances are supposed to be created by a factory, I would document the "expected" way of using the class in the class' docstring. In the `__init__` docstring, I would provide technical details that are normally taken care of by the factory. In that way, the details are available to developers, but are hidden from (and can thus not confuse) the casual users.



---

archive/issue_comments_241448.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@jdemeyer](#comment%3A91):\n> Can we remove the support for embedding information from `sagedoc.format`?\n\nI thought that this was orthogonal to the \"embedded information\" question. In the sense that it is not format's job to remove the information.\n\nWhere would it be relevant? When doing `obj?`? What happens when `obj?` is typed? I guess `sagedoc.format` is applied in that case, but *what* is it applied to?",
    "created_at": "2015-04-09T13:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241448",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@jdemeyer](#comment%3A91):
> Can we remove the support for embedding information from `sagedoc.format`?

I thought that this was orthogonal to the "embedded information" question. In the sense that it is not format's job to remove the information.

Where would it be relevant? When doing `obj?`? What happens when `obj?` is typed? I guess `sagedoc.format` is applied in that case, but *what* is it applied to?



---

archive/issue_comments_241449.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nReplying to [@simon-king-jena](#comment%3A93):\n> Replying to [@jdemeyer](#comment%3A91):\n> > Can we remove the support for embedding information from `sagedoc.format`?\n> \n> \n> I thought that this was orthogonal to the \"embedded information\" question. In the sense that it is not format's job to remove the information.\n\nI'll read this as an agreement...\n\n> What happens when `obj?` is typed?\n\nI think that just calls `sageinspect.sage_getdoc`, which calls `format()` on the original (i.e. without embedding info) doc.",
    "created_at": "2015-04-09T13:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241449",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:94" align="right">comment:94</div>

Replying to [@simon-king-jena](#comment%3A93):
> Replying to [@jdemeyer](#comment%3A91):
> > Can we remove the support for embedding information from `sagedoc.format`?
> 
> 
> I thought that this was orthogonal to the "embedded information" question. In the sense that it is not format's job to remove the information.

I'll read this as an agreement...

> What happens when `obj?` is typed?

I think that just calls `sageinspect.sage_getdoc`, which calls `format()` on the original (i.e. without embedding info) doc.



---

archive/issue_comments_241450.json:
```json
{
    "body": "Changed commit from **[`23390a1`](https://github.com/sagemath/sagetrac-mirror/commit/23390a1d85791bfe3a6f12ef667cf27d7bbf69a2)** to **[`51aa68c`](https://github.com/sagemath/sagetrac-mirror/commit/51aa68c66b6a62675aa84f351a961e823e014fb3)**",
    "created_at": "2015-04-09T13:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241450",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`23390a1`](https://github.com/sagemath/sagetrac-mirror/commit/23390a1d85791bfe3a6f12ef667cf27d7bbf69a2)** to **[`51aa68c`](https://github.com/sagemath/sagetrac-mirror/commit/51aa68c66b6a62675aa84f351a961e823e014fb3)**



---

archive/issue_comments_241451.json:
```json
{
    "body": "<div id=\"comment:95\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51aa68c66b6a62675aa84f351a961e823e014fb3\"><code>51aa68c</code></a></td><td><code>Remove support for embedding information from sagedoc.format()</code></td></tr></table>\n",
    "created_at": "2015-04-09T13:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241451",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51aa68c66b6a62675aa84f351a961e823e014fb3"><code>51aa68c</code></a></td><td><code>Remove support for embedding information from sagedoc.format()</code></td></tr></table>




---

archive/issue_comments_241452.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nI couldn't find any difference in behaviour between `foo?` or `foo??` with or without this patch.",
    "created_at": "2015-04-09T13:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241452",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:96" align="right">comment:96</div>

I couldn't find any difference in behaviour between `foo?` or `foo??` with or without this patch.



---

archive/issue_comments_241453.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nWhat is this for?\n\n```\ngetattr(init, 'im_class', None) == typ\n```",
    "created_at": "2015-04-09T13:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241453",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:97" align="right">comment:97</div>

What is this for?

```
getattr(init, 'im_class', None) == typ
```



---

archive/issue_comments_241454.json:
```json
{
    "body": "Changed commit from **[`51aa68c`](https://github.com/sagemath/sagetrac-mirror/commit/51aa68c66b6a62675aa84f351a961e823e014fb3)** to **[`02ee3cc`](https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2)**",
    "created_at": "2015-04-09T13:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241454",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`51aa68c`](https://github.com/sagemath/sagetrac-mirror/commit/51aa68c66b6a62675aa84f351a961e823e014fb3)** to **[`02ee3cc`](https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2)**



---

archive/issue_comments_241455.json:
```json
{
    "body": "<div id=\"comment:98\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2\"><code>02ee3cc</code></a></td><td><code>Fix raise syntax</code></td></tr></table>\n",
    "created_at": "2015-04-09T13:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241455",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:98"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2"><code>02ee3cc</code></a></td><td><code>Fix raise syntax</code></td></tr></table>




---

archive/issue_comments_241456.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nReplying to [@sagetrac-git](#comment%3A98):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2\"><code>02ee3cc</code></a></td><td><code>Fix raise syntax</code></td></tr></table>\n\nThanks, I thought that `except (TypeError, AttributeError), err` assigns the caught error to `err`.",
    "created_at": "2015-04-09T13:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241456",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:99" align="right">comment:99</div>

Replying to [@sagetrac-git](#comment%3A98):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2"><code>02ee3cc</code></a></td><td><code>Fix raise syntax</code></td></tr></table>

Thanks, I thought that `except (TypeError, AttributeError), err` assigns the caught error to `err`.



---

archive/issue_comments_241457.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@jdemeyer](#comment%3A97):\n> What is this for?\n> \n> ```\n> getattr(init, 'im_class', None) == typ\n> ```\n\nI wanted to test that the init method belongs to typ and is not inherited from a super class.\n\nBut on second thought, it would perhaps be better to work with inheritance: After all, docstrings are inherited, too.",
    "created_at": "2015-04-09T13:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241457",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@jdemeyer](#comment%3A97):
> What is this for?
> 
> ```
> getattr(init, 'im_class', None) == typ
> ```

I wanted to test that the init method belongs to typ and is not inherited from a super class.

But on second thought, it would perhaps be better to work with inheritance: After all, docstrings are inherited, too.



---

archive/issue_comments_241458.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nReplying to [@simon-king-jena](#comment%3A100):\n> I wanted to test that the init method belongs to typ and is not inherited from a super class.\n\nThe original rationale was this: The init method may contain embedding information for the class. If it is obtained from the super-class, then the embedding information belongs to a different class and is thus misleading.",
    "created_at": "2015-04-09T13:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241458",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:101" align="right">comment:101</div>

Replying to [@simon-king-jena](#comment%3A100):
> I wanted to test that the init method belongs to typ and is not inherited from a super class.

The original rationale was this: The init method may contain embedding information for the class. If it is obtained from the super-class, then the embedding information belongs to a different class and is thus misleading.



---

archive/issue_comments_241459.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nReplying to [@simon-king-jena](#comment%3A100):\n> But on second thought, it would perhaps be better to work with inheritance: After all, docstrings are inherited, too.\n\nI don't think this should be changed.\nI would not like to see the doc of `Parent` just because esomething something inherits from `Parent`.",
    "created_at": "2015-04-09T13:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241459",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:102" align="right">comment:102</div>

Replying to [@simon-king-jena](#comment%3A100):
> But on second thought, it would perhaps be better to work with inheritance: After all, docstrings are inherited, too.

I don't think this should be changed.
I would not like to see the doc of `Parent` just because esomething something inherits from `Parent`.



---

archive/issue_comments_241460.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nFor me, this branch is good to go if you add some comment in the sources about this part:\n\n```\n            if (getattr(init, '__objclass__', None) or\n                getattr(init, 'im_class', None)) == typ:\n                return sage_getdoc_original(init)\n```",
    "created_at": "2015-04-09T13:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241460",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:103" align="right">comment:103</div>

For me, this branch is good to go if you add some comment in the sources about this part:

```
            if (getattr(init, '__objclass__', None) or
                getattr(init, 'im_class', None)) == typ:
                return sage_getdoc_original(init)
```



---

archive/issue_comments_241461.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nReplying to [@jdemeyer](#comment%3A103):\n> For me, this branch is good to go if you add some comment in the sources about this part:\n> \n> ```\n>             if (getattr(init, '__objclass__', None) or\n>                 getattr(init, 'im_class', None)) == typ:\n>                 return sage_getdoc_original(init)\n> ```\n\nI will do so a bit later, as I have an appointment now.",
    "created_at": "2015-04-09T13:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241461",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:104" align="right">comment:104</div>

Replying to [@jdemeyer](#comment%3A103):
> For me, this branch is good to go if you add some comment in the sources about this part:
> 
> ```
>             if (getattr(init, '__objclass__', None) or
>                 getattr(init, 'im_class', None)) == typ:
>                 return sage_getdoc_original(init)
> ```

I will do so a bit later, as I have an appointment now.



---

archive/issue_comments_241462.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nHmm, this patch doesn't behave so nicely for some of Python's docs:\n\n```\nsage: print type.__doc__\ntype(object) -> the object's type\ntype(name, bases, dict) -> a new type\n\nsage: print sage_getdoc_original(type)\ntype(name, bases, dict) -> a new type\n```\n\nThis causes\n\n```\nsage -t --long src/sage/repl/ipython_tests.py\n**********************************************************************\nFile \"src/sage/repl/ipython_tests.py\", line 10, in sage.repl.ipython_tests\nFailed example:\n    shell.run_cell(u'%pinfo dummy')\nExpected:\n    Type:            function\n    String form:     <function dummy at 0x...>\n    File:            /.../sage/repl/ipython_tests.py\n    Definition:      dummy(argument, optional=None)\n    Docstring:\n       Dummy Docstring Title\n    <BLANKLINE>\n       Dummy docstring explanation.\n    <BLANKLINE>\n       INPUT:\n    <BLANKLINE>\n       * \"argument\" -- anything. Dummy argument.\n    <BLANKLINE>\n       * \"optional\" -- anything (optional). Dummy optional.\n    <BLANKLINE>\n       EXAMPLES:\n    ...\n    Class docstring:\n    function(code, globals[, name[, argdefs[, closure]]])\n    <BLANKLINE>\n    Create a function object from a code object and a dictionary. The\n    optional name string overrides the name from the code object. The\n    optional argdefs tuple specifies the default argument values. The\n    optional closure tuple supplies the bindings for free variables.\n    Init docstring:  x.__init__(...) initializes x; see help(type(x)) for signature\nGot:\n    Type:            function\n    String form:     <function dummy at 0x7f8a0ffe76e0>\n    File:            /usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/repl/ipython_tests.py\n    Definition:      dummy(argument, optional=None)\n    Docstring:\n       Dummy Docstring Title\n    <BLANKLINE>\n       Dummy docstring explanation.\n    <BLANKLINE>\n       INPUT:\n    <BLANKLINE>\n       * \"argument\" -- anything. Dummy argument.\n    <BLANKLINE>\n       * \"optional\" -- anything (optional). Dummy optional.\n    <BLANKLINE>\n       EXAMPLES:\n    <BLANKLINE>\n          sage: from sage.repl.ipython_tests import dummy sage: dummy(1)\n          'Source code would be here'\n    <BLANKLINE>\n    Class docstring:\n    Create a function object from a code object and a dictionary. The\n    optional name string overrides the name from the code object. The\n    optional argdefs tuple specifies the default argument values. The\n    optional closure tuple supplies the bindings for free variables.\n    Init docstring:  x.__init__(...) initializes x; see help(type(x)) for signature\n**********************************************************************\n```",
    "created_at": "2015-04-09T14:34:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241462",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:105" align="right">comment:105</div>

Hmm, this patch doesn't behave so nicely for some of Python's docs:

```
sage: print type.__doc__
type(object) -> the object's type
type(name, bases, dict) -> a new type

sage: print sage_getdoc_original(type)
type(name, bases, dict) -> a new type
```

This causes

```
sage -t --long src/sage/repl/ipython_tests.py
**********************************************************************
File "src/sage/repl/ipython_tests.py", line 10, in sage.repl.ipython_tests
Failed example:
    shell.run_cell(u'%pinfo dummy')
Expected:
    Type:            function
    String form:     <function dummy at 0x...>
    File:            /.../sage/repl/ipython_tests.py
    Definition:      dummy(argument, optional=None)
    Docstring:
       Dummy Docstring Title
    <BLANKLINE>
       Dummy docstring explanation.
    <BLANKLINE>
       INPUT:
    <BLANKLINE>
       * "argument" -- anything. Dummy argument.
    <BLANKLINE>
       * "optional" -- anything (optional). Dummy optional.
    <BLANKLINE>
       EXAMPLES:
    ...
    Class docstring:
    function(code, globals[, name[, argdefs[, closure]]])
    <BLANKLINE>
    Create a function object from a code object and a dictionary. The
    optional name string overrides the name from the code object. The
    optional argdefs tuple specifies the default argument values. The
    optional closure tuple supplies the bindings for free variables.
    Init docstring:  x.__init__(...) initializes x; see help(type(x)) for signature
Got:
    Type:            function
    String form:     <function dummy at 0x7f8a0ffe76e0>
    File:            /usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/repl/ipython_tests.py
    Definition:      dummy(argument, optional=None)
    Docstring:
       Dummy Docstring Title
    <BLANKLINE>
       Dummy docstring explanation.
    <BLANKLINE>
       INPUT:
    <BLANKLINE>
       * "argument" -- anything. Dummy argument.
    <BLANKLINE>
       * "optional" -- anything (optional). Dummy optional.
    <BLANKLINE>
       EXAMPLES:
    <BLANKLINE>
          sage: from sage.repl.ipython_tests import dummy sage: dummy(1)
          'Source code would be here'
    <BLANKLINE>
    Class docstring:
    Create a function object from a code object and a dictionary. The
    optional name string overrides the name from the code object. The
    optional argdefs tuple specifies the default argument values. The
    optional closure tuple supplies the bindings for free variables.
    Init docstring:  x.__init__(...) initializes x; see help(type(x)) for signature
**********************************************************************
```



---

archive/issue_events_251705.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-09T14:34:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251705"
}
```



---

archive/issue_events_251706.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-09T14:34:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251706"
}
```



---

archive/issue_comments_241463.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nReplying to [@jdemeyer](#comment%3A105):\n> Hmm, this patch doesn't behave so nicely for some of Python's docs:\n> \n> ```\n> sage: print sage_getdoc_original(type)\n> type(name, bases, dict) -> a new type\n> ```\n\nYes. That's because of my attempt to remove the signature. After all, what I have is only a heuristics.\n\nHow could we improve the heuristics? Special-case `type`? Test whether the first line ends with `')'`?\n\nI'll finish a commit now. Please wait.",
    "created_at": "2015-04-09T15:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241463",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:106" align="right">comment:106</div>

Replying to [@jdemeyer](#comment%3A105):
> Hmm, this patch doesn't behave so nicely for some of Python's docs:
> 
> ```
> sage: print sage_getdoc_original(type)
> type(name, bases, dict) -> a new type
> ```

Yes. That's because of my attempt to remove the signature. After all, what I have is only a heuristics.

How could we improve the heuristics? Special-case `type`? Test whether the first line ends with `')'`?

I'll finish a commit now. Please wait.



---

archive/issue_comments_241464.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**",
    "created_at": "2015-04-09T15:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241464",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**



---

archive/issue_comments_241465.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**",
    "created_at": "2015-04-09T16:01:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241465",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**



---

archive/issue_events_251707.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-04-09T16:01:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251707"
}
```



---

archive/issue_events_251708.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-04-09T16:01:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251708"
}
```



---

archive/issue_comments_241466.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**",
    "created_at": "2015-04-09T16:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241466",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)**



---

archive/issue_comments_241467.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nWhy has the branch that I just pushed be reverted???\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/934490a6d231c3a0028496f8e98b31faf6365d35\"><code>934490a</code></a></td><td><code>Add a comment; improve heuristics to strip the embedded signature</code></td></tr></table>\n",
    "created_at": "2015-04-09T16:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241467",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:109" align="right">comment:109</div>

Why has the branch that I just pushed be reverted???

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/934490a6d231c3a0028496f8e98b31faf6365d35"><code>934490a</code></a></td><td><code>Add a comment; improve heuristics to strip the embedded signature</code></td></tr></table>




---

archive/issue_comments_241468.json:
```json
{
    "body": "Changed commit from **[`02ee3cc`](https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2)** to **[`934490a`](https://github.com/sagemath/sagetrac-mirror/commit/934490a6d231c3a0028496f8e98b31faf6365d35)**",
    "created_at": "2015-04-09T16:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241468",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[`02ee3cc`](https://github.com/sagemath/sagetrac-mirror/commit/02ee3cc5478de184783d64c609da0d9a083db9c2)** to **[`934490a`](https://github.com/sagemath/sagetrac-mirror/commit/934490a6d231c3a0028496f8e98b31faf6365d35)**



---

archive/issue_comments_241469.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nNow it should be ready for review.",
    "created_at": "2015-04-09T16:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241469",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:110" align="right">comment:110</div>

Now it should be ready for review.



---

archive/issue_comments_241470.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**",
    "created_at": "2015-04-10T08:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241470",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/SimonKing/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/17847)** to **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)**



---

archive/issue_comments_241471.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nSorry that I didn't fix that doctest.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90\"><code>cc9e9f6</code></a></td><td><code>Fix IPython doctest</code></td></tr></table>\n",
    "created_at": "2015-04-10T09:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241471",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:112" align="right">comment:112</div>

Sorry that I didn't fix that doctest.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90"><code>cc9e9f6</code></a></td><td><code>Fix IPython doctest</code></td></tr></table>




---

archive/issue_comments_241472.json:
```json
{
    "body": "Changed commit from **[`934490a`](https://github.com/sagemath/sagetrac-mirror/commit/934490a6d231c3a0028496f8e98b31faf6365d35)** to **[`cc9e9f6`](https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90)**",
    "created_at": "2015-04-10T09:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241472",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[`934490a`](https://github.com/sagemath/sagetrac-mirror/commit/934490a6d231c3a0028496f8e98b31faf6365d35)** to **[`cc9e9f6`](https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90)**



---

archive/issue_events_251709.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-10T15:08:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251709"
}
```



---

archive/issue_events_251710.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-10T15:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251710"
}
```



---

archive/issue_events_251711.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:43:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251711"
}
```



---

archive/issue_events_251712.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "596567eaeaa4799d90204173d1f8a0336dad2dc1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-14T19:43:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17847#event-251712"
}
```



---

archive/issue_comments_241473.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[`cc9e9f6`](https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90)**",
    "created_at": "2015-04-14T19:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17847#issuecomment-241473",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17847](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17847)** to **[`cc9e9f6`](https://github.com/sagemath/sagetrac-mirror/commit/cc9e9f605faf0f7eabc8bfbed83889dc07119d90)**
