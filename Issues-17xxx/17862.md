# Issue 17862: Remove use of PY_IS_NUMERIC

archive/issues_017625.json:
```json
{
    "body": "\n\nBranch/Commit: 8300f591ae2987e01d609e856d38758b28c6bf42\n\nReviewer: Vincent Delecroix\n\nAuthor: Jeroen Demeyer\n\nDependencies: #17800\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17862\n\n",
    "closed_at": "2015-02-28T21:24:12Z",
    "created_at": "2015-02-26T14:51:59Z",
    "labels": [
        "component: c_lib"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Remove use of PY_IS_NUMERIC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17862",
    "user": "https://github.com/jdemeyer"
}
```


Branch/Commit: 8300f591ae2987e01d609e856d38758b28c6bf42

Reviewer: Vincent Delecroix

Author: Jeroen Demeyer

Dependencies: #17800

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17862





---

archive/issue_comments_250615.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2015-02-26T16:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250615",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_250616.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-26T16:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250616",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_250617.json:
```json
{
    "body": "<a id='comment:3'></a>Could we get rid in the same ticket of `_native_coercion_ranks_inv` and `_native_coercion_ranks` and use `coerce` from Python\n\n```\n>>> coerce(True, 1l)\n(1L, 1L)\n>>> coerce(complex(0,1), 1.0)\n(1j, (1+0j))\n```\nOr even better [PyNumber_Coerce](https://docs.python.org/2/c-api/number.html#c.PyNumber_Coerce) from the C API.",
    "created_at": "2015-02-26T17:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250617",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>Could we get rid in the same ticket of `_native_coercion_ranks_inv` and `_native_coercion_ranks` and use `coerce` from Python

```
>>> coerce(True, 1l)
(1L, 1L)
>>> coerce(complex(0,1), 1.0)
(1j, (1+0j))
```
Or even better [PyNumber_Coerce](https://docs.python.org/2/c-api/number.html#c.PyNumber_Coerce) from the C API.



---

archive/issue_comments_250618.json:
```json
{
    "body": "<a id='comment:4'></a>Can you make a new ticket for that instead?",
    "created_at": "2015-02-26T21:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250618",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Can you make a new ticket for that instead?



---

archive/issue_comments_250619.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 jdemeyer]:\n> Can you make a new ticket for that instead?\n\n\nYes #17865",
    "created_at": "2015-02-26T22:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250619",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Replying to [comment:4 jdemeyer]:
> Can you make a new ticket for that instead?


Yes #17865



---

archive/issue_comments_250620.json:
```json
{
    "body": "<a id='comment:6'></a>I just have two remarks but not for this ticket I guess:\n\n- Don't we want to use faster functions in `py_scalar_to_element`?\n\n- It is clear that we want compatibility between `structure.coerce.py_scalar_parent` and `structure.element.py_scalar_to_element`. I do not like the fact that these two functions belong to two different files and do not call each other in their doctests.",
    "created_at": "2015-02-27T12:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250620",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>I just have two remarks but not for this ticket I guess:

- Don't we want to use faster functions in `py_scalar_to_element`?

- It is clear that we want compatibility between `structure.coerce.py_scalar_parent` and `structure.element.py_scalar_to_element`. I do not like the fact that these two functions belong to two different files and do not call each other in their doctests.



---

archive/issue_comments_250621.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 vdelecroix]:\n> I just have two remarks but not for this ticket I guess:\n> \n> - Don't we want to use faster functions in `py_scalar_to_element`?\n \nIf you mean functions like `PyFoo_Check()`: Cython knows them too, it will generate calls to `PyFoo_Check()` in `isinstance`.\n\n> - It is clear that we want compatibility between `structure.coerce.py_scalar_parent` and `structure.element.py_scalar_to_element`. I do not like the fact that these two functions belong to two different files and do not call each other in their doctests.\n \nGood point.",
    "created_at": "2015-02-27T13:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250621",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:6 vdelecroix]:
> I just have two remarks but not for this ticket I guess:
> 
> - Don't we want to use faster functions in `py_scalar_to_element`?
 
If you mean functions like `PyFoo_Check()`: Cython knows them too, it will generate calls to `PyFoo_Check()` in `isinstance`.

> - It is clear that we want compatibility between `structure.coerce.py_scalar_parent` and `structure.element.py_scalar_to_element`. I do not like the fact that these two functions belong to two different files and do not call each other in their doctests.
 
Good point.



---

archive/issue_comments_250622.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:\n> Replying to [comment:6 vdelecroix]:\n> > I just have two remarks but not for this ticket I guess:\n> > \n> > - Don't we want to use faster functions in `py_scalar_to_element`?\n \n> If you mean functions like `PyFoo_Check()`: Cython knows them too, it will generate calls to `PyFoo_Check()` in `isinstance`.\n\nNope. I meant the conversion `Python int` -> `Sage integer` and such. The `import` takes quite a long time and `ZZ(x)` is suboptimal to create an integer.",
    "created_at": "2015-02-27T13:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250622",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:
> Replying to [comment:6 vdelecroix]:
> > I just have two remarks but not for this ticket I guess:
> > 
> > - Don't we want to use faster functions in `py_scalar_to_element`?
 
> If you mean functions like `PyFoo_Check()`: Cython knows them too, it will generate calls to `PyFoo_Check()` in `isinstance`.

Nope. I meant the conversion `Python int` -> `Sage integer` and such. The `import` takes quite a long time and `ZZ(x)` is suboptimal to create an integer.



---

archive/issue_comments_250623.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-28T09:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_250624.json:
```json
{
    "body": "<a id='comment:11'></a>I moved `py_scalar_to_element` to `coerce.pyx`, but I couldn't improve the conversion because of circular import problems.",
    "created_at": "2015-02-28T09:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250624",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>I moved `py_scalar_to_element` to `coerce.pyx`, but I couldn't improve the conversion because of circular import problems.



---

archive/issue_comments_250625.json:
```json
{
    "body": "<a id='comment:12'></a>I did not know\n\n```\nsage: isinstance(True,int)\nTrue\n```\nDo we really want the `bool -> Integer` to happen within Sage? We can do an exact type check instead. That would break support for subtyped Python base classes though. Another drawback is that it would not be possible anymore to count like\n\n```\nsage: sum((x >= 3 for x in my_list), ZZ(0))\n```\nSo I am in favor of your solution.\n\nFor the speed-up, that is not dramatic.\n\nI changed the doc to make the link `:class:`Element`` works. I am ok for positive review.\n\n---\nNew commits:",
    "created_at": "2015-02-28T10:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250625",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>I did not know

```
sage: isinstance(True,int)
True
```
Do we really want the `bool -> Integer` to happen within Sage? We can do an exact type check instead. That would break support for subtyped Python base classes though. Another drawback is that it would not be possible anymore to count like

```
sage: sum((x >= 3 for x in my_list), ZZ(0))
```
So I am in favor of your solution.

For the speed-up, that is not dramatic.

I changed the doc to make the link `:class:`Element`` works. I am ok for positive review.

---
New commits:



---

archive/issue_comments_250626.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-28T10:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250626",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_250627.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-28T21:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17862#issuecomment-250627",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050927.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-28T21:24:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17862",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17862#event-50927"
}
```
