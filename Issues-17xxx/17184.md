# Issue 17184: Upgrade to Singular-3-1-7p1

archive/issues_016947.json:
```json
{
    "body": "Singular 3-1-7p1 repackaged (see spkg-src):\n* http://boxen.math.washington.edu/home/jpflori/upstream/singular-3.1.7p1.tar.bz2\n\nCC:  @vbraun @nbruin @burcin\n\nBranch/Commit: 4e287c4a5a72e1a23c35046c71bddde9786110cc\n\nReviewer: Volker Braun\n\nAuthor: Jean-Pierre Flori\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17184\n\n",
    "closed_at": "2014-11-22T17:18:32Z",
    "created_at": "2014-10-20T20:04:32Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Upgrade to Singular-3-1-7p1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17184",
    "user": "https://github.com/jdemeyer"
}
```
Singular 3-1-7p1 repackaged (see spkg-src):
* http://boxen.math.washington.edu/home/jpflori/upstream/singular-3.1.7p1.tar.bz2

CC:  @vbraun @nbruin @burcin

Branch/Commit: 4e287c4a5a72e1a23c35046c71bddde9786110cc

Reviewer: Volker Braun

Author: Jean-Pierre Flori

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17184





---

archive/issue_comments_289867.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/17184\"",
    "created_at": "2014-10-20T20:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289867",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/17184"



---

archive/issue_comments_289868.json:
```json
{
    "body": "Changing commit from \"\" to \"7c3f691d1f544592516312f2e4961239baf6d262\"",
    "created_at": "2014-10-20T20:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289868",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "7c3f691d1f544592516312f2e4961239baf6d262"



---

archive/issue_comments_289869.json:
```json
{
    "body": "<a id='comment:2'></a>boxen is down, cannot test...\n\n---\nNew commits:",
    "created_at": "2014-10-20T20:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289869",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>boxen is down, cannot test...

---
New commits:



---

archive/issue_comments_289870.json:
```json
{
    "body": "<a id='comment:3'></a>One thing I actually did not test because i just forgot: check that it still builds with SAGE_DEBUG as it is quite involved for Singular.",
    "created_at": "2014-10-21T05:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289870",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>One thing I actually did not test because i just forgot: check that it still builds with SAGE_DEBUG as it is quite involved for Singular.



---

archive/issue_comments_289871.json:
```json
{
    "body": "<a id='comment:4'></a>Boxen is back up (from here at least)!",
    "created_at": "2014-10-21T07:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289871",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Boxen is back up (from here at least)!



---

archive/issue_comments_289872.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T08:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289873.json:
```json
{
    "body": "Changing commit from \"7c3f691d1f544592516312f2e4961239baf6d262\" to \"1027b8fbfced15a69dc4b4da4511eb43470b631e\"",
    "created_at": "2014-10-21T08:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7c3f691d1f544592516312f2e4961239baf6d262" to "1027b8fbfced15a69dc4b4da4511eb43470b631e"



---

archive/issue_comments_289874.json:
```json
{
    "body": "<a id='comment:6'></a>That's a lot of dropped patches. That, on its own, would justify the upgrade.",
    "created_at": "2014-10-21T08:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289874",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>That's a lot of dropped patches. That, on its own, would justify the upgrade.



---

archive/issue_comments_289875.json:
```json
{
    "body": "<a id='comment:7'></a>Needs some work for the debug version.\nI'm on it.",
    "created_at": "2014-10-21T09:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289875",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>Needs some work for the debug version.
I'm on it.



---

archive/issue_comments_289876.json:
```json
{
    "body": "Changing commit from \"1027b8fbfced15a69dc4b4da4511eb43470b631e\" to \"f70af8cc6cb04621cc785681e894724066d7b36b\"",
    "created_at": "2014-10-21T10:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289876",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing commit from "1027b8fbfced15a69dc4b4da4511eb43470b631e" to "f70af8cc6cb04621cc785681e894724066d7b36b"



---

archive/issue_comments_289877.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/17184\" to \"u/jpflori/ticket/17184\"",
    "created_at": "2014-10-21T10:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289877",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing branch from "u/jdemeyer/ticket/17184" to "u/jpflori/ticket/17184"



---

archive/issue_comments_289878.json:
```json
{
    "body": "<a id='comment:8'></a>Should compile ok in debug mode now, though potentially not on top of the new NTL.\n\n---\nNew commits:",
    "created_at": "2014-10-21T10:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289878",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>Should compile ok in debug mode now, though potentially not on top of the new NTL.

---
New commits:



---

archive/issue_comments_289879.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T13:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289880.json:
```json
{
    "body": "Changing commit from \"f70af8cc6cb04621cc785681e894724066d7b36b\" to \"cdedfc61ca715961acca343dea87e7e5c1163063\"",
    "created_at": "2014-10-21T13:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f70af8cc6cb04621cc785681e894724066d7b36b" to "cdedfc61ca715961acca343dea87e7e5c1163063"



---

archive/issue_comments_289881.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-21T13:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289881",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_289882.json:
```json
{
    "body": "<a id='comment:11'></a>Without the latest debug patches, without `SAGE_DEBUG=yes`, together with NTL-6.2.1:\n\n```\nsage -t --long src/sage/schemes/plane_curves/constructor.py\n**********************************************************************\nFile \"src/sage/schemes/plane_curves/constructor.py\", line 69, in sage.schemes.plane_curves.constructor.Curve\nFailed example:\n    C.genus()\nExpected:\n    1\nGot:\n    // ** redefining my_awesome_sage_ring **\n    1\n**********************************************************************\n1 item had failures:\n   1 of  30 in sage.schemes.plane_curves.constructor.Curve\n    [29 tests, 1 failure, 1.96 s]\nsage -t --long src/sage/schemes/plane_curves/curve.py\n**********************************************************************\nFile \"src/sage/schemes/plane_curves/curve.py\", line 116, in sage.schemes.plane_curves.curve.Curve_generic.geometric_genus\nFailed example:\n    C.geometric_genus()\nExpected:\n          1\nGot:\n    // ** redefining my_awesome_sage_ring **\n    1\n**********************************************************************\n1 item had failures:\n   1 of  16 in sage.schemes.plane_curves.curve.Curve_generic.geometric_genus\n    [35 tests, 1 failure, 1.65 s]\nsage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_ideal.py\", line 1971, in sage.rings.polynomial.multi_polynomial_ideal.?.integral_closure\nFailed example:\n    I.integral_closure()\nExpected:\n    [x^2, y^5, -x*y^3]\nGot:\n    [x^2, x*y^4, y^5, x*y^3]\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.rings.polynomial.multi_polynomial_ideal.?.integral_closure\n    [708 tests, 1 failure, 11.48 s]\nsage -t --long src/sage/schemes/plane_curves/projective_curve.py\n**********************************************************************\nFile \"src/sage/schemes/plane_curves/projective_curve.py\", line 70, in sage.schemes.plane_curves.projective_curve.ProjectiveCurve_generic.arithmetic_genus\nFailed example:\n    C.genus()\nExpected:\n    4\nGot:\n    // ** redefining my_awesome_sage_ring **\n    4\n**********************************************************************\n```",
    "created_at": "2014-10-21T13:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289882",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Without the latest debug patches, without `SAGE_DEBUG=yes`, together with NTL-6.2.1:

```
sage -t --long src/sage/schemes/plane_curves/constructor.py
**********************************************************************
File "src/sage/schemes/plane_curves/constructor.py", line 69, in sage.schemes.plane_curves.constructor.Curve
Failed example:
    C.genus()
Expected:
    1
Got:
    // ** redefining my_awesome_sage_ring **
    1
**********************************************************************
1 item had failures:
   1 of  30 in sage.schemes.plane_curves.constructor.Curve
    [29 tests, 1 failure, 1.96 s]
sage -t --long src/sage/schemes/plane_curves/curve.py
**********************************************************************
File "src/sage/schemes/plane_curves/curve.py", line 116, in sage.schemes.plane_curves.curve.Curve_generic.geometric_genus
Failed example:
    C.geometric_genus()
Expected:
          1
Got:
    // ** redefining my_awesome_sage_ring **
    1
**********************************************************************
1 item had failures:
   1 of  16 in sage.schemes.plane_curves.curve.Curve_generic.geometric_genus
    [35 tests, 1 failure, 1.65 s]
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_ideal.py", line 1971, in sage.rings.polynomial.multi_polynomial_ideal.?.integral_closure
Failed example:
    I.integral_closure()
Expected:
    [x^2, y^5, -x*y^3]
Got:
    [x^2, x*y^4, y^5, x*y^3]
**********************************************************************
1 item had failures:
   1 of   4 in sage.rings.polynomial.multi_polynomial_ideal.?.integral_closure
    [708 tests, 1 failure, 11.48 s]
sage -t --long src/sage/schemes/plane_curves/projective_curve.py
**********************************************************************
File "src/sage/schemes/plane_curves/projective_curve.py", line 70, in sage.schemes.plane_curves.projective_curve.ProjectiveCurve_generic.arithmetic_genus
Failed example:
    C.genus()
Expected:
    4
Got:
    // ** redefining my_awesome_sage_ring **
    4
**********************************************************************
```



---

archive/issue_comments_289883.json:
```json
{
    "body": "<a id='comment:12'></a>I get these doctest failures also with the latest version of this ticket, without NTL.",
    "created_at": "2014-10-21T14:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289883",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>I get these doctest failures also with the latest version of this ticket, without NTL.



---

archive/issue_comments_289884.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-21T14:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289884",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289885.json:
```json
{
    "body": "<a id='comment:14'></a>I don't really remember who committed the \"my_awesome_ring\" code.\nWas it Volker, or Nils, or anyone else?\nI didn't have a look at the code yet, but if the author could help, that would... help!",
    "created_at": "2014-10-22T09:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289885",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:14'></a>I don't really remember who committed the "my_awesome_ring" code.
Was it Volker, or Nils, or anyone else?
I didn't have a look at the code yet, but if the author could help, that would... help!



---

archive/issue_comments_289886.json:
```json
{
    "body": "<a id='comment:15'></a>Looking at the failing example in `src/sage/schemes/plane_curves/constructor.py`, which is a call to `genus` going through Singular, it seems that there are three creations of `SingularFunction` objects:\n* twice `normal__lib`;\n* then `genus`.\nSomehow the global `currRingHdl` is set back to zero when the second `normal__lib` object is created.\nThis was not the case with 3.1.6.\n(I'm just discovering the way Singular internally works, so my description may seem naive and wrong.)",
    "created_at": "2014-10-23T08:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289886",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:15'></a>Looking at the failing example in `src/sage/schemes/plane_curves/constructor.py`, which is a call to `genus` going through Singular, it seems that there are three creations of `SingularFunction` objects:
* twice `normal__lib`;
* then `genus`.
Somehow the global `currRingHdl` is set back to zero when the second `normal__lib` object is created.
This was not the case with 3.1.6.
(I'm just discovering the way Singular internally works, so my description may seem naive and wrong.)



---

archive/issue_comments_289887.json:
```json
{
    "body": "<a id='comment:16'></a>Wasn't me, but if there were any changes to the genus function then hopefully they fix #15477",
    "created_at": "2014-10-23T10:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289887",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>Wasn't me, but if there were any changes to the genus function then hopefully they fix #15477



---

archive/issue_comments_289888.json:
```json
{
    "body": "<a id='comment:17'></a>When the `normal` lib is loaded, `currRingHdl` is set back to zero.\nHere is when:\n\n```\n#0  rSetHdl (h=0x0) at ipshell.cc:4592\n#1  0x00003fffa487ce04 in iiPStart (pn=<optimized out>, v=<optimized out>) at iplib.cc:456\n#2  0x00003fffa487d334 in iiMake_proc (pn=0x3fffa426dd10, pack=0x3fffa42584b8, sl=0x0) at iplib.cc:612\n#3  0x00003fffa487f65c in iiRunInit (p=<error reading variable: value has been optimized out>) at iplib.cc:889\n#4  iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa280 \"/home/jpflori/sage.git/local/share/singular/modstd.lib\", newlib=0x3fffa4270280 \"modstd.lib\", \n    pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:941\n#5  0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa4270280 \"modstd.lib\", autoexport=<optimized out>, tellerror=<optimized out>, force=<optimized out>)\n    at iplib.cc:842\n#6  0x00003fffa487f3f8 in iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa4a0 \"/home/jpflori/sage.git/local/share/singular/locnormal.lib\", newlib=\n    0x3fffa42701a0 \"locnormal.lib\", pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:950\n#7  0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa42701a0 \"locnormal.lib\", autoexport=<optimized out>, tellerror=<optimized out>, \n    force=<optimized out>) at iplib.cc:842\n#8  0x00003fffa487f3f8 in iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa6c0 \"/home/jpflori/sage.git/local/share/singular/reesclos.lib\", newlib=\n    0x3fffa4254b20 \"reesclos.lib\", pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:950\n#9  0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa4254b20 \"reesclos.lib\", autoexport=<optimized out>, tellerror=<optimized out>, \n    force=<optimized out>) at iplib.cc:842\n#10 0x00003fffa487f3f8 in iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa8e0 \"/home/jpflori/sage.git/local/share/singular/normal.lib\", newlib=\n    0x3fffa4254a60 \"normal.lib\", pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:950\n#11 0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa4254a60 \"normal.lib\", autoexport=<optimized out>, tellerror=<optimized out>, force=<optimized out>)\n    at iplib.cc:842\n#12 0x00003fffa4082cd8 in __pyx_pf_4sage_4libs_8singular_8function_10lib (__pyx_self=<optimized out>, __pyx_v_name='normal.lib')\n    at build/cythonized/sage/libs/singular/function.cpp:16752\n#13 __pyx_pw_4sage_4libs_8singular_8function_11lib (__pyx_self=<optimized out>, __pyx_v_name='normal.lib')\n    at build/cythonized/sage/libs/singular/function.cpp:16623\n#14 0x00003fffb7ecbfb4 in call_function (oparg=<optimized out>, pp_stack=0x3fffffffab28) at Python/ceval.c:4021\n#15 PyEval_EvalFrameEx (f=\n    Frame 0x3fff9e5b0b60, for file /home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/libs/singular/function_factory.py, line 44, in __getattr__ (self=<type unknown at remote 0x3fffa40dee90>, name='normal'), throwflag=<optimized out>) at Python/ceval.c:2679\n#16 0x00003fffb7ecd7e0 in PyEval_EvalCodeEx (co=<code at remote 0x3fffa40f9430>, globals=<optimized out>, locals=<optimized out>, \n    args=<optimized out>, argcount=<optimized out>, kws=<optimized out>, kwcount=<optimized out>, defs=0x0, defcount=0, closure=0x0)\n    at Python/ceval.c:3265\n#17 0x00003fffb7e1d5d4 in function_call (func=<function at remote 0x3fffa40fc2a8>, arg=(<type unknown at remote 0x3fffa40dee90>, 'normal__lib'), kw=\n    0x0) at Objects/funcobject.c:526\n```",
    "created_at": "2014-10-23T14:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289888",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:17'></a>When the `normal` lib is loaded, `currRingHdl` is set back to zero.
Here is when:

```
#0  rSetHdl (h=0x0) at ipshell.cc:4592
#1  0x00003fffa487ce04 in iiPStart (pn=<optimized out>, v=<optimized out>) at iplib.cc:456
#2  0x00003fffa487d334 in iiMake_proc (pn=0x3fffa426dd10, pack=0x3fffa42584b8, sl=0x0) at iplib.cc:612
#3  0x00003fffa487f65c in iiRunInit (p=<error reading variable: value has been optimized out>) at iplib.cc:889
#4  iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa280 "/home/jpflori/sage.git/local/share/singular/modstd.lib", newlib=0x3fffa4270280 "modstd.lib", 
    pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:941
#5  0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa4270280 "modstd.lib", autoexport=<optimized out>, tellerror=<optimized out>, force=<optimized out>)
    at iplib.cc:842
#6  0x00003fffa487f3f8 in iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa4a0 "/home/jpflori/sage.git/local/share/singular/locnormal.lib", newlib=
    0x3fffa42701a0 "locnormal.lib", pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:950
#7  0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa42701a0 "locnormal.lib", autoexport=<optimized out>, tellerror=<optimized out>, 
    force=<optimized out>) at iplib.cc:842
#8  0x00003fffa487f3f8 in iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa6c0 "/home/jpflori/sage.git/local/share/singular/reesclos.lib", newlib=
    0x3fffa4254b20 "reesclos.lib", pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:950
#9  0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa4254b20 "reesclos.lib", autoexport=<optimized out>, tellerror=<optimized out>, 
    force=<optimized out>) at iplib.cc:842
#10 0x00003fffa487f3f8 in iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffa8e0 "/home/jpflori/sage.git/local/share/singular/normal.lib", newlib=
    0x3fffa4254a60 "normal.lib", pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:950
#11 0x00003fffa487f840 in iiLibCmd (newlib=0x3fffa4254a60 "normal.lib", autoexport=<optimized out>, tellerror=<optimized out>, force=<optimized out>)
    at iplib.cc:842
#12 0x00003fffa4082cd8 in __pyx_pf_4sage_4libs_8singular_8function_10lib (__pyx_self=<optimized out>, __pyx_v_name='normal.lib')
    at build/cythonized/sage/libs/singular/function.cpp:16752
#13 __pyx_pw_4sage_4libs_8singular_8function_11lib (__pyx_self=<optimized out>, __pyx_v_name='normal.lib')
    at build/cythonized/sage/libs/singular/function.cpp:16623
#14 0x00003fffb7ecbfb4 in call_function (oparg=<optimized out>, pp_stack=0x3fffffffab28) at Python/ceval.c:4021
#15 PyEval_EvalFrameEx (f=
    Frame 0x3fff9e5b0b60, for file /home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/libs/singular/function_factory.py, line 44, in __getattr__ (self=<type unknown at remote 0x3fffa40dee90>, name='normal'), throwflag=<optimized out>) at Python/ceval.c:2679
#16 0x00003fffb7ecd7e0 in PyEval_EvalCodeEx (co=<code at remote 0x3fffa40f9430>, globals=<optimized out>, locals=<optimized out>, 
    args=<optimized out>, argcount=<optimized out>, kws=<optimized out>, kwcount=<optimized out>, defs=0x0, defcount=0, closure=0x0)
    at Python/ceval.c:3265
#17 0x00003fffb7e1d5d4 in function_call (func=<function at remote 0x3fffa40fc2a8>, arg=(<type unknown at remote 0x3fffa40dee90>, 'normal__lib'), kw=
    0x0) at Objects/funcobject.c:526
```



---

archive/issue_comments_289889.json:
```json
{
    "body": "<a id='comment:18'></a>And this is the new piece of code in 3-1-7 in iplib.cc around line 453:\n\n```\n+    if ((currRing!=NULL) &&\n+      ((currRingHdl==NULL)||(IDRING(currRingHdl)!=currRing)\n+       ||(IDLEV(currRingHdl)>=myynest-1)))\n+    {\n+      rSetHdl(rFindHdl(currRing,NULL));\n+      iiLocalRing[myynest-1]=NULL;\n+    }\n```\nIn fact the whole block (not only the one included above) used to be around line 556 in 3-1-6.",
    "created_at": "2014-10-23T14:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289889",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:18'></a>And this is the new piece of code in 3-1-7 in iplib.cc around line 453:

```
+    if ((currRing!=NULL) &&
+      ((currRingHdl==NULL)||(IDRING(currRingHdl)!=currRing)
+       ||(IDLEV(currRingHdl)>=myynest-1)))
+    {
+      rSetHdl(rFindHdl(currRing,NULL));
+      iiLocalRing[myynest-1]=NULL;
+    }
```
In fact the whole block (not only the one included above) used to be around line 556 in 3-1-6.



---

archive/issue_comments_289890.json:
```json
{
    "body": "<a id='comment:19'></a>In that very piece of code, Singular 4-0-1 and 3-1-7 look similar, so we might face this issue even if going for 4-0-1 directly...",
    "created_at": "2014-10-23T14:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289890",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>In that very piece of code, Singular 4-0-1 and 3-1-7 look similar, so we might face this issue even if going for 4-0-1 directly...



---

archive/issue_comments_289891.json:
```json
{
    "body": "<a id='comment:20'></a>Groumpf, I don't remmeber if anyone from the Singualr team has an account here on trac...",
    "created_at": "2014-10-23T15:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289891",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:20'></a>Groumpf, I don't remmeber if anyone from the Singualr team has an account here on trac...



---

archive/issue_comments_289892.json:
```json
{
    "body": "<a id='comment:21'></a>> Groumpf, I don't remmeber if anyone from the Singualr team has an account here on trac...\n\n\nI do, you are welcome to ask questions if you have any.\n\n\nJakob",
    "created_at": "2014-10-24T16:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289892",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:21'></a>> Groumpf, I don't remmeber if anyone from the Singualr team has an account here on trac...


I do, you are welcome to ask questions if you have any.


Jakob



---

archive/issue_comments_289893.json:
```json
{
    "body": "<a id='comment:22'></a>The following segfaults with Singular 3-1-7.\n* 3-1-6:\n\n```\nsage: from sage.libs.singular import ff\nsage: ff.modstd__lib\n<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e6c5450>\nsage: ff.modstd__lib\n<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e6c5590>\nsage: ff.modstd__lib\n<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e6c5690>\n```\n* 3-1-7:\n\n```\nsage: from sage.libs.singular import ff\nsage: ff.modstd__lib\n<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e695450>\nsage: ff.modstd__lib\n// ** redefining root my_awesome_sage_ring **\nProgram received signal SIGSEGV, Segmentation fault.\nnSetChar (r=0x3fffa42365f0) at numbers.cc:205\n```\nwith backtrace:\n\n```\n#0  nSetChar (r=0x3fffa42365f0) at numbers.cc:205\n#1  0x00003fffa49aef34 in rChangeCurrRing (r=<error reading variable: value has been optimized out>) at ring.cc:112\n#2  0x00003fffa4864b54 in killlocals (v=<optimized out>) at ipshell.cc:386\n#3  0x00003fffa484ce24 in iiPStart (pn=<optimized out>, v=<optimized out>) at iplib.cc:499\n#4  0x00003fffa484d334 in iiMake_proc (pn=0x3fffa424fc80, pack=0x3fffa4228260, sl=0x0) at iplib.cc:612\n#5  0x00003fffa484f65c in iiRunInit (p=<error reading variable: value has been optimized out>) at iplib.cc:889\n#6  iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffb980 \"/home/jpflori/sage.git/local/share/singular/modstd.lib\", newlib=0x3fffa42521c0 \"modstd.lib\", \n    pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:941\n#7  0x00003fffa484f840 in iiLibCmd (newlib=0x3fffa42521c0 \"modstd.lib\", autoexport=<optimized out>, tellerror=<optimized out>, force=<optimized out>)\n    at iplib.cc:842\n#8  0x00003fffa4052cd8 in __pyx_pf_4sage_4libs_8singular_8function_10lib (__pyx_self=<optimized out>, __pyx_v_name='modstd.lib')\n    at build/cythonized/sage/libs/singular/function.cpp:16752\n...\n```",
    "created_at": "2014-10-24T20:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289893",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>The following segfaults with Singular 3-1-7.
* 3-1-6:

```
sage: from sage.libs.singular import ff
sage: ff.modstd__lib
<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e6c5450>
sage: ff.modstd__lib
<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e6c5590>
sage: ff.modstd__lib
<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e6c5690>
```
* 3-1-7:

```
sage: from sage.libs.singular import ff
sage: ff.modstd__lib
<sage.libs.singular.function_factory.SingularFunctionFactory object at 0x3fff9e695450>
sage: ff.modstd__lib
// ** redefining root my_awesome_sage_ring **
Program received signal SIGSEGV, Segmentation fault.
nSetChar (r=0x3fffa42365f0) at numbers.cc:205
```
with backtrace:

```
#0  nSetChar (r=0x3fffa42365f0) at numbers.cc:205
#1  0x00003fffa49aef34 in rChangeCurrRing (r=<error reading variable: value has been optimized out>) at ring.cc:112
#2  0x00003fffa4864b54 in killlocals (v=<optimized out>) at ipshell.cc:386
#3  0x00003fffa484ce24 in iiPStart (pn=<optimized out>, v=<optimized out>) at iplib.cc:499
#4  0x00003fffa484d334 in iiMake_proc (pn=0x3fffa424fc80, pack=0x3fffa4228260, sl=0x0) at iplib.cc:612
#5  0x00003fffa484f65c in iiRunInit (p=<error reading variable: value has been optimized out>) at iplib.cc:889
#6  iiLoadLIB (fp=0x0, libnamebuf=0x3fffffffb980 "/home/jpflori/sage.git/local/share/singular/modstd.lib", newlib=0x3fffa42521c0 "modstd.lib", 
    pl=<optimized out>, autoexport=<optimized out>, tellerror=<optimized out>) at iplib.cc:941
#7  0x00003fffa484f840 in iiLibCmd (newlib=0x3fffa42521c0 "modstd.lib", autoexport=<optimized out>, tellerror=<optimized out>, force=<optimized out>)
    at iplib.cc:842
#8  0x00003fffa4052cd8 in __pyx_pf_4sage_4libs_8singular_8function_10lib (__pyx_self=<optimized out>, __pyx_v_name='modstd.lib')
    at build/cythonized/sage/libs/singular/function.cpp:16752
...
```



---

archive/issue_comments_289894.json:
```json
{
    "body": "<a id='comment:23'></a>No issue using `./sage -singular`:\n\n```\n> option(loadLib);\n> LIB \"modstd.lib\";\n// ** loaded /home/jpflori/sage.git/local/share/singular/modstd.lib (3-1-7-0,May_2014)\n// ** loaded /home/jpflori/sage.git/local/share/singular/parallel.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/tasks.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/resources.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/modular.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/poly.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/ring.lib (4.0.0.0,Jun_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/primdec.lib (4.0.0.0,Jun_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/absfact.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/triang.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/matrix.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/nctools.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/random.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/elim.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/inout.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/general.lib (3-1-7-0,Sep_2013)\n> LIB \"modstd.lib\";\n// ** redefining modStd **\n...\n```",
    "created_at": "2014-10-24T20:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289894",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:23'></a>No issue using `./sage -singular`:

```
> option(loadLib);
> LIB "modstd.lib";
// ** loaded /home/jpflori/sage.git/local/share/singular/modstd.lib (3-1-7-0,May_2014)
// ** loaded /home/jpflori/sage.git/local/share/singular/parallel.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/tasks.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/resources.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/modular.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/poly.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/ring.lib (4.0.0.0,Jun_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/primdec.lib (4.0.0.0,Jun_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/absfact.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/triang.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/matrix.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/nctools.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/random.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/elim.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/inout.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/general.lib (3-1-7-0,Sep_2013)
> LIB "modstd.lib";
// ** redefining modStd **
...
```



---

archive/issue_comments_289895.json:
```json
{
    "body": "<a id='comment:25'></a>This looks related...\nhttp://trac.sagemath.org/ticket/13447#comment:63",
    "created_at": "2014-10-27T14:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289895",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:25'></a>This looks related...
http://trac.sagemath.org/ticket/13447#comment:63



---

archive/issue_comments_289896.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-27T15:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289897.json:
```json
{
    "body": "Changing commit from \"cdedfc61ca715961acca343dea87e7e5c1163063\" to \"32f3be69d6a195e73e767c179d1c855886faf667\"",
    "created_at": "2014-10-27T15:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cdedfc61ca715961acca343dea87e7e5c1163063" to "32f3be69d6a195e73e767c179d1c855886faf667"



---

archive/issue_comments_289898.json:
```json
{
    "body": "<a id='comment:27'></a>Fix extracted from the discussion at #13447.",
    "created_at": "2014-10-27T15:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289898",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:27'></a>Fix extracted from the discussion at #13447.



---

archive/issue_comments_289899.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-27T15:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289899",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289900.json:
```json
{
    "body": "Changing commit from \"32f3be69d6a195e73e767c179d1c855886faf667\" to \"e2d29209a8ca5c03ad8830596cc69578491df047\"",
    "created_at": "2014-10-27T15:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "32f3be69d6a195e73e767c179d1c855886faf667" to "e2d29209a8ca5c03ad8830596cc69578491df047"



---

archive/issue_comments_289901.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-27T15:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289902.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-27T15:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289902",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289903.json:
```json
{
    "body": "<a id='comment:29'></a>There is still one doctest to fix.",
    "created_at": "2014-10-27T15:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289903",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:29'></a>There is still one doctest to fix.



---

archive/issue_comments_289904.json:
```json
{
    "body": "Changing commit from \"e2d29209a8ca5c03ad8830596cc69578491df047\" to \"cde293057415ab28388bbdd43d813c5a21182392\"",
    "created_at": "2014-10-27T15:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e2d29209a8ca5c03ad8830596cc69578491df047" to "cde293057415ab28388bbdd43d813c5a21182392"



---

archive/issue_comments_289905.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-27T15:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289906.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-27T15:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289906",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289907.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:14 jpflori]:\n> I don't really remember who committed the \"my_awesome_ring\" code.\n\nIt looks like it was there from the start: #6628 introduced this in 2009. It also looks like you've resolved your issue with it already.",
    "created_at": "2014-11-03T20:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289907",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:32'></a>Replying to [comment:14 jpflori]:
> I don't really remember who committed the "my_awesome_ring" code.

It looks like it was there from the start: #6628 introduced this in 2009. It also looks like you've resolved your issue with it already.



---

archive/issue_comments_289908.json:
```json
{
    "body": "<a id='comment:33'></a>I hope so, I just picked up a minimal change from #13447.",
    "created_at": "2014-11-03T20:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289908",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:33'></a>I hope so, I just picked up a minimal change from #13447.



---

archive/issue_comments_289909.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-17T12:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289909",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289910.json:
```json
{
    "body": "<a id='comment:34'></a>lgtm",
    "created_at": "2014-11-17T12:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289910",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>lgtm



---

archive/issue_comments_289911.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2014-11-17T12:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289911",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_289912.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-17T17:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289912",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_289913.json:
```json
{
    "body": "<a id='comment:35'></a>A build with `SAGE_DEBUG=yes` fails in:\n\n```\nsage -t --long src/sage/schemes/plane_curves/curve.py\n**********************************************************************\nFile \"src/sage/schemes/plane_curves/curve.py\", line 122, in sage.schemes.plane_curves.curve.Curve_generic.geometric_genus\nFailed example:\n    C.geometric_genus()\nExpected:\n          3\nGot:\n    <BLANKLINE>\n    // ***dError: T[3] pLength error: has 1, specified to have 2 occured at: \n    <BLANKLINE>\n    // ***dError: T[3] pLength error: has 1, specified to have 2 occured at: \n    3\n```\nthere are more failures, always in geometric genus. If somebody can extract a singular-only testcase from that and report it on libsingular-devel then Hans is usually quick to patch that...",
    "created_at": "2014-11-17T17:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289913",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>A build with `SAGE_DEBUG=yes` fails in:

```
sage -t --long src/sage/schemes/plane_curves/curve.py
**********************************************************************
File "src/sage/schemes/plane_curves/curve.py", line 122, in sage.schemes.plane_curves.curve.Curve_generic.geometric_genus
Failed example:
    C.geometric_genus()
Expected:
          3
Got:
    <BLANKLINE>
    // ***dError: T[3] pLength error: has 1, specified to have 2 occured at: 
    <BLANKLINE>
    // ***dError: T[3] pLength error: has 1, specified to have 2 occured at: 
    3
```
there are more failures, always in geometric genus. If somebody can extract a singular-only testcase from that and report it on libsingular-devel then Hans is usually quick to patch that...



---

archive/issue_comments_289914.json:
```json
{
    "body": "<a id='comment:36'></a>Log: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2021%20x86_64%29%20incremental/builds/43/steps/shell_4/logs/stdio",
    "created_at": "2014-11-17T17:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289914",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>Log: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2021%20x86_64%29%20incremental/builds/43/steps/shell_4/logs/stdio



---

archive/issue_comments_289915.json:
```json
{
    "body": "<a id='comment:37'></a>Ok it seems to be upstream and not because of our broken reference handling.\nI'm just discovering singular syntax and might be wrong, but I get the following:\n\n```\n$ ./sage -singular\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 3-1-7\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Aug 2013\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> LIB \"normal.lib\";\n// ** loaded /home/jpflori/sage.git/local/share/singular/normal.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/algebra.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/matrix.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/nctools.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/random.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/reesclos.lib (3-1-7-1,Jan_2014)\n// ** loaded /home/jpflori/sage.git/local/share/singular/locnormal.lib (3-1-7-1,Jan_2014)\n// ** loaded /home/jpflori/sage.git/local/share/singular/modstd.lib (3-1-7-0,May_2014)\n// ** loaded /home/jpflori/sage.git/local/share/singular/parallel.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/tasks.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/resources.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/modular.lib (3-1-7-0,Dec_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/hnoether.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/primitiv.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/ring.lib (4.0.0.0,Jun_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/inout.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/presolve.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/elim.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/primdec.lib (4.0.0.0,Jun_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/absfact.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/triang.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/sing.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/poly.lib (3-1-7-0,Sep_2013)\n// ** loaded /home/jpflori/sage.git/local/share/singular/general.lib (3-1-7-0,Sep_2013)\n> ring R=5,(x,y,z),dp;\n// ** Could not open dynamic library: /home/jpflori/sage.git/local/bin/p_Procs_FieldIndep.sog\n// ** Error message from system: /home/jpflori/sage.git/local/bin/p_Procs_FieldIndep.sog: cannot open shared object file: No such file or directory\n// ** Singular will work properly, but much slower.\n// ** See the INSTALL section in the Singular manual for details.\n> ideal I = x^10 + y^7*z^3 + z^10;\n> genus(I);\n\n// ***dError: T[3] pLength error: has 1, specified to have 2 occured at: \n\n// ***dError: T[3] pLength error: has 1, specified to have 2 occured at: \n3\n```\nAlso note the Singular's warning, so it seems our way of launching singular might not be the best.",
    "created_at": "2014-11-18T11:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289915",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:37'></a>Ok it seems to be upstream and not because of our broken reference handling.
I'm just discovering singular syntax and might be wrong, but I get the following:

```
$ ./sage -singular
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 3-1-7
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Aug 2013
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> LIB "normal.lib";
// ** loaded /home/jpflori/sage.git/local/share/singular/normal.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/algebra.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/matrix.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/nctools.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/random.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/reesclos.lib (3-1-7-1,Jan_2014)
// ** loaded /home/jpflori/sage.git/local/share/singular/locnormal.lib (3-1-7-1,Jan_2014)
// ** loaded /home/jpflori/sage.git/local/share/singular/modstd.lib (3-1-7-0,May_2014)
// ** loaded /home/jpflori/sage.git/local/share/singular/parallel.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/tasks.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/resources.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/modular.lib (3-1-7-0,Dec_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/hnoether.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/primitiv.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/ring.lib (4.0.0.0,Jun_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/inout.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/presolve.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/elim.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/primdec.lib (4.0.0.0,Jun_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/absfact.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/triang.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/sing.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/poly.lib (3-1-7-0,Sep_2013)
// ** loaded /home/jpflori/sage.git/local/share/singular/general.lib (3-1-7-0,Sep_2013)
> ring R=5,(x,y,z),dp;
// ** Could not open dynamic library: /home/jpflori/sage.git/local/bin/p_Procs_FieldIndep.sog
// ** Error message from system: /home/jpflori/sage.git/local/bin/p_Procs_FieldIndep.sog: cannot open shared object file: No such file or directory
// ** Singular will work properly, but much slower.
// ** See the INSTALL section in the Singular manual for details.
> ideal I = x^10 + y^7*z^3 + z^10;
> genus(I);

// ***dError: T[3] pLength error: has 1, specified to have 2 occured at: 

// ***dError: T[3] pLength error: has 1, specified to have 2 occured at: 
3
```
Also note the Singular's warning, so it seems our way of launching singular might not be the best.



---

archive/issue_comments_289916.json:
```json
{
    "body": "<a id='comment:38'></a>Looks good, can you post to libsingular-devel?",
    "created_at": "2014-11-18T11:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289916",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>Looks good, can you post to libsingular-devel?



---

archive/issue_comments_289917.json:
```json
{
    "body": "<a id='comment:39'></a>I'm not subscribed there and I just applied.\nIn the meantime I posted on the forum on their homepage:\n* http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2470\n(And I don't have access to the bugtracker because of the unusual port it uses.)",
    "created_at": "2014-11-18T15:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289917",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:39'></a>I'm not subscribed there and I just applied.
In the meantime I posted on the forum on their homepage:
* http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2470
(And I don't have access to the bugtracker because of the unusual port it uses.)



---

archive/issue_comments_289918.json:
```json
{
    "body": "<a id='comment:40'></a>Great a fix was posted upstream and a 3-1-7p1 version released.\nI'm in the process of testing it.",
    "created_at": "2014-11-19T15:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289918",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:40'></a>Great a fix was posted upstream and a 3-1-7p1 version released.
I'm in the process of testing it.



---

archive/issue_comments_289919.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-19T16:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289919",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289920.json:
```json
{
    "body": "Changing commit from \"cde293057415ab28388bbdd43d813c5a21182392\" to \"ac60a769503ec0ad4a227ad9cec0aa7cebd10bb6\"",
    "created_at": "2014-11-19T16:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289920",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cde293057415ab28388bbdd43d813c5a21182392" to "ac60a769503ec0ad4a227ad9cec0aa7cebd10bb6"



---

archive/issue_comments_289921.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Singular 3-1-7 repackaged (see spkg-src):\n+Singular 3-1-7p1 repackaged (see spkg-src):\n * http://boxen.math.washington.edu/home/jpflori/upstream/singular-3.1.7.tar.bz2\n \n Author: Jean-Pierre Flori\n``````\n",
    "created_at": "2014-11-19T16:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289921",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Singular 3-1-7 repackaged (see spkg-src):
+Singular 3-1-7p1 repackaged (see spkg-src):
 * http://boxen.math.washington.edu/home/jpflori/upstream/singular-3.1.7.tar.bz2
 
 Author: Jean-Pierre Flori
``````




---

archive/issue_comments_289922.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-19T16:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289922",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289923.json:
```json
{
    "body": "Changing commit from \"ac60a769503ec0ad4a227ad9cec0aa7cebd10bb6\" to \"9b3b9333ca798420edcfd07f03e2ace0991d1431\"",
    "created_at": "2014-11-19T16:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289923",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ac60a769503ec0ad4a227ad9cec0aa7cebd10bb6" to "9b3b9333ca798420edcfd07f03e2ace0991d1431"



---

archive/issue_comments_289924.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-19T16:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289924",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289925.json:
```json
{
    "body": "<a id='comment:44'></a>Some additional patches were integrated into the 3-1-7p1 release.\n\nHopefully the p1 part of the upstream version number and the p0 from our patch level won't clash.",
    "created_at": "2014-11-19T16:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289925",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:44'></a>Some additional patches were integrated into the 3-1-7p1 release.

Hopefully the p1 part of the upstream version number and the p0 from our patch level won't clash.



---

archive/issue_comments_289926.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n-\n+Singular 3-1-7p1 repackaged (see spkg-src):\n+* http://boxen.math.washington.edu/home/jpflori/upstream/singular-3.1.7p1.tar.bz2\n \n Author: Jean-Pierre Flori\n \n``````\n",
    "created_at": "2014-11-19T16:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289926",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
-
+Singular 3-1-7p1 repackaged (see spkg-src):
+* http://boxen.math.washington.edu/home/jpflori/upstream/singular-3.1.7p1.tar.bz2
 
 Author: Jean-Pierre Flori
 
``````




---

archive/issue_comments_289927.json:
```json
{
    "body": "<a id='comment:46'></a>lgtm",
    "created_at": "2014-11-19T19:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289927",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:46'></a>lgtm



---

archive/issue_comments_289928.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-19T19:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289928",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289929.json:
```json
{
    "body": "<a id='comment:47'></a>I got two failing doctests in `sage/interfaces/test.py` and indeed it seems I can get Singular to crash by issuing:\n\"\"\"\nsage: 2*singular('2')\nSingular crashed -- automatically restarting.\n\"\"\"\nbut then the same command is ok.\nAnd just \n\"\"\"\nsage: singular('2')\n2\n\"\"\"\nis ok.\n\nSo maybe coercion is involved here...\nI suggest to deal with it in a separate ticket as it only involves debug builds.",
    "created_at": "2014-11-20T11:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289929",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:47'></a>I got two failing doctests in `sage/interfaces/test.py` and indeed it seems I can get Singular to crash by issuing:
"""
sage: 2*singular('2')
Singular crashed -- automatically restarting.
"""
but then the same command is ok.
And just 
"""
sage: singular('2')
2
"""
is ok.

So maybe coercion is involved here...
I suggest to deal with it in a separate ticket as it only involves debug builds.



---

archive/issue_comments_289930.json:
```json
{
    "body": "<a id='comment:48'></a>I also get them, but only on the buildbot with SAGE_DEBUG=yes\n\n```\nsage -t --long src/sage/interfaces/tests.py\n**********************************************************************\nFile \"src/sage/interfaces/tests.py\", line 20, in sage.interfaces.tests\nFailed example:\n    a = 2 * singular('2'); a\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 851, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.tests[7]>\", line 1, in <module>\n        a = Integer(2) * singular('2'); a\n      File \"sage/structure/element.pyx\", line 1763, in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:16813)\n      File \"sage/structure/coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7925)\n      File \"sage/structure/coerce.pyx\", line 793, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7872)\n      File \"sage/structure/element.pyx\", line 1758, in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:16745)\n      File \"sage/structure/element.pyx\", line 1765, in sage.structure.element.RingElement._mul_ (build/cythonized/sage/structure/element.c:16890)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 1121, in _mul_\n        return self._operation('*', right)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 1078, in _operation\n        raise TypeError(msg)\n    TypeError: Singular error:\n       ? `sage0` is not defined\n       ? error occurred in or before STDIN line 17: `def sage23=sage22 * sage0;`\n**********************************************************************\nFile \"src/sage/interfaces/tests.py\", line 22, in sage.interfaces.tests\nFailed example:\n    parent(a)\nExpected:\n    Singular\nGot:\n    Maxima\n**********************************************************************\n```",
    "created_at": "2014-11-20T11:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289930",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:48'></a>I also get them, but only on the buildbot with SAGE_DEBUG=yes

```
sage -t --long src/sage/interfaces/tests.py
**********************************************************************
File "src/sage/interfaces/tests.py", line 20, in sage.interfaces.tests
Failed example:
    a = 2 * singular('2'); a
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.tests[7]>", line 1, in <module>
        a = Integer(2) * singular('2'); a
      File "sage/structure/element.pyx", line 1763, in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:16813)
      File "sage/structure/coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7925)
      File "sage/structure/coerce.pyx", line 793, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7872)
      File "sage/structure/element.pyx", line 1758, in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:16745)
      File "sage/structure/element.pyx", line 1765, in sage.structure.element.RingElement._mul_ (build/cythonized/sage/structure/element.c:16890)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 1121, in _mul_
        return self._operation('*', right)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 1078, in _operation
        raise TypeError(msg)
    TypeError: Singular error:
       ? `sage0` is not defined
       ? error occurred in or before STDIN line 17: `def sage23=sage22 * sage0;`
**********************************************************************
File "src/sage/interfaces/tests.py", line 22, in sage.interfaces.tests
Failed example:
    parent(a)
Expected:
    Singular
Got:
    Maxima
**********************************************************************
```



---

archive/issue_comments_289931.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-20T12:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289931",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_289932.json:
```json
{
    "body": "<a id='comment:49'></a>Can you try to fix this? If we merge it then that makes one of our buildbots basically useless...",
    "created_at": "2014-11-20T12:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289932",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:49'></a>Can you try to fix this? If we merge it then that makes one of our buildbots basically useless...



---

archive/issue_comments_289933.json:
```json
{
    "body": "<a id='comment:50'></a>I'll give it a shot, but as Singular is a standalone process I need some dark magic to attach gdb to it and debug it.",
    "created_at": "2014-11-20T13:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289933",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:50'></a>I'll give it a shot, but as Singular is a standalone process I need some dark magic to attach gdb to it and debug it.



---

archive/issue_comments_289934.json:
```json
{
    "body": "<a id='comment:51'></a>Backtrace:\n\n```\n(gdb) bt\n#0  0x00000000102e98a8 in p_Init (r=0x0) at ../kernel/pInline1.h:108\n#1  0x00000000102edd6c in p_One (r=0x0) at p_polys.cc:1170\n#2  0x00000000100ba578 in jjE (res=0x3ffff92fe068, v=0x3ffff92fb388) at iparith.cc:4056\n#3  0x00000000100cd7b0 in iiExprArith1 (res=0x3ffff92fe068, a=0x3ffff92fb388, op=291) at iparith.cc:7992\n#4  0x000000001011d390 in yyparse () at grammar.y:626\n#5  0x00000000100a619c in main (argc=4, argv=0x3ffff92ff628) at tesths.cc:245\n```",
    "created_at": "2014-11-20T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289934",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:51'></a>Backtrace:

```
(gdb) bt
#0  0x00000000102e98a8 in p_Init (r=0x0) at ../kernel/pInline1.h:108
#1  0x00000000102edd6c in p_One (r=0x0) at p_polys.cc:1170
#2  0x00000000100ba578 in jjE (res=0x3ffff92fe068, v=0x3ffff92fb388) at iparith.cc:4056
#3  0x00000000100cd7b0 in iiExprArith1 (res=0x3ffff92fe068, a=0x3ffff92fb388, op=291) at iparith.cc:7992
#4  0x000000001011d390 in yyparse () at grammar.y:626
#5  0x00000000100a619c in main (argc=4, argv=0x3ffff92ff628) at tesths.cc:245
```



---

archive/issue_comments_289935.json:
```json
{
    "body": "<a id='comment:52'></a>Run with `SAGE_PEXPECT_LOG=yes`, this will log to `$DOT_SAGE/pexpect_logs`",
    "created_at": "2014-11-20T15:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289935",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:52'></a>Run with `SAGE_PEXPECT_LOG=yes`, this will log to `$DOT_SAGE/pexpect_logs`



---

archive/issue_comments_289936.json:
```json
{
    "body": "<a id='comment:53'></a>Thanks a lot for the pointer.\nHere is what Singular is fed with:\n\n```\n...\n> def sage1=\"redTail\";\n> def sage2=option(sage1);\n// ** right side is not a datum, assignment ignored^M\n> if(defined(sage1)){kill sage1;};if(defined(sage2)){kill sage2;};def sage3=\"redThrough\";\n> def sage4=option(sage3);\n// ** right side is not a datum, assignment ignored^M\n> if(defined(sage3)){kill sage3;};if(defined(sage4)){kill sage4;};def sage5=\"intStrategy\";\n> def sage6=option(sage5);\n// ** right side is not a datum, assignment ignored^M\n> option(get);\n100663424,10321^M\n> if(defined(sage5)){kill sage5;};if(defined(sage6)){kill sage6;};intvec sage7=100663424,10321;\n> def sage0=2;\n> print(sage0);\n2^M\n> def sage8=2;\n> def sage9=0;\n> def sage10=gen(sage9);\nSingular : signal 11 (v: 3170):^M\ncurrent line:>>def sage10=gen(sage9);<<^M\nSegment fault/Bus error occurred (r:1416496567)^M\nplease inform the authors^M\n^M\n// ***dError: Caught Signal 11 occured at: ^M\nquit\n```\nAnd on relaunch:\n\n```\n...\n> def sage11=\"redTail\";\n> def sage12=option(sage11);\n// ** right side is not a datum, assignment ignored^M\n> if(defined(sage11)){kill sage11;};if(defined(sage12)){kill sage12;};def sage13=\"redThrough\";\n> def sage14=option(sage13);\n// ** right side is not a datum, assignment ignored^M\n> if(defined(sage13)){kill sage13;};if(defined(sage14)){kill sage14;};def sage15=\"intStrategy\";\n> def sage16=option(sage15);\n// ** right side is not a datum, assignment ignored^M\n> option(get);\n100663424,10321^M\n> if(defined(sage15)){kill sage15;};if(defined(sage16)){kill sage16;};intvec sage17=100663424,10321;\n> def sage10=gen(sage9);\n   ? `sage9` is not defined^M\n   ? error occurred in or before STDIN line 10: `def sage10=gen(sage9);`^M\n> def sage18=gen();\n   ? error occurred in or before STDIN line 11: `def sage18=gen();`^M\n   ? last reserved name was `gen`^M\n   skipping text from `;` error at token `)`^M\n> def sage19=_an_element_;\n   ? error occurred in or before STDIN line 12: `def sage19=_an_element_;`^M\n   ? last reserved name was `def`^M\n   skipping text from `;` error at token `$INVALID$`^M\n> def sage20=pi;\n   ? `pi` is undefined^M\n   ? error occurred in or before STDIN line 13: `def sage20=pi;`^M\n> def sage21=1.2;\n   ? no ring active^M\n   ? error occurred in or before STDIN line 14: `def sage21=1.2;`^M\n> def sage22=2;\n> def sage23=2;\n> def sage24=sage23 * sage8;\n   ? `sage8` is not defined^M\n   ? error occurred in or before STDIN line 17: `def sage24=sage23 * sage8;`^M\n> def sage25=2;\n> print(sage25);\n2^M\n> def sage26=2;\n> def sage27=2;\n> def sage28=sage27 * sage26;\n> print(sage28);\n4^M\n> quit\n```",
    "created_at": "2014-11-20T15:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289936",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:53'></a>Thanks a lot for the pointer.
Here is what Singular is fed with:

```
...
> def sage1="redTail";
> def sage2=option(sage1);
// ** right side is not a datum, assignment ignored^M
> if(defined(sage1)){kill sage1;};if(defined(sage2)){kill sage2;};def sage3="redThrough";
> def sage4=option(sage3);
// ** right side is not a datum, assignment ignored^M
> if(defined(sage3)){kill sage3;};if(defined(sage4)){kill sage4;};def sage5="intStrategy";
> def sage6=option(sage5);
// ** right side is not a datum, assignment ignored^M
> option(get);
100663424,10321^M
> if(defined(sage5)){kill sage5;};if(defined(sage6)){kill sage6;};intvec sage7=100663424,10321;
> def sage0=2;
> print(sage0);
2^M
> def sage8=2;
> def sage9=0;
> def sage10=gen(sage9);
Singular : signal 11 (v: 3170):^M
current line:>>def sage10=gen(sage9);<<^M
Segment fault/Bus error occurred (r:1416496567)^M
please inform the authors^M
^M
// ***dError: Caught Signal 11 occured at: ^M
quit
```
And on relaunch:

```
...
> def sage11="redTail";
> def sage12=option(sage11);
// ** right side is not a datum, assignment ignored^M
> if(defined(sage11)){kill sage11;};if(defined(sage12)){kill sage12;};def sage13="redThrough";
> def sage14=option(sage13);
// ** right side is not a datum, assignment ignored^M
> if(defined(sage13)){kill sage13;};if(defined(sage14)){kill sage14;};def sage15="intStrategy";
> def sage16=option(sage15);
// ** right side is not a datum, assignment ignored^M
> option(get);
100663424,10321^M
> if(defined(sage15)){kill sage15;};if(defined(sage16)){kill sage16;};intvec sage17=100663424,10321;
> def sage10=gen(sage9);
   ? `sage9` is not defined^M
   ? error occurred in or before STDIN line 10: `def sage10=gen(sage9);`^M
> def sage18=gen();
   ? error occurred in or before STDIN line 11: `def sage18=gen();`^M
   ? last reserved name was `gen`^M
   skipping text from `;` error at token `)`^M
> def sage19=_an_element_;
   ? error occurred in or before STDIN line 12: `def sage19=_an_element_;`^M
   ? last reserved name was `def`^M
   skipping text from `;` error at token `$INVALID$`^M
> def sage20=pi;
   ? `pi` is undefined^M
   ? error occurred in or before STDIN line 13: `def sage20=pi;`^M
> def sage21=1.2;
   ? no ring active^M
   ? error occurred in or before STDIN line 14: `def sage21=1.2;`^M
> def sage22=2;
> def sage23=2;
> def sage24=sage23 * sage8;
   ? `sage8` is not defined^M
   ? error occurred in or before STDIN line 17: `def sage24=sage23 * sage8;`^M
> def sage25=2;
> print(sage25);
2^M
> def sage26=2;
> def sage27=2;
> def sage28=sage27 * sage26;
> print(sage28);
4^M
> quit
```



---

archive/issue_comments_289937.json:
```json
{
    "body": "<a id='comment:54'></a>Ok, the issue is that `currRing` is `NULL` when `pOne` is called.",
    "created_at": "2014-11-20T16:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289937",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:54'></a>Ok, the issue is that `currRing` is `NULL` when `pOne` is called.



---

archive/issue_comments_289938.json:
```json
{
    "body": "<a id='comment:55'></a>It seems Singular 3-1-6 was more careful:\n\n```\n> def sage8=2;\n> def sage9=0;\n> def sage10=gen(sage9);\n   ? no ring active\n   ? error occurred in or before STDIN line 14: `def sage10=gen(sage9);`\n```",
    "created_at": "2014-11-20T16:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289938",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:55'></a>It seems Singular 3-1-6 was more careful:

```
> def sage8=2;
> def sage9=0;
> def sage10=gen(sage9);
   ? no ring active
   ? error occurred in or before STDIN line 14: `def sage10=gen(sage9);`
```



---

archive/issue_comments_289939.json:
```json
{
    "body": "<a id='comment:56'></a>Looks like an upstream bug, did you post it there?",
    "created_at": "2014-11-20T16:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289939",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'></a>Looks like an upstream bug, did you post it there?



---

archive/issue_comments_289940.json:
```json
{
    "body": "<a id='comment:57'></a>Not yet, still investigating, it seems the following change (here reversed) between 3-1-6 and 3-1-7 may be the issue:\n\n```\ndiff -druN latest.orig/Singular/iparith.cc latest.new/Singular/iparith.cc\n--- latest.orig/Singular/iparith.cc     2014-11-19 05:06:05.000000000 -0800\n+++ latest.new/Singular/iparith.cc      2014-11-20 08:30:25.068389635 -0800\n@@ -8477,7 +8477,6 @@\n     sArithBase.sCmds[i].name);\n     sArithBase.sCmds[i].alias=1;\n   }\n-  #if 0\n   if (currRingHdl==NULL)\n   {\n     #ifdef SIQ\n@@ -8493,7 +8492,6 @@\n     }\n     #endif\n   }\n-  #endif\n   if (!expected_parms)\n   {\n     switch (tok)\n```",
    "created_at": "2014-11-20T16:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289940",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:57'></a>Not yet, still investigating, it seems the following change (here reversed) between 3-1-6 and 3-1-7 may be the issue:

```
diff -druN latest.orig/Singular/iparith.cc latest.new/Singular/iparith.cc
--- latest.orig/Singular/iparith.cc     2014-11-19 05:06:05.000000000 -0800
+++ latest.new/Singular/iparith.cc      2014-11-20 08:30:25.068389635 -0800
@@ -8477,7 +8477,6 @@
     sArithBase.sCmds[i].name);
     sArithBase.sCmds[i].alias=1;
   }
-  #if 0
   if (currRingHdl==NULL)
   {
     #ifdef SIQ
@@ -8493,7 +8492,6 @@
     }
     #endif
   }
-  #endif
   if (!expected_parms)
   {
     switch (tok)
```



---

archive/issue_comments_289941.json:
```json
{
    "body": "<a id='comment:58'></a>For future ref the change was part of Singular commit:\n* https://github.com/Singular/Sources/commit/bceefc05ad02b92a823faffb7a4a247a0da12fc0",
    "created_at": "2014-11-20T16:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289941",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:58'></a>For future ref the change was part of Singular commit:
* https://github.com/Singular/Sources/commit/bceefc05ad02b92a823faffb7a4a247a0da12fc0



---

archive/issue_comments_289942.json:
```json
{
    "body": "<a id='comment:59'></a>Upstream report at:\n* http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2472\n\nAnd removing the \"#if 0\" makes the simple test pass.\nRunning again the testsuite now.",
    "created_at": "2014-11-20T16:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289942",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:59'></a>Upstream report at:
* http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2472

And removing the "#if 0" makes the simple test pass.
Running again the testsuite now.



---

archive/issue_comments_289943.json:
```json
{
    "body": "<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-20T16:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289943",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289944.json:
```json
{
    "body": "Changing commit from \"9b3b9333ca798420edcfd07f03e2ace0991d1431\" to \"0a5f6951bd84d6596c292e26e8ad9b8101ca51f8\"",
    "created_at": "2014-11-20T16:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9b3b9333ca798420edcfd07f03e2ace0991d1431" to "0a5f6951bd84d6596c292e26e8ad9b8101ca51f8"



---

archive/issue_comments_289945.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-20T17:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289945",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289946.json:
```json
{
    "body": "<a id='comment:61'></a>Things look fine for me except for timeouts which I already got before in debug mode, and two spurious errors I can not reproduce.",
    "created_at": "2014-11-20T17:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289946",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:61'></a>Things look fine for me except for timeouts which I already got before in debug mode, and two spurious errors I can not reproduce.



---

archive/issue_comments_289947.json:
```json
{
    "body": "<a id='comment:62'></a>Fails on OSX with (this is a fresh install):\n\n```\ng++ -O2 -g  -fPIC -I.. -I/Users/buildslave-sage/slave/sage_git/build/local -pipe -I. -I.. -I/Users/buildslave-sage/slave/sage_git/build/local -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include   -I/Users/buildslave-sage/slave/sage_git/build/local/include -fno-implicit-templates -I.. -I/Users/buildslave-sage/slave/sage_git/build/local -DNDEBUG -DOM_NDEBUG -Dx86_64Mac_darwin -DHAVE_CONFIG_H \\\n\t  -o Singular \\\n\t  tesths.cc iparith.o mpsr_Tok.o claptmpl.o\\\n\t  grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o s_buff.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o denom_list.o minpoly.o countedref.o singmathic.o semaphore.o rlimit.o slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -dynamic -L/Users/buildslave-sage/slave/sage_git/build/local/kernel -L../kernel -lkernel -L/Users/buildslave-sage/slave/sage_git/build/local/lib -L/Users/buildslave-sage/slave/sage_git/build/local/lib  -L/Users/buildslave-sage/slave/sage_git/build/local/lib -lflint -lmpfr -lmpir  -ldl -lm -lsingfac -lsingcf -lflint -lmpfr -lntl -lgmp -lreadline -ltermcap -lpthread -lm   -lomalloc  ../kernel/mmalloc.o \nld: warning: directory not found for option '-L/Users/buildslave-sage/slave/sage_git/build/local/kernel'\nduplicate symbol NTL::Mat<NTL::zz_p>::Mat()  in:\n    claptmpl.o\n    /Users/buildslave-sage/slave/sage_git/build/local/lib/libsingcf.a(ftmpl_inst.o)\n```\nand more like that, see http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20full/builds/0/steps/compile_1/logs/singular",
    "created_at": "2014-11-21T14:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289947",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:62'></a>Fails on OSX with (this is a fresh install):

```
g++ -O2 -g  -fPIC -I.. -I/Users/buildslave-sage/slave/sage_git/build/local -pipe -I. -I.. -I/Users/buildslave-sage/slave/sage_git/build/local -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include   -I/Users/buildslave-sage/slave/sage_git/build/local/include -fno-implicit-templates -I.. -I/Users/buildslave-sage/slave/sage_git/build/local -DNDEBUG -DOM_NDEBUG -Dx86_64Mac_darwin -DHAVE_CONFIG_H \
	  -o Singular \
	  tesths.cc iparith.o mpsr_Tok.o claptmpl.o\
	  grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o s_buff.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o denom_list.o minpoly.o countedref.o singmathic.o semaphore.o rlimit.o slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -dynamic -L/Users/buildslave-sage/slave/sage_git/build/local/kernel -L../kernel -lkernel -L/Users/buildslave-sage/slave/sage_git/build/local/lib -L/Users/buildslave-sage/slave/sage_git/build/local/lib  -L/Users/buildslave-sage/slave/sage_git/build/local/lib -lflint -lmpfr -lmpir  -ldl -lm -lsingfac -lsingcf -lflint -lmpfr -lntl -lgmp -lreadline -ltermcap -lpthread -lm   -lomalloc  ../kernel/mmalloc.o 
ld: warning: directory not found for option '-L/Users/buildslave-sage/slave/sage_git/build/local/kernel'
duplicate symbol NTL::Mat<NTL::zz_p>::Mat()  in:
    claptmpl.o
    /Users/buildslave-sage/slave/sage_git/build/local/lib/libsingcf.a(ftmpl_inst.o)
```
and more like that, see http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20full/builds/0/steps/compile_1/logs/singular



---

archive/issue_comments_289948.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-21T14:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289948",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289949.json:
```json
{
    "body": "<a id='comment:63'></a>Can you try without `templates.patch`?",
    "created_at": "2014-11-21T15:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289949",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:63'></a>Can you try without `templates.patch`?



---

archive/issue_comments_289950.json:
```json
{
    "body": "<a id='comment:64'></a>Anyway, I don't see any use of the instantiated NTL classes within the `Singular` directory files, so I'll just update our patches to remove the explicit instantiations in `claptmpl.cc`.",
    "created_at": "2014-11-21T16:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289950",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:64'></a>Anyway, I don't see any use of the instantiated NTL classes within the `Singular` directory files, so I'll just update our patches to remove the explicit instantiations in `claptmpl.cc`.



---

archive/issue_comments_289951.json:
```json
{
    "body": "Changing commit from \"0a5f6951bd84d6596c292e26e8ad9b8101ca51f8\" to \"4e287c4a5a72e1a23c35046c71bddde9786110cc\"",
    "created_at": "2014-11-21T17:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0a5f6951bd84d6596c292e26e8ad9b8101ca51f8" to "4e287c4a5a72e1a23c35046c71bddde9786110cc"



---

archive/issue_comments_289952.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-21T17:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289953.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-21T17:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289953",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_049809.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-22T17:18:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17184#event-49809"
}
```



---

archive/issue_comments_289954.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-22T17:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289954",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_289955.json:
```json
{
    "body": "Changing branch from \"u/jpflori/ticket/17184\" to \"4e287c4a5a72e1a23c35046c71bddde9786110cc\"",
    "created_at": "2014-11-22T17:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17184#issuecomment-289955",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jpflori/ticket/17184" to "4e287c4a5a72e1a23c35046c71bddde9786110cc"
