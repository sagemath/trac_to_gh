# Issue 17585: Implement coordinate_ring() for free module elements

archive/issues_017348.json:
```json
{
    "body": "See https://groups.google.com/forum/#!topic/sage-devel/7n5xtT9Dw2g\n\nWe add a method `coordinate_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:\n\n```\nsage: M = (ZZ^2) * (1/2)\nsage: v = M([0,1/2])\nsage: v.base_ring()\nInteger Ring\nsage: v.coordinate_ring()\nRational Field\n```\n\nBranch/Commit: 34ba37dd06c3e2110639c2c7ee356421e2eeda04\n\nReviewer: Nils Bruin, Vincent Delecroix\n\nAuthor: Jeroen Demeyer\n\nDependencies: #17584, #17694, #13081, #12600\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17585\n\n",
    "closed_at": "2015-02-24T00:39:23Z",
    "created_at": "2015-01-05T14:54:51Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Implement coordinate_ring() for free module elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17585",
    "user": "https://github.com/jdemeyer"
}
```
See https://groups.google.com/forum/#!topic/sage-devel/7n5xtT9Dw2g

We add a method `coordinate_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:

```
sage: M = (ZZ^2) * (1/2)
sage: v = M([0,1/2])
sage: v.base_ring()
Integer Ring
sage: v.coordinate_ring()
Rational Field
```

Branch/Commit: 34ba37dd06c3e2110639c2c7ee356421e2eeda04

Reviewer: Nils Bruin, Vincent Delecroix

Author: Jeroen Demeyer

Dependencies: #17584, #17694, #13081, #12600

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17585





---

archive/issue_comments_245831.json:
```json
{
    "body": "<a id='comment:3'></a>Last 10 new commits:",
    "created_at": "2015-01-07T19:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245831",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Last 10 new commits:



---

archive/issue_comments_245832.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2015-01-08T10:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_245833.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-08T11:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245834.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-08T15:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245835.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2015-01-21T16:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_245836.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,13 @@\n See https://groups.google.com/forum/#!topic/sage-devel/7n5xtT9Dw2g\n \n-We add a method `element_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:\n+We add a method `coordinate_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:\n \n ```\n sage: M = (ZZ^2) * (1/2)\n sage: v = M([0,1/2])\n sage: v.base_ring()\n Integer Ring\n-sage: v.element_ring()\n+sage: v.coordinate_ring()\n Rational Field\n ```\n \n``````\n",
    "created_at": "2015-02-10T09:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245836",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,13 @@
 See https://groups.google.com/forum/#!topic/sage-devel/7n5xtT9Dw2g
 
-We add a method `element_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:
+We add a method `coordinate_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:
 
 ```
 sage: M = (ZZ^2) * (1/2)
 sage: v = M([0,1/2])
 sage: v.base_ring()
 Integer Ring
-sage: v.element_ring()
+sage: v.coordinate_ring()
 Rational Field
 ```
 
``````




---

archive/issue_comments_245837.json:
```json
{
    "body": "<a id='comment:11'></a>I noticed this in one of the commits:\n\n```diff\n- from sage.categories.all import FreeModules\n- category = FreeModules(base_ring.category())\n+ from sage.categories.all import Fields, FreeModules, VectorSpaces\n+ if base_ring in Fields():\n+    category = VectorSpaces(base_ring)\n+ else:\n+    category = FreeModules(base_ring)\n```\nIt's important for performance and and memory-leaking that categories do *not* refer to their base rings. This information is already stored in the parent. Thus, the `FreeModules(base_ring.category())` is quite intentional. Please keep it in.\n\nFurthermore:\n\n```\nsage: FreeModules(Fields())\nCategory of vector spaces with basis over fields\n```\nso the category code does the fields check already. No need to do it twice.",
    "created_at": "2015-02-10T17:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245837",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:11'></a>I noticed this in one of the commits:

```diff
- from sage.categories.all import FreeModules
- category = FreeModules(base_ring.category())
+ from sage.categories.all import Fields, FreeModules, VectorSpaces
+ if base_ring in Fields():
+    category = VectorSpaces(base_ring)
+ else:
+    category = FreeModules(base_ring)
```
It's important for performance and and memory-leaking that categories do *not* refer to their base rings. This information is already stored in the parent. Thus, the `FreeModules(base_ring.category())` is quite intentional. Please keep it in.

Furthermore:

```
sage: FreeModules(Fields())
Category of vector spaces with basis over fields
```
so the category code does the fields check already. No need to do it twice.



---

archive/issue_comments_245838.json:
```json
{
    "body": "<a id='comment:12'></a>Nils, I agree that it's a mistake (probably by merging, since I didn't intentionally make that change).\n\nBut currently I'm waiting for #17584 to be reviewed before continuing with this ticket.\n\nI'm also wondering whether I should wait or not for #10513: if I wait, then this ticket might never get finished.",
    "created_at": "2015-02-11T09:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245838",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Nils, I agree that it's a mistake (probably by merging, since I didn't intentionally make that change).

But currently I'm waiting for #17584 to be reviewed before continuing with this ticket.

I'm also wondering whether I should wait or not for #10513: if I wait, then this ticket might never get finished.



---

archive/issue_comments_245839.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2015-02-17T10:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_245840.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-18T15:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245841.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-18T15:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245842.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-19T01:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245843.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-19T10:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245844.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-19T11:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245844",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245845.json:
```json
{
    "body": "<a id='comment:20'></a>Hi Jeroen,\n\nDid you saw the weirdness in #13304 that I mentioned related to #11751? Could we get rid of the `.basis()` in the initialization of free module elements here?\n\nVincent",
    "created_at": "2015-02-20T15:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245845",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>Hi Jeroen,

Did you saw the weirdness in #13304 that I mentioned related to #11751? Could we get rid of the `.basis()` in the initialization of free module elements here?

Vincent



---

archive/issue_comments_245846.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 vdelecroix]:\n> Hi Jeroen,\n> \n> Did you saw the weirdness in #13304 that I mentioned related to #11751?\n\nNo, but this ticket *does* fix one of the issues mentioned in #13304.",
    "created_at": "2015-02-20T16:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245846",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Replying to [comment:20 vdelecroix]:
> Hi Jeroen,
> 
> Did you saw the weirdness in #13304 that I mentioned related to #11751?

No, but this ticket *does* fix one of the issues mentioned in #13304.



---

archive/issue_comments_245847.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-02-20T16:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245847",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_245848.json:
```json
{
    "body": "<a id='comment:22'></a>1. Do we really want to allow `non exact` coordinate rings with `exact` base ring? You replaced a test about exactness of the base ring with exactness of the coordinate ring.\n\n2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.\n\n3. Do we really need the method `coordinate_ring`/`base_ring` defined on vectors? These are methods of the parent (and are implemented as such). I do not see the point of that much duplication.",
    "created_at": "2015-02-20T16:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245848",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>1. Do we really want to allow `non exact` coordinate rings with `exact` base ring? You replaced a test about exactness of the base ring with exactness of the coordinate ring.

2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.

3. Do we really need the method `coordinate_ring`/`base_ring` defined on vectors? These are methods of the parent (and are implemented as such). I do not see the point of that much duplication.



---

archive/issue_comments_245849.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-02-20T16:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245849",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_245850.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 vdelecroix]:\n> 1. Do we really want to allow `non exact` coordinate rings with `exact` base ring? You replaced a test about exactness of the base ring with exactness of the coordinate ring.\n  \nNo, mixing exact and non-exact doesn't really work anyway. I replaced the test because it does a computation with the coordinates. If we ever want to support non-exact coordinate rings with exact base rings, the modification is the right thing to do.\n\n> 2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.\n  \nAt one point during development of this ticket, I needed an explicit ring to work-around #16399. Instead, #16399 got fixed, so this work-around was no longer needed. I did keep the change to `basis_matrix()`. Does this extra argument really hurt? I could remove it if you want. The implementation is correct though: I think you are confusing the `base_ring` of the matrix with the `coordinate_ring` of the module.\n\n> 3. Do we really need the method `coordinate_ring`/`base_ring` defined on vectors? These are methods of the parent (and are implemented as such). I do not see the point of that much duplication.\n  \nWell, we already have `base_ring()` on both the module and the vectors. If you want to change that, please do it on a new ticket. Given that we have `base_ring()` for modules and vectors, it makes a lot of sense to do the same for `coordinate_ring()`. Besides, the `coordinate_ring()` method could really be seen as a method on the vectors: it gives the parent of the entries of the vector.",
    "created_at": "2015-02-20T16:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245850",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>Replying to [comment:22 vdelecroix]:
> 1. Do we really want to allow `non exact` coordinate rings with `exact` base ring? You replaced a test about exactness of the base ring with exactness of the coordinate ring.
  
No, mixing exact and non-exact doesn't really work anyway. I replaced the test because it does a computation with the coordinates. If we ever want to support non-exact coordinate rings with exact base rings, the modification is the right thing to do.

> 2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.
  
At one point during development of this ticket, I needed an explicit ring to work-around #16399. Instead, #16399 got fixed, so this work-around was no longer needed. I did keep the change to `basis_matrix()`. Does this extra argument really hurt? I could remove it if you want. The implementation is correct though: I think you are confusing the `base_ring` of the matrix with the `coordinate_ring` of the module.

> 3. Do we really need the method `coordinate_ring`/`base_ring` defined on vectors? These are methods of the parent (and are implemented as such). I do not see the point of that much duplication.
  
Well, we already have `base_ring()` on both the module and the vectors. If you want to change that, please do it on a new ticket. Given that we have `base_ring()` for modules and vectors, it makes a lot of sense to do the same for `coordinate_ring()`. Besides, the `coordinate_ring()` method could really be seen as a method on the vectors: it gives the parent of the entries of the vector.



---

archive/issue_comments_245851.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 jdemeyer]:\n> Replying to [comment:22 vdelecroix]:\n> > 2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.\n  \n> At one point during development of this ticket, I needed an explicit ring to work-around #16399. Instead, #16399 got fixed, so this work-around was no longer needed. I did keep the change to `basis_matrix()`. Does this extra argument really hurt? I could remove it if you want. The implementation is correct though: I think you are confusing the `base_ring` of the matrix with the `coordinate_ring` of the module.\n\nCould you at least include an example in the documentation?",
    "created_at": "2015-02-22T10:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245851",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>Replying to [comment:23 jdemeyer]:
> Replying to [comment:22 vdelecroix]:
> > 2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.
  
> At one point during development of this ticket, I needed an explicit ring to work-around #16399. Instead, #16399 got fixed, so this work-around was no longer needed. I did keep the change to `basis_matrix()`. Does this extra argument really hurt? I could remove it if you want. The implementation is correct though: I think you are confusing the `base_ring` of the matrix with the `coordinate_ring` of the module.

Could you at least include an example in the documentation?



---

archive/issue_comments_245852.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-22T20:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_050448.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-22T22:13:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17585#event-50448"
}
```



---

archive/issue_comments_245853.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-22T22:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245853",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245854.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-24T00:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17585#issuecomment-245854",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050449.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-24T00:39:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17585",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17585#event-50449"
}
```
