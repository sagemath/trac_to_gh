# Issue 17740: Division of modules by basering elements should not pass to the fraction field.

archive/issues_017503.json:
```json
{
    "body": "\n```\nsage: cm = sage.structure.element.get_coercion_model()\nsage: cm.bin_op(GF(5)['x'].gen(), 7, operator.div).parent()\nFraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\n```\n\nThe problem is that we are not finding the inverse because we are passing to the fraction field of ZZ before coercing to GF(5).\n\n**Branch:** [2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Robert Bradshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/17740\n\n",
    "closed_at": "2015-02-26T07:11:07Z",
    "created_at": "2015-02-06T10:37:49Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Division of modules by basering elements should not pass to the fraction field.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17740",
    "user": "https://github.com/robertwb"
}
```

```
sage: cm = sage.structure.element.get_coercion_model()
sage: cm.bin_op(GF(5)['x'].gen(), 7, operator.div).parent()
Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5
```

The problem is that we are not finding the inverse because we are passing to the fraction field of ZZ before coercing to GF(5).

**Branch:** [2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)

**Reviewer:** Vincent Delecroix

**Author:** Robert Bradshaw

Issue created by migration from https://trac.sagemath.org/ticket/17740





---

archive/issue_comments_290827.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,6 +2,7 @@\n ```\n sage: cm = sage.structure.element.get_coercion_model()\n sage: cm.bin_op(GF(5)['x'].gen(), 7, operator.div).parent()\n-\ufe21dd186f73-dcbf-4799-a7c7-5ad880512d60\ufe21{\"stdout\":\"Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\\n\"}\ufe21\n+Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\n ```\n \n+The problem is that we are not finding the inverse because we are passing to the fraction field of ZZ before coercing to GF(5).\n``````\n",
    "created_at": "2015-02-06T10:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290827",
    "user": "https://github.com/robertwb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,6 +2,7 @@
 ```
 sage: cm = sage.structure.element.get_coercion_model()
 sage: cm.bin_op(GF(5)['x'].gen(), 7, operator.div).parent()
-︡dd186f73-dcbf-4799-a7c7-5ad880512d60︡{"stdout":"Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\n"}︡
+Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5
 ```
 
+The problem is that we are not finding the inverse because we are passing to the fraction field of ZZ before coercing to GF(5).
``````




---

archive/issue_comments_290828.json:
```json
{
    "body": "**Branch:** [u/robertwb/coerce-div](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/coerce-div)",
    "created_at": "2015-02-06T11:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290828",
    "user": "https://github.com/robertwb"
}
```

**Branch:** [u/robertwb/coerce-div](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/coerce-div)



---

archive/issue_comments_290829.json:
```json
{
    "body": "<a id='comment:3'></a>\nCan we also address here why asking the coercion system to do this operation does not lead to the same result as when we just do the computation?\n\n```\nsage: parent(GF(5)['x'].gen()/7)\nUnivariate Polynomial Ring in x over Finite Field of size 5\n```\nThere may be good reasons for this (performance?) so I'm not immediately suggesting that we change the code to use the same path in both cases, but we should document that and why we're not.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a507b79f14c7db4f28ac841996cc2ef3d1ba71d\">6a507b7</a></td><td><code>Better inversion of module actions for correct division coercions.</code></td></tr></table>\n",
    "created_at": "2015-02-06T16:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290829",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'></a>
Can we also address here why asking the coercion system to do this operation does not lead to the same result as when we just do the computation?

```
sage: parent(GF(5)['x'].gen()/7)
Univariate Polynomial Ring in x over Finite Field of size 5
```
There may be good reasons for this (performance?) so I'm not immediately suggesting that we change the code to use the same path in both cases, but we should document that and why we're not.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a507b79f14c7db4f28ac841996cc2ef3d1ba71d">6a507b7</a></td><td><code>Better inversion of module actions for correct division coercions.</code></td></tr></table>




---

archive/issue_comments_290830.json:
```json
{
    "body": "**Commit:** [6a507b79f14c7db4f28ac841996cc2ef3d1ba71d](https://github.com/sagemath/sagetrac-mirror/commit/6a507b79f14c7db4f28ac841996cc2ef3d1ba71d)",
    "created_at": "2015-02-06T16:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290830",
    "user": "https://github.com/nbruin"
}
```

**Commit:** [6a507b79f14c7db4f28ac841996cc2ef3d1ba71d](https://github.com/sagemath/sagetrac-mirror/commit/6a507b79f14c7db4f28ac841996cc2ef3d1ba71d)



---

archive/issue_comments_290831.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt was probably added because coercion simply didn't used to do the right thing. I've filed #17741 about removing the redundant __div__ which may uncover surprises.",
    "created_at": "2015-02-06T18:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290831",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'></a>
It was probably added because coercion simply didn't used to do the right thing. I've filed #17741 about removing the redundant __div__ which may uncover surprises.



---

archive/issue_comments_290832.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-02-06T18:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290832",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_290833.json:
```json
{
    "body": "<a id='comment:5'></a>\nMy main concern is that your solution ignore iteration\n\n```\nsage: cm.get_action(GF(5)['x']['y'], ZZ, operator.div)\nRight inverse action by Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5 on Univariate Polynomial Ring in y over Univariate Polynomial Ring in x over Finite Field of size 5\nwith precomposition on right by Composite map:\n  From: Integer Ring\n  To:   Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\n  Defn:   Natural morphism:\n          From: Integer Ring\n          To:   Finite Field of size 5\n        then\n          Polynomial base injection morphism:\n          From: Finite Field of size 5\n          To:   Univariate Polynomial Ring in x over Finite Field of size 5\n        then\n          Ring Coercion morphism:\n          From: Univariate Polynomial Ring in x over Finite Field of size 5\n          To:   Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\n```\n\nI think that `GF(5)['x,y']` and `GF(5)['x']['y']` should behave similarly.\n\nVincent",
    "created_at": "2015-02-06T20:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290833",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
My main concern is that your solution ignore iteration

```
sage: cm.get_action(GF(5)['x']['y'], ZZ, operator.div)
Right inverse action by Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5 on Univariate Polynomial Ring in y over Univariate Polynomial Ring in x over Finite Field of size 5
with precomposition on right by Composite map:
  From: Integer Ring
  To:   Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5
  Defn:   Natural morphism:
          From: Integer Ring
          To:   Finite Field of size 5
        then
          Polynomial base injection morphism:
          From: Finite Field of size 5
          To:   Univariate Polynomial Ring in x over Finite Field of size 5
        then
          Ring Coercion morphism:
          From: Univariate Polynomial Ring in x over Finite Field of size 5
          To:   Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5
```

I think that `GF(5)['x,y']` and `GF(5)['x']['y']` should behave similarly.

Vincent



---

archive/issue_comments_290834.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes, I've actually been thinking about that as well, and I'm not sure exactly how best to handle this. GF(5)['x']['y'] is a GF(5)-module but represented as a GF(5)['x']-module. Or, put otherwise, (most) elements of ZZ have an inverse in GF(5); we want to take the most conservative inverse possible.\n\nI used to be very against partial coercions like QQ -> GF(p), but I'm not as sure anymore.",
    "created_at": "2015-02-06T22:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290834",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>
Yes, I've actually been thinking about that as well, and I'm not sure exactly how best to handle this. GF(5)['x']['y'] is a GF(5)-module but represented as a GF(5)['x']-module. Or, put otherwise, (most) elements of ZZ have an inverse in GF(5); we want to take the most conservative inverse possible.

I used to be very against partial coercions like QQ -> GF(p), but I'm not as sure anymore.



---

archive/issue_comments_290835.json:
```json
{
    "body": "<a id='comment:7'></a>\nNote that this behavior is not new\n\n```\nsage: parent(GF(5)['x']['y'].gen() / 2)\nUnivariate Polynomial Ring in y over Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5\n```\n\nMore generally, given an R-module M and an element in R0 such that R0 -> R1 -> ... -> Rn -> R, where along this chain should the multiplicative inverse be calculated? Maybe the first (last?) Ri that is already field? Starts to feel a bit ad-hoc...",
    "created_at": "2015-02-07T05:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290835",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>
Note that this behavior is not new

```
sage: parent(GF(5)['x']['y'].gen() / 2)
Univariate Polynomial Ring in y over Fraction Field of Univariate Polynomial Ring in x over Finite Field of size 5
```

More generally, given an R-module M and an element in R0 such that R0 -> R1 -> ... -> Rn -> R, where along this chain should the multiplicative inverse be calculated? Maybe the first (last?) Ri that is already field? Starts to feel a bit ad-hoc...



---

archive/issue_comments_290836.json:
```json
{
    "body": "**Changing commit** from \"[6a507b79f14c7db4f28ac841996cc2ef3d1ba71d](https://github.com/sagemath/sagetrac-mirror/commit/6a507b79f14c7db4f28ac841996cc2ef3d1ba71d)\" to \"[1e88c72687b89713e3ca79e435c509c0d99bece2](https://github.com/sagemath/sagetrac-mirror/commit/1e88c72687b89713e3ca79e435c509c0d99bece2)\".",
    "created_at": "2015-02-08T07:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6a507b79f14c7db4f28ac841996cc2ef3d1ba71d](https://github.com/sagemath/sagetrac-mirror/commit/6a507b79f14c7db4f28ac841996cc2ef3d1ba71d)" to "[1e88c72687b89713e3ca79e435c509c0d99bece2](https://github.com/sagemath/sagetrac-mirror/commit/1e88c72687b89713e3ca79e435c509c0d99bece2)".



---

archive/issue_comments_290837.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7744207c040e7bbb9b4abd7c637b46832fe486d4\">7744207</a></td><td><code>Better behavior for polynomial division.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e88c72687b89713e3ca79e435c509c0d99bece2\">1e88c72</a></td><td><code>Another polynomial division action test.</code></td></tr></table>\n",
    "created_at": "2015-02-08T07:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7744207c040e7bbb9b4abd7c637b46832fe486d4">7744207</a></td><td><code>Better behavior for polynomial division.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e88c72687b89713e3ca79e435c509c0d99bece2">1e88c72</a></td><td><code>Another polynomial division action test.</code></td></tr></table>




---

archive/issue_comments_290838.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK, I've implemented the above behavior.",
    "created_at": "2015-02-08T08:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290838",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:9'></a>
OK, I've implemented the above behavior.



---

archive/issue_comments_290839.json:
```json
{
    "body": "**Changing branch** from \"[u/robertwb/coerce-div](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/coerce-div)\" to \"[u/vdelecroix/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17440)\".",
    "created_at": "2015-02-08T10:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290839",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/robertwb/coerce-div](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/coerce-div)" to "[u/vdelecroix/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17440)".



---

archive/issue_comments_290840.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2015-02-08T10:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290840",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_290841.json:
```json
{
    "body": "<a id='comment:10'></a>\nI wrote trivial commits while I was reading the code. One thing to mention: in the documentation you should use <code>:trac:\\`17440\\`</code> instead of `#17440`.\n\nOne last question: in `coerce.pyx`, you wrote\n\n```\ntry:\n    return ~right_mul\nexcept TypeError: # action may not be invertible\n    self._record_exception()\n```\nShouldn't we catch only `CoercionException`?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a60134cdb45ad44725efb637f6b4fec74077197f\">a60134c</a></td><td><code>trac #17740: review 1 (documentation)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/728811d3f2f1d46750775b2e9ac203c08ef6db82\">728811d</a></td><td><code>trac #17740: review 2 (clean Errors)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96c1a0348964c4edbd42f3fc52e93b9e76f26156\">96c1a03</a></td><td><code>trac #17740: review 3 (less in try/except block)</code></td></tr></table>\n",
    "created_at": "2015-02-08T10:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290841",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
I wrote trivial commits while I was reading the code. One thing to mention: in the documentation you should use <code>:trac:\`17440\`</code> instead of `#17440`.

One last question: in `coerce.pyx`, you wrote

```
try:
    return ~right_mul
except TypeError: # action may not be invertible
    self._record_exception()
```
Shouldn't we catch only `CoercionException`?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a60134cdb45ad44725efb637f6b4fec74077197f">a60134c</a></td><td><code>trac #17740: review 1 (documentation)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/728811d3f2f1d46750775b2e9ac203c08ef6db82">728811d</a></td><td><code>trac #17740: review 2 (clean Errors)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96c1a0348964c4edbd42f3fc52e93b9e76f26156">96c1a03</a></td><td><code>trac #17740: review 3 (less in try/except block)</code></td></tr></table>




---

archive/issue_comments_290842.json:
```json
{
    "body": "**Changing commit** from \"[1e88c72687b89713e3ca79e435c509c0d99bece2](https://github.com/sagemath/sagetrac-mirror/commit/1e88c72687b89713e3ca79e435c509c0d99bece2)\" to \"[96c1a0348964c4edbd42f3fc52e93b9e76f26156](https://github.com/sagemath/sagetrac-mirror/commit/96c1a0348964c4edbd42f3fc52e93b9e76f26156)\".",
    "created_at": "2015-02-08T10:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290842",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[1e88c72687b89713e3ca79e435c509c0d99bece2](https://github.com/sagemath/sagetrac-mirror/commit/1e88c72687b89713e3ca79e435c509c0d99bece2)" to "[96c1a0348964c4edbd42f3fc52e93b9e76f26156](https://github.com/sagemath/sagetrac-mirror/commit/96c1a0348964c4edbd42f3fc52e93b9e76f26156)".



---

archive/issue_comments_290843.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2015-02-08T11:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290843",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_290844.json:
```json
{
    "body": "<a id='comment:11'></a>\nAnd something is broken:\n\n```\nsage -t schemes/toric/divisor.py\n**********************************************************************\nFile \"schemes/toric/divisor.py\", line 35, in sage.schemes.toric.divisor\nFailed example:\n    (1/2)*Dx + Dy/3 - Dz\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 6 affine patches' and 'Integer Ring'\n**********************************************************************\nFile \"schemes/toric/divisor.py\", line 40, in sage.schemes.toric.divisor\nFailed example:\n    (Dx/2).parent()\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 6 affine patches' and 'Integer Ring'\n**********************************************************************\nFile \"schemes/toric/divisor.py\", line 866, in sage.schemes.toric.divisor.ToricDivisor_generic.is_Weil\nFailed example:\n    (D/2).is_Weil()\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 3 affine patches' and 'Integer Ring'\n**********************************************************************\nFile \"schemes/toric/divisor.py\", line 893, in sage.schemes.toric.divisor.ToricDivisor_generic.is_QQ_Weil\nFailed example:\n    (D/2).is_QQ_Weil()\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 3 affine patches' and 'Integer Ring'\n**********************************************************************\n3 items had failures:\n   2 of  42 in sage.schemes.toric.divisor\n   1 of   5 in sage.schemes.toric.divisor.ToricDivisor_generic.is_QQ_Weil\n   1 of   5 in sage.schemes.toric.divisor.ToricDivisor_generic.is_Weil\n    [363 tests, 4 failures, 2.53 s]\n----------------------------------------------------------------------\nsage -t schemes/toric/divisor.py  # 4 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2015-02-08T11:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290844",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
And something is broken:

```
sage -t schemes/toric/divisor.py
**********************************************************************
File "schemes/toric/divisor.py", line 35, in sage.schemes.toric.divisor
Failed example:
    (1/2)*Dx + Dy/3 - Dz
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 6 affine patches' and 'Integer Ring'
**********************************************************************
File "schemes/toric/divisor.py", line 40, in sage.schemes.toric.divisor
Failed example:
    (Dx/2).parent()
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 6 affine patches' and 'Integer Ring'
**********************************************************************
File "schemes/toric/divisor.py", line 866, in sage.schemes.toric.divisor.ToricDivisor_generic.is_Weil
Failed example:
    (D/2).is_Weil()
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 3 affine patches' and 'Integer Ring'
**********************************************************************
File "schemes/toric/divisor.py", line 893, in sage.schemes.toric.divisor.ToricDivisor_generic.is_QQ_Weil
Failed example:
    (D/2).is_QQ_Weil()
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: unsupported operand parent(s) for '/': 'Group of toric ZZ-Weil divisors on 2-d CPR-Fano toric variety covered by 3 affine patches' and 'Integer Ring'
**********************************************************************
3 items had failures:
   2 of  42 in sage.schemes.toric.divisor
   1 of   5 in sage.schemes.toric.divisor.ToricDivisor_generic.is_QQ_Weil
   1 of   5 in sage.schemes.toric.divisor.ToricDivisor_generic.is_Weil
    [363 tests, 4 failures, 2.53 s]
----------------------------------------------------------------------
sage -t schemes/toric/divisor.py  # 4 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_comments_290845.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vdelecroix](#comment%3A11):\n> And something is broken:\n> \n> ```\n> sage -t schemes/toric/divisor.py\n> ```\n\n\nThe problematic line is `module_action = type(self)(K, self.codomain())` in `coerce_action.pyx`\n\n```\nsage: dP6 = toric_varieties.dP6()\nsage: Dx,Du,Dy,Dv,Dz,Dw = dP6.toric_divisor_group().gens()\nsage: A = RightModuleAction(ZZ, Dx.parent())\nsage: ~A\nTraceback (most recent call last):\n...\n    472             print \"self.codomain = {}\".format(self.codomain())\n--> 473             module_action = type(self)(K, self.codomain())\n    474             connecting = K.coerce_map_from(self.G)\n...\nCoercionException: No common base\n```",
    "created_at": "2015-02-08T11:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290845",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>
Replying to [vdelecroix](#comment%3A11):
> And something is broken:
> 
> ```
> sage -t schemes/toric/divisor.py
> ```


The problematic line is `module_action = type(self)(K, self.codomain())` in `coerce_action.pyx`

```
sage: dP6 = toric_varieties.dP6()
sage: Dx,Du,Dy,Dv,Dz,Dw = dP6.toric_divisor_group().gens()
sage: A = RightModuleAction(ZZ, Dx.parent())
sage: ~A
Traceback (most recent call last):
...
    472             print "self.codomain = {}".format(self.codomain())
--> 473             module_action = type(self)(K, self.codomain())
    474             connecting = K.coerce_map_from(self.G)
...
CoercionException: No common base
```



---

archive/issue_comments_290846.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17440)\" to \"[u/robertwb/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17440)\".",
    "created_at": "2015-02-11T05:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290846",
    "user": "https://github.com/robertwb"
}
```

**Changing branch** from "[u/vdelecroix/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17440)" to "[u/robertwb/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17440)".



---

archive/issue_comments_290847.json:
```json
{
    "body": "**Changing commit** from \"[96c1a0348964c4edbd42f3fc52e93b9e76f26156](https://github.com/sagemath/sagetrac-mirror/commit/96c1a0348964c4edbd42f3fc52e93b9e76f26156)\" to \"[2cb51c095e0e3375dead95c194febd5873ba5e06](https://github.com/sagemath/sagetrac-mirror/commit/2cb51c095e0e3375dead95c194febd5873ba5e06)\".",
    "created_at": "2015-02-11T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290847",
    "user": "https://github.com/robertwb"
}
```

**Changing commit** from "[96c1a0348964c4edbd42f3fc52e93b9e76f26156](https://github.com/sagemath/sagetrac-mirror/commit/96c1a0348964c4edbd42f3fc52e93b9e76f26156)" to "[2cb51c095e0e3375dead95c194febd5873ba5e06](https://github.com/sagemath/sagetrac-mirror/commit/2cb51c095e0e3375dead95c194febd5873ba5e06)".



---

archive/issue_comments_290848.json:
```json
{
    "body": "<a id='comment:14'></a>\nFixed these failing tests. \n\nAlso, no, we don't want to only catch `CoercionException` there.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2cb51c095e0e3375dead95c194febd5873ba5e06\">2cb51c0</a></td><td><code>Re-introduce action of fraction field as fallback for division action.</code></td></tr></table>\n",
    "created_at": "2015-02-11T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290848",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:14'></a>
Fixed these failing tests. 

Also, no, we don't want to only catch `CoercionException` there.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2cb51c095e0e3375dead95c194febd5873ba5e06">2cb51c0</a></td><td><code>Re-introduce action of fraction field as fallback for division action.</code></td></tr></table>




---

archive/issue_comments_290849.json:
```json
{
    "body": "<a id='comment:15'></a>\nStill some failing doctests... (the last one only concerns the more recent 6-5.rc0)\n\nFile `rings/quotient_ring_element.py`\n\n```\nline 360, in sage.rings.quotient_ring_element.QuotientRingElement._div_\nFailed example:\n    1/cuberoot\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: self must be an integral domain.\n**********************************************************************\nline 362, in sage.rings.quotient_ring_element.QuotientRingElement._div_\nFailed example:\n    1/a\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: self must be an integral domain.\n**********************************************************************\nFile \"src/sage/rings/quotient_ring_element.py\", line 370, in sage.rings.quotient_ring_element.QuotientRingElement._div_\nFailed example:\n    1 / S(x1 + x2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    ArithmeticError: Division failed. The numerator is not a multiple of the denominator.\nGot:\n    Traceback (most recent call last):\n    ...\n    TypeError: self must be an integral domain.\n```\n\n\nFile `rings/padics/local_generic_element.pyx`\n\n```\nline 63, in sage.rings.padics.local_generic_element.LocalGenericElement._div_\nFailed example:\n    R = Zp(7, 4, 'fixed-mod'); 1/R(7)\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: cannot invert non-unit\nGot:\n    Traceback (most recent call last):\n    ...\n    TypeError: This implementation of the p-adic ring does not support fields of fractions.\n```\n\nFile `rings/padics/padic_ZZ_pX_FM_element.pyx`\n\n```\nline 88, in sage.rings.padics.padic_ZZ_pX_FM_element\nFailed example:\n    1/a\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: This implementation of the p-adic ring does not support fields of fractions.\n**********************************************************************\nline 875, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_\nFailed example:\n    1 / W(14) == ~W(14)\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: This implementation of the p-adic ring does not support fields of fractions.\n**********************************************************************\nline 877, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_\nFailed example:\n    1 / w\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: cannot invert non-unit\nGot:\n    Traceback (most recent call last):\n    ...\n    TypeError: This implementation of the p-adic ring does not support fields of fractions.\n**********************************************************************\nline 885, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_\nFailed example:\n    1/(t+t^2)\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: This implementation of the p-adic ring does not support fields of fraction.\n```\n\nIn `modular/modform_hecketriangle/graded_ring_element.py`:\n\n```\nsage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py\n**********************************************************************\nline 887, in sage.modular.modform_hecketriangle.graded_ring_element.FormsRingElement._div_\nFailed example:\n    ((E4.as_ring_element())^(-2)).parent() == (E4^(-2)).parent()\nException raised:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: No way to prove that ModularFormsRing(n=8) over Integer Ring is an integral domain!\n**********************************************************************\nline 889, in sage.modular.modform_hecketriangle.graded_ring_element.FormsRingElement._div_\nFailed example:\n    (MR(x)^(-3)).parent()\nException raised:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: No way to prove that QuasiMeromorphicModularFormsRing(n=8) over Integer Ring is an integral domain!\n```",
    "created_at": "2015-02-11T10:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290849",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Still some failing doctests... (the last one only concerns the more recent 6-5.rc0)

File `rings/quotient_ring_element.py`

```
line 360, in sage.rings.quotient_ring_element.QuotientRingElement._div_
Failed example:
    1/cuberoot
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: self must be an integral domain.
**********************************************************************
line 362, in sage.rings.quotient_ring_element.QuotientRingElement._div_
Failed example:
    1/a
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: self must be an integral domain.
**********************************************************************
File "src/sage/rings/quotient_ring_element.py", line 370, in sage.rings.quotient_ring_element.QuotientRingElement._div_
Failed example:
    1 / S(x1 + x2)
Expected:
    Traceback (most recent call last):
    ...
    ArithmeticError: Division failed. The numerator is not a multiple of the denominator.
Got:
    Traceback (most recent call last):
    ...
    TypeError: self must be an integral domain.
```


File `rings/padics/local_generic_element.pyx`

```
line 63, in sage.rings.padics.local_generic_element.LocalGenericElement._div_
Failed example:
    R = Zp(7, 4, 'fixed-mod'); 1/R(7)
Expected:
    Traceback (most recent call last):
    ...
    ValueError: cannot invert non-unit
Got:
    Traceback (most recent call last):
    ...
    TypeError: This implementation of the p-adic ring does not support fields of fractions.
```

File `rings/padics/padic_ZZ_pX_FM_element.pyx`

```
line 88, in sage.rings.padics.padic_ZZ_pX_FM_element
Failed example:
    1/a
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: This implementation of the p-adic ring does not support fields of fractions.
**********************************************************************
line 875, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_
Failed example:
    1 / W(14) == ~W(14)
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: This implementation of the p-adic ring does not support fields of fractions.
**********************************************************************
line 877, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_
Failed example:
    1 / w
Expected:
    Traceback (most recent call last):
    ...
    ValueError: cannot invert non-unit
Got:
    Traceback (most recent call last):
    ...
    TypeError: This implementation of the p-adic ring does not support fields of fractions.
**********************************************************************
line 885, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_
Failed example:
    1/(t+t^2)
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: This implementation of the p-adic ring does not support fields of fraction.
```

In `modular/modform_hecketriangle/graded_ring_element.py`:

```
sage -t --long src/sage/modular/modform_hecketriangle/graded_ring_element.py
**********************************************************************
line 887, in sage.modular.modform_hecketriangle.graded_ring_element.FormsRingElement._div_
Failed example:
    ((E4.as_ring_element())^(-2)).parent() == (E4^(-2)).parent()
Exception raised:
    Traceback (most recent call last):
    ...
    NotImplementedError: No way to prove that ModularFormsRing(n=8) over Integer Ring is an integral domain!
**********************************************************************
line 889, in sage.modular.modform_hecketriangle.graded_ring_element.FormsRingElement._div_
Failed example:
    (MR(x)^(-3)).parent()
Exception raised:
    Traceback (most recent call last):
    ...
    NotImplementedError: No way to prove that QuasiMeromorphicModularFormsRing(n=8) over Integer Ring is an integral domain!
```



---

archive/issue_comments_290850.json:
```json
{
    "body": "<a id='comment:16'></a>\nHello Robert,\n\nHere is a one-line commit that fixes all doctest issues. I am wondering why these did not appear in the first time... Tell me what you think.\n\nVincent\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16ca39d03e82a065cb2ceee6af68e44811974469\">16ca39d</a></td><td><code>trac #17440: merge 6.5.rc3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1fc166516e7574fceda32a828402c31586bed01\">d1fc166</a></td><td><code>trac #17440: better _pseudo_fraction_field</code></td></tr></table>\n",
    "created_at": "2015-02-14T13:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290850",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
Hello Robert,

Here is a one-line commit that fixes all doctest issues. I am wondering why these did not appear in the first time... Tell me what you think.

Vincent

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16ca39d03e82a065cb2ceee6af68e44811974469">16ca39d</a></td><td><code>trac #17440: merge 6.5.rc3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1fc166516e7574fceda32a828402c31586bed01">d1fc166</a></td><td><code>trac #17440: better _pseudo_fraction_field</code></td></tr></table>




---

archive/issue_comments_290851.json:
```json
{
    "body": "**Changing branch** from \"[u/robertwb/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17440)\" to \"[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)\".",
    "created_at": "2015-02-14T13:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290851",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/robertwb/17440](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17440)" to "[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)".



---

archive/issue_comments_290852.json:
```json
{
    "body": "**Changing commit** from \"[2cb51c095e0e3375dead95c194febd5873ba5e06](https://github.com/sagemath/sagetrac-mirror/commit/2cb51c095e0e3375dead95c194febd5873ba5e06)\" to \"[d1fc166516e7574fceda32a828402c31586bed01](https://github.com/sagemath/sagetrac-mirror/commit/d1fc166516e7574fceda32a828402c31586bed01)\".",
    "created_at": "2015-02-14T13:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290852",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[2cb51c095e0e3375dead95c194febd5873ba5e06](https://github.com/sagemath/sagetrac-mirror/commit/2cb51c095e0e3375dead95c194febd5873ba5e06)" to "[d1fc166516e7574fceda32a828402c31586bed01](https://github.com/sagemath/sagetrac-mirror/commit/d1fc166516e7574fceda32a828402c31586bed01)".



---

archive/issue_comments_290853.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-02-14T13:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290853",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_290854.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2015-02-14T13:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290854",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_comments_290855.json:
```json
{
    "body": "**Author:** Robert Bradshaw",
    "created_at": "2015-02-14T13:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290855",
    "user": "https://github.com/videlec"
}
```

**Author:** Robert Bradshaw



---

archive/issue_comments_290856.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)\" to \"[u/robertwb/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17740)\".",
    "created_at": "2015-02-15T09:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290856",
    "user": "https://github.com/robertwb"
}
```

**Changing branch** from "[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)" to "[u/robertwb/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17740)".



---

archive/issue_comments_290857.json:
```json
{
    "body": "<a id='comment:20'></a>\nI don't think self is the right thing to return by default, but here's a similar fix.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bff474b33f681de5d51ebf1be5c95dc7ac7f2f03\">bff474b</a></td><td><code>Better _pseudo_fraction_field default implementation.</code></td></tr></table>\n",
    "created_at": "2015-02-15T09:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290857",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:20'></a>
I don't think self is the right thing to return by default, but here's a similar fix.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bff474b33f681de5d51ebf1be5c95dc7ac7f2f03">bff474b</a></td><td><code>Better _pseudo_fraction_field default implementation.</code></td></tr></table>




---

archive/issue_comments_290858.json:
```json
{
    "body": "**Changing commit** from \"[d1fc166516e7574fceda32a828402c31586bed01](https://github.com/sagemath/sagetrac-mirror/commit/d1fc166516e7574fceda32a828402c31586bed01)\" to \"[bff474b33f681de5d51ebf1be5c95dc7ac7f2f03](https://github.com/sagemath/sagetrac-mirror/commit/bff474b33f681de5d51ebf1be5c95dc7ac7f2f03)\".",
    "created_at": "2015-02-15T09:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290858",
    "user": "https://github.com/robertwb"
}
```

**Changing commit** from "[d1fc166516e7574fceda32a828402c31586bed01](https://github.com/sagemath/sagetrac-mirror/commit/d1fc166516e7574fceda32a828402c31586bed01)" to "[bff474b33f681de5d51ebf1be5c95dc7ac7f2f03](https://github.com/sagemath/sagetrac-mirror/commit/bff474b33f681de5d51ebf1be5c95dc7ac7f2f03)".



---

archive/issue_comments_290859.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-02-15T11:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290859",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_290860.json:
```json
{
    "body": "**Changing status** from positive_review to needs_info.",
    "created_at": "2015-02-15T16:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290860",
    "user": "https://github.com/videlec"
}
```

**Changing status** from positive_review to needs_info.



---

archive/issue_comments_290861.json:
```json
{
    "body": "<a id='comment:22'></a>\nNow, I am not sure anymore that your solution is better. The implementation of `division_parent` tries to execute `~parent.one()`. But the default implementation of `__invert__` of an element `x` in `sage.structure.element` is precisely to call `1/x` (and soonly `x.parent().one()/x` with #17692). Hence using `division_parent` should lead to some infinite recursions that we curiously do not see here. No?\n\nEDIT: This is fine, because in `x.parent().one()/x` the numerator and denominator have the same type... and so no coercion is involved and `__div__` is called directly.",
    "created_at": "2015-02-15T16:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290861",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>
Now, I am not sure anymore that your solution is better. The implementation of `division_parent` tries to execute `~parent.one()`. But the default implementation of `__invert__` of an element `x` in `sage.structure.element` is precisely to call `1/x` (and soonly `x.parent().one()/x` with #17692). Hence using `division_parent` should lead to some infinite recursions that we curiously do not see here. No?

EDIT: This is fine, because in `x.parent().one()/x` the numerator and denominator have the same type... and so no coercion is involved and `__div__` is called directly.



---

archive/issue_comments_290862.json:
```json
{
    "body": "**Changing status** from needs_info to positive_review.",
    "created_at": "2015-02-15T16:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290862",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_info to positive_review.



---

archive/issue_comments_290863.json:
```json
{
    "body": "<a id='comment:24'></a>\nYes, indeed this should go in with #17692 to prevent possible infinite recursion. Thanks for the review!",
    "created_at": "2015-02-17T04:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290863",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:24'></a>
Yes, indeed this should go in with #17692 to prevent possible infinite recursion. Thanks for the review!



---

archive/issue_comments_290864.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2015-02-17T20:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290864",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_290865.json:
```json
{
    "body": "<a id='comment:25'></a>\nMerge conflict, possibly #17694",
    "created_at": "2015-02-17T20:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290865",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
Merge conflict, possibly #17694



---

archive/issue_comments_290866.json:
```json
{
    "body": "**Changing branch** from \"[u/robertwb/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17740)\" to \"[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)\".",
    "created_at": "2015-02-18T11:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290866",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/robertwb/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/17740)" to "[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)".



---

archive/issue_comments_290867.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-02-18T11:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290867",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_290868.json:
```json
{
    "body": "<a id='comment:26'></a>\nHi Robert,\n\nThere was only a trivial conflict in `sage/rings/ring.pyx`. I did merge with sage-6.6.beta0 in my last commit. I let you set the positive review if this is fine.\n\nVincent\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52cc62d92f8bed38aab6e2a9a8cfb785493a69bf\">52cc62d</a></td><td><code>trac #17740: merge sage-6.6.beta0</code></td></tr></table>\n",
    "created_at": "2015-02-18T11:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290868",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>
Hi Robert,

There was only a trivial conflict in `sage/rings/ring.pyx`. I did merge with sage-6.6.beta0 in my last commit. I let you set the positive review if this is fine.

Vincent

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52cc62d92f8bed38aab6e2a9a8cfb785493a69bf">52cc62d</a></td><td><code>trac #17740: merge sage-6.6.beta0</code></td></tr></table>




---

archive/issue_comments_290869.json:
```json
{
    "body": "**Changing commit** from \"[bff474b33f681de5d51ebf1be5c95dc7ac7f2f03](https://github.com/sagemath/sagetrac-mirror/commit/bff474b33f681de5d51ebf1be5c95dc7ac7f2f03)\" to \"[52cc62d92f8bed38aab6e2a9a8cfb785493a69bf](https://github.com/sagemath/sagetrac-mirror/commit/52cc62d92f8bed38aab6e2a9a8cfb785493a69bf)\".",
    "created_at": "2015-02-18T11:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290869",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[bff474b33f681de5d51ebf1be5c95dc7ac7f2f03](https://github.com/sagemath/sagetrac-mirror/commit/bff474b33f681de5d51ebf1be5c95dc7ac7f2f03)" to "[52cc62d92f8bed38aab6e2a9a8cfb785493a69bf](https://github.com/sagemath/sagetrac-mirror/commit/52cc62d92f8bed38aab6e2a9a8cfb785493a69bf)".



---

archive/issue_comments_290870.json:
```json
{
    "body": "**Changing commit** from \"[52cc62d92f8bed38aab6e2a9a8cfb785493a69bf](https://github.com/sagemath/sagetrac-mirror/commit/52cc62d92f8bed38aab6e2a9a8cfb785493a69bf)\" to \"[9c970ae1c2ef9516f61a3c6cc737e6d0c644565e](https://github.com/sagemath/sagetrac-mirror/commit/9c970ae1c2ef9516f61a3c6cc737e6d0c644565e)\".",
    "created_at": "2015-02-24T13:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[52cc62d92f8bed38aab6e2a9a8cfb785493a69bf](https://github.com/sagemath/sagetrac-mirror/commit/52cc62d92f8bed38aab6e2a9a8cfb785493a69bf)" to "[9c970ae1c2ef9516f61a3c6cc737e6d0c644565e](https://github.com/sagemath/sagetrac-mirror/commit/9c970ae1c2ef9516f61a3c6cc737e6d0c644565e)".



---

archive/issue_comments_290871.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c970ae1c2ef9516f61a3c6cc737e6d0c644565e\">9c970ae</a></td><td><code>trac #17740: merge sage-6.6.beta1</code></td></tr></table>\n",
    "created_at": "2015-02-24T13:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c970ae1c2ef9516f61a3c6cc737e6d0c644565e">9c970ae</a></td><td><code>trac #17740: merge sage-6.6.beta1</code></td></tr></table>




---

archive/issue_comments_290872.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-02-24T13:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290872",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_290873.json:
```json
{
    "body": "<a id='comment:28'></a>\nAll long tests pass. Put back in positive review.",
    "created_at": "2015-02-24T13:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290873",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>
All long tests pass. Put back in positive review.



---

archive/issue_comments_290874.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2015-02-25T00:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290874",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_290875.json:
```json
{
    "body": "<a id='comment:29'></a>\nI'm getting this on OSX:\n\n```\nsage -t --long src/sage/structure/coerce_actions.pyx\n**********************************************************************\nFile \"src/sage/structure/coerce_actions.pyx\", line 419, in sage.structure.coerce_actions.ModuleAction.__invert__\nFailed example:\n    A = ~RightModuleAction(ZZ, GF(5)['x']); A\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 850, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.structure.coerce_actions.ModuleAction.__invert__[10]>\", line 1, in <module>\n        A = ~RightModuleAction(ZZ, GF(Integer(5))['x']); A\n      File \"sage/structure/coerce_actions.pyx\", line 464, in sage.structure.coerce_actions.ModuleAction.__invert__ (build/cythonized/sage/structure/coerce_actions.c:7385)\n        module_action = type(self)(K, self.codomain())\n      File \"sage/structure/coerce_actions.pyx\", line 376, in sage.structure.coerce_actions.ModuleAction.codomain (build/cythonized/sage/structure/coerce_actions.c:6711)\n        return self.underlying_set()\n      File \"sage/categories/action.pyx\", line 186, in sage.categories.action.Action.underlying_set (build/cythonized/sage/categories/action.c:4087)\n        raise RuntimeError, \"This action acted on a set that became garbage collected\"\n    RuntimeError: This action acted on a set that became garbage collected\n**********************************************************************\nFile \"src/sage/structure/coerce_actions.pyx\", line 424, in sage.structure.coerce_actions.ModuleAction.__invert__\nFailed example:\n    A(x, 2)\nExpected:\n    3*x\nGot:\n    1/2*x\n**********************************************************************\n1 item had failures:\n   2 of  15 in sage.structure.coerce_actions.ModuleAction.__invert__\n    [90 tests, 2 failures, 0.47 s]\n```\nIn all these doctests you need to hold domain/codomain explicitly alive.",
    "created_at": "2015-02-25T00:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290875",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
I'm getting this on OSX:

```
sage -t --long src/sage/structure/coerce_actions.pyx
**********************************************************************
File "src/sage/structure/coerce_actions.pyx", line 419, in sage.structure.coerce_actions.ModuleAction.__invert__
Failed example:
    A = ~RightModuleAction(ZZ, GF(5)['x']); A
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 850, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.structure.coerce_actions.ModuleAction.__invert__[10]>", line 1, in <module>
        A = ~RightModuleAction(ZZ, GF(Integer(5))['x']); A
      File "sage/structure/coerce_actions.pyx", line 464, in sage.structure.coerce_actions.ModuleAction.__invert__ (build/cythonized/sage/structure/coerce_actions.c:7385)
        module_action = type(self)(K, self.codomain())
      File "sage/structure/coerce_actions.pyx", line 376, in sage.structure.coerce_actions.ModuleAction.codomain (build/cythonized/sage/structure/coerce_actions.c:6711)
        return self.underlying_set()
      File "sage/categories/action.pyx", line 186, in sage.categories.action.Action.underlying_set (build/cythonized/sage/categories/action.c:4087)
        raise RuntimeError, "This action acted on a set that became garbage collected"
    RuntimeError: This action acted on a set that became garbage collected
**********************************************************************
File "src/sage/structure/coerce_actions.pyx", line 424, in sage.structure.coerce_actions.ModuleAction.__invert__
Failed example:
    A(x, 2)
Expected:
    3*x
Got:
    1/2*x
**********************************************************************
1 item had failures:
   2 of  15 in sage.structure.coerce_actions.ModuleAction.__invert__
    [90 tests, 2 failures, 0.47 s]
```
In all these doctests you need to hold domain/codomain explicitly alive.



---

archive/issue_comments_290876.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46\">2075e2e</a></td><td><code>trac #17740: avoid parent deaths</code></td></tr></table>\n",
    "created_at": "2015-02-25T07:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46">2075e2e</a></td><td><code>trac #17740: avoid parent deaths</code></td></tr></table>




---

archive/issue_comments_290877.json:
```json
{
    "body": "**Changing commit** from \"[9c970ae1c2ef9516f61a3c6cc737e6d0c644565e](https://github.com/sagemath/sagetrac-mirror/commit/9c970ae1c2ef9516f61a3c6cc737e6d0c644565e)\" to \"[2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)\".",
    "created_at": "2015-02-25T07:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9c970ae1c2ef9516f61a3c6cc737e6d0c644565e](https://github.com/sagemath/sagetrac-mirror/commit/9c970ae1c2ef9516f61a3c6cc737e6d0c644565e)" to "[2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)".



---

archive/issue_comments_290878.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2015-02-25T08:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290878",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_290879.json:
```json
{
    "body": "<a id='comment:31'></a>\nRight. We should not kill our parents ;-)\n\nIt is strange that I did not get these in the first place... All doctest pass.\n\nVincent",
    "created_at": "2015-02-25T08:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290879",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>
Right. We should not kill our parents ;-)

It is strange that I did not get these in the first place... All doctest pass.

Vincent



---

archive/issue_events_057947.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-26T07:11:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17740#event-57947"
}
```



---

archive/issue_comments_290880.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)\" to \"[2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)\".",
    "created_at": "2015-02-26T07:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290880",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/17740](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17740)" to "[2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)".



---

archive/issue_comments_290881.json:
```json
{
    "body": "<a id='comment:33'></a>\nThanks for following up on this. Looks good to me.",
    "created_at": "2015-02-26T07:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290881",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:33'></a>
Thanks for following up on this. Looks good to me.



---

archive/issue_comments_290882.json:
```json
{
    "body": "**Changing commit** from \"[2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)\" to \"\".",
    "created_at": "2015-02-26T07:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17740#issuecomment-290882",
    "user": "https://github.com/robertwb"
}
```

**Changing commit** from "[2075e2e68f6e6fc981096948ad4ffc61c47cfa46](https://github.com/sagemath/sagetrac-mirror/commit/2075e2e68f6e6fc981096948ad4ffc61c47cfa46)" to "".
