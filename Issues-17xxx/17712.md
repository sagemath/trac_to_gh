# Issue 17712: Adds memoization to the branch and bound for vertex separation

archive/issues_017475.json:
```json
{
    "assignees": [],
    "body": "This patch adds to the branch and bound algorithm for the vertex separation (#17647) a kind of memoization tool for storing prefixes as proposed in [CMN14]. This can significantly reduce the number of nodes of the branch-and-bound tree to consider.\n\n\nReference:\n[CMN14] D. Coudert, D. Mazauric, N. Nisse. *Experimental Evaluation of a Branch and Bound Algorithm for computing Pathwidth*. In SEA'13, LNCS vol. 8504, pp.46-58, 2014.\n\nDepends on #17711\n\nCC:  @nathanncohen\n\nBranch/Commit: **[93e9a0a](https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de)**\n\nReviewer: **Nathann Cohen**\n\nAuthor: **David Coudert**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17712_\n\n",
    "closed_at": "2015-02-18T23:22:42Z",
    "created_at": "2015-02-01T14:59:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Adds memoization to the branch and bound for vertex separation",
    "type": "issue",
    "updated_at": "2015-02-18T23:22:42Z",
    "url": "https://github.com/sagemath/sage/issues/17712",
    "user": "https://github.com/dcoudert"
}
```
This patch adds to the branch and bound algorithm for the vertex separation (#17647) a kind of memoization tool for storing prefixes as proposed in [CMN14]. This can significantly reduce the number of nodes of the branch-and-bound tree to consider.


Reference:
[CMN14] D. Coudert, D. Mazauric, N. Nisse. *Experimental Evaluation of a Branch and Bound Algorithm for computing Pathwidth*. In SEA'13, LNCS vol. 8504, pp.46-58, 2014.

Depends on #17711

CC:  @nathanncohen

Branch/Commit: **[93e9a0a](https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de)**

Reviewer: **Nathann Cohen**

Author: **David Coudert**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/17712_





---

archive/issue_events_252359.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-01T14:59:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252359"
}
```



---

archive/issue_events_252360.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-01T14:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252360"
}
```



---

archive/issue_events_252361.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-01T14:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252361"
}
```



---

archive/issue_events_252362.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-01T14:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252362"
}
```



---

archive/issue_comments_239200.json:
```json
{
    "body": "Branch: **[public/17112](https://github.com/sagemath/sagetrac-mirror/tree/public/17112)**",
    "created_at": "2015-02-04T00:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239200",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/17112](https://github.com/sagemath/sagetrac-mirror/tree/public/17112)**



---

archive/issue_comments_239201.json:
```json
{
    "body": "Dependencies: **#17711**",
    "created_at": "2015-02-04T00:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239201",
    "user": "https://github.com/dcoudert"
}
```

Dependencies: **#17711**



---

archive/issue_comments_239202.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This patch adds to the branch and bound algorithm for the vertex separation (#17647) a memoization tool for storing prefixes as proposed in [CMN14]. This can significantly speed up the computation time.\n+This patch adds to the branch and bound algorithm for the vertex separation (#17647) a kind of memoization tool for storing prefixes as proposed in [CMN14]. This can significantly reduce the number of nodes of the branch-and-bound tree to consider.\n \n \n Reference:\n``````\n",
    "created_at": "2015-02-04T00:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239202",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This patch adds to the branch and bound algorithm for the vertex separation (#17647) a memoization tool for storing prefixes as proposed in [CMN14]. This can significantly speed up the computation time.
+This patch adds to the branch and bound algorithm for the vertex separation (#17647) a kind of memoization tool for storing prefixes as proposed in [CMN14]. This can significantly reduce the number of nodes of the branch-and-bound tree to consider.
 
 
 Reference:
``````




---

archive/issue_comments_239203.json:
```json
{
    "body": "Commit: **[8dd34cd](https://github.com/sagemath/sagetrac-mirror/commit/8dd34cd88b0463af0a1c2ad47560ea77a1543bf0)**",
    "created_at": "2015-02-05T15:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239203",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[8dd34cd](https://github.com/sagemath/sagetrac-mirror/commit/8dd34cd88b0463af0a1c2ad47560ea77a1543bf0)**



---

archive/issue_comments_239204.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfc96a02340514f80e325cae30d4ec4d161e59ca\">cfc96a0</a></td><td><code>Merge branch 'public/17647b' of git://trac.sagemath.org/sage into tmp</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c666aef83a2b61f9b7754662581d0438bb796c8\">8c666ae</a></td><td><code>trac#17711: expose BAB in vertex_separation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62dd7c8f7769e8d2b6ac8a5c288a6f85ed8f2a4c\">62dd7c8</a></td><td><code>trac#17711: Let MILP work with Graph as well</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6f49752b598dc717b026d725732fea5fe0c9865\">f6f4975</a></td><td><code>trac#17711: Let exp work with Graph as well</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1b63ba1057021fc91b373978e7ca7e186d0af14\">d1b63ba</a></td><td><code>trac#17711: Let lower_bound to work with Graph as well and clean lots of tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f62716539aaf4c236041d1e31dbf59bcb8bba750\">f627165</a></td><td><code>trac#17711: adds decomposition into strongly connected components</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/085a3cddacc561236db1fde9d42b97eaa085b764\">085a3cd</a></td><td><code>trac #17711: Mostly removing trailing whitespaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d9da78b0d3f7d7ba6caa74f5e51eec82f218302\">0d9da78</a></td><td><code>trac #17711: handle connected components</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6baf83e733555c22f287692f107eec954e494d59\">6baf83e</a></td><td><code>trac #17711: minor edit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8dd34cd88b0463af0a1c2ad47560ea77a1543bf0\">8dd34cd</a></td><td><code>trac #17712: add prefix storage to BAB</code></td></tr></table>\n",
    "created_at": "2015-02-05T15:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239204",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfc96a02340514f80e325cae30d4ec4d161e59ca">cfc96a0</a></td><td><code>Merge branch 'public/17647b' of git://trac.sagemath.org/sage into tmp</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c666aef83a2b61f9b7754662581d0438bb796c8">8c666ae</a></td><td><code>trac#17711: expose BAB in vertex_separation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62dd7c8f7769e8d2b6ac8a5c288a6f85ed8f2a4c">62dd7c8</a></td><td><code>trac#17711: Let MILP work with Graph as well</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6f49752b598dc717b026d725732fea5fe0c9865">f6f4975</a></td><td><code>trac#17711: Let exp work with Graph as well</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1b63ba1057021fc91b373978e7ca7e186d0af14">d1b63ba</a></td><td><code>trac#17711: Let lower_bound to work with Graph as well and clean lots of tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f62716539aaf4c236041d1e31dbf59bcb8bba750">f627165</a></td><td><code>trac#17711: adds decomposition into strongly connected components</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/085a3cddacc561236db1fde9d42b97eaa085b764">085a3cd</a></td><td><code>trac #17711: Mostly removing trailing whitespaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d9da78b0d3f7d7ba6caa74f5e51eec82f218302">0d9da78</a></td><td><code>trac #17711: handle connected components</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6baf83e733555c22f287692f107eec954e494d59">6baf83e</a></td><td><code>trac #17711: minor edit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8dd34cd88b0463af0a1c2ad47560ea77a1543bf0">8dd34cd</a></td><td><code>trac #17712: add prefix storage to BAB</code></td></tr></table>




---

archive/issue_comments_239205.json:
```json
{
    "body": "Changed commit from **[8dd34cd](https://github.com/sagemath/sagetrac-mirror/commit/8dd34cd88b0463af0a1c2ad47560ea77a1543bf0)** to **[1a33d04](https://github.com/sagemath/sagetrac-mirror/commit/1a33d044aa565ef4ea574d33d8010c634a17699a)**",
    "created_at": "2015-02-05T16:02:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239205",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8dd34cd](https://github.com/sagemath/sagetrac-mirror/commit/8dd34cd88b0463af0a1c2ad47560ea77a1543bf0)** to **[1a33d04](https://github.com/sagemath/sagetrac-mirror/commit/1a33d044aa565ef4ea574d33d8010c634a17699a)**



---

archive/issue_comments_239206.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a33d044aa565ef4ea574d33d8010c634a17699a\">1a33d04</a></td><td><code>trac #17712: some cleaning</code></td></tr></table>\n",
    "created_at": "2015-02-05T16:02:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239206",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a33d044aa565ef4ea574d33d8010c634a17699a">1a33d04</a></td><td><code>trac #17712: some cleaning</code></td></tr></table>




---

archive/issue_comments_239207.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI have pushed a first draft for storing prefixes.\nWe can certainly reduce further the computation time, but I don't know how. Also, I tried to be as simple as possible.\n\nDavid.",
    "created_at": "2015-02-05T16:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239207",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">comment:4</div>

I have pushed a first draft for storing prefixes.
We can certainly reduce further the computation time, but I don't know how. Also, I tried to be as simple as possible.

David.



---

archive/issue_events_252363.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-05T16:04:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252363"
}
```



---

archive/issue_comments_239208.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHello David,\n\nA short review before going to sleep:\n\n1) You do not seem to do anything at all with `max_prefix_number`.\n\n2) You add parameters in `path_decomposition` but you don't do\nanything with them.\n\n3) Given that you seem to only store sets of integers, I am\ntempted to think that you should prefer `FrozenBitset` objects\nover `frozenset`. They should give you a faster hash/equality\ntest.\n\n4) There are many empty docstrings in the methods of\n`PrefixStorage`. And to be honest, considering the amount of doc\nit takes to implement all of that, I wonder if it would not be\nbetter to leave it all in the code, without creating a new\nclass. \"Just a dictionary whose keys are bitsets\".\n\nIn order to not have too many things in the actual\nbranch-and-bound, it may be enough to have just a couple of\nfunctions (your update/is_known_prefix) taking a dictionary as an\nadditional argument.\n\nGood night,\n\nNathann",
    "created_at": "2015-02-05T22:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239208",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:5" align="right">comment:5</div>

Hello David,

A short review before going to sleep:

1) You do not seem to do anything at all with `max_prefix_number`.

2) You add parameters in `path_decomposition` but you don't do
anything with them.

3) Given that you seem to only store sets of integers, I am
tempted to think that you should prefer `FrozenBitset` objects
over `frozenset`. They should give you a faster hash/equality
test.

4) There are many empty docstrings in the methods of
`PrefixStorage`. And to be honest, considering the amount of doc
it takes to implement all of that, I wonder if it would not be
better to leave it all in the code, without creating a new
class. "Just a dictionary whose keys are bitsets".

In order to not have too many things in the actual
branch-and-bound, it may be enough to have just a couple of
functions (your update/is_known_prefix) taking a dictionary as an
additional argument.

Good night,

Nathann



---

archive/issue_events_252364.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-02-05T22:10:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252364"
}
```



---

archive/issue_events_252365.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-02-05T22:10:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252365"
}
```



---

archive/issue_comments_239209.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1181090c4d48f10b1bc20daa517c5396b6d27083\">1181090</a></td><td><code>trac #17712: improvements</code></td></tr></table>\n",
    "created_at": "2015-02-05T22:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239209",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1181090c4d48f10b1bc20daa517c5396b6d27083">1181090</a></td><td><code>trac #17712: improvements</code></td></tr></table>




---

archive/issue_comments_239210.json:
```json
{
    "body": "Changed commit from **[1a33d04](https://github.com/sagemath/sagetrac-mirror/commit/1a33d044aa565ef4ea574d33d8010c634a17699a)** to **[1181090](https://github.com/sagemath/sagetrac-mirror/commit/1181090c4d48f10b1bc20daa517c5396b6d27083)**",
    "created_at": "2015-02-05T22:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239210",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1a33d04](https://github.com/sagemath/sagetrac-mirror/commit/1a33d044aa565ef4ea574d33d8010c634a17699a)** to **[1181090](https://github.com/sagemath/sagetrac-mirror/commit/1181090c4d48f10b1bc20daa517c5396b6d27083)**



---

archive/issue_comments_239211.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nathanncohen](#comment:5):\n> Hello David,\n> \n> A short review before going to sleep:\n> \n> 1) You do not seem to do anything at all with `max_prefix_number`.\n\nNow used. I forgot some parts. Surprizingly you are less efficient when the heating system of your building is broken during winter time...\n\nAlso I'm now only recording 1 boolean per prefix. We don't need to store the cost.\n \n> 2) You add parameters in `path_decomposition` but you don't do\n> anything with them.\n\nFixed\n  \n> 3) Given that you seem to only store sets of integers, I am\n> tempted to think that you should prefer `FrozenBitset` objects\n> over `frozenset`. They should give you a faster hash/equality\n> test.\n\nMy tests gives better performances with `frozenset`. But if you have better ideas...\n  \n> 4) There are many empty docstrings in the methods of\n> `PrefixStorage`. And to be honest, considering the amount of doc\n> it takes to implement all of that, I wonder if it would not be\n> better to leave it all in the code, without creating a new\n> class. \"Just a dictionary whose keys are bitsets\".\n> \n> In order to not have too many things in the actual\n> branch-and-bound, it may be enough to have just a couple of\n> functions (your update/is_known_prefix) taking a dictionary as an\n> additional argument.\n\nThe main advantage of the class is to hide all the parameters. It is very useful to be able to tune these parameters according the amount of memory you have. Passing the dict as parameter, we would also have to pass other parameters.\nI'm not convinced that it would really be shorter to have 2 functions instead of this class. \n\nWe could however save the `enable_prefix_storage` parameter since we can obtain the same behavior setting `max_prefix_length=0`.\n\n \n> Good night,\n> \n> Nathann\n\n\nIf you want to know the kind of speedup we get for a quite hard instance:\n\n```\nsage: G = graphs.MycielskiGraph(5)\nsage: %timeit vs, seq = VS.vertex_separation_BAB(G, enable_prefix_storage=True)\n1000 loops, best of 3: 1.3 ms per loop\nsage: %timeit vs, seq = VS.vertex_separation_BAB(G, enable_prefix_storage=False)\n100 loops, best of 3: 2.19 ms per loop\n\nsage: G = graphs.MycielskiGraph(6)\nsage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=20)\n1 loops, best of 3: 1.05 s per loop\nsage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=10)\n1 loops, best of 3: 1.84 s per loop\nsage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=8)\n1 loops, best of 3: 12 s per loop\nsage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=7)\n1 loops, best of 3: 40.8 s per loop\n```\n\nI have not tested `VS.vertex_separation_BAB(G, enable_prefix_storage=False)` with this version of the prefix storage. With a former version (using trees and so much more ugly code) it was around 40min, so with dict should be more than 1h\n\nDavid.",
    "created_at": "2015-02-05T23:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239211",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nathanncohen](#comment:5):
> Hello David,
> 
> A short review before going to sleep:
> 
> 1) You do not seem to do anything at all with `max_prefix_number`.

Now used. I forgot some parts. Surprizingly you are less efficient when the heating system of your building is broken during winter time...

Also I'm now only recording 1 boolean per prefix. We don't need to store the cost.
 
> 2) You add parameters in `path_decomposition` but you don't do
> anything with them.

Fixed
  
> 3) Given that you seem to only store sets of integers, I am
> tempted to think that you should prefer `FrozenBitset` objects
> over `frozenset`. They should give you a faster hash/equality
> test.

My tests gives better performances with `frozenset`. But if you have better ideas...
  
> 4) There are many empty docstrings in the methods of
> `PrefixStorage`. And to be honest, considering the amount of doc
> it takes to implement all of that, I wonder if it would not be
> better to leave it all in the code, without creating a new
> class. "Just a dictionary whose keys are bitsets".
> 
> In order to not have too many things in the actual
> branch-and-bound, it may be enough to have just a couple of
> functions (your update/is_known_prefix) taking a dictionary as an
> additional argument.

The main advantage of the class is to hide all the parameters. It is very useful to be able to tune these parameters according the amount of memory you have. Passing the dict as parameter, we would also have to pass other parameters.
I'm not convinced that it would really be shorter to have 2 functions instead of this class. 

We could however save the `enable_prefix_storage` parameter since we can obtain the same behavior setting `max_prefix_length=0`.

 
> Good night,
> 
> Nathann


If you want to know the kind of speedup we get for a quite hard instance:

```
sage: G = graphs.MycielskiGraph(5)
sage: %timeit vs, seq = VS.vertex_separation_BAB(G, enable_prefix_storage=True)
1000 loops, best of 3: 1.3 ms per loop
sage: %timeit vs, seq = VS.vertex_separation_BAB(G, enable_prefix_storage=False)
100 loops, best of 3: 2.19 ms per loop

sage: G = graphs.MycielskiGraph(6)
sage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=20)
1 loops, best of 3: 1.05 s per loop
sage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=10)
1 loops, best of 3: 1.84 s per loop
sage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=8)
1 loops, best of 3: 12 s per loop
sage: %timeit vs, seq = VS.vertex_separation_BAB(G, max_prefix_length=7)
1 loops, best of 3: 40.8 s per loop
```

I have not tested `VS.vertex_separation_BAB(G, enable_prefix_storage=False)` with this version of the prefix storage. With a former version (using trees and so much more ugly code) it was around 40min, so with dict should be more than 1h

David.



---

archive/issue_events_252366.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-06T17:15:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252366"
}
```



---

archive/issue_events_252367.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-06T17:15:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252367"
}
```



---

archive/issue_comments_239212.json:
```json
{
    "body": "Changed commit from **[1181090](https://github.com/sagemath/sagetrac-mirror/commit/1181090c4d48f10b1bc20daa517c5396b6d27083)** to **[6e39f78](https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e)**",
    "created_at": "2015-02-07T12:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239212",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1181090](https://github.com/sagemath/sagetrac-mirror/commit/1181090c4d48f10b1bc20daa517c5396b6d27083)** to **[6e39f78](https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e)**



---

archive/issue_comments_239213.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e\">6e39f78</a></td><td><code>trac #17712: remove parameter enable_prefix_storage</code></td></tr></table>\n",
    "created_at": "2015-02-07T12:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239213",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e">6e39f78</a></td><td><code>trac #17712: remove parameter enable_prefix_storage</code></td></tr></table>




---

archive/issue_comments_239214.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHello again,\n\nI am working again on this patch, and I cannot say that I like this `PrefixStorage` class very much. To make it simple it is just a dictionary, in which you seem to store all values that you do not want to carry around as parameters of the `BAB_C` function.\n\nSome parameters are almost impossible to document in the `PrefixStorage` class and can only be understood if you know exactly where they are called from the inside of the `BAB_C` function.\n\nI removed some undocumented functions from `PrefixStorage` that you did not call (as well as the undocumented `__len__`). Please make sure that `sage -coverage <file>` does not return anything wrong before you submit a patch for review.\n\n....\n\nOkay, and I just noticed that you pushed a new commit on this `needs_review` patch. So now I will see whether it breaks all my modifications.\n\nToday is not a good day.\n\nNathann\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e\">6e39f78</a></td><td><code>trac #17712: remove parameter enable_prefix_storage</code></td></tr></table>\n",
    "created_at": "2015-02-07T12:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239214",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

Hello again,

I am working again on this patch, and I cannot say that I like this `PrefixStorage` class very much. To make it simple it is just a dictionary, in which you seem to store all values that you do not want to carry around as parameters of the `BAB_C` function.

Some parameters are almost impossible to document in the `PrefixStorage` class and can only be understood if you know exactly where they are called from the inside of the `BAB_C` function.

I removed some undocumented functions from `PrefixStorage` that you did not call (as well as the undocumented `__len__`). Please make sure that `sage -coverage <file>` does not return anything wrong before you submit a patch for review.

....

Okay, and I just noticed that you pushed a new commit on this `needs_review` patch. So now I will see whether it breaks all my modifications.

Today is not a good day.

Nathann

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e">6e39f78</a></td><td><code>trac #17712: remove parameter enable_prefix_storage</code></td></tr></table>




---

archive/issue_comments_239215.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSorry, sorry, sorry, sorry, I removed the enable prefix storage parameter to shorten the doc. Really sorry if I breaks your edits...",
    "created_at": "2015-02-07T12:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239215",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:11" align="right">comment:11</div>

Sorry, sorry, sorry, sorry, I removed the enable prefix storage parameter to shorten the doc. Really sorry if I breaks your edits...



---

archive/issue_comments_239216.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIf you believe it is better to add extra parameters to `BAB_C` (dict, max length, max number, etc.) and to remove this class, we can try.",
    "created_at": "2015-02-07T12:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239216",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:12" align="right">comment:12</div>

If you believe it is better to add extra parameters to `BAB_C` (dict, max length, max number, etc.) and to remove this class, we can try.



---

archive/issue_events_252368.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-02-07T13:25:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252368"
}
```



---

archive/issue_events_252369.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-02-07T13:25:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252369"
}
```



---

archive/issue_comments_239217.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHello again,\n\nThis commit does what was said above, and also rephrases the short description of the caching mechanism in the module's doc. I hope that it is clearer.\n\nAs you just removed a keyword I also wondered about the use of \"is_on\".\n\nTwo remarks:\n\n1) Right now you 'store' the size of the dictionary in an integer variable. To do this, every time you add a new element in the dictionary, you check whether the element is there already. Thus, each of the `+1` costs you a lookup, theoretically a `log(n)` operation. I have not run any timings, but I would be a bit troubled if calling `len(the_dict)` was not faster.\n\n2) I still do not understand the point of the dictionary: what are \"False\" values useful for ? Why isn't it just a set of frozensets ?\n\n3) \n\n```\n~/sage/graphs/graph_decompositions$ sage -coverage vertex_separation.pyx \n------------------------------------------------------------------------\nSCORE vertex_separation.pyx: 88.9% (8 of 9)\n\nMissing doctests:\n     * line 1663: def __init__(self, int max_prefix_length=20, int max_prefix_number=10**6)\n------------------------------------------------------------------------\n```\n\nNathann\n\nP.S. : About removing this `PrefixStorage`: let us first see what happens with this dict/set question. My intuition is that if this thing becomes a set you can already remove `cost/upper_bound/is_improved` from `update()` (and only call 'update' when appropriate) which may already simplify matters.",
    "created_at": "2015-02-07T13:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239217",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:13" align="right">comment:13</div>

Hello again,

This commit does what was said above, and also rephrases the short description of the caching mechanism in the module's doc. I hope that it is clearer.

As you just removed a keyword I also wondered about the use of "is_on".

Two remarks:

1) Right now you 'store' the size of the dictionary in an integer variable. To do this, every time you add a new element in the dictionary, you check whether the element is there already. Thus, each of the `+1` costs you a lookup, theoretically a `log(n)` operation. I have not run any timings, but I would be a bit troubled if calling `len(the_dict)` was not faster.

2) I still do not understand the point of the dictionary: what are "False" values useful for ? Why isn't it just a set of frozensets ?

3) 

```
~/sage/graphs/graph_decompositions$ sage -coverage vertex_separation.pyx 
------------------------------------------------------------------------
SCORE vertex_separation.pyx: 88.9% (8 of 9)

Missing doctests:
     * line 1663: def __init__(self, int max_prefix_length=20, int max_prefix_number=10**6)
------------------------------------------------------------------------
```

Nathann

P.S. : About removing this `PrefixStorage`: let us first see what happens with this dict/set question. My intuition is that if this thing becomes a set you can already remove `cost/upper_bound/is_improved` from `update()` (and only call 'update' when appropriate) which may already simplify matters.



---

archive/issue_comments_239218.json:
```json
{
    "body": "Changed commit from **[6e39f78](https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e)** to **[4abd2ba](https://github.com/sagemath/sagetrac-mirror/commit/4abd2bacff0b06ae13a4fb4d046c7ecee4716d28)**",
    "created_at": "2015-02-07T13:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239218",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6e39f78](https://github.com/sagemath/sagetrac-mirror/commit/6e39f78fbdfcf22ca89ba23ac96ce88431feaa6e)** to **[4abd2ba](https://github.com/sagemath/sagetrac-mirror/commit/4abd2bacff0b06ae13a4fb4d046c7ecee4716d28)**



---

archive/issue_comments_239219.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4abd2bacff0b06ae13a4fb4d046c7ecee4716d28\">4abd2ba</a></td><td><code>trac #17712: Reviewer's commit</code></td></tr></table>\n",
    "created_at": "2015-02-07T13:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239219",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4abd2bacff0b06ae13a4fb4d046c7ecee4716d28">4abd2ba</a></td><td><code>trac #17712: Reviewer's commit</code></td></tr></table>




---

archive/issue_comments_239220.json:
```json
{
    "body": "Changed branch from **[public/17112](https://github.com/sagemath/sagetrac-mirror/tree/public/17112)** to **[public/17712](https://github.com/sagemath/sagetrac-mirror/tree/public/17712)**",
    "created_at": "2015-02-07T13:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239220",
    "user": "https://github.com/nathanncohen"
}
```

Changed branch from **[public/17112](https://github.com/sagemath/sagetrac-mirror/tree/public/17112)** to **[public/17712](https://github.com/sagemath/sagetrac-mirror/tree/public/17712)**



---

archive/issue_comments_239221.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHello Nathann,\n\nYou are right, we could use a set instead of a dictionary and add the prefix `P` to the set only if `c(P)<\\min_{L\\in{\\cal L}_P(V)} c(L)`.\n\nHowever, it is apparently faster to test if a frozenset is a key of a dictionary than if it is in a set.\n\n```\nsage: d = dict()\nsage: s = set()\nsage: for i in range(1, 11):\n....:     for z in Combinations(range(2*i), i):\n....:         d[frozenset(z)] = True\n....:         s.add(frozenset(z))\n....:         \nsage: len(d)\n250952\nsage: %timeit len(d)\n10000000 loops, best of 3: 63 ns per loop\nsage: %timeit len(s)\n10000000 loops, best of 3: 59.9 ns per loop\nsage:\nsage: elt = d.keys()[randint(0, len(d)-1)]\nsage: %timeit elt in d\n10000000 loops, best of 3: 60.9 ns per loop\nsage: %timeit elt in s\n10000000 loops, best of 3: 163 ns per loop\nsage:\nsage: elt = d.keys()[randint(0, len(d)-1)]\nsage: %timeit elt in d\n10000000 loops, best of 3: 58.8 ns per loop\nsage: %timeit elt in s\n10000000 loops, best of 3: 160 ns per loop\n```\n\n\nWhat we can do is to change `is_known_prefix` as follows:\n\n```\n        if size<1 or size>self.max_prefix_length:\n            return False\n\n        cdef int i\n        cdef frozenset my_prefix = frozenset([prefix[i] for i in range(size)])\n\n        return my_prefix in self.PT\n```\nand `update` as:\n\n```\n        cdef int i\n        if size>0 and size<=self.max_prefix_length \\\n           and not (is_improved and cost==upper_bound) \\\n           and len(self.PT)< self.max_prefix_number:\n\n            my_prefix = frozenset(prefix[i] for i in range(size))\n            self.PT[my_prefix] = True\n```\nFurthermore, if we do that inside `BAB_C`, we do only once `my_prefix = frozenset(prefix[i] for i in range(size))`.\n\nIf you agree, I will implement the changes.\n\nDavid.",
    "created_at": "2015-02-07T14:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239221",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

Hello Nathann,

You are right, we could use a set instead of a dictionary and add the prefix `P` to the set only if `c(P)<\min_{L\in{\cal L}_P(V)} c(L)`.

However, it is apparently faster to test if a frozenset is a key of a dictionary than if it is in a set.

```
sage: d = dict()
sage: s = set()
sage: for i in range(1, 11):
....:     for z in Combinations(range(2*i), i):
....:         d[frozenset(z)] = True
....:         s.add(frozenset(z))
....:         
sage: len(d)
250952
sage: %timeit len(d)
10000000 loops, best of 3: 63 ns per loop
sage: %timeit len(s)
10000000 loops, best of 3: 59.9 ns per loop
sage:
sage: elt = d.keys()[randint(0, len(d)-1)]
sage: %timeit elt in d
10000000 loops, best of 3: 60.9 ns per loop
sage: %timeit elt in s
10000000 loops, best of 3: 163 ns per loop
sage:
sage: elt = d.keys()[randint(0, len(d)-1)]
sage: %timeit elt in d
10000000 loops, best of 3: 58.8 ns per loop
sage: %timeit elt in s
10000000 loops, best of 3: 160 ns per loop
```


What we can do is to change `is_known_prefix` as follows:

```
        if size<1 or size>self.max_prefix_length:
            return False

        cdef int i
        cdef frozenset my_prefix = frozenset([prefix[i] for i in range(size)])

        return my_prefix in self.PT
```
and `update` as:

```
        cdef int i
        if size>0 and size<=self.max_prefix_length \
           and not (is_improved and cost==upper_bound) \
           and len(self.PT)< self.max_prefix_number:

            my_prefix = frozenset(prefix[i] for i in range(size))
            self.PT[my_prefix] = True
```
Furthermore, if we do that inside `BAB_C`, we do only once `my_prefix = frozenset(prefix[i] for i in range(size))`.

If you agree, I will implement the changes.

David.



---

archive/issue_comments_239222.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYo !\n\n> You are right, we could use a set instead of a dictionary and add the prefix `P` to the set only if `c(P)<\\min_{L\\in{\\cal L}_P(V)} c(L)`.\n\nCool. This should sipmlify both code and doc.\n\n> However, it is apparently faster to test if a frozenset is a key of a dictionary than if it is in a set.\n\nWHaaaaaaaaaaaaaaat ?.... `-_-`\n\nOkay. Dict with 'True' keys. Really... `-_-`\n\nI will write to sage-devel with your timings.\n\n> If you agree, I will implement the changes.\n\n+1\n\nNathann",
    "created_at": "2015-02-07T14:59:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239222",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

Yo !

> You are right, we could use a set instead of a dictionary and add the prefix `P` to the set only if `c(P)<\min_{L\in{\cal L}_P(V)} c(L)`.

Cool. This should sipmlify both code and doc.

> However, it is apparently faster to test if a frozenset is a key of a dictionary than if it is in a set.

WHaaaaaaaaaaaaaaat ?.... `-_-`

Okay. Dict with 'True' keys. Really... `-_-`

I will write to sage-devel with your timings.

> If you agree, I will implement the changes.

+1

Nathann



---

archive/issue_comments_239223.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cc8d7fc0550aba5fd9e03f3263ede4172ff9b73\">4cc8d7f</a></td><td><code>trac #17712: remove class PrefixStorage and simplify code</code></td></tr></table>\n",
    "created_at": "2015-02-07T15:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239223",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cc8d7fc0550aba5fd9e03f3263ede4172ff9b73">4cc8d7f</a></td><td><code>trac #17712: remove class PrefixStorage and simplify code</code></td></tr></table>




---

archive/issue_comments_239224.json:
```json
{
    "body": "Changed commit from **[4abd2ba](https://github.com/sagemath/sagetrac-mirror/commit/4abd2bacff0b06ae13a4fb4d046c7ecee4716d28)** to **[4cc8d7f](https://github.com/sagemath/sagetrac-mirror/commit/4cc8d7fc0550aba5fd9e03f3263ede4172ff9b73)**",
    "created_at": "2015-02-07T15:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239224",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4abd2ba](https://github.com/sagemath/sagetrac-mirror/commit/4abd2bacff0b06ae13a4fb4d046c7ecee4716d28)** to **[4cc8d7f](https://github.com/sagemath/sagetrac-mirror/commit/4cc8d7fc0550aba5fd9e03f3263ede4172ff9b73)**



---

archive/issue_comments_239225.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWith this modification, the code is significantly faster. Cool! I'm really happy to have this timing on my MBA, knowing that it is a hard instance for this problem.\n\n```\nsage: from sage.graphs.graph_decompositions import vertex_separation as VS\nsage: G = graphs.MycielskiGraph(6)\nsage: %timeit vs, seq = VS.vertex_separation(G)\n1 loops, best of 3: 965 ms per loop\n```\nWe can easily change from `dict` to any other relevant data structure if it is faster.\n\nDavid.",
    "created_at": "2015-02-07T15:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239225",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:19" align="right">comment:19</div>

With this modification, the code is significantly faster. Cool! I'm really happy to have this timing on my MBA, knowing that it is a hard instance for this problem.

```
sage: from sage.graphs.graph_decompositions import vertex_separation as VS
sage: G = graphs.MycielskiGraph(6)
sage: %timeit vs, seq = VS.vertex_separation(G)
1 loops, best of 3: 965 ms per loop
```
We can easily change from `dict` to any other relevant data structure if it is faster.

David.



---

archive/issue_comments_239226.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHMmmmm.. Less code, more speed. Love when it happens `:-P`\n\nNathann",
    "created_at": "2015-02-07T15:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239226",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:20" align="right">comment:20</div>

HMmmmm.. Less code, more speed. Love when it happens `:-P`

Nathann



---

archive/issue_comments_239227.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSince we learned that \"internally sets are implemented just as dictionaries with no values\", there is no reason for using dictionary. The timing was certainly due to the order in which values were inserted in the set and in the dictionary. Moreover, we can get different results:\n\n```\nsage: L = []\nsage: for i in range(1, 11):\n....:     for z in Combinations(range(2*i), i):\n....:         L.append(frozenset(z))\n....:         \nsage: shuffle(L)\nsage: d = dict( (k, True) for k in L )\nsage: s = set(L)\nsage: elt = L[randint(0, len(L)-1)]\nsage: %timeit elt in s\n10000000 loops, best of 3: 66.8 ns per loop\nsage: %timeit elt in d\n10000000 loops, best of 3: 64.1 ns per loop\nsage: d = dict()\nsage: for i in range(1, 11):\n    for z in Combinations(range(2*i), i):\n        d[frozenset(z)] = True\n....:\nsage: %timeit elt in d\n10000000 loops, best of 3: 157 ns per loop\n```\n\nI will change to set.\n\nDavid.",
    "created_at": "2015-02-07T16:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239227",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:21" align="right">comment:21</div>

Since we learned that "internally sets are implemented just as dictionaries with no values", there is no reason for using dictionary. The timing was certainly due to the order in which values were inserted in the set and in the dictionary. Moreover, we can get different results:

```
sage: L = []
sage: for i in range(1, 11):
....:     for z in Combinations(range(2*i), i):
....:         L.append(frozenset(z))
....:         
sage: shuffle(L)
sage: d = dict( (k, True) for k in L )
sage: s = set(L)
sage: elt = L[randint(0, len(L)-1)]
sage: %timeit elt in s
10000000 loops, best of 3: 66.8 ns per loop
sage: %timeit elt in d
10000000 loops, best of 3: 64.1 ns per loop
sage: d = dict()
sage: for i in range(1, 11):
    for z in Combinations(range(2*i), i):
        d[frozenset(z)] = True
....:
sage: %timeit elt in d
10000000 loops, best of 3: 157 ns per loop
```

I will change to set.

David.



---

archive/issue_comments_239228.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6a71a03edd5e21712ae76268e1cdd1a00b8b845\">f6a71a0</a></td><td><code>trac #17712: use set instead of dict to store prefixes</code></td></tr></table>\n",
    "created_at": "2015-02-07T16:19:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239228",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6a71a03edd5e21712ae76268e1cdd1a00b8b845">f6a71a0</a></td><td><code>trac #17712: use set instead of dict to store prefixes</code></td></tr></table>




---

archive/issue_comments_239229.json:
```json
{
    "body": "Changed commit from **[4cc8d7f](https://github.com/sagemath/sagetrac-mirror/commit/4cc8d7fc0550aba5fd9e03f3263ede4172ff9b73)** to **[f6a71a0](https://github.com/sagemath/sagetrac-mirror/commit/f6a71a03edd5e21712ae76268e1cdd1a00b8b845)**",
    "created_at": "2015-02-07T16:19:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239229",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4cc8d7f](https://github.com/sagemath/sagetrac-mirror/commit/4cc8d7fc0550aba5fd9e03f3263ede4172ff9b73)** to **[f6a71a0](https://github.com/sagemath/sagetrac-mirror/commit/f6a71a03edd5e21712ae76268e1cdd1a00b8b845)**



---

archive/issue_comments_239230.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSame speed and bit less doc.",
    "created_at": "2015-02-07T16:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239230",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:23" align="right">comment:23</div>

Same speed and bit less doc.



---

archive/issue_events_252370.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-07T16:23:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252370"
}
```



---

archive/issue_events_252371.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-07T16:23:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252371"
}
```



---

archive/issue_comments_239231.json:
```json
{
    "body": "Changed commit from **[f6a71a0](https://github.com/sagemath/sagetrac-mirror/commit/f6a71a03edd5e21712ae76268e1cdd1a00b8b845)** to **[8bcfa17](https://github.com/sagemath/sagetrac-mirror/commit/8bcfa17987a8561d459703334615dec1b7edfa3d)**",
    "created_at": "2015-02-08T11:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239231",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f6a71a0](https://github.com/sagemath/sagetrac-mirror/commit/f6a71a03edd5e21712ae76268e1cdd1a00b8b845)** to **[8bcfa17](https://github.com/sagemath/sagetrac-mirror/commit/8bcfa17987a8561d459703334615dec1b7edfa3d)**



---

archive/issue_comments_239232.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bcfa17987a8561d459703334615dec1b7edfa3d\">8bcfa17</a></td><td><code>trac #17712: store prefixes generated by greedy steps</code></td></tr></table>\n",
    "created_at": "2015-02-08T11:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239232",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bcfa17987a8561d459703334615dec1b7edfa3d">8bcfa17</a></td><td><code>trac #17712: store prefixes generated by greedy steps</code></td></tr></table>




---

archive/issue_comments_239233.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI have added a few lines to store the prefixes generated by the greedy steps.\nAlthough it takes some time locally, it should help reducing the total number of visited branches.",
    "created_at": "2015-02-08T11:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239233",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

I have added a few lines to store the prefixes generated by the greedy steps.
Although it takes some time locally, it should help reducing the total number of visited branches.



---

archive/issue_comments_239234.json:
```json
{
    "body": "Changed commit from **[8bcfa17](https://github.com/sagemath/sagetrac-mirror/commit/8bcfa17987a8561d459703334615dec1b7edfa3d)** to **[919df3d](https://github.com/sagemath/sagetrac-mirror/commit/919df3da5d54ddc1531581c225d8dfe7a21b0f76)**",
    "created_at": "2015-02-08T14:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239234",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8bcfa17](https://github.com/sagemath/sagetrac-mirror/commit/8bcfa17987a8561d459703334615dec1b7edfa3d)** to **[919df3d](https://github.com/sagemath/sagetrac-mirror/commit/919df3da5d54ddc1531581c225d8dfe7a21b0f76)**



---

archive/issue_comments_239235.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/919df3da5d54ddc1531581c225d8dfe7a21b0f76\">919df3d</a></td><td><code>trac #17712: move tests on prefixes</code></td></tr></table>\n",
    "created_at": "2015-02-08T14:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239235",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/919df3da5d54ddc1531581c225d8dfe7a21b0f76">919df3d</a></td><td><code>trac #17712: move tests on prefixes</code></td></tr></table>




---

archive/issue_comments_239236.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de\">93e9a0a</a></td><td><code>trac #17712: Update doc</code></td></tr></table>\n",
    "created_at": "2015-02-08T18:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de">93e9a0a</a></td><td><code>trac #17712: Update doc</code></td></tr></table>




---

archive/issue_comments_239237.json:
```json
{
    "body": "Changed commit from **[919df3d](https://github.com/sagemath/sagetrac-mirror/commit/919df3da5d54ddc1531581c225d8dfe7a21b0f76)** to **[93e9a0a](https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de)**",
    "created_at": "2015-02-08T18:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239237",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[919df3d](https://github.com/sagemath/sagetrac-mirror/commit/919df3da5d54ddc1531581c225d8dfe7a21b0f76)** to **[93e9a0a](https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de)**



---

archive/issue_comments_239238.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nYoooooooooo !\n\nIf you don't see anything wrong in this last commit you can set the ticket to `positive_review`. Thanks for you work,\n\nNathann",
    "created_at": "2015-02-08T18:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239238",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:28" align="right">comment:28</div>

Yoooooooooo !

If you don't see anything wrong in this last commit you can set the ticket to `positive_review`. Thanks for you work,

Nathann



---

archive/issue_comments_239239.json:
```json
{
    "body": "Reviewer: **Nathann Cohen**",
    "created_at": "2015-02-08T18:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239239",
    "user": "https://github.com/nathanncohen"
}
```

Reviewer: **Nathann Cohen**



---

archive/issue_comments_239240.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nYouhou!!!\n\nThank you once again Nathann for your very constructive help. The final solution is very nice.\n\nBest,\nDavid.\n\nPS: I have other possible inputs for this module (algorithm for trees, pre-processing for reducing the size of input, algorithm for testing vs=1 and vs=2, heuristics, etc.), but not right now.",
    "created_at": "2015-02-08T19:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239240",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:29" align="right">comment:29</div>

Youhou!!!

Thank you once again Nathann for your very constructive help. The final solution is very nice.

Best,
David.

PS: I have other possible inputs for this module (algorithm for trees, pre-processing for reducing the size of input, algorithm for testing vs=1 and vs=2, heuristics, etc.), but not right now.



---

archive/issue_events_252372.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-08T19:44:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252372"
}
```



---

archive/issue_events_252373.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-02-08T19:44:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252373"
}
```



---

archive/issue_events_252374.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-18T23:22:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252374"
}
```



---

archive/issue_events_252375.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "da9ed4ec1f2d32db523073a998d6183527972195",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-02-18T23:22:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17712#event-252375"
}
```



---

archive/issue_comments_239241.json:
```json
{
    "body": "Changed branch from **[public/17712](https://github.com/sagemath/sagetrac-mirror/tree/public/17712)** to **[93e9a0a](https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de)**",
    "created_at": "2015-02-18T23:22:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17712#issuecomment-239241",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/17712](https://github.com/sagemath/sagetrac-mirror/tree/public/17712)** to **[93e9a0a](https://github.com/sagemath/sagetrac-mirror/commit/93e9a0ab8ffae7ae695e51f8a89ca72994c3a9de)**
