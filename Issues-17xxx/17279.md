# Issue 17279: Fix java version detection

archive/issues_017042.json:
```json
{
    "body": "CC:  @kiwifb @vbraun @gutow @kcrisman @strogdon @jdemeyer\n\nSince the Java requirements have gone up, the version detection in `src/sage/interfaces/jmoldata.py` should be fixed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17279\n\n",
    "closed_at": "2014-11-06T11:15:11Z",
    "created_at": "2014-11-03T09:21:15Z",
    "labels": [
        "component: interfaces",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Fix java version detection",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17279",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @kiwifb @vbraun @gutow @kcrisman @strogdon @jdemeyer

Since the Java requirements have gone up, the version detection in `src/sage/interfaces/jmoldata.py` should be fixed.

Issue created by migration from https://trac.sagemath.org/ticket/17279





---

archive/issue_comments_226253.json:
```json
{
    "body": "Or jmol should be compiled to run on older JREs if possible ;-)",
    "created_at": "2014-11-03T09:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226253",
    "user": "https://github.com/vbraun"
}
```

Or jmol should be compiled to run on older JREs if possible ;-)



---

archive/issue_comments_226254.json:
```json
{
    "body": "Replying to [comment:2 vbraun]:\n> Or jmol should be compiled to run on older JREs if possible ;-)\n\nWhichever but we have to agree quickly. Do we want to require java 1.7 as a minimum? Is there a good reason to ditch java 1.6?",
    "created_at": "2014-11-03T09:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226254",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:2 vbraun]:
> Or jmol should be compiled to run on older JREs if possible ;-)

Whichever but we have to agree quickly. Do we want to require java 1.7 as a minimum? Is there a good reason to ditch java 1.6?



---

archive/issue_comments_226255.json:
```json
{
    "body": "Actually the current code in sage check for version as far back as 1.5 and would be unhappy with 1.8.\n\n```\n        import re\n        java_version = re.search(\"version.*[1][.][567]\", version)\n        return java_version is not None\n```\nso some fix will be in order anyway.",
    "created_at": "2014-11-03T09:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226255",
    "user": "https://github.com/kiwifb"
}
```

Actually the current code in sage check for version as far back as 1.5 and would be unhappy with 1.8.

```
        import re
        java_version = re.search("version.*[1][.][567]", version)
        return java_version is not None
```
so some fix will be in order anyway.



---

archive/issue_comments_226256.json:
```json
{
    "body": "Good, the version checking is still in there.  This needs to be changed to not accept anything less than java 7.  I think Jmol will work with java 8, but have not done any testing.\n\nI recommend \"java_version = re.search(\"version.*[1][.][78]\", version)\"  and if we run into problems with version 8 JVMs we back up.",
    "created_at": "2014-11-03T14:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226256",
    "user": "https://github.com/gutow"
}
```

Good, the version checking is still in there.  This needs to be changed to not accept anything less than java 7.  I think Jmol will work with java 8, but have not done any testing.

I recommend "java_version = re.search("version.*[1][.][78]", version)"  and if we run into problems with version 8 JVMs we back up.



---

archive/issue_comments_226257.json:
```json
{
    "body": "Seems like they intentionally require 1.7+, so we should just require that.",
    "created_at": "2014-11-03T15:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226257",
    "user": "https://github.com/vbraun"
}
```

Seems like they intentionally require 1.7+, so we should just require that.



---

archive/issue_comments_226258.json:
```json
{
    "body": "> Good, the version checking is still in there.  This needs to be changed to not accept anything less than java 7.  I think Jmol will work with java 8, but have not done any testing.\n\nJonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.\n> Seems like they intentionally require 1.7+, so we should just require that.\nYup.  Wow, that is a bit of a change.  Sorry, Jeroen :(",
    "created_at": "2014-11-03T17:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226258",
    "user": "https://github.com/kcrisman"
}
```

> Good, the version checking is still in there.  This needs to be changed to not accept anything less than java 7.  I think Jmol will work with java 8, but have not done any testing.

Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.
> Seems like they intentionally require 1.7+, so we should just require that.
Yup.  Wow, that is a bit of a change.  Sorry, Jeroen :(



---

archive/issue_comments_226259.json:
```json
{
    "body": "Replying to [comment:8 kcrisman]:\n> Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.\n\nJSmol and Jmol work without the backend.  The backend is presently just used to make the nice static pictures, without it a less pretty Tachyon image is generated.  Ultimately, the backend should be used to package the data as well.  The present packaging method is not terribly efficient or flexible.\n\nIt is quite possible that the wiki is behind.  I'll put it on our todo list.",
    "created_at": "2014-11-03T19:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226259",
    "user": "https://github.com/gutow"
}
```

Replying to [comment:8 kcrisman]:
> Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.

JSmol and Jmol work without the backend.  The backend is presently just used to make the nice static pictures, without it a less pretty Tachyon image is generated.  Ultimately, the backend should be used to package the data as well.  The present packaging method is not terribly efficient or flexible.

It is quite possible that the wiki is behind.  I'll put it on our todo list.



---

archive/issue_comments_226260.json:
```json
{
    "body": "> > Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.\n\n> JSmol and Jmol work without the backend.  The backend is presently just used to make the nice static pictures, without it a less pretty Tachyon image is generated.  Ultimately, the backend should be used to package the data as well.  The present packaging method is not terribly efficient or flexible.\n\nWait, wait.  So is Java 1.7+ necessary to view Jmol applets from the command line?  Exactly what is it that needs 1.7?  If it's just the static images, then we could fail gracefully in the notebook to Tachyon images when the Java is not recent enough.   If I'm not understanding this properly, sorry for the noise.",
    "created_at": "2014-11-03T19:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226260",
    "user": "https://github.com/kcrisman"
}
```

> > Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.

> JSmol and Jmol work without the backend.  The backend is presently just used to make the nice static pictures, without it a less pretty Tachyon image is generated.  Ultimately, the backend should be used to package the data as well.  The present packaging method is not terribly efficient or flexible.

Wait, wait.  So is Java 1.7+ necessary to view Jmol applets from the command line?  Exactly what is it that needs 1.7?  If it's just the static images, then we could fail gracefully in the notebook to Tachyon images when the Java is not recent enough.   If I'm not understanding this properly, sorry for the noise.



---

archive/issue_comments_226261.json:
```json
{
    "body": "Replying to [comment:10 kcrisman]:\n> Wait, wait.  So is Java 1.7+ necessary to view Jmol applets from the command line?  Exactly what is it that needs 1.7?  \n\nYes, because from the command line you run the Jmol application which is a java application and now requires a recent JVM.  A side note.  I looked carefully at how we comile Jmol. Interestingly, we actually compile Jmol to be 1.6+ compatible, but it looks like the external gettext libraries now require 1.7+ and we're not about to rewrite those.  So people may only run into this problem if they are using translations.\n>If it's just the static images, then we could fail gracefully in the notebook to Tachyon images when the Java is not recent enough.   If I'm not understanding this properly, sorry for the noise.\n\nWe already do that except that we were still accepting JVM >1.5, which no longer works.  I think we have to accept only 1.7+.",
    "created_at": "2014-11-03T21:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226261",
    "user": "https://github.com/gutow"
}
```

Replying to [comment:10 kcrisman]:
> Wait, wait.  So is Java 1.7+ necessary to view Jmol applets from the command line?  Exactly what is it that needs 1.7?  

Yes, because from the command line you run the Jmol application which is a java application and now requires a recent JVM.  A side note.  I looked carefully at how we comile Jmol. Interestingly, we actually compile Jmol to be 1.6+ compatible, but it looks like the external gettext libraries now require 1.7+ and we're not about to rewrite those.  So people may only run into this problem if they are using translations.
>If it's just the static images, then we could fail gracefully in the notebook to Tachyon images when the Java is not recent enough.   If I'm not understanding this properly, sorry for the noise.

We already do that except that we were still accepting JVM >1.5, which no longer works.  I think we have to accept only 1.7+.



---

archive/issue_comments_226262.json:
```json
{
    "body": "OK thanks for all that information it is time to start committing now. There is the spot mentioned above and at least one that I can easily find in the FAQ. I should be done with those in the next 15mn.",
    "created_at": "2014-11-03T21:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226262",
    "user": "https://github.com/kiwifb"
}
```

OK thanks for all that information it is time to start committing now. There is the spot mentioned above and at least one that I can easily find in the FAQ. I should be done with those in the next 15mn.



---

archive/issue_comments_226263.json:
```json
{
    "body": "OK minimal change in the code but the documentation clearly needs a dusting. Especially in the wake of jsmol. Someone should review what I wrote and may be come with a paragraph about it.\n\n---\nNew commits:",
    "created_at": "2014-11-03T21:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226263",
    "user": "https://github.com/kiwifb"
}
```

OK minimal change in the code but the documentation clearly needs a dusting. Especially in the wake of jsmol. Someone should review what I wrote and may be come with a paragraph about it.

---
New commits:



---

archive/issue_comments_226264.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-03T21:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226264",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226265.json:
```json
{
    "body": "Something has happened to the trac changelog.  I get an error about malformed xml when I try git trac checkout.",
    "created_at": "2014-11-03T22:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226265",
    "user": "https://github.com/gutow"
}
```

Something has happened to the trac changelog.  I get an error about malformed xml when I try git trac checkout.



---

archive/issue_comments_226266.json:
```json
{
    "body": "OK, I was able to clone the branch...I'll work with that.",
    "created_at": "2014-11-03T23:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226266",
    "user": "https://github.com/gutow"
}
```

OK, I was able to clone the branch...I'll work with that.



---

archive/issue_comments_226267.json:
```json
{
    "body": "That didn't work either.  I'll just hand copy the patch...",
    "created_at": "2014-11-03T23:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226267",
    "user": "https://github.com/gutow"
}
```

That didn't work either.  I'll just hand copy the patch...



---

archive/issue_comments_226268.json:
```json
{
    "body": "Please correct my cruft while you are at it: \"use at a Java\" yuk.",
    "created_at": "2014-11-04T00:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226268",
    "user": "https://github.com/kiwifb"
}
```

Please correct my cruft while you are at it: "use at a Java" yuk.



---

archive/issue_comments_226269.json:
```json
{
    "body": "OK, I think this last commit is a reasonable update to the faq.\n\n---\nNew commits:",
    "created_at": "2014-11-04T01:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226269",
    "user": "https://github.com/gutow"
}
```

OK, I think this last commit is a reasonable update to the faq.

---
New commits:



---

archive/issue_comments_226270.json:
```json
{
    "body": "No! 'sage -dev push --ticket 17279' only seems to have added the last couple of lines of the rewrite.  I'm giving up on the trac/git combination.  Here's the corrected text.\n\nThe default live 3-D plotting for Sage 6.4+ uses\n`Jmol/JSmol <http://jmol.sourceforge.net>`_\nfor viewing. From the command line the Jmol Java application is used,\nand for in browser viewing either pure javascript or a Java applet\nis used.  By default in browsers pure javascript is used to avoid\nthe problems with some browsers that do not support java applet\nplugins (namely Chrome).  On each browser worksheet there is a\ncheckbox which must be checked before a 3-D plot is generated if\nthe user wants to use the Java applet (the applet is a little faster\nwith complex plots).\nThe most likely reason for a malfunction is that you do not have\na Java Run Time Environment (JRE) installed or you have one older than\nversion 1.7.  If things work from the command line another possibility\nis that your browser does not have the proper plugin to support Java\napplets (at present, 2014, plugins do not work with most versions of\nChrome).  Make sure you have installed either the IcedTea browser\nplugin (for linux see your package manager), see:\n`IcedTea <http://icedtea.classpath.org/wiki/IcedTea-Web>`_,\nor the Oracle Java plugin see:\n`Java <https://java.com/en/download/help/index_installing.xml>`_.\n\nIf you are using a Sage server over the web and even javascript rendering \ndoes not work, you may have a problem with your browser's javascript\nengine or have it turned off.",
    "created_at": "2014-11-04T01:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226270",
    "user": "https://github.com/gutow"
}
```

No! 'sage -dev push --ticket 17279' only seems to have added the last couple of lines of the rewrite.  I'm giving up on the trac/git combination.  Here's the corrected text.

The default live 3-D plotting for Sage 6.4+ uses
`Jmol/JSmol <http://jmol.sourceforge.net>`_
for viewing. From the command line the Jmol Java application is used,
and for in browser viewing either pure javascript or a Java applet
is used.  By default in browsers pure javascript is used to avoid
the problems with some browsers that do not support java applet
plugins (namely Chrome).  On each browser worksheet there is a
checkbox which must be checked before a 3-D plot is generated if
the user wants to use the Java applet (the applet is a little faster
with complex plots).
The most likely reason for a malfunction is that you do not have
a Java Run Time Environment (JRE) installed or you have one older than
version 1.7.  If things work from the command line another possibility
is that your browser does not have the proper plugin to support Java
applets (at present, 2014, plugins do not work with most versions of
Chrome).  Make sure you have installed either the IcedTea browser
plugin (for linux see your package manager), see:
`IcedTea <http://icedtea.classpath.org/wiki/IcedTea-Web>`_,
or the Oracle Java plugin see:
`Java <https://java.com/en/download/help/index_installing.xml>`_.

If you are using a Sage server over the web and even javascript rendering 
does not work, you may have a problem with your browser's javascript
engine or have it turned off.



---

archive/issue_comments_226271.json:
```json
{
    "body": "I'm confused.  This commit \u200b656c12 looks OK, but the final commit only has the last couple of lines.  It appears that resolving the conflict between the two updates confused things.  Or am I just not understanding?",
    "created_at": "2014-11-04T01:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226271",
    "user": "https://github.com/gutow"
}
```

I'm confused.  This commit ​656c12 looks OK, but the final commit only has the last couple of lines.  It appears that resolving the conflict between the two updates confused things.  Or am I just not understanding?



---

archive/issue_comments_226272.json:
```json
{
    "body": "I am sure you did it the recommended way but it is all there. Thank you for rewriting that bit of faq.",
    "created_at": "2014-11-04T01:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226272",
    "user": "https://github.com/kiwifb"
}
```

I am sure you did it the recommended way but it is all there. Thank you for rewriting that bit of faq.



---

archive/issue_comments_226273.json:
```json
{
    "body": "This is pretty awesome, thanks.  I can't test this since I don't have a bad java :-) but presumably Jeroen can and of course the change is quite minimal.  In terms of the doc, I would just suggest that\n\n```\n+with complex plots).\n+The most likely reason for a malfunction is that you do not have\n```\nhave a newline in between, because otherwise Sphinx will turn it into one enormous paragraph, I think.  Nice work!",
    "created_at": "2014-11-04T14:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226273",
    "user": "https://github.com/kcrisman"
}
```

This is pretty awesome, thanks.  I can't test this since I don't have a bad java :-) but presumably Jeroen can and of course the change is quite minimal.  In terms of the doc, I would just suggest that

```
+with complex plots).
+The most likely reason for a malfunction is that you do not have
```
have a newline in between, because otherwise Sphinx will turn it into one enormous paragraph, I think.  Nice work!



---

archive/issue_comments_226274.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-04T21:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226274",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226275.json:
```json
{
    "body": "Done. Putting this to positive review then.\n  \n---\nNew commits:",
    "created_at": "2014-11-04T21:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226275",
    "user": "https://github.com/kiwifb"
}
```

Done. Putting this to positive review then.
  
---
New commits:



---

archive/issue_comments_226276.json:
```json
{
    "body": "Great.",
    "created_at": "2014-11-05T12:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226276",
    "user": "https://github.com/kcrisman"
}
```

Great.



---

archive/issue_events_049958.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-06T11:15:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17279#event-49958"
}
```



---

archive/issue_comments_226277.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-06T11:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17279",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17279#issuecomment-226277",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
