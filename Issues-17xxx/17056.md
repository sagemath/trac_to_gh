# Issue 17056: Bugs in WordDatatype_char

archive/issues_016819.json:
```json
{
    "assignees": [],
    "body": "There are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):\n- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption\n- in `__getitem__` we had\n\n  ```\n  sage: W = Words([0,1,2])\n  sage: w = W([0,1,0])\n  sage: w[1:0]\n  word: ... <RANDOM STUFF> ...\n  ```\n\nCC:  @seblabbe @staroste @sagetrac-tmonteil\n\nBranch/Commit: **[19f6c25](https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17056_\n\n",
    "closed_at": "2014-09-29T11:17:38Z",
    "created_at": "2014-09-27T18:05:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Bugs in WordDatatype_char",
    "type": "issue",
    "updated_at": "2014-09-29T11:17:38Z",
    "url": "https://github.com/sagemath/sage/issues/17056",
    "user": "https://github.com/videlec"
}
```
There are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):
- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption
- in `__getitem__` we had

  ```
  sage: W = Words([0,1,2])
  sage: w = W([0,1,0])
  sage: w[1:0]
  word: ... <RANDOM STUFF> ...
  ```

CC:  @seblabbe @staroste @sagetrac-tmonteil

Branch/Commit: **[19f6c25](https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece)**

Reviewer: **Sébastien Labbé**

Author: **Vincent Delecroix**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/17056_





---

archive/issue_events_243732.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-27T18:05:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243732"
}
```



---

archive/issue_events_243733.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-27T18:05:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243733"
}
```



---

archive/issue_events_243734.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-27T18:05:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243734"
}
```



---

archive/issue_events_243735.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-27T18:05:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243735"
}
```



---

archive/issue_comments_226021.json:
```json
{
    "body": "Commit: **[4197626](https://github.com/sagemath/sagetrac-mirror/commit/419762682297b1514e70f8972e6634c2eb770ca0)**",
    "created_at": "2014-09-27T18:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226021",
    "user": "https://github.com/videlec"
}
```

Commit: **[4197626](https://github.com/sagemath/sagetrac-mirror/commit/419762682297b1514e70f8972e6634c2eb770ca0)**



---

archive/issue_comments_226022.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/419762682297b1514e70f8972e6634c2eb770ca0\">4197626</a></td><td><code>trac #17056: correct `__dealloc__` and __getitem__</code></td></tr></table>\n",
    "created_at": "2014-09-27T18:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226022",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/419762682297b1514e70f8972e6634c2eb770ca0">4197626</a></td><td><code>trac #17056: correct `__dealloc__` and __getitem__</code></td></tr></table>




---

archive/issue_comments_226023.json:
```json
{
    "body": "Branch: **[u/vdelecroix/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17056)**",
    "created_at": "2014-09-27T18:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226023",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17056)**



---

archive/issue_events_243736.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-27T18:07:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243736"
}
```



---

archive/issue_comments_226024.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nrebased on 6.4.beta4",
    "created_at": "2014-09-27T18:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226024",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">comment:3</div>

rebased on 6.4.beta4



---

archive/issue_comments_226025.json:
```json
{
    "body": "Changed commit from **[4197626](https://github.com/sagemath/sagetrac-mirror/commit/419762682297b1514e70f8972e6634c2eb770ca0)** to **[5b5d485](https://github.com/sagemath/sagetrac-mirror/commit/5b5d4859c20be447ce3aa72d53fd680fec3ea0ab)**",
    "created_at": "2014-09-27T18:37:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226025",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4197626](https://github.com/sagemath/sagetrac-mirror/commit/419762682297b1514e70f8972e6634c2eb770ca0)** to **[5b5d485](https://github.com/sagemath/sagetrac-mirror/commit/5b5d4859c20be447ce3aa72d53fd680fec3ea0ab)**



---

archive/issue_comments_226026.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b5d4859c20be447ce3aa72d53fd680fec3ea0ab\">5b5d485</a></td><td><code>trac #17056: correct `__dealloc__` and __getitem__</code></td></tr></table>\n",
    "created_at": "2014-09-27T18:37:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226026",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b5d4859c20be447ce3aa72d53fd680fec3ea0ab">5b5d485</a></td><td><code>trac #17056: correct `__dealloc__` and __getitem__</code></td></tr></table>




---

archive/issue_comments_226027.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWith #17013, I can not reproduce the second problem:\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([0,1,0])\nsage: w[:0]\nword:\n```\n\nAlso, can you provide an example so that I can reproduce the first problem?\n\nS\u00e9bastien",
    "created_at": "2014-09-27T20:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226027",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:5" align="right">comment:5</div>

With #17013, I can not reproduce the second problem:

```
sage: W = Words([0,1,2])
sage: w = W([0,1,0])
sage: w[:0]
word:
```

Also, can you provide an example so that I can reproduce the first problem?

Sébastien



---

archive/issue_comments_226028.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,6 @@\n   ```\n   sage: W = Words([0,1,2])\n   sage: w = W([0,1,0])\n-  sage: w[:0]\n+  sage: w[1:0]\n   word: ... <RANDOM STUFF> ...\n   ```\n``````\n",
    "created_at": "2014-09-28T09:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226028",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,6 @@
   ```
   sage: W = Words([0,1,2])
   sage: w = W([0,1,0])
-  sage: w[:0]
+  sage: w[1:0]
   word: ... <RANDOM STUFF> ...
   ```
``````




---

archive/issue_comments_226029.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHello,\n\nSorry, I was wrong it is `w[1:0]` which is bad.\n\nFor the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([randint(0,2) for _ in range(100)])\nsage: u = w[10:-10]\nsage: c = [u.number_of_factors(n) for n in range(20)]\nsage: quit\n<BOOM>\n```\n\nVincent",
    "created_at": "2014-09-28T09:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226029",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Hello,

Sorry, I was wrong it is `w[1:0]` which is bad.

For the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try

```
sage: W = Words([0,1,2])
sage: w = W([randint(0,2) for _ in range(100)])
sage: u = w[10:-10]
sage: c = [u.number_of_factors(n) for n in range(20)]
sage: quit
<BOOM>
```

Vincent



---

archive/issue_events_243737.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2014-09-28T17:54:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243737"
}
```



---

archive/issue_events_243738.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2014-09-28T17:54:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243738"
}
```



---

archive/issue_comments_226030.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nCan you change the new doctest so that it tests `w[1:0]` instead?",
    "created_at": "2014-09-28T17:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226030",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:7" align="right">comment:7</div>

Can you change the new doctest so that it tests `w[1:0]` instead?



---

archive/issue_events_243739.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2014-09-28T18:42:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243739"
}
```



---

archive/issue_events_243740.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2014-09-28T18:42:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243740"
}
```



---

archive/issue_comments_226031.json:
```json
{
    "body": "Changed commit from **[5b5d485](https://github.com/sagemath/sagetrac-mirror/commit/5b5d4859c20be447ce3aa72d53fd680fec3ea0ab)** to **[19f6c25](https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece)**",
    "created_at": "2014-09-28T18:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226031",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[5b5d485](https://github.com/sagemath/sagetrac-mirror/commit/5b5d4859c20be447ce3aa72d53fd680fec3ea0ab)** to **[19f6c25](https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece)**



---

archive/issue_comments_226032.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece\">19f6c25</a></td><td><code>Trac #17056: fix doctest</code></td></tr></table>\n",
    "created_at": "2014-09-28T18:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226032",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:8"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece">19f6c25</a></td><td><code>Trac #17056: fix doctest</code></td></tr></table>




---

archive/issue_comments_226033.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17056)** to **[u/slabbe/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17056)**",
    "created_at": "2014-09-28T18:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226033",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[u/vdelecroix/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17056)** to **[u/slabbe/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17056)**



---

archive/issue_comments_226034.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2014-09-28T18:43:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226034",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_226035.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHa nice. Thanks for the fix (I was out).\n\nVincent",
    "created_at": "2014-09-28T21:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226035",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

Ha nice. Thanks for the fix (I was out).

Vincent



---

archive/issue_events_243741.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-29T11:17:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243741"
}
```



---

archive/issue_events_243742.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1f0f359be1d2c76fce7ad22b87132271eecca169",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-29T11:17:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17056#event-243742"
}
```



---

archive/issue_comments_226036.json:
```json
{
    "body": "Changed branch from **[u/slabbe/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17056)** to **[19f6c25](https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece)**",
    "created_at": "2014-09-29T11:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17056#issuecomment-226036",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/slabbe/17056](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17056)** to **[19f6c25](https://github.com/sagemath/sagetrac-mirror/commit/19f6c25ece6a3159fd5e2bfdd5291aa470012ece)**
