# Issue 17056: Bugs in WordDatatype_char

archive/issues_016819.json:
```json
{
    "body": "There are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):\n- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption\n- in `__getitem__` we had\n  {{{\n  sage: W = Words([0,1,2])\n  sage: w = W([0,1,0])\n  sage: w[1:0]\n  word: ... <RANDOM STUFF> ...\n  }}}\n\nCC:  @seblabbe @staroste tmonteil\n\nBranch/Commit: 19f6c25ece6a3159fd5e2bfdd5291aa470012ece\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Vincent Delecroix\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17056\n\n",
    "closed_at": "2014-09-29T11:17:38Z",
    "created_at": "2014-09-27T18:05:12Z",
    "labels": [
        "component: combinatorics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Bugs in WordDatatype_char",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17056",
    "user": "https://github.com/videlec"
}
```
There are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):
- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption
- in `__getitem__` we had
  {{{
  sage: W = Words([0,1,2])
  sage: w = W([0,1,0])
  sage: w[1:0]
  word: ... <RANDOM STUFF> ...
  }}}

CC:  @seblabbe @staroste tmonteil

Branch/Commit: 19f6c25ece6a3159fd5e2bfdd5291aa470012ece

Reviewer: Sébastien Labbé

Author: Vincent Delecroix

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17056





---

archive/issue_comments_287115.json:
```json
{
    "body": "Changing commit from \"\" to \"419762682297b1514e70f8972e6634c2eb770ca0\"",
    "created_at": "2014-09-27T18:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287115",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "419762682297b1514e70f8972e6634c2eb770ca0"



---

archive/issue_comments_287116.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[4197626](http://git.sagemath.org/sage.git/commit/?id=419762682297b1514e70f8972e6634c2eb770ca0)|`trac #17056: correct __dealloc__ and __getitem__`|",
    "created_at": "2014-09-27T18:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287116",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[4197626](http://git.sagemath.org/sage.git/commit/?id=419762682297b1514e70f8972e6634c2eb770ca0)|`trac #17056: correct __dealloc__ and __getitem__`|



---

archive/issue_comments_287117.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/17056\"",
    "created_at": "2014-09-27T18:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287117",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/17056"



---

archive/issue_comments_287118.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-27T18:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287118",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_287119.json:
```json
{
    "body": "<a id='comment:3'></a>\nrebased on 6.4.beta4",
    "created_at": "2014-09-27T18:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287119",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
rebased on 6.4.beta4



---

archive/issue_comments_287120.json:
```json
{
    "body": "Changing commit from \"419762682297b1514e70f8972e6634c2eb770ca0\" to \"5b5d4859c20be447ce3aa72d53fd680fec3ea0ab\"",
    "created_at": "2014-09-27T18:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "419762682297b1514e70f8972e6634c2eb770ca0" to "5b5d4859c20be447ce3aa72d53fd680fec3ea0ab"



---

archive/issue_comments_287121.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[5b5d485](http://git.sagemath.org/sage.git/commit/?id=5b5d4859c20be447ce3aa72d53fd680fec3ea0ab)|`trac #17056: correct __dealloc__ and __getitem__`|",
    "created_at": "2014-09-27T18:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[5b5d485](http://git.sagemath.org/sage.git/commit/?id=5b5d4859c20be447ce3aa72d53fd680fec3ea0ab)|`trac #17056: correct __dealloc__ and __getitem__`|



---

archive/issue_comments_287122.json:
```json
{
    "body": "<a id='comment:5'></a>\nWith #17013, I can not reproduce the second problem:\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([0,1,0])\nsage: w[:0]\nword:\n```\n\nAlso, can you provide an example so that I can reproduce the first problem?\n\nS\u00e9bastien",
    "created_at": "2014-09-27T20:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287122",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:5'></a>
With #17013, I can not reproduce the second problem:

```
sage: W = Words([0,1,2])
sage: w = W([0,1,0])
sage: w[:0]
word:
```

Also, can you provide an example so that I can reproduce the first problem?

Sébastien



---

archive/issue_comments_287123.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n   {{{\n   sage: W = Words([0,1,2])\n   sage: w = W([0,1,0])\n-  sage: w[:0]\n+  sage: w[1:0]\n   word: ... <RANDOM STUFF> ...\n   }}}\n``````\n",
    "created_at": "2014-09-28T09:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287123",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
   {{{
   sage: W = Words([0,1,2])
   sage: w = W([0,1,0])
-  sage: w[:0]
+  sage: w[1:0]
   word: ... <RANDOM STUFF> ...
   }}}
``````




---

archive/issue_comments_287124.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello,\n\nSorry, I was wrong it is `w[1:0]` which is bad.\n\nFor the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([randint(0,2) for _ in range(100)])\nsage: u = w[10:-10]\nsage: c = [u.number_of_factors(n) for n in range(20)]\nsage: quit\n<BOOM>\n```\n\nVincent",
    "created_at": "2014-09-28T09:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287124",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Hello,

Sorry, I was wrong it is `w[1:0]` which is bad.

For the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try

```
sage: W = Words([0,1,2])
sage: w = W([randint(0,2) for _ in range(100)])
sage: u = w[10:-10]
sage: c = [u.number_of_factors(n) for n in range(20)]
sage: quit
<BOOM>
```

Vincent



---

archive/issue_comments_287125.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-28T17:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287125",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_287126.json:
```json
{
    "body": "<a id='comment:7'></a>\nCan you change the new doctest so that it tests `w[1:0]` instead?",
    "created_at": "2014-09-28T17:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287126",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>
Can you change the new doctest so that it tests `w[1:0]` instead?



---

archive/issue_comments_287127.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-28T18:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287127",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_287128.json:
```json
{
    "body": "Changing commit from \"5b5d4859c20be447ce3aa72d53fd680fec3ea0ab\" to \"19f6c25ece6a3159fd5e2bfdd5291aa470012ece\"",
    "created_at": "2014-09-28T18:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287128",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "5b5d4859c20be447ce3aa72d53fd680fec3ea0ab" to "19f6c25ece6a3159fd5e2bfdd5291aa470012ece"



---

archive/issue_comments_287129.json:
```json
{
    "body": "<a id='comment:8'></a>\nNew commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[19f6c25](http://git.sagemath.org/sage.git/commit/?id=19f6c25ece6a3159fd5e2bfdd5291aa470012ece)|`Trac #17056: fix doctest`|",
    "created_at": "2014-09-28T18:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287129",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:8'></a>
New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[19f6c25](http://git.sagemath.org/sage.git/commit/?id=19f6c25ece6a3159fd5e2bfdd5291aa470012ece)|`Trac #17056: fix doctest`|



---

archive/issue_comments_287130.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/17056\" to \"u/slabbe/17056\"",
    "created_at": "2014-09-28T18:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287130",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "u/vdelecroix/17056" to "u/slabbe/17056"



---

archive/issue_comments_287131.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2014-09-28T18:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287131",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_287132.json:
```json
{
    "body": "<a id='comment:10'></a>\nHa nice. Thanks for the fix (I was out).\n\nVincent",
    "created_at": "2014-09-28T21:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287132",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
Ha nice. Thanks for the fix (I was out).

Vincent



---

archive/issue_events_049615.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-29T11:17:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17056#event-49615"
}
```



---

archive/issue_comments_287133.json:
```json
{
    "body": "Changing branch from \"u/slabbe/17056\" to \"19f6c25ece6a3159fd5e2bfdd5291aa470012ece\"",
    "created_at": "2014-09-29T11:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287133",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/slabbe/17056" to "19f6c25ece6a3159fd5e2bfdd5291aa470012ece"



---

archive/issue_comments_287134.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-29T11:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17056#issuecomment-287134",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
