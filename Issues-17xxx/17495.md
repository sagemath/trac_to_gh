# Issue 17495: Fix refine_embedding when some but not all embeddings are real

archive/issues_017258.json:
```json
{
    "body": "The number field below has one real embedding and two complex embeddings. These complex embeddings should be ignored in `refine_embedding`, but that's not the case, causing\n\n```\nsage: K.<a> = NumberField(x^3 + x - 1, embedding=0.68)\nsage: from sage.rings.number_field.number_field import refine_embedding\nsage: refine_embedding(K.specified_complex_embedding(), 200)\nTraceback (most recent call last):\n...\nTypeError: Unable to convert number to real interval.\n```\n\nBranch/Commit: 8aac6fac1c438fca5defd9b4418c0ea0c541f7ea\n\nReviewer: Jeroen Demeyer\n\nAuthor: Martin von Gagern\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17495\n\n",
    "closed_at": "2014-12-18T00:57:14Z",
    "created_at": "2014-12-13T13:22:26Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Fix refine_embedding when some but not all embeddings are real",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17495",
    "user": "https://github.com/jdemeyer"
}
```
The number field below has one real embedding and two complex embeddings. These complex embeddings should be ignored in `refine_embedding`, but that's not the case, causing

```
sage: K.<a> = NumberField(x^3 + x - 1, embedding=0.68)
sage: from sage.rings.number_field.number_field import refine_embedding
sage: refine_embedding(K.specified_complex_embedding(), 200)
Traceback (most recent call last):
...
TypeError: Unable to convert number to real interval.
```

Branch/Commit: 8aac6fac1c438fca5defd9b4418c0ea0c541f7ea

Reviewer: Jeroen Demeyer

Author: Martin von Gagern

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17495





---

archive/issue_comments_297565.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gagern/ticket/17495\"",
    "created_at": "2014-12-15T09:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297565",
    "user": "https://github.com/gagern"
}
```

Changing branch from "" to "u/gagern/ticket/17495"



---

archive/issue_comments_297566.json:
```json
{
    "body": "Changing author from \"\" to \"Martin von Gagern\"",
    "created_at": "2014-12-15T09:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297566",
    "user": "https://github.com/gagern"
}
```

Changing author from "" to "Martin von Gagern"



---

archive/issue_comments_297567.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[f30d693](http://git.sagemath.org/sage.git/commit/?id=f30d693c593fcf8de8500c6821f2beff4c56c3a4)|`Only consider real embeddings if old embedding is into real lazy field.`|",
    "created_at": "2014-12-15T09:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297567",
    "user": "https://github.com/gagern"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[f30d693](http://git.sagemath.org/sage.git/commit/?id=f30d693c593fcf8de8500c6821f2beff4c56c3a4)|`Only consider real embeddings if old embedding is into real lazy field.`|



---

archive/issue_comments_297568.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-15T09:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297568",
    "user": "https://github.com/gagern"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_297569.json:
```json
{
    "body": "Changing commit from \"\" to \"f30d693c593fcf8de8500c6821f2beff4c56c3a4\"",
    "created_at": "2014-12-15T09:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297569",
    "user": "https://github.com/gagern"
}
```

Changing commit from "" to "f30d693c593fcf8de8500c6821f2beff4c56c3a4"



---

archive/issue_comments_297570.json:
```json
{
    "body": "Changing commit from \"f30d693c593fcf8de8500c6821f2beff4c56c3a4\" to \"cbe823a5dc0f0d31ada9afbf4003c386d964e221\"",
    "created_at": "2014-12-15T09:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f30d693c593fcf8de8500c6821f2beff4c56c3a4" to "cbe823a5dc0f0d31ada9afbf4003c386d964e221"



---

archive/issue_comments_297571.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[cbe823a](http://git.sagemath.org/sage.git/commit/?id=cbe823a5dc0f0d31ada9afbf4003c386d964e221)|`When determining embeddings, leave coefficients rational.`|",
    "created_at": "2014-12-15T09:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[cbe823a](http://git.sagemath.org/sage.git/commit/?id=cbe823a5dc0f0d31ada9afbf4003c386d964e221)|`When determining embeddings, leave coefficients rational.`|



---

archive/issue_comments_297572.json:
```json
{
    "body": "<a id='comment:4'></a>\nRegarding my second commit:\n\n```\nsage: f = QQ[x](69721504*x^8 + 251777664*x^6 + 329532012*x^4 + 184429548*x^2 + 37344321)\nsage: %timeit CDF[x](f).roots()\n1000 loops, best of 3: 525 \u00b5s per loop\nsage: %timeit f.roots(CDF)\n1000 loops, best of 3: 465 \u00b5s per loop\nsage: %timeit QQbar[x](f).roots()\n10 loops, best of 3: 24.4 ms per loop\nsage: %timeit f.roots(QQbar)\n10 loops, best of 3: 20.8 ms per loop\n```\n\nSo using `f.roots(K)` should be better than `K['x'](f)` in pretty much all cases.",
    "created_at": "2014-12-15T09:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297572",
    "user": "https://github.com/gagern"
}
```

<a id='comment:4'></a>
Regarding my second commit:

```
sage: f = QQ[x](69721504*x^8 + 251777664*x^6 + 329532012*x^4 + 184429548*x^2 + 37344321)
sage: %timeit CDF[x](f).roots()
1000 loops, best of 3: 525 µs per loop
sage: %timeit f.roots(CDF)
1000 loops, best of 3: 465 µs per loop
sage: %timeit QQbar[x](f).roots()
10 loops, best of 3: 24.4 ms per loop
sage: %timeit f.roots(QQbar)
10 loops, best of 3: 20.8 ms per loop
```

So using `f.roots(K)` should be better than `K['x'](f)` in pretty much all cases.



---

archive/issue_comments_297573.json:
```json
{
    "body": "<a id='comment:5'></a>\nPlease make this two lines:\n\n```\nr = f.roots(K, False); r.sort()\n```",
    "created_at": "2014-12-15T22:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297573",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Please make this two lines:

```
r = f.roots(K, False); r.sort()
```



---

archive/issue_comments_297574.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-15T22:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297574",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_297575.json:
```json
{
    "body": "<a id='comment:6'></a>\nand use `f.roots(K, multiplicities=False)`, which is much more explicit.",
    "created_at": "2014-12-15T22:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297575",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
and use `f.roots(K, multiplicities=False)`, which is much more explicit.



---

archive/issue_comments_297576.json:
```json
{
    "body": "<a id='comment:7'></a>\nFor the example you added, could you do it also for `prec=Infinity`?",
    "created_at": "2014-12-15T22:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297576",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
For the example you added, could you do it also for `prec=Infinity`?



---

archive/issue_comments_297577.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[8aac6fa](http://git.sagemath.org/sage.git/commit/?id=8aac6fac1c438fca5defd9b4418c0ea0c541f7ea)|`Minor improvements regarding number field embeddings.`|",
    "created_at": "2014-12-15T22:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297577",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[8aac6fa](http://git.sagemath.org/sage.git/commit/?id=8aac6fac1c438fca5defd9b4418c0ea0c541f7ea)|`Minor improvements regarding number field embeddings.`|



---

archive/issue_comments_297578.json:
```json
{
    "body": "Changing commit from \"cbe823a5dc0f0d31ada9afbf4003c386d964e221\" to \"8aac6fac1c438fca5defd9b4418c0ea0c541f7ea\"",
    "created_at": "2014-12-15T22:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297578",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cbe823a5dc0f0d31ada9afbf4003c386d964e221" to "8aac6fac1c438fca5defd9b4418c0ea0c541f7ea"



---

archive/issue_comments_297579.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-15T22:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297579",
    "user": "https://github.com/gagern"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_297580.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-12-16T21:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297580",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_297581.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-16T21:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297581",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_297582.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-18T00:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297582",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050298.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-18T00:57:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17495#event-50298"
}
```



---

archive/issue_comments_297583.json:
```json
{
    "body": "Changing branch from \"u/gagern/ticket/17495\" to \"8aac6fac1c438fca5defd9b4418c0ea0c541f7ea\"",
    "created_at": "2014-12-18T00:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17495#issuecomment-297583",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gagern/ticket/17495" to "8aac6fac1c438fca5defd9b4418c0ea0c541f7ea"
