# Issue 17135: Compute diameter using 2sweep, 4sweep and iFUB

archive/issues_016898.json:
```json
{
    "body": "This patch implements:\n- 2sweep and 4sweep lower bounds on the diameter of a graph\n- iFUB, an exact and fast algorithm for computing the diameter of a graph\n\n```\nsage: G = graphs.RandomBarabasiAlbert(1000,2)\nsage: %time G.diameter('standard')\nCPU times: user 44 ms, sys: 0 ns, total: 44 ms\nWall time: 42.7 ms\n7\nsage: %time G.diameter('iFUB')\nCPU times: user 24 ms, sys: 1 ms, total: 25 ms\nWall time: 23.6 ms\n7\n\nsage: G = graphs.RandomBarabasiAlbert(10000,2)\nsage: %time G.diameter('standard')\nCPU times: user 3.49 s, sys: 1 ms, total: 3.49 s\nWall time: 3.49 s\n9\nsage: %time G.diameter('iFUB')\nCPU times: user 336 ms, sys: 2 ms, total: 338 ms\nWall time: 333 ms\n9\n```\n\nThe running time of the iFUB method depends on many parameters but is in general faster than previous methods.\n\n```\nsage: G = graphs.Grid2dGraph(50,50)\nsage: %time G.diameter('standard')\nCPU times: user 138 ms, sys: 2 ms, total: 140 ms\nWall time: 139 ms\n98\nsage: %time G.diameter('iFUB')\nCPU times: user 80 ms, sys: 2 ms, total: 82 ms\nWall time: 80.5 ms\n98\nsage: V = G.vertices()\nsage: shuffle(V)\nsage: G.relabel(inplace=True, perm=V)\nsage: %time G.diameter('iFUB')\nCPU times: user 35 ms, sys: 1 ms, total: 36 ms\nWall time: 33.4 ms\n98\nsage: shuffle(V)\nsage: G.relabel(inplace=True, perm=V)\nsage: %time G.diameter('iFUB')\nCPU times: user 35 ms, sys: 1 ms, total: 36 ms\nWall time: 34.2 ms\n98\n```\n\n\nCC:  @nathanncohen\n\nBranch/Commit: 69cb552df487c204e8590a9421e44c044983f8c0\n\nReviewer: Nathann Cohen\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17135\n\n",
    "closed_at": "2014-11-15T16:18:55Z",
    "created_at": "2014-10-11T15:17:17Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Compute diameter using 2sweep, 4sweep and iFUB",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17135",
    "user": "https://github.com/dcoudert"
}
```
This patch implements:
- 2sweep and 4sweep lower bounds on the diameter of a graph
- iFUB, an exact and fast algorithm for computing the diameter of a graph

```
sage: G = graphs.RandomBarabasiAlbert(1000,2)
sage: %time G.diameter('standard')
CPU times: user 44 ms, sys: 0 ns, total: 44 ms
Wall time: 42.7 ms
7
sage: %time G.diameter('iFUB')
CPU times: user 24 ms, sys: 1 ms, total: 25 ms
Wall time: 23.6 ms
7

sage: G = graphs.RandomBarabasiAlbert(10000,2)
sage: %time G.diameter('standard')
CPU times: user 3.49 s, sys: 1 ms, total: 3.49 s
Wall time: 3.49 s
9
sage: %time G.diameter('iFUB')
CPU times: user 336 ms, sys: 2 ms, total: 338 ms
Wall time: 333 ms
9
```

The running time of the iFUB method depends on many parameters but is in general faster than previous methods.

```
sage: G = graphs.Grid2dGraph(50,50)
sage: %time G.diameter('standard')
CPU times: user 138 ms, sys: 2 ms, total: 140 ms
Wall time: 139 ms
98
sage: %time G.diameter('iFUB')
CPU times: user 80 ms, sys: 2 ms, total: 82 ms
Wall time: 80.5 ms
98
sage: V = G.vertices()
sage: shuffle(V)
sage: G.relabel(inplace=True, perm=V)
sage: %time G.diameter('iFUB')
CPU times: user 35 ms, sys: 1 ms, total: 36 ms
Wall time: 33.4 ms
98
sage: shuffle(V)
sage: G.relabel(inplace=True, perm=V)
sage: %time G.diameter('iFUB')
CPU times: user 35 ms, sys: 1 ms, total: 36 ms
Wall time: 34.2 ms
98
```


CC:  @nathanncohen

Branch/Commit: 69cb552df487c204e8590a9421e44c044983f8c0

Reviewer: Nathann Cohen

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17135





---

archive/issue_comments_288742.json:
```json
{
    "body": "Changing author from \"\" to \"David Coudert\"",
    "created_at": "2014-10-11T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288742",
    "user": "https://github.com/dcoudert"
}
```

Changing author from "" to "David Coudert"



---

archive/issue_comments_288743.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2014-10-11T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288743",
    "user": "https://github.com/dcoudert"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_288744.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-10-11T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288744",
    "user": "https://github.com/dcoudert"
}
```

Changing priority from major to minor.



---

archive/issue_comments_288745.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-\n+This patch implements:\n+- 2sweep and 4sweep lower bounds on the diameter of a graph\n+- iFUB, an exact and fast algorithm for computing the diameter of a graph\n``````\n",
    "created_at": "2014-10-11T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288745",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-
+This patch implements:
+- 2sweep and 4sweep lower bounds on the diameter of a graph
+- iFUB, an exact and fast algorithm for computing the diameter of a graph
``````




---

archive/issue_comments_288746.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-10-11T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288746",
    "user": "https://github.com/dcoudert"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_288747.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dcoudert/help\"",
    "created_at": "2014-10-11T16:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288747",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "u/dcoudert/help"



---

archive/issue_comments_288748.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,53 @@\n This patch implements:\n - 2sweep and 4sweep lower bounds on the diameter of a graph\n - iFUB, an exact and fast algorithm for computing the diameter of a graph\n+\n+```\n+sage: G = graphs.RandomBarabasiAlbert(1000,2)\n+sage: %time G.diameter('standard')\n+CPU times: user 44 ms, sys: 0 ns, total: 44 ms\n+Wall time: 42.7 ms\n+7\n+sage: %time G.diameter('iFUB')\n+CPU times: user 24 ms, sys: 1 ms, total: 25 ms\n+Wall time: 23.6 ms\n+7\n+\n+sage: G = graphs.RandomBarabasiAlbert(10000,2)\n+sage: %time G.diameter('standard')\n+CPU times: user 3.49 s, sys: 1 ms, total: 3.49 s\n+Wall time: 3.49 s\n+9\n+sage: %time G.diameter('iFUB')\n+CPU times: user 336 ms, sys: 2 ms, total: 338 ms\n+Wall time: 333 ms\n+9\n+```\n+\n+The running time of the iFUB method depends on many parameters but is in general faster than previous methods.\n+\n+```\n+sage: G = graphs.Grid2dGraph(50,50)\n+sage: %time G.diameter('standard')\n+CPU times: user 138 ms, sys: 2 ms, total: 140 ms\n+Wall time: 139 ms\n+98\n+sage: %time G.diameter('iFUB')\n+CPU times: user 80 ms, sys: 2 ms, total: 82 ms\n+Wall time: 80.5 ms\n+98\n+sage: V = G.vertices()\n+sage: shuffle(V)\n+sage: G.relabel(inplace=True, perm=V)\n+sage: %time G.diameter('iFUB')\n+CPU times: user 35 ms, sys: 1 ms, total: 36 ms\n+Wall time: 33.4 ms\n+98\n+sage: shuffle(V)\n+sage: G.relabel(inplace=True, perm=V)\n+sage: %time G.diameter('iFUB')\n+CPU times: user 35 ms, sys: 1 ms, total: 36 ms\n+Wall time: 34.2 ms\n+98\n+```\n+\n``````\n",
    "created_at": "2014-10-11T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288748",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,53 @@
 This patch implements:
 - 2sweep and 4sweep lower bounds on the diameter of a graph
 - iFUB, an exact and fast algorithm for computing the diameter of a graph
+
+```
+sage: G = graphs.RandomBarabasiAlbert(1000,2)
+sage: %time G.diameter('standard')
+CPU times: user 44 ms, sys: 0 ns, total: 44 ms
+Wall time: 42.7 ms
+7
+sage: %time G.diameter('iFUB')
+CPU times: user 24 ms, sys: 1 ms, total: 25 ms
+Wall time: 23.6 ms
+7
+
+sage: G = graphs.RandomBarabasiAlbert(10000,2)
+sage: %time G.diameter('standard')
+CPU times: user 3.49 s, sys: 1 ms, total: 3.49 s
+Wall time: 3.49 s
+9
+sage: %time G.diameter('iFUB')
+CPU times: user 336 ms, sys: 2 ms, total: 338 ms
+Wall time: 333 ms
+9
+```
+
+The running time of the iFUB method depends on many parameters but is in general faster than previous methods.
+
+```
+sage: G = graphs.Grid2dGraph(50,50)
+sage: %time G.diameter('standard')
+CPU times: user 138 ms, sys: 2 ms, total: 140 ms
+Wall time: 139 ms
+98
+sage: %time G.diameter('iFUB')
+CPU times: user 80 ms, sys: 2 ms, total: 82 ms
+Wall time: 80.5 ms
+98
+sage: V = G.vertices()
+sage: shuffle(V)
+sage: G.relabel(inplace=True, perm=V)
+sage: %time G.diameter('iFUB')
+CPU times: user 35 ms, sys: 1 ms, total: 36 ms
+Wall time: 33.4 ms
+98
+sage: shuffle(V)
+sage: G.relabel(inplace=True, perm=V)
+sage: %time G.diameter('iFUB')
+CPU times: user 35 ms, sys: 1 ms, total: 36 ms
+Wall time: 34.2 ms
+98
+```
+
``````




---

archive/issue_comments_288749.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-11T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288749",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288750.json:
```json
{
    "body": "Changing commit from \"\" to \"b4491296b1a0b4c0590b0678d7391f78fe503682\"",
    "created_at": "2014-10-11T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288750",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "b4491296b1a0b4c0590b0678d7391f78fe503682"



---

archive/issue_comments_288751.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2014-10-11T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288751",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_288752.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-16T22:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288753.json:
```json
{
    "body": "Changing commit from \"b4491296b1a0b4c0590b0678d7391f78fe503682\" to \"c1a7c956bf54c962332303b4411e774b16c4ec10\"",
    "created_at": "2014-10-16T22:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b4491296b1a0b4c0590b0678d7391f78fe503682" to "c1a7c956bf54c962332303b4411e774b16c4ec10"



---

archive/issue_comments_288754.json:
```json
{
    "body": "<a id='comment:5'></a>Yo !!\n\nA second pass on this code. With this I guess that the 'technical review' is done, but I haven't checked the correction yet, i.e. looked at the papers and what they prove. I don't really like to make a non-obvious algorithm the default one when we have a much simpler way to compute the same value, but well, if it is faster ...\n\n- About `seen`. \"It must be initialized, but there is no need to initialize it\".\n\n```\n+    - ``seen`` -- bitset of size ``n`` that must be initialized before calling\n+      this method. owever, there is no nead to initialize it.\n```\n\n- `this method check is all` --> checkS iF all\n\n- `this helps saving` --> save\n\n- `when we already known` --> know\n\n- About your check for connected graphs: I find your `if test_is_connected and len(seen)<n: return big_number` a bit weird given that you just ran a BFS which is supposed to return the eccentricity of a vertex (which, in particular, tests if the graph is connected}}}. And actually, while you say that the ` simple_BFS` function returns the eccentricity of `source`, it only does so when the graph is connected. If it is not, it returns the (finite) eccentricity of `source` in its connected component. Is there any reason why you should not do that `simple_BFS` ?\n\n```diff\n-return distances[waiting_list[waiting_end]]\n+return distances[waiting_list[waiting_end]] if waiting_end == waiting_list+n-1 else UINT32_MAX\n```\n\n  It would make the `simple_BFS` function more correct, and it also means that you do not need to define this `is_connected` parameter as ... checking this is totally free !\n\n- `This method search for` -> searches\n\n- `diameter_lower_bound_4sweep_select_dichotomy`: really the dichotomy should be done through bsearch (http://www.cplusplus.com/reference/cstdlib/bsearch/) but I don't exactly know how to provide `distances` as an argument. Too bad `:-/`\n\n  By the way, do you really need the if `i==j-1` block ? Or would it be sufficient to just replace `i=k` with `i=k+1` ?\n\n- In `lower_bound_4sweep`: you do not need a `improved` variable. Use a `break` with a `while True`. And you can even have a `while tmp>LB` and no `break` if you compute `tmp` at the end of the loop `:-P`\n\n- Is it only me or is the `4sweep` function doing much more that 4 sweeps ?\n\n- `diameter_iFUB` frees memory that it did not allocate itself. This feels wrong `O_o`\n\n- I do not think that the comments about the data structure in `diameter()` are necessary. All that this function does is call others.\n\n- There are useless variables in this function\n\nNathann",
    "created_at": "2014-10-19T14:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288754",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Yo !!

A second pass on this code. With this I guess that the 'technical review' is done, but I haven't checked the correction yet, i.e. looked at the papers and what they prove. I don't really like to make a non-obvious algorithm the default one when we have a much simpler way to compute the same value, but well, if it is faster ...

- About `seen`. "It must be initialized, but there is no need to initialize it".

```
+    - ``seen`` -- bitset of size ``n`` that must be initialized before calling
+      this method. owever, there is no nead to initialize it.
```

- `this method check is all` --> checkS iF all

- `this helps saving` --> save

- `when we already known` --> know

- About your check for connected graphs: I find your `if test_is_connected and len(seen)<n: return big_number` a bit weird given that you just ran a BFS which is supposed to return the eccentricity of a vertex (which, in particular, tests if the graph is connected}}}. And actually, while you say that the ` simple_BFS` function returns the eccentricity of `source`, it only does so when the graph is connected. If it is not, it returns the (finite) eccentricity of `source` in its connected component. Is there any reason why you should not do that `simple_BFS` ?

```diff
-return distances[waiting_list[waiting_end]]
+return distances[waiting_list[waiting_end]] if waiting_end == waiting_list+n-1 else UINT32_MAX
```

  It would make the `simple_BFS` function more correct, and it also means that you do not need to define this `is_connected` parameter as ... checking this is totally free !

- `This method search for` -> searches

- `diameter_lower_bound_4sweep_select_dichotomy`: really the dichotomy should be done through bsearch (http://www.cplusplus.com/reference/cstdlib/bsearch/) but I don't exactly know how to provide `distances` as an argument. Too bad `:-/`

  By the way, do you really need the if `i==j-1` block ? Or would it be sufficient to just replace `i=k` with `i=k+1` ?

- In `lower_bound_4sweep`: you do not need a `improved` variable. Use a `break` with a `while True`. And you can even have a `while tmp>LB` and no `break` if you compute `tmp` at the end of the loop `:-P`

- Is it only me or is the `4sweep` function doing much more that 4 sweeps ?

- `diameter_iFUB` frees memory that it did not allocate itself. This feels wrong `O_o`

- I do not think that the comments about the data structure in `diameter()` are necessary. All that this function does is call others.

- There are useless variables in this function

Nathann



---

archive/issue_comments_288755.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-19T14:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288755",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_288756.json:
```json
{
    "body": "Changing commit from \"c1a7c956bf54c962332303b4411e774b16c4ec10\" to \"6eb88ead909981bc89fea507cc1ea354fa0d175f\"",
    "created_at": "2014-10-25T10:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c1a7c956bf54c962332303b4411e774b16c4ec10" to "6eb88ead909981bc89fea507cc1ea354fa0d175f"



---

archive/issue_comments_288757.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-25T10:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288758.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-25T10:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288758",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_288759.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 ncohen]:\n> Yo !!\n> \n> A second pass on this code. With this I guess that the 'technical review' is done, but I haven't checked the correction yet, i.e. looked at the papers and what they prove. I don't really like to make a non-obvious algorithm the default one when we have a much simpler way to compute the same value, but well, if it is faster ...\n> \n> - About `seen`. \"It must be initialized, but there is no need to initialize it\".\n> \n> \n> ```\n> +    - ``seen`` -- bitset of size ``n`` that must be initialized before calling\n> +      this method. owever, there is no nead to initialize it.\n> ```\n\n\nI have revised the text as follows:\n\n```\n+    - ``seen`` -- bitset of size ``n`` that must be initialized before calling \n       this method (i.e., bitset_init(seen, n)). However, there is no need to \n       clear it. \n```\n \n\n> - `this method check is all` --> checkS iF all\n> \n> - `this helps saving` --> save\n> \n> - `when we already known` --> know\n> \n> - About your check for connected graphs: I find your `if test_is_connected and len(seen)<n: return big_number` a bit weird given that you just ran a BFS which is supposed to return the eccentricity of a vertex (which, in particular, tests if the graph is connected}}}. And actually, while you say that the ` simple_BFS` function returns the eccentricity of `source`, it only does so when the graph is connected. If it is not, it returns the (finite) eccentricity of `source` in its connected component. Is there any reason why you should not do that `simple_BFS` ?\n> \n> \n> ```\n> #!diff\n> -return distances[waiting_list[waiting_end]]\n> +return distances[waiting_list[waiting_end]] if waiting_end == waiting_list+n-1 else UINT32_MAX\n> ```\n> \n>   It would make the `simple_BFS` function more correct, and it also means that you do not need to define this `is_connected` parameter as ... checking this is totally free !\n\n\nYou are perfectly right! I have changed the code. I have removed the useless parameter and now return the eccentricity of the source in the graph:\n\n```\nreturn distances[waiting_list[waiting_end]] if waiting_end==n-1 else UINT32_MAX \n```\n \n\n> - `This method search for` -> searches\n \nok\n \n> - `diameter_lower_bound_4sweep_select_dichotomy`: really the dichotomy should be done through bsearch (http://www.cplusplus.com/reference/cstdlib/bsearch/) but I don't exactly know how to provide `distances` as an argument. Too bad `:-/`\n> \n>   By the way, do you really need the if `i==j-1` block ? Or would it be sufficient to just replace `i=k` with `i=k+1` ?\n \n>\n> - In `lower_bound_4sweep`: you do not need a `improved` variable. Use a `break` with a `while True`. And you can even have a `while tmp>LB` and no `break` if you compute `tmp` at the end of the loop `:-P`\n\n\nI agree that calling `bsearch` would be better, but I don't know how to do it without introducing extra data structure (e.g., array of pairs (vertex, distance)). I have simplified the code and removed the `diameter_lower_bound_4sweep_select_dichotomy` method.\n \n\n> - Is it only me or is the `4sweep` function doing much more that 4 sweeps ?\n\n\nYou are right. I don't know why they call it `4sweep` instead of `multisweep`. I can change the name if you think it is more natural.\n \n\n> - `diameter_iFUB` frees memory that it did not allocate itself. This feels wrong `O_o`\n\n\nI have removed these instructions.\n \n\n> - I do not think that the comments about the data structure in `diameter()` are necessary. All that this function does is call others.\n> \n> - There are useless variables in this function\n\n\nI have shortened the comments and remove useless variables. It should be cleaner now.\n \n\n> Nathann\n\n\nThanks a lot for all the comments.\n\n---\nNew commits:",
    "created_at": "2014-10-25T10:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288759",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>Replying to [comment:5 ncohen]:
> Yo !!
> 
> A second pass on this code. With this I guess that the 'technical review' is done, but I haven't checked the correction yet, i.e. looked at the papers and what they prove. I don't really like to make a non-obvious algorithm the default one when we have a much simpler way to compute the same value, but well, if it is faster ...
> 
> - About `seen`. "It must be initialized, but there is no need to initialize it".
> 
> 
> ```
> +    - ``seen`` -- bitset of size ``n`` that must be initialized before calling
> +      this method. owever, there is no nead to initialize it.
> ```


I have revised the text as follows:

```
+    - ``seen`` -- bitset of size ``n`` that must be initialized before calling 
       this method (i.e., bitset_init(seen, n)). However, there is no need to 
       clear it. 
```
 

> - `this method check is all` --> checkS iF all
> 
> - `this helps saving` --> save
> 
> - `when we already known` --> know
> 
> - About your check for connected graphs: I find your `if test_is_connected and len(seen)<n: return big_number` a bit weird given that you just ran a BFS which is supposed to return the eccentricity of a vertex (which, in particular, tests if the graph is connected}}}. And actually, while you say that the ` simple_BFS` function returns the eccentricity of `source`, it only does so when the graph is connected. If it is not, it returns the (finite) eccentricity of `source` in its connected component. Is there any reason why you should not do that `simple_BFS` ?
> 
> 
> ```
> #!diff
> -return distances[waiting_list[waiting_end]]
> +return distances[waiting_list[waiting_end]] if waiting_end == waiting_list+n-1 else UINT32_MAX
> ```
> 
>   It would make the `simple_BFS` function more correct, and it also means that you do not need to define this `is_connected` parameter as ... checking this is totally free !


You are perfectly right! I have changed the code. I have removed the useless parameter and now return the eccentricity of the source in the graph:

```
return distances[waiting_list[waiting_end]] if waiting_end==n-1 else UINT32_MAX 
```
 

> - `This method search for` -> searches
 
ok
 
> - `diameter_lower_bound_4sweep_select_dichotomy`: really the dichotomy should be done through bsearch (http://www.cplusplus.com/reference/cstdlib/bsearch/) but I don't exactly know how to provide `distances` as an argument. Too bad `:-/`
> 
>   By the way, do you really need the if `i==j-1` block ? Or would it be sufficient to just replace `i=k` with `i=k+1` ?
 
>
> - In `lower_bound_4sweep`: you do not need a `improved` variable. Use a `break` with a `while True`. And you can even have a `while tmp>LB` and no `break` if you compute `tmp` at the end of the loop `:-P`


I agree that calling `bsearch` would be better, but I don't know how to do it without introducing extra data structure (e.g., array of pairs (vertex, distance)). I have simplified the code and removed the `diameter_lower_bound_4sweep_select_dichotomy` method.
 

> - Is it only me or is the `4sweep` function doing much more that 4 sweeps ?


You are right. I don't know why they call it `4sweep` instead of `multisweep`. I can change the name if you think it is more natural.
 

> - `diameter_iFUB` frees memory that it did not allocate itself. This feels wrong `O_o`


I have removed these instructions.
 

> - I do not think that the comments about the data structure in `diameter()` are necessary. All that this function does is call others.
> 
> - There are useless variables in this function


I have shortened the comments and remove useless variables. It should be cleaner now.
 

> Nathann


Thanks a lot for all the comments.

---
New commits:



---

archive/issue_comments_288760.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-27T13:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288760",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_288761.json:
```json
{
    "body": "<a id='comment:8'></a>You say in the documentation of the 4sweep method that the vertex `w` should be at the same distance from `u` and `v`, but your dichotomy search does not do that. You only check that the vertex you take is at distance LB/2 from `u`, but you do not know anything about `v`. For all you know `w` may be a leaf.\n\nNathann",
    "created_at": "2014-10-27T13:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288761",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>You say in the documentation of the 4sweep method that the vertex `w` should be at the same distance from `u` and `v`, but your dichotomy search does not do that. You only check that the vertex you take is at distance LB/2 from `u`, but you do not know anything about `v`. For all you know `w` may be a leaf.

Nathann



---

archive/issue_comments_288762.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-27T17:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288763.json:
```json
{
    "body": "Changing commit from \"6eb88ead909981bc89fea507cc1ea354fa0d175f\" to \"7b6bfd2d0dba681240357ed36f675ecb526b8c66\"",
    "created_at": "2014-10-27T17:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288763",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6eb88ead909981bc89fea507cc1ea354fa0d175f" to "7b6bfd2d0dba681240357ed36f675ecb526b8c66"



---

archive/issue_comments_288764.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-27T17:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288764",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_288765.json:
```json
{
    "body": "<a id='comment:10'></a>You are perfectly right.\n\nI found no other way than storing the predecessors and then following the path from a destination to the source to find that vertex. Let me know if you have a smarter approach.\n\nThanks.",
    "created_at": "2014-10-27T17:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288765",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>You are perfectly right.

I found no other way than storing the predecessors and then following the path from a destination to the source to find that vertex. Let me know if you have a smarter approach.

Thanks.



---

archive/issue_comments_288766.json:
```json
{
    "body": "<a id='comment:11'></a>Yo !\n\n> I found no other way than storing the predecessors and then following the path from a destination to the source to find that vertex. Let me know if you have a smarter approach.\n\n\nNo I don't see anything better `:-/`\n\nToo bad for the fast search.\n\nNathann",
    "created_at": "2014-10-28T12:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288766",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>Yo !

> I found no other way than storing the predecessors and then following the path from a destination to the source to find that vertex. Let me know if you have a smarter approach.


No I don't see anything better `:-/`

Too bad for the fast search.

Nathann



---

archive/issue_comments_288767.json:
```json
{
    "body": "<a id='comment:12'></a>Since most of the computation time is in iFUB, this is not so bad.",
    "created_at": "2014-10-28T12:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288767",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>Since most of the computation time is in iFUB, this is not so bad.



---

archive/issue_comments_288768.json:
```json
{
    "body": "Changing commit from \"7b6bfd2d0dba681240357ed36f675ecb526b8c66\" to \"299c32364d6c928e4db9ee43ce17211f744b86ef\"",
    "created_at": "2014-10-28T15:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7b6bfd2d0dba681240357ed36f675ecb526b8c66" to "299c32364d6c928e4db9ee43ce17211f744b86ef"



---

archive/issue_comments_288769.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-28T15:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288770.json:
```json
{
    "body": "<a id='comment:14'></a>Hello again !\n\nOkay, I finally understood how this thing works and it is quite simple and clear. Cool !\n\nAaaaaand so I added a paragraph of doc that explains how the algorithm works.\n\nI also replace a couple of 4sweeps->multisweep, and remove the references from `GenericGraph.diameter` as Sphinx complained of having them twice as they are in `distances_all_pairs` too.\n\nNow, while I updated the doc of `distances_all_pairs.diameter` I did not update the doc of `GenericGraph.diameter` because I have a question: why on earth do we define `GenericGraph.diameter` instead of just importing into `GenericGraph` the function from `distances_all_pairs` ? All the documentation is mostly a copy/paste !?\n\nAlso in multi-sweep/diameter_iFUB: the documentation says that the `int *` store the result of a BFS from `source`, while actually not much can be claimed about their content when the function returns. Just say that it is memory space used by the function while it runs unless you can say something more ?..\n\nI added a commit with my changes at public/17135, tell me what you think !\n\nNathann",
    "created_at": "2014-10-29T10:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288770",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Hello again !

Okay, I finally understood how this thing works and it is quite simple and clear. Cool !

Aaaaaand so I added a paragraph of doc that explains how the algorithm works.

I also replace a couple of 4sweeps->multisweep, and remove the references from `GenericGraph.diameter` as Sphinx complained of having them twice as they are in `distances_all_pairs` too.

Now, while I updated the doc of `distances_all_pairs.diameter` I did not update the doc of `GenericGraph.diameter` because I have a question: why on earth do we define `GenericGraph.diameter` instead of just importing into `GenericGraph` the function from `distances_all_pairs` ? All the documentation is mostly a copy/paste !?

Also in multi-sweep/diameter_iFUB: the documentation says that the `int *` store the result of a BFS from `source`, while actually not much can be claimed about their content when the function returns. Just say that it is memory space used by the function while it runs unless you can say something more ?..

I added a commit with my changes at public/17135, tell me what you think !

Nathann



---

archive/issue_comments_288771.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-01T10:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288772.json:
```json
{
    "body": "Changing commit from \"299c32364d6c928e4db9ee43ce17211f744b86ef\" to \"69cb552df487c204e8590a9421e44c044983f8c0\"",
    "created_at": "2014-11-01T10:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "299c32364d6c928e4db9ee43ce17211f744b86ef" to "69cb552df487c204e8590a9421e44c044983f8c0"



---

archive/issue_comments_288773.json:
```json
{
    "body": "<a id='comment:16'></a>Hello,\n\nthanks for the improvements. It is much better now.\n\nFollowing your comments, I'm now importing the new method as `GenericGraph.diameter`.\nI have also removed some `int *` parameters from iFUB and multi-sweep. It avoids confusion. Also, since we only need to allocate tables (no need to initialize them), the extra cost of allocating some tables in 2 different methods is negligible.\n\nDavid.\n\nPS: git is powerful but not intuitive/easy for non experts.",
    "created_at": "2014-11-01T10:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288773",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:16'></a>Hello,

thanks for the improvements. It is much better now.

Following your comments, I'm now importing the new method as `GenericGraph.diameter`.
I have also removed some `int *` parameters from iFUB and multi-sweep. It avoids confusion. Also, since we only need to allocate tables (no need to initialize them), the extra cost of allocating some tables in 2 different methods is negligible.

David.

PS: git is powerful but not intuitive/easy for non experts.



---

archive/issue_comments_288774.json:
```json
{
    "body": "<a id='comment:17'></a>Hello !\n\n> Following your comments, I'm now importing the new method as `GenericGraph.diameter`.\n> I have also removed some `int *` parameters from iFUB and multi-sweep. It avoids confusion. Also, since we only need to allocate tables (no need to initialize them), the extra cost of allocating some tables in 2 different methods is negligible.\n\n\nWell.\n\n1) Looks ready to go\n2) Good job\n3) Thanks for this patch !\n\n> PS: git is powerful but not intuitive/easy for non experts.\n\n\nYep. Contributing to Sage is really hard at first `:-/`\n\nNathann",
    "created_at": "2014-11-02T22:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288774",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>Hello !

> Following your comments, I'm now importing the new method as `GenericGraph.diameter`.
> I have also removed some `int *` parameters from iFUB and multi-sweep. It avoids confusion. Also, since we only need to allocate tables (no need to initialize them), the extra cost of allocating some tables in 2 different methods is negligible.


Well.

1) Looks ready to go
2) Good job
3) Thanks for this patch !

> PS: git is powerful but not intuitive/easy for non experts.


Yep. Contributing to Sage is really hard at first `:-/`

Nathann



---

archive/issue_comments_288775.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2014-11-02T22:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288775",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_288776.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-02T22:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288776",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288777.json:
```json
{
    "body": "<a id='comment:19'></a>Thank you Nathann.",
    "created_at": "2014-11-02T22:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288777",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:19'></a>Thank you Nathann.



---

archive/issue_comments_288778.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-15T16:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288778",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049735.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-15T16:18:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17135#event-49735"
}
```



---

archive/issue_comments_288779.json:
```json
{
    "body": "Changing branch from \"u/dcoudert/help\" to \"69cb552df487c204e8590a9421e44c044983f8c0\"",
    "created_at": "2014-11-15T16:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17135#issuecomment-288779",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dcoudert/help" to "69cb552df487c204e8590a9421e44c044983f8c0"
