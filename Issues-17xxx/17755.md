# Issue 17755: Plots are not shown in the notebook using server_pool option

archive/issues_017518.json:
```json
{
    "body": "Start a notebook server with\n\n```\nsage: notebook(server_pool=[\"guest@localhost\"])\n```\nand then enter in a notebook cell\n\n```\nplot(sin(x))\n```\n\nIn **Sage 6.4.beta5**, this works as it should.\n\nIn **Sage 6.4.beta6**, this returns `None` and does not show the plot.\n\nIn **Sage 6.4.rc0** and later, no plot is shown and the following error appears in the Sage session:\n\n```\n2015-02-09 10:23:17+0100 [HTTPChannel,0,127.0.0.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpJKDXnp/sage0.png'\n```\n\nBranch/Commit: e85da059b1f5ab5124f2855e7a1eff58e7ef98da\n\nReviewer: Andrey Novoseltsev\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17755\n\n",
    "closed_at": "2015-02-13T01:08:20Z",
    "created_at": "2015-02-09T21:09:37Z",
    "labels": [
        "component: graphics",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Plots are not shown in the notebook using server_pool option",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17755",
    "user": "https://github.com/jdemeyer"
}
```
Start a notebook server with

```
sage: notebook(server_pool=["guest@localhost"])
```
and then enter in a notebook cell

```
plot(sin(x))
```

In **Sage 6.4.beta5**, this works as it should.

In **Sage 6.4.beta6**, this returns `None` and does not show the plot.

In **Sage 6.4.rc0** and later, no plot is shown and the following error appears in the Sage session:

```
2015-02-09 10:23:17+0100 [HTTPChannel,0,127.0.0.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpJKDXnp/sage0.png'
```

Branch/Commit: e85da059b1f5ab5124f2855e7a1eff58e7ef98da

Reviewer: Andrey Novoseltsev

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17755





---

archive/issue_comments_304053.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/17755\"",
    "created_at": "2015-02-09T21:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304053",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/17755"



---

archive/issue_comments_304054.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[e85da05](http://git.sagemath.org/sage.git/commit/?id=e85da059b1f5ab5124f2855e7a1eff58e7ef98da)|`Make sagenb graphics files world-readable`|",
    "created_at": "2015-02-09T21:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304054",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[e85da05](http://git.sagemath.org/sage.git/commit/?id=e85da059b1f5ab5124f2855e7a1eff58e7ef98da)|`Make sagenb graphics files world-readable`|



---

archive/issue_comments_304055.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-09T21:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304055",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_304056.json:
```json
{
    "body": "Changing commit from \"\" to \"e85da059b1f5ab5124f2855e7a1eff58e7ef98da\"",
    "created_at": "2015-02-09T21:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304056",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "e85da059b1f5ab5124f2855e7a1eff58e7ef98da"



---

archive/issue_comments_304057.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-09T22:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304057",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_304058.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Andrey Novoseltsev\"",
    "created_at": "2015-02-09T22:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304058",
    "user": "https://github.com/novoselt"
}
```

Changing reviewer from "" to "Andrey Novoseltsev"



---

archive/issue_comments_304059.json:
```json
{
    "body": "<a id='comment:4'></a>\nThats a race between the worker and the server. But oh well probably good enough since the server surely doesn't do the right thing to watch for file changes (i.e. no inotify)",
    "created_at": "2015-02-10T01:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304059",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Thats a race between the worker and the server. But oh well probably good enough since the server surely doesn't do the right thing to watch for file changes (i.e. no inotify)



---

archive/issue_comments_304060.json:
```json
{
    "body": "<a id='comment:5'></a>\nPS: I deleted graphics_file.py already in #17234",
    "created_at": "2015-02-10T01:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304060",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
PS: I deleted graphics_file.py already in #17234



---

archive/issue_comments_304061.json:
```json
{
    "body": "<a id='comment:6'></a>\nJust out of curiosity, do you two have restrictive umasks?",
    "created_at": "2015-02-10T02:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304061",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Just out of curiosity, do you two have restrictive umasks?



---

archive/issue_comments_304062.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vbraun](#comment%3A6):\n> Just out of curiosity, do you two have restrictive umasks?\n\n\nI have it running in an LXC container: root on host, root inside, server user, worker user, all give 0022 umask. The system is Debian Wheezy with some backports (like new kernel).",
    "created_at": "2015-02-10T05:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304062",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>
Replying to [vbraun](#comment%3A6):
> Just out of curiosity, do you two have restrictive umasks?


I have it running in an LXC container: root on host, root inside, server user, worker user, all give 0022 umask. The system is Debian Wheezy with some backports (like new kernel).



---

archive/issue_comments_304063.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [vbraun](#comment%3A4):\n> Thats a race between the worker and the server.\n\nNot really, since all this happens serially. The client computes something (which might include saving graphics), then sends a message to the server that it is finished.\n\n> Just out of curiosity, do you two have restrictive umasks?\n\nNo, the reason the graphics file ends up with `0600` permission is the fact that it is created as temporary file. And temporary files have `0600` permissions by default.",
    "created_at": "2015-02-10T07:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304063",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [vbraun](#comment%3A4):
> Thats a race between the worker and the server.

Not really, since all this happens serially. The client computes something (which might include saving graphics), then sends a message to the server that it is finished.

> Just out of curiosity, do you two have restrictive umasks?

No, the reason the graphics file ends up with `0600` permission is the fact that it is created as temporary file. And temporary files have `0600` permissions by default.



---

archive/issue_comments_304064.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,20 @@\n+Start a notebook server with\n \n+```\n+sage: notebook(server_pool=[\"guest@localhost\"])\n+```\n+and then enter in a notebook cell\n+\n+```\n+plot(sin(x))\n+```\n+\n+In **Sage 6.4.beta5**, this works as it should.\n+\n+In **Sage 6.4.beta6**, this returns `None` and does not show the plot.\n+\n+In **Sage 6.4.rc0** and later, no plot is shown and the following error appears in the Sage session:\n+\n+```\n+2015-02-09 10:23:17+0100 [HTTPChannel,0,127.0.0.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpJKDXnp/sage0.png'\n+```\n``````\n",
    "created_at": "2015-02-10T08:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304064",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,20 @@
+Start a notebook server with
 
+```
+sage: notebook(server_pool=["guest@localhost"])
+```
+and then enter in a notebook cell
+
+```
+plot(sin(x))
+```
+
+In **Sage 6.4.beta5**, this works as it should.
+
+In **Sage 6.4.beta6**, this returns `None` and does not show the plot.
+
+In **Sage 6.4.rc0** and later, no plot is shown and the following error appears in the Sage session:
+
+```
+2015-02-09 10:23:17+0100 [HTTPChannel,0,127.0.0.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpJKDXnp/sage0.png'
+```
``````




---

archive/issue_comments_304065.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2015-02-12T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304065",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_304066.json:
```json
{
    "body": "<a id='comment:10'></a>\nPlease merge this in Sage 6.5",
    "created_at": "2015-02-12T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304066",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Please merge this in Sage 6.5



---

archive/issue_comments_304067.json:
```json
{
    "body": "<a id='comment:11'></a>\nAlready did (will be in the next rc)",
    "created_at": "2015-02-12T21:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304067",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Already did (will be in the next rc)



---

archive/issue_events_050757.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-13T01:08:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17755#event-50757"
}
```



---

archive/issue_comments_304068.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/17755\" to \"e85da059b1f5ab5124f2855e7a1eff58e7ef98da\"",
    "created_at": "2015-02-13T01:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304068",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/17755" to "e85da059b1f5ab5124f2855e7a1eff58e7ef98da"



---

archive/issue_comments_304069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-13T01:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17755#issuecomment-304069",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
