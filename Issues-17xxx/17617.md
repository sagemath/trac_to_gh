# Issue 17617: Metaticket: remove c_lib

archive/issues_017617.json:
```json
{
    "body": "CC:  @kiwifb\n\nMove `c_lib` code to Cython modules, or refactor code to no longer use `c_lib`:\n\n* #17180: Move and fix rational reconstruction\n* #10103: Remove gmp_globals and gmp.pxi\n* #17668: Replace PY_NEW and PY_NEW_SAME_TYPE by __new__() method\n* #17726: Replace PY_TYPE() by type()\n* #17725: Replace PY_TYPE_CHECK_EXACT\n* #17800: Replace PY_TYPE_CHECK and IS_INSTANCE by isinstance\n* #17862: Remove use of PY_IS_NUMERIC\n* #17625: Remove init_csage_module()\n* #17789: Remove c_lib/src/ZZ_pylong.cpp\n* #17853: Implement mpz <-> Python int/long in Cython\n* #17788: PARI: store GEN as mpz/mpq\n* #17784: Modernize NTL error handler\n* #17819: Use unsigned long for Integer.divisors\n* #17881: Move memory functions from c_lib to Cython\n* #17882: Cython clean-up in fast_eval.pyx\n* #17889: Unify base_extend, base_extend_c, base_extend_c_impl\n* #17890: Remove _(rich)cmp_c_impl\n* #17900: Setup interrupts in Cython\n* #17915: Stop including mpz_pylong.h and mpz_longlong.h\n* #17916: Move PARI array element assignment macros to parisage.h\n* #17952: Actually remove c_lib files\n* #18007: Move includes of interrupt.pxi to pyx files\n* #18030: Clean-up stdsage.pxi includes\n* #18027: Move interrupts to Cython\n* #18367: Move ntl_wrap to Sage library\n\nIssue created by migration from https://trac.sagemath.org/ticket/17854\n\n",
    "closed_at": "2015-06-04T22:46:33Z",
    "created_at": "2015-02-25T16:15:30Z",
    "labels": [
        "component: c_lib"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Metaticket: remove c_lib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17617",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @kiwifb

Move `c_lib` code to Cython modules, or refactor code to no longer use `c_lib`:

* #17180: Move and fix rational reconstruction
* #10103: Remove gmp_globals and gmp.pxi
* #17668: Replace PY_NEW and PY_NEW_SAME_TYPE by __new__() method
* #17726: Replace PY_TYPE() by type()
* #17725: Replace PY_TYPE_CHECK_EXACT
* #17800: Replace PY_TYPE_CHECK and IS_INSTANCE by isinstance
* #17862: Remove use of PY_IS_NUMERIC
* #17625: Remove init_csage_module()
* #17789: Remove c_lib/src/ZZ_pylong.cpp
* #17853: Implement mpz <-> Python int/long in Cython
* #17788: PARI: store GEN as mpz/mpq
* #17784: Modernize NTL error handler
* #17819: Use unsigned long for Integer.divisors
* #17881: Move memory functions from c_lib to Cython
* #17882: Cython clean-up in fast_eval.pyx
* #17889: Unify base_extend, base_extend_c, base_extend_c_impl
* #17890: Remove _(rich)cmp_c_impl
* #17900: Setup interrupts in Cython
* #17915: Stop including mpz_pylong.h and mpz_longlong.h
* #17916: Move PARI array element assignment macros to parisage.h
* #17952: Actually remove c_lib files
* #18007: Move includes of interrupt.pxi to pyx files
* #18030: Clean-up stdsage.pxi includes
* #18027: Move interrupts to Cython
* #18367: Move ntl_wrap to Sage library

Issue created by migration from https://trac.sagemath.org/ticket/17854





---

archive/issue_comments_235160.json:
```json
{
    "body": "That's ambitious and will remove one barrier to having simultaneous python2.7 and python3.x installs at the same time (the others being polybori and pynac).",
    "created_at": "2015-02-25T20:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235160",
    "user": "https://github.com/kiwifb"
}
```

That's ambitious and will remove one barrier to having simultaneous python2.7 and python3.x installs at the same time (the others being polybori and pynac).



---

archive/issue_comments_235161.json:
```json
{
    "body": "Hum... That will get rid of the last doctest that give a different result with gmp than with mpir.",
    "created_at": "2015-03-02T21:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235161",
    "user": "https://github.com/kiwifb"
}
```

Hum... That will get rid of the last doctest that give a different result with gmp than with mpir.



---

archive/issue_comments_235162.json:
```json
{
    "body": "Replying to [comment:8 fbissey]:\n> Hum... That will get rid of the last doctest that give a different result with gmp than with mpir.\n\n\nWhich doctest?",
    "created_at": "2015-03-02T22:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235162",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 fbissey]:
> Hum... That will get rid of the last doctest that give a different result with gmp than with mpir.


Which doctest?



---

archive/issue_comments_235163.json:
```json
{
    "body": "I should have commented in #17881, commenting here was a mistake. I am talking about the doctest you removed so far in `sage/rings/integer.pyx` it gives a sligthly different answer for gmp than mpir. This is something we have identified a while ago with Jean-Pierre Flori.\n\nFor info this is what it gives for gmp:\n\n```\n**********************************************************************\nFile \"/usr/share/sage/src/sage/rings/integer.pyx\", line 1938, in sage.rings.integer.Integer.__pow__\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes  \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 850, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer.__pow__[27]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"sage/rings/integer.pyx\", line 1977, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:12942)\n        sig_on()\n      File \"sage/ext/c_lib.pyx\", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1035)\n        raise RuntimeError(msg)\n    RuntimeError: Aborted\n```",
    "created_at": "2015-03-02T22:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235163",
    "user": "https://github.com/kiwifb"
}
```

I should have commented in #17881, commenting here was a mistake. I am talking about the doctest you removed so far in `sage/rings/integer.pyx` it gives a sligthly different answer for gmp than mpir. This is something we have identified a while ago with Jean-Pierre Flori.

For info this is what it gives for gmp:

```
**********************************************************************
File "/usr/share/sage/src/sage/rings/integer.pyx", line 1938, in sage.rings.integer.Integer.__pow__
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes  
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 850, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer.__pow__[27]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "sage/rings/integer.pyx", line 1977, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:12942)
        sig_on()
      File "sage/ext/c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1035)
        raise RuntimeError(msg)
    RuntimeError: Aborted
```



---

archive/issue_comments_235164.json:
```json
{
    "body": "Yes, GMP has some extra error checking that MPIR doesn't have.\n\nAnyway, this doctest will not be removed, just *moved* to a different file in #17881.",
    "created_at": "2015-03-02T22:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235164",
    "user": "https://github.com/jdemeyer"
}
```

Yes, GMP has some extra error checking that MPIR doesn't have.

Anyway, this doctest will not be removed, just *moved* to a different file in #17881.



---

archive/issue_comments_235165.json:
```json
{
    "body": "Indeed it escaped my attention. So it will just move a bit. No biggy in any case.",
    "created_at": "2015-03-02T22:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235165",
    "user": "https://github.com/kiwifb"
}
```

Indeed it escaped my attention. So it will just move a bit. No biggy in any case.



---

archive/issue_events_050909.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-05-05T20:52:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17617#event-50909"
}
```



---

archive/issue_events_050910.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-05-27T11:27:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17617#event-50910"
}
```



---

archive/issue_events_050911.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-05-27T11:27:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17617#event-50911"
}
```



---

archive/issue_comments_235166.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-27T12:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235166",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235167.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-05-27T12:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235167",
    "user": "https://github.com/jdemeyer"
}
```

Last 10 new commits:



---

archive/issue_comments_235168.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-27T14:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_235169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-03T09:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235170.json:
```json
{
    "body": "Merged latest versions of dependencies, now that they have positive_review.",
    "created_at": "2015-06-03T09:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235170",
    "user": "https://github.com/jdemeyer"
}
```

Merged latest versions of dependencies, now that they have positive_review.



---

archive/issue_comments_235171.json:
```json
{
    "body": "OK I was a tiny bit too late with my comment in #18367. Anyway, it is now definitely all good to go. I want to see that stuff in 6.8.beta3, it is ready for the bots.",
    "created_at": "2015-06-03T09:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235171",
    "user": "https://github.com/kiwifb"
}
```

OK I was a tiny bit too late with my comment in #18367. Anyway, it is now definitely all good to go. I want to see that stuff in 6.8.beta3, it is ready for the bots.



---

archive/issue_comments_235172.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-03T09:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235172",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_050912.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-04T22:46:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17617#event-50912"
}
```



---

archive/issue_comments_235173.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-04T22:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17617#issuecomment-235173",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
