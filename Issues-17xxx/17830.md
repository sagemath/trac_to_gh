# Issue 17830: Comparison of number field elements dependent of real embedding

archive/issues_017593.json:
```json
{
    "body": "Comparison of embedded number field elements should be identical to the comparison of the embedding. In other words, we should have:\n\n```\nsage: x = polygen(ZZ)\nsage: K.<cbrt2> = NumberField(x^3 - 2, embedding=AA.polynomial_root(x^3-2, RIF(0,3)))\nsage: 6064/4813 < cbrt2 < 90325/71691\nTrue\n```\nThis has been done in #13213 for quadratic number fields. This ticket aims to implement this for all number fields by storing into the parent a list of interval approximations of the generator.\n\nThis concerns only real embeddings.\n\nTo go further, one should consider:\n- having a fast evaluation of integer polynomial with real intervals (mpfi elements) input\n- make better interaction with QQbar (see also #18103 and #18104)\n\nCC:  tmonteil @jjermann @staroste @gagern @mkoeppe\n\nKeywords: sd66\n\nReviewer: Volker Braun\n\nAuthor: Vincent Delecroix,  \u0160t\u011bp\u00e1n Starosta\n\nBranch: d63b7ac784f22fa8245694f31c19f3d3d7616e88\n\nCommit: d63b7ac784f22fa8245694f31c19f3d3d7616e88\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17830\n\n",
    "closed_at": "2015-12-29T17:52:15Z",
    "created_at": "2015-02-22T18:03:40Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Comparison of number field elements dependent of real embedding",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17830",
    "user": "https://github.com/videlec"
}
```
Comparison of embedded number field elements should be identical to the comparison of the embedding. In other words, we should have:

```
sage: x = polygen(ZZ)
sage: K.<cbrt2> = NumberField(x^3 - 2, embedding=AA.polynomial_root(x^3-2, RIF(0,3)))
sage: 6064/4813 < cbrt2 < 90325/71691
True
```
This has been done in #13213 for quadratic number fields. This ticket aims to implement this for all number fields by storing into the parent a list of interval approximations of the generator.

This concerns only real embeddings.

To go further, one should consider:
- having a fast evaluation of integer polynomial with real intervals (mpfi elements) input
- make better interaction with QQbar (see also #18103 and #18104)

CC:  tmonteil @jjermann @staroste @gagern @mkoeppe

Keywords: sd66

Reviewer: Volker Braun

Author: Vincent Delecroix,  Štěpán Starosta

Branch: d63b7ac784f22fa8245694f31c19f3d3d7616e88

Commit: d63b7ac784f22fa8245694f31c19f3d3d7616e88

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17830





---

archive/issue_comments_234693.json:
```json
{
    "body": "<a id='comment:1'></a>Working implementation (i.e. all tests pass in `sage.rings.number_fields`). Needs some speedup and bullet proofs!\n\n---\nNew commits:",
    "created_at": "2015-02-22T22:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234693",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>Working implementation (i.e. all tests pass in `sage.rings.number_fields`). Needs some speedup and bullet proofs!

---
New commits:



---

archive/issue_comments_234694.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd66\".",
    "created_at": "2015-03-30T11:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234694",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "sd66".



---

archive/issue_comments_234695.json:
```json
{
    "body": "<a id='comment:5'></a>I have done some testing and committed a few tweaks done on Sage days 66 + doc improvement.",
    "created_at": "2015-04-01T11:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234695",
    "user": "https://github.com/staroste"
}
```

<a id='comment:5'></a>I have done some testing and committed a few tweaks done on Sage days 66 + doc improvement.



---

archive/issue_comments_234696.json:
```json
{
    "body": "<a id='comment:6'></a>I am not sure it is because of your commit, but\n\n```\nsage -t continued_fraction.py  # 1 doctest failed\nsage -t polynomial/polynomial_rational_flint.pyx  # 1 doctest failed\n```",
    "created_at": "2015-04-01T15:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234696",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>I am not sure it is because of your commit, but

```
sage -t continued_fraction.py  # 1 doctest failed
sage -t polynomial/polynomial_rational_flint.pyx  # 1 doctest failed
```



---

archive/issue_comments_234697.json:
```json
{
    "body": "<a id='comment:7'></a>The two failing doctests come from the introduction of the method `_real_mpfi_`. I just propose to get rid of it in this ticket. The main reason is that there are a lot of duplication between:\n- AA and QQbar\n- RLF and CLF\n- what is implemented in this ticket for number fields\n\nI propose to clean it up in ticket #18103 and add the `_real_mpfi_` feature there.\n\nVincent\n\n---\nNew commits:",
    "created_at": "2015-04-01T22:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234697",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>The two failing doctests come from the introduction of the method `_real_mpfi_`. I just propose to get rid of it in this ticket. The main reason is that there are a lot of duplication between:
- AA and QQbar
- RLF and CLF
- what is implemented in this ticket for number fields

I propose to clean it up in ticket #18103 and add the `_real_mpfi_` feature there.

Vincent

---
New commits:



---

archive/issue_comments_234698.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-01T22:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234698",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_234699.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-29T22:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_234700.json:
```json
{
    "body": "<a id='comment:10'></a>rebase on sage-6.7.beta3",
    "created_at": "2015-04-29T22:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234700",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>rebase on sage-6.7.beta3



---

archive/issue_comments_234701.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-06-29T21:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_234702.json:
```json
{
    "body": "<a id='comment:13'></a>rebased on 6.8.beta6",
    "created_at": "2015-06-29T21:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234702",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>rebased on 6.8.beta6



---

archive/issue_comments_234703.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-01T13:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234703",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_234704.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-01T13:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_234705.json:
```json
{
    "body": "<a id='comment:16'></a>Sorry... I pushed to the wrong ticket. Back to normal.",
    "created_at": "2015-07-01T13:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234705",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>Sorry... I pushed to the wrong ticket. Back to normal.



---

archive/issue_comments_234706.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-09T18:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234706",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234707.json:
```json
{
    "body": "<a id='comment:17'></a>```\n+Decreased doctests rings/number_field/number_field_base.pyx from 11 / 11 = 100% to 12 / 13 = 92%\n```",
    "created_at": "2015-08-09T18:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234707",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>```
+Decreased doctests rings/number_field/number_field_base.pyx from 11 / 11 = 100% to 12 / 13 = 92%
```



---

archive/issue_comments_234708.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 chapoton]:\n> {{{\n> +Decreased doctests rings/number_field/number_field_base.pyx from 11 / 11 = 100% to 12 / 13 = 92%\n> }}}\n\n\nThen what? There is no way to test `_init_embedding_approx` that initialize private attributes. For sure we can duplicate doctests from `_get_embedding_approx` or even write\n\n```\nTESTS::\n\n    sage: 1 + 1 # indirect doctest\n    2\n```\nif it makes you happier. But I am not happy with that. If you have any **constructive** suggestion I would be happy to hear it.\n\nGeneral note: asking for review (= waiting from other people comments) is different from merging into Sage. Patchbot green light concerns the latter.",
    "created_at": "2015-08-09T19:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234708",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [comment:17 chapoton]:
> {{{
> +Decreased doctests rings/number_field/number_field_base.pyx from 11 / 11 = 100% to 12 / 13 = 92%
> }}}


Then what? There is no way to test `_init_embedding_approx` that initialize private attributes. For sure we can duplicate doctests from `_get_embedding_approx` or even write

```
TESTS::

    sage: 1 + 1 # indirect doctest
    2
```
if it makes you happier. But I am not happy with that. If you have any **constructive** suggestion I would be happy to hear it.

General note: asking for review (= waiting from other people comments) is different from merging into Sage. Patchbot green light concerns the latter.



---

archive/issue_comments_234709.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-07T17:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_050882.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-12-07T17:58:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17830#event-50882"
}
```



---

archive/issue_comments_234710.json:
```json
{
    "body": "<a id='comment:20'></a>New commits:",
    "created_at": "2015-12-07T17:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234710",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>New commits:



---

archive/issue_comments_234711.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-07T17:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234711",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234712.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-07T18:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234713.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-28T21:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234713",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234714.json:
```json
{
    "body": "<a id='comment:22'></a>Lgtm but merge conflict...",
    "created_at": "2015-12-28T21:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234714",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>Lgtm but merge conflict...



---

archive/issue_comments_234715.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-28T23:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_234716.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-28T23:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234716",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234717.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks for having a look! Rebased on 7.0.beta1.\n\nVincent",
    "created_at": "2015-12-28T23:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234717",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>Thanks for having a look! Rebased on 7.0.beta1.

Vincent



---

archive/issue_comments_234718.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-28T23:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234718",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_050883.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-29T17:52:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17830#event-50883"
}
```



---

archive/issue_comments_234719.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-29T17:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17830#issuecomment-234719",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
