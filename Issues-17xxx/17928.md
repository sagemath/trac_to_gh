# Issue 17928: opposite of cones and fans

archive/issues_017691.json:
```json
{
    "body": "it would be useful to be able to write -C and -F\nfor the cone obtained by negating the rays of a cone, and same for a fan.\n\n\n**CC:**  @vbraun @novoselt jkeitel\n\n**Keywords:** cone, fan, negative\n\n**Branch/Commit:** [bdf048609e0f1ac50905a9f7b512a5b8bab7b753](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)\n\n**Reviewer:** Andrey Novoseltsev\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17928\n\n",
    "closed_at": "2015-03-12T20:21:50Z",
    "created_at": "2015-03-11T13:34:13Z",
    "labels": [
        "component: geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "opposite of cones and fans",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17928",
    "user": "https://github.com/fchapoton"
}
```
it would be useful to be able to write -C and -F
for the cone obtained by negating the rays of a cone, and same for a fan.


**CC:**  @vbraun @novoselt jkeitel

**Keywords:** cone, fan, negative

**Branch/Commit:** [bdf048609e0f1ac50905a9f7b512a5b8bab7b753](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)

**Reviewer:** Andrey Novoseltsev

**Author:** Frédéric Chapoton

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/17928





---

archive/issue_comments_311884.json:
```json
{
    "body": "**Branch:** [u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)",
    "created_at": "2015-03-11T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311884",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)



---

archive/issue_comments_311885.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-03-11T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311885",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_311886.json:
```json
{
    "body": "**Commit:** [e1ec050f70db144c0c988b61a8ebca85e5fe8deb](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)",
    "created_at": "2015-03-11T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311886",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [e1ec050f70db144c0c988b61a8ebca85e5fe8deb](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)



---

archive/issue_comments_311887.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb\">e1ec050</a></td><td><code>trac #17928 opposite (negative) of cones and fans</code></td></tr></table>\n",
    "created_at": "2015-03-11T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311887",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb">e1ec050</a></td><td><code>trac #17928 opposite (negative) of cones and fans</code></td></tr></table>




---

archive/issue_comments_311888.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-03-11T18:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311888",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_311889.json:
```json
{
    "body": "<a id='comment:2'></a>\nThat would be nice, but:\n1. The cone negation method is in a wrong class and constructs a wrong object.\n2. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)",
    "created_at": "2015-03-11T18:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311889",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
That would be nice, but:
1. The cone negation method is in a wrong class and constructs a wrong object.
2. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)



---

archive/issue_comments_311890.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b\">c8ab1f5</a></td><td><code>trac #17928 neg of cone in correct class</code></td></tr></table>\n",
    "created_at": "2015-03-11T19:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b">c8ab1f5</a></td><td><code>trac #17928 neg of cone in correct class</code></td></tr></table>




---

archive/issue_comments_311891.json:
```json
{
    "body": "**Changing commit** from \"[e1ec050f70db144c0c988b61a8ebca85e5fe8deb](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)\" to \"[c8ab1f52df108a01440e5340baa83a9c4a818f5b](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)\".",
    "created_at": "2015-03-11T19:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e1ec050f70db144c0c988b61a8ebca85e5fe8deb](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)" to "[c8ab1f52df108a01440e5340baa83a9c4a818f5b](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)".



---

archive/issue_comments_311892.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks for your quick reaction.\n\nI think I have taken care of point 1.\n\nConcerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?\n\nBy the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?",
    "created_at": "2015-03-11T19:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311892",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
Thanks for your quick reaction.

I think I have taken care of point 1.

Concerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?

By the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?



---

archive/issue_comments_311893.json:
```json
{
    "body": "**Changing commit** from \"[c8ab1f52df108a01440e5340baa83a9c4a818f5b](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)\" to \"[bdf048609e0f1ac50905a9f7b512a5b8bab7b753](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)\".",
    "created_at": "2015-03-11T20:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c8ab1f52df108a01440e5340baa83a9c4a818f5b](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)" to "[bdf048609e0f1ac50905a9f7b512a5b8bab7b753](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)".



---

archive/issue_comments_311894.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753\">bdf0486</a></td><td><code>trac #17928 setting rays immutable</code></td></tr></table>\n",
    "created_at": "2015-03-11T20:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753">bdf0486</a></td><td><code>trac #17928 setting rays immutable</code></td></tr></table>




---

archive/issue_comments_311895.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-03-11T20:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311895",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_311896.json:
```json
{
    "body": "<a id='comment:6'></a>\nok, this should be correct now, maybe ?",
    "created_at": "2015-03-11T20:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311896",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
ok, this should be correct now, maybe ?



---

archive/issue_comments_311897.json:
```json
{
    "body": "**Reviewer:** Andrey Novoseltsev",
    "created_at": "2015-03-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311897",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** Andrey Novoseltsev



---

archive/issue_comments_311898.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-03-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311898",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_311899.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks good now.\n\nFor fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).",
    "created_at": "2015-03-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311899",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>
Looks good now.

For fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).



---

archive/issue_comments_311900.json:
```json
{
    "body": "<a id='comment:8'></a>\ncommon refinement is now #17938",
    "created_at": "2015-03-12T10:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311900",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
common refinement is now #17938



---

archive/issue_comments_311901.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)\" to \"[bdf048609e0f1ac50905a9f7b512a5b8bab7b753](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)\".",
    "created_at": "2015-03-12T20:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311901",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)" to "[bdf048609e0f1ac50905a9f7b512a5b8bab7b753](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)".



---

archive/issue_comments_311902.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-03-12T20:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17928#issuecomment-311902",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_058042.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-12T20:21:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17928",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17928#event-58042"
}
```
