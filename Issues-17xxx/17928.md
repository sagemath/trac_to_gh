# Issue 17928: opposite of cones and fans

archive/issues_017691.json:
```json
{
    "assignees": [],
    "body": "it would be useful to be able to write -C and -F\nfor the cone obtained by negating the rays of a cone, and same for a fan.\n\n\nCC:  @vbraun @novoselt @sagetrac-jkeitel\n\nKeywords: **cone, fan, negative**\n\nBranch/Commit: **[bdf0486](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)**\n\nReviewer: **Andrey Novoseltsev**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17928_\n\n",
    "closed_at": "2015-03-12T20:21:50Z",
    "created_at": "2015-03-11T13:34:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "opposite of cones and fans",
    "type": "issue",
    "updated_at": "2015-03-12T20:21:50Z",
    "url": "https://github.com/sagemath/sage/issues/17928",
    "user": "https://github.com/fchapoton"
}
```
it would be useful to be able to write -C and -F
for the cone obtained by negating the rays of a cone, and same for a fan.


CC:  @vbraun @novoselt @sagetrac-jkeitel

Keywords: **cone, fan, negative**

Branch/Commit: **[bdf0486](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)**

Reviewer: **Andrey Novoseltsev**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/17928_





---

archive/issue_events_237439.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T13:34:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237439"
}
```



---

archive/issue_events_237440.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T13:34:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237440"
}
```



---

archive/issue_events_237441.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T13:34:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237441"
}
```



---

archive/issue_events_237442.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T13:34:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237442"
}
```



---

archive/issue_comments_245489.json:
```json
{
    "body": "Branch: **[u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)**",
    "created_at": "2015-03-11T13:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245489",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)**



---

archive/issue_events_237443.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T13:40:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237443"
}
```



---

archive/issue_comments_245490.json:
```json
{
    "body": "Commit: **[e1ec050](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)**",
    "created_at": "2015-03-11T13:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245490",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[e1ec050](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)**



---

archive/issue_comments_245491.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb\">e1ec050</a></td><td><code>trac #17928 opposite (negative) of cones and fans</code></td></tr></table>\n",
    "created_at": "2015-03-11T13:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245491",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">Comment 1</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb">e1ec050</a></td><td><code>trac #17928 opposite (negative) of cones and fans</code></td></tr></table>




---

archive/issue_events_237444.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2015-03-11T18:14:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237444"
}
```



---

archive/issue_events_237445.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2015-03-11T18:14:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237445"
}
```



---

archive/issue_comments_245492.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThat would be nice, but:\n1. The cone negation method is in a wrong class and constructs a wrong object.\n2. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)",
    "created_at": "2015-03-11T18:14:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245492",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:2" align="right">Comment 2</div>

That would be nice, but:
1. The cone negation method is in a wrong class and constructs a wrong object.
2. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)



---

archive/issue_comments_245493.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b\">c8ab1f5</a></td><td><code>trac #17928 neg of cone in correct class</code></td></tr></table>\n",
    "created_at": "2015-03-11T19:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245493",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3" align="right">Comment 3</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b">c8ab1f5</a></td><td><code>trac #17928 neg of cone in correct class</code></td></tr></table>




---

archive/issue_comments_245494.json:
```json
{
    "body": "Changed commit from **[e1ec050](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)** to **[c8ab1f5](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)**",
    "created_at": "2015-03-11T19:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245494",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e1ec050](https://github.com/sagemath/sagetrac-mirror/commit/e1ec050f70db144c0c988b61a8ebca85e5fe8deb)** to **[c8ab1f5](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)**



---

archive/issue_comments_245495.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThanks for your quick reaction.\n\nI think I have taken care of point 1.\n\nConcerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?\n\nBy the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?",
    "created_at": "2015-03-11T19:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245495",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">Comment 4</div>

Thanks for your quick reaction.

I think I have taken care of point 1.

Concerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?

By the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?



---

archive/issue_comments_245496.json:
```json
{
    "body": "Changed commit from **[c8ab1f5](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)** to **[bdf0486](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)**",
    "created_at": "2015-03-11T20:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245496",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c8ab1f5](https://github.com/sagemath/sagetrac-mirror/commit/c8ab1f52df108a01440e5340baa83a9c4a818f5b)** to **[bdf0486](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)**



---

archive/issue_comments_245497.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753\">bdf0486</a></td><td><code>trac #17928 setting rays immutable</code></td></tr></table>\n",
    "created_at": "2015-03-11T20:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245497",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753">bdf0486</a></td><td><code>trac #17928 setting rays immutable</code></td></tr></table>




---

archive/issue_events_237446.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T20:07:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237446"
}
```



---

archive/issue_events_237447.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-11T20:07:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237447"
}
```



---

archive/issue_comments_245498.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nok, this should be correct now, maybe ?",
    "created_at": "2015-03-11T20:07:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245498",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">Comment 6</div>

ok, this should be correct now, maybe ?



---

archive/issue_comments_245499.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev**",
    "created_at": "2015-03-11T20:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245499",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **Andrey Novoseltsev**



---

archive/issue_events_237448.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2015-03-11T20:24:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237448"
}
```



---

archive/issue_events_237449.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2015-03-11T20:24:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237449"
}
```



---

archive/issue_comments_245500.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nLooks good now.\n\nFor fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).",
    "created_at": "2015-03-11T20:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245500",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:7" align="right">Comment 7</div>

Looks good now.

For fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).



---

archive/issue_comments_245501.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\ncommon refinement is now #17938",
    "created_at": "2015-03-12T10:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245501",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">Comment 8</div>

common refinement is now #17938



---

archive/issue_comments_245502.json:
```json
{
    "body": "Changed branch from **[u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)** to **[bdf0486](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)**",
    "created_at": "2015-03-12T20:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17928#issuecomment-245502",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/17928](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/17928)** to **[bdf0486](https://github.com/sagemath/sagetrac-mirror/commit/bdf048609e0f1ac50905a9f7b512a5b8bab7b753)**



---

archive/issue_events_237450.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-12T20:21:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237450"
}
```



---

archive/issue_events_237451.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f210002fc48b8634d6a1429ed957e8c8ad04a38a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-03-12T20:21:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17928",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17928#event-237451"
}
```
