# Issue 17013: WordDatatype_char

archive/issues_016776.json:
```json
{
    "assignees": [],
    "body": "Creation of a new class WordDatatype_char that has in backend an 'unsigned char *' and use it wherever possible. The implementation is much faster than anything else but is only available for alphabet contained in [0,255].\n\nCC:  @seblabbe\n\nKeywords: **words**\n\nBranch: **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)**\n\nReviewer: **S\u00e9bastien Labb\u00e9, Jeroen Demeyer**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17013_\n\n",
    "closed_at": "2014-09-25T12:05:55Z",
    "created_at": "2014-09-20T15:17:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "WordDatatype_char",
    "type": "issue",
    "updated_at": "2014-12-14T10:33:20Z",
    "url": "https://github.com/sagemath/sage/issues/17013",
    "user": "https://github.com/videlec"
}
```
Creation of a new class WordDatatype_char that has in backend an 'unsigned char *' and use it wherever possible. The implementation is much faster than anything else but is only available for alphabet contained in [0,255].

CC:  @seblabbe

Keywords: **words**

Branch: **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)**

Reviewer: **Sébastien Labbé, Jeroen Demeyer**

Author: **Vincent Delecroix**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/17013_





---

archive/issue_events_243113.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T15:17:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243113"
}
```



---

archive/issue_events_243114.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T15:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243114"
}
```



---

archive/issue_events_243115.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T15:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243115"
}
```



---

archive/issue_events_243116.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T15:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243116"
}
```



---

archive/issue_comments_225001.json:
```json
{
    "body": "Commit: **[398b33c](https://github.com/sagemath/sagetrac-mirror/commit/398b33c0a6f6a96f5c301e1867edb47158703776)**",
    "created_at": "2014-09-20T15:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225001",
    "user": "https://github.com/videlec"
}
```

Commit: **[398b33c](https://github.com/sagemath/sagetrac-mirror/commit/398b33c0a6f6a96f5c301e1867edb47158703776)**



---

archive/issue_comments_225002.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a25e28644286e665c2cbfea5fec1ffc50e704101\">a25e286</a></td><td><code>trac #17013: new class WordDatatype_char</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/398b33c0a6f6a96f5c301e1867edb47158703776\">398b33c</a></td><td><code>trac #17013: added is_square in WordDatatype_char</code></td></tr></table>\n",
    "created_at": "2014-09-20T15:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225002",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a25e28644286e665c2cbfea5fec1ffc50e704101">a25e286</a></td><td><code>trac #17013: new class WordDatatype_char</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/398b33c0a6f6a96f5c301e1867edb47158703776">398b33c</a></td><td><code>trac #17013: added is_square in WordDatatype_char</code></td></tr></table>




---

archive/issue_events_243117.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T15:35:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243117"
}
```



---

archive/issue_comments_225003.json:
```json
{
    "body": "Branch: **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)**",
    "created_at": "2014-09-20T15:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225003",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)**



---

archive/issue_comments_225004.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)** to **[u/slabbe/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17013)**",
    "created_at": "2014-09-20T18:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225004",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)** to **[u/slabbe/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17013)**



---

archive/issue_comments_225005.json:
```json
{
    "body": "Changed commit from **[398b33c](https://github.com/sagemath/sagetrac-mirror/commit/398b33c0a6f6a96f5c301e1867edb47158703776)** to **[a563343](https://github.com/sagemath/sagetrac-mirror/commit/a563343267f1690d74275ad3835cdebef8512a19)**",
    "created_at": "2014-09-20T18:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225005",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[398b33c](https://github.com/sagemath/sagetrac-mirror/commit/398b33c0a6f6a96f5c301e1867edb47158703776)** to **[a563343](https://github.com/sagemath/sagetrac-mirror/commit/a563343267f1690d74275ad3835cdebef8512a19)**



---

archive/issue_comments_225006.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a563343267f1690d74275ad3835cdebef8512a19\">a563343</a></td><td><code>trac #17013: doctests improvements + bug fix</code></td></tr></table>\n",
    "created_at": "2014-09-20T18:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225006",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a563343267f1690d74275ad3835cdebef8512a19">a563343</a></td><td><code>trac #17013: doctests improvements + bug fix</code></td></tr></table>




---

archive/issue_comments_225007.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIf Vincent agrees with my changes, then he can set this ticket to positive review.",
    "created_at": "2014-09-20T18:54:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225007",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:3" align="right">comment:3</div>

If Vincent agrees with my changes, then he can set this ticket to positive review.



---

archive/issue_comments_225008.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2014-09-20T18:54:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225008",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_225009.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHere is one benchmark.\n\nBEFORE::\n\n```\n    sage: w = Word([0,-1,2]*100, alphabet=[0,-1,2])\n    sage: type(w)\n    <class 'sage.combinat.words.word.FiniteWord_list'>\n    sage: %timeit w.is_square_free()\n    1000 loops, best of 3: 417 \u00b5s per loop\n```\n\nAFTER::\n\n```\n    sage: w = Word([0,1,2]*100, alphabet=[0,1,2])\n    sage: type(w)\n    <class 'sage.combinat.words.word.FiniteWord_char'>\n    sage: %timeit w.is_square_free()\n    100000 loops, best of 3: 6.29 \u00b5s per loop\n```\n\nWe should also add here some benchmark about equality test and also `__getitem__`.",
    "created_at": "2014-09-20T18:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225009",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:4" align="right">comment:4</div>

Here is one benchmark.

BEFORE::

```
    sage: w = Word([0,-1,2]*100, alphabet=[0,-1,2])
    sage: type(w)
    <class 'sage.combinat.words.word.FiniteWord_list'>
    sage: %timeit w.is_square_free()
    1000 loops, best of 3: 417 µs per loop
```

AFTER::

```
    sage: w = Word([0,1,2]*100, alphabet=[0,1,2])
    sage: type(w)
    <class 'sage.combinat.words.word.FiniteWord_char'>
    sage: %timeit w.is_square_free()
    100000 loops, best of 3: 6.29 µs per loop
```

We should also add here some benchmark about equality test and also `__getitem__`.



---

archive/issue_comments_225010.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@seblabbe](#comment:4):\n> We should also add here some benchmark about equality test and also `__getitem__`.\n\nEDIT: the timings were edited because there were not about `FiniteWord_str` but `FiniteWord_list`...\n\nCompetitions between:\n- Python string\n- `FiniteWord_str`\n- `FiniteWord_char`\n\n```\nsage: W1 = Words('abc')\nsage: W2 = Words([0,1,2])\nsage: w1 = W1(''.join(choice('abc') for _ in range(1000)))\nsage: w2 = W2([choice([0,1,2]) for _ in range(1000])\nsage: s = str(w1)\n```\nthen on slices\n\n```\nsage: timeit(\"for i in range(1000): u = w1[:i]\")\n25 loops, best of 3: 25.3 ms per loop\nsage: timeit(\"for i in range(1000): u = w2[:i]\")\n625 loops, best of 3: 237 \u00b5s per loop\nsage: timeit(\"for i in range(1000): u = s[:i]\")\n625 loops, best of 3: 129 \u00b5s per loop\n```\nand on equality\n\n```\nsage: timeit(\"w1 == w1\")\n625 loops, best of 3: 365 ns per loop\nsage: timeit(\"w2 == w2\")\n625 loops, best of 3: 187 ns per loop\nsage: timeit(\"s == s\")\n625 loops, best of 3: 86.6 ns per loop\n```\nSo Python strings are still ahead, but its much less ridiculous.\n\nVincent",
    "created_at": "2014-09-20T21:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225010",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@seblabbe](#comment:4):
> We should also add here some benchmark about equality test and also `__getitem__`.

EDIT: the timings were edited because there were not about `FiniteWord_str` but `FiniteWord_list`...

Competitions between:
- Python string
- `FiniteWord_str`
- `FiniteWord_char`

```
sage: W1 = Words('abc')
sage: W2 = Words([0,1,2])
sage: w1 = W1(''.join(choice('abc') for _ in range(1000)))
sage: w2 = W2([choice([0,1,2]) for _ in range(1000])
sage: s = str(w1)
```
then on slices

```
sage: timeit("for i in range(1000): u = w1[:i]")
25 loops, best of 3: 25.3 ms per loop
sage: timeit("for i in range(1000): u = w2[:i]")
625 loops, best of 3: 237 µs per loop
sage: timeit("for i in range(1000): u = s[:i]")
625 loops, best of 3: 129 µs per loop
```
and on equality

```
sage: timeit("w1 == w1")
625 loops, best of 3: 365 ns per loop
sage: timeit("w2 == w2")
625 loops, best of 3: 187 ns per loop
sage: timeit("s == s")
625 loops, best of 3: 86.6 ns per loop
```
So Python strings are still ahead, but its much less ridiculous.

Vincent



---

archive/issue_comments_225011.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@seblabbe](#comment:3):\n> If Vincent agrees with my changes, then he can set this ticket to positive review.\n\nI am! Thanks for the review.\n\nVincent",
    "created_at": "2014-09-20T21:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225011",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@seblabbe](#comment:3):
> If Vincent agrees with my changes, then he can set this ticket to positive review.

I am! Thanks for the review.

Vincent



---

archive/issue_events_243118.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T21:40:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243118"
}
```



---

archive/issue_events_243119.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-20T21:40:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243119"
}
```



---

archive/issue_comments_225012.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n> Competitions between:\n> - Python string\n> - `FiniteWord_str`\n> - `FiniteWord_char`\n\nI believe you do not have `FiniteWord_str` in the competition...\n\n```\nsage: type(w1)                                     \n<class 'sage.combinat.words.word.FiniteWord_list'> \n```",
    "created_at": "2014-09-20T21:44:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225012",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:7" align="right">comment:7</div>

> Competitions between:
> - Python string
> - `FiniteWord_str`
> - `FiniteWord_char`

I believe you do not have `FiniteWord_str` in the competition...

```
sage: type(w1)                                     
<class 'sage.combinat.words.word.FiniteWord_list'> 
```



---

archive/issue_comments_225013.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nInstead of (note that you already have defined i as a `ssize_t`):\n\n```python\ncdef ssize_t i\nfor i in range(w._length-1, -1, -1):\n```\n\nMaybe the following is better and would allow to use `size_t` type?\n\n```python\ncdef size_t i\nfor i from w._length > i >= 0:\n```",
    "created_at": "2014-09-20T21:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225013",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:8" align="right">comment:8</div>

Instead of (note that you already have defined i as a `ssize_t`):

```python
cdef ssize_t i
for i in range(w._length-1, -1, -1):
```

Maybe the following is better and would allow to use `size_t` type?

```python
cdef size_t i
for i from w._length > i >= 0:
```



---

archive/issue_comments_225014.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@seblabbe](#comment:8):\n> Instead of (note that you already have defined i as a `ssize_t`):\n> \n> ```python\n> cdef ssize_t i\n> for i in range(w._length-1, -1, -1):\n> ```\n> \n> Maybe the following is better and would allow to use `size_t` type?\n> \n> ```python\n> cdef size_t i\n> for i from w._length > i >= 0:\n> ```\n\nNope, it does note change anything. And be careful, your second loop is infinite (a size_t is always >= 0).",
    "created_at": "2014-09-20T21:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225014",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@seblabbe](#comment:8):
> Instead of (note that you already have defined i as a `ssize_t`):
> 
> ```python
> cdef ssize_t i
> for i in range(w._length-1, -1, -1):
> ```
> 
> Maybe the following is better and would allow to use `size_t` type?
> 
> ```python
> cdef size_t i
> for i from w._length > i >= 0:
> ```

Nope, it does note change anything. And be careful, your second loop is infinite (a size_t is always >= 0).



---

archive/issue_comments_225015.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@seblabbe](#comment:7):\n> > Competitions between:\n> > - Python string\n> > - `FiniteWord_str`\n> > - `FiniteWord_char`\n\n> \n> I believe you do not have `FiniteWord_str` in the competition...\n> \n> ```\n> sage: type(w1)                                     \n> <class 'sage.combinat.words.word.FiniteWord_list'> \n> ```\n\nOups... corrected. Does not change anything for slicing, but huge difference in equality.",
    "created_at": "2014-09-20T21:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225015",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@seblabbe](#comment:7):
> > Competitions between:
> > - Python string
> > - `FiniteWord_str`
> > - `FiniteWord_char`

> 
> I believe you do not have `FiniteWord_str` in the competition...
> 
> ```
> sage: type(w1)                                     
> <class 'sage.combinat.words.word.FiniteWord_list'> 
> ```

Oups... corrected. Does not change anything for slicing, but huge difference in equality.



---

archive/issue_comments_225016.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nGreat, so I am ok with this ticket. Positive review as already set!\n\nS\u00e9bastien",
    "created_at": "2014-09-20T22:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225016",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:11" align="right">comment:11</div>

Great, so I am ok with this ticket. Positive review as already set!

Sébastien



---

archive/issue_comments_225017.json:
```json
{
    "body": "Changed reviewer from **S\u00e9bastien Labb\u00e9** to **S\u00e9bastien Labb\u00e9, Jeroen Demeyer**",
    "created_at": "2014-09-24T15:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225017",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Sébastien Labbé** to **Sébastien Labbé, Jeroen Demeyer**



---

archive/issue_comments_225018.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThis is absolutely not the right way to handle exceptions:\n\n```\nif PySlice_GetIndicesEx(...) < 0:\n    return\n```\nThe fact that it \"works\" is because IPython picks up the exception much later than you intended. Note the botched traceback:\n\n```\nsage: Words([0,1,2,3])([0,1,0,2,0,3,1,2,3])[slice(\"foo\")]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nTypeError: slice indices must be integers or None or have an __index__ method\n```\nThe right way is to declare your function as `except -1` and let Cython do the right thing. See http://docs.cython.org/src/userguide/language_basics.html#error-return-values",
    "created_at": "2014-09-24T15:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225018",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

This is absolutely not the right way to handle exceptions:

```
if PySlice_GetIndicesEx(...) < 0:
    return
```
The fact that it "works" is because IPython picks up the exception much later than you intended. Note the botched traceback:

```
sage: Words([0,1,2,3])([0,1,0,2,0,3,1,2,3])[slice("foo")]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
TypeError: slice indices must be integers or None or have an __index__ method
```
The right way is to declare your function as `except -1` and let Cython do the right thing. See http://docs.cython.org/src/userguide/language_basics.html#error-return-values



---

archive/issue_events_243120.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-24T15:34:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243120"
}
```



---

archive/issue_events_243121.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-24T15:34:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243121"
}
```



---

archive/issue_comments_225019.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSee [https://github.com/cython/cython/commit/543c33c4a1fdf105c3173a0950297ce4f7550ece](https://github.com/cython/cython/commit/543c33c4a1fdf105c3173a0950297ce4f7550ece) for how such a declaration would look like.\n\nIf you feel like it, add that patch to the Cython package and then you can do\n\n```\nfrom cpython.slice cimport *\n```\ninstead of manually declaring the `PySlice_` functions.",
    "created_at": "2014-09-24T16:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225019",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

See [https://github.com/cython/cython/commit/543c33c4a1fdf105c3173a0950297ce4f7550ece](https://github.com/cython/cython/commit/543c33c4a1fdf105c3173a0950297ce4f7550ece) for how such a declaration would look like.

If you feel like it, add that patch to the Cython package and then you can do

```
from cpython.slice cimport *
```
instead of manually declaring the `PySlice_` functions.



---

archive/issue_comments_225020.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHi Jeroen,\n\nAs you noticed, the commit in cython is 3 days old... and the reason is because I asked on the [cython-users list](https://groups.google.com/forum/#!topic/cython-users/2G-QguqmgKk). Patching is much more work than the declaration (see the last commit):\n\n```\ncdef extern from \"Python.h\":\n    int PySlice_GetIndicesEx(...) except -1\n```\n\nVincent",
    "created_at": "2014-09-24T16:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225020",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

Hi Jeroen,

As you noticed, the commit in cython is 3 days old... and the reason is because I asked on the [cython-users list](https://groups.google.com/forum/#!topic/cython-users/2G-QguqmgKk). Patching is much more work than the declaration (see the last commit):

```
cdef extern from "Python.h":
    int PySlice_GetIndicesEx(...) except -1
```

Vincent



---

archive/issue_comments_225021.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e\">c00964d</a></td><td><code>trac #17013: fix Python C API declaration</code></td></tr></table>\n",
    "created_at": "2014-09-24T16:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225021",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e">c00964d</a></td><td><code>trac #17013: fix Python C API declaration</code></td></tr></table>




---

archive/issue_events_243122.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-24T16:19:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243122"
}
```



---

archive/issue_events_243123.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-24T16:19:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243123"
}
```



---

archive/issue_comments_225022.json:
```json
{
    "body": "Changed branch from **[u/slabbe/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17013)** to **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)**",
    "created_at": "2014-09-24T16:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225022",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/slabbe/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/17013)** to **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)**



---

archive/issue_comments_225023.json:
```json
{
    "body": "Changed commit from **[a563343](https://github.com/sagemath/sagetrac-mirror/commit/a563343267f1690d74275ad3835cdebef8512a19)** to **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)**",
    "created_at": "2014-09-24T16:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225023",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[a563343](https://github.com/sagemath/sagetrac-mirror/commit/a563343267f1690d74275ad3835cdebef8512a19)** to **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)**



---

archive/issue_events_243124.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-24T16:45:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243124"
}
```



---

archive/issue_events_243125.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-24T16:45:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243125"
}
```



---

archive/issue_comments_225024.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks!",
    "created_at": "2014-09-24T16:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225024",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks!



---

archive/issue_comments_225025.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)** to **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)**",
    "created_at": "2014-09-25T12:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225025",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/17013](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/17013)** to **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)**



---

archive/issue_events_243126.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-25T12:05:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243126"
}
```



---

archive/issue_events_243127.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-25T12:05:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17013#event-243127"
}
```



---

archive/issue_comments_225026.json:
```json
{
    "body": "Changed commit from **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)** to none",
    "created_at": "2014-12-13T23:24:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225026",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[c00964d](https://github.com/sagemath/sagetrac-mirror/commit/c00964da4655d7580277c3d4aba1e0a51b06b78e)** to none



---

archive/issue_comments_225027.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nNote that #15820 seems to address similar applications, but more general (without restriction to alphabets of length 255). In preliminary versions of bounded integer sequences, I experimented with `char*` as underlying data structure, but found that using GMP long integers with the shift operations provided by GMP was faster.",
    "created_at": "2014-12-13T23:24:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225027",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

Note that #15820 seems to address similar applications, but more general (without restriction to alphabets of length 255). In preliminary versions of bounded integer sequences, I experimented with `char*` as underlying data structure, but found that using GMP long integers with the shift operations provided by GMP was faster.



---

archive/issue_comments_225028.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYou should really compare the speed of the operations here with those from #15820. What I dislike about this ticket here is that it just talks about `WordDatatype_char` which doesn't mean anything to me: I never noticed that you were implementing sequences of integers in the interval [0,255].\n\nOn #15820, I insisted that the approach would be as general as possible. Of course, Simon King (the author) had a particular application in mind, but the code in #15820 never refers to that application, it is very general.",
    "created_at": "2014-12-14T08:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225028",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

You should really compare the speed of the operations here with those from #15820. What I dislike about this ticket here is that it just talks about `WordDatatype_char` which doesn't mean anything to me: I never noticed that you were implementing sequences of integers in the interval [0,255].

On #15820, I insisted that the approach would be as general as possible. Of course, Simon King (the author) had a particular application in mind, but the code in #15820 never refers to that application, it is very general.



---

archive/issue_comments_225029.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHello,\n\nThe thing is that having a complicated datatype with letters not aligned with computer words also has disadvantages. Namely:\n1. code less readable\n2. might be slower if not carefully done (you can not use `memcmp`, `memcpy` from `strings.h`)\nAnd implementing more involved algorithms (pattern matchings, counting subsequences, etc) might be painful.\n\nNevertheless, I would be happy to give it a try and do proper benchmarkings. There will be no problem to remove the data structure here if #15820 is just better.\n\nVincent",
    "created_at": "2014-12-14T09:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225029",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

Hello,

The thing is that having a complicated datatype with letters not aligned with computer words also has disadvantages. Namely:
1. code less readable
2. might be slower if not carefully done (you can not use `memcmp`, `memcpy` from `strings.h`)
And implementing more involved algorithms (pattern matchings, counting subsequences, etc) might be painful.

Nevertheless, I would be happy to give it a try and do proper benchmarkings. There will be no problem to remove the data structure here if #15820 is just better.

Vincent



---

archive/issue_comments_225030.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@videlec](#comment:21):\n> The thing is that having a complicated datatype with letters not aligned with computer words also has disadvantages. Namely:\n> 1. code less readable\n\nTrue for the underlying boilerplate functions. Not necessarily true for higher level code.\n\n\n> 2. might be slower if not carefully done (you can not use `memcmp`, `memcpy` from `strings.h`)\n\nWhy can one not use `memcmp` and `memcpy`? Respectively, what's wrong with using `mpn_cmp` and similar functions?\n\n> And implementing more involved algorithms (pattern matchings, counting subsequences, etc) might be painful.\n\nIndeed, detection of subsequences (which is also implemented in #15820) is a bit more complicated than it would be with `char*`. Detection of subsequences is one of the operations I care about. Admittedly, with my application to right modules over path algebras in mind, I care more about testing whether a sequence *starts* with a given subsequence than whether it just *contains* the subsequence.",
    "created_at": "2014-12-14T10:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225030",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@videlec](#comment:21):
> The thing is that having a complicated datatype with letters not aligned with computer words also has disadvantages. Namely:
> 1. code less readable

True for the underlying boilerplate functions. Not necessarily true for higher level code.


> 2. might be slower if not carefully done (you can not use `memcmp`, `memcpy` from `strings.h`)

Why can one not use `memcmp` and `memcpy`? Respectively, what's wrong with using `mpn_cmp` and similar functions?

> And implementing more involved algorithms (pattern matchings, counting subsequences, etc) might be painful.

Indeed, detection of subsequences (which is also implemented in #15820) is a bit more complicated than it would be with `char*`. Detection of subsequences is one of the operations I care about. Admittedly, with my application to right modules over path algebras in mind, I care more about testing whether a sequence *starts* with a given subsequence than whether it just *contains* the subsequence.



---

archive/issue_comments_225031.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOf course, bounded integer sequences have one disadvantage for your applications: you can not prescribe an alphabet. Each bounded integer sequences is formed by integers between 0 and a prescribed bound.\n\nAnyway, here are some timings:\n\n```\nsage: from sage.data_structures.bounded_integer_sequences import BoundedIntegerSequence\nsage: w_s = Word([9,2,0,1,5,3,10,15,1,14,8,3]*100, alphabet=range(16))\nsage: type(w_s)\n<class 'sage.combinat.words.word.FiniteWord_char'>\nsage: w_l = Word([9,2,0,1,5,3,10,15,1,14,8,3]*100)\nsage: type(w_l)\n<class 'sage.combinat.words.word.FiniteWord_list'>\nsage: w_t = Word((9,2,0,1,5,3,10,15,1,14,8,3)*100)\nsage: type(w_t)\n<class 'sage.combinat.words.word.FiniteWord_tuple'>\nsage: w_b = BoundedIntegerSequence(16, [9,2,0,1,5,3,10,15,1,14,8,3]*100)\nsage: w2_s = Word([9,2,0,1,5,3,10,15,1,14,8,3]*99+[9,2,0,1,5,3,10,15,1,14,3,8], alphabet=range(16))\nsage: w2_l = Word([9,2,0,1,5,3,10,15,1,14,8,3]*99+[9,2,0,1,5,3,10,15,1,14,3,8])\nsage: w2_t = Word((9,2,0,1,5,3,10,15,1,14,8,3)*99+(9,2,0,1,5,3,10,15,1,14,3,8))\nsage: w2_b = BoundedIntegerSequence(16, [9,2,0,1,5,3,10,15,1,14,8,3]*99+[9,2,0,1,5,3,10,15,1,14,3,8])\nsage: list(w_s)==list(w_l)==list(w_t)==list(w_b)\nTrue\nsage: list(w2_s)==list(w2_l)==list(w2_t)==list(w2_b)\nTrue\n```\n\nComparison:\n\n```\nsage: %timeit w_s==w2_s\n100000 loops, best of 3: 2.57 \u00b5s per loop\nsage: %timeit w_l==w2_l\n10000 loops, best of 3: 57.8 \u00b5s per loop\nsage: %timeit w_t==w2_t\n10000 loops, best of 3: 56 \u00b5s per loop\nsage: %timeit w_b==w2_b\n1000000 loops, best of 3: 537 ns per loop\n```\n\nHash, which is not (yet?) cached for bounded integer sequences:\n\n```\nsage: %timeit hash(w_s)\n10000000 loops, best of 3: 137 ns per loop\nsage: %timeit hash(w_l)\n10000000 loops, best of 3: 138 ns per loop\nsage: %timeit hash(w_t)\n10000000 loops, best of 3: 137 ns per loop\nsage: %timeit hash(w_b)\n1000000 loops, best of 3: 246 ns per loop\n```\n\nConcatenation:\n\n```\nsage: list(w_s+w2_s)==list(w_l+w2_l)==list(w_t+w2_t)==list(w_b+w2_b)\nTrue\nsage: %timeit w_s+w2_s\n1000 loops, best of 3: 336 \u00b5s per loop\nsage: %timeit w_l+w2_l\n10000 loops, best of 3: 31.1 \u00b5s per loop\nsage: %timeit w_t+w2_t\n10000 loops, best of 3: 31.7 \u00b5s per loop\nsage: %timeit w_b+w2_b\n1000000 loops, best of 3: 1.05 \u00b5s per loop\n```\n\nSubsequence containment:\n\n```\nsage: sub_s = Word([9,2,0,1,5,3,10,15,1,14,3,8], alphabet=range(16))\nsage: sub_l = Word([9,2,0,1,5,3,10,15,1,14,3,8])\nsage: sub_t = Word((9,2,0,1,5,3,10,15,1,14,3,8))\nsage: sub_b = BoundedIntegerSequence(16, [9,2,0,1,5,3,10,15,1,14,3,8])\nsage: W_s = w2_s+w_s\nsage: W_l = w2_l+w_l\nsage: W_t = w2_t+w_t\nsage: W_b = w2_b+w_b\nsage: sub_s.is_subword_of(W_s)\nTrue\nsage: sub_b in W_b\nTrue\nsage: %timeit sub_s.is_subword_of(W_s)\n10000 loops, best of 3: 21.3 \u00b5s per loop\nsage: %timeit sub_l.is_subword_of(W_l)\n100000 loops, best of 3: 10.9 \u00b5s per loop\nsage: %timeit sub_t.is_subword_of(W_t)\n100000 loops, best of 3: 10.7 \u00b5s per loop\nsage: %timeit sub_b in W_b\n100000 loops, best of 3: 10.8 \u00b5s per loop\n```\n\nSo, using a compressed data format (where many letters are squeezed into one machine word) is not bad for the operations above.",
    "created_at": "2014-12-14T10:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225031",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

Of course, bounded integer sequences have one disadvantage for your applications: you can not prescribe an alphabet. Each bounded integer sequences is formed by integers between 0 and a prescribed bound.

Anyway, here are some timings:

```
sage: from sage.data_structures.bounded_integer_sequences import BoundedIntegerSequence
sage: w_s = Word([9,2,0,1,5,3,10,15,1,14,8,3]*100, alphabet=range(16))
sage: type(w_s)
<class 'sage.combinat.words.word.FiniteWord_char'>
sage: w_l = Word([9,2,0,1,5,3,10,15,1,14,8,3]*100)
sage: type(w_l)
<class 'sage.combinat.words.word.FiniteWord_list'>
sage: w_t = Word((9,2,0,1,5,3,10,15,1,14,8,3)*100)
sage: type(w_t)
<class 'sage.combinat.words.word.FiniteWord_tuple'>
sage: w_b = BoundedIntegerSequence(16, [9,2,0,1,5,3,10,15,1,14,8,3]*100)
sage: w2_s = Word([9,2,0,1,5,3,10,15,1,14,8,3]*99+[9,2,0,1,5,3,10,15,1,14,3,8], alphabet=range(16))
sage: w2_l = Word([9,2,0,1,5,3,10,15,1,14,8,3]*99+[9,2,0,1,5,3,10,15,1,14,3,8])
sage: w2_t = Word((9,2,0,1,5,3,10,15,1,14,8,3)*99+(9,2,0,1,5,3,10,15,1,14,3,8))
sage: w2_b = BoundedIntegerSequence(16, [9,2,0,1,5,3,10,15,1,14,8,3]*99+[9,2,0,1,5,3,10,15,1,14,3,8])
sage: list(w_s)==list(w_l)==list(w_t)==list(w_b)
True
sage: list(w2_s)==list(w2_l)==list(w2_t)==list(w2_b)
True
```

Comparison:

```
sage: %timeit w_s==w2_s
100000 loops, best of 3: 2.57 µs per loop
sage: %timeit w_l==w2_l
10000 loops, best of 3: 57.8 µs per loop
sage: %timeit w_t==w2_t
10000 loops, best of 3: 56 µs per loop
sage: %timeit w_b==w2_b
1000000 loops, best of 3: 537 ns per loop
```

Hash, which is not (yet?) cached for bounded integer sequences:

```
sage: %timeit hash(w_s)
10000000 loops, best of 3: 137 ns per loop
sage: %timeit hash(w_l)
10000000 loops, best of 3: 138 ns per loop
sage: %timeit hash(w_t)
10000000 loops, best of 3: 137 ns per loop
sage: %timeit hash(w_b)
1000000 loops, best of 3: 246 ns per loop
```

Concatenation:

```
sage: list(w_s+w2_s)==list(w_l+w2_l)==list(w_t+w2_t)==list(w_b+w2_b)
True
sage: %timeit w_s+w2_s
1000 loops, best of 3: 336 µs per loop
sage: %timeit w_l+w2_l
10000 loops, best of 3: 31.1 µs per loop
sage: %timeit w_t+w2_t
10000 loops, best of 3: 31.7 µs per loop
sage: %timeit w_b+w2_b
1000000 loops, best of 3: 1.05 µs per loop
```

Subsequence containment:

```
sage: sub_s = Word([9,2,0,1,5,3,10,15,1,14,3,8], alphabet=range(16))
sage: sub_l = Word([9,2,0,1,5,3,10,15,1,14,3,8])
sage: sub_t = Word((9,2,0,1,5,3,10,15,1,14,3,8))
sage: sub_b = BoundedIntegerSequence(16, [9,2,0,1,5,3,10,15,1,14,3,8])
sage: W_s = w2_s+w_s
sage: W_l = w2_l+w_l
sage: W_t = w2_t+w_t
sage: W_b = w2_b+w_b
sage: sub_s.is_subword_of(W_s)
True
sage: sub_b in W_b
True
sage: %timeit sub_s.is_subword_of(W_s)
10000 loops, best of 3: 21.3 µs per loop
sage: %timeit sub_l.is_subword_of(W_l)
100000 loops, best of 3: 10.9 µs per loop
sage: %timeit sub_t.is_subword_of(W_t)
100000 loops, best of 3: 10.7 µs per loop
sage: %timeit sub_b in W_b
100000 loops, best of 3: 10.8 µs per loop
```

So, using a compressed data format (where many letters are squeezed into one machine word) is not bad for the operations above.



---

archive/issue_comments_225032.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI forgot slicing:\n\n```\nsage: list(w_s[30:70]) == list(w_b[30:70])\nTrue\nsage: %timeit x=w_s[30:70]\n1000000 loops, best of 3: 1.02 \u00b5s per loop\nsage: %timeit x=w_l[30:70]\n10000 loops, best of 3: 20.6 \u00b5s per loop\nsage: %timeit x=w_t[30:70]\n10000 loops, best of 3: 21 \u00b5s per loop\nsage: %timeit x=w_b[30:70]\n1000000 loops, best of 3: 1.14 \u00b5s per loop\nsage: list(w_s[30:70:2]) == list(w_b[30:70:2])\nTrue\nsage: %timeit x=w_s[30:70:2]\n100000 loops, best of 3: 2.65 \u00b5s per loop\nsage: %timeit x=w_l[30:70:2]\n100000 loops, best of 3: 13.3 \u00b5s per loop\nsage: %timeit x=w_t[30:70:2]\n100000 loops, best of 3: 14.4 \u00b5s per loop\nsage: %timeit x=w_b[30:70:2]\n1000000 loops, best of 3: 1.63 \u00b5s per loop\n```",
    "created_at": "2014-12-14T10:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17013#issuecomment-225032",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">comment:24</div>

I forgot slicing:

```
sage: list(w_s[30:70]) == list(w_b[30:70])
True
sage: %timeit x=w_s[30:70]
1000000 loops, best of 3: 1.02 µs per loop
sage: %timeit x=w_l[30:70]
10000 loops, best of 3: 20.6 µs per loop
sage: %timeit x=w_t[30:70]
10000 loops, best of 3: 21 µs per loop
sage: %timeit x=w_b[30:70]
1000000 loops, best of 3: 1.14 µs per loop
sage: list(w_s[30:70:2]) == list(w_b[30:70:2])
True
sage: %timeit x=w_s[30:70:2]
100000 loops, best of 3: 2.65 µs per loop
sage: %timeit x=w_l[30:70:2]
100000 loops, best of 3: 13.3 µs per loop
sage: %timeit x=w_t[30:70:2]
100000 loops, best of 3: 14.4 µs per loop
sage: %timeit x=w_b[30:70:2]
1000000 loops, best of 3: 1.63 µs per loop
```
