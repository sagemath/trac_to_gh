# Issue 17806: MPIR fails to build on 32-bit Linux with SAGE_FAT_BINARY=yes

archive/issues_017569.json:
```json
{
    "body": "Both the arando buildbot binary build as well as the virtual machine build of Sage-6.5 failed with \n\n```\nIn file included from fat.c:123:0:\n../cpuid.c: In function '__gmpn_cpu':\n../cpuid.c:96:47: error: 'CPUSETUP_ivybridge' undeclared (first use in this function)\n #define CPUIS(x) do{TRACE(printf(\"  \"#x\"\\n\"));CPUSETUP_##x;}while(0)\n                                               ^\n../cpuid.c:174:24: note: in expansion of macro 'CPUIS'\n      if (model == 58){ CPUIS(ivybridge);break;}\n                        ^\n../cpuid.c:96:47: note: each undeclared identifier is reported only once for each function it appears in\n #define CPUIS(x) do{TRACE(printf(\"  \"#x\"\\n\"));CPUSETUP_##x;}while(0)\n                                               ^\n../cpuid.c:174:24: note: in expansion of macro 'CPUIS'\n      if (model == 58){ CPUIS(ivybridge);break;}\n                        ^\n../cpuid.c:96:47: error: 'CPUSETUP_haswell' undeclared (first use in this function)\n #define CPUIS(x) do{TRACE(printf(\"  \"#x\"\\n\"));CPUSETUP_##x;}while(0)\n                                               ^\n../cpuid.c:175:22: note: in expansion of macro 'CPUIS'\n    if (model == 60){ CPUIS(haswell);break;}\n                      ^\n../cpuid.c:96:47: error: 'CPUSETUP_piledriver' undeclared (first use in this function)\n #define CPUIS(x) do{TRACE(printf(\"  \"#x\"\\n\"));CPUSETUP_##x;}while(0)\n                                               ^\n../cpuid.c:230:24: note: in expansion of macro 'CPUIS'\n      if (model == 2) { CPUIS(piledriver); break; }\n                        ^\nmake[6]: *** [fat.lo] Error 1\n```\n\n- Arando [MPIR build log](http://build.sagedev.org/release/builders/Zbin%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20binary/builds/8/steps/compile_2/logs/mpir)\n\n- report and discussion [on mpir-devel](https://groups.google.com/forum/#!topic/mpir-devel/3KCc0_wrEh0)\n\n\n**CC:**  @nexttime\n\n**Keywords:** sdl\n\n**Branch:** [3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)\n\n**Upstream:** Reported upstream. Developers acknowledge bug.\n\n**Reviewer:** Volker Braun\n\n**Author:** Leif Leonhardy, Thierry Monteil\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17806\n\n",
    "closed_at": "2015-03-04T23:16:22Z",
    "created_at": "2015-02-18T20:13:14Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "MPIR fails to build on 32-bit Linux with SAGE_FAT_BINARY=yes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17806",
    "user": "https://github.com/vbraun"
}
```
Both the arando buildbot binary build as well as the virtual machine build of Sage-6.5 failed with 

```
In file included from fat.c:123:0:
../cpuid.c: In function '__gmpn_cpu':
../cpuid.c:96:47: error: 'CPUSETUP_ivybridge' undeclared (first use in this function)
 #define CPUIS(x) do{TRACE(printf("  "#x"\n"));CPUSETUP_##x;}while(0)
                                               ^
../cpuid.c:174:24: note: in expansion of macro 'CPUIS'
      if (model == 58){ CPUIS(ivybridge);break;}
                        ^
../cpuid.c:96:47: note: each undeclared identifier is reported only once for each function it appears in
 #define CPUIS(x) do{TRACE(printf("  "#x"\n"));CPUSETUP_##x;}while(0)
                                               ^
../cpuid.c:174:24: note: in expansion of macro 'CPUIS'
      if (model == 58){ CPUIS(ivybridge);break;}
                        ^
../cpuid.c:96:47: error: 'CPUSETUP_haswell' undeclared (first use in this function)
 #define CPUIS(x) do{TRACE(printf("  "#x"\n"));CPUSETUP_##x;}while(0)
                                               ^
../cpuid.c:175:22: note: in expansion of macro 'CPUIS'
    if (model == 60){ CPUIS(haswell);break;}
                      ^
../cpuid.c:96:47: error: 'CPUSETUP_piledriver' undeclared (first use in this function)
 #define CPUIS(x) do{TRACE(printf("  "#x"\n"));CPUSETUP_##x;}while(0)
                                               ^
../cpuid.c:230:24: note: in expansion of macro 'CPUIS'
      if (model == 2) { CPUIS(piledriver); break; }
                        ^
make[6]: *** [fat.lo] Error 1
```

- Arando [MPIR build log](http://build.sagedev.org/release/builders/Zbin%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20binary/builds/8/steps/compile_2/logs/mpir)

- report and discussion [on mpir-devel](https://groups.google.com/forum/#!topic/mpir-devel/3KCc0_wrEh0)


**CC:**  @nexttime

**Keywords:** sdl

**Branch:** [3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)

**Upstream:** Reported upstream. Developers acknowledge bug.

**Reviewer:** Volker Braun

**Author:** Leif Leonhardy, Thierry Monteil

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/17806





---

archive/issue_comments_308914.json:
```json
{
    "body": "<a id='comment:2'></a>\nI confirm this bug appears on Debian stable 32 bits with `SAGE_FAT_BINARY=yes` (trying to build Sage Debian Live).",
    "created_at": "2015-02-20T00:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308914",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>
I confirm this bug appears on Debian stable 32 bits with `SAGE_FAT_BINARY=yes` (trying to build Sage Debian Live).



---

archive/issue_comments_308915.json:
```json
{
    "body": "<a id='comment:3'></a>\nI confirm the same VM (qemu) can compile MPIR without `SAGE_FAT_BINARY=yes`. Any clue about that issue ? If you need some logs or tests, please do  not hesitate to ask.",
    "created_at": "2015-02-20T09:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308915",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:3'></a>
I confirm the same VM (qemu) can compile MPIR without `SAGE_FAT_BINARY=yes`. Any clue about that issue ? If you need some logs or tests, please do  not hesitate to ask.



---

archive/issue_comments_308916.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,4 +30,7 @@\n make[6]: *** [fat.lo] Error 1\n ```\n \n-Arando MPIR build log http://build.sagedev.org/release/builders/Zbin%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20binary/builds/8/steps/compile_2/logs/mpir\n+- Arando [MPIR build log](http://build.sagedev.org/release/builders/Zbin%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20binary/builds/8/steps/compile_2/logs/mpir)\n+\n+- report and discussion [on mpir-devel](https://groups.google.com/forum/#!topic/mpir-devel/3KCc0_wrEh0)\n+\n``````\n",
    "created_at": "2015-02-20T15:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308916",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,4 +30,7 @@
 make[6]: *** [fat.lo] Error 1
 ```
 
-Arando MPIR build log http://build.sagedev.org/release/builders/Zbin%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20binary/builds/8/steps/compile_2/logs/mpir
+- Arando [MPIR build log](http://build.sagedev.org/release/builders/Zbin%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20binary/builds/8/steps/compile_2/logs/mpir)
+
+- report and discussion [on mpir-devel](https://groups.google.com/forum/#!topic/mpir-devel/3KCc0_wrEh0)
+
``````




---

archive/issue_comments_308917.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2015-02-20T17:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308917",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing upstream** from "N/A" to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_comments_308918.json:
```json
{
    "body": "<a id='comment:6'></a>\n\"Acknowledge\", well... ;-)\n\nNote that fat builds now do not even work on true 32-bit (x86) CPUs.  (That is, they don't and cannot *compile* either.)\n\nAlthough there's no specific 32-bit code for the added (64-bit) CPUs, it's not sufficient to just add \"dummy\" macro definitions for those to `mpn/x86/fat/fat.c`.  (Not sure yet, but probably `configure[.ac]` needs to get fixed / updated accordingly as well.)",
    "created_at": "2015-02-20T17:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308918",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
"Acknowledge", well... ;-)

Note that fat builds now do not even work on true 32-bit (x86) CPUs.  (That is, they don't and cannot *compile* either.)

Although there's no specific 32-bit code for the added (64-bit) CPUs, it's not sufficient to just add "dummy" macro definitions for those to `mpn/x86/fat/fat.c`.  (Not sure yet, but probably `configure[.ac]` needs to get fixed / updated accordingly as well.)



---

archive/issue_comments_308919.json:
```json
{
    "body": "<a id='comment:7'></a>\nOuch:  Looks like the `cpuvec_t` struct (containing function pointers) has been extended, but the *32-bit version* of `fat.c` doesn't yet reflect this, so (at best) wrong functions get called...",
    "created_at": "2015-02-20T18:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308919",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Ouch:  Looks like the `cpuvec_t` struct (containing function pointers) has been extended, but the *32-bit version* of `fat.c` doesn't yet reflect this, so (at best) wrong functions get called...



---

archive/issue_comments_308920.json:
```json
{
    "body": "<a id='comment:8'></a>\nOk, I *think<sup>TM</sup>* I do have an (initial, at least) fix now:\n\n```diff\n--- mpir-2.7.0-alpha12/mpn/x86/fat/fat.c.orig\t2014-09-14 21:59:13.000000000 +0200\n+++ mpir-2.7.0-alpha12/mpn/x86/fat/fat.c\t2015-02-20 20:16:13.909300216 +0100\n@@ -37,6 +37,8 @@\n long __gmpn_cpuid __GMP_PROTO ((char dst[12], int id));\n \n struct cpuvec_t __gmpn_cpuvec = {\n+  __MPN(add_err1_n_init),\n+  __MPN(add_err2_n_init),\n   __MPN(add_n_init),\n   __MPN(addmul_1_init),\n   __MPN(copyd_init),\n@@ -55,11 +57,14 @@\n   __MPN(modexact_1c_odd_init),\n   __MPN(mul_1_init),\n   __MPN(mul_basecase_init),\n+  __MPN(mulmid_basecase_init),\n   __MPN(preinv_divrem_1_init),\n   __MPN(preinv_mod_1_init),\n   __MPN(redc_1_init),\n   __MPN(rshift_init),\n   __MPN(sqr_basecase_init),\n+  __MPN(sub_err1_n_init),\n+  __MPN(sub_err2_n_init),\n   __MPN(sub_n_init),\n   __MPN(submul_1_init),\n   __MPN(sumdiff_n_init),\n@@ -102,6 +107,8 @@\n #define CPUSETUP_nehalem\tCPUVEC_SETUP_nehalem\n #define CPUSETUP_westmere\tCPUVEC_SETUP_nehalem\n #define CPUSETUP_sandybridge\tCPUVEC_SETUP_nehalem\n+#define CPUSETUP_ivybridge\tCPUVEC_SETUP_nehalem\n+#define CPUSETUP_haswell\tCPUVEC_SETUP_nehalem\n #define CPUSETUP_atom\t\tCPUVEC_SETUP_p6;CPUVEC_SETUP_p6_mmx;CPUVEC_SETUP_p6_p3mmx\n #define CPUSETUP_nano\t\tCPUVEC_SETUP_p6;CPUVEC_SETUP_p6_mmx;CPUVEC_SETUP_p6_p3mmx\n #define CPUSETUP_pentium4\tCPUVEC_SETUP_pentium4;CPUVEC_SETUP_pentium4_mmx;CPUVEC_SETUP_pentium4_sse2\n@@ -116,6 +123,7 @@\n #define CPUSETUP_k102\t\tCPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102\n #define CPUSETUP_k103\t\tCPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102\n #define CPUSETUP_bulldozer\tCPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102\n+#define CPUSETUP_piledriver\tCPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102\n #define CPUSETUP_bobcat\t\tCPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102\n #define CPUSETUP_viac3\t\tdo{}while(0)\n #define CPUSETUP_viac32\t\tdo{}while(0)\n```\n\nWorks for me (i.e., builds and passes `make check`) on x86 as well as x86_64 with `ABI=32`.\n\nFeel free to create an \"updated spkg\" / Sage patch from that (presumably by simply adding the patch to the spkg \"metadata\") -- I won't soon.",
    "created_at": "2015-02-20T19:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308920",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Ok, I *think<sup>TM</sup>* I do have an (initial, at least) fix now:

```diff
--- mpir-2.7.0-alpha12/mpn/x86/fat/fat.c.orig	2014-09-14 21:59:13.000000000 +0200
+++ mpir-2.7.0-alpha12/mpn/x86/fat/fat.c	2015-02-20 20:16:13.909300216 +0100
@@ -37,6 +37,8 @@
 long __gmpn_cpuid __GMP_PROTO ((char dst[12], int id));
 
 struct cpuvec_t __gmpn_cpuvec = {
+  __MPN(add_err1_n_init),
+  __MPN(add_err2_n_init),
   __MPN(add_n_init),
   __MPN(addmul_1_init),
   __MPN(copyd_init),
@@ -55,11 +57,14 @@
   __MPN(modexact_1c_odd_init),
   __MPN(mul_1_init),
   __MPN(mul_basecase_init),
+  __MPN(mulmid_basecase_init),
   __MPN(preinv_divrem_1_init),
   __MPN(preinv_mod_1_init),
   __MPN(redc_1_init),
   __MPN(rshift_init),
   __MPN(sqr_basecase_init),
+  __MPN(sub_err1_n_init),
+  __MPN(sub_err2_n_init),
   __MPN(sub_n_init),
   __MPN(submul_1_init),
   __MPN(sumdiff_n_init),
@@ -102,6 +107,8 @@
 #define CPUSETUP_nehalem	CPUVEC_SETUP_nehalem
 #define CPUSETUP_westmere	CPUVEC_SETUP_nehalem
 #define CPUSETUP_sandybridge	CPUVEC_SETUP_nehalem
+#define CPUSETUP_ivybridge	CPUVEC_SETUP_nehalem
+#define CPUSETUP_haswell	CPUVEC_SETUP_nehalem
 #define CPUSETUP_atom		CPUVEC_SETUP_p6;CPUVEC_SETUP_p6_mmx;CPUVEC_SETUP_p6_p3mmx
 #define CPUSETUP_nano		CPUVEC_SETUP_p6;CPUVEC_SETUP_p6_mmx;CPUVEC_SETUP_p6_p3mmx
 #define CPUSETUP_pentium4	CPUVEC_SETUP_pentium4;CPUVEC_SETUP_pentium4_mmx;CPUVEC_SETUP_pentium4_sse2
@@ -116,6 +123,7 @@
 #define CPUSETUP_k102		CPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102
 #define CPUSETUP_k103		CPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102
 #define CPUSETUP_bulldozer	CPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102
+#define CPUSETUP_piledriver	CPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102
 #define CPUSETUP_bobcat		CPUVEC_SETUP_k7;CPUVEC_SETUP_k7_mmx;CPUVEC_SETUP_k7_mmx_k8;CPUVEC_SETUP_k7_mmx_k8_k10;CPUVEC_SETUP_k7_mmx_k8_k10_k102
 #define CPUSETUP_viac3		do{}while(0)
 #define CPUSETUP_viac32		do{}while(0)
```

Works for me (i.e., builds and passes `make check`) on x86 as well as x86_64 with `ABI=32`.

Feel free to create an "updated spkg" / Sage patch from that (presumably by simply adding the patch to the spkg "metadata") -- I won't soon.



---

archive/issue_comments_308921.json:
```json
{
    "body": "**Branch:** [u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes)",
    "created_at": "2015-02-21T21:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308921",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Branch:** [u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes)



---

archive/issue_comments_308922.json:
```json
{
    "body": "**Commit:** [95b20298e6502ef0358f2e1e3d5ef58f3595c953](https://github.com/sagemath/sagetrac-mirror/commit/95b20298e6502ef0358f2e1e3d5ef58f3595c953)",
    "created_at": "2015-02-21T21:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308922",
    "user": "https://github.com/nexttime"
}
```

**Commit:** [95b20298e6502ef0358f2e1e3d5ef58f3595c953](https://github.com/sagemath/sagetrac-mirror/commit/95b20298e6502ef0358f2e1e3d5ef58f3595c953)



---

archive/issue_comments_308923.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooks like your branch lacks the last hunk.  (I've posted the patch to mpir-devel.)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95b20298e6502ef0358f2e1e3d5ef58f3595c953\">95b2029</a></td><td><code>#17806 : patch fat.c for x86 architecture.</code></td></tr></table>\n",
    "created_at": "2015-02-21T21:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308923",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Looks like your branch lacks the last hunk.  (I've posted the patch to mpir-devel.)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95b20298e6502ef0358f2e1e3d5ef58f3595c953">95b2029</a></td><td><code>#17806 : patch fat.c for x86 architecture.</code></td></tr></table>




---

archive/issue_comments_308924.json:
```json
{
    "body": "Patch against MPIR 2.7.0-alpha12 (submitted upstream)",
    "created_at": "2015-02-21T21:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308924",
    "user": "https://github.com/nexttime"
}
```

Patch against MPIR 2.7.0-alpha12 (submitted upstream)



---

archive/attachments_020636.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "mpir-2.7.0-alpha12-32-bit_fat_fix.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket17806/mpir-2.7.0-alpha12-32-bit_fat_fix.patch",
    "created_at": "2015-02-21T21:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_308925.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [leif](#comment%3A10):\n> (I've posted the patch to mpir-devel.)\n\n\nNow attached here as well.",
    "created_at": "2015-02-21T21:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308925",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Replying to [leif](#comment%3A10):
> (I've posted the patch to mpir-devel.)


Now attached here as well.



---

archive/issue_comments_308926.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36\">3cf8beb</a></td><td><code>#17806 : forgot one line.</code></td></tr></table>\n",
    "created_at": "2015-02-21T21:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36">3cf8beb</a></td><td><code>#17806 : forgot one line.</code></td></tr></table>




---

archive/issue_comments_308927.json:
```json
{
    "body": "**Changing commit** from \"[95b20298e6502ef0358f2e1e3d5ef58f3595c953](https://github.com/sagemath/sagetrac-mirror/commit/95b20298e6502ef0358f2e1e3d5ef58f3595c953)\" to \"[3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)\".",
    "created_at": "2015-02-21T21:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308927",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[95b20298e6502ef0358f2e1e3d5ef58f3595c953](https://github.com/sagemath/sagetrac-mirror/commit/95b20298e6502ef0358f2e1e3d5ef58f3595c953)" to "[3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)".



---

archive/issue_comments_308928.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-02-21T21:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308928",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_308929.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks for the fix !",
    "created_at": "2015-02-21T21:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308929",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:13'></a>
Thanks for the fix !



---

archive/issue_comments_308930.json:
```json
{
    "body": "**Author:** Leif Leonhardy, Thierry Monteil",
    "created_at": "2015-02-21T21:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308930",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Author:** Leif Leonhardy, Thierry Monteil



---

archive/issue_comments_308931.json:
```json
{
    "body": "<a id='comment:14'></a>\nFor what it worth, i confirm it allows me to build Sage on a 32 bits machine with `SAGE_FAT_BINARY=yes` (tested both with qemu and on a real 32 bits machine). What is the status of arando buildbot with this patch ? Could someone else try do do the same ?",
    "created_at": "2015-03-03T20:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308931",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:14'></a>
For what it worth, i confirm it allows me to build Sage on a 32 bits machine with `SAGE_FAT_BINARY=yes` (tested both with qemu and on a real 32 bits machine). What is the status of arando buildbot with this patch ? Could someone else try do do the same ?



---

archive/issue_comments_308932.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-03-03T20:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308932",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_308933.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2015-03-03T20:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308933",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_308934.json:
```json
{
    "body": "**Changing branch** from \"[u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes)\" to \"[3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)\".",
    "created_at": "2015-03-04T23:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308934",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/mpir_fails_to_build_on_32_bit_linux_with_sage_fat_binary_yes)" to "[3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)".



---

archive/issue_comments_308935.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-03-04T23:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308935",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_057814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-04T23:16:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17806#event-57814"
}
```



---

archive/issue_comments_308936.json:
```json
{
    "body": "**Changing commit** from \"[3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)\" to \"\".",
    "created_at": "2015-03-07T16:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308936",
    "user": "https://github.com/nexttime"
}
```

**Changing commit** from "[3cf8bebc470d4044c45dc3344ffd06c79d0fbd36](https://github.com/sagemath/sagetrac-mirror/commit/3cf8bebc470d4044c45dc3344ffd06c79d0fbd36)" to "".



---

archive/issue_comments_308937.json:
```json
{
    "body": "<a id='comment:17'></a>\nJust for the record:\n\nWith assertions enabled (MPIR configured with `--enable-assert`), I'm getting an *MPIR* test suite failure in 32-bit fat mode (`ABI=32` and `--enable-fat` on a 64-bit machine), which doesn't show up in non-fat 32-bit mode nor 64-bit fat mode:\n\n```\nFAIL: t-gcd (exit: 134)\n=======================\n\ndivexact.c:107: GNU MP assertion failed: (np[0]) != 0\n```\n\nHaven't tracked this down yet, but apparently there's more to do upstream, not necessarily really related to the issue here...",
    "created_at": "2015-03-07T16:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308937",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Just for the record:

With assertions enabled (MPIR configured with `--enable-assert`), I'm getting an *MPIR* test suite failure in 32-bit fat mode (`ABI=32` and `--enable-fat` on a 64-bit machine), which doesn't show up in non-fat 32-bit mode nor 64-bit fat mode:

```
FAIL: t-gcd (exit: 134)
=======================

divexact.c:107: GNU MP assertion failed: (np[0]) != 0
```

Haven't tracked this down yet, but apparently there's more to do upstream, not necessarily really related to the issue here...



---

archive/issue_comments_308938.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [leif](#comment%3A17):\n> With assertions enabled (MPIR configured with `--enable-assert`), I'm getting an *MPIR* test suite failure in 32-bit fat mode (`ABI=32` and `--enable-fat` on a 64-bit machine), which doesn't show up in non-fat 32-bit mode nor 64-bit fat mode:\n> \n> ```\n> FAIL: t-gcd (exit: 134)\n> =======================\n> \n> divexact.c:107: GNU MP assertion failed: (np[0]) != 0\n> ```\n\n\nThe same happens on a true 32-bit machine, and also **without** `--enable-fat`, so the failure seems rather unrelated to the issue (and the patch) here.",
    "created_at": "2015-03-19T14:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308938",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>
Replying to [leif](#comment%3A17):
> With assertions enabled (MPIR configured with `--enable-assert`), I'm getting an *MPIR* test suite failure in 32-bit fat mode (`ABI=32` and `--enable-fat` on a 64-bit machine), which doesn't show up in non-fat 32-bit mode nor 64-bit fat mode:
> 
> ```
> FAIL: t-gcd (exit: 134)
> =======================
> 
> divexact.c:107: GNU MP assertion failed: (np[0]) != 0
> ```


The same happens on a true 32-bit machine, and also **without** `--enable-fat`, so the failure seems rather unrelated to the issue (and the patch) here.



---

archive/issue_comments_308939.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sdl\".",
    "created_at": "2019-08-27T19:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17806#issuecomment-308939",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing keywords** from "" to "sdl".
