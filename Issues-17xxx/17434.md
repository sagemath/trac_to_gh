# Issue 17434: Preparser for symbolic functions ignores syntax errors

archive/issues_017197.json:
```json
{
    "body": "This should be a syntax error:\n\n```\nsage: f(x) = 1 ) + ( cos(x)\n```\n\nBut the preparser turns this into\n\n```\nsage: print preparse('''f(x) = 1 ) + ( cos(x)''')\n__tmp__=var(\"x\"); f = symbolic_expression(Integer(1) ) + ( cos(x)).function(x)\n```\n\n**CC:**  jakobkroeker\n\n**Status:** new\n\nIssue created by migration from https://trac.sagemath.org/ticket/17434\n\n",
    "created_at": "2014-12-02T23:02:14Z",
    "labels": [
        "component: misc",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Preparser for symbolic functions ignores syntax errors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17434",
    "user": "https://github.com/jdemeyer"
}
```
This should be a syntax error:

```
sage: f(x) = 1 ) + ( cos(x)
```

But the preparser turns this into

```
sage: print preparse('''f(x) = 1 ) + ( cos(x)''')
__tmp__=var("x"); f = symbolic_expression(Integer(1) ) + ( cos(x)).function(x)
```

**CC:**  jakobkroeker

**Status:** new

Issue created by migration from https://trac.sagemath.org/ticket/17434





---

archive/issue_comments_300076.json:
```json
{
    "body": "<a id='comment:1'></a>\nUltimately, this shows why you shouldn't implement input transformations with regular expressions. Sure it works, but you can only get so far. The preparser knows nothing about grammar, so how can it find out about misbalanced parens. We could try to kludge that on top (check that the paren level never goes negative going from left to right) but that would just be a bandaid, too. \n\nThe right fix (TM) is to either implement a full-blown Python+Sage parser  (lex/bison/ply/antlr/...) or hook into the built-in Python parser.",
    "created_at": "2014-12-03T08:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-300076",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>
Ultimately, this shows why you shouldn't implement input transformations with regular expressions. Sure it works, but you can only get so far. The preparser knows nothing about grammar, so how can it find out about misbalanced parens. We could try to kludge that on top (check that the paren level never goes negative going from left to right) but that would just be a bandaid, too. 

The right fix (TM) is to either implement a full-blown Python+Sage parser  (lex/bison/ply/antlr/...) or hook into the built-in Python parser.



---

archive/issue_comments_300077.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think a good start would be to use [https://docs.python.org/2/library/tokenize.html](https://docs.python.org/2/library/tokenize.html)",
    "created_at": "2014-12-03T12:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-300077",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
I think a good start would be to use [https://docs.python.org/2/library/tokenize.html](https://docs.python.org/2/library/tokenize.html)



---

archive/issue_comments_300078.json:
```json
{
    "body": "<a id='comment:3'></a>\nIssue is still open. Not sure if this one should get a stopgap",
    "created_at": "2017-03-04T02:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-300078",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:3'></a>
Issue is still open. Not sure if this one should get a stopgap
