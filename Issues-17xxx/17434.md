# Issue 17434: gcd and xgcd over fields, PID and UFD

archive/issues_017434.json:
```json
{
    "body": "As reported on [sage-support](https://groups.google.com/forum/#!topic/sage-support/AYDqdxy5fTw), gcd and xgcd disagree on fraction fields\n\n```\nsage: gcd(6/1,2/1)\n2\nsage: xgcd(6/1,2/1)\n(1, 1/6, 0)\n```\n\nIn this ticket we:\n1. Ensure that `gcd` and `xgcd` are compatible over quotient fields by implementing the `xgcd` in the appropriate place. In particular, with that branch we have\n   {{{\n   sage: xgcd(6/1,2/1)\n   (2, 0, 1)\n   sage: xgcd(5/2, 3/4)\n   (1/4, -1/2, 2)\n   }}}\n2. We fix the `xgcd` for trivial cases in `rings.polynomial.polynomial_element_generic.Polynomial_generic_field` in order that `gcd` and `xgcd` agree for them.\n3. We introduce a generic test `_test_gcd_vs_xgcd` in the category `PrincipalIdealDomains` to ensure the compatibility of `gcd` and `xgcd`.\n4. Modify the previous behavior for real numbers\n   {{{\n   sage: gcd(2.0, 4.0)\n   2\n   sage: gcd(2.0, 4.0).parent()\n   Integer Ring\n   }}}\n   The only difference is that now, Sage returns floating point with the same parent\n   {{{\n   sage: gcd(2.0, 4.0)\n   2.00000000000000\n   sage: gcd(2.0, 4.0).parent()\n   Real Field with 53 bits of precision\n   }}}\n   And the same kind of behavior will also hold for lcm and xgcd.\n\nNote:\n\nThere is a method `xgcd` implemented for univariate polynomial over ZZ. ~~This is not a proper name since it has nothing to do with `gcd`~~ This might not be the best name since the first term is not the gcd in general (see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/JV8fCPUqTzo) and #17674)\n\nIssue created by migration from https://trac.sagemath.org/ticket/17671\n\n",
    "closed_at": "2015-01-29T22:41:52Z",
    "created_at": "2015-01-25T19:31:54Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "gcd and xgcd over fields, PID and UFD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17434",
    "user": "https://github.com/videlec"
}
```
As reported on [sage-support](https://groups.google.com/forum/#!topic/sage-support/AYDqdxy5fTw), gcd and xgcd disagree on fraction fields

```
sage: gcd(6/1,2/1)
2
sage: xgcd(6/1,2/1)
(1, 1/6, 0)
```

In this ticket we:
1. Ensure that `gcd` and `xgcd` are compatible over quotient fields by implementing the `xgcd` in the appropriate place. In particular, with that branch we have
   {{{
   sage: xgcd(6/1,2/1)
   (2, 0, 1)
   sage: xgcd(5/2, 3/4)
   (1/4, -1/2, 2)
   }}}
2. We fix the `xgcd` for trivial cases in `rings.polynomial.polynomial_element_generic.Polynomial_generic_field` in order that `gcd` and `xgcd` agree for them.
3. We introduce a generic test `_test_gcd_vs_xgcd` in the category `PrincipalIdealDomains` to ensure the compatibility of `gcd` and `xgcd`.
4. Modify the previous behavior for real numbers
   {{{
   sage: gcd(2.0, 4.0)
   2
   sage: gcd(2.0, 4.0).parent()
   Integer Ring
   }}}
   The only difference is that now, Sage returns floating point with the same parent
   {{{
   sage: gcd(2.0, 4.0)
   2.00000000000000
   sage: gcd(2.0, 4.0).parent()
   Real Field with 53 bits of precision
   }}}
   And the same kind of behavior will also hold for lcm and xgcd.

Note:

There is a method `xgcd` implemented for univariate polynomial over ZZ. ~~This is not a proper name since it has nothing to do with `gcd`~~ This might not be the best name since the first term is not the gcd in general (see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/JV8fCPUqTzo) and #17674)

Issue created by migration from https://trac.sagemath.org/ticket/17671





---

archive/issue_comments_232579.json:
```json
{
    "body": "I am annoyed with the current implementation... it is written in the generic `gcd` of `categories.fields` that\n\n```\nFor fields of characteristic zero (i.e., containing the\nintegers as a sub-ring), evaluation in the integer ring is\nattempted. This is for backwards compatibility.::\n    sage: gcd(6.0,8); gcd(6.0,8).parent()\n    2\n    Integer Ring\n```\nThis is completely crazy! And moreover different from what is in gcd!!",
    "created_at": "2015-01-25T20:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232579",
    "user": "https://github.com/videlec"
}
```

I am annoyed with the current implementation... it is written in the generic `gcd` of `categories.fields` that

```
For fields of characteristic zero (i.e., containing the
integers as a sub-ring), evaluation in the integer ring is
attempted. This is for backwards compatibility.::
    sage: gcd(6.0,8); gcd(6.0,8).parent()
    2
    Integer Ring
```
This is completely crazy! And moreover different from what is in gcd!!



---

archive/issue_comments_232580.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-25T23:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232580",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232581.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-25T23:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232581",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_232582.json:
```json
{
    "body": "In `src/sage/categories/quotient_fields.py`, lines 262-270:\n\n```python\n            except (AttributeError, NotImplementedError, TypeError, ValueError):\n                zero = self.parent.zero()\n                one  = self.parent.one()\n                if self == zero:\n                    return (other, zero, one)\n                elif other == zero:\n                    return (self, one, zero)\n                else:\n                    return (zero, zero, zero)\n```\n\nI would have returned `one` as soon as one of `self` and `other` is nonzero, and `zero` only when none is nonzero. The current code is not consistent (if I am not mistaken) with the implementation of `gcd` (lines 125-128).",
    "created_at": "2015-01-26T13:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232582",
    "user": "https://github.com/bgrenet"
}
```

In `src/sage/categories/quotient_fields.py`, lines 262-270:

```python
            except (AttributeError, NotImplementedError, TypeError, ValueError):
                zero = self.parent.zero()
                one  = self.parent.one()
                if self == zero:
                    return (other, zero, one)
                elif other == zero:
                    return (self, one, zero)
                else:
                    return (zero, zero, zero)
```

I would have returned `one` as soon as one of `self` and `other` is nonzero, and `zero` only when none is nonzero. The current code is not consistent (if I am not mistaken) with the implementation of `gcd` (lines 125-128).



---

archive/issue_comments_232583.json:
```json
{
    "body": "Replying to [comment:6 bruno]:\n> In `src/sage/categories/quotient_fields.py`, lines 262-270:\n> ...\n> I would have returned `one` as soon as one of `self` and `other` is nonzero, and `zero` only when none is nonzero.\n\n\nYou are totally right! Thanks!\n\nVincent",
    "created_at": "2015-01-26T13:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232583",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:6 bruno]:
> In `src/sage/categories/quotient_fields.py`, lines 262-270:
> ...
> I would have returned `one` as soon as one of `self` and `other` is nonzero, and `zero` only when none is nonzero.


You are totally right! Thanks!

Vincent



---

archive/issue_comments_232584.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-26T15:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232585.json:
```json
{
    "body": "* In `src/sage/rings/arith.py`, lines 1901-1910, the introducing sentence should to my mind be: `Here is an example of a xgcd for two polynomials over the integers, where the linear combination is not the gcd but the gcd multiplied by the resultant::`. \n\n```python\n\n    Here is an example of a xgcd for two polynomials over the integers, where the linear\n    combination is not the gcd but the resultant::\n\n        sage: R.<x> = ZZ[]\n        sage: gcd(2*x*(x-1), x^2)\n        x\n        sage: xgcd(2*x*(x-1), x^2)\n        (2*x, -1, 2)\n        sage: (2*(x-1)).resultant(x)\n        2\n```\n\n\n* I do not understand exactly what you want to do with your function `_test_gcd_vs_xgcd()`: As discussed, it is not clear that the results should always be the same. \n\n* To answer your questions: \n  1. As I've said on sage-devel, I am clearly in favor of `gcd(RR(6), RR(3)).parent()` to return `Real Field with 53 bits of precision` rather than `Integer Ring`. \n  2. I would keep the name `xgcd` though, with a clear documentation.\n \n---\nNew commits:",
    "created_at": "2015-01-26T15:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232585",
    "user": "https://github.com/bgrenet"
}
```

* In `src/sage/rings/arith.py`, lines 1901-1910, the introducing sentence should to my mind be: `Here is an example of a xgcd for two polynomials over the integers, where the linear combination is not the gcd but the gcd multiplied by the resultant::`. 

```python

    Here is an example of a xgcd for two polynomials over the integers, where the linear
    combination is not the gcd but the resultant::

        sage: R.<x> = ZZ[]
        sage: gcd(2*x*(x-1), x^2)
        x
        sage: xgcd(2*x*(x-1), x^2)
        (2*x, -1, 2)
        sage: (2*(x-1)).resultant(x)
        2
```


* I do not understand exactly what you want to do with your function `_test_gcd_vs_xgcd()`: As discussed, it is not clear that the results should always be the same. 

* To answer your questions: 
  1. As I've said on sage-devel, I am clearly in favor of `gcd(RR(6), RR(3)).parent()` to return `Real Field with 53 bits of precision` rather than `Integer Ring`. 
  2. I would keep the name `xgcd` though, with a clear documentation.
 
---
New commits:



---

archive/issue_comments_232586.json:
```json
{
    "body": "Replying to [comment:9 bruno]:\n> * In `src/sage/rings/arith.py`, lines 1901-1910, the introducing sentence should to my mind be:\n\n\nright\n\n> * I do not understand exactly what you want to do with your function `_test_gcd_vs_xgcd()`: As discussed, it is not clear that the results should always be the same. \n\n\nThe test is **only** for principal ideal domains. Up to now I encountered two cases where the convention are a bit special:\n- quotient fields: the gcd/xgcd is compatible with the ring (managed by the category)\n- polynomial over fields: the gcd/xgcd always return monic polynomials (managed by the methods in `rings.polynomial.polynomial_element_generic`)\nIf there is an example of a PID where gcd and xgcd **must** be different I would be happy to remove my test.\n\nVincent",
    "created_at": "2015-01-26T15:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232586",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:9 bruno]:
> * In `src/sage/rings/arith.py`, lines 1901-1910, the introducing sentence should to my mind be:


right

> * I do not understand exactly what you want to do with your function `_test_gcd_vs_xgcd()`: As discussed, it is not clear that the results should always be the same. 


The test is **only** for principal ideal domains. Up to now I encountered two cases where the convention are a bit special:
- quotient fields: the gcd/xgcd is compatible with the ring (managed by the category)
- polynomial over fields: the gcd/xgcd always return monic polynomials (managed by the methods in `rings.polynomial.polynomial_element_generic`)
If there is an example of a PID where gcd and xgcd **must** be different I would be happy to remove my test.

Vincent



---

archive/issue_comments_232587.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-26T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232588.json:
```json
{
    "body": "Replying to [comment:10 vdelecroix]:\n> > * I do not understand exactly what you want to do with your function `_test_gcd_vs_xgcd()`: As discussed, it is not clear that the results should always be the same. \n \n> \n> The test is **only** for principal ideal domains. \n\n\nOh, right! Then I agree with your test.\n\nEverything you've committed so far looks good to me (and passes the tests). There are two things left:\n1. The parent of `gcd(3.0,6.0)`: This ticket seems the right one to change this.\n2. The name of `xgcd` for polynomials over UFD: There does not seem to be a consensus yet, so I would be in favor of letting this question to a later ticket so that this ticket can get a positive review soon.",
    "created_at": "2015-01-26T15:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232588",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:10 vdelecroix]:
> > * I do not understand exactly what you want to do with your function `_test_gcd_vs_xgcd()`: As discussed, it is not clear that the results should always be the same. 
 
> 
> The test is **only** for principal ideal domains. 


Oh, right! Then I agree with your test.

Everything you've committed so far looks good to me (and passes the tests). There are two things left:
1. The parent of `gcd(3.0,6.0)`: This ticket seems the right one to change this.
2. The name of `xgcd` for polynomials over UFD: There does not seem to be a consensus yet, so I would be in favor of letting this question to a later ticket so that this ticket can get a positive review soon.



---

archive/issue_comments_232589.json:
```json
{
    "body": "Nope. There seems to be a regression with respect to timings (at least I do not understand what is happening). If I run the doctest on the file `coercion_and_categories.rst` in `$SAGE_ROOT/src/doc/en/thematic_tutorials/` then I end up with an incredibly long `TestSuite(P).run()`. If I instead replace it with `TestSuite(P).run(skip='_test_gcd_vs_xgcd')` everything looks fine.\n\nMoreover, in `sage.rings.function_field.function_field.py`, line 62, the test\n\n```\nTestSuite(M).run(skip = '_test_gcd_vs_xgcd')  # long time (52s on sage.math, 2012)\n```\nis much longer for me. And if I remove the `skip` then it is even longer!\n\nThis is a critical issue.",
    "created_at": "2015-01-26T15:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232589",
    "user": "https://github.com/videlec"
}
```

Nope. There seems to be a regression with respect to timings (at least I do not understand what is happening). If I run the doctest on the file `coercion_and_categories.rst` in `$SAGE_ROOT/src/doc/en/thematic_tutorials/` then I end up with an incredibly long `TestSuite(P).run()`. If I instead replace it with `TestSuite(P).run(skip='_test_gcd_vs_xgcd')` everything looks fine.

Moreover, in `sage.rings.function_field.function_field.py`, line 62, the test

```
TestSuite(M).run(skip = '_test_gcd_vs_xgcd')  # long time (52s on sage.math, 2012)
```
is much longer for me. And if I remove the `skip` then it is even longer!

This is a critical issue.



---

archive/issue_comments_232590.json:
```json
{
    "body": "I finally find out the problem in the tests:\n\n- in `function_field.py` the timings are similar to what is here in sage-6.5.beta6. This is bad but at least not because of me\n- in `coercions_and_categories.rst` the problem comes from xgcd over `ZZ['x']` (see #17675)\n\nI will add a small commit to fix some doctests.",
    "created_at": "2015-01-27T01:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232590",
    "user": "https://github.com/videlec"
}
```

I finally find out the problem in the tests:

- in `function_field.py` the timings are similar to what is here in sage-6.5.beta6. This is bad but at least not because of me
- in `coercions_and_categories.rst` the problem comes from xgcd over `ZZ['x']` (see #17675)

I will add a small commit to fix some doctests.



---

archive/issue_comments_232591.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-27T01:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232591",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232592.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-28T12:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232593.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-28T12:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_232594.json:
```json
{
    "body": "Salut Bruno,\n\nSorry I had a typo in the two last commit messages so I had to do a forced push.\n\nNow everything looks all right. Note that before setting this one to positive review, we need to wait for the trivial #17673 to be in positive review (!hint!). Thanks to Ralf #17675 is already in positive review.\n\nIn the last commits:\n- I changed the behavior for real numbers as you and I wanted (nobody answered on the [sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/37TjI2fZfLM)).\n- I made one change to `_test_gcd_vs_xgcd` in order to check whether the parent of gcd is really what we expect and not an element of another ring.\n\nVincent",
    "created_at": "2015-01-28T12:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232594",
    "user": "https://github.com/videlec"
}
```

Salut Bruno,

Sorry I had a typo in the two last commit messages so I had to do a forced push.

Now everything looks all right. Note that before setting this one to positive review, we need to wait for the trivial #17673 to be in positive review (!hint!). Thanks to Ralf #17675 is already in positive review.

In the last commits:
- I changed the behavior for real numbers as you and I wanted (nobody answered on the [sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/37TjI2fZfLM)).
- I made one change to `_test_gcd_vs_xgcd` in order to check whether the parent of gcd is really what we expect and not an element of another ring.

Vincent



---

archive/issue_comments_232595.json:
```json
{
    "body": "Salut Vincent,\n\nI looked at #17673, but I am unable to review it since it goes beyond my knowledge in Sage... Or at least it will take some time for me to understand it and then review.\n\nConcerning the real number, I would have thought of an implementation acting as follows:\n\n```python\nsage: gcd(2.0,6.0)\n2.00000000000000\n```\nI do not know if this makes sense.",
    "created_at": "2015-01-28T13:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232595",
    "user": "https://github.com/bgrenet"
}
```

Salut Vincent,

I looked at #17673, but I am unable to review it since it goes beyond my knowledge in Sage... Or at least it will take some time for me to understand it and then review.

Concerning the real number, I would have thought of an implementation acting as follows:

```python
sage: gcd(2.0,6.0)
2.00000000000000
```
I do not know if this makes sense.



---

archive/issue_comments_232596.json:
```json
{
    "body": "Replying to [comment:21 bruno]:\n> Salut Vincent,\n> \n> I looked at #17673, but I am unable to review it since it goes beyond my knowledge in Sage... Or at least it will take some time for me to understand it and then review.\n> \n> Concerning the real number, I would have thought of an implementation acting as follows:\n> \n> ```python\n> sage: gcd(2.0,6.0)\n> 2.00000000000000\n> ```\n\nWhy? Would you like it to be nice only over ZZ and not over QQ? And this is where it becomes impossible. Within Sage any floating point can be converted to QQ...\n\n```\nsage: QQ(1.1231938951)\n155072989/138064309\n```\nSo the only way I would agree with your proposition is to have also\n\n```\nsage: gcd(RR(5/2), RR(3/2)) == RR(gcd(5/2, 3/2))\n```\nwhich is currently False as well.\n\nAnyway mixing algebraic functions (like gcd) with floating point number is often a bad idea. So at least the proposed implementation tells you that something is wrong.\n\nVincent",
    "created_at": "2015-01-28T14:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232596",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:21 bruno]:
> Salut Vincent,
> 
> I looked at #17673, but I am unable to review it since it goes beyond my knowledge in Sage... Or at least it will take some time for me to understand it and then review.
> 
> Concerning the real number, I would have thought of an implementation acting as follows:
> 
> ```python
> sage: gcd(2.0,6.0)
> 2.00000000000000
> ```

Why? Would you like it to be nice only over ZZ and not over QQ? And this is where it becomes impossible. Within Sage any floating point can be converted to QQ...

```
sage: QQ(1.1231938951)
155072989/138064309
```
So the only way I would agree with your proposition is to have also

```
sage: gcd(RR(5/2), RR(3/2)) == RR(gcd(5/2, 3/2))
```
which is currently False as well.

Anyway mixing algebraic functions (like gcd) with floating point number is often a bad idea. So at least the proposed implementation tells you that something is wrong.

Vincent



---

archive/issue_comments_232597.json:
```json
{
    "body": "Replying to [comment:22 vdelecroix]:\n> Why? Would you like it to be nice only over ZZ and not over QQ? And this is where it becomes impossible.\n\n\nFirst of all, your current solution is mathematically perfectly correct and I am quite fine with it. This said, let me expose the reasons of my suggestion. \n\nWith my suggestion, \"integral floating point numbers\" are treated differently than other floating point numbers. Reasons:\n1. The `gcd` function coincide with the mathematical GCD function for integers only;\n2. Every floating point number can be seen as a rational, while not every floating point number can be seen as an integer.\n\nAlso, `RR` and `QQ` are treated differently. Reasons: \n1. For inputs in `QQ`, we know that they are rational numbers, so we deviate from the mathematical definition to give a more meaningful answer and the definition we use \"lives\" in `QQ`;\n2. For inputs in `RR` that are \"integral\", we make an assumption (the floating point numbers we have at hand represent integers) and then use the standard mathematical definition; \n3. For inputs in `RR` that are not \"integral\", not returning `1.0000000` requires to make an assumption AND to deviate from the mathematical definition: that is, we would need to \"move\" from `RR` to `QQ` and then to use a non-standard definition.\n\nFinally, if a user asks for the GCD of two \"integral floating point numbers\", I have no difficulty to understand what s/he means (since the GCD of the integers they represent is a well-defined mathematical function). It is much more difficult to me to interpret the will of a user that asks for the GCD of two \"rational floating point numbers\", and this (also) justifies to treat differently the two situations.\n\n\n> Anyway mixing algebraic functions (like gcd) with floating point number is often a bad idea. So at least the proposed implementation tells you that something is wrong.\n\n\nI agree with that.",
    "created_at": "2015-01-28T15:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232597",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:22 vdelecroix]:
> Why? Would you like it to be nice only over ZZ and not over QQ? And this is where it becomes impossible.


First of all, your current solution is mathematically perfectly correct and I am quite fine with it. This said, let me expose the reasons of my suggestion. 

With my suggestion, "integral floating point numbers" are treated differently than other floating point numbers. Reasons:
1. The `gcd` function coincide with the mathematical GCD function for integers only;
2. Every floating point number can be seen as a rational, while not every floating point number can be seen as an integer.

Also, `RR` and `QQ` are treated differently. Reasons: 
1. For inputs in `QQ`, we know that they are rational numbers, so we deviate from the mathematical definition to give a more meaningful answer and the definition we use "lives" in `QQ`;
2. For inputs in `RR` that are "integral", we make an assumption (the floating point numbers we have at hand represent integers) and then use the standard mathematical definition; 
3. For inputs in `RR` that are not "integral", not returning `1.0000000` requires to make an assumption AND to deviate from the mathematical definition: that is, we would need to "move" from `RR` to `QQ` and then to use a non-standard definition.

Finally, if a user asks for the GCD of two "integral floating point numbers", I have no difficulty to understand what s/he means (since the GCD of the integers they represent is a well-defined mathematical function). It is much more difficult to me to interpret the will of a user that asks for the GCD of two "rational floating point numbers", and this (also) justifies to treat differently the two situations.


> Anyway mixing algebraic functions (like gcd) with floating point number is often a bad idea. So at least the proposed implementation tells you that something is wrong.


I agree with that.



---

archive/issue_comments_232598.json:
```json
{
    "body": "All right. Let us do it your way.\n\n(actually mine would be to not define floating point as a field ;-)",
    "created_at": "2015-01-28T16:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232598",
    "user": "https://github.com/videlec"
}
```

All right. Let us do it your way.

(actually mine would be to not define floating point as a field ;-)



---

archive/issue_comments_232599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2015-01-28T16:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_232600.json:
```json
{
    "body": "I removed #17673 from the dependencies... I had to do a forced push to remove the commit coming from that branch.\n\nVincent",
    "created_at": "2015-01-28T16:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232600",
    "user": "https://github.com/videlec"
}
```

I removed #17673 from the dependencies... I had to do a forced push to remove the commit coming from that branch.

Vincent



---

archive/issue_comments_232601.json:
```json
{
    "body": "It seems that I get the same problem you had in #17673, thus the tests in `src/sage/rings/polynomial/polynomial_quotient_ring.py` don't pass. From line 281, there is a test that looks like the following (I removed irrelevant parts):\n\n```python\nsage: P.<x> = QQ[]\nsage: Q = P.quotient(x^2+2)\nsage: Q in Fields()\nTrue\nsage: Q.an_element().gcd._module_\n'sage.categories.fields'\n```\nbut the test doesn't pass, and I get `AttributeError: 'sage.structure.element.NamedBinopMethod' object has no attribute '__module__'` instead of `'sage.categories.fields'`.",
    "created_at": "2015-01-28T17:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232601",
    "user": "https://github.com/bgrenet"
}
```

It seems that I get the same problem you had in #17673, thus the tests in `src/sage/rings/polynomial/polynomial_quotient_ring.py` don't pass. From line 281, there is a test that looks like the following (I removed irrelevant parts):

```python
sage: P.<x> = QQ[]
sage: Q = P.quotient(x^2+2)
sage: Q in Fields()
True
sage: Q.an_element().gcd._module_
'sage.categories.fields'
```
but the test doesn't pass, and I get `AttributeError: 'sage.structure.element.NamedBinopMethod' object has no attribute '__module__'` instead of `'sage.categories.fields'`.



---

archive/issue_comments_232602.json:
```json
{
    "body": "Yep. I forgot to change that. And the modification of gcd/lcm for floating point also causes some trouble for the symbolic ring. A commit is comming.\n\nVincent",
    "created_at": "2015-01-28T17:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232602",
    "user": "https://github.com/videlec"
}
```

Yep. I forgot to change that. And the modification of gcd/lcm for floating point also causes some trouble for the symbolic ring. A commit is comming.

Vincent



---

archive/issue_comments_232603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-28T17:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232604.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-29T12:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232604",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232605.json:
```json
{
    "body": "All tests pass! LGTM.",
    "created_at": "2015-01-29T12:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232605",
    "user": "https://github.com/bgrenet"
}
```

All tests pass! LGTM.



---

archive/issue_comments_232606.json:
```json
{
    "body": "Cool! Thanks for the review.",
    "created_at": "2015-01-29T14:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232606",
    "user": "https://github.com/videlec"
}
```

Cool! Thanks for the review.



---

archive/issue_events_050600.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-29T22:41:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17434#event-50600"
}
```



---

archive/issue_comments_232607.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-29T22:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17434#issuecomment-232607",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
