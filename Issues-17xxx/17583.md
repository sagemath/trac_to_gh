# Issue 17583: Clean up free module elements

archive/issues_017346.json:
```json
{
    "assignees": [],
    "body": "General clean-up using modern Cython code in preparation for follow-up tickets.\n\nNo changes in functionality (except perhaps details).\n\nDepends on #17561\nDepends on #10779\n\nBranch/Commit: **[`dcbf770`](https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6)**\n\nReviewer: **Marc Mezzarobba**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17583_\n\n",
    "closed_at": "2015-01-29T13:26:19Z",
    "created_at": "2015-01-05T13:26:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Clean up free module elements",
    "type": "issue",
    "updated_at": "2015-01-29T13:26:19Z",
    "url": "https://github.com/sagemath/sage/issues/17583",
    "user": "https://github.com/jdemeyer"
}
```
General clean-up using modern Cython code in preparation for follow-up tickets.

No changes in functionality (except perhaps details).

Depends on #17561
Depends on #10779

Branch/Commit: **[`dcbf770`](https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6)**

Reviewer: **Marc Mezzarobba**

Author: **Jeroen Demeyer**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/17583_





---

archive/issue_events_248269.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-05T13:26:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248269"
}
```



---

archive/issue_events_248270.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-05T13:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248270"
}
```



---

archive/issue_events_248271.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-05T13:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248271"
}
```



---

archive/issue_events_248272.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-05T13:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248272"
}
```



---

archive/issue_comments_236086.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n General clean-up using modern Cython code in preparation for follow-up tickets.\n+\n+No changes in functionality (except perhaps details).\n``````\n",
    "created_at": "2015-01-05T14:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236086",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 General clean-up using modern Cython code in preparation for follow-up tickets.
+
+No changes in functionality (except perhaps details).
``````




---

archive/issue_comments_236087.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17583](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17583)**",
    "created_at": "2015-01-05T14:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236087",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17583](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17583)**



---

archive/issue_comments_236088.json:
```json
{
    "body": "Commit: **[`66d2f76`](https://github.com/sagemath/sagetrac-mirror/commit/66d2f76d685f654f18b77f0051ae85235a4f846f)**",
    "created_at": "2015-01-21T12:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236088",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`66d2f76`](https://github.com/sagemath/sagetrac-mirror/commit/66d2f76d685f654f18b77f0051ae85235a4f846f)**



---

archive/issue_comments_236089.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d011f49a7a1e1020cd1dbb1dfdcae95a394a6aa\"><code>5d011f4</code></a></td><td><code>Merge commit '106f5d41398794b13a6a683236cf219d49602312' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66d2f76d685f654f18b77f0051ae85235a4f846f\"><code>66d2f76</code></a></td><td><code>Clean up free module elements</code></td></tr></table>\n",
    "created_at": "2015-01-21T12:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236089",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d011f49a7a1e1020cd1dbb1dfdcae95a394a6aa"><code>5d011f4</code></a></td><td><code>Merge commit '106f5d41398794b13a6a683236cf219d49602312' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66d2f76d685f654f18b77f0051ae85235a4f846f"><code>66d2f76</code></a></td><td><code>Clean up free module elements</code></td></tr></table>




---

archive/issue_events_248273.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-21T12:30:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248273"
}
```



---

archive/issue_comments_236090.json:
```json
{
    "body": "Changed dependencies from **#10513, #17561** to **#17561**",
    "created_at": "2015-01-21T12:30:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236090",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#10513, #17561** to **#17561**



---

archive/issue_events_248274.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-01-23T10:00:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248274"
}
```



---

archive/issue_events_248275.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-01-23T10:00:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248275"
}
```



---

archive/issue_comments_236091.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2015-01-23T10:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236091",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_comments_236092.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n`_sparse_dot_product()` (which you didn't touch) appears not to be used anywhere and could probably be deleted.\n\nBy the way, is there a reason to special-case the vectors of length zero in `FreeModuleElement.dot_product()`?\n\nOtherwise lgtm.",
    "created_at": "2015-01-23T10:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236092",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:5" align="right">comment:5</div>

`_sparse_dot_product()` (which you didn't touch) appears not to be used anywhere and could probably be deleted.

By the way, is there a reason to special-case the vectors of length zero in `FreeModuleElement.dot_product()`?

Otherwise lgtm.



---

archive/issue_comments_236093.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mezzarobba](#comment%3A5):\n> By the way, is there a reason to special-case the vectors of length zero in `FreeModuleElement.dot_product()`?\n\nYes, to apply the following optimization: instead of starting with zero and `a[i]*b[i]`, we start with `a[0] * b[0]` and add `a[i]*b[i]` for `i >= 1`.\n\nI'm actually preparing a commit which refactors dot products, since the logic was a bit strange. With the new commit (still testing), there will be a `cpdef` method `_dot_product_` for equal parents and `_dot_product_coerce_` for parents which might be different.",
    "created_at": "2015-01-23T20:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236093",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mezzarobba](#comment%3A5):
> By the way, is there a reason to special-case the vectors of length zero in `FreeModuleElement.dot_product()`?

Yes, to apply the following optimization: instead of starting with zero and `a[i]*b[i]`, we start with `a[0] * b[0]` and add `a[i]*b[i]` for `i >= 1`.

I'm actually preparing a commit which refactors dot products, since the logic was a bit strange. With the new commit (still testing), there will be a `cpdef` method `_dot_product_` for equal parents and `_dot_product_coerce_` for parents which might be different.



---

archive/issue_comments_236094.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c99ae29715eae43d226da51eb282c3dff0d5e22\"><code>4c99ae2</code></a></td><td><code>Improve dot products</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c84246e912c9380936c9e122934ed94ab160453f\"><code>c84246e</code></a></td><td><code>#10779: Improve coverage test for structure/element.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db023d458e9e534000f9bc6a99575c5580e07b3e\"><code>db023d4</code></a></td><td><code>Merge branch 'u/chapoton/10779' of ssh://trac.sagemath.org:22/sage into 10779</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e30025298097a2c280629135f3f76d973c0b4a5\"><code>2e30025</code></a></td><td><code>trac #10779 corrected 3 doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d72c8114eab88575b09479df240d82f1b75582e\"><code>9d72c81</code></a></td><td><code>Merge branch 'u/chapoton/10779' of ssh://trac.sagemath.org:22/sage into 10779</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95319371cc13f9512521043bfe53cfe806df244e\"><code>9531937</code></a></td><td><code>trac #10779 correct failing doctest + more doc changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54396cd64b3a1e4dc512be3438e85bfbe0bb5452\"><code>54396cd</code></a></td><td><code>Merge branch 'u/chapoton/10779' into 6.4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbf722e129b8d5239d52f8e202cb11dfeccb7049\"><code>dbf722e</code></a></td><td><code>Remove gcd, lcm, xgcd from element.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6d357a8b2874aaec970aa0d2afc3fa14d60969e\"><code>a6d357a</code></a></td><td><code>Merge ticket/10779 into ticket/17583</code></td></tr></table>\n",
    "created_at": "2015-01-23T21:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236094",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c99ae29715eae43d226da51eb282c3dff0d5e22"><code>4c99ae2</code></a></td><td><code>Improve dot products</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c84246e912c9380936c9e122934ed94ab160453f"><code>c84246e</code></a></td><td><code>#10779: Improve coverage test for structure/element.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db023d458e9e534000f9bc6a99575c5580e07b3e"><code>db023d4</code></a></td><td><code>Merge branch 'u/chapoton/10779' of ssh://trac.sagemath.org:22/sage into 10779</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e30025298097a2c280629135f3f76d973c0b4a5"><code>2e30025</code></a></td><td><code>trac #10779 corrected 3 doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d72c8114eab88575b09479df240d82f1b75582e"><code>9d72c81</code></a></td><td><code>Merge branch 'u/chapoton/10779' of ssh://trac.sagemath.org:22/sage into 10779</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95319371cc13f9512521043bfe53cfe806df244e"><code>9531937</code></a></td><td><code>trac #10779 correct failing doctest + more doc changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54396cd64b3a1e4dc512be3438e85bfbe0bb5452"><code>54396cd</code></a></td><td><code>Merge branch 'u/chapoton/10779' into 6.4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbf722e129b8d5239d52f8e202cb11dfeccb7049"><code>dbf722e</code></a></td><td><code>Remove gcd, lcm, xgcd from element.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6d357a8b2874aaec970aa0d2afc3fa14d60969e"><code>a6d357a</code></a></td><td><code>Merge ticket/10779 into ticket/17583</code></td></tr></table>




---

archive/issue_comments_236095.json:
```json
{
    "body": "Changed commit from **[`66d2f76`](https://github.com/sagemath/sagetrac-mirror/commit/66d2f76d685f654f18b77f0051ae85235a4f846f)** to **[`a6d357a`](https://github.com/sagemath/sagetrac-mirror/commit/a6d357a8b2874aaec970aa0d2afc3fa14d60969e)**",
    "created_at": "2015-01-23T21:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236095",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`66d2f76`](https://github.com/sagemath/sagetrac-mirror/commit/66d2f76d685f654f18b77f0051ae85235a4f846f)** to **[`a6d357a`](https://github.com/sagemath/sagetrac-mirror/commit/a6d357a8b2874aaec970aa0d2afc3fa14d60969e)**



---

archive/issue_comments_236096.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI also merged #10779 to avoid a small merge conflict. The only relevant new commit is\n|                                                                                                                                                 |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[4c99ae2](https://github.com/sagemath/sagetrac-mirror/commit/4c99ae29715eae43d226da51eb282c3dff0d5e22)|`Improve dot products`|",
    "created_at": "2015-01-23T21:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236096",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

I also merged #10779 to avoid a small merge conflict. The only relevant new commit is
|                                                                                                                                                 |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[4c99ae2](https://github.com/sagemath/sagetrac-mirror/commit/4c99ae29715eae43d226da51eb282c3dff0d5e22)|`Improve dot products`|



---

archive/issue_events_248276.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-23T21:36:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248276"
}
```



---

archive/issue_events_248277.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-23T21:36:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248277"
}
```



---

archive/issue_comments_236097.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n> Yes, to apply the following optimization: instead of starting with zero and `a[i]*b[i]`, we start with `a[0] * b[0]` and add `a[i]*b[i]` for `i >= 1`.\n\nFine. (I was not sure that it would be faster...)\n\nRegarding your last commit, I agree with the changes, but I don't understand why `dot_product` is defined in `FreeModuleElement` rather than in `Vector`. Actually I don't understand the point of the distinction between `Vector` and `FreeModuleElement` at all.\n\nAlso, I think we can do two additional simplifications related to `dot_product`:\n\n```\ndiff --git a/src/sage/matrix/matrix_generic_sparse.pyx b/src/sage/matrix/matrix_generic_sparse.pyx\nindex b2ff48a..a4cf07c 100644\n--- a/src/sage/matrix/matrix_generic_sparse.pyx\n+++ b/src/sage/matrix/matrix_generic_sparse.pyx\n@@ -495,17 +495,6 @@ def Matrix_sparse_from_rows(X):\n     return M(entries, coerce=False, copy=False)\n \n \n-## def _sparse_dot_product(v, w):\n-##     \"\"\"\n-##     INPUT:\n-##         v and w are dictionaries with integer keys.\n-##     \"\"\"\n-##     x = set(v.keys()).intersection(set(w.keys()))\n-##     a = 0\n-##     for k in x:\n-##         a = a + v[k]*w[k]\n-##     return a\n-\n cdef _convert_sparse_entries_to_dict(entries):\n     e = {}\n     for i in xrange(len(entries)):\ndiff --git a/src/sage/modules/vector_double_dense.pyx b/src/sage/modules/vector_double_dense.pyx\nindex 9efe536..279ce58 100644\n--- a/src/sage/modules/vector_double_dense.pyx\n+++ b/src/sage/modules/vector_double_dense.pyx\n@@ -389,8 +389,6 @@ cdef class Vector_double_dense(free_module_element.FreeModuleElement):\n             sage: w*v\n             1.0\n         \"\"\"\n-        if not right.parent() == self.parent():\n-            right = self.parent().ambient_module()(right)\n         if self._degree == 0:\n             from copy import copy\n             return copy(self)\n```",
    "created_at": "2015-01-24T11:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236097",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment%3A6):
> Yes, to apply the following optimization: instead of starting with zero and `a[i]*b[i]`, we start with `a[0] * b[0]` and add `a[i]*b[i]` for `i >= 1`.

Fine. (I was not sure that it would be faster...)

Regarding your last commit, I agree with the changes, but I don't understand why `dot_product` is defined in `FreeModuleElement` rather than in `Vector`. Actually I don't understand the point of the distinction between `Vector` and `FreeModuleElement` at all.

Also, I think we can do two additional simplifications related to `dot_product`:

```
diff --git a/src/sage/matrix/matrix_generic_sparse.pyx b/src/sage/matrix/matrix_generic_sparse.pyx
index b2ff48a..a4cf07c 100644
--- a/src/sage/matrix/matrix_generic_sparse.pyx
+++ b/src/sage/matrix/matrix_generic_sparse.pyx
@@ -495,17 +495,6 @@ def Matrix_sparse_from_rows(X):
     return M(entries, coerce=False, copy=False)
 
 
-## def _sparse_dot_product(v, w):
-##     """
-##     INPUT:
-##         v and w are dictionaries with integer keys.
-##     """
-##     x = set(v.keys()).intersection(set(w.keys()))
-##     a = 0
-##     for k in x:
-##         a = a + v[k]*w[k]
-##     return a
-
 cdef _convert_sparse_entries_to_dict(entries):
     e = {}
     for i in xrange(len(entries)):
diff --git a/src/sage/modules/vector_double_dense.pyx b/src/sage/modules/vector_double_dense.pyx
index 9efe536..279ce58 100644
--- a/src/sage/modules/vector_double_dense.pyx
+++ b/src/sage/modules/vector_double_dense.pyx
@@ -389,8 +389,6 @@ cdef class Vector_double_dense(free_module_element.FreeModuleElement):
             sage: w*v
             1.0
         """
-        if not right.parent() == self.parent():
-            right = self.parent().ambient_module()(right)
         if self._degree == 0:
             from copy import copy
             return copy(self)
```



---

archive/issue_comments_236098.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@mezzarobba](#comment%3A9):\n> Replying to [@jdemeyer](#comment%3A6):\n> > Yes, to apply the following optimization: instead of starting with zero and `a[i]*b[i]`, we start with `a[0] * b[0]` and add `a[i]*b[i]` for `i >= 1`.\n\n> \n> Fine. (I was not sure that it would be faster...)\n\nIt's always going to be somewhat faster and it avoids extra work in case the parents are not equal.\n\n> Regarding your last commit, I agree with the changes, but I don't understand why `dot_product` is defined in `FreeModuleElement` rather than in `Vector`.\n\nI could easily move it...\n\n> Actually I don't understand the point of the distinction between `Vector` and `FreeModuleElement` at all.\n\nCurrently in Sage, the only `Vector`s are also `FreeModuleElement`s. But one could envision a parent which is not a *free* module...\n\n> Also, I think we can do two additional simplifications related to `dot_product`:\n> \n> ```\n> diff --git a/src/sage/matrix/matrix_generic_sparse.pyx b/src/sage/matrix/matrix_generic_sparse.pyx\n> index b2ff48a..a4cf07c 100644\n> --- a/src/sage/matrix/matrix_generic_sparse.pyx\n> +++ b/src/sage/matrix/matrix_generic_sparse.pyx\n> @@ -495,17 +495,6 @@ def Matrix_sparse_from_rows(X):\n>      return M(entries, coerce=False, copy=False)\n>  \n>  \n> -## def _sparse_dot_product(v, w):\n> -##     \"\"\"\n> -##     INPUT:\n> -##         v and w are dictionaries with integer keys.\n> -##     \"\"\"\n> -##     x = set(v.keys()).intersection(set(w.keys()))\n> -##     a = 0\n> -##     for k in x:\n> -##         a = a + v[k]*w[k]\n> -##     return a\n> -\n>  cdef _convert_sparse_entries_to_dict(entries):\n>      e = {}\n>      for i in xrange(len(entries)):\n> ```\n\nAbsolutely not on this ticket, but see #17663.",
    "created_at": "2015-01-24T14:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236098",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@mezzarobba](#comment%3A9):
> Replying to [@jdemeyer](#comment%3A6):
> > Yes, to apply the following optimization: instead of starting with zero and `a[i]*b[i]`, we start with `a[0] * b[0]` and add `a[i]*b[i]` for `i >= 1`.

> 
> Fine. (I was not sure that it would be faster...)

It's always going to be somewhat faster and it avoids extra work in case the parents are not equal.

> Regarding your last commit, I agree with the changes, but I don't understand why `dot_product` is defined in `FreeModuleElement` rather than in `Vector`.

I could easily move it...

> Actually I don't understand the point of the distinction between `Vector` and `FreeModuleElement` at all.

Currently in Sage, the only `Vector`s are also `FreeModuleElement`s. But one could envision a parent which is not a *free* module...

> Also, I think we can do two additional simplifications related to `dot_product`:
> 
> ```
> diff --git a/src/sage/matrix/matrix_generic_sparse.pyx b/src/sage/matrix/matrix_generic_sparse.pyx
> index b2ff48a..a4cf07c 100644
> --- a/src/sage/matrix/matrix_generic_sparse.pyx
> +++ b/src/sage/matrix/matrix_generic_sparse.pyx
> @@ -495,17 +495,6 @@ def Matrix_sparse_from_rows(X):
>      return M(entries, coerce=False, copy=False)
>  
>  
> -## def _sparse_dot_product(v, w):
> -##     """
> -##     INPUT:
> -##         v and w are dictionaries with integer keys.
> -##     """
> -##     x = set(v.keys()).intersection(set(w.keys()))
> -##     a = 0
> -##     for k in x:
> -##         a = a + v[k]*w[k]
> -##     return a
> -
>  cdef _convert_sparse_entries_to_dict(entries):
>      e = {}
>      for i in xrange(len(entries)):
> ```

Absolutely not on this ticket, but see #17663.



---

archive/issue_comments_236099.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@mezzarobba](#comment%3A9):\n> Regarding your last commit, I agree with the changes, but I don't understand why `dot_product` is defined in `FreeModuleElement` rather than in `Vector`.\n\nFor consistency, I would prefer to keep `dot_product` in `FreeModuleElement`. For `pairwise_product()` (which I didn't change), we also have `pairwise_product` on the level of `FreeModuleElement` but `_pairwise_product_` on the level of `Vector`. Further refactoring would need to involve all kinds of products (dot, cross and pairwise) and I would prefer not to do this now.",
    "created_at": "2015-01-24T14:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236099",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@mezzarobba](#comment%3A9):
> Regarding your last commit, I agree with the changes, but I don't understand why `dot_product` is defined in `FreeModuleElement` rather than in `Vector`.

For consistency, I would prefer to keep `dot_product` in `FreeModuleElement`. For `pairwise_product()` (which I didn't change), we also have `pairwise_product` on the level of `FreeModuleElement` but `_pairwise_product_` on the level of `Vector`. Further refactoring would need to involve all kinds of products (dot, cross and pairwise) and I would prefer not to do this now.



---

archive/issue_comments_236100.json:
```json
{
    "body": "Changed commit from **[`a6d357a`](https://github.com/sagemath/sagetrac-mirror/commit/a6d357a8b2874aaec970aa0d2afc3fa14d60969e)** to **[`dcbf770`](https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6)**",
    "created_at": "2015-01-24T16:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236100",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a6d357a`](https://github.com/sagemath/sagetrac-mirror/commit/a6d357a8b2874aaec970aa0d2afc3fa14d60969e)** to **[`dcbf770`](https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6)**



---

archive/issue_comments_236101.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6\"><code>dcbf770</code></a></td><td><code>Fix zero-dimensional dot product</code></td></tr></table>\n",
    "created_at": "2015-01-24T16:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236101",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6"><code>dcbf770</code></a></td><td><code>Fix zero-dimensional dot product</code></td></tr></table>




---

archive/issue_comments_236102.json:
```json
{
    "body": "Changed dependencies from **#17561** to **#17561, #10779**",
    "created_at": "2015-01-24T16:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236102",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#17561** to **#17561, #10779**



---

archive/issue_comments_236103.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nDespite the fact that \"Trac's automerging failed\", the branch actually merges when using `git`.",
    "created_at": "2015-01-25T09:23:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236103",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Despite the fact that "Trac's automerging failed", the branch actually merges when using `git`.



---

archive/issue_events_248278.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-01-25T09:53:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248278"
}
```



---

archive/issue_events_248279.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-01-25T09:53:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248279"
}
```



---

archive/issue_comments_236104.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment%3A10):\n> Currently in Sage, the only `Vector`s are also `FreeModuleElement`s. But one could envision a parent which is not a *free* module...\n\nSure, but either its elements would derive direclty from `ModuleElement`, or (I'd say) much of what `FreeModuleElement` currently does would need to be moved to `Vector`. Anyway, if you feel that `dot_product` should stay in `FreeModuleElement` until someone does this kind of refactoring, I'm fine with that.\n\nThanks for you work on this ticket!",
    "created_at": "2015-01-25T09:53:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236104",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment%3A10):
> Currently in Sage, the only `Vector`s are also `FreeModuleElement`s. But one could envision a parent which is not a *free* module...

Sure, but either its elements would derive direclty from `ModuleElement`, or (I'd say) much of what `FreeModuleElement` currently does would need to be moved to `Vector`. Anyway, if you feel that `dot_product` should stay in `FreeModuleElement` until someone does this kind of refactoring, I'm fine with that.

Thanks for you work on this ticket!



---

archive/issue_events_248280.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-29T13:26:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248280"
}
```



---

archive/issue_events_248281.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6e5983b56a848b9588efe06f5581324f4777b544",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-01-29T13:26:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17583#event-248281"
}
```



---

archive/issue_comments_236105.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17583](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17583)** to **[`dcbf770`](https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6)**",
    "created_at": "2015-01-29T13:26:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17583#issuecomment-236105",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17583](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17583)** to **[`dcbf770`](https://github.com/sagemath/sagetrac-mirror/commit/dcbf770938972358639fc637dc0bf99ddf2489d6)**
