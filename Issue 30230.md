# Issue 30230: src/tox.ini: Check patchbot plugin patterns

archive/issues_030230.json:
```json
{
    "body": "CC:  @fchapoton @jhpalmieri @tobiasdiez @tscrim @slel @kliem\n\n(from #30448)\n\nIssue created by migration from https://trac.sagemath.org/ticket/30467\n\n",
    "created_at": "2020-08-29T23:48:20Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "src/tox.ini: Check patchbot plugin patterns",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30230",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @fchapoton @jhpalmieri @tobiasdiez @tscrim @slel @kliem

(from #30448)

Issue created by migration from https://trac.sagemath.org/ticket/30467





---

archive/issue_comments_430433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-30T01:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430434.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-30T01:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430434",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430435.json:
```json
{
    "body": "Overall looks good to me. A few suggestions:\n- Please try not to use `sh -c` in the tox, because this is not platform compatible i.e. doesn't work on Windows. \n- The trailing whitespace error can also be checked by pycodestyle, https://pycodestyle.pycqa.org/en/latest/intro.html#error-codes W291. Thus, I guess this custom regex lint rule can be replaced by adding W291 to the pycodestyle config.\n- Not sure if the first \"python 3 incompatible\" check is still needed. Since if you use python 3 incompatible code, then it simply shouldn't run, right?\n- relint should also be documented #30361 and added to the lint action #30404",
    "created_at": "2020-08-30T10:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430435",
    "user": "https://github.com/tobiasdiez"
}
```

Overall looks good to me. A few suggestions:
- Please try not to use `sh -c` in the tox, because this is not platform compatible i.e. doesn't work on Windows. 
- The trailing whitespace error can also be checked by pycodestyle, https://pycodestyle.pycqa.org/en/latest/intro.html#error-codes W291. Thus, I guess this custom regex lint rule can be replaced by adding W291 to the pycodestyle config.
- Not sure if the first "python 3 incompatible" check is still needed. Since if you use python 3 incompatible code, then it simply shouldn't run, right?
- relint should also be documented #30361 and added to the lint action #30404



---

archive/issue_comments_430436.json:
```json
{
    "body": "Replying to [comment:10 gh-tobiasdiez]:\n> Overall looks good to me. A few suggestions:\n> - Please try not to use `sh -c` in the tox, because this is not platform compatible i.e. doesn't work on Windows. \n\nThanks for the heads-up. Do you have a specific suggestion what to do instead?\n\n> - The trailing whitespace error can also be checked by pycodestyle, https://pycodestyle.pycqa.org/en/latest/intro.html#error-codes W291. Thus, I guess this custom regex lint rule can be replaced by adding W291 to the pycodestyle config.\n> - Not sure if the first \"python 3 incompatible\" check is still needed. Since if you use python 3 incompatible code, then it simply shouldn't run, right?\n\nRight. For now I just wanted to get these on par with the patchbot. I would prefer to make further refinements in follow-up tickets.\n\nRegarding Python 3 - these patterns may still be helpful when reviving ancient branches. Some of these patterns, of course, will be flagged by the Python 3 parser; but other patterns are for syntactically correct but outdated library functions that may be used in parts of code that is not covered by doctests.\n\n> - relint should also be documented #30361 \n\nI'll do this in #30453 (Document \"sage -tox\")\n\n> and added to the lint action #30404\n\n#30404 should possibly just invoke tox",
    "created_at": "2020-08-30T14:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430436",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 gh-tobiasdiez]:
> Overall looks good to me. A few suggestions:
> - Please try not to use `sh -c` in the tox, because this is not platform compatible i.e. doesn't work on Windows. 

Thanks for the heads-up. Do you have a specific suggestion what to do instead?

> - The trailing whitespace error can also be checked by pycodestyle, https://pycodestyle.pycqa.org/en/latest/intro.html#error-codes W291. Thus, I guess this custom regex lint rule can be replaced by adding W291 to the pycodestyle config.
> - Not sure if the first "python 3 incompatible" check is still needed. Since if you use python 3 incompatible code, then it simply shouldn't run, right?

Right. For now I just wanted to get these on par with the patchbot. I would prefer to make further refinements in follow-up tickets.

Regarding Python 3 - these patterns may still be helpful when reviving ancient branches. Some of these patterns, of course, will be flagged by the Python 3 parser; but other patterns are for syntactically correct but outdated library functions that may be used in parts of code that is not covered by doctests.

> - relint should also be documented #30361 

I'll do this in #30453 (Document "sage -tox")

> and added to the lint action #30404

#30404 should possibly just invoke tox



---

archive/issue_comments_430437.json:
```json
{
    "body": "I think in most cases you can simply remove the `sh -c` part. The if/for statements need a bit more work, probably the easiest solution is to write a small python wrapper. \n\nScrolling through the tox documentation, I'm also not sure if the processing of arguments is really in the spirit of tox. For example, the foreach loop for relint makes it impossible to pass further cmd args to relint (since they would end up in the loop). On the other hand, I see that its also convenient to have a systematic interface to apply the command to only one file. Maybe leave this functionality to `sage --tox`?",
    "created_at": "2020-08-30T16:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430437",
    "user": "https://github.com/tobiasdiez"
}
```

I think in most cases you can simply remove the `sh -c` part. The if/for statements need a bit more work, probably the easiest solution is to write a small python wrapper. 

Scrolling through the tox documentation, I'm also not sure if the processing of arguments is really in the spirit of tox. For example, the foreach loop for relint makes it impossible to pass further cmd args to relint (since they would end up in the loop). On the other hand, I see that its also convenient to have a systematic interface to apply the command to only one file. Maybe leave this functionality to `sage --tox`?



---

archive/issue_comments_430438.json:
```json
{
    "body": "Replying to [comment:12 gh-tobiasdiez]:\n> Scrolling through the tox documentation, I'm also not sure if the processing of arguments is really in the spirit of tox. For example, the foreach loop for relint makes it impossible to pass further cmd args to relint (since they would end up in the loop). On the other hand, I see that its also convenient to have a systematic interface to apply the command to only one file. Maybe leave this functionality to `sage --tox`?\n\ntox runs all environments by default -- so there needs to be a uniform interface for file/directory arguments",
    "created_at": "2020-08-30T17:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430438",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:12 gh-tobiasdiez]:
> Scrolling through the tox documentation, I'm also not sure if the processing of arguments is really in the spirit of tox. For example, the foreach loop for relint makes it impossible to pass further cmd args to relint (since they would end up in the loop). On the other hand, I see that its also convenient to have a systematic interface to apply the command to only one file. Maybe leave this functionality to `sage --tox`?

tox runs all environments by default -- so there needs to be a uniform interface for file/directory arguments



---

archive/issue_comments_430439.json:
```json
{
    "body": "Replying to [comment:12 gh-tobiasdiez]:\n> I think in most cases you can simply remove the `sh -c` part. The if/for statements need a bit more work, probably the easiest solution is to write a small python wrapper. \n\nOK. I think I am going to change `sage --coverage` so that it can invoke `sage --coverageall` if necessary.\n\nThen I can get rid of `sh -c` for all \"sagedirect\" environments.",
    "created_at": "2020-08-30T17:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430439",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:12 gh-tobiasdiez]:
> I think in most cases you can simply remove the `sh -c` part. The if/for statements need a bit more work, probably the easiest solution is to write a small python wrapper. 

OK. I think I am going to change `sage --coverage` so that it can invoke `sage --coverageall` if necessary.

Then I can get rid of `sh -c` for all "sagedirect" environments.



---

archive/issue_comments_430440.json:
```json
{
    "body": "I'll do this in #30474",
    "created_at": "2020-08-30T17:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430440",
    "user": "https://github.com/mkoeppe"
}
```

I'll do this in #30474



---

archive/issue_comments_430441.json:
```json
{
    "body": "Replying to [comment:12 gh-tobiasdiez]:\n> ... Maybe leave this functionality to `sage --tox`?\n\nNo, I think it's important to keep plain `tox` from the command line the same as `sage --tox`",
    "created_at": "2020-08-30T17:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430441",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:12 gh-tobiasdiez]:
> ... Maybe leave this functionality to `sage --tox`?

No, I think it's important to keep plain `tox` from the command line the same as `sage --tox`



---

archive/issue_comments_430442.json:
```json
{
    "body": "Needs review.",
    "created_at": "2020-08-31T17:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430442",
    "user": "https://github.com/mkoeppe"
}
```

Needs review.



---

archive/issue_comments_430443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-01T21:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430444.json:
```json
{
    "body": "I like it. It saves you from waiting on the patchbots to do trivial stuff.\n\nAs for the python3 style. That is still helpful. Iterator classes will probably still take `.next()`, but you shouldn't use it anymore and at some point, this should be removed.\n\nWorks for me.\n\n`@`gh-tobiasdiez: Do you have anything that needs changing yet.",
    "created_at": "2020-09-04T19:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430444",
    "user": "https://github.com/kliem"
}
```

I like it. It saves you from waiting on the patchbots to do trivial stuff.

As for the python3 style. That is still helpful. Iterator classes will probably still take `.next()`, but you shouldn't use it anymore and at some point, this should be removed.

Works for me.

`@`gh-tobiasdiez: Do you have anything that needs changing yet.



---

archive/issue_comments_430445.json:
```json
{
    "body": "No, it looks fine for me as well (given that #30474 is addressed at some point).",
    "created_at": "2020-09-04T20:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430445",
    "user": "https://github.com/tobiasdiez"
}
```

No, it looks fine for me as well (given that #30474 is addressed at some point).



---

archive/issue_comments_430446.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-04T22:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430446",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430447.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-09-04T22:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430447",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_430448.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-18T20:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30230#issuecomment-430448",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
