# Issue 22801: Cython testsuite failure

Issue created by migration from https://trac.sagemath.org/ticket/23038

Original creator: vbraun

Original creation time: 2017-05-20 19:31:38




---

Comment by vbraun created at 2017-05-20 19:36:50

Changing priority from major to blocker.


---

Comment by vbraun created at 2017-05-20 19:36:50

Changing status from new to needs_review.


---

Comment by vbraun created at 2017-05-20 19:36:50

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by vbraun created at 2017-05-20 19:36:50

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2017-05-20 19:36:50

New commits:


---

Comment by jdemeyer created at 2017-05-22 08:38:37

The testsuite still fails even with this patch:

```
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test ()
[cython-0.25.2.p1] Doctest: numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line 62, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line 257, in numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test (numpy_test.__test__)
[cython-0.25.2.p1] Doctest: numpy_test.__test__.numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test.__test__.numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line unknown line number, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line ?, in numpy_test.__test__.numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test ()
[cython-0.25.2.p1] Doctest: numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line 67, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line 262, in numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test (numpy_test.__test__)
[cython-0.25.2.p1] Doctest: numpy_test.__test__.numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test.__test__.numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line unknown line number, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line ?, in numpy_test.__test__.numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Ran 10243 tests in 1169.865s
[cython-0.25.2.p1] 
[cython-0.25.2.p1] FAILED (failures=4, skipped=2)
[cython-0.25.2.p1] Following tests excluded because of missing dependencies on your system:
[cython-0.25.2.p1]    Cython.Coverage
[cython-0.25.2.p1]    run.asyncio_generators
[cython-0.25.2.p1]    run.coverage_api
[cython-0.25.2.p1]    run.coverage_cmd
[cython-0.25.2.p1]    run.coverage_nogil
[cython-0.25.2.p1] ALL DONE
```



---

Comment by jdemeyer created at 2017-05-22 08:38:37

Changing status from needs_review to needs_work.


---

Comment by tmonteil created at 2017-05-22 16:26:51

See also the the segmentation fault during cython tests on 32bit at #23055.


---

Comment by vbraun created at 2017-06-11 10:51:13

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-06-11 10:51:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-06-14 10:01:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-15 16:45:39

Resolution: fixed
