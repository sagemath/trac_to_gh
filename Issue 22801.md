# Issue 22801: Cython testsuite failure

archive/issues_022801.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/23038\n\n",
    "created_at": "2017-05-20T19:31:38Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Cython testsuite failure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22801",
    "user": "https://github.com/vbraun"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/23038





---

archive/issue_comments_318457.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2017-05-20T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318457",
    "user": "https://github.com/vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_318458.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-20T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318458",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318459.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2017-05-20T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318459",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_318460.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2017-05-20T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318460",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_318461.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-20T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318461",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_318462.json:
```json
{
    "body": "The testsuite still fails even with this patch:\n\n```\n[cython-0.25.2.p1] ======================================================================\n[cython-0.25.2.p1] FAIL: numpy_test ()\n[cython-0.25.2.p1] Doctest: numpy_test\n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] Traceback (most recent call last):\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/lib/python2.7/doctest.py\", line 2226, in runTest\n[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))\n[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so\", line 62, in numpy_test\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so\", line 257, in numpy_test\n[cython-0.25.2.p1] Failed example:\n[cython-0.25.2.p1]     test_point_record()\n[cython-0.25.2.p1] Expected:\n[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] Got:\n[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ======================================================================\n[cython-0.25.2.p1] FAIL: numpy_test (numpy_test.__test__)\n[cython-0.25.2.p1] Doctest: numpy_test.__test__.numpy_test\n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] Traceback (most recent call last):\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/lib/python2.7/doctest.py\", line 2226, in runTest\n[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))\n[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test.__test__.numpy_test\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so\", line unknown line number, in numpy_test\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so\", line ?, in numpy_test.__test__.numpy_test\n[cython-0.25.2.p1] Failed example:\n[cython-0.25.2.p1]     test_point_record()\n[cython-0.25.2.p1] Expected:\n[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] Got:\n[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ======================================================================\n[cython-0.25.2.p1] FAIL: numpy_test ()\n[cython-0.25.2.p1] Doctest: numpy_test\n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] Traceback (most recent call last):\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/lib/python2.7/doctest.py\", line 2226, in runTest\n[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))\n[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so\", line 67, in numpy_test\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so\", line 262, in numpy_test\n[cython-0.25.2.p1] Failed example:\n[cython-0.25.2.p1]     test_point_record()\n[cython-0.25.2.p1] Expected:\n[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] Got:\n[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ======================================================================\n[cython-0.25.2.p1] FAIL: numpy_test (numpy_test.__test__)\n[cython-0.25.2.p1] Doctest: numpy_test.__test__.numpy_test\n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] Traceback (most recent call last):\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/lib/python2.7/doctest.py\", line 2226, in runTest\n[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))\n[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test.__test__.numpy_test\n[cython-0.25.2.p1]   File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so\", line unknown line number, in numpy_test\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] File \"/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so\", line ?, in numpy_test.__test__.numpy_test\n[cython-0.25.2.p1] Failed example:\n[cython-0.25.2.p1]     test_point_record()\n[cython-0.25.2.p1] Expected:\n[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] Got:\n[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], \n[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] \n[cython-0.25.2.p1] ----------------------------------------------------------------------\n[cython-0.25.2.p1] Ran 10243 tests in 1169.865s\n[cython-0.25.2.p1] \n[cython-0.25.2.p1] FAILED (failures=4, skipped=2)\n[cython-0.25.2.p1] Following tests excluded because of missing dependencies on your system:\n[cython-0.25.2.p1]    Cython.Coverage\n[cython-0.25.2.p1]    run.asyncio_generators\n[cython-0.25.2.p1]    run.coverage_api\n[cython-0.25.2.p1]    run.coverage_cmd\n[cython-0.25.2.p1]    run.coverage_nogil\n[cython-0.25.2.p1] ALL DONE\n```\n",
    "created_at": "2017-05-22T08:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318462",
    "user": "https://github.com/jdemeyer"
}
```

The testsuite still fails even with this patch:

```
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test ()
[cython-0.25.2.p1] Doctest: numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line 62, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line 257, in numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test (numpy_test.__test__)
[cython-0.25.2.p1] Doctest: numpy_test.__test__.numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test.__test__.numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line unknown line number, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/c/numpy_test/numpy_test.so", line ?, in numpy_test.__test__.numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test ()
[cython-0.25.2.p1] Doctest: numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line 67, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line 262, in numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ======================================================================
[cython-0.25.2.p1] FAIL: numpy_test (numpy_test.__test__)
[cython-0.25.2.p1] Doctest: numpy_test.__test__.numpy_test
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Traceback (most recent call last):
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/lib/python2.7/doctest.py", line 2226, in runTest
[cython-0.25.2.p1]     raise self.failureException(self.format_failure(new.getvalue()))
[cython-0.25.2.p1] AssertionError: Failed doctest test for numpy_test.__test__.numpy_test
[cython-0.25.2.p1]   File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line unknown line number, in numpy_test
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] File "/usr/local/src/sage-git/local/var/tmp/sage/build/cython-0.25.2.p1/src/TEST_TMP/run/cpp/numpy_test/numpy_test.so", line ?, in numpy_test.__test__.numpy_test
[cython-0.25.2.p1] Failed example:
[cython-0.25.2.p1]     test_point_record()
[cython-0.25.2.p1] Expected:
[cython-0.25.2.p1]     array([(0., 0.), (1., -1.), (2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] Got:
[cython-0.25.2.p1]     array([( 0.,  0.), ( 1., -1.), ( 2., -2.)], 
[cython-0.25.2.p1]           dtype=[('x', '!f8'), ('y', '!f8')])
[cython-0.25.2.p1] 
[cython-0.25.2.p1] 
[cython-0.25.2.p1] ----------------------------------------------------------------------
[cython-0.25.2.p1] Ran 10243 tests in 1169.865s
[cython-0.25.2.p1] 
[cython-0.25.2.p1] FAILED (failures=4, skipped=2)
[cython-0.25.2.p1] Following tests excluded because of missing dependencies on your system:
[cython-0.25.2.p1]    Cython.Coverage
[cython-0.25.2.p1]    run.asyncio_generators
[cython-0.25.2.p1]    run.coverage_api
[cython-0.25.2.p1]    run.coverage_cmd
[cython-0.25.2.p1]    run.coverage_nogil
[cython-0.25.2.p1] ALL DONE
```




---

archive/issue_comments_318463.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-22T08:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318463",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_318464.json:
```json
{
    "body": "See also the the segmentation fault during cython tests on 32bit at #23055.",
    "created_at": "2017-05-22T16:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318464",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

See also the the segmentation fault during cython tests on 32bit at #23055.



---

archive/issue_comments_318465.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-11T10:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318465",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-11T10:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318467.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-14T10:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318467",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318468.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-15T16:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22801#issuecomment-318468",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_021429.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-15T16:45:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22801",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22801#event-21429"
}
```
