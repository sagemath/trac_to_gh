# Issue 24607: Some elliptic curve functions do not set a point's order

Issue created by migration from Trac.

Original creator: cremona

Original creation time: 2018-02-26 16:49:18

CC:  erkan.tairi@gmail.com

Keywords: points order


```
sage: p=next_prime(1000000)
sage: E=EllipticCurve(GF(p), 123, 456)
sage: pts = E(0).division_points(3)
sage: P=pts[1]; P
(389063 : 124244 : 1)
sage: 
sage: P._order
...
AttributeError: 'EllipticCurvePoint_finite_field' object has no attribute '_order'
sage: P.order()
3
sage: P._order
3
sage: 
```


Here one might expect the point P's _order attribute to be set to 3 on construction since this can be deduced from what is known.


---

Comment by chapoton created at 2018-02-26 20:56:14

here is a naive tentative for a start, feel free to take over and enhance
----
New commits:


---

Comment by chapoton created at 2018-02-26 20:56:14

Changing status from new to needs_review.


---

Comment by cremona created at 2018-02-27 09:14:29

There are more cases where the order can be deduced with no work.  At a minimum therefore I would do these:
   1. nothing if self's order not set;
   2. if self's order is infinity set order to infinity;
   3. if self's order=n and m=1 then set order=n (obvious special case).
Otherwise the order is n*k where k divides m and all possibilities are possible. [Note that the first version in commit 3ebb1c is not quite correct since one of the returned points is 0.]  It would be possible to find the order k of n*Q for each returned point Q and set the order of Q to n*k, given that k is known to divide m.


---

Comment by cremona created at 2018-02-27 12:30:11

More thoughts: we currently never set the order of a point computed via addition, subtraction or even negation.  The latter is uncontroversial!  The general case is probably too much since if you add two points of infinite order the result in principle could have any finite order, and even if the summands both have finite order then the sum could have any order dividing the lcm of those.

Hence I am now inclined to do less than was suggested in comment 2, but a little more than is in the first commit, namely if you divide E(0) by m then (since it safe to assume that m is easily factorisable when that succeeds) all points returned can have their actual order (dividing m) computed and set, using the generic order_from_multiple() function.


---

Comment by git created at 2018-02-27 16:15:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-02-27 16:17:18

Despite comment 3 I put in an implementation in all cases where the original point's order is already known (or if it 0 in which case we set its order to 1).  This is quite simple and cheap.  Note that m must be small or earlier steps in the division_points() function will already take too long so the additional step is negligible.

I just thought of one more thing to add before setting to "needs review".


---

Comment by git created at 2018-02-27 16:24:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-02-28 10:44:03

I think you should add a test for the infinite order case, please.


---

Comment by cremona created at 2018-02-28 10:57:52

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2018-02-28 10:57:52

Replying to [comment:8 chapoton]:
> I think you should add a test for the infinite order case, please.
OK -- will do.   (I'll also add you as an author, sorry if I deleted you by mistake.)


---

Comment by git created at 2018-02-28 11:33:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-03-02 08:46:50

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-03-02 09:03:38

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-03-02 09:03:38

ok, thanks. No need to list me as an author.


---

Comment by vbraun created at 2018-03-06 23:23:50

Resolution: fixed
