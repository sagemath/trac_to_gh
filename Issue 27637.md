# Issue 27637: Trace monoid support

archive/issues_027637.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/27874\n\n",
    "created_at": "2019-05-26T12:54:02Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Trace monoid support",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27637",
    "user": "https://github.com/PaulRaUnite"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/27874





---

archive/issue_comments_389716.json:
```json
{
    "body": "Changing keywords from \"\" to \"monoid\".",
    "created_at": "2019-05-26T12:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389716",
    "user": "https://github.com/PaulRaUnite"
}
```

Changing keywords from "" to "monoid".



---

archive/issue_comments_389717.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebra.",
    "created_at": "2019-05-26T12:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389717",
    "user": "https://github.com/PaulRaUnite"
}
```

Changing component from PLEASE CHANGE to algebra.



---

archive/issue_comments_389718.json:
```json
{
    "body": "Set assignee to @PaulRaUnite.",
    "created_at": "2019-05-26T12:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389718",
    "user": "https://github.com/PaulRaUnite"
}
```

Set assignee to @PaulRaUnite.



---

archive/issue_comments_389719.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to task.",
    "created_at": "2019-05-26T12:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389719",
    "user": "https://github.com/PaulRaUnite"
}
```

Changing type from PLEASE CHANGE to task.



---

archive/issue_comments_389720.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-26T22:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389720",
    "user": "https://github.com/PaulRaUnite"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389721.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-26T22:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389721",
    "user": "https://github.com/PaulRaUnite"
}
```

New commits:



---

archive/issue_comments_389722.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-27T00:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389722",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_389723.json:
```json
{
    "body": "This is a good first step and implementation. However, there are a number of issues that need to be addressed:\n\n- A number of your docstrings are malformatted:\n  * After each `::` should be a blank line.\n  * You documentation is over-indented in placed (e.g., `_dependence_stack`)\n  * `b != a` -> ``b \\neq a``\n  * Not correctly aligned and soem other small tweaks\n    {{{#!diff\n-        - ``alg`` -- string (default: `naive`); defines algorithm that will be used\n-            to compute Hasse diagram; there are two variants: `naive` and `min`.\n+        - ``alg`` -- string (default: ``'naive'``); defines algorithm that will be used\n+          to compute Hasse diagram; there are two variants: ``'naive'`` and ``'min'``\n    }}}\n    (similar change in `projection`)\n- `independence` should just be a ``@`cached_method` (this is a general convention in Sage).\n- I think `foata_normal_form` should output a tuple (this is what `left_normal_form` does for the braid group). Another option might be to output a `Factorization` object.\n- All methods need doctests. A good one for an `__init__` method is to do `TestSuite(foo).run()`, where `foo` is an instance of the class.\n- I strongly disagree with expanding the syntactic sugar for the input, at least here. It is far too specialized and quite possible to break. This could be a good idea, but it is definitely something that needs to be brought to sage-devel for discussion.\n\nYou might also be interested in the right-angled Artin group class and instead build upon that.",
    "created_at": "2019-05-27T00:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389723",
    "user": "https://github.com/tscrim"
}
```

This is a good first step and implementation. However, there are a number of issues that need to be addressed:

- A number of your docstrings are malformatted:
  * After each `::` should be a blank line.
  * You documentation is over-indented in placed (e.g., `_dependence_stack`)
  * `b != a` -> ``b \neq a``
  * Not correctly aligned and soem other small tweaks
    {{{#!diff
-        - ``alg`` -- string (default: `naive`); defines algorithm that will be used
-            to compute Hasse diagram; there are two variants: `naive` and `min`.
+        - ``alg`` -- string (default: ``'naive'``); defines algorithm that will be used
+          to compute Hasse diagram; there are two variants: ``'naive'`` and ``'min'``
    }}}
    (similar change in `projection`)
- `independence` should just be a ``@`cached_method` (this is a general convention in Sage).
- I think `foata_normal_form` should output a tuple (this is what `left_normal_form` does for the braid group). Another option might be to output a `Factorization` object.
- All methods need doctests. A good one for an `__init__` method is to do `TestSuite(foo).run()`, where `foo` is an instance of the class.
- I strongly disagree with expanding the syntactic sugar for the input, at least here. It is far too specialized and quite possible to break. This could be a good idea, but it is definitely something that needs to be brought to sage-devel for discussion.

You might also be interested in the right-angled Artin group class and instead build upon that.



---

archive/issue_comments_389724.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-27T23:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389725.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n\nThank you for such a fast review.\n\nYou're right about syntax sugar, it doesn't worth to add it only for one case, so I've deleted it. If someone will really need it, someone will create a ticket.\n\nFixed all the problems you spotted, I hope.",
    "created_at": "2019-05-27T23:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389725",
    "user": "https://github.com/PaulRaUnite"
}
```

Replying to [comment:4 tscrim]:

Thank you for such a fast review.

You're right about syntax sugar, it doesn't worth to add it only for one case, so I've deleted it. If someone will really need it, someone will create a ticket.

Fixed all the problems you spotted, I hope.



---

archive/issue_comments_389726.json:
```json
{
    "body": "Thank you. It is looking much better. Here are some additional comments:\n\nAnytime you have normal text after `EXAMPLES::`, it should be `EXAMPLES:`, e.g.,\n\n```diff\n-EXAMPLES::\n+EXAMPLES:\n \n The following example demonstrates a monoid creation ::\n```\n\nYou will also want to remove the space before the `::` so Sphinx adds the colon `:` to the end of the output sentence.\n\n`AUTHORS::` -> `AUTHORS:` (it is not a special block nor is their code after it)\n\nPlease use the standard copyright header in Sage (see, e.g., `algebras/weyl_algebra.py`)\n\n\n```diff\n-        EXAMPLES::\n+        EXAMPLES:\n \n-            Get the normal form ::\n+        Get the normal form::\n```\n\n\nChange the name of `lexic_norm_form` to either the standard shortening `lex_normal_form` or fully spelled out `lexicographic_normal_form` (note the fully spelled out `normal` too).\nI am also not sure I like the `while True:` loop in there as there seems to be more standard ways to write that logic (where the main condition is the `while`-loop condition.\n\nSimilar for `foata_norm_form`.\n\nThis seem complicated:\n\n```\n        repeated_el_iter = (repeat(e, times) for e, times in self._element_list)\n        return list(chain.from_iterable(repeated_el_iter))\n```\n\nCan you just do it using a list comprehension? (e.g., `[foo(bar) for bar in B]`)\n\nWhy do you need the `next_front` map in `min_hasse_diagram`?\n\nA `TraceMonoid` is not a `FreeMonoid`, so I do not think it should inherit from `FreeMonoid`. Also, can you justify why we should add this instead of expanding the right-angled Artin group code? I understand this is to be the monoid version of that, but I still expend a lot of commonomalities.\n\n`_repr_` and `_latex_` do not have any docstrings/doctests.",
    "created_at": "2019-05-28T13:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389726",
    "user": "https://github.com/tscrim"
}
```

Thank you. It is looking much better. Here are some additional comments:

Anytime you have normal text after `EXAMPLES::`, it should be `EXAMPLES:`, e.g.,

```diff
-EXAMPLES::
+EXAMPLES:
 
 The following example demonstrates a monoid creation ::
```

You will also want to remove the space before the `::` so Sphinx adds the colon `:` to the end of the output sentence.

`AUTHORS::` -> `AUTHORS:` (it is not a special block nor is their code after it)

Please use the standard copyright header in Sage (see, e.g., `algebras/weyl_algebra.py`)


```diff
-        EXAMPLES::
+        EXAMPLES:
 
-            Get the normal form ::
+        Get the normal form::
```


Change the name of `lexic_norm_form` to either the standard shortening `lex_normal_form` or fully spelled out `lexicographic_normal_form` (note the fully spelled out `normal` too).
I am also not sure I like the `while True:` loop in there as there seems to be more standard ways to write that logic (where the main condition is the `while`-loop condition.

Similar for `foata_norm_form`.

This seem complicated:

```
        repeated_el_iter = (repeat(e, times) for e, times in self._element_list)
        return list(chain.from_iterable(repeated_el_iter))
```

Can you just do it using a list comprehension? (e.g., `[foo(bar) for bar in B]`)

Why do you need the `next_front` map in `min_hasse_diagram`?

A `TraceMonoid` is not a `FreeMonoid`, so I do not think it should inherit from `FreeMonoid`. Also, can you justify why we should add this instead of expanding the right-angled Artin group code? I understand this is to be the monoid version of that, but I still expend a lot of commonomalities.

`_repr_` and `_latex_` do not have any docstrings/doctests.



---

archive/issue_comments_389727.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n\nThanks, I'll fix the issues.\n\nSorry, I don't have much expertise in abstract algebra and Sage, but I'll try to look at the right-angled Artin group and adapt the `TraceMonoid` to it if I can.\n\nWell, yeah, theoretically, trace monoid is a factor set of some other monoid over an independence relation. Somehow I tricked myself to think that if it is so related to a free monoid, so it means it should inherit from it. I definitely need to fix this.",
    "created_at": "2019-05-28T17:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389727",
    "user": "https://github.com/PaulRaUnite"
}
```

Replying to [comment:7 tscrim]:

Thanks, I'll fix the issues.

Sorry, I don't have much expertise in abstract algebra and Sage, but I'll try to look at the right-angled Artin group and adapt the `TraceMonoid` to it if I can.

Well, yeah, theoretically, trace monoid is a factor set of some other monoid over an independence relation. Somehow I tricked myself to think that if it is so related to a free monoid, so it means it should inherit from it. I definitely need to fix this.



---

archive/issue_comments_389728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-29T21:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389729.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-29T22:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389730.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-30T21:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389731.json:
```json
{
    "body": "A right-angled Artin group is also known as a partially commutative free group or graph group as the free (or commuting) variables can be described by a (simple) graph. Indeed, it is a free group whose presentation is of the form\n\n```\n< a1,...,an | [ai,aj] such that (i,j) \\notin E(G) >\n```\n\nfor some simple graph `G` (of course, you can equivalently take `(i,j) \\in E(G)`). Subsequently, the monoid version I believe is the trace monoid you describe here. Is that correct?",
    "created_at": "2019-05-31T00:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389731",
    "user": "https://github.com/tscrim"
}
```

A right-angled Artin group is also known as a partially commutative free group or graph group as the free (or commuting) variables can be described by a (simple) graph. Indeed, it is a free group whose presentation is of the form

```
< a1,...,an | [ai,aj] such that (i,j) \notin E(G) >
```

for some simple graph `G` (of course, you can equivalently take `(i,j) \in E(G)`). Subsequently, the monoid version I believe is the trace monoid you describe here. Is that correct?



---

archive/issue_comments_389732.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n\nYes, it is.",
    "created_at": "2019-05-31T16:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389732",
    "user": "https://github.com/PaulRaUnite"
}
```

Replying to [comment:12 tscrim]:

Yes, it is.



---

archive/issue_comments_389733.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-01T12:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389733",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389734.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389734",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_389735.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389735",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_389736.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389736",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_389737.json:
```json
{
    "body": "I have fixed a few things.\n----\nNew commits:",
    "created_at": "2020-05-16T09:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389737",
    "user": "https://github.com/fchapoton"
}
```

I have fixed a few things.
----
New commits:



---

archive/issue_comments_389738.json:
```json
{
    "body": "I skimmed over this again, and I realized that this is quite a different structure than the group version. I hope to take a very detailed look at this again shortly as it would be a nice addition to Sage, and I have let it linger for far too long, to which my apologies to Pavlo.",
    "created_at": "2020-05-17T11:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389738",
    "user": "https://github.com/tscrim"
}
```

I skimmed over this again, and I realized that this is quite a different structure than the group version. I hope to take a very detailed look at this again shortly as it would be a nice addition to Sage, and I have let it linger for far too long, to which my apologies to Pavlo.



---

archive/issue_comments_389739.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-29T08:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389739",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389740.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-05-29T08:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389740",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_389741.json:
```json
{
    "body": "Sorry for taking so long to get to this Pavlo. I have made my way though the entire code, which is quite nice, and did a bit of mild refactoring and additional cleanup.",
    "created_at": "2020-05-29T08:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389741",
    "user": "https://github.com/tscrim"
}
```

Sorry for taking so long to get to this Pavlo. I have made my way though the entire code, which is quite nice, and did a bit of mild refactoring and additional cleanup.



---

archive/issue_comments_389742.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-07T13:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389743.json:
```json
{
    "body": "full green bot. Maybe it's time to give a positive review ?",
    "created_at": "2020-07-07T17:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389743",
    "user": "https://github.com/fchapoton"
}
```

full green bot. Maybe it's time to give a positive review ?



---

archive/issue_comments_389744.json:
```json
{
    "body": "Your changes LGTM Fr\u00e9d\u00e9ric. If mine are also good, then positive review.",
    "created_at": "2020-07-07T23:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389744",
    "user": "https://github.com/tscrim"
}
```

Your changes LGTM Frédéric. If mine are also good, then positive review.



---

archive/issue_comments_389745.json:
```json
{
    "body": "ok, let it be.\n\nMaybe we should say somewhere that getting code into sage requires some long-time perseverance.",
    "created_at": "2020-07-08T06:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389745",
    "user": "https://github.com/fchapoton"
}
```

ok, let it be.

Maybe we should say somewhere that getting code into sage requires some long-time perseverance.



---

archive/issue_comments_389746.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-08T06:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389746",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_025642.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-10T19:34:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27637#event-25642"
}
```



---

archive/issue_comments_389747.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-10T19:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27637#issuecomment-389747",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
