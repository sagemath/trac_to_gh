# Issue 27637: Trace monoid support

Issue created by migration from https://trac.sagemath.org/ticket/27874

Original creator: @PaulRaUnite

Original creation time: 2019-05-26 12:54:02




---

Comment by @PaulRaUnite created at 2019-05-26 12:56:36

Changing keywords from "" to "monoid".


---

Comment by @PaulRaUnite created at 2019-05-26 12:56:36

Changing component from PLEASE CHANGE to algebra.


---

Comment by @PaulRaUnite created at 2019-05-26 12:56:36

Set assignee to @PaulRaUnite.


---

Comment by @PaulRaUnite created at 2019-05-26 12:56:36

Changing type from PLEASE CHANGE to task.


---

Comment by @PaulRaUnite created at 2019-05-26 22:14:53

Changing status from new to needs_review.


---

Comment by @PaulRaUnite created at 2019-05-26 22:14:53

New commits:


---

Comment by tscrim created at 2019-05-27 00:10:42

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2019-05-27 00:10:42

This is a good first step and implementation. However, there are a number of issues that need to be addressed:

- A number of your docstrings are malformatted:
  * After each `::` should be a blank line.
  * You documentation is over-indented in placed (e.g., `_dependence_stack`)
  * `b != a` -> ``b \neq a``
  * Not correctly aligned and soem other small tweaks
    {{{#!diff
-        - ``alg`` -- string (default: `naive`); defines algorithm that will be used
-            to compute Hasse diagram; there are two variants: `naive` and `min`.
+        - ``alg`` -- string (default: ``'naive'``); defines algorithm that will be used
+          to compute Hasse diagram; there are two variants: ``'naive'`` and ``'min'``
    }}}
    (similar change in `projection`)
- `independence` should just be a ``@`cached_method` (this is a general convention in Sage).
- I think `foata_normal_form` should output a tuple (this is what `left_normal_form` does for the braid group). Another option might be to output a `Factorization` object.
- All methods need doctests. A good one for an `__init__` method is to do `TestSuite(foo).run()`, where `foo` is an instance of the class.
- I strongly disagree with expanding the syntactic sugar for the input, at least here. It is far too specialized and quite possible to break. This could be a good idea, but it is definitely something that needs to be brought to sage-devel for discussion.

You might also be interested in the right-angled Artin group class and instead build upon that.


---

Comment by git created at 2019-05-27 23:18:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @PaulRaUnite created at 2019-05-27 23:21:26

Replying to [comment:4 tscrim]:

Thank you for such a fast review.

You're right about syntax sugar, it doesn't worth to add it only for one case, so I've deleted it. If someone will really need it, someone will create a ticket.

Fixed all the problems you spotted, I hope.


---

Comment by tscrim created at 2019-05-28 13:34:19

Thank you. It is looking much better. Here are some additional comments:

Anytime you have normal text after `EXAMPLES::`, it should be `EXAMPLES:`, e.g.,

```diff
-EXAMPLES::
+EXAMPLES:
 
 The following example demonstrates a monoid creation ::
```

You will also want to remove the space before the `::` so Sphinx adds the colon `:` to the end of the output sentence.

`AUTHORS::` -> `AUTHORS:` (it is not a special block nor is their code after it)

Please use the standard copyright header in Sage (see, e.g., `algebras/weyl_algebra.py`)


```diff
-        EXAMPLES::
+        EXAMPLES:
 
-            Get the normal form ::
+        Get the normal form::
```


Change the name of `lexic_norm_form` to either the standard shortening `lex_normal_form` or fully spelled out `lexicographic_normal_form` (note the fully spelled out `normal` too).
I am also not sure I like the `while True:` loop in there as there seems to be more standard ways to write that logic (where the main condition is the `while`-loop condition.

Similar for `foata_norm_form`.

This seem complicated:

```
        repeated_el_iter = (repeat(e, times) for e, times in self._element_list)
        return list(chain.from_iterable(repeated_el_iter))
```

Can you just do it using a list comprehension? (e.g., `[foo(bar) for bar in B]`)

Why do you need the `next_front` map in `min_hasse_diagram`?

A `TraceMonoid` is not a `FreeMonoid`, so I do not think it should inherit from `FreeMonoid`. Also, can you justify why we should add this instead of expanding the right-angled Artin group code? I understand this is to be the monoid version of that, but I still expend a lot of commonomalities.

`_repr_` and `_latex_` do not have any docstrings/doctests.


---

Comment by @PaulRaUnite created at 2019-05-28 17:54:17

Replying to [comment:7 tscrim]:

Thanks, I'll fix the issues.

Sorry, I don't have much expertise in abstract algebra and Sage, but I'll try to look at the right-angled Artin group and adapt the `TraceMonoid` to it if I can.

Well, yeah, theoretically, trace monoid is a factor set of some other monoid over an independence relation. Somehow I tricked myself to think that if it is so related to a free monoid, so it means it should inherit from it. I definitely need to fix this.


---

Comment by git created at 2019-05-29 21:06:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-29 22:44:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-30 21:23:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-05-31 00:21:29

A right-angled Artin group is also known as a partially commutative free group or graph group as the free (or commuting) variables can be described by a (simple) graph. Indeed, it is a free group whose presentation is of the form

```
< a1,...,an | [ai,aj] such that (i,j) \notin E(G) >
```

for some simple graph `G` (of course, you can equivalently take `(i,j) \in E(G)`). Subsequently, the monoid version I believe is the trace monoid you describe here. Is that correct?


---

Comment by @PaulRaUnite created at 2019-05-31 16:43:51

Replying to [comment:12 tscrim]:

Yes, it is.


---

Comment by git created at 2019-06-01 12:25:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by chapoton created at 2020-05-16 09:40:18

I have fixed a few things.
----
New commits:


---

Comment by tscrim created at 2020-05-17 11:12:37

I skimmed over this again, and I realized that this is quite a different structure than the group version. I hope to take a very detailed look at this again shortly as it would be a nice addition to Sage, and I have let it linger for far too long, to which my apologies to Pavlo.


---

Comment by git created at 2020-05-29 08:01:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-05-29 08:03:30

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2020-05-29 08:03:30

Sorry for taking so long to get to this Pavlo. I have made my way though the entire code, which is quite nice, and did a bit of mild refactoring and additional cleanup.


---

Comment by git created at 2020-07-07 13:08:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-07-07 17:21:52

full green bot. Maybe it's time to give a positive review ?


---

Comment by tscrim created at 2020-07-07 23:32:44

Your changes LGTM Frédéric. If mine are also good, then positive review.


---

Comment by chapoton created at 2020-07-08 06:24:08

ok, let it be.

Maybe we should say somewhere that getting code into sage requires some long-time perseverance.


---

Comment by chapoton created at 2020-07-08 06:24:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-07-10 19:34:30

Resolution: fixed
