# Issue 26985: Proper powering in CDF

Issue created by migration from https://trac.sagemath.org/ticket/27222

Original creator: jdemeyer

Original creation time: 2019-02-05 08:39:16

Fix the Cython warning

```

```



---

Comment by git created at 2019-02-05 09:10:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-02-05 09:47:40

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-02-05 13:48:12

Patchbot reports some failures:

```
sage -t --long src/sage/symbolic/random_tests.py  # 1 doctest failed
sage -t --long src/sage/modular/modform/numerical.py  # 6 doctests failed
```



---

Comment by jdemeyer created at 2019-02-05 13:53:32

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2019-02-05 14:06:57

There is a strange regression: `CDF(-0.26319743704743886) ** -1` now returns a non-real number `-3.799429094819641 - 4.652958679558198e-16*I`. The old code didn't seem to do that.


---

Comment by jdemeyer created at 2019-02-05 14:08:58

GSL seems to special-case powering by a _complex_ -1 but not by a _real_ -1.


---

Comment by git created at 2019-02-05 14:29:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-02-05 14:30:16

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-02-05 14:30:16

I added a few special cases for powering to an integer.


---

Comment by tscrim created at 2019-02-05 15:05:26

I agree with the change. Let us wait for a patchbot report.


---

Comment by tscrim created at 2019-02-06 05:42:24

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2019-02-06 05:42:24

Failures again reported by the patchbot:

```
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/modular/abvar/torsion_subgroup.py  # 1 doctest failed
sage -t --long src/sage/tests/french_book/mpoly.py  # 1 doctest failed
```

although the `torsion_subgroup.py` is almost certainly unrelated.


---

Comment by jdemeyer created at 2019-02-06 08:49:07

Replying to [comment:12 tscrim]:
> the `torsion_subgroup.py` is almost certainly unrelated.

See #27224 for that.

The french book doctest will need to wait for #23572 (let's hope that it will finally get merged now).


---

Comment by git created at 2019-02-06 09:07:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-02-07 00:08:25

So #23572 is going to be a dependency of this? I am guessing you want to wait until that is merged before proceeding.


---

Comment by jdemeyer created at 2019-02-07 08:22:21

Replying to [comment:15 tscrim]:
> I am guessing you want to wait until that is merged before proceeding.

Indeed. Let's hope that the next beta will have it.


---

Comment by git created at 2019-02-07 21:10:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-02-07 21:11:44

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-02-07 21:11:44

This just fixes the doctest from `french_book`. If #23572 gets merged, I'll rebase it then.


---

Comment by tscrim created at 2019-02-07 21:14:46

Feel free to flip this to positive review if you think #23572 will take time. Although from what Volker wrote on #23572, it seems like that is easy to fix. Anyways, up to you on the order.


---

Comment by jdemeyer created at 2019-02-07 21:21:28

Replying to [comment:21 tscrim]:
> Feel free to flip this to positive review if you think #23572 will take time.

I don't know whether it will take time. if this happens to be merged before #23572, fine. If it doesn't, also fine.


---

Comment by jdemeyer created at 2019-02-07 21:22:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-02-08 23:21:40

Resolution: fixed


---

Comment by vbraun created at 2019-02-08 23:27:38

Changing status from closed to new.


---

Comment by vbraun created at 2019-02-08 23:27:38

Resolution changed from fixed to 


---

Comment by vbraun created at 2019-02-08 23:28:25

This conflicts with #23572, per your request I'm giving that one priority


---

Comment by jdemeyer created at 2019-02-11 21:11:17

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2019-02-12 09:08:58

I merged #23572 and tests still pass on the patchbot.


---

Comment by jdemeyer created at 2019-02-12 09:08:58

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-02-12 16:55:03

I am confirming this is good.


---

Comment by vbraun created at 2019-02-13 20:58:53

Merge conflict...


---

Comment by vbraun created at 2019-02-13 20:58:53

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-02-16 23:06:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-02-16 23:09:23

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-02-16 23:14:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2019-02-17 00:37:28

Sorry, one other test I just thought of. Can you add a doctest showing the behavior of something that masquerades as an element of `ZZ`, such as `4/2`? Once added and a green patchbot, you can set a positive review.


---

Comment by git created at 2019-02-19 11:16:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2019-02-19 12:29:02

Replying to [comment:36 tscrim]:
> Sorry, one other test I just thought of. Can you add a doctest showing the behavior of something that masquerades as an element of `ZZ`, such as `4/2`?

I did that. As expected, this is showing a worse result than using `ZZ(2)` as exponent since powering by `QQ` uses the coercion model to actually do a powering by `CDF`.


---

Comment by tscrim created at 2019-02-20 06:51:18

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-02-20 06:51:18

Thank you.


---

Comment by vbraun created at 2019-02-23 23:14:41

Resolution: fixed
