# Issue 20305: Allow choosing between ATLAS and OpenBLAS

Issue created by migration from https://trac.sagemath.org/ticket/20542

Original creator: jdemeyer

Original creation time: 2016-05-03 11:37:54

CC:  embray fbissey

Add a `./configure` option `--with-blas` to choose between ATLAS and OpenBLAS.

Installing both is not supported.


---

Comment by git created at 2016-05-03 12:58:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-05-03 15:43:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-05-03 15:43:48

Changing status from new to needs_review.


---

Comment by fbissey created at 2016-05-03 21:15:00

The mechanics looks alright but I want to have a few hours to digest it. Since we are not changing the current spkg, things are not as informative as they could be. How do you know from `configure --help` that
 1) --with-blas=atlas (or nothing) allows you to use a system ATLAS via an environment variable.
 2) that the same option will give use the accelerate framework on OS X by default (there is a way to force ATLAS build but that's a real expert case).

The first one may qualify as an expert use case where we don't want to make the suggestion in configuration's help message. I think the second one should deserve a mention, one way or another.


---

Comment by jdemeyer created at 2016-05-04 08:59:15

Replying to [comment:6 fbissey]:
> How do you know from `configure --help` that
>  1) --with-blas=atlas (or nothing) allows you to use a system ATLAS via an environment variable.
>  2) that the same option will give use the accelerate framework on OS X by default (there is a way to force ATLAS build but that's a real expert case).

Well, the ATLAS options are documented in http://doc.sagemath.org/html/en/installation/source.html#environment-variables

I agree that it's not very clear, but I was hoping that this ticket could be reviewed anyway with further work for a follow-up ticket.

Ideally we should move some of the configuration logic of the ATLAS spkg either to a generic BLAS meta-package or the top-level `configure` script. I haven't completely thought out the details of this, but I don't see much point in documenting something which I plan to change soon anyway.


---

Comment by jdemeyer created at 2016-05-04 09:07:38

Also: as long as the default remains ATLAS, old configurations using `SAGE_ATLAS...` environment variables will continue to work.


---

Comment by fbissey created at 2016-05-04 09:10:38

OK, deal. Sending to the bots.


---

Comment by fbissey created at 2016-05-04 09:10:38

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-05-04 09:21:28

Replying to [comment:9 fbissey]:
> OK, deal. Sending to the bots.

Well, the bots won't test OpenBLAS, so I don't expect problems.


---

Comment by vbraun created at 2016-05-05 09:27:04

Resolution: fixed


---

Comment by embray created at 2016-05-06 11:47:46

> Ideally we should move some of the configuration logic of the ATLAS spkg either to a generic BLAS meta-package or the top-level configure script.

This is partly why I suggested the former, earlier.  But I agree further work could be in a follow-up.  This is a good move in the right direction.


---

Comment by dimpase created at 2016-11-04 10:40:35

With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!

Besides, `with-blas` is misleading. Surely, in both bases [BLAS](https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms) is used, just different ones...


---

Comment by embray created at 2016-11-07 13:46:39

Replying to [comment:13 dimpase]:
> With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!

No, but I would expect them to read `./configure --help`.  If the help docs are broken then yeah I agree.


---

Comment by dimpase created at 2016-11-07 17:59:42

Replying to [comment:14 embray]:
> Replying to [comment:13 dimpase]:
> > With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!
> 
> No, but I would expect them to read `./configure --help`.  If the help docs are broken then yeah I agree.

`./configure` ?

`./configure` is not mentioned in the official manual.
cf http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure

or your locally built manual for the latest 7.5.beta


---

Comment by embray created at 2016-11-08 11:15:29

Well obviously it should be.
