# Issue 19936: Error executing code in Mathematica

archive/issues_019936.json:
```json
{
    "body": "CC:  @mkoeppe @dimpase @miguelmarco @vbraun\n\nKeywords: mathematica\n\nI got `TypeError` when running the same code repeatedly on OSX 10.10.4.\nEach time it stops at a different value of i and returns a different error message.\n\n```\nm = Mathematica(logfile='mathematica-log')\nfor i in range(30000):\n    print i\n    condstr = '{x + 5*y - 1<0, x - y<0, 0<-2*x - 5*y + 1<1/100}'\n    varstr = '{x, y}'\n    pt = m.FindInstance(condstr, varstr)\n    pt_val = (pt[1][1][2], pt[1][2][2])\n```\nUsually the error appears before i=2000, and the error message is most often of the type\n\n```\nTypeError: Error executing code in Mathematica\nCODE:\n\tsage3=sage0[[2]];\nMathematica ERROR:\n\tsage3=sage0[[2]];\n```\nIs it caused by the same issue as in  #20128? Any workaround?\n\nI'm also curious about the following piece of code in `Mathematica::set` (see Line 514 of mathematica.py)\n\n```\nif len(out) > 8:\n    raise TypeError(\"Error executing code in Mathematica\\nCODE:\\n\\t%s\\nMathematica ERROR:\\n\\t%s\"%(cmd, out))\n```\nWhat does the constant 8 mean here?\nNote that the error persists when I augment the number 8 to 4000.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20173\n\n",
    "created_at": "2016-03-07T01:30:48Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Error executing code in Mathematica",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19936",
    "user": "https://github.com/yuan-zhou"
}
```
CC:  @mkoeppe @dimpase @miguelmarco @vbraun

Keywords: mathematica

I got `TypeError` when running the same code repeatedly on OSX 10.10.4.
Each time it stops at a different value of i and returns a different error message.

```
m = Mathematica(logfile='mathematica-log')
for i in range(30000):
    print i
    condstr = '{x + 5*y - 1<0, x - y<0, 0<-2*x - 5*y + 1<1/100}'
    varstr = '{x, y}'
    pt = m.FindInstance(condstr, varstr)
    pt_val = (pt[1][1][2], pt[1][2][2])
```
Usually the error appears before i=2000, and the error message is most often of the type

```
TypeError: Error executing code in Mathematica
CODE:
	sage3=sage0[[2]];
Mathematica ERROR:
	sage3=sage0[[2]];
```
Is it caused by the same issue as in  #20128? Any workaround?

I'm also curious about the following piece of code in `Mathematica::set` (see Line 514 of mathematica.py)

```
if len(out) > 8:
    raise TypeError("Error executing code in Mathematica\nCODE:\n\t%s\nMathematica ERROR:\n\t%s"%(cmd, out))
```
What does the constant 8 mean here?
Note that the error persists when I augment the number 8 to 4000.

Issue created by migration from https://trac.sagemath.org/ticket/20173





---

archive/issue_comments_274053.json:
```json
{
    "body": "I was able to reproduce this error (same Mathematica version 10.3.1.0, also on OS X.)\n\nThis error is caused by sporadic double echoing, which confuses the pexpect code. This can be seen at the end of the logfile generated by the above testcase.\nI'm not sure where the double echoing comes from. Perhaps some strangeness of Mac OS ptys, perhaps a race condition, perhaps math-readline is doing something wrong, perhaps a Mathematica bug. \n\nA workaround is to disable echoing:\n\n```\ndiff --git a/src/bin/math-readline b/src/bin/math-readline\nindex 5a13906..72e3795 100755\n--- a/src/bin/math-readline\n+++ b/src/bin/math-readline\n@@ -9,6 +9,9 @@ import sys, signal, subprocess\n import readline\n from six.moves import input\n \n+import os\n+os.system(\"stty -echo\")\n+\n def child_exited(*args):\n     global child\n     status = child.poll()\n```",
    "created_at": "2016-03-07T04:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274053",
    "user": "https://github.com/mkoeppe"
}
```

I was able to reproduce this error (same Mathematica version 10.3.1.0, also on OS X.)

This error is caused by sporadic double echoing, which confuses the pexpect code. This can be seen at the end of the logfile generated by the above testcase.
I'm not sure where the double echoing comes from. Perhaps some strangeness of Mac OS ptys, perhaps a race condition, perhaps math-readline is doing something wrong, perhaps a Mathematica bug. 

A workaround is to disable echoing:

```
diff --git a/src/bin/math-readline b/src/bin/math-readline
index 5a13906..72e3795 100755
--- a/src/bin/math-readline
+++ b/src/bin/math-readline
@@ -9,6 +9,9 @@ import sys, signal, subprocess
 import readline
 from six.moves import input
 
+import os
+os.system("stty -echo")
+
 def child_exited(*args):
     global child
     status = child.poll()
```



---

archive/issue_comments_274054.json:
```json
{
    "body": "I don't have access to Mathematica on machines I have Sage on, so I can't test this easily. If this echo disabling does not affect the UI in any way, why don't we put this workaround in Sage? \n\n(To me `stty -echo` is what one does to hide what's entered on the keyboard, but here it's not relevant?)",
    "created_at": "2016-03-07T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274054",
    "user": "https://github.com/dimpase"
}
```

I don't have access to Mathematica on machines I have Sage on, so I can't test this easily. If this echo disabling does not affect the UI in any way, why don't we put this workaround in Sage? 

(To me `stty -echo` is what one does to hide what's entered on the keyboard, but here it's not relevant?)



---

archive/issue_comments_274055.json:
```json
{
    "body": "Replying to [comment:2 dimpase]:\n> I don't have access to Mathematica on machines I have Sage on, so I can't test this easily. If this echo disabling does not affect the UI in any way, why don't we put this workaround in Sage? \n> \n> (To me `stty -echo` is what one does to hide what's entered on the keyboard, but here it's not relevant?)\n\n\nThis `stty -echo` affects the pseudo-terminal that Sage uses to communicate with Mathematica. It does not affect the Sage UI.\n\nI have not tested whether this workaround has any negative effect on running Sage via SSH on a remote host.",
    "created_at": "2016-03-07T18:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274055",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:2 dimpase]:
> I don't have access to Mathematica on machines I have Sage on, so I can't test this easily. If this echo disabling does not affect the UI in any way, why don't we put this workaround in Sage? 
> 
> (To me `stty -echo` is what one does to hide what's entered on the keyboard, but here it's not relevant?)


This `stty -echo` affects the pseudo-terminal that Sage uses to communicate with Mathematica. It does not affect the Sage UI.

I have not tested whether this workaround has any negative effect on running Sage via SSH on a remote host.



---

archive/issue_comments_274056.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-03-07T18:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274056",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_274057.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-07T18:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274057",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_274058.json:
```json
{
    "body": "Expect has a `terminal_echo=False` constructor argument, this is presumably equivalent and the right way to do it. See e.g. `sage.interfaces.singular.Singular.__init__`\n\nThe terminal echo has bitten us before, really all expect interfaces should run with `terminal_echo=False` as the echo is inherently and unfixably racy. But various interfaces have been built around the assumption of terminal echo and are hard to fix.",
    "created_at": "2016-03-07T19:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274058",
    "user": "https://github.com/vbraun"
}
```

Expect has a `terminal_echo=False` constructor argument, this is presumably equivalent and the right way to do it. See e.g. `sage.interfaces.singular.Singular.__init__`

The terminal echo has bitten us before, really all expect interfaces should run with `terminal_echo=False` as the echo is inherently and unfixably racy. But various interfaces have been built around the assumption of terminal echo and are hard to fix.



---

archive/issue_comments_274059.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> Expect has a `terminal_echo=False` constructor argument, this is presumably equivalent and the right way to do it. See e.g. `sage.interfaces.singular.Singular.__init__`\n\n\nThat's what I tried first, but it didn't fix the problem.",
    "created_at": "2016-03-07T19:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274059",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:6 vbraun]:
> Expect has a `terminal_echo=False` constructor argument, this is presumably equivalent and the right way to do it. See e.g. `sage.interfaces.singular.Singular.__init__`


That's what I tried first, but it didn't fix the problem.



---

archive/issue_comments_274060.json:
```json
{
    "body": "I just checked this with Mathematica 9.0 on Linux 64-bit, the test works.\n\nI noticed that most doctests fail: I run\n\n```\nsage -btp --optional=database_gap,gap_packages,python2,sage,mathematica src/sage/interfaces/mathematica.py \n```\nand get a lot of formatting errors - the output is TeX-like rather than text-like, e.g.\n\n```\nFile \"src/sage/interfaces/mathematica.py\", line 322, in sage.interfaces.mathematica\nFailed example:\n    mlist = mathematica(slist); mlist     # optional - mathematica\nExpected:\n    {{1, 2}, 3., 4 + I}\nGot:\n    \\{\\{1,2\\},3.,4+i\\}\n**********************************************************************\nFile \"src/sage/interfaces/mathematica.py\", line 326, in sage.interfaces.mathematica\nFailed example:\n    slist2[0]                             # optional - mathematica\nExpected:\n    {1, 2}\nGot:\n    \\{1,2\\}\n**********************************************************************\nFile \"src/sage/interfaces/mathematica.py\", line 335, in sage.interfaces.mathematica\nFailed example:\n    mathematica('10.^80')     # optional - mathematica\nExpected:\n    1.*^80\nGot:\n    1.\\times 10^{80}\n**********************************************************************\nFile \"src/sage/interfaces/mathematica.py\", line 576, in sage.interfaces.mathematica.Mathematica.chdir\nFailed example:\n    mathematica('Directory[]')      # optional - mathematica\nExpected:\n    \"/\"\nGot:\n    /\n```\n\nshould these get fixed?",
    "created_at": "2016-03-07T20:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274060",
    "user": "https://github.com/dimpase"
}
```

I just checked this with Mathematica 9.0 on Linux 64-bit, the test works.

I noticed that most doctests fail: I run

```
sage -btp --optional=database_gap,gap_packages,python2,sage,mathematica src/sage/interfaces/mathematica.py 
```
and get a lot of formatting errors - the output is TeX-like rather than text-like, e.g.

```
File "src/sage/interfaces/mathematica.py", line 322, in sage.interfaces.mathematica
Failed example:
    mlist = mathematica(slist); mlist     # optional - mathematica
Expected:
    {{1, 2}, 3., 4 + I}
Got:
    \{\{1,2\},3.,4+i\}
**********************************************************************
File "src/sage/interfaces/mathematica.py", line 326, in sage.interfaces.mathematica
Failed example:
    slist2[0]                             # optional - mathematica
Expected:
    {1, 2}
Got:
    \{1,2\}
**********************************************************************
File "src/sage/interfaces/mathematica.py", line 335, in sage.interfaces.mathematica
Failed example:
    mathematica('10.^80')     # optional - mathematica
Expected:
    1.*^80
Got:
    1.\times 10^{80}
**********************************************************************
File "src/sage/interfaces/mathematica.py", line 576, in sage.interfaces.mathematica.Mathematica.chdir
Failed example:
    mathematica('Directory[]')      # optional - mathematica
Expected:
    "/"
Got:
    /
```

should these get fixed?



---

archive/issue_comments_274061.json:
```json
{
    "body": "It is quite likely that this is specific to both the Mathematica version and the OS.\n\nFor example, the beginning of `math-readline` script says:\n\n```\n# Cleverly run Mathematica with the benefit of readline, which\n# is something the usual commercial mathematica doesn't provide!\n```\n\nBut at least Mathematica 10.3.1 does provide command-line editing (though not the full range of readline's keybindings).",
    "created_at": "2016-03-07T20:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274061",
    "user": "https://github.com/mkoeppe"
}
```

It is quite likely that this is specific to both the Mathematica version and the OS.

For example, the beginning of `math-readline` script says:

```
# Cleverly run Mathematica with the benefit of readline, which
# is something the usual commercial mathematica doesn't provide!
```

But at least Mathematica 10.3.1 does provide command-line editing (though not the full range of readline's keybindings).



---

archive/issue_comments_274062.json:
```json
{
    "body": "I think a lot of tests are outdated; e.g. the precision in N() operator should be what Mathematica does now, that is the total number of digits rather than the number of\ndigits after '.'\n\nI do get command-line editing on my terminal version, too.",
    "created_at": "2016-03-07T20:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274062",
    "user": "https://github.com/dimpase"
}
```

I think a lot of tests are outdated; e.g. the precision in N() operator should be what Mathematica does now, that is the total number of digits rather than the number of
digits after '.'

I do get command-line editing on my terminal version, too.



---

archive/issue_comments_274063.json:
```json
{
    "body": "I wonder if there is a magic switch to switch to the form of output used in tests; don't know what it is exactly -- FortranForm?",
    "created_at": "2016-03-07T20:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274063",
    "user": "https://github.com/dimpase"
}
```

I wonder if there is a magic switch to switch to the form of output used in tests; don't know what it is exactly -- FortranForm?



---

archive/issue_comments_274064.json:
```json
{
    "body": "I think the failing Mathematica doctests should go on another ticket.\nThis ticket needs review...",
    "created_at": "2016-03-08T17:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274064",
    "user": "https://github.com/mkoeppe"
}
```

I think the failing Mathematica doctests should go on another ticket.
This ticket needs review...



---

archive/issue_comments_274065.json:
```json
{
    "body": "looks good to me",
    "created_at": "2016-03-08T17:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274065",
    "user": "https://github.com/dimpase"
}
```

looks good to me



---

archive/issue_comments_274066.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-08T17:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274066",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054827.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-09T08:29:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19936#event-54827"
}
```



---

archive/issue_comments_274067.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-09T08:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274067",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_274068.json:
```json
{
    "body": "Replying to [comment:12 mkoeppe]:\n> I think the failing Mathematica doctests should go on another ticket.\n\n\nSee #18888.\n\nOne problem is that the version of Mathematica may change from one user to the other...",
    "created_at": "2016-03-11T21:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274068",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:12 mkoeppe]:
> I think the failing Mathematica doctests should go on another ticket.


See #18888.

One problem is that the version of Mathematica may change from one user to the other...



---

archive/issue_comments_274069.json:
```json
{
    "body": "Replying to [comment:15 slabbe]:\n> Replying to [comment:12 mkoeppe]:\n> > I think the failing Mathematica doctests should go on another ticket.\n\n> \n> See #18888.\n\n\nthanks. I completely forgot about it :-)\n\n> \n> One problem is that the version of Mathematica may change from one user to the other...\n\n\nno, if you read info on #18888 you will see it has not much to do with versions, it is a change in behaviour.",
    "created_at": "2016-03-11T21:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274069",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:15 slabbe]:
> Replying to [comment:12 mkoeppe]:
> > I think the failing Mathematica doctests should go on another ticket.

> 
> See #18888.


thanks. I completely forgot about it :-)

> 
> One problem is that the version of Mathematica may change from one user to the other...


no, if you read info on #18888 you will see it has not much to do with versions, it is a change in behaviour.



---

archive/issue_comments_274070.json:
```json
{
    "body": "Replying to [comment:16 dimpase]:\n> Replying to [comment:15 slabbe]:\n> > Replying to [comment:12 mkoeppe]:\n> > > I think the failing Mathematica doctests should go on another ticket.\n\n> > \n> > See #18888.\n\n> \n> thanks. I completely forgot about it :-)\n> \n> > \n> > One problem is that the version of Mathematica may change from one user to the other...\n\n> \n> no, if you read info on #18888 you will see it has not much to do with versions, it is a change in behaviour.\n\n\ncaused by Volker's commit 7747261d (`$ git show 7747261d` will show it). \nI suspect the reason was to have a better output in a notebook (sagenb or jupyther or whatever).\n\nI have no clue how to fix this.",
    "created_at": "2016-03-11T21:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274070",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:16 dimpase]:
> Replying to [comment:15 slabbe]:
> > Replying to [comment:12 mkoeppe]:
> > > I think the failing Mathematica doctests should go on another ticket.

> > 
> > See #18888.

> 
> thanks. I completely forgot about it :-)
> 
> > 
> > One problem is that the version of Mathematica may change from one user to the other...

> 
> no, if you read info on #18888 you will see it has not much to do with versions, it is a change in behaviour.


caused by Volker's commit 7747261d (`$ git show 7747261d` will show it). 
I suspect the reason was to have a better output in a notebook (sagenb or jupyther or whatever).

I have no clue how to fix this.



---

archive/issue_comments_274071.json:
```json
{
    "body": "#18888 is now updated and ready for review.",
    "created_at": "2016-03-12T13:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274071",
    "user": "https://github.com/dimpase"
}
```

#18888 is now updated and ready for review.



---

archive/issue_comments_274072.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> This `stty -echo` affects the pseudo-terminal that Sage uses to communicate with Mathematica. It does not affect the Sage UI.\n\n\nI disagree with this statement, in fact it should be precisely the opposite: I don't think that the `pexpect` interface needs readline, so why would it run `math-readline` instead of the plain Mathematica (i.e. `math`) directly?\n\nThis is at least partially responsible for the breakage reported on #23112.",
    "created_at": "2017-06-01T09:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274072",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 mkoeppe]:
> This `stty -echo` affects the pseudo-terminal that Sage uses to communicate with Mathematica. It does not affect the Sage UI.


I disagree with this statement, in fact it should be precisely the opposite: I don't think that the `pexpect` interface needs readline, so why would it run `math-readline` instead of the plain Mathematica (i.e. `math`) directly?

This is at least partially responsible for the breakage reported on #23112.



---

archive/issue_comments_274073.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Replying to [comment:3 mkoeppe]:\n> > This `stty -echo` affects the pseudo-terminal that Sage uses to communicate with Mathematica. It does not affect the Sage UI.\n\n> \n> I disagree with this statement, in fact it should be precisely the opposite: I don't think that the `pexpect` interface needs readline, so why would it run `math-readline` instead of the plain Mathematica (i.e. `math`) directly?\n> \n> This is at least partially responsible for the breakage reported on #23112.\n\n\nThe statement that you quoted is correct as stated.\n\nRather, what went wrong on this ticket is: It was overlooked that this script `math-readline` is intended to be a user script, rather than just one that is used internally by the pexpect interface. (The script is not mentioned in a manual.)\n\nAlso, note that current versions of mathematica (like \"Mathematica 11.0.1 for Mac OS X x86\") do provide a readline-like interface, so `math-readline` is not needed; so certainly the description of `math-readline` is outdated.\n\nWe can fix the script on #23112 (for the benefit of users of ancient versions of mathematica??), but please not by breaking the mathematica pexpect interface.",
    "created_at": "2017-06-02T18:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274073",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:19 jdemeyer]:
> Replying to [comment:3 mkoeppe]:
> > This `stty -echo` affects the pseudo-terminal that Sage uses to communicate with Mathematica. It does not affect the Sage UI.

> 
> I disagree with this statement, in fact it should be precisely the opposite: I don't think that the `pexpect` interface needs readline, so why would it run `math-readline` instead of the plain Mathematica (i.e. `math`) directly?
> 
> This is at least partially responsible for the breakage reported on #23112.


The statement that you quoted is correct as stated.

Rather, what went wrong on this ticket is: It was overlooked that this script `math-readline` is intended to be a user script, rather than just one that is used internally by the pexpect interface. (The script is not mentioned in a manual.)

Also, note that current versions of mathematica (like "Mathematica 11.0.1 for Mac OS X x86") do provide a readline-like interface, so `math-readline` is not needed; so certainly the description of `math-readline` is outdated.

We can fix the script on #23112 (for the benefit of users of ancient versions of mathematica??), but please not by breaking the mathematica pexpect interface.



---

archive/issue_comments_274074.json:
```json
{
    "body": "Upon further investigation, this ticket did break echoing in `mathematica_console()`. So something needs fixing (in #23112).",
    "created_at": "2017-06-04T05:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274074",
    "user": "https://github.com/mkoeppe"
}
```

Upon further investigation, this ticket did break echoing in `mathematica_console()`. So something needs fixing (in #23112).



---

archive/issue_comments_274075.json:
```json
{
    "body": "A working fix is now available on #23112.",
    "created_at": "2017-06-12T00:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19936#issuecomment-274075",
    "user": "https://github.com/mkoeppe"
}
```

A working fix is now available on #23112.
