# Issue 21355: ".. note:" must be ".. note::"

archive/issues_021355.json:
```json
{
    "body": "CC:  chapoton jhpalmieri\n\nSee for example `isogeny_graph()` on elliptic curves over the rational numbers: http://sage-doc.sis.uta.fi/reference/curves/sage/schemes/elliptic_curves/ell_rational_field.html. The note \"The vertices are labeled 1 to n - -\" is not shown at all. The reason is\n\n\n```\n.. note:\n```\n\n\nthat should be\n\n\n```\n.. note::\n```\n\n\nAccording to\n\n\n```\negrep -R -i '^ +\\.\\. note:$' src/sage\n```\n\n\nthere are 19 files with this bug and a total of 34 lines to correct.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21592\n\n",
    "created_at": "2016-09-25T16:45:55Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "\".. note:\" must be \".. note::\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21355",
    "user": "jmantysalo"
}
```
CC:  chapoton jhpalmieri

See for example `isogeny_graph()` on elliptic curves over the rational numbers: http://sage-doc.sis.uta.fi/reference/curves/sage/schemes/elliptic_curves/ell_rational_field.html. The note "The vertices are labeled 1 to n - -" is not shown at all. The reason is


```
.. note:
```


that should be


```
.. note::
```


According to


```
egrep -R -i '^ +\.\. note:$' src/sage
```


there are 19 files with this bug and a total of 34 lines to correct.

Issue created by migration from https://trac.sagemath.org/ticket/21592





---

archive/issue_comments_296358.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to documentation.",
    "created_at": "2016-09-25T16:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296358",
    "user": "jmantysalo"
}
```

Changing component from PLEASE CHANGE to documentation.



---

archive/issue_comments_296359.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2016-09-25T16:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296359",
    "user": "jmantysalo"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_296360.json:
```json
{
    "body": "Perl is... perl.\n\n\n```\nfind src/sage -name '*.py' -or -name '*.pyx' -or -name '*.pxi' | xargs perl -e 's|(^ +)\\.\\. note:(?=$)|$1.. note::|g;' -p -i.bak\n```\n\n\nAnyways, this should work. Not tested yet, just compiling.\n----\nNew commits:",
    "created_at": "2016-09-25T17:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296360",
    "user": "jmantysalo"
}
```

Perl is... perl.


```
find src/sage -name '*.py' -or -name '*.pyx' -or -name '*.pxi' | xargs perl -e 's|(^ +)\.\. note:(?=$)|$1.. note::|g;' -p -i.bak
```


Anyways, this should work. Not tested yet, just compiling.
----
New commits:



---

archive/issue_comments_296361.json:
```json
{
    "body": "John, maybe you are also interested in this. Does this make some harm to the code removing `TESTS`-blocks?",
    "created_at": "2016-09-25T17:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296361",
    "user": "jmantysalo"
}
```

John, maybe you are also interested in this. Does this make some harm to the code removing `TESTS`-blocks?



---

archive/issue_comments_296362.json:
```json
{
    "body": "Why not use Sage for the search?\n\n```\nsage: search_src('\\.\\. note:[^:]')\n```\n",
    "created_at": "2016-09-25T20:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296362",
    "user": "jhpalmieri"
}
```

Why not use Sage for the search?

```
sage: search_src('\.\. note:[^:]')
```




---

archive/issue_comments_296363.json:
```json
{
    "body": "Replying to [comment:5 jhpalmieri]:\n> Why not use Sage for the search?\n> {{{\n> sage: search_src('\\.\\. note:[^:]')\n> }}}\n\nJust that I didn't remember that. Thanks!\n\nNext question: what to do for blocks that have\n\n\n```\n.. note:\n\nNot indented block here.\n```\n\n\n? Or how to found them automatically?\n\nUh, I don't like Sphinx.",
    "created_at": "2016-09-26T03:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296363",
    "user": "jmantysalo"
}
```

Replying to [comment:5 jhpalmieri]:
> Why not use Sage for the search?
> {{{
> sage: search_src('\.\. note:[^:]')
> }}}

Just that I didn't remember that. Thanks!

Next question: what to do for blocks that have


```
.. note:

Not indented block here.
```


? Or how to found them automatically?

Uh, I don't like Sphinx.



---

archive/issue_comments_296364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-26T04:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296364",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296365.json:
```json
{
    "body": "To find such blocks:\n\n```\nsage: search_src(r'([ ]*)\\.\\. note::[ ]*\\n\\n\\1[^ ]', multiline=True)\ncategories/map.pyx\ninterfaces/r.py\nrings/polynomial/pbori.pyx\n```\n\nWith the `multiline=True` option, it doesn't return the line number, just the file. But it's not hard to find the offending lines. `map.pyx`:\n\n```diff\ndiff --git a/src/sage/categories/map.pyx b/src/sage/categories/map.pyx\nindex 5fd7637..8c36b47 100644\n--- a/src/sage/categories/map.pyx\n+++ b/src/sage/categories/map.pyx\n@@ -510,7 +510,7 @@ cdef class Map(Element):\n \n         .. NOTE::\n \n-        By default, the empty string is returned. Subclasses may overload this method.\n+            By default, the empty string is returned. Subclasses may overload this method.\n \n         EXAMPLE::\n \n```\n\n`r.py`:\n\n```diff\ndiff --git a/src/sage/interfaces/r.py b/src/sage/interfaces/r.py\nindex f8eda3b..8875b50 100644\n--- a/src/sage/interfaces/r.py\n+++ b/src/sage/interfaces/r.py\n@@ -787,7 +787,7 @@ class R(ExtraTabCompletion, Expect):\n \n             .. note::\n \n-            This is similar to typing r.command?.\n+                This is similar to typing r.command?.\n         \"\"\"\n         s = self.eval('help(\"%s\")'%command).strip()     # ?cmd is only an unsafe shortcut\n         import sage.plot.plot\n```\n\nThe last one, `pbori.pyx`, is a false positive, probably because of a mistake in my regular expression: it matches because of blocks with more than one blank line between `.. note::` and the indented block.",
    "created_at": "2016-09-26T05:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296365",
    "user": "jhpalmieri"
}
```

To find such blocks:

```
sage: search_src(r'([ ]*)\.\. note::[ ]*\n\n\1[^ ]', multiline=True)
categories/map.pyx
interfaces/r.py
rings/polynomial/pbori.pyx
```

With the `multiline=True` option, it doesn't return the line number, just the file. But it's not hard to find the offending lines. `map.pyx`:

```diff
diff --git a/src/sage/categories/map.pyx b/src/sage/categories/map.pyx
index 5fd7637..8c36b47 100644
--- a/src/sage/categories/map.pyx
+++ b/src/sage/categories/map.pyx
@@ -510,7 +510,7 @@ cdef class Map(Element):
 
         .. NOTE::
 
-        By default, the empty string is returned. Subclasses may overload this method.
+            By default, the empty string is returned. Subclasses may overload this method.
 
         EXAMPLE::
 
```

`r.py`:

```diff
diff --git a/src/sage/interfaces/r.py b/src/sage/interfaces/r.py
index f8eda3b..8875b50 100644
--- a/src/sage/interfaces/r.py
+++ b/src/sage/interfaces/r.py
@@ -787,7 +787,7 @@ class R(ExtraTabCompletion, Expect):
 
             .. note::
 
-            This is similar to typing r.command?.
+                This is similar to typing r.command?.
         """
         s = self.eval('help("%s")'%command).strip()     # ?cmd is only an unsafe shortcut
         import sage.plot.plot
```

The last one, `pbori.pyx`, is a false positive, probably because of a mistake in my regular expression: it matches because of blocks with more than one blank line between `.. note::` and the indented block.



---

archive/issue_comments_296366.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-26T09:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296366",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296367.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-26T09:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296367",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296368.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-26T09:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296368",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296369.json:
```json
{
    "body": "Replying to [comment:8 jhpalmieri]:\n> To find such blocks:\n> {{{\n> sage: search_src(r'([ ]*)\\.\\. note::[ ]*\\n\\n\\1[^ ]', multiline=True)\n> categories/map.pyx\n> interfaces/r.py\n> rings/polynomial/pbori.pyx\n> }}}\n\nThanks.\n\nNow this one should work, at last. Sphinx seems to be very, very bad and error-prone for documentation like this. It would need much more structure and error checking.",
    "created_at": "2016-09-26T09:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296369",
    "user": "jmantysalo"
}
```

Replying to [comment:8 jhpalmieri]:
> To find such blocks:
> {{{
> sage: search_src(r'([ ]*)\.\. note::[ ]*\n\n\1[^ ]', multiline=True)
> categories/map.pyx
> interfaces/r.py
> rings/polynomial/pbori.pyx
> }}}

Thanks.

Now this one should work, at last. Sphinx seems to be very, very bad and error-prone for documentation like this. It would need much more structure and error checking.



---

archive/issue_comments_296370.json:
```json
{
    "body": "I found a few more. I think that Sphinx treats any line that starts with `.. text` as a comment unless it is of the form `.. directive::`. In particular, lines like `.. note: blah` are ignored completely by Sphinx, so I fixed those.\n----\nNew commits:",
    "created_at": "2016-09-26T18:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296370",
    "user": "jhpalmieri"
}
```

I found a few more. I think that Sphinx treats any line that starts with `.. text` as a comment unless it is of the form `.. directive::`. In particular, lines like `.. note: blah` are ignored completely by Sphinx, so I fixed those.
----
New commits:



---

archive/issue_comments_296371.json:
```json
{
    "body": "I'm happy with your original version, so if you're okay with my changes, feel free to set a positive review.",
    "created_at": "2016-09-26T18:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296371",
    "user": "jhpalmieri"
}
```

I'm happy with your original version, so if you're okay with my changes, feel free to set a positive review.



---

archive/issue_comments_296372.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-27T04:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296372",
    "user": "jmantysalo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_296373.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> I'm happy with your original version, so if you're okay with my changes, feel free to set a positive review.\n\nCan you re-check this? It seems that `elliptic_curves/padic_lseries.html` contains no `NOTE`-blocks, but `btquotients/btquotient.html` is fine. I don't see why so.",
    "created_at": "2016-09-27T04:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296373",
    "user": "jmantysalo"
}
```

Replying to [comment:14 jhpalmieri]:
> I'm happy with your original version, so if you're okay with my changes, feel free to set a positive review.

Can you re-check this? It seems that `elliptic_curves/padic_lseries.html` contains no `NOTE`-blocks, but `btquotients/btquotient.html` is fine. I don't see why so.



---

archive/issue_comments_296374.json:
```json
{
    "body": "The methods in `padic_lseries.py` which contain the `.. notes:` blocks start with an underscore, so they don't appear in the documentation. I think we should still fix the formatting.",
    "created_at": "2016-09-27T17:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296374",
    "user": "jhpalmieri"
}
```

The methods in `padic_lseries.py` which contain the `.. notes:` blocks start with an underscore, so they don't appear in the documentation. I think we should still fix the formatting.



---

archive/issue_comments_296375.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-09-27T17:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296375",
    "user": "jmantysalo"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_296376.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> The methods in `padic_lseries.py` which contain the `.. notes:` blocks start with an underscore\n\nDuh.",
    "created_at": "2016-09-27T17:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296376",
    "user": "jmantysalo"
}
```

Replying to [comment:17 jhpalmieri]:
> The methods in `padic_lseries.py` which contain the `.. notes:` blocks start with an underscore

Duh.



---

archive/issue_comments_296377.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2016-10-05T07:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296377",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_296378.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-05T07:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296378",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_296379.json:
```json
{
    "body": "The way prescribed by the dev guide it `.. NOTE::`. So while you're at it, could you make that change as well?",
    "created_at": "2016-10-05T14:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296379",
    "user": "tscrim"
}
```

The way prescribed by the dev guide it `.. NOTE::`. So while you're at it, could you make that change as well?



---

archive/issue_comments_296380.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> The way prescribed by the dev guide it `.. NOTE::`. So while you're at it, could you make that change as well?\n\nIt is easier to do this first, and then later change all with a perl command, just like in #21648. (Btw, thanks for that.)",
    "created_at": "2016-10-05T14:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296380",
    "user": "jmantysalo"
}
```

Replying to [comment:20 tscrim]:
> The way prescribed by the dev guide it `.. NOTE::`. So while you're at it, could you make that change as well?

It is easier to do this first, and then later change all with a perl command, just like in #21648. (Btw, thanks for that.)



---

archive/issue_comments_296381.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-21T21:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296381",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_296382.json:
```json
{
    "body": "rebased on 7.6.b4\n----\nNew commits:",
    "created_at": "2017-02-21T21:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296382",
    "user": "chapoton"
}
```

rebased on 7.6.b4
----
New commits:



---

archive/issue_comments_296383.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-21T21:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296383",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296384.json:
```json
{
    "body": "ok, looks good to me. I made one more commit about some missing accents in one of the touched files.\n\nIf you agree with my changes, you can set to positive.",
    "created_at": "2017-02-21T21:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296384",
    "user": "chapoton"
}
```

ok, looks good to me. I made one more commit about some missing accents in one of the touched files.

If you agree with my changes, you can set to positive.



---

archive/issue_comments_296385.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-22T06:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296385",
    "user": "jmantysalo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_296386.json:
```json
{
    "body": "LGTM. I changed some metadata.",
    "created_at": "2017-02-22T06:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296386",
    "user": "jmantysalo"
}
```

LGTM. I changed some metadata.



---

archive/issue_comments_296387.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-24T14:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21355#issuecomment-296387",
    "user": "vbraun"
}
```

Resolution: fixed
