# Issue 15313: Implement the Kirchhoff-Symanzik polynomial for graphs

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2013-12-19 14:53:13

Keywords: symanzik polynomial

This is a polynomial in several variables, useful in the study of Feynman diagrams.

Code should follow soon.


---

Comment by chapoton created at 2013-12-19 16:07:25

Changing type from enhancement to task.


---

Comment by chapoton created at 2013-12-21 13:43:54

Changing status from new to needs_review.


---

Comment by chapoton created at 2013-12-21 13:43:54

Changing type from task to enhancement.


---

Comment by chapoton created at 2013-12-21 13:44:09

New commits:


---

Comment by ncohen created at 2013-12-25 13:49:32

Hello Frederic !

I think you could replace your "quasitree_to_cycle" function by a call to `Graph.is_forest(certificate=True)`. Could you also merge all these patches into one ? It would make it a bit easier to review `^^;`

Nathann


---

Comment by ncohen created at 2013-12-25 13:54:06

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2013-12-28 20:20:10

Hello Nathann,

thanks for the suggestion. But `is_forest` does not work correctly on graphs with multiple edges:

```

sage: G=graphs.CycleGraph(6)
sage: G.is_forest()
False
sage: G.is_forest(certificate=True)
(False, [5, 4, 3, 2, 1, 0])
sage: G = Graph([(1,2,'a'),(1,2,'b')])
sage: G.is_forest(certificate=True)
sage: G.is_forest()
False
```

and moreover I need the cycle as a sequence of signed edges.


---

Comment by ncohen created at 2013-12-28 21:01:09

> thanks for the suggestion. But `is_forest` does not work correctly on graphs with multiple edges:

Oh. Well, multiple edges actually make no difference, unless you have a 2-cycle. In which case that is your certificate. I think that fixing that is still better than re-implementing it with a weird name.

> and moreover I need the cycle as a sequence of signed edges.

What does that mean ? Can't that be obtained with the certificate of `is_forest` ?

Nathann


---

Comment by git created at 2013-12-29 20:29:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2013-12-30 17:38:07

Hello Nathann,

I have now made good use of the `is_tree` function.

Would you prefer if I put my auxiliary function inside the new method ? I do not see how to avoid it completely. I need to choose an arbitray orientation of the graph, and for this I am using the way the edges are given by a pair (i,j). Then I need to know how every cycle is oriented, some arrows being in the wrong direction.

Is this really necessary to smash all my commits (not patches) into one ? I would prefer not to.


---

Comment by ncohen created at 2013-12-30 22:24:17

Hellooooooooo !

> Would you prefer if I put my auxiliary function inside the new method ? 

Your auxiliary method will not be in your final patch, that's for sure, because even if it were actually useful for your code it has no general use and has nothing to do has a Graph function. At the very least it should be made private. This being said, you still haven't explained to me what exactly this function does (neither is it explained in the function's docstring), so I do not understand how to help you remove it yet. Please tell me what exactly it does. Right now its docstring reads "return the only cycle of a graph with one cycle", and that's exactly what `is_forest` does for you, thus something is missing.

> I do not see how to avoid it completely. I need to choose an arbitray orientation of the graph, and for this I am using the way the edges are given by a pair (i,j). Then I need to know how every cycle is oriented, some arrows being in the wrong direction.

I do not know what you need this orientation for, but using the orientation given by `edges()` can be tricky. There is absolutely no certainty that the orientation of the edges given by `edges()` is consistent with the one given by `edges_incident()`.

> Is this really necessary to smash all my commits (not patches) into one ? I would prefer not to.

It would make your patch clearer. There are 5 commits in your patch right now and most of what one does is undone in the other. This being said merging commits is *very easy* to do in git : you have to "rebase" your ticket's branch upon "develop" using the '-i' flag, for "interactive". In only one command you can merge commits together (I think 'git' uses the keyword 'meld' instead). That's actually quite cool `:-P`

Nathann


---

Comment by git created at 2014-01-01 17:23:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-01-01 17:26:01

Here is a smashed thing. And hopefully simpler, too.


---

Comment by ncohen created at 2014-01-02 14:01:07

(please set the ticket back to `needs_review` when it needs a review. Otherwise it does not appear in the list of tickets needing a review and nobody reads them. And I 'lost' tickets several times like that, finding them again years later, just because they were still in `needs_work` `:-P`)

Nathann


---

Comment by chapoton created at 2014-01-02 15:16:40

Yes, sorry.

I have made the auxiliary method into a private method, but it is now very small, so it could be put inside the main function. Tell me what you prefer and I will change accordingly.


---

Comment by chapoton created at 2014-01-02 15:16:40

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-01-02 16:25:57

Well, if it is 10 lines long I think it would be better to move it inside of your main function. But it would be very nice if you could explain what exactly it does, because I have to understand the code if I want to review it `^^;`

Nathann


---

Comment by git created at 2014-01-02 18:56:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-02 19:07:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-01-03 09:27:30

I am still trying to understand this code (and it would clearly help if you could add comments to it). You are buildng a cycle basis for a graph, and we have a function named `Graph.cycle_basis`. The problem is that it does not work for graphs with multiedges. Shouldn't your code move there ? If there are differences in speed, it would be cool to keep the two implementations available.

Nathann


---

Comment by ncohen created at 2014-01-03 09:27:30

Changing status from needs_review to needs_info.


---

Comment by git created at 2014-01-03 10:58:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-01-03 11:01:55

I have now added some code to cycle_basis

But one cannot reconstruct a cycle from its support in a graph with multiple edges, so I cannot use that, unless I change the output of cycle_basis to a list of edges.

When you tell me you want more explanations, do you mean
* here in trac
* as comments in the code
* in the doc of the code ?


---

Comment by chapoton created at 2014-01-03 11:04:21

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2014-01-03 11:08:58

Did you know that:

http://git.sagemath.org/sage.git/diff/?h=u/chapoton/15550&id2=develop

This is a way to see all the changes at once.. No need to smash commits..


---

Comment by ncohen created at 2014-01-03 11:10:52

Hello !

> I have now added some code to cycle_basis
> 
> But one cannot reconstruct a cycle from its support in a graph with multiple edges, so I cannot use that, unless I change the output of cycle_basis to a list of edges.

Well, the best way would be to add a flag to `cycle_basis` to ask precisely this : how should the output be given ? While saying that of course the "vertex" output cannot be used if the graph has multiple edges.

> When you tell me you want more explanations, do you mean
> * here in trac
> * as comments in the code
> * in the doc of the code ?

I would personally like it very much if you could answer the questions I ask here with real words and not only with git commits. Then, the problem is the following : the code is clearly not documented properly, as I cannot understand what it does, and I can swear this review costed me a lot of time already.

I would like to understand clearly the orientation that you pick, and all steps that you use to build the matrix, then to compute the coefficients. Besides, this should be written somewhere, in the docstring or as comments in the code.

Nathann


---

Comment by ncohen created at 2014-01-03 11:16:07

> Did you know that:
> 
> http://git.sagemath.org/sage.git/diff/?h=u/chapoton/15550&id2=develop
> 
> This is a way to see all the changes at once.. No need to smash commits..

I knew. Git can also be used directly to output such things. But it does not help at all either when every commits contradicts the previous ones. Several commits can be very useful when each of the commit does some meaningful task, that actually helps the review. Commiting the mistakes one makes while writing the patch does not.

I swear, I write and review things like #15623 these days, which contain far too many commits already without showing all mistakes done during the development `:-P`

Nathann


---

Comment by git created at 2014-01-03 14:20:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-01-03 14:26:55

Hello

Thank you Nathann for spending time on this, and sorry for not answering well-enough.

I have now added a 'output' keyword to 'cycle_basis', 'is_tree' and 'is_forest'.

Still I am not satisfied, because when output is set to 'edge', the cycle is not returned as a list of triples (vertex,vertex,label), but as a list of pairs [vertex,vertex]. It cannot therefore be recognized as an edge, i.e does not belongs to G.edges().

I will try later to correct that.


---

Comment by chapoton created at 2014-01-03 14:26:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-01-03 14:52:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-03 17:14:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-01-03 17:19:33

Rewriting history again, here is a working version.


---

Comment by chapoton created at 2014-01-03 17:19:33

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-01-03 19:17:48

Wow. Very good patch, thank you very much for this work `:-)`

All I could add are small modifications to the doc. I added one commit to your branch. If you agree with that, you can set the ticket to `positive_review`.

Happy new yeaaaaaaaaar !

Nathann


---

Comment by git created at 2014-01-03 19:18:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-01-03 19:19:15

Oops, soorry I forgot. I noticed that the `cycle_basis` function does not work for disconnected graphs. I'll fix that in a second.

Nathann


---

Comment by ncohen created at 2014-01-03 20:15:08

Hmmmmm... It was actually slightly more complicated than that. This, and supper in between.

Technically : 
* networkx refuses to work on a graph that allows multiple edges, even if it does not contain any
* `cycle_basis` now handles disconnected graphs

Aaaaaaaaand I found a bug with those cursed multiple edges again :


```
sage: g = Graph({0:{1:[1,1]}}, multiedges=True)
sage: g.edges()
[(0, 1, 1), (0, 1, 1)]
sage: (2*g).edges()
[(0, 1, 1), (2, 3, 1)]
```


I hate these things...

Anyway, branch updated. Tell me what you think !

Nathann


---

Comment by git created at 2014-01-03 20:16:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-01-03 20:33:46

Happy new year to you too, and thanks for the review !

Review patch looks good to me. If you agree, please set to positive review.


---

Comment by ncohen created at 2014-01-03 20:40:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-05 00:51:09

Doesn't merge, please resolve.


---

Comment by ncohen created at 2014-01-05 08:22:35

Hmmmm... It merges with 6.1.beta3, so it must be conflicting with some other patch you already merged.

Nathann


---

Comment by vbraun created at 2014-01-05 18:38:20

Conflicts with beta4


---

Comment by ncohen created at 2014-01-05 18:47:38

Rebased ! (though there was no automatic git message)

Nathann
----
New commits:


---

Comment by vbraun created at 2014-01-07 04:55:35

Resolution: fixed
