# Issue 19435: giac depends on Sage runtime

archive/issues_019435.json:
```json
{
    "body": "CC:  @frederichan-IMJPRG\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19672\n\n",
    "created_at": "2015-12-05T09:10:28Z",
    "labels": [
        "component: packages: optional",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "giac depends on Sage runtime",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19435",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @frederichan-IMJPRG



Issue created by migration from https://trac.sagemath.org/ticket/19672





---

archive/issue_comments_266916.json:
```json
{
    "body": "Set assignee to @frederichan-IMJPRG.",
    "created_at": "2015-12-05T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266916",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Set assignee to @frederichan-IMJPRG.



---

archive/issue_comments_266917.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-12-05T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266917",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

New commits:



---

archive/issue_comments_266918.json:
```json
{
    "body": "You should write `| $(SAGERUNTIME)` in the dependencies. That means that `giac` will be built after the Sage runtime, but not *rebuilt* every time that the Sage runtime gets rebuilt.\n\nAnd don't forget your name as author.",
    "created_at": "2015-12-05T11:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266918",
    "user": "https://github.com/jdemeyer"
}
```

You should write `| $(SAGERUNTIME)` in the dependencies. That means that `giac` will be built after the Sage runtime, but not *rebuilt* every time that the Sage runtime gets rebuilt.

And don't forget your name as author.



---

archive/issue_comments_266919.json:
```json
{
    "body": "As an example, see the dependencies for `sagetex`.",
    "created_at": "2015-12-05T11:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266919",
    "user": "https://github.com/jdemeyer"
}
```

As an example, see the dependencies for `sagetex`.



---

archive/issue_comments_266920.json:
```json
{
    "body": "Thank you for the Hint. I have found only sagetex depending on SAGERUNTIME, \nso should I try to remove this dependency in spkg-install?\n\nI think that the guilty  is the following:\n\n```\n#############################################################\n#   Build dir for the pexpect interface\n#############################################################\n# create the script_subdirectory for the pexpect giac interface by running a trivial instruction\nsage -c \"giac(1)\"\n```\n\nbut I wonder if it is still usefull? (I can run the first pexpect giac interface session with the binary  sage tarball 6.9 without the ownership of the sage install)",
    "created_at": "2015-12-05T14:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266920",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Thank you for the Hint. I have found only sagetex depending on SAGERUNTIME, 
so should I try to remove this dependency in spkg-install?

I think that the guilty  is the following:

```
#############################################################
#   Build dir for the pexpect interface
#############################################################
# create the script_subdirectory for the pexpect giac interface by running a trivial instruction
sage -c "giac(1)"
```

but I wonder if it is still usefull? (I can run the first pexpect giac interface session with the binary  sage tarball 6.9 without the ownership of the sage install)



---

archive/issue_comments_266921.json:
```json
{
    "body": "Replying to [comment:5 frederichan]:\n> Thank you for the Hint. I have found only sagetex depending on SAGERUNTIME, \n> so should I try to remove this dependency in spkg-install?\n> \n> I think that the guilty  is the following:\n> {{{\n> #############################################################\n> #   Build dir for the pexpect interface\n> #############################################################\n> # create the script_subdirectory for the pexpect giac interface by running a trivial instruction\n> sage -c \"giac(1)\"\n> }}}\n> but I wonder if it is still usefull? (I can run the first pexpect giac interface session with the binary  sage tarball 6.9 without the ownership of the sage install) \n\nI don't mind to keep that command, it also works as a test that `giac` works.",
    "created_at": "2015-12-05T14:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266921",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 frederichan]:
> Thank you for the Hint. I have found only sagetex depending on SAGERUNTIME, 
> so should I try to remove this dependency in spkg-install?
> 
> I think that the guilty  is the following:
> {{{
> #############################################################
> #   Build dir for the pexpect interface
> #############################################################
> # create the script_subdirectory for the pexpect giac interface by running a trivial instruction
> sage -c "giac(1)"
> }}}
> but I wonder if it is still usefull? (I can run the first pexpect giac interface session with the binary  sage tarball 6.9 without the ownership of the sage install) 

I don't mind to keep that command, it also works as a test that `giac` works.



---

archive/issue_comments_266922.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-05T15:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266923.json:
```json
{
    "body": "needs review?",
    "created_at": "2015-12-05T15:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266923",
    "user": "https://github.com/jdemeyer"
}
```

needs review?



---

archive/issue_comments_266924.json:
```json
{
    "body": "I don't plan to add changes, but  I have not yet tested this because my sage was not up to date. So I was waiting for my fresh built to finish and then test...\nBut if you prefer to review it now it is OK for me.",
    "created_at": "2015-12-05T15:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266924",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

I don't plan to add changes, but  I have not yet tested this because my sage was not up to date. So I was waiting for my fresh built to finish and then test...
But if you prefer to review it now it is OK for me.



---

archive/issue_comments_266925.json:
```json
{
    "body": "So for my first test with sage 6.10beta7 I got the following PB:\nI was able to built giacpy but not with the check option because\nsome prettyprint in sympy was not found.\nmake sympy solved the problem.\n\nShould sympy be a dep of giacpy?",
    "created_at": "2015-12-05T17:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266925",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

So for my first test with sage 6.10beta7 I got the following PB:
I was able to built giacpy but not with the check option because
some prettyprint in sympy was not found.
make sympy solved the problem.

Should sympy be a dep of giacpy?



---

archive/issue_comments_266926.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-06T07:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266926",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_266927.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-07T08:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266927",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_266928.json:
```json
{
    "body": "Replying to [comment:10 frederichan]:\n> Should sympy be a dep of giacpy?\nYes.",
    "created_at": "2015-12-07T08:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266928",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 frederichan]:
> Should sympy be a dep of giacpy?
Yes.



---

archive/issue_comments_266929.json:
```json
{
    "body": "Also giacpy should depend on maxima:\n\n```\nTrying (line 1516):    simplify(SR(a)+sin(u)*sin(v))\nExpecting:\n    cos(u)*cos(v)\n**********************************************************************\nFile \"giacpy.pyx\", line 1516, in giacpy.encstring23._giac.Pygen.__iter__._symbolic_\nFailed example:\n    simplify(SR(a)+sin(u)*sin(v))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest giacpy.encstring23._giac.Pygen.__iter__._symbolic_[2]>\", line 1, in <module>\n        simplify(SR(a)+sin(u)*sin(v))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/functional.py\", line 51, in simplify\n        return f.simplify()\n      File \"sage/symbolic/expression.pyx\", line 8714, in sage.symbolic.expression.Expression.simplify (build/cythonized/sage/symbolic/expression.cpp:45102)\n        return self._parent(self._maxima_())\n      File \"sage/symbolic/expression.pyx\", line 786, in sage.symbolic.expression.Expression._maxima_ (build/cythonized/sage/symbolic/expression.cpp:7048)\n        return super(Expression, self)._interface_(maxima)\n      File \"sage/structure/sage_object.pyx\", line 698, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5631)\n        nm = I.name()\n      File \"sage/misc/lazy_import.pyx\", line 347, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3405)\n        return getattr(self._get_object(), attr)\n      File \"sage/misc/lazy_import.pyx\", line 246, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2150)\n        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py\", line 80, in <module>\n        ecl_eval(\"(require 'maxima)\")\n      File \"sage/libs/ecl.pyx\", line 1314, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:9725)\n        cpdef EclObject ecl_eval(bytes s):\n      File \"sage/libs/ecl.pyx\", line 1329, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:9658)\n        o=ecl_safe_eval(o)\n      File \"sage/libs/ecl.pyx\", line 342, in sage.libs.ecl.ecl_safe_eval (build/cythonized/sage/libs/ecl.c:4673)\n        raise RuntimeError, \"ECL says: \"+ecl_base_string_pointer_safe(s)\n    RuntimeError: ECL says: Module error: Don't know how to REQUIRE MAXIMA.\n```\n",
    "created_at": "2015-12-07T08:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266929",
    "user": "https://github.com/jdemeyer"
}
```

Also giacpy should depend on maxima:

```
Trying (line 1516):    simplify(SR(a)+sin(u)*sin(v))
Expecting:
    cos(u)*cos(v)
**********************************************************************
File "giacpy.pyx", line 1516, in giacpy.encstring23._giac.Pygen.__iter__._symbolic_
Failed example:
    simplify(SR(a)+sin(u)*sin(v))
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest giacpy.encstring23._giac.Pygen.__iter__._symbolic_[2]>", line 1, in <module>
        simplify(SR(a)+sin(u)*sin(v))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/functional.py", line 51, in simplify
        return f.simplify()
      File "sage/symbolic/expression.pyx", line 8714, in sage.symbolic.expression.Expression.simplify (build/cythonized/sage/symbolic/expression.cpp:45102)
        return self._parent(self._maxima_())
      File "sage/symbolic/expression.pyx", line 786, in sage.symbolic.expression.Expression._maxima_ (build/cythonized/sage/symbolic/expression.cpp:7048)
        return super(Expression, self)._interface_(maxima)
      File "sage/structure/sage_object.pyx", line 698, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5631)
        nm = I.name()
      File "sage/misc/lazy_import.pyx", line 347, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3405)
        return getattr(self._get_object(), attr)
      File "sage/misc/lazy_import.pyx", line 246, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2150)
        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 80, in <module>
        ecl_eval("(require 'maxima)")
      File "sage/libs/ecl.pyx", line 1314, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:9725)
        cpdef EclObject ecl_eval(bytes s):
      File "sage/libs/ecl.pyx", line 1329, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:9658)
        o=ecl_safe_eval(o)
      File "sage/libs/ecl.pyx", line 342, in sage.libs.ecl.ecl_safe_eval (build/cythonized/sage/libs/ecl.c:4673)
        raise RuntimeError, "ECL says: "+ecl_base_string_pointer_safe(s)
    RuntimeError: ECL says: Module error: Don't know how to REQUIRE MAXIMA.
```




---

archive/issue_comments_266930.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-07T11:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266931.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-07T11:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266931",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_266932.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-07T12:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266932",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_018519.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-08T16:27:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19435#event-18519"
}
```



---

archive/issue_comments_266933.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-08T16:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19435#issuecomment-266933",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
