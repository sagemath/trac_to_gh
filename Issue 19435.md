# Issue 19435: giac depends on Sage runtime

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-12-05 09:10:28

CC:  frederichan




---

Comment by frederichan created at 2015-12-05 11:47:56

Set assignee to frederichan.


---

Comment by frederichan created at 2015-12-05 11:47:56

New commits:


---

Comment by jdemeyer created at 2015-12-05 11:51:04

You should write `| $(SAGERUNTIME)` in the dependencies. That means that `giac` will be built after the Sage runtime, but not _rebuilt_ every time that the Sage runtime gets rebuilt.

And don't forget your name as author.


---

Comment by jdemeyer created at 2015-12-05 11:51:37

As an example, see the dependencies for `sagetex`.


---

Comment by frederichan created at 2015-12-05 14:20:14

Thank you for the Hint. I have found only sagetex depending on SAGERUNTIME, 
so should I try to remove this dependency in spkg-install?

I think that the guilty  is the following:

```
#############################################################
#   Build dir for the pexpect interface
#############################################################
# create the script_subdirectory for the pexpect giac interface by running a trivial instruction
sage -c "giac(1)"
```

but I wonder if it is still usefull? (I can run the first pexpect giac interface session with the binary  sage tarball 6.9 without the ownership of the sage install)


---

Comment by jdemeyer created at 2015-12-05 14:24:21

Replying to [comment:5 frederichan]:
> Thank you for the Hint. I have found only sagetex depending on SAGERUNTIME, 
> so should I try to remove this dependency in spkg-install?
> 
> I think that the guilty  is the following:
> {{{
> #############################################################
> #   Build dir for the pexpect interface
> #############################################################
> # create the script_subdirectory for the pexpect giac interface by running a trivial instruction
> sage -c "giac(1)"
> }}}
> but I wonder if it is still usefull? (I can run the first pexpect giac interface session with the binary  sage tarball 6.9 without the ownership of the sage install) 

I don't mind to keep that command, it also works as a test that `giac` works.


---

Comment by git created at 2015-12-05 15:08:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-12-05 15:15:50

needs review?


---

Comment by frederichan created at 2015-12-05 15:45:23

I don't plan to add changes, but  I have not yet tested this because my sage was not up to date. So I was waiting for my fresh built to finish and then test...
But if you prefer to review it now it is OK for me.


---

Comment by frederichan created at 2015-12-05 17:42:02

So for my first test with sage 6.10beta7 I got the following PB:
I was able to built giacpy but not with the check option because
some prettyprint in sympy was not found.
make sympy solved the problem.

Should sympy be a dep of giacpy?


---

Comment by frederichan created at 2015-12-06 07:52:54

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-12-07 08:50:43

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-12-07 08:50:43

Replying to [comment:10 frederichan]:
> Should sympy be a dep of giacpy?
Yes.


---

Comment by jdemeyer created at 2015-12-07 08:59:48

Also giacpy should depend on maxima:

```
Trying (line 1516):    simplify(SR(a)+sin(u)*sin(v))
Expecting:
    cos(u)*cos(v)
**********************************************************************
File "giacpy.pyx", line 1516, in giacpy.encstring23._giac.Pygen.__iter__._symbolic_
Failed example:
    simplify(SR(a)+sin(u)*sin(v))
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest giacpy.encstring23._giac.Pygen.__iter__._symbolic_[2]>", line 1, in <module>
        simplify(SR(a)+sin(u)*sin(v))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/functional.py", line 51, in simplify
        return f.simplify()
      File "sage/symbolic/expression.pyx", line 8714, in sage.symbolic.expression.Expression.simplify (build/cythonized/sage/symbolic/expression.cpp:45102)
        return self._parent(self._maxima_())
      File "sage/symbolic/expression.pyx", line 786, in sage.symbolic.expression.Expression._maxima_ (build/cythonized/sage/symbolic/expression.cpp:7048)
        return super(Expression, self)._interface_(maxima)
      File "sage/structure/sage_object.pyx", line 698, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5631)
        nm = I.name()
      File "sage/misc/lazy_import.pyx", line 347, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3405)
        return getattr(self._get_object(), attr)
      File "sage/misc/lazy_import.pyx", line 246, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2150)
        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 80, in <module>
        ecl_eval("(require 'maxima)")
      File "sage/libs/ecl.pyx", line 1314, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:9725)
        cpdef EclObject ecl_eval(bytes s):
      File "sage/libs/ecl.pyx", line 1329, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:9658)
        o=ecl_safe_eval(o)
      File "sage/libs/ecl.pyx", line 342, in sage.libs.ecl.ecl_safe_eval (build/cythonized/sage/libs/ecl.c:4673)
        raise RuntimeError, "ECL says: "+ecl_base_string_pointer_safe(s)
    RuntimeError: ECL says: Module error: Don't know how to REQUIRE MAXIMA.
```



---

Comment by git created at 2015-12-07 11:18:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-12-07 11:23:31

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-12-07 12:26:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-12-08 16:27:19

Resolution: fixed
