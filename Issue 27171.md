# Issue 27171: Edge view for graphs

archive/issues_027171.json:
```json
{
    "body": "CC:  @nthiery tmonteil\n\nThis ticket implements an edge view for graphs, as discussed in #22349 and in [this message](https://groups.google.com/d/msg/sage-devel/uEHBKekJ_Cw/peoyx4PaBQAJ).\n\nAn edge view is a read-only iterable container of edges enabling operations like `for e in E` and `e in E`. In can be iterated multiple times. Checking membership is done in constant time. It avoids the construction of edge lists and so consumes little memory.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27408\n\n",
    "created_at": "2019-03-03T16:59:46Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Edge view for graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27171",
    "user": "@dcoudert"
}
```
CC:  @nthiery tmonteil

This ticket implements an edge view for graphs, as discussed in #22349 and in [this message](https://groups.google.com/d/msg/sage-devel/uEHBKekJ_Cw/peoyx4PaBQAJ).

An edge view is a read-only iterable container of edges enabling operations like `for e in E` and `e in E`. In can be iterated multiple times. Checking membership is done in constant time. It avoids the construction of edge lists and so consumes little memory.

Issue created by migration from https://trac.sagemath.org/ticket/27408





---

archive/issue_comments_382735.json:
```json
{
    "body": "This is a first draft of an `EdgeView`. I tried to combined the flexibility offered by the parameters of `.edges()` and `.edge_iterator()`. I have not tested it with Python3 yet, only with Python2 to understand the impact and what should be fixed.\n\nFeedback is more than welcome, for instance concerning:\n- Is the location OK or should we move it another file ?\n- Should it be in Cython ?\n- how to make `next(E)` ?\n- should we add the option to call `E[i]` to get the ith edge, even if it's slow ?\n----\nNew commits:",
    "created_at": "2019-03-03T21:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382735",
    "user": "@dcoudert"
}
```

This is a first draft of an `EdgeView`. I tried to combined the flexibility offered by the parameters of `.edges()` and `.edge_iterator()`. I have not tested it with Python3 yet, only with Python2 to understand the impact and what should be fixed.

Feedback is more than welcome, for instance concerning:
- Is the location OK or should we move it another file ?
- Should it be in Cython ?
- how to make `next(E)` ?
- should we add the option to call `E[i]` to get the ith edge, even if it's slow ?
----
New commits:



---

archive/issue_comments_382736.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-03T21:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382736",
    "user": "@dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_382737.json:
```json
{
    "body": "I think having this separate `views.py` file is perfect. Also, prototyping is much easier in Python and the Cython phase should be kept for a later ticket.\n\nIn Python there is a difference between an iterator (what you obtain with `iter(X)` and on which you can apply `next`) and an iterable (something on which `iter(X)` make sense). It is dangerous to have an object that is doing both (e.g. when `X` is an iterator `iter(X)` returns `X` itself). `EdgeView` is definitely an **iterable**. I would simply disallow `next(E)` similarly to\n\n```\nsage: next([0,1,2])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-21b4c4a0c628> in <module>()\n----> 1 next([Integer(0),Integer(1),Integer(2)])\n\nTypeError: list object is not an iterator\n```\n",
    "created_at": "2019-03-03T21:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382737",
    "user": "@videlec"
}
```

I think having this separate `views.py` file is perfect. Also, prototyping is much easier in Python and the Cython phase should be kept for a later ticket.

In Python there is a difference between an iterator (what you obtain with `iter(X)` and on which you can apply `next`) and an iterable (something on which `iter(X)` make sense). It is dangerous to have an object that is doing both (e.g. when `X` is an iterator `iter(X)` returns `X` itself). `EdgeView` is definitely an **iterable**. I would simply disallow `next(E)` similarly to

```
sage: next([0,1,2])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-21b4c4a0c628> in <module>()
----> 1 next([Integer(0),Integer(1),Integer(2)])

TypeError: list object is not an iterator
```




---

archive/issue_comments_382738.json:
```json
{
    "body": "OK. We can still do `next(iter(E))` to get first edge if needed.\n\nWe can certainly also replace `edge_iterator` by the `EdgeView`, but this can induce a small slow down.\n\nI have also create a class `VertexView` currently raising `NotImplementedError`. I'm not sure if it's needed.",
    "created_at": "2019-03-03T22:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382738",
    "user": "@dcoudert"
}
```

OK. We can still do `next(iter(E))` to get first edge if needed.

We can certainly also replace `edge_iterator` by the `EdgeView`, but this can induce a small slow down.

I have also create a class `VertexView` currently raising `NotImplementedError`. I'm not sure if it's needed.



---

archive/issue_comments_382739.json:
```json
{
    "body": "Replying to [comment:3 dcoudert]:\n> OK. We can still do `next(iter(E))` to get first edge if needed.\n\nThe various combinatorial sets in sage implements `.first()` and `.last()`.\n\n```\nsage: Partitions(5).first()\n[5]\nsage: Partitions(5).last()\n[1, 1, 1, 1, 1]\n```\n\n\n> We can certainly also replace `edge_iterator` by the `EdgeView`, but this can induce a small slow down.\n\nTo avoid slowdown there are several possibilities:\n- cache the edge view of the whole graph\n- have a pool of edge views to avoid creating the objects\n \n> I have also create a class `VertexView` currently raising `NotImplementedError`. I'm not sure if it's needed.\n\nThen remove it for now. I think that there are enough troubles introducing this `EdgeView`.",
    "created_at": "2019-03-04T08:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382739",
    "user": "@videlec"
}
```

Replying to [comment:3 dcoudert]:
> OK. We can still do `next(iter(E))` to get first edge if needed.

The various combinatorial sets in sage implements `.first()` and `.last()`.

```
sage: Partitions(5).first()
[5]
sage: Partitions(5).last()
[1, 1, 1, 1, 1]
```


> We can certainly also replace `edge_iterator` by the `EdgeView`, but this can induce a small slow down.

To avoid slowdown there are several possibilities:
- cache the edge view of the whole graph
- have a pool of edge views to avoid creating the objects
 
> I have also create a class `VertexView` currently raising `NotImplementedError`. I'm not sure if it's needed.

Then remove it for now. I think that there are enough troubles introducing this `EdgeView`.



---

archive/issue_comments_382740.json:
```json
{
    "body": "Replying to [comment:4 vdelecroix]:\n> Replying to [comment:3 dcoudert]:\n> > We can certainly also replace `edge_iterator` by the `EdgeView`, but this can induce a small slow down.\n> \n> To avoid slowdown there are several possibilities:\n> - cache the edge view of the whole graph\n\nActually, the above makes sense if you want the following to be fast\n\n```\nsage: (0,3) in G.edges()\n```\n\n(Am I right that `G.edges()` would return the view?)",
    "created_at": "2019-03-04T08:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382740",
    "user": "@videlec"
}
```

Replying to [comment:4 vdelecroix]:
> Replying to [comment:3 dcoudert]:
> > We can certainly also replace `edge_iterator` by the `EdgeView`, but this can induce a small slow down.
> 
> To avoid slowdown there are several possibilities:
> - cache the edge view of the whole graph

Actually, the above makes sense if you want the following to be fast

```
sage: (0,3) in G.edges()
```

(Am I right that `G.edges()` would return the view?)



---

archive/issue_comments_382741.json:
```json
{
    "body": "> The various combinatorial sets in sage implements `.first()` and `.last()`.\n\n`.first()` is easy, but `.last()` requires to iterate over all edges.\n\nActually, in the current implementation, when `sort=True`, we store a sorted list of edges. So getting the last one becomes easy. But when `sort=False`, we have to iterate.\nFurthermore, as the view is updated as the graph, we cannot store first/last edge.\n\n> - cache the edge view of the whole graph\n\nI don't know how to do that...\n\n> (Am I right that `G.edges()` would return the view?)\nYes.",
    "created_at": "2019-03-04T08:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382741",
    "user": "@dcoudert"
}
```

> The various combinatorial sets in sage implements `.first()` and `.last()`.

`.first()` is easy, but `.last()` requires to iterate over all edges.

Actually, in the current implementation, when `sort=True`, we store a sorted list of edges. So getting the last one becomes easy. But when `sort=False`, we have to iterate.
Furthermore, as the view is updated as the graph, we cannot store first/last edge.

> - cache the edge view of the whole graph

I don't know how to do that...

> (Am I right that `G.edges()` would return the view?)
Yes.



---

archive/issue_comments_382742.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-04T10:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382742",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382743.json:
```json
{
    "body": "Why the attributes `graph`, `directed`, etc of `EdgeView` do not start with underscore? With this version they would appear in the tab-completion which is not desirable.\n\nThe `sorted` function does not need a list as input. Replace `sorted(list(edges), ...)` with `sorted(edges, ...)`.\n\nWhy do you store the `directed` attribute in `EdgeView`?\n\nWhat I mean by cache is that the graph class could have a `_edge_view` attribute which is initialized with `EdgeView(self)` in `Graph.__init__`. Even if edges are added to the graph the edge view is magically updated (though you need to remove the `directed` attribute). It might even make sense to have two versions: `_edge_view` and `_edge_view_unlabelled`.",
    "created_at": "2019-03-04T10:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382743",
    "user": "@videlec"
}
```

Why the attributes `graph`, `directed`, etc of `EdgeView` do not start with underscore? With this version they would appear in the tab-completion which is not desirable.

The `sorted` function does not need a list as input. Replace `sorted(list(edges), ...)` with `sorted(edges, ...)`.

Why do you store the `directed` attribute in `EdgeView`?

What I mean by cache is that the graph class could have a `_edge_view` attribute which is initialized with `EdgeView(self)` in `Graph.__init__`. Even if edges are added to the graph the edge view is magically updated (though you need to remove the `directed` attribute). It might even make sense to have two versions: `_edge_view` and `_edge_view_unlabelled`.



---

archive/issue_comments_382744.json:
```json
{
    "body": "You want this to be fast. I would certainly do this in Cython.",
    "created_at": "2019-03-04T10:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382744",
    "user": "@jdemeyer"
}
```

You want this to be fast. I would certainly do this in Cython.



---

archive/issue_comments_382745.json:
```json
{
    "body": "I think it should be called `EdgesView` (plural): you're making a view of all edges, not one particular edge.",
    "created_at": "2019-03-04T10:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382745",
    "user": "@jdemeyer"
}
```

I think it should be called `EdgesView` (plural): you're making a view of all edges, not one particular edge.



---

archive/issue_comments_382746.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-04T10:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382746",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382747.json:
```json
{
    "body": "Again for performance, this should be as low-level as possible so I would drop the inheritance from `SageObject`.",
    "created_at": "2019-03-04T10:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382747",
    "user": "@jdemeyer"
}
```

Again for performance, this should be as low-level as possible so I would drop the inheritance from `SageObject`.



---

archive/issue_comments_382748.json:
```json
{
    "body": "Replying to [comment:2 vdelecroix]:\n> the Cython phase should be kept for a later ticket.\n\nI disagree here. I would agree with you if we would be adding a completely new feature. But here, we are changing an existing feature (namely `edges()`). So we don't want this to become slower than before.",
    "created_at": "2019-03-04T10:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382748",
    "user": "@jdemeyer"
}
```

Replying to [comment:2 vdelecroix]:
> the Cython phase should be kept for a later ticket.

I disagree here. I would agree with you if we would be adding a completely new feature. But here, we are changing an existing feature (namely `edges()`). So we don't want this to become slower than before.



---

archive/issue_comments_382749.json:
```json
{
    "body": "What do you think of this proposal from #22349?\n\n1. Make the default `sort=None`. In this case, give a deprecation warning and try to sort but fail gracefully if the input is not sortable.\n\n2. If `sort=True` is given, always sort (raising an exception if the sorting failed)\n\n3. If `sort=False` is given, never sort.",
    "created_at": "2019-03-04T10:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382749",
    "user": "@jdemeyer"
}
```

What do you think of this proposal from #22349?

1. Make the default `sort=None`. In this case, give a deprecation warning and try to sort but fail gracefully if the input is not sortable.

2. If `sort=True` is given, always sort (raising an exception if the sorting failed)

3. If `sort=False` is given, never sort.



---

archive/issue_comments_382750.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-04T10:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382750",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_382751.json:
```json
{
    "body": "I'm not going to insist on the cythonization, but I'd like to hear the opinion from others on this ticket.",
    "created_at": "2019-03-04T10:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382751",
    "user": "@jdemeyer"
}
```

I'm not going to insist on the cythonization, but I'd like to hear the opinion from others on this ticket.



---

archive/issue_comments_382752.json:
```json
{
    "body": "Replying to [comment:1 dcoudert]:\n> - should we add the option to call `E[i]` to get the ith edge, even if it's slow ?\n\nI would say yes, since the old `edges()` had that functionality.",
    "created_at": "2019-03-04T10:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382752",
    "user": "@jdemeyer"
}
```

Replying to [comment:1 dcoudert]:
> - should we add the option to call `E[i]` to get the ith edge, even if it's slow ?

I would say yes, since the old `edges()` had that functionality.



---

archive/issue_comments_382753.json:
```json
{
    "body": "I also suggest to keep the interface as simple as possible. For example, for the `vertices` argument, I would support only `None` and a `list` (and not: a single vertex).\n\nI also wouldn't do `True if labels else False`. Just write `labels` and assume that people don't give funny arguments for `labels`.\n\nTo check for a `key` function, use `key is not None` instead of `key`.",
    "created_at": "2019-03-04T11:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382753",
    "user": "@jdemeyer"
}
```

I also suggest to keep the interface as simple as possible. For example, for the `vertices` argument, I would support only `None` and a `list` (and not: a single vertex).

I also wouldn't do `True if labels else False`. Just write `labels` and assume that people don't give funny arguments for `labels`.

To check for a `key` function, use `key is not None` instead of `key`.



---

archive/issue_comments_382754.json:
```json
{
    "body": "In various places, you are replacing calls to `edges()` by `edge_iterator()`.\n\nThat looks like a backwards change: isn't the eventual goal to deprecate `edge_iterator()` and replace it by `edges()`, similarly to how `itervalues()` was deprecated in favor of `values()` in Python?",
    "created_at": "2019-03-04T11:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382754",
    "user": "@jdemeyer"
}
```

In various places, you are replacing calls to `edges()` by `edge_iterator()`.

That looks like a backwards change: isn't the eventual goal to deprecate `edge_iterator()` and replace it by `edges()`, similarly to how `itervalues()` was deprecated in favor of `values()` in Python?



---

archive/issue_comments_382755.json:
```json
{
    "body": "Cython allows you to use `yield from`, so you could implement `__iter__` as\n\n```python\n        if self._sort_edges:\n            yield from sorted(self, key=self._sort_edges_key)\n        elif self._graph._directed:\n            yield from self._graph._backend.iterator_out_edges(self._vertices, self._labels)\n            if self._ignore_direction:\n                yield from self._graph._backend.iterator_in_edges(self._vertices, self._labels)\n        else:\n            yield from self._graph._backend.iterator_edges(self._vertices, self._labels)\n```\n\nwhich I find easier to read and it's probably more efficient too.",
    "created_at": "2019-03-04T11:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382755",
    "user": "@jdemeyer"
}
```

Cython allows you to use `yield from`, so you could implement `__iter__` as

```python
        if self._sort_edges:
            yield from sorted(self, key=self._sort_edges_key)
        elif self._graph._directed:
            yield from self._graph._backend.iterator_out_edges(self._vertices, self._labels)
            if self._ignore_direction:
                yield from self._graph._backend.iterator_in_edges(self._vertices, self._labels)
        else:
            yield from self._graph._backend.iterator_edges(self._vertices, self._labels)
```

which I find easier to read and it's probably more efficient too.



---

archive/issue_comments_382756.json:
```json
{
    "body": "Overall, I think that this is a good change. I would like to see some more compatibility added with the old list return type for `edges()`, in particular implementing `__getitem__`. You could also consider `__add__` and `__mul__`.",
    "created_at": "2019-03-04T11:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382756",
    "user": "@jdemeyer"
}
```

Overall, I think that this is a good change. I would like to see some more compatibility added with the old list return type for `edges()`, in particular implementing `__getitem__`. You could also consider `__add__` and `__mul__`.



---

archive/issue_comments_382757.json:
```json
{
    "body": "Some quick answers (cannot work on it now):\n- networkx defines `EdgeView` and not `EdgesView` (see [here](https://github.com/networkx/networkx/blob/master/networkx/classes/reportviews.py)), but we can decide to use plural\n- change of `.edges()` to `.edge_iterator()`. I agree that it's not necessary. We can revert these changes. Also, I combined parameters of existing `.edges` and `.edge_iterator` methods  to be able to get a unique method with more options. We could certainly extend the tool to also do `.edges_incident()` and `.edge_boundary()`, but in another ticket.\n- I agree with the proposal for sort #comment:14, but we will have to check in many places if sorted is required or not.\n- `labels`. I have this bad habit that I'm trying to correct to write `labels=0`... that's why I offered some flexibility to users. But of course we can be strict.\n- `__add__` and `__mul__`. What could be a smart way to do that ? It's easy to return a list of edges, but a `EdgeView` ?\n- and of course switch to Cython.",
    "created_at": "2019-03-04T12:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382757",
    "user": "@dcoudert"
}
```

Some quick answers (cannot work on it now):
- networkx defines `EdgeView` and not `EdgesView` (see [here](https://github.com/networkx/networkx/blob/master/networkx/classes/reportviews.py)), but we can decide to use plural
- change of `.edges()` to `.edge_iterator()`. I agree that it's not necessary. We can revert these changes. Also, I combined parameters of existing `.edges` and `.edge_iterator` methods  to be able to get a unique method with more options. We could certainly extend the tool to also do `.edges_incident()` and `.edge_boundary()`, but in another ticket.
- I agree with the proposal for sort #comment:14, but we will have to check in many places if sorted is required or not.
- `labels`. I have this bad habit that I'm trying to correct to write `labels=0`... that's why I offered some flexibility to users. But of course we can be strict.
- `__add__` and `__mul__`. What could be a smart way to do that ? It's easy to return a list of edges, but a `EdgeView` ?
- and of course switch to Cython.



---

archive/issue_comments_382758.json:
```json
{
    "body": "Replying to [comment:21 dcoudert]:\n> - `labels`. I have this bad habit that I'm trying to correct to write `labels=0`... that's why I offered some flexibility to users.\n\nBut do you expect users to call `EdgeView` directly? I consider the `edges()` method the high-level interface, where you can be flexible. On the other hand, `EdgeView` should be as fast and simple as possible.",
    "created_at": "2019-03-04T12:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382758",
    "user": "@jdemeyer"
}
```

Replying to [comment:21 dcoudert]:
> - `labels`. I have this bad habit that I'm trying to correct to write `labels=0`... that's why I offered some flexibility to users.

But do you expect users to call `EdgeView` directly? I consider the `edges()` method the high-level interface, where you can be flexible. On the other hand, `EdgeView` should be as fast and simple as possible.



---

archive/issue_comments_382759.json:
```json
{
    "body": "Replying to [comment:21 dcoudert]:\n> - `__add__` and `__mul__`. What could be a smart way to do that ? It's easy to return a list of edges, but a `EdgeView` ?\n\nI wouldn't mind to return a list here. It's not very elegant, but it's good for backwards compatibility.",
    "created_at": "2019-03-05T12:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382759",
    "user": "@jdemeyer"
}
```

Replying to [comment:21 dcoudert]:
> - `__add__` and `__mul__`. What could be a smart way to do that ? It's easy to return a list of edges, but a `EdgeView` ?

I wouldn't mind to return a list here. It's not very elegant, but it's good for backwards compatibility.



---

archive/issue_comments_382760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-05T15:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382760",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382761.json:
```json
{
    "body": "I have implemented some of our wishlist. It remains to deal with\n- labels\n- sort\n- sublist query like `G.edges()[:-2]`. What's the name ?\n- try to replace `.edge_iterator()`\n- make sure it works with Python 3",
    "created_at": "2019-03-05T15:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382761",
    "user": "@dcoudert"
}
```

I have implemented some of our wishlist. It remains to deal with
- labels
- sort
- sublist query like `G.edges()[:-2]`. What's the name ?
- try to replace `.edge_iterator()`
- make sure it works with Python 3



---

archive/issue_comments_382762.json:
```json
{
    "body": "Replying to [comment:25 dcoudert]:\n> I have implemented some of our wishlist. It remains to deal with\n> - labels\n> - sort\n> - sublist query like `G.edges()[:-2]`. What's the name ?\n\nThis is also `__getitem__`. The call `X.[a:b:c]` is transformed into `X.__getitem__(slice(a,b,c))`. You can do something as simple as\n\n```\ndef __getitem__(self, i):\n    if isinstance(i, slice):\n        return list(self).__getitem__(i)\n```\n\n(or possibly be a little bit smarter using `islice` from `itertools`).\n\n> - try to replace `.edge_iterator()`\n> - make sure it works with Python 3",
    "created_at": "2019-03-05T15:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382762",
    "user": "@videlec"
}
```

Replying to [comment:25 dcoudert]:
> I have implemented some of our wishlist. It remains to deal with
> - labels
> - sort
> - sublist query like `G.edges()[:-2]`. What's the name ?

This is also `__getitem__`. The call `X.[a:b:c]` is transformed into `X.__getitem__(slice(a,b,c))`. You can do something as simple as

```
def __getitem__(self, i):
    if isinstance(i, slice):
        return list(self).__getitem__(i)
```

(or possibly be a little bit smarter using `islice` from `itertools`).

> - try to replace `.edge_iterator()`
> - make sure it works with Python 3



---

archive/issue_comments_382763.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-05T16:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382763",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382764.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-05T17:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382764",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382765.json:
```json
{
    "body": "- for slice queries, I have not use `islice` as it returns an iterator. The compatibility with current behavior is list. We can change that in the future\n- I implemented the proposal of Jeroen for sorting. Well, the \"fail gracefully\" is not clear to me.\n\nit remains to\n- try to replace `.edge_iterator()` -- I tried and it breaks too many things. Could be done in another ticket, replacing calls be `.edges` and adding a deprecation warning to `.vertex_iterator`\n- make sure it works with Python 3\n- certainly try to speed up the beast",
    "created_at": "2019-03-05T18:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382765",
    "user": "@dcoudert"
}
```

- for slice queries, I have not use `islice` as it returns an iterator. The compatibility with current behavior is list. We can change that in the future
- I implemented the proposal of Jeroen for sorting. Well, the "fail gracefully" is not clear to me.

it remains to
- try to replace `.edge_iterator()` -- I tried and it breaks too many things. Could be done in another ticket, replacing calls be `.edges` and adding a deprecation warning to `.vertex_iterator`
- make sure it works with Python 3
- certainly try to speed up the beast



---

archive/issue_comments_382766.json:
```json
{
    "body": "Since you know how many edges there are it is easy to implement `E[-3]` without creating the list (though I have no idea whether it has any proper use case).\n\nConcerning slices, I never suggested to **return** islice but to **use it**. More explicitely\n\n```\nif isinstance(i, slice):\n    return list(islice(self, i.start, i.stop, i.end)))\n```\n\nThe above avoids creating the list of all edges (at least when `b` is positive which can always be done since you know the length). You will notice the difference if you do `E[:10]` on a huge graph.",
    "created_at": "2019-03-05T18:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382766",
    "user": "@videlec"
}
```

Since you know how many edges there are it is easy to implement `E[-3]` without creating the list (though I have no idea whether it has any proper use case).

Concerning slices, I never suggested to **return** islice but to **use it**. More explicitely

```
if isinstance(i, slice):
    return list(islice(self, i.start, i.stop, i.end)))
```

The above avoids creating the list of all edges (at least when `b` is positive which can always be done since you know the length). You will notice the difference if you do `E[:10]` on a huge graph.



---

archive/issue_comments_382767.json:
```json
{
    "body": "I think that it would be good to replace *some* occurrences of `.edge_iterator` and identify what is the source of breakage.",
    "created_at": "2019-03-05T18:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382767",
    "user": "@videlec"
}
```

I think that it would be good to replace *some* occurrences of `.edge_iterator` and identify what is the source of breakage.



---

archive/issue_comments_382768.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-05T19:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382768",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382769.json:
```json
{
    "body": "I fixed various issues for Python3 to avoid introducing new issues.\n\n* We know the length **if and only if** `vertices = None`. Otherwise we have to count edges.\n  I tried using `islice` without success. Got `AttributeError: 'slice' object has no attribute 'end'`...\n\n* for `.edge_iterator`, we have many calls to `next(...)`. We have to change each of them and may be other stuff.",
    "created_at": "2019-03-05T19:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382769",
    "user": "@dcoudert"
}
```

I fixed various issues for Python3 to avoid introducing new issues.

* We know the length **if and only if** `vertices = None`. Otherwise we have to count edges.
  I tried using `islice` without success. Got `AttributeError: 'slice' object has no attribute 'end'`...

* for `.edge_iterator`, we have many calls to `next(...)`. We have to change each of them and may be other stuff.



---

archive/issue_comments_382770.json:
```json
{
    "body": "Replying to [comment:33 dcoudert]:\n> I fixed various issues for Python3 to avoid introducing new issues.\n> \n> * We know the length **if and only if** `vertices = None`. Otherwise we have to count edges.\n>  I tried using `islice` without success. Got `AttributeError: 'slice' object has no attribute 'end'`...\n\nSorry, the attributes are `start`, `stop`, `step`. When you know the length you can use the method `indices` of the slice to find out the (correctly bounded) `start`, `stop`, `step` as in\n\n```\nsage: slice(1, -1, 2).indices(23)\n(1, 22, 2)\n```\n\nSee https://docs.python.org/2/library/functions.html#slice",
    "created_at": "2019-03-05T19:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382770",
    "user": "@videlec"
}
```

Replying to [comment:33 dcoudert]:
> I fixed various issues for Python3 to avoid introducing new issues.
> 
> * We know the length **if and only if** `vertices = None`. Otherwise we have to count edges.
>  I tried using `islice` without success. Got `AttributeError: 'slice' object has no attribute 'end'`...

Sorry, the attributes are `start`, `stop`, `step`. When you know the length you can use the method `indices` of the slice to find out the (correctly bounded) `start`, `stop`, `step` as in

```
sage: slice(1, -1, 2).indices(23)
(1, 22, 2)
```

See https://docs.python.org/2/library/functions.html#slice



---

archive/issue_comments_382771.json:
```json
{
    "body": "Replying to [comment:26 vdelecroix]:\n> You can do something as simple as\n> {{{\n> def __getitem__(self, i):\n>     if isinstance(i, slice):\n>         return list(self).__getitem__(i)\n> }}}\n\n...except that the line should be written as `return list(self)[i]`. There is almost never a need to call special methods like `__getitem__` directly (although one exception is `super()` calls).",
    "created_at": "2019-03-05T20:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382771",
    "user": "@jdemeyer"
}
```

Replying to [comment:26 vdelecroix]:
> You can do something as simple as
> {{{
> def __getitem__(self, i):
>     if isinstance(i, slice):
>         return list(self).__getitem__(i)
> }}}

...except that the line should be written as `return list(self)[i]`. There is almost never a need to call special methods like `__getitem__` directly (although one exception is `super()` calls).



---

archive/issue_comments_382772.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-05T23:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382772",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382773.json:
```json
{
    "body": "According to the documentation of [islice](https://docs.python.org/3/library/itertools.html#itertools.islice), it needs non negative parameters. Thus I tried to combine use of islice and `list()[i]`.",
    "created_at": "2019-03-05T23:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382773",
    "user": "@dcoudert"
}
```

According to the documentation of [islice](https://docs.python.org/3/library/itertools.html#itertools.islice), it needs non negative parameters. Thus I tried to combine use of islice and `list()[i]`.



---

archive/issue_comments_382774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-06T07:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382774",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382775.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-06T08:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382775",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382776.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-06T12:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382776",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382777.json:
```json
{
    "body": "To replace `.edge_iterator`, we must be able to call `next(...)` on `EdgesView`. Some algorithms use this functionality. The trivial solution is to use `it = iter(E)`, but there is certainly a smarter solution.",
    "created_at": "2019-03-06T12:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382777",
    "user": "@dcoudert"
}
```

To replace `.edge_iterator`, we must be able to call `next(...)` on `EdgesView`. Some algorithms use this functionality. The trivial solution is to use `it = iter(E)`, but there is certainly a smarter solution.



---

archive/issue_comments_382778.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-09T18:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382778",
    "user": "@dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_382779.json:
```json
{
    "body": "I read the sentence `the graph should not be updated while iterating through a view`. Note that the following behavior for sets\n\n```\nsage: s = set([1,2])\nsage: for i in s:\n....:     print(i)\n....:     s.add(3*i)\nTraceback (most recent call last):\n...\nRuntimeError: Set changed size during iteration\n```\n",
    "created_at": "2019-03-10T06:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382779",
    "user": "@videlec"
}
```

I read the sentence `the graph should not be updated while iterating through a view`. Note that the following behavior for sets

```
sage: s = set([1,2])
sage: for i in s:
....:     print(i)
....:     s.add(3*i)
Traceback (most recent call last):
...
RuntimeError: Set changed size during iteration
```




---

archive/issue_comments_382780.json:
```json
{
    "body": "`self.__mul__(n)` -> `self * n`",
    "created_at": "2019-03-10T06:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382780",
    "user": "@videlec"
}
```

`self.__mul__(n)` -> `self * n`



---

archive/issue_comments_382781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-10T09:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382782.json:
```json
{
    "body": "I fixed `__mul__`.\n\nFor sets, we also have this. \n\n```\nsage: s = set([1,2])\nsage: for i in s:\n....:     print(i)\n....:     s.add(i*3)\n....:     s.discard(i)\n....:     \n1\n2\n3\n6\n```\n",
    "created_at": "2019-03-10T09:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382782",
    "user": "@dcoudert"
}
```

I fixed `__mul__`.

For sets, we also have this. 

```
sage: s = set([1,2])
sage: for i in s:
....:     print(i)
....:     s.add(i*3)
....:     s.discard(i)
....:     
1
2
3
6
```




---

archive/issue_comments_382783.json:
```json
{
    "body": "Replying to [comment:46 dcoudert]:\n> I fixed `__mul__`.\n> \n> For sets, we also have this. \n> {{{\n> sage: s = set([1,2])\n> sage: for i in s:\n> ....:     print(i)\n> ....:     s.add(i*3)\n> ....:     s.discard(i)\n> ....:     \n> 1\n> 2\n> 3\n> 6\n> }}}\n\nOuch.",
    "created_at": "2019-03-10T13:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382783",
    "user": "@videlec"
}
```

Replying to [comment:46 dcoudert]:
> I fixed `__mul__`.
> 
> For sets, we also have this. 
> {{{
> sage: s = set([1,2])
> sage: for i in s:
> ....:     print(i)
> ....:     s.add(i*3)
> ....:     s.discard(i)
> ....:     
> 1
> 2
> 3
> 6
> }}}

Ouch.



---

archive/issue_comments_382784.json:
```json
{
    "body": "`@`Nicolas: this ticket implements your proposal of an view for edges. Any comment / suggestion for improvements is more than welcome ;)",
    "created_at": "2019-03-11T16:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382784",
    "user": "@dcoudert"
}
```

`@`Nicolas: this ticket implements your proposal of an view for edges. Any comment / suggestion for improvements is more than welcome ;)



---

archive/issue_comments_382785.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382785",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_382786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-09T12:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382786",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382787.json:
```json
{
    "body": "rebase and fix merge conflict with 8.8.beta1",
    "created_at": "2019-04-09T12:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382787",
    "user": "@dcoudert"
}
```

rebase and fix merge conflict with 8.8.beta1



---

archive/issue_comments_382788.json:
```json
{
    "body": "[comment:17] hasn't been addressed. Was that intentional or did you just forget about it?",
    "created_at": "2019-04-09T13:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382788",
    "user": "@jdemeyer"
}
```

[comment:17] hasn't been addressed. Was that intentional or did you just forget about it?



---

archive/issue_comments_382789.json:
```json
{
    "body": "To better explain what I meant with [comment:17]: I would try to keep the logic in `EdgesView.__init__` as simple as possible and move some of the argument handling (like replacing a single vertex by a 1-element list) to `GenericGraph.edges()`.",
    "created_at": "2019-04-09T13:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382789",
    "user": "@jdemeyer"
}
```

To better explain what I meant with [comment:17]: I would try to keep the logic in `EdgesView.__init__` as simple as possible and move some of the argument handling (like replacing a single vertex by a 1-element list) to `GenericGraph.edges()`.



---

archive/issue_comments_382790.json:
```json
{
    "body": "Various comments about `views.pyx`:\n\n1. Instead of `class EdgesView():`, I suggest a Cython class `cdef class EdgesView:` (dropping the empty tuple since that looks strange to me). This requires explicitly declaring attributes but it will be faster. It also requires merging `__mul__` and `__rmul__`.\n\n2. `<int>i` is not correct (the correct cast is `<Py_ssize_t>`) and not needed (Cython should do the type conversion automatically): just replace `<int>i` by `i`.\n\n3. I personally dislike code of the form\n\n```\n            try:\n                yield from sorted(self, key=self._sort_edges_key)\n            except Exception as msg:\n                raise TypeError(\"the edges cannot be sorted due to \" + msg)\n```\n\njust keep the original exception, drop the `try`/`except`.\n\n4. The proper way to deal with unknown types in `__eq__`, `__add__` and friends is to `return NotImplemented`.\n\n5. In `__mul__`, drop the check for `n < 1`, leave that to `list`.\n\n6. It would be good to implement `__bool__` too (for checking non-emptyness).",
    "created_at": "2019-04-09T14:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382790",
    "user": "@jdemeyer"
}
```

Various comments about `views.pyx`:

1. Instead of `class EdgesView():`, I suggest a Cython class `cdef class EdgesView:` (dropping the empty tuple since that looks strange to me). This requires explicitly declaring attributes but it will be faster. It also requires merging `__mul__` and `__rmul__`.

2. `<int>i` is not correct (the correct cast is `<Py_ssize_t>`) and not needed (Cython should do the type conversion automatically): just replace `<int>i` by `i`.

3. I personally dislike code of the form

```
            try:
                yield from sorted(self, key=self._sort_edges_key)
            except Exception as msg:
                raise TypeError("the edges cannot be sorted due to " + msg)
```

just keep the original exception, drop the `try`/`except`.

4. The proper way to deal with unknown types in `__eq__`, `__add__` and friends is to `return NotImplemented`.

5. In `__mul__`, drop the check for `n < 1`, leave that to `list`.

6. It would be good to implement `__bool__` too (for checking non-emptyness).



---

archive/issue_comments_382791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-09T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382792.json:
```json
{
    "body": "I have not (yet) done the change `cdef class EdgesView:` as I don't know how to properly define the types of the variables.\n\n- `_vertices` can be list, and then we have to handle empty list case instead of assigning `G`\n- `_vertex_set` is frozenset\n- `_labels` is boolean, but it prevents `None`\n- `_sort_edges` is a boolean\n- `_sort_edges_key` is a function. What's the appropriate type ?\n\nAlso, I did not get how to merge `__mul__` and `__rmul__`. Any pointer is welcome.",
    "created_at": "2019-04-09T15:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382792",
    "user": "@dcoudert"
}
```

I have not (yet) done the change `cdef class EdgesView:` as I don't know how to properly define the types of the variables.

- `_vertices` can be list, and then we have to handle empty list case instead of assigning `G`
- `_vertex_set` is frozenset
- `_labels` is boolean, but it prevents `None`
- `_sort_edges` is a boolean
- `_sort_edges_key` is a function. What's the appropriate type ?

Also, I did not get how to merge `__mul__` and `__rmul__`. Any pointer is welcome.



---

archive/issue_comments_382793.json:
```json
{
    "body": "With the info that you provided, it should be\n\n> - `_labels` is boolean, but it prevents `None`\n\nWhy should it be `None`? Isn't it just a boolean?",
    "created_at": "2019-04-09T15:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382793",
    "user": "@jdemeyer"
}
```

With the info that you provided, it should be

> - `_labels` is boolean, but it prevents `None`

Why should it be `None`? Isn't it just a boolean?



---

archive/issue_comments_382794.json:
```json
{
    "body": "Replying to [comment:56 dcoudert]:\n> - `_vertices` can be list, and then we have to handle empty list case instead of assigning `G`\n\nOr you could use `_vertices = None` to represent that case.",
    "created_at": "2019-04-09T15:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382794",
    "user": "@jdemeyer"
}
```

Replying to [comment:56 dcoudert]:
> - `_vertices` can be list, and then we have to handle empty list case instead of assigning `G`

Or you could use `_vertices = None` to represent that case.



---

archive/issue_comments_382795.json:
```json
{
    "body": "Replying to [comment:56 dcoudert]:\n> Also, I did not get how to merge `__mul__` and `__rmul__`. Any pointer is welcome.\n\nhttps://cython.readthedocs.io/en/latest/src/userguide/special_methods.html#arithmetic-methods",
    "created_at": "2019-04-09T15:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382795",
    "user": "@jdemeyer"
}
```

Replying to [comment:56 dcoudert]:
> Also, I did not get how to merge `__mul__` and `__rmul__`. Any pointer is welcome.

https://cython.readthedocs.io/en/latest/src/userguide/special_methods.html#arithmetic-methods



---

archive/issue_comments_382796.json:
```json
{
    "body": "Replying to [comment:54 jdemeyer]:\n> Various comments about `views.pyx`:\n> \n> 1. Instead of `class EdgesView():`, I suggest a Cython class `cdef class EdgesView:` (dropping the empty tuple since that looks strange to me). This requires explicitly declaring attributes but it will be faster. \n\nWith the current implementation of `__eq__`, we must access the variables of `other`. The only solution I see is to declare the class in `views.pxd` and to explicitly declare the members, i.e., make all members public. Is that the only solution or there is a smarter solution ?",
    "created_at": "2019-04-10T08:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382796",
    "user": "@dcoudert"
}
```

Replying to [comment:54 jdemeyer]:
> Various comments about `views.pyx`:
> 
> 1. Instead of `class EdgesView():`, I suggest a Cython class `cdef class EdgesView:` (dropping the empty tuple since that looks strange to me). This requires explicitly declaring attributes but it will be faster. 

With the current implementation of `__eq__`, we must access the variables of `other`. The only solution I see is to declare the class in `views.pxd` and to explicitly declare the members, i.e., make all members public. Is that the only solution or there is a smarter solution ?



---

archive/issue_comments_382797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T12:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382798.json:
```json
{
    "body": "Using `readonly` on some class members allow to fix `__eq__`. This way, the required members are available in Python-space, but only for reading. [documentation](https://cython.readthedocs.io/en/latest/src/tutorial/cdef_classes.html)\n\nI think I have now implemented all comments/suggestions. I don't know what else we can do to speed up the code. Anyway, thank you for your help.",
    "created_at": "2019-04-10T12:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382798",
    "user": "@dcoudert"
}
```

Using `readonly` on some class members allow to fix `__eq__`. This way, the required members are available in Python-space, but only for reading. [documentation](https://cython.readthedocs.io/en/latest/src/tutorial/cdef_classes.html)

I think I have now implemented all comments/suggestions. I don't know what else we can do to speed up the code. Anyway, thank you for your help.



---

archive/issue_comments_382799.json:
```json
{
    "body": "First of all, making the attributes `readonly` is a good idea anyway. There is no reason why they should only be accessible from Cython.\n\nSecond, the correct way to deal with `__eq__` (or really any other place where you do a type check for `EdgesView`) is to write code as follows:\n\n```\ndef __eq__(self, right):\n    if not isinstance(right, EdgesView):\n        return NotImplemented\n    other = <EdgesView>right\n```\n\nThis way, Cython knows that `other` is an instance of `EdgesView` and it will use optimized access to the `cdef` attributes. Otherwise, Cython accesses those attributes as Python attributes, which is must slower (and requires `readonly` or `public`).",
    "created_at": "2019-04-10T12:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382799",
    "user": "@jdemeyer"
}
```

First of all, making the attributes `readonly` is a good idea anyway. There is no reason why they should only be accessible from Cython.

Second, the correct way to deal with `__eq__` (or really any other place where you do a type check for `EdgesView`) is to write code as follows:

```
def __eq__(self, right):
    if not isinstance(right, EdgesView):
        return NotImplemented
    other = <EdgesView>right
```

This way, Cython knows that `other` is an instance of `EdgesView` and it will use optimized access to the `cdef` attributes. Otherwise, Cython accesses those attributes as Python attributes, which is must slower (and requires `readonly` or `public`).



---

archive/issue_comments_382800.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T12:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382800",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382801.json:
```json
{
    "body": "I didn't know that. It's really tricky.",
    "created_at": "2019-04-10T13:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382801",
    "user": "@dcoudert"
}
```

I didn't know that. It's really tricky.



---

archive/issue_comments_382802.json:
```json
{
    "body": "Yes, Cython is 95% like Python but that 5% is what makes it tricky.",
    "created_at": "2019-04-10T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382802",
    "user": "@jdemeyer"
}
```

Yes, Cython is 95% like Python but that 5% is what makes it tricky.



---

archive/issue_comments_382803.json:
```json
{
    "body": "Some more comments:\n\n1. Moving the handling of `sort=None` to `GenericGraph` (in line with [comment:17])\n\n2. `self._sort_edges = False if sort is False else True` should be simply `self._sort_edges = sort` then (since `_sort_edges` is declared `bint`, Cython automatically does the conversion to `bool`)\n\n3. `self._graph = <GenericGraph_pyx>G` is very dangerous as no type check is done. Replace this by `self._graph = <GenericGraph_pyx?>G` which is the same, except that an exception is raised by Cython if `G` is not an instance of `GenericGraph_pyx`.\n\n4. Use `def __add__(left, right)` instead of `def __add__(self, other)` since using the name `self` here is potentially confusing. Same for `__mul__`.\n\n5. I have some doubts about `start, stop, step = i.start or 0, i.stop or sys_maxsize, i.step or 1` but I'll need to check precise `slice` behavior.",
    "created_at": "2019-04-10T13:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382803",
    "user": "@jdemeyer"
}
```

Some more comments:

1. Moving the handling of `sort=None` to `GenericGraph` (in line with [comment:17])

2. `self._sort_edges = False if sort is False else True` should be simply `self._sort_edges = sort` then (since `_sort_edges` is declared `bint`, Cython automatically does the conversion to `bool`)

3. `self._graph = <GenericGraph_pyx>G` is very dangerous as no type check is done. Replace this by `self._graph = <GenericGraph_pyx?>G` which is the same, except that an exception is raised by Cython if `G` is not an instance of `GenericGraph_pyx`.

4. Use `def __add__(left, right)` instead of `def __add__(self, other)` since using the name `self` here is potentially confusing. Same for `__mul__`.

5. I have some doubts about `start, stop, step = i.start or 0, i.stop or sys_maxsize, i.step or 1` but I'll need to check precise `slice` behavior.



---

archive/issue_comments_382804.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T13:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382804",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382805.json:
```json
{
    "body": "I treated 1-4.\n\nfor `slice`, I followed the suggestion at https://docs.python.org/3/library/itertools.html#itertools.islice, but I agree it's not so clear.",
    "created_at": "2019-04-10T13:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382805",
    "user": "@dcoudert"
}
```

I treated 1-4.

for `slice`, I followed the suggestion at https://docs.python.org/3/library/itertools.html#itertools.islice, but I agree it's not so clear.



---

archive/issue_comments_382806.json:
```json
{
    "body": "This should `return NotImplemented`:\n\n```\n        if not isinstance(right, EdgesView):\n            raise TypeError('right is not a EdgesView')\n```\n",
    "created_at": "2019-04-10T14:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382806",
    "user": "@jdemeyer"
}
```

This should `return NotImplemented`:

```
        if not isinstance(right, EdgesView):
            raise TypeError('right is not a EdgesView')
```




---

archive/issue_comments_382807.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T14:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382807",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382808.json:
```json
{
    "body": "I don't quite like this code:\n\n```\n        if self._sort_edges is True:\n            self._sort_edges = False\n            yield from sorted(self, key=self._sort_edges_key)\n            self._sort_edges = True\n        elif self._sort_edges is None:\n            self._sort_edges = False\n            yield from sorted(self)\n            self._sort_edges = True\n```\n\nFirst of all, the condition should be `if self._sort_edges:`, dropping the `None` case. Second, mutating `_sort_edges` like this looks dangerous: what if the iteration is interrupted for example? Two alternatives:\n\nA. Create a new `EdgesView` with `sorted=False` and use that to iterate.\n\nB. Factor out the iteration-without-sorting to a separate method and call that from `__iter__`.",
    "created_at": "2019-04-10T14:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382808",
    "user": "@jdemeyer"
}
```

I don't quite like this code:

```
        if self._sort_edges is True:
            self._sort_edges = False
            yield from sorted(self, key=self._sort_edges_key)
            self._sort_edges = True
        elif self._sort_edges is None:
            self._sort_edges = False
            yield from sorted(self)
            self._sort_edges = True
```

First of all, the condition should be `if self._sort_edges:`, dropping the `None` case. Second, mutating `_sort_edges` like this looks dangerous: what if the iteration is interrupted for example? Two alternatives:

A. Create a new `EdgesView` with `sorted=False` and use that to iterate.

B. Factor out the iteration-without-sorting to a separate method and call that from `__iter__`.



---

archive/issue_comments_382809.json:
```json
{
    "body": "Replying to [comment:70 jdemeyer]:\n> This should `return NotImplemented`:\n> {{{\n>         if not isinstance(right, EdgesView):\n>             raise TypeError('right is not a EdgesView')\n> }}}\n\nActually, looking better at `__add__`, you're not really assuming anything about the types of `left` and `right`, only that they are iterable. So why not just drop the condition completely and allow any iterable for `left` and `right`? That would also solve the case `list` + `EdgesView` for example.",
    "created_at": "2019-04-10T14:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382809",
    "user": "@jdemeyer"
}
```

Replying to [comment:70 jdemeyer]:
> This should `return NotImplemented`:
> {{{
>         if not isinstance(right, EdgesView):
>             raise TypeError('right is not a EdgesView')
> }}}

Actually, looking better at `__add__`, you're not really assuming anything about the types of `left` and `right`, only that they are iterable. So why not just drop the condition completely and allow any iterable for `left` and `right`? That would also solve the case `list` + `EdgesView` for example.



---

archive/issue_comments_382810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T16:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382810",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382811.json:
```json
{
    "body": "- for the iterator, I added a method to iterate unsorted edges. This is cleaner now.\n\n- for `__add__`, I tried to drop tests and got\n\n```\nFile \"src/sage/graphs/views.pyx\", line 628, in sage.graphs.views.EdgesView.__add__\nFailed example:\n    E + 'foo'\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: unsupported operand type(s) for +: 'sage.graphs.views.EdgesView' and 'str'\nGot:\n    [(0, 1, None),\n     (0, 2, None),\n     (1, 3, None),\n     (2, 3, None),\n     (2, 4, None),\n     (3, 4, None),\n     'f',\n     'o',\n     'o']\n```\n\n  So I added a test on `left`.",
    "created_at": "2019-04-10T16:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382811",
    "user": "@dcoudert"
}
```

- for the iterator, I added a method to iterate unsorted edges. This is cleaner now.

- for `__add__`, I tried to drop tests and got

```
File "src/sage/graphs/views.pyx", line 628, in sage.graphs.views.EdgesView.__add__
Failed example:
    E + 'foo'
Expected:
    Traceback (most recent call last):
    ...
    TypeError: unsupported operand type(s) for +: 'sage.graphs.views.EdgesView' and 'str'
Got:
    [(0, 1, None),
     (0, 2, None),
     (1, 3, None),
     (2, 3, None),
     (2, 4, None),
     (3, 4, None),
     'f',
     'o',
     'o']
```

  So I added a test on `left`.



---

archive/issue_comments_382812.json:
```json
{
    "body": "This is twice the same condition :-)\n\n```\nif not isinstance(right, EdgesView) or not isinstance(right, EdgesView):\n```\n",
    "created_at": "2019-04-12T12:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382812",
    "user": "@jdemeyer"
}
```

This is twice the same condition :-)

```
if not isinstance(right, EdgesView) or not isinstance(right, EdgesView):
```




---

archive/issue_comments_382813.json:
```json
{
    "body": "For `__add__`, I really meant allowing `EdgesView` + `list`. Otherwise, `EdgesView` + `EdgesView` works but `EdgesView` + `EdgesView` + `EdgesView` does not. That would be strange. So, if you want to keep the condition, you should check for `isinstance(..., (list, EdgesView))`.\n\nFor the deprecation warning for the `sort` keyword to be meaningful, `sort=None` should be the default. You could also consider setting `sort=True` automatically whenever a `key` is given.",
    "created_at": "2019-04-12T12:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382813",
    "user": "@jdemeyer"
}
```

For `__add__`, I really meant allowing `EdgesView` + `list`. Otherwise, `EdgesView` + `EdgesView` works but `EdgesView` + `EdgesView` + `EdgesView` does not. That would be strange. So, if you want to keep the condition, you should check for `isinstance(..., (list, EdgesView))`.

For the deprecation warning for the `sort` keyword to be meaningful, `sort=None` should be the default. You could also consider setting `sort=True` automatically whenever a `key` is given.



---

archive/issue_comments_382814.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-12T12:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382814",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382815.json:
```json
{
    "body": "Replying to [comment:76 jdemeyer]:\n> This is twice the same condition :-)\n> {{{\n> if not isinstance(right, EdgesView) or not isinstance(right, EdgesView):\n> }}}\n\nnot always easy to focus on something...\n  \nReplying to [comment:77 jdemeyer]:\n> For `__add__`, I really meant allowing `EdgesView` + `list`. Otherwise, `EdgesView` + `EdgesView` works but `EdgesView` + `EdgesView` + `EdgesView` does not. That would be strange. So, if you want to keep the condition, you should check for `isinstance(..., (list, EdgesView))`.\n\n\nI changed to use `isinstance(..., (list, EdgesView))`, and added a doctest with the some a 3 `EdgesView`\n \n> For the deprecation warning for the `sort` keyword to be meaningful, `sort=None` should be the default. You could also consider setting `sort=True` automatically whenever a `key` is given.\n\nActually, I'm not so sure of what we should do. The current default is `True` and `None` has never been used here. So introducing `None` might not be a good idea. Consequently, adding a deprecation warning is this ticket might be confusing. It is certainly better to make a specific / clearly identified ticket for that. Do you agree ?",
    "created_at": "2019-04-12T12:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382815",
    "user": "@dcoudert"
}
```

Replying to [comment:76 jdemeyer]:
> This is twice the same condition :-)
> {{{
> if not isinstance(right, EdgesView) or not isinstance(right, EdgesView):
> }}}

not always easy to focus on something...
  
Replying to [comment:77 jdemeyer]:
> For `__add__`, I really meant allowing `EdgesView` + `list`. Otherwise, `EdgesView` + `EdgesView` works but `EdgesView` + `EdgesView` + `EdgesView` does not. That would be strange. So, if you want to keep the condition, you should check for `isinstance(..., (list, EdgesView))`.


I changed to use `isinstance(..., (list, EdgesView))`, and added a doctest with the some a 3 `EdgesView`
 
> For the deprecation warning for the `sort` keyword to be meaningful, `sort=None` should be the default. You could also consider setting `sort=True` automatically whenever a `key` is given.

Actually, I'm not so sure of what we should do. The current default is `True` and `None` has never been used here. So introducing `None` might not be a good idea. Consequently, adding a deprecation warning is this ticket might be confusing. It is certainly better to make a specific / clearly identified ticket for that. Do you agree ?



---

archive/issue_comments_382816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-06T16:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382816",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382817.json:
```json
{
    "body": "in the doctest in `matroids/utilities.py`, I also changed `'a'` to `55` to avoid py2/py3 issues.",
    "created_at": "2019-05-06T16:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382817",
    "user": "@dcoudert"
}
```

in the doctest in `matroids/utilities.py`, I also changed `'a'` to `55` to avoid py2/py3 issues.



---

archive/issue_comments_382818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-12T07:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382818",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382819.json:
```json
{
    "body": "just fixed a merge conflict with 8.8.rc0.",
    "created_at": "2019-06-12T07:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382819",
    "user": "@dcoudert"
}
```

just fixed a merge conflict with 8.8.rc0.



---

archive/issue_comments_382820.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382820",
    "user": "@embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_382821.json:
```json
{
    "body": "*(1) in python2, maybe we need `__nonzero__` as an alias for `__bool__` ?\n\n*(2) the implementation of `__bool__` does not look optimal.. maybe trying to iter would be better ?\n\n**EDIT**: point (1) is probably not needed, because this is a cython file.",
    "created_at": "2019-07-14T09:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382821",
    "user": "@fchapoton"
}
```

*(1) in python2, maybe we need `__nonzero__` as an alias for `__bool__` ?

*(2) the implementation of `__bool__` does not look optimal.. maybe trying to iter would be better ?

**EDIT**: point (1) is probably not needed, because this is a cython file.



---

archive/issue_comments_382822.json:
```json
{
    "body": "Replying to [comment:85 chapoton]:\n> * the implementation of `__bool__` does not look optimal.. maybe trying to iter would be better ?\n\nIndeed, if it has to go through `return sum(1 for _ in self)` it is rather suboptimal. You can use the funny\n\n```\n    for _ in self: return True\n    return False\n```\n",
    "created_at": "2019-07-14T09:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382822",
    "user": "@videlec"
}
```

Replying to [comment:85 chapoton]:
> * the implementation of `__bool__` does not look optimal.. maybe trying to iter would be better ?

Indeed, if it has to go through `return sum(1 for _ in self)` it is rather suboptimal. You can use the funny

```
    for _ in self: return True
    return False
```




---

archive/issue_comments_382823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-14T12:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382823",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382824.json:
```json
{
    "body": "I did something more complex but certainly more efficient than `for _ in self:` to avoid the cost of extracting edge labels and to sort edges (when `_sort_edges is True`).\n\nLet me know if I should or not add `__nonzero__`.",
    "created_at": "2019-07-14T12:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382824",
    "user": "@dcoudert"
}
```

I did something more complex but certainly more efficient than `for _ in self:` to avoid the cost of extracting edge labels and to sort edges (when `_sort_edges is True`).

Let me know if I should or not add `__nonzero__`.



---

archive/issue_comments_382825.json:
```json
{
    "body": "* in src/sage/graphs/connectivity.pyx, do we need to wrap with list?",
    "created_at": "2019-07-20T11:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382825",
    "user": "@fchapoton"
}
```

* in src/sage/graphs/connectivity.pyx, do we need to wrap with list?



---

archive/issue_comments_382826.json:
```json
{
    "body": "The graph is modified inside the loop, so yes we need to wrap with list.",
    "created_at": "2019-07-20T13:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382826",
    "user": "@dcoudert"
}
```

The graph is modified inside the loop, so yes we need to wrap with list.



---

archive/issue_comments_382827.json:
```json
{
    "body": "do you want to wait for another round of review by Jeroen ?\n\nif not, you can set to positive on my behalf",
    "created_at": "2019-07-20T14:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382827",
    "user": "@fchapoton"
}
```

do you want to wait for another round of review by Jeroen ?

if not, you can set to positive on my behalf



---

archive/issue_comments_382828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-21T23:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382828",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382829.json:
```json
{
    "body": "I had to fix a small issue induced by recent change in `graph_coloring.pyx`.",
    "created_at": "2019-07-21T23:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382829",
    "user": "@dcoudert"
}
```

I had to fix a small issue induced by recent change in `graph_coloring.pyx`.



---

archive/issue_comments_382830.json:
```json
{
    "body": "Let's wait for the patchbot to see if everything is in order, but for me this patch is now good to go (and the html documentation displays well).",
    "created_at": "2019-07-22T00:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382830",
    "user": "@dcoudert"
}
```

Let's wait for the patchbot to see if everything is in order, but for me this patch is now good to go (and the html documentation displays well).



---

archive/issue_comments_382831.json:
```json
{
    "body": "I let you guys decide if another round of review is necessary or not.\n\nAs this is a big change, shouldn't we add a specific note in the release changelog or in the documentation of the graph module ?\n(by the way, sage-8.8.txt is missing in the [Changelogs](https://www.sagemath.org/changelogs/index.html) page)",
    "created_at": "2019-07-31T14:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382831",
    "user": "@dcoudert"
}
```

I let you guys decide if another round of review is necessary or not.

As this is a big change, shouldn't we add a specific note in the release changelog or in the documentation of the graph module ?
(by the way, sage-8.8.txt is missing in the [Changelogs](https://www.sagemath.org/changelogs/index.html) page)



---

archive/issue_comments_382832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T16:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382832",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382833.json:
```json
{
    "body": "When reading [this thread](https://groups.google.com/forum/#!msg/sage-devel/rg4lXvJT8Rk/9_dfhoRjAQAJ) i was surprised not to be in cc of this ticket as it refers to an email of mine, now i realize that there is a confusion in names between Nicolas Thi\u00e9ry and Thierry Monteil (it is not the first time). I had some plans to implement that, but i am even happier that someone did the job, i will have a look to the branch.",
    "created_at": "2019-09-23T19:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382833",
    "user": "tmonteil"
}
```

When reading [this thread](https://groups.google.com/forum/#!msg/sage-devel/rg4lXvJT8Rk/9_dfhoRjAQAJ) i was surprised not to be in cc of this ticket as it refers to an email of mine, now i realize that there is a confusion in names between Nicolas Thiry and Thierry Monteil (it is not the first time). I had some plans to implement that, but i am even happier that someone did the job, i will have a look to the branch.



---

archive/issue_comments_382834.json:
```json
{
    "body": "Any feedback is more than welcome, and if happy, you can set to positive. We will also have to work on vertices and neighbors views.",
    "created_at": "2019-09-24T07:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382834",
    "user": "@dcoudert"
}
```

Any feedback is more than welcome, and if happy, you can set to positive. We will also have to work on vertices and neighbors views.



---

archive/issue_comments_382835.json:
```json
{
    "body": "It would be good to have this feature inside 9.0.",
    "created_at": "2019-10-07T10:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382835",
    "user": "@dcoudert"
}
```

It would be good to have this feature inside 9.0.



---

archive/issue_comments_382836.json:
```json
{
    "body": "ok, let it be.\n\nVincent, si tu veux faire une objection, c'est le moment.",
    "created_at": "2019-11-29T20:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382836",
    "user": "@fchapoton"
}
```

ok, let it be.

Vincent, si tu veux faire une objection, c'est le moment.



---

archive/issue_comments_382837.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-29T20:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382837",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_382838.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-30T13:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27171",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27171#issuecomment-382838",
    "user": "@vbraun"
}
```

Resolution: fixed
