# Issue 26265: failing optional internet doctests in sage/combinat/designs

Issue created by migration from https://trac.sagemath.org/ticket/26502

Original creator: slabbe

Original creation time: 2018-10-18 10:00:38

CC:  slelievre

The command


```
sage -t --long --optional=sage,internet src/sage/combinat/designs/covering_design.py src/sage/combinat/designs/design_catalog.py
```


gives


```
----------------------------------------------------------------------
sage -t --long --warn-long 80.6 src/sage/combinat/designs/covering_design.py  # 2 doctests failed
sage -t --long --warn-long 80.6 src/sage/combinat/designs/design_catalog.py  # 3 doctests failed
----------------------------------------------------------------------
```


complete log below


```
Running doctests with ID 2018-10-18-11-57-37-ce10c176.
Git branch: develop
Using --optional=internet,memlimit,sage
Doctesting 2 files.
sage -t --long --warn-long 80.6 src/sage/combinat/designs/covering_design.py
**********************************************************************
File "src/sage/combinat/designs/covering_design.py", line 473, in sage.combinat.designs.covering_design.best_known_covering_design_www
Failed example:
    C = best_known_covering_design_www(7, 3, 2)   # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[1]>", line 1, in <module>
        C = best_known_covering_design_www(Integer(7), Integer(3), Integer(2))   # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py", line 503, in best_known_covering_design_www
        f = urlopen(url)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
        return opener.open(url, data, timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
        response = meth(req, response)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
        'http', request, response, code, msg, hdrs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 467, in error
        result = self._call_chain(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 654, in http_error_302
        return self.parent.open(new, timeout=req.timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
        response = meth(req, response)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
        'http', request, response, code, msg, hdrs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 473, in error
        return self._call_chain(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 556, in http_error_default
        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
    HTTPError: HTTP Error 404: Not Found
**********************************************************************
File "src/sage/combinat/designs/covering_design.py", line 474, in sage.combinat.designs.covering_design.best_known_covering_design_www
Failed example:
    print(C)                                     # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[2]>", line 1, in <module>
        print(C)                                     # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
1 item had failures:
   2 of   4 in sage.combinat.designs.covering_design.best_known_covering_design_www
    [49 tests, 2 failures, 0.42 s]
sage -t --long --warn-long 80.6 src/sage/combinat/designs/design_catalog.py
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 22, in sage.combinat.designs.design_catalog
Failed example:
    C = designs.best_known_covering_design_from_LJCR(7, 3, 2)   # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[1]>", line 1, in <module>
        C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))   # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py", line 503, in best_known_covering_design_www
        f = urlopen(url)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
        return opener.open(url, data, timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
        response = meth(req, response)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
        'http', request, response, code, msg, hdrs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 467, in error
        result = self._call_chain(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 654, in http_error_302
        return self.parent.open(new, timeout=req.timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
        response = meth(req, response)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
        'http', request, response, code, msg, hdrs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 473, in error
        return self._call_chain(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 556, in http_error_default
        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
    HTTPError: HTTP Error 404: Not Found
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 23, in sage.combinat.designs.design_catalog
Failed example:
    C                            # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[2]>", line 1, in <module>
        C                            # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 28, in sage.combinat.designs.design_catalog
Failed example:
    C.incidence_structure()      # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[3]>", line 1, in <module>
        C.incidence_structure()      # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
1 item had failures:
   3 of   5 in sage.combinat.designs.design_catalog
    [4 tests, 3 failures, 0.25 s]
----------------------------------------------------------------------
sage -t --long --warn-long 80.6 src/sage/combinat/designs/covering_design.py  # 2 doctests failed
sage -t --long --warn-long 80.6 src/sage/combinat/designs/design_catalog.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 0.7 seconds
```



---

Comment by slelievre created at 2018-10-18 16:41:57

The math databases and papers of CCR La Jolla have moved from
http://www.ccrwest.org to https://math.ccrwest.org.
----
New commits:


---

Comment by slelievre created at 2018-10-18 16:41:57

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-10-19 19:47:39

ok


---

Comment by chapoton created at 2018-10-19 19:47:39

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-20 19:02:34

Resolution: fixed


---

Comment by slabbe created at 2018-10-26 06:54:10

With 8.5.beta0, on another machine, I am now getting failures on the same file at the same place for another reason (SSL?) :


```
sage -t --long --warn-long 80.6 --optional=sage,optional,external src/sage/combinat/designs/design_catalog.py src/sage/combinat/designs/covering_design.py
```



```
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 22, in sage.combinat.designs.design_catalog
Failed example:
    C = designs.best_known_covering_design_from_LJCR(7, 3, 2)   # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[1]>", line 1, in <module>
        C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))   # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py", line 503, in best_known_covering_design_www
        f = urlopen(url)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
        return opener.open(url, data, timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 429, in open
        response = self._open(req, data)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 447, in _open
        '_open', req)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 1241, in https_open
        context=self._context)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 1198, in do_open
        raise URLError(err)
    URLError: <urlopen error [SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:726)>
**********************************************************************

...

----------------------------------------------------------------------
sage -t --long --warn-long 80.6 src/sage/combinat/designs/design_catalog.py  # 3 doctests failed
sage -t --long --warn-long 80.6 src/sage/combinat/designs/covering_design.py  # 2 doctests failed
----------------------------------------------------------------------
```



---

Comment by slabbe created at 2018-10-29 15:45:59

I was able to reproduce the issue with 8.5.beta1. I created #26592.


---

Comment by slabbe created at 2019-02-28 08:56:28

The errors fixed in this ticket are now back in 8.7.beta5. Did the url changed again?


---

Comment by slelievre created at 2019-02-28 09:14:42

It seems the database is now on Dan Gordon's webpage at

- http://dmgordon.org/cover/


---

Comment by slelievre created at 2019-02-28 09:15:40

Let's fix that at #26592.
