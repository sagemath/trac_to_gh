# Issue 30761: Compute the treelength of graphs

Issue created by migration from https://trac.sagemath.org/ticket/30998

Original creator: dcoudert

Original creation time: 2020-12-03 19:20:19

We add a method to compute the treelength of a graph. This measure of tree-likeness express how the metric structure of a graph is close to a tree metric.

Some implementation choices:
- Check if the input graph is chordal (treelength 1)
- Use decomposition by clique minimal separators as preprocessing, and so compute only the treelength of the atoms of the graph.
- Use isomorphisms between atoms to avoid computing the treelength of isomorphic atoms.
- Implement a specific class to compute the treelength of an atom (which is working for all graphs but without pre-processing)
- The main algorithm is an adaptation of algorithm `'sage'` for treewidth.


---

Comment by dcoudert created at 2020-12-03 19:21:29

New commits:


---

Comment by dcoudert created at 2020-12-03 19:21:29

Changing status from new to needs_review.


---

Comment by git created at 2020-12-03 21:19:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2020-12-03 21:20:24

Let's see if the doctest coverage is better this way.


---

Comment by git created at 2020-12-05 15:34:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2020-12-05 15:36:08

I have simplified some parts of the code.


---

Comment by dcoudert created at 2020-12-07 16:37:58

I will rebase this ticket on top of #30993 (and remove dependency on #30986 which has been merged in 9.3.beta3).


---

Comment by dcoudert created at 2020-12-07 16:37:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-12-07 17:52:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by dcoudert created at 2020-12-07 17:56:40

I have rebased this ticket over #30993 (instead of #30986). I hope I did it correctly...


---

Comment by dcoudert created at 2020-12-07 17:56:40

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by git created at 2021-09-18 15:51:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-09-18 15:52:43

Fix merge conflict with 9.5.beta1


---

Comment by tscrim created at 2021-10-03 08:47:09

Some little comments:

I know Matthias would like the `from sage.functions.other import ceil` import to be in the method that uses it to help him with the Sage modularization.

The text for `OUTPUT:` and `ALGORITHM:` should not be indented.

In `treelength()` and `_treelength()`, do you want to give some of your variables type information? For example, isn't `cc` a `set`?

Shouldn't `__destroy__` be `__dealloc__`?


```diff
-    TESTS::
+    TESTS:
 
     Check that the decomposition by clique separators is valid::
```



---

Comment by git created at 2021-10-03 10:54:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-10-03 10:56:46

I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.

Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.


---

Comment by tscrim created at 2021-10-03 11:31:54

Replying to [comment:15 dcoudert]:
> I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.

I meant for Cython, like `cdef list result`.

> Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.

That is quite surprising. Well, let's wait for the patchbot.


---

Comment by git created at 2021-10-03 12:25:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-10-03 12:27:18

I added a few type informations.

For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`.


---

Comment by tscrim created at 2021-10-03 12:36:50

Replying to [comment:18 dcoudert]:
> I added a few type informations.

Thanks. That should make it run a bit faster (although it probably is at the mirco-optimization level).

> For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`. 

Quite possibly. Anyways, if the patchbot comes back green, then positive review.


---

Comment by dcoudert created at 2021-10-03 15:32:08

A patchbot reports a reduction of the doctest coverage. I don't understand why. All methods (except methods defined inside another method) have either an `EXAMPLES` block or a `TESTS` block or both. Actually, 3 methods have only `TESTS` blocks and the patchbot says that the coverage is 11/14. Should I change these blocks to `EXAMPLES` (or add something) ?


---

Comment by tscrim created at 2021-10-03 23:22:17

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-10-03 23:22:17

It is picking up the internal functions:

```
travis@apricot:~/sage-build$ ./sage --coverage src/sage/graphs/graph_decompositions/tree_decomposition.pyx 
------------------------------------------------------------------------
SCORE src/sage/graphs/graph_decompositions/tree_decomposition.pyx: 78.6% (11 of 14)

Missing documentation:
     * line 1077: def rec(cut, cc)
     * line 1172: def good_label(x)
     * line 1175: def good_label(x)
```

so it's fine. My guess is this is a bug in the coverage script by not filtering them out properly because they are within a `cdef` function.


---

Comment by dcoudert created at 2021-10-04 06:00:44

Thank you for the review !


---

Comment by vbraun created at 2021-10-10 10:17:09

Resolution: fixed
