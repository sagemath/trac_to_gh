# Issue 30761: Compute the treelength of graphs

archive/issues_030761.json:
```json
{
    "body": "We add a method to compute the treelength of a graph. This measure of tree-likeness express how the metric structure of a graph is close to a tree metric.\n\nSome implementation choices:\n- Check if the input graph is chordal (treelength 1)\n- Use decomposition by clique minimal separators as preprocessing, and so compute only the treelength of the atoms of the graph.\n- Use isomorphisms between atoms to avoid computing the treelength of isomorphic atoms.\n- Implement a specific class to compute the treelength of an atom (which is working for all graphs but without pre-processing)\n- The main algorithm is an adaptation of algorithm `'sage'` for treewidth.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30998\n\n",
    "created_at": "2020-12-03T19:20:19Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "Compute the treelength of graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30761",
    "user": "dcoudert"
}
```
We add a method to compute the treelength of a graph. This measure of tree-likeness express how the metric structure of a graph is close to a tree metric.

Some implementation choices:
- Check if the input graph is chordal (treelength 1)
- Use decomposition by clique minimal separators as preprocessing, and so compute only the treelength of the atoms of the graph.
- Use isomorphisms between atoms to avoid computing the treelength of isomorphic atoms.
- Implement a specific class to compute the treelength of an atom (which is working for all graphs but without pre-processing)
- The main algorithm is an adaptation of algorithm `'sage'` for treewidth.

Issue created by migration from https://trac.sagemath.org/ticket/30998





---

archive/issue_comments_439648.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-03T19:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439648",
    "user": "dcoudert"
}
```

New commits:



---

archive/issue_comments_439649.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-03T19:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439649",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-03T21:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439650",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439651.json:
```json
{
    "body": "Let's see if the doctest coverage is better this way.",
    "created_at": "2020-12-03T21:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439651",
    "user": "dcoudert"
}
```

Let's see if the doctest coverage is better this way.



---

archive/issue_comments_439652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-05T15:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439652",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439653.json:
```json
{
    "body": "I have simplified some parts of the code.",
    "created_at": "2020-12-05T15:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439653",
    "user": "dcoudert"
}
```

I have simplified some parts of the code.



---

archive/issue_comments_439654.json:
```json
{
    "body": "I will rebase this ticket on top of #30993 (and remove dependency on #30986 which has been merged in 9.3.beta3).",
    "created_at": "2020-12-07T16:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439654",
    "user": "dcoudert"
}
```

I will rebase this ticket on top of #30993 (and remove dependency on #30986 which has been merged in 9.3.beta3).



---

archive/issue_comments_439655.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-07T16:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439655",
    "user": "dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_439656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-12-07T17:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439656",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_439657.json:
```json
{
    "body": "I have rebased this ticket over #30993 (instead of #30986). I hope I did it correctly...",
    "created_at": "2020-12-07T17:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439657",
    "user": "dcoudert"
}
```

I have rebased this ticket over #30993 (instead of #30986). I hope I did it correctly...



---

archive/issue_comments_439658.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-07T17:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439658",
    "user": "dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_439659.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439659",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_439660.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439660",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_439661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-18T15:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439661",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439662.json:
```json
{
    "body": "Fix merge conflict with 9.5.beta1",
    "created_at": "2021-09-18T15:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439662",
    "user": "dcoudert"
}
```

Fix merge conflict with 9.5.beta1



---

archive/issue_comments_439663.json:
```json
{
    "body": "Some little comments:\n\nI know Matthias would like the `from sage.functions.other import ceil` import to be in the method that uses it to help him with the Sage modularization.\n\nThe text for `OUTPUT:` and `ALGORITHM:` should not be indented.\n\nIn `treelength()` and `_treelength()`, do you want to give some of your variables type information? For example, isn't `cc` a `set`?\n\nShouldn't `__destroy__` be `__dealloc__`?\n\n\n```diff\n-    TESTS::\n+    TESTS:\n \n     Check that the decomposition by clique separators is valid::\n```\n",
    "created_at": "2021-10-03T08:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439663",
    "user": "tscrim"
}
```

Some little comments:

I know Matthias would like the `from sage.functions.other import ceil` import to be in the method that uses it to help him with the Sage modularization.

The text for `OUTPUT:` and `ALGORITHM:` should not be indented.

In `treelength()` and `_treelength()`, do you want to give some of your variables type information? For example, isn't `cc` a `set`?

Shouldn't `__destroy__` be `__dealloc__`?


```diff
-    TESTS::
+    TESTS:
 
     Check that the decomposition by clique separators is valid::
```




---

archive/issue_comments_439664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-03T10:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439664",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439665.json:
```json
{
    "body": "I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.\n\nSurprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.",
    "created_at": "2021-10-03T10:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439665",
    "user": "dcoudert"
}
```

I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.

Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.



---

archive/issue_comments_439666.json:
```json
{
    "body": "Replying to [comment:15 dcoudert]:\n> I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.\n\nI meant for Cython, like `cdef list result`.\n\n> Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.\n\nThat is quite surprising. Well, let's wait for the patchbot.",
    "created_at": "2021-10-03T11:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439666",
    "user": "tscrim"
}
```

Replying to [comment:15 dcoudert]:
> I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.

I meant for Cython, like `cdef list result`.

> Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.

That is quite surprising. Well, let's wait for the patchbot.



---

archive/issue_comments_439667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-03T12:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439667",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439668.json:
```json
{
    "body": "I added a few type informations.\n\nFor the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`.",
    "created_at": "2021-10-03T12:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439668",
    "user": "dcoudert"
}
```

I added a few type informations.

For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`.



---

archive/issue_comments_439669.json:
```json
{
    "body": "Replying to [comment:18 dcoudert]:\n> I added a few type informations.\n\nThanks. That should make it run a bit faster (although it probably is at the mirco-optimization level).\n\n> For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`. \n\nQuite possibly. Anyways, if the patchbot comes back green, then positive review.",
    "created_at": "2021-10-03T12:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439669",
    "user": "tscrim"
}
```

Replying to [comment:18 dcoudert]:
> I added a few type informations.

Thanks. That should make it run a bit faster (although it probably is at the mirco-optimization level).

> For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`. 

Quite possibly. Anyways, if the patchbot comes back green, then positive review.



---

archive/issue_comments_439670.json:
```json
{
    "body": "A patchbot reports a reduction of the doctest coverage. I don't understand why. All methods (except methods defined inside another method) have either an `EXAMPLES` block or a `TESTS` block or both. Actually, 3 methods have only `TESTS` blocks and the patchbot says that the coverage is 11/14. Should I change these blocks to `EXAMPLES` (or add something) ?",
    "created_at": "2021-10-03T15:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439670",
    "user": "dcoudert"
}
```

A patchbot reports a reduction of the doctest coverage. I don't understand why. All methods (except methods defined inside another method) have either an `EXAMPLES` block or a `TESTS` block or both. Actually, 3 methods have only `TESTS` blocks and the patchbot says that the coverage is 11/14. Should I change these blocks to `EXAMPLES` (or add something) ?



---

archive/issue_comments_439671.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-03T23:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439671",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439672.json:
```json
{
    "body": "It is picking up the internal functions:\n\n```\ntravis@apricot:~/sage-build$ ./sage --coverage src/sage/graphs/graph_decompositions/tree_decomposition.pyx \n------------------------------------------------------------------------\nSCORE src/sage/graphs/graph_decompositions/tree_decomposition.pyx: 78.6% (11 of 14)\n\nMissing documentation:\n     * line 1077: def rec(cut, cc)\n     * line 1172: def good_label(x)\n     * line 1175: def good_label(x)\n```\n\nso it's fine. My guess is this is a bug in the coverage script by not filtering them out properly because they are within a `cdef` function.",
    "created_at": "2021-10-03T23:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439672",
    "user": "tscrim"
}
```

It is picking up the internal functions:

```
travis@apricot:~/sage-build$ ./sage --coverage src/sage/graphs/graph_decompositions/tree_decomposition.pyx 
------------------------------------------------------------------------
SCORE src/sage/graphs/graph_decompositions/tree_decomposition.pyx: 78.6% (11 of 14)

Missing documentation:
     * line 1077: def rec(cut, cc)
     * line 1172: def good_label(x)
     * line 1175: def good_label(x)
```

so it's fine. My guess is this is a bug in the coverage script by not filtering them out properly because they are within a `cdef` function.



---

archive/issue_comments_439673.json:
```json
{
    "body": "Thank you for the review !",
    "created_at": "2021-10-04T06:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439673",
    "user": "dcoudert"
}
```

Thank you for the review !



---

archive/issue_comments_439674.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-10T10:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30761",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30761#issuecomment-439674",
    "user": "vbraun"
}
```

Resolution: fixed
