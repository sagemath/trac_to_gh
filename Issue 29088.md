# Issue 29088: Set up permutahedron with both Vrep and Hrep (if backend supports it)

Issue created by migration from https://trac.sagemath.org/ticket/29325

Original creator: @kliem

Original creation time: 2020-03-13 15:15:59

CC:  jipilab @laisrast

Keywords: polytopes, precomputed data, permutahedron

We set up the permutahedron with both Vrepresenation and Hrepresentation, if the backend supports it.

If the backend supports precomputed data (currently `field`) this is much faster. Otherwise, this is a bit faster, as the Hrepresentation seems to be the better choice.

Before this ticket:

```
sage: %timeit P = polytopes.permutahedron(6)  # using ppl
10 loops, best of 5: 56.5 ms per loop
sage: %timeit P = polytopes.permutahedron(7)  # using ppl
1 loop, best of 5: 1.57 s per loop
```


With this ticket:

```
sage: %timeit P = polytopes.permutahedron(6)  # using ppl
10 loops, best of 5: 34.2 ms per loop
sage: %timeit P = polytopes.permutahedron(7)  # using ppl
1 loop, best of 5: 1.04 s per loop
sage: %time P = polytopes.permutahedron(8, backend='field')
CPU times: user 587 ms, sys: 20 ms, total: 607 ms
Wall time: 607 ms
sage: %time P = polytopes.permutahedron(9, backend='field')
CPU times: user 5.08 s, sys: 248 ms, total: 5.33 s
Wall time: 5.33 s
```


Note that `field` is much slower than `ppl` before this ticket and the timings are therefore omitted.

As the order of Vrepresentation and Hrepresentation changes, a lot of tests need to be fixed.


---

Comment by @kliem created at 2020-03-13 15:29:25

New commits:


---

Comment by @kliem created at 2020-03-13 15:29:25

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by @kliem created at 2020-04-24 05:53:40

New commits:


---

Comment by jipilab created at 2020-05-11 13:08:56

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2020-05-11 13:08:56

These timings are interesting. Perhaps it would be good to add them to the documentation of the function? Since the backend `field` performs well but isn't the default, it would be good to give this information in the documentation.


---

Comment by @kliem created at 2020-05-11 14:00:42

New commits:


---

Comment by @kliem created at 2020-05-11 14:00:42

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2020-05-12 11:44:00

Failing doctests, see patchbot:


```
sage -t --long src/doc/en/thematic_tutorials/geometry/tips.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/geometry/tips.rst", line 110, in doc.en.thematic_tutorials.geometry.tips
Failed example:
    print(P.Hrepresentation_str(style='<='))
Expected:
    -x0 - x1 - x2 == -6
          x1 + x2 <=  5
               x2 <=  3
               x1 <=  3
              -x1 <= -1
         -x1 - x2 <= -3
              -x2 <= -1
Got:
    -x0 - x1 - x2 == -6 
         -x0 - x1 <= -3 
          x0 + x1 <=  5 
              -x1 <= -1 
               x0 <=  3 
              -x0 <= -1 
               x1 <=  3 
**********************************************************************
File "src/doc/en/thematic_tutorials/geometry/tips.rst", line 118, in doc.en.thematic_tutorials.geometry.tips
Failed example:
    print(P.Hrepresentation_str(style='positive'))
Expected:
    x0 + x1 + x2 == 6
               5 >= x1 + x2
               3 >= x2
               3 >= x1
              x1 >= 1
         x1 + x2 >= 3
              x2 >= 1
Got:
    x0 + x1 + x2 == 6      
         x0 + x1 >= 3      
               5 >= x0 + x1
              x1 >= 1      
               3 >= x0     
              x0 >= 1      
               3 >= x1     
**********************************************************************
```



```
----------------------------------------------------------------------
sage -t --long src/sage/schemes/cyclic_covers/charpoly_frobenius.py  # 1 doctest failed
sage -t --long src/sage/geometry/polyhedron/library.py  # Bad exit: 1
sage -t --long src/doc/en/thematic_tutorials/geometry/tips.rst  # 2 doctests failed
----------------------------------------------------------------------
```



---

Comment by jipilab created at 2020-05-12 11:44:00

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-05-12 12:33:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-05-12 12:33:55

As for the bad exit it appears that memory consumption is highly unstable during doctesting.
I can make it pass with 2400 MB and default is 3300 MB, so I would expect this to work anywhere, but I guess this is not the case. (And 2400 MB is much over what causes a bad exit for Sébastien Labbé).

I guess I just mark it as not tested. The examples are more for documentation than for testing.
----
New commits:


---

Comment by @kliem created at 2020-05-12 12:34:03

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-07-04 19:31:41

"not tested" seems like the right choice for this.


---

Comment by mkoeppe created at 2020-08-11 17:22:50

Needs rebase


---

Comment by mkoeppe created at 2020-08-11 17:22:58

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-08-11 22:17:47

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-08-11 22:17:47

New commits:


---

Comment by mkoeppe created at 2020-08-12 05:15:30

these doctests that seem to depend on an unspecified order of enumeration... is there not a better way of testing this, for example by sorting...?


---

Comment by @kliem created at 2020-08-12 06:07:17

There is only a few doctests that can be fixed by sorting. The face iterator really behaves different with different order and the indices are all shuffled.


---

Comment by @kliem created at 2020-08-12 06:09:41

And the first ones cannot be fixed by this either. Looks like `ppl` picks a different representative for the inequalities (that are modulo an equation).


---

Comment by mkoeppe created at 2020-08-12 22:53:09

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-08-12 22:53:14

Ok then


---

Comment by @kliem created at 2020-08-13 05:23:07

Thank you.


---

Comment by vbraun created at 2020-08-15 09:41:43

Resolution: fixed
