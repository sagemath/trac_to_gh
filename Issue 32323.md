# Issue 32323: unexpected behavior of aspect_ratio in threejs template

Issue created by migration from https://trac.sagemath.org/ticket/32560

Original creator: @LaisRast

Original creation time: 2021-09-25 15:27:25

CC:  slelievre egourgoulhon paulmasson

Keywords: threejs, aspect_ratio

`threejs_template.html` overwrites the last entry in the parameter `aspect_ratio` to provide an automatic scaling in the z-axis.

For instance, the following example

```
sage: plot = sum([cube((0,0,i)) for i in range(0,6)])
....: plot.show(aspect_ratio=[1,1,1])
```

will produce a stack of cubes squeezed along the z-axis.

This behavior is unexpected since the user provided the scaling they want.
This behavior is also not documented. I looked into the file `threejs_template.html` and I found the lines responsible for this behavior:

```
    var autoAspect = 2.5;
    if ( zRange > autoAspect * rRange && a[2] === 1 ) a[2] = autoAspect * rRange / zRange;
```


It turned out that the autmatic scaling was introduced in #12402. I quote the following text from that ticket:
>  There is already automatic scaling in the z-direction to avoid the tall thin box that appears in the current version on the cell server (and SMC), but that can easily be overridden.


It is worth mentioning that one way to overwrite this behavior is to do:

```
sage: plot.show(aspect_ratio=[1,1,0.99999])
```


I suggest to remove these 2 lines from the file,
or at the least, document it so the user can expect this behavior.


---

Comment by guenterrote created at 2021-10-04 11:33:18

This example shows the distortion in a more conspicuous way:

```
sage: plot = sum([cube((0,0,i)) for i in range(0,10,2)])
....: plot.show(aspect_ratio=[1,1,1])
```

Apparently this automatic distortion was inserted as a hack to deal with some specific example that looked bad? It should be removed!

If such an automatic scaling feature is at all desired, it should be triggered by something like
_aspect_ratio=[1,1,"automatic"]_


---

Comment by guenterrote created at 2021-10-07 12:44:44

Changing type from PLEASE CHANGE to defect.


---

Comment by @LaisRast created at 2021-10-07 13:20:37

It turns out this behavior is documented.
In the current version of `reference/plot3d/threejs.html` (see page https://doc.sagemath.org/html/en/reference/plot3d/threejs.html) it says
> aspect_ratio – (default: [1,1,1]) list or tuple of three numeric values; z-aspect is automatically reduced when large but can be overridden

However, I still believe it should not be the default behavior.
Following Günter's suggestion, we can do

```diff
    var autoAspect = 2.5;
-    if ( zRange > autoAspect * rRange && a[2] === 1 ) a[2] = autoAspect * rRange / zRange;
+    if ( zRange > autoAspect * rRange && a[2] === "automatic" ) a[2] = autoAspect * rRange / zRange;

```



---

Comment by @LaisRast created at 2021-10-14 14:13:48

Changing status from new to needs_review.


---

Comment by git created at 2021-10-14 15:02:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by mkoeppe created at 2022-03-08 20:15:11

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-03-08 20:15:11

This is a nice improvement.


---

Comment by vbraun created at 2022-03-12 15:10:57

Resolution: fixed
