# Issue 20364: Issue @experimental warnings only once

Issue created by migration from Trac.

Original creator: jsrn

Original creation time: 2016-05-13 07:38:09

CC:  dlucas dkrenn tmonteil

Keywords: warnings, experimental

Marking a function/method/constructor as ``@`experimental` causes the experimental warning message to be issued every time. This seems to be due to a general convention in Sage that warnings are issued repeatedly.

That convention leaves ``@`experimental` virtually useless, however, since the user is clearly aware of the experimental nature of the code after the first issuing of the warning, but nonetheless chooses to keep on using it.

This patch makes sure that the ``@`experimental` warnings are issued only once (without changing behaviour for other warnings)


---

Comment by git created at 2016-05-13 07:44:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-05-13 07:49:37

I've implemented a flag so ``@`experimental` knows whether it has already issued a warning or not. The flag works as expected in the terminal.

However, during doc-testing I get strange behaviour: I wanted to add a test to demonstrate that an error message is now only issued on the first call. However, the test passes even without the patch! This is in stark contrast to the behaviour in the terminal, where the message (copy-paste the code from the doc-tested) is definitely issued every time. There is some magic in either Sphinx or the terminal interface that I'm not understanding here.

(more data is that #20526, commit 0ab93ec currently has all doc-tests failing due to experimental warnings being issued, but with this patch, all the tests pass)


---

Comment by jsrn created at 2016-05-13 07:49:37

Changing status from new to needs_review.


---

Comment by git created at 2016-05-13 08:14:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-05-13 08:18:02

I managed to make a test that properly demonstrates the behaviour: without the patch, the test fails since extra `FutureWarning`s are issued, while the test passes with the patch.

Due to aforementioned Sphinx magic the test is a bit complicated: it seems the test has to involve a "real" function/class and span multiple documentation strings, so I've added a class `__experimental_self_test` for this purpose.

Note that this behaviour is really critical, i.e. that only a single warning is issued across documentation strings: if not, a class that is marked as ``@`experimental` would need to add the `FutureWarning` to *all* documentation strings in the entire file. With this patch, only a single at the top needs to be added (e.g. together with the documentation text that describes that the functionality is experimental).

The patch is still in needs review.


---

Comment by jdemeyer created at 2016-05-13 08:22:06

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-05-13 08:22:06

Detail: replace `#20601` by `:trac:`20601`` in docstrings.


---

Comment by git created at 2016-05-13 09:07:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-05-13 09:08:37

Done.


---

Comment by jsrn created at 2016-05-13 09:08:37

Changing status from needs_work to needs_review.


---

Comment by dlucas created at 2016-05-13 11:55:04

Hello,

It works (I tested it in #20526 and it fixed my problem with experimental warnings), the doc looks good...
But does not compile because you wrote `:method:` instead of `:meth:` l. 222 in `superseded.py`.

If you fix that I'll set this ticket to positive review.


---

Comment by git created at 2016-05-13 12:01:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-05-13 12:02:36

Stupid of me: I forgot `./sage -b` before recompiling the doc and hence didn't see the error. Fixed now.


---

Comment by dlucas created at 2016-05-13 12:08:25

Changing status from needs_review to positive_review.


---

Comment by dlucas created at 2016-05-13 12:08:25

Great, I'm giving the green light!

David


---

Comment by jsrn created at 2016-05-13 12:15:13

Awesome, thanks!


---

Comment by tscrim created at 2016-05-13 15:48:40

Reviewer name(s)


---

Comment by dlucas created at 2016-05-13 16:39:56

> Reviewer name(s)

Oops. Done now!


---

Comment by vbraun created at 2016-05-20 22:52:45

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-05-20 22:52:45

Various doctest failures, e.g.

```
sage -t --long --warn-long 40.7 src/sage/rings/asymptotic/asymptotic_ring.py
**********************************************************************
File "src/sage/rings/asymptotic/asymptotic_ring.py", line 109, in sage.rings.asymptotic.asymptotic_ring
Failed example:
    R.<x, y> = AsymptoticRing(growth_group='x^ZZ * y^ZZ', coefficient_ring=ZZ)
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as
    experimental. It, its functionality or its interface might change
    without a formal deprecation.
    See http://trac.sagemath.org/17601 for details.
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of  44 in sage.rings.asymptotic.asymptotic_ring
    [583 tests, 1 failure, 7.26 s]
```



---

Comment by git created at 2016-05-23 07:45:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-05-23 07:46:06

Indeed, fixed.


---

Comment by jsrn created at 2016-05-23 07:46:06

Changing status from needs_work to needs_review.


---

Comment by dlucas created at 2016-05-24 13:07:22

Changing status from needs_review to positive_review.


---

Comment by dlucas created at 2016-05-24 13:07:22

I ran the tests and it works on my side, setting to `positive_review`.

David


---

Comment by vbraun created at 2016-05-24 22:25:40

Resolution: fixed


---

Comment by mkoeppe created at 2020-03-30 01:15:00

Follow-up: #29272
