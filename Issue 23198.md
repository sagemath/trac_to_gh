# Issue 23198: Dynamic classes of extension types should behave like extension types

archive/issues_023198.json:
```json
{
    "body": "CC:  @nthiery @tscrim\n\nWhen `dynamic_class()` creates a class whose base classes are all extension types, the new dynamic class is created with `__slots__ = []` such that it behaves more like an extension type.\n\nThe goal of this ticket is to reduce the performance penalty when replacing an extension type by a dynamic class: extension types and Python classes with `__slots__` have no `__dict__` which speeds up all attribute accesses.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23435\n\n",
    "created_at": "2017-07-14T14:40:10Z",
    "labels": [
        "performance",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Dynamic classes of extension types should behave like extension types",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23198",
    "user": "@jdemeyer"
}
```
CC:  @nthiery @tscrim

When `dynamic_class()` creates a class whose base classes are all extension types, the new dynamic class is created with `__slots__ = []` such that it behaves more like an extension type.

The goal of this ticket is to reduce the performance penalty when replacing an extension type by a dynamic class: extension types and Python classes with `__slots__` have no `__dict__` which speeds up all attribute accesses.

Issue created by migration from https://trac.sagemath.org/ticket/23435





---

archive/issue_comments_324567.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-14T15:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324567",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_324568.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-07-14T15:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324568",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_324569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-14T21:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324569",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_324570.json:
```json
{
    "body": "Some doctests in `src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst` involving `sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class` break.",
    "created_at": "2017-07-15T08:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324570",
    "user": "@jdemeyer"
}
```

Some doctests in `src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst` involving `sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class` break.



---

archive/issue_comments_324571.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-15T08:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324571",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_324572.json:
```json
{
    "body": "I am pretty sure the problem comes from a missed an `is_extension_type()` in `__make_element_class__` in `parent.pyx`.",
    "created_at": "2017-08-28T17:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324572",
    "user": "@tscrim"
}
```

I am pretty sure the problem comes from a missed an `is_extension_type()` in `__make_element_class__` in `parent.pyx`.



---

archive/issue_comments_324573.json:
```json
{
    "body": "(Edit: I misinterpreted your comment)",
    "created_at": "2017-08-28T20:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324573",
    "user": "@jdemeyer"
}
```

(Edit: I misinterpreted your comment)



---

archive/issue_comments_324574.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-29T10:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324574",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324575.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-29T10:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324575",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_324576.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-30T08:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324576",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324577.json:
```json
{
    "body": "I doubt anyone is using the features provided from having a `__dict__`. So I think the better solution would be to change the tutorial because the `CFM.element_class` is really just a workaround not inheriting properly from the category implementation. Because once we remove that workaround, we would run into the same problem.\n\nAlso, IMO this test is not accurate (or at least somewhat misleading):\n\n```\nSome particular actions modify the data structure of ``el``::\n\n    sage: el.rename(\"bla\")\n    sage: el\n    bla\n```\n\nFor the tests that are failing in the `.. NOTE::`, we can just change it to, e.g., `E.<x,y> = algebras.Exterior(QQ)` that has a proper Python subclass.\n\nDoes this sound okay?",
    "created_at": "2017-08-30T14:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324577",
    "user": "@tscrim"
}
```

I doubt anyone is using the features provided from having a `__dict__`. So I think the better solution would be to change the tutorial because the `CFM.element_class` is really just a workaround not inheriting properly from the category implementation. Because once we remove that workaround, we would run into the same problem.

Also, IMO this test is not accurate (or at least somewhat misleading):

```
Some particular actions modify the data structure of ``el``::

    sage: el.rename("bla")
    sage: el
    bla
```

For the tests that are failing in the `.. NOTE::`, we can just change it to, e.g., `E.<x,y> = algebras.Exterior(QQ)` that has a proper Python subclass.

Does this sound okay?



---

archive/issue_comments_324578.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n> For the tests that are failing in the `.. NOTE::`, we can just change it to, e.g., `E.<x,y> = algebras.Exterior(QQ)` that has a proper Python subclass.\n> \n> Does this sound okay?\n\nI would rather prefer to just remove those examples. I don't think it makes sense to document something as a feature when that feature depends on the implementation detail of whether the class has a `__dict__`. With your proposal, we would get breakage again if someone decides that `algebras.Exterior` should be implemented in Cython.",
    "created_at": "2017-08-30T14:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324578",
    "user": "@jdemeyer"
}
```

Replying to [comment:12 tscrim]:
> For the tests that are failing in the `.. NOTE::`, we can just change it to, e.g., `E.<x,y> = algebras.Exterior(QQ)` that has a proper Python subclass.
> 
> Does this sound okay?

I would rather prefer to just remove those examples. I don't think it makes sense to document something as a feature when that feature depends on the implementation detail of whether the class has a `__dict__`. With your proposal, we would get breakage again if someone decides that `algebras.Exterior` should be implemented in Cython.



---

archive/issue_comments_324579.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Replying to [comment:12 tscrim]:\n> > For the tests that are failing in the `.. NOTE::`, we can just change it to, e.g., `E.<x,y> = algebras.Exterior(QQ)` that has a proper Python subclass.\n> > \n> > Does this sound okay?\n> \n> I would rather prefer to just remove those examples. I don't think it makes sense to document something as a feature when that feature depends on the implementation detail of whether the class has a `__dict__`. With your proposal, we would get breakage again if someone decides that `algebras.Exterior` should be implemented in Cython.\n\nGood point. What about doing a custom class for that example, since it is about showing the difference between Python and Cython, which is a point that should be made? (Of course, I am happy to remove the \"changing data structure\" test.)",
    "created_at": "2017-08-30T15:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324579",
    "user": "@tscrim"
}
```

Replying to [comment:13 jdemeyer]:
> Replying to [comment:12 tscrim]:
> > For the tests that are failing in the `.. NOTE::`, we can just change it to, e.g., `E.<x,y> = algebras.Exterior(QQ)` that has a proper Python subclass.
> > 
> > Does this sound okay?
> 
> I would rather prefer to just remove those examples. I don't think it makes sense to document something as a feature when that feature depends on the implementation detail of whether the class has a `__dict__`. With your proposal, we would get breakage again if someone decides that `algebras.Exterior` should be implemented in Cython.

Good point. What about doing a custom class for that example, since it is about showing the difference between Python and Cython, which is a point that should be made? (Of course, I am happy to remove the "changing data structure" test.)



---

archive/issue_comments_324580.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-09-18T11:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324580",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_324581.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-19T15:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324581",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_324582.json:
```json
{
    "body": "Let it be so.",
    "created_at": "2017-09-19T15:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324582",
    "user": "@tscrim"
}
```

Let it be so.



---

archive/issue_comments_324583.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23198#issuecomment-324583",
    "user": "@vbraun"
}
```

Resolution: fixed
