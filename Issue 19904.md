# Issue 19904: Cysignals tests fail

Issue created by migration from https://trac.sagemath.org/ticket/20141

Original creator: vbraun

Original creation time: 2016-02-29 19:49:38

CC:  jdemeyer vdelecroix fbissey malb

Unter certain conditions cysignal tests fail (building with `SAGE_CHECK=yes`). This is on the buildbot so directories are the same as always. Possibly triggered by a full rebuild:

```
[...]
python -m doctest src/cysignals/*.pyx
cd example && python setup.py build
sys:1: RuntimeWarning: not adding directory '' to sys.path since it's writable by an untrusted group.
Untrusted users could put files in this directory which might then be imported by your Python code. As a general precaution from similar exploits, you should not execute Python code from this directory
Compiling cysignals_example.pyx because it changed.
[1/1] Cythonizing cysignals_example.pyx
running build
running build_ext
building 'cysignals_example' extension
creating build
creating build/temp.macosx-10.9-x86_64-2.7
gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.10.p0/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c cysignals_example.c -o build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o
creating build/lib.macosx-10.9-x86_64-2.7
gcc -bundle -undefined dynamic_lookup -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o -L/Users/buildslave-sage/slave/sage_git/build/local/lib -o build/lib.macosx-10.9-x86_64-2.7/cysignals_example.so -lpari -Ddummy
**********************************************************************
File "src/cysignals/tests.pyx", line 494, in tests.pyx
Failed example:
    print Popen(['python', '-c', cmd], stdout=PIPE, stderr=PIPE).communicate()[1]  # doctest: +ELLIPSIS
Expected:
    ------------------------------------------------------------------------
    ...
    ------------------------------------------------------------------------
    <BLANKLINE>
Got:
    sys:1: RuntimeWarning: not adding directory '' to sys.path since it's writable by an untrusted group.
    Untrusted users could put files in this directory which might then be imported by your Python code. As a general precaution from similar exploits, you should not execute Python code from this directory
    ------------------------------------------------------------------------
    0   signals.so                          0x0000000108971885 print_backtrace + 37
    ------------------------------------------------------------------------
    <BLANKLINE>
**********************************************************************
```

PS: as always the cysignals.log is useless since it has many different compilations mashed together and there is no indication where it happened the first time.


---

Comment by fbissey created at 2016-02-29 20:52:29

Doesn't that message come from one of the patches sage is adding to python? It looks like the folder where the test is run is at fault.


---

Comment by jdemeyer created at 2016-02-29 21:44:30

Changing priority from major to blocker.


---

Comment by jdemeyer created at 2016-03-01 10:42:25

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-03-01 10:42:25

New commits:


---

Comment by malb created at 2016-03-01 11:18:06

This looks good to me.


---

Comment by malb created at 2016-03-01 11:18:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-02 08:27:46

Resolution: fixed
