# Issue 19904: Cysignals tests fail

archive/issues_019904.json:
```json
{
    "body": "CC:  @jdemeyer @videlec @kiwifb @malb\n\nUnter certain conditions cysignal tests fail (building with `SAGE_CHECK=yes`). This is on the buildbot so directories are the same as always. Possibly triggered by a full rebuild:\n\n```\n[...]\npython -m doctest src/cysignals/*.pyx\ncd example && python setup.py build\nsys:1: RuntimeWarning: not adding directory '' to sys.path since it's writable by an untrusted group.\nUntrusted users could put files in this directory which might then be imported by your Python code. As a general precaution from similar exploits, you should not execute Python code from this directory\nCompiling cysignals_example.pyx because it changed.\n[1/1] Cythonizing cysignals_example.pyx\nrunning build\nrunning build_ext\nbuilding 'cysignals_example' extension\ncreating build\ncreating build/temp.macosx-10.9-x86_64-2.7\ngcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.10.p0/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c cysignals_example.c -o build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o\ncreating build/lib.macosx-10.9-x86_64-2.7\ngcc -bundle -undefined dynamic_lookup -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o -L/Users/buildslave-sage/slave/sage_git/build/local/lib -o build/lib.macosx-10.9-x86_64-2.7/cysignals_example.so -lpari -Ddummy\n**********************************************************************\nFile \"src/cysignals/tests.pyx\", line 494, in tests.pyx\nFailed example:\n    print Popen(['python', '-c', cmd], stdout=PIPE, stderr=PIPE).communicate()[1]  # doctest: +ELLIPSIS\nExpected:\n    ------------------------------------------------------------------------\n    ...\n    ------------------------------------------------------------------------\n    <BLANKLINE>\nGot:\n    sys:1: RuntimeWarning: not adding directory '' to sys.path since it's writable by an untrusted group.\n    Untrusted users could put files in this directory which might then be imported by your Python code. As a general precaution from similar exploits, you should not execute Python code from this directory\n    ------------------------------------------------------------------------\n    0   signals.so                          0x0000000108971885 print_backtrace + 37\n    ------------------------------------------------------------------------\n    <BLANKLINE>\n**********************************************************************\n```\n\nPS: as always the cysignals.log is useless since it has many different compilations mashed together and there is no indication where it happened the first time.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20141\n\n",
    "created_at": "2016-02-29T19:49:38Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Cysignals tests fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19904",
    "user": "https://github.com/vbraun"
}
```
CC:  @jdemeyer @videlec @kiwifb @malb

Unter certain conditions cysignal tests fail (building with `SAGE_CHECK=yes`). This is on the buildbot so directories are the same as always. Possibly triggered by a full rebuild:

```
[...]
python -m doctest src/cysignals/*.pyx
cd example && python setup.py build
sys:1: RuntimeWarning: not adding directory '' to sys.path since it's writable by an untrusted group.
Untrusted users could put files in this directory which might then be imported by your Python code. As a general precaution from similar exploits, you should not execute Python code from this directory
Compiling cysignals_example.pyx because it changed.
[1/1] Cythonizing cysignals_example.pyx
running build
running build_ext
building 'cysignals_example' extension
creating build
creating build/temp.macosx-10.9-x86_64-2.7
gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.10.p0/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c cysignals_example.c -o build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o
creating build/lib.macosx-10.9-x86_64-2.7
gcc -bundle -undefined dynamic_lookup -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o -L/Users/buildslave-sage/slave/sage_git/build/local/lib -o build/lib.macosx-10.9-x86_64-2.7/cysignals_example.so -lpari -Ddummy
**********************************************************************
File "src/cysignals/tests.pyx", line 494, in tests.pyx
Failed example:
    print Popen(['python', '-c', cmd], stdout=PIPE, stderr=PIPE).communicate()[1]  # doctest: +ELLIPSIS
Expected:
    ------------------------------------------------------------------------
    ...
    ------------------------------------------------------------------------
    <BLANKLINE>
Got:
    sys:1: RuntimeWarning: not adding directory '' to sys.path since it's writable by an untrusted group.
    Untrusted users could put files in this directory which might then be imported by your Python code. As a general precaution from similar exploits, you should not execute Python code from this directory
    ------------------------------------------------------------------------
    0   signals.so                          0x0000000108971885 print_backtrace + 37
    ------------------------------------------------------------------------
    <BLANKLINE>
**********************************************************************
```

PS: as always the cysignals.log is useless since it has many different compilations mashed together and there is no indication where it happened the first time.

Issue created by migration from https://trac.sagemath.org/ticket/20141





---

archive/issue_comments_273593.json:
```json
{
    "body": "Doesn't that message come from one of the patches sage is adding to python? It looks like the folder where the test is run is at fault.",
    "created_at": "2016-02-29T20:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273593",
    "user": "https://github.com/kiwifb"
}
```

Doesn't that message come from one of the patches sage is adding to python? It looks like the folder where the test is run is at fault.



---

archive/issue_comments_273594.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2016-02-29T21:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273594",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_273595.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-01T10:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273595",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_273596.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-03-01T10:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273596",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_273597.json:
```json
{
    "body": "This looks good to me.",
    "created_at": "2016-03-01T11:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273597",
    "user": "https://github.com/malb"
}
```

This looks good to me.



---

archive/issue_comments_273598.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-01T11:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273598",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_018930.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-03-02T08:27:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19904#event-18930"
}
```



---

archive/issue_comments_273599.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-02T08:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19904#issuecomment-273599",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
