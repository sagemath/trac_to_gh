# Issue 26210: py3: do not sort vertices in static graphs

Issue created by migration from https://trac.sagemath.org/ticket/26447

Original creator: chapoton

Original creation time: 2018-10-09 17:52:22

CC:  dcoudert

as this may help to fix the posets


---

Comment by chapoton created at 2018-10-09 17:53:20

New commits:


---

Comment by chapoton created at 2018-10-09 17:53:20

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-10-09 18:37:54

This makes many doctests errors

```
sage -t --long src/sage/graphs/generic_graph.py  # 7 doctests failed
sage -t --long src/sage/graphs/strongly_regular_db.pyx  # 2 doctests failed
sage -t --long src/sage/graphs/connectivity.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/base/static_sparse_graph.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/generic_graph_pyx.pyx  # 2 doctests failed
sage -t --long src/sage/graphs/comparability.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/base/static_sparse_backend.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/hyperbolicity.pyx  # 8 doctests failed
```



---

Comment by chapoton created at 2018-10-09 18:45:10

damned.. This would have been too simple..


---

Comment by chapoton created at 2018-10-09 18:45:10

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-10-09 18:54:29

even just the simple change in static_sparse_backend.pyx triggers doctests failures in src/sage/graphs/connectivity.pyx (related to SPQR trees, in fact)

EDIT: more precisely

```
sage -t --long src/sage/graphs/connectivity.pyx  # 6 doctests failed
sage -t --long src/sage/graphs/base/static_sparse_backend.pyx  # 4 doctests failed
```



---

Comment by dcoudert created at 2018-10-09 19:08:11

This is not surprising. The entire graph module assumes that the order of the vertices is always the same. Touching this ordering is a nightmare..


---

Comment by git created at 2018-10-09 19:19:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-10-10 08:02:34

here is another tentative, previous one stored in "u/chapoton/26447"
----
New commits:


---

Comment by git created at 2018-10-11 07:21:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-10-11 09:35:08

Ok, so this is a working proposal: sort if possible. Not breaking any doctest on python2.

EDIT: and improving a lot of things on the python3 side !


---

Comment by chapoton created at 2018-10-11 10:01:37

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2018-10-11 13:38:55

In general I agree with this change. However, I have the following concern:
- the description of parameter `vertex_list` must be extended. It should be explained that if it is given, the ordering induced by this vertex_list is used to map vertices to integers.
- What if vertex_list is not a list but a set, dict, etc. ?
- What if vertex_list has length less than `G.order()`. In particular, we must check that `set(vertex_list) == set(G.vertices())`.
- Specific doctests are required.

Question: in the declaration of method `init_short_digraph` in file `static_sparse_graph.pxd`, you use `vertex_list = ?`. Shouldn't it be `vertex_list=?` to comply with PEP8 ?


---

Comment by dcoudert created at 2018-10-11 13:38:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-10-11 14:09:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-10-11 14:09:59

Here is some more doc. I would prefer not to add checks for the type, length and content of "vertex_list".


---

Comment by dcoudert created at 2018-10-11 15:40:23

I did several tests and it's working well except when the list has more vertices than the graph. This particular case could be tested at low cost, no ?

In all other cases, when the given list is not good, an error is raised somewhere. 

```python
sage: from sage.graphs.base.static_sparse_backend import StaticSparseCGraph
sage: G = graphs.PetersenGraph()
sage: S = StaticSparseCGraph(G, vertex_list=range(10))
sage: S = StaticSparseCGraph(G, vertex_list=range(10)[::-1])
sage: S.verts()
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
sage: S = StaticSparseCGraph(G, vertex_list=range(20)) ### should we care ??
sage: S.verts()
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
sage:
sage: S = StaticSparseCGraph(G, vertex_list=range(5))
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
...
IndexError: list index out of range
sage:
sage: S = StaticSparseCGraph(G, vertex_list=range(1,11))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
....
TypeError: 'int' object is not iterable
sage:
sage: S = StaticSparseCGraph(G, vertex_list=set(range(10)))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: Expected list, got set
```



---

Comment by git created at 2018-10-11 17:07:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-11 17:11:46

`len(G)` could be `G.order()`.


---

Comment by git created at 2018-10-11 17:47:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-10-11 17:53:03

ok, done


---

Comment by chapoton created at 2018-10-11 18:02:30

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2018-10-11 18:11:59

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2018-10-11 18:11:59

LGTM, passes all long tests on `graphs`.


---

Comment by vbraun created at 2018-10-20 11:57:59

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
