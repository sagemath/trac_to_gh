# Issue 26210: py3: do not sort vertices in static graphs

archive/issues_026210.json:
```json
{
    "body": "CC:  @dcoudert\n\nas this may help to fix the posets\n\nIssue created by migration from https://trac.sagemath.org/ticket/26447\n\n",
    "created_at": "2018-10-09T17:52:22Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "py3: do not sort vertices in static graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26210",
    "user": "@fchapoton"
}
```
CC:  @dcoudert

as this may help to fix the posets

Issue created by migration from https://trac.sagemath.org/ticket/26447





---

archive/issue_comments_369404.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-10-09T17:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369404",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_369405.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-09T17:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369405",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369406.json:
```json
{
    "body": "This makes many doctests errors\n\n```\nsage -t --long src/sage/graphs/generic_graph.py  # 7 doctests failed\nsage -t --long src/sage/graphs/strongly_regular_db.pyx  # 2 doctests failed\nsage -t --long src/sage/graphs/connectivity.pyx  # 1 doctest failed\nsage -t --long src/sage/graphs/base/static_sparse_graph.pyx  # 1 doctest failed\nsage -t --long src/sage/graphs/generic_graph_pyx.pyx  # 2 doctests failed\nsage -t --long src/sage/graphs/comparability.pyx  # 1 doctest failed\nsage -t --long src/sage/graphs/base/static_sparse_backend.pyx  # 1 doctest failed\nsage -t --long src/sage/graphs/hyperbolicity.pyx  # 8 doctests failed\n```\n",
    "created_at": "2018-10-09T18:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369406",
    "user": "@dcoudert"
}
```

This makes many doctests errors

```
sage -t --long src/sage/graphs/generic_graph.py  # 7 doctests failed
sage -t --long src/sage/graphs/strongly_regular_db.pyx  # 2 doctests failed
sage -t --long src/sage/graphs/connectivity.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/base/static_sparse_graph.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/generic_graph_pyx.pyx  # 2 doctests failed
sage -t --long src/sage/graphs/comparability.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/base/static_sparse_backend.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/hyperbolicity.pyx  # 8 doctests failed
```




---

archive/issue_comments_369407.json:
```json
{
    "body": "damned.. This would have been too simple..",
    "created_at": "2018-10-09T18:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369407",
    "user": "@fchapoton"
}
```

damned.. This would have been too simple..



---

archive/issue_comments_369408.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-09T18:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369408",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_369409.json:
```json
{
    "body": "even just the simple change in static_sparse_backend.pyx triggers doctests failures in src/sage/graphs/connectivity.pyx (related to SPQR trees, in fact)\n\nEDIT: more precisely\n\n```\nsage -t --long src/sage/graphs/connectivity.pyx  # 6 doctests failed\nsage -t --long src/sage/graphs/base/static_sparse_backend.pyx  # 4 doctests failed\n```\n",
    "created_at": "2018-10-09T18:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369409",
    "user": "@fchapoton"
}
```

even just the simple change in static_sparse_backend.pyx triggers doctests failures in src/sage/graphs/connectivity.pyx (related to SPQR trees, in fact)

EDIT: more precisely

```
sage -t --long src/sage/graphs/connectivity.pyx  # 6 doctests failed
sage -t --long src/sage/graphs/base/static_sparse_backend.pyx  # 4 doctests failed
```




---

archive/issue_comments_369410.json:
```json
{
    "body": "This is not surprising. The entire graph module assumes that the order of the vertices is always the same. Touching this ordering is a nightmare..",
    "created_at": "2018-10-09T19:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369410",
    "user": "@dcoudert"
}
```

This is not surprising. The entire graph module assumes that the order of the vertices is always the same. Touching this ordering is a nightmare..



---

archive/issue_comments_369411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-09T19:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369412.json:
```json
{
    "body": "here is another tentative, previous one stored in \"u/chapoton/26447\"\n----\nNew commits:",
    "created_at": "2018-10-10T08:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369412",
    "user": "@fchapoton"
}
```

here is another tentative, previous one stored in "u/chapoton/26447"
----
New commits:



---

archive/issue_comments_369413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-11T07:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369413",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369414.json:
```json
{
    "body": "Ok, so this is a working proposal: sort if possible. Not breaking any doctest on python2.\n\nEDIT: and improving a lot of things on the python3 side !",
    "created_at": "2018-10-11T09:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369414",
    "user": "@fchapoton"
}
```

Ok, so this is a working proposal: sort if possible. Not breaking any doctest on python2.

EDIT: and improving a lot of things on the python3 side !



---

archive/issue_comments_369415.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-11T10:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369415",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369416.json:
```json
{
    "body": "In general I agree with this change. However, I have the following concern:\n- the description of parameter `vertex_list` must be extended. It should be explained that if it is given, the ordering induced by this vertex_list is used to map vertices to integers.\n- What if vertex_list is not a list but a set, dict, etc. ?\n- What if vertex_list has length less than `G.order()`. In particular, we must check that `set(vertex_list) == set(G.vertices())`.\n- Specific doctests are required.\n\nQuestion: in the declaration of method `init_short_digraph` in file `static_sparse_graph.pxd`, you use `vertex_list = ?`. Shouldn't it be `vertex_list=?` to comply with PEP8 ?",
    "created_at": "2018-10-11T13:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369416",
    "user": "@dcoudert"
}
```

In general I agree with this change. However, I have the following concern:
- the description of parameter `vertex_list` must be extended. It should be explained that if it is given, the ordering induced by this vertex_list is used to map vertices to integers.
- What if vertex_list is not a list but a set, dict, etc. ?
- What if vertex_list has length less than `G.order()`. In particular, we must check that `set(vertex_list) == set(G.vertices())`.
- Specific doctests are required.

Question: in the declaration of method `init_short_digraph` in file `static_sparse_graph.pxd`, you use `vertex_list = ?`. Shouldn't it be `vertex_list=?` to comply with PEP8 ?



---

archive/issue_comments_369417.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-11T13:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369417",
    "user": "@dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_369418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-11T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369418",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369419.json:
```json
{
    "body": "Here is some more doc. I would prefer not to add checks for the type, length and content of \"vertex_list\".",
    "created_at": "2018-10-11T14:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369419",
    "user": "@fchapoton"
}
```

Here is some more doc. I would prefer not to add checks for the type, length and content of "vertex_list".



---

archive/issue_comments_369420.json:
```json
{
    "body": "I did several tests and it's working well except when the list has more vertices than the graph. This particular case could be tested at low cost, no ?\n\nIn all other cases, when the given list is not good, an error is raised somewhere. \n\n```python\nsage: from sage.graphs.base.static_sparse_backend import StaticSparseCGraph\nsage: G = graphs.PetersenGraph()\nsage: S = StaticSparseCGraph(G, vertex_list=range(10))\nsage: S = StaticSparseCGraph(G, vertex_list=range(10)[::-1])\nsage: S.verts()\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nsage: S = StaticSparseCGraph(G, vertex_list=range(20)) ### should we care ??\nsage: S.verts()\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nsage:\nsage: S = StaticSparseCGraph(G, vertex_list=range(5))\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n...\nIndexError: list index out of range\nsage:\nsage: S = StaticSparseCGraph(G, vertex_list=range(1,11))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n....\nTypeError: 'int' object is not iterable\nsage:\nsage: S = StaticSparseCGraph(G, vertex_list=set(range(10)))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: Expected list, got set\n```\n",
    "created_at": "2018-10-11T15:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369420",
    "user": "@dcoudert"
}
```

I did several tests and it's working well except when the list has more vertices than the graph. This particular case could be tested at low cost, no ?

In all other cases, when the given list is not good, an error is raised somewhere. 

```python
sage: from sage.graphs.base.static_sparse_backend import StaticSparseCGraph
sage: G = graphs.PetersenGraph()
sage: S = StaticSparseCGraph(G, vertex_list=range(10))
sage: S = StaticSparseCGraph(G, vertex_list=range(10)[::-1])
sage: S.verts()
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
sage: S = StaticSparseCGraph(G, vertex_list=range(20)) ### should we care ??
sage: S.verts()
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
sage:
sage: S = StaticSparseCGraph(G, vertex_list=range(5))
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
...
IndexError: list index out of range
sage:
sage: S = StaticSparseCGraph(G, vertex_list=range(1,11))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
....
TypeError: 'int' object is not iterable
sage:
sage: S = StaticSparseCGraph(G, vertex_list=set(range(10)))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: Expected list, got set
```




---

archive/issue_comments_369421.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-11T17:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369421",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369422.json:
```json
{
    "body": "`len(G)` could be `G.order()`.",
    "created_at": "2018-10-11T17:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369422",
    "user": "@dcoudert"
}
```

`len(G)` could be `G.order()`.



---

archive/issue_comments_369423.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-11T17:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369423",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369424.json:
```json
{
    "body": "ok, done",
    "created_at": "2018-10-11T17:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369424",
    "user": "@fchapoton"
}
```

ok, done



---

archive/issue_comments_369425.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-11T18:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369425",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369426.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-11T18:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369426",
    "user": "@dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369427.json:
```json
{
    "body": "LGTM, passes all long tests on `graphs`.",
    "created_at": "2018-10-11T18:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369427",
    "user": "@dcoudert"
}
```

LGTM, passes all long tests on `graphs`.



---

archive/issue_comments_369428.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T11:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369428",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_369429.json:
```json
{
    "body": "This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26210#issuecomment-369429",
    "user": "@embray"
}
```

This should be re-targeted for 8.5.
