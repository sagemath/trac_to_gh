# Issue 28493: cvxopt fails its test suite

archive/issues_028493.json:
```json
{
    "body": "With a Python 3 build of Sage, `./sage -f -c cvxopt` fails.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28730\n\n",
    "created_at": "2019-11-13T20:50:26Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "cvxopt fails its test suite",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28493",
    "user": "jhpalmieri"
}
```
With a Python 3 build of Sage, `./sage -f -c cvxopt` fails.

Issue created by migration from https://trac.sagemath.org/ticket/28730





---

archive/issue_comments_402391.json:
```json
{
    "body": "Is it related to #24657? Note my comment at the end of the ticket.",
    "created_at": "2019-11-13T20:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402391",
    "user": "fbissey"
}
```

Is it related to #24657? Note my comment at the end of the ticket.



---

archive/issue_comments_402392.json:
```json
{
    "body": "Thank you for pointing out that ticket. It looks different to me, though: I see\n\n```\nOptimal solution found.\nTraceback (most recent call last):\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/numpy/lib/histograms.py\", line 410, in _get_bin_edges\n    n_equal_bins = operator.index(bins)\nTypeError: 'float' object cannot be interpreted as an integer\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"normappr.py\", line 27, in <module>\n    pylab.hist(A*x1.value + b, m/5)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/matplotlib/pyplot.py\", line 3137, in hist\n    stacked=stacked, normed=normed, data=data, **kwargs)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/matplotlib/__init__.py\", line 1867, in inner\n    return func(ax, *args, **kwargs)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/matplotlib/axes/_axes.py\", line 6639, in hist\n    m, bins = np.histogram(x[i], bins, weights=w[i], **hist_kwargs)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/numpy/lib/histograms.py\", line 780, in histogram\n    bin_edges, uniform_bins = _get_bin_edges(a, bins, range, weights)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/numpy/lib/histograms.py\", line 413, in _get_bin_edges\n    '`bins` must be an integer, a string, or an array')\nTypeError: `bins` must be an integer, a string, or an array\nError: test /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10/normappr.py failed\n```\n",
    "created_at": "2019-11-13T21:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402392",
    "user": "jhpalmieri"
}
```

Thank you for pointing out that ticket. It looks different to me, though: I see

```
Optimal solution found.
Traceback (most recent call last):
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/numpy/lib/histograms.py", line 410, in _get_bin_edges
    n_equal_bins = operator.index(bins)
TypeError: 'float' object cannot be interpreted as an integer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "normappr.py", line 27, in <module>
    pylab.hist(A*x1.value + b, m/5)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/matplotlib/pyplot.py", line 3137, in hist
    stacked=stacked, normed=normed, data=data, **kwargs)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/matplotlib/__init__.py", line 1867, in inner
    return func(ax, *args, **kwargs)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/matplotlib/axes/_axes.py", line 6639, in hist
    m, bins = np.histogram(x[i], bins, weights=w[i], **hist_kwargs)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/numpy/lib/histograms.py", line 780, in histogram
    bin_edges, uniform_bins = _get_bin_edges(a, bins, range, weights)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/lib/python3.7/site-packages/numpy/lib/histograms.py", line 413, in _get_bin_edges
    '`bins` must be an integer, a string, or an array')
TypeError: `bins` must be an integer, a string, or an array
Error: test /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta5/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10/normappr.py failed
```




---

archive/issue_comments_402393.json:
```json
{
    "body": "I see a change from numpy ultimately. Which file is this from? I'll see if it still happens with cvxopt-1.2.3 which is what I am using in sage-on-gentoo. In fact now that I have shipped suitesparse we should be able to update cvxopt, I guess I should have taken a lead on that.",
    "created_at": "2019-11-13T21:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402393",
    "user": "fbissey"
}
```

I see a change from numpy ultimately. Which file is this from? I'll see if it still happens with cvxopt-1.2.3 which is what I am using in sage-on-gentoo. In fact now that I have shipped suitesparse we should be able to update cvxopt, I guess I should have taken a lead on that.



---

archive/issue_comments_402394.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> I see a change from numpy ultimately. Which file is this from?\n\nNot sure what you mean. The error message is from the cvxopt log file, and it refers to `normappr.py`, or in full detail, `SAGE_ROOT/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10/normappr.py`",
    "created_at": "2019-11-13T21:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402394",
    "user": "jhpalmieri"
}
```

Replying to [comment:4 fbissey]:
> I see a change from numpy ultimately. Which file is this from?

Not sure what you mean. The error message is from the cvxopt log file, and it refers to `normappr.py`, or in full detail, `SAGE_ROOT/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10/normappr.py`



---

archive/issue_comments_402395.json:
```json
{
    "body": "I see, I should have spotted it. Now I see that this is the same file file but a different problem than in #24657. Upgrading cvxopt won't fix the fact that you try to run (outdated) documentation as tests.\n\nNote like I said in #24657 cvxopt' spkg-check is not running a test suite, it is running documentation examples as if it was a test suite. And then shock horror it is not foolproofed like one. I think we should ditch spkg-check in cvxopt unless we are to run the real test suite with `pytest`.",
    "created_at": "2019-11-13T21:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402395",
    "user": "fbissey"
}
```

I see, I should have spotted it. Now I see that this is the same file file but a different problem than in #24657. Upgrading cvxopt won't fix the fact that you try to run (outdated) documentation as tests.

Note like I said in #24657 cvxopt' spkg-check is not running a test suite, it is running documentation examples as if it was a test suite. And then shock horror it is not foolproofed like one. I think we should ditch spkg-check in cvxopt unless we are to run the real test suite with `pytest`.



---

archive/issue_comments_402396.json:
```json
{
    "body": "That makes sense to me. Unfortunately, I don't think we have a way of including an optional package as a dependency for testing, so should we just remove the cvxopt `spkg-check` file? Then later we can consider adding `pytest` as a standard package.",
    "created_at": "2019-11-13T22:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402396",
    "user": "jhpalmieri"
}
```

That makes sense to me. Unfortunately, I don't think we have a way of including an optional package as a dependency for testing, so should we just remove the cvxopt `spkg-check` file? Then later we can consider adding `pytest` as a standard package.



---

archive/issue_comments_402397.json:
```json
{
    "body": "That would be the sensible thing. At least in my opinion. The other testing dependency I can think of is `nose` and it looks like it has been made a standard package.",
    "created_at": "2019-11-13T22:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402397",
    "user": "fbissey"
}
```

That would be the sensible thing. At least in my opinion. The other testing dependency I can think of is `nose` and it looks like it has been made a standard package.



---

archive/issue_comments_402398.json:
```json
{
    "body": "Actually, looking at the version of `cvxopt` which is in Sage, its `INSTALL` file says\n\n```\nTo test that the installation was successful, go to the examples directory \nand try one of the examples, for example, \n\n     cd examples/doc/chap8\n     python lp.py\n```\n\nI just downloaded version 1.2.3, and its `INSTALL` file says\n\n```\nTo test that the installation was successful, run the included tests using\n\n     python -m unittest discover -s tests\n\nor alternatively, if `nose` is installed,\n\n     nosetests\n```\n\nSo we could update to 1.2.3 and use `nose`.",
    "created_at": "2019-11-13T22:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402398",
    "user": "jhpalmieri"
}
```

Actually, looking at the version of `cvxopt` which is in Sage, its `INSTALL` file says

```
To test that the installation was successful, go to the examples directory 
and try one of the examples, for example, 

     cd examples/doc/chap8
     python lp.py
```

I just downloaded version 1.2.3, and its `INSTALL` file says

```
To test that the installation was successful, run the included tests using

     python -m unittest discover -s tests

or alternatively, if `nose` is installed,

     nosetests
```

So we could update to 1.2.3 and use `nose`.



---

archive/issue_comments_402399.json:
```json
{
    "body": "I guess we can try that. Personally I didn't look at `INSTALL` when writing the tests on sage-on-gentoo, I looked at the `.travis.yml` file and followed what they are doing in there. There is a chance that `INSTALL` is not up to date but we should give it a go.",
    "created_at": "2019-11-13T22:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402399",
    "user": "fbissey"
}
```

I guess we can try that. Personally I didn't look at `INSTALL` when writing the tests on sage-on-gentoo, I looked at the `.travis.yml` file and followed what they are doing in there. There is a chance that `INSTALL` is not up to date but we should give it a go.



---

archive/issue_comments_402400.json:
```json
{
    "body": "I think our current broken `spkg-check` is already doing what they suggest.\n\nI tried upgrading to 1.2.3, but there are too many dependencies for me to deal with right now: [SuiteSparse](http://faculty.cse.tamu.edu/davis/suitesparse.html) which in turn depends on `cmake`. I don't want to convert `cmake` to be a standard Sage package. Maybe we can just build part of SuiteSparse without using `cmake`.",
    "created_at": "2019-11-13T23:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402400",
    "user": "jhpalmieri"
}
```

I think our current broken `spkg-check` is already doing what they suggest.

I tried upgrading to 1.2.3, but there are too many dependencies for me to deal with right now: [SuiteSparse](http://faculty.cse.tamu.edu/davis/suitesparse.html) which in turn depends on `cmake`. I don't want to convert `cmake` to be a standard Sage package. Maybe we can just build part of SuiteSparse without using `cmake`.



---

archive/issue_comments_402401.json:
```json
{
    "body": "I thought part of #22380 had gone in but it was blocked by cygwin :( If suitesparse now depends on cmake that means there is a new release. I should at least look into that.",
    "created_at": "2019-11-13T23:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402401",
    "user": "fbissey"
}
```

I thought part of #22380 had gone in but it was blocked by cygwin :( If suitesparse now depends on cmake that means there is a new release. I should at least look into that.



---

archive/issue_comments_402402.json:
```json
{
    "body": "#22380 is using suitesparse 5.4.0, upstream is now at 5.6.0 but it should all work as in that ticket. `cmake` is only needed for some stuff we don't use. Unless there are new dependencies between packages that I haven't spotted.",
    "created_at": "2019-11-13T23:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402402",
    "user": "fbissey"
}
```

#22380 is using suitesparse 5.4.0, upstream is now at 5.6.0 but it should all work as in that ticket. `cmake` is only needed for some stuff we don't use. Unless there are new dependencies between packages that I haven't spotted.



---

archive/issue_comments_402403.json:
```json
{
    "body": "I agree, we don't need `cmake` for the crucial parts of `SuiteSparse`.",
    "created_at": "2019-11-13T23:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402403",
    "user": "jhpalmieri"
}
```

I agree, we don't need `cmake` for the crucial parts of `SuiteSparse`.



---

archive/issue_comments_402404.json:
```json
{
    "body": "Now I see I made a patch to avoid calls to cmake. We should finish that ticket.",
    "created_at": "2019-11-13T23:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402404",
    "user": "fbissey"
}
```

Now I see I made a patch to avoid calls to cmake. We should finish that ticket.



---

archive/issue_comments_402405.json:
```json
{
    "body": "So should we close this ticket, or should we use this to remove `spkg-check`? In either case, #22380 can instate a better version.",
    "created_at": "2019-11-14T00:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402405",
    "user": "jhpalmieri"
}
```

So should we close this ticket, or should we use this to remove `spkg-check`? In either case, #22380 can instate a better version.



---

archive/issue_comments_402406.json:
```json
{
    "body": "Replying to [comment:16 jhpalmieri]:\n> So should we close this ticket, or should we use this to remove `spkg-check`? In either case, #22380 can instate a better version.\n\nWe should remove it here. Fixing the cygwin problem in #22380 may take a bit of time. I have an alternative packaging option for suitesparse, it just makes me the maintainer for both gentoo and sage until it gets a better build system [which is likely to be cmake].",
    "created_at": "2019-11-14T00:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402406",
    "user": "fbissey"
}
```

Replying to [comment:16 jhpalmieri]:
> So should we close this ticket, or should we use this to remove `spkg-check`? In either case, #22380 can instate a better version.

We should remove it here. Fixing the cygwin problem in #22380 may take a bit of time. I have an alternative packaging option for suitesparse, it just makes me the maintainer for both gentoo and sage until it gets a better build system [which is likely to be cmake].



---

archive/issue_comments_402407.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-14T00:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402407",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_402408.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-11-14T00:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402408",
    "user": "jhpalmieri"
}
```

New commits:



---

archive/issue_comments_402409.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-14T00:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402409",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_402410.json:
```json
{
    "body": "LGTM",
    "created_at": "2019-11-14T00:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402410",
    "user": "fbissey"
}
```

LGTM



---

archive/issue_comments_402411.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-16T20:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-402411",
    "user": "vbraun"
}
```

Resolution: fixed
