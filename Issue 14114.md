# Issue 14114: More doctests from the book "Calcul mathématique avec Sage"

Issue created by migration from Trac.

Original creator: lfousse

Original creation time: 2013-03-20 04:38:21

Assignee: mvngu

The attached file provides doctests for examples in the chapter on integration and differential equations. Tests pass with 5.7.


---

Attachment


---

Comment by lfousse created at 2013-03-25 01:32:12

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-04-09 14:24:47

What am I supposed to do with this file? Normally, additions to Sage are patches to the Sage library (in `devel/sage`). See [http://sagemath.org/doc/developer/](http://sagemath.org/doc/developer/)


---

Comment by jdemeyer created at 2013-04-09 14:25:10

Changing status from needs_review to needs_work.


---

Comment by zimmerma created at 2013-08-23 11:45:43

I've made a proper patch. All tests pass with Sage 5.11. Ready for review.

Paul


---

Comment by zimmerma created at 2013-08-23 11:45:43

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2013-08-30 12:18:00

ok, looks good to me


---

Comment by chapoton created at 2013-08-30 12:18:00

Changing status from needs_review to positive_review.


---

Comment by zimmerma created at 2013-08-31 08:44:30

thank you Frédéric.

Paul


---

Comment by jdemeyer created at 2013-09-02 10:09:00

Some of these examples yield slightly different results on 32-bit systems:

```
sage -t --long devel/sage/sage/tests/french_book/integration_doctest.py
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 30, in sage.tests.french_book.integration_doctest
Failed example:
    N(integrate(exp(-x^2)*log(x), x, 17, 42))
Expected:
    2.5657285006962035e-127
Got:
    2.565728500696221e-127
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 42, in sage.tests.french_book.integration_doctest
Failed example:
    numerical_integral(exp(-x^2)*log(x), 17, 42)
Expected:
    (2.5657285006962035e-127, 3.3540254049238093e-128)
Got:
    (2.565728500696221e-127, 3.3540254049023843e-128)
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 49, in sage.tests.french_book.integration_doctest
Failed example:
    numerical_integral(exp(-x^100), 0, 1.1, algorithm='qng')
Expected:
    (0.994327538576531..., 0.016840666914688864)
Got:
    (0.9943275385765319, 0.016840666914705607)
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 59, in sage.tests.french_book.integration_doctest
Failed example:
    N(integrate(exp(-x^2)*log(x), x, 17, 42), 200)
Expected:
    2.5657285006962035e-127
Got:
    2.565728500696221e-127
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 80, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=17, 42, exp(-x^2)*log(x))')
Expected:
    2.5657285005610514829173563961304785900 E-127
Got:
    2.565728500561051482917356396 E-127
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 85, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=0, 1, sin(sin(x)))')
Expected:
    0.43060610312069060491237735524846578643
Got:
    0.4306061031206906049123773553
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 94, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=0, 1, x^(-1/2))')
Expected:
    1.999999999999999999999999999998...
Got:
    1.999999999999999999990291881
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 99, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=[0, -1/2], 1, x^(-1/2))')
Expected:
    2.00000000000000000000000000000...
Got:
    2.000000000000000000000000000
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 104, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=[0, -1/42], 1, x^(-1/2))')
Expected:
    1.9999999999999999999999999999996...
Got:
    1.999999999999999999996899473
**********************************************************************
```



---

Comment by jdemeyer created at 2013-09-02 10:09:00

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-09-03 12:22:45

On Linux ia64:

```
sage -t --long devel/sage/sage/tests/french_book/integration_doctest.py
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 30, in sage.tests.french_book.integration_doctest
Failed example:
    N(integrate(exp(-x^2)*log(x), x, 17, 42))
Expected:
    2.5657285006962035e-127
Got:
    2.565728500696221e-127
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 42, in sage.tests.french_book.integration_doctest
Failed example:
    numerical_integral(exp(-x^2)*log(x), 17, 42)
Expected:
    (2.5657285006962035e-127, 3.3540254049238093e-128)
Got:
    (2.565728500696221e-127, 3.3540254049023813e-128)
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 59, in sage.tests.french_book.integration_doctest
Failed example:
    N(integrate(exp(-x^2)*log(x), x, 17, 42), 200)
Expected:
    2.5657285006962035e-127
Got:
    2.565728500696221e-127
**********************************************************************
```



---

Comment by zimmerma created at 2013-09-03 13:03:49

Changing status from needs_work to needs_review.


---

Comment by zimmerma created at 2013-09-03 13:03:49

the new attachment should fix the numerical noise issues on both 32-bit systems and ia64.
I'm not sure the notation `1.2345...` works with the scientific notation, thus I've
used `# rel tol` in some places.

Paul


---

Comment by jdemeyer created at 2013-09-06 08:15:51

Replying to [comment:12 zimmerma]:
> the new attachment should fix the numerical noise issues on both 32-bit systems and ia64.
> I'm not sure the notation `1.2345...` works with the scientific notation, thus I've
> used `# rel tol` in some places.

The `...` notation in doctest results works purely with strings, it doesn't interpret the numbers. Tolerances like `# rel tol` do interpret the numbers, so that's probably the better choice indeed.


---

Comment by chapoton created at 2013-09-22 11:17:42

Hello,

I am not happy with the indentation: it should be 4 spaces instead of 2 !

Otherwise, this should be good to go.


---

Comment by chapoton created at 2013-09-22 11:17:42

Changing status from needs_review to needs_work.


---

Comment by zimmerma created at 2013-11-13 10:00:27

Changing status from needs_work to needs_review.


---

Attachment

> I am not happy with the indentation: it should be 4 spaces instead of 2 !

fixed in the new attachment.

Paul


---

Comment by jdemeyer created at 2013-11-22 14:44:55

There still remains

```
sage -t --long devel/sage/sage/tests/french_book/integration_doctest.py
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 94, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=0, 1, x^(-1/2))')
Expected:
    1.999999999999999999999...
Got:
    1.999999999999999999990291881
**********************************************************************
File "devel/sage/sage/tests/french_book/integration_doctest.py", line 104, in sage.tests.french_book.integration_doctest
Failed example:
    gp('intnum(x=[0, -1/42], 1, x^(-1/2))')
Expected:
    1.999999999999999999999...
Got:
    1.999999999999999999996899473
**********************************************************************
```



---

Comment by jdemeyer created at 2013-11-22 14:44:55

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2013-12-22 19:40:10

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2013-12-22 19:40:10

New commits:


---

Comment by chapoton created at 2014-01-05 09:56:57

Paul or Laurent, if you agree with my changes, you can set this to positive review.


---

Comment by zimmerma created at 2014-01-06 21:59:37

> Paul or Laurent, if you agree with my changes, you can set this to positive review. 

Frédéric, commit 91f4bcb is fine to me. I guess the other one (804f8f9) is just the original file?

Paul


---

Comment by chapoton created at 2014-01-07 08:39:57

Yes, the first commit is just the patch trac_14318_doctests_from_french_book.patch​ turned into a git commit


---

Comment by zimmerma created at 2014-01-07 08:49:56

thanks, then I give a positive review.

Paul


---

Comment by zimmerma created at 2014-01-07 08:49:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-16 19:23:54

Resolution: fixed
