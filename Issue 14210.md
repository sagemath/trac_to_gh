# Issue 14210: runsnake command broken

archive/issues_014210.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  sage-combinat @saliola @anneschilling @novoselt @nathanncohen\n\n#11287 introduced a `runsnake` command that tries to execute `runsnake` using the system python. However, it does so without `sage-native-execute` and without clearing `PYTHONHOME` and `PYTHONPATH`, so it has very little chance of ever working. It already comes a little closer by doing\n\n```diff\n-   os.system(\"/usr/bin/python -E `which runsnake` %s &\"%tmpfile)\n+   os.system(\"unset PYTHONHOME; unset PYTHONPATH; sage-native-execute runsnake %s &\"%tmpfile)\n```\n\nin `sage/misc/dev_tools.py` (that makes the command `runsnake` work on my computer).\n\nYou can't really expect the system python to work properly when the environment variables point to libraries for other python installs. See also #9386, #10286.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14414\n\n",
    "created_at": "2013-04-05T06:41:53Z",
    "labels": [
        "component: performance",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "runsnake command broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14210",
    "user": "https://github.com/nbruin"
}
```
Assignee: tbd

CC:  sage-combinat @saliola @anneschilling @novoselt @nathanncohen

#11287 introduced a `runsnake` command that tries to execute `runsnake` using the system python. However, it does so without `sage-native-execute` and without clearing `PYTHONHOME` and `PYTHONPATH`, so it has very little chance of ever working. It already comes a little closer by doing

```diff
-   os.system("/usr/bin/python -E `which runsnake` %s &"%tmpfile)
+   os.system("unset PYTHONHOME; unset PYTHONPATH; sage-native-execute runsnake %s &"%tmpfile)
```

in `sage/misc/dev_tools.py` (that makes the command `runsnake` work on my computer).

You can't really expect the system python to work properly when the environment variables point to libraries for other python installs. See also #9386, #10286.

Issue created by migration from https://trac.sagemath.org/ticket/14414





---

archive/issue_comments_178497.json:
```json
{
    "body": "Thanks for investigating this. Please someone go ahead and make a patch!\n\nCheers,\n                        Nicolas",
    "created_at": "2013-04-06T02:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178497",
    "user": "https://github.com/nthiery"
}
```

Thanks for investigating this. Please someone go ahead and make a patch!

Cheers,
                        Nicolas



---

archive/issue_events_040935.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40935"
}
```



---

archive/issue_comments_178498.json:
```json
{
    "body": "Attachment [trac-14414.patch](tarball://root/attachments/some-uuid/ticket14414/trac-14414.patch) by @fchapoton created at 2013-09-25 20:06:48",
    "created_at": "2013-09-25T20:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178498",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac-14414.patch](tarball://root/attachments/some-uuid/ticket14414/trac-14414.patch) by @fchapoton created at 2013-09-25 20:06:48



---

archive/issue_comments_178499.json:
```json
{
    "body": "Here is a patch, just as suggested.",
    "created_at": "2013-09-25T20:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178499",
    "user": "https://github.com/fchapoton"
}
```

Here is a patch, just as suggested.



---

archive/issue_comments_178500.json:
```json
{
    "body": "--PING--\n\nI just ran into this again. Can someone review this?",
    "created_at": "2013-12-04T00:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178500",
    "user": "https://github.com/nbruin"
}
```

--PING--

I just ran into this again. Can someone review this?



---

archive/issue_comments_178501.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-12-04T01:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178501",
    "user": "https://github.com/anneschilling"
}
```

New commits:



---

archive/issue_comments_178502.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-04T01:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178502",
    "user": "https://github.com/anneschilling"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_178503.json:
```json
{
    "body": "For me runsnake runs with and without the patch, so I am probably not the right reviewer. But I did convert the patch to a git branch in order to play with it.",
    "created_at": "2013-12-04T01:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178503",
    "user": "https://github.com/anneschilling"
}
```

For me runsnake runs with and without the patch, so I am probably not the right reviewer. But I did convert the patch to a git branch in order to play with it.



---

archive/issue_events_040936.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40936"
}
```



---

archive/issue_events_040937.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40937"
}
```



---

archive/issue_comments_178504.json:
```json
{
    "body": "I can't get runsnake to work either with or without this patch.\n\n```\nsage: runsnake(\"list(SymmetricGroup(3))\")\nsage: Traceback (most recent call last):\n  File \"/usr/local/bin/runsnake\", line 9, in <module>\n    load_entry_point('RunSnakeRun==2.0.2b1', 'gui_scripts', 'runsnake')()\n  File \"/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py\", line 784, in main\n    app = RunSnakeRunApp(0)\n  File \"/usr/lib/python2.7/dist-packages/wx-2.6-gtk2-unicode/wx/_core.py\", line 7700, in __init__\n    self._BootstrapApp()\n  File \"/usr/lib/python2.7/dist-packages/wx-2.6-gtk2-unicode/wx/_core.py\", line 7352, in _BootstrapApp\n    return _core_.PyApp__BootstrapApp(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py\", line 722, in OnInit\n    frame = MainFrame( config_parser = load_config())\n  File \"/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py\", line 205, in __init__\n    self.CreateControls(config_parser)\n  File \"/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py\", line 231, in CreateControls\n    square_style = True,\n  File \"/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py\", line 135, in __init__\n    self.OnSize(None)\n  File \"/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py\", line 226, in OnSize\n    self.UpdateDrawing()\n  File \"/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py\", line 230, in UpdateDrawing\n    self.Draw(dc)\n  File \"/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py\", line 236, in Draw\n    brush = wx.Brush( self.BackgroundColour  )\nAttributeError: 'SquareMap' object has no attribute 'BackgroundColour'\nsage: \n```\n\nNo window appears in reasonable time. Is this any related?",
    "created_at": "2014-03-07T05:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178504",
    "user": "https://github.com/darijgr"
}
```

I can't get runsnake to work either with or without this patch.

```
sage: runsnake("list(SymmetricGroup(3))")
sage: Traceback (most recent call last):
  File "/usr/local/bin/runsnake", line 9, in <module>
    load_entry_point('RunSnakeRun==2.0.2b1', 'gui_scripts', 'runsnake')()
  File "/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py", line 784, in main
    app = RunSnakeRunApp(0)
  File "/usr/lib/python2.7/dist-packages/wx-2.6-gtk2-unicode/wx/_core.py", line 7700, in __init__
    self._BootstrapApp()
  File "/usr/lib/python2.7/dist-packages/wx-2.6-gtk2-unicode/wx/_core.py", line 7352, in _BootstrapApp
    return _core_.PyApp__BootstrapApp(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py", line 722, in OnInit
    frame = MainFrame( config_parser = load_config())
  File "/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py", line 205, in __init__
    self.CreateControls(config_parser)
  File "/usr/local/lib/python2.7/dist-packages/RunSnakeRun-2.0.2b1-py2.7.egg/runsnakerun/runsnake.py", line 231, in CreateControls
    square_style = True,
  File "/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py", line 135, in __init__
    self.OnSize(None)
  File "/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py", line 226, in OnSize
    self.UpdateDrawing()
  File "/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py", line 230, in UpdateDrawing
    self.Draw(dc)
  File "/usr/local/lib/python2.7/dist-packages/SquareMap-1.0.1-py2.7.egg/squaremap/squaremap.py", line 236, in Draw
    brush = wx.Brush( self.BackgroundColour  )
AttributeError: 'SquareMap' object has no attribute 'BackgroundColour'
sage: 
```

No window appears in reasonable time. Is this any related?



---

archive/issue_comments_178505.json:
```json
{
    "body": "Replying to [comment:9 darij]:\n> I can't get runsnake to work either with or without this patch.\n> No window appears in reasonable time. Is this any related?\nIs perhaps the version of your SquareMap mismatched with runsnake? When I installed `RunSnakeRun==2.0.4` (yum install from standard Fedora 19 repositories), it complained about a version mismatch for SquareMap. At that point, the only SquareMap available from fedora's standard repositories was `SquareMap-1.0.1`, but `SquareMap-1.0.3` was needed. After I installed that from PyPi everything worked like a charm (with the patch here).",
    "created_at": "2014-03-07T06:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178505",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:9 darij]:
> I can't get runsnake to work either with or without this patch.
> No window appears in reasonable time. Is this any related?
Is perhaps the version of your SquareMap mismatched with runsnake? When I installed `RunSnakeRun==2.0.4` (yum install from standard Fedora 19 repositories), it complained about a version mismatch for SquareMap. At that point, the only SquareMap available from fedora's standard repositories was `SquareMap-1.0.1`, but `SquareMap-1.0.3` was needed. After I installed that from PyPi everything worked like a charm (with the patch here).



---

archive/issue_comments_178506.json:
```json
{
    "body": "Thanks for the instructions!\n\nI fear this will disappoint you, but I can now run the snake both with and without this branch...",
    "created_at": "2014-03-07T06:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178506",
    "user": "https://github.com/darijgr"
}
```

Thanks for the instructions!

I fear this will disappoint you, but I can now run the snake both with and without this branch...



---

archive/issue_comments_178507.json:
```json
{
    "body": "Replying to [comment:11 darij]:\n> Thanks for the instructions!\n> \n> I fear this will disappoint you, but I can now run the snake both with and without this branch...\n\n:-) That means that your native python `/usr/bin/python` is binary compatible with sage's `python`. Good for you! However, we cannot guarantee that this is the case. In general, if we run `/usr/bin/python` we have to ensure that the sage library and the sage-python library (via the PYTHON path variables) do not get in the way of standard python execution.\n\nAn alternative is to try and figure out how to install runsnake for sage's python (i.e., make an spkg out of it) but that seems like a hopelessly complicated solution relative to relying on system-provided runsnake. That said, fedora still only offers python-SquareMap-1.0.1, which is insufficient for the runsnake they offer. But at least the beast that is wxPython is available on the system Python by default ...",
    "created_at": "2014-03-07T18:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178507",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:11 darij]:
> Thanks for the instructions!
> 
> I fear this will disappoint you, but I can now run the snake both with and without this branch...

:-) That means that your native python `/usr/bin/python` is binary compatible with sage's `python`. Good for you! However, we cannot guarantee that this is the case. In general, if we run `/usr/bin/python` we have to ensure that the sage library and the sage-python library (via the PYTHON path variables) do not get in the way of standard python execution.

An alternative is to try and figure out how to install runsnake for sage's python (i.e., make an spkg out of it) but that seems like a hopelessly complicated solution relative to relying on system-provided runsnake. That said, fedora still only offers python-SquareMap-1.0.1, which is insufficient for the runsnake they offer. But at least the beast that is wxPython is available on the system Python by default ...



---

archive/issue_events_040938.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40938"
}
```



---

archive/issue_events_040939.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40939"
}
```



---

archive/issue_events_040940.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40940"
}
```



---

archive/issue_events_040941.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14210#event-40941"
}
```



---

archive/issue_comments_178508.json:
```json
{
    "body": "Replying to [comment:12 nbruin]:\n> An alternative is to try and figure out how to install runsnake for sage's python (i.e., make an spkg out of it) but that seems like a hopelessly complicated solution relative to relying on system-provided runsnake. That said, fedora still only offers python-SquareMap-1.0.1, which is insufficient for the runsnake they offer. But at least the beast that is wxPython is available on the system Python by default ...\n\nI would appreciate to have that alternative. I tried (system-wide) `sudo easy_install RunSnakeRun`, but then `runsnake` failed with\n\n```\nTraceback (most recent call last):\n  File \"/usr/bin/runsnake\", line 9, in <module>\n    load_entry_point('RunSnakeRun==2.0.4', 'gui_scripts', 'runsnake')()\n  File \"/usr/lib/python2.7/site-packages/pkg_resources.py\", line 337, in load_entry_point\n    return get_distribution(dist).load_entry_point(group, name)\n  File \"/usr/lib/python2.7/site-packages/pkg_resources.py\", line 2333, in load_entry_point\n    return ep.load()\n  File \"/usr/lib/python2.7/site-packages/pkg_resources.py\", line 2039, in load\n    entry = __import__(self.module_name, globals(),globals(), ['__name__'])\n  File \"/usr/lib/python2.7/site-packages/RunSnakeRun-2.0.4-py2.7.egg/runsnakerun/runsnake.py\", line 4, in <module>\n    import wx, sys, os, logging, traceback\nImportError: No module named wx\n```\n\nSo, `easy_install` apparently did not take care of dependencies. I think I met this problem before (I am not sure if I ever managed to install runsnake on my laptop). Unfortunately, runsnake seems to be unknown to the opensuse distribution. So, I can not simply install it with `yast`, hoping that `yast` takes care of dependencies (in contrast to easy_install).",
    "created_at": "2014-10-14T21:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178508",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:12 nbruin]:
> An alternative is to try and figure out how to install runsnake for sage's python (i.e., make an spkg out of it) but that seems like a hopelessly complicated solution relative to relying on system-provided runsnake. That said, fedora still only offers python-SquareMap-1.0.1, which is insufficient for the runsnake they offer. But at least the beast that is wxPython is available on the system Python by default ...

I would appreciate to have that alternative. I tried (system-wide) `sudo easy_install RunSnakeRun`, but then `runsnake` failed with

```
Traceback (most recent call last):
  File "/usr/bin/runsnake", line 9, in <module>
    load_entry_point('RunSnakeRun==2.0.4', 'gui_scripts', 'runsnake')()
  File "/usr/lib/python2.7/site-packages/pkg_resources.py", line 337, in load_entry_point
    return get_distribution(dist).load_entry_point(group, name)
  File "/usr/lib/python2.7/site-packages/pkg_resources.py", line 2333, in load_entry_point
    return ep.load()
  File "/usr/lib/python2.7/site-packages/pkg_resources.py", line 2039, in load
    entry = __import__(self.module_name, globals(),globals(), ['__name__'])
  File "/usr/lib/python2.7/site-packages/RunSnakeRun-2.0.4-py2.7.egg/runsnakerun/runsnake.py", line 4, in <module>
    import wx, sys, os, logging, traceback
ImportError: No module named wx
```

So, `easy_install` apparently did not take care of dependencies. I think I met this problem before (I am not sure if I ever managed to install runsnake on my laptop). Unfortunately, runsnake seems to be unknown to the opensuse distribution. So, I can not simply install it with `yast`, hoping that `yast` takes care of dependencies (in contrast to easy_install).



---

archive/issue_comments_178509.json:
```json
{
    "body": "Replying to [comment:15 SimonKing]:\n> I would appreciate to have that alternative. I tried (system-wide) `sudo easy_install RunSnakeRun`, but then `runsnake` failed with\n> {{{\n> Traceback (most recent call last):\n>   File \"/usr/bin/runsnake\", line 9, in <module>\n>     load_entry_point('RunSnakeRun==2.0.4', 'gui_scripts', 'runsnake')()\n>   File \"/usr/lib/python2.7/site-packages/pkg_resources.py\", line 337, in load_entry_point\n>     return get_distribution(dist).load_entry_point(group, name)\n>   File \"/usr/lib/python2.7/site-packages/pkg_resources.py\", line 2333, in load_entry_point\n>     return ep.load()\n>   File \"/usr/lib/python2.7/site-packages/pkg_resources.py\", line 2039, in load\n>     entry = __import__(self.module_name, globals(),globals(), ['__name__'])\n>   File \"/usr/lib/python2.7/site-packages/RunSnakeRun-2.0.4-py2.7.egg/runsnakerun/runsnake.py\", line 4, in <module>\n>     import wx, sys, os, logging, traceback\n> ImportError: No module named wx\n> }}}\n> So, `easy_install` apparently did not take care of dependencies.\nIf you google \"suse runsnake\" you'll get RPM hits, so at least third parties have packaged it for opensuse. I wouldn't go and install random rpms from the web, but for instance [this page](http://rpm.pbone.net/index.php3/stat/4/idpl/21440304/dir/opensuse_12.x/com/RunSnakeRun-2.0.2b1-6.2.noarch.rpm.html) lists the requirements of the rpm. With a bit of luck THOSE can be satisfied by yast (the main one probably being python-wxWidgets) so that from that point your easily installed runsnake might work.\n\nPackaging a runsnake for sage's python would involve recompiling sage's python with wx support. That sounds painful.",
    "created_at": "2014-10-14T23:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178509",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:15 SimonKing]:
> I would appreciate to have that alternative. I tried (system-wide) `sudo easy_install RunSnakeRun`, but then `runsnake` failed with
> {{{
> Traceback (most recent call last):
>   File "/usr/bin/runsnake", line 9, in <module>
>     load_entry_point('RunSnakeRun==2.0.4', 'gui_scripts', 'runsnake')()
>   File "/usr/lib/python2.7/site-packages/pkg_resources.py", line 337, in load_entry_point
>     return get_distribution(dist).load_entry_point(group, name)
>   File "/usr/lib/python2.7/site-packages/pkg_resources.py", line 2333, in load_entry_point
>     return ep.load()
>   File "/usr/lib/python2.7/site-packages/pkg_resources.py", line 2039, in load
>     entry = __import__(self.module_name, globals(),globals(), ['__name__'])
>   File "/usr/lib/python2.7/site-packages/RunSnakeRun-2.0.4-py2.7.egg/runsnakerun/runsnake.py", line 4, in <module>
>     import wx, sys, os, logging, traceback
> ImportError: No module named wx
> }}}
> So, `easy_install` apparently did not take care of dependencies.
If you google "suse runsnake" you'll get RPM hits, so at least third parties have packaged it for opensuse. I wouldn't go and install random rpms from the web, but for instance [this page](http://rpm.pbone.net/index.php3/stat/4/idpl/21440304/dir/opensuse_12.x/com/RunSnakeRun-2.0.2b1-6.2.noarch.rpm.html) lists the requirements of the rpm. With a bit of luck THOSE can be satisfied by yast (the main one probably being python-wxWidgets) so that from that point your easily installed runsnake might work.

Packaging a runsnake for sage's python would involve recompiling sage's python with wx support. That sounds painful.



---

archive/issue_comments_178510.json:
```json
{
    "body": "Replying to [comment:16 nbruin]:\n> If you google \"suse runsnake\" you'll get RPM hits, so at least third parties have packaged it for opensuse. I wouldn't go and install random rpms from the web, but for instance [this page](http://rpm.pbone.net/index.php3/stat/4/idpl/21440304/dir/opensuse_12.x/com/RunSnakeRun-2.0.2b1-6.2.noarch.rpm.html) lists the requirements of the rpm. With a bit of luck THOSE can be satisfied by yast (the main one probably being python-wxWidgets) so that from that point your easily installed runsnake might work.\n\nThank you! `python-wxWidgets` was the missing bit. Previously, I have not been able to find this by searching what is offered by yast. Now, runsnake starts.",
    "created_at": "2014-10-15T09:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178510",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:16 nbruin]:
> If you google "suse runsnake" you'll get RPM hits, so at least third parties have packaged it for opensuse. I wouldn't go and install random rpms from the web, but for instance [this page](http://rpm.pbone.net/index.php3/stat/4/idpl/21440304/dir/opensuse_12.x/com/RunSnakeRun-2.0.2b1-6.2.noarch.rpm.html) lists the requirements of the rpm. With a bit of luck THOSE can be satisfied by yast (the main one probably being python-wxWidgets) so that from that point your easily installed runsnake might work.

Thank you! `python-wxWidgets` was the missing bit. Previously, I have not been able to find this by searching what is offered by yast. Now, runsnake starts.



---

archive/issue_comments_178511.json:
```json
{
    "body": "Replying to [comment:17 SimonKing]:\n> Thank you! `python-wxWidgets` was the missing bit.\n\n\"Missing bit\" in the sense of \"runsnake can be installed with easy_install, even though it is not known to yast\".",
    "created_at": "2014-10-15T09:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178511",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:17 SimonKing]:
> Thank you! `python-wxWidgets` was the missing bit.

"Missing bit" in the sense of "runsnake can be installed with easy_install, even though it is not known to yast".



---

archive/issue_comments_178512.json:
```json
{
    "body": "What's the reason anyway that the *system* Python is used? Why not just use Sage's Python, like every other optional package?",
    "created_at": "2015-02-06T09:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178512",
    "user": "https://github.com/jdemeyer"
}
```

What's the reason anyway that the *system* Python is used? Why not just use Sage's Python, like every other optional package?



---

archive/issue_comments_178513.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-06T09:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178513",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_178514.json:
```json
{
    "body": "In any case, the commands `unset PYTHONHOME; unset PYTHONPATH;` really should be moved to `sage-native-execute`.",
    "created_at": "2015-02-06T09:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178514",
    "user": "https://github.com/jdemeyer"
}
```

In any case, the commands `unset PYTHONHOME; unset PYTHONPATH;` really should be moved to `sage-native-execute`.



---

archive/issue_comments_178515.json:
```json
{
    "body": "I just tried to install runsnake in my Sage Python and it went flawlessly.\n\nFor `wxPython`, I followed [these instructions](http://www.wxpython.org/builddoc.php): all I had to do was download and extract the tarball and then\n\n```\ncd wxPython\npython build-wxpython.py --prefix=\"$SAGE_LOCAL\" --install\n```\n\n\nFor runsnake, I used `easy_install`:\n\n```\neasy_install RunSnakeRun\n```\n\n\n(all this in a Sage shell of course)\n\nPerhaps it used to be more complicated or it is highly system-dependent, but I don't see the problem...",
    "created_at": "2015-02-06T10:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178515",
    "user": "https://github.com/jdemeyer"
}
```

I just tried to install runsnake in my Sage Python and it went flawlessly.

For `wxPython`, I followed [these instructions](http://www.wxpython.org/builddoc.php): all I had to do was download and extract the tarball and then

```
cd wxPython
python build-wxpython.py --prefix="$SAGE_LOCAL" --install
```


For runsnake, I used `easy_install`:

```
easy_install RunSnakeRun
```


(all this in a Sage shell of course)

Perhaps it used to be more complicated or it is highly system-dependent, but I don't see the problem...



---

archive/issue_comments_178516.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> I just tried to install runsnake in my Sage Python and it went flawlessly.\nIf failed for me in the configuration process:\n\n```\nchecking for GST... configure: WARNING: GStreamer 0.10 not available, falling back to 0.8\nchecking for GST... configure: WARNING: GStreamer 0.8/0.10 not available.\nconfigure: error: GStreamer not available\nError running configure\nERROR: failed building wxWidgets\n```\n\nRunsnake as packaged by Fedora works well for me (apart from the fact that `SquareMap-1.0.3` was required but not packaged by Fedora. I presume this has been resolved in more modern distributions).\n\nSo, installing and building runsnake in the sage python seems a convenient solution for some people, but the building requirements are so heavy (the wxPython source tarball is 58Mb, and it requires all kinds of bells and whistles to be present on the host system that are not otherwise required for sage) that supporting a system runsnake should definitely be an option (and it's not hard to do).\n\nThe last couple of times I've just resorted to saving the profile data using \"%prun -D <filename> <command\" and opening it with the system runsnake afterwards (the pathnames allow the system runsnake to display all relevant source, so it doesn't need to run in the same python as where the profile comes from).\n\n------\n\nSo something along these lines would probably give the best of both worlds:\n\n\n```\n  if os.path.exists( os.environ['SAGE_LOCAL']+'/bin/runsnake'):\n      subprocess.call([\"runsnake\",tmpfile])\n  else\n      os.system(\"\"\"sh -c \"\n        LD_LIBRARY_PATH=$SAGE_ORIG_LD_LIBRARY_PATH; export LD_LIBRARY_PATH\n        if [ `uname` = 'Darwin' ]; then\n            DYLD_LIBRARY_PATH=$SAGE_ORIG_DYLD_LIBRARY_PATH\n        fi\n        unset PYTHONHOME; unset PYTHONPATH;\n        runsnake %s\n      \"    \n      \"\"\"%tempfile)\n```\n\nThis is assuming that the runsnake script itself addresses the python it wants by full name, which installed scripts usually do. We definitely need to reset the PYTHON variables, since those will be referring to sage-specific python modules, which may be incompatible with the system python. And we also do not want the sage libraries get in the way.\n\n**optional:** catch if running the command led to an error condition and then print some message what the possible avenues are for getting runsnake installed.",
    "created_at": "2015-02-06T16:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178516",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:22 jdemeyer]:
> I just tried to install runsnake in my Sage Python and it went flawlessly.
If failed for me in the configuration process:

```
checking for GST... configure: WARNING: GStreamer 0.10 not available, falling back to 0.8
checking for GST... configure: WARNING: GStreamer 0.8/0.10 not available.
configure: error: GStreamer not available
Error running configure
ERROR: failed building wxWidgets
```

Runsnake as packaged by Fedora works well for me (apart from the fact that `SquareMap-1.0.3` was required but not packaged by Fedora. I presume this has been resolved in more modern distributions).

So, installing and building runsnake in the sage python seems a convenient solution for some people, but the building requirements are so heavy (the wxPython source tarball is 58Mb, and it requires all kinds of bells and whistles to be present on the host system that are not otherwise required for sage) that supporting a system runsnake should definitely be an option (and it's not hard to do).

The last couple of times I've just resorted to saving the profile data using "%prun -D <filename> <command" and opening it with the system runsnake afterwards (the pathnames allow the system runsnake to display all relevant source, so it doesn't need to run in the same python as where the profile comes from).

------

So something along these lines would probably give the best of both worlds:


```
  if os.path.exists( os.environ['SAGE_LOCAL']+'/bin/runsnake'):
      subprocess.call(["runsnake",tmpfile])
  else
      os.system("""sh -c "
        LD_LIBRARY_PATH=$SAGE_ORIG_LD_LIBRARY_PATH; export LD_LIBRARY_PATH
        if [ `uname` = 'Darwin' ]; then
            DYLD_LIBRARY_PATH=$SAGE_ORIG_DYLD_LIBRARY_PATH
        fi
        unset PYTHONHOME; unset PYTHONPATH;
        runsnake %s
      "    
      """%tempfile)
```

This is assuming that the runsnake script itself addresses the python it wants by full name, which installed scripts usually do. We definitely need to reset the PYTHON variables, since those will be referring to sage-specific python modules, which may be incompatible with the system python. And we also do not want the sage libraries get in the way.

**optional:** catch if running the command led to an error condition and then print some message what the possible avenues are for getting runsnake installed.



---

archive/issue_comments_178517.json:
```json
{
    "body": "I like your proposal from the last comment, but some comments:\n\nYou never need `os.system(\"sh -c ...\")` since `os.system()` already uses a Shell.\n\nAnd like I said before, use `sage-native-execute` instead of manually messing with environment variables.\n\nInstead of `os.path.exists()`, you could instead use the more Pythonic\n\n```\ntry:\n    subprocess.call(os.path.join(SAGE_LOCAL, \"bin\", \"runsnake\"...)\nexcept OSError:\n    ...\n```\n",
    "created_at": "2015-02-07T09:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178517",
    "user": "https://github.com/jdemeyer"
}
```

I like your proposal from the last comment, but some comments:

You never need `os.system("sh -c ...")` since `os.system()` already uses a Shell.

And like I said before, use `sage-native-execute` instead of manually messing with environment variables.

Instead of `os.path.exists()`, you could instead use the more Pythonic

```
try:
    subprocess.call(os.path.join(SAGE_LOCAL, "bin", "runsnake"...)
except OSError:
    ...
```




---

archive/issue_comments_178518.json:
```json
{
    "body": "To elaborate on `os.path.exists(file)`:\n\n1. it checks only whether something by that name exists, not that it's an ordinary file. So at least use `os.path.isfile(file)` instead.\n\n2. it doesn't check whether the file is executable. Removing executable bits from a program is a valid way to temporarily \"disable\" it, so you should also check `os.access(file, X_OK)`.\n\nBut really, the `try`/`except` style is preferred by Python...",
    "created_at": "2015-02-07T09:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178518",
    "user": "https://github.com/jdemeyer"
}
```

To elaborate on `os.path.exists(file)`:

1. it checks only whether something by that name exists, not that it's an ordinary file. So at least use `os.path.isfile(file)` instead.

2. it doesn't check whether the file is executable. Removing executable bits from a program is a valid way to temporarily "disable" it, so you should also check `os.access(file, X_OK)`.

But really, the `try`/`except` style is preferred by Python...



---

archive/issue_comments_178519.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> But really, the `try`/`except` style is preferred by Python...\nYes, I know that as a general rule, pythonistas seem to promote it, but one shouldn't apply this blindly. The problem is that checking that it's hard to write and \"except\" class that guarantees it only catches the particular OSError resulting from the relevant file not existing.\n\nA priori, there may be loads of reasons why os.system might return an OSError, and I *only* want to try something else if `runsnake` is *not* installed in sage; otherwise I'd prefer to see an error. I certainly get that effect by testing the presence of `runsnake`. If `$SAGE_LOCAL/bin/runsnake` exists but is not executable, an error is also more appropriate than silently trying something else, so not testing executability also leads to better error reporting.\n\nI think it's good to be aware that `try/except` can be quite efficient in python and for some operations is less prone to race conditions, but one shouldn't apply it blindly. It's simply too hard to get a sufficiently fine filtering in the except clause.",
    "created_at": "2015-02-07T17:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178519",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:25 jdemeyer]:
> But really, the `try`/`except` style is preferred by Python...
Yes, I know that as a general rule, pythonistas seem to promote it, but one shouldn't apply this blindly. The problem is that checking that it's hard to write and "except" class that guarantees it only catches the particular OSError resulting from the relevant file not existing.

A priori, there may be loads of reasons why os.system might return an OSError, and I *only* want to try something else if `runsnake` is *not* installed in sage; otherwise I'd prefer to see an error. I certainly get that effect by testing the presence of `runsnake`. If `$SAGE_LOCAL/bin/runsnake` exists but is not executable, an error is also more appropriate than silently trying something else, so not testing executability also leads to better error reporting.

I think it's good to be aware that `try/except` can be quite efficient in python and for some operations is less prone to race conditions, but one shouldn't apply it blindly. It's simply too hard to get a sufficiently fine filtering in the except clause.



---

archive/issue_comments_178520.json:
```json
{
    "body": "Replying to [comment:26 nbruin]:\n> A priori, there may be loads of reasons why os.system might return an OSError\nYou mean `subprocess.call`, not `os.system`. Yes, this is an important difference!\n\nI would say it's highly unlikely that `subprocess.call` raises an `OSError` which is *not* because the file does not exist or is not executable. The only thing I can think of is running out of memory...\n\n> If `$SAGE_LOCAL/bin/runsnake` exists but is not executable, an error is also more appropriate\nI completely disagree with this, see previous comment.",
    "created_at": "2015-02-07T18:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178520",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 nbruin]:
> A priori, there may be loads of reasons why os.system might return an OSError
You mean `subprocess.call`, not `os.system`. Yes, this is an important difference!

I would say it's highly unlikely that `subprocess.call` raises an `OSError` which is *not* because the file does not exist or is not executable. The only thing I can think of is running out of memory...

> If `$SAGE_LOCAL/bin/runsnake` exists but is not executable, an error is also more appropriate
I completely disagree with this, see previous comment.



---

archive/issue_comments_178521.json:
```json
{
    "body": "Replying to [comment:27 jdemeyer]:\n> > If `$SAGE_LOCAL/bin/runsnake` exists but is not executable, an error is also more appropriate\n> I completely disagree with this, see previous comment.\nOK, executable lookup indeed ignores non-executable files that occur earlier in the path, so we should too. Strictly speaking the check should be\n\n```\nsage_runsnake=os.path.join(os.eviron(\"SAGE_LOCAL\"),\"bin\",\"runsnake\")\nif os.path.isfile(sage_runsnake) and os.access(sage_runsnake,os.X_OK):\n    ...\n```\n\nto emulate normal PATH behaviour (where lookup skips directories with the relevant name). Also, there's a comment on `os.access` that it tests against real uid rather than effective gid. Sigh ... it's almost worth running the risk of an improperly caught OSError.",
    "created_at": "2015-02-07T22:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178521",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:27 jdemeyer]:
> > If `$SAGE_LOCAL/bin/runsnake` exists but is not executable, an error is also more appropriate
> I completely disagree with this, see previous comment.
OK, executable lookup indeed ignores non-executable files that occur earlier in the path, so we should too. Strictly speaking the check should be

```
sage_runsnake=os.path.join(os.eviron("SAGE_LOCAL"),"bin","runsnake")
if os.path.isfile(sage_runsnake) and os.access(sage_runsnake,os.X_OK):
    ...
```

to emulate normal PATH behaviour (where lookup skips directories with the relevant name). Also, there's a comment on `os.access` that it tests against real uid rather than effective gid. Sigh ... it's almost worth running the risk of an improperly caught OSError.



---

archive/issue_comments_178522.json:
```json
{
    "body": "Replying to [comment:28 nbruin]:\n> Also, there's a comment on `os.access` that it tests against real uid rather than effective gid.\nThat's true, but I would think it's unlikely that people run Sage as suid. But it's certainly odd that there is no system call to check whether a file is executable for the current user.",
    "created_at": "2015-02-08T07:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178522",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 nbruin]:
> Also, there's a comment on `os.access` that it tests against real uid rather than effective gid.
That's true, but I would think it's unlikely that people run Sage as suid. But it's certainly odd that there is no system call to check whether a file is executable for the current user.



---

archive/issue_comments_178523.json:
```json
{
    "body": "See also #17735 that was primarily about docs, checks and preparsing for `runsnake()`, but discuss similar issues.",
    "created_at": "2015-02-08T11:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178523",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

See also #17735 that was primarily about docs, checks and preparsing for `runsnake()`, but discuss similar issues.



---

archive/issue_comments_178524.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-16T20:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_178525.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-16T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178525",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178526.json:
```json
{
    "body": "OK, the current branch implements the proposed strategy\n\n**edit:** D'oh. sage wasn't waiting for the runsnake process to complete before, and there's no reason to change that. Should be fixed now (just call Popen rather than call)",
    "created_at": "2015-02-16T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178526",
    "user": "https://github.com/nbruin"
}
```

OK, the current branch implements the proposed strategy

**edit:** D'oh. sage wasn't waiting for the runsnake process to complete before, and there's no reason to change that. Should be fixed now (just call Popen rather than call)



---

archive/issue_comments_178527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-16T21:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178527",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_178528.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-04T07:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178528",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_178529.json:
```json
{
    "body": "does not apply",
    "created_at": "2015-08-04T07:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14210#issuecomment-178529",
    "user": "https://github.com/fchapoton"
}
```

does not apply
