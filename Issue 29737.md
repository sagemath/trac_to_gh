# Issue 29737: Make combinat doctests ready for random seeds

Issue created by migration from https://trac.sagemath.org/ticket/29974

Original creator: @kliem

Original creation time: 2020-06-24 21:22:48

This ticket makes

```
sage -t --long --random-seed=n src/sage/combinat/
```

pass for different values `n` than just `0`.


---

Comment by @kliem created at 2020-06-24 21:38:16

New commits:


---

Comment by @kliem created at 2020-06-24 21:38:16

Changing status from new to needs_review.


---

Comment by @kliem created at 2020-07-12 18:16:23

Merge conflict.

I also need to go through it again and check I respected the design decision in #29935.


---

Comment by @kliem created at 2020-07-12 18:16:23

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-07-20 05:03:18

Note that elements of `g = GelfandTsetlinPatterns(4, 5)` have the wrong parent.


---

Comment by git created at 2020-07-21 07:29:44

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @kliem created at 2020-07-21 07:30:06

Changing status from needs_work to needs_review.


---

Comment by slabbe created at 2020-08-14 13:56:08

I get one failure in combinat:


```
----------------------------------------------------------------------
sage -t --long --random-seed=2 src/sage/combinat/derangements.py  # 1 doctest failed
----------------------------------------------------------------------
```


Can you reproduce it?


```
sage -t --long --random-seed=2 src/sage/combinat/derangements.py
**********************************************************************
File "src/sage/combinat/derangements.py", line 129, in sage.combinat.derangements.Derangements
Failed example:
    D2.random_element() # random
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 715, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1139, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.derangements.Derangements[7]>", line 1, in <module>
        D2.random_element() # random
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/combinat/derangements.py", line 504, in random_element
        return L[i]
    IndexError: list index out of range
**********************************************************************
1 item had failures:
   1 of   9 in sage.combinat.derangements.Derangements
    [85 tests, 1 failure, 0.10 s]
```



---

Comment by slabbe created at 2020-08-14 13:56:08

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-08-14 14:00:38

Yes, I can confirm the problem.


---

Comment by slabbe created at 2020-08-14 14:30:21

But it works for `--random-seed=0`, `--random-seed=1`, `--random-seed=3`, `--random-seed=4`.


---

Comment by @kliem created at 2020-08-15 07:53:12

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-08-15 07:53:12

Tiny mistake that the range of `randint(0,n)` is actually `range(0,n+1)`.
----
New commits:


---

Comment by slabbe created at 2020-08-15 08:16:51

There is 

```
from random import randrange
```

for that. Do you mind to change to the lesser known `randrange`?


---

Comment by git created at 2020-08-15 08:24:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-08-15 08:25:22

I like `randrange` much better. It is much more intuitive if you are used to `range`. (But reading the very short docstring that was exactly the point of introducing it.)


---

Comment by slabbe created at 2020-08-15 08:29:27

In fact, I think we want to import it from prandom

```
from sage.misc.prandom import randrange  
```

in order for it to depend on the `--random-seed`.


---

Comment by @kliem created at 2020-08-15 08:32:53

I was wondering about what the point was of duplicating that thing.


---

Comment by git created at 2020-08-15 08:33:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2020-08-15 08:59:54

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-08-15 10:18:10

Thank you.


---

Comment by vbraun created at 2020-08-16 22:33:01

Resolution: fixed
