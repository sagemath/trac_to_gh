# Issue 29737: Make combinat doctests ready for random seeds

archive/issues_029737.json:
```json
{
    "body": "This ticket makes\n\n```\nsage -t --long --random-seed=n src/sage/combinat/\n```\n\npass for different values `n` than just `0`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29974\n\n",
    "created_at": "2020-06-24T21:22:48Z",
    "labels": [
        "doctest framework",
        "major",
        "enhancement"
    ],
    "title": "Make combinat doctests ready for random seeds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29737",
    "user": "@kliem"
}
```
This ticket makes

```
sage -t --long --random-seed=n src/sage/combinat/
```

pass for different values `n` than just `0`.

Issue created by migration from https://trac.sagemath.org/ticket/29974





---

archive/issue_comments_422417.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-24T21:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422417",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_422418.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-24T21:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422418",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422419.json:
```json
{
    "body": "Merge conflict.\n\nI also need to go through it again and check I respected the design decision in #29935.",
    "created_at": "2020-07-12T18:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422419",
    "user": "@kliem"
}
```

Merge conflict.

I also need to go through it again and check I respected the design decision in #29935.



---

archive/issue_comments_422420.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-12T18:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422420",
    "user": "@kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_422421.json:
```json
{
    "body": "Note that elements of `g = GelfandTsetlinPatterns(4, 5)` have the wrong parent.",
    "created_at": "2020-07-20T05:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422421",
    "user": "@kliem"
}
```

Note that elements of `g = GelfandTsetlinPatterns(4, 5)` have the wrong parent.



---

archive/issue_comments_422422.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-07-21T07:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422422",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_422423.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-21T07:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422423",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_422424.json:
```json
{
    "body": "I get one failure in combinat:\n\n\n```\n----------------------------------------------------------------------\nsage -t --long --random-seed=2 src/sage/combinat/derangements.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\n\nCan you reproduce it?\n\n\n```\nsage -t --long --random-seed=2 src/sage/combinat/derangements.py\n**********************************************************************\nFile \"src/sage/combinat/derangements.py\", line 129, in sage.combinat.derangements.Derangements\nFailed example:\n    D2.random_element() # random\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 715, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1139, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.derangements.Derangements[7]>\", line 1, in <module>\n        D2.random_element() # random\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/combinat/derangements.py\", line 504, in random_element\n        return L[i]\n    IndexError: list index out of range\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.combinat.derangements.Derangements\n    [85 tests, 1 failure, 0.10 s]\n```\n",
    "created_at": "2020-08-14T13:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422424",
    "user": "slabbe"
}
```

I get one failure in combinat:


```
----------------------------------------------------------------------
sage -t --long --random-seed=2 src/sage/combinat/derangements.py  # 1 doctest failed
----------------------------------------------------------------------
```


Can you reproduce it?


```
sage -t --long --random-seed=2 src/sage/combinat/derangements.py
**********************************************************************
File "src/sage/combinat/derangements.py", line 129, in sage.combinat.derangements.Derangements
Failed example:
    D2.random_element() # random
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 715, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1139, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.derangements.Derangements[7]>", line 1, in <module>
        D2.random_element() # random
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/combinat/derangements.py", line 504, in random_element
        return L[i]
    IndexError: list index out of range
**********************************************************************
1 item had failures:
   1 of   9 in sage.combinat.derangements.Derangements
    [85 tests, 1 failure, 0.10 s]
```




---

archive/issue_comments_422425.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-14T13:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422425",
    "user": "slabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_422426.json:
```json
{
    "body": "Yes, I can confirm the problem.",
    "created_at": "2020-08-14T14:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422426",
    "user": "@kliem"
}
```

Yes, I can confirm the problem.



---

archive/issue_comments_422427.json:
```json
{
    "body": "But it works for `--random-seed=0`, `--random-seed=1`, `--random-seed=3`, `--random-seed=4`.",
    "created_at": "2020-08-14T14:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422427",
    "user": "slabbe"
}
```

But it works for `--random-seed=0`, `--random-seed=1`, `--random-seed=3`, `--random-seed=4`.



---

archive/issue_comments_422428.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-15T07:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422428",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_422429.json:
```json
{
    "body": "Tiny mistake that the range of `randint(0,n)` is actually `range(0,n+1)`.\n----\nNew commits:",
    "created_at": "2020-08-15T07:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422429",
    "user": "@kliem"
}
```

Tiny mistake that the range of `randint(0,n)` is actually `range(0,n+1)`.
----
New commits:



---

archive/issue_comments_422430.json:
```json
{
    "body": "There is \n\n```\nfrom random import randrange\n```\n\nfor that. Do you mind to change to the lesser known `randrange`?",
    "created_at": "2020-08-15T08:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422430",
    "user": "slabbe"
}
```

There is 

```
from random import randrange
```

for that. Do you mind to change to the lesser known `randrange`?



---

archive/issue_comments_422431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-15T08:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422431",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422432.json:
```json
{
    "body": "I like `randrange` much better. It is much more intuitive if you are used to `range`. (But reading the very short docstring that was exactly the point of introducing it.)",
    "created_at": "2020-08-15T08:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422432",
    "user": "@kliem"
}
```

I like `randrange` much better. It is much more intuitive if you are used to `range`. (But reading the very short docstring that was exactly the point of introducing it.)



---

archive/issue_comments_422433.json:
```json
{
    "body": "In fact, I think we want to import it from prandom\n\n```\nfrom sage.misc.prandom import randrange  \n```\n\nin order for it to depend on the `--random-seed`.",
    "created_at": "2020-08-15T08:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422433",
    "user": "slabbe"
}
```

In fact, I think we want to import it from prandom

```
from sage.misc.prandom import randrange  
```

in order for it to depend on the `--random-seed`.



---

archive/issue_comments_422434.json:
```json
{
    "body": "I was wondering about what the point was of duplicating that thing.",
    "created_at": "2020-08-15T08:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422434",
    "user": "@kliem"
}
```

I was wondering about what the point was of duplicating that thing.



---

archive/issue_comments_422435.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-15T08:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422435",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422436.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-15T08:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422436",
    "user": "slabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422437.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-08-15T10:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422437",
    "user": "@kliem"
}
```

Thank you.



---

archive/issue_comments_422438.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-16T22:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29737#issuecomment-422438",
    "user": "vbraun"
}
```

Resolution: fixed
