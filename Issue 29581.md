# Issue 29581: segfault constructing matrix over field of characteristic 2

Issue created by migration from https://trac.sagemath.org/ticket/29818

Original creator: @DaveWitteMorris

Original creation time: 2020-06-06 18:44:28

CC:  @mbombar

Keywords: matrix, characteristic 2

This issue comes from [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/SHwyFuYG-XM). The following code crashes on 9.1 and 9.2b0, but not 9.0.

```
sage: q = 2
....: for m in range(2,31):
....:     Fqm.<a> = GF(q^m)
....:     print(m, matrix(Fqm, [a]))
....:     
2 [a]
3 [a]
4 [a]
...
17 [a]
18 [a]
------------------------------------------------------------------------
(no backtrace available)
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
```

The crash does not always happen at the same size, but, in my experience, it is around 20. The reporter tested at fixed sizes (instead of running a loop to try larger-and-larger sizes), and found that the crash happens sometimes at m = 17, but never m = 16, and is more frequent for larger sizes. ("You can put m=42 for instance to make sure sage crashes.")

The reporter discovered the crash on debian (sagemath v9.1), and I confirmed it on MacOS 10.15.3 (v9.1 and 9.2b0) and `CoCalc` (v9.1). `CoCalc` agrees with the reporter that 9.0 does not have the problem, but I did not try to verify this on my laptop. I agree with the reporter that fields of odd characteristic do not seem to crash.

Additional helpful information from the reporter:

```
Using sage -gdb I have the following error (the same appear on both Debian and Arch Linux)

"Thread 1 "python3" received signal SIGSEGV, Segmentation fault.
0x00007ffdee4bd94d in gf2e_init (minpoly=minpoly@entry=2199023255561) at m4rie/gf2e.c:23
23	m4rie/gf2e.c: No such file or directory.
"
```



I did not investigate python2 v. python3.


---

Comment by tscrim created at 2020-06-08 00:29:41

I can also confirm on Ubuntu 16 using 9.0.beta9 that this does not crash. The problem is actually quite fundamental: the M4RIE library should not be used beyond `2^16`. That is why it always works for smaller values. So with 9.2.beta0, we get

```
sage: Fqm.<a> = GF(2^17)
sage: M = matrix(Fqm, [a])
sage: type(M)
<class 'sage.matrix.matrix_gf2e_dense.Matrix_gf2e_dense'>
```

whereas before, I got

```
<class 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>
```



---

Comment by tscrim created at 2020-06-08 00:41:27

Changing priority from major to blocker.


---

Comment by tscrim created at 2020-06-08 00:41:27

Quite an easy fix too. Someone just moved the test to the wrong spot during some refactoring.

I am making this a blocker as it is a pretty serious and fundamental crash.
----
New commits:


---

Comment by tscrim created at 2020-06-08 00:41:27

Changing status from new to needs_review.


---

Comment by @mbombar created at 2020-06-08 13:48:55

I can confirm it fixes the bug. Thanks !


---

Comment by @DaveWitteMorris created at 2020-06-08 19:12:17

Thanks for making the correction so quickly!  The patch is a localized change that fixes a clear bug and solves the problem, so I am confident in setting this to positive review.


---

Comment by @DaveWitteMorris created at 2020-06-08 19:12:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-06-21 22:37:34

Resolution: fixed
