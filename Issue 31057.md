# Issue 31057: Implement fetch_int method for non-givaro finite fields

Issue created by migration from https://trac.sagemath.org/ticket/31294

Original creator: slelievre

Original creation time: 2021-01-25 19:31:13

Finite fields in the givaro implementation have
a `fetch_int` method, which is not present in the
`pari` implementation.

Define a prime and a finite field:

```
sage: p = 4091
sage: F = GF(p^2, 'a')
```


Before this ticket:

```
sage: F.fetch_int(3*p + 2)
Traceback (most recent call last)
...
AttributeError: 'FiniteField_pari_ffelt_with_category' object has no attribute 'fetch_int'
```


After this ticket:

```
sage: F.fetch_int(3*4091 + 2)
3*a + 2
```


Requested at

- [Ask Sage question 55451](https://ask.sagemath.org/question/55451)



---

Comment by @DaveWitteMorris created at 2021-02-04 04:34:39

The PR adds the requested method (and doctests) to the base class. I don't think we should assume that we know how the element constructor acts on lists, so I did not use the elegant solution that is in the [ask Sage question](https://ask.sagemath.org/question/55451/arithmetic-operation-is-not-working-in-finite-field-gf40912/), although I did use the same idea.
----
New commits:


---

Comment by @DaveWitteMorris created at 2021-02-04 04:34:39

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-02-05 00:18:09

I think this is good overall. Here are some changes that should increase the speed:

```diff
         n = Integer(n)
         if (n < 0) or (n >= self.order()):
             raise TypeError("n must be between 0 and self.order()")
         if n == 0:
-            return self(0)
+            return self.zero()
-        digs = n.digits(base=self.characteristic())
-        return sum(self(digs[i]) * self.gen()**i for i in range(len(digs)))
+        cdef list digs = n.digits(base=self.characteristic())
+        g = self.gen()
+        return self.sum(self(val) * g**i for val in digs if val)
```

Other than that LGTM.


---

Comment by git created at 2021-02-05 01:58:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2021-02-05 02:01:03

Thanks for the suggestions! I had to change the final line, because `i` is an undefined variable in `(self(val) * g**i for val in digs if val)`.


---

Comment by git created at 2021-02-05 02:06:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2021-02-05 02:07:46

I forgot to save the final edit to the file before the last commit, so the commit was missing one of the reviewer suggestions. My bad.


---

Comment by tscrim created at 2021-02-05 03:49:41

Ah, right, the `i`. This is marginally faster (at least, the last time I tested it):

```
return self.sum(self(val) * g**i for i, val in enumerate(digs) if val)
```



---

Comment by git created at 2021-02-05 05:15:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2021-02-05 05:19:47

Thanks, that's better than what I had. It bothered me that I was accessing `digs[i]` twice, but I didn't know how to avoid that.


---

Comment by tscrim created at 2021-02-05 06:10:09

Thank you.


---

Comment by tscrim created at 2021-02-05 06:10:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-03-09 00:02:20

Resolution: fixed
