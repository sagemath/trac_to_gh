# Issue 22718: Put MatrixSpace in the category of ModulesWithBasis

archive/issues_022718.json:
```json
{
    "body": "CC:  @nthiery @fchapoton @kcrisman @darijgr\n\n`MatrixSpace` has a basis, so we should put it into the category of `ModulesWithBasis`. We also use `dict` as `monomial_coefficients` with the extra keyword `copy` (default `True`) and change the `basis` to return a `Family`.\n\n**note** the change to `basis` is backwards incompatible.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22955\n\n",
    "created_at": "2017-05-06T18:04:44Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Put MatrixSpace in the category of ModulesWithBasis",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22718",
    "user": "https://github.com/tscrim"
}
```
CC:  @nthiery @fchapoton @kcrisman @darijgr

`MatrixSpace` has a basis, so we should put it into the category of `ModulesWithBasis`. We also use `dict` as `monomial_coefficients` with the extra keyword `copy` (default `True`) and change the `basis` to return a `Family`.

**note** the change to `basis` is backwards incompatible.

Issue created by migration from https://trac.sagemath.org/ticket/22955





---

archive/issue_comments_316808.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-06T18:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316808",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_316809.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-06T18:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316809",
    "user": "https://github.com/tscrim"
}
```

New commits:



---

archive/issue_comments_316810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-06T18:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_316811.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-06T18:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_316812.json:
```json
{
    "body": "Changing component from categories to linear algebra.",
    "created_at": "2017-05-06T18:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316812",
    "user": "https://github.com/tscrim"
}
```

Changing component from categories to linear algebra.



---

archive/issue_comments_316813.json:
```json
{
    "body": "Altogether it looks good. And it's very nice to have `MatrixSpaces` get finally closer from proper ModulesWithBasis`. Thanks Travis!\n\nI still need to double check on the changes in `Family`. Maybe they are unavoidable with the current `FiniteFamily` API which makes it a pinch cumbursome to create a family from a set of indices and a function. For consistency it could be good to create the basis through `Family` and have the latter use `keys` to specify the indices as is already done when it creates a `FiniteFamily`. More later.\n\nOne additional question: rather than loading more categories upon startup, would we have a chance to avoid creating a matrix space upon Sage startup? That's what we would want in the long run.",
    "created_at": "2017-05-07T21:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316813",
    "user": "https://github.com/nthiery"
}
```

Altogether it looks good. And it's very nice to have `MatrixSpaces` get finally closer from proper ModulesWithBasis`. Thanks Travis!

I still need to double check on the changes in `Family`. Maybe they are unavoidable with the current `FiniteFamily` API which makes it a pinch cumbursome to create a family from a set of indices and a function. For consistency it could be good to create the basis through `Family` and have the latter use `keys` to specify the indices as is already done when it creates a `FiniteFamily`. More later.

One additional question: rather than loading more categories upon startup, would we have a chance to avoid creating a matrix space upon Sage startup? That's what we would want in the long run.



---

archive/issue_comments_316814.json:
```json
{
    "body": "Plausibly unrelated, but just in case, see #12099.",
    "created_at": "2017-05-08T01:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316814",
    "user": "https://github.com/nthiery"
}
```

Plausibly unrelated, but just in case, see #12099.



---

archive/issue_comments_316815.json:
```json
{
    "body": "Replying to [comment:6 nthiery]:\n> Altogether it looks good. And it's very nice to have `MatrixSpaces` get finally closer from proper ModulesWithBasis`. Thanks Travis!\n\nThis has been something I have wanted for a long time too with some use cases.\n\n> I still need to double check on the changes in `Family`. Maybe they are unavoidable with the current `FiniteFamily` API which makes it a pinch cumbursome to create a family from a set of indices and a function. For consistency it could be good to create the basis through `Family` and have the latter use `keys` to specify the indices as is already done when it creates a `FiniteFamily`. More later.\n\nReally the only reason I make these changes is so the print order is fixed. I feel this is a natural change. I don't think I am quite following what you are saying about the API.\n\n> One additional question: rather than loading more categories upon startup, would we have a chance to avoid creating a matrix space upon Sage startup? That's what we would want in the long run.\n\nI agree. Maybe I shouldn't be so lazy here... <.< >.>",
    "created_at": "2017-05-08T06:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316815",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:6 nthiery]:
> Altogether it looks good. And it's very nice to have `MatrixSpaces` get finally closer from proper ModulesWithBasis`. Thanks Travis!

This has been something I have wanted for a long time too with some use cases.

> I still need to double check on the changes in `Family`. Maybe they are unavoidable with the current `FiniteFamily` API which makes it a pinch cumbursome to create a family from a set of indices and a function. For consistency it could be good to create the basis through `Family` and have the latter use `keys` to specify the indices as is already done when it creates a `FiniteFamily`. More later.

Really the only reason I make these changes is so the print order is fixed. I feel this is a natural change. I don't think I am quite following what you are saying about the API.

> One additional question: rather than loading more categories upon startup, would we have a chance to avoid creating a matrix space upon Sage startup? That's what we would want in the long run.

I agree. Maybe I shouldn't be so lazy here... <.< >.>



---

archive/issue_comments_316816.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> Really the only reason I make these changes is so the print order is fixed.\n> I feel this is a natural change.\n\nAgreed.\n\n> I don't think I am quite following what you are saying about the API.\n\nI'll give it a shot in terms of code now.",
    "created_at": "2017-05-08T13:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316816",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:8 tscrim]:
> Really the only reason I make these changes is so the print order is fixed.
> I feel this is a natural change.

Agreed.

> I don't think I am quite following what you are saying about the API.

I'll give it a shot in terms of code now.



---

archive/issue_comments_316817.json:
```json
{
    "body": "Replying to [comment:9 nthiery]:\n> Replying to [comment:8 tscrim]:\n> > I don't think I am quite following what you are saying about the API.\n> \n> I'll give it a shot in terms of code now.\n\nGreat, thanks.",
    "created_at": "2017-05-08T13:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316817",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:9 nthiery]:
> Replying to [comment:8 tscrim]:
> > I don't think I am quite following what you are saying about the API.
> 
> I'll give it a shot in terms of code now.

Great, thanks.



---

archive/issue_comments_316818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-08T14:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316819.json:
```json
{
    "body": "Ok, after reading in detail the Family changes, that's actually how I would have done it myself; all good! I added a test. It would have been best done in a separate ticket, but let's move on.\n\nAbout the changes in `*tour_linalg`, we have a slight problem: the change in the example would require to update the comment just above which says that `basis` returns a list. No big deal in itself, but we need to change that in a bunch of languages; I could take care of the german, french, and english versions; maybe you can handle one or two more. We need people for the others. Dima for russian?\n\nAbout the change in the `french_book` directory: changes there require a discussion with the book authors, to make sure the book is kept in sync. I discussed with myself, so that's done :-)",
    "created_at": "2017-05-08T14:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316819",
    "user": "https://github.com/nthiery"
}
```

Ok, after reading in detail the Family changes, that's actually how I would have done it myself; all good! I added a test. It would have been best done in a separate ticket, but let's move on.

About the changes in `*tour_linalg`, we have a slight problem: the change in the example would require to update the comment just above which says that `basis` returns a list. No big deal in itself, but we need to change that in a bunch of languages; I could take care of the german, french, and english versions; maybe you can handle one or two more. We need people for the others. Dima for russian?

About the change in the `french_book` directory: changes there require a discussion with the book authors, to make sure the book is kept in sync. I discussed with myself, so that's done :-)



---

archive/issue_comments_316820.json:
```json
{
    "body": "Replying to [comment:12 nthiery]:\n> About the changes in `*tour_linalg`, we have a slight problem: the change in the example would require to update the comment just above which says that `basis` returns a list. No big deal in itself, but we need to change that in a bunch of languages; I could take care of the german, french, and english versions; maybe you can handle one or two more. We need people for the others. Dima for russian?\n\nI can do the Spanish and Japanese and probably the Portugese. We could also ask Darij for the Russian too.\n\n> About the change in the `french_book` directory: changes there require a discussion with the book authors, to make sure the book is kept in sync. I discussed with myself, so that's done :-)\n\n`<sup>_</sup>`",
    "created_at": "2017-05-08T15:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316820",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:12 nthiery]:
> About the changes in `*tour_linalg`, we have a slight problem: the change in the example would require to update the comment just above which says that `basis` returns a list. No big deal in itself, but we need to change that in a bunch of languages; I could take care of the german, french, and english versions; maybe you can handle one or two more. We need people for the others. Dima for russian?

I can do the Spanish and Japanese and probably the Portugese. We could also ask Darij for the Russian too.

> About the change in the `french_book` directory: changes there require a discussion with the book authors, to make sure the book is kept in sync. I discussed with myself, so that's done :-)

`<sup>_</sup>`



---

archive/issue_comments_316821.json:
```json
{
    "body": "Is the only change you plan to do `list` -> `family`?",
    "created_at": "2017-05-08T15:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316821",
    "user": "https://github.com/tscrim"
}
```

Is the only change you plan to do `list` -> `family`?



---

archive/issue_comments_316822.json:
```json
{
    "body": "Let me do the French and English now, to see how it feels under the fingers ...",
    "created_at": "2017-05-08T15:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316822",
    "user": "https://github.com/nthiery"
}
```

Let me do the French and English now, to see how it feels under the fingers ...



---

archive/issue_comments_316823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-08T16:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316824.json:
```json
{
    "body": "I ended up doing a first draft for all languages but Japanese. Some translations are plain google ... I double checked they seemed reasonable, and I imagine that, for very constrainted technical sentences like this, google should do a fair job. But please proofread!",
    "created_at": "2017-05-08T16:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316824",
    "user": "https://github.com/nthiery"
}
```

I ended up doing a first draft for all languages but Japanese. Some translations are plain google ... I double checked they seemed reasonable, and I imagine that, for very constrainted technical sentences like this, google should do a fair job. But please proofread!



---

archive/issue_comments_316825.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> I agree. Maybe I shouldn't be so lazy here... <.< >.>\n\n:-)\n\nPlease go ahead and explore. If it's not too hard, let's do it in this ticket. If not, oh well.",
    "created_at": "2017-05-08T16:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316825",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:8 tscrim]:
> I agree. Maybe I shouldn't be so lazy here... <.< >.>

:-)

Please go ahead and explore. If it's not too hard, let's do it in this ticket. If not, oh well.



---

archive/issue_comments_316826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-08T17:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316827.json:
```json
{
    "body": "So the current issue is in the `modular/arithgroup` imports at startup as they create a number of matrices at the module level. So I could go through and lazily import all of that, but I am not sure I want to go through that on this ticket.\n\nThe Spanish and English translations look good. I'm doing the Japanese now.",
    "created_at": "2017-05-08T17:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316827",
    "user": "https://github.com/tscrim"
}
```

So the current issue is in the `modular/arithgroup` imports at startup as they create a number of matrices at the module level. So I could go through and lazily import all of that, but I am not sure I want to go through that on this ticket.

The Spanish and English translations look good. I'm doing the Japanese now.



---

archive/issue_comments_316828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-08T17:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316829.json:
```json
{
    "body": "Okay, this should be the correct Japanese version.",
    "created_at": "2017-05-08T17:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316829",
    "user": "https://github.com/tscrim"
}
```

Okay, this should be the correct Japanese version.



---

archive/issue_comments_316830.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> So the current issue is in the `modular/arithgroup` imports at startup as they create a number of matrices at the module level. So I could go through and lazily import all of that, but I am not sure I want to go through that on this ticket.\n\nAll right. We want to do this at some point, but that's going beyond the scope of this ticket. \nCould you just add, near the relevant atStartup=True, a reference to this ticket?\nThanks for investigating!",
    "created_at": "2017-05-08T18:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316830",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:20 tscrim]:
> So the current issue is in the `modular/arithgroup` imports at startup as they create a number of matrices at the module level. So I could go through and lazily import all of that, but I am not sure I want to go through that on this ticket.

All right. We want to do this at some point, but that's going beyond the scope of this ticket. 
Could you just add, near the relevant atStartup=True, a reference to this ticket?
Thanks for investigating!



---

archive/issue_comments_316831.json:
```json
{
    "body": "Do you have any chance to have someone cross check the russian / japanese? Otherwise, up to the above comment, and assuming all tests pass, I believe this is good to go.",
    "created_at": "2017-05-08T19:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316831",
    "user": "https://github.com/nthiery"
}
```

Do you have any chance to have someone cross check the russian / japanese? Otherwise, up to the above comment, and assuming all tests pass, I believe this is good to go.



---

archive/issue_comments_316832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-08T21:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316833.json:
```json
{
    "body": "I've added the comment. I don't have anyone offhand who I could ask about the Japanese. Darij, could you take a very quick look at the Russian?",
    "created_at": "2017-05-08T21:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316833",
    "user": "https://github.com/tscrim"
}
```

I've added the comment. I don't have anyone offhand who I could ask about the Japanese. Darij, could you take a very quick look at the Russian?



---

archive/issue_comments_316834.json:
```json
{
    "body": "The change to rc/doc/ru/tutorial/tour_linalg.rst is perfectly fine.",
    "created_at": "2017-05-08T21:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316834",
    "user": "https://github.com/darijgr"
}
```

The change to rc/doc/ru/tutorial/tour_linalg.rst is perfectly fine.



---

archive/issue_comments_316835.json:
```json
{
    "body": "Thank you for checking Darij!",
    "created_at": "2017-05-08T21:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316835",
    "user": "https://github.com/tscrim"
}
```

Thank you for checking Darij!



---

archive/issue_comments_316836.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-19T20:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316837.json:
```json
{
    "body": "If you wait until July, then I can get someone to look at the Japanese when I am in Japan. Although I am fairly confident about the translation, and we can always make additional changes later.\n\nHowever, we currently have 1 failing doctest in `categories/covariant_functorial_construction.py` that I do not know if we need to simply change the output or change the test.\n\n```\nsage -t src/sage/categories/covariant_functorial_construction.py\n**********************************************************************\nFile \"src/sage/categories/covariant_functorial_construction.py\", line 262, in sage.categories.covariant_functorial_construction.FunctorialConstructionCategory._base_category_class\nFailed example:\n    F._foo\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: could not infer axiom for the nested class\n    <...AlgebrasWithBasis'> of <...GradedAlgebrasWithBasis'>\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.covariant_functorial_construction.FunctorialConstructionCategory._base_category_class[4]>\", line 1, in <module>\n        F._foo\n      File \"sage/misc/classcall_metaclass.pyx\", line 409, in sage.misc.classcall_metaclass.ClasscallMetaclass.__get__ (/home/travis/sage-build/src/build/cythonized/sage/misc/classcall_metaclass.c:1537)\n        return cls.classget(cls, instance, owner)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/categories/category_with_axiom.py\", line 2059, in __classget__\n        cls, cls._base_category_class_and_axiom[0], base_category_class)\n    AssertionError: base category class for <class 'sage.categories.algebras_with_basis.AlgebrasWithBasis'> mismatch; expected <class 'sage.categories.algebras.Algebras'>, got <class 'sage.categories.graded_algebras_with_basis.GradedAlgebrasWithBasis'>\n**********************************************************************\n```\n",
    "created_at": "2017-05-19T20:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316837",
    "user": "https://github.com/tscrim"
}
```

If you wait until July, then I can get someone to look at the Japanese when I am in Japan. Although I am fairly confident about the translation, and we can always make additional changes later.

However, we currently have 1 failing doctest in `categories/covariant_functorial_construction.py` that I do not know if we need to simply change the output or change the test.

```
sage -t src/sage/categories/covariant_functorial_construction.py
**********************************************************************
File "src/sage/categories/covariant_functorial_construction.py", line 262, in sage.categories.covariant_functorial_construction.FunctorialConstructionCategory._base_category_class
Failed example:
    F._foo
Expected:
    Traceback (most recent call last):
    ...
    ValueError: could not infer axiom for the nested class
    <...AlgebrasWithBasis'> of <...GradedAlgebrasWithBasis'>
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.covariant_functorial_construction.FunctorialConstructionCategory._base_category_class[4]>", line 1, in <module>
        F._foo
      File "sage/misc/classcall_metaclass.pyx", line 409, in sage.misc.classcall_metaclass.ClasscallMetaclass.__get__ (/home/travis/sage-build/src/build/cythonized/sage/misc/classcall_metaclass.c:1537)
        return cls.classget(cls, instance, owner)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/categories/category_with_axiom.py", line 2059, in __classget__
        cls, cls._base_category_class_and_axiom[0], base_category_class)
    AssertionError: base category class for <class 'sage.categories.algebras_with_basis.AlgebrasWithBasis'> mismatch; expected <class 'sage.categories.algebras.Algebras'>, got <class 'sage.categories.graded_algebras_with_basis.GradedAlgebrasWithBasis'>
**********************************************************************
```




---

archive/issue_comments_316838.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-19T20:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316838",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_316839.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-06-05T08:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316839",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_316840.json:
```json
{
    "body": "That should have been needs_info for comment:30.",
    "created_at": "2017-06-05T08:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316840",
    "user": "https://github.com/tscrim"
}
```

That should have been needs_info for comment:30.



---

archive/issue_comments_316841.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-14T04:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316842.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-06-14T04:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316842",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_316843.json:
```json
{
    "body": "After a discussion with Nicolas, we concluded that we can simply change the doctest and we should put a note in about what will happen when `Algebras.WithBasis` is again lazy rather than resolved at startup. At this point, it just needs someone to flip the switch.",
    "created_at": "2017-06-14T04:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316843",
    "user": "https://github.com/tscrim"
}
```

After a discussion with Nicolas, we concluded that we can simply change the doctest and we should put a note in about what will happen when `Algebras.WithBasis` is again lazy rather than resolved at startup. At this point, it just needs someone to flip the switch.



---

archive/issue_comments_316844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-18T02:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316845.json:
```json
{
    "body": "One more change: I made the matrix spaces know they were finite dimensional. This caused some problems with checking to see if certain inputs could be treated as vectors by seeing if they have a `_vector_` attribute. I took the approach that matrices were not to be considered as vectors in those cases.",
    "created_at": "2017-06-18T02:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316845",
    "user": "https://github.com/tscrim"
}
```

One more change: I made the matrix spaces know they were finite dimensional. This caused some problems with checking to see if certain inputs could be treated as vectors by seeing if they have a `_vector_` attribute. I took the approach that matrices were not to be considered as vectors in those cases.



---

archive/issue_comments_316846.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-18T14:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316846",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_316847.json:
```json
{
    "body": "failing doctests, see patchbot report",
    "created_at": "2017-06-18T14:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316847",
    "user": "https://github.com/fchapoton"
}
```

failing doctests, see patchbot report



---

archive/issue_comments_316848.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-18T14:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316849.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-18T14:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316849",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_316850.json:
```json
{
    "body": "Trivial fixes.",
    "created_at": "2017-06-18T14:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316850",
    "user": "https://github.com/tscrim"
}
```

Trivial fixes.



---

archive/issue_comments_316851.json:
```json
{
    "body": "Thanks Travis!\n\nThe Runtime Type Checking to distinguish vectors from matrices is somewhat smelly but I don't see a better way. And it's very nice to finally have matrix spaces as finite dimensional modules. So let it be.\n\nI am assuming the patchbot will go green after your latest fixes. Therefore positive review!\n(could you just double check that the pdf doc compiles?)",
    "created_at": "2017-06-19T19:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316851",
    "user": "https://github.com/nthiery"
}
```

Thanks Travis!

The Runtime Type Checking to distinguish vectors from matrices is somewhat smelly but I don't see a better way. And it's very nice to finally have matrix spaces as finite dimensional modules. So let it be.

I am assuming the patchbot will go green after your latest fixes. Therefore positive review!
(could you just double check that the pdf doc compiles?)



---

archive/issue_comments_316852.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-19T19:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316852",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_316853.json:
```json
{
    "body": "Replying to [comment:41 nthiery]:\n> The Runtime Type Checking to distinguish vectors from matrices is somewhat smelly but I don't see a better way. And it's very nice to finally have matrix spaces as finite dimensional modules. So let it be.\n\nI agree. There might be some better ways by checking dimensions or number of entries. However, it wasn't clear what was the best way forward and this kept the old behavior. We can always change it on a followup.\n\n> I am assuming the patchbot will go green after your latest fixes. Therefore positive review!\n> (could you just double check that the pdf doc compiles?)\n\nPatchbot came back (essentially) green, and I didn't notice a problem with the pdf doc.",
    "created_at": "2017-06-20T01:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316853",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:41 nthiery]:
> The Runtime Type Checking to distinguish vectors from matrices is somewhat smelly but I don't see a better way. And it's very nice to finally have matrix spaces as finite dimensional modules. So let it be.

I agree. There might be some better ways by checking dimensions or number of entries. However, it wasn't clear what was the best way forward and this kept the old behavior. We can always change it on a followup.

> I am assuming the patchbot will go green after your latest fixes. Therefore positive review!
> (could you just double check that the pdf doc compiles?)

Patchbot came back (essentially) green, and I didn't notice a problem with the pdf doc.



---

archive/issue_comments_316854.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-22T07:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22718#issuecomment-316854",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
