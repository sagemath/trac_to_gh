# Issue 33339: Modernize coercion for SpecialHyperellipticQuotientRing

archive/issues_033339.json:
```json
{
    "body": "CC:  @fchapoton\n\nThis is still using the old coercion system and was not covered by the change in #33525.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33576\n\n",
    "created_at": "2022-03-27T06:27:18Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Modernize coercion for SpecialHyperellipticQuotientRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33339",
    "user": "https://github.com/tscrim"
}
```
CC:  @fchapoton

This is still using the old coercion system and was not covered by the change in #33525.

Issue created by migration from https://trac.sagemath.org/ticket/33576





---

archive/issue_comments_474077.json:
```json
{
    "body": "indeed, my fault. I somehow managed to fix only half of the file, sorry.",
    "created_at": "2022-03-27T07:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474077",
    "user": "https://github.com/fchapoton"
}
```

indeed, my fault. I somehow managed to fix only half of the file, sorry.



---

archive/issue_comments_474078.json:
```json
{
    "body": "I am out of time right now, but I have gotten it down to 21 failures that are all likely from the same root 2 causes. One is needing a coercion, the other is something else that I don't understand at all.\n\nI made a few other changes to try and improve the file, which might have broken things. I did find \"one\" bug with the cubic quotient `one()` not having coefficients in the right parent.\n\nHopefully you can find what is going wrong. I will take a look again later in the week.\n----\nNew commits:",
    "created_at": "2022-03-27T08:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474078",
    "user": "https://github.com/tscrim"
}
```

I am out of time right now, but I have gotten it down to 21 failures that are all likely from the same root 2 causes. One is needing a coercion, the other is something else that I don't understand at all.

I made a few other changes to try and improve the file, which might have broken things. I did find "one" bug with the cubic quotient `one()` not having coefficients in the right parent.

Hopefully you can find what is going wrong. I will take a look again later in the week.
----
New commits:



---

archive/issue_comments_474079.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-27T10:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474080.json:
```json
{
    "body": "down to 2 failing doctests",
    "created_at": "2022-03-27T10:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474080",
    "user": "https://github.com/fchapoton"
}
```

down to 2 failing doctests



---

archive/issue_comments_474081.json:
```json
{
    "body": "Thank you. That was a dumb thing on my part to return the element and not the parent. I will investigate the remaining doctest failures tomorrow morning.",
    "created_at": "2022-03-27T10:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474081",
    "user": "https://github.com/tscrim"
}
```

Thank you. That was a dumb thing on my part to return the element and not the parent. I will investigate the remaining doctest failures tomorrow morning.



---

archive/issue_comments_474082.json:
```json
{
    "body": "I think one should exclude `_test_divides, _test_zero` from the `TestSuite`.\n\nThat would fix one of the two failing doctests.",
    "created_at": "2022-03-27T19:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474082",
    "user": "https://github.com/fchapoton"
}
```

I think one should exclude `_test_divides, _test_zero` from the `TestSuite`.

That would fix one of the two failing doctests.



---

archive/issue_comments_474083.json:
```json
{
    "body": "I think the `_test_zero` should be fixed as it is an indication of a bigger underlying bug:\n\n```\nsage: HQR.zero()\n0\nsage: bool(HQR.zero())\nTrue\nsage: f = HQR.zero()._f; f\n0\nsage: type(f)\n<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_cdvf_with_category.element_class'>\nsage: bool(f)\nTrue\nsage: F = f.parent()\nsage: f == F.zero()\nTrue\nsage: f != F.zero()  # it is consistent\nFalse\nsage: bool(F.zero())  # but not here\nFalse\n```\n\n\nMy guess for the second failure is we are not converting some element to the base ring of the polynomial ring like we should. Possibly from skipping some checks.",
    "created_at": "2022-03-27T22:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474083",
    "user": "https://github.com/tscrim"
}
```

I think the `_test_zero` should be fixed as it is an indication of a bigger underlying bug:

```
sage: HQR.zero()
0
sage: bool(HQR.zero())
True
sage: f = HQR.zero()._f; f
0
sage: type(f)
<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_cdvf_with_category.element_class'>
sage: bool(f)
True
sage: F = f.parent()
sage: f == F.zero()
True
sage: f != F.zero()  # it is consistent
False
sage: bool(F.zero())  # but not here
False
```


My guess for the second failure is we are not converting some element to the base ring of the polynomial ring like we should. Possibly from skipping some checks.



---

archive/issue_comments_474084.json:
```json
{
    "body": "Indeed, here is the underlying issue:\n\n```\nsage: f.list(copy=False)\n[0]\nsage: F.zero().list(copy=False)\n[]\n```\n",
    "created_at": "2022-03-27T22:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474084",
    "user": "https://github.com/tscrim"
}
```

Indeed, here is the underlying issue:

```
sage: f.list(copy=False)
[0]
sage: F.zero().list(copy=False)
[]
```




---

archive/issue_comments_474085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-27T22:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474085",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474086.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-27T22:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474086",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474087.json:
```json
{
    "body": "Indeed, it is as I expected. I have fixed the issues. Now all tests pass for the file.",
    "created_at": "2022-03-27T22:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474087",
    "user": "https://github.com/tscrim"
}
```

Indeed, it is as I expected. I have fixed the issues. Now all tests pass for the file.



---

archive/issue_comments_474088.json:
```json
{
    "body": "some pyflakes errors:\n\n```\n+src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py:3114:9 local variable 'n' is assigned to but never used\n+src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py:3117:9 local variable 'br_zero' is assigned to but never used\n```\n\nOnce fixed, you can set to positive on my behalf.",
    "created_at": "2022-03-28T12:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474088",
    "user": "https://github.com/fchapoton"
}
```

some pyflakes errors:

```
+src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py:3114:9 local variable 'n' is assigned to but never used
+src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py:3117:9 local variable 'br_zero' is assigned to but never used
```

Once fixed, you can set to positive on my behalf.



---

archive/issue_comments_474089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-28T23:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474090.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-28T23:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474090",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474091.json:
```json
{
    "body": "Done. Thank you.",
    "created_at": "2022-03-28T23:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474091",
    "user": "https://github.com/tscrim"
}
```

Done. Thank you.



---

archive/issue_comments_474092.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-03-31T23:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474092",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_474093.json:
```json
{
    "body": "Merge failure on top of:\n\na79b1b8baa Trac #33573: extend method cores to accept graphs with multiple edges\n\n9543d076d5 Trac #33570: Add CONTRIBUTING.md to the repository\n\n86d9846846 Trac #33569: Speed up methods allow_multiple_edges and  multiple_edges\n\n08a942330a Trac #33507: sagemath_doc_html: Use jupyter-sphinx for 3D graphics\n\n3dd4e6b470 Trac #33568: Add method `is_integral_domain` for polynomial quotient rings\n\n76d0d33770 Trac #33567: finer category for cubic braid group quotients\n\n328de7a17c Trac #33564: add one test in TestSuite of Coxeter groups\n\n08854a8167 Trac #33559: Fix bug in sage.graphs.graph_coloring.vertex_coloring\n\n1762a6ca6d Trac #33558: get rid of __nonzero__ and use __bool__ instead\n\nfbc8bd05e9 Trac #33555: refresh the file subword.py\n\n42a088a131 Trac #33553: README Build from Source: m4 (step 5) is needed to run `make configure` (step 3)\n\nce74d3217f Trac #33540: remove class inheritance of object in combinat\n\nd8f2ce96a0 Trac #33538: More doctests fix in sage_docbuild\n\na5446dbaa4 Trac #33536: Some changes suggested by lgtm\n\nb9cdb7c713 Trac #33529: Remove old thebe package\n\n211da0e7d1 Trac #33214: V\u00e9lu isogeny formulas use incorrect a-invariants when pre-isomorphism is set\n\n64bd36ebc8 Trac #32687: error in height difference bound\n\nf6ce4103f3 Trac #8784: remove quit_sage() command from all.py top level\n\n3c6f5086b7 Trac #33585: doctest failure when doc html not built/installed but sphinx is available in PYTHONPATH\n\nafa0d9633b Trac #33584: Adapt Mathics interface to SymPy upgrade from 1.8 to 1.10 (resp.1.9)\n\n58bf1ba6bb Trac #33520: scipy, networkx: Update install-requires.txt\n\nd20cc4945d Trac #33139: Fix sagemath_doc_html build failure on Cygwin\n\ne39a3a2736 Trac #31924: sage -t: Do not run pytest on individual Python files unless they match the pytest file pattern\n\na275e1f383 Trac #33607: jupyterlab: Use jupyterlab-server < 2.11\n\n949bb36dd0 Trac #33523: Fix crosslinks in algebras catalog\n\ne3fce642a0 Trac #33469: %matplotlib widget does not work in the scope of %display latex\n\nbaf6b19517 Trac #33443: slow doctest improvements (isogeny_small_degree, function_field, doctest/test.py)\n\nb11471b30b Trac #33393: Implement Krawtchouk, Meixner, and Hahn polynomials\n\na54d7ce44a Trac #33114: Feature.require vs. is_present, is_functional\n\nc399fc096b Trac #32364: every quaternion lies in every quaternion order\n\n5166ac1413 Trac #20343: Add file `sage/misc/latex_standalone.py` and class `TikzPicture`\n\n0991f82d57 Trac #33547: Update sympy to 1.10.1\n\n0d0bb77fb2 Trac #33508: OpenSSL 3.0.2 security update\n\n56d233b1f6 Trac #33227: SystemError: calling remove_from_pari_stack() inside sig_on() in expression.pyx\n\n43474c96d5 Updated [SageMath](SageMath) version to 9.6.beta6\n\n\n\nmerge was not clean: conflicts in src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py",
    "created_at": "2022-03-31T23:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474093",
    "user": "https://github.com/vbraun"
}
```

Merge failure on top of:

a79b1b8baa Trac #33573: extend method cores to accept graphs with multiple edges

9543d076d5 Trac #33570: Add CONTRIBUTING.md to the repository

86d9846846 Trac #33569: Speed up methods allow_multiple_edges and  multiple_edges

08a942330a Trac #33507: sagemath_doc_html: Use jupyter-sphinx for 3D graphics

3dd4e6b470 Trac #33568: Add method `is_integral_domain` for polynomial quotient rings

76d0d33770 Trac #33567: finer category for cubic braid group quotients

328de7a17c Trac #33564: add one test in TestSuite of Coxeter groups

08854a8167 Trac #33559: Fix bug in sage.graphs.graph_coloring.vertex_coloring

1762a6ca6d Trac #33558: get rid of __nonzero__ and use __bool__ instead

fbc8bd05e9 Trac #33555: refresh the file subword.py

42a088a131 Trac #33553: README Build from Source: m4 (step 5) is needed to run `make configure` (step 3)

ce74d3217f Trac #33540: remove class inheritance of object in combinat

d8f2ce96a0 Trac #33538: More doctests fix in sage_docbuild

a5446dbaa4 Trac #33536: Some changes suggested by lgtm

b9cdb7c713 Trac #33529: Remove old thebe package

211da0e7d1 Trac #33214: VÃ©lu isogeny formulas use incorrect a-invariants when pre-isomorphism is set

64bd36ebc8 Trac #32687: error in height difference bound

f6ce4103f3 Trac #8784: remove quit_sage() command from all.py top level

3c6f5086b7 Trac #33585: doctest failure when doc html not built/installed but sphinx is available in PYTHONPATH

afa0d9633b Trac #33584: Adapt Mathics interface to SymPy upgrade from 1.8 to 1.10 (resp.1.9)

58bf1ba6bb Trac #33520: scipy, networkx: Update install-requires.txt

d20cc4945d Trac #33139: Fix sagemath_doc_html build failure on Cygwin

e39a3a2736 Trac #31924: sage -t: Do not run pytest on individual Python files unless they match the pytest file pattern

a275e1f383 Trac #33607: jupyterlab: Use jupyterlab-server < 2.11

949bb36dd0 Trac #33523: Fix crosslinks in algebras catalog

e3fce642a0 Trac #33469: %matplotlib widget does not work in the scope of %display latex

baf6b19517 Trac #33443: slow doctest improvements (isogeny_small_degree, function_field, doctest/test.py)

b11471b30b Trac #33393: Implement Krawtchouk, Meixner, and Hahn polynomials

a54d7ce44a Trac #33114: Feature.require vs. is_present, is_functional

c399fc096b Trac #32364: every quaternion lies in every quaternion order

5166ac1413 Trac #20343: Add file `sage/misc/latex_standalone.py` and class `TikzPicture`

0991f82d57 Trac #33547: Update sympy to 1.10.1

0d0bb77fb2 Trac #33508: OpenSSL 3.0.2 security update

56d233b1f6 Trac #33227: SystemError: calling remove_from_pari_stack() inside sig_on() in expression.pyx

43474c96d5 Updated [SageMath](SageMath) version to 9.6.beta6



merge was not clean: conflicts in src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py



---

archive/issue_comments_474094.json:
```json
{
    "body": "probably conflict with #33558",
    "created_at": "2022-04-01T06:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474094",
    "user": "https://github.com/fchapoton"
}
```

probably conflict with #33558



---

archive/issue_comments_474095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-01T06:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474096.json:
```json
{
    "body": "Indeed. Trivial conflict (the same ones on #33497).",
    "created_at": "2022-04-01T06:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474096",
    "user": "https://github.com/tscrim"
}
```

Indeed. Trivial conflict (the same ones on #33497).



---

archive/issue_comments_474097.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-04-01T06:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474097",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_474098.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-03T11:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33339#issuecomment-474098",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_030137.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-04-03T11:13:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33339",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33339#event-30137"
}
```
