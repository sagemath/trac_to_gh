# Issue 33339: Modernize coercion for SpecialHyperellipticQuotientRing

Issue created by migration from https://trac.sagemath.org/ticket/33576

Original creator: tscrim

Original creation time: 2022-03-27 06:27:18

CC:  chapoton

This is still using the old coercion system and was not covered by the change in #33525.


---

Comment by chapoton created at 2022-03-27 07:31:32

indeed, my fault. I somehow managed to fix only half of the file, sorry.


---

Comment by tscrim created at 2022-03-27 08:54:18

I am out of time right now, but I have gotten it down to 21 failures that are all likely from the same root 2 causes. One is needing a coercion, the other is something else that I don't understand at all.

I made a few other changes to try and improve the file, which might have broken things. I did find "one" bug with the cubic quotient `one()` not having coefficients in the right parent.

Hopefully you can find what is going wrong. I will take a look again later in the week.
----
New commits:


---

Comment by git created at 2022-03-27 10:05:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-27 10:06:30

down to 2 failing doctests


---

Comment by tscrim created at 2022-03-27 10:39:08

Thank you. That was a dumb thing on my part to return the element and not the parent. I will investigate the remaining doctest failures tomorrow morning.


---

Comment by chapoton created at 2022-03-27 19:03:38

I think one should exclude `_test_divides, _test_zero` from the `TestSuite`.

That would fix one of the two failing doctests.


---

Comment by tscrim created at 2022-03-27 22:17:20

I think the `_test_zero` should be fixed as it is an indication of a bigger underlying bug:

```
sage: HQR.zero()
0
sage: bool(HQR.zero())
True
sage: f = HQR.zero()._f; f
0
sage: type(f)
<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_cdvf_with_category.element_class'>
sage: bool(f)
True
sage: F = f.parent()
sage: f == F.zero()
True
sage: f != F.zero()  # it is consistent
False
sage: bool(F.zero())  # but not here
False
```


My guess for the second failure is we are not converting some element to the base ring of the polynomial ring like we should. Possibly from skipping some checks.


---

Comment by tscrim created at 2022-03-27 22:19:33

Indeed, here is the underlying issue:

```
sage: f.list(copy=False)
[0]
sage: F.zero().list(copy=False)
[]
```



---

Comment by git created at 2022-03-27 22:37:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-03-27 22:38:25

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-03-27 22:38:25

Indeed, it is as I expected. I have fixed the issues. Now all tests pass for the file.


---

Comment by chapoton created at 2022-03-28 12:51:35

some pyflakes errors:

```
+src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py:3114:9 local variable 'n' is assigned to but never used
+src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py:3117:9 local variable 'br_zero' is assigned to but never used
```

Once fixed, you can set to positive on my behalf.


---

Comment by git created at 2022-03-28 23:44:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-03-28 23:47:29

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-03-28 23:47:29

Done. Thank you.


---

Comment by vbraun created at 2022-03-31 23:14:51

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-03-31 23:14:51

Merge failure on top of:

a79b1b8baa Trac #33573: extend method cores to accept graphs with multiple edges

9543d076d5 Trac #33570: Add CONTRIBUTING.md to the repository

86d9846846 Trac #33569: Speed up methods allow_multiple_edges and  multiple_edges

08a942330a Trac #33507: sagemath_doc_html: Use jupyter-sphinx for 3D graphics

3dd4e6b470 Trac #33568: Add method `is_integral_domain` for polynomial quotient rings

76d0d33770 Trac #33567: finer category for cubic braid group quotients

328de7a17c Trac #33564: add one test in TestSuite of Coxeter groups

08854a8167 Trac #33559: Fix bug in sage.graphs.graph_coloring.vertex_coloring

1762a6ca6d Trac #33558: get rid of __nonzero__ and use __bool__ instead

fbc8bd05e9 Trac #33555: refresh the file subword.py

42a088a131 Trac #33553: README Build from Source: m4 (step 5) is needed to run `make configure` (step 3)

ce74d3217f Trac #33540: remove class inheritance of object in combinat

d8f2ce96a0 Trac #33538: More doctests fix in sage_docbuild

a5446dbaa4 Trac #33536: Some changes suggested by lgtm

b9cdb7c713 Trac #33529: Remove old thebe package

211da0e7d1 Trac #33214: VÃ©lu isogeny formulas use incorrect a-invariants when pre-isomorphism is set

64bd36ebc8 Trac #32687: error in height difference bound

f6ce4103f3 Trac #8784: remove quit_sage() command from all.py top level

3c6f5086b7 Trac #33585: doctest failure when doc html not built/installed but sphinx is available in PYTHONPATH

afa0d9633b Trac #33584: Adapt Mathics interface to SymPy upgrade from 1.8 to 1.10 (resp.1.9)

58bf1ba6bb Trac #33520: scipy, networkx: Update install-requires.txt

d20cc4945d Trac #33139: Fix sagemath_doc_html build failure on Cygwin

e39a3a2736 Trac #31924: sage -t: Do not run pytest on individual Python files unless they match the pytest file pattern

a275e1f383 Trac #33607: jupyterlab: Use jupyterlab-server < 2.11

949bb36dd0 Trac #33523: Fix crosslinks in algebras catalog

e3fce642a0 Trac #33469: %matplotlib widget does not work in the scope of %display latex

baf6b19517 Trac #33443: slow doctest improvements (isogeny_small_degree, function_field, doctest/test.py)

b11471b30b Trac #33393: Implement Krawtchouk, Meixner, and Hahn polynomials

a54d7ce44a Trac #33114: Feature.require vs. is_present, is_functional

c399fc096b Trac #32364: every quaternion lies in every quaternion order

5166ac1413 Trac #20343: Add file `sage/misc/latex_standalone.py` and class `TikzPicture`

0991f82d57 Trac #33547: Update sympy to 1.10.1

0d0bb77fb2 Trac #33508: OpenSSL 3.0.2 security update

56d233b1f6 Trac #33227: SystemError: calling remove_from_pari_stack() inside sig_on() in expression.pyx

43474c96d5 Updated [SageMath](SageMath) version to 9.6.beta6



merge was not clean: conflicts in src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py


---

Comment by chapoton created at 2022-04-01 06:52:37

probably conflict with #33558


---

Comment by git created at 2022-04-01 06:54:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-04-01 06:55:05

Indeed. Trivial conflict (the same ones on #33497).


---

Comment by tscrim created at 2022-04-01 06:55:05

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-04-03 11:13:42

Resolution: fixed
