# Issue 13702: Segmentation fault in subgraph_search

Issue created by migration from https://trac.sagemath.org/ticket/13906

Original creator: azi

Original creation time: 2013-01-04 10:37:41

Assignee: jason, ncohen, rlm

CC:  rbeezer ncohen

A very weird thing happens when you start searching for the obvious. If one uses subgraph_search on a single vertex, the function (oddly???) works at times and segfaults at others. The segfault happens arbitrarily. 


```
sage: G = graphs.RandomBarabasiAlbert(100,2)
sage: G.subgraph_search(graphs.CompleteGraph(1))
Subgraph of (): Graph on 1 vertex
sage: G.subgraph_search(graphs.CompleteGraph(1))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/azi/moreMoore/<ipython console> in <module>()

/home/azi/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in subgraph_search(self, G, induced)
  10245         S = SubgraphSearch(self, G, induced = induced)
  10246         
> 10247         for g in S:
  10248             if induced:
  10249                 return self.subgraph(g)

/home/azi/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/graphs/generic_graph_pyx.so in sage.graphs.generic_graph_pyx.SubgraphSearch.__next__ (sage/graphs/generic_graph_pyx.c:5897)()

RuntimeError: Segmentation fault
sage: G.subgraph_search(graphs.CompleteGraph(1))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/azi/moreMoore/<ipython console> in <module>()

/home/azi/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in subgraph_search(self, G, induced)
  10245         S = SubgraphSearch(self, G, induced = induced)
  10246         
> 10247         for g in S:
  10248             if induced:
  10249                 return self.subgraph(g)

/home/azi/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/graphs/generic_graph_pyx.so in sage.graphs.generic_graph_pyx.SubgraphSearch.__next__ (sage/graphs/generic_graph_pyx.c:5897)()

RuntimeError: Segmentation fault
sage: G.subgraph_search(graphs.CompleteGraph(1))
Subgraph of (): Graph on 1 vertex
sage: G.subgraph_search(graphs.CompleteGraph(1))
Subgraph of (): Graph on 1 vertex
sage: G.subgraph_search(graphs.CompleteGraph(1))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/azi/moreMoore/<ipython console> in <module>()

/home/azi/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in subgraph_search(self, G, induced)
  10245         S = SubgraphSearch(self, G, induced = induced)
  10246         
> 10247         for g in S:
  10248             if induced:
  10249                 return self.subgraph(g)

/home/azi/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/graphs/generic_graph_pyx.so in sage.graphs.generic_graph_pyx.SubgraphSearch.__next__ (sage/graphs/generic_graph_pyx.c:5897)()

RuntimeError: Segmentation fault
```



---

Comment by azi created at 2013-01-04 10:53:23

Okay I see where the problem is. SubgraphSearch assumes the graph always has at least two vertices! I'll post a patch soon.


---

Comment by azi created at 2013-01-04 11:22:22

As it turns out subgraph_search_iter segfaults and subgraph_searc_count as well (in addition to giving wrong results). 

The patch should solve these problems.


---

Comment by azi created at 2013-01-04 11:22:34

Changing status from new to needs_review.


---

Comment by ncohen created at 2013-01-05 09:33:14

Helloooooooooooo !!

Well, your patch looks all right to me ! THaaaaaaaaaanks ! `:-)`

Nathann


---

Comment by ncohen created at 2013-01-05 09:33:14

Changing status from needs_review to positive_review.


---

Comment by azi created at 2013-01-05 10:49:56

Just a quick question ! Should we actually perform the check in the SubgraphSearch.pxy file or perhaps add a comment that it assumes graphs have order at least 2?


---

Comment by ncohen created at 2013-01-05 10:51:38

Indeed, raising an exception in Subgraph search may be a good idea `:-)`

Nathann


---

Attachment


---

Comment by azi created at 2013-01-05 12:40:39

Nathan!

Could you please look at this (trivial) modification if it is OK?

Thank youuuuuuu!!


---

Comment by ncohen created at 2013-01-05 14:45:46

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2013-01-05 14:45:55

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2013-01-07 08:35:45

If you agree with this patch, to be applied on top of yours, then this bug can be finally fixed ! Sorry for the delay `;-)`

Nathann

Apply trac_13906_subgraph_search_K1.2.patch, trac_13906-rev.patch


---

Attachment

(btw, you should add a commit message to your patch, or Jeroen won't like it)

Nathann


---

Comment by azi created at 2013-01-07 11:32:53

I agree with your patch of course! I am not sure how to make a commit message though! Could you make it or perhaps explain it to me how to do it?

Best,

Jernej


---

Comment by ncohen created at 2013-01-07 12:44:38

Helloooooooooooooo !!!

Well, there are many ways to write a commit message, but it depends on how you use mercurial. If you use mercurial queue, then you can do "hg qref -e" instead of "hg qref". That's what I do. But of course, you can also edit the .patch file with a text editor, and write a message like the one you will find in my patch `:-)`

Nathann


---

Comment by azi created at 2013-01-07 13:53:33

Hello!1

Damn technology.. What I usually do is just run "hg diff" from the command line. I have now issues "hg commit" to write a commit message and now "hg diff" does not produce any output. Do you happen to know how could I now obtain a patch of the change?

Sorry for being so annoying with these "meta problems" I'll offer you a dinner when you come to Ljubljana :-)


---

Comment by ncohen created at 2013-01-07 14:02:45

Helloooooooooooooo !!

I just asked one of my colleagues (who uses mercurual queue too, so he wasn't so sure) and he told me to give "hg rollback" a try.

While keeping your finger crossed `:-P`

Nathann


---

Comment by ncohen created at 2013-01-16 10:54:41

Changing status from needs_review to needs_work.


---

Comment by azi created at 2013-01-21 13:13:30

Hello!

Here we go! I have now added the commit message to the patch!

Let me know if everything is all right!!


---

Comment by azi created at 2013-01-21 13:13:45

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2013-01-21 13:55:49

Changing status from needs_review to positive_review.


---

Attachment

Well, if you have a proper commit message then I guess that it's good to go ! `:-)`

Nathann

Apply trac_13906_subgraph_search_K1.patch, trac_13906-rev.patch


---

Comment by jdemeyer created at 2013-01-25 13:07:44

Resolution: fixed
