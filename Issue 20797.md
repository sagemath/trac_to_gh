# Issue 20797: Upgrade to pynac-0.6.8

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2016-07-17 06:11:05

CC:  paulmasson

The new Pynac version does:
* fix polylog evalf (Sage #18368)
* better beta_evalf() (Sage #15196)
* fix bug in cancelling of fractions (Sage #19775, #20843)
* fix some positive/nonnegative bugs
* do not ignore `_print_latex_()` in `GinacFunction`s
* provide Pynac version of Maxima's `ex.coefficients()` (Sage #20455)
* some fixes ported from GiNaC

https://github.com/pynac/pynac/releases/download/pynac-0.6.8/pynac-0.6.8.tar.bz2


---

Comment by rws created at 2016-07-17 06:26:50

New commits:


---

Comment by rws created at 2016-07-17 06:26:50

Changing status from new to needs_review.


---

Comment by paulmasson created at 2016-07-17 21:46:25

Started from a clean copy of 7.3.beta8 `develop` and pulled in changes for this ticket. Ran `make` and got this error:


```
The following package(s) may have failed to build (not necessarily
during this run of 'make all'):

* package: sagelib-7.3.beta5
  log file: /Users/Masson/Downloads/GitHub/sage/logs/pkgs/sagelib-7.3.beta5.log
  build directory: /Users/Masson/Downloads/GitHub/sage/local/var/tmp/sage/build/sagelib-7.3.beta5
```


Ran `make` again on `develop` with no problem.


---

Comment by paulmasson created at 2016-07-20 20:26:36

Any update on the 7.3.beta5 error message? Something on my end or yours?


---

Comment by rws created at 2016-07-21 06:21:04

Replying to [comment:3 paulmasson]:
> Started from a clean copy of 7.3.beta8 `develop` and pulled in changes for this ticket.

How did you "pull in" the changes? BTW, if you do `git trac checkout 21034` you will always get the Sage version of the branch in 21034, regardless of your develop. Also a hint: `make start` will skip building the expensive step of building the docs.

You should also download the pynac tarball and copy it into `upstream/` before making.


---

Comment by paulmasson created at 2016-07-21 22:45:40

Originally did `git trac pull 21034`. This time did `git trach checkout 21034` and getting same error. Then also copied pynac tarball to `upstream` folder and still getting error. Last bit not building is this:


```
[sagelib-7.3.beta8] [3/9] gcc -fno-strict-aliasing -I/Users/Masson/Downloads/GitHub/sage/local/var/tmp/sage/build/python2-2.7.10.p2/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/Masson/Downloads/GitHub/sage/local/include -I/Users/Masson/Downloads/GitHub/sage/local/include/python2.7 -I/Users/Masson/Downloads/GitHub/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/Masson/Downloads/GitHub/sage/src -I/Users/Masson/Downloads/GitHub/sage/src/sage/ext -I/Users/Masson/Downloads/GitHub/sage/src/build/cythonized -I/Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/ext -I/Users/Masson/Downloads/GitHub/sage/local/include/python2.7 -c /Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/symbolic/getitem.cpp -o build/temp.macosx-10.9-x86_64-2.7/Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/symbolic/getitem.o -std=c++11 -fno-strict-aliasing
[sagelib-7.3.beta8] error: command 'gcc' failed with exit status 1
[sagelib-7.3.beta8] make[3]: *** [sage] Error 1
```


Can't review until it builds completely.


---

Comment by rws created at 2016-07-22 05:48:30

In comment:5 you write about starting from beta8 but the output shows beta5. Can you please confirm that beta8 develop compiles cleanly? I'm asking because on the sage-devel there are several reports about problems of beta8 on MacOS.


---

Comment by paulmasson created at 2016-07-22 06:01:35

7.3.beta8 develop compiles cleanly on Mac OS X El Capitan


---

Comment by git created at 2016-07-23 06:11:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-07-23 06:55:25

beta9 is now merged into the branch and has all recent MacOS fixes. Please either do `git trac pull 21034` in your local copy of this branch, or delete your local copy of this branch and do a `git trac checkout 21034`. And try again.


---

Comment by paulmasson created at 2016-07-23 21:49:05

Sorry Ralf, but still getting the error. Curiously even though it references "sagelib-7.3.beta5.log" this file hasn't been modified building either beta8 or beta9.

Before you ask, 7.3.beta9 develop also compiles cleanly on Mac OS X El Capitan.

Looking back to the pynac 0.6.7 upgrade, there is a [comment](https://trac.sagemath.org/ticket/20742#comment:11) from Travis that looks relevant. This prompted me to see which beta included 0.6.7 and sure enough it was beta5.

I'll be the first to admit knowing nothing about building tarballs, but are you sure there isn't a problem there? The tarball for 0.6.8 isn't downloading automatically to the `upstream` folder.


---

Comment by rws created at 2016-07-24 06:27:42

Paul, Sage cannot download pynac-0.6.8 because this is only possible after this ticket is merged. As a reviewer you need to download manually and copy it into upstream. Note however that the tarball might be deleted again by Sage at some time. So always make sure it's there before compiling this branch.


---

Comment by paulmasson created at 2016-07-24 19:15:54

This time I downloaded the tarball to `upstream`, deleted the local branch, did `git trac checkout 21034`, confirmed the tarball was in place and ran `make`. Unfortunately, same error. Tarball still there after `make` errors out. What now?


---

Comment by paulmasson created at 2016-07-25 02:35:10

In an effort to move this forward, I did `make distclean` followed by `make`. The latter fails for both `master` and `develop`, so there are Mac issues at play. Will report on sage-devel.


---

Comment by paulmasson created at 2016-07-26 20:53:48

Not a Mac problem after all. I accidentally merged #21006 some time ago which left behind an empty package folder named "prompt_toolkit". Any package following it alphabetically was ignored, including pynac.


---

Comment by paulmasson created at 2016-07-27 02:57:26

Finally built this ticket! Some preliminary questions:

1) The second plot in #18368 still throws an error. Have you modified the behavior of the zeta function in Pynac or just the polylog? If the latter, the doctest you included doesn't appear to address the problem with the zeta function on that ticket.

2) Numerical evaluation of the beta function looks good, so that fixes #15196. I have noticed however that evaluating the beta function at poles returns `NaN` rather than unsigned infinity. Is this something that needs to be addressed in Sage or Pynac?

3) The description of #20888 makes it sound like an existing LaTeX string in Pynac overrides one in Sage. Is that correct? If so, shouldn't entries in Sage always take precedence?

4) This ticket doesn't appear to change anything for #20455. Does that ticket need to be addressed in Sage using behavior now available from Pynac?

Will do more testing tomorrow. Thanks for putting up with my build issue.


---

Comment by rws created at 2016-07-27 05:49:02

1) Yes, only part of #18368 is fixed, 2) the infinity problem has to be addressed in Sage and it's the same problem as #19439 so it should go in that ticket, 3) Yes, and this is only one example where Pynac code overrides Sage code (I don't think this is a problem in principle), 4) Good Question, in the process of implementation I had to revise my opinion, let's discuss that in #20455.


---

Comment by paulmasson created at 2016-07-27 21:45:40

Changing status from needs_review to positive_review.


---

Comment by paulmasson created at 2016-07-27 21:45:40

Doctests pass. Documentation builds. Outstanding issues will be addressed on indicated tickets.

Good to go.


---

Comment by paulmasson created at 2016-07-28 00:51:09

Typo in ticket description referencing wrong ticket. Positive review stands.


---

Comment by rws created at 2016-07-28 13:10:51

Thanks for the review.


---

Comment by vbraun created at 2016-08-07 20:01:16

Resolution: fixed
