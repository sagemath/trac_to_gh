# Issue 10553: Trouble with deepcopy of vectorspaces where the inner product matrix is specified

archive/issues_010553.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  was jonhanke\n\nKeywords: copy, vectorspace\n\nThere are some serious problems using deepcopy on vectorspaces where the inner_product_matrix is specified.  This fails over GF(p) for large primes, and over RR.\n\nPlease see also Ticket #10577 for a related problem over GF(2).\n\n\n```\nsage: V = VectorSpace(GF(46337), 2, inner_product_matrix=DiagonalMatrix(ZZ, [1,1]))\nsage: deepcopy(V)\nAmbient quadratic space of dimension 2 over Finite Field of size 46337\nInner product matrix:\n[1 0]\n[0 1]\nsage: \nsage: V = VectorSpace(GF(46349), 2, inner_product_matrix=DiagonalMatrix(ZZ, [1,1]))\nsage: deepcopy(V)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)\n    187                             raise Error(\n    188                                 \"un(deep)copyable object of type %s\" % cls)\n--> 189                 y = _reconstruct(x, rv, 1, memo)\n    190 \n    191     memo[d] = y\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in _reconstruct(x, info, deep, memo)\n    320         dictiter = None\n    321     if deep:\n--> 322         args = deepcopy(args, memo)\n    323     y = callable(*args)\n    324     memo[id(x)] = y\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)\n    160     copier = _deepcopy_dispatch.get(cls)\n    161     if copier:\n--> 162         y = copier(x, memo)\n    163     else:\n    164         try:\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in _deepcopy_tuple(x, memo)\n    233     y = []\n    234     for a in x:\n--> 235         y.append(deepcopy(a, memo))\n    236     d = id(x)\n    237     try:\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)\n    160     copier = _deepcopy_dispatch.get(cls)\n    161     if copier:\n--> 162         y = copier(x, memo)\n    163     else:\n    164         try:\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in _deepcopy_tuple(x, memo)\n    233     y = []\n    234     for a in x:\n--> 235         y.append(deepcopy(a, memo))\n    236     d = id(x)\n    237     try:\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)\n    171             copier = getattr(x, \"__deepcopy__\", None)\n    172             if copier:\n--> 173                 y = copier(memo)\n    174             else:\n    175                 reductor = dispatch_table.get(cls)\n\nTypeError: __deepcopy__() takes no arguments (1 given)\n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10606\n\n",
    "created_at": "2011-01-12T20:35:19Z",
    "labels": [
        "linear algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Trouble with deepcopy of vectorspaces where the inner product matrix is specified",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10553",
    "user": "jonhanke"
}
```
Assignee: jason, was

CC:  was jonhanke

Keywords: copy, vectorspace

There are some serious problems using deepcopy on vectorspaces where the inner_product_matrix is specified.  This fails over GF(p) for large primes, and over RR.

Please see also Ticket #10577 for a related problem over GF(2).


```
sage: V = VectorSpace(GF(46337), 2, inner_product_matrix=DiagonalMatrix(ZZ, [1,1]))
sage: deepcopy(V)
Ambient quadratic space of dimension 2 over Finite Field of size 46337
Inner product matrix:
[1 0]
[0 1]
sage: 
sage: V = VectorSpace(GF(46349), 2, inner_product_matrix=DiagonalMatrix(ZZ, [1,1]))
sage: deepcopy(V)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)
    187                             raise Error(
    188                                 "un(deep)copyable object of type %s" % cls)
--> 189                 y = _reconstruct(x, rv, 1, memo)
    190 
    191     memo[d] = y

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in _reconstruct(x, info, deep, memo)
    320         dictiter = None
    321     if deep:
--> 322         args = deepcopy(args, memo)
    323     y = callable(*args)
    324     memo[id(x)] = y

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)
    160     copier = _deepcopy_dispatch.get(cls)
    161     if copier:
--> 162         y = copier(x, memo)
    163     else:
    164         try:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in _deepcopy_tuple(x, memo)
    233     y = []
    234     for a in x:
--> 235         y.append(deepcopy(a, memo))
    236     d = id(x)
    237     try:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)
    160     copier = _deepcopy_dispatch.get(cls)
    161     if copier:
--> 162         y = copier(x, memo)
    163     else:
    164         try:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in _deepcopy_tuple(x, memo)
    233     y = []
    234     for a in x:
--> 235         y.append(deepcopy(a, memo))
    236     d = id(x)
    237     try:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in deepcopy(x, memo, _nil)
    171             copier = getattr(x, "__deepcopy__", None)
    172             if copier:
--> 173                 y = copier(memo)
    174             else:
    175                 reductor = dispatch_table.get(cls)

TypeError: __deepcopy__() takes no arguments (1 given)
```




Issue created by migration from https://trac.sagemath.org/ticket/10606





---

archive/issue_comments_110313.json:
```json
{
    "body": "Works in 8.2.b7",
    "created_at": "2018-03-10T07:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110313",
    "user": "chapoton"
}
```

Works in 8.2.b7



---

archive/issue_comments_110314.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-10T07:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110314",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_110315.json:
```json
{
    "body": "Shouldn't we add a doctest to show the bug is fixed?",
    "created_at": "2018-03-20T11:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110315",
    "user": "sbrandhorst"
}
```

Shouldn't we add a doctest to show the bug is fixed?



---

archive/issue_comments_110316.json:
```json
{
    "body": "Replying to [comment:6 sbrandhorst]:\n> Shouldn't we add a doctest to show the bug is fixed?\n\nFeel free to add one.",
    "created_at": "2018-05-05T23:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110316",
    "user": "tscrim"
}
```

Replying to [comment:6 sbrandhorst]:
> Shouldn't we add a doctest to show the bug is fixed?

Feel free to add one.



---

archive/issue_comments_110317.json:
```json
{
    "body": "doctest added, please review\n----\nNew commits:",
    "created_at": "2018-05-06T06:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110317",
    "user": "chapoton"
}
```

doctest added, please review
----
New commits:



---

archive/issue_comments_110318.json:
```json
{
    "body": "LGTM.",
    "created_at": "2018-05-06T08:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110318",
    "user": "tscrim"
}
```

LGTM.



---

archive/issue_comments_110319.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-06T08:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110319",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110320.json:
```json
{
    "body": "Changing priority from critical to minor.",
    "created_at": "2018-05-06T08:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110320",
    "user": "tscrim"
}
```

Changing priority from critical to minor.



---

archive/issue_comments_110321.json:
```json
{
    "body": "there is a typo Z Z",
    "created_at": "2018-05-06T10:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110321",
    "user": "chapoton"
}
```

there is a typo Z Z



---

archive/issue_comments_110322.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-06T10:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110322",
    "user": "chapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110323.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-06T10:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110323",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_110324.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-06T10:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110324",
    "user": "chapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_110325.json:
```json
{
    "body": "corrected and tested. I am setting back to positive",
    "created_at": "2018-05-06T10:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110325",
    "user": "chapoton"
}
```

corrected and tested. I am setting back to positive



---

archive/issue_comments_110326.json:
```json
{
    "body": "pyflakes plugin is not happy",
    "created_at": "2018-05-06T15:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110326",
    "user": "chapoton"
}
```

pyflakes plugin is not happy



---

archive/issue_comments_110327.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-06T15:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110327",
    "user": "chapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110328.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-06T15:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110328",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_110329.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-06T15:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110329",
    "user": "chapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_110330.json:
```json
{
    "body": "done, setting back to positive",
    "created_at": "2018-05-06T15:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110330",
    "user": "chapoton"
}
```

done, setting back to positive



---

archive/issue_comments_110331.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-15T22:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10553#issuecomment-110331",
    "user": "vbraun"
}
```

Resolution: fixed
