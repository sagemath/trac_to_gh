# Issue 25002: QQbar points of subschemes not valid

Issue created by migration from https://trac.sagemath.org/ticket/25239

Original creator: bhutz

Original creation time: 2018-04-24 13:41:23

There seems to be a numerical issues with QQbar elements for _check_satisfies_equations in subschemes. I can't seem to get a direct reproduction, but the issue appears in 


```
sage: P.<x,y> = ProjectiveSpace(QQ, 1)
sage: f = DynamicalSystem([16*x^2 - 21*y^2, 16*y^2])
sage: f.automorphism_group()
```

Should be just the identity conjugation.


---

Comment by bhutz created at 2018-04-24 13:42:09

I'm not totally sure what the right fix is here. It seems that 'touching' the elements causes the numerical issues to go away. The branch has this particular kind of 'fix'. It would be nice to have a better fix for this...


---

Comment by bhutz created at 2018-04-24 13:45:03

New commits:


---

Comment by nbruin created at 2018-04-25 16:50:25

I'm not able to reproduce the behaviour on 8.2rc4.


---

Comment by bhutz created at 2018-04-25 16:55:34

that would be excellent! I'm running 8.2rc1, so I'll update again and get post again.


---

Comment by bhutz created at 2018-04-25 17:30:16

hmm...the original issue definitely appears to be fixed. However, the example I boiled it down to on the sage-devel ticket still does not work, but gives a different error now.

This was fails for enumeration, but it shouldn't be enumerating on a dimension 0 subscheme

```
P.<x,y,z,w>=ProjectiveSpace(QQ,3)
X=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])
X.change_ring(QQbar).rational_points()
```


This now also works.

```
P.<x,y,z,w>=ProjectiveSpace(QQbar,3)
X=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])
X.rational_points()
```


So this ticket requires some more work, but the original issue (and hence the branch) are now outdated.


---

Comment by bhutz created at 2018-04-25 17:34:24

One more comment...it is still the same issue:


```
P.<x,y,z,w>=ProjectiveSpace(QQ,3)
X=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])
Y=X.change_ring(QQbar)
Y(QQbar).points()
```


fails with


```
TypeError: Coordinates [-1, -1.821428571428572?, -4/7, 1] do not define a point on Closed subscheme of Projective Space of dimension 3 over Algebraic Field defined by:
  (-7/4)*z - w,
  x + (-7/4)*z,
  (-3/4)*x + y + (-9/16)*z + 3/4*w
```



---

Comment by @jasminecamero created at 2019-06-20 14:56:15

The error is now fixed as of version [SageMath](SageMath) 8.8.rc0.


---

Comment by @jasminecamero created at 2019-06-20 15:04:39

Changing status from new to needs_review.


---

Comment by @jasminecamero created at 2019-06-20 15:04:54

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-07-09 19:14:06

Resolution: worksforme


---

Comment by chapoton created at 2019-07-09 19:14:06

I am closing the ticket as required.

Note that in this situation, one should rather check if the fixed issue is doctested somewhere, and if not, add a doctest. Please keep this in mind for the next time.


---

Comment by bhutz created at 2019-08-13 17:54:44

Changing keywords from "" to "SI2019".
