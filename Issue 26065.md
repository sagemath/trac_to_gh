# Issue 26065: MixedIntegerLinearProgram should provide a way to get the variables in the order they are provided to the polyhedron method

Issue created by migration from Trac.

Original creator: tmonteil

Original creation time: 2018-09-17 18:41:27

CC:  jipilab mkoeppe moritz vdelecroix yzh

When creating a `MixedIntegerLinearProgram`, we may have no control on the order in which the (one-dimensional) variables are defined (because of complicated loops).

When we use the `polyhedron` method, the basis of the underlying vector space is ordered according to some order on the variables, which basically follows the order in which they are defined.

However, there is no simple way to get this order for the user. We need a method to get this order if we want to be able to connect information provided by the polytope (e.g. its set of integral points) to the original linear problem.

To provide a concrete example of the issue, see my answer of [this as question](https://ask.sagemath.org/question/43581/how-to-find-the-spanning-elementary-subgraphs-of-a-given-graph/).


---

Comment by dcoudert created at 2018-09-18 12:08:55

I'm not aware of all the ways to use `MixedIntegerLinearProgram`, create variables, use vectors of variables, etc.

At least, in class `MIPVariable`, we can add a list to record the order in which variables of of that class are created. It suffices to add the key to that list inside method `__getitem__`.


---

Comment by mkoeppe created at 2018-09-18 12:17:02

A trick to control the order is to touch all MIP variables in the desired order (before adding constraints to the system).


---

Comment by mkoeppe created at 2018-09-18 12:19:42

Replying to [comment:3 mkoeppe]:
> A trick to control the order is to touch all MIP variables in the desired order (before adding constraints to the system).

In your answer to that ask.sagemath question,
you can simplify

```
 for edge in G.edges(labels=False):
        p.add_constraint(e[edge] >= 0)
```

to

```
[ e[edge] for edge in G.edges(labels=False) ]
```



---

Comment by mkoeppe created at 2018-09-18 12:40:37

Instead of trying to produce a mapping from backend variables to frontend variables, I would propose to:

 - Add an optional argument `backend_values` (a vector of length `self.number_of_variables()`) to the `MixedIntegerLinearProgram.get_values` method. If provided, it will take values from this vector instead of from the backend via `backend.get_variable_value`.


---

Comment by dcoudert created at 2018-09-18 12:42:49

> {{{
> [ e[edge] for edge in G.edges(labels=False) ]
> }}}
MIP variables are stored in a dictionary. So even if you touch them in a certain order, you rely on the ordering of the keys of the dictionary, which might be different.
Storing keys in a list in the order of creation ensures that we get the same order.

Nonetheless, why is the order of the keys of the dictionary not sufficient ? We have an ordering of instances of class MIPVariable inside `MixedIntegerLinearProgram` (it's a list), and then we have the order of the keys.


---

Comment by mkoeppe created at 2018-09-18 13:25:30

No, the mapping to backend indices is created in `MIPVariable.__getitem__,` which calls `backend.add_variable`.
This is why just referencing `e[edge]` creates the order.


---

Comment by mkoeppe created at 2018-09-18 13:34:59

Also see: 
#20773 - `MixedIntegerLinearProgram.new_variable` could optionally take a "static" list of component indices

This could be a nice idiomatic way to ensure consecutive backend indices of a MIPVariable's component variables.


---

Comment by mkoeppe created at 2018-09-18 14:27:40

Also see the proposed new method `MixedIntegerLinearProgram._linear_variable_index` in 
https://git.sagemath.org/sage.git/commit/?h=b7906ffd31c2007d81cb556d23b8b814d2faaebb&id=ca1298b4ec78844b4f5488978ef6e09e76af8ad1
on the branch of #20656 - MixedIntegerLinearProgram: Remove _variables dictionary,
which obtains the mapping from `MIPVariable` components to backend indices.


---

Comment by mkoeppe created at 2018-09-18 15:50:39

#20773 now has an implementation, please review.


---

Comment by tmonteil created at 2018-09-18 21:09:39

Thanks for the pointers, the `_linear_variable_index` proposed in #20656 is somehow what i want (actually, i have a raw `e[edge].dict().keys()[0]` in my own code, but how to explain such a construction while promoting Sage to a newcomer !). However, i do not understand why you made it a hidden method, since the end user will use it to go back-and-forth between the milp and the polyhedron. Perhaps, on the `MixedIntegerLinearProgram` side, one could also have a `p.get_variable_index()(e)` method so that it can be easily discovered (not sure about that though).


---

Comment by mkoeppe created at 2018-09-18 21:58:52

It's fine with me to make it a public method. If you want, go ahead and put this code from #20656 on some separate ticket.


---

Comment by mkoeppe created at 2018-09-18 22:02:44

Replying to [comment:11 tmonteil]:
> Perhaps, on the `MixedIntegerLinearProgram` side, one could also have a `p.get_variable_index()(e)` method so that it can be easily discovered (not sure about that though).

I'd say let's first go for the `linear_variable_index` (or whatever more suitable name we could find...) and #20773 and see the combination leads to convenient user code.


---

Comment by mkoeppe created at 2022-08-25 23:14:03

New commits:
