# Issue 22614: qepcad doctest errors

archive/issues_022614.json:
```json
{
    "body": "With optional package qepcad installed I got\n\n```\n\nsage -t --long --warn-long 70.0 src/sage/interfaces/qepcad.py\n**********************************************************************\nFile \"src/sage/interfaces/qepcad.py\", line 1565, in sage.interfaces.qepcad.?\nFailed example:\n    _qepcad_atoms(qepcad('(E x)[a x + b > 0]', vars='(a,b,x)'))               # optional - qepcad\nExpected:\n    {'a /= 0', 'b > 0'}\nGot:\n    {'finish  &'}\n********************************************************************** \n```\n\n(and many other similar problems).\n\nSee\n- [this patchbot report](https://patchbot.sagemath.org/log/22773/Ubuntu/16.04/x86_64/4.4.0-72-generic/quasar/2017-04-14%2004:51:17?short)\n- [this thread on sage-devel](https://groups.google.com/forum/#!searchin/sage-devel/qepcad$20doctest$20error%7Csort:relevance/sage-devel/WGKwjO4tWws/l4gS5O4PBAAJ)\n\nIssue created by migration from https://trac.sagemath.org/ticket/22851\n\n",
    "created_at": "2017-04-21T07:07:07Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "qepcad doctest errors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22614",
    "user": "https://github.com/videlec"
}
```
With optional package qepcad installed I got

```

sage -t --long --warn-long 70.0 src/sage/interfaces/qepcad.py
**********************************************************************
File "src/sage/interfaces/qepcad.py", line 1565, in sage.interfaces.qepcad.?
Failed example:
    _qepcad_atoms(qepcad('(E x)[a x + b > 0]', vars='(a,b,x)'))               # optional - qepcad
Expected:
    {'a /= 0', 'b > 0'}
Got:
    {'finish  &'}
********************************************************************** 
```

(and many other similar problems).

See
- [this patchbot report](https://patchbot.sagemath.org/log/22773/Ubuntu/16.04/x86_64/4.4.0-72-generic/quasar/2017-04-14%2004:51:17?short)
- [this thread on sage-devel](https://groups.google.com/forum/#!searchin/sage-devel/qepcad$20doctest$20error%7Csort:relevance/sage-devel/WGKwjO4tWws/l4gS5O4PBAAJ)

Issue created by migration from https://trac.sagemath.org/ticket/22851





---

archive/issue_comments_315143.json:
```json
{
    "body": "I can not reproduce this (on a pretty similar setting: Debian stable, x_64, 8.0.beta2). Did you try re-compiling qepcad (just in case) ?",
    "created_at": "2017-04-21T16:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315143",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I can not reproduce this (on a pretty similar setting: Debian stable, x_64, 8.0.beta2). Did you try re-compiling qepcad (just in case) ?



---

archive/issue_comments_315144.json:
```json
{
    "body": "Nope. And note that the patchbot was started from scratch (ie it was a fresh build). For now I disable qepcad on quasar. I will try again later on.",
    "created_at": "2017-04-21T20:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315144",
    "user": "https://github.com/videlec"
}
```

Nope. And note that the patchbot was started from scratch (ie it was a fresh build). For now I disable qepcad on quasar. I will try again later on.



---

archive/issue_comments_315145.json:
```json
{
    "body": "Cannot confirm on OpenSuSE and 8.1.beta2.",
    "created_at": "2017-08-22T08:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315145",
    "user": "https://github.com/rwst"
}
```

Cannot confirm on OpenSuSE and 8.1.beta2.



---

archive/issue_comments_315146.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2017-10-20T15:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315146",
    "user": "https://github.com/koffie"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_315147.json:
```json
{
    "body": "I retried and the same happens with a fresh compilation of 8.1.beta8 (on quasar patchbot).",
    "created_at": "2017-10-20T15:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315147",
    "user": "https://github.com/videlec"
}
```

I retried and the same happens with a fresh compilation of 8.1.beta8 (on quasar patchbot).



---

archive/issue_comments_315148.json:
```json
{
    "body": "I think the error might be non-deterministic. I have seen it on my patchbots too, but it does not happen every time.\n\nMy vote would be to downgrade qepcad to experimental for now.",
    "created_at": "2017-11-13T13:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315148",
    "user": "https://github.com/jdemeyer"
}
```

I think the error might be non-deterministic. I have seen it on my patchbots too, but it does not happen every time.

My vote would be to downgrade qepcad to experimental for now.



---

archive/issue_comments_315149.json:
```json
{
    "body": "Agreed if done together with a report to upstream. They might have an idea about the issue.",
    "created_at": "2017-11-13T13:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315149",
    "user": "https://github.com/videlec"
}
```

Agreed if done together with a report to upstream. They might have an idea about the issue.



---

archive/issue_comments_315150.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> I think the error might be non-deterministic. I have seen it on my patchbots too, but it does not happen every time.\n\nCould you please provide a link to the corresponding logs, so that we can guess the common factor ?\n\nVincent: i am not sure to understand: you get the error systematically on that machine ? Does the doctest fail when run alone from the command line ? Could you evaluate the evolution of available RAM, dmesg, whether you ar running within a VM, etc. Perhaps this patchbot just runs out of some ressource and the `finihsh` is a kind of error that should just be handled by the interface.",
    "created_at": "2017-11-13T15:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315150",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:6 jdemeyer]:
> I think the error might be non-deterministic. I have seen it on my patchbots too, but it does not happen every time.

Could you please provide a link to the corresponding logs, so that we can guess the common factor ?

Vincent: i am not sure to understand: you get the error systematically on that machine ? Does the doctest fail when run alone from the command line ? Could you evaluate the evolution of available RAM, dmesg, whether you ar running within a VM, etc. Perhaps this patchbot just runs out of some ressource and the `finihsh` is a kind of error that should just be handled by the interface.



---

archive/issue_comments_315151.json:
```json
{
    "body": "I did see the error systematically while testing ticket 0 on the quasar patchbot (I did it only twice though).\n\nThe patchbot quasar has:\n- Intel i7-2600\n- 8G of RAM (+ 3G swap)\n- Ubuntu 16.04 (packages up to date)\n- tests are run in parallel with the option `\"parallelism\": 6` of the patchbot\n\nI am recompiling a clean 8.1.rc0 with qepcad only to see if I can reproduce.",
    "created_at": "2017-11-13T16:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315151",
    "user": "https://github.com/videlec"
}
```

I did see the error systematically while testing ticket 0 on the quasar patchbot (I did it only twice though).

The patchbot quasar has:
- Intel i7-2600
- 8G of RAM (+ 3G swap)
- Ubuntu 16.04 (packages up to date)
- tests are run in parallel with the option `"parallelism": 6` of the patchbot

I am recompiling a clean 8.1.rc0 with qepcad only to see if I can reproduce.



---

archive/issue_comments_315152.json:
```json
{
    "body": "It is a failure that I can reproduce on standalone tests\n\n```\nsage -t interfaces/qepcad.py\n**********************************************************************\nFile \"interfaces/qepcad.py\", line 571, in sage.interfaces.qepcad\nFailed example:\n    _qepcad_atoms(qepcad(F))                                 # optional - qepcad\nExpected:\n    {'2 x^2 - 3 < 0', 'x > 0', 'x^2 - 3 <= 0'}\nGot:\n    {'finish  &'}\n**********************************************************************\n1 item had failures:\n   1 of  71 in sage.interfaces.qepcad\n\n    [343 tests, 1 failure, 4.22 s]\n----------------------------------------------------------------------\nsage -t interfaces/qepcad.py  # 1 doctest failed\n```\n\nAnd `dmesg` tells that there has been a segfault\n\n```\n[330099.427778] qepcad[23042]: segfault at 0 ip 00007f53357e0ad0 sp 00007fff03121c58 error 4 in libc-2.23.so[7f533576b000+1c0000]\n[330101.201869] qepcad[23504]: segfault at 0 ip 00007f1a9db08ad0 sp 00007fffff166368 error 4 in libc-2.23.so[7f1a9da93000+1c0000]\n[330101.416720] qepcad[23575]: segfault at 0 ip 00007fc35557dad0 sp 00007ffc40447278 error 4 in libc-2.23.so[7fc355508000+1c0000]\n[330101.486706] qepcad[23615]: segfault at 0 ip 00007f65903e9ad0 sp 00007fff498cadc8 error 4 in libc-2.23.so[7f6590374000+1c0000]\n[330105.033871] qepcad[23162]: segfault at 0 ip 00007f4d7c325ad0 sp 00007ffc5bc8baf8 error 4 in libc-2.23.so[7f4d7c2b0000+1c0000]\n```\n",
    "created_at": "2017-11-14T09:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315152",
    "user": "https://github.com/videlec"
}
```

It is a failure that I can reproduce on standalone tests

```
sage -t interfaces/qepcad.py
**********************************************************************
File "interfaces/qepcad.py", line 571, in sage.interfaces.qepcad
Failed example:
    _qepcad_atoms(qepcad(F))                                 # optional - qepcad
Expected:
    {'2 x^2 - 3 < 0', 'x > 0', 'x^2 - 3 <= 0'}
Got:
    {'finish  &'}
**********************************************************************
1 item had failures:
   1 of  71 in sage.interfaces.qepcad

    [343 tests, 1 failure, 4.22 s]
----------------------------------------------------------------------
sage -t interfaces/qepcad.py  # 1 doctest failed
```

And `dmesg` tells that there has been a segfault

```
[330099.427778] qepcad[23042]: segfault at 0 ip 00007f53357e0ad0 sp 00007fff03121c58 error 4 in libc-2.23.so[7f533576b000+1c0000]
[330101.201869] qepcad[23504]: segfault at 0 ip 00007f1a9db08ad0 sp 00007fffff166368 error 4 in libc-2.23.so[7f1a9da93000+1c0000]
[330101.416720] qepcad[23575]: segfault at 0 ip 00007fc35557dad0 sp 00007ffc40447278 error 4 in libc-2.23.so[7fc355508000+1c0000]
[330101.486706] qepcad[23615]: segfault at 0 ip 00007f65903e9ad0 sp 00007fff498cadc8 error 4 in libc-2.23.so[7f6590374000+1c0000]
[330105.033871] qepcad[23162]: segfault at 0 ip 00007f4d7c325ad0 sp 00007ffc5bc8baf8 error 4 in libc-2.23.so[7f4d7c2b0000+1c0000]
```




---

archive/issue_comments_315153.json:
```json
{
    "body": "optional packages aren't blockers, I'd say",
    "created_at": "2017-11-17T13:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315153",
    "user": "https://github.com/vbraun"
}
```

optional packages aren't blockers, I'd say



---

archive/issue_comments_315154.json:
```json
{
    "body": "Replying to [comment:11 vbraun]:\n> optional packages aren't blockers, I'd say \n\nsince when!? Jeroen proposition at [This is the Trac macro *comment:6* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:6-macro) looks reasonable to me.",
    "created_at": "2017-11-17T16:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315154",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:11 vbraun]:
> optional packages aren't blockers, I'd say 

since when!? Jeroen proposition at [This is the Trac macro *comment:6* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:6-macro) looks reasonable to me.



---

archive/issue_comments_315155.json:
```json
{
    "body": "Hi Volker,\n\nSome time ago I explicitly asked about the support status for optional packages in sage on [sage-devel](https://groups.google.com/d/msg/sage-devel/oDJS-7R0qzE/iRieFYnRAQAJ). In that thread [Jeroen answered](https://groups.google.com/d/msg/sage-devel/oDJS-7R0qzE/WCHDW4jhAQAJ) that optional packages causing doctest failures should be considered blockers. So this is why I made this and the other ticket blocker, and no one objected to that later in the discussion. It would be helpful if you could also state your opinion on this in that sage-devel thread so that other people won't do the same in the future.\n\nThanks,\nMaarten",
    "created_at": "2017-11-17T16:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315155",
    "user": "https://github.com/koffie"
}
```

Hi Volker,

Some time ago I explicitly asked about the support status for optional packages in sage on [sage-devel](https://groups.google.com/d/msg/sage-devel/oDJS-7R0qzE/iRieFYnRAQAJ). In that thread [Jeroen answered](https://groups.google.com/d/msg/sage-devel/oDJS-7R0qzE/WCHDW4jhAQAJ) that optional packages causing doctest failures should be considered blockers. So this is why I made this and the other ticket blocker, and no one objected to that later in the discussion. It would be helpful if you could also state your opinion on this in that sage-devel thread so that other people won't do the same in the future.

Thanks,
Maarten



---

archive/issue_comments_315156.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2017-11-22T10:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315156",
    "user": "https://github.com/videlec"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_315157.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-22T10:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315157",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315158.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-11-22T10:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315158",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_315159.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-22T12:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315159",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315160.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-11-23T21:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22614#issuecomment-315160",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
