# Issue 19450: upgrade cvxopt to version 1.1.8

archive/issues_019450.json:
```json
{
    "body": "CC:  @jdemeyer @nathanncohen\n\nthis is the current stable version\n\nIssue created by migration from https://trac.sagemath.org/ticket/19687\n\n",
    "created_at": "2015-12-09T21:52:21Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "upgrade cvxopt to version 1.1.8",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19450",
    "user": "https://github.com/dimpase"
}
```
CC:  @jdemeyer @nathanncohen

this is the current stable version

Issue created by migration from https://trac.sagemath.org/ticket/19687





---

archive/issue_comments_267079.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-09T22:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267079",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_267080.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-12-09T22:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267080",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_267081.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-11T20:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267081",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_267082.json:
```json
{
    "body": "Looks good to me. No doctest broken on linux x86_64.",
    "created_at": "2015-12-11T20:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267082",
    "user": "https://github.com/kiwifb"
}
```

Looks good to me. No doctest broken on linux x86_64.



---

archive/issue_comments_267083.json:
```json
{
    "body": "On older linux (Ubuntu 12.04) I get \n\n```\nImportError: /mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cvxopt/amd.so: undefined symbol: clock_gettime\n```\n\naccording to man page, needs to \"link with -lrt (only for glibc versions before 2.17)\" but does not.",
    "created_at": "2015-12-21T19:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267083",
    "user": "https://github.com/vbraun"
}
```

On older linux (Ubuntu 12.04) I get 

```
ImportError: /mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cvxopt/amd.so: undefined symbol: clock_gettime
```

according to man page, needs to "link with -lrt (only for glibc versions before 2.17)" but does not.



---

archive/issue_comments_267084.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-21T19:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267084",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_267085.json:
```json
{
    "body": "Upstream probably doesn't build on older machines. Should be trivial to fix.",
    "created_at": "2015-12-21T19:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267085",
    "user": "https://github.com/kiwifb"
}
```

Upstream probably doesn't build on older machines. Should be trivial to fix.



---

archive/issue_comments_267086.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> On older linux (Ubuntu 12.04) I get \n> {{{\n> ImportError: /mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cvxopt/amd.so: undefined symbol: clock_gettime\n> }}}\n> according to man page, needs to \"link with -lrt (only for glibc versions before 2.17)\" but does not.\n\nIt does not seem that testing glibc version tells you the right thing. Indeed, on Ubuntu 14.04, where this all works, I see\n\n```\n>>> import platform\n>>> platform.libc_ver() \n('glibc', '2.4')\n```\n\nAnd I don't even have librt. I will just add it unconditionally, for every Linux...",
    "created_at": "2015-12-21T20:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267086",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:3 vbraun]:
> On older linux (Ubuntu 12.04) I get 
> {{{
> ImportError: /mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cvxopt/amd.so: undefined symbol: clock_gettime
> }}}
> according to man page, needs to "link with -lrt (only for glibc versions before 2.17)" but does not.

It does not seem that testing glibc version tells you the right thing. Indeed, on Ubuntu 14.04, where this all works, I see

```
>>> import platform
>>> platform.libc_ver() 
('glibc', '2.4')
```

And I don't even have librt. I will just add it unconditionally, for every Linux...



---

archive/issue_comments_267087.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-21T20:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_267088.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-21T20:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267088",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_267089.json:
```json
{
    "body": "Wrong solution\n\n```\nif SUITESPARSE_EXT_LIB:\n    amd = Extension('amd',\n        libraries = ['amd','suitesparseconfig'],\n        include_dirs = [SUITESPARSE_INC_DIR],\n        library_dirs = [SUITESPARSE_LIB_DIR],\n        sources = ['src/C/amd.c'])\nelse:\n    amd = Extension('amd', \n        include_dirs = [ 'src/C/SuiteSparse/AMD/Include', \n            'src/C/SuiteSparse/SuiteSparse_config' ],\n        define_macros = MACROS,\n        sources = [ 'src/C/amd.c', 'src/C/SuiteSparse/SuiteSparse_config/SuiteSparse_config.c'] +\n        glob('src/C/SuiteSparse/AMD/Source/*.c') )\n```\n\nThe `amd` extension doesn't use `libraries` so I would be surprised if it worked by adding it to `BLAS_LIBS`.",
    "created_at": "2015-12-21T21:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267089",
    "user": "https://github.com/kiwifb"
}
```

Wrong solution

```
if SUITESPARSE_EXT_LIB:
    amd = Extension('amd',
        libraries = ['amd','suitesparseconfig'],
        include_dirs = [SUITESPARSE_INC_DIR],
        library_dirs = [SUITESPARSE_LIB_DIR],
        sources = ['src/C/amd.c'])
else:
    amd = Extension('amd', 
        include_dirs = [ 'src/C/SuiteSparse/AMD/Include', 
            'src/C/SuiteSparse/SuiteSparse_config' ],
        define_macros = MACROS,
        sources = [ 'src/C/amd.c', 'src/C/SuiteSparse/SuiteSparse_config/SuiteSparse_config.c'] +
        glob('src/C/SuiteSparse/AMD/Source/*.c') )
```

The `amd` extension doesn't use `libraries` so I would be surprised if it worked by adding it to `BLAS_LIBS`.



---

archive/issue_comments_267090.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-21T21:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_267091.json:
```json
{
    "body": "right, it should have gone to the amd Extension chunk, sorry.\nThe patch is longer, as I fixed all the fizz, by cloning https://github.com/cvxopt/cvxopt\nand making a new patch using the old one.\nThen I just added `libraries=['rt']` unconditionally there -- should this be done for Linux only?",
    "created_at": "2015-12-21T22:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267091",
    "user": "https://github.com/dimpase"
}
```

right, it should have gone to the amd Extension chunk, sorry.
The patch is longer, as I fixed all the fizz, by cloning https://github.com/cvxopt/cvxopt
and making a new patch using the old one.
Then I just added `libraries=['rt']` unconditionally there -- should this be done for Linux only?



---

archive/issue_comments_267092.json:
```json
{
    "body": "No `librt` on OS X as far as I can tell, I don't know about cygwin. I would restrict it.",
    "created_at": "2015-12-21T22:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267092",
    "user": "https://github.com/kiwifb"
}
```

No `librt` on OS X as far as I can tell, I don't know about cygwin. I would restrict it.



---

archive/issue_comments_267093.json:
```json
{
    "body": "`clock_gettime` is not in the `AMD` code it is in the `SuiteSparse_config` I am checking the implications.",
    "created_at": "2015-12-21T22:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267093",
    "user": "https://github.com/kiwifb"
}
```

`clock_gettime` is not in the `AMD` code it is in the `SuiteSparse_config` I am checking the implications.



---

archive/issue_comments_267094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-21T22:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_267095.json:
```json
{
    "body": "Replying to [comment:13 fbissey]:\n> `clock_gettime` is not in the `AMD` code it is in the `SuiteSparse_config` I am checking the implications.\n\nwell, the import error is in `amd.so`, and `src/C/SuiteSparse/SuiteSparse_config/SuiteSparse_config.c`\ngets complied into the amd extension. So this looks right what I do now...",
    "created_at": "2015-12-21T22:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267095",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:13 fbissey]:
> `clock_gettime` is not in the `AMD` code it is in the `SuiteSparse_config` I am checking the implications.

well, the import error is in `amd.so`, and `src/C/SuiteSparse/SuiteSparse_config/SuiteSparse_config.c`
gets complied into the amd extension. So this looks right what I do now...



---

archive/issue_comments_267096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-21T22:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_267097.json:
```json
{
    "body": "Volker reported one failure, there may be other hidden behind the first one. That file is also included in `cholmod` and `umfpack` so they are potentially affected too. However the code should only be enabled if `SUITESPARSE_TIMER_ENABLED` is defined, in turn it depends on whether `NTIMER` is defined (which it is for `cholmod` and `umfpack` so in the end they won't be affected). A better solution in my opinion is to add `[('NTIMER', '1')]` to the line `define_macros` for the `amd` section.\n----\nNew commits:",
    "created_at": "2015-12-21T22:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267097",
    "user": "https://github.com/kiwifb"
}
```

Volker reported one failure, there may be other hidden behind the first one. That file is also included in `cholmod` and `umfpack` so they are potentially affected too. However the code should only be enabled if `SUITESPARSE_TIMER_ENABLED` is defined, in turn it depends on whether `NTIMER` is defined (which it is for `cholmod` and `umfpack` so in the end they won't be affected). A better solution in my opinion is to add `[('NTIMER', '1')]` to the line `define_macros` for the `amd` section.
----
New commits:



---

archive/issue_comments_267098.json:
```json
{
    "body": "adding things like `[('NTIMER', '1')]` looks like going too far, as you're changing the behaviour of upstream code this way...",
    "created_at": "2015-12-21T23:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267098",
    "user": "https://github.com/dimpase"
}
```

adding things like `[('NTIMER', '1')]` looks like going too far, as you're changing the behaviour of upstream code this way...



---

archive/issue_comments_267099.json:
```json
{
    "body": "I don't think `cvxopt` cares about timing of the code, in fact `SuiteSparse_{tic,toc,time}` are used nowhere in `AMD`'s code. It is only enabled as part of `SuiteSparse_config.c` by accident I would argue. In contrast `cholmod` and `umfpack` have code that can use `SuiteSparse_time` and it is disabled on purpose in those. Those function are only used to measure performance, I don't think `cvxopt` would be doing it that way, if it was interested in measuring the performance of the `SuiteSparse` code.",
    "created_at": "2015-12-21T23:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267099",
    "user": "https://github.com/kiwifb"
}
```

I don't think `cvxopt` cares about timing of the code, in fact `SuiteSparse_{tic,toc,time}` are used nowhere in `AMD`'s code. It is only enabled as part of `SuiteSparse_config.c` by accident I would argue. In contrast `cholmod` and `umfpack` have code that can use `SuiteSparse_time` and it is disabled on purpose in those. Those function are only used to measure performance, I don't think `cvxopt` would be doing it that way, if it was interested in measuring the performance of the `SuiteSparse` code.



---

archive/issue_comments_267100.json:
```json
{
    "body": "I would further argue that we should point to upstream that unless they want to use those timing functions in the future, `NTIMER` should be in the default macros variable that is currently empty.",
    "created_at": "2015-12-21T23:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267100",
    "user": "https://github.com/kiwifb"
}
```

I would further argue that we should point to upstream that unless they want to use those timing functions in the future, `NTIMER` should be in the default macros variable that is currently empty.



---

archive/issue_comments_267101.json:
```json
{
    "body": "I just asked upstream [here](https://groups.google.com/d/msg/cvxopt/G57kX4Ocw0I/GDpeHcGlBwAJ) on this.",
    "created_at": "2015-12-21T23:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267101",
    "user": "https://github.com/dimpase"
}
```

I just asked upstream [here](https://groups.google.com/d/msg/cvxopt/G57kX4Ocw0I/GDpeHcGlBwAJ) on this.



---

archive/issue_comments_267102.json:
```json
{
    "body": "OK, I'll add an argument: \n`SuiteSparse_config.c` is not part of `amd`'s sources. If you were using an external `suitesparse` install, you would have a `suitesparse_config` library and `amd` would get the functions from this library as needed. But here we have a custom system that makes `SuiteSparse_config.c` a part of the used `amd` source code and including all the function of `SuiteSparse_config.c` instead of just the one needed by `amd`. That include the timing functions.",
    "created_at": "2015-12-21T23:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267102",
    "user": "https://github.com/kiwifb"
}
```

OK, I'll add an argument: 
`SuiteSparse_config.c` is not part of `amd`'s sources. If you were using an external `suitesparse` install, you would have a `suitesparse_config` library and `amd` would get the functions from this library as needed. But here we have a custom system that makes `SuiteSparse_config.c` a part of the used `amd` source code and including all the function of `SuiteSparse_config.c` instead of just the one needed by `amd`. That include the timing functions.



---

archive/issue_comments_267103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-22T19:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_267104.json:
```json
{
    "body": "indeed, that was the right suggestion for the fix. The upstream fixed this in dev [here](https://github.com/cvxopt/cvxopt/commit/9d55fa22ec849d460444fa08d17a841f5b3e06c1?diff=unified) 3 weeks ago...\n\nplease see the latest commit update. \n----\nNew commits:",
    "created_at": "2015-12-22T19:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267104",
    "user": "https://github.com/dimpase"
}
```

indeed, that was the right suggestion for the fix. The upstream fixed this in dev [here](https://github.com/cvxopt/cvxopt/commit/9d55fa22ec849d460444fa08d17a841f5b3e06c1?diff=unified) 3 weeks ago...

please see the latest commit update. 
----
New commits:



---

archive/issue_comments_267105.json:
```json
{
    "body": "I am happy with that resolution. Back to positive review.",
    "created_at": "2015-12-22T19:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267105",
    "user": "https://github.com/kiwifb"
}
```

I am happy with that resolution. Back to positive review.



---

archive/issue_comments_267106.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-22T19:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267106",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_267107.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-23T11:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19450#issuecomment-267107",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_018534.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-23T11:06:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19450",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19450#event-18534"
}
```
