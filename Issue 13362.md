# Issue 13362: Simplicial complex examples as singletons

archive/issues_013362.json:
```json
{
    "body": "Assignee: @tscrim\n\nCC:  @jhpalmieri @vbraun\n\nKeywords: simplicial\n\nSince each of the examples are unique, there should only be one (immutable) instance of each. In other words, we do not recreate the example each time it is called. For example\n\n```\nsage: S1 = simplicial_complexes.KleinBottle()\nsage: S2 = simplicial_complexes.KleinBottle()\nsage: S1 == S2\nTrue\nsage: S1 is S2\nFalse\n```\n\nwhere the last should return `true`. Possibly do this by something like\n\n```\ndef KlienBottle(self):\n    if not hasattr(self, \"_klien_bottle_output\"):\n        self._klien_bottle_output = SimplicialComplex(facets)\n    return self._klien_bottle_output\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13566\n\n",
    "created_at": "2012-10-04T02:05:16Z",
    "labels": [
        "component: algebraic topology",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Simplicial complex examples as singletons",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13362",
    "user": "https://github.com/tscrim"
}
```
Assignee: @tscrim

CC:  @jhpalmieri @vbraun

Keywords: simplicial

Since each of the examples are unique, there should only be one (immutable) instance of each. In other words, we do not recreate the example each time it is called. For example

```
sage: S1 = simplicial_complexes.KleinBottle()
sage: S2 = simplicial_complexes.KleinBottle()
sage: S1 == S2
True
sage: S1 is S2
False
```

where the last should return `true`. Possibly do this by something like

```
def KlienBottle(self):
    if not hasattr(self, "_klien_bottle_output"):
        self._klien_bottle_output = SimplicialComplex(facets)
    return self._klien_bottle_output
```


Issue created by migration from https://trac.sagemath.org/ticket/13566





---

archive/issue_comments_163952.json:
```json
{
    "body": "A simpler solution would be to turn the constructors in the `SimplicialComplexExamples` class into ``@`cached_methods`. I'm attaching this as a patch.",
    "created_at": "2012-12-08T13:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163952",
    "user": "https://github.com/cnassau"
}
```

A simpler solution would be to turn the constructors in the `SimplicialComplexExamples` class into ``@`cached_methods`. I'm attaching this as a patch.



---

archive/issue_comments_163953.json:
```json
{
    "body": "make examples unique using ``@`cached_method`",
    "created_at": "2012-12-08T13:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163953",
    "user": "https://github.com/cnassau"
}
```

make examples unique using ``@`cached_method`



---

archive/issue_comments_163954.json:
```json
{
    "body": "Attachment [13566cna.patch](tarball://root/attachments/some-uuid/ticket13566/13566cna.patch) by @cnassau created at 2012-12-08 14:12:42",
    "created_at": "2012-12-08T14:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163954",
    "user": "https://github.com/cnassau"
}
```

Attachment [13566cna.patch](tarball://root/attachments/some-uuid/ticket13566/13566cna.patch) by @cnassau created at 2012-12-08 14:12:42



---

archive/issue_comments_163955.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-08T14:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163955",
    "user": "https://github.com/cnassau"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_163956.json:
```json
{
    "body": "Please add doctests such as\n\n```\nsage: T1 = simplicial_complexes.Torus()\nsage: T2 = simplicial_complexes.Torus()\nsage: T1 is T2\nTrue\n```\n\nand make sure this is based on #12587 (the ticket cannot apply with any fuzz). I'd also like to see you put your name in the `AUTHORS:` block and a general statement of the changes. Also you will need to fill in your real name on the ticket and have a proper commit message in the patch.\n\nThank you,\n\nTravis",
    "created_at": "2012-12-10T23:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163956",
    "user": "https://github.com/tscrim"
}
```

Please add doctests such as

```
sage: T1 = simplicial_complexes.Torus()
sage: T2 = simplicial_complexes.Torus()
sage: T1 is T2
True
```

and make sure this is based on #12587 (the ticket cannot apply with any fuzz). I'd also like to see you put your name in the `AUTHORS:` block and a general statement of the changes. Also you will need to fill in your real name on the ticket and have a proper commit message in the patch.

Thank you,

Travis



---

archive/issue_comments_163957.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-12-10T23:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163957",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_163958.json:
```json
{
    "body": "Hmm, I've tried for about an hour to apply the patches from #12587 on my (essentially clean) 3.5.1, but without success. I think I'll just \"withdraw\" this patch for now and come back to it after the next release...",
    "created_at": "2012-12-11T07:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163958",
    "user": "https://github.com/cnassau"
}
```

Hmm, I've tried for about an hour to apply the patches from #12587 on my (essentially clean) 3.5.1, but without success. I think I'll just "withdraw" this patch for now and come back to it after the next release...



---

archive/issue_comments_163959.json:
```json
{
    "body": "Sorry about that. I think I've recorded the correct dependencies on #12587 now.",
    "created_at": "2012-12-11T21:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163959",
    "user": "https://github.com/jhpalmieri"
}
```

Sorry about that. I think I've recorded the correct dependencies on #12587 now.



---

archive/issue_comments_163960.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> Sorry about that. I think I've recorded the correct dependencies on #12587 now.\n\nThanks, that might help. On the other hand, I don't think this issue is urgent so I've pushed it to the back of my queue for now. If someone else wants to implement a fix I wouldn't mind at all ;-)",
    "created_at": "2012-12-14T18:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163960",
    "user": "https://github.com/cnassau"
}
```

Replying to [comment:7 jhpalmieri]:
> Sorry about that. I think I've recorded the correct dependencies on #12587 now.

Thanks, that might help. On the other hand, I don't think this issue is urgent so I've pushed it to the back of my queue for now. If someone else wants to implement a fix I wouldn't mind at all ;-)



---

archive/issue_comments_163961.json:
```json
{
    "body": "Here is a rebased version of Christian's patch. I added a bunch of tests, also.",
    "created_at": "2012-12-18T19:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163961",
    "user": "https://github.com/jhpalmieri"
}
```

Here is a rebased version of Christian's patch. I added a bunch of tests, also.



---

archive/issue_comments_163962.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-18T19:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163962",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_163963.json:
```json
{
    "body": "Attachment [trac_13566cna.patch](tarball://root/attachments/some-uuid/ticket13566/trac_13566cna.patch) by @jhpalmieri created at 2012-12-18 19:29:37",
    "created_at": "2012-12-18T19:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163963",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13566cna.patch](tarball://root/attachments/some-uuid/ticket13566/trac_13566cna.patch) by @jhpalmieri created at 2012-12-18 19:29:37



---

archive/issue_comments_163964.json:
```json
{
    "body": "By the way, this applies independently of the patches at #13725 for sum complexes. Those can't be cached like this because they can accept a list (which is unhashable) as an argument.",
    "created_at": "2012-12-18T19:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163964",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, this applies independently of the patches at #13725 for sum complexes. Those can't be cached like this because they can accept a list (which is unhashable) as an argument.



---

archive/issue_comments_163965.json:
```json
{
    "body": "From what I've heard, custom caches are something we should avoid. So since we can't make sum complexes work with ``@`cached_method`, and everything looks good to me, I'm setting this to positive review. Thanks.",
    "created_at": "2012-12-19T04:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163965",
    "user": "https://github.com/tscrim"
}
```

From what I've heard, custom caches are something we should avoid. So since we can't make sum complexes work with ``@`cached_method`, and everything looks good to me, I'm setting this to positive review. Thanks.



---

archive/issue_comments_163966.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-19T04:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163966",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_163967.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n> From what I've heard, custom caches are something we should avoid. So since we can't make sum complexes work with ``@`cached_method`, and everything looks good to me, I'm setting this to positive review. Thanks.\n\nThe author credits are very generous, many thanks. From my part this was a somewhat reckless case of drive-by patching of which I am rather ashamed now. I hope to do a better job next time...  ;-)\n\nCheers, \\\\\nChristian",
    "created_at": "2012-12-19T06:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163967",
    "user": "https://github.com/cnassau"
}
```

Replying to [comment:12 tscrim]:
> From what I've heard, custom caches are something we should avoid. So since we can't make sum complexes work with ``@`cached_method`, and everything looks good to me, I'm setting this to positive review. Thanks.

The author credits are very generous, many thanks. From my part this was a somewhat reckless case of drive-by patching of which I am rather ashamed now. I hope to do a better job next time...  ;-)

Cheers, \\
Christian



---

archive/issue_comments_163968.json:
```json
{
    "body": "On sage.math, this patch causes\n\n```\nsage -t  -force_lib devel/sage/sage/categories/algebra_modules.py\n/release/merger/sage-5.6.beta2/local/lib/libcsage.so(print_backtrace+0x2b)[0x2b1002e4866e]\n/release/merger/sage-5.6.beta2/local/lib/libcsage.so(sigdie+0x14)[0x2b1002e4869b]\n/release/merger/sage-5.6.beta2/local/lib/libcsage.so(sage_signal_handler+0x20b)[0x2b1002e48189]\n/lib/libpthread.so.0[0x2b1000eb27d0]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_GC_Del+0x22)[0x2b1000be54c2]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b62e01]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b31703]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b31978]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b31978]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000bd949b]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b44643]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyDict_SetItem+0x73)[0x2b1000b45583]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyDict_SetItemString+0x4b)[0x2b1000b4676b]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x47fd)[0x2b1000bab07d]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b329b9]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b158bf]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b1000ba7b19]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b329b9]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b158bf]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b1000ba7b19]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x2b1000bae472]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xc1)[0x2b1000bd21f1]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x1f9)[0x2b1000bd24c9]\n/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(Py_Main+0xb15)[0x2b1000be5115]\n/lib/libc.so.6(__libc_start_main+0xf4)[0x2b10017671f4]\npython[0x400679]\n\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off(). You might\nwant to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n",
    "created_at": "2012-12-27T22:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163968",
    "user": "https://github.com/jdemeyer"
}
```

On sage.math, this patch causes

```
sage -t  -force_lib devel/sage/sage/categories/algebra_modules.py
/release/merger/sage-5.6.beta2/local/lib/libcsage.so(print_backtrace+0x2b)[0x2b1002e4866e]
/release/merger/sage-5.6.beta2/local/lib/libcsage.so(sigdie+0x14)[0x2b1002e4869b]
/release/merger/sage-5.6.beta2/local/lib/libcsage.so(sage_signal_handler+0x20b)[0x2b1002e48189]
/lib/libpthread.so.0[0x2b1000eb27d0]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_GC_Del+0x22)[0x2b1000be54c2]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b62e01]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b31703]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b31978]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b31978]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000bd949b]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b44643]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyDict_SetItem+0x73)[0x2b1000b45583]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyDict_SetItemString+0x4b)[0x2b1000b4676b]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x47fd)[0x2b1000bab07d]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b329b9]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b158bf]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b1000ba7b19]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b329b9]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0[0x2b1000b158bf]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b1000b05308]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b1000ba7b19]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b1000bac364]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b1000bae352]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x2b1000bae472]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xc1)[0x2b1000bd21f1]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x1f9)[0x2b1000bd24c9]
/release/merger/sage-5.6.beta2/local/lib/libpython2.7.so.1.0(Py_Main+0xb15)[0x2b1000be5115]
/lib/libc.so.6(__libc_start_main+0xf4)[0x2b10017671f4]
python[0x400679]

------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off(). You might
want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate.
------------------------------------------------------------------------
Segmentation fault
```




---

archive/issue_comments_163969.json:
```json
{
    "body": "Note that this segfault is actually \"caused\" by #715 + #11521.",
    "created_at": "2012-12-27T23:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163969",
    "user": "https://github.com/jdemeyer"
}
```

Note that this segfault is actually "caused" by #715 + #11521.



---

archive/issue_comments_163970.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-30T01:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163970",
    "user": "https://github.com/nbruin"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_163971.json:
```json
{
    "body": "Why is this caching desirable? As far as I can see, this creates a memory leak:\n\n```\ni=1\nwhile true:\n   simplicial_complexes.Sphere(i)\n   i=i+1\n```\n\nfails much sooner than it should because all the now useless previous examples are still nailed in memory. \n\nYou aren't proposing the cache to save computation time, I suppose? It's probably because you find it desirable to guarantee uniqueness when these things exist (are they parents?) In that case, you can get what you want by inheriting from UniqueRepresentation or UniqueFactory. That keeps a weak cache, so that\nexamples that aren't otherwise referenced anymore can be collected.",
    "created_at": "2012-12-30T01:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163971",
    "user": "https://github.com/nbruin"
}
```

Why is this caching desirable? As far as I can see, this creates a memory leak:

```
i=1
while true:
   simplicial_complexes.Sphere(i)
   i=i+1
```

fails much sooner than it should because all the now useless previous examples are still nailed in memory. 

You aren't proposing the cache to save computation time, I suppose? It's probably because you find it desirable to guarantee uniqueness when these things exist (are they parents?) In that case, you can get what you want by inheriting from UniqueRepresentation or UniqueFactory. That keeps a weak cache, so that
examples that aren't otherwise referenced anymore can be collected.



---

archive/issue_comments_163972.json:
```json
{
    "body": "Replying to [comment:17 nbruin]:\n> You aren't proposing the cache to save computation time, I suppose? It's probably because you find it desirable to guarantee uniqueness when these things exist (are they parents?) In that case, you can get what you want by inheriting from UniqueRepresentation or UniqueFactory. That keeps a weak cache, so that\n> examples that aren't otherwise referenced anymore can be collected.\n\nI wonder if we could create a new modifier ``@`weakly_chached_method` (or maybe ``@`cached_method(weakref=True)`) for this purpose. Using a UniqueRepresentation or UniqueFactory probably requires some code re-arrangements (for example, `Sphere` is a currently a method, not a class whose inheritance we could change).",
    "created_at": "2012-12-30T09:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163972",
    "user": "https://github.com/cnassau"
}
```

Replying to [comment:17 nbruin]:
> You aren't proposing the cache to save computation time, I suppose? It's probably because you find it desirable to guarantee uniqueness when these things exist (are they parents?) In that case, you can get what you want by inheriting from UniqueRepresentation or UniqueFactory. That keeps a weak cache, so that
> examples that aren't otherwise referenced anymore can be collected.

I wonder if we could create a new modifier ``@`weakly_chached_method` (or maybe ``@`cached_method(weakref=True)`) for this purpose. Using a UniqueRepresentation or UniqueFactory probably requires some code re-arrangements (for example, `Sphere` is a currently a method, not a class whose inheritance we could change).



---

archive/issue_comments_163973.json:
```json
{
    "body": "Well ... you could write a decorator that turns a function into a UniqueFactory. However, I think you have a more serious problem: The routines you are now defining have no business being a method (note that you don't use the `self` argument!). Python is not Java. You don't have to stuff everything into a class. Much more appropriate is a module (just a file with functions). In fact, since your functions are just interfaces to SimplicialComplex, any uniqueness of the output value is already ensured by that thing. And if it isn't, then either SimplicialComplex should be ensuring uniqueness or there's a good reason why it shouldn't and then your routines shouldn't ensure uniqueness either. In other words: the caching you're proposing should either happen on a deeper level or not at all.\n\nFor more information about using modules to gather examples or as convenient namespace groupings, see #13115 and this [sage-devel thread](https://groups.google.com/group/sage-devel/browse_thread/thread/76f32baf025a370/4aa1b2f40eadd48c?hl=en&lnk=gst&q=examples+in+module#4aa1b2f40eadd48c).",
    "created_at": "2013-01-01T02:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163973",
    "user": "https://github.com/nbruin"
}
```

Well ... you could write a decorator that turns a function into a UniqueFactory. However, I think you have a more serious problem: The routines you are now defining have no business being a method (note that you don't use the `self` argument!). Python is not Java. You don't have to stuff everything into a class. Much more appropriate is a module (just a file with functions). In fact, since your functions are just interfaces to SimplicialComplex, any uniqueness of the output value is already ensured by that thing. And if it isn't, then either SimplicialComplex should be ensuring uniqueness or there's a good reason why it shouldn't and then your routines shouldn't ensure uniqueness either. In other words: the caching you're proposing should either happen on a deeper level or not at all.

For more information about using modules to gather examples or as convenient namespace groupings, see #13115 and this [sage-devel thread](https://groups.google.com/group/sage-devel/browse_thread/thread/76f32baf025a370/4aa1b2f40eadd48c?hl=en&lnk=gst&q=examples+in+module#4aa1b2f40eadd48c).



---

archive/issue_comments_163974.json:
```json
{
    "body": "If I understand #13115/the thread correctly, a way to do this would be:\n\n- have an `import homology/examples as simplical_complexes` in the `all.py`\n- Make each of these methods into a subclass of `SimplicialComplex` and `UniqueRepresentation` and have these be at the module level\n\nsince right now `SimplicialComplex` is mutable until specified otherwise. (I guess with this we can also do some optimization with certain methods, such as homology for `Sphere`... and that should be a different ticket.)",
    "created_at": "2013-01-01T05:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163974",
    "user": "https://github.com/tscrim"
}
```

If I understand #13115/the thread correctly, a way to do this would be:

- have an `import homology/examples as simplical_complexes` in the `all.py`
- Make each of these methods into a subclass of `SimplicialComplex` and `UniqueRepresentation` and have these be at the module level

since right now `SimplicialComplex` is mutable until specified otherwise. (I guess with this we can also do some optimization with certain methods, such as homology for `Sphere`... and that should be a different ticket.)



---

archive/issue_comments_163975.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> If I understand #13115/the thread correctly, a way to do this would be:\n> \n> - have an `import homology/examples as simplical_complexes` in the `all.py`\n> - Make each of these methods into a subclass of `SimplicialComplex` and `UniqueRepresentation` and have these be at the module level\n> \n> since right now `SimplicialComplex` is mutable until specified otherwise. (I guess with this we can also do some optimization with certain methods, such as homology for `Sphere`... and that should be a different ticket.)\n\nYes, that sounds looks like a sensible approach. Additionally, if that seems like a heavy-weight solution (it does to me), one should probably see if uniqueness is so important that it warrants a subclass and/or if there are other pressing reasons to make these subclasses. Reasons against uniqueness:\n\n- `SimplicialComplex` is not a parent so there's no sage-technical reason to enforce uniqueness (that's just a reason *not for* uniqueness)\n\n- While any two `Sphere(3)` complexes are isomorphic, they are not canonically so, so mathematically there can be good reasons to have multiple non-identical spheres in memory.\n\n- It makes things like `Sphere` behave different from `SimplicialComplex` (and more generally not simply *be* a `SimplicialComplex`. That makes code harder to maintain because now you have similar-but-subtly-different acting objects. You should only do that if there's a benefit elsewhere.\n\nShould uniqueness of `SimplicialComplexes` be desirable in general (why? are they meant to become parents?) then it should perhaps be fixed on that level. Mutable obviously can't be forced to be unique, so then you should probably make two: `SimplicialComplex` and `MutableSimplicialComplex` (one a subclass of the other if at all possible), where you can make the immutable one unique by also inheriting from UniqueRepresentation. Going to the immutable one then of course should return an immutable *copy*, not just change a flag.\n\nAlternatively, (I don't know if that would be too hackish) you could add another flag, `canonical_instance=true/false` (only to be used with `is_mutable=False`), or make (a renamed version of) `is_mutable` tristate, to determines whether a cache is involved. That would have the severe drawback you'd have to break open the caching mechanism used in `UniqueRepresentation`.\n\nIf you find there's no need for `Sphere` etc. to be anything more than just a `SimplicialComplex` the implementation becomes *really* easy: `sage.homology.examples.Sphere` can simple be a function, returning the relevant `SimplicialComplex`.",
    "created_at": "2013-01-01T18:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163975",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:20 tscrim]:
> If I understand #13115/the thread correctly, a way to do this would be:
> 
> - have an `import homology/examples as simplical_complexes` in the `all.py`
> - Make each of these methods into a subclass of `SimplicialComplex` and `UniqueRepresentation` and have these be at the module level
> 
> since right now `SimplicialComplex` is mutable until specified otherwise. (I guess with this we can also do some optimization with certain methods, such as homology for `Sphere`... and that should be a different ticket.)

Yes, that sounds looks like a sensible approach. Additionally, if that seems like a heavy-weight solution (it does to me), one should probably see if uniqueness is so important that it warrants a subclass and/or if there are other pressing reasons to make these subclasses. Reasons against uniqueness:

- `SimplicialComplex` is not a parent so there's no sage-technical reason to enforce uniqueness (that's just a reason *not for* uniqueness)

- While any two `Sphere(3)` complexes are isomorphic, they are not canonically so, so mathematically there can be good reasons to have multiple non-identical spheres in memory.

- It makes things like `Sphere` behave different from `SimplicialComplex` (and more generally not simply *be* a `SimplicialComplex`. That makes code harder to maintain because now you have similar-but-subtly-different acting objects. You should only do that if there's a benefit elsewhere.

Should uniqueness of `SimplicialComplexes` be desirable in general (why? are they meant to become parents?) then it should perhaps be fixed on that level. Mutable obviously can't be forced to be unique, so then you should probably make two: `SimplicialComplex` and `MutableSimplicialComplex` (one a subclass of the other if at all possible), where you can make the immutable one unique by also inheriting from UniqueRepresentation. Going to the immutable one then of course should return an immutable *copy*, not just change a flag.

Alternatively, (I don't know if that would be too hackish) you could add another flag, `canonical_instance=true/false` (only to be used with `is_mutable=False`), or make (a renamed version of) `is_mutable` tristate, to determines whether a cache is involved. That would have the severe drawback you'd have to break open the caching mechanism used in `UniqueRepresentation`.

If you find there's no need for `Sphere` etc. to be anything more than just a `SimplicialComplex` the implementation becomes *really* easy: `sage.homology.examples.Sphere` can simple be a function, returning the relevant `SimplicialComplex`.



---

archive/issue_comments_163976.json:
```json
{
    "body": "Replying to [comment:21 nbruin]:\n> Reasons against uniqueness:\n> \n> - `SimplicialComplex` is not a parent so there's no sage-technical reason to enforce uniqueness (that's just a reason *not for* uniqueness)\n> \n> - While any two `Sphere(3)` complexes are isomorphic, they are not canonically so, so mathematically there can be good reasons to have multiple non-identical spheres in memory.\n\nThat is a good point since I believe not all triangulations of a (high enough dimensional) sphere can be obtained by bistellar flips.\n\n> - It makes things like `Sphere` behave different from `SimplicialComplex` (and more generally not simply *be* a `SimplicialComplex`. That makes code harder to maintain because now you have similar-but-subtly-different acting objects. You should only do that if there's a benefit elsewhere.\n\nAlso a good point.\n\n> Should uniqueness of `SimplicialComplexes` be desirable in general (why? are they meant to become parents?) then it should perhaps be fixed on that level. Mutable obviously can't be forced to be unique, so then you should probably make two: `SimplicialComplex` and `MutableSimplicialComplex` (one a subclass of the other if at all possible), where you can make the immutable one unique by also inheriting from UniqueRepresentation. Going to the immutable one then of course should return an immutable *copy*, not just change a flag.\n\nWhat I was thinking when I created this ticket was that since these are particular examples of simplicial complexes, they should be unique and immutable. However, perhaps it would be better to have them be mutable copies for computations rather than having the user create a copy (I don't really know offhand if these are used computationally in Sage)...I will leave this decision to someone who uses these more than me.\n\n> If you find there's no need for `Sphere` etc. to be anything more than just a `SimplicialComplex` the implementation becomes *really* easy: `sage.homology.examples.Sphere` can simple be a function, returning the relevant `SimplicialComplex`.\n\nIf it is decided to essentially do nothing, perhaps we should use this ticket to move everything down to a function.\n\nAlso it seems like this needs to be rebased to 5.6.beta1.\n\nThanks,\n\nTravis\n\nPS - I may not be able to respond for 2 weeks",
    "created_at": "2013-01-02T15:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163976",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:21 nbruin]:
> Reasons against uniqueness:
> 
> - `SimplicialComplex` is not a parent so there's no sage-technical reason to enforce uniqueness (that's just a reason *not for* uniqueness)
> 
> - While any two `Sphere(3)` complexes are isomorphic, they are not canonically so, so mathematically there can be good reasons to have multiple non-identical spheres in memory.

That is a good point since I believe not all triangulations of a (high enough dimensional) sphere can be obtained by bistellar flips.

> - It makes things like `Sphere` behave different from `SimplicialComplex` (and more generally not simply *be* a `SimplicialComplex`. That makes code harder to maintain because now you have similar-but-subtly-different acting objects. You should only do that if there's a benefit elsewhere.

Also a good point.

> Should uniqueness of `SimplicialComplexes` be desirable in general (why? are they meant to become parents?) then it should perhaps be fixed on that level. Mutable obviously can't be forced to be unique, so then you should probably make two: `SimplicialComplex` and `MutableSimplicialComplex` (one a subclass of the other if at all possible), where you can make the immutable one unique by also inheriting from UniqueRepresentation. Going to the immutable one then of course should return an immutable *copy*, not just change a flag.

What I was thinking when I created this ticket was that since these are particular examples of simplicial complexes, they should be unique and immutable. However, perhaps it would be better to have them be mutable copies for computations rather than having the user create a copy (I don't really know offhand if these are used computationally in Sage)...I will leave this decision to someone who uses these more than me.

> If you find there's no need for `Sphere` etc. to be anything more than just a `SimplicialComplex` the implementation becomes *really* easy: `sage.homology.examples.Sphere` can simple be a function, returning the relevant `SimplicialComplex`.

If it is decided to essentially do nothing, perhaps we should use this ticket to move everything down to a function.

Also it seems like this needs to be rebased to 5.6.beta1.

Thanks,

Travis

PS - I may not be able to respond for 2 weeks



---

archive/issue_comments_163977.json:
```json
{
    "body": "Sorry, I did not read the whole discussion, but I see in the patch that cached_method is used. Hence, the constructed simplicial complexes will be kept in memory indefinitely. Wouldn't it be a better idea to turn simplicial_complexes into a `UniqueFactory`?\n\nOf course, in a `UniqueFactory` one would usually ask for a Klein bottle by `simplicial_complexes(\"KleinBottle\")`. But of course one could still define methods `KleinBottle` and so on, so that `simplicial_complexes.KleinBottle()` is equivalent to `simplicial_complexes(\"KleinBottle\")`.\n\nThe latter could be automatised by a `__getattr__` method:\n\n```\n    def __getattr__(self, s):\n        return lambda : self(s)\n```\n\n\nWhy would that solve the problem with permanent caching? Well, `UniqueFactory` will soon be using weak dictionaries for caching (in fact it already uses weak references, but improperly, and that's supposed to be fixed in #12215).",
    "created_at": "2013-01-03T16:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163977",
    "user": "https://github.com/simon-king-jena"
}
```

Sorry, I did not read the whole discussion, but I see in the patch that cached_method is used. Hence, the constructed simplicial complexes will be kept in memory indefinitely. Wouldn't it be a better idea to turn simplicial_complexes into a `UniqueFactory`?

Of course, in a `UniqueFactory` one would usually ask for a Klein bottle by `simplicial_complexes("KleinBottle")`. But of course one could still define methods `KleinBottle` and so on, so that `simplicial_complexes.KleinBottle()` is equivalent to `simplicial_complexes("KleinBottle")`.

The latter could be automatised by a `__getattr__` method:

```
    def __getattr__(self, s):
        return lambda : self(s)
```


Why would that solve the problem with permanent caching? Well, `UniqueFactory` will soon be using weak dictionaries for caching (in fact it already uses weak references, but improperly, and that's supposed to be fixed in #12215).



---

archive/issue_comments_163978.json:
```json
{
    "body": "Sorry for falling behind on this ticket. What we should do strongly depends on the answer the question \"Should these examples be immutable to begin with (right now one would need to make a mutable copy to manipulate it)?\" My belief is still yes and so I'd support going to a `UniqueFactory`, however this is at odds with what the graph code does:\n\n```\nsage: g = graphs.StarGraph(5)\nsage: g\nStar graph: Graph on 6 vertices\nsage: g.add_vertex(10)\nsage: g\nStar graph: Graph on 7 vertices\n```\n\nSince the graph is given a special name, I'd rather that be immutable. (If we do keep them immutable, we probably should give each of our simplicial complex examples special names too...)\n\nAnyways, what are everyone else's thoughts?\n\nThanks,\n\nTravis",
    "created_at": "2013-02-11T00:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163978",
    "user": "https://github.com/tscrim"
}
```

Sorry for falling behind on this ticket. What we should do strongly depends on the answer the question "Should these examples be immutable to begin with (right now one would need to make a mutable copy to manipulate it)?" My belief is still yes and so I'd support going to a `UniqueFactory`, however this is at odds with what the graph code does:

```
sage: g = graphs.StarGraph(5)
sage: g
Star graph: Graph on 6 vertices
sage: g.add_vertex(10)
sage: g
Star graph: Graph on 7 vertices
```

Since the graph is given a special name, I'd rather that be immutable. (If we do keep them immutable, we probably should give each of our simplicial complex examples special names too...)

Anyways, what are everyone else's thoughts?

Thanks,

Travis



---

archive/issue_comments_163979.json:
```json
{
    "body": "How do you make an immutable simplicial complex mutable? We seem to have missed adding a `set_mutable` method in #12587, and so now I don't know how to get a mutable copy of the various examples, short of explicitly setting the `_is_mutable` attribute.\n\nI think this should be fixed very soon, maybe before the other issues in this ticket.\n\nAs far as whether the examples should be immutable, I don't feel strongly either way. I can see a certain elegance in immutability, but other examples in Sage don't seem to work like this. I suppose we could use `UniqueFactory` to create an immutable unique instance, but the functions (or methods, or whatever) could return a mutable copy each time. For example:\n\n```\nsage: MatrixSpace(QQ, 3, 3).identity_matrix().is_mutable()\nFalse\n\nsage: matrix.identity(QQ, 3).is_mutable()\nTrue\n```\n\nThis seems rather odd to me, but I suppose it's an option.",
    "created_at": "2013-02-11T22:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163979",
    "user": "https://github.com/jhpalmieri"
}
```

How do you make an immutable simplicial complex mutable? We seem to have missed adding a `set_mutable` method in #12587, and so now I don't know how to get a mutable copy of the various examples, short of explicitly setting the `_is_mutable` attribute.

I think this should be fixed very soon, maybe before the other issues in this ticket.

As far as whether the examples should be immutable, I don't feel strongly either way. I can see a certain elegance in immutability, but other examples in Sage don't seem to work like this. I suppose we could use `UniqueFactory` to create an immutable unique instance, but the functions (or methods, or whatever) could return a mutable copy each time. For example:

```
sage: MatrixSpace(QQ, 3, 3).identity_matrix().is_mutable()
False

sage: matrix.identity(QQ, 3).is_mutable()
True
```

This seems rather odd to me, but I suppose it's an option.



---

archive/issue_comments_163980.json:
```json
{
    "body": "Replying to [comment:25 jhpalmieri]:\n> How do you make an immutable simplicial complex mutable? We seem to have missed adding a `set_mutable` method in #12587, and so now I don't know how to get a mutable copy of the various examples, short of explicitly setting the `_is_mutable` attribute.\n\nFor example\n\n```\nsage: S = simplicial_complexes.Sphere(4)\nsage: S.is_mutable()\nFalse\nsage: T = SimplicialComplex(S, is_mutable=True) # This should work and is a bug I didn't catch\nsage: T.is_mutable()\nFalse\nsage: T = SimplicialComplex(S) # This one I'm happy with leaving immutable\nsage: T.is_mutable()\nFalse\n```\n\nHowever I do think we should also have a method to make a mutable copy, my suggestions are either `copy()` and/or `make_mutable()`.\n\n> I think this should be fixed very soon, maybe before the other issues in this ticket.\n\nAgreed. This was something I introduced, so I'll be happy to fix it.\n\n> As far as whether the examples should be immutable, I don't feel strongly either way. I can see a certain elegance in immutability, but other examples in Sage don't seem to work like this. I suppose we could use `UniqueFactory` to create an immutable unique instance, but the functions (or methods, or whatever) could return a mutable copy each time. For example:\n> {{{\n> sage: MatrixSpace(QQ, 3, 3).identity_matrix().is_mutable()\n> False\n> \n> sage: matrix.identity(QQ, 3).is_mutable()\n> True\n> }}}\n> This seems rather odd to me, but I suppose it's an option.\n\nThis is very strange to me as well. Part of the thing is the identity matrix function is cached, so it must return an immutable object.\n\nBest,\n\nTravis",
    "created_at": "2013-02-12T01:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163980",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:25 jhpalmieri]:
> How do you make an immutable simplicial complex mutable? We seem to have missed adding a `set_mutable` method in #12587, and so now I don't know how to get a mutable copy of the various examples, short of explicitly setting the `_is_mutable` attribute.

For example

```
sage: S = simplicial_complexes.Sphere(4)
sage: S.is_mutable()
False
sage: T = SimplicialComplex(S, is_mutable=True) # This should work and is a bug I didn't catch
sage: T.is_mutable()
False
sage: T = SimplicialComplex(S) # This one I'm happy with leaving immutable
sage: T.is_mutable()
False
```

However I do think we should also have a method to make a mutable copy, my suggestions are either `copy()` and/or `make_mutable()`.

> I think this should be fixed very soon, maybe before the other issues in this ticket.

Agreed. This was something I introduced, so I'll be happy to fix it.

> As far as whether the examples should be immutable, I don't feel strongly either way. I can see a certain elegance in immutability, but other examples in Sage don't seem to work like this. I suppose we could use `UniqueFactory` to create an immutable unique instance, but the functions (or methods, or whatever) could return a mutable copy each time. For example:
> {{{
> sage: MatrixSpace(QQ, 3, 3).identity_matrix().is_mutable()
> False
> 
> sage: matrix.identity(QQ, 3).is_mutable()
> True
> }}}
> This seems rather odd to me, but I suppose it's an option.

This is very strange to me as well. Part of the thing is the identity matrix function is cached, so it must return an immutable object.

Best,

Travis



---

archive/issue_comments_163981.json:
```json
{
    "body": "Replying to [comment:26 tscrim]:\n> However I do think we should also have a method to make a mutable copy, my suggestions are either `copy()` and/or `make_mutable()`.\n\nAnother option is to use `__copy__()`; then calling `copy(X)` would return a mutable copy of `X`. We could make `copy()` an alias for `__copy__()`, so it's visible via tab completion.",
    "created_at": "2013-02-12T04:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163981",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:26 tscrim]:
> However I do think we should also have a method to make a mutable copy, my suggestions are either `copy()` and/or `make_mutable()`.

Another option is to use `__copy__()`; then calling `copy(X)` would return a mutable copy of `X`. We could make `copy()` an alias for `__copy__()`, so it's visible via tab completion.



---

archive/issue_comments_163982.json:
```json
{
    "body": "I've started #14142 which will allow mutable copies.",
    "created_at": "2013-02-16T16:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163982",
    "user": "https://github.com/tscrim"
}
```

I've started #14142 which will allow mutable copies.



---

archive/issue_comments_163983.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-22T22:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163983",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_163984.json:
```json
{
    "body": "Here is a branch which makes two more examples of simplicial complexes immutable, and then converts all of the examples from methods to functions. They are not cached (and I think that was the consensus).\n\nAs Travis said above:\n\n> If it is decided to essentially do nothing, perhaps we should use this ticket to move everything down to a function.\n\nI guess that's what I've done.\n----\nNew commits:",
    "created_at": "2015-10-22T22:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163984",
    "user": "https://github.com/jhpalmieri"
}
```

Here is a branch which makes two more examples of simplicial complexes immutable, and then converts all of the examples from methods to functions. They are not cached (and I think that was the consensus).

As Travis said above:

> If it is decided to essentially do nothing, perhaps we should use this ticket to move everything down to a function.

I guess that's what I've done.
----
New commits:



---

archive/issue_comments_163985.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-22T22:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163985",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_163986.json:
```json
{
    "body": "What about having a class which inherits from `SimplicialComplex` and `UniqueRepresentation` which takes the cells and a name, and then each of these functions pass the requisite data to that class? That way we get the singleton behavior and naming without really much effort (and wouldn't conflict with anything else we are doing with `SimplicialComplex`).",
    "created_at": "2015-10-22T23:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163986",
    "user": "https://github.com/tscrim"
}
```

What about having a class which inherits from `SimplicialComplex` and `UniqueRepresentation` which takes the cells and a name, and then each of these functions pass the requisite data to that class? That way we get the singleton behavior and naming without really much effort (and wouldn't conflict with anything else we are doing with `SimplicialComplex`).



---

archive/issue_comments_163987.json:
```json
{
    "body": "Okay. To do this, I've had to change `__cmp__` for `SimplicialComplexes` to `__eq__` and `__ne__` so that we could correctly compare a simplicial complex and a `UniqueSimplicialComplex`. I'm not sure what you meant by naming, but I took a guess. Since the names of these complexes arise frequently in doctests, and since many of those doctests are changed in #6101, I decided to make #6101 a dependency for this, to avoid later rebasing.",
    "created_at": "2015-10-24T22:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163987",
    "user": "https://github.com/jhpalmieri"
}
```

Okay. To do this, I've had to change `__cmp__` for `SimplicialComplexes` to `__eq__` and `__ne__` so that we could correctly compare a simplicial complex and a `UniqueSimplicialComplex`. I'm not sure what you meant by naming, but I took a guess. Since the names of these complexes arise frequently in doctests, and since many of those doctests are changed in #6101, I decided to make #6101 a dependency for this, to avoid later rebasing.



---

archive/issue_comments_163988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-24T22:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_163989.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-24T22:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_163990.json:
```json
{
    "body": "Replying to [comment:37 jhpalmieri]:\n> Okay. To do this, I've had to change `__cmp__` for `SimplicialComplexes` to `__eq__` and `__ne__` so that we could correctly compare a simplicial complex and a `UniqueSimplicialComplex`. I'm not sure what you meant by naming, but I took a guess.\n\nYes, that was what I was looking for. Note to self: Make sure the hash functions match as well.",
    "created_at": "2015-10-24T22:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163990",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:37 jhpalmieri]:
> Okay. To do this, I've had to change `__cmp__` for `SimplicialComplexes` to `__eq__` and `__ne__` so that we could correctly compare a simplicial complex and a `UniqueSimplicialComplex`. I'm not sure what you meant by naming, but I took a guess.

Yes, that was what I was looking for. Note to self: Make sure the hash functions match as well.



---

archive/issue_comments_163991.json:
```json
{
    "body": "It looks like we're going to also have to handle some old pickles... :/",
    "created_at": "2015-10-25T16:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163991",
    "user": "https://github.com/tscrim"
}
```

It looks like we're going to also have to handle some old pickles... :/



---

archive/issue_comments_163992.json:
```json
{
    "body": "I think this is easy to fix: just add the line\n\n```\nSimplicialSurface = SimplicialComplex\n```\n\nto `examples.py`. That line doesn't make any sense, though. Can we get rid of the old pickle?",
    "created_at": "2015-10-25T21:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163992",
    "user": "https://github.com/jhpalmieri"
}
```

I think this is easy to fix: just add the line

```
SimplicialSurface = SimplicialComplex
```

to `examples.py`. That line doesn't make any sense, though. Can we get rid of the old pickle?



---

archive/issue_comments_163993.json:
```json
{
    "body": "Here's my proposal, use `register_unpickle_override`.\n----\nNew commits:",
    "created_at": "2015-10-26T14:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163993",
    "user": "https://github.com/tscrim"
}
```

Here's my proposal, use `register_unpickle_override`.
----
New commits:



---

archive/issue_comments_163994.json:
```json
{
    "body": "Nom nom nom\n\n```\nUsing --optional=coxeter3,database_gap,dot2tex,gap_packages,lie,mpir,python2,sage\nDoctesting 1 file using 8 threads.\nsage -t --long ../structure/sage_object.pyx\n    [204 tests, 6.00 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 11.2 seconds\n    cpu time: 3.3 seconds\n    cumulative wall time: 6.0 seconds\n```\n\n\nIf you're happy with this change, then you can set a positive review.",
    "created_at": "2015-10-26T14:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163994",
    "user": "https://github.com/tscrim"
}
```

Nom nom nom

```
Using --optional=coxeter3,database_gap,dot2tex,gap_packages,lie,mpir,python2,sage
Doctesting 1 file using 8 threads.
sage -t --long ../structure/sage_object.pyx
    [204 tests, 6.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 11.2 seconds
    cpu time: 3.3 seconds
    cumulative wall time: 6.0 seconds
```


If you're happy with this change, then you can set a positive review.



---

archive/issue_comments_163995.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-26T16:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163995",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_163996.json:
```json
{
    "body": "All tests pass.",
    "created_at": "2015-10-26T16:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163996",
    "user": "https://github.com/jhpalmieri"
}
```

All tests pass.



---

archive/issue_comments_163997.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-11-08T16:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_163998.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-11-08T16:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_163999.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-08T16:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-163999",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_164000.json:
```json
{
    "body": "Ignore the first commits, I forgot to checkout `develop`.\n\nHopefully now this can be merged.",
    "created_at": "2015-11-08T16:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-164000",
    "user": "https://github.com/tscrim"
}
```

Ignore the first commits, I forgot to checkout `develop`.

Hopefully now this can be merged.



---

archive/issue_comments_164001.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-08T16:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-164001",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_164002.json:
```json
{
    "body": "Volker, will this get merged for the next beta?",
    "created_at": "2015-11-25T05:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-164002",
    "user": "https://github.com/tscrim"
}
```

Volker, will this get merged for the next beta?



---

archive/issue_comments_164003.json:
```json
{
    "body": "Once you take out the dependencies that don't correspond to merged tickets it'll be merged.",
    "created_at": "2015-11-25T09:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-164003",
    "user": "https://github.com/vbraun"
}
```

Once you take out the dependencies that don't correspond to merged tickets it'll be merged.



---

archive/issue_comments_164004.json:
```json
{
    "body": "All of the dependencies had been merged...",
    "created_at": "2015-11-25T14:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-164004",
    "user": "https://github.com/tscrim"
}
```

All of the dependencies had been merged...



---

archive/issue_comments_164005.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-25T23:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13362#issuecomment-164005",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
