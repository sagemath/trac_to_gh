# Issue 24390: Use arb 2.6+ comparison functions instead of custom implementation

Issue created by migration from https://trac.sagemath.org/ticket/24627

Original creator: mmezzarobba

Original creation time: 2018-01-31 18:44:13

CC:  jdemeyer vdelecroix cheuberg fredrik.johansson




---

Comment by mmezzarobba created at 2018-01-31 18:52:01

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2018-01-31 18:52:01

New commits:


---

Comment by tmonteil created at 2018-02-01 00:41:12

Changing status from needs_review to needs_work.


---

Comment by tmonteil created at 2018-02-01 00:41:12

Good move.

However, i got a failing doctest in `src/sage/rings/polynomial/polynomial_element.pyx`, that reveals a criminal (though documented) failure in the previous behaviour of `RBF`, that `x = RBF(1.0, 0.1) ; x == x` returns `True`. The doctest seems to have been introduced in #22087 without complain.

Let me suggest to:

  - move the doctest `x = RBF(1.0, 0.1) ; x == x` to something specific to ARB (it has nothing to do with polynomials actually)
  - add the doctest that triggered #22087 proposed at [/22076#comment:5 #22076:comment:5] in `src/sage/rings/polynomial/polynomial_element.pyx`
  - adapt the doctests corresponding to `RIF` in `src/sage/rings/polynomial/polynomial_element.pyx` (the block just above) to the `RBF` case.


---

Comment by git created at 2018-02-12 13:57:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-02-12 13:59:25

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-02-12 14:02:07

Replying to [ticket:24627 mmezzarobba]:
> This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. 

If you are changing semantics, don't hide that information in the commit message!


---

Comment by jdemeyer created at 2018-02-12 14:02:07

Changing status from needs_review to needs_info.


---

Comment by mmezzarobba created at 2018-02-12 14:10:25

?!?

That's why I mentioned it here... Commit messages are both more durable and easier to access than trac tickets, aren't they? But I can copy the commit message here if you prefer:

  Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.


---

Comment by mmezzarobba created at 2018-02-12 14:10:25

Changing status from needs_info to positive_review.


---

Comment by mmezzarobba created at 2018-02-12 14:10:36

Changing status from positive_review to needs_review.


---

Comment by vdelecroix created at 2018-02-26 13:48:38

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2018-02-26 13:48:38

All tests pass. This is a great improvement (that is blocking many other tickets).


---

Comment by vbraun created at 2018-03-04 23:29:00

Resolution: fixed
