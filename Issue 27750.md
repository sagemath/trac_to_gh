# Issue 27750: `CombinatorialPolyhedron` improve initialization, remove bug for unbounded polyhedra

Issue created by migration from https://trac.sagemath.org/ticket/27987

Original creator: @kliem

Original creation time: 2019-06-14 06:50:42

CC:  jipilab tscrim vdelecroix

`CombinatorialPolyhedron` at the moment only requires the number of lines (as `n_lines` in `Polyhedron_base`). This does not suffice, as


```
sage: P1 = Polyhedron(vertices=[[0,1],[1,0]], rays=[[1,1]])
sage: P2 = Polyhedron(vertices=[[0,1],[1,0],[1,1]])
sage: P1.incidence_matrix() == P2.incidence_matrix()
True
```


Instead of just specifying the `n_lines`, one should specify `unbounded` and a far face (or the how many lines and rays there are in total).

Unfortunately, determining the rays from just the incidence matrix does not seem to work.


---

Comment by @kliem created at 2019-06-14 13:39:31

Last 10 new commits:


---

Comment by embray created at 2019-06-14 14:55:02

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by chapoton created at 2019-07-10 09:44:01

There is also a python3 failing doctest:

This triggers a new failing doctest with python3-sage:

```
sage -t --long src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx
**********************************************************************
File "src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 937, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.edge_graph
Failed example:
    G.degree()
Expected:
    [4, 3, 4, 3, 4]
Got:
    [3, 4, 4, 3, 4]
```



---

Comment by chapoton created at 2019-07-10 09:56:59

I have made #28153 for the py3 problem, please review.


---

Comment by @kliem created at 2019-07-11 17:51:07

New commits:


---

Comment by git created at 2019-07-11 22:04:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 22:12:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 22:20:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-11 22:26:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-07-11 22:27:56

New commits:


---

Comment by @kliem created at 2019-07-11 22:27:56

Changing status from new to needs_review.


---

Comment by @kliem created at 2019-07-12 14:36:51

https://patchbot.sagemath.org/log/27987/debian/9.9/x86_64/4.9.0-9-amd64/cofio/2019-07-12%2013:08:53?short

The whole business with testing an interrupt is really unstable. It seems to work almost all of the time, but having the tests fail in even 1 percent of the tests is not acceptable, is it? (Imagine this being the case for all modules.)

I do not know, where I could possible have made a mistake with catching an interrupt. I suspect that it just sometimes fails at some place that I have no impact on.

Anyway, maybe I should remove those fragile tests (in a new ticket).


---

Comment by tscrim created at 2019-07-24 09:47:38

A few things:

Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).

`#27987` -> `:trac:`12987``

`if unbounded is False:` -> `if not unbounded:` (unless you expect `unbounded` to possibly be something else like `None` that should be treated differently, in which case you should add a comment about that).


---

Comment by @kliem created at 2019-07-24 11:55:33

Thanks.

Replying to [comment:16 tscrim]:
> A few things:
> 
> Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).

`CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.

At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.
Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).

> 
> `#27987` -> `:trac:`12987``
> 
> `if unbounded is False:` -> `if not unbounded:` (unless you expect `unbounded` to possibly be something else like `None` that should be treated differently, in which case you should add a comment about that).


---

Comment by tscrim created at 2019-07-24 13:25:10

Replying to [comment:17 gh-kliem]:
> Thanks.
> 
> Replying to [comment:16 tscrim]:
> > A few things:
> > 
> > Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).
> 
> `CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.

Okay, then this is good as it currently is (i.e., you do not need to issue a warning).

> At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.
> Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).

That is probably best for another ticket.

So if you make the other two changes I mentioned, then you can set a positive review on my behalf.


---

Comment by @kliem created at 2019-07-24 14:04:38

Great. I will do so probably on Saturday (no PC at the moment).

Replying to [comment:18 tscrim]:
> Replying to [comment:17 gh-kliem]:
> > Thanks.
> > 
> > Replying to [comment:16 tscrim]:
> > > A few things:
> > > 
> > > Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).
> > 
> > `CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.
> 
> Okay, then this is good as it currently is (i.e., you do not need to issue a warning).
> 
> > At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.
> > Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).
> 
> That is probably best for another ticket.
> 
> So if you make the other two changes I mentioned, then you can set a positive review on my behalf.


---

Comment by git created at 2019-07-27 19:11:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-07-27 19:13:38

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2019-07-27 19:13:38

Two changes mentioned by Travis taken care of.


---

Comment by vbraun created at 2019-07-29 21:54:58

Resolution: fixed
