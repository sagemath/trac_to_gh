# Issue 11411: Sagetex example has some nontrivial dependancy's

Issue created by migration from Trac.

Original creator: mderickx

Original creation time: 2011-07-08 14:21:55

Assignee: tbd

CC:  ddrake fbissey

As mentioned in https://groups.google.com/forum/#!topic/sage-devel/6I3BD32YZWI
the standard sagetex example included in sage depends on tkz-berge which can be hard to get it working correctly. This might scare of sagetex users while tkz-berge is only needed for the graph (with vertices and edges) part of sage. The new version of the example .tex disables this part of the example by default with some notice on how to enable it.


---

Attachment


---

Comment by vbraun created at 2011-07-08 16:43:22

Changing type from PLEASE CHANGE to defect.


---

Comment by jhpalmieri created at 2011-11-10 22:03:18

Changing priority from major to blocker.


---

Comment by jhpalmieri created at 2011-11-10 22:03:18

A related, but not completely identical problem: self-tests fail for the sagetex package.  If I set SAGE_CHECK=yes and then do `sage -f sagetex...`, I get a message like

```
/Applications/sage_builds/sage/local/bin/sage-preparse: File 'example.sage' is missing
python: can't open file 'example.py': [Errno 2] No such file or directory
Error running Sage on example.sage!
```

I know how to fix this problem, but self-tests still fail if various `.sty` files are missing, as they are on sage.math:

```
! LaTeX Error: File `ifxetex.sty' not found.

Type X to quit or <RETURN> to proceed,
or enter new name. (Default extension: sty)

Enter file name: 
! Emergency stop.
<read *> 
```

I think the following patch fixes the first problem, but not the second:

```diff
diff --git a/spkg-check b/spkg-check
--- a/spkg-check
+++ b/spkg-check
`@``@` -46,10 +46,10 `@``@` fi
 cd src
 
 typeset example.tex
-checkdotsage example
+checkdotsage example.sagetex
 
-typeset sagetexpackage.dtx
-checkdotsage sagetexpackage
+typeset sagetex.dtx
+checkdotsage sagetex.sagetex
 
 # if we get here, we assume the .sage files are good, and exit successfully
 exit 0
```

I'm upgrading this to a blocker, since all of our spkg's should pass self-tests.  (Well, except for Python...)


---

Comment by pipedream created at 2011-11-16 19:05:29

Fix instructions in example.tex on new file extension (.sage -> .sagetex.sage)


---

Attachment

Above a separate patch to fix example.sage to example.sagetex.sage in the file example.tex.


---

Comment by ddrake created at 2011-11-18 02:51:12

Changing status from new to needs_review.


---

Comment by ddrake created at 2011-11-18 02:51:12

I have an updated spkg that should fix both the file extension and `tkz-berge`/TikZ problems: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.p1.spkg. 

To fully review, you'll need to look at some revisions to the source code; start with rev 3cc4e629401e "remove \sageplot default of .75\textwidth; make the user decide": https://bitbucket.org/ddrake/sagetex/changesets and look over all the revs to the tip. (A bunch are simple one-liners; don't be discouraged.)

Then you'll need to look over the most recent two revisions to the spkg repository (inside the spkg). 

Finally, install the spkg with SAGE_CHECK=yes and make sure it works.


---

Comment by jhpalmieri created at 2011-11-21 23:45:22

Looks good to me.  Passes doctests on several different machines where it failed before, some of which have recent TeX distributions, some of which have old TeX distributions, and some of which are missing TeX altogether.

The only part of the change log that I don't completely understand (because I don't know LaTeX style files very well) is [this one](https://bitbucket.org/ddrake/sagetex/changeset/3840ae05d2a7), but I tried putting some Sage code in a labeled math environment, like align, and it worked fine.


---

Comment by jhpalmieri created at 2011-11-21 23:45:22

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-11-23 21:03:42

Please give clear instructions in the ticket description of what should be merged.


---

Comment by jdemeyer created at 2011-11-26 09:34:50

Resolution: fixed
