# Issue 27254: bug fix: default value true instead of false in networkx_graph method

archive/issues_027254.json:
```json
{
    "body": "CC:  dcoudert\n\nDefault value of parameter copy in method network_graph is written in documentation to be false but used as True in generic_graph.py\n\nIssue created by migration from https://trac.sagemath.org/ticket/27491\n\n",
    "created_at": "2019-03-15T11:06:25Z",
    "labels": [
        "graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "bug fix: default value true instead of false in networkx_graph method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27254",
    "user": "@rajat1433"
}
```
CC:  dcoudert

Default value of parameter copy in method network_graph is written in documentation to be false but used as True in generic_graph.py

Issue created by migration from https://trac.sagemath.org/ticket/27491





---

archive/issue_comments_384056.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-03-15T11:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384056",
    "user": "@rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_comments_384057.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-15T11:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384057",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384058.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-15T11:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384058",
    "user": "@rajat1433"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384059.json:
```json
{
    "body": "This is a very good catch. However, what you propose to do is not what should be done.\n\nIn #27166, we removed deprecated networkx backends, but we forgot to update other parts.\n\n- In file `src/sage/graphs/base/graph_backends.pyx`: remove class `NetworkXGraphDeprecated`\n\n- in method `networkx_graph`: remove parameter `copy` and update the code so that the method always returns a networkx graph.\n\n- the name of this ticket will have to be updated accordingly",
    "created_at": "2019-03-15T12:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384059",
    "user": "dcoudert"
}
```

This is a very good catch. However, what you propose to do is not what should be done.

In #27166, we removed deprecated networkx backends, but we forgot to update other parts.

- In file `src/sage/graphs/base/graph_backends.pyx`: remove class `NetworkXGraphDeprecated`

- in method `networkx_graph`: remove parameter `copy` and update the code so that the method always returns a networkx graph.

- the name of this ticket will have to be updated accordingly



---

archive/issue_comments_384060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-15T14:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384061.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-03-15T14:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384061",
    "user": "@rajat1433"
}
```

New commits:



---

archive/issue_comments_384062.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2019-03-15T15:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384062",
    "user": "@rajat1433"
}
```

Changing priority from minor to major.



---

archive/issue_comments_384063.json:
```json
{
    "body": "I am not able to locate _backend._nxg in any backend file in the networkx_graph method\n \n\n```\n        try:\n            return self._backend._nxg\n        except Exception:\n```\n\n\ncan you point the location or does it always throw an error , if so we can remove it.",
    "created_at": "2019-03-15T15:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384063",
    "user": "@rajat1433"
}
```

I am not able to locate _backend._nxg in any backend file in the networkx_graph method
 

```
        try:
            return self._backend._nxg
        except Exception:
```


can you point the location or does it always throw an error , if so we can remove it.



---

archive/issue_comments_384064.json:
```json
{
    "body": "We don't have this backend anymore. This is a remaining of the very first releases of Sagemath that we have not fully removed yet (I forgot to do it in  #27166).\n\n\nYou can also remove this from `trees.pyx`\n\n```\n#        from networkx import MultiGraph\n#        G = Graph(self.vertices)\n#        cdef object XG = G._backend._nxg\n#\n#        for i from 2 <= i <= self.vertices:\n#            vertex1 = i - 1\n#            vertex2 = self.current_level_sequence[i - 1] - 1\n#            XG.add_edge(vertex1, vertex2)\n#\n#        return G\n\n        # Currently, c_graph does not have all the same functionality as networkx.\n        # Until it does, we can't generate graphs using the c_graph backend even\n        # though it is twice as fast (for our purposes) as networkx.\n```\n",
    "created_at": "2019-03-15T16:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384064",
    "user": "dcoudert"
}
```

We don't have this backend anymore. This is a remaining of the very first releases of Sagemath that we have not fully removed yet (I forgot to do it in  #27166).


You can also remove this from `trees.pyx`

```
#        from networkx import MultiGraph
#        G = Graph(self.vertices)
#        cdef object XG = G._backend._nxg
#
#        for i from 2 <= i <= self.vertices:
#            vertex1 = i - 1
#            vertex2 = self.current_level_sequence[i - 1] - 1
#            XG.add_edge(vertex1, vertex2)
#
#        return G

        # Currently, c_graph does not have all the same functionality as networkx.
        # Until it does, we can't generate graphs using the c_graph backend even
        # though it is twice as fast (for our purposes) as networkx.
```




---

archive/issue_comments_384065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-15T16:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384065",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384066.json:
```json
{
    "body": "I was a little to fast. To be clean, we should add a deprecation warning for parameter `copy`.\n\nCould you:\n- put back parameter `copy` as input parameter, but without documentation. So\n\n```diff\n-    def networkx_graph(self):\n+    def networkx_graph(self, copy=True):\n```\n\n- and add the following at the very beginning of the method\n\n```diff\n+        if copy is not True:\n+            deprecation(27491, \"parameter copy is removed\")\n```\n\n\nThen, in one year, we will completely remove this parameter.\n\nAnother small modification:\n\n```diff\n-        N.add_nodes_from(self.vertices())\n+        N.add_nodes_from(self)\n```\n\nMethod `vertices` sorts vertices by default, and returns a list of vertices. Method `add_nodes_from` can take an iterator as input. So we save the creation of the list.\n\n\nI changed the description of this ticket to be consistent with what it does.",
    "created_at": "2019-03-17T07:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384066",
    "user": "dcoudert"
}
```

I was a little to fast. To be clean, we should add a deprecation warning for parameter `copy`.

Could you:
- put back parameter `copy` as input parameter, but without documentation. So

```diff
-    def networkx_graph(self):
+    def networkx_graph(self, copy=True):
```

- and add the following at the very beginning of the method

```diff
+        if copy is not True:
+            deprecation(27491, "parameter copy is removed")
```


Then, in one year, we will completely remove this parameter.

Another small modification:

```diff
-        N.add_nodes_from(self.vertices())
+        N.add_nodes_from(self)
```

Method `vertices` sorts vertices by default, and returns a list of vertices. Method `add_nodes_from` can take an iterator as input. So we save the creation of the list.


I changed the description of this ticket to be consistent with what it does.



---

archive/issue_comments_384067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-17T08:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384067",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384068.json:
```json
{
    "body": "deprecated the copy parameter.",
    "created_at": "2019-03-17T08:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384068",
    "user": "@rajat1433"
}
```

deprecated the copy parameter.



---

archive/issue_comments_384069.json:
```json
{
    "body": "LGTM",
    "created_at": "2019-03-17T17:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384069",
    "user": "dcoudert"
}
```

LGTM



---

archive/issue_comments_384070.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-17T17:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384070",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384071.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-25T19:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27254#issuecomment-384071",
    "user": "vbraun"
}
```

Resolution: fixed
