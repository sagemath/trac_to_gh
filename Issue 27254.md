# Issue 27254: bug fix: default value true instead of false in networkx_graph method

Issue created by migration from https://trac.sagemath.org/ticket/27491

Original creator: @rajat1433

Original creation time: 2019-03-15 11:06:25

CC:  dcoudert

Default value of parameter copy in method network_graph is written in documentation to be false but used as True in generic_graph.py


---

Comment by @rajat1433 created at 2019-03-15 11:07:27

Set assignee to @rajat1433.


---

Comment by git created at 2019-03-15 11:10:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-15 11:11:54

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-03-15 12:11:54

This is a very good catch. However, what you propose to do is not what should be done.

In #27166, we removed deprecated networkx backends, but we forgot to update other parts.

- In file `src/sage/graphs/base/graph_backends.pyx`: remove class `NetworkXGraphDeprecated`

- in method `networkx_graph`: remove parameter `copy` and update the code so that the method always returns a networkx graph.

- the name of this ticket will have to be updated accordingly


---

Comment by git created at 2019-03-15 14:54:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-15 14:57:18

New commits:


---

Comment by @rajat1433 created at 2019-03-15 15:01:28

Changing priority from minor to major.


---

Comment by @rajat1433 created at 2019-03-15 15:24:35

I am not able to locate _backend._nxg in any backend file in the networkx_graph method
 

```
        try:
            return self._backend._nxg
        except Exception:
```


can you point the location or does it always throw an error , if so we can remove it.


---

Comment by dcoudert created at 2019-03-15 16:01:20

We don't have this backend anymore. This is a remaining of the very first releases of Sagemath that we have not fully removed yet (I forgot to do it in  #27166).


You can also remove this from `trees.pyx`

```
#        from networkx import MultiGraph
#        G = Graph(self.vertices)
#        cdef object XG = G._backend._nxg
#
#        for i from 2 <= i <= self.vertices:
#            vertex1 = i - 1
#            vertex2 = self.current_level_sequence[i - 1] - 1
#            XG.add_edge(vertex1, vertex2)
#
#        return G

        # Currently, c_graph does not have all the same functionality as networkx.
        # Until it does, we can't generate graphs using the c_graph backend even
        # though it is twice as fast (for our purposes) as networkx.
```



---

Comment by git created at 2019-03-15 16:25:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-03-17 07:51:47

I was a little to fast. To be clean, we should add a deprecation warning for parameter `copy`.

Could you:
- put back parameter `copy` as input parameter, but without documentation. So

```diff
-    def networkx_graph(self):
+    def networkx_graph(self, copy=True):
```

- and add the following at the very beginning of the method

```diff
+        if copy is not True:
+            deprecation(27491, "parameter copy is removed")
```


Then, in one year, we will completely remove this parameter.

Another small modification:

```diff
-        N.add_nodes_from(self.vertices())
+        N.add_nodes_from(self)
```

Method `vertices` sorts vertices by default, and returns a list of vertices. Method `add_nodes_from` can take an iterator as input. So we save the creation of the list.


I changed the description of this ticket to be consistent with what it does.


---

Comment by git created at 2019-03-17 08:15:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-17 08:18:17

deprecated the copy parameter.


---

Comment by dcoudert created at 2019-03-17 17:20:35

LGTM


---

Comment by dcoudert created at 2019-03-17 17:20:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-25 19:43:46

Resolution: fixed
