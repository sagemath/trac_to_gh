# Issue 20423: Add Certificate to is_isomorphic() in the matroids package

Issue created by migration from Trac.

Original creator: tara

Original creation time: 2016-05-23 15:10:29

CC:  stefan yomcat

Keywords: matroid, isomorphism

We are going to add an option to get certificate when testing if two matroids are isomorphic. I will be doing this.


---

Comment by yomcat created at 2016-05-24 05:06:07

Changing type from PLEASE CHANGE to enhancement.


---

Comment by yomcat created at 2016-05-24 05:06:07

Changing component from PLEASE CHANGE to matroid theory.


---

Comment by git created at 2016-05-26 21:37:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tara created at 2016-05-26 22:03:34

Right now, I'm happy with the code except for in basis_exchange_matroid, `M1._is_isomorphic(M2, True)` yields the output `(True, True)` on line 2272, and similarly on line 2278. This doesn't seem to be something that I caused directly, but might be due to the following code found in `_isomorphism()` in basis_matroid.pyx (lines 980-981). 

```
if not isinstance(other, BasisMatroid):
    return BasisExchangeMatroid._is_isomorphic(self, other)
```


I'm not sure exactly how to tell what type of matroid a thing is when it gets instigated. Regardless, is there any reason why we don't want to or are unable to return an isomorphism in the above case?


---

Comment by Stefan created at 2016-05-27 01:54:16

If you're calling another instance of the is_isomorphic method, you should pass through all parameters. So the line you quote needs to be changed to


```
if not isinstance(other, BasisMatroid):
    return BasisExchangeMatroid._is_isomorphic(self, other, cert)
```



---

Comment by tara created at 2016-05-27 02:04:39

Replying to [comment:5 Stefan]:
> If you're calling another instance of the is_isomorphic method, you should pass through all parameters. So the line you quote needs to be changed to
> 
> {{{
> if not isinstance(other, BasisMatroid):
>     return BasisExchangeMatroid._is_isomorphic(self, other, cert)
> }}}

My question was why we are calling `is_isomorphic` instead of `isomorphism`. For instance, the following comes from an unedited version of sage. But I would expect a dictionary instead of a boolean.

```
sage: from sage.matroids.advanced import *
sage: M1 = BasisMatroid(matroids.Wheel(3))
sage: M2 = matroids.CompleteGraphic(4)
sage: M1.isomorphism(M2)
True
```


So I think that this is a bug in Sage.


---

Comment by Stefan created at 2016-05-27 02:13:38

I think you're right. Normally the right thing to do would be to open a separate ticket for the bug, but since you're editing the same methods already, you might as well fix it in this ticket.


---

Comment by git created at 2016-05-27 02:48:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tara created at 2016-05-27 02:49:18

Changing status from new to needs_review.


---

Comment by yomcat created at 2016-05-27 03:06:53

I'll have a proper look later, but you should change `cert` to `certificate` as `is_3connected()` has for consistency.


---

Comment by git created at 2016-05-27 19:31:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yomcat created at 2016-05-27 21:12:24

Changing status from needs_review to needs_work.


---

Comment by yomcat created at 2016-05-27 21:12:24

A few minor things:

* There's some extraneous whitespace after your commas -- use `git trac review` to see it easily.
* You haven't fully made the `cert` to `certificate` change. The pxd files are causing errors upon compilation because of it.
* In the doctests, you should specify the option, ie: `M.is_isomorphic(N, certificate=True)`
* In the output part of the docstring, you should say what that the dictionary shows the isomorphism, and None is output when the matroids aren't isomorphic.


---

Comment by git created at 2016-05-28 19:48:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-28 19:50:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yomcat created at 2016-05-28 21:04:06

First, you have a bunch of doubled-up doctests (one with the explicit option, one without).

This happens (it's due to a capital C):


```
sage -t --long --warn-long 69.0 src/sage/matroids/circuit_closures_matroid.pyx
**********************************************************************
File "src/sage/matroids/circuit_closures_matroid.pyx", line 393, in sage.matroids.circuit_closures_matroid.CircuitClosuresMatroid._is_isomorphic
Failed example:
    M1._is_isomorphic(M2, Certificate=True)
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage-devel/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Applications/sage-devel/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matroids.circuit_closures_matroid.CircuitClosuresMatroid._is_isomorphic[9]>", line 1, in <module>
        M1._is_isomorphic(M2, Certificate=True)
      File "sage/matroids/circuit_closures_matroid.pyx", line 358, in sage.matroids.circuit_closures_matroid.CircuitClosuresMatroid._is_isomorphic (/Applications/sage-devel/src/build/cythonized/sage/matroids/circuit_closures_matroid.c:4575)
        cpdef _is_isomorphic(self, other, certificate=False):
    TypeError: _is_isomorphic() got an unexpected keyword argument 'Certificate'
**********************************************************************
1 item had failures:
   1 of  12 in sage.matroids.circuit_closures_matroid.CircuitClosuresMatroid._is_isomorphic
    [81 tests, 1 failure, 0.30 s]
```


Last doctest in BasisExchangeMatroid is missing the explicit option.

Around line 2694 in `linear_matroid.pyx`, you've removed an extra space. It should be `return True, None`.

You've dropped an I from INPUT around line 355 of `circuit_closures_matroid.pyx`, and lines 3265, 4312, 5941 of `linear_matroid.pyx`


---

Comment by git created at 2016-05-28 22:28:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-28 22:40:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yomcat created at 2016-05-28 22:42:50

You missed one doctest, but I cleaned it up. If you're happy now with that (I'm happy now), set it to positive.


---

Comment by tara created at 2016-05-28 22:51:19

I don't see anything wrong with it. My doctest has been acting weird for the last couple of hours. On this file, its now giving me 13 errors, each of which saying that `is_isomorphic()` or `_is_isomorphic()` is only supposed to be taking one parameter. Before it was saying that everything passes when it shouldn't have been.


---

Comment by yomcat created at 2016-05-28 22:58:07

Replying to [comment:19 tara]:
> I don't see anything wrong with it. My doctest has been acting weird for the last couple of hours. On this file, its now giving me 13 errors, each of which saying that `is_isomorphic()` or `_is_isomorphic()` is only supposed to be taking one parameter. Before it was saying that everything passes when it shouldn't have been.

That sounds like you're partially in the wrong branch (so not all the changes are being applied). Have you run `./sage -br`?


---

Comment by git created at 2016-05-28 23:11:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tara created at 2016-05-29 02:16:12

Replying to [comment:20 yomcat]:
> Replying to [comment:19 tara]:
> > I don't see anything wrong with it. My doctest has been acting weird for the last couple of hours. On this file, its now giving me 13 errors, each of which saying that `is_isomorphic()` or `_is_isomorphic()` is only supposed to be taking one parameter. Before it was saying that everything passes when it shouldn't have been.
> 
> That sounds like you're partially in the wrong branch (so not all the changes are being applied). Have you run `./sage -br`?

That worked for me. What exactly does ./sage -br do? I don't remember seeing it before.


---

Comment by tara created at 2016-05-29 02:16:45

Changing status from needs_work to positive_review.


---

Comment by yomcat created at 2016-05-29 03:12:47

Replying to [comment:22 tara]:
> Replying to [comment:20 yomcat]:
> > Replying to [comment:19 tara]:
> > > I don't see anything wrong with it. My doctest has been acting weird for the last couple of hours. On this file, its now giving me 13 errors, each of which saying that `is_isomorphic()` or `_is_isomorphic()` is only supposed to be taking one parameter. Before it was saying that everything passes when it shouldn't have been.
> > 
> > That sounds like you're partially in the wrong branch (so not all the changes are being applied). Have you run `./sage -br`?
> 
> That worked for me. What exactly does ./sage -br do? I don't remember seeing it before.
It rebuilds the sage library (just the bits that have changed). You need to do it to make your updated code work.

http://doc.sagemath.org/html/en/developer/walk_through.html#section-walkthrough-make


---

Comment by vbraun created at 2016-05-31 07:29:44

Resolution: fixed
