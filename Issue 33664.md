# Issue 33664: sage-bootstrap-python doesn't work with pyenv installed

archive/issues_033664.json:
```json
{
    "body": "Keywords: bootstrap, build, python, pyenv\n\nThe script sage-bootstrap-python attempts to call a command like\n\"/path/to/python\" -c \"...\"\nPyenv python treats \"python\" differently from just python, giving the output:\n/home/.../.pyenv/shims/python: line 1: 2: command not found\n\nWith pyenv installed and configured normally, the script will never check a non-pyenv version of python, and thus will fail to find a suitable python. My fix was to attempt to remove pyenv from the PATH before testing for python.\n\nI've only confirmed this behavior on arch linux\n\nIssue created by migration from https://trac.sagemath.org/ticket/33901\n\n",
    "created_at": "2022-05-25T06:27:00Z",
    "labels": [
        "build: configure",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "sage-bootstrap-python doesn't work with pyenv installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33664",
    "user": "@k3w1k0d3r"
}
```
Keywords: bootstrap, build, python, pyenv

The script sage-bootstrap-python attempts to call a command like
"/path/to/python" -c "..."
Pyenv python treats "python" differently from just python, giving the output:
/home/.../.pyenv/shims/python: line 1: 2: command not found

With pyenv installed and configured normally, the script will never check a non-pyenv version of python, and thus will fail to find a suitable python. My fix was to attempt to remove pyenv from the PATH before testing for python.

I've only confirmed this behavior on arch linux

Issue created by migration from https://trac.sagemath.org/ticket/33901





---

archive/issue_comments_479146.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-05-25T06:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479146",
    "user": "@k3w1k0d3r"
}
```

New commits:



---

archive/issue_comments_479147.json:
```json
{
    "body": "Set assignee to @k3w1k0d3r.",
    "created_at": "2022-05-25T06:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479147",
    "user": "@k3w1k0d3r"
}
```

Set assignee to @k3w1k0d3r.



---

archive/issue_comments_479148.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-25T06:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479148",
    "user": "@k3w1k0d3r"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_479149.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-25T16:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479149",
    "user": "@k3w1k0d3r"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_479150.json:
```json
{
    "body": "Could you please open a bug report with pyenv? It's pretty wild that they install a broken python command in PATH",
    "created_at": "2022-05-25T16:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479150",
    "user": "mkoeppe"
}
```

Could you please open a bug report with pyenv? It's pretty wild that they install a broken python command in PATH



---

archive/issue_comments_479151.json:
```json
{
    "body": "yeah sure\n\ndo you think I should give up on this ticket or should I still work on it to make the build not fail?",
    "created_at": "2022-05-25T17:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479151",
    "user": "@k3w1k0d3r"
}
```

yeah sure

do you think I should give up on this ticket or should I still work on it to make the build not fail?



---

archive/issue_comments_479152.json:
```json
{
    "body": "well I'll fix it because it's not too bad, I just used bash-only syntax and for some reason when I tested it locally it still worked",
    "created_at": "2022-05-25T17:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479152",
    "user": "@k3w1k0d3r"
}
```

well I'll fix it because it's not too bad, I just used bash-only syntax and for some reason when I tested it locally it still worked



---

archive/issue_comments_479153.json:
```json
{
    "body": "Yes, we can merge a workaround in Sage. But the bug is in pyenv",
    "created_at": "2022-05-25T17:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479153",
    "user": "mkoeppe"
}
```

Yes, we can merge a workaround in Sage. But the bug is in pyenv



---

archive/issue_comments_479154.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-25T17:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479154",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479155.json:
```json
{
    "body": "great thank you",
    "created_at": "2022-05-25T17:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479155",
    "user": "@k3w1k0d3r"
}
```

great thank you



---

archive/issue_comments_479156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-25T17:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479156",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479157.json:
```json
{
    "body": "\n```\n+paths=$(echo $SAGE_ORIG_PATH | tr \":\" \"\\n\")\n+NEW_PATH=\"\"\n+for path in $paths\n```\n\nLoops like this are better done with IFS",
    "created_at": "2022-05-25T18:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479157",
    "user": "mkoeppe"
}
```


```
+paths=$(echo $SAGE_ORIG_PATH | tr ":" "\n")
+NEW_PATH=""
+for path in $paths
```

Loops like this are better done with IFS



---

archive/issue_comments_479158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-25T18:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479158",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479159.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> {{{\n> +paths=$(echo $SAGE_ORIG_PATH | tr \":\" \"\\n\")\n> +NEW_PATH=\"\"\n> +for path in $paths\n> }}}\n> Loops like this are better done with IFS\nalright I'll change it thanks",
    "created_at": "2022-05-25T18:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479159",
    "user": "@k3w1k0d3r"
}
```

Replying to [comment:13 mkoeppe]:
> {{{
> +paths=$(echo $SAGE_ORIG_PATH | tr ":" "\n")
> +NEW_PATH=""
> +for path in $paths
> }}}
> Loops like this are better done with IFS
alright I'll change it thanks



---

archive/issue_comments_479160.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-25T18:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479160",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479161.json:
```json
{
    "body": "I realized my system sh was a symlink to bash instead of dash, which is why my local tests worked. I've now properly tested with dash, so hopefully now everything works.",
    "created_at": "2022-05-25T18:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479161",
    "user": "@k3w1k0d3r"
}
```

I realized my system sh was a symlink to bash instead of dash, which is why my local tests worked. I've now properly tested with dash, so hopefully now everything works.



---

archive/issue_comments_479162.json:
```json
{
    "body": "https://github.com/pyenv/pyenv/issues/2378",
    "created_at": "2022-05-25T19:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479162",
    "user": "@k3w1k0d3r"
}
```

https://github.com/pyenv/pyenv/issues/2378



---

archive/issue_comments_479163.json:
```json
{
    "body": "it seems that the issue with pyenv is most likely a misconfiguration on my end of some sort",
    "created_at": "2022-05-25T19:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479163",
    "user": "@k3w1k0d3r"
}
```

it seems that the issue with pyenv is most likely a misconfiguration on my end of some sort



---

archive/issue_comments_479164.json:
```json
{
    "body": "yeah the quotes issue is fixed on my system, but the old script still doesn't work for me. I assume it's because of #29285",
    "created_at": "2022-05-25T21:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479164",
    "user": "@k3w1k0d3r"
}
```

yeah the quotes issue is fixed on my system, but the old script still doesn't work for me. I assume it's because of #29285



---

archive/issue_comments_479165.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-25T21:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479165",
    "user": "@k3w1k0d3r"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_479166.json:
```json
{
    "body": "\n```\n+        *      ) NEW_PATH=\"$NEW_PATH$path:\";;\n```\n\nshouldn't the colon be in a different place?",
    "created_at": "2022-05-25T23:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479166",
    "user": "mkoeppe"
}
```


```
+        *      ) NEW_PATH="$NEW_PATH$path:";;
```

shouldn't the colon be in a different place?



---

archive/issue_comments_479167.json:
```json
{
    "body": "I think \":$NEW_PATH$path\" also works if that's what you mean.",
    "created_at": "2022-05-25T23:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479167",
    "user": "@k3w1k0d3r"
}
```

I think ":$NEW_PATH$path" also works if that's what you mean.



---

archive/issue_comments_479168.json:
```json
{
    "body": "I think the constructed path should neither begin nor end with `:` because that would mean that the current directory is included.",
    "created_at": "2022-05-25T23:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479168",
    "user": "mkoeppe"
}
```

I think the constructed path should neither begin nor end with `:` because that would mean that the current directory is included.



---

archive/issue_comments_479169.json:
```json
{
    "body": "okay I'll get rid of the extra `:`",
    "created_at": "2022-05-25T23:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479169",
    "user": "@k3w1k0d3r"
}
```

okay I'll get rid of the extra `:`



---

archive/issue_comments_479170.json:
```json
{
    "body": "Also could you make the pattern `*pyenv*` a bit more specific?",
    "created_at": "2022-05-25T23:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479170",
    "user": "mkoeppe"
}
```

Also could you make the pattern `*pyenv*` a bit more specific?



---

archive/issue_comments_479171.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-25T23:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479171",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479172.json:
```json
{
    "body": "\n```\n+        '/home/'*'/.pyenv/shims'*);;\n```\n\nWell that's now a bit too specific. For example, on macOS, user home directories live in `/Users`. By the way, words don't need to be quoted in these patterns",
    "created_at": "2022-05-26T00:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479172",
    "user": "mkoeppe"
}
```


```
+        '/home/'*'/.pyenv/shims'*);;
```

Well that's now a bit too specific. For example, on macOS, user home directories live in `/Users`. By the way, words don't need to be quoted in these patterns



---

archive/issue_comments_479173.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-26T00:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479173",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479174.json:
```json
{
    "body": "Replying to [comment:28 mkoeppe]:\n> {{{\n> +        '/home/'*'/.pyenv/shims'*);;\n> }}}\n> Well that's now a bit too specific. For example, on macOS, user home directories live in `/Users`. By the way, words don't need to be quoted in these patterns\nyeah I didn't think that through very well",
    "created_at": "2022-05-26T00:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479174",
    "user": "@k3w1k0d3r"
}
```

Replying to [comment:28 mkoeppe]:
> {{{
> +        '/home/'*'/.pyenv/shims'*);;
> }}}
> Well that's now a bit too specific. For example, on macOS, user home directories live in `/Users`. By the way, words don't need to be quoted in these patterns
yeah I didn't think that through very well



---

archive/issue_comments_479175.json:
```json
{
    "body": "\n```\n+IFS=' '\n```\n\nIt doesn't matter very much here, but note that this is not the default value of `IFS`.\nIt would be more idiomatic to either save the old IFS in a variable and then restore it, or to `unset IFS` to restore the default behavior of the shell.",
    "created_at": "2022-05-26T16:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479175",
    "user": "mkoeppe"
}
```


```
+IFS=' '
```

It doesn't matter very much here, but note that this is not the default value of `IFS`.
It would be more idiomatic to either save the old IFS in a variable and then restore it, or to `unset IFS` to restore the default behavior of the shell.



---

archive/issue_comments_479176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-26T18:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479176",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479177.json:
```json
{
    "body": "it seems odd that this failed a startup time test right? it doesn't seem like this script ever gets executed after it's already been configured",
    "created_at": "2022-05-26T18:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479177",
    "user": "@k3w1k0d3r"
}
```

it seems odd that this failed a startup time test right? it doesn't seem like this script ever gets executed after it's already been configured



---

archive/issue_comments_479178.json:
```json
{
    "body": "The startup time test is safe to ignore. It is much too optimistic regarding the precision of its measurements.",
    "created_at": "2022-05-26T18:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479178",
    "user": "mkoeppe"
}
```

The startup time test is safe to ignore. It is much too optimistic regarding the precision of its measurements.



---

archive/issue_comments_479179.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-26T18:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479179",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_479180.json:
```json
{
    "body": "Thanks for this contribution.",
    "created_at": "2022-05-26T18:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479180",
    "user": "mkoeppe"
}
```

Thanks for this contribution.



---

archive/issue_comments_479181.json:
```json
{
    "body": "Changing priority from trivial to major.",
    "created_at": "2022-05-26T18:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479181",
    "user": "mkoeppe"
}
```

Changing priority from trivial to major.



---

archive/issue_comments_479182.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-29T11:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33664#issuecomment-479182",
    "user": "vbraun"
}
```

Resolution: fixed
