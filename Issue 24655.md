# Issue 24655: triangle (2,2,5)

Issue created by migration from https://trac.sagemath.org/ticket/24892

Original creator: vdelecroix

Original creation time: 2018-03-02 16:24:08

CC:  jipilab tscrim

Keywords: days93

The triangle group (2,2,5) is reducible but the error below is very much obscure

```
sage: p=2; q=2; r=5
sage: CoxeterMatrix([[1,p,r],[p,1,q],[r,q,1]])
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-129-eadfa2d4542d> in <module>()
----> 1 p=Integer(2);q=Integer(2);r=Integer(5);CoxeterMatrix([[Integer(1),p,r],[p,Integer(1),q],[r,q,Integer(1)]])

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in __classcall_private__(cls, data, index_set, coxeter_type, cartan_type, coxeter_type_check)
    208                 raise ValueError("the given index set is not valid")
    209 
--> 210         return cls._from_matrix(data, coxeter_type, index_set, coxeter_type_check)
    211 
    212     def __init__(self, parent, data, coxeter_type, index_set):

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in _from_matrix(cls, data, coxeter_type, index_set, coxeter_type_check)
    292                 coxeter_type = CoxeterType(['A', 1])
    293             elif coxeter_type_check:
--> 294                 coxeter_type = recognize_coxeter_type_from_matrix(M, index_set)
    295             else:
    296                 coxeter_type = None

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in recognize_coxeter_type_from_matrix(coxeter_matrix, index_set)
   1154             return None
   1155 
-> 1156     return CoxeterType(types)
   1157 
   1158 #####################################################################

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_type.pyc in __classcall_private__(cls, *x)
     52 
     53         try:
---> 54             return CoxeterTypeFromCartanType(CartanType(x))
     55         except (ValueError, TypeError):
     56             pass

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.pyc in __call__(self, *args)
    732         from . import type_reducible
    733         try:
--> 734             return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])
    735         except (SyntaxError, ValueError):
    736             raise ValueError("%s is not a valid Cartan type"%t)

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_reducible.pyc in __init__(self, types)
    124         self._index_relabelling = dict((indices[i], i) for i in range(1, len(indices)))
    125 
--> 126         self._spaces = [t.root_system().ambient_space() for t in types]
    127         if all(l is not None for l in self._spaces):
    128             self._shifts = [sum(l.dimension() for l in self._spaces[:k])

/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10785)()
   2012                 return cache[k]
   2013         except KeyError:
-> 2014             w = self._instance_call(*args, **kwds)
   2015             cache[k] = w
   2016             return w
/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:10236)()
   1888             True
   1889         """
-> 1890         return self.f(self._instance, *args, **kwds)
   1891 
   1892     cdef fix_args_kwds(self, tuple args, dict kwds):

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/root_system.pyc in ambient_space(self, base_ring)
    749         if not base_ring.has_coerce_map_from(AmbientSpace.smallest_base_ring(self.cartan_type())):
    750             return None
--> 751         return AmbientSpace(self, base_ring)
    752 
    753     def coambient_space(self, base_ring=QQ):

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6246)()
   1057                 return self.cache[k]
   1058         except KeyError:
-> 1059             w = self.f(*args, **kwds)
   1060             self.cache[k] = w
   1061             return w

/opt/sage/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)
   1019             True
   1020         """
-> 1021         instance = typecall(cls, *args, **options)
   1022         assert isinstance( instance, cls )
   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2040)()
    495             TypeError: Argument 'cls' has incorrect type (expected type, got classobj)
    496     """
--> 497     return (<PyTypeObject*>type).tp_call(cls, args, kwds)
    498 
    499 # Class for timing::

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/ambient_space.pyc in __init__(self, root_system, base_ring, index_set)
     89         self.root_system = root_system
     90         if index_set is None:
---> 91             index_set = tuple(range(0, self.dimension()))
     92         CombinatorialFreeModule.__init__(self, base_ring,
     93                                          index_set,

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_relabel.pyc in dimension(self)
    425         """
    426         # Can't yet use _dual_space for the base ring (and cartan_type?) is not yet initialized
--> 427         return self.root_system.cartan_type()._type.root_system().ambient_space().dimension()
    428 
    429     @cached_method

AttributeError: 'NoneType' object has no attribute 'dimension'
```



---

Comment by tscrim created at 2018-03-02 22:24:33

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-03-02 22:24:33

Okay, I found the underlying issue and hacked around it. The proper fix can be a followup. See the ticket description.

Also, you can do a little better for the ticket title. :P
----
New commits:


---

Comment by tscrim created at 2018-03-02 22:25:17

I also fixed some issues with the outputs of relabeled types H and I that were related and useful in my debugging.


---

Comment by chapoton created at 2018-03-03 08:26:09

positive review if patchbot turns green


---

Comment by chapoton created at 2018-03-03 10:57:52

some failing doctests


---

Comment by chapoton created at 2018-03-03 10:57:52

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-03-03 21:50:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-03-03 21:51:50

I added a short-circuiting exemption for super Cartan types (for which there is not really a notion of crystallographic AFAIK, which is why there is no such method for them).


---

Comment by tscrim created at 2018-03-03 21:51:50

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-03-08 09:10:47

ping


---

Comment by tscrim created at 2018-03-11 03:39:18

**ping**


---

Comment by chapoton created at 2018-03-11 07:28:38

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-03-11 07:28:38

ok


---

Comment by tscrim created at 2018-03-11 07:41:55

Thank you.


---

Comment by vbraun created at 2018-03-19 07:57:46

Resolution: fixed
