# Issue 24655: triangle (2,2,5)

archive/issues_024655.json:
```json
{
    "body": "CC:  @jplab @tscrim\n\nKeywords: days93\n\nThe triangle group (2,2,5) is reducible but the error below is very much obscure\n\n```\nsage: p=2; q=2; r=5\nsage: CoxeterMatrix([[1,p,r],[p,1,q],[r,q,1]])\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-129-eadfa2d4542d> in <module>()\n----> 1 p=Integer(2);q=Integer(2);r=Integer(5);CoxeterMatrix([[Integer(1),p,r],[p,Integer(1),q],[r,q,Integer(1)]])\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()\n    328         \"\"\"\n    329         if cls.classcall is not None:\n--> 330             return cls.classcall(cls, *args, **kwds)\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in __classcall_private__(cls, data, index_set, coxeter_type, cartan_type, coxeter_type_check)\n    208                 raise ValueError(\"the given index set is not valid\")\n    209 \n--> 210         return cls._from_matrix(data, coxeter_type, index_set, coxeter_type_check)\n    211 \n    212     def __init__(self, parent, data, coxeter_type, index_set):\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in _from_matrix(cls, data, coxeter_type, index_set, coxeter_type_check)\n    292                 coxeter_type = CoxeterType(['A', 1])\n    293             elif coxeter_type_check:\n--> 294                 coxeter_type = recognize_coxeter_type_from_matrix(M, index_set)\n    295             else:\n    296                 coxeter_type = None\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in recognize_coxeter_type_from_matrix(coxeter_matrix, index_set)\n   1154             return None\n   1155 \n-> 1156     return CoxeterType(types)\n   1157 \n   1158 #####################################################################\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()\n    328         \"\"\"\n    329         if cls.classcall is not None:\n--> 330             return cls.classcall(cls, *args, **kwds)\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_type.pyc in __classcall_private__(cls, *x)\n     52 \n     53         try:\n---> 54             return CoxeterTypeFromCartanType(CartanType(x))\n     55         except (ValueError, TypeError):\n     56             pass\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.pyc in __call__(self, *args)\n    732         from . import type_reducible\n    733         try:\n--> 734             return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])\n    735         except (SyntaxError, ValueError):\n    736             raise ValueError(\"%s is not a valid Cartan type\"%t)\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_reducible.pyc in __init__(self, types)\n    124         self._index_relabelling = dict((indices[i], i) for i in range(1, len(indices)))\n    125 \n--> 126         self._spaces = [t.root_system().ambient_space() for t in types]\n    127         if all(l is not None for l in self._spaces):\n    128             self._shifts = [sum(l.dimension() for l in self._spaces[:k])\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10785)()\n   2012                 return cache[k]\n   2013         except KeyError:\n-> 2014             w = self._instance_call(*args, **kwds)\n   2015             cache[k] = w\n   2016             return w\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:10236)()\n   1888             True\n   1889         \"\"\"\n-> 1890         return self.f(self._instance, *args, **kwds)\n   1891 \n   1892     cdef fix_args_kwds(self, tuple args, dict kwds):\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/root_system.pyc in ambient_space(self, base_ring)\n    749         if not base_ring.has_coerce_map_from(AmbientSpace.smallest_base_ring(self.cartan_type())):\n    750             return None\n--> 751         return AmbientSpace(self, base_ring)\n    752 \n    753     def coambient_space(self, base_ring=QQ):\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()\n    328         \"\"\"\n    329         if cls.classcall is not None:\n--> 330             return cls.classcall(cls, *args, **kwds)\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6246)()\n   1057                 return self.cache[k]\n   1058         except KeyError:\n-> 1059             w = self.f(*args, **kwds)\n   1060             self.cache[k] = w\n   1061             return w\n\n/opt/sage/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)\n   1019             True\n   1020         \"\"\"\n-> 1021         instance = typecall(cls, *args, **options)\n   1022         assert isinstance( instance, cls )\n   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2040)()\n    495             TypeError: Argument 'cls' has incorrect type (expected type, got classobj)\n    496     \"\"\"\n--> 497     return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n    498 \n    499 # Class for timing::\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/ambient_space.pyc in __init__(self, root_system, base_ring, index_set)\n     89         self.root_system = root_system\n     90         if index_set is None:\n---> 91             index_set = tuple(range(0, self.dimension()))\n     92         CombinatorialFreeModule.__init__(self, base_ring,\n     93                                          index_set,\n\n/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_relabel.pyc in dimension(self)\n    425         \"\"\"\n    426         # Can't yet use _dual_space for the base ring (and cartan_type?) is not yet initialized\n--> 427         return self.root_system.cartan_type()._type.root_system().ambient_space().dimension()\n    428 \n    429     @cached_method\n\nAttributeError: 'NoneType' object has no attribute 'dimension'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24892\n\n",
    "created_at": "2018-03-02T16:24:08Z",
    "labels": [
        "geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "triangle (2,2,5)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24655",
    "user": "@videlec"
}
```
CC:  @jplab @tscrim

Keywords: days93

The triangle group (2,2,5) is reducible but the error below is very much obscure

```
sage: p=2; q=2; r=5
sage: CoxeterMatrix([[1,p,r],[p,1,q],[r,q,1]])
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-129-eadfa2d4542d> in <module>()
----> 1 p=Integer(2);q=Integer(2);r=Integer(5);CoxeterMatrix([[Integer(1),p,r],[p,Integer(1),q],[r,q,Integer(1)]])

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in __classcall_private__(cls, data, index_set, coxeter_type, cartan_type, coxeter_type_check)
    208                 raise ValueError("the given index set is not valid")
    209 
--> 210         return cls._from_matrix(data, coxeter_type, index_set, coxeter_type_check)
    211 
    212     def __init__(self, parent, data, coxeter_type, index_set):

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in _from_matrix(cls, data, coxeter_type, index_set, coxeter_type_check)
    292                 coxeter_type = CoxeterType(['A', 1])
    293             elif coxeter_type_check:
--> 294                 coxeter_type = recognize_coxeter_type_from_matrix(M, index_set)
    295             else:
    296                 coxeter_type = None

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_matrix.pyc in recognize_coxeter_type_from_matrix(coxeter_matrix, index_set)
   1154             return None
   1155 
-> 1156     return CoxeterType(types)
   1157 
   1158 #####################################################################

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_type.pyc in __classcall_private__(cls, *x)
     52 
     53         try:
---> 54             return CoxeterTypeFromCartanType(CartanType(x))
     55         except (ValueError, TypeError):
     56             pass

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.pyc in __call__(self, *args)
    732         from . import type_reducible
    733         try:
--> 734             return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])
    735         except (SyntaxError, ValueError):
    736             raise ValueError("%s is not a valid Cartan type"%t)

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_reducible.pyc in __init__(self, types)
    124         self._index_relabelling = dict((indices[i], i) for i in range(1, len(indices)))
    125 
--> 126         self._spaces = [t.root_system().ambient_space() for t in types]
    127         if all(l is not None for l in self._spaces):
    128             self._shifts = [sum(l.dimension() for l in self._spaces[:k])

/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10785)()
   2012                 return cache[k]
   2013         except KeyError:
-> 2014             w = self._instance_call(*args, **kwds)
   2015             cache[k] = w
   2016             return w
/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:10236)()
   1888             True
   1889         """
-> 1890         return self.f(self._instance, *args, **kwds)
   1891 
   1892     cdef fix_args_kwds(self, tuple args, dict kwds):

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/root_system.pyc in ambient_space(self, base_ring)
    749         if not base_ring.has_coerce_map_from(AmbientSpace.smallest_base_ring(self.cartan_type())):
    750             return None
--> 751         return AmbientSpace(self, base_ring)
    752 
    753     def coambient_space(self, base_ring=QQ):

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6246)()
   1057                 return self.cache[k]
   1058         except KeyError:
-> 1059             w = self.f(*args, **kwds)
   1060             self.cache[k] = w
   1061             return w

/opt/sage/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)
   1019             True
   1020         """
-> 1021         instance = typecall(cls, *args, **options)
   1022         assert isinstance( instance, cls )
   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:

/opt/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2040)()
    495             TypeError: Argument 'cls' has incorrect type (expected type, got classobj)
    496     """
--> 497     return (<PyTypeObject*>type).tp_call(cls, args, kwds)
    498 
    499 # Class for timing::

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/ambient_space.pyc in __init__(self, root_system, base_ring, index_set)
     89         self.root_system = root_system
     90         if index_set is None:
---> 91             index_set = tuple(range(0, self.dimension()))
     92         CombinatorialFreeModule.__init__(self, base_ring,
     93                                          index_set,

/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_relabel.pyc in dimension(self)
    425         """
    426         # Can't yet use _dual_space for the base ring (and cartan_type?) is not yet initialized
--> 427         return self.root_system.cartan_type()._type.root_system().ambient_space().dimension()
    428 
    429     @cached_method

AttributeError: 'NoneType' object has no attribute 'dimension'
```


Issue created by migration from https://trac.sagemath.org/ticket/24892





---

archive/issue_comments_345785.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-02T22:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345785",
    "user": "@tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_345786.json:
```json
{
    "body": "Okay, I found the underlying issue and hacked around it. The proper fix can be a followup. See the ticket description.\n\nAlso, you can do a little better for the ticket title. :P\n----\nNew commits:",
    "created_at": "2018-03-02T22:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345786",
    "user": "@tscrim"
}
```

Okay, I found the underlying issue and hacked around it. The proper fix can be a followup. See the ticket description.

Also, you can do a little better for the ticket title. :P
----
New commits:



---

archive/issue_comments_345787.json:
```json
{
    "body": "I also fixed some issues with the outputs of relabeled types H and I that were related and useful in my debugging.",
    "created_at": "2018-03-02T22:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345787",
    "user": "@tscrim"
}
```

I also fixed some issues with the outputs of relabeled types H and I that were related and useful in my debugging.



---

archive/issue_comments_345788.json:
```json
{
    "body": "positive review if patchbot turns green",
    "created_at": "2018-03-03T08:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345788",
    "user": "@fchapoton"
}
```

positive review if patchbot turns green



---

archive/issue_comments_345789.json:
```json
{
    "body": "some failing doctests",
    "created_at": "2018-03-03T10:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345789",
    "user": "@fchapoton"
}
```

some failing doctests



---

archive/issue_comments_345790.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-03T10:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345790",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_345791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-03T21:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_345792.json:
```json
{
    "body": "I added a short-circuiting exemption for super Cartan types (for which there is not really a notion of crystallographic AFAIK, which is why there is no such method for them).",
    "created_at": "2018-03-03T21:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345792",
    "user": "@tscrim"
}
```

I added a short-circuiting exemption for super Cartan types (for which there is not really a notion of crystallographic AFAIK, which is why there is no such method for them).



---

archive/issue_comments_345793.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-03T21:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345793",
    "user": "@tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_345794.json:
```json
{
    "body": "ping",
    "created_at": "2018-03-08T09:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345794",
    "user": "@tscrim"
}
```

ping



---

archive/issue_comments_345795.json:
```json
{
    "body": "**ping**",
    "created_at": "2018-03-11T03:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345795",
    "user": "@tscrim"
}
```

**ping**



---

archive/issue_comments_345796.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-11T07:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345796",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_345797.json:
```json
{
    "body": "ok",
    "created_at": "2018-03-11T07:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345797",
    "user": "@fchapoton"
}
```

ok



---

archive/issue_comments_345798.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-03-11T07:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345798",
    "user": "@tscrim"
}
```

Thank you.



---

archive/issue_comments_345799.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-19T07:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24655#issuecomment-345799",
    "user": "@vbraun"
}
```

Resolution: fixed
