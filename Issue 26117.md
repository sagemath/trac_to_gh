# Issue 26117: Pickling morphisms is broken

Issue created by migration from Trac.

Original creator: caruso

Original creation time: 2018-09-27 13:25:48

Here is an exemple:


```
sage: R.<x,y> = QQ[]
sage: theta = R.hom([y,x])
sage: hash(theta)
-1982612945128833994
sage: hash(loads(dumps(theta)))
Traceback (most recent call last):
...
ValueError: mutable sequences are unhashable
```



---

Comment by roed created at 2018-09-27 21:27:44

New commits:


---

Comment by roed created at 2018-09-27 21:27:44

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-09-27 21:49:04

This is definitely a fix, but is it the correct fix? The `PolynomialSequence` does not seem to pickle immutability like I think it should:

```
sage: theta.__reduce__()[1][3]['__im_gens']
[y, x]
sage: S = theta.__reduce__()[1][3]['__im_gens']
sage: type(S)
<class 'sage.rings.polynomial.multi_polynomial_sequence.PolynomialSequence_generic'>
sage: S.is_immutable()
True
sage: loads(dumps(S)).is_immutable()
False
```

Contrast:

```
sage: S.__reduce__()
(<function PolynomialSequence at 0x7f62c7ef2c80>,
 (Multivariate Polynomial Ring in x, y over Rational Field, ((y, x),)))
sage: Sequence([1,2,3,4]).__reduce__()
(<function _reconstructor at 0x7f64198a5aa0>,
 (<class 'sage.structure.sequence.Sequence_generic'>,
  <type 'sage.structure.sage_object.SageObject'>,
  <sage.structure.sage_object.SageObject object at 0x7f62b02dc0b0>),
 {'_Sequence_generic__cr': False,
  '_Sequence_generic__cr_str': False,
  '_Sequence_generic__hash': None,
  '_Sequence_generic__universe': Integer Ring,
  '_is_immutable': False})
```

What are your thoughts about instead adjusting the pickling of `PolynomialSequence`?


---

Comment by caruso created at 2018-10-01 08:39:01

I agree with you, Travis.

I pushed a fix for the pickling of `PolynomialSequence`. I'm not sure I've done it correctly (in particular, this class redefines `__getattr__`, I don't know why); please review :-)
----
New commits:


---

Comment by git created at 2018-10-01 08:43:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-01 10:18:21

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-10-01 10:18:21

Yep, LGTM. Thanks.


---

Comment by vbraun created at 2018-10-03 21:56:39

Resolution: fixed
