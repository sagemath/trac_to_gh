# Issue 19441: Linking of Pynac to GMP

archive/issues_019441.json:
```json
{
    "body": "Assignee: @tscrim\n\nCC:  gouezel jpflori @rwst\n\nKeywords: pynac, linking\n\nWhen building on Cygwin32, I get the following error:\n\n```\n.libs/libpynac_la-numeric.o: In function `ZN5GiNaC7numericD2Ev':\n/home/Travis/sage/local/var/tmp/sage/build/pynac-0.5.2/src/ginac/numeric.cpp:621:\n undefined reference to `_imp____gmpq_clear'\n```\n\nThis indicated to me there is a linking issue with Pynac to GMP. Full log is [here](http://trac.sagemath.org/attachment/ticket/19663/pynac-0.5.2.log) on #19663.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19678\n\n",
    "created_at": "2015-12-07T19:08:50Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Linking of Pynac to GMP",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19441",
    "user": "https://github.com/tscrim"
}
```
Assignee: @tscrim

CC:  gouezel jpflori @rwst

Keywords: pynac, linking

When building on Cygwin32, I get the following error:

```
.libs/libpynac_la-numeric.o: In function `ZN5GiNaC7numericD2Ev':
/home/Travis/sage/local/var/tmp/sage/build/pynac-0.5.2/src/ginac/numeric.cpp:621:
 undefined reference to `_imp____gmpq_clear'
```

This indicated to me there is a linking issue with Pynac to GMP. Full log is [here](http://trac.sagemath.org/attachment/ticket/19663/pynac-0.5.2.log) on #19663.

Issue created by migration from https://trac.sagemath.org/ticket/19678





---

archive/issue_comments_266999.json:
```json
{
    "body": "Note that this is unrelated to the change in #19606 (merged before #19312, which reverted it).",
    "created_at": "2015-12-13T13:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-266999",
    "user": "https://github.com/nexttime"
}
```

Note that this is unrelated to the change in #19606 (merged before #19312, which reverted it).



---

archive/issue_comments_267000.json:
```json
{
    "body": "I was trying to build on Cygwin with 6.10.beta7, which contains both #19606 and #19312.",
    "created_at": "2015-12-13T15:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267000",
    "user": "https://github.com/tscrim"
}
```

I was trying to build on Cygwin with 6.10.beta7, which contains both #19606 and #19312.



---

archive/issue_comments_267001.json:
```json
{
    "body": "The `.pc` file also lacks `-lgmp`.",
    "created_at": "2015-12-13T15:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267001",
    "user": "https://github.com/nexttime"
}
```

The `.pc` file also lacks `-lgmp`.



---

archive/issue_comments_267002.json:
```json
{
    "body": "Changing keywords from \"pynac, linking\" to \"pynac, underlinking\".",
    "created_at": "2015-12-13T15:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267002",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "pynac, linking" to "pynac, underlinking".



---

archive/issue_comments_267003.json:
```json
{
    "body": "FWIW, Pynac's `configure` doesn't check for libgmp, just for its header.\n\nIn GiNaC's Makefile we still have\n\n```make\n#The -no-undefined breaks Pynac on OS X 10.4.  See #9135\nif CYGWIN\nlibpynac_la_LDFLAGS = -version-info $(LT_VERSION_INFO) -no-undefined\nelse\nlibpynac_la_LDFLAGS = -version-info $(LT_VERSION_INFO)\nendif\n```\n\n\nthough, so it must fail on Cygwin (unless we link to libgmp there).\n\n\n\n\nThe libtool versioning (0.0.0) IMHO doesn't make sense either.",
    "created_at": "2015-12-13T15:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267003",
    "user": "https://github.com/nexttime"
}
```

FWIW, Pynac's `configure` doesn't check for libgmp, just for its header.

In GiNaC's Makefile we still have

```make
#The -no-undefined breaks Pynac on OS X 10.4.  See #9135
if CYGWIN
libpynac_la_LDFLAGS = -version-info $(LT_VERSION_INFO) -no-undefined
else
libpynac_la_LDFLAGS = -version-info $(LT_VERSION_INFO)
endif
```


though, so it must fail on Cygwin (unless we link to libgmp there).




The libtool versioning (0.0.0) IMHO doesn't make sense either.



---

archive/issue_comments_267004.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-13T19:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267004",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_267005.json:
```json
{
    "body": "Added linking to gmp on Cygwin in the makefile. With this, compilation on cygwin works properly.\n----\nNew commits:",
    "created_at": "2015-12-13T19:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267005",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

Added linking to gmp on Cygwin in the makefile. With this, compilation on cygwin works properly.
----
New commits:



---

archive/issue_comments_267006.json:
```json
{
    "body": "Hmmm, do we want to link with GMP on Cygwin only?\n\nIt would have been sufficient to add `-lgmp` to `LIBS` in `configure`[`.ac`], either manually or by calling`AC_CHECK_LIB()` (but upstream should decide; not sure why they don't do this already).",
    "created_at": "2015-12-13T19:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267006",
    "user": "https://github.com/nexttime"
}
```

Hmmm, do we want to link with GMP on Cygwin only?

It would have been sufficient to add `-lgmp` to `LIBS` in `configure`[`.ac`], either manually or by calling`AC_CHECK_LIB()` (but upstream should decide; not sure why they don't do this already).



---

archive/issue_comments_267007.json:
```json
{
    "body": "I agree it is probably safe to link everywhere to GMP. I was scared by the comment `The -no-undefined breaks Pynac on OS X 10.4.  See #9135`, since it is also usually safe to add `no-undefined` everywhere. As I have no OS X to test, I opted for the safest solution. Anyway, I agree upstream should decide.",
    "created_at": "2015-12-13T20:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267007",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

I agree it is probably safe to link everywhere to GMP. I was scared by the comment `The -no-undefined breaks Pynac on OS X 10.4.  See #9135`, since it is also usually safe to add `no-undefined` everywhere. As I have no OS X to test, I opted for the safest solution. Anyway, I agree upstream should decide.



---

archive/issue_comments_267008.json:
```json
{
    "body": "It's an oversight. I have opened https://github.com/pynac/pynac/issues/102. Thanks for the suggestions.",
    "created_at": "2015-12-14T07:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267008",
    "user": "https://github.com/rwst"
}
```

It's an oversight. I have opened https://github.com/pynac/pynac/issues/102. Thanks for the suggestions.



---

archive/issue_comments_267009.json:
```json
{
    "body": "Replying to [comment:9 rws]:\n> It's an oversight. I have opened https://github.com/pynac/pynac/issues/102. Thanks for the suggestions.\n\nShould we wait for an upstream patch or merge as is?",
    "created_at": "2015-12-14T07:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267009",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:9 rws]:
> It's an oversight. I have opened https://github.com/pynac/pynac/issues/102. Thanks for the suggestions.

Should we wait for an upstream patch or merge as is?



---

archive/issue_comments_267010.json:
```json
{
    "body": "Please don't wait. I'm in minimum maintenance mode (accept patches, do urgent releases).",
    "created_at": "2015-12-14T07:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267010",
    "user": "https://github.com/rwst"
}
```

Please don't wait. I'm in minimum maintenance mode (accept patches, do urgent releases).



---

archive/issue_comments_267011.json:
```json
{
    "body": "I'd prefer to not just add it on Cygwin; on the other hand, the component is still (just) \"Porting: Cygwin\", and the current patch doesn't affect other systems (so doesn't need further testing on MacOS X, say).\n\nThoughts (by others than Ralph)?",
    "created_at": "2015-12-14T07:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267011",
    "user": "https://github.com/nexttime"
}
```

I'd prefer to not just add it on Cygwin; on the other hand, the component is still (just) "Porting: Cygwin", and the current patch doesn't affect other systems (so doesn't need further testing on MacOS X, say).

Thoughts (by others than Ralph)?



---

archive/issue_comments_267012.json:
```json
{
    "body": "Replying to [comment:12 leif]:\n> the component is still (just) \"Porting: Cygwin\"\n\nFixed :-)",
    "created_at": "2015-12-14T09:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267012",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 leif]:
> the component is still (just) "Porting: Cygwin"

Fixed :-)



---

archive/issue_comments_267013.json:
```json
{
    "body": "Changing component from porting: Cygwin to packages: standard.",
    "created_at": "2015-12-14T09:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267013",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from porting: Cygwin to packages: standard.



---

archive/issue_comments_267014.json:
```json
{
    "body": "New branch linking to gmp on all platforms, adding the proper test in configure.\n\nThe patch itself is one line\n\n```\nAC_CHECK_LIB(gmp, __gmpz_init, , AC_MSG_ERROR([This package needs libgmp]))\n```\n\nin `configure.ac` (this is the patch in `patches/build/`). The patch generated by autotools, however, is much bigger since my versions of the tools do not match with the versions previously used by pynac (my versions are more recent, so it should be for the better).\n----\nNew commits:",
    "created_at": "2015-12-18T08:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267014",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

New branch linking to gmp on all platforms, adding the proper test in configure.

The patch itself is one line

```
AC_CHECK_LIB(gmp, __gmpz_init, , AC_MSG_ERROR([This package needs libgmp]))
```

in `configure.ac` (this is the patch in `patches/build/`). The patch generated by autotools, however, is much bigger since my versions of the tools do not match with the versions previously used by pynac (my versions are more recent, so it should be for the better).
----
New commits:



---

archive/issue_comments_267015.json:
```json
{
    "body": "The change to `configure.ac` looks sensible.\n\nIs upstream (`@`rws) willing to make a new release for this? Then we don't need the patching.",
    "created_at": "2015-12-18T09:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267015",
    "user": "https://github.com/jdemeyer"
}
```

The change to `configure.ac` looks sensible.

Is upstream (`@`rws) willing to make a new release for this? Then we don't need the patching.



---

archive/issue_comments_267016.json:
```json
{
    "body": "Replying to [comment:15 gouezel]:\n> New branch linking to gmp on all platforms, adding the proper test in configure.\n\nThanks.  If I had the time, I would have done the same in a pull request...\n\n`@`jdemeyer:  Simply set upstream to \"Fixed upstream, but not in a stable release\". ;-)",
    "created_at": "2015-12-18T09:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267016",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 gouezel]:
> New branch linking to gmp on all platforms, adding the proper test in configure.

Thanks.  If I had the time, I would have done the same in a pull request...

`@`jdemeyer:  Simply set upstream to "Fixed upstream, but not in a stable release". ;-)



---

archive/issue_comments_267017.json:
```json
{
    "body": "P.S.:  Of course a patch using the same autotools versions is preferable.",
    "created_at": "2015-12-18T09:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267017",
    "user": "https://github.com/nexttime"
}
```

P.S.:  Of course a patch using the same autotools versions is preferable.



---

archive/issue_comments_267018.json:
```json
{
    "body": "I already submitted a PR upstream (two actually, the `.pc` was also sick) and they have been merged. Not sure when Ralph will want to do a release.",
    "created_at": "2015-12-18T09:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267018",
    "user": "https://github.com/kiwifb"
}
```

I already submitted a PR upstream (two actually, the `.pc` was also sick) and they have been merged. Not sure when Ralph will want to do a release.



---

archive/issue_comments_267019.json:
```json
{
    "body": "The search lib command is already merged. I'll add the `config.h.in` patch. Maybe I'll do a release at the weekend. Note that I do not have a means for testing it but you seem to have had success with these patches.",
    "created_at": "2015-12-18T13:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267019",
    "user": "https://github.com/rwst"
}
```

The search lib command is already merged. I'll add the `config.h.in` patch. Maybe I'll do a release at the weekend. Note that I do not have a means for testing it but you seem to have had success with these patches.



---

archive/issue_comments_267020.json:
```json
{
    "body": "Ah that gets generated, so I can do the release today, as well.",
    "created_at": "2015-12-18T13:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267020",
    "user": "https://github.com/rwst"
}
```

Ah that gets generated, so I can do the release today, as well.



---

archive/issue_comments_267021.json:
```json
{
    "body": "Please test #19744 on Cygwin.",
    "created_at": "2015-12-18T14:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267021",
    "user": "https://github.com/rwst"
}
```

Please test #19744 on Cygwin.



---

archive/issue_comments_267022.json:
```json
{
    "body": "This has been superseded by #19744, correct?",
    "created_at": "2015-12-18T15:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267022",
    "user": "https://github.com/tscrim"
}
```

This has been superseded by #19744, correct?



---

archive/issue_events_054027.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-12-18T15:03:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19441#event-54027"
}
```



---

archive/issue_comments_267023.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> This has been superseded by #19744, correct?\nYes, thanks.",
    "created_at": "2015-12-18T15:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267023",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:23 tscrim]:
> This has been superseded by #19744, correct?
Yes, thanks.



---

archive/issue_comments_267024.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-18T15:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267024",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_267025.json:
```json
{
    "body": "Replying to [comment:20 rws]:\n> The search lib command is already merged. I'll add the `config.h.in` patch. Maybe I'll do a release at the weekend. Note that I do not have a means for testing it but you seem to have had success with these patches.\nThat was not really useful but it doesn't hurt and is consistent with common practise I guess.",
    "created_at": "2015-12-18T18:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267025",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:20 rws]:
> The search lib command is already merged. I'll add the `config.h.in` patch. Maybe I'll do a release at the weekend. Note that I do not have a means for testing it but you seem to have had success with these patches.
That was not really useful but it doesn't hurt and is consistent with common practise I guess.



---

archive/issue_events_054028.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-19T09:37:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19441#event-54028"
}
```



---

archive/issue_comments_267026.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-19T09:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19441#issuecomment-267026",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
