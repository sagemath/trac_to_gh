# Issue 25893: fflas_ffpack is not tested, tests fail

Issue created by migration from https://trac.sagemath.org/ticket/26130

Original creator: @timokau

Original creation time: 2018-08-25 19:39:44

CC:  vdelecroix cpernet dimpase arojas mkoeppe

While trying to port the nix build (and its dependencies) to darwin, `@`jbaum98 [discovered](https://github.com/linbox-team/fflas-ffpack/issues/173) that the fflas-ffpack tests are failing on darwin when using openblas. They don't fail on linux using openblas and they don't fail on darwin using another blas.

Trying to figure out if that is a nix issue or a fflas-ffpack / openblas issue, I compared our build with the sage spkg. I noticed that sage is not even running the fflas_ffpack tests. So maybe some issues with darwin have gone unnoticed.

I even get one test failure on linux:


```
FAIL: test-fgemm-check
======================

Checking ............................Modular<double> mod 67 ... PASSED with seed = 1535225205942725
Checking ........................Modular<double> mod 351293 ... PASSED with seed = 1535225205942726
Checking .........................Modular<double> mod 17659 ... PASSED with seed = 1535225205942727
Checking ....................ModularBalanced<double> mod 67 ... PASSED with seed = 1535225205942725
Checking ................ModularBalanced<double> mod 351293 ... PASSED with seed = 1535225205942726
Checking .................ModularBalanced<double> mod 17659 ... PASSED with seed = 1535225205942727
Checking .............................Modular<float> mod 13 ... FAILED
FAILED with seed = 1535225205942725
FAIL test-fgemm-check (exit status: 1)
```



---

Comment by @timokau created at 2018-08-25 19:42:04

Changing type from PLEASE CHANGE to defect.


---

Comment by @timokau created at 2018-08-25 19:42:04

New commits:


---

Comment by @timokau created at 2018-08-25 19:42:04

Changing keywords from "" to "darwin".


---

Comment by @timokau created at 2018-08-25 19:42:04

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by git created at 2018-08-25 21:31:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @timokau created at 2018-10-27 13:11:14

Changing status from new to needs_review.


---

Comment by @timokau created at 2018-10-27 13:11:14

Setting to needs_review since someone with acess to a darwin machine needs to test this.


---

Comment by vklein created at 2018-11-09 14:01:57

On Darwin i get a fail with openblas too


```
$ sage -f -c fflas_ffpack
...
[fflas_ffpack-2.3.2] PASS: test-ftrmm
[fflas_ffpack-2.3.2] FAIL: test-fgemm-check
[fflas_ffpack-2.3.2] PASS: test-permutations
...
```


It look like it's a fflas-ffpack / openblas issue.



```
# file test-fgemm-check.log
Checking ..........................Modular<double> mod 1693 ... PASSED with seed = 1541770760090127
Checking .........................Modular<double> mod 12421 ... PASSED with seed = 1541770760090128
Checking ...........................Modular<double> mod 139 ... PASSED with seed = 1541770760090129
Checking ..................ModularBalanced<double> mod 1693 ... PASSED with seed = 1541770760090127
Checking .................ModularBalanced<double> mod 12421 ... PASSED with seed = 1541770760090128
Checking ...................ModularBalanced<double> mod 139 ... PASSED with seed = 1541770760090129
Checking ...........................Modular<float> mod 1693 ... PASSED with seed = 1541770760090127
Checking .............................Modular<float> mod 47 ... FAILED
FAILED with seed = 1541770760090128
FAIL test-fgemm-check (exit status: 1)
```



---

Comment by @timokau created at 2018-11-09 19:43:55

It'd be great if you can help upstream find the cause of it in https://github.com/linbox-team/fflas-ffpack/issues/173 :)

`@`jbaum98 had more test failures there, but this is one of them and he isn't responding. Maybe they have a common cause.


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-01-30 03:05:32

Tested at https://github.com/mkoeppe/sage/actions/runs/32812271 on top of 9.1.beta2


---

Comment by mkoeppe created at 2020-01-30 03:05:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-01-31 23:49:56

Resolution: fixed
