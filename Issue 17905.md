# Issue 17905: Numpy: install includes in $SAGE_LOCAL/include

Issue created by migration from https://trac.sagemath.org/ticket/18142

Original creator: jdemeyer

Original creation time: 2015-04-08 08:55:29

To make the logic in `src/setup.py` easier, we should just symlink the numpy includes (which are in `local/lib/python/site-packages/numpy/core/include/numpy` to `local/include/numpy`.


---

Comment by fbissey created at 2015-04-08 10:03:00

It always felt strange that there isn't a way to get to the numpy include location from numpy itself. Is it just because we are ignorant? If not it seems to be a case of something missing to me.

Of course with sage you can afford the short-cut to `local/include` I cannot when I can numpy installed for various versions of python. I'd like to see if numpy provides a mechanism first.


---

Comment by fbissey created at 2015-04-08 10:06:40

http://stackoverflow.com/questions/2379898/make-distutils-look-for-numpy-header-files-in-the-correct-place

`numpy.get_include()` is what we are after.


---

Comment by jdemeyer created at 2015-04-08 10:21:51

Replying to [comment:3 fbissey]:
> Of course with sage you can afford the short-cut to `local/include` I cannot when I can numpy installed for various versions of python. I'd like to see if numpy provides a mechanism first.

FranÃ§ois, I don't quite understand what you're trying to say. Are you saying that it's a bad idea to symlink numpy's headers in `$SAGE_LOCAL/include/numpy`?


---

Comment by fbissey created at 2015-04-08 10:30:19

Well for sage alone you don't really care. But from my sage-on-distro point of view I can have numpy for python 2.7.9 and python 3.4.3 installed. And I will have to choose which one to link under `/usr/include`. But I think the annoyance we have in setup.py (and currently module_list.py), is because we never bothered to look if numpy itself could just tell us where its headers are. And as a matter of fact it can.


---

Comment by jdemeyer created at 2015-04-08 11:25:47

Replying to [comment:6 fbissey]:
> Well for sage alone you don't really care. But from my sage-on-distro point of view I can have numpy for python 2.7.9 and python 3.4.3 installed.
Does the Python version even matter for the C includes of `numpy`?


---

Comment by jdemeyer created at 2015-04-08 11:32:58

If you prefer `numpy.get_include()`, that could be arranged. But I still find it strange that every single package installs its includes in `$SAGE_LOCAL/includes` _except_ for numpy.


---

Comment by fbissey created at 2015-04-08 12:04:08

Replying to [comment:8 jdemeyer]:
> If you prefer `numpy.get_include()`, that could be arranged. But I still find it strange that every single package installs its includes in `$SAGE_LOCAL/includes` _except_ for numpy.

The only python packages that I know have headers and install under `include` are
 * python itself under python$version
 * pynac (python 2.7 only)
 * polybori (python 2.7 only)

Apart from numpy and cython I cannot think of any other python packages that install headers and those two definitely don't do it under `$prefix/include`. Because some of the headers in these can depend on the version of python I don't think it will happen anytime soon.


---

Comment by jdemeyer created at 2015-04-08 12:28:56

New commits:


---

Comment by jdemeyer created at 2015-04-08 12:28:56

Changing status from new to needs_review.


---

Comment by fbissey created at 2015-04-08 12:43:25

After inspection of my system I got one header that is shared between version of python under `/usr/include`: `pygobject/pygobject.h`. There is only one switch inside that depends on the version of python used if I read the thing correctly. So it can be done.

Anyway the patch looks very good to me and it get the right head counts of `numpy_depends` (26) in `module_list.py`. 

The only thing you forgot is that bit of code in `sage/misc/cython.py`

```
include_dirs = [os.path.join(SAGE_LOCAL,'include','csage'),
                os.path.join(SAGE_LOCAL,'include'), \
                os.path.join(SAGE_LOCAL,'include','python'+platform.python_version().rsplit('.', 1)[0]), \
                os.path.join(SAGE_LOCAL,'lib','python','site-packages','numpy','core','include'), \
                os.path.join(SAGE_SRC,'sage','ext'), \
                os.path.join(SAGE_SRC), \
                os.path.join(SAGE_SRC,'sage','gsl')]
```



---

Comment by jdemeyer created at 2015-04-08 13:29:26

Replying to [comment:13 fbissey]:
> The only thing you forgot is that bit of code in `sage/misc/cython.py`

Please no! That's outside the scope of this ticket. Fixing the big mess which is `sage/misc/cython.py` is for later.


---

Comment by fbissey created at 2015-04-08 13:40:54

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-04-08 13:40:54

Fair enough cython.py deserve its own ticket.


---

Comment by jdemeyer created at 2015-04-08 13:52:11

Replying to [comment:16 fbissey]:
> Fair enough cython.py deserve its own ticket.

But later. There are way too many Cython-related tickets that it's becoming hard to do anything which doesn't conflict with another ticket.


---

Comment by vbraun created at 2015-04-14 19:43:10

Resolution: fixed
