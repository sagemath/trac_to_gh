# Issue 24698: Upgrade to Sphinx 1.7.1

archive/issues_024698.json:
```json
{
    "body": "CC:  @embray @kiwifb @dimpase\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24935\n\n",
    "created_at": "2018-03-09T13:06:24Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Upgrade to Sphinx 1.7.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24698",
    "user": "@jdemeyer"
}
```
CC:  @embray @kiwifb @dimpase



Issue created by migration from https://trac.sagemath.org/ticket/24935





---

archive/issue_comments_346665.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-16T10:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346665",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_346666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-16T10:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-16T11:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346667",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346668.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-16T15:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346668",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_346669.json:
```json
{
    "body": "Can you please give a link to the sphinxcontrib_websupport package, or is it supposed to be installed by other means? An upgrade attempt failed here because the mirrors didn't have it.",
    "created_at": "2018-03-19T14:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346669",
    "user": "@rwst"
}
```

Can you please give a link to the sphinxcontrib_websupport package, or is it supposed to be installed by other means? An upgrade attempt failed here because the mirrors didn't have it.



---

archive/issue_comments_346670.json:
```json
{
    "body": "Replying to [comment:9 rws]:\n> Can you please give a link to the sphinxcontrib_websupport package, or is it supposed to be installed by other means?\n\nIt's linked on the dependency #24972",
    "created_at": "2018-03-19T18:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346670",
    "user": "@jdemeyer"
}
```

Replying to [comment:9 rws]:
> Can you please give a link to the sphinxcontrib_websupport package, or is it supposed to be installed by other means?

It's linked on the dependency #24972



---

archive/issue_comments_346671.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-03-20T07:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346671",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_346672.json:
```json
{
    "body": "\n```\n**********************************************************************\nFile \"src/sage/misc/sphinxify.py\", line 51, in sage.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('**Testing**\\n`monospace`')\nExpected:\n    '...<div class=\"docstring\"...<strong>Testing</strong>\\n<span class=\"math\"...</p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><strong>Testing</strong>\\n<span class=\"math notranslate\">monospace</span></p>\\n\\n\\n</div>'\n**********************************************************************\nFile \"src/sage/misc/sphinxify.py\", line 53, in sage.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('`x=y`')\nExpected:\n    '...<div class=\"docstring\">\\n    \\n  <p><span class=\"math\">x=y</span></p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><span class=\"math notranslate\">x=y</span></p>\\n\\n\\n</div>'\n**********************************************************************\n```\n",
    "created_at": "2018-03-20T07:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346672",
    "user": "@rwst"
}
```


```
**********************************************************************
File "src/sage/misc/sphinxify.py", line 51, in sage.misc.sphinxify.sphinxify
Failed example:
    sphinxify('**Testing**\n`monospace`')
Expected:
    '...<div class="docstring"...<strong>Testing</strong>\n<span class="math"...</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><strong>Testing</strong>\n<span class="math notranslate">monospace</span></p>\n\n\n</div>'
**********************************************************************
File "src/sage/misc/sphinxify.py", line 53, in sage.misc.sphinxify.sphinxify
Failed example:
    sphinxify('`x=y`')
Expected:
    '...<div class="docstring">\n    \n  <p><span class="math">x=y</span></p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><span class="math notranslate">x=y</span></p>\n\n\n</div>'
**********************************************************************
```




---

archive/issue_comments_346673.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2018-03-20T07:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346673",
    "user": "@rwst"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_346674.json:
```json
{
    "body": "I did not consider that Sphinx might affect doctests too.",
    "created_at": "2018-03-20T08:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346674",
    "user": "@jdemeyer"
}
```

I did not consider that Sphinx might affect doctests too.



---

archive/issue_comments_346675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-20T10:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346675",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346676.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-20T12:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346676",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346677.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> I did not consider that Sphinx might affect doctests too.\n\nIt definitely can :)  There are several places in Python 3 where I've had to make sure to ignore some python 3 specific `DeprecationWarning`s from Sphinx at import time or else it broke some tests.  So I'm not too surprised that a Sphinx upgrade might also affect some docbuild-related tests.",
    "created_at": "2018-03-20T12:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346677",
    "user": "@embray"
}
```

Replying to [comment:13 jdemeyer]:
> I did not consider that Sphinx might affect doctests too.

It definitely can :)  There are several places in Python 3 where I've had to make sure to ignore some python 3 specific `DeprecationWarning`s from Sphinx at import time or else it broke some tests.  So I'm not too surprised that a Sphinx upgrade might also affect some docbuild-related tests.



---

archive/issue_comments_346678.json:
```json
{
    "body": "It would be great if patchbot could test \"unsafe\" tickets but I remember about difficulties.",
    "created_at": "2018-03-20T14:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346678",
    "user": "@rwst"
}
```

It would be great if patchbot could test "unsafe" tickets but I remember about difficulties.



---

archive/issue_comments_346679.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-20T14:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346679",
    "user": "@rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346680.json:
```json
{
    "body": "Replying to [comment:17 rws]:\n> It would be great if patchbot could test \"unsafe\" tickets but I remember about difficulties.\n> \n\nI already have a patch for patchbot that will allow it to test tickets with new packages.  It's been running on my Cygwin patchbot for a while now, but it does occasionally run into hiccups requiring me to manually restart the patchbot (after cleaning things up a bit).\n\nI especially am not 100% sure why this happens sometimes, since the patchbot creates a copy of SAGE_LOCAL for \"unsafe\" tickets before doing much else.",
    "created_at": "2018-03-20T15:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346680",
    "user": "@embray"
}
```

Replying to [comment:17 rws]:
> It would be great if patchbot could test "unsafe" tickets but I remember about difficulties.
> 

I already have a patch for patchbot that will allow it to test tickets with new packages.  It's been running on my Cygwin patchbot for a while now, but it does occasionally run into hiccups requiring me to manually restart the patchbot (after cleaning things up a bit).

I especially am not 100% sure why this happens sometimes, since the patchbot creates a copy of SAGE_LOCAL for "unsafe" tickets before doing much else.



---

archive/issue_comments_346681.json:
```json
{
    "body": "Speaking of \"unsafe\" tickets, I'm not convinced that \"unsafe\" tickets are on average less safe than \"safe\" tickets. We certainly have had \"safe\" tickets messing up a patchbot installation.",
    "created_at": "2018-03-20T15:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346681",
    "user": "@jdemeyer"
}
```

Speaking of "unsafe" tickets, I'm not convinced that "unsafe" tickets are on average less safe than "safe" tickets. We certainly have had "safe" tickets messing up a patchbot installation.



---

archive/issue_comments_346682.json:
```json
{
    "body": "Yes, it's a pretty flimsy distinction.",
    "created_at": "2018-03-20T15:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346682",
    "user": "@embray"
}
```

Yes, it's a pretty flimsy distinction.



---

archive/issue_comments_346683.json:
```json
{
    "body": "Replying to [comment:18 embray]:\n> I especially am not 100% sure why this happens sometimes, since the patchbot creates a copy of SAGE_LOCAL for \"unsafe\" tickets before doing much else.\n\nPlease note https://github.com/sagemath/sage-patchbot/issues/34",
    "created_at": "2018-03-20T16:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346683",
    "user": "@rwst"
}
```

Replying to [comment:18 embray]:
> I especially am not 100% sure why this happens sometimes, since the patchbot creates a copy of SAGE_LOCAL for "unsafe" tickets before doing much else.

Please note https://github.com/sagemath/sage-patchbot/issues/34



---

archive/issue_comments_346684.json:
```json
{
    "body": "PDF docs don't build...",
    "created_at": "2018-05-10T07:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346684",
    "user": "@vbraun"
}
```

PDF docs don't build...



---

archive/issue_comments_346685.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-10T07:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346685",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346686.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-15T14:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346686",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-16T13:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346687",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346688.json:
```json
{
    "body": "Replying to [comment:22 vbraun]:\n> PDF docs don't build...\n\nIndeed... unfortunately it's a genuine problem with Sphinx. I reported it at https://github.com/sphinx-doc/sphinx/issues/4978",
    "created_at": "2018-05-16T15:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346688",
    "user": "@jdemeyer"
}
```

Replying to [comment:22 vbraun]:
> PDF docs don't build...

Indeed... unfortunately it's a genuine problem with Sphinx. I reported it at https://github.com/sphinx-doc/sphinx/issues/4978



---

archive/issue_comments_346689.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-04T07:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346689",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346690.json:
```json
{
    "body": "The Sphinx problem with Brazilian is fixed [0] but\nnow there is a Sphinx problem with Russian [1].\n\n- [0] https://github.com/sphinx-doc/sphinx/issues/4978\n- [1] https://github.com/sphinx-doc/sphinx/issues/5037",
    "created_at": "2018-06-04T19:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346690",
    "user": "@slel"
}
```

The Sphinx problem with Brazilian is fixed [0] but
now there is a Sphinx problem with Russian [1].

- [0] https://github.com/sphinx-doc/sphinx/issues/4978
- [1] https://github.com/sphinx-doc/sphinx/issues/5037



---

archive/issue_comments_346691.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-06T15:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346691",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346692.json:
```json
{
    "body": "This took several iterations to get right, but now the PDF docs build for me.",
    "created_at": "2018-06-07T12:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346692",
    "user": "@jdemeyer"
}
```

This took several iterations to get right, but now the PDF docs build for me.



---

archive/issue_comments_346693.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-07T12:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346693",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346694.json:
```json
{
    "body": "Upstream greatly simplified the patch for PR5400 but I'll admit I am unclear if it can be used alone or need some other PR to go with it.",
    "created_at": "2018-06-07T23:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346694",
    "user": "@kiwifb"
}
```

Upstream greatly simplified the patch for PR5400 but I'll admit I am unclear if it can be used alone or need some other PR to go with it.



---

archive/issue_comments_346695.json:
```json
{
    "body": "Are you referring to https://github.com/sphinx-doc/sphinx/pull/5045?\n\nAnyway, the current branch seems to work so I'd rather keep it.",
    "created_at": "2018-06-08T08:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346695",
    "user": "@jdemeyer"
}
```

Are you referring to https://github.com/sphinx-doc/sphinx/pull/5045?

Anyway, the current branch seems to work so I'd rather keep it.



---

archive/issue_comments_346696.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-08T08:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346696",
    "user": "@kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346697.json:
```json
{
    "body": "Replying to [comment:37 jdemeyer]:\n> Are you referring to https://github.com/sphinx-doc/sphinx/pull/5045?\n> \n> Anyway, the current branch seems to work so I'd rather keep it.\n\nNo. 5040 has two commits. Your current patch is the first one. It is described as a temporary solution while the second commit is more \"future proofing\". But indeed the first commit you are using is supposed to work. Let's send this to the bots as is.",
    "created_at": "2018-06-08T08:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346697",
    "user": "@kiwifb"
}
```

Replying to [comment:37 jdemeyer]:
> Are you referring to https://github.com/sphinx-doc/sphinx/pull/5045?
> 
> Anyway, the current branch seems to work so I'd rather keep it.

No. 5040 has two commits. Your current patch is the first one. It is described as a temporary solution while the second commit is more "future proofing". But indeed the first commit you are using is supposed to work. Let's send this to the bots as is.



---

archive/issue_comments_346698.json:
```json
{
    "body": "Replying to [comment:38 fbissey]:\n> Your current patch is the first one.\n\nIt actually contains both commits.",
    "created_at": "2018-06-08T08:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346698",
    "user": "@jdemeyer"
}
```

Replying to [comment:38 fbissey]:
> Your current patch is the first one.

It actually contains both commits.



---

archive/issue_comments_346699.json:
```json
{
    "body": "Cumulative patches on the same files confuse me no end.",
    "created_at": "2018-06-08T08:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346699",
    "user": "@kiwifb"
}
```

Cumulative patches on the same files confuse me no end.



---

archive/issue_comments_346700.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-06-10T08:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346700",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346701.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/misc/sphinxify.py  # 2 doctests failed\nsage -t --long local/lib/python2.7/site-packages/sagenb/misc/sphinxify.py  # 2 doctests failed\n```\n",
    "created_at": "2018-06-10T08:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346701",
    "user": "@vbraun"
}
```


```
sage -t --long src/sage/misc/sphinxify.py  # 2 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/misc/sphinxify.py  # 2 doctests failed
```




---

archive/issue_comments_346702.json:
```json
{
    "body": "Trivial but we should have seen it in reviews\n\n```\nfbissey@moonloop ~ $ sage -t --long /usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2018-06-10-20-16-29-93e55012.\nUsing --optional=optional,sage\nDoctesting 1 file.\nsage -t --long /usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py\", line 51, in sage.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('**Testing**\\n`monospace`')\nExpected:\n    '<div class=\"docstring\"...<strong>Testing</strong>\\n<span class=\"math notranslate\"...</p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><strong>Testing</strong>\\n<span class=\"math notranslate nohighlight\">monospace</span></p>\\n\\n\\n</div>'\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py\", line 53, in sage.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('`x=y`')\nExpected:\n    '<div class=\"docstring\">\\n    \\n  <p><span class=\"math notranslate\">x=y</span></p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><span class=\"math notranslate nohighlight\">x=y</span></p>\\n\\n\\n</div>'\n**********************************************************************\n1 item had failures:\n   2 of  10 in sage.misc.sphinxify.sphinxify\n    [9 tests, 2 failures, 1.02 s]\n----------------------------------------------------------------------\nsage -t --long /usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1.0 seconds\n    cpu time: 1.0 seconds\n    cumulative wall time: 1.0 seconds\nfbissey@moonloop ~ $ sage -t --long /usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2018-06-10-20-17-44-197b0e5d.\nUsing --optional=optional,sage\nDoctesting 1 file.\nsage -t --long /usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py\", line 68, in sagenb.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('**Testing**\\n`monospace`')\nExpected:\n    '...<div class=\"docstring\"...<strong>Testing</strong>\\n<span class=\"math\"...</p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><strong>Testing</strong>\\n<span class=\"math notranslate nohighlight\">monospace</span></p>\\n\\n\\n</div>'\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py\", line 70, in sagenb.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('`x=y`')\nExpected:\n    '...<div class=\"docstring\">\\n    \\n  <p><span class=\"math\">x=y</span></p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><span class=\"math notranslate nohighlight\">x=y</span></p>\\n\\n\\n</div>'\n**********************************************************************\n1 item had failures:\n   2 of  10 in sagenb.misc.sphinxify.sphinxify\n    [14 tests, 2 failures, 0.74 s]\n----------------------------------------------------------------------\nsage -t --long /usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1.2 seconds\n    cpu time: 0.7 seconds\n    cumulative wall time: 0.7 seconds\n```\n\nThat unfortunately requires a new version of `sagenb`. `@`Dima could we get a 1.0.3 for this.",
    "created_at": "2018-06-10T08:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346702",
    "user": "@kiwifb"
}
```

Trivial but we should have seen it in reviews

```
fbissey@moonloop ~ $ sage -t --long /usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py 
too many failed tests, not using stored timings
Running doctests with ID 2018-06-10-20-16-29-93e55012.
Using --optional=optional,sage
Doctesting 1 file.
sage -t --long /usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py", line 51, in sage.misc.sphinxify.sphinxify
Failed example:
    sphinxify('**Testing**\n`monospace`')
Expected:
    '<div class="docstring"...<strong>Testing</strong>\n<span class="math notranslate"...</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><strong>Testing</strong>\n<span class="math notranslate nohighlight">monospace</span></p>\n\n\n</div>'
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py", line 53, in sage.misc.sphinxify.sphinxify
Failed example:
    sphinxify('`x=y`')
Expected:
    '<div class="docstring">\n    \n  <p><span class="math notranslate">x=y</span></p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><span class="math notranslate nohighlight">x=y</span></p>\n\n\n</div>'
**********************************************************************
1 item had failures:
   2 of  10 in sage.misc.sphinxify.sphinxify
    [9 tests, 2 failures, 1.02 s]
----------------------------------------------------------------------
sage -t --long /usr/lib64/python2.7/site-packages/sage/misc/sphinxify.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1.0 seconds
    cpu time: 1.0 seconds
    cumulative wall time: 1.0 seconds
fbissey@moonloop ~ $ sage -t --long /usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py 
too many failed tests, not using stored timings
Running doctests with ID 2018-06-10-20-17-44-197b0e5d.
Using --optional=optional,sage
Doctesting 1 file.
sage -t --long /usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py", line 68, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('**Testing**\n`monospace`')
Expected:
    '...<div class="docstring"...<strong>Testing</strong>\n<span class="math"...</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><strong>Testing</strong>\n<span class="math notranslate nohighlight">monospace</span></p>\n\n\n</div>'
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py", line 70, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('`x=y`')
Expected:
    '...<div class="docstring">\n    \n  <p><span class="math">x=y</span></p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><span class="math notranslate nohighlight">x=y</span></p>\n\n\n</div>'
**********************************************************************
1 item had failures:
   2 of  10 in sagenb.misc.sphinxify.sphinxify
    [14 tests, 2 failures, 0.74 s]
----------------------------------------------------------------------
sage -t --long /usr/lib64/python2.7/site-packages/sagenb/misc/sphinxify.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1.2 seconds
    cpu time: 0.7 seconds
    cumulative wall time: 0.7 seconds
```

That unfortunately requires a new version of `sagenb`. `@`Dima could we get a 1.0.3 for this.



---

archive/issue_comments_346703.json:
```json
{
    "body": "OK, so that's just doctests  in sagenb, right? No problem, I'll fix these.\nhttps://github.com/sagemath/sagenb/issues/445",
    "created_at": "2018-06-10T08:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346703",
    "user": "@dimpase"
}
```

OK, so that's just doctests  in sagenb, right? No problem, I'll fix these.
https://github.com/sagemath/sagenb/issues/445



---

archive/issue_comments_346704.json:
```json
{
    "body": "Replying to [comment:42 fbissey]:\n> Trivial but we should have seen it in reviews\n\nRight. I just did not think about running doctests after fixing the PDF documentation stuff.",
    "created_at": "2018-06-10T09:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346704",
    "user": "@jdemeyer"
}
```

Replying to [comment:42 fbissey]:
> Trivial but we should have seen it in reviews

Right. I just did not think about running doctests after fixing the PDF documentation stuff.



---

archive/issue_comments_346705.json:
```json
{
    "body": "Replying to [comment:43 dimpase]:\n> OK, so that's just doctests  in sagenb, right? No problem, I'll fix these.\n> https://github.com/sagemath/sagenb/issues/445\n\nThe commit works for me. We just have to reproduce it in sage's `sphinxify.py`.",
    "created_at": "2018-06-10T22:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346705",
    "user": "@kiwifb"
}
```

Replying to [comment:43 dimpase]:
> OK, so that's just doctests  in sagenb, right? No problem, I'll fix these.
> https://github.com/sagemath/sagenb/issues/445

The commit works for me. We just have to reproduce it in sage's `sphinxify.py`.



---

archive/issue_comments_346706.json:
```json
{
    "body": "here is the new sagenb https://github.com/sagemath/sagenb/releases/download/1.0.3/sagenb-1.0.3.tar.bz2\n\nCould you bump up the version in build/pkgs/sagenb/ etc to include it on this ticket?",
    "created_at": "2018-06-10T22:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346706",
    "user": "@dimpase"
}
```

here is the new sagenb https://github.com/sagemath/sagenb/releases/download/1.0.3/sagenb-1.0.3.tar.bz2

Could you bump up the version in build/pkgs/sagenb/ etc to include it on this ticket?



---

archive/issue_comments_346707.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> here is the new sagenb https://github.com/sagemath/sagenb/releases/download/1.0.3/sagenb-1.0.3.tar.bz2\n> \n> Could you bump up the version in build/pkgs/sagenb/ etc to include it on this ticket?\n\nDefinitely. I am leaving it to Jeroen as the ticket author, unless he indicates he is too busy to handle it in which case I will step up.",
    "created_at": "2018-06-10T22:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346707",
    "user": "@kiwifb"
}
```

Replying to [comment:46 dimpase]:
> here is the new sagenb https://github.com/sagemath/sagenb/releases/download/1.0.3/sagenb-1.0.3.tar.bz2
> 
> Could you bump up the version in build/pkgs/sagenb/ etc to include it on this ticket?

Definitely. I am leaving it to Jeroen as the ticket author, unless he indicates he is too busy to handle it in which case I will step up.



---

archive/issue_comments_346708.json:
```json
{
    "body": "Replying to [comment:47 fbissey]:\n> I am leaving it to Jeroen as the ticket author, unless he indicates he is too busy to handle it in which case I will step up.\n\nIt's literally my job to do this...",
    "created_at": "2018-06-11T08:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346708",
    "user": "@jdemeyer"
}
```

Replying to [comment:47 fbissey]:
> I am leaving it to Jeroen as the ticket author, unless he indicates he is too busy to handle it in which case I will step up.

It's literally my job to do this...



---

archive/issue_comments_346709.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-11T08:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346709",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346710.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-11T08:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346710",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346711.json:
```json
{
    "body": "Works for me.",
    "created_at": "2018-06-11T08:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346711",
    "user": "@kiwifb"
}
```

Works for me.



---

archive/issue_comments_346712.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-11T08:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346712",
    "user": "@kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346713.json:
```json
{
    "body": "Damn. Could we get rid of the `\"import __builtin__\"` in sagenb/misc/sphinxify.py and sagenb/misc/support.py ??\n\nThis is breaking the compatibility of sagenb with python3...",
    "created_at": "2018-06-11T12:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346713",
    "user": "@fchapoton"
}
```

Damn. Could we get rid of the `"import __builtin__"` in sagenb/misc/sphinxify.py and sagenb/misc/support.py ??

This is breaking the compatibility of sagenb with python3...



---

archive/issue_comments_346714.json:
```json
{
    "body": "Replying to [comment:53 chapoton]:\n> Damn. Could we get rid of the `\"import __builtin__\"` in sagenb/misc/sphinxify.py and sagenb/misc/support.py ??\n\nPerhaps, but not in this ticket please.",
    "created_at": "2018-06-11T12:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346714",
    "user": "@jdemeyer"
}
```

Replying to [comment:53 chapoton]:
> Damn. Could we get rid of the `"import __builtin__"` in sagenb/misc/sphinxify.py and sagenb/misc/support.py ??

Perhaps, but not in this ticket please.



---

archive/issue_comments_346715.json:
```json
{
    "body": "Replying to [comment:54 jdemeyer]:\n> Replying to [comment:53 chapoton]:\n> > Damn. Could we get rid of the `\"import __builtin__\"` in sagenb/misc/sphinxify.py and sagenb/misc/support.py ??\n> \n> Perhaps, but not in this ticket please.\n\nTotally agree with Jeroen, another ticket please. \n\nThat being said, historically we have migrated `sphinxify.py` from `sagenb` into sage to reduce dependency on `sagenb` (that's what I remember at least). If you want to work on that, I would really suggest to try eliminating the `sphinxify.py` of `sagenb` and use sage's one instead.",
    "created_at": "2018-06-11T20:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346715",
    "user": "@kiwifb"
}
```

Replying to [comment:54 jdemeyer]:
> Replying to [comment:53 chapoton]:
> > Damn. Could we get rid of the `"import __builtin__"` in sagenb/misc/sphinxify.py and sagenb/misc/support.py ??
> 
> Perhaps, but not in this ticket please.

Totally agree with Jeroen, another ticket please. 

That being said, historically we have migrated `sphinxify.py` from `sagenb` into sage to reduce dependency on `sagenb` (that's what I remember at least). If you want to work on that, I would really suggest to try eliminating the `sphinxify.py` of `sagenb` and use sage's one instead.



---

archive/issue_comments_346716.json:
```json
{
    "body": "\n```\nFile \"src/doc/common/conf.py\", line 627, in doc.common.conf.call_intersphinx\nFailed example:\n    for line in open(thematic_index).readlines():\n        if \"padics\" in line:\n            sys.stdout.write(line)\nExpected:\n    <li><a class=\"reference external\" href=\"../reference/padics/sage/rings/padics/tutorial.html#sage-rings-padics-tutorial\" title=\"(in Sage Reference Manual: p-Adics ...)\"><span>Introduction to the -adics</span></a></li>\nGot:\n    <li><a class=\"reference external\" href=\"../reference/padics/sage/rings/padics/tutorial.html#sage-rings-padics-tutorial\" title=\"(in Sage Reference Manual: p-Adics)\"><span>Introduction to the -adics</span></a></li>\n**********************************************************************\n1 item had failures:\n   1 of   4 in doc.common.conf.call_intersphinx\n    [3 tests, 1 failure, 0.61 s]\n```\n",
    "created_at": "2018-06-12T20:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346716",
    "user": "@vbraun"
}
```


```
File "src/doc/common/conf.py", line 627, in doc.common.conf.call_intersphinx
Failed example:
    for line in open(thematic_index).readlines():
        if "padics" in line:
            sys.stdout.write(line)
Expected:
    <li><a class="reference external" href="../reference/padics/sage/rings/padics/tutorial.html#sage-rings-padics-tutorial" title="(in Sage Reference Manual: p-Adics ...)"><span>Introduction to the -adics</span></a></li>
Got:
    <li><a class="reference external" href="../reference/padics/sage/rings/padics/tutorial.html#sage-rings-padics-tutorial" title="(in Sage Reference Manual: p-Adics)"><span>Introduction to the -adics</span></a></li>
**********************************************************************
1 item had failures:
   1 of   4 in doc.common.conf.call_intersphinx
    [3 tests, 1 failure, 0.61 s]
```




---

archive/issue_comments_346717.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-06-12T20:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346717",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346718.json:
```json
{
    "body": "I have seen it too in the vbraun branch and it confused me quite a bit because I don't remember seeing it the first time round but it should have been there. It seems like before this ticket the title field ends up with ` v` as in `title=\"(in Sage Reference Manual:  p-Adics v)` not just for this particular one that's tested but for all of them. After this ticket it is reduced to just `title=\"(in Sage Reference Manual: p-Adics)` and the ` v` has disappeared everywhere.",
    "created_at": "2018-06-12T21:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346718",
    "user": "@kiwifb"
}
```

I have seen it too in the vbraun branch and it confused me quite a bit because I don't remember seeing it the first time round but it should have been there. It seems like before this ticket the title field ends up with ` v` as in `title="(in Sage Reference Manual:  p-Adics v)` not just for this particular one that's tested but for all of them. After this ticket it is reduced to just `title="(in Sage Reference Manual: p-Adics)` and the ` v` has disappeared everywhere.



---

archive/issue_comments_346719.json:
```json
{
    "body": "It's supposed to say `v8.3.beta5` so that's a regression somehow.",
    "created_at": "2018-06-13T11:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346719",
    "user": "@jdemeyer"
}
```

It's supposed to say `v8.3.beta5` so that's a regression somehow.



---

archive/issue_comments_346720.json:
```json
{
    "body": "I opened #25570 for the version number regression.",
    "created_at": "2018-06-13T11:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346720",
    "user": "@jdemeyer"
}
```

I opened #25570 for the version number regression.



---

archive/issue_comments_346721.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-06-13T11:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346721",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_346722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2018-06-13T12:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346722",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_346723.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-06-13T12:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346723",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_346724.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-14T12:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346724",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346725.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-17T22:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24698#issuecomment-346725",
    "user": "@vbraun"
}
```

Resolution: fixed
