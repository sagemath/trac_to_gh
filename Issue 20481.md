# Issue 20481: Simplicial complexes: consistently order faces when computing chain complexes, homology

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2016-05-30 15:27:13

CC:  tscrim jeremy.l.martin

The main changes here: use `n_cells` instead of `n_faces` throughout the simplicial complex code, and then sort `n_cells`. This way, it is easy to understand the indexing of the matrices defining the differentials in the associated chain complex.


---

Comment by jhpalmieri created at 2016-05-30 15:37:17

Changing keywords from "" to "days74".


---

Comment by jhpalmieri created at 2016-05-30 15:37:17

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2016-05-30 15:41:12

New commits:


---

Comment by git created at 2016-05-30 15:47:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2016-05-30 15:48:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-06-01 18:37:43


```
sage -t src/sage/homology/simplicial_complex.py
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 1391, in sage.homology.simplicial_complex.SimplicialComplex.n_cells
Failed example:
    S = SimplicialComplex([This is the Trac macro *complex* that was inherited from the migration called with arguments (i), complex)](https://trac.sagemath.org/wiki/WikiMacros#complex-macro), sort_facets=False)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complex.SimplicialComplex.n_cells[6]>", line 1, in <module>
        S = SimplicialComplex([This is the Trac macro *complex* that was inherited from the migration called with arguments (i), complex)](https://trac.sagemath.org/wiki/WikiMacros#complex-macro), sort_facets=False)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py", line 999, in __init__
        vertices = tuple(range(vertex_set+1))
    TypeError: can only concatenate list (not "int") to list
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 1392, in sage.homology.simplicial_complex.SimplicialComplex.n_cells
Failed example:
    S.n_cells(0)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complex.SimplicialComplex.n_cells[7]>", line 1, in <module>
        S.n_cells(Integer(0))
      File "sage/structure/parent.pyx", line 851, in sage.structure.parent.Parent.__getattr__ (build/cythonized/sage/structure/parent.c:8117)
        attr = getattr_from_other_class(self, self._category.parent_class, name)
      File "sage/structure/misc.pyx", line 253, in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1763)
        raise dummy_attribute_error
    AttributeError: 'Set_object_enumerated_with_category' object has no attribute 'n_cells'
**********************************************************************
1 item had failures:
   2 of   9 in sage.homology.simplicial_complex.SimplicialComplex.n_cells
    [554 tests, 2 failures, 2.99 s]
----------------------------------------------------------------------
sage -t src/sage/homology/simplicial_complex.py  # 2 doctests failed
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2016-06-01 18:37:43

Changing status from positive_review to needs_work.


---

Comment by jhpalmieri created at 2016-06-01 20:40:06

I guess this is fallout from #20720.


---

Comment by jhpalmieri created at 2016-06-01 20:49:21

Yes, I think the problem is that a line

```
    if sort_facets:
```

got deleted from the `__init__` method in #20720, and it needs to be put back.


---

Comment by tscrim created at 2016-06-01 20:51:50

I agree, that should be the problem (I removed it because the vertex set was going to be a `frozenset` and forgot to put it back in when I made it to be a tuple).


---

Comment by jhpalmieri created at 2016-06-01 20:52:48

I propose this change:

```diff
diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
index c8a5bdd..db1b5f0 100644
--- a/src/sage/homology/simplicial_complex.py
+++ b/src/sage/homology/simplicial_complex.py
`@``@` -991,10 +991,13 `@``@` class SimplicialComplex(Parent, GenericCellComplex):
             self._sorted = False
             return
 
-        try:  # vertex_set is an iterable
-            vertices = tuple(sorted(vertex_set))
-        except TypeError:  # vertex_set is an integer
-            vertices = tuple(range(vertex_set+1))
+        if sort_facets:
+            try:  # vertex_set is an iterable
+                vertices = tuple(sorted(vertex_set))
+            except TypeError:  # vertex_set is an integer
+                vertices = tuple(range(vertex_set+1))
+        else:
+            vertices = tuple(vertex_set)
         gen_dict = {}
         for v in vertices:
             if name_check:
```

It really belongs on #20720, but that ticket is closed now. Open a new ticket and make this one a dependency of the new one, or do it here?


---

Comment by tscrim created at 2016-06-01 20:59:07

Just do it here; we can allow for some ticket creep. It's easiest to do, and we essentially need this ticket to test against the failure of this behavior I think (and we understand what is going on).


---

Comment by git created at 2016-06-02 07:17:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2016-06-02 07:20:10

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-06-02 07:48:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-06-02 20:58:03

Resolution: fixed


---

Comment by jhpalmieri created at 2016-06-17 20:13:26

See #20841 for a minor followup.
