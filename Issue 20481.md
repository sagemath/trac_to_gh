# Issue 20481: Simplicial complexes: consistently order faces when computing chain complexes, homology

archive/issues_020481.json:
```json
{
    "body": "CC:  @tscrim jeremy.l.martin\n\nThe main changes here: use `n_cells` instead of `n_faces` throughout the simplicial complex code, and then sort `n_cells`. This way, it is easy to understand the indexing of the matrices defining the differentials in the associated chain complex.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20718\n\n",
    "created_at": "2016-05-30T15:27:13Z",
    "labels": [
        "component: algebraic topology",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Simplicial complexes: consistently order faces when computing chain complexes, homology",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20481",
    "user": "https://github.com/jhpalmieri"
}
```
CC:  @tscrim jeremy.l.martin

The main changes here: use `n_cells` instead of `n_faces` throughout the simplicial complex code, and then sort `n_cells`. This way, it is easy to understand the indexing of the matrices defining the differentials in the associated chain complex.

Issue created by migration from https://trac.sagemath.org/ticket/20718





---

archive/issue_comments_282217.json:
```json
{
    "body": "Changing keywords from \"\" to \"days74\".",
    "created_at": "2016-05-30T15:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282217",
    "user": "https://github.com/jhpalmieri"
}
```

Changing keywords from "" to "days74".



---

archive/issue_comments_282218.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-30T15:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282218",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_282219.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-05-30T15:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282219",
    "user": "https://github.com/jhpalmieri"
}
```

New commits:



---

archive/issue_comments_282220.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-30T15:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282221.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-30T15:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282221",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282222.json:
```json
{
    "body": "\n```\nsage -t src/sage/homology/simplicial_complex.py\n**********************************************************************\nFile \"src/sage/homology/simplicial_complex.py\", line 1391, in sage.homology.simplicial_complex.SimplicialComplex.n_cells\nFailed example:\n    S = SimplicialComplex([[complex(i), complex(1)]], sort_facets=False)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.homology.simplicial_complex.SimplicialComplex.n_cells[6]>\", line 1, in <module>\n        S = SimplicialComplex([[complex(i), complex(Integer(1))]], sort_facets=False)\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py\", line 999, in __init__\n        vertices = tuple(range(vertex_set+1))\n    TypeError: can only concatenate list (not \"int\") to list\n**********************************************************************\nFile \"src/sage/homology/simplicial_complex.py\", line 1392, in sage.homology.simplicial_complex.SimplicialComplex.n_cells\nFailed example:\n    S.n_cells(0)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.homology.simplicial_complex.SimplicialComplex.n_cells[7]>\", line 1, in <module>\n        S.n_cells(Integer(0))\n      File \"sage/structure/parent.pyx\", line 851, in sage.structure.parent.Parent.__getattr__ (build/cythonized/sage/structure/parent.c:8117)\n        attr = getattr_from_other_class(self, self._category.parent_class, name)\n      File \"sage/structure/misc.pyx\", line 253, in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1763)\n        raise dummy_attribute_error\n    AttributeError: 'Set_object_enumerated_with_category' object has no attribute 'n_cells'\n**********************************************************************\n1 item had failures:\n   2 of   9 in sage.homology.simplicial_complex.SimplicialComplex.n_cells\n    [554 tests, 2 failures, 2.99 s]\n----------------------------------------------------------------------\nsage -t src/sage/homology/simplicial_complex.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2016-06-01T18:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282222",
    "user": "https://github.com/vbraun"
}
```


```
sage -t src/sage/homology/simplicial_complex.py
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 1391, in sage.homology.simplicial_complex.SimplicialComplex.n_cells
Failed example:
    S = SimplicialComplex([[complex(i), complex(1)]], sort_facets=False)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complex.SimplicialComplex.n_cells[6]>", line 1, in <module>
        S = SimplicialComplex([[complex(i), complex(Integer(1))]], sort_facets=False)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py", line 999, in __init__
        vertices = tuple(range(vertex_set+1))
    TypeError: can only concatenate list (not "int") to list
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 1392, in sage.homology.simplicial_complex.SimplicialComplex.n_cells
Failed example:
    S.n_cells(0)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complex.SimplicialComplex.n_cells[7]>", line 1, in <module>
        S.n_cells(Integer(0))
      File "sage/structure/parent.pyx", line 851, in sage.structure.parent.Parent.__getattr__ (build/cythonized/sage/structure/parent.c:8117)
        attr = getattr_from_other_class(self, self._category.parent_class, name)
      File "sage/structure/misc.pyx", line 253, in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1763)
        raise dummy_attribute_error
    AttributeError: 'Set_object_enumerated_with_category' object has no attribute 'n_cells'
**********************************************************************
1 item had failures:
   2 of   9 in sage.homology.simplicial_complex.SimplicialComplex.n_cells
    [554 tests, 2 failures, 2.99 s]
----------------------------------------------------------------------
sage -t src/sage/homology/simplicial_complex.py  # 2 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_282223.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-06-01T18:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282223",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_282224.json:
```json
{
    "body": "I guess this is fallout from #20720.",
    "created_at": "2016-06-01T20:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282224",
    "user": "https://github.com/jhpalmieri"
}
```

I guess this is fallout from #20720.



---

archive/issue_comments_282225.json:
```json
{
    "body": "Yes, I think the problem is that a line\n\n```\n    if sort_facets:\n```\n\ngot deleted from the `__init__` method in #20720, and it needs to be put back.",
    "created_at": "2016-06-01T20:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282225",
    "user": "https://github.com/jhpalmieri"
}
```

Yes, I think the problem is that a line

```
    if sort_facets:
```

got deleted from the `__init__` method in #20720, and it needs to be put back.



---

archive/issue_comments_282226.json:
```json
{
    "body": "I agree, that should be the problem (I removed it because the vertex set was going to be a `frozenset` and forgot to put it back in when I made it to be a tuple).",
    "created_at": "2016-06-01T20:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282226",
    "user": "https://github.com/tscrim"
}
```

I agree, that should be the problem (I removed it because the vertex set was going to be a `frozenset` and forgot to put it back in when I made it to be a tuple).



---

archive/issue_comments_282227.json:
```json
{
    "body": "I propose this change:\n\n```diff\ndiff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py\nindex c8a5bdd..db1b5f0 100644\n--- a/src/sage/homology/simplicial_complex.py\n+++ b/src/sage/homology/simplicial_complex.py\n@@ -991,10 +991,13 @@ class SimplicialComplex(Parent, GenericCellComplex):\n             self._sorted = False\n             return\n \n-        try:  # vertex_set is an iterable\n-            vertices = tuple(sorted(vertex_set))\n-        except TypeError:  # vertex_set is an integer\n-            vertices = tuple(range(vertex_set+1))\n+        if sort_facets:\n+            try:  # vertex_set is an iterable\n+                vertices = tuple(sorted(vertex_set))\n+            except TypeError:  # vertex_set is an integer\n+                vertices = tuple(range(vertex_set+1))\n+        else:\n+            vertices = tuple(vertex_set)\n         gen_dict = {}\n         for v in vertices:\n             if name_check:\n```\n\nIt really belongs on #20720, but that ticket is closed now. Open a new ticket and make this one a dependency of the new one, or do it here?",
    "created_at": "2016-06-01T20:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282227",
    "user": "https://github.com/jhpalmieri"
}
```

I propose this change:

```diff
diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
index c8a5bdd..db1b5f0 100644
--- a/src/sage/homology/simplicial_complex.py
+++ b/src/sage/homology/simplicial_complex.py
@@ -991,10 +991,13 @@ class SimplicialComplex(Parent, GenericCellComplex):
             self._sorted = False
             return
 
-        try:  # vertex_set is an iterable
-            vertices = tuple(sorted(vertex_set))
-        except TypeError:  # vertex_set is an integer
-            vertices = tuple(range(vertex_set+1))
+        if sort_facets:
+            try:  # vertex_set is an iterable
+                vertices = tuple(sorted(vertex_set))
+            except TypeError:  # vertex_set is an integer
+                vertices = tuple(range(vertex_set+1))
+        else:
+            vertices = tuple(vertex_set)
         gen_dict = {}
         for v in vertices:
             if name_check:
```

It really belongs on #20720, but that ticket is closed now. Open a new ticket and make this one a dependency of the new one, or do it here?



---

archive/issue_comments_282228.json:
```json
{
    "body": "Just do it here; we can allow for some ticket creep. It's easiest to do, and we essentially need this ticket to test against the failure of this behavior I think (and we understand what is going on).",
    "created_at": "2016-06-01T20:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282228",
    "user": "https://github.com/tscrim"
}
```

Just do it here; we can allow for some ticket creep. It's easiest to do, and we essentially need this ticket to test against the failure of this behavior I think (and we understand what is going on).



---

archive/issue_comments_282229.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-02T07:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282230.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-06-02T07:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282230",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_282231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-06-02T07:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282231",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_019444.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-02T20:58:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20481#event-19444"
}
```



---

archive/issue_comments_282232.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-06-02T20:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282232",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_282233.json:
```json
{
    "body": "See #20841 for a minor followup.",
    "created_at": "2016-06-17T20:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20481#issuecomment-282233",
    "user": "https://github.com/jhpalmieri"
}
```

See #20841 for a minor followup.
