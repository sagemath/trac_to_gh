# Issue 12315: sdist in /tmp/sage-sdist-$$/sage-VERSION

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2012-02-10 09:46:24

Assignee: leif

Currently, `sage-sdist` uses

```
/tmp/sage-VERSION
```

as temporary directory, leading to all sorts of race conditions.

I propose to use instead

```
/tmp/sage-sdist-$$/sage-VERSION
```



---

Comment by jdemeyer created at 2012-02-11 21:44:09

Changing status from new to needs_review.


---

Comment by vbraun created at 2012-02-18 00:36:11

Why not go all the way and use

```
TOP=`mktemp "${TMPDIR:-/tmp}/sage-sdist-XXXXX"`
```

This would then also be safe on multi-user systems regardless of umask.


---

Comment by jdemeyer created at 2012-02-18 09:21:36

I just don't know about the portability of "mktemp"...


---

Comment by jhpalmieri created at 2012-02-18 15:51:59

The various options for mktemp are not very portable, but the above command seems to work on linux, Darwin, and OpenSolaris.


---

Comment by jdemeyer created at 2012-02-21 11:08:20

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-02-21 11:08:20

Well, we need the "-d" option for directory, but that seems to work also.


---

Attachment


---

Comment by jdemeyer created at 2012-02-23 20:25:20

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2012-02-23 20:25:20

Volker, I made the change you suggested.  Needs review.


---

Comment by vbraun created at 2012-02-27 18:44:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-02-27 18:44:04

Apparently mktemp isn't POSIX (!?!) but then without it you can't securely create temp files (without the temp directory hack). So everybody in his right mind will have a version of mktemp, I'd say.


---

Comment by jdemeyer created at 2012-02-27 20:09:29

Resolution: fixed
