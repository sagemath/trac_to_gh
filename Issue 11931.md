# Issue 11931: Use MeatAxe as an optional back end for dense matrices over `GF(p^n)`, p odd, n>1, `p^n<255`

archive/issues_011931.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @malb @jdemeyer @vbraun\n\nKeywords: linear algebra, MeatAxe\n\nSage has (or will soon have) fairly good implementations of dense matrices over `GF(2)`, over `GF(2^e)` (#9562) and over `GF(p)` (p prime, #4260). However, it uses generic code for dense matrices over `GF(p^n)`, p odd, n>1, `p^n<255`. \n\nI suggest to use a major modification of `MeatAxe Release 2.2.4` instead of the basic implementation. More on the modifications and the reason for choosing an old release is explained in the comments.\n\nThis is awfully slow:\n\n```\nsage: MS = MatrixSpace(GF(5^3,'y'),2000)\nsage: %time A = MS.random_element()\nCPU times: user 6.36 s, sys: 0.02 s, total: 6.39 s\nWall time: 6.41 s\nsage: type(A)\n<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>\nsage: B = MS.random_element()\nsage: %time A*B    # using 6.3% of my computer's memory\nCPU times: user 744.20 s, sys: 1.18 s, total: 745.38 s\nWall time: 747.69 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\nsage: %time ~A     # using 10.4% of my computer's memory\nCPU times: user 1096.74 s, sys: 1.30 s, total: 1098.05 s\nWall time: 1101.24 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\nsage: %time A.echelon_form() # using 10.4% of my computer's memory\nCPU times: user 378.62 s, sys: 0.33 s, total: 378.95 s\nWall time: 380.06 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\n```\n\n\nWith the optional spkg and the patch, one gets a clear improvement.\n\n```\nsage: MS = MatrixSpace(GF(5^3,'y'),2000)\nsage: %time A = MS.random_element()\nCPU times: user 0.32 s, sys: 0.00 s, total: 0.32 s\nWall time: 0.33 s\nsage: type(A)\n<type 'sage.matrix.matrix_modpn_dense.Matrix_modpn_dense'>\nsage: B = MS.random_element()\n# The following uses Strassen-Winograd multiplication\nsage: %time A*B      # using 3.5% of my computer's memory\nCPU times: user 7.68 s, sys: 0.01 s, total: 7.69 s\nWall time: 7.72 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\n# The following is school book multiplication;\n# that's more or less the original meataxe speed:\nsage: %time A._multiply_classical(B)   # using 3.6% of my computer's memory\nCPU times: user 11.68 s, sys: 0.02 s, total: 11.70 s\nWall time: 11.73 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\n# Strassen is not implemented for inversion and echelon form.\nsage: %time ~A    # using 3.8% of my computer's memory\nCPU times: user 23.55 s, sys: 0.00 s, total: 23.55 s\nWall time: 23.62 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\nsage: %time A.echelon_form() #using 3.9% of my computer's memory\nCPU times: user 11.73 s, sys: 0.01 s, total: 11.74 s\nWall time: 11.78 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3\n```\n\n\nI think the component is \"linear algebra\", even though it is about an optional package.\n\n**__How to install stuff__**\n\n* Apply the dependencies\n* Install [the optional libmeataxe spkg](http://sage.math.washington.edu/home/SimonKing/LibMeatAxe/libmeataxe-1.0.spkg)\n* Apply either [attachment:] or [attachment:], depending on whether or not you have #11900 applied.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12103\n\n",
    "created_at": "2011-11-30T12:55:11Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Use MeatAxe as an optional back end for dense matrices over `GF(p^n)`, p odd, n>1, `p^n<255`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11931",
    "user": "https://github.com/simon-king-jena"
}
```
Assignee: jason, was

CC:  @malb @jdemeyer @vbraun

Keywords: linear algebra, MeatAxe

Sage has (or will soon have) fairly good implementations of dense matrices over `GF(2)`, over `GF(2^e)` (#9562) and over `GF(p)` (p prime, #4260). However, it uses generic code for dense matrices over `GF(p^n)`, p odd, n>1, `p^n<255`. 

I suggest to use a major modification of `MeatAxe Release 2.2.4` instead of the basic implementation. More on the modifications and the reason for choosing an old release is explained in the comments.

This is awfully slow:

```
sage: MS = MatrixSpace(GF(5^3,'y'),2000)
sage: %time A = MS.random_element()
CPU times: user 6.36 s, sys: 0.02 s, total: 6.39 s
Wall time: 6.41 s
sage: type(A)
<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>
sage: B = MS.random_element()
sage: %time A*B    # using 6.3% of my computer's memory
CPU times: user 744.20 s, sys: 1.18 s, total: 745.38 s
Wall time: 747.69 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
sage: %time ~A     # using 10.4% of my computer's memory
CPU times: user 1096.74 s, sys: 1.30 s, total: 1098.05 s
Wall time: 1101.24 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
sage: %time A.echelon_form() # using 10.4% of my computer's memory
CPU times: user 378.62 s, sys: 0.33 s, total: 378.95 s
Wall time: 380.06 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
```


With the optional spkg and the patch, one gets a clear improvement.

```
sage: MS = MatrixSpace(GF(5^3,'y'),2000)
sage: %time A = MS.random_element()
CPU times: user 0.32 s, sys: 0.00 s, total: 0.32 s
Wall time: 0.33 s
sage: type(A)
<type 'sage.matrix.matrix_modpn_dense.Matrix_modpn_dense'>
sage: B = MS.random_element()
# The following uses Strassen-Winograd multiplication
sage: %time A*B      # using 3.5% of my computer's memory
CPU times: user 7.68 s, sys: 0.01 s, total: 7.69 s
Wall time: 7.72 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
# The following is school book multiplication;
# that's more or less the original meataxe speed:
sage: %time A._multiply_classical(B)   # using 3.6% of my computer's memory
CPU times: user 11.68 s, sys: 0.02 s, total: 11.70 s
Wall time: 11.73 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
# Strassen is not implemented for inversion and echelon form.
sage: %time ~A    # using 3.8% of my computer's memory
CPU times: user 23.55 s, sys: 0.00 s, total: 23.55 s
Wall time: 23.62 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
sage: %time A.echelon_form() #using 3.9% of my computer's memory
CPU times: user 11.73 s, sys: 0.01 s, total: 11.74 s
Wall time: 11.78 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3
```


I think the component is "linear algebra", even though it is about an optional package.

**__How to install stuff__**

* Apply the dependencies
* Install [the optional libmeataxe spkg](http://sage.math.washington.edu/home/SimonKing/LibMeatAxe/libmeataxe-1.0.spkg)
* Apply either [attachment:] or [attachment:], depending on whether or not you have #11900 applied.

Issue created by migration from https://trac.sagemath.org/ticket/12103





---

archive/issue_comments_136660.json:
```json
{
    "body": "Here is more on `libmeataxe-1.0.spkg`.\n\nI started with Release 2.2.4 of the Aachen `C MeatAxe`. This is partially because I first came in touch with `MeatAxe` by old code of David Green, who was using the 2.2.3 release. `MeatAxe 2.2.4` was released under GPL2+, which should be fine. There are more recent releases. However, according to Michael Ringe, while the interface changed substantially, the linear algebra is more or less the same.\n\nThe spkg contains the unmodified sources in the folder `src/`, which is not under version control. The file `patches/libmeataxe.patch` provides my modification. Of course, if one installs the package, the patch will automatically be applied.\n \nHere is a summary of my changes:\n\n* Normally, `MeatAxe` provides some executables that operate on matrices stored in files. I strip it down, such that the executables are not built and only a C library remains (this is [libmeataxe-1.0.spkg](http://sage.math.washington.edu/home/SimonKing/LibMeatAxe/libmeataxe-1.0.spkg)). I wrap the C library using Cython (this is [attachment:trac12103_meataxe.patch])\n* `MeatAxe` uses school book multiplication. I added Strassen-Winograd multiplication, using a schedule that minimizes memory consumption. See `src/src/window.c`.\n* The environment variable `MTXLIB` was supposed to tell `MeatAxe` where to find multiplication tables. However, this never worked for me. I fix it, so that now multiplication tables in `$SAGE_ROOT/local` are used, that are created when the package is installed.\n* A simpler version of the package has been part of our group cohomology spkg. Bad experiences on Solaris made me change three names: I changed\n   * `T_STRING` into `T_STRINGS`,\n   * matextract into _matextract,\n   * matid into `MTXmatid`.\n Please don't ask me why the Solaris linker was mistaking these symbols with symbols in completely different Sage packages, but as a matter of fact it did.\n\nThe aim of this ticket is to make the modified `MeatAxe` an optional back end for dense matrices over `GF(p^n)`, p>2 prime, n>1, `p^n<255`. Currently, one needs to install an spkg *and* a patch to the Sage library.\n\nI would prefer to have it all in one, such that `sage -i libmeataxe-1.0.spkg` would automatically patch the Sage library. Question to Sage experts: Is that possible?\n\nAnyway, I think it can be reviewed...",
    "created_at": "2011-11-30T13:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136660",
    "user": "https://github.com/simon-king-jena"
}
```

Here is more on `libmeataxe-1.0.spkg`.

I started with Release 2.2.4 of the Aachen `C MeatAxe`. This is partially because I first came in touch with `MeatAxe` by old code of David Green, who was using the 2.2.3 release. `MeatAxe 2.2.4` was released under GPL2+, which should be fine. There are more recent releases. However, according to Michael Ringe, while the interface changed substantially, the linear algebra is more or less the same.

The spkg contains the unmodified sources in the folder `src/`, which is not under version control. The file `patches/libmeataxe.patch` provides my modification. Of course, if one installs the package, the patch will automatically be applied.
 
Here is a summary of my changes:

* Normally, `MeatAxe` provides some executables that operate on matrices stored in files. I strip it down, such that the executables are not built and only a C library remains (this is [libmeataxe-1.0.spkg](http://sage.math.washington.edu/home/SimonKing/LibMeatAxe/libmeataxe-1.0.spkg)). I wrap the C library using Cython (this is [attachment:trac12103_meataxe.patch])
* `MeatAxe` uses school book multiplication. I added Strassen-Winograd multiplication, using a schedule that minimizes memory consumption. See `src/src/window.c`.
* The environment variable `MTXLIB` was supposed to tell `MeatAxe` where to find multiplication tables. However, this never worked for me. I fix it, so that now multiplication tables in `$SAGE_ROOT/local` are used, that are created when the package is installed.
* A simpler version of the package has been part of our group cohomology spkg. Bad experiences on Solaris made me change three names: I changed
   * `T_STRING` into `T_STRINGS`,
   * matextract into _matextract,
   * matid into `MTXmatid`.
 Please don't ask me why the Solaris linker was mistaking these symbols with symbols in completely different Sage packages, but as a matter of fact it did.

The aim of this ticket is to make the modified `MeatAxe` an optional back end for dense matrices over `GF(p^n)`, p>2 prime, n>1, `p^n<255`. Currently, one needs to install an spkg *and* a patch to the Sage library.

I would prefer to have it all in one, such that `sage -i libmeataxe-1.0.spkg` would automatically patch the Sage library. Question to Sage experts: Is that possible?

Anyway, I think it can be reviewed...



---

archive/issue_comments_136661.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-30T13:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136661",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136662.json:
```json
{
    "body": "Attachment [trac12103_meataxe.patch](tarball://root/attachments/some-uuid/ticket12103/trac12103_meataxe.patch) by @simon-king-jena created at 2011-12-01 11:23:02\n\nUse `MeatAxe` as back end for linear algebra over some finite fields.",
    "created_at": "2011-12-01T11:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136662",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [trac12103_meataxe.patch](tarball://root/attachments/some-uuid/ticket12103/trac12103_meataxe.patch) by @simon-king-jena created at 2011-12-01 11:23:02

Use `MeatAxe` as back end for linear algebra over some finite fields.



---

archive/issue_comments_136663.json:
```json
{
    "body": "Use `MeatAxe` as back end for linear algebra over some finite fields. Relative to #11900",
    "created_at": "2011-12-01T11:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136663",
    "user": "https://github.com/simon-king-jena"
}
```

Use `MeatAxe` as back end for linear algebra over some finite fields. Relative to #11900



---

archive/issue_comments_136664.json:
```json
{
    "body": "Attachment [trac12103_meataxe_rel11900.patch](tarball://root/attachments/some-uuid/ticket12103/trac12103_meataxe_rel11900.patch) by @simon-king-jena created at 2011-12-01 11:25:11\n\nI have updated both patches, because I wanted to add one method: `matrix_from_rows`. One could rely on the generic implementation, but in some application I need this to be fast:\n\n\n```\n            sage: MS = MatrixSpace(GF(5^3,'y'),3,2)\n            sage: A = MS(range(6))\n            sage: A\n            [0 1]\n            [2 3]\n            [4 0]\n            sage: A.matrix_from_rows([2,1])\n            [4 0]\n            [2 3]\n            sage: A.matrix_from_rows([1,1])\n            [2 3]\n            [2 3]\n```\n",
    "created_at": "2011-12-01T11:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136664",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [trac12103_meataxe_rel11900.patch](tarball://root/attachments/some-uuid/ticket12103/trac12103_meataxe_rel11900.patch) by @simon-king-jena created at 2011-12-01 11:25:11

I have updated both patches, because I wanted to add one method: `matrix_from_rows`. One could rely on the generic implementation, but in some application I need this to be fast:


```
            sage: MS = MatrixSpace(GF(5^3,'y'),3,2)
            sage: A = MS(range(6))
            sage: A
            [0 1]
            [2 3]
            [4 0]
            sage: A.matrix_from_rows([2,1])
            [4 0]
            [2 3]
            sage: A.matrix_from_rows([1,1])
            [2 3]
            [2 3]
```




---

archive/issue_comments_136665.json:
```json
{
    "body": "Attachment [trac12103_meataxe_docfix.patch](tarball://root/attachments/some-uuid/ticket12103/trac12103_meataxe_docfix.patch) by @simon-king-jena created at 2012-03-03 14:02:57\n\nFix one doctest (coping with a changed class name)",
    "created_at": "2012-03-03T14:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136665",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [trac12103_meataxe_docfix.patch](tarball://root/attachments/some-uuid/ticket12103/trac12103_meataxe_docfix.patch) by @simon-king-jena created at 2012-03-03 14:02:57

Fix one doctest (coping with a changed class name)



---

archive/issue_comments_136666.json:
```json
{
    "body": "Apparently there has been a name change `MatrixSpace_generic` to `MatrixSpace`. The result is one doctest failure in my original patch. I am not sure where that name change happened (perhaps it is in one of my patches that aren't in vanilla Sage yet). Therefore I added a second patch, that may or may not be necessary.\n\nApply trac12103_meataxe_rel11900.patch trac12103_meataxe_docfix.patch",
    "created_at": "2012-03-03T14:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136666",
    "user": "https://github.com/simon-king-jena"
}
```

Apparently there has been a name change `MatrixSpace_generic` to `MatrixSpace`. The result is one doctest failure in my original patch. I am not sure where that name change happened (perhaps it is in one of my patches that aren't in vanilla Sage yet). Therefore I added a second patch, that may or may not be necessary.

Apply trac12103_meataxe_rel11900.patch trac12103_meataxe_docfix.patch



---

archive/issue_comments_136667.json:
```json
{
    "body": "The patch applies neither cleanly to 4.8 nor 5.0.beta6. The issue 4.8 is small and easy to fix, 5.0.beta6 are a bit more failures.",
    "created_at": "2012-03-03T15:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136667",
    "user": "https://github.com/malb"
}
```

The patch applies neither cleanly to 4.8 nor 5.0.beta6. The issue 4.8 is small and easy to fix, 5.0.beta6 are a bit more failures.



---

archive/issue_comments_136668.json:
```json
{
    "body": "as of now module_list.py will try to build matrix_modpn_dense regardless of whether MeatAxe is installed, but it should only build it if MeatAxe is installed.",
    "created_at": "2012-03-03T15:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136668",
    "user": "https://github.com/malb"
}
```

as of now module_list.py will try to build matrix_modpn_dense regardless of whether MeatAxe is installed, but it should only build it if MeatAxe is installed.



---

archive/issue_comments_136669.json:
```json
{
    "body": "Replying to [comment:4 malb]:\n> The patch applies neither cleanly to 4.8 nor 5.0.beta6. The issue 4.8 is small and easy to fix, 5.0.beta6 are a bit more failures.\n\nI get\n\n```\n(sage subshell) mpc721:sage king$ hg qpush\napplying trac12103_meataxe_rel11900.patch\npatching file sage/modules/quotient_module.py\nHunk #12 succeeded at 297 with fuzz 1 (offset 10 lines).\nHunk #13 succeeded at 322 with fuzz 1 (offset 14 lines).\nnow at: trac12103_meataxe_rel11900.patch\nSAGE_ROOT=/home/king/SAGE/sage-5.0.beta6\n```\n\nSo, I can not confirm that the first to-be-applied patch is really problematic (ok, fuzz 1 might be fixed at some point, but I don't get actual errors).\n\nHow can I test in module_list.py whether or not `MeatAxe` is installed? I suppose the patch to the sage library should not be applied by the installation script of the spkg.",
    "created_at": "2012-03-03T16:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136669",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:4 malb]:
> The patch applies neither cleanly to 4.8 nor 5.0.beta6. The issue 4.8 is small and easy to fix, 5.0.beta6 are a bit more failures.

I get

```
(sage subshell) mpc721:sage king$ hg qpush
applying trac12103_meataxe_rel11900.patch
patching file sage/modules/quotient_module.py
Hunk #12 succeeded at 297 with fuzz 1 (offset 10 lines).
Hunk #13 succeeded at 322 with fuzz 1 (offset 14 lines).
now at: trac12103_meataxe_rel11900.patch
SAGE_ROOT=/home/king/SAGE/sage-5.0.beta6
```

So, I can not confirm that the first to-be-applied patch is really problematic (ok, fuzz 1 might be fixed at some point, but I don't get actual errors).

How can I test in module_list.py whether or not `MeatAxe` is installed? I suppose the patch to the sage library should not be applied by the installation script of the spkg.



---

archive/issue_comments_136670.json:
```json
{
    "body": "PS: Martin, did you really try to apply trac12103_meataxe_rel11900.patch? Namely, the previous patch (that is not relative to #11900) should be disregarded, as #11900 is already merged.",
    "created_at": "2012-03-03T16:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136670",
    "user": "https://github.com/simon-king-jena"
}
```

PS: Martin, did you really try to apply trac12103_meataxe_rel11900.patch? Namely, the previous patch (that is not relative to #11900) should be disregarded, as #11900 is already merged.



---

archive/issue_comments_136671.json:
```json
{
    "body": "Ah, crap, 11900 was it. \n\nRE: module_list.py I commented on it here: https://bitbucket.org/malb/sagemath/pull-request/1/12103-meataxe-wrapper#comment-3510\n\nPS: Did you get my e-mail that I sent to simon.king___uni-jena.de?",
    "created_at": "2012-03-03T16:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136671",
    "user": "https://github.com/malb"
}
```

Ah, crap, 11900 was it. 

RE: module_list.py I commented on it here: https://bitbucket.org/malb/sagemath/pull-request/1/12103-meataxe-wrapper#comment-3510

PS: Did you get my e-mail that I sent to simon.king___uni-jena.de?



---

archive/issue_comments_136672.json:
```json
{
    "body": "Replying to [comment:8 malb]:\n> Ah, crap, 11900 was it. \n\nOK, I changed the instructions in the ticket description accordingly.\n\n> RE: module_list.py I commented on it here: https://bitbucket.org/malb/sagemath/pull-request/1/12103-meataxe-wrapper#comment-3510\n> \n> PS: Did you get my e-mail that I sent to simon.king___uni-jena.de?\n\nYes, but I didn't look at bitbucket yet, and I suppose I will not find the time to start and learn the new development before Monday.",
    "created_at": "2012-03-03T16:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136672",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:8 malb]:
> Ah, crap, 11900 was it. 

OK, I changed the instructions in the ticket description accordingly.

> RE: module_list.py I commented on it here: https://bitbucket.org/malb/sagemath/pull-request/1/12103-meataxe-wrapper#comment-3510
> 
> PS: Did you get my e-mail that I sent to simon.king___uni-jena.de?

Yes, but I didn't look at bitbucket yet, and I suppose I will not find the time to start and learn the new development before Monday.



---

archive/issue_events_032152.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32152"
}
```



---

archive/issue_events_032153.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32153"
}
```



---

archive/issue_events_032154.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32154"
}
```



---

archive/issue_comments_136673.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-03-31T07:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136673",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_032155.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32155"
}
```



---

archive/issue_events_032156.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32156"
}
```



---

archive/issue_events_032157.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32157"
}
```



---

archive/issue_events_032158.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32158"
}
```



---

archive/issue_comments_136674.json:
```json
{
    "body": "I think this ticket should be revived. But the aim should be to have a library version of the *latest* MeatAxe upstream sources. And of course it should be a new-style package.",
    "created_at": "2015-09-10T16:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136674",
    "user": "https://github.com/simon-king-jena"
}
```

I think this ticket should be revived. But the aim should be to have a library version of the *latest* MeatAxe upstream sources. And of course it should be a new-style package.



---

archive/issue_comments_136675.json:
```json
{
    "body": "The first step will probably be the creation of a new-style package for MeatAxe 2.4.24 (which I take as an exercise for learning new-style packaging).\n\nThe README file says:\n\n```\n================================================================================\nINSTALLATION (for Unix systems)\n================================================================================\n\n1) Copy Makefile.conf.dist to Makefile.conf. Edit Makefile.conf\n   and fill in the necessary parameters.\n\n2) To compile all programs an run the test suite, enter\n\n        make check\n\n   You will probably need gmake (GNU make) to build the MeatAxe.\n\n3) If there were no errors, run\n\n        make install\n\n   to install the executables in their final location (as selected\n   in the makefile).\n```\n\n\nI wonder if we should follow that procedure. After all, `Makefile.conf.dist` just defines a couple of variables that determine the compiler, the flags, the location of the binaries, the location of the library and the implementation (for fields of order up to 255 or for larger fields).\n\nWhat do people think?\n1. a) Should we patch Makefile, by removing the line `include Makefile.conf`, and define all the variables MTXLIB, MTXBIN etc. from Makefile.conf as environment variables?\nor\n1. b) Should we keep Makefile, create an empty Makefile.conf, and do the rest with environment variables?\nor\n2. Should spkg-install first create a fully grown Makefile.conf?",
    "created_at": "2015-09-12T11:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136675",
    "user": "https://github.com/simon-king-jena"
}
```

The first step will probably be the creation of a new-style package for MeatAxe 2.4.24 (which I take as an exercise for learning new-style packaging).

The README file says:

```
================================================================================
INSTALLATION (for Unix systems)
================================================================================

1) Copy Makefile.conf.dist to Makefile.conf. Edit Makefile.conf
   and fill in the necessary parameters.

2) To compile all programs an run the test suite, enter

        make check

   You will probably need gmake (GNU make) to build the MeatAxe.

3) If there were no errors, run

        make install

   to install the executables in their final location (as selected
   in the makefile).
```


I wonder if we should follow that procedure. After all, `Makefile.conf.dist` just defines a couple of variables that determine the compiler, the flags, the location of the binaries, the location of the library and the implementation (for fields of order up to 255 or for larger fields).

What do people think?
1. a) Should we patch Makefile, by removing the line `include Makefile.conf`, and define all the variables MTXLIB, MTXBIN etc. from Makefile.conf as environment variables?
or
1. b) Should we keep Makefile, create an empty Makefile.conf, and do the rest with environment variables?
or
2. Should spkg-install first create a fully grown Makefile.conf?



---

archive/issue_comments_136676.json:
```json
{
    "body": "If all you have to do is `touch Makefile.conf` then I'd go for that.",
    "created_at": "2015-09-12T12:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136676",
    "user": "https://github.com/vbraun"
}
```

If all you have to do is `touch Makefile.conf` then I'd go for that.



---

archive/issue_comments_136677.json:
```json
{
    "body": "Changing component from linear algebra to packages: experimental.",
    "created_at": "2015-09-12T12:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136677",
    "user": "https://github.com/simon-king-jena"
}
```

Changing component from linear algebra to packages: experimental.



---

archive/issue_comments_136678.json:
```json
{
    "body": "I am slightly puzzled.\n\nThere is a variable ZZZ used in Makefile. But when I do\n\n```\nZZZ=0\n$MAKE\n```\n\nthen apparently Makefile doesn't know about ZZZ. What do I need to do to define ZZZ so that Makefile knows about it?",
    "created_at": "2015-09-12T12:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136678",
    "user": "https://github.com/simon-king-jena"
}
```

I am slightly puzzled.

There is a variable ZZZ used in Makefile. But when I do

```
ZZZ=0
$MAKE
```

then apparently Makefile doesn't know about ZZZ. What do I need to do to define ZZZ so that Makefile knows about it?



---

archive/issue_comments_136679.json:
```json
{
    "body": "Unless you `export ZZZ` it is not passed to subprocesses. Alternatively, you might want to use `$MAKE ZZZ=0`.",
    "created_at": "2015-09-12T12:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136679",
    "user": "https://github.com/vbraun"
}
```

Unless you `export ZZZ` it is not passed to subprocesses. Alternatively, you might want to use `$MAKE ZZZ=0`.



---

archive/issue_comments_136680.json:
```json
{
    "body": "Thanks, \"export\" did the trick.\n\nHowever, I am afraid that some of the reasons for massively patching MeatAxe 2.2.4 are still present in version 2.4.24:\n- The environment variables MTXLIB and MTXBIN are ignored during build. I.e., the library is put into ./tmp/, the binaries are put into ./bin/\n\n  Suggested solution: Let spkg-install move the created binaries and libmtx.a to the desired location\n\n- `make clean` doesn't work, as it also goes into the directory test/ and calls `make clean` there---but there is no test/Makefile.\n\n   Not relevant here, as the build directory is deleted anyway.\n\n- `make check` rebuilds everything in ./tmp/ and ./bin/ before testing. Hence, the test suite actually does NOT test what is in $SAGE_ROOT/local/lib and $SAGE_ROOT/local/bin.\n\nQuestion on `make check`: Would it be OK to let spkg-install ALWAYS do `make check`? Or should that be solely the job of spkg-check (with the drawback that then spkg-check would rebuild meataxe)?",
    "created_at": "2015-09-12T14:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136680",
    "user": "https://github.com/simon-king-jena"
}
```

Thanks, "export" did the trick.

However, I am afraid that some of the reasons for massively patching MeatAxe 2.2.4 are still present in version 2.4.24:
- The environment variables MTXLIB and MTXBIN are ignored during build. I.e., the library is put into ./tmp/, the binaries are put into ./bin/

  Suggested solution: Let spkg-install move the created binaries and libmtx.a to the desired location

- `make clean` doesn't work, as it also goes into the directory test/ and calls `make clean` there---but there is no test/Makefile.

   Not relevant here, as the build directory is deleted anyway.

- `make check` rebuilds everything in ./tmp/ and ./bin/ before testing. Hence, the test suite actually does NOT test what is in $SAGE_ROOT/local/lib and $SAGE_ROOT/local/bin.

Question on `make check`: Would it be OK to let spkg-install ALWAYS do `make check`? Or should that be solely the job of spkg-check (with the drawback that then spkg-check would rebuild meataxe)?



---

archive/issue_comments_136681.json:
```json
{
    "body": "Replying to [comment:22 SimonKing]:\n> Question on `make check`: Would it be OK to let spkg-install ALWAYS do `make check`? Or should that be solely the job of spkg-check (with the drawback that then spkg-check would rebuild meataxe)?\n\nOr should spkg-install test whether SAGE_CHECK=yes, and choose between `make` and `make check` accordingly?",
    "created_at": "2015-09-12T14:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136681",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:22 SimonKing]:
> Question on `make check`: Would it be OK to let spkg-install ALWAYS do `make check`? Or should that be solely the job of spkg-check (with the drawback that then spkg-check would rebuild meataxe)?

Or should spkg-install test whether SAGE_CHECK=yes, and choose between `make` and `make check` accordingly?



---

archive/issue_comments_136682.json:
```json
{
    "body": "Do I understand correctly that for automatically downloading the sources from upstream, I should create spkg-src similarly to what I find in build/pkg/singular/spkg-src?",
    "created_at": "2015-09-12T14:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136682",
    "user": "https://github.com/simon-king-jena"
}
```

Do I understand correctly that for automatically downloading the sources from upstream, I should create spkg-src similarly to what I find in build/pkg/singular/spkg-src?



---

archive/issue_comments_136683.json:
```json
{
    "body": "Replying to [comment:22 SimonKing]:\n> However, I am afraid that some of the reasons for massively patching MeatAxe 2.2.4 are still present in version 2.4.24:\n\nBut one aspect has improved: MeatAxe used to rely on certain tables that were put (and when needed also created) in the current directory. And I had to patch the c-sources so that MeatAxe would be able to find the tables in a fixed directory. Now I cannot see any of these tables.",
    "created_at": "2015-09-12T14:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136683",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:22 SimonKing]:
> However, I am afraid that some of the reasons for massively patching MeatAxe 2.2.4 are still present in version 2.4.24:

But one aspect has improved: MeatAxe used to rely on certain tables that were put (and when needed also created) in the current directory. And I had to patch the c-sources so that MeatAxe would be able to find the tables in a fixed directory. Now I cannot see any of these tables.



---

archive/issue_comments_136684.json:
```json
{
    "body": "Replying to [comment:22 SimonKing]:\n> Question on `make check`: Would it be OK to let spkg-install ALWAYS do `make check`? Or should that be solely the job of spkg-check (with the drawback that then spkg-check would rebuild meataxe)?\n\nIn my opinion, if `make check` doesn't add too much time (a minute?) to the build, then you can always do it, but if it's more than that, it should be done only in `spkg-check`.",
    "created_at": "2015-09-12T15:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136684",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:22 SimonKing]:
> Question on `make check`: Would it be OK to let spkg-install ALWAYS do `make check`? Or should that be solely the job of spkg-check (with the drawback that then spkg-check would rebuild meataxe)?

In my opinion, if `make check` doesn't add too much time (a minute?) to the build, then you can always do it, but if it's more than that, it should be done only in `spkg-check`.



---

archive/issue_comments_136685.json:
```json
{
    "body": "You don't need spkg-src, its just a bandaid to modify tarballs (don't do it if you can avoid it)",
    "created_at": "2015-09-12T15:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136685",
    "user": "https://github.com/vbraun"
}
```

You don't need spkg-src, its just a bandaid to modify tarballs (don't do it if you can avoid it)



---

archive/issue_comments_136686.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-12T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136686",
    "user": "https://github.com/simon-king-jena"
}
```

New commits:



---

archive/issue_comments_136687.json:
```json
{
    "body": "Question on how to continue:\n\nMy aim is to provide a Cython wrapper, so, I need to copy meataxe.h to some include location.\n\nBut how to deal with the Cython wrapper? Apparently it would be in the Sage library, but apparently it will not compile if meataxe is not installed.\n\nSo, should the package install the cython code into the Sage library? Or is it possible to have code permanently in the Sage library that is only compiled if a certain package is installed, and otherwise is left untouched?",
    "created_at": "2015-09-12T16:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136687",
    "user": "https://github.com/simon-king-jena"
}
```

Question on how to continue:

My aim is to provide a Cython wrapper, so, I need to copy meataxe.h to some include location.

But how to deal with the Cython wrapper? Apparently it would be in the Sage library, but apparently it will not compile if meataxe is not installed.

So, should the package install the cython code into the Sage library? Or is it possible to have code permanently in the Sage library that is only compiled if a certain package is installed, and otherwise is left untouched?



---

archive/issue_comments_136688.json:
```json
{
    "body": "PS: Note that MeatAxe has a nice documentation, and as usual it is installed if SAGE_SPKG_INSTALL_DOCS=yes.",
    "created_at": "2015-09-12T16:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136688",
    "user": "https://github.com/simon-king-jena"
}
```

PS: Note that MeatAxe has a nice documentation, and as usual it is installed if SAGE_SPKG_INSTALL_DOCS=yes.



---

archive/issue_comments_136689.json:
```json
{
    "body": "Replying to [comment:25 SimonKing]:\n> But one aspect has improved: MeatAxe used to rely on certain tables that were put (and when needed also created) in the current directory. And I had to patch the c-sources so that MeatAxe would be able to find the tables in a fixed directory. Now I cannot see any of these tables.\n\nI am afraid I stand corrected. Meanwhile I have a Cython wrapper on my laptop, and when I create a matrix over GF(2), then a file p002.zzz (defining multiplication table) is created in the current directory.\n\nThat's a very nasty property of MeatAxe. What shall we do about it? \n\nShall we leave it like that?\n\nShall I try to port my patch from 2.2.4 to 2.4.24 and ensure that all multiplication tables should be created in SAGE_ROOT/local/lib/meataxe/?",
    "created_at": "2015-09-13T08:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136689",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:25 SimonKing]:
> But one aspect has improved: MeatAxe used to rely on certain tables that were put (and when needed also created) in the current directory. And I had to patch the c-sources so that MeatAxe would be able to find the tables in a fixed directory. Now I cannot see any of these tables.

I am afraid I stand corrected. Meanwhile I have a Cython wrapper on my laptop, and when I create a matrix over GF(2), then a file p002.zzz (defining multiplication table) is created in the current directory.

That's a very nasty property of MeatAxe. What shall we do about it? 

Shall we leave it like that?

Shall I try to port my patch from 2.2.4 to 2.4.24 and ensure that all multiplication tables should be created in SAGE_ROOT/local/lib/meataxe/?



---

archive/issue_comments_136690.json:
```json
{
    "body": "Replying to [comment:32 SimonKing]:\n> Shall I try to port my patch from 2.2.4 to 2.4.24 and ensure that all multiplication tables should be created in SAGE_ROOT/local/lib/meataxe/?\n\nIf \"yes\": Where shall the tables be placed? In SAGE_LOCAL/share/meataxe/ perhaps?",
    "created_at": "2015-09-13T09:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136690",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:32 SimonKing]:
> Shall I try to port my patch from 2.2.4 to 2.4.24 and ensure that all multiplication tables should be created in SAGE_ROOT/local/lib/meataxe/?

If "yes": Where shall the tables be placed? In SAGE_LOCAL/share/meataxe/ perhaps?



---

archive/issue_comments_136691.json:
```json
{
    "body": "From the MeatAxe sources:\n\n```\n/**\n ** MeatAxe Library Directory.\n ** This variable contains the name of the MeatAxe library directory.\n ** Arithmetic table files are searched in this directory. The value of \n ** MtxLibDir can be set on the command line with the \"-L\" option. Otherwise, \n ** the value of the environment variable MTXLIB is used. If neither \"-L\" nor \n ** MTXLIB are defined, the default directory, which was selected when \n ** building the MeatAxe, is used.\n ** @see  MtxBinDir \n **/\n```\n\nSo, apparently the multiplication tables are supposed to be in MTXLIB. But that has NEVER worked for me.\n\nOr rather, it could be that MTXLIB has to be an environment variable at running time. Would it be acceptable that a module `sage.matrix.meataxe` sets an environment variable for MeatAxe? I'll test if that works.",
    "created_at": "2015-09-13T09:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136691",
    "user": "https://github.com/simon-king-jena"
}
```

From the MeatAxe sources:

```
/**
 ** MeatAxe Library Directory.
 ** This variable contains the name of the MeatAxe library directory.
 ** Arithmetic table files are searched in this directory. The value of 
 ** MtxLibDir can be set on the command line with the "-L" option. Otherwise, 
 ** the value of the environment variable MTXLIB is used. If neither "-L" nor 
 ** MTXLIB are defined, the default directory, which was selected when 
 ** building the MeatAxe, is used.
 ** @see  MtxBinDir 
 **/
```

So, apparently the multiplication tables are supposed to be in MTXLIB. But that has NEVER worked for me.

Or rather, it could be that MTXLIB has to be an environment variable at running time. Would it be acceptable that a module `sage.matrix.meataxe` sets an environment variable for MeatAxe? I'll test if that works.



---

archive/issue_comments_136692.json:
```json
{
    "body": "PS: It says \"Otherwise, the value of the environment variable MTXLIB is used.\"\nThat definitely does not work.",
    "created_at": "2015-09-13T09:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136692",
    "user": "https://github.com/simon-king-jena"
}
```

PS: It says "Otherwise, the value of the environment variable MTXLIB is used."
That definitely does not work.



---

archive/issue_comments_136693.json:
```json
{
    "body": "Setting the environment variable at running time doesn't work either. That's a bug that has always been present in MeatAxe. So, I guess I need to patch the sources.",
    "created_at": "2015-09-13T10:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136693",
    "user": "https://github.com/simon-king-jena"
}
```

Setting the environment variable at running time doesn't work either. That's a bug that has always been present in MeatAxe. So, I guess I need to patch the sources.



---

archive/issue_comments_136694.json:
```json
{
    "body": "Internally, MeatAxe stores MTXLIB in MtxLibDir. But directly defining MtxLibDir at run time didn't help. Sigh.",
    "created_at": "2015-09-13T10:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136694",
    "user": "https://github.com/simon-king-jena"
}
```

Internally, MeatAxe stores MTXLIB in MtxLibDir. But directly defining MtxLibDir at run time didn't help. Sigh.



---

archive/issue_comments_136695.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-13T15:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136696.json:
```json
{
    "body": "You shouldn't assume that the Sage directory is writeable. So the multiplication tables should be stored in `SAGE_TMP` or (if you want to keep them) in some other subdirectory of `DOT_SAGE`, probably `DOT_SAGE/meataxe-2.4.24/`.",
    "created_at": "2015-09-13T15:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136696",
    "user": "https://github.com/jhpalmieri"
}
```

You shouldn't assume that the Sage directory is writeable. So the multiplication tables should be stored in `SAGE_TMP` or (if you want to keep them) in some other subdirectory of `DOT_SAGE`, probably `DOT_SAGE/meataxe-2.4.24/`.



---

archive/issue_comments_136697.json:
```json
{
    "body": "Recent changes:\n\n- Since we want to wrap the code, it is needed to make the meataxe header available.\n- I found that packages are supposed to give a file called \"type\". I declare there that the package is supposed to be optional.\n- Since we move libmtx.a from a temporary location to somewhere in SAGE_LOCAL, it is needed to use \"-fPIC\".\n- The multiplication tables shouldn't pollute the user's current directory. I propose to store them in SAGE_SHARE/meataxe/.\n- MeatAxe has IO-functions that accept an argument saying that the file is a library file---but in the IO-functions, it is always first looked into the current directory, and the library location is only considered if the current directory didn't work.\n- In at least one function, the IO-argument for \"library files\" is used wrongly. So, after fixing the IO-function, the wrong argument needed to be fixed, too.\n\nIn meataxe/patches is a patch that fixes these two upstream bugs.\n\nCurrent status:\n\n- The package builds fine.\n- When running the testsuite, I sometimes see a wrong checksum, but when I repeat the testsuite, everything is fine. I guess upstream's checksum function is fragile. Not sure if I'm going to fix that.\n- With the Cython wrapper on my laptop, I can create MeatAxe matrices in a Sage session, and the current directory is not polluted by multiplication tables.\n\nTODO:\n\n- Finish the Cython wrapper.",
    "created_at": "2015-09-13T15:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136697",
    "user": "https://github.com/simon-king-jena"
}
```

Recent changes:

- Since we want to wrap the code, it is needed to make the meataxe header available.
- I found that packages are supposed to give a file called "type". I declare there that the package is supposed to be optional.
- Since we move libmtx.a from a temporary location to somewhere in SAGE_LOCAL, it is needed to use "-fPIC".
- The multiplication tables shouldn't pollute the user's current directory. I propose to store them in SAGE_SHARE/meataxe/.
- MeatAxe has IO-functions that accept an argument saying that the file is a library file---but in the IO-functions, it is always first looked into the current directory, and the library location is only considered if the current directory didn't work.
- In at least one function, the IO-argument for "library files" is used wrongly. So, after fixing the IO-function, the wrong argument needed to be fixed, too.

In meataxe/patches is a patch that fixes these two upstream bugs.

Current status:

- The package builds fine.
- When running the testsuite, I sometimes see a wrong checksum, but when I repeat the testsuite, everything is fine. I guess upstream's checksum function is fragile. Not sure if I'm going to fix that.
- With the Cython wrapper on my laptop, I can create MeatAxe matrices in a Sage session, and the current directory is not polluted by multiplication tables.

TODO:

- Finish the Cython wrapper.



---

archive/issue_comments_136698.json:
```json
{
    "body": "Replying to [comment:39 jhpalmieri]:\n> You shouldn't assume that the Sage directory is writeable. So the multiplication tables should be stored in `SAGE_TMP` or (if you want to keep them) in some other subdirectory of `DOT_SAGE`, probably `DOT_SAGE/meataxe-2.4.24/`.\n\nRight, that could be a problem. The tables should indeed be permanent. So, `DOT_SAGE/meataxe` (without version number) it is.",
    "created_at": "2015-09-13T15:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136698",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:39 jhpalmieri]:
> You shouldn't assume that the Sage directory is writeable. So the multiplication tables should be stored in `SAGE_TMP` or (if you want to keep them) in some other subdirectory of `DOT_SAGE`, probably `DOT_SAGE/meataxe-2.4.24/`.

Right, that could be a problem. The tables should indeed be permanent. So, `DOT_SAGE/meataxe` (without version number) it is.



---

archive/issue_comments_136699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-13T15:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136700.json:
```json
{
    "body": "Replying to [comment:41 SimonKing]:\n> Replying to [comment:39 jhpalmieri]:\n> > You shouldn't assume that the Sage directory is writeable. So the multiplication tables should be stored in `SAGE_TMP` or (if you want to keep them) in some other subdirectory of `DOT_SAGE`, probably `DOT_SAGE/meataxe-2.4.24/`.\n> \n> Right, that could be a problem. The tables should indeed be permanent. So, `DOT_SAGE/meataxe` (without version number) it is.\n\nAs long as you're pretty confident that the tables will be compatible with future versions. (We ran into this problem with `IPython` and `matplotlib`, which is why their directories in `DOT_SAGE` include the version number.)",
    "created_at": "2015-09-13T15:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136700",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:41 SimonKing]:
> Replying to [comment:39 jhpalmieri]:
> > You shouldn't assume that the Sage directory is writeable. So the multiplication tables should be stored in `SAGE_TMP` or (if you want to keep them) in some other subdirectory of `DOT_SAGE`, probably `DOT_SAGE/meataxe-2.4.24/`.
> 
> Right, that could be a problem. The tables should indeed be permanent. So, `DOT_SAGE/meataxe` (without version number) it is.

As long as you're pretty confident that the tables will be compatible with future versions. (We ran into this problem with `IPython` and `matplotlib`, which is why their directories in `DOT_SAGE` include the version number.)



---

archive/issue_comments_136701.json:
```json
{
    "body": "Replying to [comment:43 jhpalmieri]:\n> As long as you're pretty confident that the tables will be compatible with future versions. (We ran into this problem with `IPython` and `matplotlib`, which is why their directories in `DOT_SAGE` include the version number.)\n\nThe format hasn't changed since version 2.2.3, and the current version already is 4 years old. So, I don't think there will be changes any time soon.\n\nMoreover, if we really need to change it, we can create all multiplication tables (we have bounded field size) in a fraction of a second during package installation.",
    "created_at": "2015-09-13T15:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136701",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:43 jhpalmieri]:
> As long as you're pretty confident that the tables will be compatible with future versions. (We ran into this problem with `IPython` and `matplotlib`, which is why their directories in `DOT_SAGE` include the version number.)

The format hasn't changed since version 2.2.3, and the current version already is 4 years old. So, I don't think there will be changes any time soon.

Moreover, if we really need to change it, we can create all multiplication tables (we have bounded field size) in a fraction of a second during package installation.



---

archive/issue_comments_136702.json:
```json
{
    "body": "Replying to [comment:44 SimonKing]:\n> Moreover, if we really need to change it, we can create all multiplication tables (we have bounded field size) in a fraction of a second during package installation.\n\nAaahm, if we use SAGE_SHARE.\n\nAnyway, if things really go bad in future meataxe versions, it should be possible to patch it so that invalid old multiplication tables are automatically removed when accidentally opening them.",
    "created_at": "2015-09-13T15:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136702",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:44 SimonKing]:
> Moreover, if we really need to change it, we can create all multiplication tables (we have bounded field size) in a fraction of a second during package installation.

Aaahm, if we use SAGE_SHARE.

Anyway, if things really go bad in future meataxe versions, it should be possible to patch it so that invalid old multiplication tables are automatically removed when accidentally opening them.



---

archive/issue_comments_136703.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-18T08:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136703",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136704.json:
```json
{
    "body": "In the recent commit, patches `StrassenWinogradImplementation.patch` and `StrassenWinogradUsage.patch` are provided.\n\nThere, I implement the Winograd-Strassen multiplication algorithm in MeatAxe. I optimized the cutoff parameter using a Cython wrapper that I didn't post yet (needs doctests and needs to wrap echelonisation).\n\nI tested on matrices of different sizes and different fields. First of all, the school book multiplication in MeatAxe is vastly faster than the current matrix multiplication in Sage for all non-prime finite fields of odd characteristic (of course with field order < 256).\n\nMoreover, it turns out that the Winograd-Strassen implementation is not only asymptotically fast, but even on small examples (200x200) is as fast as MeatAxe's school book multiplication. So, I think it makes sense to use it not only in my Cython wrapper but also in the MeatAxe functions/executables, which is done in `StrassenWinogradUsage.patch`.\n\nThe fact that MeatAxe's test suite still works is an indicative that my Winograd-Strassen implementation ok.\n\nOf course it will be even clearer in the Cython wrapper that will be subject of the next commit. Then, I'll show timings.",
    "created_at": "2015-09-18T10:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136704",
    "user": "https://github.com/simon-king-jena"
}
```

In the recent commit, patches `StrassenWinogradImplementation.patch` and `StrassenWinogradUsage.patch` are provided.

There, I implement the Winograd-Strassen multiplication algorithm in MeatAxe. I optimized the cutoff parameter using a Cython wrapper that I didn't post yet (needs doctests and needs to wrap echelonisation).

I tested on matrices of different sizes and different fields. First of all, the school book multiplication in MeatAxe is vastly faster than the current matrix multiplication in Sage for all non-prime finite fields of odd characteristic (of course with field order < 256).

Moreover, it turns out that the Winograd-Strassen implementation is not only asymptotically fast, but even on small examples (200x200) is as fast as MeatAxe's school book multiplication. So, I think it makes sense to use it not only in my Cython wrapper but also in the MeatAxe functions/executables, which is done in `StrassenWinogradUsage.patch`.

The fact that MeatAxe's test suite still works is an indicative that my Winograd-Strassen implementation ok.

Of course it will be even clearer in the Cython wrapper that will be subject of the next commit. Then, I'll show timings.



---

archive/issue_comments_136705.json:
```json
{
    "body": "The tarball is badly made: there should be top-level directory like `meataxe-2.4.24` with everything contained in that directory.\n\nAlso, we no longer list maintainers in `SPKG.txt` (#19238)",
    "created_at": "2015-09-18T11:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136705",
    "user": "https://github.com/jdemeyer"
}
```

The tarball is badly made: there should be top-level directory like `meataxe-2.4.24` with everything contained in that directory.

Also, we no longer list maintainers in `SPKG.txt` (#19238)



---

archive/issue_comments_136706.json:
```json
{
    "body": "Patches need to be documented (preferably in the patch itself). In particular: where do the patches come from?",
    "created_at": "2015-09-18T11:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136706",
    "user": "https://github.com/jdemeyer"
}
```

Patches need to be documented (preferably in the patch itself). In particular: where do the patches come from?



---

archive/issue_comments_136707.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> The tarball is badly made:\n\nComplain to upstream. The tarball is directly from their website. I'm not going to fix that.",
    "created_at": "2015-09-18T11:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136707",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:49 jdemeyer]:
> The tarball is badly made:

Complain to upstream. The tarball is directly from their website. I'm not going to fix that.



---

archive/issue_comments_136708.json:
```json
{
    "body": "Replying to [comment:50 jdemeyer]:\n> Patches need to be documented (preferably in the patch itself).\n\nRight, I did so (if I recall correctly) for the first patch concerning IO-fixes, but failed for the other two.\n\n> In particular: where do the patches come from?\n\nMy name suffices?",
    "created_at": "2015-09-18T11:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136708",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:50 jdemeyer]:
> Patches need to be documented (preferably in the patch itself).

Right, I did so (if I recall correctly) for the first patch concerning IO-fixes, but failed for the other two.

> In particular: where do the patches come from?

My name suffices?



---

archive/issue_comments_136709.json:
```json
{
    "body": "Replying to [comment:51 SimonKing]:\n> Replying to [comment:49 jdemeyer]:\n> > The tarball is badly made:\n> \n> Complain to upstream. The tarball is directly from their website. I'm not going to fix that.\n\nOr would it be ok to repack the upstream tarball? I thought the purpose of the new-style packages is to use clean upstream sources?",
    "created_at": "2015-09-18T11:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136709",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:51 SimonKing]:
> Replying to [comment:49 jdemeyer]:
> > The tarball is badly made:
> 
> Complain to upstream. The tarball is directly from their website. I'm not going to fix that.

Or would it be ok to repack the upstream tarball? I thought the purpose of the new-style packages is to use clean upstream sources?



---

archive/issue_comments_136710.json:
```json
{
    "body": "I guess nobody except myself uses the branch. Hence, I will rebase and force-push the changes requested by Jeroen, unless someone tells me not to.",
    "created_at": "2015-09-18T11:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136710",
    "user": "https://github.com/simon-king-jena"
}
```

I guess nobody except myself uses the branch. Hence, I will rebase and force-push the changes requested by Jeroen, unless someone tells me not to.



---

archive/issue_comments_136711.json:
```json
{
    "body": "Replying to [comment:53 SimonKing]:\n> Or would it be ok to repack the upstream tarball?\nYes. In this case, it is clearly needed.\n\nI am going to complain to upstream by the way.",
    "created_at": "2015-09-18T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136711",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:53 SimonKing]:
> Or would it be ok to repack the upstream tarball?
Yes. In this case, it is clearly needed.

I am going to complain to upstream by the way.



---

archive/issue_comments_136712.json:
```json
{
    "body": "Replying to [comment:52 SimonKing]:\n> My name suffices?\nYes, it should somehow be clear that you wrote the patch, that it's not an official patch from upstream. Have the patches been submitted upstream? They should be!",
    "created_at": "2015-09-18T11:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136712",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:52 SimonKing]:
> My name suffices?
Yes, it should somehow be clear that you wrote the patch, that it's not an official patch from upstream. Have the patches been submitted upstream? They should be!



---

archive/issue_comments_136713.json:
```json
{
    "body": "Replying to [comment:54 SimonKing]:\n> Hence, I will rebase and force-push the changes requested by Jeroen, unless someone tells me not to.\n\nGo ahead. If you're rebasing, you might as well squash everything in one commit (with the `f` option in `git rebase -i`)",
    "created_at": "2015-09-18T11:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136713",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:54 SimonKing]:
> Hence, I will rebase and force-push the changes requested by Jeroen, unless someone tells me not to.

Go ahead. If you're rebasing, you might as well squash everything in one commit (with the `f` option in `git rebase -i`)



---

archive/issue_comments_136714.json:
```json
{
    "body": "After replacing the old tarball by a new one called `meataxe-2.4.24.p0.tar.gz`, I did `./sage -fix-pkg-checksums`. However, it did not produce a new `checksum.ini` in `build/pkgs/meataxe/`.\n\nWhat can I do now?",
    "created_at": "2015-09-18T12:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136714",
    "user": "https://github.com/simon-king-jena"
}
```

After replacing the old tarball by a new one called `meataxe-2.4.24.p0.tar.gz`, I did `./sage -fix-pkg-checksums`. However, it did not produce a new `checksum.ini` in `build/pkgs/meataxe/`.

What can I do now?



---

archive/issue_comments_136715.json:
```json
{
    "body": "Aha. Apparently it was needed to call it `meataxe-2.4.24.tar.gz` without .p0.",
    "created_at": "2015-09-18T12:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136715",
    "user": "https://github.com/simon-king-jena"
}
```

Aha. Apparently it was needed to call it `meataxe-2.4.24.tar.gz` without .p0.



---

archive/issue_comments_136716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-18T12:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136717.json:
```json
{
    "body": "Repackaged upstream sources",
    "created_at": "2015-09-18T12:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136717",
    "user": "https://github.com/simon-king-jena"
}
```

Repackaged upstream sources



---

archive/issue_comments_136718.json:
```json
{
    "body": "Attachment [meataxe-2.4.24.tar.gz](tarball://root/attachments/some-uuid/ticket12103/meataxe-2.4.24.tar.gz) by @simon-king-jena created at 2015-09-18 12:35:12",
    "created_at": "2015-09-18T12:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136718",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [meataxe-2.4.24.tar.gz](tarball://root/attachments/some-uuid/ticket12103/meataxe-2.4.24.tar.gz) by @simon-king-jena created at 2015-09-18 12:35:12



---

archive/issue_comments_136719.json:
```json
{
    "body": "Replying to [comment:57 jdemeyer]:\n> Go ahead. If you're rebasing, you might as well squash everything in one commit (with the `f` option in `git rebase -i`)\n\nDone. I kept two commits of largely different purpose. The first makes MeatAxe build and install its tables into `DOT_SAGE`. The second commit implements and uses Winograd-Strassen multiplication in MeatAxe.\n\nThe self-tests (by `sage -f -c meataxe`) should pass. I don't know why they are a little flaky. Perhaps a race condition? Anyway, I think that's an upstream problem. Most of the time, the self-tests just pass fine.\n\nThe third commit will be cython wrapper for MeatAxe with which I can demonstrate that things work correct and very fast. And then I have to deal with doctests.",
    "created_at": "2015-09-18T12:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136719",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:57 jdemeyer]:
> Go ahead. If you're rebasing, you might as well squash everything in one commit (with the `f` option in `git rebase -i`)

Done. I kept two commits of largely different purpose. The first makes MeatAxe build and install its tables into `DOT_SAGE`. The second commit implements and uses Winograd-Strassen multiplication in MeatAxe.

The self-tests (by `sage -f -c meataxe`) should pass. I don't know why they are a little flaky. Perhaps a race condition? Anyway, I think that's an upstream problem. Most of the time, the self-tests just pass fine.

The third commit will be cython wrapper for MeatAxe with which I can demonstrate that things work correct and very fast. And then I have to deal with doctests.



---

archive/issue_comments_136720.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> Replying to [comment:52 SimonKing]:\n> > My name suffices?\n> Yes, it should somehow be clear that you wrote the patch, that it's not an official patch from upstream. Have the patches been submitted upstream? They should be!\n\nLong time ago, I have submitted a Winograd-Strassen patch for version 2.2.4 to upstream. But too much has changed since version 2.2.4, the old patches are useless.\n\nBut for sure it makes sense to submit the new three patches to upstream. Even the first one is useful. I wonder why upstream keeps telling that multiplication tables are stored in `MTX_LIB` when in the last 10 years they have always been installed in the current directory.",
    "created_at": "2015-09-18T12:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136720",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:56 jdemeyer]:
> Replying to [comment:52 SimonKing]:
> > My name suffices?
> Yes, it should somehow be clear that you wrote the patch, that it's not an official patch from upstream. Have the patches been submitted upstream? They should be!

Long time ago, I have submitted a Winograd-Strassen patch for version 2.2.4 to upstream. But too much has changed since version 2.2.4, the old patches are useless.

But for sure it makes sense to submit the new three patches to upstream. Even the first one is useful. I wonder why upstream keeps telling that multiplication tables are stored in `MTX_LIB` when in the last 10 years they have always been installed in the current directory.



---

archive/issue_comments_136721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-18T12:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136722.json:
```json
{
    "body": "Replying to [comment:64 SimonKing]:\n> Long time ago, I have submitted a Winograd-Strassen patch for version 2.2.4 to upstream. But too much has changed since version 2.2.4, the old patches are useless.\nI don't understand. In this ticket, you are adding patches to a package which you claim yourself are useless???",
    "created_at": "2015-09-18T13:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136722",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:64 SimonKing]:
> Long time ago, I have submitted a Winograd-Strassen patch for version 2.2.4 to upstream. But too much has changed since version 2.2.4, the old patches are useless.
I don't understand. In this ticket, you are adding patches to a package which you claim yourself are useless???



---

archive/issue_comments_136723.json:
```json
{
    "body": "The last commit really isn't finished yet (most tests and much documentation is missing). But for now it is enough to demonstrate the progress compared with the current Sage beta.\n\nPlease make sure that you use attachment:meataxe-2.4.24.tar.gz, not the source tarball from the upstream download page.\n\nIn the latest development version, we have\n\n```\nsage: MS = MatrixSpace(GF(5^3,'y'),2000)\nsage: %time A = MS.random_element()\nCPU times: user 6.71 s, sys: 20 ms, total: 6.73 s\nWall time: 6.79 s\nsage: type(A)\n<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>\nsage: B = MS.random_element()\nsage: %time A*B\nCPU times: user 23min 49s, sys: 490 ms, total: 23min 50s\nWall time: 23min 55s # using 7.5% of my computer's memory\n2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)\nsage: %time ~A\nCPU times: user 23min 42s, sys: 842 ms, total: 23min 43s\nWall time: 23min 47s # using 11.3% of my computer's memory\n2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)\n```\n\n\n23 minutes for a single multiplication or inversion of a not so big matrix over a small field!!\n\nYou see why I see the need of a different backend?\n\nHere is the same example when the optional meataxe package (and its wrapper) is used:\n\n```\nsage: MS = MatrixSpace(GF(5^3,'y'),2000)\nsage: %time A = MS.random_element()\nCPU times: user 320 ms, sys: 5 ms, total: 325 ms\nWall time: 351 ms\nsage: type(A)\n<type 'sage.matrix.matrix_modpn_dense.Matrix_modpn_dense'>\nsage: B = MS.random_element()\nsage: %time A*B  # using 4.8% of my computer's memory\nCPU times: user 14.4 s, sys: 1 ms, total: 14.4 s\nWall time: 14.4 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)\nsage: %time ~A   # using 5.9% of my computer's memory\nCPU times: user 32.7 s, sys: 69 ms, total: 32.8 s\nWall time: 33.2 s\n2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)\nsage: %time _*A == A*_ == 1\nCPU times: user 28.7 s, sys: 60 ms, total: 28.8 s\nWall time: 29 s\nTrue\n```\n\nThe last example indicates that the (Strassen) multiplication is vastly faster than what we have now in Sage.\n\nAdmittedly, the patched MeatAxe is still a lot slower than linbox for prime fields or M4RIE for characteristic 2. That's why I only suggest to use it for non-prime fields of odd characteristic.\n\nBy the way, MeatAxe is supposed to have a different kernel for fields of size > 255. But strangely, the respective source file is not in the upstream source tarball.",
    "created_at": "2015-09-18T13:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136723",
    "user": "https://github.com/simon-king-jena"
}
```

The last commit really isn't finished yet (most tests and much documentation is missing). But for now it is enough to demonstrate the progress compared with the current Sage beta.

Please make sure that you use attachment:meataxe-2.4.24.tar.gz, not the source tarball from the upstream download page.

In the latest development version, we have

```
sage: MS = MatrixSpace(GF(5^3,'y'),2000)
sage: %time A = MS.random_element()
CPU times: user 6.71 s, sys: 20 ms, total: 6.73 s
Wall time: 6.79 s
sage: type(A)
<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>
sage: B = MS.random_element()
sage: %time A*B
CPU times: user 23min 49s, sys: 490 ms, total: 23min 50s
Wall time: 23min 55s # using 7.5% of my computer's memory
2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)
sage: %time ~A
CPU times: user 23min 42s, sys: 842 ms, total: 23min 43s
Wall time: 23min 47s # using 11.3% of my computer's memory
2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)
```


23 minutes for a single multiplication or inversion of a not so big matrix over a small field!!

You see why I see the need of a different backend?

Here is the same example when the optional meataxe package (and its wrapper) is used:

```
sage: MS = MatrixSpace(GF(5^3,'y'),2000)
sage: %time A = MS.random_element()
CPU times: user 320 ms, sys: 5 ms, total: 325 ms
Wall time: 351 ms
sage: type(A)
<type 'sage.matrix.matrix_modpn_dense.Matrix_modpn_dense'>
sage: B = MS.random_element()
sage: %time A*B  # using 4.8% of my computer's memory
CPU times: user 14.4 s, sys: 1 ms, total: 14.4 s
Wall time: 14.4 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)
sage: %time ~A   # using 5.9% of my computer's memory
CPU times: user 32.7 s, sys: 69 ms, total: 32.8 s
Wall time: 33.2 s
2000 x 2000 dense matrix over Finite Field in y of size 5^3 (use the '.str()' method to see the entries)
sage: %time _*A == A*_ == 1
CPU times: user 28.7 s, sys: 60 ms, total: 28.8 s
Wall time: 29 s
True
```

The last example indicates that the (Strassen) multiplication is vastly faster than what we have now in Sage.

Admittedly, the patched MeatAxe is still a lot slower than linbox for prime fields or M4RIE for characteristic 2. That's why I only suggest to use it for non-prime fields of odd characteristic.

By the way, MeatAxe is supposed to have a different kernel for fields of size > 255. But strangely, the respective source file is not in the upstream source tarball.



---

archive/issue_comments_136724.json:
```json
{
    "body": "The meataxe part of `src/sage/matrix/matrix_modpn_dense.pxd` should probably be moved to `src/sage/libs/meataxe.pxd` or `src/sage/libs/meataxe/multiple_files_here.pxd`\n\nAlso, can you use the standard heading template from [http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files](http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files)",
    "created_at": "2015-09-18T13:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136724",
    "user": "https://github.com/jdemeyer"
}
```

The meataxe part of `src/sage/matrix/matrix_modpn_dense.pxd` should probably be moved to `src/sage/libs/meataxe.pxd` or `src/sage/libs/meataxe/multiple_files_here.pxd`

Also, can you use the standard heading template from [http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files](http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files)



---

archive/issue_comments_136725.json:
```json
{
    "body": "Replying to [comment:66 jdemeyer]:\n> Replying to [comment:64 SimonKing]:\n> > Long time ago, I have submitted a Winograd-Strassen patch for version 2.2.4 to upstream. But too much has changed since version 2.2.4, the old patches are useless.\n> I don't understand. In this ticket, you are adding patches to a package which you claim yourself are useless???\n\nThe patches FOR THE OLD VERSION 2.2.4 that I send to upstream a couple of years ago are useless FOR THE CURRENT VERSION 2.4.24. All function and struct names in MeatAxe have changed between version 2.2.4 and 2.4.24.",
    "created_at": "2015-09-18T13:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136725",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:66 jdemeyer]:
> Replying to [comment:64 SimonKing]:
> > Long time ago, I have submitted a Winograd-Strassen patch for version 2.2.4 to upstream. But too much has changed since version 2.2.4, the old patches are useless.
> I don't understand. In this ticket, you are adding patches to a package which you claim yourself are useless???

The patches FOR THE OLD VERSION 2.2.4 that I send to upstream a couple of years ago are useless FOR THE CURRENT VERSION 2.4.24. All function and struct names in MeatAxe have changed between version 2.2.4 and 2.4.24.



---

archive/issue_comments_136726.json:
```json
{
    "body": "Replying to [comment:69 SimonKing]:\n> The patches FOR THE OLD VERSION 2.2.4 that I send to upstream a couple of years ago are useless FOR THE CURRENT VERSION 2.4.24. All function and struct names in MeatAxe have changed between version 2.2.4 and 2.4.24.\n\nOK, but does it make sense to send the *new* patches to upstream again?",
    "created_at": "2015-09-18T13:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136726",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:69 SimonKing]:
> The patches FOR THE OLD VERSION 2.2.4 that I send to upstream a couple of years ago are useless FOR THE CURRENT VERSION 2.4.24. All function and struct names in MeatAxe have changed between version 2.2.4 and 2.4.24.

OK, but does it make sense to send the *new* patches to upstream again?



---

archive/issue_comments_136727.json:
```json
{
    "body": "Replying to [comment:68 jdemeyer]:\n> `src/sage/matrix/matrix_modpn_dense.pxd` should probably be moved to `src/sage/libs/meataxe.pxd` or `src/sage/libs/meataxe/multiple_files_here.pxd`\n\nI don't think that meataxe.pxd is a good name. It is a dense implementation for matrices over `GF(p^n)`, and thus it is `matrix_modpn_dense.pxd`. This is totally analogous to `matrix_mod2e_dense.pxd`; or do you suggest to rename the latter by `m4rie.pxd`?\n\n> Also, can you use the standard heading template from [http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files](http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files)\n\nI think I have copied the heading from some existing pxd files. But I can change it.",
    "created_at": "2015-09-18T13:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136727",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:68 jdemeyer]:
> `src/sage/matrix/matrix_modpn_dense.pxd` should probably be moved to `src/sage/libs/meataxe.pxd` or `src/sage/libs/meataxe/multiple_files_here.pxd`

I don't think that meataxe.pxd is a good name. It is a dense implementation for matrices over `GF(p^n)`, and thus it is `matrix_modpn_dense.pxd`. This is totally analogous to `matrix_mod2e_dense.pxd`; or do you suggest to rename the latter by `m4rie.pxd`?

> Also, can you use the standard heading template from [http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files](http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files)

I think I have copied the heading from some existing pxd files. But I can change it.



---

archive/issue_comments_136728.json:
```json
{
    "body": "If I understand things correctly, the `modpn` in the filename refers to a finite field of size `p^n`, right? That's a very confusing name, can you use `matrix_gfpn_dense.pyx` or something?",
    "created_at": "2015-09-18T13:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136728",
    "user": "https://github.com/jdemeyer"
}
```

If I understand things correctly, the `modpn` in the filename refers to a finite field of size `p^n`, right? That's a very confusing name, can you use `matrix_gfpn_dense.pyx` or something?



---

archive/issue_comments_136729.json:
```json
{
    "body": "Replying to [comment:70 jdemeyer]:\n> Replying to [comment:69 SimonKing]:\n> > The patches FOR THE OLD VERSION 2.2.4 that I send to upstream a couple of years ago are useless FOR THE CURRENT VERSION 2.4.24. All function and struct names in MeatAxe have changed between version 2.2.4 and 2.4.24.\n> \n> OK, but does it make sense to send the *new* patches to upstream again?\n\nAs I said in comment:64: \"But for sure it makes sense to submit the new three patches to upstream.\"",
    "created_at": "2015-09-18T13:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136729",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:70 jdemeyer]:
> Replying to [comment:69 SimonKing]:
> > The patches FOR THE OLD VERSION 2.2.4 that I send to upstream a couple of years ago are useless FOR THE CURRENT VERSION 2.4.24. All function and struct names in MeatAxe have changed between version 2.2.4 and 2.4.24.
> 
> OK, but does it make sense to send the *new* patches to upstream again?

As I said in comment:64: "But for sure it makes sense to submit the new three patches to upstream."



---

archive/issue_comments_136730.json:
```json
{
    "body": "Replying to [comment:71 SimonKing]:\n> This is totally analogous to `matrix_mod2e_dense.pxd`; or do you suggest to rename the latter by `m4rie.pxd`?\nThat file actually exists: `src/sage/libs/m4rie.pxd`\n\nIt's cimported by `matrix_mod2e_dense.pxd`, which is what you should do for meataxe also: separate the Sage matrix stuff from the meataxe library stuff.",
    "created_at": "2015-09-18T13:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136730",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:71 SimonKing]:
> This is totally analogous to `matrix_mod2e_dense.pxd`; or do you suggest to rename the latter by `m4rie.pxd`?
That file actually exists: `src/sage/libs/m4rie.pxd`

It's cimported by `matrix_mod2e_dense.pxd`, which is what you should do for meataxe also: separate the Sage matrix stuff from the meataxe library stuff.



---

archive/issue_comments_136731.json:
```json
{
    "body": "Replying to [comment:72 jdemeyer]:\n> If I understand things correctly, the `modpn` in the filename refers to a finite field of size `p^n`, right? That's a very confusing name, can you use `matrix_gfpn_dense.pyx` or something?\n\nDo you suggest to rename Martin Albrecht's `matrix_mod2e_dense.pyx` to `matrix_gf2e_dense.pyx`? By the way, IIRC that's where I got the heading from.\n\nI think we should be consistent with the existing naming scheme. We currently have `matrix_modn_dense`, `matrix_mod2_dense`, `matrix_mod2e_dense`, and the obvious continuation of that scheme is `matrix_modpn_dense`.",
    "created_at": "2015-09-18T13:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136731",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:72 jdemeyer]:
> If I understand things correctly, the `modpn` in the filename refers to a finite field of size `p^n`, right? That's a very confusing name, can you use `matrix_gfpn_dense.pyx` or something?

Do you suggest to rename Martin Albrecht's `matrix_mod2e_dense.pyx` to `matrix_gf2e_dense.pyx`? By the way, IIRC that's where I got the heading from.

I think we should be consistent with the existing naming scheme. We currently have `matrix_modn_dense`, `matrix_mod2_dense`, `matrix_mod2e_dense`, and the obvious continuation of that scheme is `matrix_modpn_dense`.



---

archive/issue_comments_136732.json:
```json
{
    "body": "Replying to [comment:74 jdemeyer]:\n> Replying to [comment:71 SimonKing]:\n> > This is totally analogous to `matrix_mod2e_dense.pxd`; or do you suggest to rename the latter by `m4rie.pxd`?\n> That file actually exists: `src/sage/libs/m4rie.pxd`\n\nAha! Now I understand.\n\nOK, that makes more sense. Have a `src/sage/libs/meataxe.pxd` without a corresponding `.pyx` file, and do the rest in `src/sage/matrix/matrix_modpn_dense.p??`, which imports from `sage.libs.meataxe`.",
    "created_at": "2015-09-18T13:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136732",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:74 jdemeyer]:
> Replying to [comment:71 SimonKing]:
> > This is totally analogous to `matrix_mod2e_dense.pxd`; or do you suggest to rename the latter by `m4rie.pxd`?
> That file actually exists: `src/sage/libs/m4rie.pxd`

Aha! Now I understand.

OK, that makes more sense. Have a `src/sage/libs/meataxe.pxd` without a corresponding `.pyx` file, and do the rest in `src/sage/matrix/matrix_modpn_dense.p??`, which imports from `sage.libs.meataxe`.



---

archive/issue_comments_136733.json:
```json
{
    "body": "Replying to [comment:76 SimonKing]:\n> Do you suggest to rename Martin Albrecht's `matrix_mod2e_dense.pyx` to `matrix_gf2e_dense.pyx`?\nYes!! It's a very confusing name.",
    "created_at": "2015-09-18T13:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136733",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:76 SimonKing]:
> Do you suggest to rename Martin Albrecht's `matrix_mod2e_dense.pyx` to `matrix_gf2e_dense.pyx`?
Yes!! It's a very confusing name.



---

archive/issue_comments_136734.json:
```json
{
    "body": "Replying to [comment:77 SimonKing]:\n> Have a `src/sage/libs/meataxe.pxd` without a corresponding `.pyx` file, and do the rest in `src/sage/matrix/matrix_modpn_dense.p??`, which imports from `sage.libs.meataxe`.\n\nYes, exactly. It's good practice to separate the library (which has nothing to do with Sage) from the Sage interface.",
    "created_at": "2015-09-18T13:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136734",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:77 SimonKing]:
> Have a `src/sage/libs/meataxe.pxd` without a corresponding `.pyx` file, and do the rest in `src/sage/matrix/matrix_modpn_dense.p??`, which imports from `sage.libs.meataxe`.

Yes, exactly. It's good practice to separate the library (which has nothing to do with Sage) from the Sage interface.



---

archive/issue_comments_136735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-18T13:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136736.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-18T13:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136737.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-18T13:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136738.json:
```json
{
    "body": "Replying to [comment:78 jdemeyer]:\n> Replying to [comment:76 SimonKing]:\n> > Do you suggest to rename Martin Albrecht's `matrix_mod2e_dense.pyx` to `matrix_gf2e_dense.pyx`?\n> Yes!! It's a very confusing name.\n\nOK, if you are so determined, then I better change my module and class name, which is done in the previous (forced) commit.\n\nI think I will now let it rest for a few hours, and then I'll tell how I found the default cutoff for Winograd-Strassen multiplication.",
    "created_at": "2015-09-18T13:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136738",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:78 jdemeyer]:
> Replying to [comment:76 SimonKing]:
> > Do you suggest to rename Martin Albrecht's `matrix_mod2e_dense.pyx` to `matrix_gf2e_dense.pyx`?
> Yes!! It's a very confusing name.

OK, if you are so determined, then I better change my module and class name, which is done in the previous (forced) commit.

I think I will now let it rest for a few hours, and then I'll tell how I found the default cutoff for Winograd-Strassen multiplication.



---

archive/issue_comments_136739.json:
```json
{
    "body": "I tested that classical multiplication yields the same result as Strassen multiplication, for various fields (GF(q) for q=4,8,9,25,27,32,125,243). No problem. Then I tested GF(2)---and got different results. Sigh. I don't know what's wrong with 2, but I need to debug it.",
    "created_at": "2015-09-18T19:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136739",
    "user": "https://github.com/simon-king-jena"
}
```

I tested that classical multiplication yields the same result as Strassen multiplication, for various fields (GF(q) for q=4,8,9,25,27,32,125,243). No problem. Then I tested GF(2)---and got different results. Sigh. I don't know what's wrong with 2, but I need to debug it.



---

archive/issue_comments_136740.json:
```json
{
    "body": "In `meataxe.pxd`, I assume that `ctypedef struct FILE` refers to the `<stdio.h>` type `FILE`? In that case, it's better to use\n\n```\nfrom libc.stdio cimport FILE\n```\n\n(or even remove that line altogether, since you don't actually use `FILE`)",
    "created_at": "2015-09-19T09:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136740",
    "user": "https://github.com/jdemeyer"
}
```

In `meataxe.pxd`, I assume that `ctypedef struct FILE` refers to the `<stdio.h>` type `FILE`? In that case, it's better to use

```
from libc.stdio cimport FILE
```

(or even remove that line altogether, since you don't actually use `FILE`)



---

archive/issue_comments_136741.json:
```json
{
    "body": "In `spkg-install`, why this?\n\n```\nPATCHES=../patches\nfor patch in \"$PATCHES\"/*.patch; do\n```\n\nIt's not wrong, but usually one simply does\n\n```\nfor patch in ../patches/*.patch; do\n```\n",
    "created_at": "2015-09-19T10:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136741",
    "user": "https://github.com/jdemeyer"
}
```

In `spkg-install`, why this?

```
PATCHES=../patches
for patch in "$PATCHES"/*.patch; do
```

It's not wrong, but usually one simply does

```
for patch in ../patches/*.patch; do
```




---

archive/issue_comments_136742.json:
```json
{
    "body": "Replying to [comment:85 jdemeyer]:\n> In `meataxe.pxd`, I assume that `ctypedef struct FILE` refers to the `<stdio.h>` type `FILE`? In that case, it's better to use\n> {{{\n> from libc.stdio cimport FILE\n> }}}\n> (or even remove that line altogether, since you don't actually use `FILE`)\n\nI refer to whatever MeatAxe refers to. But you are right, I don't use it. Similarly I don't use `Ulong`, `Ushort` etc. I left them in for completeness.",
    "created_at": "2015-09-19T10:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136742",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:85 jdemeyer]:
> In `meataxe.pxd`, I assume that `ctypedef struct FILE` refers to the `<stdio.h>` type `FILE`? In that case, it's better to use
> {{{
> from libc.stdio cimport FILE
> }}}
> (or even remove that line altogether, since you don't actually use `FILE`)

I refer to whatever MeatAxe refers to. But you are right, I don't use it. Similarly I don't use `Ulong`, `Ushort` etc. I left them in for completeness.



---

archive/issue_comments_136743.json:
```json
{
    "body": "Replying to [comment:86 jdemeyer]:\n> In `spkg-install`, why this?\n> {{{\n> PATCHES=../patches\n> for patch in \"$PATCHES\"/*.patch; do\n> }}}\n> It's not wrong, but usually one simply does\n> {{{\n> for patch in ../patches/*.patch; do\n> }}}\n\nI guess I copied it from somewhere. But \"somewhere\" probably means a package in which the \"patches\" folder is referred to repeatedly.",
    "created_at": "2015-09-19T10:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136743",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:86 jdemeyer]:
> In `spkg-install`, why this?
> {{{
> PATCHES=../patches
> for patch in "$PATCHES"/*.patch; do
> }}}
> It's not wrong, but usually one simply does
> {{{
> for patch in ../patches/*.patch; do
> }}}

I guess I copied it from somewhere. But "somewhere" probably means a package in which the "patches" folder is referred to repeatedly.



---

archive/issue_comments_136744.json:
```json
{
    "body": "Meanwhile I know that the wrong results of Strassen multiplication in field order 2 come from the function `FfAddMapRowWindow`, which in fact has a special case for the field of order 2. This function is a modification of the MeatAxe function `FfMapRow`. So, I have to find out where my modifications went wrong.",
    "created_at": "2015-09-19T10:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136744",
    "user": "https://github.com/simon-king-jena"
}
```

Meanwhile I know that the wrong results of Strassen multiplication in field order 2 come from the function `FfAddMapRowWindow`, which in fact has a special case for the field of order 2. This function is a modification of the MeatAxe function `FfMapRow`. So, I have to find out where my modifications went wrong.



---

archive/issue_comments_136745.json:
```json
{
    "body": "Replying to [comment:87 SimonKing]:\n> I refer to whatever MeatAxe refers to.\nI don't understand what you mean with \"refers to\".\n\nI hope that meataxe does not redefine `FILE` (otherwise it's more broken than I thought).\n\n> Similarly I don't use `Ulong`, `Ushort` etc.\nThis is different, since these are meataxe-specific.",
    "created_at": "2015-09-19T10:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136745",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:87 SimonKing]:
> I refer to whatever MeatAxe refers to.
I don't understand what you mean with "refers to".

I hope that meataxe does not redefine `FILE` (otherwise it's more broken than I thought).

> Similarly I don't use `Ulong`, `Ushort` etc.
This is different, since these are meataxe-specific.



---

archive/issue_comments_136746.json:
```json
{
    "body": "Replying to [comment:90 jdemeyer]:\n> Replying to [comment:87 SimonKing]:\n> > I refer to whatever MeatAxe refers to.\n> I don't understand what you mean with \"refers to\".\n\nHm. Now I am puzzled myself. I thought for a few minutes that I found it in meataxe.h of version 2.2.4, and when I ported my wrapper to version 2.4.24 I didn't check if it is still there. But now I checked: FILE is *not* defined in meataxe.h, neither in the old nor the new version.\n\n> I hope that meataxe does not redefine `FILE` (otherwise it's more broken than I thought).\n\nIt doesn't. It does `#include <stdio.h>` both in the old and the new version.",
    "created_at": "2015-09-19T10:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136746",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:90 jdemeyer]:
> Replying to [comment:87 SimonKing]:
> > I refer to whatever MeatAxe refers to.
> I don't understand what you mean with "refers to".

Hm. Now I am puzzled myself. I thought for a few minutes that I found it in meataxe.h of version 2.2.4, and when I ported my wrapper to version 2.4.24 I didn't check if it is still there. But now I checked: FILE is *not* defined in meataxe.h, neither in the old nor the new version.

> I hope that meataxe does not redefine `FILE` (otherwise it's more broken than I thought).

It doesn't. It does `#include <stdio.h>` both in the old and the new version.



---

archive/issue_comments_136747.json:
```json
{
    "body": "Replying to [comment:91 SimonKing]:\n> It doesn't. It does `#include <stdio.h>` both in the old and the new version.\n\nExcellent! Then there is certainly no reason to define `FILE` the way you did in `meataxe.pxd`.",
    "created_at": "2015-09-19T10:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136747",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:91 SimonKing]:
> It doesn't. It does `#include <stdio.h>` both in the old and the new version.

Excellent! Then there is certainly no reason to define `FILE` the way you did in `meataxe.pxd`.



---

archive/issue_comments_136748.json:
```json
{
    "body": "Replying to [comment:89 SimonKing]:\n> Meanwhile I know that the wrong results of Strassen multiplication in field order 2 come from the function `FfAddMapRowWindow`, which in fact has a special case for the field of order 2. This function is a modification of the MeatAxe function `FfMapRow`.\n\nGot it! There is a pointer that is moved through the matrix by which we are multiplying. In case of order two, if an addition of a row happens then the pointer is moved to the next item after the current row of the matrix.\n\nIn `FfMapRow`, this position automatically is the first item of the next row of the matrix. In `FfAddMapRowWindow`, the matrix is in fact just a window of a larger matrix, and this position generally is outside of the window. Hence, I have to manually move the pointer to the first position of the next line of the window.",
    "created_at": "2015-09-19T10:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136748",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:89 SimonKing]:
> Meanwhile I know that the wrong results of Strassen multiplication in field order 2 come from the function `FfAddMapRowWindow`, which in fact has a special case for the field of order 2. This function is a modification of the MeatAxe function `FfMapRow`.

Got it! There is a pointer that is moved through the matrix by which we are multiplying. In case of order two, if an addition of a row happens then the pointer is moved to the next item after the current row of the matrix.

In `FfMapRow`, this position automatically is the first item of the next row of the matrix. In `FfAddMapRowWindow`, the matrix is in fact just a window of a larger matrix, and this position generally is outside of the window. Hence, I have to manually move the pointer to the first position of the next line of the window.



---

archive/issue_comments_136749.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-19T11:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136750.json:
```json
{
    "body": "I force-pushed the new version.\n\nChanges: The bug is fixed, and FILE and PATCHES are removed.\n\nNow for timings and the quest for a good (default) cutoff.\n\nWhen using Winograd-Strassen, one needs to define a matrix size such that divide-and-conquer is applied if and only if all resulting blocks have at least that size.\n\nMeataxe packs matrix coefficients densely. I.e, if you have a field of size 3, then it will pack 5 matrix coefficients into one byte (`2^5<256`).\n\nEach meataxe matrix is stored in a block of memory, row by row. Internally, meataxe uses \"long\" operations in some functions. That's why each row uses a byte size that is a multiple of sizeof(long), using up to sizeof(long)-1 trailing zero bytes (\"padding bytes\").\n\nWinograd-Strassen operates on matrix windows. It is rather obvious that the window shouldn't end in the middle of a byte, i.e., the number of columns of a window should be a multiple of the \"number of coefficients per byte\".\n\nIn my old patches for version 2.2.4, in fact I used \"byte\" as unit. But in the new patches for version 2.4.24, I adopt meataxe's convention that row length should be divisible by sizeof(long). So, in my Winograd-Strassen implementation, the number of columns of matrix windows is a multiple of \"sizeof(long)*(number of coefficients)\".\n\nConsequently, the cutoff parameter in meataxe is given in the unit \"sizeof(long)\" (in my current cython wrapper the unit is byte, but that's likely to change).\n\nWith the following function used in a Sage session, I have determined the optimal cutoff parameter for different field sizes and different matrix dimensions. Also I have tested for what matrix dimensions the school book algorithm is faster than the Winograd-Strassen algorithm, and I checked that both algorithms yield the same result.\n\n```python\nfrom sage.matrix.matrix_gfpn_dense import Matrix_gfpn_dense\ndef find_cutoff(q, D):\n    print \"GF({})\".format(q)\n    for n in [100,500,1000,2000]:\n        print \"  n = {}:\".format(n),\n        MS = MatrixSpace(GF(q,'x'), n)\n        MS._MatrixSpace__matrix_class = Matrix_gfpn_dense\n        M = MS.random_element()\n        t = cputime()\n        N = M._multiply_classical(M)\n        D[q,n] = set()\n        D[q,n].add((cputime(t),0))\n        for c in range(1,9):\n            print c*8,\n            sys.stdout.flush()\n            t = cputime()\n            N1 = M._multiply_strassen(M, c*8)\n            D[q,n].add((cputime(t), c))\n            assert N1==N\n        print\n        print \"->\",sorted(list((D[q,n])))[:5]\n```\n\nThe result was\n\n```\nsage: D = {}\nsage: for q in [2,3,8,9,25,27,32,49,81,125,243]: find_cutoff(q, D)\nGF(2)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0, 0), (0.0, 1), (0.0, 2), (0.0, 3), (0.0, 4)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.002999999999985903, 5), (0.002999999999985903, 6), (0.002999999999985903, 7), (0.0030000000000427463, 4), (0.0030000000000427463, 8)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(0.019000000000005457, 0), (0.01999999999998181, 8), (0.02199999999999136, 4), (0.02199999999999136, 5), (0.02199999999999136, 7)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(0.12000000000000455, 0), (0.14599999999995816, 8), (0.1560000000000059, 4), (0.15699999999998226, 5), (0.15699999999998226, 6)]\nGF(3)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0, 0), (0.0, 4), (0.0, 7), (0.0009999999999763531, 2), (0.0009999999999763531, 3)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.04899999999997817, 0), (0.05000000000001137, 7), (0.05099999999998772, 8), (0.051999999999964075, 5), (0.05299999999999727, 4)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(0.3509999999999991, 4), (0.3509999999999991, 5), (0.3509999999999991, 6), (0.36199999999996635, 8), (0.36299999999999955, 7)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(2.4659999999999513, 6), (2.4669999999999845, 4), (2.4669999999999845, 5), (2.5469999999999686, 7), (2.548000000000002, 8)]\nGF(8)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0009999999999763531, 3), (0.0009999999999763531, 6), (0.0009999999999763531, 8), (0.0010000000000331966, 1), (0.0019999999999527063, 0)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.1169999999999618, 3), (0.117999999999995, 2), (0.1209999999999809, 5), (0.12100000000003774, 4), (0.12100000000003774, 6)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(0.9129999999999541, 7), (0.9130000000000109, 4), (0.9130000000000109, 6), (0.9139999999999873, 5), (0.9519999999999982, 3)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(6.291999999999973, 7), (6.29200000000003, 4), (6.293000000000006, 5), (6.293000000000006, 6), (6.569000000000017, 2)]\nGF(9)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0009999999999763531, 7), (0.0010000000000331966, 2), (0.0010000000000331966, 4), (0.0019999999999527063, 0), (0.0019999999999527063, 3)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.12299999999999045, 3), (0.1239999999999668, 7), (0.12400000000002365, 2), (0.125, 4), (0.125, 5)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(0.9429999999999836, 4), (0.9429999999999836, 6), (0.9430000000000405, 7), (0.9440000000000168, 5), (0.9830000000000041, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(6.517999999999972, 6), (6.522999999999968, 7), (6.524000000000001, 5), (6.5330000000000155, 4), (6.793999999999983, 8)]\nGF(25)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.002999999999985903, 0), (0.002999999999985903, 2), (0.002999999999985903, 3), (0.002999999999985903, 4), (0.002999999999985903, 6)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.28300000000001546, 4), (0.2839999999999918, 6), (0.2839999999999918, 7), (0.2840000000001055, 5), (0.2949999999999591, 8)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(1.9640000000000555, 7), (1.9650000000000318, 6), (1.9669999999999845, 4), (1.969000000000051, 5), (2.044999999999959, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(13.799999999999955, 4), (13.805000000000064, 6), (13.807000000000016, 7), (13.81499999999994, 5), (14.360000000000014, 8)]\nGF(27)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0029999999999290594, 0), (0.0029999999999290594, 4), (0.0029999999999290594, 6), (0.0030000000000427463, 2), (0.0030000000000427463, 3)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.28099999999994907, 5), (0.28099999999994907, 7), (0.28100000000006276, 4), (0.28100000000006276, 6), (0.29300000000000637, 8)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(1.9509999999999081, 4), (1.9510000000000218, 6), (1.9510000000000218, 7), (1.9520000000001119, 5), (2.033999999999878, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(13.709999999999923, 6), (13.718000000000075, 7), (13.731999999999971, 5), (13.764999999999873, 4), (14.337999999999965, 8)]\nGF(32)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0029999999999290594, 2), (0.0029999999999290594, 5), (0.0029999999999290594, 7), (0.0030000000000427463, 0), (0.0030000000000427463, 3)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.2700000000000955, 7), (0.27099999999995816, 4), (0.27099999999995816, 6), (0.2720000000000482, 5), (0.2799999999999727, 2)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(1.8730000000000473, 4), (1.893000000000029, 5), (1.8960000000000719, 7), (1.8980000000000246, 6), (1.9220000000000255, 2)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(13.370999999999981, 4), (13.513000000000034, 5), (13.535999999999945, 2), (13.625, 3), (13.687000000000012, 7)]\nGF(49)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0029999999999290594, 4), (0.0029999999999290594, 7), (0.0030000000000427463, 0), (0.0030000000000427463, 2), (0.0030000000000427463, 3)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.28300000000001546, 4), (0.2860000000000582, 6), (0.2869999999999209, 5), (0.28700000000003456, 7), (0.2939999999999827, 8)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(1.9269999999999072, 6), (1.9300000000000637, 7), (1.9329999999999927, 5), (1.9470000000000027, 4), (2.038000000000011, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(13.607000000000198, 6), (13.632000000000062, 7), (13.685999999999922, 5), (13.788999999999987, 4), (14.29099999999994, 2)]\nGF(81)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0029999999999290594, 2), (0.0029999999999290594, 4), (0.0029999999999290594, 5), (0.0029999999999290594, 7), (0.0029999999999290594, 8)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.2819999999999254, 4), (0.2819999999999254, 7), (0.2840000000001055, 6), (0.28899999999998727, 5), (0.29500000000007276, 2)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(1.9349999999999454, 6), (1.9409999999998035, 7), (1.9610000000000127, 4), (1.9629999999999654, 5), (2.0399999999999636, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(13.505999999999858, 7), (13.623000000000047, 5), (13.644000000000233, 6), (13.719000000000278, 4), (14.055000000000064, 8)]\nGF(125)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0029999999999290594, 0), (0.0029999999999290594, 2), (0.0029999999999290594, 4), (0.0029999999999290594, 5), (0.0029999999999290594, 7)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.29599999999982174, 5), (0.2960000000000491, 4), (0.2960000000000491, 6), (0.2960000000000491, 7), (0.3009999999999309, 8)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(2.0429999999998927, 5), (2.04300000000012, 7), (2.0449999999998454, 4), (2.0450000000000728, 6), (2.0960000000000036, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(14.353999999999814, 7), (14.366000000000213, 5), (14.383000000000266, 4), (14.414999999999964, 6), (14.596000000000004, 8)]\nGF(243)\n  n = 100: 8 16 24 32 40 48 56 64\n-> [(0.0029999999999290594, 4), (0.0029999999999290594, 6), (0.003000000000156433, 0), (0.003000000000156433, 2), (0.003000000000156433, 8)]\n  n = 500: 8 16 24 32 40 48 56 64\n-> [(0.3369999999999891, 5), (0.3369999999999891, 7), (0.33799999999996544, 4), (0.3380000000001928, 6), (0.34799999999995634, 8)]\n  n = 1000: 8 16 24 32 40 48 56 64\n-> [(2.336999999999989, 4), (2.336999999999989, 6), (2.336999999999989, 7), (2.341999999999871, 5), (2.4020000000000437, 8)]\n  n = 2000: 8 16 24 32 40 48 56 64\n-> [(17.700999999999794, 4), (17.958000000000084, 5), (17.998000000000047, 7), (18.02800000000002, 2), (18.03599999999983, 6)]\n```\n\n\n**__Evaluation of these timings__**\n\n- My Winograd-Strassen implementation gives the same result as meataxe's school book implementation. **--> Hooray**\n- There is not a single case (not even for small matrices) where meataxe's school book implementation is significantly faster than Winograd-Strassen **--> Winograd-Strassen should be the default algorithm in matrix_gfpn_dense**\n- It seems that a cutoff between 4 and 7 in the unit \"sizeof(long)\" are about the same, and are generally better than other cutoffs.\n\nThe last statement is backed up by another study, where I consider 3601x3601-matrices over different fields, varying the cutoff parameter. I got these timings for multiplication:\n\n```\ncutoff       1       2        3       4        5        6        7         8\nGF(4):     15.5 s   12.2 s  12.3 s   11 s     11 s     11 s     11 s      11.5 s\nGF(9):     41.3 s   33.7 s  33.5 s   31.6 s   31.5 s   31.5 s   31.5 s    34 s\nGF(16):    26.4 s   21.1 s   21 s    19.9 s   19.9 s   19.9 s   19.9 s    21.4 s\nGF(25):   1min 34s 1min 12s 1min 12s 1min 8s  1min 8s  1min 8s  1min 8s  1min 12s\nGF(32):   1min 27s 1min 6s  1min 6s  1min 4s  1min 4s  1min 4s  1min 4s  1min 10s\nGF(243):  1min 55s 1min 27s 1min 27s 1min 18s 1min 18s 1min 18s 1min 19s 1min 24s\n```\n\n\nNow, the real question is: What is the meaning of \"4\"? My guess is that \"4\" is \"sizeof(long)/2\", so that the default cutoff parameter now is \"sizeof(long)/2\". But I could be mistaken. Perhaps on a 32-bit machine, cutoff 4 is better than cutoff \"2==sizeof(long)/2\", and on a 128-bit machine, cutoff 4 is better than cutoff \"8=sizeof(long)/2\"? Or perhaps it all depends on L1/L2 cache size?\n\n**__Request to the reviewer__**\n\n- Do you have access to machines of different architecture (32-bit, 128-bit, different cache sizes)? Could you try to use the function above to find the optimal cutoff parameters?\n- Meataxe uses an environment variable ASM_MMX in the file kernel-0.c. It means that in some functions it uses assembler code in characteristic two. By copying I use it as well, in `FfAddMapRowWindow` mentioned above. In some comment, it says that \"this assumes Intel with 4 bytes per long, but MMX implies Intel anyway.\"\n\n  My questions:\n\n    - Is ASM_MMX some kind of standard variable?\n    - Can you test the package on a machine where ASM_MMX is used?\n\n  Note that I do have Intel, but my longs are 8 bytes, not 4.",
    "created_at": "2015-09-19T12:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136750",
    "user": "https://github.com/simon-king-jena"
}
```

I force-pushed the new version.

Changes: The bug is fixed, and FILE and PATCHES are removed.

Now for timings and the quest for a good (default) cutoff.

When using Winograd-Strassen, one needs to define a matrix size such that divide-and-conquer is applied if and only if all resulting blocks have at least that size.

Meataxe packs matrix coefficients densely. I.e, if you have a field of size 3, then it will pack 5 matrix coefficients into one byte (`2^5<256`).

Each meataxe matrix is stored in a block of memory, row by row. Internally, meataxe uses "long" operations in some functions. That's why each row uses a byte size that is a multiple of sizeof(long), using up to sizeof(long)-1 trailing zero bytes ("padding bytes").

Winograd-Strassen operates on matrix windows. It is rather obvious that the window shouldn't end in the middle of a byte, i.e., the number of columns of a window should be a multiple of the "number of coefficients per byte".

In my old patches for version 2.2.4, in fact I used "byte" as unit. But in the new patches for version 2.4.24, I adopt meataxe's convention that row length should be divisible by sizeof(long). So, in my Winograd-Strassen implementation, the number of columns of matrix windows is a multiple of "sizeof(long)*(number of coefficients)".

Consequently, the cutoff parameter in meataxe is given in the unit "sizeof(long)" (in my current cython wrapper the unit is byte, but that's likely to change).

With the following function used in a Sage session, I have determined the optimal cutoff parameter for different field sizes and different matrix dimensions. Also I have tested for what matrix dimensions the school book algorithm is faster than the Winograd-Strassen algorithm, and I checked that both algorithms yield the same result.

```python
from sage.matrix.matrix_gfpn_dense import Matrix_gfpn_dense
def find_cutoff(q, D):
    print "GF({})".format(q)
    for n in [100,500,1000,2000]:
        print "  n = {}:".format(n),
        MS = MatrixSpace(GF(q,'x'), n)
        MS._MatrixSpace__matrix_class = Matrix_gfpn_dense
        M = MS.random_element()
        t = cputime()
        N = M._multiply_classical(M)
        D[q,n] = set()
        D[q,n].add((cputime(t),0))
        for c in range(1,9):
            print c*8,
            sys.stdout.flush()
            t = cputime()
            N1 = M._multiply_strassen(M, c*8)
            D[q,n].add((cputime(t), c))
            assert N1==N
        print
        print "->",sorted(list((D[q,n])))[:5]
```

The result was

```
sage: D = {}
sage: for q in [2,3,8,9,25,27,32,49,81,125,243]: find_cutoff(q, D)
GF(2)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0, 0), (0.0, 1), (0.0, 2), (0.0, 3), (0.0, 4)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.002999999999985903, 5), (0.002999999999985903, 6), (0.002999999999985903, 7), (0.0030000000000427463, 4), (0.0030000000000427463, 8)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(0.019000000000005457, 0), (0.01999999999998181, 8), (0.02199999999999136, 4), (0.02199999999999136, 5), (0.02199999999999136, 7)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(0.12000000000000455, 0), (0.14599999999995816, 8), (0.1560000000000059, 4), (0.15699999999998226, 5), (0.15699999999998226, 6)]
GF(3)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0, 0), (0.0, 4), (0.0, 7), (0.0009999999999763531, 2), (0.0009999999999763531, 3)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.04899999999997817, 0), (0.05000000000001137, 7), (0.05099999999998772, 8), (0.051999999999964075, 5), (0.05299999999999727, 4)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(0.3509999999999991, 4), (0.3509999999999991, 5), (0.3509999999999991, 6), (0.36199999999996635, 8), (0.36299999999999955, 7)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(2.4659999999999513, 6), (2.4669999999999845, 4), (2.4669999999999845, 5), (2.5469999999999686, 7), (2.548000000000002, 8)]
GF(8)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0009999999999763531, 3), (0.0009999999999763531, 6), (0.0009999999999763531, 8), (0.0010000000000331966, 1), (0.0019999999999527063, 0)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.1169999999999618, 3), (0.117999999999995, 2), (0.1209999999999809, 5), (0.12100000000003774, 4), (0.12100000000003774, 6)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(0.9129999999999541, 7), (0.9130000000000109, 4), (0.9130000000000109, 6), (0.9139999999999873, 5), (0.9519999999999982, 3)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(6.291999999999973, 7), (6.29200000000003, 4), (6.293000000000006, 5), (6.293000000000006, 6), (6.569000000000017, 2)]
GF(9)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0009999999999763531, 7), (0.0010000000000331966, 2), (0.0010000000000331966, 4), (0.0019999999999527063, 0), (0.0019999999999527063, 3)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.12299999999999045, 3), (0.1239999999999668, 7), (0.12400000000002365, 2), (0.125, 4), (0.125, 5)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(0.9429999999999836, 4), (0.9429999999999836, 6), (0.9430000000000405, 7), (0.9440000000000168, 5), (0.9830000000000041, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(6.517999999999972, 6), (6.522999999999968, 7), (6.524000000000001, 5), (6.5330000000000155, 4), (6.793999999999983, 8)]
GF(25)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.002999999999985903, 0), (0.002999999999985903, 2), (0.002999999999985903, 3), (0.002999999999985903, 4), (0.002999999999985903, 6)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.28300000000001546, 4), (0.2839999999999918, 6), (0.2839999999999918, 7), (0.2840000000001055, 5), (0.2949999999999591, 8)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(1.9640000000000555, 7), (1.9650000000000318, 6), (1.9669999999999845, 4), (1.969000000000051, 5), (2.044999999999959, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(13.799999999999955, 4), (13.805000000000064, 6), (13.807000000000016, 7), (13.81499999999994, 5), (14.360000000000014, 8)]
GF(27)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0029999999999290594, 0), (0.0029999999999290594, 4), (0.0029999999999290594, 6), (0.0030000000000427463, 2), (0.0030000000000427463, 3)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.28099999999994907, 5), (0.28099999999994907, 7), (0.28100000000006276, 4), (0.28100000000006276, 6), (0.29300000000000637, 8)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(1.9509999999999081, 4), (1.9510000000000218, 6), (1.9510000000000218, 7), (1.9520000000001119, 5), (2.033999999999878, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(13.709999999999923, 6), (13.718000000000075, 7), (13.731999999999971, 5), (13.764999999999873, 4), (14.337999999999965, 8)]
GF(32)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0029999999999290594, 2), (0.0029999999999290594, 5), (0.0029999999999290594, 7), (0.0030000000000427463, 0), (0.0030000000000427463, 3)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.2700000000000955, 7), (0.27099999999995816, 4), (0.27099999999995816, 6), (0.2720000000000482, 5), (0.2799999999999727, 2)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(1.8730000000000473, 4), (1.893000000000029, 5), (1.8960000000000719, 7), (1.8980000000000246, 6), (1.9220000000000255, 2)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(13.370999999999981, 4), (13.513000000000034, 5), (13.535999999999945, 2), (13.625, 3), (13.687000000000012, 7)]
GF(49)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0029999999999290594, 4), (0.0029999999999290594, 7), (0.0030000000000427463, 0), (0.0030000000000427463, 2), (0.0030000000000427463, 3)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.28300000000001546, 4), (0.2860000000000582, 6), (0.2869999999999209, 5), (0.28700000000003456, 7), (0.2939999999999827, 8)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(1.9269999999999072, 6), (1.9300000000000637, 7), (1.9329999999999927, 5), (1.9470000000000027, 4), (2.038000000000011, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(13.607000000000198, 6), (13.632000000000062, 7), (13.685999999999922, 5), (13.788999999999987, 4), (14.29099999999994, 2)]
GF(81)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0029999999999290594, 2), (0.0029999999999290594, 4), (0.0029999999999290594, 5), (0.0029999999999290594, 7), (0.0029999999999290594, 8)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.2819999999999254, 4), (0.2819999999999254, 7), (0.2840000000001055, 6), (0.28899999999998727, 5), (0.29500000000007276, 2)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(1.9349999999999454, 6), (1.9409999999998035, 7), (1.9610000000000127, 4), (1.9629999999999654, 5), (2.0399999999999636, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(13.505999999999858, 7), (13.623000000000047, 5), (13.644000000000233, 6), (13.719000000000278, 4), (14.055000000000064, 8)]
GF(125)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0029999999999290594, 0), (0.0029999999999290594, 2), (0.0029999999999290594, 4), (0.0029999999999290594, 5), (0.0029999999999290594, 7)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.29599999999982174, 5), (0.2960000000000491, 4), (0.2960000000000491, 6), (0.2960000000000491, 7), (0.3009999999999309, 8)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(2.0429999999998927, 5), (2.04300000000012, 7), (2.0449999999998454, 4), (2.0450000000000728, 6), (2.0960000000000036, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(14.353999999999814, 7), (14.366000000000213, 5), (14.383000000000266, 4), (14.414999999999964, 6), (14.596000000000004, 8)]
GF(243)
  n = 100: 8 16 24 32 40 48 56 64
-> [(0.0029999999999290594, 4), (0.0029999999999290594, 6), (0.003000000000156433, 0), (0.003000000000156433, 2), (0.003000000000156433, 8)]
  n = 500: 8 16 24 32 40 48 56 64
-> [(0.3369999999999891, 5), (0.3369999999999891, 7), (0.33799999999996544, 4), (0.3380000000001928, 6), (0.34799999999995634, 8)]
  n = 1000: 8 16 24 32 40 48 56 64
-> [(2.336999999999989, 4), (2.336999999999989, 6), (2.336999999999989, 7), (2.341999999999871, 5), (2.4020000000000437, 8)]
  n = 2000: 8 16 24 32 40 48 56 64
-> [(17.700999999999794, 4), (17.958000000000084, 5), (17.998000000000047, 7), (18.02800000000002, 2), (18.03599999999983, 6)]
```


**__Evaluation of these timings__**

- My Winograd-Strassen implementation gives the same result as meataxe's school book implementation. **--> Hooray**
- There is not a single case (not even for small matrices) where meataxe's school book implementation is significantly faster than Winograd-Strassen **--> Winograd-Strassen should be the default algorithm in matrix_gfpn_dense**
- It seems that a cutoff between 4 and 7 in the unit "sizeof(long)" are about the same, and are generally better than other cutoffs.

The last statement is backed up by another study, where I consider 3601x3601-matrices over different fields, varying the cutoff parameter. I got these timings for multiplication:

```
cutoff       1       2        3       4        5        6        7         8
GF(4):     15.5 s   12.2 s  12.3 s   11 s     11 s     11 s     11 s      11.5 s
GF(9):     41.3 s   33.7 s  33.5 s   31.6 s   31.5 s   31.5 s   31.5 s    34 s
GF(16):    26.4 s   21.1 s   21 s    19.9 s   19.9 s   19.9 s   19.9 s    21.4 s
GF(25):   1min 34s 1min 12s 1min 12s 1min 8s  1min 8s  1min 8s  1min 8s  1min 12s
GF(32):   1min 27s 1min 6s  1min 6s  1min 4s  1min 4s  1min 4s  1min 4s  1min 10s
GF(243):  1min 55s 1min 27s 1min 27s 1min 18s 1min 18s 1min 18s 1min 19s 1min 24s
```


Now, the real question is: What is the meaning of "4"? My guess is that "4" is "sizeof(long)/2", so that the default cutoff parameter now is "sizeof(long)/2". But I could be mistaken. Perhaps on a 32-bit machine, cutoff 4 is better than cutoff "2==sizeof(long)/2", and on a 128-bit machine, cutoff 4 is better than cutoff "8=sizeof(long)/2"? Or perhaps it all depends on L1/L2 cache size?

**__Request to the reviewer__**

- Do you have access to machines of different architecture (32-bit, 128-bit, different cache sizes)? Could you try to use the function above to find the optimal cutoff parameters?
- Meataxe uses an environment variable ASM_MMX in the file kernel-0.c. It means that in some functions it uses assembler code in characteristic two. By copying I use it as well, in `FfAddMapRowWindow` mentioned above. In some comment, it says that "this assumes Intel with 4 bytes per long, but MMX implies Intel anyway."

  My questions:

    - Is ASM_MMX some kind of standard variable?
    - Can you test the package on a machine where ASM_MMX is used?

  Note that I do have Intel, but my longs are 8 bytes, not 4.



---

archive/issue_comments_136751.json:
```json
{
    "body": "Just to see if I can improve the code a bit, I did\n\n```\nsage: M = MatrixSpace(GF(125,'x'),2000).random_element()\nsage: %crun N = M*M\nPROFILE: interrupts/evictions/bytes = 1466/1183/718104\nUsing local file /home/king/Sage/git/sage/local/bin/python.\nUsing local file /home/king/.sage/temp/linux-va3e.site/18759/tmp_efM3tZ.perf.\nTotal: 1466 samples\n       0   0.0%   0.0%     1466 100.0% MatMulStrassen\n       0   0.0%   0.0%     1466 100.0% PyEval_EvalCode\n       0   0.0%   0.0%     1466 100.0% PyEval_EvalCodeEx\n       0   0.0%   0.0%     1466 100.0% PyEval_EvalFrameEx\n       0   0.0%   0.0%     1466 100.0% PyNumber_Multiply\n       0   0.0%   0.0%     1466 100.0% PyObject_Call\n       0   0.0%   0.0%     1466 100.0% PyRun_FileExFlags\n       0   0.0%   0.0%     1466 100.0% PyRun_SimpleFileExFlags\n       0   0.0%   0.0%     1466 100.0% PyRun_StringFlags\n       0   0.0%   0.0%     1466 100.0% Py_Main\n       0   0.0%   0.0%     1466 100.0% StrassenStep\n       0   0.0%   0.0%     1466 100.0% __libc_start_main\n       0   0.0%   0.0%     1466 100.0% __pyx_f_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense__matrix_times_matrix_\n       0   0.0%   0.0%     1466 100.0% __pyx_f_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense__multiply_strassen\n       0   0.0%   0.0%     1466 100.0% __pyx_pf_4sage_9structure_7element_6Matrix_2__mul__ (inline)\n       0   0.0%   0.0%     1466 100.0% __pyx_pw_4sage_9structure_7element_6Matrix_3__mul__\n       0   0.0%   0.0%     1466 100.0% _start\n       0   0.0%   0.0%     1466 100.0% binary_op1 (inline)\n       0   0.0%   0.0%     1466 100.0% call_function (inline)\n       0   0.0%   0.0%     1466 100.0% exec_statement (inline)\n       0   0.0%   0.0%     1466 100.0% ext_do_call (inline)\n       0   0.0%   0.0%     1466 100.0% fast_function (inline)\n       0   0.0%   0.0%     1466 100.0% function_call\n       0   0.0%   0.0%     1466 100.0% run_mod (inline)\n       2   0.1%   0.1%     1382  94.3% WindowAddMul\n    1368  93.3%  93.5%     1368  93.3% FfAddMapRowWindow\n       0   0.0%  93.5%       46   3.1% WindowDif\n       2   0.1%  93.6%       31   2.1% WindowSum\n      30   2.0%  95.6%       30   2.0% FfSetNoc\n      23   1.6%  97.2%       23   1.6% FfAddRowPartial\n      23   1.6%  98.8%       23   1.6% FfSubRowPartial\n       8   0.5%  99.3%        8   0.5% FfSubRowPartialReverse\n       0   0.0%  99.3%        4   0.3% WindowClear\n       4   0.3%  99.6%        4   0.3% __GI_memset\n       0   0.0%  99.6%        3   0.2% FfAlloc\n       0   0.0%  99.6%        3   0.2% MatAlloc\n       0   0.0%  99.6%        3   0.2% WindowAlloc\n       2   0.1%  99.7%        2   0.1% FfStepPtr\n       0   0.0%  99.7%        2   0.1% SysMalloc\n       1   0.1%  99.8%        2   0.1% __GI___libc_malloc\n       0   0.0%  99.8%        1   0.1% FfAddRow\n       0   0.0%  99.8%        1   0.1% FfGetPtr\n       1   0.1%  99.9%        1   0.1% FfMulRow\n       1   0.1%  99.9%        1   0.1% __memcpy_sse2_unaligned\n       0   0.0%  99.9%        1   0.1% _int_malloc\n       1   0.1% 100.0%        1   0.1% malloc_consolidate\nsage: %crun N = M._multiply_classical(M)\nPROFILE: interrupts/evictions/bytes = 2242/24/17464\nUsing local file /home/king/Sage/git/sage/local/bin/python.\nUsing local file /home/king/.sage/temp/linux-va3e.site/18759/tmp_R9Qzph.perf.\nTotal: 2242 samples\n       0   0.0%   0.0%     2242 100.0% PyEval_EvalCode\n       0   0.0%   0.0%     2242 100.0% PyEval_EvalCodeEx\n       0   0.0%   0.0%     2242 100.0% PyEval_EvalFrameEx\n       0   0.0%   0.0%     2242 100.0% PyObject_Call\n       0   0.0%   0.0%     2242 100.0% PyRun_FileExFlags\n       0   0.0%   0.0%     2242 100.0% PyRun_SimpleFileExFlags\n       0   0.0%   0.0%     2242 100.0% PyRun_StringFlags\n       0   0.0%   0.0%     2242 100.0% Py_Main\n       0   0.0%   0.0%     2242 100.0% __libc_start_main\n       0   0.0%   0.0%     2242 100.0% __pyx_f_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense__multiply_classical\n       0   0.0%   0.0%     2242 100.0% __pyx_pf_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense_32_multiply_classical (inline)\n       0   0.0%   0.0%     2242 100.0% __pyx_pw_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense_33_multiply_classical\n       0   0.0%   0.0%     2242 100.0% _start\n       0   0.0%   0.0%     2242 100.0% call_function (inline)\n       0   0.0%   0.0%     2242 100.0% exec_statement (inline)\n       0   0.0%   0.0%     2242 100.0% ext_do_call (inline)\n       0   0.0%   0.0%     2242 100.0% fast_function (inline)\n       0   0.0%   0.0%     2242 100.0% function_call\n       0   0.0%   0.0%     2242 100.0% run_mod (inline)\n    2241 100.0% 100.0%     2241 100.0% FfMapRow\n       0   0.0% 100.0%     2241 100.0% MatMul\n       0   0.0% 100.0%        1   0.0% FfAlloc\n       1   0.0% 100.0%        1   0.0% FfMulRow\n       0   0.0% 100.0%        1   0.0% MatAlloc\n       0   0.0% 100.0%        1   0.0% MatDup\n```\n\n\nSo, if I want to optimise something then I should have a look at `FfMapRow/FfAddMapRowWindow`.",
    "created_at": "2015-09-19T13:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136751",
    "user": "https://github.com/simon-king-jena"
}
```

Just to see if I can improve the code a bit, I did

```
sage: M = MatrixSpace(GF(125,'x'),2000).random_element()
sage: %crun N = M*M
PROFILE: interrupts/evictions/bytes = 1466/1183/718104
Using local file /home/king/Sage/git/sage/local/bin/python.
Using local file /home/king/.sage/temp/linux-va3e.site/18759/tmp_efM3tZ.perf.
Total: 1466 samples
       0   0.0%   0.0%     1466 100.0% MatMulStrassen
       0   0.0%   0.0%     1466 100.0% PyEval_EvalCode
       0   0.0%   0.0%     1466 100.0% PyEval_EvalCodeEx
       0   0.0%   0.0%     1466 100.0% PyEval_EvalFrameEx
       0   0.0%   0.0%     1466 100.0% PyNumber_Multiply
       0   0.0%   0.0%     1466 100.0% PyObject_Call
       0   0.0%   0.0%     1466 100.0% PyRun_FileExFlags
       0   0.0%   0.0%     1466 100.0% PyRun_SimpleFileExFlags
       0   0.0%   0.0%     1466 100.0% PyRun_StringFlags
       0   0.0%   0.0%     1466 100.0% Py_Main
       0   0.0%   0.0%     1466 100.0% StrassenStep
       0   0.0%   0.0%     1466 100.0% __libc_start_main
       0   0.0%   0.0%     1466 100.0% __pyx_f_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense__matrix_times_matrix_
       0   0.0%   0.0%     1466 100.0% __pyx_f_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense__multiply_strassen
       0   0.0%   0.0%     1466 100.0% __pyx_pf_4sage_9structure_7element_6Matrix_2__mul__ (inline)
       0   0.0%   0.0%     1466 100.0% __pyx_pw_4sage_9structure_7element_6Matrix_3__mul__
       0   0.0%   0.0%     1466 100.0% _start
       0   0.0%   0.0%     1466 100.0% binary_op1 (inline)
       0   0.0%   0.0%     1466 100.0% call_function (inline)
       0   0.0%   0.0%     1466 100.0% exec_statement (inline)
       0   0.0%   0.0%     1466 100.0% ext_do_call (inline)
       0   0.0%   0.0%     1466 100.0% fast_function (inline)
       0   0.0%   0.0%     1466 100.0% function_call
       0   0.0%   0.0%     1466 100.0% run_mod (inline)
       2   0.1%   0.1%     1382  94.3% WindowAddMul
    1368  93.3%  93.5%     1368  93.3% FfAddMapRowWindow
       0   0.0%  93.5%       46   3.1% WindowDif
       2   0.1%  93.6%       31   2.1% WindowSum
      30   2.0%  95.6%       30   2.0% FfSetNoc
      23   1.6%  97.2%       23   1.6% FfAddRowPartial
      23   1.6%  98.8%       23   1.6% FfSubRowPartial
       8   0.5%  99.3%        8   0.5% FfSubRowPartialReverse
       0   0.0%  99.3%        4   0.3% WindowClear
       4   0.3%  99.6%        4   0.3% __GI_memset
       0   0.0%  99.6%        3   0.2% FfAlloc
       0   0.0%  99.6%        3   0.2% MatAlloc
       0   0.0%  99.6%        3   0.2% WindowAlloc
       2   0.1%  99.7%        2   0.1% FfStepPtr
       0   0.0%  99.7%        2   0.1% SysMalloc
       1   0.1%  99.8%        2   0.1% __GI___libc_malloc
       0   0.0%  99.8%        1   0.1% FfAddRow
       0   0.0%  99.8%        1   0.1% FfGetPtr
       1   0.1%  99.9%        1   0.1% FfMulRow
       1   0.1%  99.9%        1   0.1% __memcpy_sse2_unaligned
       0   0.0%  99.9%        1   0.1% _int_malloc
       1   0.1% 100.0%        1   0.1% malloc_consolidate
sage: %crun N = M._multiply_classical(M)
PROFILE: interrupts/evictions/bytes = 2242/24/17464
Using local file /home/king/Sage/git/sage/local/bin/python.
Using local file /home/king/.sage/temp/linux-va3e.site/18759/tmp_R9Qzph.perf.
Total: 2242 samples
       0   0.0%   0.0%     2242 100.0% PyEval_EvalCode
       0   0.0%   0.0%     2242 100.0% PyEval_EvalCodeEx
       0   0.0%   0.0%     2242 100.0% PyEval_EvalFrameEx
       0   0.0%   0.0%     2242 100.0% PyObject_Call
       0   0.0%   0.0%     2242 100.0% PyRun_FileExFlags
       0   0.0%   0.0%     2242 100.0% PyRun_SimpleFileExFlags
       0   0.0%   0.0%     2242 100.0% PyRun_StringFlags
       0   0.0%   0.0%     2242 100.0% Py_Main
       0   0.0%   0.0%     2242 100.0% __libc_start_main
       0   0.0%   0.0%     2242 100.0% __pyx_f_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense__multiply_classical
       0   0.0%   0.0%     2242 100.0% __pyx_pf_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense_32_multiply_classical (inline)
       0   0.0%   0.0%     2242 100.0% __pyx_pw_4sage_6matrix_17matrix_gfpn_dense_17Matrix_gfpn_dense_33_multiply_classical
       0   0.0%   0.0%     2242 100.0% _start
       0   0.0%   0.0%     2242 100.0% call_function (inline)
       0   0.0%   0.0%     2242 100.0% exec_statement (inline)
       0   0.0%   0.0%     2242 100.0% ext_do_call (inline)
       0   0.0%   0.0%     2242 100.0% fast_function (inline)
       0   0.0%   0.0%     2242 100.0% function_call
       0   0.0%   0.0%     2242 100.0% run_mod (inline)
    2241 100.0% 100.0%     2241 100.0% FfMapRow
       0   0.0% 100.0%     2241 100.0% MatMul
       0   0.0% 100.0%        1   0.0% FfAlloc
       1   0.0% 100.0%        1   0.0% FfMulRow
       0   0.0% 100.0%        1   0.0% MatAlloc
       0   0.0% 100.0%        1   0.0% MatDup
```


So, if I want to optimise something then I should have a look at `FfMapRow/FfAddMapRowWindow`.



---

archive/issue_comments_136752.json:
```json
{
    "body": "I tried some tweaks, but it didn't result in a clear improvement. So, I'll now focus on wrapping echelon computation and then on the doctests.",
    "created_at": "2015-09-19T19:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136752",
    "user": "https://github.com/simon-king-jena"
}
```

I tried some tweaks, but it didn't result in a clear improvement. So, I'll now focus on wrapping echelon computation and then on the doctests.



---

archive/issue_comments_136753.json:
```json
{
    "body": "It would be convenient if you would base this ticket on #19240 (and review that), because there will be conflicts.",
    "created_at": "2015-09-19T19:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136753",
    "user": "https://github.com/jdemeyer"
}
```

It would be convenient if you would base this ticket on #19240 (and review that), because there will be conflicts.



---

archive/issue_comments_136754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-20T07:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136755.json:
```json
{
    "body": "I don't know why \"git trac push 12103 --force\" does not return, although apparently it has succeeded and all commits have arrived on trac. Anyway, I have rebased the branch on top of #19240.",
    "created_at": "2015-09-20T08:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136755",
    "user": "https://github.com/simon-king-jena"
}
```

I don't know why "git trac push 12103 --force" does not return, although apparently it has succeeded and all commits have arrived on trac. Anyway, I have rebased the branch on top of #19240.



---

archive/issue_comments_136756.json:
```json
{
    "body": "By the way, I asked upstream about the \"big\" kernel (for field orders larger than 255) and got the reply that they had it in version 2.2.4, but removed in the most recent versions because apparently nobody has used it. So, if I want to use it, then I have to port the \"big\" kernel from 2.2.4 to 2.4.24 myself.\n\nVery probably I will not do it. For my applications, field orders up to 255 are enough.",
    "created_at": "2015-09-20T08:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136756",
    "user": "https://github.com/simon-king-jena"
}
```

By the way, I asked upstream about the "big" kernel (for field orders larger than 255) and got the reply that they had it in version 2.2.4, but removed in the most recent versions because apparently nobody has used it. So, if I want to use it, then I have to port the "big" kernel from 2.2.4 to 2.4.24 myself.

Very probably I will not do it. For my applications, field orders up to 255 are enough.



---

archive/issue_comments_136757.json:
```json
{
    "body": "In order to have a fully-fledged matrix implementation, I will have a look at sage.matrix.matrix_generic_dense to see what methods need to be implemented.",
    "created_at": "2015-09-20T09:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136757",
    "user": "https://github.com/simon-king-jena"
}
```

In order to have a fully-fledged matrix implementation, I will have a look at sage.matrix.matrix_generic_dense to see what methods need to be implemented.



---

archive/issue_comments_136758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-21T00:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136759.json:
```json
{
    "body": "The implementation of `_matrix_times_matrix_` is now inherited from `sage.matrix.matrix0`, i.e., instead of overriding it I created a method `_strassen_default_cutoff` that returns 0 (which means that Strassen-Winograd is used for all matrices).\n\nAlso, I have wrapped the computation of echelon form. Meataxe only computes a semi-echelon form. Thus, I need to work a little harder to get the reduced row echelon form. Again, it is a lot faster than what currently is in Sage for nonprime finite fields of odd order.",
    "created_at": "2015-09-21T00:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136759",
    "user": "https://github.com/simon-king-jena"
}
```

The implementation of `_matrix_times_matrix_` is now inherited from `sage.matrix.matrix0`, i.e., instead of overriding it I created a method `_strassen_default_cutoff` that returns 0 (which means that Strassen-Winograd is used for all matrices).

Also, I have wrapped the computation of echelon form. Meataxe only computes a semi-echelon form. Thus, I need to work a little harder to get the reduced row echelon form. Again, it is a lot faster than what currently is in Sage for nonprime finite fields of odd order.



---

archive/issue_comments_136760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-21T10:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136761.json:
```json
{
    "body": "In Gaussian elimination, one adds a scalar multiple of one row to another row. In fact, one knows that pivot of the row to add, i.e., in fact one only needs to add a *part* of the row (namely the part after the pivot). However, MeatAxe did always add the complete rows, including the leading zeroes.\n\nThat's obviously a waste of time, and thus I added another patch to MeatAxe in my recent commit.\n\nWith the patch:\n\n```\nsage: M = MatrixSpace(GF(25,'x'),5000).random_element(density=0.001)\nsage: %time N = M.echelon_form()\nCPU times: user 1min 9s, sys: 156 ms, total: 1min 9s\nWall time: 1min 9s\n```\n\nWithout the patch, it is 1min 31s. I guess that's something.\n\nI am unsure if I will implement echelon computation \u00e0 la Strassen. If I do, it is essential to be able to add *parts* of a row, because one operates on matrix windows and not on matrices.",
    "created_at": "2015-09-21T10:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136761",
    "user": "https://github.com/simon-king-jena"
}
```

In Gaussian elimination, one adds a scalar multiple of one row to another row. In fact, one knows that pivot of the row to add, i.e., in fact one only needs to add a *part* of the row (namely the part after the pivot). However, MeatAxe did always add the complete rows, including the leading zeroes.

That's obviously a waste of time, and thus I added another patch to MeatAxe in my recent commit.

With the patch:

```
sage: M = MatrixSpace(GF(25,'x'),5000).random_element(density=0.001)
sage: %time N = M.echelon_form()
CPU times: user 1min 9s, sys: 156 ms, total: 1min 9s
Wall time: 1min 9s
```

Without the patch, it is 1min 31s. I guess that's something.

I am unsure if I will implement echelon computation à la Strassen. If I do, it is essential to be able to add *parts* of a row, because one operates on matrix windows and not on matrices.



---

archive/issue_comments_136762.json:
```json
{
    "body": "Following up on your sage-devel post, you should add a file `build/pkgs/meataxe/dependencies` containing\n\n```\n# no dependencies\n```\n\n\nIn that case, you need to create `$SAGE_LOCAL/include` to avoid\n\n```\ncp: cannot create regular file '/usr/local/src/sage-config/local/include/': Not a directory\nError copying MeatAxe header.\n```\n",
    "created_at": "2015-09-21T13:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136762",
    "user": "https://github.com/jdemeyer"
}
```

Following up on your sage-devel post, you should add a file `build/pkgs/meataxe/dependencies` containing

```
# no dependencies
```


In that case, you need to create `$SAGE_LOCAL/include` to avoid

```
cp: cannot create regular file '/usr/local/src/sage-config/local/include/': Not a directory
Error copying MeatAxe header.
```




---

archive/issue_comments_136763.json:
```json
{
    "body": "Replying to [comment:108 jdemeyer]:\n> Following up on your sage-devel post, you should add a file `build/pkgs/meataxe/dependencies` containing\n> {{{\n> # no dependencies\n> }}}\n\nThank you! Doing it now.\n\n> In that case, you need to create `$SAGE_LOCAL/include` to avoid\n> {{{\n> cp: cannot create regular file '/usr/local/src/sage-config/local/include/': Not a directory\n> Error copying MeatAxe header.\n> }}}\n\nPardon? is $SAGE_LOCAL/include not a standard Sage folder? Or do you mean that I need to do `mkdir -p \"$SAGE_LOCAL/include\"` because the local/include folder is only created during installation of Sage, making sage a dependency?",
    "created_at": "2015-09-21T13:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136763",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:108 jdemeyer]:
> Following up on your sage-devel post, you should add a file `build/pkgs/meataxe/dependencies` containing
> {{{
> # no dependencies
> }}}

Thank you! Doing it now.

> In that case, you need to create `$SAGE_LOCAL/include` to avoid
> {{{
> cp: cannot create regular file '/usr/local/src/sage-config/local/include/': Not a directory
> Error copying MeatAxe header.
> }}}

Pardon? is $SAGE_LOCAL/include not a standard Sage folder? Or do you mean that I need to do `mkdir -p "$SAGE_LOCAL/include"` because the local/include folder is only created during installation of Sage, making sage a dependency?



---

archive/issue_comments_136764.json:
```json
{
    "body": "Replying to [comment:109 SimonKing]:\n> Replying to [comment:108 jdemeyer]:\n> > Following up on your sage-devel post, you should add a file `build/pkgs/meataxe/dependencies` containing\n> > {{{\n> > # no dependencies\n> > }}}\n> \n> Thank you! Doing it now.\n\nDidn't help (edit: ... against the three occurrences of `make -j2 configure`. It did help against `sage -b`).",
    "created_at": "2015-09-21T13:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136764",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:109 SimonKing]:
> Replying to [comment:108 jdemeyer]:
> > Following up on your sage-devel post, you should add a file `build/pkgs/meataxe/dependencies` containing
> > {{{
> > # no dependencies
> > }}}
> 
> Thank you! Doing it now.

Didn't help (edit: ... against the three occurrences of `make -j2 configure`. It did help against `sage -b`).



---

archive/issue_comments_136765.json:
```json
{
    "body": "Replying to [comment:109 SimonKing]:\n> Or do you mean that I need to do `mkdir -p \"$SAGE_LOCAL/include\"` because the local/include folder is only created during installation of Sage\nYes, exactly.",
    "created_at": "2015-09-21T13:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136765",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:109 SimonKing]:
> Or do you mean that I need to do `mkdir -p "$SAGE_LOCAL/include"` because the local/include folder is only created during installation of Sage
Yes, exactly.



---

archive/issue_comments_136766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-21T13:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-21T14:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136768.json:
```json
{
    "body": "Sorry for force-pushing again...\n\nIn the modified version of the previous commit, I do the \"mkdir -p\" thingy for all folders that I use ($SAGE_LOCAL/include and $SAGE_LOCAL/bin).\n\nAlso, I remove all but one compiler warnings for meataxe. The only remaining warning can not be removed. I need that the function `MatrxiToWindow` has a const argument, because it is used in a multiplication function which has const arguments. However, in `MatrixToWindow`, I assign the const argument to a pointer target type.\n\nI think it is fine to ignore the warning. The matrix definitely is not altered inside of `MatrixToWindow` (but may of course be altered by a function that *later* modifies the window).",
    "created_at": "2015-09-21T14:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136768",
    "user": "https://github.com/simon-king-jena"
}
```

Sorry for force-pushing again...

In the modified version of the previous commit, I do the "mkdir -p" thingy for all folders that I use ($SAGE_LOCAL/include and $SAGE_LOCAL/bin).

Also, I remove all but one compiler warnings for meataxe. The only remaining warning can not be removed. I need that the function `MatrxiToWindow` has a const argument, because it is used in a multiplication function which has const arguments. However, in `MatrixToWindow`, I assign the const argument to a pointer target type.

I think it is fine to ignore the warning. The matrix definitely is not altered inside of `MatrixToWindow` (but may of course be altered by a function that *later* modifies the window).



---

archive/issue_comments_136769.json:
```json
{
    "body": "I think there is a very severe problem: Error handling.\n\nI thought that meataxe would set an error and then return an error value, for example in matinv.c in the function zmatinv:\n\n```C\n\tif (f1 == FF_ZERO) \n\t{\n\t    MTX_ERROR1(\"%E\",MTX_ERR_DIV0);\n\t    return -1;\n\t}\n```\n\nwhich should propage to the function MatInverse:\n\n```C\n    if (zmatinv(tmp,dest->Data) != 0) \n    {\n\tMatFree(dest);\n\treturn NULL;\n    }\n    return dest;\n```\n\n\nAnd in my wrapper, I also test for the error return value:\n\n```python\n        sig_on()\n        OUT.Data = MatInverse(self.Data)\n        sig_off()\n        if OUT.Data != NULL:\n            return OUT\n        raise ArithmeticError(\"This matrix is not invertible\")\n```\n\n\nHowever, it doesn't work. I get an immediate crash of Sage without any traceback:\n\n```\nsage: M = MatrixSpace(GF(27,'x'),5).random_element(density=0.4)\nsage: M.rank()\n4\nsage: ~M\nmatinv.c(50):Division by zero\n```\n\n\nHence, I need to study how meataxe manages to crash everything, even though it pretends to handle errors.",
    "created_at": "2015-09-22T07:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136769",
    "user": "https://github.com/simon-king-jena"
}
```

I think there is a very severe problem: Error handling.

I thought that meataxe would set an error and then return an error value, for example in matinv.c in the function zmatinv:

```C
	if (f1 == FF_ZERO) 
	{
	    MTX_ERROR1("%E",MTX_ERR_DIV0);
	    return -1;
	}
```

which should propage to the function MatInverse:

```C
    if (zmatinv(tmp,dest->Data) != 0) 
    {
	MatFree(dest);
	return NULL;
    }
    return dest;
```


And in my wrapper, I also test for the error return value:

```python
        sig_on()
        OUT.Data = MatInverse(self.Data)
        sig_off()
        if OUT.Data != NULL:
            return OUT
        raise ArithmeticError("This matrix is not invertible")
```


However, it doesn't work. I get an immediate crash of Sage without any traceback:

```
sage: M = MatrixSpace(GF(27,'x'),5).random_element(density=0.4)
sage: M.rank()
4
sage: ~M
matinv.c(50):Division by zero
```


Hence, I need to study how meataxe manages to crash everything, even though it pretends to handle errors.



---

archive/issue_comments_136770.json:
```json
{
    "body": "I think it is the default error handler doing the following:\n\n```C\nstatic void DefaultHandler(const MtxErrorRecord_t *e)\n{\n    static int count = 0;\n    if (LogFile == NULL)\n\tLogFile = stderr;\n\n    if (e->FileInfo != NULL)\n\tfprintf(LogFile,\"%s(%d):\",e->FileInfo->BaseName,e->LineNo);\n    fprintf(LogFile,\"%s\\n\",e->Text);\n    if (--count <= 0)\n\texit(255);\n}\n```\n\n\nApparently Sage's sig_on()/sig_off() cannot deal with the line `exit(255);`, right?\n\nSo, should I patch the default error handler, making it signal something that sig_on()/off() can deal with? What would that be?\n\nOr perhaps I know something better: I think the usual MeatAxe binaries could very well keep using the current error handler. However, in my wrapper, I could instead define a new error handler and set it with `MtxSetErrorHandler`.",
    "created_at": "2015-09-22T07:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136770",
    "user": "https://github.com/simon-king-jena"
}
```

I think it is the default error handler doing the following:

```C
static void DefaultHandler(const MtxErrorRecord_t *e)
{
    static int count = 0;
    if (LogFile == NULL)
	LogFile = stderr;

    if (e->FileInfo != NULL)
	fprintf(LogFile,"%s(%d):",e->FileInfo->BaseName,e->LineNo);
    fprintf(LogFile,"%s\n",e->Text);
    if (--count <= 0)
	exit(255);
}
```


Apparently Sage's sig_on()/sig_off() cannot deal with the line `exit(255);`, right?

So, should I patch the default error handler, making it signal something that sig_on()/off() can deal with? What would that be?

Or perhaps I know something better: I think the usual MeatAxe binaries could very well keep using the current error handler. However, in my wrapper, I could instead define a new error handler and set it with `MtxSetErrorHandler`.



---

archive/issue_comments_136771.json:
```json
{
    "body": "The fact that the error handler is called `DefaultHandler` seems to imply that it's possible to change the error handler...\n\nFor a simple example of a custom error handler for a C library, see the `error_handler` function in `src/sage/libs/gap/util.pyx`",
    "created_at": "2015-09-22T08:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136771",
    "user": "https://github.com/jdemeyer"
}
```

The fact that the error handler is called `DefaultHandler` seems to imply that it's possible to change the error handler...

For a simple example of a custom error handler for a C library, see the `error_handler` function in `src/sage/libs/gap/util.pyx`



---

archive/issue_comments_136772.json:
```json
{
    "body": "Replying to [comment:117 jdemeyer]:\n> The fact that the error handler is called `DefaultHandler` seems to imply that it's possible to change the error handler...\n\nSure. I already mentioned `MtxSetErrorHandler`.\n\n> For a simple example of a custom error handler for a C library, see the `error_handler` function in `src/sage/libs/gap/util.pyx`\n\nThank you, I'll have a look!",
    "created_at": "2015-09-22T08:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136772",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:117 jdemeyer]:
> The fact that the error handler is called `DefaultHandler` seems to imply that it's possible to change the error handler...

Sure. I already mentioned `MtxSetErrorHandler`.

> For a simple example of a custom error handler for a C library, see the `error_handler` function in `src/sage/libs/gap/util.pyx`

Thank you, I'll have a look!



---

archive/issue_comments_136773.json:
```json
{
    "body": "In case you're wondering: the function `PyErr_SetObject()` is a low-level version of `raise`: it \"raises\" an exception but execution continues to the `sig_error()` which is handled by `sig_on()`.",
    "created_at": "2015-09-22T08:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136773",
    "user": "https://github.com/jdemeyer"
}
```

In case you're wondering: the function `PyErr_SetObject()` is a low-level version of `raise`: it "raises" an exception but execution continues to the `sig_error()` which is handled by `sig_on()`.



---

archive/issue_comments_136774.json:
```json
{
    "body": "I am not sure if the error handler should do sig_error().\n\nThere are some places in meataxe where a function A calls a function B, and if B returns an error value then A deallocates temporary data before returning an error value as well.\n\nWouldn't we prevent meataxe from these clean-up operations (causing a memory leak on error) if we would raise sig_error()?",
    "created_at": "2015-09-22T08:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136774",
    "user": "https://github.com/simon-king-jena"
}
```

I am not sure if the error handler should do sig_error().

There are some places in meataxe where a function A calls a function B, and if B returns an error value then A deallocates temporary data before returning an error value as well.

Wouldn't we prevent meataxe from these clean-up operations (causing a memory leak on error) if we would raise sig_error()?



---

archive/issue_comments_136775.json:
```json
{
    "body": "Replying to [comment:120 SimonKing]:\n> Wouldn't we prevent meataxe from these clean-up operations (causing a memory leak on error) if we would raise sig_error()?\nYes.\n\nBut since I don't know the specifics of the meataxe error handling system, I cannot comment further.",
    "created_at": "2015-09-22T08:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136775",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:120 SimonKing]:
> Wouldn't we prevent meataxe from these clean-up operations (causing a memory leak on error) if we would raise sig_error()?
Yes.

But since I don't know the specifics of the meataxe error handling system, I cannot comment further.



---

archive/issue_comments_136776.json:
```json
{
    "body": "Replying to [comment:121 jdemeyer]:\n> Replying to [comment:120 SimonKing]:\n> > Wouldn't we prevent meataxe from these clean-up operations (causing a memory leak on error) if we would raise sig_error()?\n> Yes.\n\nThe question is if we care. But perhaps we should, since catching errors and coping with it is typical for Python, and that has caused problems in the past (I recall some problem with the Gap interface, because a tight loop occasionally catching errors eventually exceeded the allowed number of errors in Gap).\n\nDoes meataxe care itself? That's unclear. I have seen instances of the cleaning-up-on-error, but I have seen other cases in which it does not clean up.\n\n> But since I don't know the specifics of the meataxe error handling system, I cannot comment further.\n\nI am not sure if one can call it a \"system\". Anyway. There is a function that defines the error handler to-be-used. The function `MtxError` creates an error record (containing information on file name and line number and error code) and calls the error handler with it.\n\nIn sage.libs.gap.util, the error handler sets an exception and signals sig_error(). An alternative approach would be an error handler that just sets an exception. If the meataxe functions are wrapped with an error value (such as `cdef Matrix_t *MatInverse(Matrix_t M) except NULL`) then this error would be raised, wouldn't it?\n\nTo me, it seems like a cleaner approach, as it allows meataxe to cope with the exception. Plus, we would see if meataxe really respects its own error values (otherwise we would see crashes in the wrapper) and could fix that. Meanwhile I have THREE patches that should be send upstream, and I wouldn't mind a fourth patch.",
    "created_at": "2015-09-22T10:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136776",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:121 jdemeyer]:
> Replying to [comment:120 SimonKing]:
> > Wouldn't we prevent meataxe from these clean-up operations (causing a memory leak on error) if we would raise sig_error()?
> Yes.

The question is if we care. But perhaps we should, since catching errors and coping with it is typical for Python, and that has caused problems in the past (I recall some problem with the Gap interface, because a tight loop occasionally catching errors eventually exceeded the allowed number of errors in Gap).

Does meataxe care itself? That's unclear. I have seen instances of the cleaning-up-on-error, but I have seen other cases in which it does not clean up.

> But since I don't know the specifics of the meataxe error handling system, I cannot comment further.

I am not sure if one can call it a "system". Anyway. There is a function that defines the error handler to-be-used. The function `MtxError` creates an error record (containing information on file name and line number and error code) and calls the error handler with it.

In sage.libs.gap.util, the error handler sets an exception and signals sig_error(). An alternative approach would be an error handler that just sets an exception. If the meataxe functions are wrapped with an error value (such as `cdef Matrix_t *MatInverse(Matrix_t M) except NULL`) then this error would be raised, wouldn't it?

To me, it seems like a cleaner approach, as it allows meataxe to cope with the exception. Plus, we would see if meataxe really respects its own error values (otherwise we would see crashes in the wrapper) and could fix that. Meanwhile I have THREE patches that should be send upstream, and I wouldn't mind a fourth patch.



---

archive/issue_comments_136777.json:
```json
{
    "body": "Replying to [comment:122 SimonKing]:\n> In sage.libs.gap.util, the error handler sets an exception and signals sig_error(). An alternative approach would be an error handler that just sets an exception. If the meataxe functions are wrapped with an error value (such as `cdef Matrix_t *MatInverse(Matrix_t M) except NULL`) then this error would be raised, wouldn't it?\n\nAt least in theory, that would work. You do need to be sure that the result is `NULL` **if and only if** the error handler was called. I agree that it would be cleaner if you can make it work because that would completely bypass the `sig_on()` system.",
    "created_at": "2015-09-22T10:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136777",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:122 SimonKing]:
> In sage.libs.gap.util, the error handler sets an exception and signals sig_error(). An alternative approach would be an error handler that just sets an exception. If the meataxe functions are wrapped with an error value (such as `cdef Matrix_t *MatInverse(Matrix_t M) except NULL`) then this error would be raised, wouldn't it?

At least in theory, that would work. You do need to be sure that the result is `NULL` **if and only if** the error handler was called. I agree that it would be cleaner if you can make it work because that would completely bypass the `sig_on()` system.



---

archive/issue_comments_136778.json:
```json
{
    "body": "Replying to [comment:123 jdemeyer]:\n> At least in theory, that would work. You do need to be sure that the result is `NULL` **if and only if** the error handler was called.\n\nAt least the meataxe documentation occasionally mentions that a certain value is returned on error.\n\nAnd to be on the safe side, one could perhaps do `cdef Matrix_t *MatInverse(Matrix_t M) except? NULL`. Then, Cython would check if there is an exception set, and otherwise it would just continue.",
    "created_at": "2015-09-22T10:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136778",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:123 jdemeyer]:
> At least in theory, that would work. You do need to be sure that the result is `NULL` **if and only if** the error handler was called.

At least the meataxe documentation occasionally mentions that a certain value is returned on error.

And to be on the safe side, one could perhaps do `cdef Matrix_t *MatInverse(Matrix_t M) except? NULL`. Then, Cython would check if there is an exception set, and otherwise it would just continue.



---

archive/issue_comments_136779.json:
```json
{
    "body": "Replying to [comment:124 SimonKing]:\n> otherwise it would just continue.\nWould that make sense? If you're doing something with the result, you need that it's not `NULL`, so the `except NULL` can actually be an additional sanity check (IIRC, Cython raises a `SystemError` when there is no exception set if there should be one. That's safer that a segfault because you forgot to check for a `NULL`).",
    "created_at": "2015-09-22T10:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136779",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:124 SimonKing]:
> otherwise it would just continue.
Would that make sense? If you're doing something with the result, you need that it's not `NULL`, so the `except NULL` can actually be an additional sanity check (IIRC, Cython raises a `SystemError` when there is no exception set if there should be one. That's safer that a segfault because you forgot to check for a `NULL`).



---

archive/issue_comments_136780.json:
```json
{
    "body": "Replying to [comment:125 jdemeyer]:\n> Replying to [comment:124 SimonKing]:\n> > otherwise it would just continue.\n> Would that make sense? If you're doing something with the result, you need that it's not `NULL`, so the `except NULL` can actually be an additional sanity check (IIRC, Cython raises a `SystemError` when there is no exception set if there should be one. That's safer that a segfault because you forgot to check for a `NULL`).\n\nCorrect. The edits I am currently doing generally assume an error if an error value occurs (accepting Cython's SystemError as an answer). There is one function where the docs say that the value -1 means that PERHAPS there was an exception, and I'll use `except?` only in those cases.",
    "created_at": "2015-09-22T10:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136780",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:125 jdemeyer]:
> Replying to [comment:124 SimonKing]:
> > otherwise it would just continue.
> Would that make sense? If you're doing something with the result, you need that it's not `NULL`, so the `except NULL` can actually be an additional sanity check (IIRC, Cython raises a `SystemError` when there is no exception set if there should be one. That's safer that a segfault because you forgot to check for a `NULL`).

Correct. The edits I am currently doing generally assume an error if an error value occurs (accepting Cython's SystemError as an answer). There is one function where the docs say that the value -1 means that PERHAPS there was an exception, and I'll use `except?` only in those cases.



---

archive/issue_comments_136781.json:
```json
{
    "body": "I was mistaken in one point: `MtxErrorRecord_t` does not contain the error code. It only contains a message that was created from the error record. The error messages are taken from a \"static struct\" that is part of the file message.c\n\nSince the list of these error messages is finite and is in one-to-one correspondence to the error codes, I will translate each mesage back into the error code and use the appropriate error (`ZeroDivisionError`, `MemoryError`, `ArithmeticError` etc).\n\nIf you think that it isn't worth it, I could instead create a new error type `MtxError`, that is raised whenever an error occurs in meataxe. But I will go for the \"long\" solution, if you don't stop me...",
    "created_at": "2015-09-22T11:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136781",
    "user": "https://github.com/simon-king-jena"
}
```

I was mistaken in one point: `MtxErrorRecord_t` does not contain the error code. It only contains a message that was created from the error record. The error messages are taken from a "static struct" that is part of the file message.c

Since the list of these error messages is finite and is in one-to-one correspondence to the error codes, I will translate each mesage back into the error code and use the appropriate error (`ZeroDivisionError`, `MemoryError`, `ArithmeticError` etc).

If you think that it isn't worth it, I could instead create a new error type `MtxError`, that is raised whenever an error occurs in meataxe. But I will go for the "long" solution, if you don't stop me...



---

archive/issue_comments_136782.json:
```json
{
    "body": "It seems to work. With the commit that I am preparing now and that also contains some doctests, I obtain:\n\n```\nsage: M = MatrixSpace(GF(27,'x'),5).random_element(density=0.4)\nsage: M.rank()\n5\nsage: ~M\n[            1 x^2 + 2*x + 2             0             0             0]\n[    x^2 + 2*x     2*x^2 + 2           x^2             0   x^2 + x + 2]\n[      x^2 + 2           x^2         2*x^2     2*x^2 + 1       x^2 + 2]\n[            1       x^2 + x           2*x             0             0]\n[    2*x^2 + x             x             0             0             0]\nsage: M = MatrixSpace(GF(27,'x'),5).random_element(density=0.4)\nsage: M.rank()\n4\nsage: ~M\n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\n<ipython-input-6-1888fd9efc66> in <module>()\n----> 1 ~M\n\n/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__invert__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:12186)()\n   1032         OUT._cache = {}\n   1033         sig_on()\n-> 1034         OUT.Data = MatInverse(self.Data)\n   1035         sig_off()\n   1036         if OUT.Data != NULL:\n\nZeroDivisionError: Division by zero in file matinv.c (line 50)\n```\n",
    "created_at": "2015-09-22T11:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136782",
    "user": "https://github.com/simon-king-jena"
}
```

It seems to work. With the commit that I am preparing now and that also contains some doctests, I obtain:

```
sage: M = MatrixSpace(GF(27,'x'),5).random_element(density=0.4)
sage: M.rank()
5
sage: ~M
[            1 x^2 + 2*x + 2             0             0             0]
[    x^2 + 2*x     2*x^2 + 2           x^2             0   x^2 + x + 2]
[      x^2 + 2           x^2         2*x^2     2*x^2 + 1       x^2 + 2]
[            1       x^2 + x           2*x             0             0]
[    2*x^2 + x             x             0             0             0]
sage: M = MatrixSpace(GF(27,'x'),5).random_element(density=0.4)
sage: M.rank()
4
sage: ~M
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
<ipython-input-6-1888fd9efc66> in <module>()
----> 1 ~M

/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__invert__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:12186)()
   1032         OUT._cache = {}
   1033         sig_on()
-> 1034         OUT.Data = MatInverse(self.Data)
   1035         sig_off()
   1036         if OUT.Data != NULL:

ZeroDivisionError: Division by zero in file matinv.c (line 50)
```




---

archive/issue_comments_136783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-22T16:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_136784.json:
```json
{
    "body": "With the new commits, there is full doctest coverage for the MeatAxe wrapper. Both\n\n```\nsage -t --optional=sage,meataxe src/sage/matrix/matrix_gfpn_dense.pyx\n```\n\nand\n\n```\nsage -t src/sage/matrix/matrix_gfpn_dense.pyx\n```\n\npass.\n\nMoreover, as I have announced above, I can now handle errors in MeatAxe.\n\nAnother change: I have removed the `__pow__` method: The default `__pow__` method automatically uses Strassen multiplication and is thus faster than the previous method, which called MeatAxe's `MatPower` (which doesn't use Strassen).\n\nProbably I have to work on several doctests in other files: All tests depending on a random matrix may fail with meataxe, thus, for these cases I need to force usage of `Matrix_generic_dense`.",
    "created_at": "2015-09-22T16:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136784",
    "user": "https://github.com/simon-king-jena"
}
```

With the new commits, there is full doctest coverage for the MeatAxe wrapper. Both

```
sage -t --optional=sage,meataxe src/sage/matrix/matrix_gfpn_dense.pyx
```

and

```
sage -t src/sage/matrix/matrix_gfpn_dense.pyx
```

pass.

Moreover, as I have announced above, I can now handle errors in MeatAxe.

Another change: I have removed the `__pow__` method: The default `__pow__` method automatically uses Strassen multiplication and is thus faster than the previous method, which called MeatAxe's `MatPower` (which doesn't use Strassen).

Probably I have to work on several doctests in other files: All tests depending on a random matrix may fail with meataxe, thus, for these cases I need to force usage of `Matrix_generic_dense`.



---

archive/issue_comments_136785.json:
```json
{
    "body": "Problem:\n\n```\nsage: K.<a> = GF(25)\nsage: MS = MatrixSpace(K, 2, 4)\nsage: M = MS([4, 4, 1, 0, 0, 2*a+1, a+2, 1])\nsage: M.echelon_form()\n[      4       4       1       0]\n[      0 2*a + 1   a + 2       1]\n```\n",
    "created_at": "2015-09-22T21:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136785",
    "user": "https://github.com/simon-king-jena"
}
```

Problem:

```
sage: K.<a> = GF(25)
sage: MS = MatrixSpace(K, 2, 4)
sage: M = MS([4, 4, 1, 0, 0, 2*a+1, a+2, 1])
sage: M.echelon_form()
[      4       4       1       0]
[      0 2*a + 1   a + 2       1]
```




---

archive/issue_comments_136786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-22T22:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136787.json:
```json
{
    "body": "I have fixed the computation of row-reduced echelon form.\n\n- With the current branch, meataxe in Sage is substantially improved compared with upstream (fixes for multiplication table IO, some speed-ups for echelon computation, Strassen-Winograd, error handling).\n- Matrix arithmetic over small non-prime fields of odd order will be vastly faster with meataxe than with the previously used matrix implementation in Sage.\n- Doctest coverage of the Cython wrapper is 100%.\n- `make test` should now pass (I need to re-run \"make test\" after fixing the errors, though).\n\nHence: Needs review!",
    "created_at": "2015-09-22T23:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136787",
    "user": "https://github.com/simon-king-jena"
}
```

I have fixed the computation of row-reduced echelon form.

- With the current branch, meataxe in Sage is substantially improved compared with upstream (fixes for multiplication table IO, some speed-ups for echelon computation, Strassen-Winograd, error handling).
- Matrix arithmetic over small non-prime fields of odd order will be vastly faster with meataxe than with the previously used matrix implementation in Sage.
- Doctest coverage of the Cython wrapper is 100%.
- `make test` should now pass (I need to re-run "make test" after fixing the errors, though).

Hence: Needs review!



---

archive/issue_comments_136788.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-22T23:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136788",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136789.json:
```json
{
    "body": "Changing component from packages: experimental to packages: optional.",
    "created_at": "2015-09-22T23:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136789",
    "user": "https://github.com/simon-king-jena"
}
```

Changing component from packages: experimental to packages: optional.



---

archive/issue_comments_136790.json:
```json
{
    "body": "PS: I suggest that meataxe will be optional, not experimental.",
    "created_at": "2015-09-22T23:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136790",
    "user": "https://github.com/simon-king-jena"
}
```

PS: I suggest that meataxe will be optional, not experimental.



---

archive/issue_comments_136791.json:
```json
{
    "body": "+1 for making it optional.",
    "created_at": "2015-09-23T14:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136791",
    "user": "https://github.com/tscrim"
}
```

+1 for making it optional.



---

archive/issue_events_032159.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-09-23T14:34:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32159"
}
```



---

archive/issue_events_032160.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-09-23T14:34:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32160"
}
```



---

archive/issue_comments_136792.json:
```json
{
    "body": "Sigh. I shot into my own foot: After installing this package, I couldn't install my cohomology package (because the latter relies on meataxe-2.2.4).",
    "created_at": "2015-09-23T16:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136792",
    "user": "https://github.com/simon-king-jena"
}
```

Sigh. I shot into my own foot: After installing this package, I couldn't install my cohomology package (because the latter relies on meataxe-2.2.4).



---

archive/issue_comments_136793.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-25T07:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136793",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136794.json:
```json
{
    "body": "Motivated by the attempt to rebase my cohomology package on the new meataxe version, I try to be a bit more careful concerning errors in meataxe.\n\nI made a thorough list of all functions in meataxe that use MTX_ERROR (or some variation thereof). I found that not all of them have error values set. Some of them have a documentation defining an error value, but the function in some cases does not return them. And if a function returning an error value is called by a second function, then the error value is not always dealt with.\n\nIt would be a very messy work to fix error handling thoroughly. I thus try to go a middle way:\n- I will ignore MeatAxe's stand-alone programs, because they are *supposed* to immediately exit on error. In particular, I will also ignore functions checking command line arguments.\n- I will try to only deal with functions that are relevant for matrix arithmetic, because that's the only part of meataxe that I am wrapping here.\n\nHence, if someone in future wants to wrap the more interesting parts of MeatAxe (all the representation theory stuff), then he or she has to deal with it.",
    "created_at": "2015-09-25T07:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136794",
    "user": "https://github.com/simon-king-jena"
}
```

Motivated by the attempt to rebase my cohomology package on the new meataxe version, I try to be a bit more careful concerning errors in meataxe.

I made a thorough list of all functions in meataxe that use MTX_ERROR (or some variation thereof). I found that not all of them have error values set. Some of them have a documentation defining an error value, but the function in some cases does not return them. And if a function returning an error value is called by a second function, then the error value is not always dealt with.

It would be a very messy work to fix error handling thoroughly. I thus try to go a middle way:
- I will ignore MeatAxe's stand-alone programs, because they are *supposed* to immediately exit on error. In particular, I will also ignore functions checking command line arguments.
- I will try to only deal with functions that are relevant for matrix arithmetic, because that's the only part of meataxe that I am wrapping here.

Hence, if someone in future wants to wrap the more interesting parts of MeatAxe (all the representation theory stuff), then he or she has to deal with it.



---

archive/issue_comments_136795.json:
```json
{
    "body": "PS: Also ignore the test suite, as that is supposed to have a non-default error handler anyway. And as long as the test suite passes, I could care less about its error handling.",
    "created_at": "2015-09-25T07:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136795",
    "user": "https://github.com/simon-king-jena"
}
```

PS: Also ignore the test suite, as that is supposed to have a non-default error handler anyway. And as long as the test suite passes, I could care less about its error handling.



---

archive/issue_comments_136796.json:
```json
{
    "body": "To summarise, it seems to me that everything concerning\n\n- stand-alone programs\n- test suite\n- \"bit strings\"\n- polynomials and their factorisation (I currently do not wrap characteristic polynomials!)\n- \"greased\" matrices (but see below!)\n- integer matrices (I am only interested in finite fields)\n- representations\n- lattices\n- matrix sets\n- sets\n- permutations\n- operating system stuff. I am not going to fix setting a timeout in meataxe, because we can set a timeout in Sage, with `alarm(...)`, provided that we wrap meataxe calls in sig_on()/sig_off().\n- word generators\n\nis not relevant at that point. I'll focus on what remains.\n\n__Greased matrices__\n\nSomething that I have ignored but perhaps should consider in future: \"Greased matrices\". From the documentation, it seems that greased matrices use more memory, but have faster row operations achieved by precomputing linear combinations of blocks of rows. So, if meataxe becomes an optional package with `Matrix_gfpn_dense` wrapping meataxe matrices, then a further development would be a wrapper for greased matrices.",
    "created_at": "2015-09-25T07:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136796",
    "user": "https://github.com/simon-king-jena"
}
```

To summarise, it seems to me that everything concerning

- stand-alone programs
- test suite
- "bit strings"
- polynomials and their factorisation (I currently do not wrap characteristic polynomials!)
- "greased" matrices (but see below!)
- integer matrices (I am only interested in finite fields)
- representations
- lattices
- matrix sets
- sets
- permutations
- operating system stuff. I am not going to fix setting a timeout in meataxe, because we can set a timeout in Sage, with `alarm(...)`, provided that we wrap meataxe calls in sig_on()/sig_off().
- word generators

is not relevant at that point. I'll focus on what remains.

__Greased matrices__

Something that I have ignored but perhaps should consider in future: "Greased matrices". From the documentation, it seems that greased matrices use more memory, but have faster row operations achieved by precomputing linear combinations of blocks of rows. So, if meataxe becomes an optional package with `Matrix_gfpn_dense` wrapping meataxe matrices, then a further development would be a wrapper for greased matrices.



---

archive/issue_comments_136797.json:
```json
{
    "body": "Also I will not do error propagation for `MatFree`.",
    "created_at": "2015-09-25T10:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136797",
    "user": "https://github.com/simon-king-jena"
}
```

Also I will not do error propagation for `MatFree`.



---

archive/issue_comments_136798.json:
```json
{
    "body": "I have a patch that \"should work\" (TM). But the test suite consistently fails in a part that I didn't change (concerning the stand-alone program zmw, which is supposed to \"Make word\"). The program relies on computation of null space which (I thinK) I haven't changed, except for error handling. Sigh.",
    "created_at": "2015-09-25T12:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136798",
    "user": "https://github.com/simon-king-jena"
}
```

I have a patch that "should work" (TM). But the test suite consistently fails in a part that I didn't change (concerning the stand-alone program zmw, which is supposed to "Make word"). The program relies on computation of null space which (I thinK) I haven't changed, except for error handling. Sigh.



---

archive/issue_comments_136799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-25T22:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136800.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-25T23:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136800",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136801.json:
```json
{
    "body": "The problems with error propagation are solved, tests with the current patch should still pass, and I think it is good that with the fifth patch MeatAxe becomes a lot more consequent in using specific return values indicating an error. Thus, it an error handler that doesn't exit on error became even more useful.\n\nFor now, I have no idea for further improvements (but perhaps you have ideas?). So, I will continue to try and rebase David Green's programs for my group cohomology package.",
    "created_at": "2015-09-25T23:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136801",
    "user": "https://github.com/simon-king-jena"
}
```

The problems with error propagation are solved, tests with the current patch should still pass, and I think it is good that with the fifth patch MeatAxe becomes a lot more consequent in using specific return values indicating an error. Thus, it an error handler that doesn't exit on error became even more useful.

For now, I have no idea for further improvements (but perhaps you have ideas?). So, I will continue to try and rebase David Green's programs for my group cohomology package.



---

archive/issue_comments_136802.json:
```json
{
    "body": "Replying to [comment:143 SimonKing]:\n> For now, I have no idea for further improvements ...\n\nOne detail comes to my mind: MeatAxe does not only have MTX_ERROR, but also MTX_ASSERT and MTX_VERIFY. I made sure that after all instances of MTX_ERROR outside of stand-alone executables an error return value is returned. This is yet to be done for MTX_ASSERT and MTX_VERIFY.",
    "created_at": "2015-09-26T08:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136802",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:143 SimonKing]:
> For now, I have no idea for further improvements ...

One detail comes to my mind: MeatAxe does not only have MTX_ERROR, but also MTX_ASSERT and MTX_VERIFY. I made sure that after all instances of MTX_ERROR outside of stand-alone executables an error return value is returned. This is yet to be done for MTX_ASSERT and MTX_VERIFY.



---

archive/issue_comments_136803.json:
```json
{
    "body": "OTOH, I feel that I am overdoing it. So, I will *not* deal with MTX_ASSERT and MTX_VERIFY, unless requested by the referee.",
    "created_at": "2015-09-26T08:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136803",
    "user": "https://github.com/simon-king-jena"
}
```

OTOH, I feel that I am overdoing it. So, I will *not* deal with MTX_ASSERT and MTX_VERIFY, unless requested by the referee.



---

archive/issue_comments_136804.json:
```json
{
    "body": "Replying to [comment:51 SimonKing]:\n> Complain to upstream. The tarball is directly from their website. I'm not going to fix that.\nUpstream's answer:\n\n```\nI am currently working on a 2.4 release that will solve some known \nproblems and hopefully not break anthing else (it's been a long\ntime since I last touched the code...). The next TAR release will\ncontain a properly named root directory as you suggested. \n\nI am not sure, however, when the release will be ready.\n```\n",
    "created_at": "2015-09-29T11:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136804",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:51 SimonKing]:
> Complain to upstream. The tarball is directly from their website. I'm not going to fix that.
Upstream's answer:

```
I am currently working on a 2.4 release that will solve some known 
problems and hopefully not break anthing else (it's been a long
time since I last touched the code...). The next TAR release will
contain a properly named root directory as you suggested. 

I am not sure, however, when the release will be ready.
```




---

archive/issue_comments_136805.json:
```json
{
    "body": "Replying to [comment:146 jdemeyer]:\n> Replying to [comment:51 SimonKing]:\n> > Complain to upstream. The tarball is directly from their website. I'm not going to fix that.\n> Upstream's answer:\n> {{{\n> I am currently working on a 2.4 release that will solve some known \n> problems and hopefully not break anthing else (it's been a long\n> time since I last touched the code...). The next TAR release will\n> contain a properly named root directory as you suggested. \n> \n> I am not sure, however, when the release will be ready.\n> }}}\n\nOMG. I see coming that my patches won't apply on the new release.",
    "created_at": "2015-09-29T11:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136805",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:146 jdemeyer]:
> Replying to [comment:51 SimonKing]:
> > Complain to upstream. The tarball is directly from their website. I'm not going to fix that.
> Upstream's answer:
> {{{
> I am currently working on a 2.4 release that will solve some known 
> problems and hopefully not break anthing else (it's been a long
> time since I last touched the code...). The next TAR release will
> contain a properly named root directory as you suggested. 
> 
> I am not sure, however, when the release will be ready.
> }}}

OMG. I see coming that my patches won't apply on the new release.



---

archive/issue_comments_136806.json:
```json
{
    "body": "I have sent my patches upstream a minute ago.",
    "created_at": "2015-09-30T16:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136806",
    "user": "https://github.com/simon-king-jena"
}
```

I have sent my patches upstream a minute ago.



---

archive/issue_comments_136807.json:
```json
{
    "body": "Any answer from upstream?\n\nDo you have an idea who could review those patches, because I seems to me that it should only be reviewed by somebody who knows meataxe.\n\nOne detail I spotted in the code: replace `except:` by `except BaseException:` (I assume that people write `except:` by mistake, so it's better to be explicit that you really want to catch everything).",
    "created_at": "2015-10-05T08:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136807",
    "user": "https://github.com/jdemeyer"
}
```

Any answer from upstream?

Do you have an idea who could review those patches, because I seems to me that it should only be reviewed by somebody who knows meataxe.

One detail I spotted in the code: replace `except:` by `except BaseException:` (I assume that people write `except:` by mistake, so it's better to be explicit that you really want to catch everything).



---

archive/issue_comments_136808.json:
```json
{
    "body": "Replying to [comment:149 jdemeyer]:\n> Any answer from upstream?\n\nUnfortunately not.\n\n> Do you have an idea who could review those patches, because I seems to me that it should only be reviewed by somebody who knows meataxe.\n\nThis might be difficult. But the following should be possible even without deeper knowledge of meataxe:\n- Does the package keeps the promise that multiplication tables (name pXYZ.zzz, where XYZ is the order of the field) will not pollute the current directory?\n- Are there memory leaks? Combine various random matrices by stacking, slicing, multiplication, copying etc, delete everything, repeat in a loop, and see if any memory is lost.\n- Manually create the same large random matrices once in meataxe and once in the current sage backends. That includes the case of fields of characteristic 2 and prime fields, where meataxe will not be used by default. Then do arithmetic, including echolonization, and compare (using `M.list()`) if the results coincide in all implementations. There are examples of that type in the docs.\n- In addition to the previous class of tests, compare the timings. You will hopefully find that for non-prime fields of odd characteristic meataxe is clearly superior over the current Sage implementation.\n- Concerning Strassen-Winograd (which is not in upstream meataxe): Compare the results of multiplication using school book and Strassen-Winograd algorithm, with different cutoff and different matrix dimensions. Here, both the results (via `M.list()`) and the performance (memory consumption) should be compared. Also it can be tested if the default cutoff I chose is optimal even on 32bit machines (I only tested on 64 bit).\n\nI think a review based on such test would be valid. I doubt that for our current standard backends the review was more thorough than what I suggest here for an optional backend.\n\n> One detail I spotted in the code: replace `except:` by `except BaseException:` (I assume that people write `except:` by mistake, so it's better to be explicit that you really want to catch everything).\n\nOK, can do.",
    "created_at": "2015-10-05T11:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136808",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:149 jdemeyer]:
> Any answer from upstream?

Unfortunately not.

> Do you have an idea who could review those patches, because I seems to me that it should only be reviewed by somebody who knows meataxe.

This might be difficult. But the following should be possible even without deeper knowledge of meataxe:
- Does the package keeps the promise that multiplication tables (name pXYZ.zzz, where XYZ is the order of the field) will not pollute the current directory?
- Are there memory leaks? Combine various random matrices by stacking, slicing, multiplication, copying etc, delete everything, repeat in a loop, and see if any memory is lost.
- Manually create the same large random matrices once in meataxe and once in the current sage backends. That includes the case of fields of characteristic 2 and prime fields, where meataxe will not be used by default. Then do arithmetic, including echolonization, and compare (using `M.list()`) if the results coincide in all implementations. There are examples of that type in the docs.
- In addition to the previous class of tests, compare the timings. You will hopefully find that for non-prime fields of odd characteristic meataxe is clearly superior over the current Sage implementation.
- Concerning Strassen-Winograd (which is not in upstream meataxe): Compare the results of multiplication using school book and Strassen-Winograd algorithm, with different cutoff and different matrix dimensions. Here, both the results (via `M.list()`) and the performance (memory consumption) should be compared. Also it can be tested if the default cutoff I chose is optimal even on 32bit machines (I only tested on 64 bit).

I think a review based on such test would be valid. I doubt that for our current standard backends the review was more thorough than what I suggest here for an optional backend.

> One detail I spotted in the code: replace `except:` by `except BaseException:` (I assume that people write `except:` by mistake, so it's better to be explicit that you really want to catch everything).

OK, can do.



---

archive/issue_comments_136809.json:
```json
{
    "body": "Replying to [comment:150 SimonKing]:\n> I doubt that for our current standard backends the review was more thorough than what I suggest here for an optional backend.\n\nA fair comment, but those standard backends are not heavily patched with patches which are not accepted by upstream.\n\nUpstream code does not need a review, but these patches *do* need a review.",
    "created_at": "2015-10-05T12:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136809",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:150 SimonKing]:
> I doubt that for our current standard backends the review was more thorough than what I suggest here for an optional backend.

A fair comment, but those standard backends are not heavily patched with patches which are not accepted by upstream.

Upstream code does not need a review, but these patches *do* need a review.



---

archive/issue_comments_136810.json:
```json
{
    "body": "I think you are still mis-using some of the error handling.\n\nFor example, you have\n\n```\nint MatEchelonize(Matrix_t *mat) except -1\n```\n\nbut you still write\n\n```\n        if MatEchelonize(self.Data) == -1:\n            raise ArithmeticError(\"Error echelonizing this matrix\")\n```\n\nThe latter should just be\n\n```\nMatEchelonize(self.Data)\n```\n",
    "created_at": "2015-10-05T12:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136810",
    "user": "https://github.com/jdemeyer"
}
```

I think you are still mis-using some of the error handling.

For example, you have

```
int MatEchelonize(Matrix_t *mat) except -1
```

but you still write

```
        if MatEchelonize(self.Data) == -1:
            raise ArithmeticError("Error echelonizing this matrix")
```

The latter should just be

```
MatEchelonize(self.Data)
```




---

archive/issue_comments_136811.json:
```json
{
    "body": "You can remove these parts from `spkg-install`:\n\n```diff\n+# Just to be sure, we also create other folders, although\n+# they are standard SageMath folders\n+\n+mkdir -p $MTXBIN\n+\n+if [ $? -ne 0 ]; then\n+    echo >&2 \"Error creating directory for meataxe binaries.\"\n+    exit 1\n+fi\n+\n+mkdir -p \"$SAGE_LOCAL/include\"\n+\n+if [ $? -ne 0 ]; then\n+    echo >&2 \"Error creating SageMath's include directory.\"\n+    exit 1\n+fi\n+\n+mkdir -p \"$SAGE_LOCAL/lib\"\n+\n+if [ $? -ne 0 ]; then\n+    echo >&2 \"Error creating SageMath's lib folder.\"\n+    exit 1\n+fi\n```\n\n\n(I know I asked you to add these, but in the mean time the build system was improved)",
    "created_at": "2015-10-05T12:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136811",
    "user": "https://github.com/jdemeyer"
}
```

You can remove these parts from `spkg-install`:

```diff
+# Just to be sure, we also create other folders, although
+# they are standard SageMath folders
+
+mkdir -p $MTXBIN
+
+if [ $? -ne 0 ]; then
+    echo >&2 "Error creating directory for meataxe binaries."
+    exit 1
+fi
+
+mkdir -p "$SAGE_LOCAL/include"
+
+if [ $? -ne 0 ]; then
+    echo >&2 "Error creating SageMath's include directory."
+    exit 1
+fi
+
+mkdir -p "$SAGE_LOCAL/lib"
+
+if [ $? -ne 0 ]; then
+    echo >&2 "Error creating SageMath's lib folder."
+    exit 1
+fi
```


(I know I asked you to add these, but in the mean time the build system was improved)



---

archive/issue_comments_136812.json:
```json
{
    "body": "Replying to [comment:152 jdemeyer]:\n> I think you are still mis-using some of the error handling.\n> \n> For example, you have\n> {{{\n> int MatEchelonize(Matrix_t *mat) except -1\n> }}}\n> but you still write\n> {{{\n>         if MatEchelonize(self.Data) == -1:\n>             raise ArithmeticError(\"Error echelonizing this matrix\")\n> }}}\n> The latter should just be\n> {{{\n> MatEchelonize(self.Data)\n> }}}\n\nRight. I guess I wrote it before I changed to using error return values. How important is it to change that?",
    "created_at": "2015-10-05T12:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136812",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:152 jdemeyer]:
> I think you are still mis-using some of the error handling.
> 
> For example, you have
> {{{
> int MatEchelonize(Matrix_t *mat) except -1
> }}}
> but you still write
> {{{
>         if MatEchelonize(self.Data) == -1:
>             raise ArithmeticError("Error echelonizing this matrix")
> }}}
> The latter should just be
> {{{
> MatEchelonize(self.Data)
> }}}

Right. I guess I wrote it before I changed to using error return values. How important is it to change that?



---

archive/issue_comments_136813.json:
```json
{
    "body": "Replying to [comment:154 SimonKing]:\n> How important is it to change that?\n\nThat's a very philosophical question. It's not important. This ticket is not important. Even Sage itself is not really that important.\n\nSeriously: it's a small thing which makes your code more readable, so why wouldn't you fix it?",
    "created_at": "2015-10-05T12:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136813",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:154 SimonKing]:
> How important is it to change that?

That's a very philosophical question. It's not important. This ticket is not important. Even Sage itself is not really that important.

Seriously: it's a small thing which makes your code more readable, so why wouldn't you fix it?



---

archive/issue_comments_136814.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-05T13:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136815.json:
```json
{
    "body": "In fact there were several places in which I explicitly tested for error return values, where I should better let Cython do the job. Fixed now. Of course, I can't easily solve the problem that upstream didn't comment on (or just acknowledges receive of) my patches.",
    "created_at": "2015-10-05T13:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136815",
    "user": "https://github.com/simon-king-jena"
}
```

In fact there were several places in which I explicitly tested for error return values, where I should better let Cython do the job. Fixed now. Of course, I can't easily solve the problem that upstream didn't comment on (or just acknowledges receive of) my patches.



---

archive/issue_comments_136816.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-11T11:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136816",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136817.json:
```json
{
    "body": "I thought that I did test pickling. But now I obtain crashes when unpickling a pickle.\n\n```\nsage: M = MatrixSpace(GF(9,'x'),10,10)(0)\nsage: M[2,3] = M[3,7] = 1\nsage: f = tmp_filename()\nsage: save(M, f)\nsage: load(f+\".sobj\")\n------------------------------------------------------------------------\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x4125)[0x7f5a7dd08125]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x4177)[0x7f5a7dd08177]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x60c9)[0x7f5a7dd0a0c9]\n/lib64/libpthread.so.0(+0xf890)[0x7f5a85922890]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_gfpn_dense.so(+0xd9a0)[0x7f5a46fad9a0]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_dense.so(+0x629a)[0x7f5a6290029a]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix0.so(+0x39496)[0x7f5a62d99496]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f5a85b84a23]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f5a85c35317]\n/home/king/Sage/git/sage/local/lib/python2.7/lib-dynload/cPickle.so(+0x4f4e)[0x7f5a80250f4e]\n/home/king/Sage/git/sage/local/lib/python2.7/lib-dynload/cPickle.so(+0xa669)[0x7f5a80256669]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/sage_object.so(+0x21fa2)[0x7f5a7e83bfa2]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/sage_object.so(+0x77df)[0x7f5a7e8217df]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/sage_object.so(+0x25e10)[0x7f5a7e83fe10]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x48a9)[0x7f5a85c3a1a9]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x7f5a85c3bb02]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x4dae)[0x7f5a85c3a6ae]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x7f5a85c3bb02]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x92)[0x7f5a85c666d2]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xd9)[0x7f5a85c67c09]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(Py_Main+0xc4d)[0x7f5a85c7d99d]\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f5a84e85b05]\npython[0x4007be]\n------------------------------------------------------------------------\nAttaching gdb to process id 4561.\n...\n```\n",
    "created_at": "2015-10-11T11:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136817",
    "user": "https://github.com/simon-king-jena"
}
```

I thought that I did test pickling. But now I obtain crashes when unpickling a pickle.

```
sage: M = MatrixSpace(GF(9,'x'),10,10)(0)
sage: M[2,3] = M[3,7] = 1
sage: f = tmp_filename()
sage: save(M, f)
sage: load(f+".sobj")
------------------------------------------------------------------------
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x4125)[0x7f5a7dd08125]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x4177)[0x7f5a7dd08177]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x60c9)[0x7f5a7dd0a0c9]
/lib64/libpthread.so.0(+0xf890)[0x7f5a85922890]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_gfpn_dense.so(+0xd9a0)[0x7f5a46fad9a0]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_dense.so(+0x629a)[0x7f5a6290029a]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix0.so(+0x39496)[0x7f5a62d99496]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f5a85b84a23]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f5a85c35317]
/home/king/Sage/git/sage/local/lib/python2.7/lib-dynload/cPickle.so(+0x4f4e)[0x7f5a80250f4e]
/home/king/Sage/git/sage/local/lib/python2.7/lib-dynload/cPickle.so(+0xa669)[0x7f5a80256669]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/sage_object.so(+0x21fa2)[0x7f5a7e83bfa2]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/sage_object.so(+0x77df)[0x7f5a7e8217df]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/sage_object.so(+0x25e10)[0x7f5a7e83fe10]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x48a9)[0x7f5a85c3a1a9]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x7f5a85c3bb02]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x4dae)[0x7f5a85c3a6ae]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x43a1)[0x7f5a85c39ca1]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d)[0x7f5a85c3b9cd]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x7f5a85c3bb02]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x92)[0x7f5a85c666d2]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xd9)[0x7f5a85c67c09]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(Py_Main+0xc4d)[0x7f5a85c7d99d]
/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f5a84e85b05]
python[0x4007be]
------------------------------------------------------------------------
Attaching gdb to process id 4561.
...
```




---

archive/issue_comments_136818.json:
```json
{
    "body": "What can I change in my local git configuration so that I can push to trac if port 22 is blocked?",
    "created_at": "2015-10-11T19:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136818",
    "user": "https://github.com/simon-king-jena"
}
```

What can I change in my local git configuration so that I can push to trac if port 22 is blocked?



---

archive/issue_comments_136819.json:
```json
{
    "body": "You could try the solution posted here: http://stackoverflow.com/questions/4891527/git-protocol-blocked-by-company-how-can-i-get-around-that, but I'm not sure that will work because it is a different port (and IDK about how the trac server is setup and which ports it is listening to).",
    "created_at": "2015-10-11T19:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136819",
    "user": "https://github.com/tscrim"
}
```

You could try the solution posted here: http://stackoverflow.com/questions/4891527/git-protocol-blocked-by-company-how-can-i-get-around-that, but I'm not sure that will work because it is a different port (and IDK about how the trac server is setup and which ports it is listening to).



---

archive/issue_comments_136820.json:
```json
{
    "body": "Replying to [comment:161 tscrim]:\n> You could try the solution posted here: http://stackoverflow.com/questions/4891527/git-protocol-blocked-by-company-how-can-i-get-around-that, but I'm not sure that will work because it is a different port (and IDK about how the trac server is setup and which ports it is listening to).\n\nIt didn't work; in particular, after the change, the error messages still mentioned port 22, which is not available to me.",
    "created_at": "2015-10-11T21:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136820",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:161 tscrim]:
> You could try the solution posted here: http://stackoverflow.com/questions/4891527/git-protocol-blocked-by-company-how-can-i-get-around-that, but I'm not sure that will work because it is a different port (and IDK about how the trac server is setup and which ports it is listening to).

It didn't work; in particular, after the change, the error messages still mentioned port 22, which is not available to me.



---

archive/issue_comments_136821.json:
```json
{
    "body": "not access to port 22 == no access to the internet. Complain to whoever is blocking you that you can't do your work and their service is useless to you",
    "created_at": "2015-10-11T22:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136821",
    "user": "https://github.com/vbraun"
}
```

not access to port 22 == no access to the internet. Complain to whoever is blocking you that you can't do your work and their service is useless to you



---

archive/issue_comments_136822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-12T09:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136823.json:
```json
{
    "body": "The problem was: The default implementation of unpickling relies on `set_unsafe(i,j,val)`. In my implementation, `set_unsafe` relies on a converter from finite field elements to the internal representation---and the converter is not created during the unpickling.\n\nHence, I created a custom `__reduce__` relying on some unpickling function.\n\nThere, I used the occasion to return to what I did in the old group cohomology spkg: Pickling is *not* by conversion of the matrix to a list of entries, but it dumps the densely packed internal representation. Advantage: It is a lot faster!\n\nFor the group cohomology spkg, it was checked that the internal representation does not depend on details such as big versus little endian machines: A pickle created on a big-endian machine can correctly be unpickled with a little-endian machine.\n\nAnother advantage of the new approach will be apparent in #18514: Since the new pickling/unpickling  scheme for meataxe matrices is a lot closer to the scheme used in the old group cohomology spkg, the *new* group cohomology package should relatively easily be able to read data from existing cohomology data bases.",
    "created_at": "2015-10-12T10:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136823",
    "user": "https://github.com/simon-king-jena"
}
```

The problem was: The default implementation of unpickling relies on `set_unsafe(i,j,val)`. In my implementation, `set_unsafe` relies on a converter from finite field elements to the internal representation---and the converter is not created during the unpickling.

Hence, I created a custom `__reduce__` relying on some unpickling function.

There, I used the occasion to return to what I did in the old group cohomology spkg: Pickling is *not* by conversion of the matrix to a list of entries, but it dumps the densely packed internal representation. Advantage: It is a lot faster!

For the group cohomology spkg, it was checked that the internal representation does not depend on details such as big versus little endian machines: A pickle created on a big-endian machine can correctly be unpickled with a little-endian machine.

Another advantage of the new approach will be apparent in #18514: Since the new pickling/unpickling  scheme for meataxe matrices is a lot closer to the scheme used in the old group cohomology spkg, the *new* group cohomology package should relatively easily be able to read data from existing cohomology data bases.



---

archive/issue_comments_136824.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-12T10:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136824",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_032161.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-12-16T20:56:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32161"
}
```



---

archive/issue_comments_136825.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-16T20:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136825",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136826.json:
```json
{
    "body": "I get 2 doctest failures with MeatAxe *not* installed. Both I think are because they should be marked optional:\n\n```\nFile \"../../matrix/matrix_gfpn_dense.pyx\", line 213, in sage.matrix.matrix_gfpn_dense.PrimeFieldConverter_class.int_to_field\nFailed example:\n    C.int_to_field(int(2))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix_gfpn_dense.PrimeFieldConverter_class.int_to_field[1]>\", line 1, in <module>\n        C.int_to_field(int(Integer(2)))\n    NameError: name 'C' is not defined\n\n**********************************************************************\n\nFile \"../../matrix/matrix_space.py\", line 992, in sage.matrix.matrix_space.MatrixSpace._get_matrix_class\nFailed example:\n    type(matrix(GF(125,'z'), 2, range(4)))\nExpected:\n    <type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nGot:\n    <type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>\n```\n",
    "created_at": "2015-12-16T20:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136826",
    "user": "https://github.com/tscrim"
}
```

I get 2 doctest failures with MeatAxe *not* installed. Both I think are because they should be marked optional:

```
File "../../matrix/matrix_gfpn_dense.pyx", line 213, in sage.matrix.matrix_gfpn_dense.PrimeFieldConverter_class.int_to_field
Failed example:
    C.int_to_field(int(2))
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_gfpn_dense.PrimeFieldConverter_class.int_to_field[1]>", line 1, in <module>
        C.int_to_field(int(Integer(2)))
    NameError: name 'C' is not defined

**********************************************************************

File "../../matrix/matrix_space.py", line 992, in sage.matrix.matrix_space.MatrixSpace._get_matrix_class
Failed example:
    type(matrix(GF(125,'z'), 2, range(4)))
Expected:
    <type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
Got:
    <type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>
```




---

archive/issue_comments_136827.json:
```json
{
    "body": "However, all tests pass in `src/matrix` with it installed.",
    "created_at": "2015-12-16T20:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136827",
    "user": "https://github.com/tscrim"
}
```

However, all tests pass in `src/matrix` with it installed.



---

archive/issue_comments_136828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-01-16T13:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_136829.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-16T13:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136829",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136830.json:
```json
{
    "body": "I made the two failing tests optional and at that occasion merged the latest develop.\n\nIs it fine now?",
    "created_at": "2016-01-16T13:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136830",
    "user": "https://github.com/simon-king-jena"
}
```

I made the two failing tests optional and at that occasion merged the latest develop.

Is it fine now?



---

archive/issue_comments_136831.json:
```json
{
    "body": "Looks good to me now. Thanks.",
    "created_at": "2016-01-16T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136831",
    "user": "https://github.com/tscrim"
}
```

Looks good to me now. Thanks.



---

archive/issue_comments_136832.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-16T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136832",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_032162.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-20T10:20:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11931#event-32162"
}
```



---

archive/issue_comments_136833.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-20T10:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136833",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_136834.json:
```json
{
    "body": "there is no tarball on the mirrors, apparently",
    "created_at": "2016-02-24T23:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136834",
    "user": "https://github.com/dimpase"
}
```

there is no tarball on the mirrors, apparently



---

archive/issue_comments_136835.json:
```json
{
    "body": "Fixed",
    "created_at": "2016-02-25T09:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11931#issuecomment-136835",
    "user": "https://github.com/vbraun"
}
```

Fixed
