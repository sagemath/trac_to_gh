# Issue 18846: AsymptoticRing: cleanup, some improvements, documentation

Issue created by migration from https://trac.sagemath.org/ticket/19083

Original creator: dkrenn

Original creation time: 2015-08-25 07:46:48

CC:  behackl cheuberg

Cleanup, some improvements, documentation in the asymptotic ring framework (see also #17601).


---

Comment by dkrenn created at 2015-08-25 07:54:23

Last 10 new commits:


---

Comment by git created at 2015-08-25 08:39:57

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-26 07:08:54

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-26 17:10:31

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-26 18:27:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-27 17:54:38

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-28 09:23:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-28 09:50:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-28 14:02:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-28 14:34:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-28 19:08:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-30 10:03:47

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-30 18:09:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-08-31 16:56:27

New commits:


---

Comment by git created at 2015-08-31 17:14:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-01 11:25:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-01 11:51:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-01 12:05:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-01 16:27:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-02 10:50:48

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-09-02 12:01:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-09-02 13:51:53

New commits:


---

Comment by git created at 2015-09-02 14:00:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-03 08:46:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-04 11:13:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-04 11:34:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-04 16:30:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-14 18:41:19

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2015-09-14 18:41:57

merged 6.9.beta5


---

Comment by git created at 2015-09-14 19:15:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-14 19:23:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-09-15 17:29:12

Changing component from symbolics to asymptotic expansions.


---

Comment by git created at 2015-09-16 06:53:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-16 16:13:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-09-16 16:14:14

merged 6.9.beta6 (with #18182)
----
New commits:


---

Comment by git created at 2015-09-16 17:37:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-30 09:14:09

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-09-30 09:21:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-30 10:10:00

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-09-30 12:34:35

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-10-08 14:14:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-08 14:25:51

Merged dependencies.


---

Comment by git created at 2015-10-08 15:28:16

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-10-08 17:48:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-12 14:57:51

TODO: correct categories of MonomialGrowthGroup and ExponentialGrowthGroup; make this category consider the input (coefficients). 

This comes from See http://trac.sagemath.org/ticket/19073#comment:28 of #19073.


---

Comment by git created at 2015-10-12 17:16:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-13 09:30:21

Replying to [comment:53 dkrenn]:
> TODO: correct categories of MonomialGrowthGroup and ExponentialGrowthGroup; make this category consider the input (coefficients). 
> 
> This comes from See http://trac.sagemath.org/ticket/19073#comment:28 of #19073.

This is now #19399.


---

Comment by dkrenn created at 2015-10-13 09:41:23

Changing status from new to needs_review.


---

Comment by dkrenn created at 2015-10-13 09:41:23

Work Issues: move code to sage.asymptotic (shortly before positive_review) --> this is now #19400.


---

Comment by behackl created at 2015-10-13 12:23:17

merged current version of #19094.
----
New commits:


---

Comment by git created at 2015-10-14 16:30:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-10-14 16:41:43

Due to many interdependencies, I review this ticket and its dependency #19094 in one go. I pushed some reviewer commits here and add my comments here. The aim is to eventually set both tickets to `positive_review` at the same time.

Up to now, I reviewed the following files:
|                                                             |             |
|-------------------------------------------------------------|-------------|
|`src/doc/en/reference/rings/asymptotic_expansions_index.rst` |   50 `+++-` |
|`src/sage/data_structures/mutable_poset.py`                  |    3 `+-` |
|`src/sage/rings/all.py`                                      |    2 `+-` |
|`src/sage/rings/asymptotic/all.py`                           |    3 `+-` |
|`src/sage/rings/asymptotic/growth_group.py`                  | 1779 `+++++++++++++++++++++++++++++++++++` `++++++++++++++++++++++++++++++++++++` `+++++++++++++++++++++` `-----------------------------------------` |
|`src/sage/rings/asymptotic/misc.py`                          |  476 `++++++++++++++++++++++++++++++++++++` |
Here are my comments on these files:
1. `misc.split_str_by_op`: 
	- parameter `op`: is special treatment of `^^` worthwhile when `op ='^'` or is that a special case for `*`?
	- parameter `strip_parentheses` not tested
	- document and test `op is None`. This is used in `growth_group.Variable.__init__`
2. `misc.repr_op`: what about `-` and `/`? Why don't they also induce parentheses?

```
sage: from sage.rings.asymptotic.misc import repr_op
sage: repr_op('a-b', '^', 'c')
'a-b^c'
sage: repr_op('a+b', '^', 'c')
'(a+b)^c'
```

3. `growth_group.is_lt_one`: this is a module level function, but doctests use it as a method.
	- mark doctest as indirect
	- document this fact.
4. `growth_group.log`:
	- see comments on `growth_group.is_lt_one`.
	- error "results in a sum" is not tested.
5. `growth_group.log_factor`:
	- why `from growth_group import GenericGrowthGroup`?
	- see comments on `growth_group.is_lt_one`
6. `GenericGrowthElement.__ne__`: is the "Note" box actually needed?
7. `GenericGrowthElement._rpow_element_`:
	- when is the output `None`?
	- I do not understand "it lives (in contrast to rpow) in its own group".
8. `GenericGrowthGroup._create_element_via_parent_`: I do not understand the explanation. Is "via" a good part of the name of the method?
9. `GenericGrowthGroup.gens`:
	- why "monomial" growth group in the generic group?
	- why `MonomialGrowthElement`?
10. `MonomialGrowthElement.__pow__`: Is the following intentional:

```
sage: P = GrowthGroup('x^ZZ')
sage: x = P.gen()
sage: a = x^7; a
x^7
sage: a^(1/7)
x
sage: (a^(1/7)).parent()
Growth Group x^QQ
```

    I understand that `((1/7)*7).parent()` is `QQ`, but in that case, the user explicitly left the integers. It is not clear to me whether this is also the case here.
11. `MonomialGrowthElement._log_factor_`:
	- The parameter `base` is ignored in the second `if`:

```
sage: G = GrowthGroup('exp(x)^ZZ*x^ZZ')
sage: e1 = G('exp(x)'); e1
exp(x)
sage: log(e1, base=2)
x
```

	- In some cases, computation fails although it would be feasible:

```
sage: G = GrowthGroup('(e^x)^ZZ*x^ZZ')
sage: e1 = G('e^x'); e1
e^x
sage: var('e')
sage: log(e1^2, base=e^2)
Traceback (most recent call last):
...
ArithmeticError: Cannot build log((e^x)^2) since log(e^x) is not in Growth Group (e^x)^ZZ * x^ZZ.
```


12. `MonomialGrowthElement._rpow_element_`:
	- I do not understand "it lives (in contrast to rpow()) in its own group."
	- Parameter `base` is not tested (with an actual result).
	- The documentation does not explain why `2^x` is illegal here (it seems that this method operates only if the result can be a monomial growth group element, not necessarily in the same growth group as `self`).
13. `ExponentialGrowthElement._repr_`: what is the motivation behind checking for `-/^`? This leads to the following (perhaps stupid) example:

```
sage: from sage.rings.asymptotic.growth_group import ExponentialGrowthGroup
sage: G = ExponentialGrowthGroup(ZZ['x'], 'y'); G
Growth Group ZZ[x]^y
sage: G('(1-x)^y')
(-x + 1)^y
sage: G('(1+x)^y')
x + 1^y
```

14. `GrowthGroupFactory`: the documentation sounds like `ignore_variables=('e',)` would only be set when no keywords are given. However, this applies even if only `ignore_variables` is not set.


---

Comment by git created at 2015-10-14 17:25:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-10-14 17:26:58

Here are my comments on `src/sage/rings/asymptotic/growth_group_cartesian.py`:
15. `GenericProduct._create_element_via_parent_`:
	- see comment 8.
	- Error "Cannot create ... as a cartesian product like ..." not tested.
16. `GenericProduct.Element.__pow__`: "This can be anything that is a valid right hand side of `*` with elements of the parent's base." seems to be misplaced (each factor does have a base, and this only applies to monomial factors).
17. `GenericProduct.Element.__rpow__`: see comment 7.
18. `GenericProduct.Element._rpow_element_`: I think that the loop `for factor in factors` combined with `continue` makes this more difficult to read than simply saying `factor = factors[0]` because the length of `factors` is `1` anyway.


---

Comment by git created at 2015-10-15 18:14:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-10-15 18:17:38

Here are my commits and comments on `src/sage/rings/asymptotic/term_monoid.py`:
19. Why does a `TermMonoid` with `O` need a coefficient ring?
20. `GenericTerm._calculate_pow_test_zero_`: Is it possible to replace the error message "Cannot take Generic Term with growth z to exponent -2" by something which is not dependent on the very special interpretation of this very special method?
21. `GenericTerm.log_term`: remove first note box, as it is a `NotImplementedError` anyway?
22. `GenericTermMonoid.__classcall__`: Test all errors.
23. `GenericTermMonoid._coerce_map_from_`: The code requires that the coefficient ring of `S` coerces into the coefficient ring of `self`, which is good, but it should be documented and tested.
24. `GenericTermMonoid._create_element_via_parent_`: See comment 8.
25. `GenericTermMonoid._split_growth_and_coefficient_`: I'd appreciate having more doctests here, e.g. actually having a product of growth groups, several factors of the coefficient (e.g., in the symbolic ring), testing the error message.
26. `GenericTermMonoid._get_factors_`: This does not work when the input is an element of a multivariate polynomial ring. On the other hand, this is more general phenomenon:

```
sage: from sage.rings.asymptotic.term_monoid import TermMonoid
sage: from sage.rings.asymptotic.growth_group import GrowthGroup
sage: G_ZZ = GrowthGroup('y^ZZ*z^ZZ')
sage: T_ZZ = TermMonoid('exact', G_ZZ, QQ)
sage: R.<y, z> = ZZ[]
sage: T_ZZ._get_factors_(5*y*z)
(5*y*z,)
sage: G_ZZ(y)*G_ZZ(z)
y*z
sage: G_ZZ(y*z)
Traceback (most recent call last):
...
ValueError: y*z is not in Growth Group y^ZZ * z^ZZ.
> *previous* ValueError: y*z is not in any of the factors of Growth Group y^ZZ * z^ZZ
```

	If this cannot be fixed easily, a new ticket should be devoted to that.
27. `GenericTermMonoid.__pow__`:
	- there is the implicit assumption that `0 = O(g)` for any `g` in the growth group. This is certainly a valid assumption in the classical case of a variable going to infinity in the reals or in the complex numbers. However, it is not clear to me what non-standard asymptotics might be handeled by this module, e.g., `p`-adic valuations or things like that. So perhaps this should somehow be documented.
	- test error message coming from `_calculate_pow_test_zero_`.
28. `OTermMonoid._create_element_`: test error
29. `TermWithCoefficient._calculate_pow_`:
	- broken link to `:meth:`__pow__``
	- test `ArithmeticError`
	- I do not like the broken semantics that the coefficient is taken to a power in `TermWithCoefficient._calculate_pow_`, but not in `GenericTerm._calculate_pow_`. 
30. `TermMonoidFactory`:
	- documentation should mention that `TermMonoid` is an instance of `TermMonoidFactory`.
	- test parameter `asymptotic_ring`
	- test case that `term` is a `GenericTermMonoid`


---

Comment by git created at 2015-10-16 07:04:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-10-16 07:11:03

Here are my remaining comments (files `src/sage/rings/asymptotic/asymptotic_ring.py` and `src/sage/rings/big_oh.py`):
31. `AsymptoticExpansion.__init__`: 
	- parameter `convert` is neither documented nor tested.
	- test error "Cannot include ..."
32. `AsymptoticExpansion._mul_term_`: I'd prefer to say `simplify = not isinstance(term, ExactTerm)` because this seems to be more robust with respect to future extensions.
33. `AsymptoticExpansion.__invert__`:
	- test errors
	- I think that there is shared code between `__invert__`, `__log__`, `__exp__` and powers with rational exponents. In all those cases, it is important to split into main term and renormalized remainder. The main term is then processed according to the respective method, the remainder is inserted into a converging taylor series with certain coefficients (this could be handeled by one method getting the sequence of taylor coefficients as an argument). Possibly in a follow-up ticket.
34. `AsymptoticExpansion.__pow__`:
	- why is `(y^2 + O(y))^(1/2)` not tested (add a comment?)
	- test error: "Cannot take ... to the negative exponent"
	- test error: "Taking ... to the exponent ... not implemented"
	- rational exponents could be implemented via binomial series (follow-up ticket?)
35. `AsymptoticExpansion.log`:
	- test error ("several maximal elements")
	- I am not convinced that having `k` as an `AsymptoticExpansion` is very efficient (let the division be in `QQ` and convert later?, cf. `rpow`.)
36. `AsymptoticExpansion.rpow`:
	- Decrease indentation of ALGORITHM block
	- The algorithm given in the documentation seems to be quite obvious
	- I do not like "the rest", "the remaining part": those are actually the asymptotic main parts.
	- Why is the algorithm described in that much detail here and nowhere (`log`, `exp`, `pow`) else?
	- Test error "Cannot construct the power ..."
37. `AsymptoticRing`: Add some comment on the "TESTS" section which is currently inactive.
38. `AsymptoticRing.change_parameter`: is this a good name (the method sounds like an inplace change, but usually returns a new parent instead)
39. `AsymptoticRing._create_element_via_parent_`:
	- I do not like the name and the description of the method.
	- The role of `old_parent` is not documented
	- In all uses of the method in this module, `old_parent` is set and is a term monoid. In the example of this method, it is an asymptotic ring.
	- I do not understand why `old_parent` is needed: if `term.parent() is old_parent`, then `self.change_parameter` will probably not change the parent anyway.
40. `AsymptoticRing._element_constructor_`:
	- I do not understand the sentence "If set, then it is assured that the terms belong to this asymptotic ring (by converting them if needed)." Who does the converting?
	- The note box seems to be outdated, as the parameter `summands` no longer exists.
	- test error "Not all list entries ..."
	- Why `not data or data == 0` instead of `not data`?
	- test error "Symbolic expression ... is not in ..."
	- What happens with an O-Term in SR?
	- conversion of multivariate polynomial ring is not tested.
41. `AsymptoticRing._create_exact_summand_`: Why is this needed and not handeled by `.create_summand`?
42. `AsymptoticRing.create_summand`:
	- doctest case of interesting `data` (i.e. with coefficient and growth element).
	- The following is surprising:

```
sage: AR.<z> = AsymptoticRing('z^QQ', QQ)
sage: AR.create_summand('exact', growth='z^2')
z^2
```

	  I'd rather expect an error or zero than using an implicit coefficient of `1`.
43. Delete the following in `src/doc/en/reference/rings/index.rst`

```
.. toctree::
   :hidden:

   asymptotic_expansions_index
```



---

Comment by dkrenn created at 2015-10-16 11:04:43

Replying to [comment:60 cheuberg]:
> 1. `misc.split_str_by_op`: 
> 	- parameter `op`: is special treatment of `^^` worthwhile when `op ='^'` or is that a special case for `*`?

The motivation comes, of course, from `*` and `**`. Since `^^` is not one of Python's operators, it should not be interpreted as twice `^`. Thus, I think this should be as it is.

> 	- parameter `strip_parentheses` not tested
> 	- document and test `op is None`. This is used in `growth_group.Variable.__init__`

Added.

> 2. `misc.repr_op`: what about `-` and `/`? Why don't they also induce parentheses?
> {{{
> sage: from sage.rings.asymptotic.misc import repr_op
> sage: repr_op('a-b', '^', 'c')
> 'a-b^c'
> sage: repr_op('a+b', '^', 'c')
> '(a+b)^c'
> }}}

Now included as well.

> 4. `growth_group.log`:
> 	- see comments on `growth_group.is_lt_one`.

Done.

> 	- error "results in a sum" is not tested.

Added.

> 5. `growth_group.log_factor`:
> 	- why `from growth_group import GenericGrowthGroup`?

Removed.

> 	- see comments on `growth_group.is_lt_one`

Done.

> 6. `GenericGrowthElement.__ne__`: is the "Note" box actually needed?

Not really; deleted.

> 7. `GenericGrowthElement._rpow_element_`:
> 	- when is the output `None`?

Removed output `None`.

> 	- I do not understand "it lives (in contrast to rpow) in its own group".

Rewritten.

> 8. `GenericGrowthGroup._create_element_via_parent_`: I do not understand the explanation. 

Rewritten.

> Is "via" a good part of the name of the method?

Renamed to `_create_element_in_extension_`.

> 9. `GenericGrowthGroup.gens`:
> 	- why "monomial" growth group in the generic group?
> 	- why `MonomialGrowthElement`?

Cut and paste problem; changed.

> 10. `MonomialGrowthElement.__pow__`: Is the following intentional:
> {{{
> sage: P = GrowthGroup('x^ZZ')
> sage: x = P.gen()
> sage: a = x^7; a
> x^7
> sage: a^(1/7)
> x
> sage: (a^(1/7)).parent()
> Growth Group x^QQ
> }}}
>     I understand that `((1/7)*7).parent()` is `QQ`, but in that case, the user explicitly left the integers. It is not clear to me whether this is also the case here.

`(a<sup>7)</sup>(1/7)` is calculated as `a^(7*(1/7))`, thus the same phenomenon as with `((1/7)*7).parent()` appears.

> 11. `MonomialGrowthElement._log_factor_`:
> 	- The parameter `base` is ignored in the second `if`:
> {{{
> sage: G = GrowthGroup('exp(x)<sup>ZZ*x</sup>ZZ')
> sage: e1 = G('exp(x)'); e1
> exp(x)
> sage: log(e1, base=2)
> x

Corrected.

> }}}
> 	- In some cases, computation fails although it would be feasible:
> {{{
> sage: G = GrowthGroup('(e<sup>x)</sup>ZZ*x^ZZ')
> sage: e1 = G('e^x'); e1
> e^x
> sage: var('e')
> sage: log(e1^2, base=e^2)
> Traceback (most recent call last):
> ...
> ArithmeticError: Cannot build log((e<sup>x)</sup>2) since log(e^x) is not in Growth Group (e<sup>x)</sup>ZZ * x^ZZ.
> }}}

This is now #19420.

> 12. `MonomialGrowthElement._rpow_element_`:
> 	- I do not understand "it lives (in contrast to rpow()) in its own group."

Changed.

> 	- Parameter `base` is not tested (with an actual result).

Doctest added.

> 	- The documentation does not explain why `2^x` is illegal here (it seems that this method operates only if the result can be a monomial growth group element, not necessarily in the same growth group as `self`).

Example explained.

> 13. `ExponentialGrowthElement._repr_`: what is the motivation behind checking for `-/^`? This leads to the following (perhaps stupid) example:
> {{{
> sage: from sage.rings.asymptotic.growth_group import ExponentialGrowthGroup
> sage: G = ExponentialGrowthGroup(ZZ['x'], 'y'); G
> Growth Group ZZ[x]^y
> sage: G('(1-x)^y')
> (-x + 1)^y
> sage: G('(1+x)^y')
> x + 1^y
> }}}

Seems to be code from before `repr_op` and then just inserting it. Now rewritten.

> 14. `GrowthGroupFactory`: the documentation sounds like `ignore_variables=('e',)` would only be set when no keywords are given. However, this applies even if only `ignore_variables` is not set.

Rewritten.

----
Last 10 new commits:


---

Comment by dkrenn created at 2015-10-16 11:06:06

(here comes 3.: trac didn't like it when inserted with the other numbers together, but stand alone seems to be fine........)

Replying to [comment:60 cheuberg]:
> 3. `growth_group.is_lt_one`: this is a module level function, but doctests use it as a method.
> 	- mark doctest as indirect
> 	- document this fact.

Done.


---

Comment by dkrenn created at 2015-10-16 11:06:28

Replying to [comment:62 cheuberg]:
> Here are my comments on `src/sage/rings/asymptotic/growth_group_cartesian.py`:
> 15. `GenericProduct._create_element_via_parent_`:
> 	- see comment 8.

Changed.

> 	- Error "Cannot create ... as a cartesian product like ..." not tested.

Added a test.

> 16. `GenericProduct.Element.__pow__`: "This can be anything that is a valid right hand side of `*` with elements of the parent's base." seems to be misplaced (each factor does have a base, and this only applies to monomial factors).

Deleted.

> 17. `GenericProduct.Element.__rpow__`: see comment 7.

Rewritten.

> 18. `GenericProduct.Element._rpow_element_`: I think that the loop `for factor in factors` combined with `continue` makes this more difficult to read than simply saying `factor = factors[0]` because the length of `factors` is `1` anyway.

Rewritten.


---

Comment by git created at 2015-10-16 11:35:04

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2015-10-16 11:36:15

Replying to [comment:60 cheuberg]:
> I pushed some reviewer commits here and add my comments here. 

Cross-reviewed. Fine.


---

Comment by git created at 2015-10-16 12:59:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-10-16 13:02:10

I reviewed your changes so far (`misc`, `growth_group`, `growth_group_cartesian`) and pushed three minor commits. Once you have cross-reviewed these three, these three files are fine for me.


---

Comment by dkrenn created at 2015-10-16 13:26:02

Replying to [comment:76 cheuberg]:
> I reviewed your changes so far (`misc`, `growth_group`, `growth_group_cartesian`) and pushed three minor commits. Once you have cross-reviewed these three, these three files are fine for me.

Fine for me.
----
Last 10 new commits:


---

Comment by dkrenn created at 2015-10-16 14:26:26

Replying to [comment:64 cheuberg]:
> 19. Why does a `TermMonoid` with `O` need a coefficient ring?

To make it clear and explicit which parts of an expression are allowed to be eaten up by the O-Term. For example, having a symbolic `x*y` and `R = AsymptoticRing('x^ZZ', QQ), then `O(x*y)` should not silently be possible in `R`.

> 20. `GenericTerm._calculate_pow_test_zero_`: Is it possible to replace the error message "Cannot take Generic Term with growth z to exponent -2" by something which is not dependent on the very special interpretation of this very special method?

The method does what it claims to do. Thus I am for keeping it as it is.

> 21. `GenericTerm.log_term`: remove first note box, as it is a `NotImplementedError` anyway?

Removed.

> 22. `GenericTermMonoid.__classcall__`: Test all errors.

Are tested now.

> 23. `GenericTermMonoid._coerce_map_from_`: The code requires that the coefficient ring of `S` coerces into the coefficient ring of `self`, which is good, but it should be documented and tested.

Extended doc.

> 24. `GenericTermMonoid._create_element_via_parent_`: See comment 8.

Done.

> 25. `GenericTermMonoid._split_growth_and_coefficient_`: I'd appreciate having more doctests here, e.g. actually having a product of growth groups, several factors of the coefficient (e.g., in the symbolic ring), testing the error message.

Added.

> 26. `GenericTermMonoid._get_factors_`: This does not work when the input is an element of a multivariate polynomial ring. [...]
> 	If this cannot be fixed easily, a new ticket should be devoted to that.

#19421.

> 27. `GenericTermMonoid.__pow__`:
> 	- there is the implicit assumption that `0 = O(g)` for any `g` in the growth group. This is certainly a valid assumption in the classical case of a variable going to infinity in the reals or in the complex numbers. However, it is not clear to me what non-standard asymptotics might be handeled by this module, e.g., `p`-adic valuations or things like that. So perhaps this should somehow be documented.

I've added a note in the source code.

> 	- test error message coming from `_calculate_pow_test_zero_`.

Test added.

> 28. `OTermMonoid._create_element_`: test error

Added doctest.

> 29. `TermWithCoefficient._calculate_pow_`:
> 	- broken link to `:meth:`__pow__``

Fixed.

> 	- test `ArithmeticError`

Tested.

> 	- I do not like the broken semantics that the coefficient is taken to a power in `TermWithCoefficient._calculate_pow_`, but not in `GenericTerm._calculate_pow_`. 

I've renamed `coefficient` to `new_coefficient` to make the difference between the methods clearer.

> 30. `TermMonoidFactory`:
> 	- documentation should mention that `TermMonoid` is an instance of `TermMonoidFactory`.

Note block added and docstring to instances added as well.

> 	- test parameter `asymptotic_ring`

Tests added.

> 	- test case that `term` is a `GenericTermMonoid`

Tests added.


---

Comment by git created at 2015-10-16 14:28:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-16 14:29:30

Finished with the terms. Needs cross-review. I will now look at the ring...


---

Comment by cheuberg created at 2015-10-16 15:16:25

Replying to [comment:81 dkrenn]:
> Finished with the terms. Needs cross-review.
Reviewed and added two commits. Please cross-review those. After that, only the `asymptotic_ring` is still to do.
----
New commits:


---

Comment by dkrenn created at 2015-10-16 15:34:50

Replying to [comment:83 cheuberg]:
> Replying to [comment:81 dkrenn]:
> > Finished with the terms. Needs cross-review.
> Reviewed and added two commits. Please cross-review those.

Commits are fine.

> ----
> New commits:
> ||[57eb7cc](http://git.sagemath.org/sage.git/commit/?id=57eb7cc1f45a0f0ba02ab97bb414f109117f2828)||`Trac #19083: Mention "GrowthGroup" in docstring of "GrowthGroupFactory"`||
> ||[0042756](http://git.sagemath.org/sage.git/commit/?id=0042756990b86f3b0ac536fe64d14c32fb2033a0)||`Trac #19083: added doctest (comment 64.23)`||
----
New commits:


---

Comment by dkrenn created at 2015-10-16 15:36:48

Replying to [comment:66 cheuberg]:
> 31. `AsymptoticExpansion.__init__`: 
> 	- parameter `convert` is neither documented nor tested.

Now it is.

> 	- test error "Cannot include ..."

Doctest added.

> 32. `AsymptoticExpansion._mul_term_`: I'd prefer to say `simplify = not isinstance(term, ExactTerm)` because this seems to be more robust with respect to future extensions.

True, good idea; changed.

> 33. `AsymptoticExpansion.__invert__`:
> 	- test errors

Done.


---

Comment by dkrenn created at 2015-10-16 15:37:09

> 33. `AsymptoticExpansion.__invert__`:
> 	- I think that there is shared code between `__invert__`, `__log__`, `__exp__` and powers with rational exponents. In all those cases, it is important to split into main term and renormalized remainder. The main term is then processed according to the respective method, the remainder is inserted into a converging taylor series with certain coefficients (this could be handeled by one method getting the sequence of taylor coefficients as an argument). Possibly in a follow-up ticket.

Yes, I've noticed this as well. I have it on my local todo list. Now this is #19423


---

Comment by dkrenn created at 2015-10-16 15:37:40

> 34. `AsymptoticExpansion.__pow__`:
> 	- why is `(y^2 + O(y))^(1/2)` not tested (add a comment?)

I've refered to #19316.

> 	- test error: "Cannot take ... to the negative exponent"
> 	- test error: "Taking ... to the exponent ... not implemented"

Added tests.

> 	- rational exponents could be implemented via binomial series (follow-up ticket?)

A ticket (#19316) already exists.

> 35. `AsymptoticExpansion.log`:
> 	- test error ("several maximal elements")

Added.

> 	- I am not convinced that having `k` as an `AsymptoticExpansion` is very efficient (let the division be in `QQ` and convert later?, cf. `rpow`.)

Changed and made some tests: I could save about 15% cputime :)

Rest will follow later today.


---

Comment by git created at 2015-10-16 17:34:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-16 17:38:13

Replying to [comment:66 cheuberg]:
> 36. `AsymptoticExpansion.rpow`:
> 	- Decrease indentation of ALGORITHM block

Done.

> 	- Test error "Cannot construct the power ..."

Added test.

> 37. `AsymptoticRing`: Add some comment on the "TESTS" section which is currently inactive.

Added (#19424).

> 38. `AsymptoticRing.change_parameter`: is this a good name (the method sounds like an inplace change, but usually returns a new parent instead)

True, but consistent with

```
sage: R.<z> = ZZ[]
sage: R.change_ring(QQ)
Univariate Polynomial Ring in z over Rational Field
sage: R
Univariate Polynomial Ring in z over Integer Ring
```


> 39. `AsymptoticRing._create_element_via_parent_`:
> 	- I do not like the name and the description of the method.

Changed earlier already.

> 	- The role of `old_parent` is not documented

Extended doc.

> 	- In all uses of the method in this module, `old_parent` is set and is a term monoid. In the example of this method, it is an asymptotic ring.

Uuups...changed.

> 	- I do not understand why `old_parent` is needed: if `term.parent() is old_parent`, then `self.change_parameter` will probably not change the parent anyway.

E.g. when inverting, then the `term` parameter will be the already inverted term and `old_parent` the parent of the original term.

> 40. `AsymptoticRing._element_constructor_`:
> 	- The note box seems to be outdated, as the parameter `summands` no longer exists.

Deleted.

> 	- test error "Not all list entries ..."
> 	- test error "Symbolic expression ... is not in ..."

Added.

> 	- Why `not data or data == 0` instead of `not data`?

Changed.

> 	- What happens with an O-Term in SR?

There seems to be a bug in SR: #19425. Opened follow up #19426.

> 	- conversion of multivariate polynomial ring is not tested.

Now it is.

> 43. Delete the following in `src/doc/en/reference/rings/index.rst`
> {{{
> .. toctree::
>    :hidden:
> 
>    asymptotic_expansions_index
> }}}

Not possible, since in `src/doc/en/reference/index.rst` all indices are included
via `:doc:` which seems not to add them to any toctree.


---

Comment by git created at 2015-10-16 18:51:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-16 18:58:43

Replying to [comment:66 cheuberg]:
> 36. `AsymptoticExpansion.rpow`:
> 	- The algorithm given in the documentation seems to be quite obvious
> 	- I do not like "the rest", "the remaining part": those are actually the asymptotic main parts.
> 	- Why is the algorithm described in that much detail here and nowhere (`log`, `exp`, `pow`) else?

Block deleted.

> 40. `AsymptoticRing._element_constructor_`:
> 	- I do not understand the sentence "If set, then it is assured that the terms belong to this asymptotic ring (by converting them if needed)." Who does the converting?

Meanwhile the convert parameter in AsymptoticExpansion has a better description.

> 41. `AsymptoticRing._create_exact_summand_`: Why is this needed and not handeled by `.create_summand`?

Deleted and remaining code adapted.

> 42. `AsymptoticRing.create_summand`:
> 	- doctest case of interesting `data` (i.e. with coefficient and growth element).

Added.

> 	- The following is surprising:
> {{{
> sage: AR.<z> = AsymptoticRing('z^QQ', QQ)
> sage: AR.create_summand('exact', growth='z^2')
> z^2
> }}}
> 	  I'd rather expect an error or zero than using an implicit coefficient of `1`

Changed; now there is an error.


---

Comment by git created at 2015-10-17 05:29:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-10-17 05:32:56

I checked the changes again, added two trivial commits. Doctests pass, documentation builds, trac's automerge fails for unknown reasons, but branch merges cleanly into 6.10.beta0.


---

Comment by cheuberg created at 2015-10-17 05:32:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-10-24 10:22:16

Resolution: fixed
