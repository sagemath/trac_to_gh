# Issue 14278: create the new development scripts/library

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2013-04-24 05:54:23

Assignee: jason

CC:  mderickx robertwb roed jdemeyer kini saraedum leif simonking

In order to switch to the new workflow, we need to create a set of development scripts for interfacing against git and trac.


---

Comment by tkluck created at 2013-07-20 12:39:05

The dependencies got lost through the ./sage --dev upload script. I'm putting them back.


---

Comment by tkluck created at 2013-07-22 13:29:23

Changing keywords from "" to "sd51".


---

Comment by tkluck created at 2013-07-23 10:09:00

Remove circular dependency.


---

Comment by saraedum created at 2013-07-25 15:51:34

We can now add comments.


---

Comment by saraedum created at 2013-07-29 14:53:06

I will spend the better part of this week trying to complete these scripts (i.e. mostly writing doctests). If anybody else wants to do substantial work on these scripts, it's probably best to contact me, so we don't work on the same issues.


---

Comment by saraedum created at 2013-08-04 21:03:21

I did some work on doctesting and better reporting of exceptions. I will not be able to work on this for about a week but will try to finish this afterwards.


---

Comment by vbraun created at 2013-08-13 20:41:14

There is a problem in the handling of untracked files. Git interprets "untracked" as untracked in cwd. In fact, just having been given `--git-dir` we can't possibly know where the working directory is. For example, consider the filesystem layout:

```
$ tree -a
.
├── a
│   ├── file_in_a
│   └── .git
│       ├── branches
│       [...] 
└── b
    └── file_in_b
$ cd b
$ git --git-dir=../a/.git ls-files --other
file_in_b
```

whereas you probably would have expected `file_in_a`.


---

Comment by saraedum created at 2013-08-19 18:01:24

Replying to [comment:27 vbraun]:
This should be fixed now in `git_interface.untracked_files()`.


---

Comment by saraedum created at 2013-08-19 18:03:04

wget (when invoked by the dev scripts) complains that the Common Name for the SSL certificate on trac.sagemath.org refers to sagecell.sagemath.org. I don't know much about SSL but do we not have a certificate for trac.sagemath.org?


---

Comment by vbraun created at 2013-08-19 19:09:55

The scripts should use curl instead of wget, the latter is not available on OSX since Apple is prejudiced against the GPL. 

The SSL problem is that we are trying to host two SSL virtual domains on the same IP, that is a no-no. I've posted to sage-devel about it at https://groups.google.com/d/msg/sage-devel/VRohw4DSNrk/TpjWGQ-Vtu8J


---

Comment by ohanar created at 2013-08-19 21:01:49

If you are trying to download a file from within python you should probably use the retrieve method of `urllib.FancyURLopener`. See src/bin/sage-download-file for an example.


---

Comment by vbraun created at 2013-08-19 21:18:21

Also, I'm not entirely happy with the git interface. Though I also think its good enough to use in the git scripts and its probably a bad idea to do any architectural changes at this point. For the record I've built on the current code at https://github.com/vbraun/SageUI/tree/release/src/sageui/model. Changes incude

* Use proxy objects instead of having to import magic constants:
  {{{
In [3]: git.status()   # return stdout by default, the most desirable behaviour
Out[3]: '# On branch dev_scripts\nnothing to commit, working directory clean\n'

In [4]: git.exit_code.status()
Out[4]: 0

In [5]: git.silent.status()

In [6]: git.echo.status()
# On branch dev_scripts
nothing to commit, working directory clean
  }}}
* Don't hardcode the Sage repo directory, this is probably going to be useful elsewhere
* Use the `GIT_DIR` and `GIT_WORK_TREE` environment variables instead of `--git-dir` (though warning: there seems to be a bug in `git status`, it is not respecting `GIT_WORK_TREE`)
* Split the git interface (handling the mechanics of interfacing with the git binary) from the logical repository handling (like the `create_ticket` method)
* Put all the doctesting setup into a utility class instead of having lengthy sections creating `Doctest*` classes and sample repos.


---

Comment by saraedum created at 2013-08-20 11:20:50

Replying to [comment:31 ohanar]:
> If you are trying to download a file from within python you should probably use the retrieve method of `urllib.FancyURLopener`. See src/bin/sage-download-file for an example.

Ok. I changed it to use urllib.


---

Comment by saraedum created at 2013-08-20 11:26:22

Replying to [comment:32 vbraun]:
> * Use proxy objects instead of having to import magic constants
Right, this is syntactically much nicer. I changed this in my branch.
> * Don't hardcode the Sage repo directory, this is probably going to be useful elsewhere
Where is the repo hardcoded?
> * Use the `GIT_DIR` and `GIT_WORK_TREE` environment variables instead of `--git-dir` (though warning: there seems to be a bug in `git status`, it is not respecting `GIT_WORK_TREE`)
Could you explain the benefit of GIT_DIR and GIT_WORK_TREE?
> * Split the git interface (handling the mechanics of interfacing with the git binary) from the logical repository handling (like the `create_ticket` method)
`create_ticket` is not part of the git interface anymore. Are there any other methods you want to move?
> * Put all the doctesting setup into a utility class instead of having lengthy sections creating `Doctest*` classes and sample repos.
Good point. I was not sure initially what the doctests would look like. Now it seems that there are only two cases (one user, two users). I'll put the usual setup into special functions.


---

Comment by vbraun created at 2013-08-20 13:46:03

Changing type from task to enhancement.


---

Comment by vbraun created at 2013-08-20 13:46:03

Thanks, looks much better.

I would say anything that accesses the UI or Config ought to not be part of the low-level git interface. That should only know about the path to the repo and nothing else, so it can be used in the future for other git repos. But its not really urgent to fine-tune this right now.

Functionally, setting `GIT_DIR` and `GIT_WORK_TREE` is basically equivalent to setting `--git-dir` and always chdir-ing to the right directory. I just find the former better structured, you don't have to filter out arguments for the log etc. But again its not a big difference.


---

Comment by saraedum created at 2013-08-20 13:52:45

Replying to [comment:35 vbraun]:
> I would say anything that accesses the UI or Config ought to not be part of the low-level git interface. That should only know about the path to the repo and nothing else, so it can be used in the future for other git repos. But its not really urgent to fine-tune this right now.

> Functionally, setting `GIT_DIR` and `GIT_WORK_TREE` is basically equivalent to setting `--git-dir` and always chdir-ing to the right directory. I just find the former better structured, you don't have to filter out arguments for the log etc. But again its not a big difference.

I agree with both points. It would be nice to change this some day. For the time being I would rather leave it the way it is, just to be able to focus on the missing bits in sagedev.py.


---

Comment by ohanar created at 2013-08-20 21:48:41

Replying to [comment:35 vbraun]:
> Functionally, setting `GIT_DIR` and `GIT_WORK_TREE` is basically equivalent to setting `--git-dir` and always chdir-ing to the right directory.

Not quite, setting `GIT_WORK_TREE` doesn't behave the same as chdir-ing to a given directory, it simply specifies what git should consider is the root of work tree -- it will still display relative paths to the current directory (for all commands, as far as I can tell) if the current directory is a within the specified work tree.


---

Comment by saraedum created at 2013-08-22 18:36:20

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-08-29 15:15:42

I have a DSA ssh key (`~/.ssh/id_dsa` and `~/.ssh/id_dsa.pub`). I encountered two bugs:
1. The dev scripts only check for a RSA key, which I don't have. 
2. Since it didn't find my key, the scripts generated a new one. But as (`~/.ssh/id_rsa.pub` and `~/.ssh/id_rsa.pub.pub`), making the private key look like a public key that can be shared.


---

Comment by saraedum created at 2013-08-29 15:39:54

Thanks for trying things out. This should be fixed now.

Replying to [comment:40 vbraun]:
> I have a DSA ssh key (`~/.ssh/id_dsa` and `~/.ssh/id_dsa.pub`). I encountered two bugs:
> 1. The dev scripts only check for a RSA key, which I don't have. 
> 2. Since it didn't find my key, the scripts generated a new one. But as (`~/.ssh/id_rsa.pub` and `~/.ssh/id_rsa.pub.pub`), making the private key look like a public key that can be shared.


---

Comment by vbraun created at 2013-08-29 19:45:35

Thanks!

There is a minor annoyance left, I have already set up ssh keys yet the dev scripts insist on doing it again and prompt for username/password. We should first check if authetication to gitolite works, and only upload keys if it doesn't. I suggest the following test: Run

```
ssh -o "StrictHostKeyChecking yes" -o "PasswordAuthentication no" -o "PubkeyAuthentication yes" -p 2222 git`@`trac.sagemath.org help
```

If the exit code is 0, then the host key and ssh keys are already set up.


---

Comment by saraedum created at 2013-08-29 22:34:06

Replying to [comment:42 vbraun]:
> There is a minor annoyance left, I have already set up ssh keys yet the dev scripts insist on doing it again and prompt for username/password. We should first check if authetication to gitolite works, and only upload keys if it doesn't. I suggest the following test: Run

I now simply changed the scripts to only ask the user once. Your solution is much nicer but I just did something that is easy to implement. (Also, I'm not sure how portable the ssh call is, and I do not have a MAC to test.)


---

Comment by saraedum created at 2013-08-31 12:40:26

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2013-08-31 12:40:26

The SavingDicts' data is stored in DOT_SAGE. This is not a good idea because multiple copies of sage will write to the same data file. I guess these dicts need to go somewhere in the repository. Where should that be? `local/`?


---

Comment by tkluck created at 2013-08-31 14:52:13

maybe .git is best. They contain data about branches, right? I would also expect to be able to rm -rf local for a full rebuild.


---

Comment by saraedum created at 2013-08-31 14:57:06

Replying to [comment:45 tkluck]:
> maybe .git is best. They contain data about branches, right? I would also expect to be able to rm -rf local for a full rebuild.

You are right. Does git care if there are extra files in .git?


---

Comment by saraedum created at 2013-08-31 15:46:29

Replying to [comment:46 saraedum]:
> Replying to [comment:45 tkluck]:
> > maybe .git is best. They contain data about branches, right? I would also expect to be able to rm -rf local for a full rebuild.
> 
> You are right. Does git care if there are extra files in .git?

No it does not. man git says:

Higher level SCMs may provide and manage additional information in the $GIT_DIR.


---

Comment by saraedum created at 2013-08-31 16:05:39

Changing status from needs_work to needs_review.


---

Comment by ohanar created at 2013-08-31 22:00:11

Does not merge cleanly with `build_system` again, although easy fix. (More I want to hijack the branch here to review #15133)


---

Comment by git created at 2013-08-31 22:38:48

Branch pushed to git repo; I updated commit sha1. Recent commits:


---

Comment by git created at 2013-08-31 22:38:54

Branch pushed to git repo; I updated commit sha1. Recent commits:


---

Comment by git created at 2013-09-03 14:53:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-03 22:33:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-04 16:08:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 01:34:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 12:43:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 14:12:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-09-05 16:19:41


```
    sage: alice.git.echo.log('--pretty=%s') 
    Merge branch 'u/bob/ticket/1' of /dev/shm/... into ticket/1 
```

most peopole don't have their temp dir on `/dev/shm`. Can you ellipsize some more?


---

Comment by git created at 2013-09-05 16:22:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 16:46:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 16:51:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 16:57:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 18:32:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 18:53:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-05 19:07:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-06 14:05:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-06 14:29:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-06 14:32:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-06 23:49:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-09 16:06:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-10 21:35:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-10 21:53:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-11 17:16:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-11 22:49:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-12 15:18:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-13 13:28:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-13 13:38:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-13 21:11:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-09-20 10:51:04

How difficult would it be to preserve the description part of the `u/user/description` branch name? That is, when checking out a branch from a ticket #12345 use the local name `ticket/12345/description`? I think it'll be a bit annoying that the dev script users bulldoze your carefully thought-out description.

If the description already starts with `ticket/12345/...` then that first bit would be skipped. So if you push back to trac, it would become `u/user/ticket/12345/description`. And if somebody checks that ticket out, it would again become the local branch `ticket/12345/description`.


---

Comment by saraedum created at 2013-09-20 13:48:42

That's not hard to do. I guess I would like to prompt the user because personally I prefer the short names.

Would you mind creating an issue at the github page?


---

Comment by vbraun created at 2013-09-20 13:57:23

Do you want to spit in the original author's face and delete his description [Y/N]?

If you are using the dev scripts then you never get to see the actual branch name, so it shouldn't matter. If not then you should have tab-completion for git branches, making it into a non-issue as well. 

In any case, we can easily add that later so its not important for the first release of the dev scripts.


---

Comment by git created at 2013-09-20 15:52:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-09-22 21:32:49

I'm pretty happy with the rename. Two things remain:

```
    reset-to-clean-working-directory
                        Drop any uncommitted changes in the working directory.
```

should be something like

```
    clean               Delete all uncommited changes.
```

And `unstash` is not a word, its akin to "unspend" not being the opposite of "spend". It should be removed (my favorite) or renamed to `stash apply' (preferably) or 'stash-apply' (if we really must).


---

Comment by roed created at 2013-09-22 22:26:15

Replying to [comment:92 vbraun]:
> I'm pretty happy with the rename. Two things remain:
> {{{
>     reset-to-clean-working-directory
>                         Drop any uncommitted changes in the working directory.
> }}}
> should be something like
> {{{
>     clean               Delete all uncommited changes.
> }}}
> And `unstash` is not a word, its akin to "unspend" not being the opposite of "spend". It should be removed (my favorite) or renamed to `stash apply' (preferably) or 'stash-apply' (if we really must).

I'm happy with the `clean` rename, but I think `unstash` is better than either of the alternatives you've suggested, even if it's not a word.


---

Comment by vbraun created at 2013-09-22 22:49:03

I always though `unstash` was supposed to be `stash drop` until I read the docs, found that very confusing.


---

Comment by git created at 2013-09-23 15:50:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-09-24 11:41:17

I just debugged Simon's problem, and the dev scripts trip over the German localization in various places. The dev scripts should always set `LC_ALL=C` or `posix` before launching external programs if the output is being parsed. See also the thread at https://groups.google.com/d/msg/sage-git/jlm0piUE8Pk/DsA6lkbmhIsJ


---

Comment by vbraun created at 2013-09-26 13:26:28

I tried out the "stash" feature and it doesn't stash anything. It reimplements something that is similar but using branches instead of the git stash stack. So if this is the desired effect then we shouldn't call it stash, which also resolves the unstash naming question. Just call its save/restore or something like that. 

Also, documentation build failures:

```
[dev      ] /home/vbraun/Code/sage/src/doc/en/reference/dev/index.rst:2: WARNING: Title underline too short.
[dev      ] Sage's Development Scripts
[dev      ] =========
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/git_interface.py:docstring of sage.dev.git_interface.GitInterface.local_branches:5: WARNING: Literal block expected; none found.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev.merge:60: WARNING: Literal block expected; none found.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:11: WARNING: Block quote ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:10: WARNING: Block quote ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:11: WARNING: Block quote ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:11: WARNING: Block quote ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev.push:25: WARNING: Literal block expected; none found.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev.show_dependencies:35: WARNING: Literal block expected; none found.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/trac_interface.py:docstring of sage.dev.trac_interface.TicketSyntaxError:5: WARNING: Block quote ends without a blank line; unexpected unindent.
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/trac_interface.py:docstring of sage.dev.trac_interface.TicketSyntaxError:7: ERROR: Unexpected indentation.
```



---

Comment by saraedum created at 2013-09-26 15:17:35

Replying to [comment:99 vbraun]:
> I tried out the "stash" feature and it doesn't stash anything. It reimplements something that is similar but using branches instead of the git stash stack. So if this is the desired effect then we shouldn't call it stash, which also resolves the unstash naming question. Just call its save/restore or something like that.
It implements something that feels like stashing but internally it does not stash, correct. The reason for this is that the names of stashes change, i.e., the first stash is called something like ``@`stash{0}` but if you create another stash then it changes to ``@`stash{1}`. Feel free to change the current behaviour/naming if you are not happy with it.
 
> Also, documentation build failures:
> {{{
> [dev      ] /home/vbraun/Code/sage/src/doc/en/reference/dev/index.rst:2: WARNING: Title underline too short.
> [dev      ] Sage's Development Scripts
> [dev      ] =========
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/git_interface.py:docstring of sage.dev.git_interface.GitInterface.local_branches:5: WARNING: Literal block expected; none found.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev.merge:60: WARNING: Literal block expected; none found.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:11: WARNING: Block quote ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:10: WARNING: Block quote ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:11: WARNING: Block quote ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev:3: WARNING: Bullet list ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev:11: WARNING: Block quote ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev.push:25: WARNING: Literal block expected; none found.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/sagedev.py:docstring of sage.dev.sagedev.SageDev.show_dependencies:35: WARNING: Literal block expected; none found.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/trac_interface.py:docstring of sage.dev.trac_interface.TicketSyntaxError:5: WARNING: Block quote ends without a blank line; unexpected unindent.
> [dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/trac_interface.py:docstring of sage.dev.trac_interface.TicketSyntaxError:7: ERROR: Unexpected indentation.
> }}}
Thanks. I forgot to build the docs. I'll fix these later.


---

Comment by git created at 2013-09-26 16:16:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2013-09-26 16:19:38

I can't make any sense of this warning:


```
[dev      ] /home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/dev/trac_interface.py:docstring of sage.dev.trac_interface.TicketSyntaxError:5: WARNING: Block quote ends without a blank line; unexpected unindent.
```


Could someone else have a look at this?


---

Comment by vbraun created at 2013-09-29 13:23:29

All external programs ought to be called via `sage-native-execute`. Otherwise this is bound to happen (Fedora 19):

```
$ sage -dev create-ticket
nano: symbol lookup error: /lib64/libncursesw.so.5: undefined symbol: _nc_putchar
TicketSyntaxError: Editor returned non-zero exit value
```



---

Comment by vbraun created at 2013-09-29 20:57:56

I fixed the doc build issues. Will try to find some time this week to go through the code.


---

Comment by git created at 2013-09-29 20:58:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-30 15:56:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-30 17:16:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-30 19:39:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-30 21:41:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-30 23:36:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 02:55:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 02:56:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 04:27:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 04:31:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 04:52:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 06:09:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 06:11:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 06:24:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-01 11:06:00

I used INFO to log messages about how to proceed, this is one of the crucial features that make git usable:

```
$ git status
# On branch dev_scripts
# Your branch is ahead of 'trac/u/vbraun/dev_scripts' by 11 commits.
#   (use "git push" to publish your local commits)
#
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#	test
nothing added to commit but untracked files present (use "git add" to track)
```

Everything with comment markers is what I call INFO. I spent a lot of time observing people trying to use the dev scripts last week and not being told about the next logical step is a huge obstacle.

There are lots of DEBUG messages (=stuff that protocols the execution flow like "operation completed successfully") that are mislabeled as INFO. If you don't want to see unless you are trying to debug the program then it should be DEBUG.

We can have an intermediate INFO < HELP < NORMAL level if somebody really has a use for non-debug informational messages but I think that would be overkill.


---

Comment by git created at 2013-10-01 12:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 17:44:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-01 22:00:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-02 19:09:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-02 20:53:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-03 16:16:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-03 18:10:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-03 20:14:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-03 22:29:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-07 23:27:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-07 23:29:12

The last commit should fix the issue that Robert noted on https://groups.google.com/d/msg/sage-git/1V391vUBTH0/9qXjxD5u23UJ


---

Comment by git created at 2013-10-17 15:00:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-18 10:16:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ohanar created at 2013-10-24 19:02:59

There is a non-trivial merge with this branch and 5.13.beta1 in `src/bin/sage-fixdoctests` (which I'm not familiar with). I've merge the latest beta into my build system branch, but not into master due to this conflict, please resolve.


---

Comment by git created at 2013-10-24 21:06:50

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by vbraun created at 2013-10-24 21:08:21

I had made a quick&dirty fix to `sage-fixdoctests` since I needed it to fix the doctests... but in the meantime the proper fix from #10589 hit.


---

Comment by vbraun created at 2013-10-29 22:01:12

The dev scripts fail on a clean install:

```
$ ./sage -dev
Traceback (most recent call last):
  File "/home/vbraun/opt/sage-git/sage-5.13.beta1/src/bin/sage-dev", line 9, in <module>
    from sage.dev import dev as DEV
ImportError: cannot import name dev
```

I haven't noticed before because this is masked by a stale `.pyc` file if you have been following development for a while. Fix in the following commit.


---

Comment by git created at 2013-10-29 22:01:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-11-05 01:37:36

New commits:


---

Comment by git created at 2013-11-05 01:49:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-05 23:40:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-06 01:14:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-06 01:15:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-06 02:19:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mderickx created at 2013-11-06 04:54:09

I have the impression that this ticket is still heavily under developement and hence should not have a "needs review" status.


---

Comment by mderickx created at 2013-11-06 04:54:09

Changing status from needs_review to needs_work.


---

Comment by git created at 2013-11-06 05:39:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-06 18:12:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-06 18:30:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-07 00:48:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-07 23:07:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 20:24:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 20:43:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-11-11 16:50:11

New commits:


---

Comment by vbraun created at 2013-11-11 18:41:34

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2013-11-11 18:41:34

I agree with everything that I haven't written myself here... Andrew, is there anything left that we need to fix?


---

Comment by ohanar created at 2013-11-12 17:54:58

Not that I know of.


---

Comment by vbraun created at 2013-11-16 03:55:40

I get doctest failures on fresh accounts (cached stuff in DOT_SAGE?) of the type

```
File "src/sage/dev/git_interface.py", line 118, in sage.dev.git_interface.GitProxy._run_git
Failed example:
    dev.git.status()
Expected:
    Traceback (most recent call last):
    ...
    AssertionError: working with the sage repository in a doctest
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.dev.git_interface.GitProxy._run_git[7]>", line 1, in <module>
        dev.git.status()
      File "lazy_import.pyx", line 312, in sage.misc.lazy_import.LazyImport.__getattr__ (sage/misc/lazy_import.c:2402)
      File "lazy_import.pyx", line 248, in sage.misc.lazy_import.LazyImport._get_object (sage/misc/lazy_import.c:1885)
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/dev/sagedev_wrapper.py", line 250, in <module>
        dev = SageDevWrapper(SageDev())
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/dev/sagedev.py", line 119, in __init__
        self.trac = TracInterface(self.config['trac'], self._UI)
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/dev/trac_interface.py", line 212, in __init__
        self.__ticket_cache = SavingDict(ticket_cache_file)
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/dev/saving_dict.py", line 116, in __init__
        self._write()
      File "/home/buildslave/slave/local_full/build/local/lib/python2.7/site-packages/sage/dev/saving_dict.py", line 236, in _write
        assert os.path.abspath(self._filename).startswith(SAGE_TMP), error
    AssertionError: write attempt to a saving_dict in a doctest
```

Doesn't happen in my own user account. Anybody knows whats up?


---

Comment by vbraun created at 2013-11-20 16:17:39

On skynet/mark (Sparc Solaris, `Sun_SSH_1.1`) you must specify the key type in `ssh-keygen`: 

```
-bash-3.00$ ssh-keygen -q -f /tmp/foo -P ''
You must specify a key type (-t).
Usage: ssh-keygen [options]
Options:
  -b bits     Number of bits in the key to create.
  -c          Change comment in private and public key files.
  -e          Convert OpenSSH to IETF SECSH key file.
  -f filename Filename of the key file.
  -i          Convert IETF SECSH to OpenSSH key file.
  -l          Show fingerprint of key file.
  -p          Change passphrase of private key file.
  -q          Quiet.
  -y          Read private key file and print public key.
  -t type     Specify type of key to create.
  -B          Show bubblebabble digest of key file.
  -C comment  Provide new comment.
  -N phrase   Provide new passphrase.
  -P phrase   Provide old passphrase.
```



---

Comment by git created at 2013-11-21 04:37:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-23 02:14:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-26 19:22:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2013-12-09 16:53:50

I am having trouble importing Hg patches. I added an issue to the Github page with the details.

EDIT - Also I don't like that when aborting patch imports that it deletes all untracked directories (in particular, documentation output). I'd prefer if we could only delete newly created directories.

Thanks for all your work on this.


---

Comment by vbraun created at 2013-12-12 01:09:24

Which github page? In any case, our bug tracker is not on github. 
 
I'm sure there are a lot of small things that could be improved, but improvement requests should go into a separate ticket by now. Unless you think that the deleting of documentation output merits delaying the git transition.


---

Comment by tscrim created at 2013-12-12 03:35:42

Replying to [comment:164 vbraun]:
> Which github page? In any case, our bug tracker is not on github. 

The issues forum in the ticket description: ​https://github.com/sagemath/sage-workflow/issues

> I'm sure there are a lot of small things that could be improved, but improvement requests should go into a separate ticket by now. Unless you think that the deleting of documentation output merits delaying the git transition.

It's not worth the delay. It's an annoyance IMO, but not horribly so.


---

Comment by vbraun created at 2013-12-16 14:03:04

Resolution: fixed
