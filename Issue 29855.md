# Issue 29855: FreeQuadraticModule needs richer categories

Issue created by migration from https://trac.sagemath.org/ticket/30092

Original creator: mkoeppe

Original creation time: 2020-07-08 20:12:38

CC:  tscrim sbrandhorst gourgoulhon @mjungmath


```
sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()
Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)
```



---

Comment by mkoeppe created at 2020-07-17 17:58:43

Also, the classes in `sage.modules` do not make it possible to pass a `category` argument at initialization.


---

Comment by mkoeppe created at 2020-07-17 23:47:28

I have here a preliminary implementation (trying to learn from `FilteredModules` and `MetricSpaces`) of `NormedSpacesCategory` and `NormedVectorSpaces`.

Travis, if you could take a quick look to see if this seems to be going in the right direction...
----
New commits:


---

Comment by tscrim created at 2020-07-17 23:57:35

Why is this a functorial construction and not an axiom? I don't see why this wouldn't commute with other axioms, such as `WithBasis`.


---

Comment by mkoeppe created at 2020-07-18 00:00:09

Thanks. I'll look into this.


---

Comment by tscrim created at 2020-07-18 00:12:37

Ah, no, this is good. I thought I implemented metric spaces as an axiom, but it is a functorial construction. So please keep the current approach.


---

Comment by mkoeppe created at 2020-07-18 00:16:51

Thanks. I am still quite confused about many basic things in the category system, thanks for your patience.  I am getting this:

```
sage: VectorSpaces(QQ).Filtered().Normed()
Join of Category of filtered vector spaces over Rational Field and Category of metric spaces
```

What am I missing for "normed spaces" to show up?


---

Comment by tscrim created at 2020-07-18 00:19:11

Try

```diff
-class NormedSpacesCategory(RegressiveCovariantConstructionCategory, Category_over_base_ring):
+class NormedSpacesCategory(RegressiveCovariantConstructionCategory):
```



---

Comment by tscrim created at 2020-07-18 00:19:41

Also remove the `__init__`.


---

Comment by git created at 2020-07-18 00:22:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-18 00:27:30

I also have a question. Do we need this to be be a subcategory for vector spaces? I would think it would be sufficient for a module structure for the definition to make sense. For example, *Z* is naturally a normed *Z*-module that is not a vector space.

Addendum - Well, we actually need normed fields and rings as well for this to make sense. In fact, any additive monoid with a metric (function) becomes naturally normed. So we should also set that additional category link. I am not sure how to do that off-hand.


---

Comment by mkoeppe created at 2020-07-18 00:30:59

Well, I wanted `NormedSpacesCategory` to actually work also for modules, but I did not want to introduce the word "normed module" -- because this does not seem to be in widespread use.


---

Comment by tscrim created at 2020-07-18 00:32:25

However, moving it up one category level higher is a no-cost operation. Plus it means you don't have to deal with distinguishing the two categories (which can be slightly annoying at times).


---

Comment by mkoeppe created at 2020-07-18 00:33:18

Still getting

```
sage: VectorSpaces(QQ).Filtered().Normed()
Join of Category of filtered vector spaces over Rational Field and Category of metric spaces
```

after the changes from your comments 11/12


---

Comment by git created at 2020-07-18 00:36:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-18 00:37:57

Of course, there's always more generality. Here's one: https://mathworld.wolfram.com/NormedBanachModule.html


---

Comment by mkoeppe created at 2020-07-18 00:42:57

and we could do https://en.wikipedia.org/wiki/Normed_algebra (which places a restriction on the norm wrt multiplication)

... but I was hoping to first implement things that would be useful in a first course in linear algebra.


---

Comment by mkoeppe created at 2020-07-18 00:53:06

Another direction of generalization is, of course, through valuations on the field; instead of just informally using the absolute value function...


---

Comment by tscrim created at 2020-07-18 01:00:01

I am not really sure at this point why it is not working from looking at the code. The only thing I can think of at this point is that `default_super_categories` is not picking up the vector spaces category somehow. Perhaps something to look at is what is happening here

```python
        return Category.join([getattr(cat, cls._functor_category)(*args)
                              for cat in category._super_categories
                              if hasattr(cat, cls._functor_category)])
```

in `CovariantConstructionCategory.default_super_categories`. I can do some experimentation when I get back to my office on Monday.

I generally prefer to implement things in the first category where they make sense, which then follows up to the category that I really want it.

The other issue here is that you need the other normed categories in order for the definition of a norm to make sense. So they kind of have to come along for the ride. However, it should be easy enough to use the same functorial construction, the meaning of the word "normed" changes slightly, but everything is compatible, so there is no issue (and it is something we regularly do in the math).


---

Comment by mkoeppe created at 2020-07-18 01:17:20

Thanks a lot already!


---

Comment by git created at 2020-07-18 01:18:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-18 06:30:56

Replying to [comment:22 tscrim]:
> I generally prefer to implement things in the first category where they make sense, which then follows up to the category that I really want it.

Right. It looks it's best to start with normed additive groups (https://ncatlab.org/nlab/show/normed+group) - which use slightly weaker conditions.

> The other issue here is that you need the other normed categories in order for the definition of a norm to make sense. So they kind of have to come along for the ride. However, it should be easy enough to use the same functorial construction, the meaning of the word "normed" changes slightly, but everything is compatible, so there is no issue (and it is something we regularly do in the math).

I agree, this type of overloading seems unproblematic in this case.


---

Comment by sbrandhorst created at 2020-07-18 11:01:57

I didn't have time to look at this.
Just in case: Please be aware that there are no restrictions whatsoever on the inner product.
It is just a bilinear form. For instance it could be zero.


---

Comment by mkoeppe created at 2020-07-18 20:24:31

Replying to [comment:26 sbrandhorst]:
> Please be aware that there are no restrictions whatsoever on the inner product.
> It is just a bilinear form. For instance it could be zero. 

Thanks. This is important to keep it mind.


---

Comment by tscrim created at 2020-07-20 02:45:16

I figured out the problem: There is no link to the `NormedVectorSpaces`. So you need to add this to `VectorSpaces`:

```
    Normed = LazyImport('sage.categories.normed_vector_spaces', 'NormedVectorSpaces',
                        'Normed')
```

However, as we discussed, we wanted to lift this up. Are you currently working on this or would you like me to do it?


---

Comment by mkoeppe created at 2020-07-20 03:13:19

Please go ahead, I can't work on this until mid next week.


---

Comment by mkoeppe created at 2020-07-20 03:14:01

(Mid this week in your timezone)


---

Comment by tscrim created at 2020-07-21 00:53:26

It is still lacking a bit in implementation, but here is a proof-of-concept for the normed (additive) monoids and various other subcategories with concrete implementations for `ZZ` and `QQ` (which likely require more trivial doctest changes throughout Sage, but we should get all of the categories that we want done first in case it causes the output to change).
----
New commits:


---

Comment by mkoeppe created at 2020-07-21 01:07:23

Thanks very much! Looks great on a quick glance -- I'll take a closer look soon


---

Comment by mkoeppe created at 2020-07-21 02:22:35

Some quick thoughts on the test functions.
 - `_test_norm_additive` in `AdditiveSemigroups` ... perhaps change to `_test_norm_on_additive_monoid`
 - the one in additive groups - perhaps just have `_test_norm_symmetric` and use the inherited `_test_norm_on_additive_monoid` - if that makes sense
 - `_test_norm_multiplication` ... likewise change to `test_norm_on_multiplicative_monoid`


---

Comment by git created at 2020-07-21 04:43:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-21 04:51:11

Replying to [comment:33 mkoeppe]:
> Some quick thoughts on the test functions.
>  - `_test_norm_additive` in `AdditiveSemigroups` ... perhaps change to `_test_norm_on_additive_monoid`
>  - `_test_norm_multiplication` ... likewise change to `test_norm_on_multiplicative_monoid`

I don't want to do that for the multiplicative test because a ring, which is a monoid, does not satisfy the normed monoid properties because the norm of the multiplicative identity is not `0`. I guess that actually means this is not a regressive functorial construction. We only get a semigroup with a "weak norm," a function `S -> R` that satisfies `|ab| <= |a| + |b|` (do you know if something like this has a name?). Or we just have to acknowledge the abuse somewhere.

>  - the one in additive groups - perhaps just have `_test_norm_symmetric` and use the inherited `_test_norm_on_additive_monoid` - if that makes sense

That is a good idea. Done.


---

Comment by mkoeppe created at 2020-07-21 05:04:15

Replying to [comment:35 tscrim]:
> Replying to [comment:33 mkoeppe]:
> > Some quick thoughts on the test functions.
> >  - `_test_norm_additive` in `AdditiveSemigroups` ... perhaps change to `_test_norm_on_additive_monoid`
> >  - `_test_norm_multiplication` ... likewise change to `test_norm_on_multiplicative_monoid`
> 
> I don't want to do that for the multiplicative test because a ring, which is a monoid, does not satisfy the normed monoid properties because the norm of the multiplicative identity is not `0`. I guess that actually means this is not a regressive functorial construction. We only get a semigroup with a "weak norm," a function `S -> R` that satisfies `|ab| <= |a| + |b|` (do you know if something like this has a name?). Or we just have to acknowledge the abuse somewhere.

Let's see. I think this just means that there should be a separate category/functor for normed multiplicatively written monoids - satisfying `|ab| <= |a| + |b|` (and then multiplicative identities necessarily have norm 0). Call it `MultiplicativeNormed`. Just like `AdditiveCommutative` and `Commutative` are distinguished. 

This has nothing to do with the positive homogeneity property of norms on modules.


---

Comment by mkoeppe created at 2020-07-21 05:09:14

... OK, I forgot about rings.

Yes, there needs to be a `_test_norm_submultiplicative` that tests the ring multiplication. (That's in the category `Normed` - not `MultiplicativeNormed`.)


---

Comment by mkoeppe created at 2020-07-22 08:08:06

I'll make a few quick edits


---

Comment by git created at 2020-07-22 08:23:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-22 08:24:01

more on another day


---

Comment by tscrim created at 2020-07-24 00:45:27

I am -1 on calling the test `norm_symmetric` since I think that is too vague of a name. Are there objects that satisfy both the multiplicative and additive inverse norm properties? If so, then there will be a name clash too.

I think splitting the tests into finer pieces with finer categories is the right way to do things. The submultiplicative can then go into a new normed semigroups (maybe magmas?) category, etc.


---

Comment by mkoeppe created at 2020-07-24 00:55:52

Replying to [comment:41 tscrim]:
> I am -1 on calling the test `norm_symmetric` since I think that is too vague of a name.

OK, I agree.

> Are there objects that satisfy both the multiplicative and additive inverse norm properties? If so, then there will be a name clash too.

Haven't seen and I don't think it would be useful.

> I think splitting the tests into finer pieces with finer categories is the right way to do things. The submultiplicative can then go into a new normed semigroups (maybe magmas?) category, etc.

We could also make `norm` a map and then go through #30193...


---

Comment by tscrim created at 2020-07-24 01:10:29

Replying to [comment:42 mkoeppe]:
> Replying to [comment:41 tscrim]:
> > Are there objects that satisfy both the multiplicative and additive inverse norm properties? If so, then there will be a name clash too.
> 
> Haven't seen and I don't think it would be useful.

I agree, but sometimes you never know...

> > I think splitting the tests into finer pieces with finer categories is the right way to do things. The submultiplicative can then go into a new normed semigroups (maybe magmas?) category, etc.
> 
> We could also make `norm` a map and then go through #30193...

Possibly. Although at least for now we can implement everything here in the respective categories and refine it later on (well, just moving the respective methods around).


---

Comment by mkoeppe created at 2020-07-24 01:59:04

Replying to [comment:43 tscrim]:
> Although at least for now we can implement everything here in the respective categories and refine it later on (well, just moving the respective methods around).

OK, sounds like a plan. I'll work on it a little bit now


---

Comment by tscrim created at 2020-07-24 02:15:54

Replying to [comment:44 mkoeppe]:
> Replying to [comment:43 tscrim]:
> > Although at least for now we can implement everything here in the respective categories and refine it later on (well, just moving the respective methods around).
> 
> OK, sounds like a plan. I'll work on it a little bit now

Thank you. I can probably do it today too if you want.


---

Comment by git created at 2020-07-24 02:24:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-24 02:28:07

Replying to [comment:43 tscrim]:
> Replying to [comment:42 mkoeppe]:
> > Replying to [comment:41 tscrim]:
> > > Are there objects that satisfy both the multiplicative and additive inverse norm properties? If so, then there will be a name clash too.

I would suggest that we just ignore norms on multiplicative monoids on this ticket. 

Then we can decide later whether we want the shared code to go through axioms on functionals, or through other means. 

Also, norms on multiplicative monoids have a close connection to valuations on fields -- and getting all of that right on one ticket is too large a scope.


---

Comment by mkoeppe created at 2020-07-24 02:30:14

Replying to [comment:45 tscrim]:
> I can probably do it today too if you want.

Feel free to take over -- I have to take a break for dinner now anyway


---

Comment by mkoeppe created at 2020-07-25 21:24:14

Narrowed the ticket description


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
