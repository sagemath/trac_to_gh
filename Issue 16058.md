# Issue 16058: Faster is_orthogonal_array

archive/issues_016058.json:
```json
{
    "body": "CC:  @videlec @KPanComputes @dimpase\n\nAs the ticket claims this ticket implements a Cython version of `is_orthogonal_array`, which is then called by is_transversal_design and `are_mutually_orthogonal_latin_squares`.\n\nAlso sets a `check=False` in the code which slowed things down. As a resultthe tests are checked faster in the designs/ folder !\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/16295\n\n",
    "created_at": "2014-05-06T09:00:17Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Faster is_orthogonal_array",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16058",
    "user": "@nathanncohen"
}
```
CC:  @videlec @KPanComputes @dimpase

As the ticket claims this ticket implements a Cython version of `is_orthogonal_array`, which is then called by is_transversal_design and `are_mutually_orthogonal_latin_squares`.

Also sets a `check=False` in the code which slowed things down. As a resultthe tests are checked faster in the designs/ folder !

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/16295





---

archive/issue_comments_208966.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-06T09:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208966",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_208967.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2014-05-06T10:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208967",
    "user": "@nathanncohen"
}
```

Last 10 new commits:



---

archive/issue_comments_208968.json:
```json
{
    "body": "Nathann,\n\nThe code looks good and I have tested on an example different from your doc test.\n\nThe following run fine:\n\nmake, \ndoc-test, \ndocbuild html, \ncode coverage is 100%\n\nI had trouble making the pdf documentation and then went back to devel branch to check it worked Ok there.  It did and then when I moved back to u/ncohen/16295 it worked.  I am not sure what happened\n\nI think this needs two things:\n\n- it needs to be as consistent as possible with the purely python version inside orthogonal_arrays.py. That is, it will react the same way on the same input.  This change should be done and then a doc-test written to verify it.\n\n- it needs to have a doctest that demonstrates the speed improvement that cycthon gives over the purely python version inside orthogonal_arrays.py.",
    "created_at": "2014-05-12T15:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208968",
    "user": "@brettpim"
}
```

Nathann,

The code looks good and I have tested on an example different from your doc test.

The following run fine:

make, 
doc-test, 
docbuild html, 
code coverage is 100%

I had trouble making the pdf documentation and then went back to devel branch to check it worked Ok there.  It did and then when I moved back to u/ncohen/16295 it worked.  I am not sure what happened

I think this needs two things:

- it needs to be as consistent as possible with the purely python version inside orthogonal_arrays.py. That is, it will react the same way on the same input.  This change should be done and then a doc-test written to verify it.

- it needs to have a doctest that demonstrates the speed improvement that cycthon gives over the purely python version inside orthogonal_arrays.py.



---

archive/issue_comments_208969.json:
```json
{
    "body": "Hellllooooo !!\n\n> I had trouble making the pdf documentation and then went back to devel branch to check it worked Ok there.  It did and then when I moved back to u/ncohen/16295 it worked.  I am not sure what happened\n\nYeah, we had the same problems just one hour ago when Volker tried to merge #16277 or #16235... And it does not happen again because Sphinx is totall unreliable. I expect it to ocome from the dependencies, not from this ticket\n\n> I think this needs two things:\n> \n> - it needs to be as consistent as possible with the purely python version inside orthogonal_arrays.py. That is, it will react the same way on the same input.  This change should be done and then a doc-test written to verify it.\n\nOnce this patch is applied there is no python version inside of `orthogonal_arrays.py`, as this patch removes it. We can add any doctest you want, but what could it be ? Remember that  this function is already tested a LOT by all constructions of OA/TD/MOLS as it is run on those instances every time one is built.\n\n> - it needs to have a doctest that demonstrates the speed improvement that cycthon gives over the purely python version inside orthogonal_arrays.py.\n\nOnce more, this function removes the purely python one.\n\nNathann",
    "created_at": "2014-05-12T15:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208969",
    "user": "@nathanncohen"
}
```

Hellllooooo !!

> I had trouble making the pdf documentation and then went back to devel branch to check it worked Ok there.  It did and then when I moved back to u/ncohen/16295 it worked.  I am not sure what happened

Yeah, we had the same problems just one hour ago when Volker tried to merge #16277 or #16235... And it does not happen again because Sphinx is totall unreliable. I expect it to ocome from the dependencies, not from this ticket

> I think this needs two things:
> 
> - it needs to be as consistent as possible with the purely python version inside orthogonal_arrays.py. That is, it will react the same way on the same input.  This change should be done and then a doc-test written to verify it.

Once this patch is applied there is no python version inside of `orthogonal_arrays.py`, as this patch removes it. We can add any doctest you want, but what could it be ? Remember that  this function is already tested a LOT by all constructions of OA/TD/MOLS as it is run on those instances every time one is built.

> - it needs to have a doctest that demonstrates the speed improvement that cycthon gives over the purely python version inside orthogonal_arrays.py.

Once more, this function removes the purely python one.

Nathann



---

archive/issue_comments_208970.json:
```json
{
    "body": "Hi Nathann,\n\nYou should avoid using `any` in Cython. This is not properly cythonized. The following is better by 15%:\n\n```\nfor i in range(len(OA)):\n    if len(OA[i]) != k:\n        if verbose:\n            print {\"OA\"   : \"Some row does not have length \"+str(k),\n                   \"MOLS\" : \"The number of matrices is not \"+str(k)}[terminology]\n```\n\nIf you do so, you need to move up the `cdef int i,j,l`.\n\nVincent",
    "created_at": "2014-05-12T15:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208970",
    "user": "@videlec"
}
```

Hi Nathann,

You should avoid using `any` in Cython. This is not properly cythonized. The following is better by 15%:

```
for i in range(len(OA)):
    if len(OA[i]) != k:
        if verbose:
            print {"OA"   : "Some row does not have length "+str(k),
                   "MOLS" : "The number of matrices is not "+str(k)}[terminology]
```

If you do so, you need to move up the `cdef int i,j,l`.

Vincent



---

archive/issue_comments_208971.json:
```json
{
    "body": "Yoooooooo !!\n\n> You should avoid using `any` in Cython. This is not properly cythonized. The following is better by 15%:\n\nIt is good to know, but I really do not think that this is the critical part here `:-D`\n\nNathann",
    "created_at": "2014-05-12T16:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208971",
    "user": "@nathanncohen"
}
```

Yoooooooo !!

> You should avoid using `any` in Cython. This is not properly cythonized. The following is better by 15%:

It is good to know, but I really do not think that this is the critical part here `:-D`

Nathann



---

archive/issue_comments_208972.json:
```json
{
    "body": "Sorry, I had changed branches and then opened orthogonal_array.py in an editor and so thought is_orthogonal_array was still there.\n\nHere is my timing data\n\nwith Cython:\n\n\n```\nsage: time is_orthogonal_array(OA,8,9)\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 27.2 \u00b5s\nFalse\nsage: time is_orthogonal_array(OA,12,11)\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 239 \u00b5s\nTrue\n```\n\n\n\nwith Python:\n\n```\nsage: time is_orthogonal_array(OA,8,9,2)\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 29.1 \u00b5s\nFalse\nsage: time is_orthogonal_array(OA,12,11,2)\nCPU times: user 12 ms, sys: 4 ms, total: 16 ms\nWall time: 13.1 ms\nTrue\n```\n\n\nthis shows a significant improvement in speed.\n\nHowever I think this needs to be fixed:\n\n\n```\nsage: is_orthogonal_array(OA,12,11,3)\nTrue\n```\n\nIf it is passed t=3 it should at least alert the user that it is going to override this with t=2\n\nHere is what I think should be done:\n\n- fix t>2 bug\n- remove \"any\" as Vincent suggested\n- implement a doc test for\n    - all your bad input/format tests\n    - memory test\n    - t>2 test",
    "created_at": "2014-05-12T16:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208972",
    "user": "@brettpim"
}
```

Sorry, I had changed branches and then opened orthogonal_array.py in an editor and so thought is_orthogonal_array was still there.

Here is my timing data

with Cython:


```
sage: time is_orthogonal_array(OA,8,9)
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 27.2 µs
False
sage: time is_orthogonal_array(OA,12,11)
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 239 µs
True
```



with Python:

```
sage: time is_orthogonal_array(OA,8,9,2)
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 29.1 µs
False
sage: time is_orthogonal_array(OA,12,11,2)
CPU times: user 12 ms, sys: 4 ms, total: 16 ms
Wall time: 13.1 ms
True
```


this shows a significant improvement in speed.

However I think this needs to be fixed:


```
sage: is_orthogonal_array(OA,12,11,3)
True
```

If it is passed t=3 it should at least alert the user that it is going to override this with t=2

Here is what I think should be done:

- fix t>2 bug
- remove "any" as Vincent suggested
- implement a doc test for
    - all your bad input/format tests
    - memory test
    - t>2 test



---

archive/issue_comments_208973.json:
```json
{
    "body": "p.s. where is sage_free documented?",
    "created_at": "2014-05-12T16:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208973",
    "user": "@brettpim"
}
```

p.s. where is sage_free documented?



---

archive/issue_comments_208974.json:
```json
{
    "body": "Hello !\n\n> - fix t>2 bug\n\nDone.\n\n> - remove \"any\" as Vincent suggested\n\nGuys, it is very important that you understand that this is what is called \"taste\", and that it makes absolutely no difference in the runtimes. If you want to make changes like that, it would be cool to implement it yourself instead of asking me to do it for you.\n\nI just did it, because I need the patch to get in quick.\n\n> - implement a doc test for\n>     - all your bad input/format tests\n\nDone.\n\n>     - memory test\n\nI cannot test that.\n\n>     - t>2 test\n\nDone.\n\nNathann",
    "created_at": "2014-05-13T09:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208974",
    "user": "@nathanncohen"
}
```

Hello !

> - fix t>2 bug

Done.

> - remove "any" as Vincent suggested

Guys, it is very important that you understand that this is what is called "taste", and that it makes absolutely no difference in the runtimes. If you want to make changes like that, it would be cool to implement it yourself instead of asking me to do it for you.

I just did it, because I need the patch to get in quick.

> - implement a doc test for
>     - all your bad input/format tests

Done.

>     - memory test

I cannot test that.

>     - t>2 test

Done.

Nathann



---

archive/issue_comments_208975.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2014-05-13T09:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208975",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_208976.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-05-13T09:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208976",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_208977.json:
```json
{
    "body": "Brett : the performance improvements are particularly nice for LARGE designs ! I implemented this because I wanted to check that we could indeed produce all the OA promised in our MOLS table, but some (in particularly prime powers, for k gets very large) took VERY long. With this, it is really faster and checking that the OA is an OA is not the bottleneck anymore when playing with designs.\n\nNathann",
    "created_at": "2014-05-13T13:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208977",
    "user": "@nathanncohen"
}
```

Brett : the performance improvements are particularly nice for LARGE designs ! I implemented this because I wanted to check that we could indeed produce all the OA promised in our MOLS table, but some (in particularly prime powers, for k gets very large) took VERY long. With this, it is really faster and checking that the OA is an OA is not the bottleneck anymore when playing with designs.

Nathann



---

archive/issue_comments_208978.json:
```json
{
    "body": "A bugfix. `u=1` was disregarded by mistake in `wilson_construction`. Julian R. Abel spotted this from only looking at the MOLS table. That's scary `O_O;;;;`\n\nNathann",
    "created_at": "2014-05-14T09:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208978",
    "user": "@nathanncohen"
}
```

A bugfix. `u=1` was disregarded by mistake in `wilson_construction`. Julian R. Abel spotted this from only looking at the MOLS table. That's scary `O_O;;;;`

Nathann



---

archive/issue_comments_208979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-14T09:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208979",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208980.json:
```json
{
    "body": "Vincent,\n\nWhat does it mean that \"any\" is not properly cythonized.  Does this just mean it is not efficient or does it mean there could be problems with future versions of cython?\n\nbrett",
    "created_at": "2014-05-15T08:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208980",
    "user": "@brettpim"
}
```

Vincent,

What does it mean that "any" is not properly cythonized.  Does this just mean it is not efficient or does it mean there could be problems with future versions of cython?

brett



---

archive/issue_comments_208981.json:
```json
{
    "body": "To look at the new code for this patch, I updated master and develop.  Then I tried \n\n\n```\ngit checkout u/ncohen/16295\ngit pull --ff-only trac u/ncohen/16295\n```\n\n\nand recieved\n\n\n```\nFrom trac.sagemath.org:sage\n * branch            u/ncohen/16295 -> FETCH_HEAD\nfatal: Not possible to fast-forward, aborting.\n```\n\n\nhow do I update this branch?\n\nthanks\nbrett",
    "created_at": "2014-05-15T08:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208981",
    "user": "@brettpim"
}
```

To look at the new code for this patch, I updated master and develop.  Then I tried 


```
git checkout u/ncohen/16295
git pull --ff-only trac u/ncohen/16295
```


and recieved


```
From trac.sagemath.org:sage
 * branch            u/ncohen/16295 -> FETCH_HEAD
fatal: Not possible to fast-forward, aborting.
```


how do I update this branch?

thanks
brett



---

archive/issue_comments_208982.json:
```json
{
    "body": "As suggestedin the developers guide, I just ran \n\n\n\n```\n$git checkout master\nSwitched to branch 'master'\nYour branch is ahead of 'origin/master' by 1992 commits.\n$ git reset --hard trac/master\nfatal: ambiguous argument 'trac/master': unknown revision or path not in the working tree.\nUse '--' to separate paths from revisions\n```\n\n\nI am not sure what to do, the developers guide does not help here.\n\nbrett",
    "created_at": "2014-05-15T08:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208982",
    "user": "@brettpim"
}
```

As suggestedin the developers guide, I just ran 



```
$git checkout master
Switched to branch 'master'
Your branch is ahead of 'origin/master' by 1992 commits.
$ git reset --hard trac/master
fatal: ambiguous argument 'trac/master': unknown revision or path not in the working tree.
Use '--' to separate paths from revisions
```


I am not sure what to do, the developers guide does not help here.

brett



---

archive/issue_comments_208983.json:
```json
{
    "body": "Replying to [comment:18 brett]:\n> As suggestedin the developers guide, I just ran \n> \n> \n> {{{\n> $git checkout master\n> }}}\n\nWhy do you need this? This brings you to the stable Sage release (6.2).\nOf course you are miles ahead of it, being around 6.3.beta1 or even later.",
    "created_at": "2014-05-15T08:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208983",
    "user": "@dimpase"
}
```

Replying to [comment:18 brett]:
> As suggestedin the developers guide, I just ran 
> 
> 
> {{{
> $git checkout master
> }}}

Why do you need this? This brings you to the stable Sage release (6.2).
Of course you are miles ahead of it, being around 6.3.beta1 or even later.



---

archive/issue_comments_208984.json:
```json
{
    "body": "Replying to [comment:17 brett]:\n> To look at the new code for this patch, I updated master and develop.  Then I tried \n> \n> {{{\n> git checkout u/ncohen/16295\n> git pull --ff-only trac u/ncohen/16295\n> }}}\n> \n\nhow about doing this without `--ff-only` ?",
    "created_at": "2014-05-15T08:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208984",
    "user": "@dimpase"
}
```

Replying to [comment:17 brett]:
> To look at the new code for this patch, I updated master and develop.  Then I tried 
> 
> {{{
> git checkout u/ncohen/16295
> git pull --ff-only trac u/ncohen/16295
> }}}
> 

how about doing this without `--ff-only` ?



---

archive/issue_comments_208985.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> Replying to [comment:18 brett]:\n> > As suggestedin the developers guide, I just ran \n> > \n> > \n> > {{{\n> > $git checkout master\n> > }}}\n> \n> Why do you need this? This brings you to the stable Sage release (6.2).\n> Of course you are miles ahead of it, being around 6.3.beta1 or even later.\n> \n\nI keep a current stable release branch for reference and stability if I need it.  I think I have done something to it.",
    "created_at": "2014-05-15T08:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208985",
    "user": "@brettpim"
}
```

Replying to [comment:19 dimpase]:
> Replying to [comment:18 brett]:
> > As suggestedin the developers guide, I just ran 
> > 
> > 
> > {{{
> > $git checkout master
> > }}}
> 
> Why do you need this? This brings you to the stable Sage release (6.2).
> Of course you are miles ahead of it, being around 6.3.beta1 or even later.
> 

I keep a current stable release branch for reference and stability if I need it.  I think I have done something to it.



---

archive/issue_comments_208986.json:
```json
{
    "body": "Replying to [comment:20 dimpase]:\n> Replying to [comment:17 brett]:\n> > To look at the new code for this patch, I updated master and develop.  Then I tried \n> > \n> > {{{\n> > git checkout u/ncohen/16295\n> > git pull --ff-only trac u/ncohen/16295\n> > }}}\n> > \n> \n> how about doing this without `--ff-only` ?\n> \n\nOk I tried\n\n\n\n```\n$ git checkout u/ncohen/16295 \nSwitched to branch 'u/ncohen/16295'\n$ git pull trac u/ncohen/16295\nFrom trac.sagemath.org:sage\n * branch            u/ncohen/16295 -> FETCH_HEAD\nAuto-merging src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py\nAuto-merging src/sage/combinat/designs/orthogonal_arrays.py\nCONFLICT (content): Merge conflict in src/sage/combinat/designs/orthogonal_arrays.py\nAuto-merging src/sage/combinat/designs/latin_squares.py\nAuto-merging src/sage/combinat/designs/designs_pyx.pyx\nCONFLICT (add/add): Merge conflict in src/sage/combinat/designs/designs_pyx.pyx\nAuto-merging src/sage/combinat/designs/block_design.py\nAuto-merging src/module_list.py\nAutomatic merge failed; fix conflicts and then commit the result.\n```\n\n\nHave I somehow changed the files?  I certainly did not intend to.\n\nbrett",
    "created_at": "2014-05-15T08:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208986",
    "user": "@brettpim"
}
```

Replying to [comment:20 dimpase]:
> Replying to [comment:17 brett]:
> > To look at the new code for this patch, I updated master and develop.  Then I tried 
> > 
> > {{{
> > git checkout u/ncohen/16295
> > git pull --ff-only trac u/ncohen/16295
> > }}}
> > 
> 
> how about doing this without `--ff-only` ?
> 

Ok I tried



```
$ git checkout u/ncohen/16295 
Switched to branch 'u/ncohen/16295'
$ git pull trac u/ncohen/16295
From trac.sagemath.org:sage
 * branch            u/ncohen/16295 -> FETCH_HEAD
Auto-merging src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py
Auto-merging src/sage/combinat/designs/orthogonal_arrays.py
CONFLICT (content): Merge conflict in src/sage/combinat/designs/orthogonal_arrays.py
Auto-merging src/sage/combinat/designs/latin_squares.py
Auto-merging src/sage/combinat/designs/designs_pyx.pyx
CONFLICT (add/add): Merge conflict in src/sage/combinat/designs/designs_pyx.pyx
Auto-merging src/sage/combinat/designs/block_design.py
Auto-merging src/module_list.py
Automatic merge failed; fix conflicts and then commit the result.
```


Have I somehow changed the files?  I certainly did not intend to.

brett



---

archive/issue_comments_208987.json:
```json
{
    "body": "Replying to [comment:21 brett]:\n\nas you see `switching to the branch master` rather than `already on branch master`, and you're ahead of `master` by a zillion commits, you are most probably on \n`develop`, or on some other branch you got onto while reviewing a ticket.",
    "created_at": "2014-05-15T08:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208987",
    "user": "@dimpase"
}
```

Replying to [comment:21 brett]:

as you see `switching to the branch master` rather than `already on branch master`, and you're ahead of `master` by a zillion commits, you are most probably on 
`develop`, or on some other branch you got onto while reviewing a ticket.



---

archive/issue_comments_208988.json:
```json
{
    "body": "Replying to [comment:22 brett]:\n> Replying to [comment:20 dimpase]:\n> > Replying to [comment:17 brett]:\n> > > To look at the new code for this patch, I updated master and develop.  Then I tried \n> > > \n> > > {{{\n> > > git checkout u/ncohen/16295\n> > > git pull --ff-only trac u/ncohen/16295\n> > > }}}\n> > > \n> > \n> > how about doing this without `--ff-only` ?\n> > \n> \n> Ok I tried\n> \n> \n> {{{\n> $ git checkout u/ncohen/16295 \n> Switched to branch 'u/ncohen/16295'\n> $ git pull trac u/ncohen/16295\n> From trac.sagemath.org:sage\n>  * branch            u/ncohen/16295 -> FETCH_HEAD\n> Auto-merging src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py\n> Auto-merging src/sage/combinat/designs/orthogonal_arrays.py\n> CONFLICT (content): Merge conflict in src/sage/combinat/designs/orthogonal_arrays.py\n> Auto-merging src/sage/combinat/designs/latin_squares.py\n> Auto-merging src/sage/combinat/designs/designs_pyx.pyx\n> CONFLICT (add/add): Merge conflict in src/sage/combinat/designs/designs_pyx.pyx\n> Auto-merging src/sage/combinat/designs/block_design.py\n> Auto-merging src/module_list.py\n> Automatic merge failed; fix conflicts and then commit the result.\n> }}}\n> \n> Have I somehow changed the files?  I certainly did not intend to.\n\nare you updating from `develop`? Or `master`? \nOn the other hand I just tried `git trac pull 12345` (I am using [git-trac-command](https://github.com/sagemath/git-trac-command), which I would recommend!) it is worked.\n\nPerhaps you should try checking out `develop` and then trying again...",
    "created_at": "2014-05-15T09:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208988",
    "user": "@dimpase"
}
```

Replying to [comment:22 brett]:
> Replying to [comment:20 dimpase]:
> > Replying to [comment:17 brett]:
> > > To look at the new code for this patch, I updated master and develop.  Then I tried 
> > > 
> > > {{{
> > > git checkout u/ncohen/16295
> > > git pull --ff-only trac u/ncohen/16295
> > > }}}
> > > 
> > 
> > how about doing this without `--ff-only` ?
> > 
> 
> Ok I tried
> 
> 
> {{{
> $ git checkout u/ncohen/16295 
> Switched to branch 'u/ncohen/16295'
> $ git pull trac u/ncohen/16295
> From trac.sagemath.org:sage
>  * branch            u/ncohen/16295 -> FETCH_HEAD
> Auto-merging src/sage/schemes/hyperelliptic_curves/monsky_washnitzer.py
> Auto-merging src/sage/combinat/designs/orthogonal_arrays.py
> CONFLICT (content): Merge conflict in src/sage/combinat/designs/orthogonal_arrays.py
> Auto-merging src/sage/combinat/designs/latin_squares.py
> Auto-merging src/sage/combinat/designs/designs_pyx.pyx
> CONFLICT (add/add): Merge conflict in src/sage/combinat/designs/designs_pyx.pyx
> Auto-merging src/sage/combinat/designs/block_design.py
> Auto-merging src/module_list.py
> Automatic merge failed; fix conflicts and then commit the result.
> }}}
> 
> Have I somehow changed the files?  I certainly did not intend to.

are you updating from `develop`? Or `master`? 
On the other hand I just tried `git trac pull 12345` (I am using [git-trac-command](https://github.com/sagemath/git-trac-command), which I would recommend!) it is worked.

Perhaps you should try checking out `develop` and then trying again...



---

archive/issue_comments_208989.json:
```json
{
    "body": "Guys guys, all this is happening because I rewrote history here. The only thing to do brett is to checkout my branch, or to checkout \"develop\" and then to pull my branch.\n\nThe copy of my branch that you have on your computer has been abandonned. If you do a checkout on it THEN pull my branch then you are trying to apply the same modifications twice, and it fails.\n\nIf you can delete the copy of my branch that you have on my computer, do it.\n\nIt is a bit hard to debug without having both hands on your keyboard, though `:-/`\n\nNathann",
    "created_at": "2014-05-15T09:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208989",
    "user": "@nathanncohen"
}
```

Guys guys, all this is happening because I rewrote history here. The only thing to do brett is to checkout my branch, or to checkout "develop" and then to pull my branch.

The copy of my branch that you have on your computer has been abandonned. If you do a checkout on it THEN pull my branch then you are trying to apply the same modifications twice, and it fails.

If you can delete the copy of my branch that you have on my computer, do it.

It is a bit hard to debug without having both hands on your keyboard, though `:-/`

Nathann



---

archive/issue_comments_208990.json:
```json
{
    "body": "Everything is good except I am still having trouble building the documentation\n\n\n\n```\n$sage -docbuild reference html\n.\n.\n.\nc_functions                                    writing output... [ 99%] tableaux\n                                               writing output... [100%] words\n[combinat ] None:38: WARNING: citation not found: Schiffmann\nError building the documentation.\nTraceback (most recent call last):\n  File \"/home/brett/Projects/SAGE/sage/src/doc/common/builder.py\", line 1477, in <module>\n    getattr(get_builder(name), type)()\n  File \"/home/brett/Projects/SAGE/sage/src/doc/common/builder.py\", line 487, in _wrapper\n    x.get(99999)\n  File \"/home/brett/Projects/SAGE/sage/local/lib/python/multiprocessing/pool.py\", line 554, in get\n    raise self._value\nOSError: [combinat ] None:38: WARNING: citation not found: Schiffmann\n\n```\n\n\n\nDo you get this error too Nathann?",
    "created_at": "2014-05-15T10:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208990",
    "user": "@brettpim"
}
```

Everything is good except I am still having trouble building the documentation



```
$sage -docbuild reference html
.
.
.
c_functions                                    writing output... [ 99%] tableaux
                                               writing output... [100%] words
[combinat ] None:38: WARNING: citation not found: Schiffmann
Error building the documentation.
Traceback (most recent call last):
  File "/home/brett/Projects/SAGE/sage/src/doc/common/builder.py", line 1477, in <module>
    getattr(get_builder(name), type)()
  File "/home/brett/Projects/SAGE/sage/src/doc/common/builder.py", line 487, in _wrapper
    x.get(99999)
  File "/home/brett/Projects/SAGE/sage/local/lib/python/multiprocessing/pool.py", line 554, in get
    raise self._value
OSError: [combinat ] None:38: WARNING: citation not found: Schiffmann

```



Do you get this error too Nathann?



---

archive/issue_comments_208991.json:
```json
{
    "body": "Helloooooo Brett !!\n\nNo I don' get this error and apparently it does not come from the designs code but somewhere else.. I think you should run \"make doc-clean && make\" which will re-build the doc. Takes some time, but not tooo long either. Sorry, I think you hit a lot of walls on this tickets `^^;`\n\nNathann",
    "created_at": "2014-05-15T11:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208991",
    "user": "@nathanncohen"
}
```

Helloooooo Brett !!

No I don' get this error and apparently it does not come from the designs code but somewhere else.. I think you should run "make doc-clean && make" which will re-build the doc. Takes some time, but not tooo long either. Sorry, I think you hit a lot of walls on this tickets `^^;`

Nathann



---

archive/issue_comments_208992.json:
```json
{
    "body": "Replying to [comment:27 ncohen]:\n> Helloooooo Brett !!\n> \n> No I don' get this error and apparently it does not come from the designs code but somewhere else.. I think you should run \"make doc-clean && make\" which will re-build the doc. Takes some time, but not tooo long either. Sorry, I think you hit a lot of walls on this tickets `^^;`\n> \n> Nathann\n\nIt is not a problem.  The coding part of this patch is clear and easy so this is a good ticket to hit the other kinds of problems that might show up when reviewing.",
    "created_at": "2014-05-15T11:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208992",
    "user": "@brettpim"
}
```

Replying to [comment:27 ncohen]:
> Helloooooo Brett !!
> 
> No I don' get this error and apparently it does not come from the designs code but somewhere else.. I think you should run "make doc-clean && make" which will re-build the doc. Takes some time, but not tooo long either. Sorry, I think you hit a lot of walls on this tickets `^^;`
> 
> Nathann

It is not a problem.  The coding part of this patch is clear and easy so this is a good ticket to hit the other kinds of problems that might show up when reviewing.



---

archive/issue_comments_208993.json:
```json
{
    "body": "make doc-clean && make worked fine.  Does this build both html and pdf documentation?",
    "created_at": "2014-05-15T11:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208993",
    "user": "@brettpim"
}
```

make doc-clean && make worked fine.  Does this build both html and pdf documentation?



---

archive/issue_comments_208994.json:
```json
{
    "body": "I think it only build the html one. \"make doc-pdf\" builds the pdf version `:-)`\n\nNathann",
    "created_at": "2014-05-15T11:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208994",
    "user": "@nathanncohen"
}
```

I think it only build the html one. "make doc-pdf" builds the pdf version `:-)`

Nathann



---

archive/issue_comments_208995.json:
```json
{
    "body": "\n```python\n    # Filling times_n\n    for i in range(n+1):\n        times_n[i] = i*n\n```\n\n\nAhem, you care for speed? ;-)\n\n(And there's no `times_n2[]` either.)",
    "created_at": "2014-05-15T20:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208995",
    "user": "@nexttime"
}
```


```python
    # Filling times_n
    for i in range(n+1):
        times_n[i] = i*n
```


Ahem, you care for speed? ;-)

(And there's no `times_n2[]` either.)



---

archive/issue_comments_208996.json:
```json
{
    "body": "> Ahem, you care for speed? ;-)\n\nYeah. And it turns out that I am totally incompetent.\n\nWhen caching the multiplication\n\n```\nsage: OA=designs.orthogonal_array(None,2**7,check=False)\nsage: %timeit is_orthogonal_array(OA,2**7+1,2**7,2)                    \n1 loops, best of 3: 618 ms per loop\n```\n\n\nWhen you don't\n\n```\nsage: OA=designs.orthogonal_array(None,2**7,check=False)\nsage: %timeit is_orthogonal_array(OA,2**7+1,2**7,2)                    \n1 loops, best of 3: 375 ms per loop\n```\n\n\n.......................................................\n\n> (And there's no `times_n2[]` either.)\n\n`times_n2` ? What for ?\n\nAnyway, this caching was the only thing keeping me from implementing this for all t, so now I will be able to implement it generally now. Cool `-_-`\n\nNathann",
    "created_at": "2014-05-15T20:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208996",
    "user": "@nathanncohen"
}
```

> Ahem, you care for speed? ;-)

Yeah. And it turns out that I am totally incompetent.

When caching the multiplication

```
sage: OA=designs.orthogonal_array(None,2**7,check=False)
sage: %timeit is_orthogonal_array(OA,2**7+1,2**7,2)                    
1 loops, best of 3: 618 ms per loop
```


When you don't

```
sage: OA=designs.orthogonal_array(None,2**7,check=False)
sage: %timeit is_orthogonal_array(OA,2**7+1,2**7,2)                    
1 loops, best of 3: 375 ms per loop
```


.......................................................

> (And there's no `times_n2[]` either.)

`times_n2` ? What for ?

Anyway, this caching was the only thing keeping me from implementing this for all t, so now I will be able to implement it generally now. Cool `-_-`

Nathann



---

archive/issue_comments_208997.json:
```json
{
    "body": "Does this data show that it is faster to simply do the multiplications?",
    "created_at": "2014-05-15T20:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208997",
    "user": "@brettpim"
}
```

Does this data show that it is faster to simply do the multiplications?



---

archive/issue_comments_208998.json:
```json
{
    "body": "Replying to [comment:33 brett]:\n> Does this data show that it is faster to simply do the multiplications?  \n\nIn general depends on your CPU and your (C) compiler.  (And in conjunction with Cython, the kind of code the latter generates, i.e., whether the C compiler can \"guess\" what's meant or whether the code is to obfuscated.)",
    "created_at": "2014-05-15T20:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208998",
    "user": "@nexttime"
}
```

Replying to [comment:33 brett]:
> Does this data show that it is faster to simply do the multiplications?  

In general depends on your CPU and your (C) compiler.  (And in conjunction with Cython, the kind of code the latter generates, i.e., whether the C compiler can "guess" what's meant or whether the code is to obfuscated.)



---

archive/issue_comments_208999.json:
```json
{
    "body": "Replying to [comment:32 ncohen]:\n> `times_n2` ? What for ?\n\nIt's used twice, in the outer loop and the first inner loop:\n\n```python\n    for i in range(k): # For any column C1\n        C1 = OAc+i*n2\n        for j in range(i+1,k): # For any column C2 > C1\n            C2 = OAc+j*n2\n            ...\n```\n\n\nOne would usually not look up multiples of `n^2` (or `n` in the earlier case), but do\n\n```python\n    C1 = OAc\n    i = 0\n    while i < k:\n\n        ... # similar for C2, j\n\n        C1 += n2\n        i++\n```\n\n\nIn C, you'd presumably drop `j` (and perhaps also `i`) altogether, and just compare the pointers to the address of the (current sub-)array end.\n\n(And inlining the bitset operations would of course make it even faster.  Afterwards special-case for `n`=2<sup>m</sup> ... :-) )",
    "created_at": "2014-05-15T21:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-208999",
    "user": "@nexttime"
}
```

Replying to [comment:32 ncohen]:
> `times_n2` ? What for ?

It's used twice, in the outer loop and the first inner loop:

```python
    for i in range(k): # For any column C1
        C1 = OAc+i*n2
        for j in range(i+1,k): # For any column C2 > C1
            C2 = OAc+j*n2
            ...
```


One would usually not look up multiples of `n^2` (or `n` in the earlier case), but do

```python
    C1 = OAc
    i = 0
    while i < k:

        ... # similar for C2, j

        C1 += n2
        i++
```


In C, you'd presumably drop `j` (and perhaps also `i`) altogether, and just compare the pointers to the address of the (current sub-)array end.

(And inlining the bitset operations would of course make it even faster.  Afterwards special-case for `n`=2<sup>m</sup> ... :-) )



---

archive/issue_comments_209000.json:
```json
{
    "body": "> It's used twice, in the outer loop and the first inner loop:\n\nCome on... This is not the bottleneck `:-P`\n\n> (And inlining the bitset operations would of course make it even faster.  Afterwards special-case for `n`=2<sup>m</sup> ... :-) )\n\nThey may be inlined already ! I didn't check though.\n\nAnyway. Let's remove this useless caching, and then I will go sleep a bit. I couldn't do this earlier because my laptop is totally breaking and my screen refused to turn on `T_T`\n\nNathann",
    "created_at": "2014-05-15T21:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209000",
    "user": "@nathanncohen"
}
```

> It's used twice, in the outer loop and the first inner loop:

Come on... This is not the bottleneck `:-P`

> (And inlining the bitset operations would of course make it even faster.  Afterwards special-case for `n`=2<sup>m</sup> ... :-) )

They may be inlined already ! I didn't check though.

Anyway. Let's remove this useless caching, and then I will go sleep a bit. I couldn't do this earlier because my laptop is totally breaking and my screen refused to turn on `T_T`

Nathann



---

archive/issue_comments_209001.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-15T21:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209001",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209002.json:
```json
{
    "body": "Changing component from combinatorics to combinatorial designs.",
    "created_at": "2014-05-16T21:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209002",
    "user": "@nathanncohen"
}
```

Changing component from combinatorics to combinatorial designs.



---

archive/issue_comments_209003.json:
```json
{
    "body": "Would anybody have some time for this ticket ? `:-P`\n\nNathann",
    "created_at": "2014-05-20T12:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209003",
    "user": "@nathanncohen"
}
```

Would anybody have some time for this ticket ? `:-P`

Nathann



---

archive/issue_comments_209004.json:
```json
{
    "body": "Nathann\n\nI am in Finland visiting a colleague.  My plan is to produce a patch on top of this that implements Vincent's code for \"any\" and does some small work on English and once I commit it and if you are OK with my changes we can finish with this patch.  I am sorry I am working in spurts on these sage patches, but I am trying to make the most of my time with my colleague here.  It will be soon.\n\nregards\nbrett",
    "created_at": "2014-05-20T12:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209004",
    "user": "@brettpim"
}
```

Nathann

I am in Finland visiting a colleague.  My plan is to produce a patch on top of this that implements Vincent's code for "any" and does some small work on English and once I commit it and if you are OK with my changes we can finish with this patch.  I am sorry I am working in spurts on these sage patches, but I am trying to make the most of my time with my colleague here.  It will be soon.

regards
brett



---

archive/issue_comments_209005.json:
```json
{
    "body": "Hello !\n\n> I am in Finland visiting a colleague.\n\nOkayyyyyyyyy.... !\n\n>   My plan is to produce a patch on top of this that implements Vincent's code for \"any\" \n\nThis is already done, I updated the code last time and there is no \"any\" anymore.\n\n> and does some small work on English\n\nOkay.\n\n> and once I commit it and if you are OK with my changes we can finish with this patch.  I am sorry I am working in spurts on these sage patches, but I am trying to make the most of my time with my colleague here.  It will be soon.\n\nGot it ! Have fun there.\n\nNathann",
    "created_at": "2014-05-20T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209005",
    "user": "@nathanncohen"
}
```

Hello !

> I am in Finland visiting a colleague.

Okayyyyyyyyy.... !

>   My plan is to produce a patch on top of this that implements Vincent's code for "any" 

This is already done, I updated the code last time and there is no "any" anymore.

> and does some small work on English

Okay.

> and once I commit it and if you are OK with my changes we can finish with this patch.  I am sorry I am working in spurts on these sage patches, but I am trying to make the most of my time with my colleague here.  It will be soon.

Got it ! Have fun there.

Nathann



---

archive/issue_comments_209006.json:
```json
{
    "body": "Replying to [comment:40 brett]:\n> My plan is to produce a patch on top of this that [...]  does some small work on English and once I commit it and if you are OK with my changes we can finish with this patch.\n\nYes, there are some typos, and the first sentence of the docstring refers to `M` while the parameter's name is `OA`.",
    "created_at": "2014-05-20T13:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209006",
    "user": "@nexttime"
}
```

Replying to [comment:40 brett]:
> My plan is to produce a patch on top of this that [...]  does some small work on English and once I commit it and if you are OK with my changes we can finish with this patch.

Yes, there are some typos, and the first sentence of the docstring refers to `M` while the parameter's name is `OA`.



---

archive/issue_comments_209007.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-20T13:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209007",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209008.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-26T16:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209008",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209009.json:
```json
{
    "body": "Okay guys... Well it has been two weeks, so if the only problem of this patch is a typo perhaps it can be dealt with ?... There are several branches depending on this one...\n\nNathann",
    "created_at": "2014-06-02T09:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209009",
    "user": "@nathanncohen"
}
```

Okay guys... Well it has been two weeks, so if the only problem of this patch is a typo perhaps it can be dealt with ?... There are several branches depending on this one...

Nathann



---

archive/issue_comments_209010.json:
```json
{
    "body": "I am just back from Scandinavia.  I will do this today.\n\nbrett",
    "created_at": "2014-06-03T06:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209010",
    "user": "@brettpim"
}
```

I am just back from Scandinavia.  I will do this today.

brett



---

archive/issue_comments_209011.json:
```json
{
    "body": "I have made almost all the changes.  In the code line\n\n\n\n```\nif verbose:\n    print {\"OA\"   : \"Columns {} and {} are not orthogonal\".format(i,j),\n           \"MOLS\" : \"Matrices {} and {} are not orthogonal\".format(i,j)}[terminology]\n    return False\n```\n\n\nIs there a compact way of switching depending on the values of i and j in the case that terminology=MOLS?  if i = 0 and j>1 then \"square j-2\" is not row latin.  if i=1 and J> 1 then square j-2 is not column latin\"  if both i,j >2 then \"square i-2 is not orthogonal to square j-2\"\n\nif i=0 and j=1 I have not found the right way to word the error message yet. Perhaps something like \"the row and column indices are not orthogonal\"\n\nbrett",
    "created_at": "2014-06-03T21:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209011",
    "user": "@brettpim"
}
```

I have made almost all the changes.  In the code line



```
if verbose:
    print {"OA"   : "Columns {} and {} are not orthogonal".format(i,j),
           "MOLS" : "Matrices {} and {} are not orthogonal".format(i,j)}[terminology]
    return False
```


Is there a compact way of switching depending on the values of i and j in the case that terminology=MOLS?  if i = 0 and j>1 then "square j-2" is not row latin.  if i=1 and J> 1 then square j-2 is not column latin"  if both i,j >2 then "square i-2 is not orthogonal to square j-2"

if i=0 and j=1 I have not found the right way to word the error message yet. Perhaps something like "the row and column indices are not orthogonal"

brett



---

archive/issue_comments_209012.json:
```json
{
    "body": "Hello !\n\nReplying to [comment:47 brett]:\n> I have made almost all the changes.  In the code line\n> \n> \n> {{{\n> if verbose:\n>     print {\"OA\"   : \"Columns {} and {} are not orthogonal\".format(i,j),\n>            \"MOLS\" : \"Matrices {} and {} are not orthogonal\".format(i,j)}[terminology]\n>     return False\n> }}}\n> \n> Is there a compact way of switching depending on the values of i and j in the case that terminology=MOLS?  if i = 0 and j>1 then \"square j-2\" is not row latin.  if i=1 and J> 1 then square j-2 is not column latin\"  if both i,j >2 then \"square i-2 is not orthogonal to square j-2\"\n\nThis block of code is not about each matrix being a latin square. Actually, this is not checked anywhere so I will add a commit.\n\nThis block of code is about the orthogonality of two matrices, i.e. do you find all possible pairs of integers when you read them simultaneously cell by cell.\n\nNathann",
    "created_at": "2014-06-04T08:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209012",
    "user": "@nathanncohen"
}
```

Hello !

Replying to [comment:47 brett]:
> I have made almost all the changes.  In the code line
> 
> 
> {{{
> if verbose:
>     print {"OA"   : "Columns {} and {} are not orthogonal".format(i,j),
>            "MOLS" : "Matrices {} and {} are not orthogonal".format(i,j)}[terminology]
>     return False
> }}}
> 
> Is there a compact way of switching depending on the values of i and j in the case that terminology=MOLS?  if i = 0 and j>1 then "square j-2" is not row latin.  if i=1 and J> 1 then square j-2 is not column latin"  if both i,j >2 then "square i-2 is not orthogonal to square j-2"

This block of code is not about each matrix being a latin square. Actually, this is not checked anywhere so I will add a commit.

This block of code is about the orthogonality of two matrices, i.e. do you find all possible pairs of integers when you read them simultaneously cell by cell.

Nathann



---

archive/issue_comments_209013.json:
```json
{
    "body": "Nathann,\n\nI understand what the code is doing.  When I say \"square\" I mean \"latin square\"  and in the language of MOLS column 0 of an OA is the row index of the Squares, column 1 is the column index and column i is latin square i-2.  I am just making the error reporting consistent with the way that a MOLS person would interpret it.  Please do not change the branch yet as I am in the middle of editing the code.  I was just curious if there was a compact way to use a more complex case/switch in cython.  But I think there is not so I will just make the changes with nested if statements.\n\nbrett",
    "created_at": "2014-06-04T08:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209013",
    "user": "@brettpim"
}
```

Nathann,

I understand what the code is doing.  When I say "square" I mean "latin square"  and in the language of MOLS column 0 of an OA is the row index of the Squares, column 1 is the column index and column i is latin square i-2.  I am just making the error reporting consistent with the way that a MOLS person would interpret it.  Please do not change the branch yet as I am in the middle of editing the code.  I was just curious if there was a compact way to use a more complex case/switch in cython.  But I think there is not so I will just make the changes with nested if statements.

brett



---

archive/issue_comments_209014.json:
```json
{
    "body": "Still, it must be checked that each matrix is a latin square, because right now we have this :\n\n\n```\nsage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares\nsage: m1 = matrix([[0,0,0],[1,1,1],[2,2,2]])                                               \nsage: m2 = matrix([[0,1,2],[0,1,2],[0,1,2]])                                               \nsage: are_mutually_orthogonal_latin_squares([m1,m2], verbose=True)                         \nTrue\n```\n\n\nI added a commit on u/ncohen/16295_v2 to fix that. Do not worry about possible conflicts with what you are doing : when you will be done, push your commit wherever you want on a branch of yours, give me its name and I will deal with the merge.\n\nNathann",
    "created_at": "2014-06-04T10:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209014",
    "user": "@nathanncohen"
}
```

Still, it must be checked that each matrix is a latin square, because right now we have this :


```
sage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares
sage: m1 = matrix([[0,0,0],[1,1,1],[2,2,2]])                                               
sage: m2 = matrix([[0,1,2],[0,1,2],[0,1,2]])                                               
sage: are_mutually_orthogonal_latin_squares([m1,m2], verbose=True)                         
True
```


I added a commit on u/ncohen/16295_v2 to fix that. Do not worry about possible conflicts with what you are doing : when you will be done, push your commit wherever you want on a branch of yours, give me its name and I will deal with the merge.

Nathann



---

archive/issue_comments_209015.json:
```json
{
    "body": "Hello,\n\n> I understand what the code is doing.  When I say \"square\" I mean \"latin square\"  and in the language of MOLS column 0 of an OA is the row index of the Squares, column 1 is the column index and column i is latin square i-2.\n\nRight now when `are_mutually_latin_squares` calls `is_orthogonal_array` it does not check that the resulting OA is a `OA(k+2,n)` but only that it is a `OA(k,n)`. This, because the OA that is produced has only k columns and not k+2. This, because the columns corresponding to the row indices and the columns indices are not added to the OA.\n\nThis way, when the sequence of matrices is not a MOLS, the error message is that \"matrix i is not orthogonal with matrix j\" or that \"matrix i is not a latin squares\".\n\nWhich is, I believe, clearer to the user and easier to implement than by messing with the error messages of `is_orthogonal_design`.\n\nNathann",
    "created_at": "2014-06-04T10:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209015",
    "user": "@nathanncohen"
}
```

Hello,

> I understand what the code is doing.  When I say "square" I mean "latin square"  and in the language of MOLS column 0 of an OA is the row index of the Squares, column 1 is the column index and column i is latin square i-2.

Right now when `are_mutually_latin_squares` calls `is_orthogonal_array` it does not check that the resulting OA is a `OA(k+2,n)` but only that it is a `OA(k,n)`. This, because the OA that is produced has only k columns and not k+2. This, because the columns corresponding to the row indices and the columns indices are not added to the OA.

This way, when the sequence of matrices is not a MOLS, the error message is that "matrix i is not orthogonal with matrix j" or that "matrix i is not a latin squares".

Which is, I believe, clearer to the user and easier to implement than by messing with the error messages of `is_orthogonal_design`.

Nathann



---

archive/issue_comments_209016.json:
```json
{
    "body": "I just tried \n\n\n\n```\n$git trac push\ngit: 'trac' is not a git command. See 'git --help'.\n\n```\n\n\n\nbut this did not work to push my revision up.  What command do I use?",
    "created_at": "2014-06-04T13:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209016",
    "user": "@brettpim"
}
```

I just tried 



```
$git trac push
git: 'trac' is not a git command. See 'git --help'.

```



but this did not work to push my revision up.  What command do I use?



---

archive/issue_comments_209017.json:
```json
{
    "body": "Hello !\n\n> but this did not work to push my revision up.  What command do I use?\n\nYou seem to want to use \"git trac\" but it is not installed. This being said if you downloaded the branch without using \"git trac\" I don't think that just pushing is going to work.\n\nWhat is the output of \n\n\n```\ngit push trac HEAD:public/16295\n```\n\n\nIt should push your current branch to public/16295.\n\nNathann",
    "created_at": "2014-06-04T13:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209017",
    "user": "@nathanncohen"
}
```

Hello !

> but this did not work to push my revision up.  What command do I use?

You seem to want to use "git trac" but it is not installed. This being said if you downloaded the branch without using "git trac" I don't think that just pushing is going to work.

What is the output of 


```
git push trac HEAD:public/16295
```


It should push your current branch to public/16295.

Nathann



---

archive/issue_comments_209018.json:
```json
{
    "body": "The Sage developers guide says \"git trac puch\" not \"git push trac\"\n\nhere is what I get when I do it the right way around:\n\n\n```\n$ git push trac\nCounting objects: 13, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (7/7), done.\nWriting objects: 100% (7/7), 937 bytes, done.\nTotal 7 (delta 6), reused 0 (delta 0)\nremote: FATAL: W refs/heads/u/ncohen/16295 sage brett DENIED by fallthru\nremote: error: hook declined to update refs/heads/u/ncohen/16295\nTo git@trac.sagemath.org:sage.git\n ! [remote rejected] u/ncohen/16295 -> u/ncohen/16295 (hook declined)\nerror: failed to push some refs to 'git@trac.sagemath.org:sage.git'\n```\n",
    "created_at": "2014-06-04T13:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209018",
    "user": "@brettpim"
}
```

The Sage developers guide says "git trac puch" not "git push trac"

here is what I get when I do it the right way around:


```
$ git push trac
Counting objects: 13, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (7/7), done.
Writing objects: 100% (7/7), 937 bytes, done.
Total 7 (delta 6), reused 0 (delta 0)
remote: FATAL: W refs/heads/u/ncohen/16295 sage brett DENIED by fallthru
remote: error: hook declined to update refs/heads/u/ncohen/16295
To git@trac.sagemath.org:sage.git
 ! [remote rejected] u/ncohen/16295 -> u/ncohen/16295 (hook declined)
error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
```




---

archive/issue_comments_209019.json:
```json
{
    "body": "> The Sage developers guide says \"git trac puch\" not \"git push trac\"\n> \n> here is what I get when I do it the right way around:\n\nOkay. So you noticed that the \"right way\" did not work. Can you try the \"wrong way\", i.e. the line I gave you above ? From the error message you got I think it will work.\n\nThe reason is simple : you cannot simply \"push\" to my branch because you have no write access to it. All branches whose name is u/my_login/whatever can only be written by guys whose login is my_login.\n\npublic/whatever branches can be written by anybody, though.\n\nNathann",
    "created_at": "2014-06-04T13:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209019",
    "user": "@nathanncohen"
}
```

> The Sage developers guide says "git trac puch" not "git push trac"
> 
> here is what I get when I do it the right way around:

Okay. So you noticed that the "right way" did not work. Can you try the "wrong way", i.e. the line I gave you above ? From the error message you got I think it will work.

The reason is simple : you cannot simply "push" to my branch because you have no write access to it. All branches whose name is u/my_login/whatever can only be written by guys whose login is my_login.

public/whatever branches can be written by anybody, though.

Nathann



---

archive/issue_comments_209020.json:
```json
{
    "body": "your command worked but it creates a new branch and that is inoptimal\n\n\n```\n$ git push trac HEAD:public/16295\nCounting objects: 13, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (7/7), done.\nWriting objects: 100% (7/7), 937 bytes, done.\nTotal 7 (delta 6), reused 0 (delta 0)\nTo git@trac.sagemath.org:sage.git\n * [new branch]      HEAD -> public/16295\n\n```\n\n\nDoes this get attached to the right ticket?",
    "created_at": "2014-06-04T13:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209020",
    "user": "@brettpim"
}
```

your command worked but it creates a new branch and that is inoptimal


```
$ git push trac HEAD:public/16295
Counting objects: 13, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (7/7), done.
Writing objects: 100% (7/7), 937 bytes, done.
Total 7 (delta 6), reused 0 (delta 0)
To git@trac.sagemath.org:sage.git
 * [new branch]      HEAD -> public/16295

```


Does this get attached to the right ticket?



---

archive/issue_comments_209021.json:
```json
{
    "body": "> your command worked but it creates a new branch and that is inoptimal\n\nDon't worry about branches, nobody has to pay for them. Anyway you cannot write on my branch (which is not my doing) so there is no other way.\n\n> Does this get attached to the right ticket?\n\nIt does not get attached to any ticket. You just added a branch on the trac server. Now I can look at it, we can discuss it, and if we agree with what is inside I will push it on the branch which is on this ticket. Or I will change this ticket's branch to public/16295 if it is easier.\n\nNathann",
    "created_at": "2014-06-04T13:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209021",
    "user": "@nathanncohen"
}
```

> your command worked but it creates a new branch and that is inoptimal

Don't worry about branches, nobody has to pay for them. Anyway you cannot write on my branch (which is not my doing) so there is no other way.

> Does this get attached to the right ticket?

It does not get attached to any ticket. You just added a branch on the trac server. Now I can look at it, we can discuss it, and if we agree with what is inside I will push it on the branch which is on this ticket. Or I will change this ticket's branch to public/16295 if it is easier.

Nathann



---

archive/issue_comments_209022.json:
```json
{
    "body": "Replying to [comment:56 brett]:\n> your command worked but it creates a new branch and that is inoptimal\n> \n> {{{\n> $ git push trac HEAD:public/16295\n> Counting objects: 13, done.\n> Delta compression using up to 4 threads.\n> Compressing objects: 100% (7/7), done.\n> Writing objects: 100% (7/7), 937 bytes, done.\n> Total 7 (delta 6), reused 0 (delta 0)\n> To git`@`trac.sagemath.org:sage.git\n>  * [new branch]      HEAD -> public/16295\n> \n> }}}\n> \n> Does this get attached to the right ticket?\n\nWhy do you think this is not optimal? This is a normal way to go. Surely if there already was public/16295 branch you'd rather pushed there. But there was none. You can't push into someone else's branch. only into public/ ones.",
    "created_at": "2014-06-04T13:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209022",
    "user": "@dimpase"
}
```

Replying to [comment:56 brett]:
> your command worked but it creates a new branch and that is inoptimal
> 
> {{{
> $ git push trac HEAD:public/16295
> Counting objects: 13, done.
> Delta compression using up to 4 threads.
> Compressing objects: 100% (7/7), done.
> Writing objects: 100% (7/7), 937 bytes, done.
> Total 7 (delta 6), reused 0 (delta 0)
> To git`@`trac.sagemath.org:sage.git
>  * [new branch]      HEAD -> public/16295
> 
> }}}
> 
> Does this get attached to the right ticket?

Why do you think this is not optimal? This is a normal way to go. Surely if there already was public/16295 branch you'd rather pushed there. But there was none. You can't push into someone else's branch. only into public/ ones.



---

archive/issue_comments_209023.json:
```json
{
    "body": "Replying to [comment:58 dimpase]:\n \n> Why do you think this is not optimal? This is a normal way to go. Surely if there already was public/16295 branch you'd rather pushed there. But there was none. You can't push into someone else's branch. only into public/ ones.\n\nI thought that that if there was a way for me to write to the patch's branch then having to create another is inoptimal, but if this is how it works then that is no problem.",
    "created_at": "2014-06-04T13:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209023",
    "user": "@brettpim"
}
```

Replying to [comment:58 dimpase]:
 
> Why do you think this is not optimal? This is a normal way to go. Surely if there already was public/16295 branch you'd rather pushed there. But there was none. You can't push into someone else's branch. only into public/ ones.

I thought that that if there was a way for me to write to the patch's branch then having to create another is inoptimal, but if this is how it works then that is no problem.



---

archive/issue_comments_209024.json:
```json
{
    "body": "Replying to [comment:54 brett]:\n> The Sage developers guide says \"git trac puch\" not \"git push trac\"\n\n`git trac` means `invoke git-trac git extension`. (see http://github.com/sagemath/git-trac-command)\n\n`git push trac` means `do git's push to the remote named `trac`.\n\n(you can use `git remote -v` to see which remotes are set up for you)\n\n\n> \n> here is what I get when I do it the right way around:\n> \n> {{{\n> $ git push trac\n> Counting objects: 13, done.\n> Delta compression using up to 4 threads.\n> Compressing objects: 100% (7/7), done.\n> Writing objects: 100% (7/7), 937 bytes, done.\n> Total 7 (delta 6), reused 0 (delta 0)\n> remote: FATAL: W refs/heads/u/ncohen/16295 sage brett DENIED by fallthru\n> remote: error: hook declined to update refs/heads/u/ncohen/16295\n> To git`@`trac.sagemath.org:sage.git\n>  ! [remote rejected] u/ncohen/16295 -> u/ncohen/16295 (hook declined)\n> error: failed to push some refs to 'git`@`trac.sagemath.org:sage.git'\n> }}}\n> \nsurely, you can't push in an u/TRAC-USERNAME branch, that's why\n\n>",
    "created_at": "2014-06-04T13:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209024",
    "user": "@dimpase"
}
```

Replying to [comment:54 brett]:
> The Sage developers guide says "git trac puch" not "git push trac"

`git trac` means `invoke git-trac git extension`. (see http://github.com/sagemath/git-trac-command)

`git push trac` means `do git's push to the remote named `trac`.

(you can use `git remote -v` to see which remotes are set up for you)


> 
> here is what I get when I do it the right way around:
> 
> {{{
> $ git push trac
> Counting objects: 13, done.
> Delta compression using up to 4 threads.
> Compressing objects: 100% (7/7), done.
> Writing objects: 100% (7/7), 937 bytes, done.
> Total 7 (delta 6), reused 0 (delta 0)
> remote: FATAL: W refs/heads/u/ncohen/16295 sage brett DENIED by fallthru
> remote: error: hook declined to update refs/heads/u/ncohen/16295
> To git`@`trac.sagemath.org:sage.git
>  ! [remote rejected] u/ncohen/16295 -> u/ncohen/16295 (hook declined)
> error: failed to push some refs to 'git`@`trac.sagemath.org:sage.git'
> }}}
> 
surely, you can't push in an u/TRAC-USERNAME branch, that's why

>



---

archive/issue_comments_209025.json:
```json
{
    "body": "Nathann,\n\nI think if MOLS people are going to be using this code then we should add the additional 2 columns in when a MOLS gets transformed to a OA.  In that case all the error messages I have changed are correct and this is what MOLS people will expect",
    "created_at": "2014-06-04T13:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209025",
    "user": "@brettpim"
}
```

Nathann,

I think if MOLS people are going to be using this code then we should add the additional 2 columns in when a MOLS gets transformed to a OA.  In that case all the error messages I have changed are correct and this is what MOLS people will expect



---

archive/issue_comments_209026.json:
```json
{
    "body": "Brett,\n\nHere is the behaviour of your branch\n\n```\nsage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares\nsage: m1 = matrix([[0,1,0],[2,0,1],[1,2,0]]) # not a latin square\nsage: m2 = matrix([[0,1,2],[1,2,0],[2,0,1]]) # not a latin square                                     \nsage: are_mutually_orthogonal_latin_squares([m1,m2], verbose=True)                         \nThe row and column indices are not orthogonal\nFalse\nsage: m1 = matrix([[0,0,0],[1,1,1],[2,2,2]])  # not a latin square\nsage: m2 = matrix([[0,1,2],[0,1,2],[0,1,2]])  # not a latin square\nsage: are_mutually_orthogonal_latin_squares([m1,m2],verbose=True)\nTrue\nsage: a,b,c,d = designs.mutually_orthogonal_latin_squares(11,4)      \nsage: are_mutually_orthogonal_latin_squares([a,b,c,d,d],verbose=True)\nSquares 1 and 2 are not orthogonal\nFalse\n```\n\n\nThe index issues come from problem I mentionned in comment 51.\n\n> I think if MOLS people are going to be using this code then we should add the additional 2 columns in when a MOLS gets transformed to a OA.  In that case all the error messages I have changed are correct and this is what MOLS people will expect\n\nHere is what my branch u/ncohen/16295_v2 (mentionned in comment 50) does :\n\n\n```\nsage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares\nsage: m1 = matrix([[0,1,0],[2,0,1],[1,2,0]]) # not a latin square\nsage: m2 = matrix([[0,1,2],[1,2,0],[2,0,1]]) # not a latin square\nsage: are_mutually_orthogonal_latin_squares([m1,m2], verbose=True) \nMatrix 0 is not row latin\nFalse\nsage: m1 = matrix([[0,0,0],[1,1,1],[2,2,2]])  # not a latin square\nsage: m2 = matrix([[0,1,2],[0,1,2],[0,1,2]])  # not a latin square\nsage: are_mutually_orthogonal_latin_squares([m1,m2],verbose=True)\nMatrix 0 is not row latin\nFalse\nsage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares\nsage: a,b,c,d = designs.mutually_orthogonal_latin_squares(11,4)\nsage: are_mutually_orthogonal_latin_squares([a,b,c,d,d],verbose=True)\nMatrices 3 and 4 are not orthogonal\nFalse\n```\n\n\nOur terminology is almost the same (we can replace \"matrix\" with \"square\" if you prefer). The interest of mine is that you do not have to add MOLS-specific code to the `is_orthogonal_array` function. Thus do you mind if we keep my version of the code to make `are_mutually_orthogonal_squares` correct and include your typo fix ?\n\nNathann",
    "created_at": "2014-06-04T14:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209026",
    "user": "@nathanncohen"
}
```

Brett,

Here is the behaviour of your branch

```
sage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares
sage: m1 = matrix([[0,1,0],[2,0,1],[1,2,0]]) # not a latin square
sage: m2 = matrix([[0,1,2],[1,2,0],[2,0,1]]) # not a latin square                                     
sage: are_mutually_orthogonal_latin_squares([m1,m2], verbose=True)                         
The row and column indices are not orthogonal
False
sage: m1 = matrix([[0,0,0],[1,1,1],[2,2,2]])  # not a latin square
sage: m2 = matrix([[0,1,2],[0,1,2],[0,1,2]])  # not a latin square
sage: are_mutually_orthogonal_latin_squares([m1,m2],verbose=True)
True
sage: a,b,c,d = designs.mutually_orthogonal_latin_squares(11,4)      
sage: are_mutually_orthogonal_latin_squares([a,b,c,d,d],verbose=True)
Squares 1 and 2 are not orthogonal
False
```


The index issues come from problem I mentionned in comment 51.

> I think if MOLS people are going to be using this code then we should add the additional 2 columns in when a MOLS gets transformed to a OA.  In that case all the error messages I have changed are correct and this is what MOLS people will expect

Here is what my branch u/ncohen/16295_v2 (mentionned in comment 50) does :


```
sage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares
sage: m1 = matrix([[0,1,0],[2,0,1],[1,2,0]]) # not a latin square
sage: m2 = matrix([[0,1,2],[1,2,0],[2,0,1]]) # not a latin square
sage: are_mutually_orthogonal_latin_squares([m1,m2], verbose=True) 
Matrix 0 is not row latin
False
sage: m1 = matrix([[0,0,0],[1,1,1],[2,2,2]])  # not a latin square
sage: m2 = matrix([[0,1,2],[0,1,2],[0,1,2]])  # not a latin square
sage: are_mutually_orthogonal_latin_squares([m1,m2],verbose=True)
Matrix 0 is not row latin
False
sage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares
sage: a,b,c,d = designs.mutually_orthogonal_latin_squares(11,4)
sage: are_mutually_orthogonal_latin_squares([a,b,c,d,d],verbose=True)
Matrices 3 and 4 are not orthogonal
False
```


Our terminology is almost the same (we can replace "matrix" with "square" if you prefer). The interest of mine is that you do not have to add MOLS-specific code to the `is_orthogonal_array` function. Thus do you mind if we keep my version of the code to make `are_mutually_orthogonal_squares` correct and include your typo fix ?

Nathann



---

archive/issue_comments_209027.json:
```json
{
    "body": "Nathann,\n\nI strongly feel that it would be much more consistent with\n\n1) what people in design theory will expect the code to do\n\n2) the equivalence between OAs and MOLS\n\nto have `are_mutually_orthogonal_squares` add the two extra columns and then simply call `is_orthogonal_array`.  This will have the effect of checking that all the squares are, in fact latin and you will not have to have `are_mutually_orthogonal_squares` do this extra checking.\n\nin my opinion as a design theorist, the behaviour you cite in comment 62 of my code is all correct.  In the second example the squares ARE orthogonal, they are just NOT latin.  if you add the additional two columns the behaviour will be reported.\n\n\nbrett",
    "created_at": "2014-06-05T06:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209027",
    "user": "@brettpim"
}
```

Nathann,

I strongly feel that it would be much more consistent with

1) what people in design theory will expect the code to do

2) the equivalence between OAs and MOLS

to have `are_mutually_orthogonal_squares` add the two extra columns and then simply call `is_orthogonal_array`.  This will have the effect of checking that all the squares are, in fact latin and you will not have to have `are_mutually_orthogonal_squares` do this extra checking.

in my opinion as a design theorist, the behaviour you cite in comment 62 of my code is all correct.  In the second example the squares ARE orthogonal, they are just NOT latin.  if you add the additional two columns the behaviour will be reported.


brett



---

archive/issue_comments_209028.json:
```json
{
    "body": "Hello !\n\n> I strongly feel that it would be much more consistent with\n> \n> 1) what people in design theory will expect the code to do\n\nYou claim again that my code does something that somebody (a user ?) \"in design theory\" might not expect. Can you tell me what it is ? Or is the function okay for the user's point of view, while you think that the way it is coded is \"something that people in design theory\" would not expect ?\n\n> 2) the equivalence between OAs and MOLS\n> \n> to have `are_mutually_orthogonal_squares` add the two extra columns and then simply call `is_orthogonal_array`.  This will have the effect of checking that all the squares are, in fact latin and you will not have to have `are_mutually_orthogonal_squares` do this extra checking.\n\nI would have agreed if the function only returned `True/False` answer. What you are telling me to do is that I should consider all latins squares as k rows of a TD to which I add the two row/column ones, only to differentiate them later in a function that has no reason to contain MOLS-specific code.\n\nThis is why it does not make sense to me to build a homogeneous input only to dissassemble it immediately afterwards.\n\nBesides, I expect that my commented code is sufficient for anybody \"who does design theory\" to understand what exactly happens.\n\n> in my opinion as a design theorist, the behaviour you cite in comment 62 of my code is all correct.  \n\nIt is not. The function is named \"are_mutually_orthogonal_latin_squares\". It should return True if the input consists of mutually orthogonal latin squares.\n\n> In the second example the squares ARE orthogonal, they are just NOT latin.  if you add the additional two columns the behaviour will be reported.\n\nI agree with that, I am just showing that your branch returns wrong results. If this is fixed the results will be correct. This being said, if this is fixed then what you said just above, i.e. that the function should return True even when the input does not consist of latin squares, will not hold anymore. And so according to you the function will return wrong results.\n\nNathann",
    "created_at": "2014-06-05T06:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209028",
    "user": "@nathanncohen"
}
```

Hello !

> I strongly feel that it would be much more consistent with
> 
> 1) what people in design theory will expect the code to do

You claim again that my code does something that somebody (a user ?) "in design theory" might not expect. Can you tell me what it is ? Or is the function okay for the user's point of view, while you think that the way it is coded is "something that people in design theory" would not expect ?

> 2) the equivalence between OAs and MOLS
> 
> to have `are_mutually_orthogonal_squares` add the two extra columns and then simply call `is_orthogonal_array`.  This will have the effect of checking that all the squares are, in fact latin and you will not have to have `are_mutually_orthogonal_squares` do this extra checking.

I would have agreed if the function only returned `True/False` answer. What you are telling me to do is that I should consider all latins squares as k rows of a TD to which I add the two row/column ones, only to differentiate them later in a function that has no reason to contain MOLS-specific code.

This is why it does not make sense to me to build a homogeneous input only to dissassemble it immediately afterwards.

Besides, I expect that my commented code is sufficient for anybody "who does design theory" to understand what exactly happens.

> in my opinion as a design theorist, the behaviour you cite in comment 62 of my code is all correct.  

It is not. The function is named "are_mutually_orthogonal_latin_squares". It should return True if the input consists of mutually orthogonal latin squares.

> In the second example the squares ARE orthogonal, they are just NOT latin.  if you add the additional two columns the behaviour will be reported.

I agree with that, I am just showing that your branch returns wrong results. If this is fixed the results will be correct. This being said, if this is fixed then what you said just above, i.e. that the function should return True even when the input does not consist of latin squares, will not hold anymore. And so according to you the function will return wrong results.

Nathann



---

archive/issue_comments_209029.json:
```json
{
    "body": "Two details that may help you decide :\n\n1) The current behaviour of the are_mutually_orthogonal_latin_squares is to check that the latin squares are latin squares, and so changing that would mean changing the behaviour of the function\n\n\n```\nsage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares\nsage: are_mutually_orthogonal_latin_squares([Matrix([[1,1],[1,0]])])                       \nFalse\n```\n\n\n2) All results returned by the constructors of `mutually_orthogonal_latin_squares` are checked using this function.. If it does not check whether the latin squares are orthogonal then we need to make sure that the output of our constructors are actually latin squares\n\nNathann",
    "created_at": "2014-06-05T07:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209029",
    "user": "@nathanncohen"
}
```

Two details that may help you decide :

1) The current behaviour of the are_mutually_orthogonal_latin_squares is to check that the latin squares are latin squares, and so changing that would mean changing the behaviour of the function


```
sage: from sage.combinat.designs.latin_squares import are_mutually_orthogonal_latin_squares
sage: are_mutually_orthogonal_latin_squares([Matrix([[1,1],[1,0]])])                       
False
```


2) All results returned by the constructors of `mutually_orthogonal_latin_squares` are checked using this function.. If it does not check whether the latin squares are orthogonal then we need to make sure that the output of our constructors are actually latin squares

Nathann



---

archive/issue_comments_209030.json:
```json
{
    "body": "I updated my branch starting from u/ncohen/16295_v2 by adding your commit to it. I removed the \"if\" in `is_orthogonal_array` that only deal with MOLS input as this was already dealt with in `are_mutually_orthogonal_latin_squares`. This mixed version of our codes seems good to me...\n\nNathann",
    "created_at": "2014-06-05T14:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209030",
    "user": "@nathanncohen"
}
```

I updated my branch starting from u/ncohen/16295_v2 by adding your commit to it. I removed the "if" in `is_orthogonal_array` that only deal with MOLS input as this was already dealt with in `are_mutually_orthogonal_latin_squares`. This mixed version of our codes seems good to me...

Nathann



---

archive/issue_comments_209031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-05T14:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209031",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209032.json:
```json
{
    "body": "Brett ?",
    "created_at": "2014-06-09T08:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209032",
    "user": "@nathanncohen"
}
```

Brett ?



---

archive/issue_comments_209033.json:
```json
{
    "body": "Hi Nathann,\n\nWe waited too long for that ticket and many tickets are depending on this one. For me the review is basically done as the function does what is specified.\n\nI added one nice doctest at `u/vdelecroix/16295`... If you like it, set my branch to positive review otherwise set yours to positive review.\n\nVincent",
    "created_at": "2014-06-12T13:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209033",
    "user": "@videlec"
}
```

Hi Nathann,

We waited too long for that ticket and many tickets are depending on this one. For me the review is basically done as the function does what is specified.

I added one nice doctest at `u/vdelecroix/16295`... If you like it, set my branch to positive review otherwise set yours to positive review.

Vincent



---

archive/issue_comments_209034.json:
```json
{
    "body": "AHahahah. Funny doctest. I was actually thinking that \"indeed, this function is used a LOT in the code, but that it is only tested on True instances. With your doctest, it makes it a bit more interesting than\n\n\n```\ndef is_orthogonal_array(*args):\n    return True\n```\n\n\nThanks !\n\nNathann\n----\nNew commits:",
    "created_at": "2014-06-12T13:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209034",
    "user": "@nathanncohen"
}
```

AHahahah. Funny doctest. I was actually thinking that "indeed, this function is used a LOT in the code, but that it is only tested on True instances. With your doctest, it makes it a bit more interesting than


```
def is_orthogonal_array(*args):
    return True
```


Thanks !

Nathann
----
New commits:



---

archive/issue_comments_209035.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-12T13:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209035",
    "user": "@nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_209036.json:
```json
{
    "body": "OK,\n\nI am (mostly) happy.  What do I do to approve this patch?\n\nbrett",
    "created_at": "2014-06-13T09:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209036",
    "user": "@brettpim"
}
```

OK,

I am (mostly) happy.  What do I do to approve this patch?

brett



---

archive/issue_comments_209037.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-14T19:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16058#issuecomment-209037",
    "user": "@vbraun"
}
```

Resolution: fixed
