# Issue 18934: Add a method `divides` to Polynomial

archive/issues_018934.json:
```json
{
    "body": "Keywords: polynomial, division\n\nThe generic method `divides` that can be found in `src/sage/structure/element.pyx` uses `quo_rem` (*via* `%`) to test if an element divides another one: `return (x % self) == 0`. \n\nFor polynomials, depending on the implementations, the method `quo_rem` may raise an error if the divisor is not monic (see #16649 for more on this).\n\nThis ticket aims at implementing a method `divides` for the class `Polynomial`, so that it catches the errors in `quo_rem` to return `False` when it is needed.\n\n**Example of a problematic behavior:**\n\n```python\nsage: R.<x> = PolynomialRing(ZZ, implementation=\"FLINT\")\nsage: p = 2*x + 1\nsage: q = R.random_element(10)\nsage: p.divides(q)\nFalse\nsage: R.<x> = PolynomialRing(ZZ, implementation=\"NTL\")\nsage: p = R(p)\nsage: q = R(q)\nsage: p.divides(q)\nTraceback (most recent call last):\n...\nArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19171\n\n",
    "created_at": "2015-09-09T09:24:04Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Add a method `divides` to Polynomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18934",
    "user": "bruno"
}
```
Keywords: polynomial, division

The generic method `divides` that can be found in `src/sage/structure/element.pyx` uses `quo_rem` (*via* `%`) to test if an element divides another one: `return (x % self) == 0`. 

For polynomials, depending on the implementations, the method `quo_rem` may raise an error if the divisor is not monic (see #16649 for more on this).

This ticket aims at implementing a method `divides` for the class `Polynomial`, so that it catches the errors in `quo_rem` to return `False` when it is needed.

**Example of a problematic behavior:**

```python
sage: R.<x> = PolynomialRing(ZZ, implementation="FLINT")
sage: p = 2*x + 1
sage: q = R.random_element(10)
sage: p.divides(q)
False
sage: R.<x> = PolynomialRing(ZZ, implementation="NTL")
sage: p = R(p)
sage: q = R(q)
sage: p.divides(q)
Traceback (most recent call last):
...
ArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)
```


Issue created by migration from https://trac.sagemath.org/ticket/19171





---

archive/issue_comments_259448.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-09T11:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259448",
    "user": "bruno"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_259449.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-09T11:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259449",
    "user": "bruno"
}
```

New commits:



---

archive/issue_comments_259450.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-22T16:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259450",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_259451.json:
```json
{
    "body": "Changing component from basic arithmetic to commutative algebra.",
    "created_at": "2016-05-22T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259451",
    "user": "bruno"
}
```

Changing component from basic arithmetic to commutative algebra.



---

archive/issue_comments_259452.json:
```json
{
    "body": "Changing type from enhancement to defect.",
    "created_at": "2016-05-22T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259452",
    "user": "bruno"
}
```

Changing type from enhancement to defect.



---

archive/issue_comments_259453.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-23T09:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259453",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_259454.json:
```json
{
    "body": "I added some noise with two forced pushes (due to some mistake I made), but there is really only one commit! Now the ticket passes the tests (as far as I can tell) and is very ready for review!",
    "created_at": "2016-05-23T09:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259454",
    "user": "bruno"
}
```

I added some noise with two forced pushes (due to some mistake I made), but there is really only one commit! Now the ticket passes the tests (as far as I can tell) and is very ready for review!



---

archive/issue_comments_259455.json:
```json
{
    "body": "You would better use `coerce_binop` from `sage.structure.element` rather than a manually handled coercion.\n\nWhy is this code specific to polynomials?",
    "created_at": "2016-07-11T18:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259455",
    "user": "vdelecroix"
}
```

You would better use `coerce_binop` from `sage.structure.element` rather than a manually handled coercion.

Why is this code specific to polynomials?



---

archive/issue_comments_259456.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-11T18:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259456",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_259457.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-07-18T13:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259457",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_259458.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-18T16:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259458",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259459.json:
```json
{
    "body": "Replying to [comment:9 vdelecroix]:\n> You would better use `coerce_binop` from `sage.structure.element` rather than a manually handled coercion.\n\nDone.\n\n> Why is this code specific to polynomials?\n\nI tried to explain the reasons in the description: For polynomials over (say) `ZZ`, the euclidean division is not well defined. The problem occurs when the leading coefficient is not invertible. There are several ways to deal with this problem, and different implementations in Sage use different conventions (see #16649 for pointers on this). As a result, testing divisibility by invoking `self % p == 0` can lead to `ArithmeticError` for polynomials: But when this exception is raised, we know that `self` does not divide `p`.\u00b9 That's why I decided to add this new method which only differs from the generic one by the fact it catches the exception. \n\nI could have changed the generic method instead to catch an `ArithmeticError` and return `False` in such case, but though I am pretty confident that it makes sense for polynomials, I am much less confident concerning other rings.\n\n\u00b9 \"We know\" is maybe a too strong assumption. In #16649, I did changes that ensure that the assumption holds for all *current implementations* of polynomials in Sage. (This was not the case before.) Yet, future implementations may break this rule. This may imply that we shouldn't simply rely on `quo_rem` to test divisibility.",
    "created_at": "2016-07-18T16:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259459",
    "user": "bruno"
}
```

Replying to [comment:9 vdelecroix]:
> You would better use `coerce_binop` from `sage.structure.element` rather than a manually handled coercion.

Done.

> Why is this code specific to polynomials?

I tried to explain the reasons in the description: For polynomials over (say) `ZZ`, the euclidean division is not well defined. The problem occurs when the leading coefficient is not invertible. There are several ways to deal with this problem, and different implementations in Sage use different conventions (see #16649 for pointers on this). As a result, testing divisibility by invoking `self % p == 0` can lead to `ArithmeticError` for polynomials: But when this exception is raised, we know that `self` does not divide `p`.¹ That's why I decided to add this new method which only differs from the generic one by the fact it catches the exception. 

I could have changed the generic method instead to catch an `ArithmeticError` and return `False` in such case, but though I am pretty confident that it makes sense for polynomials, I am much less confident concerning other rings.

¹ "We know" is maybe a too strong assumption. In #16649, I did changes that ensure that the assumption holds for all *current implementations* of polynomials in Sage. (This was not the case before.) Yet, future implementations may break this rule. This may imply that we shouldn't simply rely on `quo_rem` to test divisibility.



---

archive/issue_comments_259460.json:
```json
{
    "body": "Since one is always a unit the `if self.is_one(): return True` would better be inside the block `except NotImplementedError:`.\n\nPlease add a more exotic example like `GF(4)['x']['y']`.",
    "created_at": "2016-07-25T01:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259460",
    "user": "vdelecroix"
}
```

Since one is always a unit the `if self.is_one(): return True` would better be inside the block `except NotImplementedError:`.

Please add a more exotic example like `GF(4)['x']['y']`.



---

archive/issue_comments_259461.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-25T01:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259461",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_259462.json:
```json
{
    "body": "And why not using `quo_rem` instead of catching a potential `ArithmeticError`?",
    "created_at": "2016-07-25T01:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259462",
    "user": "vdelecroix"
}
```

And why not using `quo_rem` instead of catching a potential `ArithmeticError`?



---

archive/issue_comments_259463.json:
```json
{
    "body": "I am not sure I fully understand your latest comments:  \n\n> Since one is always a unit the `if self.is_one(): return True` would better be inside the block `except NotImplementedError:`.\n\nDo you mean adding a `try: ... except NotImplementedError:` construction? Because if I add this test say right below the test `if self.is_unit(): return True`, an exception will be raised in the cases where `is_unit` is not implemented but `is_one` is.\n\n\n\n> And why not using `quo_rem` instead of catching a potential `ArithmeticError`?\n\nUsing `p % self` is really the same as ` p.quo_rem(self)[1] ` so I do not see the difference.",
    "created_at": "2016-07-26T07:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259463",
    "user": "bruno"
}
```

I am not sure I fully understand your latest comments:  

> Since one is always a unit the `if self.is_one(): return True` would better be inside the block `except NotImplementedError:`.

Do you mean adding a `try: ... except NotImplementedError:` construction? Because if I add this test say right below the test `if self.is_unit(): return True`, an exception will be raised in the cases where `is_unit` is not implemented but `is_one` is.



> And why not using `quo_rem` instead of catching a potential `ArithmeticError`?

Using `p % self` is really the same as ` p.quo_rem(self)[1] ` so I do not see the difference.



---

archive/issue_comments_259464.json:
```json
{
    "body": "Replying to [comment:15 bruno]:\n> I am not sure I fully understand your latest comments:  \n> \n> > Since one is always a unit the `if self.is_one(): return True` would better be inside the block `except NotImplementedError:`.\n> \n> Do you mean adding a `try: ... except NotImplementedError:` construction? Because if I add this test say right below the test `if self.is_unit(): return True`, an exception will be raised in the cases where `is_unit` is not implemented but `is_one` is.\n\nI meant\n\n```\ntry:\n    if self.is_unit(): return True   # units divide everything\nexcept NotImplementedError:\n    if self.is_one(): return True    # if is_unit is not implemented\n```\n\n\n> \n> > And why not using `quo_rem` instead of catching a potential `ArithmeticError`?\n> \n> Using `p % self` is really the same as ` p.quo_rem(self)[1] ` so I do not see the difference.\n\nNot exactly. NTL makes a distinction... and you should actually use `pseudo_quo_rem` when it is there:\n\n```\nsage: R.<x> = PolynomialRing(ZZ, implementation=\"NTL\")\nsage: p = 2*x + 1\nsage: q = R.random_element(10)\nsage: p.quo_rem(q)\nTraceback (most recent call last):\n...\nArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)\nsage: p.pseudo_quo_rem(q)\n(0, 2*x + 1)\n```\n",
    "created_at": "2016-07-26T16:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259464",
    "user": "vdelecroix"
}
```

Replying to [comment:15 bruno]:
> I am not sure I fully understand your latest comments:  
> 
> > Since one is always a unit the `if self.is_one(): return True` would better be inside the block `except NotImplementedError:`.
> 
> Do you mean adding a `try: ... except NotImplementedError:` construction? Because if I add this test say right below the test `if self.is_unit(): return True`, an exception will be raised in the cases where `is_unit` is not implemented but `is_one` is.

I meant

```
try:
    if self.is_unit(): return True   # units divide everything
except NotImplementedError:
    if self.is_one(): return True    # if is_unit is not implemented
```


> 
> > And why not using `quo_rem` instead of catching a potential `ArithmeticError`?
> 
> Using `p % self` is really the same as ` p.quo_rem(self)[1] ` so I do not see the difference.

Not exactly. NTL makes a distinction... and you should actually use `pseudo_quo_rem` when it is there:

```
sage: R.<x> = PolynomialRing(ZZ, implementation="NTL")
sage: p = 2*x + 1
sage: q = R.random_element(10)
sage: p.quo_rem(q)
Traceback (most recent call last):
...
ArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)
sage: p.pseudo_quo_rem(q)
(0, 2*x + 1)
```




---

archive/issue_comments_259465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-27T09:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259465",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259466.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-27T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259466",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259467.json:
```json
{
    "body": "Replying to [comment:16 vdelecroix]:\n> `...`\n\n> I meant\n\n> `...`\nDone.\n\n> > \n> > > And why not using `quo_rem` instead of catching a potential `ArithmeticError`?\n> > \n> > Using `p % self` is really the same as ` p.quo_rem(self)[1] ` so I do not see the difference.\n> \n> Not exactly. NTL makes a distinction... and you should actually use `pseudo_quo_rem` when it is there:\n> {{{\n> sage: R.<x> = PolynomialRing(ZZ, implementation=\"NTL\")\n> sage: p = 2*x + 1\n> sage: q = R.random_element(10)\n> sage: p.quo_rem(q)\n> Traceback (most recent call last):\n> ...\n> ArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)\n> sage: p.pseudo_quo_rem(q)\n> (0, 2*x + 1)\n> }}}\nNot done: I do not think `pseudo_quo_rem` is applicable, because of the following:\n\n```python\nsage: R.<x> = ZZ[] # works the same with NTL\nsage: p = x^2 - 1\nsage: q = 2*x + 2\nsage: p.pseudo_quo_rem(q)\n(2*x - 2, 0)\n```\n\nSo, the remainder in `p.pseudo_quo_rem(q)` can be zero even if `q` does not divide `p`.\n\n\nP.S.: I won't be able to work on this ticket until mid-august.",
    "created_at": "2016-07-27T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259467",
    "user": "bruno"
}
```

Replying to [comment:16 vdelecroix]:
> `...`

> I meant

> `...`
Done.

> > 
> > > And why not using `quo_rem` instead of catching a potential `ArithmeticError`?
> > 
> > Using `p % self` is really the same as ` p.quo_rem(self)[1] ` so I do not see the difference.
> 
> Not exactly. NTL makes a distinction... and you should actually use `pseudo_quo_rem` when it is there:
> {{{
> sage: R.<x> = PolynomialRing(ZZ, implementation="NTL")
> sage: p = 2*x + 1
> sage: q = R.random_element(10)
> sage: p.quo_rem(q)
> Traceback (most recent call last):
> ...
> ArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)
> sage: p.pseudo_quo_rem(q)
> (0, 2*x + 1)
> }}}
Not done: I do not think `pseudo_quo_rem` is applicable, because of the following:

```python
sage: R.<x> = ZZ[] # works the same with NTL
sage: p = x^2 - 1
sage: q = 2*x + 2
sage: p.pseudo_quo_rem(q)
(2*x - 2, 0)
```

So, the remainder in `p.pseudo_quo_rem(q)` can be zero even if `q` does not divide `p`.


P.S.: I won't be able to work on this ticket until mid-august.



---

archive/issue_comments_259468.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-16T04:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259468",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_259469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-19T14:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259469",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259470.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-19T14:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259470",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259471.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-21T02:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259471",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_259472.json:
```json
{
    "body": "Needs rebasing.",
    "created_at": "2017-05-21T02:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259472",
    "user": "tscrim"
}
```

Needs rebasing.



---

archive/issue_comments_259473.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-25T13:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259473",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259474.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-25T13:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259474",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259475.json:
```json
{
    "body": "Hi,\n\nThis looks reasonable to me; I would be willing to set the ticket to positive review. Vincent, do you agree?",
    "created_at": "2017-07-27T11:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259475",
    "user": "mmezzarobba"
}
```

Hi,

This looks reasonable to me; I would be willing to set the ticket to positive review. Vincent, do you agree?



---

archive/issue_comments_259476.json:
```json
{
    "body": "why `return (p % self) == 0` instead of `return (p % self).is_zero()`?",
    "created_at": "2017-07-27T13:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259476",
    "user": "vdelecroix"
}
```

why `return (p % self) == 0` instead of `return (p % self).is_zero()`?



---

archive/issue_comments_259477.json:
```json
{
    "body": "How can you be sure that the following\n\n```\n        except ArithmeticError:\n            return False                     # if division is not exact\n```\n\nonly catches non exact divisions?",
    "created_at": "2017-07-27T13:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259477",
    "user": "vdelecroix"
}
```

How can you be sure that the following

```
        except ArithmeticError:
            return False                     # if division is not exact
```

only catches non exact divisions?



---

archive/issue_comments_259478.json:
```json
{
    "body": "Could you add check on more exotic rings like `Zmod(6)['x']`, `ZZ['x']['y']`, `GF(2)['x,y']['z']`?",
    "created_at": "2017-07-27T13:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259478",
    "user": "vdelecroix"
}
```

Could you add check on more exotic rings like `Zmod(6)['x']`, `ZZ['x']['y']`, `GF(2)['x,y']['z']`?



---

archive/issue_comments_259479.json:
```json
{
    "body": "Replying to [comment:27 vdelecroix]:\n> How can you be sure that the following\n> {{{\n>         except ArithmeticError:\n>             return False                     # if division is not exact\n> }}}\n> only catches non exact divisions?\n\nBTW, each except will cost a non trivial amount of time. Isn't there a fastest way to see if the division is exact? (eg calling `quo_rem`)",
    "created_at": "2017-07-27T13:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259479",
    "user": "vdelecroix"
}
```

Replying to [comment:27 vdelecroix]:
> How can you be sure that the following
> {{{
>         except ArithmeticError:
>             return False                     # if division is not exact
> }}}
> only catches non exact divisions?

BTW, each except will cost a non trivial amount of time. Isn't there a fastest way to see if the division is exact? (eg calling `quo_rem`)



---

archive/issue_comments_259480.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-07-27T13:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259480",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_259481.json:
```json
{
    "body": "FWIW, I agree that using `is_zero()` would be better, but I don't think it matters enough for blocking the ticket.\nConsidering that an `ArithmeticError` implies that there is no divisibility looks very reasonable to me, though testing divisibility of the leading coefficients would likely be faster.",
    "created_at": "2017-07-27T13:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259481",
    "user": "mmezzarobba"
}
```

FWIW, I agree that using `is_zero()` would be better, but I don't think it matters enough for blocking the ticket.
Considering that an `ArithmeticError` implies that there is no divisibility looks very reasonable to me, though testing divisibility of the leading coefficients would likely be faster.



---

archive/issue_comments_259482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-23T15:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259482",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259483.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-11-23T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259483",
    "user": "bruno"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_259484.json:
```json
{
    "body": "I've pushed my branch but some doctest fails. Actually I need some advice.\n\n* The `try... except ArithmeticError` is needed for `PolynomialRing(ZZ, 'x', implementation = 'NTL')` since in this implementation `quo_rem` raises an exception for non-divisible polynomials, even when the leading coefficients divide each other. See [ticket:16649] for details.\n\n* Contrary to what my (broken) commit message might indicate, I did not add a leading coefficient test that would fasten the computation. The problem comes from the `Zmod(6)['x']` example: In `Zmod(6)`, computing the remainder raise exceptions. (Test for instance `Zmod(6)(1) % Zmod(6)(4)`.)\n\n* As mentioned before, there is still a failing doctest, also due to `Zmod(6)['x']`. We face the same kind problem as before with the 'NTL' implementation of Z[x]: Computing `quo_rem` in `Zmod(6)['x']` is only possible if the leading coefficient of the divisor is a unit (an exception is raised otherwise). The exception is not caught since contrary to the case of `ZZ['x']`, the raised exception is a `ValueError`.\n\nI am not sure to see what the best solutions are to make it work. Some possibilities:\n\n* We make this ticket depend on another one that unifies all the `quo_rem` implementations for polynomials over non-field, so that we can base this function on the common behavior of these methods.\u00b9\n* We make this ticket depend on another one with more limited goals, such as unifying the errors to `ArithmeticError`.\n* We add some specific code, to catch the `ValueError`.\n\nWhat do you think? \n\nThe first solution seem to me unreachable given the endless discussions about the behavior of `quo_rem` (links in [ticket:16649]). The second one is maybe more doable. The third one is probably the faster to close this ticket but I am not sure whether there is a good way to implement it.\n\n\u00b9 More generally, there should exist a ticket for unifying the diverse behaviors of polynomial rings, but 1. it is clearly off-topic this ticket and 2. given the difficulty with unifying \"content\" in another ticket, I am not at all ready to go for this!",
    "created_at": "2017-11-23T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259484",
    "user": "bruno"
}
```

I've pushed my branch but some doctest fails. Actually I need some advice.

* The `try... except ArithmeticError` is needed for `PolynomialRing(ZZ, 'x', implementation = 'NTL')` since in this implementation `quo_rem` raises an exception for non-divisible polynomials, even when the leading coefficients divide each other. See [ticket:16649] for details.

* Contrary to what my (broken) commit message might indicate, I did not add a leading coefficient test that would fasten the computation. The problem comes from the `Zmod(6)['x']` example: In `Zmod(6)`, computing the remainder raise exceptions. (Test for instance `Zmod(6)(1) % Zmod(6)(4)`.)

* As mentioned before, there is still a failing doctest, also due to `Zmod(6)['x']`. We face the same kind problem as before with the 'NTL' implementation of Z[x]: Computing `quo_rem` in `Zmod(6)['x']` is only possible if the leading coefficient of the divisor is a unit (an exception is raised otherwise). The exception is not caught since contrary to the case of `ZZ['x']`, the raised exception is a `ValueError`.

I am not sure to see what the best solutions are to make it work. Some possibilities:

* We make this ticket depend on another one that unifies all the `quo_rem` implementations for polynomials over non-field, so that we can base this function on the common behavior of these methods.¹
* We make this ticket depend on another one with more limited goals, such as unifying the errors to `ArithmeticError`.
* We add some specific code, to catch the `ValueError`.

What do you think? 

The first solution seem to me unreachable given the endless discussions about the behavior of `quo_rem` (links in [ticket:16649]). The second one is maybe more doable. The third one is probably the faster to close this ticket but I am not sure whether there is a good way to implement it.

¹ More generally, there should exist a ticket for unifying the diverse behaviors of polynomial rings, but 1. it is clearly off-topic this ticket and 2. given the difficulty with unifying "content" in another ticket, I am not at all ready to go for this!



---

archive/issue_comments_259485.json:
```json
{
    "body": "An `ArithmeticError` in `%` does not imply not divisible as shown with\n\n```\nsage: R.<x> = Zmod(6)[]\nsage: S.<z> = R[]\nsage: p = x*z + 1\nsage: q = z + 1\nsage: (p*q) % p\nTraceback (most recent call last):\n...\nArithmeticError: Division non exact (consider coercing to polynomials over the fraction field)\n```\n\nThe reason being that\n\n```\nsage: Z6 = Zmod(6)\nsage: a = Z6(4)\nsage: b = Z6(2)\nsage: b.divides(a)\nTrue\nsage: a / b\nTraceback (most recent call last):\n...\nZeroDivisionError: Inverse does not exist.\n```\n\nFrom there three possibilities:\n- \"fix\" divisions in integer mod ring `Zmod` so that `a / b` above does work. Though in\n  this situation there are several possible answers as `4 = 2 x 5 = 2 x 2 mod 6`.\n- restrict `divides` on polynomial whose base rings are integral domains (so that division\n  is well defined: quotient is unique when it exists).",
    "created_at": "2018-05-01T15:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259485",
    "user": "vdelecroix"
}
```

An `ArithmeticError` in `%` does not imply not divisible as shown with

```
sage: R.<x> = Zmod(6)[]
sage: S.<z> = R[]
sage: p = x*z + 1
sage: q = z + 1
sage: (p*q) % p
Traceback (most recent call last):
...
ArithmeticError: Division non exact (consider coercing to polynomials over the fraction field)
```

The reason being that

```
sage: Z6 = Zmod(6)
sage: a = Z6(4)
sage: b = Z6(2)
sage: b.divides(a)
True
sage: a / b
Traceback (most recent call last):
...
ZeroDivisionError: Inverse does not exist.
```

From there three possibilities:
- "fix" divisions in integer mod ring `Zmod` so that `a / b` above does work. Though in
  this situation there are several possible answers as `4 = 2 x 5 = 2 x 2 mod 6`.
- restrict `divides` on polynomial whose base rings are integral domains (so that division
  is well defined: quotient is unique when it exists).



---

archive/issue_comments_259486.json:
```json
{
    "body": "A fix is provided in #25277 for Zmod ring.",
    "created_at": "2018-05-12T19:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259486",
    "user": "vdelecroix"
}
```

A fix is provided in #25277 for Zmod ring.



---

archive/issue_comments_259487.json:
```json
{
    "body": "The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. \n\nIf we decide this, the problem with `PolynomialRing(ZZ, 'x', implementation=\"NTL\")` remains since `quo_rem` cannot be used there without catching an exception, which is not very appealing... Should we convert first the polynomial to polynomials over the fraction field of the base ring?",
    "created_at": "2018-06-12T16:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259487",
    "user": "bruno"
}
```

The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. 

If we decide this, the problem with `PolynomialRing(ZZ, 'x', implementation="NTL")` remains since `quo_rem` cannot be used there without catching an exception, which is not very appealing... Should we convert first the polynomial to polynomials over the fraction field of the base ring?



---

archive/issue_comments_259488.json:
```json
{
    "body": "Replying to [comment:37 bruno]:\n> The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. \n\nThere is #25277 for that (it is merged in beta3 already). So you can test for division... but you can not divide yet.\n\n> If we decide this, the problem with `PolynomialRing(ZZ, 'x', implementation=\"NTL\")` remains since `quo_rem` cannot be used there without catching an exception, which is not very appealing... Should we convert first the polynomial to polynomials over the fraction field of the base ring?\n\nIt is fine to catch an exception, but it should be clear what it means.",
    "created_at": "2018-06-16T17:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259488",
    "user": "vdelecroix"
}
```

Replying to [comment:37 bruno]:
> The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. 

There is #25277 for that (it is merged in beta3 already). So you can test for division... but you can not divide yet.

> If we decide this, the problem with `PolynomialRing(ZZ, 'x', implementation="NTL")` remains since `quo_rem` cannot be used there without catching an exception, which is not very appealing... Should we convert first the polynomial to polynomials over the fraction field of the base ring?

It is fine to catch an exception, but it should be clear what it means.



---

archive/issue_comments_259489.json:
```json
{
    "body": "Replying to [comment:38 vdelecroix]:\n> Replying to [comment:37 bruno]:\n> > The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. \n> \n> There is #25277 for that (it is merged in beta3 already). So you can test for division... but you can not divide yet.\n\nI meant testing divisibility of polynomials over `Zmod(6)`. I am not sure that it can be reduced to simply testing divisibility of elements of `Zmod(6)`, I think you need to perform some divisions.",
    "created_at": "2018-06-18T14:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259489",
    "user": "bruno"
}
```

Replying to [comment:38 vdelecroix]:
> Replying to [comment:37 bruno]:
> > The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. 
> 
> There is #25277 for that (it is merged in beta3 already). So you can test for division... but you can not divide yet.

I meant testing divisibility of polynomials over `Zmod(6)`. I am not sure that it can be reduced to simply testing divisibility of elements of `Zmod(6)`, I think you need to perform some divisions.



---

archive/issue_comments_259490.json:
```json
{
    "body": "Replying to [comment:39 bruno]:\n> Replying to [comment:38 vdelecroix]:\n> > Replying to [comment:37 bruno]:\n> > > The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. \n> > \n> > There is #25277 for that (it is merged in beta3 already). So you can test for division... but you can not divide yet.\n> \n> I meant testing divisibility of polynomials over `Zmod(6)`. I am not sure that it can be reduced to simply testing divisibility of elements of `Zmod(6)`, I think you need to perform some divisions.\n\nA far from efficient method consist in\n\n1. testing divisibility of leading coefficients `b_m | a_n`\n2. if yes, test all possible quotients `q` so that `a_n = q b_m`\n\nBut for that, you need a method that return all quotients. Hence my remark.",
    "created_at": "2018-06-18T20:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259490",
    "user": "vdelecroix"
}
```

Replying to [comment:39 bruno]:
> Replying to [comment:38 vdelecroix]:
> > Replying to [comment:37 bruno]:
> > > The difficulties with rings such as `Zmod(6)` let me think that we should indeed restrict to polynomials over integral domains. The problem being that I actually do not know for instance how to test divisibility over `Zmod(6)`. 
> > 
> > There is #25277 for that (it is merged in beta3 already). So you can test for division... but you can not divide yet.
> 
> I meant testing divisibility of polynomials over `Zmod(6)`. I am not sure that it can be reduced to simply testing divisibility of elements of `Zmod(6)`, I think you need to perform some divisions.

A far from efficient method consist in

1. testing divisibility of leading coefficients `b_m | a_n`
2. if yes, test all possible quotients `q` so that `a_n = q b_m`

But for that, you need a method that return all quotients. Hence my remark.



---

archive/issue_comments_259491.json:
```json
{
    "body": "So do you agree with me that we should better abandon non-integral rings (at least for now)?",
    "created_at": "2018-06-19T13:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259491",
    "user": "bruno"
}
```

So do you agree with me that we should better abandon non-integral rings (at least for now)?



---

archive/issue_comments_259492.json:
```json
{
    "body": "Replying to [comment:41 bruno]:\n> So do you agree with me that we should better abandon non-integral rings (at least for now)?\n\nyes",
    "created_at": "2018-06-19T14:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259492",
    "user": "vdelecroix"
}
```

Replying to [comment:41 bruno]:
> So do you agree with me that we should better abandon non-integral rings (at least for now)?

yes



---

archive/issue_comments_259493.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259493",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259494",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259495.json:
```json
{
    "body": "Is the proposed solution ok for you?",
    "created_at": "2018-06-19T15:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259495",
    "user": "bruno"
}
```

Is the proposed solution ok for you?



---

archive/issue_comments_259496.json:
```json
{
    "body": "You are not doing the right thing on non-integral domains. You should test `is_integral_domain` much earlier. With the ticket applied\n\n```\nsage: R.<x> = Zmod(6)[]\nsage: (2*x +1).divides(3)\nFalse\nsage: (2*x + 1) * 3 == 3\nTrue\n```\n\n(testing divisibility of leading coefficient is not even valid... I was wrong)\n\nYou need a line break after `TESTS::`\n\nIt should be documented that this method only works for integral domains. And the examples with Zmod(6) (raising error) should be in the `EXAMPLES` block rather than `TESTS`.",
    "created_at": "2018-06-19T21:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259496",
    "user": "vdelecroix"
}
```

You are not doing the right thing on non-integral domains. You should test `is_integral_domain` much earlier. With the ticket applied

```
sage: R.<x> = Zmod(6)[]
sage: (2*x +1).divides(3)
False
sage: (2*x + 1) * 3 == 3
True
```

(testing divisibility of leading coefficient is not even valid... I was wrong)

You need a line break after `TESTS::`

It should be documented that this method only works for integral domains. And the examples with Zmod(6) (raising error) should be in the `EXAMPLES` block rather than `TESTS`.



---

archive/issue_comments_259497.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-04T14:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259497",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259498.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-04T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259498",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259499.json:
```json
{
    "body": "I've followed your advice, and changed my mind: My idea was to give an answer (for non-integral domains) as long as I am able to do so. The problem with the divisibility of leading coefficients made me adopt the opposite viewpoint: Divisibility is not implemented for non-integral domains, that's it. I am not sure that an implementation which only works in some uninteresting cases would be helpful to anyone!",
    "created_at": "2018-07-04T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259499",
    "user": "bruno"
}
```

I've followed your advice, and changed my mind: My idea was to give an answer (for non-integral domains) as long as I am able to do so. The problem with the divisibility of leading coefficients made me adopt the opposite viewpoint: Divisibility is not implemented for non-integral domains, that's it. I am not sure that an implementation which only works in some uninteresting cases would be helpful to anyone!



---

archive/issue_comments_259500.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259500",
    "user": "vdelecroix"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_comments_259501.json:
```json
{
    "body": "ok",
    "created_at": "2018-08-23T03:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259501",
    "user": "vdelecroix"
}
```

ok



---

archive/issue_comments_259502.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-23T03:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259502",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_259503.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-26T09:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18934#issuecomment-259503",
    "user": "vbraun"
}
```

Resolution: fixed
