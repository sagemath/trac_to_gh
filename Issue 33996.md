# Issue 33996: Missing scientific labels

Issue created by migration from https://trac.sagemath.org/ticket/34233

Original creator: kcrisman

Original creation time: 2022-07-28 13:52:41

CC:  @niranjankm

See [this sage-devel discussion](https://groups.google.com/g/sage-devel/c/s39WysaG0fI) for the problem.  Compare

```
sage:  plot(x^2,(x,0,5000))  # missing display of 1e7 above y-axis
sage:  plot(x^2,(x,50,5000))  # missing display of 1e7 above y-axis
sage:  plot(x^2,(x,100,5000))  # display of 1e7 above y-axis is visible
```


gh-niranjankm has identified the problem as the use of `SelectiveFormatter`, in particular `skip_values=[0]`

Related:
* 30983
* #7964


---

Comment by @niranjankm created at 2022-08-07 13:32:26

See:
https://stackoverflow.com/a/73371333/18152652


---

Comment by @niranjankm created at 2022-08-07 17:17:02

The fix is as follows:

**STEP 1:** Add following function to sage.plot.plot.py


```python
def CustomScalarFormatter(replace_values=([],[])):
    """
    This matplotlib formatter selectively replaces the given tick labels.
    Takes a tuple or list of two lists as argument. First list labels will be replaced by second list labels.
    Note that the first label entries are cumpulsorily int or float values. No strings.
    No such restrictions for the second list. Because they will be anyway converted to strings in the end.

    EXAMPLES:

    ::

        sage: from sage.plot.plot import CustomScalarFormatter
        sage: import matplotlib.pyplot as plt
        sage: import numpy as np
        sage: z = np.linspace(0, 5000, 100)
        sage: fig, ax = plt.subplots()
        sage: xmajorformatter = CustomScalarFormatter(replace_values=([2000,0],['$x_0$','']))
        sage: ymajorformatter = CustomScalarFormatter(replace_values=([1E7,0],['$y_0$','']))
        sage: ax.xaxis.set_major_formatter(xmajorformatter)
        sage: ax.yaxis.set_major_formatter(ymajorformatter)
        sage: ax.plot(z,z**2)
        sage: plt.show()
        
    ::
    
        sage: from sage.plot.plot import CustomScalarFormatter
        sage: from matplotlib import font_manager
        sage: plot(x^2, (x,100,5000), tick_formatter = [ CustomScalarFormatter(replace_values=[[2000,0],['$x_0$','']]), CustomScalarFormatter(replace_values=[[1E7,0],['$y_0$','']]) ])

    """

    from matplotlib.ticker import ScalarFormatter

    class _CustomScalarFormatter(ScalarFormatter):
        def __init__(self, useOffset=None, useMathText=None, useLocale=None, replace_values=([],[])):
            super().__init__(useOffset=None, useMathText=None, useLocale=None)
            self.replace_values = replace_values

        def __call__(self, x, pos=None):
            """
            Return the format for tick value *x* at position *pos*.
            """
            if len(self.locs) == 0:
                return ''
            #elif x == 0:
            #    return ''
            elif x in self.replace_values[0]:
                idx = self.replace_values[0].index(x)
                return str(self.replace_values[1][idx])
            else:
                xp = (x - self.offset) / (10. ** self.orderOfMagnitude)
                if abs(xp) < 1e-8:
                    xp = 0
                return self._format_maybe_minus_and_locale(self.format, xp)

    return _CustomScalarFormatter(replace_values=replace_values)
```


I have verified the examples in docstring but check once the formatting.

**STEP 2:** Replace following lines in sage.plot.graphics.py


```python
                from sage.plot.plot import SelectiveFormatter
                subplot.yaxis.set_major_formatter(SelectiveFormatter(
                    subplot.yaxis.get_major_formatter(), skip_values=[0]))
                subplot.xaxis.set_major_formatter(SelectiveFormatter(
                    subplot.xaxis.get_major_formatter(), skip_values=[0]))
```


by



```python
                from sage.plot.plot import CustomScalarFormatter
                subplot.yaxis.set_major_formatter(CustomScalarFormatter(replace_values=([0],[''])))
                subplot.xaxis.set_major_formatter(CustomScalarFormatter(replace_values=([0],[''])))
```



**STEP 3: (Optional)** To have nice display of scientific label as x10<sup>7</sup> instead of 1e7 (say for example) by default add following line in sage.plot.graphics.py


```python
        rcParams['axes.formatter.use_mathtext'] = True
```


just after


```python
        from matplotlib import rcParams
```


in function


```python
    def matplotlib(self, filename=None,
```


Very sorry, now I am far from setting up and working with sage git due to my upcoming exams and also since i am new to git and i have to explore and learn some more about git. Please somebody take up this task of getting these into sage.


---

Comment by egourgoulhon created at 2022-09-21 11:07:45

FWIW, a new report for this bug:
https://groups.google.com/g/sage-support/c/zH_4KsKCscQ
