# Issue 16009: Add functions calculating all spanning trees, all bridges in a graph

Issue created by migration from Trac.

Original creator: jdickinson

Original creation time: 2014-04-26 21:48:37

CC:  lipshitz ncohen

Keywords: bridge, spanning tree

This patch adds 

1) a function that finds all spanning trees in a graph. 
(adapted from "Bounds on Backtrack Algorithms for Listing Cycles, Paths, and Spanning Trees" R. C. Read and R. E. Tarjan, 1975)

2) a function that finds all bridges in a graph recursively, that is used in calculating the spanning trees
(adapted from the solution to 4.1.36 in Sedgewick's _Algorithms_ 4th ed.)

For example:

sage: G = Graph([(1,2),(1,2),(1,3),(1,3),(2,3),(1,4)])
sage: G.spanning_trees()
[Graph on 4 vertices,
 Graph on 4 vertices,
 Graph on 4 vertices,
 Graph on 4 vertices,
 Graph on 4 vertices,
 Graph on 4 vertices,
 Graph on 4 vertices,
 Graph on 4 vertices]
sage: len(G.spanning_trees()) == G.spanning_trees_count()
True
sage: G.bridges()
[(1, 4, None)]

These functions will assist in the calculation of the Jones polynomial of a knot.


---

Comment by jdickinson created at 2014-04-26 21:48:58

Changing priority from major to minor.


---

Comment by ncohen created at 2014-04-27 07:21:50

(cc me)


---

Comment by jdickinson created at 2014-05-05 13:24:16

Changing status from new to needs_review.


---

Comment by jdickinson created at 2014-05-05 13:24:16

New commits:


---

Comment by ncohen created at 2014-05-05 13:57:40

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2014-05-05 13:57:40

Hello !

1) Please work on the documentation of your function. You can compare it to the other graph functions and see that they are not quite up to the standard.

2) Please define your auxiliary functions INSIDE of the functions you define, and not inside of the !Graph/DiGraph class

3) The file generic_graph.py applies to both graphs and digraphs. Is your code meant to handle digraphs ?

4) I can write `bridges` with the following 5 lines


```
def bridges(g):
    r"""
    EXAMPLES:: 
        sage: g = 2*graphs.PetersenGraph()
        sage: g.add_edge(1,10)
        sage: g.is_connected()
        True
        sage: bridges(g)
        [(1, 10, None)]
    """
    gs = g.strong_orientation()
    bridges = []
    for scc in gs.strongly_connected_components():
        bridges.extend(gs.edge_boundary(scc))
    return bridges
```


please provide comparisons of speed with your implementation.

5) Please think hard of what the following line from your code does

```
[x for x in self.edges() if x not in self.bridges()])
```


Nathann


---

Comment by ncohen created at 2014-05-05 14:29:34

(just updated the code above, there was an useless waste of time)


---

Comment by git created at 2014-05-09 23:45:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdickinson created at 2014-05-09 23:48:36

Hello! Thanks for the feedback.  We have been working on addressing your suggestions

1) Improved documentation coming soon

2) Auxiliary functions have been moved inside the functions we define

3) Our code isn't meant to handle digraphs – have moved everything from generic_graph.py to graph.py

4) Have replaced our bridges code with yours – it runs faster and avoids the problem of hitting a max recursion depth

5) Updated spanning_trees no longer includes this line 

Jennet


---

Comment by ncohen created at 2014-05-12 08:50:46

Right ! Please set the ticket's status back to `needs_review` once it is ready again !

Nathann
----
New commits:


---

Comment by ncohen created at 2014-05-12 13:03:02

Hellooooooooooo again !

I spent some time over your code, and did some modifications to it. They all appear in u/ncohen/16246 for you to look at them.

Some remarks which are fixed there :

1) We try to keep the first line of a function's doc short. Less than a line describing the behaviour, and nothing else. Then you can be as verbose as you want.

2) This :

`len(G.edges()) == len(part_G.edges())`

Builds the list of edges just to compute its length. Use `G.size()`.

3) This

```
-                X = G.edges()
-                for y in part_G.edges():
-                    X.remove(y)
```

results in `part_G.size()` linear searches in a list X. When you want to test if a pair of things belongs to a set of pairs of things, the data structure you need is a graph. Besides, you only need ONE element of X, so don't compute them all.

4) Call to `.bridges` in the recursive function : I don't think this is very effective. Computing all bridges is costly, and if you apply your function to a complete graph it will always be useless. Besides, the first thing you do in a recursive call (right after you removed an edge) is to test whether the graph is connected. Sooo you could use this to detect bridges instead, and wouldn't lose much.

5) Function `_edges_to_remove` : when the call to `bridges` is removed, you only add edges one by one. And when you only add one edge to `part_G` it is easier to detect which edges should be removed. Thus this function can be removed

6) A "SEEALSO" section in the doc is cool. Tells you what you may be interested in finding. I added one in `spanning_trees` and another in `spanning_trees_count`.

7) No need to repeat "in the graph" when you describe what a function does.

Consequently :

Before

```
sage: g = Graph(':I`KGgaF?SaP_UGa^') # A random graph
sage: %timeit g.spanning_trees()    
1 loops, best of 3: 2.21 s per loop
```

After

```
sage: g = Graph(':I`KGgaF?SaP_UGa^')
sage: %timeit g.spanning_trees()    
1 loops, best of 3: 975 ms per loop
```


The branch containing my commits is now at u/ncohen/16246. If you agree with it, you can :

1) Change this ticket's branch to u/ncohen/16246; or

2) Append my commits to your branch

and then set this ticket to `positive_review`. If you don't, let's discuss it as usual `:-)`

Btw : I wanted to rename `part_G` to `forest`. What do you think ? It's not important or anything, but `part_G` does not make much sense to me ...

Nathann


---

Comment by lipshitz created at 2014-05-14 21:38:24

Hi Nathann,

Thanks for all of the feedback and improvements!  We read your revised code, and agree with everyone you said except perhaps point 4.

About 4:  We think the reason that Read-Tarjan included this step in their algorithm is the opposite extreme:  the case that G is a tree, or almost a tree.  According to their analysis, their algorithm runs in O(V+E+ET), where T is the number of spanning trees. (This assumes, of course, that bridges() and so on are implemented efficiently, and that the graphs are stored in a particular way.  We think the first half is true for the Sage code, but don't know about the second.)

With your modification, suppose G is a tree.  Then it seems the running time is  E * O(is_connected()).  We don't know how is_connected is implemented.  A naive implementation runs in O(V+E) time.  Perhaps this can be improved to something like O(V) time.

Upshot:  deleting the bridges() stuff adds a quadratic E*V in the algorithm, which can be worse than V+E+ET, in cases that T is small.

In practice, though, you're probably right:  probably it's (always? almost always?) faster the way you rewrote the function.


How do you prefer to proceed?  The simpler, probably practically faster version you wrote?  The possibly theoretically faster Read-Tarjan one?  An option in the function, allowing the user to decide (defaulting to your version, say)?


Also, feel free to change "part_G" to "forest" if you prefer.  ("part_G" stood for "part of the original graph G" or "partial spanning tree".)


Best,
Robert and Jennet


---

Comment by ncohen created at 2014-05-15 11:58:06

Helloooooooooo !!

> About 4:  We think the reason that Read-Tarjan included this step in their algorithm is the opposite extreme:  the case that G is a tree, or almost a tree.  According to their analysis, their algorithm runs in O(V+E+ET), where T is the number of spanning trees. (This assumes, of course, that bridges() and so on are implemented efficiently, and that the graphs are stored in a particular way.  We think the first half is true for the Sage code, but don't know about the second.)
> 
> With your modification, suppose G is a tree.  Then it seems the running time is  E * O(is_connected()).  We don't know how is_connected is implemented.  A naive implementation runs in O(V+E) time.  Perhaps this can be improved to something like O(V) time.

Hmmmmm... Well, can I shamelessly avoid answering the real question by saying that if the graph is a tree then E=O(V), in which case the asymptotic analysis of the complexity is cool ?

> In practice, though, you're probably right:  probably it's (always? almost always?) faster the way you rewrote the function.

I believe that removing it really saves something when you have a lot of edges. But I can't prove it with paper and pen.

> How do you prefer to proceed?  The simpler, probably practically faster version you wrote?  The possibly theoretically faster Read-Tarjan one?  An option in the function, allowing the user to decide (defaulting to your version, say)?

Oh. Well, I prefer the simple and faster version of course. I even prefer "simple" versions when it is just sligthly slower. Really, when it comes to programming you cannot put a lot of faith in complexity analysis. You have to profile code, there is no other way. It is possible that most of the time is taken by something you would not have thought about, something that theory discards as straightforward, which actually isn't. Or just isn't implemented as theory thinks that it should.

> Also, feel free to change "part_G" to "forest" if you prefer.  ("part_G" stood for "part of the original graph G" or "partial spanning tree".)

I will do this in a second.

Nathann


---

Comment by ncohen created at 2014-05-15 12:08:40

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-05-15 12:08:40

If you agree with the code, you can set the ticket to `needs_review`. The "procedure" is : I reviewed your changes, you reviewed mine, so it is good to go.

Nathann
----
New commits:


---

Comment by git created at 2014-05-15 12:08:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdickinson created at 2014-05-15 14:27:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-05-15 17:18:24

Resolution: fixed
