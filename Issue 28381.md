# Issue 28381: polynomial rings over p-adics behave weirdly wrt coercion

archive/issues_028381.json:
```json
{
    "body": "CC:  @xcaruso @saraedum @roed314\n\nThe coercion model predicts that the division of a polynomial over `Qp` by an integer should lies in the fraction field\n\n```\nsage: cm = get_coercion_model()\nsage: cm.bin_op(Qp(7)['x'].one(), ZZ.one(), operator.truediv).parent()\nFraction Field of Univariate Polynomial Ring in x ...\n```\nHowever, the prediction is wrong\n\n```\nsage: parent(Qp(7)['x'].one() / ZZ.one())\nUnivariate Polynomial Ring in x over 7-adic Field with capped relative precision 20\n```\n\nNote that the prediction of the coercion model is correct over rationals\n\n```\nsage: cm.bin_op(QQ['x'].one(), ZZ.one(), operator.truediv).parent()\nUnivariate Polynomial Ring in x ...\n```\n\nLooking at the coercion code, one possible reason is that there is no action by `ZZ` found by the coercion model\n\n```\nsage: cm.get_action(QQ['x'], ZZ, operator.mul)\nRight scalar multiplication by Integer Ring on\n  Univariate Polynomial Ring in x over Rational Field\nsage: cm.get_action(Zmod(135)['x']['y'], ZZ, operator.mul)\nRight scalar multiplication by Integer Ring on\n  Univariate Polynomial Ring in y over\n  Univariate Polynomial Ring in x over\n  Ring of integers modulo 135\nsage: cm.get_action(Qp(7)['x'], ZZ, operator.mul)  # nothing!\n```\n\nThis causes trouble for some code factorization in #28592.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28618\n\n",
    "created_at": "2019-10-16T17:19:29Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "polynomial rings over p-adics behave weirdly wrt coercion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28381",
    "user": "https://github.com/videlec"
}
```
CC:  @xcaruso @saraedum @roed314

The coercion model predicts that the division of a polynomial over `Qp` by an integer should lies in the fraction field

```
sage: cm = get_coercion_model()
sage: cm.bin_op(Qp(7)['x'].one(), ZZ.one(), operator.truediv).parent()
Fraction Field of Univariate Polynomial Ring in x ...
```
However, the prediction is wrong

```
sage: parent(Qp(7)['x'].one() / ZZ.one())
Univariate Polynomial Ring in x over 7-adic Field with capped relative precision 20
```

Note that the prediction of the coercion model is correct over rationals

```
sage: cm.bin_op(QQ['x'].one(), ZZ.one(), operator.truediv).parent()
Univariate Polynomial Ring in x ...
```

Looking at the coercion code, one possible reason is that there is no action by `ZZ` found by the coercion model

```
sage: cm.get_action(QQ['x'], ZZ, operator.mul)
Right scalar multiplication by Integer Ring on
  Univariate Polynomial Ring in x over Rational Field
sage: cm.get_action(Zmod(135)['x']['y'], ZZ, operator.mul)
Right scalar multiplication by Integer Ring on
  Univariate Polynomial Ring in y over
  Univariate Polynomial Ring in x over
  Ring of integers modulo 135
sage: cm.get_action(Qp(7)['x'], ZZ, operator.mul)  # nothing!
```

This causes trouble for some code factorization in #28592.

Issue created by migration from https://trac.sagemath.org/ticket/28618





---

archive/issue_comments_400363.json:
```json
{
    "body": "The original trouble in #28592 probably qualifies as a bug. I'm not entirely sure that what is observed here is: at the face of it, we don't need an action because there's a common parent. Also, as reported on #28592, the would be\n\n```\nsage: cm.bin_op(Qp(7)['x'].one(), ZZ.one(), operator.truediv).parent()\nFraction Field of Univariate Polynomial Ring in x over 7-adic Field with capped relative precision 20\n```\nhowever, this is at odds with actually executing the operation:\n\n```\nsage: parent(Qp(7)['x'].one() / ZZ.one())\nUnivariate Polynomial Ring in x over 7-adic Field with capped relative precision 20\n```\nIn any case, should it turn out that the right way of getting this fixed is indeed by introducing actions, we should probably also consider\n\n```\ncm.bin_op(Qp(7)['x'].one(), Zp(7).one(), operator.truediv).parent()\n```\nGiven that actions can't really be discovered transitively through the coercion graph, you'd end up having to add a LOT of actions, because there are so many copies of p-adic rings possible (with different precisions). That would have to be done programmatically (which is possible) and you would need to be careful about not introducing memory leaks.",
    "created_at": "2019-10-16T17:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28381#issuecomment-400363",
    "user": "https://github.com/nbruin"
}
```

The original trouble in #28592 probably qualifies as a bug. I'm not entirely sure that what is observed here is: at the face of it, we don't need an action because there's a common parent. Also, as reported on #28592, the would be

```
sage: cm.bin_op(Qp(7)['x'].one(), ZZ.one(), operator.truediv).parent()
Fraction Field of Univariate Polynomial Ring in x over 7-adic Field with capped relative precision 20
```
however, this is at odds with actually executing the operation:

```
sage: parent(Qp(7)['x'].one() / ZZ.one())
Univariate Polynomial Ring in x over 7-adic Field with capped relative precision 20
```
In any case, should it turn out that the right way of getting this fixed is indeed by introducing actions, we should probably also consider

```
cm.bin_op(Qp(7)['x'].one(), Zp(7).one(), operator.truediv).parent()
```
Given that actions can't really be discovered transitively through the coercion graph, you'd end up having to add a LOT of actions, because there are so many copies of p-adic rings possible (with different precisions). That would have to be done programmatically (which is possible) and you would need to be careful about not introducing memory leaks.



---

archive/issue_comments_400364.json:
```json
{
    "body": "More accurate description...",
    "created_at": "2019-10-17T01:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28381#issuecomment-400364",
    "user": "https://github.com/videlec"
}
```

More accurate description...



---

archive/issue_events_071995.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-71995"
}
```



---

archive/issue_comments_400365.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28381#issuecomment-400365",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_071996.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-71996"
}
```



---

archive/issue_events_071997.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-71997"
}
```



---

archive/issue_comments_400366.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28381#issuecomment-400366",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_071998.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-71998"
}
```



---

archive/issue_events_071999.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-71999"
}
```



---

archive/issue_events_072000.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72000"
}
```



---

archive/issue_events_072001.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72001"
}
```



---

archive/issue_comments_400367.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28381#issuecomment-400367",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_072002.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72002"
}
```



---

archive/issue_events_072003.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72003"
}
```



---

archive/issue_events_072004.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72004"
}
```



---

archive/issue_events_072005.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72005"
}
```



---

archive/issue_events_072006.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72006"
}
```



---

archive/issue_events_072007.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72007"
}
```



---

archive/issue_events_072008.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72008"
}
```



---

archive/issue_events_072009.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28381",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28381#event-72009"
}
```
