# Issue 18248: Make function to generate *all* independent sets.

archive/issues_018248.json:
```json
{
    "body": "Assignee: Rudi\n\nCC:  chapoton vdelecroix\n\nCurrently the user can only enumerate all independent sets by calling Matroid.independent_r_sets repeatedly.  \nAn algorithm to compute all independent sets could be more efficient by taking into account that the independent sets are closed under taking subsets. \n\nI will write two versions of the algorithm, for Matroid and for BasisExchangeMatroid.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18485\n\n",
    "created_at": "2015-05-24T10:11:21Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Make function to generate *all* independent sets.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18248",
    "user": "Rudi"
}
```
Assignee: Rudi

CC:  chapoton vdelecroix

Currently the user can only enumerate all independent sets by calling Matroid.independent_r_sets repeatedly.  
An algorithm to compute all independent sets could be more efficient by taking into account that the independent sets are closed under taking subsets. 

I will write two versions of the algorithm, for Matroid and for BasisExchangeMatroid.



Issue created by migration from https://trac.sagemath.org/ticket/18485





---

archive/issue_comments_246405.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to matroid theory.",
    "created_at": "2015-05-24T10:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246405",
    "user": "Rudi"
}
```

Changing component from PLEASE CHANGE to matroid theory.



---

archive/issue_comments_246406.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2015-05-24T10:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246406",
    "user": "Rudi"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_246407.json:
```json
{
    "body": "I do not know what exactly you have in mind, but I remember from a conversation (on another ticket that I forgot) that we already needed it. You may also find in `sage.combinat.subsets_hereditary.subsets_with_hereditary_property` a function that \"may\" be a part of what you intend, though I do not know what exactly you want to optimize your function for.\n\nNathann",
    "created_at": "2015-05-24T14:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246407",
    "user": "ncohen"
}
```

I do not know what exactly you have in mind, but I remember from a conversation (on another ticket that I forgot) that we already needed it. You may also find in `sage.combinat.subsets_hereditary.subsets_with_hereditary_property` a function that "may" be a part of what you intend, though I do not know what exactly you want to optimize your function for.

Nathann



---

archive/issue_comments_246408.json:
```json
{
    "body": "Hi Nathann,\n\nI think you remember ticket #18183, on matroid polytopes. I saw that discussion the other day and I had to agree that it is an omission that we have no `.independent_sets()` method. \n\nI want to optimize the running time. Maybe using  `subsets_with_hereditary_property` is a good choice for the top class Matroids, I'll check it out. To improve upon `BasisExchangeMatroid.independent_r_sets()` I will have to work harder. Not sure even how much I can still squeeze out, we thoroughly optimized that one. But even if I cannot improve the running time, it will be good to have `.independent_sets()` in the interface.\n\nRudi",
    "created_at": "2015-05-24T22:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246408",
    "user": "Rudi"
}
```

Hi Nathann,

I think you remember ticket #18183, on matroid polytopes. I saw that discussion the other day and I had to agree that it is an omission that we have no `.independent_sets()` method. 

I want to optimize the running time. Maybe using  `subsets_with_hereditary_property` is a good choice for the top class Matroids, I'll check it out. To improve upon `BasisExchangeMatroid.independent_r_sets()` I will have to work harder. Not sure even how much I can still squeeze out, we thoroughly optimized that one. But even if I cannot improve the running time, it will be good to have `.independent_sets()` in the interface.

Rudi



---

archive/issue_comments_246409.json:
```json
{
    "body": "Hello !\n\n> I think you remember ticket #18183, on matroid polytopes. I saw that discussion the other day and I had to agree that it is an omission that we have no `.independent_sets()` method. \n\nYepyep. Such a function will surely be useful.\n\n> I want to optimize the running time. Maybe using  `subsets_with_hereditary_property` is a good choice for the top class Matroids, I'll check it out.\n\nI wrote it for situations when the function that checks if a set is a base is very slow. It may not be very efficient in other cases, though it definitely uses the information that the property is hereditary.\n\nGood luck `;-)`\n\nNathann",
    "created_at": "2015-05-25T08:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246409",
    "user": "ncohen"
}
```

Hello !

> I think you remember ticket #18183, on matroid polytopes. I saw that discussion the other day and I had to agree that it is an omission that we have no `.independent_sets()` method. 

Yepyep. Such a function will surely be useful.

> I want to optimize the running time. Maybe using  `subsets_with_hereditary_property` is a good choice for the top class Matroids, I'll check it out.

I wrote it for situations when the function that checks if a set is a base is very slow. It may not be very efficient in other cases, though it definitely uses the information that the property is hereditary.

Good luck `;-)`

Nathann



---

archive/issue_comments_246410.json:
```json
{
    "body": "Right now this ticket #18485 fails to build (sage -b) when I check it out on my fresh sage 6.7. The master can be rebuilt afterwards, but it takes quite a while.  This suggests that this ticket carries major changes, but clearly that is not the case. I have not added any code since creating it yesterday afternoon, it's empty! I'm baffled. What could possibly be wrong here?",
    "created_at": "2015-05-25T21:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246410",
    "user": "Rudi"
}
```

Right now this ticket #18485 fails to build (sage -b) when I check it out on my fresh sage 6.7. The master can be rebuilt afterwards, but it takes quite a while.  This suggests that this ticket carries major changes, but clearly that is not the case. I have not added any code since creating it yesterday afternoon, it's empty! I'm baffled. What could possibly be wrong here?



---

archive/issue_comments_246411.json:
```json
{
    "body": "> Right now this ticket #18485 fails to build (sage -b) when I check it out on my fresh sage 6.7.\n\nThere is no branch attached to this ticket.\n\nNathann",
    "created_at": "2015-05-26T06:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246411",
    "user": "ncohen"
}
```

> Right now this ticket #18485 fails to build (sage -b) when I check it out on my fresh sage 6.7.

There is no branch attached to this ticket.

Nathann



---

archive/issue_comments_246412.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\n> \n> There is no branch attached to this ticket.\nExactly. It does not get much stranger than this. I `git trac checkout 18485`, this empty branch, do `sage -b`, and boom. Have you tried it out?",
    "created_at": "2015-05-26T06:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246412",
    "user": "Rudi"
}
```

Replying to [comment:7 ncohen]:
> 
> There is no branch attached to this ticket.
Exactly. It does not get much stranger than this. I `git trac checkout 18485`, this empty branch, do `sage -b`, and boom. Have you tried it out?



---

archive/issue_comments_246413.json:
```json
{
    "body": "The new function seems to work just fine. \n\n```\nsage: M=matroids.named_matroids.Q10()\nsage: len(M.independent_sets())==sum([len(M.independent_r_sets(r)) for r in range(M.full_rank()+1)])\nTrue\nsage: timeit(\"M.independent_sets()\")\n625 loops, best of 3: 467 \u00b5s per loop\nsage: timeit(\"[M.independent_r_sets(r) for r in range(M.full_rank()+1)]\")\n625 loops, best of 3: 674 \u00b5s per loop\n```\n\nOther matroids give the same picture. There is some speedup (30-40%), but nothing exceptional. \n\nQ10 is a BasisExchangeMatroid, so independent_sets() and independent_r_sets() above use bitsets, and that is where some of the speed comes from. \n\nI tried out Nathann's idea to use the hereditary-set code:\n\n```\nsage:def independent_sets_iterator(M):\n    from sage.combinat.subsets_hereditary import subsets_with_hereditary_property\n    for x in subsets_with_hereditary_property(M.is_independent,M.groundset()):\n        yield x\nsage: timeit(\"list(independent_sets_iterator(M))\")\n125 loops, best of 3: 5.17 ms per loop\n```\n\nFor a fair comparison, I should force the use Matroid.independent_sets() instead of BasisExchangeMatroid.independent_sets(), so that you're not just looking at the advantage of using bitsets.\n\n```\nsage: from sage.matroids.matroid import Matroid\nsage: timeit(\"Matroid.independent_sets(M)\")\n625 loops, best of 3: 1.17 ms per loop\n```\n\n\nI will go and modify the code for M.independence_matroid_polytope().The code will perhaps be more straightforward, but it will not matter much for the efficiency. With the same matroid Q10, you get:\n\n```\nsage: timeit(\"M.independence_matroid_polytope()\")\n5 loops, best of 3: 109 ms per loop\n```\n\nSo the amount of time spent on generating independent sets is already less than 1%.\n\nA somewhat bigger matroid is the binary Golay code on 24 elements. The timings for that matroid are as follows:\n\n```\nsage: M=matroids.named_matroids.ExtendedBinaryGolayCode()\nsage: len(M.independent_sets())\n7898547\nsage: timeit(\"M.independent_sets()\")\n5 loops, best of 3: 2.29 s per loop\nsage: timeit(\"[M.independent_r_sets(r) for r in range(M.full_rank()+1)]\")\n5 loops, best of 3: 3.95 s per loop\nsage: timeit(\"list(independent_sets_iterator(M))\")\n5 loops, best of 3: 92.1 s per loop\ntimeit(\"Matroid.independent_sets(M)\")\n5 loops, best of 3: 40 s per loop\n```\n \n----\nNew commits:",
    "created_at": "2015-05-30T17:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246413",
    "user": "Rudi"
}
```

The new function seems to work just fine. 

```
sage: M=matroids.named_matroids.Q10()
sage: len(M.independent_sets())==sum([len(M.independent_r_sets(r)) for r in range(M.full_rank()+1)])
True
sage: timeit("M.independent_sets()")
625 loops, best of 3: 467 µs per loop
sage: timeit("[M.independent_r_sets(r) for r in range(M.full_rank()+1)]")
625 loops, best of 3: 674 µs per loop
```

Other matroids give the same picture. There is some speedup (30-40%), but nothing exceptional. 

Q10 is a BasisExchangeMatroid, so independent_sets() and independent_r_sets() above use bitsets, and that is where some of the speed comes from. 

I tried out Nathann's idea to use the hereditary-set code:

```
sage:def independent_sets_iterator(M):
    from sage.combinat.subsets_hereditary import subsets_with_hereditary_property
    for x in subsets_with_hereditary_property(M.is_independent,M.groundset()):
        yield x
sage: timeit("list(independent_sets_iterator(M))")
125 loops, best of 3: 5.17 ms per loop
```

For a fair comparison, I should force the use Matroid.independent_sets() instead of BasisExchangeMatroid.independent_sets(), so that you're not just looking at the advantage of using bitsets.

```
sage: from sage.matroids.matroid import Matroid
sage: timeit("Matroid.independent_sets(M)")
625 loops, best of 3: 1.17 ms per loop
```


I will go and modify the code for M.independence_matroid_polytope().The code will perhaps be more straightforward, but it will not matter much for the efficiency. With the same matroid Q10, you get:

```
sage: timeit("M.independence_matroid_polytope()")
5 loops, best of 3: 109 ms per loop
```

So the amount of time spent on generating independent sets is already less than 1%.

A somewhat bigger matroid is the binary Golay code on 24 elements. The timings for that matroid are as follows:

```
sage: M=matroids.named_matroids.ExtendedBinaryGolayCode()
sage: len(M.independent_sets())
7898547
sage: timeit("M.independent_sets()")
5 loops, best of 3: 2.29 s per loop
sage: timeit("[M.independent_r_sets(r) for r in range(M.full_rank()+1)]")
5 loops, best of 3: 3.95 s per loop
sage: timeit("list(independent_sets_iterator(M))")
5 loops, best of 3: 92.1 s per loop
timeit("Matroid.independent_sets(M)")
5 loops, best of 3: 40 s per loop
```
 
----
New commits:



---

archive/issue_comments_246414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-30T17:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246414",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246415.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-30T17:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246415",
    "user": "Rudi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_246416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-07T14:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246416",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246417.json:
```json
{
    "body": "The patchbot could not merge, and so I rebased to develop. Let's see if the patchbot is happy now.",
    "created_at": "2015-06-07T14:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246417",
    "user": "Rudi"
}
```

The patchbot could not merge, and so I rebased to develop. Let's see if the patchbot is happy now.



---

archive/issue_comments_246418.json:
```json
{
    "body": "Hmm, mixed signals from the patchbot. Two out of four pass. One fails tests, but this seems unrelated to my patch:\n\n```\nsage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)\n```\n\nPlugins fail on one time:\n\n```\nplugins.startup_time Failed\n```\n\nThis also seems unrelated to my patch.",
    "created_at": "2015-06-07T18:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246418",
    "user": "Rudi"
}
```

Hmm, mixed signals from the patchbot. Two out of four pass. One fails tests, but this seems unrelated to my patch:

```
sage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)
```

Plugins fail on one time:

```
plugins.startup_time Failed
```

This also seems unrelated to my patch.



---

archive/issue_comments_246419.json:
```json
{
    "body": "Replying to [comment:16 Rudi]:\n> Hmm, mixed signals from the patchbot. Two out of four pass. One fails tests, but this seems unrelated to my patch:\n> {{{\n> sage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)\n> }}}\n\nThis is a problem with some update of PARI/GP (the failing doctest is the interrupt in `Integer.binomial`). Independent of that ticket.\n\n> Plugins fail on one time:\n> {{{\n> plugins.startup_time Failed\n> }}}\n> This also seems unrelated to my patch.\n\nYou can also ignore that.",
    "created_at": "2015-06-07T18:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246419",
    "user": "vdelecroix"
}
```

Replying to [comment:16 Rudi]:
> Hmm, mixed signals from the patchbot. Two out of four pass. One fails tests, but this seems unrelated to my patch:
> {{{
> sage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)
> }}}

This is a problem with some update of PARI/GP (the failing doctest is the interrupt in `Integer.binomial`). Independent of that ticket.

> Plugins fail on one time:
> {{{
> plugins.startup_time Failed
> }}}
> This also seems unrelated to my patch.

You can also ignore that.



---

archive/issue_comments_246420.json:
```json
{
    "body": "Hello,\n\nYour commit `6347279` is full of\n\n```\n- <empty line>\n+ <four or more spaces>\n```\n\nRemove that.\n\nYou might have a serious problem with your text editor ;-) Or you like too much trailing whitespaces. Anyway: remove all trailing whitespaces you introduced.\n\nVincent",
    "created_at": "2015-06-09T16:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246420",
    "user": "vdelecroix"
}
```

Hello,

Your commit `6347279` is full of

```
- <empty line>
+ <four or more spaces>
```

Remove that.

You might have a serious problem with your text editor ;-) Or you like too much trailing whitespaces. Anyway: remove all trailing whitespaces you introduced.

Vincent



---

archive/issue_comments_246421.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-09T16:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246421",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_246422.json:
```json
{
    "body": "When you use `set` there is no need that for the argument of `.union()` to be a set also. You can replace\n\n```\nI[r+1] = I[r].union(set([e]))\n```\n\nwith\n\n```\nI[r+1] = I[r].union([e])\n```\n",
    "created_at": "2015-06-09T16:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246422",
    "user": "vdelecroix"
}
```

When you use `set` there is no need that for the argument of `.union()` to be a set also. You can replace

```
I[r+1] = I[r].union(set([e]))
```

with

```
I[r+1] = I[r].union([e])
```




---

archive/issue_comments_246423.json:
```json
{
    "body": "Instead of `sage_malloc` you should use `check_malloc` or `check_calloc` from #10257.",
    "created_at": "2015-06-09T16:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246423",
    "user": "vdelecroix"
}
```

Instead of `sage_malloc` you should use `check_malloc` or `check_calloc` from #10257.



---

archive/issue_comments_246424.json:
```json
{
    "body": "Replying to [comment:18 vdelecroix]:\n> Hello,\n> \n> Your commit `6347279` is full of\n> {{{\n> - <empty line>\n> + <four or more spaces>\n> }}}\n> Remove that.\n> \n> You might have a serious problem with your text editor ;-) Or you like too much trailing whitespaces. Anyway: remove all trailing whitespaces you introduced.\n\nI recall touching a button `cleanup whitespace` in my text editor. Guess that did not work out as advertised :). I will get rid of those whitespaces.",
    "created_at": "2015-06-09T17:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246424",
    "user": "Rudi"
}
```

Replying to [comment:18 vdelecroix]:
> Hello,
> 
> Your commit `6347279` is full of
> {{{
> - <empty line>
> + <four or more spaces>
> }}}
> Remove that.
> 
> You might have a serious problem with your text editor ;-) Or you like too much trailing whitespaces. Anyway: remove all trailing whitespaces you introduced.

I recall touching a button `cleanup whitespace` in my text editor. Guess that did not work out as advertised :). I will get rid of those whitespaces.



---

archive/issue_comments_246425.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T18:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246425",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T18:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246427.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T18:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246427",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246428.json:
```json
{
    "body": "My, my, that was a lot of white space. \n\nLooking at the final branch I appear to have repaired them all. I even repaired a few new ones that were in the recently added method `components()'. \n\nI also got rid of the superfluous set([e]). You're right, in that position [e] will do.\n\nUp for review again.",
    "created_at": "2015-06-09T19:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246428",
    "user": "Rudi"
}
```

My, my, that was a lot of white space. 

Looking at the final branch I appear to have repaired them all. I even repaired a few new ones that were in the recently added method `components()'. 

I also got rid of the superfluous set([e]). You're right, in that position [e] will do.

Up for review again.



---

archive/issue_comments_246429.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-09T19:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246429",
    "user": "Rudi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246430.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-12T21:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246430",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_246431.json:
```json
{
    "body": "Replying to [comment:25 Rudi]:\n> My, my, that was a lot of white space. \n> \n> Looking at the final branch I appear to have repaired them all. I even repaired a few new ones that were in the recently added method `components()'. \n\nJust look at the diff. Many of them are still there. I will provide a commit for gettint rid of them later on if you do not succeed.\n\n> I also got rid of the superfluous set([e]). You're right, in that position [e] will do.\n> \n> Up for review again.\n\nMight be cool to do more declaration in `src/sage/matroids/matroid.pyx`\n\n``` \ncdef list T = [...]\ncdef list L = [...]\ncdef int r = 0\n```\n\nAs a consequence, calls like `T[i]` gets much faster.\n\nVincent",
    "created_at": "2015-06-12T21:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246431",
    "user": "vdelecroix"
}
```

Replying to [comment:25 Rudi]:
> My, my, that was a lot of white space. 
> 
> Looking at the final branch I appear to have repaired them all. I even repaired a few new ones that were in the recently added method `components()'. 

Just look at the diff. Many of them are still there. I will provide a commit for gettint rid of them later on if you do not succeed.

> I also got rid of the superfluous set([e]). You're right, in that position [e] will do.
> 
> Up for review again.

Might be cool to do more declaration in `src/sage/matroids/matroid.pyx`

``` 
cdef list T = [...]
cdef list L = [...]
cdef int r = 0
```

As a consequence, calls like `T[i]` gets much faster.

Vincent



---

archive/issue_comments_246432.json:
```json
{
    "body": "And also declare `cdef long e` in `basis_exchange_matroid.pyx`.",
    "created_at": "2015-06-12T21:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246432",
    "user": "vdelecroix"
}
```

And also declare `cdef long e` in `basis_exchange_matroid.pyx`.



---

archive/issue_comments_246433.json:
```json
{
    "body": "Use `range` instead of `xrange`. First of all it does not make any difference in Cython and secondly, `xrange` is gone in Python 3.",
    "created_at": "2015-06-12T21:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246433",
    "user": "vdelecroix"
}
```

Use `range` instead of `xrange`. First of all it does not make any difference in Cython and secondly, `xrange` is gone in Python 3.



---

archive/issue_comments_246434.json:
```json
{
    "body": "`cdef long r = self.full_rank()`\n\nBTW, is this full rank intended to be huge? Doing `r+1` malloc/free of size `X` is much slower than one malloc/free of size `(r+1)*X`. Why not using `sage.data_structures.binary_matrix` here?",
    "created_at": "2015-06-12T21:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246434",
    "user": "vdelecroix"
}
```

`cdef long r = self.full_rank()`

BTW, is this full rank intended to be huge? Doing `r+1` malloc/free of size `X` is much slower than one malloc/free of size `(r+1)*X`. Why not using `sage.data_structures.binary_matrix` here?



---

archive/issue_comments_246435.json:
```json
{
    "body": "Replying to [comment:26 vdelecroix]:\n> Might be cool to do more declaration in `src/sage/matroids/matroid.pyx`\n> {{{ \n> cdef list T = [...]\n> cdef list L = [...]\n> cdef int r = 0\n> }}}\n> As a consequence, calls like `T[i]` gets much faster.\nYes, that does improve the efficiency a bit.",
    "created_at": "2015-06-12T22:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246435",
    "user": "Rudi"
}
```

Replying to [comment:26 vdelecroix]:
> Might be cool to do more declaration in `src/sage/matroids/matroid.pyx`
> {{{ 
> cdef list T = [...]
> cdef list L = [...]
> cdef int r = 0
> }}}
> As a consequence, calls like `T[i]` gets much faster.
Yes, that does improve the efficiency a bit.



---

archive/issue_comments_246436.json:
```json
{
    "body": "Replying to [comment:28 vdelecroix]:\n> Use `range` instead of `xrange`. First of all it does not make any difference in Cython and secondly, `xrange` is gone in Python 3.\nOld habit. Perhaps I should go through all the code, I used it all over.",
    "created_at": "2015-06-12T22:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246436",
    "user": "Rudi"
}
```

Replying to [comment:28 vdelecroix]:
> Use `range` instead of `xrange`. First of all it does not make any difference in Cython and secondly, `xrange` is gone in Python 3.
Old habit. Perhaps I should go through all the code, I used it all over.



---

archive/issue_comments_246437.json:
```json
{
    "body": "Replying to [comment:29 vdelecroix]:\n> `cdef long r = self.full_rank()`\n> \n> BTW, is this full rank intended to be huge? Doing `r+1` malloc/free of size `X` is much slower than one malloc/free of size `(r+1)*X`. Why not using `sage.data_structures.binary_matrix` here?\nI'll check out `binary_matrix` on the train tomorrow morning. I do need to apply bitset operations between rows of that matrix...",
    "created_at": "2015-06-12T22:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246437",
    "user": "Rudi"
}
```

Replying to [comment:29 vdelecroix]:
> `cdef long r = self.full_rank()`
> 
> BTW, is this full rank intended to be huge? Doing `r+1` malloc/free of size `X` is much slower than one malloc/free of size `(r+1)*X`. Why not using `sage.data_structures.binary_matrix` here?
I'll check out `binary_matrix` on the train tomorrow morning. I do need to apply bitset operations between rows of that matrix...



---

archive/issue_comments_246438.json:
```json
{
    "body": "Replying to [comment:29 vdelecroix]:\n> `cdef long r = self.full_rank()`\n> \n> BTW, is this full rank intended to be huge? Doing `r+1` malloc/free of size `X` is much slower than one malloc/free of size `(r+1)*X`.\n\nFull_rank is not huge, never more than the sizes of bitsets themselves.\n\nCreating an array of bitset_t is what I do in most places, even if the lenght of that array is huge. Typically the work in computing the contents of the individual bitsets outweighs the time to allocate them in my application. The advantage is that each entry is an individual bitset to which I can apply bitset methods. And in theory (I don't seem to do it anywhere in practice) you can swap pointers in such an array stead of copying their contents. So once you've paid for all the memory allocation, you will only benefit while using it.\n\nBut perhaps if we design a new dense hypergraph, we can have our cake and eat it, by doing mass allocation of the bitset contents and have an array of pointers on the side. It's just that calling bitset_free has to be avoided then.",
    "created_at": "2015-06-13T08:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246438",
    "user": "Rudi"
}
```

Replying to [comment:29 vdelecroix]:
> `cdef long r = self.full_rank()`
> 
> BTW, is this full rank intended to be huge? Doing `r+1` malloc/free of size `X` is much slower than one malloc/free of size `(r+1)*X`.

Full_rank is not huge, never more than the sizes of bitsets themselves.

Creating an array of bitset_t is what I do in most places, even if the lenght of that array is huge. Typically the work in computing the contents of the individual bitsets outweighs the time to allocate them in my application. The advantage is that each entry is an individual bitset to which I can apply bitset methods. And in theory (I don't seem to do it anywhere in practice) you can swap pointers in such an array stead of copying their contents. So once you've paid for all the memory allocation, you will only benefit while using it.

But perhaps if we design a new dense hypergraph, we can have our cake and eat it, by doing mass allocation of the bitset contents and have an array of pointers on the side. It's just that calling bitset_free has to be avoided then.



---

archive/issue_comments_246439.json:
```json
{
    "body": "Replying to [comment:28 vdelecroix]:\n> Use `range` instead of `xrange`. First of all it does not make any difference in Cython and secondly, `xrange` is gone in Python 3.\n\nPerhaps I should really go through all of the matroid code to make it ready for python 3. Is there any particular place where I can read up on the kind of stuff I need to check (e.g. get rid of xrange).",
    "created_at": "2015-06-13T08:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246439",
    "user": "Rudi"
}
```

Replying to [comment:28 vdelecroix]:
> Use `range` instead of `xrange`. First of all it does not make any difference in Cython and secondly, `xrange` is gone in Python 3.

Perhaps I should really go through all of the matroid code to make it ready for python 3. Is there any particular place where I can read up on the kind of stuff I need to check (e.g. get rid of xrange).



---

archive/issue_comments_246440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-13T08:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246440",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-13T08:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246441",
    "user": "Rudi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246442.json:
```json
{
    "body": "Replying to [comment:26 vdelecroix]:\n> Replying to [comment:25 Rudi]:\n> > Looking at the final branch I appear to have repaired them all. I even repaired a few new ones that were in the recently added method `components()'. \n> \n> Just look at the diff. Many of them are still there. I will provide a commit for gettint rid of them later on if you do not succeed.\n> \nHi Vincent, \n\nI think I got everything you mentioned in the above, so up for review again.\n\nAbout the whitespaces: I think the few things you still see in the diff are changes in the right direction, from whitespace to no whitespace.",
    "created_at": "2015-06-13T08:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246442",
    "user": "Rudi"
}
```

Replying to [comment:26 vdelecroix]:
> Replying to [comment:25 Rudi]:
> > Looking at the final branch I appear to have repaired them all. I even repaired a few new ones that were in the recently added method `components()'. 
> 
> Just look at the diff. Many of them are still there. I will provide a commit for gettint rid of them later on if you do not succeed.
> 
Hi Vincent, 

I think I got everything you mentioned in the above, so up for review again.

About the whitespaces: I think the few things you still see in the diff are changes in the right direction, from whitespace to no whitespace.



---

archive/issue_comments_246443.json:
```json
{
    "body": "Still some non-technical comments:\n\n- Why are you declaring your new functions as `cpdef` and not `def`? Will they be called from Cython code?\n\n- Now, there are two very similar functions in `basis_exchange_matroid.pyx`: `independent_r_sets` and `independent_sets`. Could you at least make a reference to each other (ideally in a `.. SEEALSO` section). Similarly in `matroid.pyx` you have `bases`, `independent_r_sets`, ...\n\n- (not necessarily for this ticket) The code in `independent_r_sets` and `bases_count` is almost identical. Why not making `bases_count` more general by allowing to count the cardinality of independent set and share the code with `independent_r_sets`?\n\nVincent",
    "created_at": "2015-06-13T11:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246443",
    "user": "vdelecroix"
}
```

Still some non-technical comments:

- Why are you declaring your new functions as `cpdef` and not `def`? Will they be called from Cython code?

- Now, there are two very similar functions in `basis_exchange_matroid.pyx`: `independent_r_sets` and `independent_sets`. Could you at least make a reference to each other (ideally in a `.. SEEALSO` section). Similarly in `matroid.pyx` you have `bases`, `independent_r_sets`, ...

- (not necessarily for this ticket) The code in `independent_r_sets` and `bases_count` is almost identical. Why not making `bases_count` more general by allowing to count the cardinality of independent set and share the code with `independent_r_sets`?

Vincent



---

archive/issue_comments_246444.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-13T16:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246444",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246445.json:
```json
{
    "body": "Replying to [comment:37 vdelecroix]: \n> - Why are you declaring your new functions as `cpdef` and not `def`? Will they be called from Cython code?\n> \nThe BasisExchangeMatroid method could be called from cython at some point, and that function overrides the Matroid method. Is there a disadvantage to declaring then cpdef? \n\n> - Now, there are two very similar functions in `basis_exchange_matroid.pyx`: `independent_r_sets` and `independent_sets`. Could you at least make a reference to each other (ideally in a `.. SEEALSO` section). Similarly in `matroid.pyx` you have `bases`, `independent_r_sets`, ...\n> \nOK.\n> - (not necessarily for this ticket) The code in `independent_r_sets` and `bases_count` is almost identical. Why not making `bases_count` more general by allowing to count the cardinality of independent set and share the code with `independent_r_sets`?\n> \nIn BasisExchangeMatroid this is already the case. Andl I could also modify Matroid, but right now that is not my top priority. We are talking about 6 lines of code here. \n----\nNew commits:",
    "created_at": "2015-06-13T16:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246445",
    "user": "Rudi"
}
```

Replying to [comment:37 vdelecroix]: 
> - Why are you declaring your new functions as `cpdef` and not `def`? Will they be called from Cython code?
> 
The BasisExchangeMatroid method could be called from cython at some point, and that function overrides the Matroid method. Is there a disadvantage to declaring then cpdef? 

> - Now, there are two very similar functions in `basis_exchange_matroid.pyx`: `independent_r_sets` and `independent_sets`. Could you at least make a reference to each other (ideally in a `.. SEEALSO` section). Similarly in `matroid.pyx` you have `bases`, `independent_r_sets`, ...
> 
OK.
> - (not necessarily for this ticket) The code in `independent_r_sets` and `bases_count` is almost identical. Why not making `bases_count` more general by allowing to count the cardinality of independent set and share the code with `independent_r_sets`?
> 
In BasisExchangeMatroid this is already the case. Andl I could also modify Matroid, but right now that is not my top priority. We are talking about 6 lines of code here. 
----
New commits:



---

archive/issue_comments_246446.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-20T08:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246446",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246447.json:
```json
{
    "body": "The patch was out of date, so I merged with the most recent develop. Doctests still run.\n\nAnything in particular that still needs to be done for the review?",
    "created_at": "2015-07-20T08:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246447",
    "user": "Rudi"
}
```

The patch was out of date, so I merged with the most recent develop. Doctests still run.

Anything in particular that still needs to be done for the review?



---

archive/issue_comments_246448.json:
```json
{
    "body": "Your branch creates three files in the build/ folder. That does not seem to be your intent.",
    "created_at": "2015-07-22T15:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246448",
    "user": "ncohen"
}
```

Your branch creates three files in the build/ folder. That does not seem to be your intent.



---

archive/issue_comments_246449.json:
```json
{
    "body": "Replying to [comment:42 ncohen]:\n> Your branch creates three files in the build/ folder. That does not seem to be your intent.\n\nClearly not. I suspect this happened after my the last merge, but I honestly don't see what I might have done wrong. It was a fairly clean operation, although I had to help the merge a little bit.. So have two questions:\n- where did I mess up?\n- how do I make this right?\nHope you can be my coach one more time, Nathan :).",
    "created_at": "2015-07-22T15:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246449",
    "user": "Rudi"
}
```

Replying to [comment:42 ncohen]:
> Your branch creates three files in the build/ folder. That does not seem to be your intent.

Clearly not. I suspect this happened after my the last merge, but I honestly don't see what I might have done wrong. It was a fairly clean operation, although I had to help the merge a little bit.. So have two questions:
- where did I mess up?
- how do I make this right?
Hope you can be my coach one more time, Nathan :).



---

archive/issue_comments_246450.json:
```json
{
    "body": "Helloooooo,\n\nIt must have happened during this merge: those files were *moved* to a different directory in a recent release, and perhaps some \"git commit -a\" during the merge added them back. Either way it is not complicated: just type \"git rm <filename>\" on those three guys, then add the commit to your branch.\n\nThat means that your branch will in theory add them back then remove them, but that's not really a problem. If you want to make it cleaner later, you can squash all the commits of your branch together (after the previous operation) with \"git rebase -i develop\".\n\nNathann",
    "created_at": "2015-07-22T15:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246450",
    "user": "ncohen"
}
```

Helloooooo,

It must have happened during this merge: those files were *moved* to a different directory in a recent release, and perhaps some "git commit -a" during the merge added them back. Either way it is not complicated: just type "git rm <filename>" on those three guys, then add the commit to your branch.

That means that your branch will in theory add them back then remove them, but that's not really a problem. If you want to make it cleaner later, you can squash all the commits of your branch together (after the previous operation) with "git rebase -i develop".

Nathann



---

archive/issue_comments_246451.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-22T17:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246451",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246452.json:
```json
{
    "body": "Replying to [comment:44 ncohen]:\n\n> It must have happened during this merge: those files were *moved* to a different directory in a recent release, and perhaps some \"git commit -a\" during the merge added them back. Either way it is not complicated: just type \"git rm <filename>\" on those three guys, then add the commit to your branch.\n\nThanks Nathann, did that.",
    "created_at": "2015-07-22T17:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246452",
    "user": "Rudi"
}
```

Replying to [comment:44 ncohen]:

> It must have happened during this merge: those files were *moved* to a different directory in a recent release, and perhaps some "git commit -a" during the merge added them back. Either way it is not complicated: just type "git rm <filename>" on those three guys, then add the commit to your branch.

Thanks Nathann, did that.



---

archive/issue_comments_246453.json:
```json
{
    "body": "Hey Vincent,\n\nDo you plan on finishing the review for this ticket? Otherwise I can finish it.",
    "created_at": "2015-11-20T18:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246453",
    "user": "tscrim"
}
```

Hey Vincent,

Do you plan on finishing the review for this ticket? Otherwise I can finish it.



---

archive/issue_comments_246454.json:
```json
{
    "body": "Hello Travis,\n\nReplying to [comment:47 tscrim]:\n> Do you plan on finishing the review for this ticket? Otherwise I can finish it.\n\nPlease do. The ticket is waiting since too long.",
    "created_at": "2015-11-23T14:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246454",
    "user": "vdelecroix"
}
```

Hello Travis,

Replying to [comment:47 tscrim]:
> Do you plan on finishing the review for this ticket? Otherwise I can finish it.

Please do. The ticket is waiting since too long.



---

archive/issue_comments_246455.json:
```json
{
    "body": "In the `independent_sets` of `BasisExchangeMatroid`, is there a reason why you have to do all of that extra processing before the empty ground set check? Also it is faster to do `if not self._E:`.\n\nYou also have a little bit of whitespace left here:\n\n```\n        # <-- Whitespace\n        .. SEEALSO::\n\n            :meth:`M.independent_sets() <sage.matroids.matroid.Matroid.independent_sets>`\n            :meth:`M.bases() <sage.matroids.matroid.Matroid.bases>`\n```\n\n\nOtherwise I think it looks good.",
    "created_at": "2015-11-23T15:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246455",
    "user": "tscrim"
}
```

In the `independent_sets` of `BasisExchangeMatroid`, is there a reason why you have to do all of that extra processing before the empty ground set check? Also it is faster to do `if not self._E:`.

You also have a little bit of whitespace left here:

```
        # <-- Whitespace
        .. SEEALSO::

            :meth:`M.independent_sets() <sage.matroids.matroid.Matroid.independent_sets>`
            :meth:`M.bases() <sage.matroids.matroid.Matroid.bases>`
```


Otherwise I think it looks good.



---

archive/issue_comments_246456.json:
```json
{
    "body": "I made the changes in my comment. If there is no response to my question in comment:49 in a few days, then Vincent, if you could double-check my code and then set a positive review.\n----\nNew commits:",
    "created_at": "2016-01-03T04:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246456",
    "user": "tscrim"
}
```

I made the changes in my comment. If there is no response to my question in comment:49 in a few days, then Vincent, if you could double-check my code and then set a positive review.
----
New commits:



---

archive/issue_comments_246457.json:
```json
{
    "body": "Hello,\n\n1. This is very bad\n\n```\n+        I = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))\n+        T = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))\n+        for i in range(r + 1):\n+            bitset_init(I[i], self._bitset_size)\n+            bitset_init(T[i], self._bitset_size)\n```\n\n  It calls `2(r+2)` times memory allocation for arrays of fixed size! There should be only *one* memory allocation call for everything.\n\n2. Something should be done for `KeyboardInterruption`. i.e. proper `sig_on/sig_off` and appropriate testing.\n\n3. In the other method `independent_sets`:\n   - the variable `int i` is useless.\n   - replace\n\n```\ncdef list I = [frozenset() for i in range(self.full_rank()+1)]\n```\n\n  with\n\n```\ncdef list I = [frozenset()] * (self.full_rank()+1)\n```\n\n- why using `frozenset` in `I`? Using `set` would allow to replace `I[r+1] = I[r].union([e])` with\n\n```\nI[r+1] = I[r].copy()\nI[r+1].update(e)\n```\n\n  It avoids a one element list to be created and `update` is much faster than `union`.",
    "created_at": "2016-01-03T15:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246457",
    "user": "vdelecroix"
}
```

Hello,

1. This is very bad

```
+        I = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))
+        T = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))
+        for i in range(r + 1):
+            bitset_init(I[i], self._bitset_size)
+            bitset_init(T[i], self._bitset_size)
```

  It calls `2(r+2)` times memory allocation for arrays of fixed size! There should be only *one* memory allocation call for everything.

2. Something should be done for `KeyboardInterruption`. i.e. proper `sig_on/sig_off` and appropriate testing.

3. In the other method `independent_sets`:
   - the variable `int i` is useless.
   - replace

```
cdef list I = [frozenset() for i in range(self.full_rank()+1)]
```

  with

```
cdef list I = [frozenset()] * (self.full_rank()+1)
```

- why using `frozenset` in `I`? Using `set` would allow to replace `I[r+1] = I[r].union([e])` with

```
I[r+1] = I[r].copy()
I[r+1].update(e)
```

  It avoids a one element list to be created and `update` is much faster than `union`.



---

archive/issue_comments_246458.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-03T15:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246458",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_246459.json:
```json
{
    "body": "Replying to [comment:51 vdelecroix]:\n> 1. This is very bad\n> {{{\n> +        I = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))\n> +        T = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))\n> +        for i in range(r + 1):\n> +            bitset_init(I[i], self._bitset_size)\n> +            bitset_init(T[i], self._bitset_size)\n> }}}\n>   It calls `2(r+2)` times memory allocation for arrays of fixed size! There should be only *one* memory allocation call for everything.\n\nThese are just my 2 cents and do not constitute an expert opinion on this issue.\n\nI believe it has to be the two arrays of bitsets because of the code (at least without adding additional bitset manipulations and reimplementing the `__closure`).\n\nAlthough I don't know if it is faster to use a python list of bitsets or the allocated block of memory. My intuition says the latter because it avoids the Python overhead.\n\n> 2. Something should be done for `KeyboardInterruption`. i.e. proper `sig_on/sig_off` and appropriate testing.\n\nDo you need a `sig_on` / `sig_off` for `cpdef` functions?\n\n> 3. In the other method `independent_sets`:\n>  - the variable `int i` is useless.\n\nYes, it is redundant; `r` could be used in its stead.\n\n>  - replace\n> {{{\n> cdef list I = [frozenset() for i in range(self.full_rank()+1)]\n> }}}\n>   with\n> {{{\n> cdef list I = [frozenset()] * (self.full_rank()+1)\n> }}}\n>  - why using `frozenset` in `I`? Using `set` would allow to replace `I[r+1] = I[r].union([e])` with\n> {{{\n> I[r+1] = I[r].copy()\n> I[r+1].update(e)\n> }}}\n>   It avoids a one element list to be created and `update` is much faster than `union`.\n\nIf this switches to using `set`, then we can't do the first replacement (which I believe you are aware, but I'm stating for the record). I'm +1 for changing to `set` and the above; it is much better in terms of memory manipulations and should gain some speed improvements. Additionally (mostly a note for myself), we will also need to cast the result into a frozenset:\n\n```diff\n-self.__closure(T[i+1], self._input)\n+self.__closure(frozenset(T[i+1]), self._input)\n```\n",
    "created_at": "2016-01-03T16:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246459",
    "user": "tscrim"
}
```

Replying to [comment:51 vdelecroix]:
> 1. This is very bad
> {{{
> +        I = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))
> +        T = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))
> +        for i in range(r + 1):
> +            bitset_init(I[i], self._bitset_size)
> +            bitset_init(T[i], self._bitset_size)
> }}}
>   It calls `2(r+2)` times memory allocation for arrays of fixed size! There should be only *one* memory allocation call for everything.

These are just my 2 cents and do not constitute an expert opinion on this issue.

I believe it has to be the two arrays of bitsets because of the code (at least without adding additional bitset manipulations and reimplementing the `__closure`).

Although I don't know if it is faster to use a python list of bitsets or the allocated block of memory. My intuition says the latter because it avoids the Python overhead.

> 2. Something should be done for `KeyboardInterruption`. i.e. proper `sig_on/sig_off` and appropriate testing.

Do you need a `sig_on` / `sig_off` for `cpdef` functions?

> 3. In the other method `independent_sets`:
>  - the variable `int i` is useless.

Yes, it is redundant; `r` could be used in its stead.

>  - replace
> {{{
> cdef list I = [frozenset() for i in range(self.full_rank()+1)]
> }}}
>   with
> {{{
> cdef list I = [frozenset()] * (self.full_rank()+1)
> }}}
>  - why using `frozenset` in `I`? Using `set` would allow to replace `I[r+1] = I[r].union([e])` with
> {{{
> I[r+1] = I[r].copy()
> I[r+1].update(e)
> }}}
>   It avoids a one element list to be created and `update` is much faster than `union`.

If this switches to using `set`, then we can't do the first replacement (which I believe you are aware, but I'm stating for the record). I'm +1 for changing to `set` and the above; it is much better in terms of memory manipulations and should gain some speed improvements. Additionally (mostly a note for myself), we will also need to cast the result into a frozenset:

```diff
-self.__closure(T[i+1], self._input)
+self.__closure(frozenset(T[i+1]), self._input)
```




---

archive/issue_comments_246460.json:
```json
{
    "body": "Hi Travis,\n\nsorry for the late reply. My setup for writing sage code involves working remotely on a linux machine. This is so uncomfortable that I was putting of this work until my macbook installation is on it's feet again. But I will at least reply to your last comments.\n\nReplying to [comment:49 tscrim]:\n> In the `independent_sets` of `BasisExchangeMatroid`, is there a reason why you have to do all of that extra processing before the empty ground set check? Also it is faster to do `if not self._E:`.\n> \nThe empty set is always an independent set of a matroid, so even if the ground set (self._E) is empty the output of .independent_sets() should be a SetSystem containing an empty set. So yes, that setup before the test if self._E is empty is necessary.",
    "created_at": "2016-01-03T18:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246460",
    "user": "Rudi"
}
```

Hi Travis,

sorry for the late reply. My setup for writing sage code involves working remotely on a linux machine. This is so uncomfortable that I was putting of this work until my macbook installation is on it's feet again. But I will at least reply to your last comments.

Replying to [comment:49 tscrim]:
> In the `independent_sets` of `BasisExchangeMatroid`, is there a reason why you have to do all of that extra processing before the empty ground set check? Also it is faster to do `if not self._E:`.
> 
The empty set is always an independent set of a matroid, so even if the ground set (self._E) is empty the output of .independent_sets() should be a SetSystem containing an empty set. So yes, that setup before the test if self._E is empty is necessary.



---

archive/issue_comments_246461.json:
```json
{
    "body": "Hi Vincent,\n\nthanks for the feedback.\n\nReplying to [comment:51 vdelecroix]:\n> 1. This is very bad\n> {{{\n> +        I = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))\n> +        T = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))\n> +        for i in range(r + 1):\n> +            bitset_init(I[i], self._bitset_size)\n> +            bitset_init(T[i], self._bitset_size)\n> }}}\n>   It calls `2(r+2)` times memory allocation for arrays of fixed size! There should be only *one* memory allocation call for everything.\n> \n\nThe overhead of these 2(r+2) memory allocations is negligible compared to the other work that independent_sets() does. Most subsets of the ground set of cardinality at most r will be independent, so for a matroid on n elements, writing the output takes time proportional to ` \\sum_{i=0}^r (n choose i)`. So when this memory allocation takes more than a microsecond, were looking at an r in the hundreds. Then the function as a whole will probably take many years.",
    "created_at": "2016-01-03T19:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246461",
    "user": "Rudi"
}
```

Hi Vincent,

thanks for the feedback.

Replying to [comment:51 vdelecroix]:
> 1. This is very bad
> {{{
> +        I = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))
> +        T = <bitset_t*>sage_malloc((r + 1) * sizeof(bitset_t))
> +        for i in range(r + 1):
> +            bitset_init(I[i], self._bitset_size)
> +            bitset_init(T[i], self._bitset_size)
> }}}
>   It calls `2(r+2)` times memory allocation for arrays of fixed size! There should be only *one* memory allocation call for everything.
> 

The overhead of these 2(r+2) memory allocations is negligible compared to the other work that independent_sets() does. Most subsets of the ground set of cardinality at most r will be independent, so for a matroid on n elements, writing the output takes time proportional to ` \sum_{i=0}^r (n choose i)`. So when this memory allocation takes more than a microsecond, were looking at an r in the hundreds. Then the function as a whole will probably take many years.



---

archive/issue_comments_246462.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-01-04T00:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246462",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_246463.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-04T00:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246463",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246464.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-04T00:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246464",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246465.json:
```json
{
    "body": "Whoops, sorry about that. Fixed and you shouldn't have to do anything special because I just reverted my bad merge.\n\nI did some testing and found that the extra copying of the sets plus the conversion to a frozenset was just as slow if not slower than doing the union with the frozenset.\n\nHowever I was able to optimize the method by special casing when `r` is at the full rank. The `BetsyRoss().independent_sets()` time when from 4.8s to 1.6s and `R98().independent_sets()` went from 4.8s to 2.8s on my machine.\n\nThanks for the explanations Rudi.",
    "created_at": "2016-01-04T00:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246465",
    "user": "tscrim"
}
```

Whoops, sorry about that. Fixed and you shouldn't have to do anything special because I just reverted my bad merge.

I did some testing and found that the extra copying of the sets plus the conversion to a frozenset was just as slow if not slower than doing the union with the frozenset.

However I was able to optimize the method by special casing when `r` is at the full rank. The `BetsyRoss().independent_sets()` time when from 4.8s to 1.6s and `R98().independent_sets()` went from 4.8s to 2.8s on my machine.

Thanks for the explanations Rudi.



---

archive/issue_comments_246466.json:
```json
{
    "body": "Ping. Vincent, Rudi, are my changes good and are we ready to set this to a positive review?",
    "created_at": "2016-01-08T16:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246466",
    "user": "tscrim"
}
```

Ping. Vincent, Rudi, are my changes good and are we ready to set this to a positive review?



---

archive/issue_comments_246467.json:
```json
{
    "body": "Replying to [comment:58 tscrim]:\n> Ping. Vincent, Rudi, are my changes good and are we ready to set this to a positive review?\n\nSorry Travis, missed that ping. Thank you for making those changes, I'm happy with them.\n\nCheers,\nRudi",
    "created_at": "2016-02-11T19:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246467",
    "user": "Rudi"
}
```

Replying to [comment:58 tscrim]:
> Ping. Vincent, Rudi, are my changes good and are we ready to set this to a positive review?

Sorry Travis, missed that ping. Thank you for making those changes, I'm happy with them.

Cheers,
Rudi



---

archive/issue_comments_246468.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-11T20:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246468",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_246469.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-11T23:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18248#issuecomment-246469",
    "user": "vbraun"
}
```

Resolution: fixed
