# Issue 25132: L-series values for certain modular forms computed incorrectly

Issue created by migration from https://trac.sagemath.org/ticket/25369

Original creator: arminstraub

Original creation time: 2018-05-15 20:59:20

CC:  davidloeffler

Keywords: lseries

Using Sage 8.1 on CoCalc:

```
sage: f5 = Newforms(Gamma1(4), 5, names='a')[0]; f5
q - 4*q^2 + 16*q^4 - 14*q^5 + O(q^6)
sage: L5 = f5.lseries()
sage: L5.check_functional_equation()
0.148408065960889 - 9.08737314733255e-18*I
```

An example of an incorrect L-value (and the correct one, for comparison):

```
sage: L5(4)
0.379630585317869 + 2.49933520900079e-17*I
sage: sum(f5.coefficient(n)/n^4 for n in [1..200]).n()
0.787848673384282
sage: (gamma(1/4)^8/(3840*pi^2)).n()
0.787803000538474
```

Just in case it is helpful, here is another example with similar issues:

```
sage: f3 = Newforms(Gamma1(24), 3, names='a')[0]; f3
q - 2*q^2 + 3*q^3 + 4*q^4 + 2*q^5 + O(q^6)
sage: f3.lseries().check_functional_equation()
1.13933480080878 - 3.61460956971046e-16*I
```



---

Comment by alexjbest created at 2018-05-16 12:09:49

It seems the behaviour here is changed by #24086, it still doesn't seem to work even after that for me though.

The LMFDB has this form http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/4/5/3/a/ and says the associated L-function is http://www.lmfdb.org/L/ModularForm/GL2/Q/holomorphic/4/5/3/a/0/, which has epsilon factor 1, rather than -1 as L5.eps reports.
If you set the epsilon factor to 1 then the functional equation checks out (for both examples).

Conceivably this could just be an issue of embeddings? In the first case the atkin lehner eigenvalue is reported with #24086 to be zeta4 or simply `I` using the 0th embedding of the heceke_eigenvalue_field into QQbar, which if embedded as the same as I gives `I^5 * I = -1`, in the second case the eigenvalue is `-I` with the 0th embedding giving `I^3 *(-I) = -1` again. So both examples would be fixed by a judicious conjugate embedding?
But I think I have stretched my lack of the appropriate mathematics too far now, as I really don't know what all these embeddings etc. "should" be.


---

Comment by davidloeffler created at 2018-05-16 12:23:04

This is an interesting case: it's a form of odd weight and rational Hecke eigenvalues -- this can only happen for CM forms. Since the Hecke eigenvalue field is QQ, the "embedding" parameter to `atkin_lehner_eigenvalue()` has no effect.

My best guess is that this is a discrepancy of normalisations between `atkin_lehner_eigenvalue()` and `lseries()`. The Atkin-Lehner eigenvalue code uses the normalisations from Atkin-Li's 1978 paper; but that defines W_N to be [0,1; -N,0], whereas a lot of subsequent literature uses [0,-1; N,0], and that causes a sign discrepancy in odd weights.

I will investigate more and get back to you.


---

Comment by arminstraub created at 2018-05-16 13:27:53

Thank you, Alex!  Manually adjusting the epsilon factor indeed makes the functional equation work out.  The L-values I am interested in are then also computed correctly.  This is very helpful as a temporary work-around.  It is awesome to see you and David investigate this issue so swiftly!


---

Comment by davidloeffler created at 2018-05-16 14:57:24

Yes, I was correct: this is the discrepancy between the Atkin--Li definition of $W_N$ and the other definition when the weight is odd. I'll to do a fix on top of my existing branch for #24086.


---

Comment by davidloeffler created at 2018-05-16 21:54:25

Changing status from new to needs_review.


---

Comment by davidloeffler created at 2018-05-16 21:54:25

Here's a fix -- it's literally a single-byte change! I also added your weight 5 example as a doctest.
----
New commits:


---

Comment by alexjbest created at 2018-05-17 00:25:31

Just ran through a load of examples with this patch and all the functional equations check out, so positive review!


---

Comment by alexjbest created at 2018-05-17 00:25:31

Changing status from needs_review to positive_review.


---

Comment by arminstraub created at 2018-05-17 14:11:12

Fantastic!  It's been a while, but I updated Sage on my machine to the newest beta, applied your patch, and computed lots of L-values (the ones I included in the report are part of an infinite family).  It is working beautifully!  Thank you!


---

Comment by davidloeffler created at 2018-05-19 12:16:54

Here's a new branch which merges cleanly with 8.3.beta2.
----
New commits:


---

Comment by vbraun created at 2018-05-20 22:55:14

Resolution: fixed
