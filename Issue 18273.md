# Issue 18273: uniform api for 3d graphics renderers

archive/issues_018273.json:
```json
{
    "body": "CC:  ohanar vbraun schilly novoselt\n\nKeywords: graphics3d, rich_repr\n\nRefactor 3d plotting classes to create a uniform interface for rendering with various frontends.  Will make it easier to maintain current and implement new rendering frontends.  This will also make it possible to implement a new renderer outside of the Sage library, e.g. for prototyping.\n\nSimilar in strategy to rich representation as in #17234.\n\nNote: we use 'render' in the most liberal sense.  E.g. x3d \"renders\" to a particular format.  Better term is welcome.\n\nIdea: Instead of a repr method for each renderer on each 3d graphics class, put all rendering commands for a given renderer in a single class.  Renderers are registered in a global dict, etc.\n\nTo do: Figure out precisely how this should interact with the rich_repr framework.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18510\n\n",
    "created_at": "2015-05-26T04:05:02Z",
    "labels": [
        "graphics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "uniform api for 3d graphics renderers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18273",
    "user": "niles"
}
```
CC:  ohanar vbraun schilly novoselt

Keywords: graphics3d, rich_repr

Refactor 3d plotting classes to create a uniform interface for rendering with various frontends.  Will make it easier to maintain current and implement new rendering frontends.  This will also make it possible to implement a new renderer outside of the Sage library, e.g. for prototyping.

Similar in strategy to rich representation as in #17234.

Note: we use 'render' in the most liberal sense.  E.g. x3d "renders" to a particular format.  Better term is welcome.

Idea: Instead of a repr method for each renderer on each 3d graphics class, put all rendering commands for a given renderer in a single class.  Renderers are registered in a global dict, etc.

To do: Figure out precisely how this should interact with the rich_repr framework.

Issue created by migration from https://trac.sagemath.org/ticket/18510





---

archive/issue_comments_246908.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-26T04:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246908",
    "user": "niles"
}
```

New commits:



---

archive/issue_comments_246909.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T04:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246909",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246910.json:
```json
{
    "body": "+1 to the idea\n\nIts a variant of the translator pattern, so maybe name things JmolTranslator etc?",
    "created_at": "2015-05-26T06:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246910",
    "user": "vbraun"
}
```

+1 to the idea

Its a variant of the translator pattern, so maybe name things JmolTranslator etc?



---

archive/issue_comments_246911.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T20:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246911",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246912.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T20:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246912",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246913.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T21:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246913",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246914.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T21:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246914",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246915.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T21:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246915",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246916.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T21:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246916",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246917.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T22:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246917",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246918.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T22:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246918",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246919.json:
```json
{
    "body": "The idea behind the rich output is that the backend knows best which implementation to pick. The graphics preferences is just to express some overall preference, but it shouldn't be used to micromanage the implementation. E.g. for 2-d graphics there is a choice between raster and vector graphics, but which raster graphics format (png/jpg/gif/...) is intentionally **not** specified: Which one of those is best depends on the backend capababilities, e.g. the IPython notebook can't display gif. This is also easier for the user since he doesn't have to know the difference between different implementations nor their support in different backends. \n\nFor 3-d graphics there is a logical choice between rendered (2-d bitmap) vs live 3d, but shouldn't offer further controls on the particular implementation. More is just confusing to non-experts (what is jmol and why is it not working [if I don't have java installed]?). Let the backend decide what produces good quality and what doesn't.",
    "created_at": "2015-05-26T23:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246919",
    "user": "vbraun"
}
```

The idea behind the rich output is that the backend knows best which implementation to pick. The graphics preferences is just to express some overall preference, but it shouldn't be used to micromanage the implementation. E.g. for 2-d graphics there is a choice between raster and vector graphics, but which raster graphics format (png/jpg/gif/...) is intentionally **not** specified: Which one of those is best depends on the backend capababilities, e.g. the IPython notebook can't display gif. This is also easier for the user since he doesn't have to know the difference between different implementations nor their support in different backends. 

For 3-d graphics there is a logical choice between rendered (2-d bitmap) vs live 3d, but shouldn't offer further controls on the particular implementation. More is just confusing to non-experts (what is jmol and why is it not working [if I don't have java installed]?). Let the backend decide what produces good quality and what doesn't.



---

archive/issue_comments_246920.json:
```json
{
    "body": "Right now the preferences that you can set aren't really publicized, so at the moment, non-experts will never really see the preferences. Moreover, I think that you should support experts who might care about the format that they get (e.g. they always want jpg over png) and that they should be able to set their preferences as such.\n\nAdditionally, with the binary choice, I wouldn't be able to implement a renderer outside of the sage library and use it as the default in my own backend, since all of the renderers within the sage library would be preferred over my own.\n\nFor instance, SMC does not currently use a backend, but rather monkey patches things because it uses its own threejs based renderer. While this stuff will likely eventually make its way into the sage library, you shouldn't be forced to implement these things in the library itself. If the backend can specify its own preferred renderers, then it is possible implement such things outside of the sage library.",
    "created_at": "2015-05-26T23:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246920",
    "user": "ohanar"
}
```

Right now the preferences that you can set aren't really publicized, so at the moment, non-experts will never really see the preferences. Moreover, I think that you should support experts who might care about the format that they get (e.g. they always want jpg over png) and that they should be able to set their preferences as such.

Additionally, with the binary choice, I wouldn't be able to implement a renderer outside of the sage library and use it as the default in my own backend, since all of the renderers within the sage library would be preferred over my own.

For instance, SMC does not currently use a backend, but rather monkey patches things because it uses its own threejs based renderer. While this stuff will likely eventually make its way into the sage library, you shouldn't be forced to implement these things in the library itself. If the backend can specify its own preferred renderers, then it is possible implement such things outside of the sage library.



---

archive/issue_comments_246921.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T00:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246921",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246922.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T01:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246922",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246923.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T01:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246923",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246924.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T03:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246924",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246925.json:
```json
{
    "body": "No, the preferences are what you access through `%display`, so they are in fact the easiest and intended way to interact with the display manager. Thats why its user hostile if you name settings after obscure package names, and confusing to boot since not every 3d implementation makes sense for every UI.\n\nIf you want to micromanage the format then there is already `foo.plot(viewer='jmol')` and friends. The keyword name might/should be changed but at least its hidden away so that no ordinary user has to deal with it. An alternative would be `foo.save('output.obj').show()` and use the file extension to guess the type.\n\nYou can't realistically have pluggable arbitrary rich output, the author of the Sage object needs to know what the possibilities are in order to decide on the suitable rich output. Now for the the very special case of just 3d graphics that might make sense, but then you can easily do that by\n\n```\ndef _rich_repr_:\n    ... try sane defaults first ...\n    # if none of the defaults work try the rest \n    for output_type in display_manager.supported_output():\n        try:\n            return renderer(self, output_type) \n        except:\n            pass\n```\n\nand then declare a particular output type as the only supported one from your backend.",
    "created_at": "2015-05-27T09:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246925",
    "user": "vbraun"
}
```

No, the preferences are what you access through `%display`, so they are in fact the easiest and intended way to interact with the display manager. Thats why its user hostile if you name settings after obscure package names, and confusing to boot since not every 3d implementation makes sense for every UI.

If you want to micromanage the format then there is already `foo.plot(viewer='jmol')` and friends. The keyword name might/should be changed but at least its hidden away so that no ordinary user has to deal with it. An alternative would be `foo.save('output.obj').show()` and use the file extension to guess the type.

You can't realistically have pluggable arbitrary rich output, the author of the Sage object needs to know what the possibilities are in order to decide on the suitable rich output. Now for the the very special case of just 3d graphics that might make sense, but then you can easily do that by

```
def _rich_repr_:
    ... try sane defaults first ...
    # if none of the defaults work try the rest 
    for output_type in display_manager.supported_output():
        try:
            return renderer(self, output_type) 
        except:
            pass
```

and then declare a particular output type as the only supported one from your backend.



---

archive/issue_comments_246926.json:
```json
{
    "body": "PS: \"render\" has a rather narrow meaning in the 3d graphics context http://en.wikipedia.org/wiki/3D_rendering, IMHO it would be clearer if you chose a different one",
    "created_at": "2015-05-27T09:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18273#issuecomment-246926",
    "user": "vbraun"
}
```

PS: "render" has a rather narrow meaning in the 3d graphics context http://en.wikipedia.org/wiki/3D_rendering, IMHO it would be clearer if you chose a different one
