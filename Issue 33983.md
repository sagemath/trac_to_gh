# Issue 33983: build from source fails with --with-system-flint=no

Issue created by migration from https://trac.sagemath.org/ticket/34220

Original creator: zimmerma

Original creation time: 2022-07-25 14:52:21

CC:  fredrik.johansson

I tried to build Sage 9.6 from source with `--with-system-flint=no`, and it fails, cf from `sagemath_doc_html-none.log`:

```
ImportError: libflint-2.8.4.so: cannot open shared object file: No such file or directory
Error: './sage --docbuild --all-documents' failed
make[5]: *** [Makefile:33: doc-inventory-reference] Error 1
```

The dynamic library built in `local/lib` is `libflint.so.16.1.4` (also named `libflint.so`).


---

Comment by mkoeppe created at 2022-07-25 16:20:55

Did you build it from scratch, or is it an incremental build from a previous version?


---

Comment by zimmerma created at 2022-07-25 18:59:33

I built it from scratch


---

Comment by mkoeppe created at 2022-07-25 21:23:45

Try what `make list-broken-packages` from #34203 says about your installation.


---

Comment by zimmerma created at 2022-07-26 07:44:55

it says:

```
zimmerma@choucroute:/localdisk/zimmerma/sage-9.6$ make list-broken-packages
...
Checking shared library file '/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10.5/lib/python3.10/lib-dynload/zlib.cpython-310-x86_64-linux-gnu.so'

Uninstall broken packages by typing:

make[2]: Entering directory '/localdisk/zimmerma/sage-9.6/build/make'
make[2]: Leaving directory '/localdisk/zimmerma/sage-9.6/build/make'
make[1]: Leaving directory '/localdisk/zimmerma/sage-9.6/build/make'

real    2m21.924s
user    3m33.370s
sys     0m20.784s
Sage build/upgrade complete!
```



---

Comment by mkoeppe created at 2022-07-26 19:33:56

Can you reproduce the error also using the testsuite instead of the docbuild? For example `./sage -tp src/sage/rings`


---

Comment by zimmerma created at 2022-07-27 06:59:55

yes I can:

```
zimmerma@choucroute:/localdisk/zimmerma/sage-9.6$ ./sage -tp src/sage/rings
...
Running doctests with ID 2022-07-27-08-58-18-158c9994.
Git branch: develop
Using --optional=debian,pip,sage,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,gfan,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,nauty,palp,pandoc,pdf2svg,pdftocairo,phitigra,plantri,polytopes_db,polytopes_db_4d,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
Sorting sources by runtime so that slower doctests are run first....
Doctesting 438 files using 4 threads.
Traceback (most recent call last):
  File "/localdisk/zimmerma/sage-9.6/src/bin/sage-runtests", line 151, in <module>
    err = DC.run()
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/control.py", line 1347, in run
    self.run_doctests()
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/control.py", line 1043, in run_doctests
    self.dispatcher = DocTestDispatcher(self)
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 1626, in __init__
    init_sage(controller)
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 193, in init_sage
    controller.load_environment()
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/control.py", line 583, in load_environment
    return import_module(self.options.environment)
  File "/usr/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/repl/ipython_kernel/all_jupyter.py", line 5, in <module>
    from sage.all_cmdline import *
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/all_cmdline.py", line 19, in <module>
    from sage.all import *
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/all.py", line 131, in <module>
    from sage.rings.all      import *
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/all.py", line 76, in <module>
    from .number_field.all import *
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/number_field/all.py", line 2, in <module>
    from .number_field import (NumberField, NumberFieldTower, CyclotomicField, QuadraticField,
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/number_field/number_field.py", line 117, in <module>
    from sage.rings.polynomial.polynomial_element import is_Polynomial
  File "sage/rings/polynomial/polynomial_element.pyx", line 67, in init sage.rings.polynomial.polynomial_element (build/cythonized/sage/rings/polynomial/polynomial_element.c:108949)
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/polynomial_ring.py", line 152, in <module>
    import sage.rings.polynomial.polynomial_element_generic as polynomial_element_generic
  File "/localdisk/zimmerma/sage-9.6/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/polynomial_element_generic.py", line 1556, in <module>
    from sage.rings.polynomial.polynomial_rational_flint import Polynomial_rational_flint
ImportError: libflint-2.8.4.so: cannot open shared object file: No such file or directory
```

