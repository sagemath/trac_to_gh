# Issue 23864: Implement Katz centrality and related methods for graphs

archive/issues_023864.json:
```json
{
    "body": "Keywords: sd90\n\nwant to be able to compute Katz centrality, use Katz method for link prediction in graphs/networks (https://en.wikipedia.org/wiki/Katz_centrality)\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24101\n\n",
    "created_at": "2017-10-24T23:11:27Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Implement Katz centrality and related methods for graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23864",
    "user": "https://trac.sagemath.org/admin/accounts/users/clienkaemper"
}
```
Keywords: sd90

want to be able to compute Katz centrality, use Katz method for link prediction in graphs/networks (https://en.wikipedia.org/wiki/Katz_centrality)



Issue created by migration from https://trac.sagemath.org/ticket/24101





---

archive/issue_comments_334105.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-25T23:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334106.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-25T23:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334106",
    "user": "https://trac.sagemath.org/admin/accounts/users/clienkaemper"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_334107.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-26T07:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334107",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_334108.json:
```json
{
    "body": "Welcome to Sagemath\n\nI have some comments to help you improving the code.\n\n- unify `nonedges_only` and `nonedgesonly`. Actually, #24094 uses `nonedgesonly`. I don't know which is best, but should be the same.\n- `Returns the Katz matrix of G with parameter alpha.` -> `Return the Katz matrix of the graph with parameter alpha.`\n- only 1 empty line is needed after `INPUT::`\n- ``True`` -> ```True```\n- `if true, eliminates common neighbors between adjacent vertices`. Could you add that the value for each edge is set to 0 ?\n- `the Katz matrix of the graph self with parameter alpha` -> `the Katz matrix of the graph  with parameter alpha`\n- `G1 = Graph({1:[2,3], 2:[1,4], 3:[1,4], 4:[2,3]})` -> `G1 = graphs.CycleGraph(4)` ?\n- since you don't have `G2`, you could rename `G1` to `G`\n- add a space between `*` and the text in `*:meth:`~katz_centrality`` and the line after\n- add an empty line after `TESTS::`\n- The examples you give in the `TESTS` could be in the examples section. In a TESTS block, we expect examples raising errors, with the empty graph, etc.\n- the test `alpha <= 0` should be made before any other computation\n- `if nonedges_only == True:` -> `if nonedges_only:`\n\nin method `def katz_centrality(self, alpha):`\n- you could add an optional parameter `u` to return the centrality of a specified vertex. For that, add `u=None` and then the return statement becomes something like `if u is None: return K else: return K[u]`\n- you must indent the text in 80 columns mode. Some code editors are really helpful to do that without effort\n- You return a list. Wouldn't it be better to return a dictionary keyed by vertices ? How to know which value corresponds to a node ?",
    "created_at": "2017-10-26T07:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334108",
    "user": "https://github.com/dcoudert"
}
```

Welcome to Sagemath

I have some comments to help you improving the code.

- unify `nonedges_only` and `nonedgesonly`. Actually, #24094 uses `nonedgesonly`. I don't know which is best, but should be the same.
- `Returns the Katz matrix of G with parameter alpha.` -> `Return the Katz matrix of the graph with parameter alpha.`
- only 1 empty line is needed after `INPUT::`
- ``True`` -> ```True```
- `if true, eliminates common neighbors between adjacent vertices`. Could you add that the value for each edge is set to 0 ?
- `the Katz matrix of the graph self with parameter alpha` -> `the Katz matrix of the graph  with parameter alpha`
- `G1 = Graph({1:[2,3], 2:[1,4], 3:[1,4], 4:[2,3]})` -> `G1 = graphs.CycleGraph(4)` ?
- since you don't have `G2`, you could rename `G1` to `G`
- add a space between `*` and the text in `*:meth:`~katz_centrality`` and the line after
- add an empty line after `TESTS::`
- The examples you give in the `TESTS` could be in the examples section. In a TESTS block, we expect examples raising errors, with the empty graph, etc.
- the test `alpha <= 0` should be made before any other computation
- `if nonedges_only == True:` -> `if nonedges_only:`

in method `def katz_centrality(self, alpha):`
- you could add an optional parameter `u` to return the centrality of a specified vertex. For that, add `u=None` and then the return statement becomes something like `if u is None: return K else: return K[u]`
- you must indent the text in 80 columns mode. Some code editors are really helpful to do that without effort
- You return a list. Wouldn't it be better to return a dictionary keyed by vertices ? How to know which value corresponds to a node ?



---

archive/issue_comments_334109.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-03-08T14:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334109",
    "user": "https://github.com/rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_comments_334110.json:
```json
{
    "body": "I would like to work on it.\nShould I work on existing branch or should I create a new one based on latest sage develop version?",
    "created_at": "2019-03-08T14:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334110",
    "user": "https://github.com/rajat1433"
}
```

I would like to work on it.
Should I work on existing branch or should I create a new one based on latest sage develop version?



---

archive/issue_comments_334111.json:
```json
{
    "body": "You can either rebase this ticket on last develop branch (and fix the merge conflicts), or create a new branch based on last beta.",
    "created_at": "2019-03-08T16:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334111",
    "user": "https://github.com/dcoudert"
}
```

You can either rebase this ticket on last develop branch (and fix the merge conflicts), or create a new branch based on last beta.



---

archive/issue_comments_334112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-09T04:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334113.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-09T04:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334113",
    "user": "https://github.com/rajat1433"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_334114.json:
```json
{
    "body": "Several issues (I'm skipping the coding style issues for the moment, but please have a look at http://doc.sagemath.org/html/en/developer/coding_basics.html and check how other methods are written).\n\nIn method `katz_matrix`:\n- add some explanation of what is a Katz matrix\n- please add parameter `vertices` similarly to method `.adjacency_matrix()`. This is important as in the future we will no longer ensure that the list of vertices is sorted (due to Python 3).\n\nIn method `katz_centrality`\n- add some explanation of what is the Katz centrality, plus a link to relevant wikipedia page\n- in the code, choose an order like `verts = list(self)`, and pass it to `katz_matrix`. Here we don't need the list of vertices to be sorted, we just want to know the ordering, so we fix it.\n- `u not in self.vertices()` -> `u not in self`\n- You can simplify the construction of the dictionary\n\n```diff\n-        for i in range(n):\n-            Kdict[vert[i]] = katz_values[0][i]\n+        Kdict = {u: katz_values[0][i] for i, u in enumerate(verts)}\n```\n\n- Do we really need to build dictionary `Kdict` when `u` is not None ?\n\nDo not forget to check that all tests pass and that the documentation builds properly and displays nicely.",
    "created_at": "2019-03-09T08:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334114",
    "user": "https://github.com/dcoudert"
}
```

Several issues (I'm skipping the coding style issues for the moment, but please have a look at http://doc.sagemath.org/html/en/developer/coding_basics.html and check how other methods are written).

In method `katz_matrix`:
- add some explanation of what is a Katz matrix
- please add parameter `vertices` similarly to method `.adjacency_matrix()`. This is important as in the future we will no longer ensure that the list of vertices is sorted (due to Python 3).

In method `katz_centrality`
- add some explanation of what is the Katz centrality, plus a link to relevant wikipedia page
- in the code, choose an order like `verts = list(self)`, and pass it to `katz_matrix`. Here we don't need the list of vertices to be sorted, we just want to know the ordering, so we fix it.
- `u not in self.vertices()` -> `u not in self`
- You can simplify the construction of the dictionary

```diff
-        for i in range(n):
-            Kdict[vert[i]] = katz_values[0][i]
+        Kdict = {u: katz_values[0][i] for i, u in enumerate(verts)}
```

- Do we really need to build dictionary `Kdict` when `u` is not None ?

Do not forget to check that all tests pass and that the documentation builds properly and displays nicely.



---

archive/issue_comments_334115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-09T11:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334116.json:
```json
{
    "body": "Thanks for the prompt reply and suggesting the changes.\nDone all the improvements mentioned above and also made sure to pass all the tests.\nI have done the changes as per required by the documentation in generic_graph.py file. But could not figure out how to view those changes as they will actually be looking in documentation. And is \nthere any test command for checking if format is correct for documentation.",
    "created_at": "2019-03-09T11:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334116",
    "user": "https://github.com/rajat1433"
}
```

Thanks for the prompt reply and suggesting the changes.
Done all the improvements mentioned above and also made sure to pass all the tests.
I have done the changes as per required by the documentation in generic_graph.py file. But could not figure out how to view those changes as they will actually be looking in documentation. And is 
there any test command for checking if format is correct for documentation.



---

archive/issue_comments_334117.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-09T12:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334118.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-09T17:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334119.json:
```json
{
    "body": "> I have done the changes as per required by the documentation in generic_graph.py file. But could not figure out how to view those changes as they will actually be looking in documentation. And is \n> there any test command for checking if format is correct for documentation.\n\nSee http://doc.sagemath.org/html/en/developer/sage_manuals.html\n\nYou can rebuild the full documentation using\n\n```\nsage -b && sage --docbuild reference html\n```\n\nor rebuild only the documentation of the graph module\n\n```\nsage -b && sage --docbuild reference/graphs html\n```\n\n\nThen, you can look at the documentation with your web browser.\n\n```\nfile://PATH_ON_YOUR_COMPUTER/sage/local/share/doc/sage/html/en/reference/graphs/index.html\n```\n\n\nFor the coding style, please try to comply to https://www.python.org/dev/peps/pep-0008",
    "created_at": "2019-03-09T18:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334119",
    "user": "https://github.com/dcoudert"
}
```

> I have done the changes as per required by the documentation in generic_graph.py file. But could not figure out how to view those changes as they will actually be looking in documentation. And is 
> there any test command for checking if format is correct for documentation.

See http://doc.sagemath.org/html/en/developer/sage_manuals.html

You can rebuild the full documentation using

```
sage -b && sage --docbuild reference html
```

or rebuild only the documentation of the graph module

```
sage -b && sage --docbuild reference/graphs html
```


Then, you can look at the documentation with your web browser.

```
file://PATH_ON_YOUR_COMPUTER/sage/local/share/doc/sage/html/en/reference/graphs/index.html
```


For the coding style, please try to comply to https://www.python.org/dev/peps/pep-0008



---

archive/issue_comments_334120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-10T19:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334121.json:
```json
{
    "body": "I have made changes so as to build the documentation properly and also passed all the tests and tried to follow the coding convention. Can you please review the code so that we can finalize it.",
    "created_at": "2019-03-10T19:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334121",
    "user": "https://github.com/rajat1433"
}
```

I have made changes so as to build the documentation properly and also passed all the tests and tried to follow the coding convention. Can you please review the code so that we can finalize it.



---

archive/issue_comments_334122.json:
```json
{
    "body": "- You must ensure that all comments are formatted in 80 columns mode. Some code editors can be configured to ease this task\n\n- minor stylistic issue\n\n```diff\n-        - ``nonedgesonly`` -- Boolean (default: ``True``); if True, value for each\n-          edge present in the graph is set to zero.\n+        - ``nonedgesonly`` -- boolean (default: ``True``); if ``True``, value for each\n+          edge present in the graph is set to zero\n```\n\n\n- you can use `for u in self` or `set(self)` or `if u in self`, etc.\n\n```diff\n-              set(vertices) != set(self.vertex_iterator())):\n+              set(vertices) != set(self)):\n```\n\n\n- pep8\n\n```diff\n-        K =  (In - alpha * A.transpose()).inverse()-In\n+        K =  (In - alpha * A.transpose()).inverse() - In\n```\n\n \n {{{#!diff\n-            Missing = onesmat - A- In\n+            Missing = onesmat - A - In\n}}}\n\n- Please revise method `katz_centrality`: alignment, ensure that the code is correct, remove useless instructions, etc.",
    "created_at": "2019-03-11T08:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334122",
    "user": "https://github.com/dcoudert"
}
```

- You must ensure that all comments are formatted in 80 columns mode. Some code editors can be configured to ease this task

- minor stylistic issue

```diff
-        - ``nonedgesonly`` -- Boolean (default: ``True``); if True, value for each
-          edge present in the graph is set to zero.
+        - ``nonedgesonly`` -- boolean (default: ``True``); if ``True``, value for each
+          edge present in the graph is set to zero
```


- you can use `for u in self` or `set(self)` or `if u in self`, etc.

```diff
-              set(vertices) != set(self.vertex_iterator())):
+              set(vertices) != set(self)):
```


- pep8

```diff
-        K =  (In - alpha * A.transpose()).inverse()-In
+        K =  (In - alpha * A.transpose()).inverse() - In
```

 
 {{{#!diff
-            Missing = onesmat - A- In
+            Missing = onesmat - A - In
}}}

- Please revise method `katz_centrality`: alignment, ensure that the code is correct, remove useless instructions, etc.



---

archive/issue_comments_334123.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T09:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334124.json:
```json
{
    "body": "Thanks for the review. Its been really a learning experience. I have started following alignment and pep8 seriously and I have fixed the issues above.",
    "created_at": "2019-03-11T09:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334124",
    "user": "https://github.com/rajat1433"
}
```

Thanks for the review. Its been really a learning experience. I have started following alignment and pep8 seriously and I have fixed the issues above.



---

archive/issue_comments_334125.json:
```json
{
    "body": "Please check carefully your code, that comments are in 80 columns mode, if possible that you follow the PEP8 coding style, that the comments are sufficient and helpful to the user, and that your code is best possible.\n\nfor instance, you have apparently not double check this part:\n\n```diff\n-        if u :\n-            idx = verts.index(u)\n-            return katz_values[0][idx]\n-\n-        Kdict = {}\n-        Kdict = {u: katz_values[0][i] for i, u in enumerate(verts)}\n-\n-        if u is None:\n-            return Kdict\n-        else :\n-            return Kdict[u]\n+        if u:\n+            return katz_values[0][verts.index(u)]\n+        return {u: katz_values[0][i] for i, u in enumerate(verts)}\n```\n",
    "created_at": "2019-03-11T15:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334125",
    "user": "https://github.com/dcoudert"
}
```

Please check carefully your code, that comments are in 80 columns mode, if possible that you follow the PEP8 coding style, that the comments are sufficient and helpful to the user, and that your code is best possible.

for instance, you have apparently not double check this part:

```diff
-        if u :
-            idx = verts.index(u)
-            return katz_values[0][idx]
-
-        Kdict = {}
-        Kdict = {u: katz_values[0][i] for i, u in enumerate(verts)}
-
-        if u is None:
-            return Kdict
-        else :
-            return Kdict[u]
+        if u:
+            return katz_values[0][verts.index(u)]
+        return {u: katz_values[0][i] for i, u in enumerate(verts)}
```




---

archive/issue_comments_334126.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-11T15:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334126",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_334127.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T16:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T16:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334129.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-11T16:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334129",
    "user": "https://github.com/rajat1433"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_334130.json:
```json
{
    "body": "- except in the names of the method, use `Katz` and not `katz` everywhere.\n- remove trailing white spaces\n- you should rephrase the description of method `katz_matrix` to first give the definition of this centrality measure, and then explain what's the returned matrix.\n- Avoid having too many empty lines like this. 1 is often enough\n\n```\n+\n+\n+\n```\n\n- remove the `.` at the end of error messages\n- `if alpha <=  0:` -> `if alpha <= 0:`\n- \n\n```diff\n-        We compute katz_centrality for the undirected 4-cycle again (note that \n+        We compute the Katz centrality of a 4-cycle (note that \n```\n\n- \n\n```diff\n-        Return the katz centrality of the vertex u of the graph.\n+        Return the Katz centrality of vertex `u`.\n```\n\n- there is a `\u03b1`. It should be ok, but it might be safer to use `\\alpha`.",
    "created_at": "2019-03-12T08:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334130",
    "user": "https://github.com/dcoudert"
}
```

- except in the names of the method, use `Katz` and not `katz` everywhere.
- remove trailing white spaces
- you should rephrase the description of method `katz_matrix` to first give the definition of this centrality measure, and then explain what's the returned matrix.
- Avoid having too many empty lines like this. 1 is often enough

```
+
+
+
```

- remove the `.` at the end of error messages
- `if alpha <=  0:` -> `if alpha <= 0:`
- 

```diff
-        We compute katz_centrality for the undirected 4-cycle again (note that 
+        We compute the Katz centrality of a 4-cycle (note that 
```

- 

```diff
-        Return the katz centrality of the vertex u of the graph.
+        Return the Katz centrality of vertex `u`.
```

- there is a `α`. It should be ok, but it might be safer to use `\alpha`.



---

archive/issue_comments_334131.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-12T09:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334132.json:
```json
{
    "body": "Thanks for the review , I have fixed the coding style bugs.",
    "created_at": "2019-03-12T09:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334132",
    "user": "https://github.com/rajat1433"
}
```

Thanks for the review , I have fixed the coding style bugs.



---

archive/issue_comments_334133.json:
```json
{
    "body": "- to use latex in the documentation, you must write ``\\alpha``, and not only `\\alpha`. Using `r\"\"\"` and then ``...`` indicates to use latex.\n\n- in `katz_centrality`, when you ask for the centrality of a vertex `u`, you first compute `katz_values = (M*matrix(QQ, n, 1, lambda i, j: 1)).transpose()`. However, if I understand well the definition of the Katz matrix, it suffices to make the some of the values of a particular row (or column), right ? If so, you could avoid the matrix multiplication when asking for a single value.\n\n- also, a `.` and a ` ` to remove\n\n```diff\n-          reciprocal of the spectral radius of the graph. (the maximum\n-          absolute eigenvalue of the adjacency matrix )\n+          reciprocal of the spectral radius of the graph (the maximum\n+          absolute eigenvalue of the adjacency matrix)\n```\n",
    "created_at": "2019-03-12T10:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334133",
    "user": "https://github.com/dcoudert"
}
```

- to use latex in the documentation, you must write ``\alpha``, and not only `\alpha`. Using `r"""` and then ``...`` indicates to use latex.

- in `katz_centrality`, when you ask for the centrality of a vertex `u`, you first compute `katz_values = (M*matrix(QQ, n, 1, lambda i, j: 1)).transpose()`. However, if I understand well the definition of the Katz matrix, it suffices to make the some of the values of a particular row (or column), right ? If so, you could avoid the matrix multiplication when asking for a single value.

- also, a `.` and a ` ` to remove

```diff
-          reciprocal of the spectral radius of the graph. (the maximum
-          absolute eigenvalue of the adjacency matrix )
+          reciprocal of the spectral radius of the graph (the maximum
+          absolute eigenvalue of the adjacency matrix)
```




---

archive/issue_comments_334134.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-12T10:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334134",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334135.json:
```json
{
    "body": "I have used sum function now and eliminated the multiplication step. I guess it give better complexity now in terms of space and time specially for a single vertex case.",
    "created_at": "2019-03-12T11:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334135",
    "user": "https://github.com/rajat1433"
}
```

I have used sum function now and eliminated the multiplication step. I guess it give better complexity now in terms of space and time specially for a single vertex case.



---

archive/issue_comments_334136.json:
```json
{
    "body": "This is much better now. We certainly same some computation time (but see point below). For the space complexity, it remains in `O(n^2)` as we compute the Katz matrix in all cases.\n\n- The test `if u and u not in self:` must be done before computing `verts = list(self)` and more importantly the computation of the Katz matrix.\n\nI have now more algorithmic questions (more interesting than coding style :P):\n\n- What is the expected answer when the graph is not connected ? May be we can save computation time if the answer is always 0 for vertices in different components ?\n\n- Same question for strongly connected digraphs? In the example, vertices 1, 2, 3, 7, 9 have no in-neighbors and vertex 4 has no out-neighbor. When you will get an answer, you should document the example explaining why some values are 0.",
    "created_at": "2019-03-12T12:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334136",
    "user": "https://github.com/dcoudert"
}
```

This is much better now. We certainly same some computation time (but see point below). For the space complexity, it remains in `O(n^2)` as we compute the Katz matrix in all cases.

- The test `if u and u not in self:` must be done before computing `verts = list(self)` and more importantly the computation of the Katz matrix.

I have now more algorithmic questions (more interesting than coding style :P):

- What is the expected answer when the graph is not connected ? May be we can save computation time if the answer is always 0 for vertices in different components ?

- Same question for strongly connected digraphs? In the example, vertices 1, 2, 3, 7, 9 have no in-neighbors and vertex 4 has no out-neighbor. When you will get an answer, you should document the example explaining why some values are 0.



---

archive/issue_comments_334137.json:
```json
{
    "body": "''What is the expected answer when the graph is not connected ? May be we can save computation time if the answer is always 0 for vertices in different components ? \n''\n\n- When graph is not connected answer for a particular vertex is only dependent on the vertices in its connected component only and not in the other component. So yes we really can do optimize here. Will work on that.\n\n\n*Same question for strongly connected digraphs? In the example, vertices 1, 2, 3, 7, 9 have no in-neighbors and vertex 4 has no out-neighbor. When you will get an answer, you should document the example explaining why some values are 0.* \n\n\n- for strongly connected Digraph the answer will be non zero for every node. Also for any node with in-neighbors 0 the answer will be 0 as its the very essence of katz centrality to measure influence of an actor(node here) in a social network.\nWill document the example with reasoning.",
    "created_at": "2019-03-12T12:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334137",
    "user": "https://github.com/rajat1433"
}
```

''What is the expected answer when the graph is not connected ? May be we can save computation time if the answer is always 0 for vertices in different components ? 
''

- When graph is not connected answer for a particular vertex is only dependent on the vertices in its connected component only and not in the other component. So yes we really can do optimize here. Will work on that.


*Same question for strongly connected digraphs? In the example, vertices 1, 2, 3, 7, 9 have no in-neighbors and vertex 4 has no out-neighbor. When you will get an answer, you should document the example explaining why some values are 0.* 


- for strongly connected Digraph the answer will be non zero for every node. Also for any node with in-neighbors 0 the answer will be 0 as its the very essence of katz centrality to measure influence of an actor(node here) in a social network.
Will document the example with reasoning.



---

archive/issue_comments_334138.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-12T13:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-12T13:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334140.json:
```json
{
    "body": "* You can get the connected component containing vertex u directly using `C = G.connected_component_containing_vertex(u, sort=False)`.\n\n  Then you must compute the Katz matrix of the subgraph, i.e., `self.subgraph(C)`.\n\n\n```\nif u:\n    if self.is_connected():\n        G = self\n    else:\n        G = self.subgraph(self.connected_component_containing_vertex(u, sort=False))\n        verts = list(G)\n    M = G.katz_matrix(alpha, nonedgesonly=False, vertices=verts)\n    return sum(M[verts.index(u)])\n```\n\n\n* When you compute the Katz centrality of all vertices, you want the union of the Katz centralities of each subgraph. You can use `self.connected_components_subgraphs()`",
    "created_at": "2019-03-13T10:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334140",
    "user": "https://github.com/dcoudert"
}
```

* You can get the connected component containing vertex u directly using `C = G.connected_component_containing_vertex(u, sort=False)`.

  Then you must compute the Katz matrix of the subgraph, i.e., `self.subgraph(C)`.


```
if u:
    if self.is_connected():
        G = self
    else:
        G = self.subgraph(self.connected_component_containing_vertex(u, sort=False))
        verts = list(G)
    M = G.katz_matrix(alpha, nonedgesonly=False, vertices=verts)
    return sum(M[verts.index(u)])
```


* When you compute the Katz centrality of all vertices, you want the union of the Katz centralities of each subgraph. You can use `self.connected_components_subgraphs()`



---

archive/issue_comments_334141.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-13T12:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334142.json:
```json
{
    "body": "I have optimized the code as per the review.",
    "created_at": "2019-03-13T12:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334142",
    "user": "https://github.com/rajat1433"
}
```

I have optimized the code as per the review.



---

archive/issue_comments_334143.json:
```json
{
    "body": "Please double check your code and test it ! it contains obvious errors.\n\nYou can write directly `for g in self.connected_components_subgraphs()`\n\nAdd a doctest with a non connected graph, e.g., `graphs.PathGraph(3) + graphs.PathGraph(4)`.",
    "created_at": "2019-03-13T12:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334143",
    "user": "https://github.com/dcoudert"
}
```

Please double check your code and test it ! it contains obvious errors.

You can write directly `for g in self.connected_components_subgraphs()`

Add a doctest with a non connected graph, e.g., `graphs.PathGraph(3) + graphs.PathGraph(4)`.



---

archive/issue_comments_334144.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-13T14:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334145.json:
```json
{
    "body": "I am really sorry about the previous errors. Now its fixed and well tested.",
    "created_at": "2019-03-13T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334145",
    "user": "https://github.com/rajat1433"
}
```

I am really sorry about the previous errors. Now its fixed and well tested.



---

archive/issue_comments_334146.json:
```json
{
    "body": "Could you change the example to `sage: (graphs.PathGraph(3) + graphs.PathGraph(4)).katz_centrality(1/20)`. This is to show that the values for the vertices in the P3 and in the P4 are the same than in previous examples.",
    "created_at": "2019-03-13T14:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334146",
    "user": "https://github.com/dcoudert"
}
```

Could you change the example to `sage: (graphs.PathGraph(3) + graphs.PathGraph(4)).katz_centrality(1/20)`. This is to show that the values for the vertices in the P3 and in the P4 are the same than in previous examples.



---

archive/issue_comments_334147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-13T15:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334148.json:
```json
{
    "body": "*Could you change the example to sage: (graphs.PathGraph(3) + graphs.PathGraph(4)).katz_centrality(1/20). This is to show that the values for the vertices in the P3 and in the P4 are the same than in previous examples.* \n\nDone!",
    "created_at": "2019-03-13T15:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334148",
    "user": "https://github.com/rajat1433"
}
```

*Could you change the example to sage: (graphs.PathGraph(3) + graphs.PathGraph(4)).katz_centrality(1/20). This is to show that the values for the vertices in the P3 and in the P4 are the same than in previous examples.* 

Done!



---

archive/issue_comments_334149.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-13T17:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334149",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_334150.json:
```json
{
    "body": "Further speed up improvements can certainly be obtained, but I don't know how.\n\nFor me this patch is good to go.",
    "created_at": "2019-03-13T17:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334150",
    "user": "https://github.com/dcoudert"
}
```

Further speed up improvements can certainly be obtained, but I don't know how.

For me this patch is good to go.



---

archive/issue_events_022336.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-14T18:13:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23864#event-22336"
}
```



---

archive/issue_comments_334151.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-14T18:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23864#issuecomment-334151",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
