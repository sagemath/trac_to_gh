# Issue 22765: Make bridges method for graphs an iterator

Issue created by migration from https://trac.sagemath.org/ticket/23002

Original creator: tmonteil

Original creation time: 2017-05-15 10:03:25

CC:  tpetiteau cchretien dcoudert

The bridges method for graphs returns a list. Here we return an iterator.


---

Comment by tmonteil created at 2017-05-15 10:08:23

New commits:


---

Comment by tmonteil created at 2017-05-15 10:08:23

Changing status from new to needs_review.


---

Comment by dcoudert created at 2017-05-15 11:06:39

What's the motivation for this change ?


---

Comment by tmonteil created at 2017-05-15 12:29:57

Today, i am meeting two students who did some Sage development and show them how to contribute their code (related to spanning-trees for digraphs and sandpiles), so we took an existing method and i explained the whole git/trac process, and since we were discussing the difference list/iterator, we chosed that one. So, indeed, this is not an important change regarding Sage, but it has some pedagogical interest.

Wile being a minor improvement, this commit adds some tests to that method ; also, when possible, iterators are prefered over lists, as they save a lot of memory while being as fast, which can be critical for some backtracking or search algorithms, where such constructions can be stacked.

This is becoming the default case with Python3, where even `range` becomes an iterator. Ideally, most method should behave that way (when there is no cost). In particular, in the longer term, i am in favor to replace things like `neighbor_iterator` by `neighbors` and `neighbors` by nothing, while the user can write `list(G.neighbors())` if she explicitely wants to store the whole stuff for reuse.


---

Comment by dcoudert created at 2017-05-15 12:41:21

ok, I understand the motivation. It will certainly be a very hard task to change all the graph module. It is not always easy/possible to do. See for instance #22613.

Q: do you also plan to ask your students to review this ticket? the code looks good to me.


---

Comment by tmonteil created at 2017-05-15 13:42:56

Replying to [comment:5 dcoudert]:
> ok, I understand the motivation. It will certainly be a very hard task to change all the graph module. It is not always easy/possible to do. See for instance #22613.

Agree, it is especially unfeasible for things that require recurrent access to data (e.g. dynamic programming).

> Q: do you also plan to ask your students to review this ticket? the code looks good to me.

If it is OK for you, go ahead, i guess it is better for them to first create tickets and recieve lots of comments from experienced devs about their code (doctests, naming conventions, ...).


---

Comment by tscrim created at 2017-05-15 13:43:56

A quick comments: Instead of `raise StopIteration`, you should simply have a `return`. Also, while you are at is, change `Returns` -> `Return` in the 1-line docstring.

A more serious comment: This is a backwards incompatible change. So I would instead introduce a new method `bridges_iterator` similar to other methods in graphs (e.g., `degree`, `subgraph_search`, `edge_iterator`/`edges`).


---

Comment by tmonteil created at 2017-05-15 14:15:20

Replying to [comment:7 tscrim]:
> A quick comments: Instead of `raise StopIteration`, you should simply have a `return`. Also, while you are at is, change `Returns` -> `Return` in the 1-line docstring.

Thanks, this indeed cleaner, i will do it.

> A more serious comment: This is a backwards incompatible change. So I would instead introduce a new method `bridges_iterator` similar to other methods in graphs (e.g., `degree`, `subgraph_search`, `edge_iterator`/`edges`).

Well, i am more in favor to remove the `_iterator` in other methods as explained in comment:4 or we are going to get entangled. When we will move to Python 3, should we define a `range_iterator` wrapper ?

Regarding the `edges` method, returning a list has a very bad side effect: a list is an iterable but also a container, but the containment is ill-defined for graphs:


```
sage: G = graphs.PetersenGraph()
sage: (0, 1) in G.edges(labels=False)
True
sage: (1,0) in G.edges(labels=False)
False
sage: G.has_edge((1,0))
True
```


This causes a lot of troubles as it does not even raise a warning.

My longer term plans would be to define an `edge()` view (à la `numpy`), with `__contains__` pointing to `has_edge`, and `__iter__` pointing to `edge_iterator`, so that every feature works correctly with a 	pleasant syntax.


---

Comment by git created at 2017-05-15 14:46:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-05-15 15:10:31

you wrote in the test section: `g.bridges().next()`. Isn't it better to write `next(g.bridges())` in Python3 ?


---

Comment by git created at 2017-05-15 15:23:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2017-05-15 15:23:45

Replying to [comment:10 dcoudert]:
> you wrote in the test section: `g.bridges().next()`. Isn't it better to write `next(g.bridges())` in Python3 ?

Indeed !


---

Comment by tscrim created at 2017-05-15 16:32:48

Replying to [comment:8 tmonteil]:
> Replying to [comment:7 tscrim]:
> > A more serious comment: This is a backwards incompatible change. So I would instead introduce a new method `bridges_iterator` similar to other methods in graphs (e.g., `degree`, `subgraph_search`, `edge_iterator`/`edges`).
> 
> Well, i am more in favor to remove the `_iterator` in other methods as explained in comment:4 or we are going to get entangled. When we will move to Python 3, should we define a `range_iterator` wrapper ?

I do not disagree with this, but at this point we should try to be as consistent as possible. If we are going to change the behavior, we should do it for all or most such methods at once to reduce the backwards breaking shock. Although we could put a deprecation warning in `bridges` to say it will return an iterator and while we add the `bridges_iterator`, we add it with a deprecation as well saying we will just have an iterator version of `bridges` in a year.

> Regarding the `edges` method, returning a list has a very bad side effect: a list is an iterable but also a container, but the containment is ill-defined for graphs:
> 
> {{{
> sage: G = graphs.PetersenGraph()
> sage: (0, 1) in G.edges(labels=False)
> True
> sage: (1,0) in G.edges(labels=False)
> False
> sage: G.has_edge((1,0))
> True
> }}}
> 
> This causes a lot of troubles as it does not even raise a warning.
>
> My longer term plans would be to define an `edge()` view (à la `numpy`), with `__contains__` pointing to `has_edge`, and `__iter__` pointing to `edge_iterator`, so that every feature works correctly with a 	pleasant syntax.

That one is a much harder and more subtle issue (which deserves a separate ticket). My first thought was basically what you are suggesting too. +1


---

Comment by vdelecroix created at 2017-05-22 18:10:44

Replying to [comment:13 tscrim]:
> Replying to [comment:8 tmonteil]:
> > Replying to [comment:7 tscrim]:
> > > A more serious comment: This is a backwards incompatible change. So I would instead introduce a new method `bridges_iterator` similar to other methods in graphs (e.g., `degree`, `subgraph_search`, `edge_iterator`/`edges`).
> > 
> > Well, i am more in favor to remove the `_iterator` in other methods as explained in comment:4 or we are going to get entangled. When we will move to Python 3, should we define a `range_iterator` wrapper ?
> 
> I do not disagree with this, but at this point we should try to be as consistent as possible. If we are going to change the behavior, we should do it for all or most such methods at once to reduce the backwards breaking shock. Although we could put a deprecation warning in `bridges` to say it will return an iterator and while we add the `bridges_iterator`, we add it with a deprecation as well saying we will just have an iterator version of `bridges` in a year.

There will be no deprecation warning to say that we switch to Python3 (which is the next stable release). Hence I don't feel like we need something to advertise the switch. However, I agree that doing it all at once in sage 8.0 for all methods that we want to be converted would be much better.


---

Comment by tscrim created at 2017-05-22 18:36:23

I am pretty sure we are _not_ switching to Python3 in 8.0. The big changes are the default notebook and support for Cygwin. We still have a bit of work before we are ready to be Python3 compatible, but that isn't way off in the future now.

However, I think there are still differences between Python's view objects and true iterators being returned. Plus, `list` will still be perfectly valid in Python3, so changing to an iterator is still a separate can of worms in my mind.


---

Comment by dcoudert created at 2017-05-23 07:41:08

[comment:8](https://trac.sagemath.org/ticket/23002#comment:8) makes me realize that the `bridges` method makes the strong assumption that not only edges are ordered (we use `(0, 1)` and not `(1,0)`) but also blocks (we have block `[0, 1]` and not block `[1, 0]`). If we want to strengthen the method to avoid future problems, we could make `ME` a graph and then use `ME.has_edge(tuple(b))`,  or use a faster method if any.

Then we should conclude on this ticket. Either we decide that we continue the current practice and create method `bridge_iterator`, or we consider that as a first step toward turning all methods to iterators we start with `bridges`.


---

Comment by tscrim created at 2017-05-24 21:44:59

A view/container object is not the same as an iterator; in particular, you (can) have a `__contains__` method. So changing the output to be an iterator would still be a backwards incompatible change. Yet, a view/container object would only be if there was no `__contains__`, but not having that would defeat its purpose.

I'm still -1 on making this into an iterator and say we should keep the current practice of having an iterator method.


---

Comment by heluani created at 2020-08-25 20:57:06

Changing status from needs_review to needs_work.


---

Comment by heluani created at 2020-08-25 20:57:06

red branch


---

Comment by git created at 2020-08-28 19:56:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tmonteil created at 2020-08-28 19:57:14

Changing status from needs_work to needs_review.


---

Comment by tmonteil created at 2020-08-28 19:57:14

Replying to [comment:18 heluani]:
> red branch

green again :)


---

Comment by dcoudert created at 2020-08-28 20:33:01


```diff
-        sage: list(list(bridges(g)))
+        sage: list(bridges(g))
```



---

Comment by git created at 2020-08-28 20:48:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2020-08-28 20:48:51

Replying to [comment:21 dcoudert]:
> {{{#!diff
> -        sage: list(list(bridges(g)))
> +        sage: list(bridges(g))
> }}}

Oops, thanks for pointing !


---

Comment by dcoudert created at 2020-08-28 21:03:13

LGTM.


---

Comment by dcoudert created at 2020-08-28 21:03:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-09-01 23:00:14

Resolution: fixed
