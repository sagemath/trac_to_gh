# Issue 24284: Abelian Groups with Gap

Issue created by migration from Trac.

Original creator: sbrandhorst

Original creation time: 2018-01-11 17:01:34

CC:  vbraun tscrim

Interface our abelian groups with the abelian groups in gap through 
libgap. 



---

Comment by tscrim created at 2018-01-11 19:15:50

New commits:


---

Comment by git created at 2018-01-12 16:06:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-01-12 16:06:57

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-01-12 19:21:20

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-01-12 19:21:20

Some comments:

- A number of your 1-line descriptions are missing periods/full-stops at the end.
- `AbelianGroupElement_gap.__reduce__` is missing `EXAMPLES::` or `TESTS::`. (Is this method necessary?)
- Your `INPUT:` and `OUTPUT:` blocks are over-indented.
- `AbelianGroup_gap.__init__` is missing documentation. I would recommend having the `TestSuite` test there and in the class-level doc having an actual example(s) of how to construct and use the class.
- the `- ``A`` -- an `AbelianGroup`` means that "AbelianGroup" is latex formatting (needs 2 backticks on both sides), but I don't understand why you do not link to the specific class (or construction function) in Sage.
- There should not be a `__hash__` function because that should be handled by `UniqueRepresentation`.
- `_coerce_map_from_` is missing documentation.
- I do not understand the `sage` method.
- The `OUTPUT:` of `subgroup` is strange. I understand why you are saying that (most subgroups do not keep track of their ambient group(s)), but it reads very awkwardly.
- `elementary_divisors` does not have any doctests.


---

Comment by git created at 2018-01-12 21:02:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-01-12 21:05:04

Thank you for your comments. 

I guess you are right the .sage method makes little sense. I will replace it by a coercion to the sage implementation.


---

Comment by git created at 2018-01-16 17:50:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-17 10:42:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-17 10:46:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-17 11:21:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-01-17 11:22:39

Changing status from needs_work to needs_review.


---

Comment by sbrandhorst created at 2018-01-17 11:25:37

the `__reduce__` methods are necessary. In sage.groups.libgap_wrapper:
"
   Your implementation definitely needs to supply

    * ``__reduce__()``: serialize the LibGAP group. Since GAP does not
      support Python pickles natively, you need to figure out yourself
      how you can recreate the group from a pickle.
"


---

Comment by git created at 2018-01-17 17:49:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-01-17 18:50:49

If you look at the diff you can see

```
\ No newline at end of file
```

That needs to be fixed


---

Comment by chapoton created at 2018-01-17 20:21:00

what about the related #2153 (just resurrected from long ago) ?


---

Comment by sbrandhorst created at 2018-01-18 07:15:16

Interesting I was not aware of that. Do you suggest introducing homsets?


---

Comment by git created at 2018-01-18 18:05:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-18 18:19:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-28 08:53:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-02-04 09:18:13

I finally found some time to make it through this ticket. Here is a synopsis of my changes:

- I simplified the overall logic by renaming `AbelianGroupAmbient_gap` to `AbelianGroupGap` and made this is the main entry point as `UniqueRepresentation` can handle processing input.
- I got rid of the `_with_pc` flag that was basically unused except for defining the behavior of `exponents`, but that is much better handled by a subclass IMO.
- I only use `Polycyclic` when it is necessary and error out when unable to import. Previously, there was a subtle change of a behavior only really noticeable because `Polycyclic` generators are `g1` whereas the usual libgap's are `f1` once `gap_packages` was installed.
- I fixed a bug where finite subgroups were placed in the category of infinite groups.
- Other misc doc and formatting changes.
----
New commits:


---

Comment by tscrim created at 2018-02-04 09:18:58

If my changes are good to you, then positive review.


---

Comment by git created at 2018-02-04 15:25:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-02-04 15:30:56

Thank you for the careful review. I did not know about `__classcall_private__`.
Your changes look good.

Positive review from my side if you are happy with my changes in `exponents`.

A question: what is the purpose of 
`return super(AbelianGroup_gap, self)._coerce_map_from_(S)`
in `_coerce_map_from_` ? I do not quite understand it.


---

Comment by tscrim created at 2018-02-04 20:23:04

Replying to [comment:24 sbrandhorst]:
> Positive review from my side if you are happy with my changes in `exponents`.

LGTM. Thanks.

> A question: what is the purpose of 
> `return super(AbelianGroup_gap, self)._coerce_map_from_(S)`
> in `_coerce_map_from_` ? I do not quite understand it.

It makes a call up to the closest base class's implementation of `_coerce_map_from_`. In this case, it is most likely calling the default one from `Parent`, which simply returns `None`. Yet, perhaps at some point in the future, one of the base classes will implement a more generic coercion check that this class can benefit from.


---

Comment by tscrim created at 2018-02-04 20:23:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-06 08:04:55

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-02-06 08:04:55


```
sage -t --long src/sage/groups/abelian_gps/abelian_group_gap.py
**********************************************************************
File "src/sage/groups/abelian_gps/abelian_group_gap.py", line 701, in sage.groups.abelian_gps.abelian_group_gap.AbelianGroupSubgroup_gap.__init__
Failed example:
    G = AbelianGroupGap([2,3,0])
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 534, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 937, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.abelian_gps.abelian_group_gap.AbelianGroupSubgroup_gap.__init__[5]>", line 1, in <module>
        G = AbelianGroupGap([Integer(2),Integer(3),Integer(0)])
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1590)
        return cls.classcall(cls, *args, **kwds)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/groups/abelian_gps/abelian_group_gap.py", line 599, in __classcall_private__
        return super(AbelianGroupGap, cls).__classcall__(cls, generator_orders)
      File "sage/misc/cachefunc.pyx", line 1059, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6246)
        w = self.f(*args, **kwds)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/structure/unique_representation.py", line 1021, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 497, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2040)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/groups/abelian_gps/abelian_group_gap.py", line 614, in __init__
        raise ImportError("unable to import polycyclic package")
    ImportError: unable to import polycyclic package
**********************************************************************
```



---

Comment by git created at 2018-02-06 08:21:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-02-06 08:21:51

Changing status from needs_work to needs_review.


---

Comment by sbrandhorst created at 2018-02-06 08:23:13

Thank you Volker. Let us see what the bot has to say.


---

Comment by tscrim created at 2018-02-06 08:28:15

Whoops, my bad. Forgot to add those. Green patchbot => positive review.


---

Comment by tscrim created at 2018-02-06 12:22:47

Changing status from needs_review to positive_review.


---

Comment by git created at 2018-02-09 14:17:44

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2018-02-09 14:17:44

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2018-02-09 20:49:30

I'm guessing there was a merge conflict? Otherwise you did not have to merge in the latest `develop`.


---

Comment by tscrim created at 2018-02-09 20:49:30

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2018-02-10 08:46:18

I am just tired to switch between different versions of sage all the time and recompile everything for hours. So I just keep all my branches up to date with the newest beta.


---

Comment by vbraun created at 2018-02-11 13:04:08

Resolution: fixed
