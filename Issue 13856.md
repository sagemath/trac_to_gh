# Issue 13856: Some elliptic curve functions fail since pari_curve is created with insufficient precision

Issue created by migration from https://trac.sagemath.org/ticket/14060

Original creator: cremona

Original creation time: 2013-02-05 11:56:34

Assignee: cremona

CC:  wuthrich

Keywords: pari precision

This fails on a 32-bit machine (Sage-5.6):

```
sage: EllipticCurve([0, -1, 0, -360796668980, 83414685883377400]).minimal_quadratic_twist()
```

because it results in pari_curve() being called on some curves with no attempt to catch insufficient precision.

Two things needs fixing:  (1) Making sure that all calls to pari_curve() deal with this precision issue properly;  (2) a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much rwork as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal twist, but not necessarily a quadratic twist, so the documentation (or function name, or something) needs correcting.


---

Comment by jdemeyer created at 2014-01-09 21:07:19

Precision issue is #13163.


---

Comment by cremona created at 2014-01-11 16:21:20

I see two possibilities here:  either rename this function `minimal_twist()` and return (as it does now) a curve which may be a sextic or quartic twist when j=0 or j=1728;   or keep this name and be more restrictive for those j-invariants so that the returned curve literally is a quadratic twist.  A third possibility is to have both named functions, doing the same thing unless j=0 or j=1728.

I am CC-ing Chris W since the only place where this function is used (according to `search_src()`) is in `sha_tate.py`, line 540, and whatever we do must be compatible with what is needed there!

Of course this is in addition to adding one line to return self of `self.conductor().is_squarefree()`.


---

Comment by wuthrich created at 2014-01-11 16:38:00

In sha_tate and in general for p-adic L-functions we can only twist by quadratic characters (well, I can only, maybe someone else knows more). So if changing the function one has to be careful to twist only by quadratic twists for these two cm curves. But if I remember correctly, we currently exclude cm curve (which we would not have to do in fact).


---

Comment by cremona created at 2014-01-11 17:05:54

Looking more carefully at the code (I am not embarrassed that I wrote it but could not remember) I see that for j=0 and j=1728 the curve returned is always a quadratic twist.  So the "additionally" part of the ticket's current description is incorrect.

If you agree with me on that (and a second opinion would be welcome!) then that just leaves the first part which I can easily implement by adding one line.


---

Comment by wuthrich created at 2014-01-11 17:17:31

We could have a minimal_twist function, too, if you wish, but I need minimal_quadratic_twist for modular symbols. If you can simplify the current function that is certainly a good thing to do.

I am not sure what changes you want to make, but if you do them, I should be able to look at them and review it quickly.

(from Besancon)


---

Comment by cremona created at 2014-01-11 18:13:16

Changing status from new to needs_review.


---

Comment by cremona created at 2014-01-11 18:13:16

I have implemented the small improvement (do nothing if the conductor is square-free) with a new doctest, and also expanded on the documentation in the exceptional cases j=0, 1728 to remove any confusion, with an example!

I decided not to implement a new `minimal_twist()` function since 

```
EllipticCurve(j=E.j_invariant())
```

does that.  But I could.
----
Last 10 new commits:


---

Comment by cremona created at 2014-01-11 18:15:50

There are lots of commits listed above, none of which is mine.  The relevant one, which you can see by clicking on the branch name, is dc07e494c5230bef1dd7e1a0df351194a03acb36 .


---

Comment by chapoton created at 2014-01-12 20:25:10

the `note` field is only indented by 3 spaces, there should be 4


---

Comment by wuthrich created at 2014-01-23 23:19:40

Changing status from needs_review to positive_review.


---

Comment by wuthrich created at 2014-01-23 23:19:40

I rebased it to the 6.1.beta6 in the hope that the extra merge commits above do not show anymore (even if they are harmless. 

Since all test then pass for me, I give it a positive review.
----
New commits:


---

Comment by wuthrich created at 2014-01-23 23:20:41

By the way, I believe there are 4 spaces before the ..note. No ? At least the html output seems ok.


---

Comment by cremona created at 2014-01-24 08:57:07

Replying to [comment:12 wuthrich]:
> By the way, I believe there are 4 spaces before the ..note. No ? At least the html output seems ok.

I don't know, I thought that not warnings were produced when building the docs but have forgotten.

Thanks for the review!


---

Comment by vbraun created at 2014-02-01 15:17:01

Resolution: fixed
