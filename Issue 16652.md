# Issue 16652: Doctest tolerance: allow spaces

archive/issues_016652.json:
```json
{
    "body": "CC:  @zimmermann6\n\nThe doctesting framework should ignore spaces before numbers when testing with `abs/rel tol`. There are two reasons why:\n\n1. The spacing of matrices is unpredictable. You could have\n\n```\n[1.0 0.0]\n[1.0 0.0]\n```\n\nvs\n\n```\n[0.999999 0.0]\n[     1.0 0.0]\n```\n\nNote the added space between `[` and `1.0`.\n\n2. Complex numbers or polynomials\n\n```\n1.0 + 1e-16*I\n```\n\nvs\n\n```\n1.0 - 1e-16*I\n```\n\nHere you want to compare ` + 1e-16` and ` - 1e-16` for your tolerance computations.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16889\n\n",
    "created_at": "2014-08-27T14:43:50Z",
    "labels": [
        "component: doctest framework",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Doctest tolerance: allow spaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16652",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @zimmermann6

The doctesting framework should ignore spaces before numbers when testing with `abs/rel tol`. There are two reasons why:

1. The spacing of matrices is unpredictable. You could have

```
[1.0 0.0]
[1.0 0.0]
```

vs

```
[0.999999 0.0]
[     1.0 0.0]
```

Note the added space between `[` and `1.0`.

2. Complex numbers or polynomials

```
1.0 + 1e-16*I
```

vs

```
1.0 - 1e-16*I
```

Here you want to compare ` + 1e-16` and ` - 1e-16` for your tolerance computations.

Issue created by migration from https://trac.sagemath.org/ticket/16889





---

archive/issue_comments_219508.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-27T16:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219508",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_219509.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-27T18:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_219510.json:
```json
{
    "body": "Paul Zimmermann: this needs a minor change to a French book doctest. When using `# tol`, you may no longer split doctest results like\n\n```\n1.5 -\n2.3\n```\n\nThe minus sign may not be on its own line, you need to write\n\n```\n1.5\n- 2.3\n```\n",
    "created_at": "2014-08-27T19:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219510",
    "user": "https://github.com/jdemeyer"
}
```

Paul Zimmermann: this needs a minor change to a French book doctest. When using `# tol`, you may no longer split doctest results like

```
1.5 -
2.3
```

The minus sign may not be on its own line, you need to write

```
1.5
- 2.3
```




---

archive/issue_comments_219511.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-27T19:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219511",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_219512.json:
```json
{
    "body": "in the source of the french book, I've changed to:\n\n```\n  [0.347521510119 + 0.566550553398*I, 0.347521510119 - 0.566550553398*I,\n  0.345023776962 + 0.439908702386*I, 0.345023776962 - 0.439908702386*I,\n  -0.517257614325 + 0.512958206789*I,\n  -0.517257614325 - 0.512958206789*I, -1.36699716455, -9.98357818097]\n```\n\nwhich uses the same number of lines, and should not make any overfull hbox.\nIs that ok?\n\nPaul",
    "created_at": "2014-08-27T20:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219512",
    "user": "https://github.com/zimmermann6"
}
```

in the source of the french book, I've changed to:

```
  [0.347521510119 + 0.566550553398*I, 0.347521510119 - 0.566550553398*I,
  0.345023776962 + 0.439908702386*I, 0.345023776962 - 0.439908702386*I,
  -0.517257614325 + 0.512958206789*I,
  -0.517257614325 - 0.512958206789*I, -1.36699716455, -9.98357818097]
```

which uses the same number of lines, and should not make any overfull hbox.
Is that ok?

Paul



---

archive/issue_comments_219513.json:
```json
{
    "body": "Replying to [comment:6 zimmerma]:\n> in the source of the french book, I've changed to:\n> {{{\n>   [0.347521510119 + 0.566550553398*I, 0.347521510119 - 0.566550553398*I,\n>   0.345023776962 + 0.439908702386*I, 0.345023776962 - 0.439908702386*I,\n>   -0.517257614325 + 0.512958206789*I,\n>   -0.517257614325 - 0.512958206789*I, -1.36699716455, -9.98357818097]\n> }}}\n> which uses the same number of lines, and should not make any overfull hbox.\n> Is that ok?\nYes, that would be good. However, note that Sage itself actually formats the results as in my patch, with one value per line.",
    "created_at": "2014-08-27T20:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219513",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 zimmerma]:
> in the source of the french book, I've changed to:
> {{{
>   [0.347521510119 + 0.566550553398*I, 0.347521510119 - 0.566550553398*I,
>   0.345023776962 + 0.439908702386*I, 0.345023776962 - 0.439908702386*I,
>   -0.517257614325 + 0.512958206789*I,
>   -0.517257614325 - 0.512958206789*I, -1.36699716455, -9.98357818097]
> }}}
> which uses the same number of lines, and should not make any overfull hbox.
> Is that ok?
Yes, that would be good. However, note that Sage itself actually formats the results as in my patch, with one value per line.



---

archive/issue_comments_219514.json:
```json
{
    "body": "ok, however in our book we allow ourselves not to follow 100% the Sage output format, up to spaces\nand line breaks, to save some vertical space.\n\nPaul",
    "created_at": "2014-08-27T20:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219514",
    "user": "https://github.com/zimmermann6"
}
```

ok, however in our book we allow ourselves not to follow 100% the Sage output format, up to spaces
and line breaks, to save some vertical space.

Paul



---

archive/issue_comments_219515.json:
```json
{
    "body": "Fun fact: this ticket relies on functionality added in 2006:\n\n```diff\ncommit 04043acc648e0bca14725f147b2040e204ae1f9b\nAuthor: William Stein <wstein@ucsd.edu>\nDate:   Mon May 29 01:10:56 2006 +0000\n\n    [project @ mpfr -- can coerce in numbers ignoring space, e.g. RR('1 E7') now works (which is what pari outputs!)]\n\ndiff --git a/src/sage/ext/mpfr.pyx b/src/sage/ext/mpfr.pyx\nindex 8f92208..afc9b72 100644\n--- a/src/sage/ext/mpfr.pyx\n+++ b/src/sage/ext/mpfr.pyx\n@@ -602,7 +602,7 @@ cdef class RealNumber(element.RingElement):\n             d = parent(x.denominator())\n             mpfr_div(self.value, n.value, d.value, parent.rnd)\n         else:\n-            s = str(x)\n+            s = str(x).replace(' ','')\n             if mpfr_set_str(self.value, s, base, parent.rnd):\n                 if s == 'NaN' or s == '@NaN@':\n                     mpfr_set_nan(self.value)\n```\n",
    "created_at": "2014-08-27T20:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219515",
    "user": "https://github.com/jdemeyer"
}
```

Fun fact: this ticket relies on functionality added in 2006:

```diff
commit 04043acc648e0bca14725f147b2040e204ae1f9b
Author: William Stein <wstein@ucsd.edu>
Date:   Mon May 29 01:10:56 2006 +0000

    [project @ mpfr -- can coerce in numbers ignoring space, e.g. RR('1 E7') now works (which is what pari outputs!)]

diff --git a/src/sage/ext/mpfr.pyx b/src/sage/ext/mpfr.pyx
index 8f92208..afc9b72 100644
--- a/src/sage/ext/mpfr.pyx
+++ b/src/sage/ext/mpfr.pyx
@@ -602,7 +602,7 @@ cdef class RealNumber(element.RingElement):
             d = parent(x.denominator())
             mpfr_div(self.value, n.value, d.value, parent.rnd)
         else:
-            s = str(x)
+            s = str(x).replace(' ','')
             if mpfr_set_str(self.value, s, base, parent.rnd):
                 if s == 'NaN' or s == '@NaN@':
                     mpfr_set_nan(self.value)
```




---

archive/issue_comments_219516.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-28T13:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219517.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-28T21:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219518.json:
```json
{
    "body": "This looks good to me. How about renaming the `tolerance.rst` to `must_fail.rst` or so and have an explanatory sentence about what is going on at the top. I fear that somebody will sooner or later \"fix\" the failing doctests if its not clear ;-)",
    "created_at": "2014-08-29T10:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219518",
    "user": "https://github.com/vbraun"
}
```

This looks good to me. How about renaming the `tolerance.rst` to `must_fail.rst` or so and have an explanatory sentence about what is going on at the top. I fear that somebody will sooner or later "fix" the failing doctests if its not clear ;-)



---

archive/issue_comments_219519.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-29T10:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219519",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219520.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-01T19:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219520",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_219521.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-09-01T21:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219521",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_219522.json:
```json
{
    "body": "Doctests fail because the line numbers are shifted, e.g. http://build.sagemath.org/sage/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2020%20x86_64%29%20incremental/builds/416/steps/shell_4/logs/stdio",
    "created_at": "2014-09-01T21:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219522",
    "user": "https://github.com/vbraun"
}
```

Doctests fail because the line numbers are shifted, e.g. http://build.sagemath.org/sage/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2020%20x86_64%29%20incremental/builds/416/steps/shell_4/logs/stdio



---

archive/issue_comments_219523.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-02T08:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219523",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_016127.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T11:03:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16652#event-16127"
}
```



---

archive/issue_comments_219524.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-06T11:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16652#issuecomment-219524",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
