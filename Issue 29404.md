# Issue 29404: spring cleanup in finite state machine

Issue created by migration from https://trac.sagemath.org/ticket/29641

Original creator: chapoton

Original creation time: 2020-05-03 15:58:49

CC:  tscrim

* some pep8 changes
* some changes suggested by lgtm (use self as first argument)
* some little tweaks in doc

Quite a lot of little changes


---

Comment by chapoton created at 2020-05-03 15:59:50

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-05-03 15:59:50

New commits:


---

Comment by chapoton created at 2020-05-04 05:24:50

green bot. Long and boring ticket, I'm afraid.


---

Comment by tscrim created at 2020-05-04 05:34:57

Two comments; everything else LGTM.

Is this faster?

```diff
+    return all(x == y for x, y in zip(list_, prefix))
 
-    return list[:len(prefix)] == prefix
```

(I agree with the first simple check.) I think most the lists are very small, so doing the slice shouldn't be a problem memory-wise. I would think using the direct list equality check would be faster than doing the Python iteration check.

Raising a `TypeError` in an `__eq__` seems like a bad practice to me. I think that should instead just return `False`.


---

Comment by git created at 2020-05-04 07:08:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-04 07:11:07

Voilà ! Merci !

I have just put back the original prefix comparison, without checking which was faster.


---

Comment by tscrim created at 2020-05-04 07:18:31

Thank you. However, there is one more place (at least from the diff) where an error is raised instead of returning `False` in `FiniteStateMachine.__eq__`.


---

Comment by git created at 2020-05-04 07:20:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-04 07:21:16

Ah, zut. Re-voilà. :)


---

Comment by tscrim created at 2020-05-04 07:28:30

Merci. Now to wait for the patchbot. Once green, then positive review.


---

Comment by chapoton created at 2020-05-04 15:54:17

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-05-04 15:54:17

bot is green, I am setting to positive. Thanks a lot, Travis!


---

Comment by vbraun created at 2020-05-31 15:20:49

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-05-31 15:20:49

Merge conflict


---

Comment by git created at 2020-05-31 16:13:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-31 16:13:42

trivial rebase, setting back to positive


---

Comment by chapoton created at 2020-05-31 16:13:42

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2020-06-01 07:24:23


```
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/var/lib/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 553, in _wrapper
[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)
[dochtml]   File "/var/lib/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 539, in _build_everything_except_bibliography
[dochtml]     build_many(build_ref_doc, non_references)
[dochtml]   File "/var/lib/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 281, in build_many
[dochtml]     _build_many(target, args, processes=NUM_THREADS)
[dochtml]   File "/var/lib/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage_setup/docbuild/utils.py", line 283, in build_many
[dochtml]     raise worker_exc.original_exception
[dochtml]   File "/var/lib/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage/combinat/finite_state_machine.py", line 4937
[dochtml]     if transitions):
[dochtml]                   ^
[dochtml] SyntaxError: invalid syntax
Makefile:2008: recipe for target 'doc-html-mathjax' failed
make[1]: *** [doc-html-mathjax] Error 1
make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build/build/make'
```



---

Comment by vbraun created at 2020-06-01 07:24:23

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2020-06-01 08:01:06


```diff
-if transitions):
+if transitions:
```



---

Comment by git created at 2020-06-01 08:30:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-06-01 08:31:36

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-06-01 08:31:36

fixed and tested, sorry. Back to "needs review", so that Travis can double check.


---

Comment by tscrim created at 2020-06-01 08:33:30

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-06-01 08:33:30

Good for me too. I guess it must have happened during the merge?


---

Comment by vbraun created at 2020-06-05 22:12:28

Resolution: fixed
