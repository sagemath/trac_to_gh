# Issue 24808: Add DESTDIR support for mpfr

Issue created by migration from https://trac.sagemath.org/ticket/25045

Original creator: embray

Original creation time: 2018-03-27 15:18:18

Keywords: destdir mpfr

Implements #24024 for mpfr.

This one is slightly non-trivial especially in how it uses multiple `configure` calls.  However, my local experiments show that it's just fine to use `sdh_configure` there all the same (though it isn't strictly necessary either).


---

Comment by embray created at 2018-03-27 15:18:51

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-03-29 07:53:34

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-03-29 07:53:34

Here, I see no reason to use `sdh_configure`. This is not the real `./configure` run, it is only needed to check some defaults:

```
        ./configure --with-gmp="$SAGE_LOCAL" $SAGE_CONF_OPTS $MPFR_CONFIGURE) &>/dev/null;
```


You don't need

```
Error configuring MPFR.
See above for the options passed to it, and the file
  $(pwd)/config.log
for details.
```

because `sdh_configure` can never fail (it either succeeds or exists the script).


---

Comment by embray created at 2018-03-29 08:58:41

Do we care about keeping that error message at all then?
(I'm not sure we do--the config.log file won't even exist unless built with `SAGE_KEEP_BUILT_SPKGS=yes`).


---

Comment by jdemeyer created at 2018-03-29 09:27:07

Replying to [comment:3 embray]:
> Do we care about keeping that error message at all then?

Ideally yes because the message saying to look at `config.log` is useful. But it should be put in `sdh_configure`, because it is generally useful for all packages using GNU configure. Of course, there should be a check that `config.log` exists.

> the config.log file won't even exist unless built with `SAGE_KEEP_BUILT_SPKGS=yes`.

Directories of a _failed_ build are kept anyway.


---

Comment by embray created at 2018-03-29 09:39:31

Oh, I didn't know that.  Or if I did I'd forgotten.  I could move that message to `sdh_configure`.  I agree it's useful in general, at least so long as we're talking standard autoconf.  

The one wrinkle might be that in principle `config.log` can be somewhere other than `$(pwd)/config.log`.  Sometimes it will be in some place like `$(pwd)/config/config.log`.  I could either try to search for a `config.log`, or just assume `$(pwd)/config.log` and only print the message if it exists.  For most cases that should probably suffice...


---

Comment by jdemeyer created at 2018-03-29 10:17:34

Replying to [comment:5 embray]:
> Sometimes it will be in some place like `$(pwd)/config/config.log`.

Are you sure? As far as I know, this cannot be customized with GNU autoconf.


---

Comment by embray created at 2018-03-29 14:16:59

You know, I seem to recall seeing that before, but I wonder if that was some kind of `AC_SUBDIRS` thing going on with a trivial top-level directory or something.  You're right that in general it can't be customized.  So that makes things simpler.


---

Comment by git created at 2018-04-04 08:41:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-04-04 08:41:42

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2018-07-17 15:40:51

Looks good to me (though it does a bit more than what it says in the ticket description.) Feel free to set this to positive review if you think that this still works.


---

Comment by embray created at 2018-07-17 17:35:17

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-07-18 11:47:03

I believe this issue can reasonably be addressed for Sage 8.4.


---

Comment by vbraun created at 2018-08-05 08:42:56

Resolution: fixed
