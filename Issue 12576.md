# Issue 12576: An inconsistent term order must not be accepted as input of a polynomial ring construction

archive/issues_012576.json:
```json
{
    "body": "Assignee: malb\n\nKeywords: polynomial ring termorder\n\n[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:\n\n```\nsage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])\nsage: x1 in I\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: Segmentation fault\n```\n\n\nSo, two problems:\n\n* I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.\n* One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12748\n\n",
    "created_at": "2012-03-26T05:33:11Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "title": "An inconsistent term order must not be accepted as input of a polynomial ring construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12576",
    "user": "SimonKing"
}
```
Assignee: malb

Keywords: polynomial ring termorder

[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:

```
sage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])
sage: x1 in I
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Segmentation fault
```


So, two problems:

* I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.
* One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.




Issue created by migration from https://trac.sagemath.org/ticket/12748





---

archive/issue_comments_149531.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149531",
    "user": "malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149532.json:
```json
{
    "body": "Attachment [trac_12748_term_order.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_term_order.patch) by malb created at 2012-04-13 18:41:27\n\nThe attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149532",
    "user": "malb"
}
```

Attachment [trac_12748_term_order.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_term_order.patch) by malb created at 2012-04-13 18:41:27

The attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.



---

archive/issue_comments_149533.json:
```json
{
    "body": "Towards a review:\n\n* The patch does apply to sage-5.0.beta13.\n* The fix looks fine to me.\n* I am now running `make test`, and at least the first couple of tests pass.\n* The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.",
    "created_at": "2012-04-15T07:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149533",
    "user": "SimonKing"
}
```

Towards a review:

* The patch does apply to sage-5.0.beta13.
* The fix looks fine to me.
* I am now running `make test`, and at least the first couple of tests pass.
* The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.



---

archive/issue_comments_149534.json:
```json
{
    "body": "All tests pass. Some criticism:\n\n* The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.\n* In fact, I think the error *should* be raised in the copy constructor.\n* One should use the :trac: directive.\n\nSo, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.",
    "created_at": "2012-04-15T09:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149534",
    "user": "SimonKing"
}
```

All tests pass. Some criticism:

* The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
* In fact, I think the error *should* be raised in the copy constructor.
* One should use the :trac: directive.

So, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.



---

archive/issue_comments_149535.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-04-15T10:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149535",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_149536.json:
```json
{
    "body": "I experimented with moving the error to the `__copy` method. However, it turns out that\n\n```\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed\n```\n\nbecause the copy method is called with (say) 6 variables on an input of (say) 5 variables.\n\nQuestion: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\nIf the answer is \"yes\", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.\n\nIf the answer is \"no\", then what shall we do? Apparently the `__copy` method *is* called with different numbers of variables. Shall we deal with that on a different ticket or here?",
    "created_at": "2012-04-15T10:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149536",
    "user": "SimonKing"
}
```

I experimented with moving the error to the `__copy` method. However, it turns out that

```
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed
```

because the copy method is called with (say) 6 variables on an input of (say) 5 variables.

Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

If the answer is "yes", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.

If the answer is "no", then what shall we do? Apparently the `__copy` method *is* called with different numbers of variables. Shall we deal with that on a different ticket or here?



---

archive/issue_comments_149537.json:
```json
{
    "body": "Replying to [comment:4 SimonKing]:\n> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\nThe following use cases come to mind:\n* homogenisation\n* specialisation of a ring to those variables actually appearing in a set of polynomials\n* `change_ring()` in general\n\nSo I vote \"yes\".",
    "created_at": "2012-04-15T11:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149537",
    "user": "malb"
}
```

Replying to [comment:4 SimonKing]:
> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

The following use cases come to mind:
* homogenisation
* specialisation of a ring to those variables actually appearing in a set of polynomials
* `change_ring()` in general

So I vote "yes".



---

archive/issue_comments_149538.json:
```json
{
    "body": "Replying to [comment:3 SimonKing]:\n> All tests pass. Some criticism:\n> \n>  * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.\n>  * In fact, I think the error *should* be raised in the copy constructor.\n\nMy emphasis was on copy **constructor**, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`\n\n>  * One should use the :trac: directive.\n\nAh, thanks for the reminder. I can updated the patch or review your reviewers patch.",
    "created_at": "2012-04-15T11:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149538",
    "user": "malb"
}
```

Replying to [comment:3 SimonKing]:
> All tests pass. Some criticism:
> 
>  * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
>  * In fact, I think the error *should* be raised in the copy constructor.

My emphasis was on copy **constructor**, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`

>  * One should use the :trac: directive.

Ah, thanks for the reminder. I can updated the patch or review your reviewers patch.



---

archive/issue_comments_149539.json:
```json
{
    "body": "Replying to [comment:5 malb]:\n> Replying to [comment:4 SimonKing]:\n> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n> \n> ...\n>\n> So I vote \"yes\".\n\nOK, then I'll simply produce a little reviewer patch...",
    "created_at": "2012-04-17T08:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149539",
    "user": "SimonKing"
}
```

Replying to [comment:5 malb]:
> Replying to [comment:4 SimonKing]:
> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?
> 
> ...
>
> So I vote "yes".

OK, then I'll simply produce a little reviewer patch...



---

archive/issue_comments_149540.json:
```json
{
    "body": "Attachment [trac_12748_reviewer.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_reviewer.patch) by SimonKing created at 2012-04-17 08:52:42",
    "created_at": "2012-04-17T08:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149540",
    "user": "SimonKing"
}
```

Attachment [trac_12748_reviewer.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_reviewer.patch) by SimonKing created at 2012-04-17 08:52:42



---

archive/issue_comments_149541.json:
```json
{
    "body": "The reviewer patch is up.",
    "created_at": "2012-04-17T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149541",
    "user": "SimonKing"
}
```

The reviewer patch is up.



---

archive/issue_comments_149542.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-04-17T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149542",
    "user": "SimonKing"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_149543.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-17T08:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149543",
    "user": "SimonKing"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149544.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-05-06T12:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12576#issuecomment-149544",
    "user": "jdemeyer"
}
```

Resolution: fixed
