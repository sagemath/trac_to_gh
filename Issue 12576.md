# Issue 12576: An inconsistent term order must not be accepted as input of a polynomial ring construction

Issue created by migration from https://trac.sagemath.org/ticket/12748

Original creator: SimonKing

Original creation time: 2012-03-26 05:33:11

Assignee: malb

Keywords: polynomial ring termorder

[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:

```
sage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])
sage: x1 in I
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Segmentation fault
```


So, two problems:

 * I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.
 * One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.





---

Comment by malb created at 2012-04-13 18:41:27

Changing status from new to needs_review.


---

Attachment

The attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.


---

Comment by SimonKing created at 2012-04-15 07:46:37

Towards a review:

 * The patch does apply to sage-5.0.beta13.
 * The fix looks fine to me.
 * I am now running `make test`, and at least the first couple of tests pass.
 * The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.


---

Comment by SimonKing created at 2012-04-15 09:54:05

All tests pass. Some criticism:

 * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
 * In fact, I think the error _should_ be raised in the copy constructor.
 * One should use the :trac: directive.

So, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.


---

Comment by SimonKing created at 2012-04-15 10:14:19

Changing status from needs_review to needs_info.


---

Comment by SimonKing created at 2012-04-15 10:14:19

I experimented with moving the error to the `__copy` method. However, it turns out that

```
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed
```

because the copy method is called with (say) 6 variables on an input of (say) 5 variables.

Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

If the answer is "yes", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.

If the answer is "no", then what shall we do? Apparently the `__copy` method _is_ called with different numbers of variables. Shall we deal with that on a different ticket or here?


---

Comment by malb created at 2012-04-15 11:08:11

Replying to [comment:4 SimonKing]:
> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

The following use cases come to mind:
 * homogenisation
 * specialisation of a ring to those variables actually appearing in a set of polynomials
 * `change_ring()` in general

So I vote "yes".


---

Comment by malb created at 2012-04-15 11:11:57

Replying to [comment:3 SimonKing]:
> All tests pass. Some criticism:
> 
>  * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
>  * In fact, I think the error _should_ be raised in the copy constructor.

My emphasis was on copy *constructor*, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`

>  * One should use the :trac: directive.

Ah, thanks for the reminder. I can updated the patch or review your reviewers patch.


---

Comment by SimonKing created at 2012-04-17 08:39:35

Replying to [comment:5 malb]:
> Replying to [comment:4 SimonKing]:
> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?
> 
> ...
>
> So I vote "yes".

OK, then I'll simply produce a little reviewer patch...


---

Attachment


---

Comment by SimonKing created at 2012-04-17 08:53:18

The reviewer patch is up.


---

Comment by SimonKing created at 2012-04-17 08:53:18

Changing status from needs_info to needs_review.


---

Comment by SimonKing created at 2012-04-17 08:53:29

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-05-06 12:16:28

Resolution: fixed
