# Issue 20879: Improve Sage's top-level 'configure'

Issue created by migration from https://trac.sagemath.org/ticket/21116

Original creator: leif

Original creation time: 2016-07-28 14:37:42

CC:  mkoeppe dimpase

Keywords: require check system python Xcode version

There are a couple of things which can (and should) be improved:

 * `configure` doesn't contain any check for `python` (and its version), despite Sage meanwhile requiring a _system_ python to build (until one of Sage's python packages has been built).  This is a critical defect on its own, but as we've been living with that since Sage 6.7 IIRC, I haven't made this issue a blocker.  (`sage-download-file` or `sage-uncompress-spkg` simply _won't run_ if there's _not any_ `python` in the PATH, but we cannot be sure they'll work properly with some random version.)

 * The checks for Xcode on Darwin (MacOS X) are presumably outdated, and `configure` eventually only gives warnings or hints.  (We should probably also check or deduce whether Xcode's default assembler is still Apple's ancient fork of the GNU assembler, which has major deficiencies, and install a wrapper script `$SAGE_LOCAL/bin/as` which invokes LLVM's more recent assembler in that case.  Then the GCC package won't have to deal with that, which it currently doesn't anyway, potentially leading to build errors caused by the assembler not supporting the instructions Sage's GCC emits.  The latter can also happen on (older) Linux distros when Sage's GCC gets built, though, so something not Darwin-specific should be added to GCC's spkg-install, too.)

 * The list of all Sage packages dumped near the end of `configure` lets any warning messages given earlier drown, so it's less likely people will notice them.  We could collect at least important warnings in order to give (or repeat) them at the end (a `configure` "summary" would IMHO be good anyway), and/or print more than one package name per line.

 * ... (There are quite certainly other things which could be improved.)


---

Comment by leif created at 2016-07-28 14:59:00

Regarding a wrapper script for the assembler on Darwin, see also #20779 (around [comment:ticket:20779:34 comment 34]).

Also _there_ is some reasoning about Darwin versions and Xcode versions ([comment:ticket:20779:49 comment 49 ff.]); in some cases we may want to *require* a newer version of Xcode, provided there's one available for the given Darwin version (for example Xcode 7.3 or later on El Capitan / MacOS X 10.11, which is not available for earlier versions of MacOS X).


---

Comment by leif created at 2016-07-28 16:08:27

Added "dynamic" exclusion of (in most cases dummy) packages like iconv, which we could handle just like the GCC package.


---

Comment by leif created at 2016-07-28 16:18:44

Correction:  Cephes is meanwhile solely built on FreeBSD, not even on Cygwin anymore.


---

Comment by leif created at 2016-07-28 16:21:30

P.S.:  Seems this rather gets a meta-ticket.


---

Comment by leif created at 2016-07-30 19:24:13

Added a note on the use of `PYTHON`, with which we again(!) pollute the environment.


---

Comment by mkoeppe created at 2016-10-30 06:34:23

For XCode - see also #21708.


---

Comment by dimpase created at 2017-03-24 00:12:25

Replying to [comment:3 leif]:
> Correction:  Cephes is meanwhile solely built on FreeBSD, not even on Cygwin anymore.

I am experimenting with FreeBSD 11.0, and there cephes nukes the Sage build.
(I had to remove `SAGE_LOCAL/bin/libm.so` it produces so that linking does not break)

Should we remove it as obsolete? It appears that new FreeBSD's libm is good enough.


---

Comment by dimpase created at 2017-03-27 16:12:39

Replying to [comment:7 dimpase]:
scratch this:

> Should we remove it as obsolete? It appears that new FreeBSD's libm is good enough.

there are still few functions from there missing on FreeBSD, see #22679


---

Comment by mkoeppe created at 2020-05-01 20:13:49

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-05-01 20:13:49

These issues appear to be all outdated, and the ticket should be closed.


---

Comment by dimpase created at 2020-05-02 04:46:35

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-05-02 04:46:35

ok


---

Comment by chapoton created at 2020-06-17 07:13:03

Resolution: invalid
