# Issue 20879: Improve Sage's top-level 'configure'

archive/issues_020879.json:
```json
{
    "body": "CC:  mkoeppe dimpase\n\nKeywords: require check system python Xcode version\n\nThere are a couple of things which can (and should) be improved:\n\n* `configure` doesn't contain any check for `python` (and its version), despite Sage meanwhile requiring a *system* python to build (until one of Sage's python packages has been built).  This is a critical defect on its own, but as we've been living with that since Sage 6.7 IIRC, I haven't made this issue a blocker.  (`sage-download-file` or `sage-uncompress-spkg` simply *won't run* if there's *not any* `python` in the PATH, but we cannot be sure they'll work properly with some random version.)\n\n* The checks for Xcode on Darwin (MacOS X) are presumably outdated, and `configure` eventually only gives warnings or hints.  (We should probably also check or deduce whether Xcode's default assembler is still Apple's ancient fork of the GNU assembler, which has major deficiencies, and install a wrapper script `$SAGE_LOCAL/bin/as` which invokes LLVM's more recent assembler in that case.  Then the GCC package won't have to deal with that, which it currently doesn't anyway, potentially leading to build errors caused by the assembler not supporting the instructions Sage's GCC emits.  The latter can also happen on (older) Linux distros when Sage's GCC gets built, though, so something not Darwin-specific should be added to GCC's spkg-install, too.)\n\n* The list of all Sage packages dumped near the end of `configure` lets any warning messages given earlier drown, so it's less likely people will notice them.  We could collect at least important warnings in order to give (or repeat) them at the end (a `configure` \"summary\" would IMHO be good anyway), and/or print more than one package name per line.\n\n* ... (There are quite certainly other things which could be improved.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/21116\n\n",
    "created_at": "2016-07-28T14:37:42Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Improve Sage's top-level 'configure'",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20879",
    "user": "leif"
}
```
CC:  mkoeppe dimpase

Keywords: require check system python Xcode version

There are a couple of things which can (and should) be improved:

* `configure` doesn't contain any check for `python` (and its version), despite Sage meanwhile requiring a *system* python to build (until one of Sage's python packages has been built).  This is a critical defect on its own, but as we've been living with that since Sage 6.7 IIRC, I haven't made this issue a blocker.  (`sage-download-file` or `sage-uncompress-spkg` simply *won't run* if there's *not any* `python` in the PATH, but we cannot be sure they'll work properly with some random version.)

* The checks for Xcode on Darwin (MacOS X) are presumably outdated, and `configure` eventually only gives warnings or hints.  (We should probably also check or deduce whether Xcode's default assembler is still Apple's ancient fork of the GNU assembler, which has major deficiencies, and install a wrapper script `$SAGE_LOCAL/bin/as` which invokes LLVM's more recent assembler in that case.  Then the GCC package won't have to deal with that, which it currently doesn't anyway, potentially leading to build errors caused by the assembler not supporting the instructions Sage's GCC emits.  The latter can also happen on (older) Linux distros when Sage's GCC gets built, though, so something not Darwin-specific should be added to GCC's spkg-install, too.)

* The list of all Sage packages dumped near the end of `configure` lets any warning messages given earlier drown, so it's less likely people will notice them.  We could collect at least important warnings in order to give (or repeat) them at the end (a `configure` "summary" would IMHO be good anyway), and/or print more than one package name per line.

* ... (There are quite certainly other things which could be improved.)

Issue created by migration from https://trac.sagemath.org/ticket/21116





---

archive/issue_comments_288648.json:
```json
{
    "body": "Regarding a wrapper script for the assembler on Darwin, see also #20779 (around [comment:ticket:20779:34 comment 34]).\n\nAlso *there* is some reasoning about Darwin versions and Xcode versions ([comment:ticket:20779:49 comment 49 ff.]); in some cases we may want to **require** a newer version of Xcode, provided there's one available for the given Darwin version (for example Xcode 7.3 or later on El Capitan / MacOS X 10.11, which is not available for earlier versions of MacOS X).",
    "created_at": "2016-07-28T14:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288648",
    "user": "leif"
}
```

Regarding a wrapper script for the assembler on Darwin, see also #20779 (around [comment:ticket:20779:34 comment 34]).

Also *there* is some reasoning about Darwin versions and Xcode versions ([comment:ticket:20779:49 comment 49 ff.]); in some cases we may want to **require** a newer version of Xcode, provided there's one available for the given Darwin version (for example Xcode 7.3 or later on El Capitan / MacOS X 10.11, which is not available for earlier versions of MacOS X).



---

archive/issue_comments_288649.json:
```json
{
    "body": "Added \"dynamic\" exclusion of (in most cases dummy) packages like iconv, which we could handle just like the GCC package.",
    "created_at": "2016-07-28T16:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288649",
    "user": "leif"
}
```

Added "dynamic" exclusion of (in most cases dummy) packages like iconv, which we could handle just like the GCC package.



---

archive/issue_comments_288650.json:
```json
{
    "body": "Correction:  Cephes is meanwhile solely built on FreeBSD, not even on Cygwin anymore.",
    "created_at": "2016-07-28T16:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288650",
    "user": "leif"
}
```

Correction:  Cephes is meanwhile solely built on FreeBSD, not even on Cygwin anymore.



---

archive/issue_comments_288651.json:
```json
{
    "body": "P.S.:  Seems this rather gets a meta-ticket.",
    "created_at": "2016-07-28T16:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288651",
    "user": "leif"
}
```

P.S.:  Seems this rather gets a meta-ticket.



---

archive/issue_comments_288652.json:
```json
{
    "body": "Added a note on the use of `PYTHON`, with which we again(!) pollute the environment.",
    "created_at": "2016-07-30T19:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288652",
    "user": "leif"
}
```

Added a note on the use of `PYTHON`, with which we again(!) pollute the environment.



---

archive/issue_comments_288653.json:
```json
{
    "body": "For XCode - see also #21708.",
    "created_at": "2016-10-30T06:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288653",
    "user": "mkoeppe"
}
```

For XCode - see also #21708.



---

archive/issue_comments_288654.json:
```json
{
    "body": "Replying to [comment:3 leif]:\n> Correction:  Cephes is meanwhile solely built on FreeBSD, not even on Cygwin anymore.\n\nI am experimenting with FreeBSD 11.0, and there cephes nukes the Sage build.\n(I had to remove `SAGE_LOCAL/bin/libm.so` it produces so that linking does not break)\n\nShould we remove it as obsolete? It appears that new FreeBSD's libm is good enough.",
    "created_at": "2017-03-24T00:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288654",
    "user": "dimpase"
}
```

Replying to [comment:3 leif]:
> Correction:  Cephes is meanwhile solely built on FreeBSD, not even on Cygwin anymore.

I am experimenting with FreeBSD 11.0, and there cephes nukes the Sage build.
(I had to remove `SAGE_LOCAL/bin/libm.so` it produces so that linking does not break)

Should we remove it as obsolete? It appears that new FreeBSD's libm is good enough.



---

archive/issue_comments_288655.json:
```json
{
    "body": "Replying to [comment:7 dimpase]:\nscratch this:\n\n> Should we remove it as obsolete? It appears that new FreeBSD's libm is good enough.\n\nthere are still few functions from there missing on FreeBSD, see #22679",
    "created_at": "2017-03-27T16:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288655",
    "user": "dimpase"
}
```

Replying to [comment:7 dimpase]:
scratch this:

> Should we remove it as obsolete? It appears that new FreeBSD's libm is good enough.

there are still few functions from there missing on FreeBSD, see #22679



---

archive/issue_comments_288656.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-01T20:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288656",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288657.json:
```json
{
    "body": "These issues appear to be all outdated, and the ticket should be closed.",
    "created_at": "2020-05-01T20:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288657",
    "user": "mkoeppe"
}
```

These issues appear to be all outdated, and the ticket should be closed.



---

archive/issue_comments_288658.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-02T04:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288658",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288659.json:
```json
{
    "body": "ok",
    "created_at": "2020-05-02T04:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288659",
    "user": "dimpase"
}
```

ok



---

archive/issue_comments_288660.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-06-17T07:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20879#issuecomment-288660",
    "user": "chapoton"
}
```

Resolution: invalid
