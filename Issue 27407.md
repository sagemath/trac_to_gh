# Issue 27407: Sage Jupyter Kernel vs EIN (Emacs Jupyter Interface)

Issue created by migration from https://trac.sagemath.org/ticket/27644

Original creator: malb

Original creation time: 2019-04-11 12:45:57

CC:  jdemeyer slelievre zerline

Sage's Jupyter Kernel doesn't work with EIN: 

https://github.com/millejoh/emacs-ipython-notebook/issues/466

It seems this is mainly down to the Sage kernel not declaring its language in the kernel spec. For example, this seems to do the trick:


```diff
diff --git a/src/sage/repl/ipython_kernel/install.py b/src/sage/repl/ipython_kernel/install.py
index dc3dd6ed4a..1e03a1cf85 100644
--- a/src/sage/repl/ipython_kernel/install.py
+++ b/src/sage/repl/ipython_kernel/install.py
@@ -212,6 +212,7 @@ class SageKernelSpec(object):
         return dict(
             argv=self._kernel_cmd(),
             display_name=self._display_name,
+            language="python",
         )
 
     def _install_spec(self):
```


However, I have actually no idea how the whole architecture works. Thus, is thee above "fix" or workaround acceptable?


---

Comment by zerline created at 2019-04-15 11:25:23

In effect the language is normally stated in the "kernel.json" specification file. For python3 for example:

./local/share/jupyter/kernels/python3/kernel.json

--%<

"display_name": "Python 3",

"language": "python"

--%<

and yes, apparently, the Sagemath kernel fails to do that


---

Comment by embray created at 2019-04-15 12:11:53

According to [the docs on Kernel Specs](https://jupyter-client.readthedocs.io/en/stable/kernels.html#kernel-specs):

> **language**: The name of the language of the kernel. When loading notebooks, if no matching kernelspec key (may differ across machines) is found, a kernel with a matching _language_ will be used. This allows a notebook written on any Python or Julia kernel to be properly associated with the user’s Python or Julia kernel, even if they aren’t listed under the same name as the author’s.

Therefore this should probably be `language="sage"` or something like that.  `language="python"` would not be appropriate as a Sage kernel notebook does not have a good chance of working on a generic Python kernel.


---

Comment by zerline created at 2019-04-17 19:45:54

Changing status from new to needs_review.


---

Comment by zerline created at 2019-04-17 19:45:54

New commits:


---

Comment by malb created at 2019-04-18 14:03:04

This patch + the workaround (on the Emacs-side) suggested at https://github.com/millejoh/emacs-ipython-notebook/issues/466 does the trick for me.


---

Comment by malb created at 2019-04-18 14:03:04

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-04-19 16:54:29

LGTM as well.  Let's see what the buildbots say.


---

Comment by chapoton created at 2019-04-24 06:39:58

Author name missing


---

Comment by vbraun created at 2019-04-24 11:57:37

Changing status from positive_review to needs_work.


---

Comment by zerline created at 2019-05-10 13:28:41

Changing status from needs_work to needs_review.


---

Comment by malb created at 2019-05-14 10:32:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-17 11:45:22

Resolution: fixed
