# Issue 23085: py3: richcmp for modular symbols

archive/issues_023085.json:
```json
{
    "body": "CC:  @tscrim @jdemeyer\n\nas another step to python3\n\nusing the very newly available decorator `@`richcmp_method\n\nIssue created by migration from https://trac.sagemath.org/ticket/23322\n\n",
    "created_at": "2017-06-23T14:53:23Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "py3: richcmp for modular symbols",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23085",
    "user": "https://github.com/fchapoton"
}
```
CC:  @tscrim @jdemeyer

as another step to python3

using the very newly available decorator `@`richcmp_method

Issue created by migration from https://trac.sagemath.org/ticket/23322





---

archive/issue_comments_322371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-23T14:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322371",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_322372.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-23T14:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322372",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_322373.json:
```json
{
    "body": "\n```\nsage -t src/sage/modular/abvar/homspace.py  # Timed out\nsage -t src/sage/modular/hecke/hecke_operator.py  # 1 doctest failed\n```\n",
    "created_at": "2017-06-23T15:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322373",
    "user": "https://github.com/fchapoton"
}
```


```
sage -t src/sage/modular/abvar/homspace.py  # Timed out
sage -t src/sage/modular/hecke/hecke_operator.py  # 1 doctest failed
```




---

archive/issue_comments_322374.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-23T15:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322374",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_322375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-23T15:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322376.json:
```json
{
    "body": "Jeroen or Travis, could you please help to fix the pickling issue arising here ?\n\nI had to change some classes from old-style classes to SageObject classes in order to benefit from the new ``@`richcmp_method` decorator. This breaks the pickles, but I do not known how to fix that.\n\nSee patchbot report for the exact doctest failure.\n\nMaybe this is not the only issue with the branch.",
    "created_at": "2017-06-24T20:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322376",
    "user": "https://github.com/fchapoton"
}
```

Jeroen or Travis, could you please help to fix the pickling issue arising here ?

I had to change some classes from old-style classes to SageObject classes in order to benefit from the new ``@`richcmp_method` decorator. This breaks the pickles, but I do not known how to fix that.

See patchbot report for the exact doctest failure.

Maybe this is not the only issue with the branch.



---

archive/issue_comments_322377.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-06-24T20:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322377",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_322378.json:
```json
{
    "body": "I think there might be two issues here. The `H == loads(dumps(H))` might be exposing something with the decorator not being well-behaved wrt pickling. The second might be due to old-style vs new-style classes, but IDK without doing a much deeper investigation than I have time ATM.\n\nSide comment: in `HeckeOperator`, the check\n\n```\nif not isinstance(other, HeckeOperator):\n```\n\nseems superfluous now because the coercion framework should make them have the same parent, and hence, the same element class (at least if it is a proper, well-behaved parent).",
    "created_at": "2017-06-24T23:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322378",
    "user": "https://github.com/tscrim"
}
```

I think there might be two issues here. The `H == loads(dumps(H))` might be exposing something with the decorator not being well-behaved wrt pickling. The second might be due to old-style vs new-style classes, but IDK without doing a much deeper investigation than I have time ATM.

Side comment: in `HeckeOperator`, the check

```
if not isinstance(other, HeckeOperator):
```

seems superfluous now because the coercion framework should make them have the same parent, and hence, the same element class (at least if it is a proper, well-behaved parent).



---

archive/issue_comments_322379.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> at least if it is a proper, well-behaved parent\n\nWhat do you mean with this? There is nothing in the coercion framework which says that \"equal parents\" should imply \"equal Python classes\". For *most* parents, this implication happens to be true, but it's not a general rule.",
    "created_at": "2017-06-26T07:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322379",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 tscrim]:
> at least if it is a proper, well-behaved parent

What do you mean with this? There is nothing in the coercion framework which says that "equal parents" should imply "equal Python classes". For *most* parents, this implication happens to be true, but it's not a general rule.



---

archive/issue_comments_322380.json:
```json
{
    "body": "Replying to [comment:4 chapoton]:\n> Jeroen or Travis, could you please help to fix the pickling issue arising here ?\n\nIt would help if you could specify exactly which \"issue\" you mean.",
    "created_at": "2017-06-26T09:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322380",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 chapoton]:
> Jeroen or Travis, could you please help to fix the pickling issue arising here ?

It would help if you could specify exactly which "issue" you mean.



---

archive/issue_comments_322381.json:
```json
{
    "body": "Why the `return (op == op_NE)` for non-matching types? The proper Python behaviour is `return NotImplemented` when you cannot decide a comparison.",
    "created_at": "2017-06-26T09:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322381",
    "user": "https://github.com/jdemeyer"
}
```

Why the `return (op == op_NE)` for non-matching types? The proper Python behaviour is `return NotImplemented` when you cannot decide a comparison.



---

archive/issue_comments_322382.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-06-26T11:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322382",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_322383.json:
```json
{
    "body": "With the current branch, I get\n\n```\nsage -t src/sage/modular/hecke/ambient_module.py\n**********************************************************************\nFile \"src/sage/modular/hecke/ambient_module.py\", line 167, in sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element\nFailed example:\n    sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, 3, 2, 4)._hecke_image_of_ith_basis_element(4, 2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: Derived class <class 'sage.modular.hecke.ambient_module.AmbientHeckeModule_with_category'> should implement __cmp__\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element[0]>\", line 1, in <module>\n        sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, Integer(3), Integer(2), Integer(4))._hecke_image_of_ith_basis_element(Integer(4), Integer(2))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/ambient_module.py\", line 172, in _hecke_image_of_ith_basis_element\n        return self.hecke_operator(n)(self.gen(i))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py\", line 203, in __call__\n        T = self.hecke_module_morphism()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py\", line 142, in hecke_module_morphism\n        T = self.matrix()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py\", line 750, in matrix\n        self.__matrix = self.parent().hecke_matrix(self.__n, *args, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/algebra.py\", line 592, in hecke_matrix\n        return self.__M.hecke_matrix(n, *args, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 1389, in hecke_matrix\n        T = self._compute_hecke_matrix(n)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 220, in _compute_hecke_matrix\n        return self._compute_hecke_matrix_prime_power(F[0][0],F[0][1], **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 148, in _compute_hecke_matrix_prime_power\n        self._hecke_matrices[pow] = self._compute_hecke_matrix(pow)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 216, in _compute_hecke_matrix\n        return self._compute_hecke_matrix_prime(n, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 239, in _compute_hecke_matrix_prime\n        raise NotImplementedError(\"All subclasses must implement _compute_hecke_matrix_prime\")\n    NotImplementedError: All subclasses must implement _compute_hecke_matrix_prime\n**********************************************************************\n```\n\nI think it's sufficient to fix the doctest here.",
    "created_at": "2017-06-26T11:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322383",
    "user": "https://github.com/jdemeyer"
}
```

With the current branch, I get

```
sage -t src/sage/modular/hecke/ambient_module.py
**********************************************************************
File "src/sage/modular/hecke/ambient_module.py", line 167, in sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element
Failed example:
    sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, 3, 2, 4)._hecke_image_of_ith_basis_element(4, 2)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: Derived class <class 'sage.modular.hecke.ambient_module.AmbientHeckeModule_with_category'> should implement __cmp__
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element[0]>", line 1, in <module>
        sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, Integer(3), Integer(2), Integer(4))._hecke_image_of_ith_basis_element(Integer(4), Integer(2))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/ambient_module.py", line 172, in _hecke_image_of_ith_basis_element
        return self.hecke_operator(n)(self.gen(i))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py", line 203, in __call__
        T = self.hecke_module_morphism()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py", line 142, in hecke_module_morphism
        T = self.matrix()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py", line 750, in matrix
        self.__matrix = self.parent().hecke_matrix(self.__n, *args, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/algebra.py", line 592, in hecke_matrix
        return self.__M.hecke_matrix(n, *args, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 1389, in hecke_matrix
        T = self._compute_hecke_matrix(n)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 220, in _compute_hecke_matrix
        return self._compute_hecke_matrix_prime_power(F[0][0],F[0][1], **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 148, in _compute_hecke_matrix_prime_power
        self._hecke_matrices[pow] = self._compute_hecke_matrix(pow)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 216, in _compute_hecke_matrix
        return self._compute_hecke_matrix_prime(n, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 239, in _compute_hecke_matrix_prime
        raise NotImplementedError("All subclasses must implement _compute_hecke_matrix_prime")
    NotImplementedError: All subclasses must implement _compute_hecke_matrix_prime
**********************************************************************
```

I think it's sufficient to fix the doctest here.



---

archive/issue_comments_322384.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:5 tscrim]:\n> > at least if it is a proper, well-behaved parent\n> \n> What do you mean with this? There is nothing in the coercion framework which says that \"equal parents\" should imply \"equal Python classes\". For *most* parents, this implication happens to be true, but it's not a general rule.\n\nI'm going to use a cop-out and say \"well-behaved\" `:P`, but yes, fair point. There is also the fact that the Hecke algebra here bypasses the usual coercion and implements its own custom `__call__`. So, we do need to keep the extra type checking and handling by `_richcmp_`.",
    "created_at": "2017-06-26T11:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322384",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:5 tscrim]:
> > at least if it is a proper, well-behaved parent
> 
> What do you mean with this? There is nothing in the coercion framework which says that "equal parents" should imply "equal Python classes". For *most* parents, this implication happens to be true, but it's not a general rule.

I'm going to use a cop-out and say "well-behaved" `:P`, but yes, fair point. There is also the fact that the Hecke algebra here bypasses the usual coercion and implements its own custom `__call__`. So, we do need to keep the extra type checking and handling by `_richcmp_`.



---

archive/issue_comments_322385.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-05T06:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322386.json:
```json
{
    "body": "I fixed the failing doctest and made the suggested changes (using `NotImplemented`).\n\nThere remains the 3 pickling problems, namely in\n\n```\nsage -t --long src/sage/structure/sage_object.pyx\n```\n\nand more precisely (see patchbot reports for more details):\n\n```\n    Failed:\n    _class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj\n    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj\n    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma_h__.sobj\n    ----------------------------------------------------------------------\n    ** This error is probably due to an old pickle failing to unpickle.\n    ** See sage.structure.sage_object.register_unpickle_override for\n    ** how to override the default unpickling methods for (old) pickles.\n    ** NOTE: pickles should never be removed from the pickle_jar! \n    ----------------------------------------------------------------------\n    Successfully unpickled 583 objects.\n    Failed to unpickle 3 objects.\n```\n\nPlease help to fix that, because I am not able to.",
    "created_at": "2017-07-05T06:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322386",
    "user": "https://github.com/fchapoton"
}
```

I fixed the failing doctest and made the suggested changes (using `NotImplemented`).

There remains the 3 pickling problems, namely in

```
sage -t --long src/sage/structure/sage_object.pyx
```

and more precisely (see patchbot reports for more details):

```
    Failed:
    _class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj
    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj
    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma_h__.sobj
    ----------------------------------------------------------------------
    ** This error is probably due to an old pickle failing to unpickle.
    ** See sage.structure.sage_object.register_unpickle_override for
    ** how to override the default unpickling methods for (old) pickles.
    ** NOTE: pickles should never be removed from the pickle_jar! 
    ----------------------------------------------------------------------
    Successfully unpickled 583 objects.
    Failed to unpickle 3 objects.
```

Please help to fix that, because I am not able to.



---

archive/issue_comments_322387.json:
```json
{
    "body": "ping ? any expert on pickling ?",
    "created_at": "2017-07-07T07:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322387",
    "user": "https://github.com/fchapoton"
}
```

ping ? any expert on pickling ?



---

archive/issue_comments_322388.json:
```json
{
    "body": "maybe we can just update the pickle jar ?",
    "created_at": "2017-07-07T13:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322388",
    "user": "https://github.com/fchapoton"
}
```

maybe we can just update the pickle jar ?



---

archive/issue_comments_322389.json:
```json
{
    "body": "Replying to [comment:14 chapoton]:\n> maybe we can just update the pickle jar ?\n\nNo, we really should not do that, at least not without a deprecation of the old pickles.",
    "created_at": "2017-07-07T14:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322389",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 chapoton]:
> maybe we can just update the pickle jar ?

No, we really should not do that, at least not without a deprecation of the old pickles.



---

archive/issue_comments_322390.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-07T14:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322391.json:
```json
{
    "body": "ok, I think that I have found a proper solution for the pickling issue. I kept a minimalist old-style class.",
    "created_at": "2017-07-07T14:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322391",
    "user": "https://github.com/fchapoton"
}
```

ok, I think that I have found a proper solution for the pickling issue. I kept a minimalist old-style class.



---

archive/issue_comments_322392.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-07T14:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322392",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_322393.json:
```json
{
    "body": "This is a solution, but IMO it is a complete hack solution. I suspect the issues comes from the fact that the base class is now `SageObject` versus a old-style Python class:\n\n```python\nsage: class Foo(object):\n....:     def __init__(self, x):\n....:         self._x = x\n....:     def __eq__(self, other):\n....:         return self._x == other._x\nsage: F = Foo(5)\nsage: F.__class__.__mro__\n(<class '__main__.Foo'>, <type 'object'>)\nsage: class Foo:\n...\nsage: F = Foo(5)\nsage: F.__class__.__mro__\n...\nAttributeError: class Foo has no attribute '__mro__'\n```\n\nHowever, I'm not sure exactly how to fix this. Have you tried implementing a custom `__setstate__`?\n\nOne way to get around this should be to use a function as the unpickle override, but IIRC, classes need to go to classes, so I think this ends up not working. Yet, there is a close variant of this approach that has a simple target class with a `__setstate__`, that when called and the unpickling is done, it then sets the `self.__class__ = Foo`. I believe this is done somewhere in the codebase...",
    "created_at": "2017-07-07T15:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322393",
    "user": "https://github.com/tscrim"
}
```

This is a solution, but IMO it is a complete hack solution. I suspect the issues comes from the fact that the base class is now `SageObject` versus a old-style Python class:

```python
sage: class Foo(object):
....:     def __init__(self, x):
....:         self._x = x
....:     def __eq__(self, other):
....:         return self._x == other._x
sage: F = Foo(5)
sage: F.__class__.__mro__
(<class '__main__.Foo'>, <type 'object'>)
sage: class Foo:
...
sage: F = Foo(5)
sage: F.__class__.__mro__
...
AttributeError: class Foo has no attribute '__mro__'
```

However, I'm not sure exactly how to fix this. Have you tried implementing a custom `__setstate__`?

One way to get around this should be to use a function as the unpickle override, but IIRC, classes need to go to classes, so I think this ends up not working. Yet, there is a close variant of this approach that has a simple target class with a `__setstate__`, that when called and the unpickling is done, it then sets the `self.__class__ = Foo`. I believe this is done somewhere in the codebase...



---

archive/issue_comments_322394.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-07T15:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322394",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_322395.json:
```json
{
    "body": "I have found something in `src/sage/combinat/skew_tableau.py` but not managed so far to adapt it to the current situation.",
    "created_at": "2017-07-09T10:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322395",
    "user": "https://github.com/fchapoton"
}
```

I have found something in `src/sage/combinat/skew_tableau.py` but not managed so far to adapt it to the current situation.



---

archive/issue_comments_322396.json:
```json
{
    "body": "Trying this\n\n```\nclass G1list_old:\n    \"\"\"\n    This exists solely for unpickling old ``G1list`` objects.\n\n    TESTS::\n\n        sage: L = sage.modular.modsym.g1list.G1list_old(18)\n        sage: loads(dumps(L)) == L\n        True\n    \"\"\"\n    def __setstate__(self, state):\n        r\"\"\"\n        Unpickle old ``G1list`` objects.\n        \"\"\"\n        self.__class__ = G1list_new\n        self.__init__(state['_N'])\n```\n\nfails `unpickle_all()` with error:\n\n```\nline 160, in __setstate__\n    self.__class__ = G1list_new\nTypeError: __class__ must be set to a class\n```\n\nWhen changing the first line to `class G1list_old(object)`, I get another error.",
    "created_at": "2017-07-09T14:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322396",
    "user": "https://github.com/fchapoton"
}
```

Trying this

```
class G1list_old:
    """
    This exists solely for unpickling old ``G1list`` objects.

    TESTS::

        sage: L = sage.modular.modsym.g1list.G1list_old(18)
        sage: loads(dumps(L)) == L
        True
    """
    def __setstate__(self, state):
        r"""
        Unpickle old ``G1list`` objects.
        """
        self.__class__ = G1list_new
        self.__init__(state['_N'])
```

fails `unpickle_all()` with error:

```
line 160, in __setstate__
    self.__class__ = G1list_new
TypeError: __class__ must be set to a class
```

When changing the first line to `class G1list_old(object)`, I get another error.



---

archive/issue_comments_322397.json:
```json
{
    "body": "Replying to [comment:20 chapoton]:\n> fails `unpickle_all()` with error:\n> {{{\n> line 160, in __setstate__\n>     self.__class__ = G1list_new\n> TypeError: __class__ must be set to a class\n> }}}\n\nWriting *complete* tracebacks in tickets is very useful if people want to understand the issue.",
    "created_at": "2017-07-10T08:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322397",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:20 chapoton]:
> fails `unpickle_all()` with error:
> {{{
> line 160, in __setstate__
>     self.__class__ = G1list_new
> TypeError: __class__ must be set to a class
> }}}

Writing *complete* tracebacks in tickets is very useful if people want to understand the issue.



---

archive/issue_comments_322398.json:
```json
{
    "body": "Here it is (I am going to push the corresponding branch as `u/chapoton/23322_experimental`):\n\n```\nsage: from sage.structure.sage_object import *\nsage: unpickle_all()\n/home/chapoton/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2881: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.\nSee http://trac.sagemath.org/18375 for details.\n  exec(code_obj, self.user_global_ns, self.user_ns)\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.\nSee http://trac.sagemath.org/1000 for details.\n  #!/usr/bin/env python\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: This function is only used to unpickle invalid objects\nSee http://trac.sagemath.org/18848 for details.\n  #!/usr/bin/env python\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: OrderedAlphabet is deprecated; use Alphabet instead.\nSee http://trac.sagemath.org/8920 for details.\n  #!/usr/bin/env python\n * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj')\nTraceback (most recent call last):\n  File \"sage/structure/sage_object.pyx\", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)\n    object = load(os.path.join(dir,A))\n  File \"sage/structure/sage_object.pyx\", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)\n    X = loads(open(filename).read(), compress=compress)\n  File \"sage/structure/sage_object.pyx\", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)\n    return unpickler.load()\n  File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py\", line 151, in __setstate__\n    self.__class__ = G1list_new\nTypeError: __class__ must be set to a class\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: gen_py.pari is deprecated, use sage.libs.pari.all.pari instead\nSee http://trac.sagemath.org/17451 for details.\n  #!/usr/bin/env python\n * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj')\nTraceback (most recent call last):\n  File \"sage/structure/sage_object.pyx\", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)\n    object = load(os.path.join(dir,A))\n  File \"sage/structure/sage_object.pyx\", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)\n    X = loads(open(filename).read(), compress=compress)\n  File \"sage/structure/sage_object.pyx\", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)\n    return unpickler.load()\n  File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py\", line 151, in __setstate__\n    self.__class__ = G1list_new\nTypeError: __class__ must be set to a class\n/home/chapoton/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_constructor.py:718: DeprecationWarning: The \"pari_mod\" finite field implementation is deprecated\nSee http://trac.sagemath.org/17297 for details.\n  K = FiniteField_ext_pari(order, name, modulus)\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: ANRootOfUnity is deprecated\nSee http://trac.sagemath.org/19954 for details.\n  #!/usr/bin/env python\nFailed:\n_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj\n_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj\n----------------------------------------------------------------------\n** This error is probably due to an old pickle failing to unpickle.\n** See sage.structure.sage_object.register_unpickle_override for\n** how to override the default unpickling methods for (old) pickles.\n** NOTE: pickles should never be removed from the pickle_jar! \n----------------------------------------------------------------------\nSuccessfully unpickled 584 objects.\nFailed to unpickle 2 objects.\n```\n",
    "created_at": "2017-07-10T09:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322398",
    "user": "https://github.com/fchapoton"
}
```

Here it is (I am going to push the corresponding branch as `u/chapoton/23322_experimental`):

```
sage: from sage.structure.sage_object import *
sage: unpickle_all()
/home/chapoton/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2881: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.
See http://trac.sagemath.org/18375 for details.
  exec(code_obj, self.user_global_ns, self.user_ns)
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.
See http://trac.sagemath.org/1000 for details.
  #!/usr/bin/env python
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: This function is only used to unpickle invalid objects
See http://trac.sagemath.org/18848 for details.
  #!/usr/bin/env python
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: OrderedAlphabet is deprecated; use Alphabet instead.
See http://trac.sagemath.org/8920 for details.
  #!/usr/bin/env python
 * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj')
Traceback (most recent call last):
  File "sage/structure/sage_object.pyx", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)
    object = load(os.path.join(dir,A))
  File "sage/structure/sage_object.pyx", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)
    X = loads(open(filename).read(), compress=compress)
  File "sage/structure/sage_object.pyx", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)
    return unpickler.load()
  File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py", line 151, in __setstate__
    self.__class__ = G1list_new
TypeError: __class__ must be set to a class
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: gen_py.pari is deprecated, use sage.libs.pari.all.pari instead
See http://trac.sagemath.org/17451 for details.
  #!/usr/bin/env python
 * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj')
Traceback (most recent call last):
  File "sage/structure/sage_object.pyx", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)
    object = load(os.path.join(dir,A))
  File "sage/structure/sage_object.pyx", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)
    X = loads(open(filename).read(), compress=compress)
  File "sage/structure/sage_object.pyx", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)
    return unpickler.load()
  File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py", line 151, in __setstate__
    self.__class__ = G1list_new
TypeError: __class__ must be set to a class
/home/chapoton/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_constructor.py:718: DeprecationWarning: The "pari_mod" finite field implementation is deprecated
See http://trac.sagemath.org/17297 for details.
  K = FiniteField_ext_pari(order, name, modulus)
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: ANRootOfUnity is deprecated
See http://trac.sagemath.org/19954 for details.
  #!/usr/bin/env python
Failed:
_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj
_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj
----------------------------------------------------------------------
** This error is probably due to an old pickle failing to unpickle.
** See sage.structure.sage_object.register_unpickle_override for
** how to override the default unpickling methods for (old) pickles.
** NOTE: pickles should never be removed from the pickle_jar! 
----------------------------------------------------------------------
Successfully unpickled 584 objects.
Failed to unpickle 2 objects.
```




---

archive/issue_comments_322399.json:
```json
{
    "body": "In the case of `SkewTableau`, the old `SkewTableau_class` was being removed and base class changed, which changed the internals and how it dealt with unpickling. So the solution (workaround?) was to subclass and write unpickling within the `__setstate__` as the unpickling did not want to take a function when it was originally a class.\n\nThe reason why you are getting an error in your case is because `G1list_old` is an old-style class, which does not have a `__class__` attribute. So I think if you were going to do the `SkewTableau` approach, it should be a subclass of `G1list_new` with a `__setstate__`.\n\nHowever, I do not think this is a good approach overall as there is no real point in having a class alias and it seems too hacky, at least without trying to handle things directly with a `__setstate__`. Now that I have 2 moments to spend, let me see if I can get something to work.",
    "created_at": "2017-07-10T23:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322399",
    "user": "https://github.com/tscrim"
}
```

In the case of `SkewTableau`, the old `SkewTableau_class` was being removed and base class changed, which changed the internals and how it dealt with unpickling. So the solution (workaround?) was to subclass and write unpickling within the `__setstate__` as the unpickling did not want to take a function when it was originally a class.

The reason why you are getting an error in your case is because `G1list_old` is an old-style class, which does not have a `__class__` attribute. So I think if you were going to do the `SkewTableau` approach, it should be a subclass of `G1list_new` with a `__setstate__`.

However, I do not think this is a good approach overall as there is no real point in having a class alias and it seems too hacky, at least without trying to handle things directly with a `__setstate__`. Now that I have 2 moments to spend, let me see if I can get something to work.



---

archive/issue_comments_322400.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-11T00:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322400",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_322401.json:
```json
{
    "body": "Okay, so how pickles are created for old-style classes is quite different than for new-style:\n\n```\nsage: class Foo:\n....:     def __init__(self, x):\n....:         self._x = x\nsage: F = Foo(5)\nsage: p = dumps(F)\nsage: explain_pickle(p)\npg_Foo = unpickle_global('__main__', 'Foo')\npg = unpickle_instantiate(pg_Foo, ())\npg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')\nunpickle_build(pg, {'_x':pg_make_integer('5')})\npg\nsage: loads(p)._x\n5\nsage: class Foo(object):\n....:     def __init__(self, x=None):\n....:         self._x = x\n....:     def __setstate__(self, state):\n....:         print(state)\n....:         self._x = state['_x']\nsage: loads(p)._x\n('__init__', None)\n{'_x': 5}\n5\nsage: explain_pickle(dumps(Foo(5)))\npg_Foo = unpickle_global('__main__', 'Foo')\nsi = unpickle_newobj(pg_Foo, ())\npg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')\nunpickle_build(si, {'_x':pg_make_integer('5')})\nsi\nsage: loads(dumps(Foo(5)))._x\n('__init__', 5)\n{'_x': 5}\n5\n```\n\nSo all of the `__setstate__` logic happens **after** the `__init__` call, which makes it essentially useless for our purpose.\n\nMy solution is similar to the `SkewTableau` case, where there is a little dummy class that inherits from the main class `G1list` that just exists to handle pickles and sets its `__class__` to the base class upon `__init__`. This is a little elegant, a little hackish, but it works.\n----\nNew commits:",
    "created_at": "2017-07-11T00:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322401",
    "user": "https://github.com/tscrim"
}
```

Okay, so how pickles are created for old-style classes is quite different than for new-style:

```
sage: class Foo:
....:     def __init__(self, x):
....:         self._x = x
sage: F = Foo(5)
sage: p = dumps(F)
sage: explain_pickle(p)
pg_Foo = unpickle_global('__main__', 'Foo')
pg = unpickle_instantiate(pg_Foo, ())
pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')
unpickle_build(pg, {'_x':pg_make_integer('5')})
pg
sage: loads(p)._x
5
sage: class Foo(object):
....:     def __init__(self, x=None):
....:         self._x = x
....:     def __setstate__(self, state):
....:         print(state)
....:         self._x = state['_x']
sage: loads(p)._x
('__init__', None)
{'_x': 5}
5
sage: explain_pickle(dumps(Foo(5)))
pg_Foo = unpickle_global('__main__', 'Foo')
si = unpickle_newobj(pg_Foo, ())
pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')
unpickle_build(si, {'_x':pg_make_integer('5')})
si
sage: loads(dumps(Foo(5)))._x
('__init__', 5)
{'_x': 5}
5
```

So all of the `__setstate__` logic happens **after** the `__init__` call, which makes it essentially useless for our purpose.

My solution is similar to the `SkewTableau` case, where there is a little dummy class that inherits from the main class `G1list` that just exists to handle pickles and sets its `__class__` to the base class upon `__init__`. This is a little elegant, a little hackish, but it works.
----
New commits:



---

archive/issue_comments_322402.json:
```json
{
    "body": "Thanks a lot, Travis. I would never have found that myself.\n\nI did the same for the other similar case. Let me launch my patchbot on it now.\n----\nNew commits:",
    "created_at": "2017-07-11T06:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322402",
    "user": "https://github.com/fchapoton"
}
```

Thanks a lot, Travis. I would never have found that myself.

I did the same for the other similar case. Let me launch my patchbot on it now.
----
New commits:



---

archive/issue_comments_322403.json:
```json
{
    "body": "No problem. I'm sorry I didn't have more time to actually sit down and fix it rather than lobbing ideas over.\n\nOne other detail, we should add a test in the `__init__` of those classes to make sure the pickling is happening correctly for the new objects. Something like:\n\n```\nsage: from sage.modular.modsym.g1list import G1list\nsage: L = G1list(6)\nsage: Lp = loads(dumps(L))\nsage: L == Lp\nTrue\nsage: type(Lp) == G1list\nTrue\n```\n\nFeel free to add after the patchbot run.",
    "created_at": "2017-07-11T07:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322403",
    "user": "https://github.com/tscrim"
}
```

No problem. I'm sorry I didn't have more time to actually sit down and fix it rather than lobbing ideas over.

One other detail, we should add a test in the `__init__` of those classes to make sure the pickling is happening correctly for the new objects. Something like:

```
sage: from sage.modular.modsym.g1list import G1list
sage: L = G1list(6)
sage: Lp = loads(dumps(L))
sage: L == Lp
True
sage: type(Lp) == G1list
True
```

Feel free to add after the patchbot run.



---

archive/issue_comments_322404.json:
```json
{
    "body": "Also, positive review if green patchbot (and the added tests pass).",
    "created_at": "2017-07-11T07:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322404",
    "user": "https://github.com/tscrim"
}
```

Also, positive review if green patchbot (and the added tests pass).



---

archive/issue_comments_322405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-11T08:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322406.json:
```json
{
    "body": "This test fails:\n\n```\ntype(Lp) == G1list\n```\n\nbecause \n\n```\nsage: type(L)\n<class 'sage.modular.modsym.g1list.G1list'>\nsage: type(Lp)\n<class 'sage.modular.modsym.g1list._G1list_old_pickle'>\n```\n",
    "created_at": "2017-07-11T08:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322406",
    "user": "https://github.com/fchapoton"
}
```

This test fails:

```
type(Lp) == G1list
```

because 

```
sage: type(L)
<class 'sage.modular.modsym.g1list.G1list'>
sage: type(Lp)
<class 'sage.modular.modsym.g1list._G1list_old_pickle'>
```




---

archive/issue_comments_322407.json:
```json
{
    "body": "So `SageObject` pickles seem to behave slightly differently than my testing above. So I explicitly added a `__setstate__` and removed the other argument from `__init__` to ensure the corresponding behavior. Now the tests pass:\n\n```\nDoctesting 2 files using 8 threads.\nsage -t src/sage/modular/modsym/g1list.py\n    [21 tests, 0.30 s]\nsage -t src/sage/modular/modsym/ghlist.py\n    [22 tests, 0.62 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n\n----\nNew commits:",
    "created_at": "2017-07-11T14:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322407",
    "user": "https://github.com/tscrim"
}
```

So `SageObject` pickles seem to behave slightly differently than my testing above. So I explicitly added a `__setstate__` and removed the other argument from `__init__` to ensure the corresponding behavior. Now the tests pass:

```
Doctesting 2 files using 8 threads.
sage -t src/sage/modular/modsym/g1list.py
    [21 tests, 0.30 s]
sage -t src/sage/modular/modsym/ghlist.py
    [22 tests, 0.62 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```

----
New commits:



---

archive/issue_comments_322408.json:
```json
{
    "body": "green bot. Do we agree that it can be set to positive ?",
    "created_at": "2017-07-11T16:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322408",
    "user": "https://github.com/fchapoton"
}
```

green bot. Do we agree that it can be set to positive ?



---

archive/issue_comments_322409.json:
```json
{
    "body": "Yep. Done.",
    "created_at": "2017-07-11T23:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322409",
    "user": "https://github.com/tscrim"
}
```

Yep. Done.



---

archive/issue_comments_322410.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-11T23:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322410",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_322411.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-26T22:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23085#issuecomment-322411",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_021673.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-07-26T22:13:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23085",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23085#event-21673"
}
```
