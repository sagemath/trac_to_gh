# Issue 31978: Asymptotic Term Monoids: refactor element construction

archive/issues_031978.json:
```json
{
    "body": "CC:  @cheuberg @behackl @thhagelmayer\n\nIn #31933 conversion fails. In order to fix this properly, a refactor of the conversion process seems the best solution. This ticket does this (without fixing the open issue on #31933 which will be a follow up).\n\nIssue created by migration from https://trac.sagemath.org/ticket/32215\n\n",
    "created_at": "2021-07-16T19:55:19Z",
    "labels": [
        "asymptotic expansions",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Asymptotic Term Monoids: refactor element construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31978",
    "user": "@dkrenn"
}
```
CC:  @cheuberg @behackl @thhagelmayer

In #31933 conversion fails. In order to fix this properly, a refactor of the conversion process seems the best solution. This ticket does this (without fixing the open issue on #31933 which will be a follow up).

Issue created by migration from https://trac.sagemath.org/ticket/32215





---

archive/issue_comments_456914.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-16T20:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456914",
    "user": "@dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_456915.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-07-16T20:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456915",
    "user": "@dkrenn"
}
```

New commits:



---

archive/issue_comments_456916.json:
```json
{
    "body": "Review recommendation: commit-wise",
    "created_at": "2021-07-16T20:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456916",
    "user": "@dkrenn"
}
```

Review recommendation: commit-wise



---

archive/issue_comments_456917.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-17T10:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456917",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456918.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-18T11:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456918",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456919.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-18T14:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456919",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456920.json:
```json
{
    "body": "Here are some minor points that should be addressed: \n\n1. The new exceptions caused by ambiguously passing additional `growth` and `coefficient` keyword arguments should be tested.\n\n2. Is there a particular reason for changing the implementation of `OTerm.can_absorb`?\n\n3. The implementations of `TermWithCoefficientMonoid._convert_construction_` and `ExactTermMonoid._convert_construction_` are identical. I think the tests contained in the docstring of `ExactTermMonoid._convert_construction_` should be moved to `TermWithCoefficientMonoid._convert_construction_` and the separate implementation of `ExactTermMonoid._convert_construction_` should be removed.\n\n\nOtherwise, the proposed changes look good to me. Here are the changes I've made in my reviewer commits:\n\n- the `cached_method` import was unused and is now removed.\n\n- The `EXAMPLES` block in some newly added methods used `TermMonoidFactory` to manually construct a factory, I've changed it to `from sage.rings.asymptotic.term_monoid import DefaultTermMonoidFactory as TermMonoid` (also see #32032).\n\n- Language improvements for the error messages and the deprecation warning in `GenericTermMonoid._element_constructor`.\n----\nNew commits:",
    "created_at": "2021-07-22T11:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456920",
    "user": "@behackl"
}
```

Here are some minor points that should be addressed: 

1. The new exceptions caused by ambiguously passing additional `growth` and `coefficient` keyword arguments should be tested.

2. Is there a particular reason for changing the implementation of `OTerm.can_absorb`?

3. The implementations of `TermWithCoefficientMonoid._convert_construction_` and `ExactTermMonoid._convert_construction_` are identical. I think the tests contained in the docstring of `ExactTermMonoid._convert_construction_` should be moved to `TermWithCoefficientMonoid._convert_construction_` and the separate implementation of `ExactTermMonoid._convert_construction_` should be removed.


Otherwise, the proposed changes look good to me. Here are the changes I've made in my reviewer commits:

- the `cached_method` import was unused and is now removed.

- The `EXAMPLES` block in some newly added methods used `TermMonoidFactory` to manually construct a factory, I've changed it to `from sage.rings.asymptotic.term_monoid import DefaultTermMonoidFactory as TermMonoid` (also see #32032).

- Language improvements for the error messages and the deprecation warning in `GenericTermMonoid._element_constructor`.
----
New commits:



---

archive/issue_comments_456921.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-22T11:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456921",
    "user": "@behackl"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_456922.json:
```json
{
    "body": "I have merged #32032 and fixed some doctests.\n----\nNew commits:",
    "created_at": "2021-08-07T16:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456922",
    "user": "@thhagelmayer"
}
```

I have merged #32032 and fixed some doctests.
----
New commits:



---

archive/issue_comments_456923.json:
```json
{
    "body": "Replying to [comment:9 behackl]:\n> Otherwise, the proposed changes look good to me. Here are the changes I've made in my reviewer commits:\n> \n> - the `cached_method` import was unused and is now removed.\n> \n> - The `EXAMPLES` block in some newly added methods used `TermMonoidFactory` to manually construct a factory, I've changed it to `from sage.rings.asymptotic.term_monoid import DefaultTermMonoidFactory as TermMonoid` (also see #32032).\n> \n> - Language improvements for the error messages and the deprecation warning in `GenericTermMonoid._element_constructor`.\n\nLGTM, thanks.",
    "created_at": "2021-08-09T13:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456923",
    "user": "@dkrenn"
}
```

Replying to [comment:9 behackl]:
> Otherwise, the proposed changes look good to me. Here are the changes I've made in my reviewer commits:
> 
> - the `cached_method` import was unused and is now removed.
> 
> - The `EXAMPLES` block in some newly added methods used `TermMonoidFactory` to manually construct a factory, I've changed it to `from sage.rings.asymptotic.term_monoid import DefaultTermMonoidFactory as TermMonoid` (also see #32032).
> 
> - Language improvements for the error messages and the deprecation warning in `GenericTermMonoid._element_constructor`.

LGTM, thanks.



---

archive/issue_comments_456924.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T14:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456924",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456925.json:
```json
{
    "body": "Replying to [comment:9 behackl]:\n> 1. The new exceptions caused by ambiguously passing additional `growth` and `coefficient` keyword arguments should be tested.\n\nTested now. Indeed there was code, that could have never been reached. I think we should have full coverage now.\n\n> 2. Is there a particular reason for changing the implementation of `OTerm.can_absorb`?\n\nThis was the only place, where the `<=` of a term was used. However, I think it should be made clear what we compare here (\"explicit is better than implicit\"), so I switched to comparing the growth directly.\n\nThe reason for having `<=` (and method `le`) is for being compatible with SageMath's poset class in this perspective. If it wouldn't be for that, I would suggest to deprecate `<=` in the long run. However, as there is a reason for keeping it, I suggest to, at least, not use it further.\n\n> 3. The implementations of `TermWithCoefficientMonoid._convert_construction_` and `ExactTermMonoid._convert_construction_` are identical. I think the tests contained in the docstring of `ExactTermMonoid._convert_construction_` should be moved to `TermWithCoefficientMonoid._convert_construction_` and the separate implementation of `ExactTermMonoid._convert_construction_` should be removed.\n\nI disagree here. Usually I am in strong favour of removeing code duplicities, however, `_convert_construction_` is the one crucial method that all different terms (or their monoids, to be precise) have that do the conversion and making this conversion as explicit as possible helps understanding what is going on. I find it more of an incidient that two different type of terms have the same conversion.",
    "created_at": "2021-08-09T14:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456925",
    "user": "@dkrenn"
}
```

Replying to [comment:9 behackl]:
> 1. The new exceptions caused by ambiguously passing additional `growth` and `coefficient` keyword arguments should be tested.

Tested now. Indeed there was code, that could have never been reached. I think we should have full coverage now.

> 2. Is there a particular reason for changing the implementation of `OTerm.can_absorb`?

This was the only place, where the `<=` of a term was used. However, I think it should be made clear what we compare here ("explicit is better than implicit"), so I switched to comparing the growth directly.

The reason for having `<=` (and method `le`) is for being compatible with SageMath's poset class in this perspective. If it wouldn't be for that, I would suggest to deprecate `<=` in the long run. However, as there is a reason for keeping it, I suggest to, at least, not use it further.

> 3. The implementations of `TermWithCoefficientMonoid._convert_construction_` and `ExactTermMonoid._convert_construction_` are identical. I think the tests contained in the docstring of `ExactTermMonoid._convert_construction_` should be moved to `TermWithCoefficientMonoid._convert_construction_` and the separate implementation of `ExactTermMonoid._convert_construction_` should be removed.

I disagree here. Usually I am in strong favour of removeing code duplicities, however, `_convert_construction_` is the one crucial method that all different terms (or their monoids, to be precise) have that do the conversion and making this conversion as explicit as possible helps understanding what is going on. I find it more of an incidient that two different type of terms have the same conversion.



---

archive/issue_comments_456926.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-08-09T16:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456926",
    "user": "@behackl"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_456927.json:
```json
{
    "body": "> I think we should have full coverage now.\n\nGreat, thanks!\n\n>  I would suggest to deprecate `<=` in the long run. However, as there is a reason for keeping it, I suggest to, at least, not use it further.\n\nAnother example of //spiritual deprecation//. +1.\n\n>  I find it more of an incidient that two different type of terms have the same conversion.\n\nOkay, good argument.\n\nThis LGTM now, thanks for your efforts!",
    "created_at": "2021-08-09T16:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456927",
    "user": "@behackl"
}
```

> I think we should have full coverage now.

Great, thanks!

>  I would suggest to deprecate `<=` in the long run. However, as there is a reason for keeping it, I suggest to, at least, not use it further.

Another example of //spiritual deprecation//. +1.

>  I find it more of an incidient that two different type of terms have the same conversion.

Okay, good argument.

This LGTM now, thanks for your efforts!



---

archive/issue_comments_456928.json:
```json
{
    "body": "I am not sure why the `deprecation_number` test in the most recent patchbot run failed though. The deprecation introduced here correctly uses 32215.",
    "created_at": "2021-08-09T16:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456928",
    "user": "@behackl"
}
```

I am not sure why the `deprecation_number` test in the most recent patchbot run failed though. The deprecation introduced here correctly uses 32215.



---

archive/issue_comments_456929.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-08-09T20:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456929",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_456930.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-08-09T20:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456930",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_456931.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T20:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456931",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456932.json:
```json
{
    "body": "Merged #32153 and fixed doctest. It's now on 9.4.beta4.",
    "created_at": "2021-08-09T20:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456932",
    "user": "@dkrenn"
}
```

Merged #32153 and fixed doctest. It's now on 9.4.beta4.



---

archive/issue_comments_456933.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-10T07:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456933",
    "user": "@behackl"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_456934.json:
```json
{
    "body": "Changing keywords from \"\" to \"gsoc2021\".",
    "created_at": "2021-08-18T13:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456934",
    "user": "@thhagelmayer"
}
```

Changing keywords from "" to "gsoc2021".



---

archive/issue_comments_456935.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-08-30T22:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456935",
    "user": "@vbraun"
}
```

Merge conflict



---

archive/issue_comments_456936.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-08-30T22:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456936",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_456937.json:
```json
{
    "body": "I merged #31933 into this ticket and resolved the merge conflict.\n----\nNew commits:",
    "created_at": "2021-09-15T15:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456937",
    "user": "@thhagelmayer"
}
```

I merged #31933 into this ticket and resolved the merge conflict.
----
New commits:



---

archive/issue_comments_456938.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-15T15:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456938",
    "user": "@thhagelmayer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_456939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-17T08:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456940.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-24T12:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456940",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_456941.json:
```json
{
    "body": "Somwthing went wrong with the last push here, so I went back to the status of `u/dkrenn/refactor-element-construction-term-monoids` and redid the merge and fixed the doctests. There is still one doctest failing:\n\n\n\n```\nFile \"src/sage/rings/asymptotic/term_monoid.py\", line 4698, in sage.rings.asymptotic.term_monoid.BTerm.can_absorb\nFailed example:\n    t2.absorb(t1)\nExpected:\n    B(2003/400*x^3, x >= 20)\nGot:\n...\n    DeprecationWarning: Passing 'coefficient' as a positional argument is deprecated; specify it as keyword argument 'coefficient=...'.\n    See https://trac.sagemath.org/32215 for details.\n    B(2003/400*x^3, x >= 20)\n```\n",
    "created_at": "2021-11-24T12:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456941",
    "user": "@thhagelmayer"
}
```

Somwthing went wrong with the last push here, so I went back to the status of `u/dkrenn/refactor-element-construction-term-monoids` and redid the merge and fixed the doctests. There is still one doctest failing:



```
File "src/sage/rings/asymptotic/term_monoid.py", line 4698, in sage.rings.asymptotic.term_monoid.BTerm.can_absorb
Failed example:
    t2.absorb(t1)
Expected:
    B(2003/400*x^3, x >= 20)
Got:
...
    DeprecationWarning: Passing 'coefficient' as a positional argument is deprecated; specify it as keyword argument 'coefficient=...'.
    See https://trac.sagemath.org/32215 for details.
    B(2003/400*x^3, x >= 20)
```




---

archive/issue_comments_456942.json:
```json
{
    "body": "Replying to [comment:29 gh-thhagelmayer]:\n> Somwthing went wrong with the last push here, so I went back to the status of `u/dkrenn/refactor-element-construction-term-monoids` and redid the merge and fixed the doctests. There is still one doctest failing:\n> \n> \n> {{{\n> File \"src/sage/rings/asymptotic/term_monoid.py\", line 4698, in sage.rings.asymptotic.term_monoid.BTerm.can_absorb\n> Failed example:\n>     t2.absorb(t1)\n> Expected:\n>     B(2003/400*x^3, x >= 20)\n> Got:\n> ...\n>     DeprecationWarning: Passing 'coefficient' as a positional argument is deprecated; specify it as keyword argument 'coefficient=...'.\n>     See https://trac.sagemath.org/32215 for details.\n>     B(2003/400*x^3, x >= 20)\n> }}}\n\nYes, this should be resolved as well: it comes from https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/rings/asymptotic/term_monoid.py?id=683acc1eaa07fd3375bdd031516cfce30f1e363b#n4753, the coefficient should be passed via keyword argument.",
    "created_at": "2021-11-24T13:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456942",
    "user": "@behackl"
}
```

Replying to [comment:29 gh-thhagelmayer]:
> Somwthing went wrong with the last push here, so I went back to the status of `u/dkrenn/refactor-element-construction-term-monoids` and redid the merge and fixed the doctests. There is still one doctest failing:
> 
> 
> {{{
> File "src/sage/rings/asymptotic/term_monoid.py", line 4698, in sage.rings.asymptotic.term_monoid.BTerm.can_absorb
> Failed example:
>     t2.absorb(t1)
> Expected:
>     B(2003/400*x^3, x >= 20)
> Got:
> ...
>     DeprecationWarning: Passing 'coefficient' as a positional argument is deprecated; specify it as keyword argument 'coefficient=...'.
>     See https://trac.sagemath.org/32215 for details.
>     B(2003/400*x^3, x >= 20)
> }}}

Yes, this should be resolved as well: it comes from https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/rings/asymptotic/term_monoid.py?id=683acc1eaa07fd3375bdd031516cfce30f1e363b#n4753, the coefficient should be passed via keyword argument.



---

archive/issue_comments_456943.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-25T11:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456943",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456944.json:
```json
{
    "body": "I fixed the doctest in [7e7b5c7](https://git.sagemath.org/sage.git/commit/?id=7e7b5c7bf93c713e3688a94ccb33561092556b83)",
    "created_at": "2021-11-25T11:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456944",
    "user": "@thhagelmayer"
}
```

I fixed the doctest in [7e7b5c7](https://git.sagemath.org/sage.git/commit/?id=7e7b5c7bf93c713e3688a94ccb33561092556b83)



---

archive/issue_comments_456945.json:
```json
{
    "body": "I've managed to find the problem causing the `deprecation_number` plugin failure: looking at the implementation of the plugin over at https://github.com/sagemath/sage-patchbot/blob/745ec21b12f3bce03e8f1c8399cba0fb77bdc45c/sage_patchbot/plugins.py#L546, the plugin parses all //added// lines. If one of those contains `deprecation(` or `deprecated_function_alias(`, the code tries to parse the part following afterwards to find the ticket number, and then compares this parsed number to the actual ticket number.\n\nThe problem with our code is that we currently have\n\n```diff\n+            deprecation(\n+                32215,\n+                \"Passing 'coefficient' as a positional argument is deprecated; \"\n+                \"specify it as keyword argument 'coefficient=...'.\")\n```\n\nin our diff, so the code fails to properly parse the deprecation number. Changing this addition in `term_monoid.py` to\n\n```diff\n+            deprecation(32215,\n+                \"Passing 'coefficient' as a positional argument is deprecated; \"\n+                \"specify it as keyword argument 'coefficient=...'.\")\n```\n\nwill fix the failing test.",
    "created_at": "2021-11-25T20:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456945",
    "user": "@behackl"
}
```

I've managed to find the problem causing the `deprecation_number` plugin failure: looking at the implementation of the plugin over at https://github.com/sagemath/sage-patchbot/blob/745ec21b12f3bce03e8f1c8399cba0fb77bdc45c/sage_patchbot/plugins.py#L546, the plugin parses all //added// lines. If one of those contains `deprecation(` or `deprecated_function_alias(`, the code tries to parse the part following afterwards to find the ticket number, and then compares this parsed number to the actual ticket number.

The problem with our code is that we currently have

```diff
+            deprecation(
+                32215,
+                "Passing 'coefficient' as a positional argument is deprecated; "
+                "specify it as keyword argument 'coefficient=...'.")
```

in our diff, so the code fails to properly parse the deprecation number. Changing this addition in `term_monoid.py` to

```diff
+            deprecation(32215,
+                "Passing 'coefficient' as a positional argument is deprecated; "
+                "specify it as keyword argument 'coefficient=...'.")
```

will fix the failing test.



---

archive/issue_comments_456946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-26T10:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456947.json:
```json
{
    "body": "Replying to [comment:33 behackl]:\n> I've managed to find the problem causing the `deprecation_number` plugin failure: looking at the implementation of the plugin over at https://github.com/sagemath/sage-patchbot/blob/745ec21b12f3bce03e8f1c8399cba0fb77bdc45c/sage_patchbot/plugins.py#L546, the plugin parses all //added// lines. If one of those contains `deprecation(` or `deprecated_function_alias(`, the code tries to parse the part following afterwards to find the ticket number, and then compares this parsed number to the actual ticket number.\n> \n> The problem with our code is that we currently have\n> {{{#!diff\n> +            deprecation(\n> +                32215,\n> +                \"Passing 'coefficient' as a positional argument is deprecated; \"\n> +                \"specify it as keyword argument 'coefficient=...'.\")\n> }}}\n> in our diff, so the code fails to properly parse the deprecation number. Changing this addition in `term_monoid.py` to\n> {{{#!diff\n> +            deprecation(32215,\n> +                \"Passing 'coefficient' as a positional argument is deprecated; \"\n> +                \"specify it as keyword argument 'coefficient=...'.\")\n> }}}\n> will fix the failing test.\n\nI changed that line accordingly.",
    "created_at": "2021-11-26T10:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456947",
    "user": "@thhagelmayer"
}
```

Replying to [comment:33 behackl]:
> I've managed to find the problem causing the `deprecation_number` plugin failure: looking at the implementation of the plugin over at https://github.com/sagemath/sage-patchbot/blob/745ec21b12f3bce03e8f1c8399cba0fb77bdc45c/sage_patchbot/plugins.py#L546, the plugin parses all //added// lines. If one of those contains `deprecation(` or `deprecated_function_alias(`, the code tries to parse the part following afterwards to find the ticket number, and then compares this parsed number to the actual ticket number.
> 
> The problem with our code is that we currently have
> {{{#!diff
> +            deprecation(
> +                32215,
> +                "Passing 'coefficient' as a positional argument is deprecated; "
> +                "specify it as keyword argument 'coefficient=...'.")
> }}}
> in our diff, so the code fails to properly parse the deprecation number. Changing this addition in `term_monoid.py` to
> {{{#!diff
> +            deprecation(32215,
> +                "Passing 'coefficient' as a positional argument is deprecated; "
> +                "specify it as keyword argument 'coefficient=...'.")
> }}}
> will fix the failing test.

I changed that line accordingly.



---

archive/issue_comments_456948.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-01T09:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456948",
    "user": "@behackl"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_456949.json:
```json
{
    "body": "This seems fine to me now, thank you! The latest patchbot test failures seem unrelated.",
    "created_at": "2021-12-01T09:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456949",
    "user": "@behackl"
}
```

This seems fine to me now, thank you! The latest patchbot test failures seem unrelated.



---

archive/issue_comments_456950.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31978#issuecomment-456950",
    "user": "@vbraun"
}
```

Resolution: fixed
