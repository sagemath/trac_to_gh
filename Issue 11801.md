# Issue 11801: list_plot of a nearly constant sequence fails

Issue created by migration from Trac.

Original creator: ddrake

Original creation time: 2011-11-01 07:29:37

Assignee: jason, was

CC:  novoselt

Keywords: list_plot, matplotlib

At https://groups.google.com/d/topic/sage-devel/gu0Al01k-3Y/discussion I noted that list_plot/matplotlib are confused when given a nearly-constant sequence:

```
sage: list_plot([[0, 0.7886751345948214], [0.01, 0.788675134595], [0.02, 0.788675134595], [0.03, 0.788675134595], [0.04, 0.788675134595], [0.05, 0.788675134595], [0.06, 0.788675134595], [0.07, 0.788675134595], [0.08, 0.788675134595], [0.09, 0.788675134595], [0.1, 0.788675134595]])
```

fails with

```
...
/opt/sage/local/lib/python2.6/site-packages/matplotlib/axis.pyc in get_minorticklabels(self)
   1076     def get_minorticklabels(self):
   1077         'Return a list of Text instances for the minor ticklabels'
-> 1078         ticks = self.get_minor_ticks()
   1079         labels1 = [tick.label1 for tick in ticks if tick.label1On]
   1080         labels2 = [tick.label2 for tick in ticks if tick.label2On]

/opt/sage/local/lib/python2.6/site-packages/matplotlib/axis.pyc in get_minor_ticks(self, numticks)
   1190         'get the minor tick instances; grow as necessary'
   1191         if numticks is None:
-> 1192             numticks = len(self.get_minor_locator()())
   1193
   1194         if len(self.minorTicks) < numticks:

/opt/sage/local/lib/python2.6/site-packages/matplotlib/ticker.pyc in __call__(self)
   1424
   1425         # don't create minor ticks on top of existing major ticks
-> 1426         diff = 0.5 * abs(locs[1] - locs[0])
   1427         locs = [l for l in locs if (np.abs(l - majorlocs) > diff).all()]
   1428

IndexError: index out of bounds
```

(with 4.7.1 on 64-bit Linux.)

Since the usual plot() function works with constant functions, there should be a way to get this working. (Or, we should decide that this is a matplotlib bug and properly report it.)


---

Comment by kcrisman created at 2011-11-01 13:50:10

Here are a whole bunch of (closed) related tickets.
 * #2409 plotting constant functions
 * #3952 make plot use fast-float
 * #2604 dup of #2409
 * #4384 constant function causes division by zero
 * #5448 use mpl axes and other improvements
I suspect the last one has some clues, but I can't remember off-hand which of these _actually_ fixed that before.  Note that the error message here is different, because it's now an mpl error.


---

Comment by jason created at 2011-11-01 22:12:27

This happens with plot too:


```
plot(lambda x: x*1+(1-x)*(1+1e-13),(x,0,1))
```



---

Comment by jason created at 2011-11-01 22:33:27

It appears that the major locator is giving back bad values (i.e., somehow it is giving back [0,1,2] as the major tickmarks, which is then trimmed down to just 1, giving the minor locator error since there is only one major tickmark).

I think the problem is somewhere in matplotlib.ticker.MaxNLocator.bin_boundaries function, but I'm not sure.


---

Comment by jason created at 2011-11-01 22:34:45

My test cases are:


```
sage: list_plot([0,0+1e-14]) # works

sage: list_plot([1,1+1e-14]) # doesn't work

```



---

Comment by jason created at 2011-11-01 22:35:16

I think the next step would be to try to replicate it using only matplotlib.  If we can do that, we can move the bug report upstream.


---

Comment by jdemeyer created at 2011-11-03 16:14:43

Milestone sage-4.7.3 deleted


---

Comment by dsm created at 2012-05-25 19:27:04

I think we can bump this up:


```
import pylab
pylab.plot([0, 1], [0, 1e-14])
pylab.savefig("works.png")
pylab.close()
pylab.plot([0, 1], [1, 1+1e-14])
pylab.savefig("fails.png")
pylab.close()
```


reproduces the problem in mpl 1.2.x.


---

Comment by jason created at 2012-05-25 19:30:07

Great; if you can post to the matplotlib mailing list and post the thread URL here, that would be great.


---

Comment by novoselt created at 2012-05-25 19:32:08

Changing keywords from "list_plot, matplotlib" to "list_plot, matplotlib, sd40.5".


---

Comment by ddrake created at 2012-05-25 21:58:00

I'll contact matplotlib-devel and see what they think of the problem.


---

Comment by ddrake created at 2012-05-25 22:47:28

Interesting: the example I gave in the description works in 5.1beta0 (64-bit Linux), but the y-axis doesn't have any labels. The plot is correct for the given data, though.


---

Comment by chapoton created at 2015-03-21 21:03:39

everything works in 6.6.rc0


---

Comment by chapoton created at 2015-03-21 21:03:39

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-03-25 19:57:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-03-26 22:44:42

Resolution: fixed
