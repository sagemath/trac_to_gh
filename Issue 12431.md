# Issue 12431: copying cached_methods does not work properly

Issue created by migration from https://trac.sagemath.org/ticket/12603

Original creator: saraedum

Original creation time: 2012-02-27 19:31:30

Assignee: jason

CC:  simonking

Keywords: cached_method, cache

A few funny things can happen when copying cached methods:


```
sage: class A:
...       @cached_method
...       def f(self):
...           return 1
...
sage: class B:
...       g=A.f
...       def f(self):
...           return 2
...       
...
sage: b=B()
sage: b.f()
2
sage: b.g()
1
sage: b.f()
1
```


The problem is that a call to b.g leads to a new MethodCaller in b.f; something similar happens here:

```
sage: class C:
...       g=A.f
...
sage: c=C()
sage: c.g is c.g
False
sage: c.g is c.f
True
```



---

Comment by SimonKing created at 2012-02-27 19:56:53

Is that a new bug (i.e., introduced by my code from #11115)?

Anyway, it is not clear to me how the problem could be solved. Namely, a cached method knows the name under which it was defined, but if one assigns it to a different name afterwards, I see no way for the cached method to find out that new name.


---

Comment by SimonKing created at 2012-02-27 19:56:53

Changing type from PLEASE CHANGE to defect.


---

Comment by saraedum created at 2015-10-04 22:23:08

New commits:


---

Comment by saraedum created at 2015-10-04 22:23:08

Changing status from new to needs_review.


---

Comment by roed created at 2015-11-05 01:18:12

Changing status from needs_review to needs_work.


---

Comment by roed created at 2015-11-05 01:18:12

Need to use ....: doctest continuations rather than ...


---

Comment by git created at 2015-11-05 01:49:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2015-11-05 01:49:40

Changing status from needs_work to needs_review.


---

Comment by roed created at 2015-11-05 01:53:23

Looks good.  Positive review once the tests all pass.


---

Comment by aly.deines created at 2016-03-24 16:19:55

Changing status from needs_review to positive_review.


---

Comment by aly.deines created at 2016-03-24 16:19:55

Changing keywords from "cached_method, cache" to "cached_method, cache, days71".


---

Comment by aly.deines created at 2016-03-24 16:19:55

All tests pass. :)


---

Comment by vbraun created at 2016-03-24 23:39:46

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-03-24 23:39:46

Reviewer name


---

Comment by roed created at 2016-03-24 23:46:59

Aly, you can add yourself if you like.  ;-)


---

Comment by roed created at 2016-03-24 23:46:59

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-03-25 08:38:53

Merge conflict, possibly with #15692


---

Comment by vbraun created at 2016-03-27 07:44:19

Resolution: fixed
