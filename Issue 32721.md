# Issue 32721: do not compute more elements than asked for on submission

Issue created by migration from https://trac.sagemath.org/ticket/32958

Original creator: mantepse

Original creation time: 2021-12-02 10:29:08




---

Comment by mantepse created at 2021-12-02 10:34:58

New commits:


---

Comment by mantepse created at 2021-12-02 10:34:58

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mantepse created at 2021-12-02 10:34:58

Changing keywords from "" to "findstat".


---

Comment by mantepse created at 2021-12-02 10:34:58

Changing status from new to needs_review.


---

Comment by mantepse created at 2021-12-02 10:34:58

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by git created at 2021-12-03 09:28:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-12 20:21:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-14 20:29:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-15 05:35:55

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-02-15 05:35:55

LGTM.


---

Comment by vbraun created at 2022-02-20 10:03:49

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-02-20 10:03:49


```
**********************************************************************
File "src/sage/databases/findstat.py", line 1020, in sage.databases.findstat.?
Failed example:
    findstat("Permutations", lambda x: 1, depth="x")
Expected:
    Traceback (most recent call last):
    ...
    ValueError: E021: Depth should be a non-negative integer at most 9, but is x.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6061)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3815)
        raise KeyError(k)
    KeyError: ((<class 'sage.databases.findstat.FindStatCollections'>,), ())
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connection.py", line 169, in _new_conn
        conn = connection.create_connection(
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/util/connection.py", line 96, in create_connection
        raise err
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/util/connection.py", line 86, in create_connection
        sock.connect(sa)
    OSError: [Errno 65] No route to host
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connectionpool.py", line 696, in urlopen
        self._prepare_proxy(conn)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connectionpool.py", line 964, in _prepare_proxy
        conn.connect()
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connection.py", line 353, in connect
        conn = self._new_conn()
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connection.py", line 181, in _new_conn
        raise NewConnectionError(
    urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x1690059a0>: Failed to establish a new connection: [Errno 65] No route to host
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/adapters.py", line 439, in send
        resp = conn.urlopen(
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connectionpool.py", line 755, in urlopen
        retries = retries.increment(
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/util/retry.py", line 574, in increment
        raise MaxRetryError(_pool, url, error or ResponseError(cause))
    urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='www.findstat.org', port=443): Max retries exceeded with url: /api/CollectionsDatabase/?fields=LevelsWithSizes,Name,NamePlural,NameWiki (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1690059a0>: Failed to establish a new connection: [Errno 65] No route to host')))
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.databases.findstat.?[1]>", line 1, in <module>
        findstat("Permutations", lambda x: Integer(1), depth="x")
      File "sage/misc/lazy_import.pyx", line 391, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4250)
        return self.get_object()(*args, **kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 1107, in findstat
        domain = FindStatCollection(domain)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1842)
        return cls.classcall(cls, *args, **kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 4014, in __classcall_private__
        return FindStatCollections()(entry)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1842)
        return cls.classcall(cls, *args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6189)
        w = self.f(*args, **kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2306)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 4639, in __init__
        d = _get_json(url, object_pairs_hook=OrderedDict)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 439, in _get_json
        response = requests.get(url)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/api.py", line 75, in get
        return request('get', url, params=params, **kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/api.py", line 61, in request
        return session.request(method=method, url=url, **kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/sessions.py", line 542, in request
        resp = self.send(prep, **send_kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/sessions.py", line 655, in send
        r = adapter.send(request, **kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/adapters.py", line 510, in send
        raise ProxyError(e, request=request)
    requests.exceptions.ProxyError: HTTPSConnectionPool(host='www.findstat.org', port=443): Max retries exceeded with url: /api/CollectionsDatabase/?fields=LevelsWithSizes,Name,NamePlural,NameWiki (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1690059a0>: Failed to establish a new connection: [Errno 65] No route to host')))
**********************************************************************
File "src/sage/databases/findstat.py", line 1025, in sage.databases.findstat.?
Failed example:
    findstat("Permutations", lambda x: 1, depth=100)
Expected:
    Traceback (most recent call last):
    ...
    ValueError: E021: Depth should be a non-negative integer at most 9, but is 100.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6061)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3815)
        raise KeyError(k)
    KeyError: ((<class 'sage.databases.findstat.FindStatCollections'>,), ())
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connection.py", line 169, in _new_conn
        conn = connection.create_connection(
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/util/connection.py", line 96, in create_connection
        raise err
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/util/connection.py", line 86, in create_connection
        sock.connect(sa)
    OSError: [Errno 65] No route to host
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connectionpool.py", line 696, in urlopen
        self._prepare_proxy(conn)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connectionpool.py", line 964, in _prepare_proxy
        conn.connect()
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connection.py", line 353, in connect
        conn = self._new_conn()
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connection.py", line 181, in _new_conn
        raise NewConnectionError(
    urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x168ffaeb0>: Failed to establish a new connection: [Errno 65] No route to host
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/adapters.py", line 439, in send
        resp = conn.urlopen(
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/connectionpool.py", line 755, in urlopen
        retries = retries.increment(
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/urllib3/util/retry.py", line 574, in increment
        raise MaxRetryError(_pool, url, error or ResponseError(cause))
    urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='www.findstat.org', port=443): Max retries exceeded with url: /api/CollectionsDatabase/?fields=LevelsWithSizes,Name,NamePlural,NameWiki (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x168ffaeb0>: Failed to establish a new connection: [Errno 65] No route to host')))
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.databases.findstat.?[2]>", line 1, in <module>
        findstat("Permutations", lambda x: Integer(1), depth=Integer(100))
      File "sage/misc/lazy_import.pyx", line 391, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4250)
        return self.get_object()(*args, **kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 1107, in findstat
        domain = FindStatCollection(domain)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1842)
        return cls.classcall(cls, *args, **kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 4014, in __classcall_private__
        return FindStatCollections()(entry)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1842)
        return cls.classcall(cls, *args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6189)
        w = self.f(*args, **kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2306)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 4639, in __init__
        d = _get_json(url, object_pairs_hook=OrderedDict)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/databases/findstat.py", line 439, in _get_json
        response = requests.get(url)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/api.py", line 75, in get
        return request('get', url, params=params, **kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/api.py", line 61, in request
        return session.request(method=method, url=url, **kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/sessions.py", line 542, in request
        resp = self.send(prep, **send_kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/sessions.py", line 655, in send
        r = adapter.send(request, **kwargs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/requests/adapters.py", line 510, in send
        raise ProxyError(e, request=request)
    requests.exceptions.ProxyError: HTTPSConnectionPool(host='www.findstat.org', port=443): Max retries exceeded with url: /api/CollectionsDatabase/?fields=LevelsWithSizes,Name,NamePlural,NameWiki (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x168ffaeb0>: Failed to establish a new connection: [Errno 65] No route to host')))
**********************************************************************
1 item had failures:
   2 of  16 in sage.databases.findstat.?
    [137 tests, 2 failures, 0.32 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/databases/findstat.py  # 2 doctests failed
----------------------------------------------------------------------
```



---

Comment by git created at 2022-02-20 20:09:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-02-20 20:09:45

Changing status from needs_work to needs_review.


---

Comment by mantepse created at 2022-02-20 20:10:05

I am sorry, Volker.  Please excuse me.


---

Comment by tscrim created at 2022-02-21 05:46:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-27 22:00:32

Resolution: fixed
