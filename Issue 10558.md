# Issue 10558: IPython magic functions in the Sage preparser

Issue created by migration from Trac.

Original creator: eviatarbach

Original creation time: 2011-01-12 23:28:36

Assignee: was

IPython's magic functions, when not escaped by %, are preparsed by Sage as variables. For example, with implicit multiplication turned on:

```
sage: cd Desktop/          
------------------------------------------------------------
   File "<ipython console>", line 1
     cd*Desktop/
                ^
SyntaxError: invalid syntax
```


This patch adds the IPython magic functions as keywords, and fixes this problem.


---

Comment by eviatarbach created at 2011-01-12 23:32:50

Adds IPython magic functions to the Sage preparser


---

Attachment


---

Comment by eviatarbach created at 2011-01-12 23:45:22

Changing status from new to needs_review.


---

Comment by robertwb created at 2011-01-27 06:07:36

Hmm... I'm not so sure "r" should be included in this, as it's more likely to be used as a variable. Also, this doesn't handle


```
sage: ls /path/with/number/100
sh: -c: line 0: syntax error near unexpected token `('
sh: -c: line 0: `ls -F /path/with/number/Integer(100)'
```


I would rather something that looks at the first "word" to see if it's a iPython magic function and doesn't preparse at all in that case.


---

Comment by robertwb created at 2011-01-27 06:07:36

Changing status from needs_review to needs_work.


---

Comment by eviatarbach created at 2011-06-01 01:12:25

Remove assignee was.


---

Comment by eviatarbach created at 2011-06-01 01:12:25

Yes, this is not the ideal solution. Closing.


---

Comment by knsam created at 2013-02-03 19:04:20

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2013-02-24 02:14:15

Changing status from needs_review to needs_info.


---

Comment by kcrisman created at 2013-02-24 02:14:15

This probably needs more discussion... especially after the IPython upgrade.


---

Comment by chapoton created at 2018-06-28 19:47:43

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2018-06-28 19:47:43

should we close this one ?


---

Comment by embray created at 2018-08-14 17:40:51

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-08-14 17:40:51

Clearing milestone since I don't know when this will be fixed, or if anyone wants to tackle it, but it is still buggy.  E.g. this works no problem:


```
sage: mkdir abc
sage: ls -ld abc
drwxr-xr-x+ 1 Erik M. Bray 0 Aug 14 19:37 abc/
```


But this is broken:


```
sage: mkdir 100
/bin/bash: -c: line 0: syntax error near unexpected token `('
/bin/bash: -c: line 0: `mkdir Integer(100)'
```


I don't know how difficult this would be to fix, but the Sage REPL should probably talk to IPython's parser to find out when a line of input would be processed as a command-line command and _not_ run the Sage preparser on it.
