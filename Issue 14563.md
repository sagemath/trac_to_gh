# Issue 14563: import_statements() does not work with lazy imports

Issue created by migration from Trac.

Original creator: tmonteil

Original creation time: 2013-06-18 20:37:07

Assignee: jason

CC:  vdelecroix

Keywords: days49

Here is an example:


```
sage: import_statements('NN')
from sage.misc.lazy_import import NN
sage: from sage.misc.lazy_import import NN
...
ImportError: cannot import name NN
```


However, it is able to answer correctly with a few help:


```
sage: import_statements('NN', lazy=True)  
from sage.misc.lazy_import import lazy_import
lazy_import('sage.misc.lazy_import', 'NN')
sage: from sage.misc.lazy_import import lazy_import
sage: lazy_import('sage.misc.lazy_import', 'NN'
```


Hence `import_statements()` should fall to `import_statements(lazy=True)` when necessary.


---

Attachment

I strongly disagree by putting lazy as True for lazy imported objects. The behavior is nevertheless corrected with a two line patch which needs review (but the description of the ticket needs to be modified accordingly if you agree with my solution).

Vincent


---

Comment by vdelecroix created at 2013-06-24 18:19:30

Changing status from new to needs_review.


---

Comment by nthiery created at 2013-06-24 20:11:50

Replying to [comment:2 vdelecroix]:
> I strongly disagree by putting lazy as True for lazy imported objects.

What's your rationale? If something is lazy imported in the global
name space, then it's likely that whoever needs it will want to lazy
import it, no?

The only drawback is that lazy imported classes are a bit more fragile
due to the isinstance issue.

> The behavior is nevertheless corrected with a two line patch which
> needs review (but the description of the ticket needs to be modified
> accordingly if you agree with my solution).

I'll have a look.

Cheers,
                        Nicolas


---

Comment by nthiery created at 2013-06-24 20:36:12

Assuming all test pass, positive review on the current patch for resolving properly lazy imports.


---

Comment by nthiery created at 2013-06-24 20:39:22

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2013-06-25 04:35:26

Replying to [comment:4 nthiery]:
> Replying to [comment:2 vdelecroix]:
> > I strongly disagree by putting lazy as True for lazy imported objects.
> 
> What's your rationale? If something is lazy imported in the global
> name space, then it's likely that whoever needs it will want to lazy
> import it, no?
>
> The only drawback is that lazy imported classes are a bit more fragile
> due to the isinstance issue.

I am not an expert of the lazy import buisness, but I do not want an extra layer on the objects I import. If I use a standard import statement inside a module it will neither affect the global namespace nor the starting time, right ?

> > The behavior is nevertheless corrected with a two line patch which
> > needs review (but the description of the ticket needs to be modified
> > accordingly if you agree with my solution).
> 
> I'll have a look.

Many thanks!

Cheers,
Vincent


---

Comment by nthiery created at 2013-06-25 12:58:44

Replying to [comment:7 vdelecroix]:
> I am not an expert of the lazy import buisness, but I do not want an
> extra layer on the objects I import. If I use a standard import
> statement inside a module it will neither affect the global
> namespace nor the starting time, right ?

Assuming your module is lazy imported, yes.

So your point is that, if a module is lazy imported (which should
progressively become the case most of the time), then within it the
modules it depends upon may as well be imported rather than lazy
imported. Ok, this sounds fair enough!

So positive review assuming the patchbot goes green.


---

Comment by nthiery created at 2013-06-25 12:58:56

Changing status from needs_info to needs_review.


---

Comment by nthiery created at 2013-06-25 12:59:14

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2013-06-25 13:10:19

Thanks Nicolas!


---

Comment by tmonteil created at 2013-06-25 21:07:24

The patch works for me as well, and fixes the bug i mentionned.

However, i think both points of view are valid:

- it is useless to add a layer when one imports a module for a direct use.
- on the other hand, developpers using this to modify Sage's source code
  should know that the module is currently only lazy imported. Indeed, if
  they "hard" import the module, this will lose the benefits of related
  lazy imports in terms of startup time.

As a limited developper, if i didn't fall on the bug when writing #10358,
i would have written 
`from sage.rings.semirings.non_negative_integer_semiring import NN`
instead of
`lazy_import('sage.rings.semirings.non_negative_integer_semiring','NN')`.

Hence, what i may suggest it to keep Vincent's behaviour as first output, and
when the module is only lazy imported in the Sage code, then add a warning
explaining this, and output the lazy statement as well.

Does this make sense ?

Thierry (late as usually, or perhaps is the workflow too fast for me ;)


---

Comment by nthiery created at 2013-06-25 21:18:26

Replying to [comment:13 tmonteil]:
> - on the other hand, developpers using this to modify Sage's source code
>   should know that the module is currently only lazy imported. Indeed, if
>   they "hard" import the module, this will lose the benefits of related
>   lazy imports in terms of startup time.

Maybe not an issue, since now Sage complains if a lazy imported module is resolved at startup time. Ah but this might not be the case if the module is imported through another path ...

Well, let's get this patch in and think about it for the future.


---

Comment by jdemeyer created at 2013-07-31 12:56:59

Resolution: fixed
