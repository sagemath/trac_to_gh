# Issue 24854: Expose some normaliz features

archive/issues_024854.json:
```json
{
    "body": "CC:  @videlec @mo271 @mkoeppe @sebasguts winfried @braunmath @tscrim\n\nKeywords: polytope, normaliz, IMA-PolyGeom\n\nUsing Normaliz can compute several things that are currently not interfaced. For example:\n\n- Integral points generators\n- Volume\n- Euclidean volume\n- Triangulations\n\nThis ticket provides some new features.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25091\n\n",
    "created_at": "2018-04-03T18:59:18Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Expose some normaliz features",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24854",
    "user": "https://github.com/jplab"
}
```
CC:  @videlec @mo271 @mkoeppe @sebasguts winfried @braunmath @tscrim

Keywords: polytope, normaliz, IMA-PolyGeom

Using Normaliz can compute several things that are currently not interfaced. For example:

- Integral points generators
- Volume
- Euclidean volume
- Triangulations

This ticket provides some new features.

Issue created by migration from https://trac.sagemath.org/ticket/25091





---

archive/issue_comments_348691.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2018-04-03T19:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348691",
    "user": "https://github.com/jplab"
}
```

Last 10 new commits:



---

archive/issue_comments_348692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-03T19:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348693.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-03T19:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348693",
    "user": "https://github.com/jplab"
}
```

New commits:



---

archive/issue_comments_348694.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-03T23:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348694",
    "user": "https://github.com/jplab"
}
```

New commits:



---

archive/issue_comments_348695.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T00:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T14:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348697.json:
```json
{
    "body": "Note that `is_package_installed` is being deprecated, see #20382",
    "created_at": "2018-04-04T14:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348697",
    "user": "https://github.com/videlec"
}
```

Note that `is_package_installed` is being deprecated, see #20382



---

archive/issue_comments_348698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T19:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T19:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348700.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T19:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T20:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-07T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348703.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-07T18:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348703",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-08T16:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-08T17:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348706.json:
```json
{
    "body": "It's probably best to add all lattice-point related methods to `Polyhedron_QQ_normaliz` rather than `Polyhedron_normaliz` in anticipation of #25097 (which moves `integral_points` and `integral_hull` there).",
    "created_at": "2018-04-09T04:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348706",
    "user": "https://github.com/mkoeppe"
}
```

It's probably best to add all lattice-point related methods to `Polyhedron_QQ_normaliz` rather than `Polyhedron_normaliz` in anticipation of #25097 (which moves `integral_points` and `integral_hull` there).



---

archive/issue_comments_348707.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> It's probably best to add all lattice-point related methods to `Polyhedron_QQ_normaliz` rather than `Polyhedron_normaliz` in anticipation of #25097 (which moves `integral_points` and `integral_hull` there). \n\nI see. Yes I can do that.",
    "created_at": "2018-04-09T13:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348707",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:18 mkoeppe]:
> It's probably best to add all lattice-point related methods to `Polyhedron_QQ_normaliz` rather than `Polyhedron_normaliz` in anticipation of #25097 (which moves `integral_points` and `integral_hull` there). 

I see. Yes I can do that.



---

archive/issue_comments_348708.json:
```json
{
    "body": "Replying to [comment:19 jipilab]:\n> Replying to [comment:18 mkoeppe]:\n> > It's probably best to add all lattice-point related methods to `Polyhedron_QQ_normaliz` rather than `Polyhedron_normaliz` in anticipation of #25097 (which moves `integral_points` and `integral_hull` there). \n> \n> I see. Yes I can do that.\n\nAs discussed with mkoeppe: The move of the rational polyhedron methods will be done in #25097. The merge should go without conflicts.",
    "created_at": "2018-04-09T14:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348708",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:19 jipilab]:
> Replying to [comment:18 mkoeppe]:
> > It's probably best to add all lattice-point related methods to `Polyhedron_QQ_normaliz` rather than `Polyhedron_normaliz` in anticipation of #25097 (which moves `integral_points` and `integral_hull` there). 
> 
> I see. Yes I can do that.

As discussed with mkoeppe: The move of the rational polyhedron methods will be done in #25097. The merge should go without conflicts.



---

archive/issue_comments_348709.json:
```json
{
    "body": "Replying to [comment:7 vdelecroix]:\n> Note that `is_package_installed` is being deprecated, see #20382\n\nOh! Wow! Thanks for the timely warning! I set it as a dependency. I will change the check once it is merged...",
    "created_at": "2018-04-09T15:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348709",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:7 vdelecroix]:
> Note that `is_package_installed` is being deprecated, see #20382

Oh! Wow! Thanks for the timely warning! I set it as a dependency. I will change the check once it is merged...



---

archive/issue_comments_348710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-09T15:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T19:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T20:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T22:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T22:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_062920.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-08-05T12:38:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24854#event-62920"
}
```



---

archive/issue_comments_348715.json:
```json
{
    "body": "Out of interest: Given a monomial ideal in Sage, how can one compute its Hilbert series using normaliz?",
    "created_at": "2018-09-11T15:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348715",
    "user": "https://github.com/simon-king-jena"
}
```

Out of interest: Given a monomial ideal in Sage, how can one compute its Hilbert series using normaliz?



---

archive/issue_comments_348716.json:
```json
{
    "body": "Replying to [comment:21 jipilab]:\n> Replying to [comment:7 vdelecroix]:\n> > Note that `is_package_installed` is being deprecated, see #20382\n> \n> Oh! Wow! Thanks for the timely warning! I set it as a dependency. I will change the check once it is merged...\n\nIt is really a pity that #20382 doesn't explain (in the ticket description!!!) what one is supposed to do instead of `is_package_installed`.\n\nSo, how would one change the current branch to make it use #20382?",
    "created_at": "2018-09-11T16:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348716",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:21 jipilab]:
> Replying to [comment:7 vdelecroix]:
> > Note that `is_package_installed` is being deprecated, see #20382
> 
> Oh! Wow! Thanks for the timely warning! I set it as a dependency. I will change the check once it is merged...

It is really a pity that #20382 doesn't explain (in the ticket description!!!) what one is supposed to do instead of `is_package_installed`.

So, how would one change the current branch to make it use #20382?



---

archive/issue_comments_348717.json:
```json
{
    "body": "Replying to SimonKing\n\nNormaliz can compute Hilbert series of the integral closures of monomial ideals, not of arbitrary monomial ideals. If one wants to apply it: input the monomials as vertices, the polynomial ring as cone (= unit matrix), and put the weights of the indeterminates into the grading.\n\nExample for Normaliz input (integral closure of (x^2, y^2, deg x = 2, deg y =1)\n\n\n\n```\namb_space 2\nvertices 2\n2 0 1\n0 2 1\ncone 2\n1 0\n0 1\ngrading \n2 1\nHilbertSeries\n```\n",
    "created_at": "2018-09-11T19:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348717",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

Replying to SimonKing

Normaliz can compute Hilbert series of the integral closures of monomial ideals, not of arbitrary monomial ideals. If one wants to apply it: input the monomials as vertices, the polynomial ring as cone (= unit matrix), and put the weights of the indeterminates into the grading.

Example for Normaliz input (integral closure of (x^2, y^2, deg x = 2, deg y =1)



```
amb_space 2
vertices 2
2 0 1
0 2 1
cone 2
1 0
0 1
grading 
2 1
HilbertSeries
```




---

archive/issue_comments_348718.json:
```json
{
    "body": "Replying to [comment:31 Winfried]:\n> Replying to SimonKing\n> \n> Normaliz can compute Hilbert series of the integral closures of monomial ideals, not of arbitrary monomial ideals. If one wants to apply it: input the monomials as vertices, the polynomial ring as cone (= unit matrix), and put the weights of the indeterminates into the grading.\n> \n> Example for Normaliz input (integral closure of (x^2, y^2, deg x = 2, deg y =1)\n> \n> \n> {{{\n> amb_space 2\n> vertices 2\n> 2 0 1\n> 0 2 1\n> cone 2\n> 1 0\n> 0 1\n> grading \n> 2 1\n> HilbertSeries\n> }}}\n\nThank you. But my question was really: Given a monomial ideal **in Sage**, how to compute the Hilbert series of it (or maybe of its integral closure) using normaliz as a backend (not: *in* normaliz).\n\nI.e.:\n\n```\n        sage: n=4;m=11;P = PolynomialRing(QQ,n*m,\"x\"); x = P.gens(); M = Matrix(n,x)\n        sage: I = P.ideal(M.minors(2))\n        sage: J = P*[m.lm() for m in I.groebner_basis()]\n```\n\nand what now? How to use the new interface to normaliz to compute the Hilbert series of (the integral closure of) `J`?\n\nSince I never worked with the integral closure of a monomial ideal: How are the Hilbert series of the ideal and its integral closure related?",
    "created_at": "2018-09-11T19:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348718",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:31 Winfried]:
> Replying to SimonKing
> 
> Normaliz can compute Hilbert series of the integral closures of monomial ideals, not of arbitrary monomial ideals. If one wants to apply it: input the monomials as vertices, the polynomial ring as cone (= unit matrix), and put the weights of the indeterminates into the grading.
> 
> Example for Normaliz input (integral closure of (x^2, y^2, deg x = 2, deg y =1)
> 
> 
> {{{
> amb_space 2
> vertices 2
> 2 0 1
> 0 2 1
> cone 2
> 1 0
> 0 1
> grading 
> 2 1
> HilbertSeries
> }}}

Thank you. But my question was really: Given a monomial ideal **in Sage**, how to compute the Hilbert series of it (or maybe of its integral closure) using normaliz as a backend (not: *in* normaliz).

I.e.:

```
        sage: n=4;m=11;P = PolynomialRing(QQ,n*m,"x"); x = P.gens(); M = Matrix(n,x)
        sage: I = P.ideal(M.minors(2))
        sage: J = P*[m.lm() for m in I.groebner_basis()]
```

and what now? How to use the new interface to normaliz to compute the Hilbert series of (the integral closure of) `J`?

Since I never worked with the integral closure of a monomial ideal: How are the Hilbert series of the ideal and its integral closure related?



---

archive/issue_comments_348719.json:
```json
{
    "body": "\"What now?\" is a question that Jean-Philippe should answer. I have no overview which of the Normaliz computation goals can be reached from Sage. However, all of them can be reached via PyNormaliz. For example, Normaliz can take a binomial ideal (suitably encoded) as input. It finds the affine monoid A defined by the binomial ideal, and then computes invariants of the normalization of A.\n\nI think there is no way to relate the Hilbert series of an ideal I and the Hilbert series of its integral closure in a useful way.",
    "created_at": "2018-09-12T07:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348719",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

"What now?" is a question that Jean-Philippe should answer. I have no overview which of the Normaliz computation goals can be reached from Sage. However, all of them can be reached via PyNormaliz. For example, Normaliz can take a binomial ideal (suitably encoded) as input. It finds the affine monoid A defined by the binomial ideal, and then computes invariants of the normalization of A.

I think there is no way to relate the Hilbert series of an ideal I and the Hilbert series of its integral closure in a useful way.



---

archive/issue_comments_348720.json:
```json
{
    "body": "> \n> Thank you. But my question was really: Given a monomial ideal **in Sage**, how to compute the Hilbert series of it (or maybe of its integral closure) using normaliz as a backend (not: *in* normaliz).\n> \n> I.e.:\n> {{{\n>         sage: n=4;m=11;P = PolynomialRing(QQ,n*m,\"x\"); x = P.gens(); M = Matrix(n,x)\n>         sage: I = P.ideal(M.minors(2))\n>         sage: J = P*[m.lm() for m in I.groebner_basis()]\n> }}}\n> and what now? How to use the new interface to normaliz to compute the Hilbert series of (the integral closure of) `J`?\n> \n> Since I never worked with the integral closure of a monomial ideal: How are the Hilbert series of the ideal and its integral closure related?\n\nMy knowledge of the theory lacks in order to give you a satisfactory answer to your questions.\n\nThe present ticket allows you to get the Hilbert series *of a rational polyhedron*. Whether this Hilbert series *is* or corresponds to the Hilbert series of a monomial ideal should be clarified. In case they match, then, what I would do in Sage is\n\n1) a function that transfers the data of the monomial ideal to a polyhedron that uses the backend normaliz and compute its hilbert series (a function implemented in this ticket).\n\n2) use PyNormaliz package directly as the normaliz backend of polyhedron is currently doing. This is not really well documented as its usage is currently only in the backend for polyhedron.\n\nFor this, the present ticket provides some useful functions to deal with PyNormaliz that builds on #25090.",
    "created_at": "2018-09-17T15:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348720",
    "user": "https://github.com/jplab"
}
```

> 
> Thank you. But my question was really: Given a monomial ideal **in Sage**, how to compute the Hilbert series of it (or maybe of its integral closure) using normaliz as a backend (not: *in* normaliz).
> 
> I.e.:
> {{{
>         sage: n=4;m=11;P = PolynomialRing(QQ,n*m,"x"); x = P.gens(); M = Matrix(n,x)
>         sage: I = P.ideal(M.minors(2))
>         sage: J = P*[m.lm() for m in I.groebner_basis()]
> }}}
> and what now? How to use the new interface to normaliz to compute the Hilbert series of (the integral closure of) `J`?
> 
> Since I never worked with the integral closure of a monomial ideal: How are the Hilbert series of the ideal and its integral closure related?

My knowledge of the theory lacks in order to give you a satisfactory answer to your questions.

The present ticket allows you to get the Hilbert series *of a rational polyhedron*. Whether this Hilbert series *is* or corresponds to the Hilbert series of a monomial ideal should be clarified. In case they match, then, what I would do in Sage is

1) a function that transfers the data of the monomial ideal to a polyhedron that uses the backend normaliz and compute its hilbert series (a function implemented in this ticket).

2) use PyNormaliz package directly as the normaliz backend of polyhedron is currently doing. This is not really well documented as its usage is currently only in the backend for polyhedron.

For this, the present ticket provides some useful functions to deal with PyNormaliz that builds on #25090.



---

archive/issue_comments_348721.json:
```json
{
    "body": "Would this compute what you want? I did this with the current ticket and merge with the latest sage.\n\n\n```\n\nsage: n=4;m=11;P = PolynomialRing(QQ,n*m,\"x\"); x = P.gens(); M = Matrix(n,x)\nsage: I = P.ideal(M.minors(2))\nsage: J = P*[m.lm() for m in I.groebner_basis()]\nsage: P = Polyhedron(rays=[m.degrees() for m in J.gens()],backend='normaliz')\nsage: P\nA 42-dimensional polyhedron in ZZ^44 defined as the convex hull of 1 vertex and 330 rays\nsage: P.hilbert_series()\n\n```\n\n\nWell, I'd say this is a quite large computation involving triangulating a 42 dimensional polyhedron with 330 vertices...",
    "created_at": "2018-09-17T15:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348721",
    "user": "https://github.com/jplab"
}
```

Would this compute what you want? I did this with the current ticket and merge with the latest sage.


```

sage: n=4;m=11;P = PolynomialRing(QQ,n*m,"x"); x = P.gens(); M = Matrix(n,x)
sage: I = P.ideal(M.minors(2))
sage: J = P*[m.lm() for m in I.groebner_basis()]
sage: P = Polyhedron(rays=[m.degrees() for m in J.gens()],backend='normaliz')
sage: P
A 42-dimensional polyhedron in ZZ^44 defined as the convex hull of 1 vertex and 330 rays
sage: P.hilbert_series()

```


Well, I'd say this is a quite large computation involving triangulating a 42 dimensional polyhedron with 330 vertices...



---

archive/issue_comments_348722.json:
```json
{
    "body": "What one really wants is not the Hilbert series of the ideal. The goal is the Hilbert series of the residue class ring defined by the ideal. The residue class ring can be identified with a monomial algebra of Krull dimension 14. The Hilbert series is easily calculated. If one wants to use Normaliz for it, then the best approach is to input the binomial ideal to Normaliz.\n\nYou make a matrix of integer vectors whose rows represent the binomials in the form v-w, corresponding to x^v - x^w. The input type is \"lattice_ideal\". You must also define a grading. Simply say \"total_degree\". In this case it represents a vector with 44 entries 1.\n\nThat one can go this way is due to the fact that the residue class ring is a normal monoid algebra. In general this is not the case.",
    "created_at": "2018-09-17T16:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348722",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

What one really wants is not the Hilbert series of the ideal. The goal is the Hilbert series of the residue class ring defined by the ideal. The residue class ring can be identified with a monomial algebra of Krull dimension 14. The Hilbert series is easily calculated. If one wants to use Normaliz for it, then the best approach is to input the binomial ideal to Normaliz.

You make a matrix of integer vectors whose rows represent the binomials in the form v-w, corresponding to x^v - x^w. The input type is "lattice_ideal". You must also define a grading. Simply say "total_degree". In this case it represents a vector with 44 entries 1.

That one can go this way is due to the fact that the residue class ring is a normal monoid algebra. In general this is not the case.



---

archive/issue_comments_348723.json:
```json
{
    "body": "Replying to [comment:30 SimonKing]:\n> Replying to [comment:21 jipilab]:\n> > Replying to [comment:7 vdelecroix]:\n> > > Note that `is_package_installed` is being deprecated, see #20382\n> > \n> > Oh! Wow! Thanks for the timely warning! I set it as a dependency. I will change the check once it is merged...\n> \n> It is really a pity that #20382 doesn't explain (in the ticket description!!!) what one is supposed to do instead of `is_package_installed`.\n\nIndeed.",
    "created_at": "2018-09-17T17:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348723",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:30 SimonKing]:
> Replying to [comment:21 jipilab]:
> > Replying to [comment:7 vdelecroix]:
> > > Note that `is_package_installed` is being deprecated, see #20382
> > 
> > Oh! Wow! Thanks for the timely warning! I set it as a dependency. I will change the check once it is merged...
> 
> It is really a pity that #20382 doesn't explain (in the ticket description!!!) what one is supposed to do instead of `is_package_installed`.

Indeed.



---

archive/issue_comments_348724.json:
```json
{
    "body": "Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.\n\nSo I would remove it from the necessary things to do for this ticket.",
    "created_at": "2018-09-17T18:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348724",
    "user": "https://github.com/jplab"
}
```

Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.

So I would remove it from the necessary things to do for this ticket.



---

archive/issue_comments_348725.json:
```json
{
    "body": "Replying to [comment:38 jipilab]:\n> Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.\n> \n> So I would remove it from the necessary things to do for this ticket.\n\nI tend to disagree. `is_package_installed` is used here to test whether pynormaliz, normaliz, or latte_int is available. And it may be available for reasons that have nothing to do with `sage -i`.",
    "created_at": "2018-09-17T21:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348725",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:38 jipilab]:
> Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.
> 
> So I would remove it from the necessary things to do for this ticket.

I tend to disagree. `is_package_installed` is used here to test whether pynormaliz, normaliz, or latte_int is available. And it may be available for reasons that have nothing to do with `sage -i`.



---

archive/issue_comments_348726.json:
```json
{
    "body": "Replying to [comment:39 SimonKing]:\n> Replying to [comment:38 jipilab]:\n> > Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.\n> > \n> > So I would remove it from the necessary things to do for this ticket.\n> \n> I tend to disagree. `is_package_installed` is used here to test whether pynormaliz, normaliz, or latte_int is available. And it may be available for reasons that have nothing to do with `sage -i`.\n\nOkay. Nevertheless, the mentionned ticket does not provide a way to check if they are available or not. Right?",
    "created_at": "2018-09-19T00:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348726",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:39 SimonKing]:
> Replying to [comment:38 jipilab]:
> > Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.
> > 
> > So I would remove it from the necessary things to do for this ticket.
> 
> I tend to disagree. `is_package_installed` is used here to test whether pynormaliz, normaliz, or latte_int is available. And it may be available for reasons that have nothing to do with `sage -i`.

Okay. Nevertheless, the mentionned ticket does not provide a way to check if they are available or not. Right?



---

archive/issue_comments_348727.json:
```json
{
    "body": "Replying to [comment:40 jipilab]:\n> Okay. Nevertheless, the mentionned ticket does not provide a way to check if they are available or not. Right?\n\nYes, it doesn't. But I guess that's because the author of that ticket thought that the solution is relatively straight forward: When you code in Python, how do you use a package? You do so by importing stuff. Hence, you should test whether the package is available by trying to import something from that package (sooner or later, you will do anyway!), surrounded with a `try: ... except ImportError: ...` clause.\n\nIndeed, in your code, you do `import PyNormaliz`. So, this could be\n\n```\ntry:\n    import PyNormaliz\nexcept ImportError:\n    raise ImportError(\"some meaningful error message, telling the user at least one way to install PyNormaliz\")\n```\n\n\nFor latte_int, I am not so sure what you do, because I don't see a related import statement in your code. However, in some place of your code, you do use it; you should try and see what happens if latte_int is not available: Will there be an ImportError, or a TypeError, or a ValueError, etc.? Then, instead of `is_package_available`, you could try to use latte_int in a dry run, and if an error occurs, you take it as an answer (namely the answer that latte_int is not available).",
    "created_at": "2018-09-19T06:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348727",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:40 jipilab]:
> Okay. Nevertheless, the mentionned ticket does not provide a way to check if they are available or not. Right?

Yes, it doesn't. But I guess that's because the author of that ticket thought that the solution is relatively straight forward: When you code in Python, how do you use a package? You do so by importing stuff. Hence, you should test whether the package is available by trying to import something from that package (sooner or later, you will do anyway!), surrounded with a `try: ... except ImportError: ...` clause.

Indeed, in your code, you do `import PyNormaliz`. So, this could be

```
try:
    import PyNormaliz
except ImportError:
    raise ImportError("some meaningful error message, telling the user at least one way to install PyNormaliz")
```


For latte_int, I am not so sure what you do, because I don't see a related import statement in your code. However, in some place of your code, you do use it; you should try and see what happens if latte_int is not available: Will there be an ImportError, or a TypeError, or a ValueError, etc.? Then, instead of `is_package_available`, you could try to use latte_int in a dry run, and if an error occurs, you take it as an answer (namely the answer that latte_int is not available).



---

archive/issue_comments_348728.json:
```json
{
    "body": "Replying to [comment:40 jipilab]:\n> Replying to [comment:39 SimonKing]:\n> > Replying to [comment:38 jipilab]:\n> > > Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.\n> > > \n> > > So I would remove it from the necessary things to do for this ticket.\n> > \n> > I tend to disagree. `is_package_installed` is used here to test whether pynormaliz, normaliz, or latte_int is available. And it may be available for reasons that have nothing to do with `sage -i`.\n> \n> Okay. Nevertheless, the mentionned ticket does not provide a way to check if they are available or not. Right?\n\nI think what may be intended here is to subclass `sage.features.PythonModule`.",
    "created_at": "2018-09-19T12:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348728",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:40 jipilab]:
> Replying to [comment:39 SimonKing]:
> > Replying to [comment:38 jipilab]:
> > > Concerning the `is_package_installed` thing, it seems that it is *not* deprecated when we want to check whether a package was installed using `sage -i` which is what we want here I guess.
> > > 
> > > So I would remove it from the necessary things to do for this ticket.
> > 
> > I tend to disagree. `is_package_installed` is used here to test whether pynormaliz, normaliz, or latte_int is available. And it may be available for reasons that have nothing to do with `sage -i`.
> 
> Okay. Nevertheless, the mentionned ticket does not provide a way to check if they are available or not. Right?

I think what may be intended here is to subclass `sage.features.PythonModule`.



---

archive/issue_comments_348729.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-10T19:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348730.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-11T17:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348731.json:
```json
{
    "body": "I looked back at this now, and I'm getting a weird result from an example in Normaliz' manual:\n\n\n```\nsage: P = Polyhedron(vertices=[(1/2,1/2),(1/3,1/3),(1/4,-1/2)],backend='normaliz')\nsage: P\nA 2-dimensional polyhedron in QQ^2 defined as the convex hull of 3 vertices\nsage: P.hilbert_series()\n0\n```\n\n\nFrom calling PyNormaliz, I get:\n\n\n```\nsage: h = PyNormaliz.NmzResult(new_cone, \"HilbertSeries\")\nsage: h\n[[], [], -1L]\n```\n\n\nSo it's not the parsing from PyNormaliz to sage, but rather something weird is happening here. It has been a while since I wrote the code so I am a bit lost in trying to figure out what is going on...\n\nI'll try to do some more searching...",
    "created_at": "2019-01-28T16:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348731",
    "user": "https://github.com/jplab"
}
```

I looked back at this now, and I'm getting a weird result from an example in Normaliz' manual:


```
sage: P = Polyhedron(vertices=[(1/2,1/2),(1/3,1/3),(1/4,-1/2)],backend='normaliz')
sage: P
A 2-dimensional polyhedron in QQ^2 defined as the convex hull of 3 vertices
sage: P.hilbert_series()
0
```


From calling PyNormaliz, I get:


```
sage: h = PyNormaliz.NmzResult(new_cone, "HilbertSeries")
sage: h
[[], [], -1L]
```


So it's not the parsing from PyNormaliz to sage, but rather something weird is happening here. It has been a while since I wrote the code so I am a bit lost in trying to figure out what is going on...

I'll try to do some more searching...



---

archive/issue_comments_348732.json:
```json
{
    "body": "I guess you want the Ehrhart series. The Normaliz computation goal HilbertSeries requires the existence of a grading which is not defined with this input. \n\nThis is an intricate point, but it is inevitable: the grading is defined on the space in which the polyhedron lives, not on the cone over it.",
    "created_at": "2019-01-28T18:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348732",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

I guess you want the Ehrhart series. The Normaliz computation goal HilbertSeries requires the existence of a grading which is not defined with this input. 

This is an intricate point, but it is inevitable: the grading is defined on the space in which the polyhedron lives, not on the cone over it.



---

archive/issue_comments_348733.json:
```json
{
    "body": "Replying to [comment:47 Winfried]:\n> I guess you want the Ehrhart series. The Normaliz computation goal HilbertSeries requires the existence of a grading which is not defined with this input. \n> \n\nYes, in the end I want the Ehrhart series, but I was doing both computations to understand their difference again...\n\n> This is an intricate point, but it is inevitable: the grading is defined on the space in which the polyhedron lives, not on the cone over it.  \n\nYes, agreed. I take this example from p.23 of the Normaliz manual. I thought that HilbertSeries would work out of the box like in the example. That's why I am asking myself what I did wrong.\n\nIn the code for hilbert_series, if no grading is given, we canonically give the all 1's grading on the ambient space, and then ask for the HilbertSeries, in which case we get the empty result(!?). (Is that a good choice of canonical grading?)\n\nSo, my question would be, how do I get the result from the Normaliz manual?\n\nThis issue makes me wonder also if the results in the current examples are actually true (because maybe I am doing something wrong). For example, what would be the expected outputs of for the 3-dimensional 0-1 cube?\n\nCurrently it gives me:\n\n\n```\nsage: C = Polyhedron(vertices = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1]\n....: ,[1,1,0],[1,1,1]],backend='normaliz')\nsage: C.hilbert_series()\nt^3 + 3*t^2 + 3*t + 1\nsage: C.ehrhart_series()\n(t^2 + 4*t + 1)/(t^10 - t^9 - t^8 + 2*t^5 - t^2 - t + 1)\nsage: C.ehrhart_series().denominator().factor()\n(t + 1)^2 * (t - 1)^4 * (t^2 + 1) * (t^2 + t + 1)\nsage: C.ehrhart_quasipolynomial()\nt^3 + 3*t^2 + 3*t + 1\n```\n\n\nHilbert series and ehrhart polynomials look fine, but the denominator of the Ehrhart series is not what I would expect. Is that related to the discussion on p.24 of Normaliz' manual?\n\nI would have expected (1-t)^4, so that the degree would be -2 so that when we dilate by a factor two, we see the first interior integer point. Right?",
    "created_at": "2019-01-29T08:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348733",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:47 Winfried]:
> I guess you want the Ehrhart series. The Normaliz computation goal HilbertSeries requires the existence of a grading which is not defined with this input. 
> 

Yes, in the end I want the Ehrhart series, but I was doing both computations to understand their difference again...

> This is an intricate point, but it is inevitable: the grading is defined on the space in which the polyhedron lives, not on the cone over it.  

Yes, agreed. I take this example from p.23 of the Normaliz manual. I thought that HilbertSeries would work out of the box like in the example. That's why I am asking myself what I did wrong.

In the code for hilbert_series, if no grading is given, we canonically give the all 1's grading on the ambient space, and then ask for the HilbertSeries, in which case we get the empty result(!?). (Is that a good choice of canonical grading?)

So, my question would be, how do I get the result from the Normaliz manual?

This issue makes me wonder also if the results in the current examples are actually true (because maybe I am doing something wrong). For example, what would be the expected outputs of for the 3-dimensional 0-1 cube?

Currently it gives me:


```
sage: C = Polyhedron(vertices = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1]
....: ,[1,1,0],[1,1,1]],backend='normaliz')
sage: C.hilbert_series()
t^3 + 3*t^2 + 3*t + 1
sage: C.ehrhart_series()
(t^2 + 4*t + 1)/(t^10 - t^9 - t^8 + 2*t^5 - t^2 - t + 1)
sage: C.ehrhart_series().denominator().factor()
(t + 1)^2 * (t - 1)^4 * (t^2 + 1) * (t^2 + t + 1)
sage: C.ehrhart_quasipolynomial()
t^3 + 3*t^2 + 3*t + 1
```


Hilbert series and ehrhart polynomials look fine, but the denominator of the Ehrhart series is not what I would expect. Is that related to the discussion on p.24 of Normaliz' manual?

I would have expected (1-t)^4, so that the degree would be -2 so that when we dilate by a factor two, we see the first interior integer point. Right?



---

archive/issue_comments_348734.json:
```json
{
    "body": "HilbertSeries works out of the box, provided you use the right input type:\n\n**polytope** defines a cone and a grading, and the Hilbert series of the cone under this grading is the Ehrhart series of the polytope that arises as the intersection of the cone and the hyperplane of degree 1 elements. **polytope** is a homogeneous input type.\n\nThe inhomogeneous type **vertices**  only defines a polytope P, or in connection with cone a potentially umbounded polyhedron. We can have an grding on the space in which the polytope lives, and then HilbertSeries makes sense.  This Hilbert series is the generating function of the lattice point enumerator of the points **in** P. You can ask Normaliz to compute the Ehrhart series of P if P is bounded. It constructs a cone with a grading behind the scenes and computes the Hilbert series of that cone.\n\nSo far, so good.\n\nIn your cube example: the vertices are in principle rational vectors. What are your denominators? Does Sage choose them automatically? If so what are they? \n\nMoreover, it seems to me tat Sage implicitly defines a grading on the space of the polytpe, taking the sum of the coordinates. This explains why you get a Hilbert series and that it is exactly the result shown: 1 point of degree 0, 3 points of degree 1, 3 of degree 2 and 1 of degree 3.\n\nThe denominator of the Ehrhart series is for a 3-dimensional polytope that has vertices of degree 4,3,2 qnd 1.\n\nBefore I can say more, I must know what happens on the way from Sage input to Normaliz input.",
    "created_at": "2019-01-29T11:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348734",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

HilbertSeries works out of the box, provided you use the right input type:

**polytope** defines a cone and a grading, and the Hilbert series of the cone under this grading is the Ehrhart series of the polytope that arises as the intersection of the cone and the hyperplane of degree 1 elements. **polytope** is a homogeneous input type.

The inhomogeneous type **vertices**  only defines a polytope P, or in connection with cone a potentially umbounded polyhedron. We can have an grding on the space in which the polytope lives, and then HilbertSeries makes sense.  This Hilbert series is the generating function of the lattice point enumerator of the points **in** P. You can ask Normaliz to compute the Ehrhart series of P if P is bounded. It constructs a cone with a grading behind the scenes and computes the Hilbert series of that cone.

So far, so good.

In your cube example: the vertices are in principle rational vectors. What are your denominators? Does Sage choose them automatically? If so what are they? 

Moreover, it seems to me tat Sage implicitly defines a grading on the space of the polytpe, taking the sum of the coordinates. This explains why you get a Hilbert series and that it is exactly the result shown: 1 point of degree 0, 3 points of degree 1, 3 of degree 2 and 1 of degree 3.

The denominator of the Ehrhart series is for a 3-dimensional polytope that has vertices of degree 4,3,2 qnd 1.

Before I can say more, I must know what happens on the way from Sage input to Normaliz input.



---

archive/issue_comments_348735.json:
```json
{
    "body": "PS. My question for the denominators must be understood form the viewpoint of Normaliz input. For the 3-cube we need vertices with **four** coordinates in Normaliz where the last coordinate represents a denominator for the first three. (This was introduced before Normaliz allowed fractions in input; it would be superfluous now.)\n\nIf you send the matrix with the 8 vertices as it is to Normaliz as input type **vertices**, then the result will be a BadInputexception, because we have the denominator 0 for some vertices. In other words: Something must have happened from the Sage vertices before they go into Normaliz.\n\nI think you want the denominator 1 attached to each vertex. If we do that, the Normaliz input becomes\n\n\n\n```\namb_space auto\nvertices\n[[0,0,0,1],[0,0,1,1],[0,1,0,1],[0,1,1,1],[1,0,0,1],[1,0,1,1],[1,1,0,1],[1,1,1,1]]\nEhrhartSeries\n```\n\n\nand the output contains\n\n\n\n```\nEhrhart series:\n1 4 1 \ndenominator with 4 factors:\n1: 4\n```\n\n \nas one expects.\n\nAgain my question: what happens on the way from Sage input to Normaliz input?",
    "created_at": "2019-01-29T14:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348735",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

PS. My question for the denominators must be understood form the viewpoint of Normaliz input. For the 3-cube we need vertices with **four** coordinates in Normaliz where the last coordinate represents a denominator for the first three. (This was introduced before Normaliz allowed fractions in input; it would be superfluous now.)

If you send the matrix with the 8 vertices as it is to Normaliz as input type **vertices**, then the result will be a BadInputexception, because we have the denominator 0 for some vertices. In other words: Something must have happened from the Sage vertices before they go into Normaliz.

I think you want the denominator 1 attached to each vertex. If we do that, the Normaliz input becomes



```
amb_space auto
vertices
[[0,0,0,1],[0,0,1,1],[0,1,0,1],[0,1,1,1],[1,0,0,1],[1,0,1,1],[1,1,0,1],[1,1,1,1]]
EhrhartSeries
```


and the output contains



```
Ehrhart series:
1 4 1 
denominator with 4 factors:
1: 4
```

 
as one expects.

Again my question: what happens on the way from Sage input to Normaliz input?



---

archive/issue_comments_348736.json:
```json
{
    "body": "Dear Winfried,\n\nThanks for your quick reply. This explanation is really good, and probably I should add it to the top to shortly describe how the translation from sage to normaliz is done.\n\nHere is the verbose of the example for the cube, we can see the input given by sage to normaliz.\nThe current way is to always use inhomogeneous (vertices, cones, and subspaces). Eventually, inhom. equations and inequalities are added.\n\n\n```\nsage: C = Polyhedron(vertices = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]],backend='normaliz',\n....: verbose=True)\n# Calling PyNormaliz.NmzCone(**{'subspace': [], 'vertices': [[0, 0, 0, 1], [0, 0, 1, 1], [0, 1, 0, 1], [0, 1, 1, 1], [1, 0, 0, 1], [1, 0, 1, 1], [1, 1, 0, 1], [1, 1, 1, 1]], 'cone': []})\n# ----8<---- Equivalent Normaliz input file ----8<----\namb_space 3\nsubspace 0\nvertices 8\n 0 0 0 1\n 0 0 1 1\n 0 1 0 1\n 0 1 1 1\n 1 0 0 1\n 1 0 1 1\n 1 1 0 1\n 1 1 1 1\ncone 0\n# ----8<-------------------8<-------------------8<----\n```\n\n\nOnce I have this, I compute the hilbert series, **without** giving any grading. In this case, Sage assign the grading [1,...,1] and passes it to normaliz (as you observed) and get:\n\n\n```\nsage: C.hilbert_series()\nt^3 + 3*t^2 + 3*t + 1\n```\n\n\nNow, for the Ehrhart series, I get:\n\n\n```\nsage: C.ehrhart_series()\n(t^2 + 4*t + 1)/(t^10 - t^9 - t^8 + 2*t^5 - t^2 - t + 1)\n```\n\n\nAs you said:\n\n>  It constructs a cone with a grading behind the scenes and computes the Hilbert series of that cone. \n\nWhat is the grading in this case?\n\nSo there seems to be a difference between the above input and the one you mentioned:\n\n\n```\namb_space auto\nvertices\n[[0,0,0,1],[0,0,1,1],[0,1,0,1],[0,1,1,1],[1,0,0,1],[1,0,1,1],[1,1,0,1],[1,1,1,1]]\nEhrhartSeries\n```\n\n\nbecause they give different output for the Ehrhart series?",
    "created_at": "2019-01-30T10:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348736",
    "user": "https://github.com/jplab"
}
```

Dear Winfried,

Thanks for your quick reply. This explanation is really good, and probably I should add it to the top to shortly describe how the translation from sage to normaliz is done.

Here is the verbose of the example for the cube, we can see the input given by sage to normaliz.
The current way is to always use inhomogeneous (vertices, cones, and subspaces). Eventually, inhom. equations and inequalities are added.


```
sage: C = Polyhedron(vertices = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]],backend='normaliz',
....: verbose=True)
# Calling PyNormaliz.NmzCone(**{'subspace': [], 'vertices': [[0, 0, 0, 1], [0, 0, 1, 1], [0, 1, 0, 1], [0, 1, 1, 1], [1, 0, 0, 1], [1, 0, 1, 1], [1, 1, 0, 1], [1, 1, 1, 1]], 'cone': []})
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 3
subspace 0
vertices 8
 0 0 0 1
 0 0 1 1
 0 1 0 1
 0 1 1 1
 1 0 0 1
 1 0 1 1
 1 1 0 1
 1 1 1 1
cone 0
# ----8<-------------------8<-------------------8<----
```


Once I have this, I compute the hilbert series, **without** giving any grading. In this case, Sage assign the grading [1,...,1] and passes it to normaliz (as you observed) and get:


```
sage: C.hilbert_series()
t^3 + 3*t^2 + 3*t + 1
```


Now, for the Ehrhart series, I get:


```
sage: C.ehrhart_series()
(t^2 + 4*t + 1)/(t^10 - t^9 - t^8 + 2*t^5 - t^2 - t + 1)
```


As you said:

>  It constructs a cone with a grading behind the scenes and computes the Hilbert series of that cone. 

What is the grading in this case?

So there seems to be a difference between the above input and the one you mentioned:


```
amb_space auto
vertices
[[0,0,0,1],[0,0,1,1],[0,1,0,1],[0,1,1,1],[1,0,0,1],[1,0,1,1],[1,1,0,1],[1,1,1,1]]
EhrhartSeries
```


because they give different output for the Ehrhart series?



---

archive/issue_comments_348737.json:
```json
{
    "body": "The Normaliz input is the desired one. If I run it with the computation goal EhhhartSeries I get the right answer, and if I run it with the computation goal HilbertSeries, then the answer is that it cannot be computed. Everything o.k.\n\nBut it is also clear that this workflow is not exactly that of Sage/PyNormaliz: the latter constructs a cone and then calls functions that trigger computations and return results. For a better analysis the next step is to put the same data into PyNormaliz and to see what happens.",
    "created_at": "2019-01-30T11:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348737",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

The Normaliz input is the desired one. If I run it with the computation goal EhhhartSeries I get the right answer, and if I run it with the computation goal HilbertSeries, then the answer is that it cannot be computed. Everything o.k.

But it is also clear that this workflow is not exactly that of Sage/PyNormaliz: the latter constructs a cone and then calls functions that trigger computations and return results. For a better analysis the next step is to put the same data into PyNormaliz and to see what happens.



---

archive/issue_comments_348738.json:
```json
{
    "body": "Replying to [comment:52 Winfried]:\n> The Normaliz input is the desired one. If I run it with the computation goal EhhhartSeries I get the right answer, and if I run it with the computation goal HilbertSeries, then the answer is that it cannot be computed. Everything o.k.\n\nOk. Good to know!\n\n> \n> But it is also clear that this workflow is not exactly that of Sage/PyNormaliz: the latter constructs a cone and then calls functions that trigger computations and return results. For a better analysis the next step is to put the same data into PyNormaliz and to see what happens.\n\nOk, I will look into that.",
    "created_at": "2019-01-30T12:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348738",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:52 Winfried]:
> The Normaliz input is the desired one. If I run it with the computation goal EhhhartSeries I get the right answer, and if I run it with the computation goal HilbertSeries, then the answer is that it cannot be computed. Everything o.k.

Ok. Good to know!

> 
> But it is also clear that this workflow is not exactly that of Sage/PyNormaliz: the latter constructs a cone and then calls functions that trigger computations and return results. For a better analysis the next step is to put the same data into PyNormaliz and to see what happens.

Ok, I will look into that.



---

archive/issue_comments_348739.json:
```json
{
    "body": "Ok, I think that I have figured out something, that I did not expect.\n\n\n```\nsage: C = Polyhedron(vertices = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]\n....: ],backend='normaliz',verbose=True)\n# Calling PyNormaliz.NmzCone(**{'subspace': [], 'vertices': [[0, 0, 0, 1], [0, 0, 1, 1], [0, 1, 0, 1], [0, 1, 1, 1], [1, 0, 0, 1], [1, 0, 1, 1], [1, 1, 0, 1], [1, 1, 1, 1]], 'cone': []})\n# ----8<---- Equivalent Normaliz input file ----8<----\namb_space 3\nsubspace 0\nvertices 8\n 0 0 0 1\n 0 0 1 1\n 0 1 0 1\n 0 1 1 1\n 1 0 0 1\n 1 0 1 1\n 1 1 0 1\n 1 1 1 1\ncone 0\n# ----8<-------------------8<-------------------8<----\n```\n\n\nSo far I simply created the 0-1-cube using normaliz. Then, I get the normaliz cone and the enclosed data:\n\n\n```\nsage: cone = C._normaliz_cone;cone\n<capsule object \"Cone\" at 0x7fcc880cf210>\nsage: data = C._get_nmzcone_data()\n```\n\n\nFrom there, if I compute the Hilbert Series directly, it will complain, because it does not have a grading:\n\n\n```\nsage: PyNormaliz.NmzResult(cone,\"HilbertSeries\")\n---------------------------------------------------------------------------\nerror                                     Traceback (most recent call last)\n<ipython-input-26-93c9989a5377> in <module>()\n----> 1 PyNormaliz.NmzResult(cone,\"HilbertSeries\")\n\nerror: Could not compute: No grading specified and cannot find one. Cannot compute some requested properties!\n```\n\n\nSo far so good. Then, I ask for the Ehrhart series and then, it unlocks the Hilbert series:\n\n\n```\nsage: PyNormaliz.NmzResult(cone,\"EhrhartSeries\")\n[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]\nsage: PyNormaliz.NmzResult(cone,\"HilbertSeries\")\n[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]\n```\n\n\nFor now, there is no way to access the difference in the normaliz cone. It is now equipped with a grading in the background, but it seems that we can not extract it:\n\n\n```\nsage: new_C = C.parent().element_class._from_normaliz_cone(parent=C.parent(),normaliz_cone=cone)\nsage: PyNormaliz.NmzResult(new_C._normaliz_cone,\"HilbertSeries\")\n[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]\nsage: PyNormaliz.NmzResult(new_C._normaliz_cone,\"Grading\")\n---------------------------------------------------------------------------\nerror                                     Traceback (most recent call last)\n<ipython-input-43-809cb91899e5> in <module>()\n----> 1 PyNormaliz.NmzResult(new_C._normaliz_cone,\"Grading\")\n\nerror: Could not compute: Grading !\n```\n\n\nBut, when creating a whole new cone from the data and adding by hand the grading (which is what is done in `hilbert_series` in sage, we get the enumeration of the lattice points with respect to this grading:\n\n\n```\nsage: C.hilbert_series()\nt^3 + 3*t^2 + 3*t + 1\n```\n\n\nThis can be reproduced manually as:\n\n\n```\nsage: data['grading'] = [1] * C.ambient_dim()\nsage: new_cone = C._make_normaliz_cone(data)\nsage: h = PyNormaliz.NmzResult(new_cone, \"HilbertSeries\");h\n[[1L, 3L, 3L, 1L], [], 0L]\n```\n\n\nSo, right now, we get two potential output for Hilbert series.\n\nFurther, if we actually change the normaliz cone while doing the computation of the Hilbert series (instead of doing it on a distinct cone created on the side), it then breaks the ehrhart series:\n\n\n```\nsage: C._normaliz_cone = new_cone\nsage: C.ehrhart_series()\n---------------------------------------------------------------------------\nerror                                     Traceback (most recent call last)\n<ipython-input-85-0117d93a819f> in <module>()\n----> 1 C.ehrhart_series()\n\n/home/jplabbe/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in ehrhart_series(self, variable)\n    636 \n    637         cone = self._normaliz_cone\n--> 638         e = PyNormaliz.NmzResult(cone, \"EhrhartSeries\")\n    639 \n    640         from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing\n\nerror: Some error in the normaliz input data detected: Grading not allowed with Ehrhart series in the inhomogeneous case\n```\n\n\n\nOi Oi Oi...",
    "created_at": "2019-01-30T14:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348739",
    "user": "https://github.com/jplab"
}
```

Ok, I think that I have figured out something, that I did not expect.


```
sage: C = Polyhedron(vertices = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]
....: ],backend='normaliz',verbose=True)
# Calling PyNormaliz.NmzCone(**{'subspace': [], 'vertices': [[0, 0, 0, 1], [0, 0, 1, 1], [0, 1, 0, 1], [0, 1, 1, 1], [1, 0, 0, 1], [1, 0, 1, 1], [1, 1, 0, 1], [1, 1, 1, 1]], 'cone': []})
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 3
subspace 0
vertices 8
 0 0 0 1
 0 0 1 1
 0 1 0 1
 0 1 1 1
 1 0 0 1
 1 0 1 1
 1 1 0 1
 1 1 1 1
cone 0
# ----8<-------------------8<-------------------8<----
```


So far I simply created the 0-1-cube using normaliz. Then, I get the normaliz cone and the enclosed data:


```
sage: cone = C._normaliz_cone;cone
<capsule object "Cone" at 0x7fcc880cf210>
sage: data = C._get_nmzcone_data()
```


From there, if I compute the Hilbert Series directly, it will complain, because it does not have a grading:


```
sage: PyNormaliz.NmzResult(cone,"HilbertSeries")
---------------------------------------------------------------------------
error                                     Traceback (most recent call last)
<ipython-input-26-93c9989a5377> in <module>()
----> 1 PyNormaliz.NmzResult(cone,"HilbertSeries")

error: Could not compute: No grading specified and cannot find one. Cannot compute some requested properties!
```


So far so good. Then, I ask for the Ehrhart series and then, it unlocks the Hilbert series:


```
sage: PyNormaliz.NmzResult(cone,"EhrhartSeries")
[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]
sage: PyNormaliz.NmzResult(cone,"HilbertSeries")
[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]
```


For now, there is no way to access the difference in the normaliz cone. It is now equipped with a grading in the background, but it seems that we can not extract it:


```
sage: new_C = C.parent().element_class._from_normaliz_cone(parent=C.parent(),normaliz_cone=cone)
sage: PyNormaliz.NmzResult(new_C._normaliz_cone,"HilbertSeries")
[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]
sage: PyNormaliz.NmzResult(new_C._normaliz_cone,"Grading")
---------------------------------------------------------------------------
error                                     Traceback (most recent call last)
<ipython-input-43-809cb91899e5> in <module>()
----> 1 PyNormaliz.NmzResult(new_C._normaliz_cone,"Grading")

error: Could not compute: Grading !
```


But, when creating a whole new cone from the data and adding by hand the grading (which is what is done in `hilbert_series` in sage, we get the enumeration of the lattice points with respect to this grading:


```
sage: C.hilbert_series()
t^3 + 3*t^2 + 3*t + 1
```


This can be reproduced manually as:


```
sage: data['grading'] = [1] * C.ambient_dim()
sage: new_cone = C._make_normaliz_cone(data)
sage: h = PyNormaliz.NmzResult(new_cone, "HilbertSeries");h
[[1L, 3L, 3L, 1L], [], 0L]
```


So, right now, we get two potential output for Hilbert series.

Further, if we actually change the normaliz cone while doing the computation of the Hilbert series (instead of doing it on a distinct cone created on the side), it then breaks the ehrhart series:


```
sage: C._normaliz_cone = new_cone
sage: C.ehrhart_series()
---------------------------------------------------------------------------
error                                     Traceback (most recent call last)
<ipython-input-85-0117d93a819f> in <module>()
----> 1 C.ehrhart_series()

/home/jplabbe/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in ehrhart_series(self, variable)
    636 
    637         cone = self._normaliz_cone
--> 638         e = PyNormaliz.NmzResult(cone, "EhrhartSeries")
    639 
    640         from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing

error: Some error in the normaliz input data detected: Grading not allowed with Ehrhart series in the inhomogeneous case
```



Oi Oi Oi...



---

archive/issue_comments_348740.json:
```json
{
    "body": "Everything above is as it should be, with 2 exceptions:\n\n1) The computation of the Ehrhart series should not make the Hilbert series computed. This requires a correction in libnormaliz.\n\nThere is no grading in the background. The Ehrhart series was computed on an auxiliary cone.\n\n2) Sage should not add a default grading if one asks for the Hilbert series. This is not in my hands.\n\nFurther remark: if one changes the grading later on (or defines one), all grading dependent results are erased.",
    "created_at": "2019-01-30T15:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348740",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

Everything above is as it should be, with 2 exceptions:

1) The computation of the Ehrhart series should not make the Hilbert series computed. This requires a correction in libnormaliz.

There is no grading in the background. The Ehrhart series was computed on an auxiliary cone.

2) Sage should not add a default grading if one asks for the Hilbert series. This is not in my hands.

Further remark: if one changes the grading later on (or defines one), all grading dependent results are erased.



---

archive/issue_comments_348741.json:
```json
{
    "body": "PS. The last observation is the intended behavior of Normaliz: HilbertSeries and EhrhartSeries are not allowed on the same input. One intended obstruction to this is that we do not even allow a grading if EhrhartSeries is to be computed.",
    "created_at": "2019-01-30T16:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348741",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

PS. The last observation is the intended behavior of Normaliz: HilbertSeries and EhrhartSeries are not allowed on the same input. One intended obstruction to this is that we do not even allow a grading if EhrhartSeries is to be computed.



---

archive/issue_comments_348742.json:
```json
{
    "body": "The next Normaliz release will store the Hilbert series and the Ehrhart series separately and provide a specific access function for the Ehrhart series. Then the confusion that we see in the preceding remarks will not arise anymore.",
    "created_at": "2019-02-01T08:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348742",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

The next Normaliz release will store the Hilbert series and the Ehrhart series separately and provide a specific access function for the Ehrhart series. Then the confusion that we see in the preceding remarks will not arise anymore.



---

archive/issue_comments_348743.json:
```json
{
    "body": "Ok!!\n\nSo I went back to PyNormaliz and had a look at the tutorial mentioned in Appendix E of the normaliz manual:\n\nhttps://mybinder.org/v2/gh/Normaliz/NormalizJupyter/master\n\nIn there, the PyNormaliz output of .hilbert_series is explained. **Importantly**, it seems that the output is different than the one of normaliz(!). This was the source of one of the above problems.\n\n\n```\n[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]\n```\n\n\nAs to be interpreted as `t^2+4t+1` divided by `(1-t)(1-t)(1-t)(1-t)` and a `0` shift.\n\nSo, it's all good. But it indicates that the code should be more explicit on those output formats... I'll put this on my list of TODO to add on some comments on the pynormaliz side...",
    "created_at": "2019-02-04T13:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348743",
    "user": "https://github.com/jplab"
}
```

Ok!!

So I went back to PyNormaliz and had a look at the tutorial mentioned in Appendix E of the normaliz manual:

https://mybinder.org/v2/gh/Normaliz/NormalizJupyter/master

In there, the PyNormaliz output of .hilbert_series is explained. **Importantly**, it seems that the output is different than the one of normaliz(!). This was the source of one of the above problems.


```
[[1L, 4L, 1L], [1L, 1L, 1L, 1L], 0L]
```


As to be interpreted as `t^2+4t+1` divided by `(1-t)(1-t)(1-t)(1-t)` and a `0` shift.

So, it's all good. But it indicates that the code should be more explicit on those output formats... I'll put this on my list of TODO to add on some comments on the pynormaliz side...



---

archive/issue_comments_348744.json:
```json
{
    "body": "In the Normaliz pitput file we use a multiset notation. i think this is difficult to represent in Python. Therefore it is translated into a vector format where each element of the multiset is repeated as often as it occurs in the multiset.",
    "created_at": "2019-02-04T16:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348744",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

In the Normaliz pitput file we use a multiset notation. i think this is difficult to represent in Python. Therefore it is translated into a vector format where each element of the multiset is repeated as often as it occurs in the multiset.



---

archive/issue_comments_348745.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-04T17:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348746.json:
```json
{
    "body": "Replying to [comment:59 Winfried]:\n> In the Normaliz pitput file we use a multiset notation. i think this is difficult to represent in Python. Therefore it is translated into a vector format where each element of the multiset is repeated as often as it occurs in the multiset.\n\nYes, makes sense now. Somehow got it wrong from the beginning. I just commited an update that should cover the mistake. I added several examples coming from normaliz manual to be able to compare.\n\nI still have to smoothen the usage for the user. But now, at least things look like they work and make sense...",
    "created_at": "2019-02-04T17:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348746",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:59 Winfried]:
> In the Normaliz pitput file we use a multiset notation. i think this is difficult to represent in Python. Therefore it is translated into a vector format where each element of the multiset is repeated as often as it occurs in the multiset.

Yes, makes sense now. Somehow got it wrong from the beginning. I just commited an update that should cover the mistake. I added several examples coming from normaliz manual to be able to compare.

I still have to smoothen the usage for the user. But now, at least things look like they work and make sense...



---

archive/issue_comments_348747.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-05T10:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348748.json:
```json
{
    "body": "Here is a bug, which I think is coming from the PyNormaliz side of things:\n\n\n```\nsage: v = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]]\nsage: cube = Polyhedron(vertices=v,backend='normaliz')\nsage: cube._volume_normaliz()\nsage: cube._volume_normaliz('induced_lattice')\n6\nsage: cube._volume_normaliz()\n1.0\n```\n\n\nEquivalently:\n\n\n```\nsage: v = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]]\nsage: cube = Polyhedron(vertices=v,backend='normaliz',verbose=True)\n# Calling PyNormaliz.NmzCone(**{'subspace': [], 'vertices': [[0, 0, 0, 1], [0, 0, 1, 1], [0, 1, 0, 1], [0, 1, 1, 1], [1, 0, 0, 1], [1, 0, 1, 1], [1, 1, 0, 1], [1, 1, 1, 1]], 'cone': []})\n# ----8<---- Equivalent Normaliz input file ----8<----\namb_space 3\nsubspace 0\nvertices 8\n 0 0 0 1\n 0 0 1 1\n 0 1 0 1\n 0 1 1 1\n 1 0 0 1\n 1 0 1 1\n 1 1 0 1\n 1 1 1 1\ncone 0\n# ----8<-------------------8<-------------------8<----\nsage: cone = cube._normaliz_cone\nsage: import PyNormaliz\nsage: PyNormaliz.NmzResult(cone,'EuclideanVolume')\nsage: PyNormaliz.NmzResult(cone,'EuclideanVolume')\n1.0\n```\n\n\nThis is weird. The volume somehow seems to get lost on the way. When one asks again, the output appears.",
    "created_at": "2019-02-05T10:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348748",
    "user": "https://github.com/jplab"
}
```

Here is a bug, which I think is coming from the PyNormaliz side of things:


```
sage: v = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]]
sage: cube = Polyhedron(vertices=v,backend='normaliz')
sage: cube._volume_normaliz()
sage: cube._volume_normaliz('induced_lattice')
6
sage: cube._volume_normaliz()
1.0
```


Equivalently:


```
sage: v = [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]]
sage: cube = Polyhedron(vertices=v,backend='normaliz',verbose=True)
# Calling PyNormaliz.NmzCone(**{'subspace': [], 'vertices': [[0, 0, 0, 1], [0, 0, 1, 1], [0, 1, 0, 1], [0, 1, 1, 1], [1, 0, 0, 1], [1, 0, 1, 1], [1, 1, 0, 1], [1, 1, 1, 1]], 'cone': []})
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 3
subspace 0
vertices 8
 0 0 0 1
 0 0 1 1
 0 1 0 1
 0 1 1 1
 1 0 0 1
 1 0 1 1
 1 1 0 1
 1 1 1 1
cone 0
# ----8<-------------------8<-------------------8<----
sage: cone = cube._normaliz_cone
sage: import PyNormaliz
sage: PyNormaliz.NmzResult(cone,'EuclideanVolume')
sage: PyNormaliz.NmzResult(cone,'EuclideanVolume')
1.0
```


This is weird. The volume somehow seems to get lost on the way. When one asks again, the output appears.



---

archive/issue_comments_348749.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-05T11:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348750.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-13T14:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_062921.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-03-13T14:19:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24854#event-62921"
}
```



---

archive/issue_events_062922.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-03-13T14:19:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24854#event-62922"
}
```



---

archive/issue_comments_348751.json:
```json
{
    "body": "This\n\n```\ntry:\n    import PyNormaliz\nexcept ImportError:\n    raise ImportError(\"This backend requires PyNormaliz. To install PyNormaliz, type 'sage -i pynormaliz' in the terminal.\")\n```\n\nis not desirable. You should do that via a \"feature\". See the class `PythonModule` in `sage/features/__init__.py`. The main reason is that `sage -i` would only work for people compiling from source (which is the case of less and less people nowadays).",
    "created_at": "2019-03-13T19:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348751",
    "user": "https://github.com/videlec"
}
```

This

```
try:
    import PyNormaliz
except ImportError:
    raise ImportError("This backend requires PyNormaliz. To install PyNormaliz, type 'sage -i pynormaliz' in the terminal.")
```

is not desirable. You should do that via a "feature". See the class `PythonModule` in `sage/features/__init__.py`. The main reason is that `sage -i` would only work for people compiling from source (which is the case of less and less people nowadays).



---

archive/issue_comments_348752.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348752",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_062923.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24854#event-62923"
}
```



---

archive/issue_events_062924.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24854#event-62924"
}
```



---

archive/issue_comments_348753.json:
```json
{
    "body": "I'd suggest to merge #27716 as a dependency and use the new helper method `_nmz_result`",
    "created_at": "2019-04-23T12:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348753",
    "user": "https://github.com/mkoeppe"
}
```

I'd suggest to merge #27716 as a dependency and use the new helper method `_nmz_result`



---

archive/issue_comments_348754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-23T13:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348755.json:
```json
{
    "body": "I merge the latest develop and #27682 in the last commits. I will merge #27716 as the next step.",
    "created_at": "2019-04-23T13:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348755",
    "user": "https://github.com/jplab"
}
```

I merge the latest develop and #27682 in the last commits. I will merge #27716 as the next step.



---

archive/issue_comments_348756.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2019-04-25T17:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_348757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-25T17:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348758.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-25T17:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348758",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348759.json:
```json
{
    "body": "I have some comments:\n\nThis is a general Python convention we try to follow with the messages, moreover, the error is because the class has the wrong type (you are not expecting it to be implemented at some point, right?):\n\n```diff\n-raise NotImplementedError(\"The backend should be normaliz.\")\n+raise TypeError(\"the backend should be normaliz\")\n```\n\nA similar comment applies elsewhere too. However, the `ImportError` can be the exception to this guide as it is \"long\".\n\nThe `INPUT:` bullet points are not considered to be complete sentences, so they should not end in a period/full-stop.\n\nPEP8:\n\n```diff\n-sage: S = Polyhedron(vertices = [[0,1],[1,0]],backend='normaliz') # optional - pynormaliz\n+sage: S = Polyhedron(vertices=[[0,1],[1,0]], backend='normaliz')  # optional - pynormaliz\n```\n\nand similar such things.\n\nIn `ehrhart_series()`, i think this will look better in latex formatting:\n\n```\n-``t^k`` is number of integer lattice points inside the ``k``-th dilation of\n+`t^k` is number of integer lattice points inside the `k`-th dilation of\n```\n\nNote that `k` and `t` are not input variable names.",
    "created_at": "2019-04-25T23:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348759",
    "user": "https://github.com/tscrim"
}
```

I have some comments:

This is a general Python convention we try to follow with the messages, moreover, the error is because the class has the wrong type (you are not expecting it to be implemented at some point, right?):

```diff
-raise NotImplementedError("The backend should be normaliz.")
+raise TypeError("the backend should be normaliz")
```

A similar comment applies elsewhere too. However, the `ImportError` can be the exception to this guide as it is "long".

The `INPUT:` bullet points are not considered to be complete sentences, so they should not end in a period/full-stop.

PEP8:

```diff
-sage: S = Polyhedron(vertices = [[0,1],[1,0]],backend='normaliz') # optional - pynormaliz
+sage: S = Polyhedron(vertices=[[0,1],[1,0]], backend='normaliz')  # optional - pynormaliz
```

and similar such things.

In `ehrhart_series()`, i think this will look better in latex formatting:

```
-``t^k`` is number of integer lattice points inside the ``k``-th dilation of
+`t^k` is number of integer lattice points inside the `k`-th dilation of
```

Note that `k` and `t` are not input variable names.



---

archive/issue_comments_348760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-26T08:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-26T12:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348762.json:
```json
{
    "body": "There's an error in a doctest. \n\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 2874, in sage.geometry.polyhedron.base.Polyhedron_base._triangulate_normaliz\nFailed example:\n    K._triangulate_normaliz(engine='normaliz')\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: The polyhedron's backend should be 'normaliz'\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base._triangulate_normaliz[1]>\", line 1, in <module>\n        K._triangulate_normaliz(engine='normaliz')\n    TypeError: _triangulate_normaliz() got an unexpected keyword argument 'engine'\n**********************************************************************\n```\n",
    "created_at": "2019-04-26T14:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348762",
    "user": "https://github.com/mkoeppe"
}
```

There's an error in a doctest. 

```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 2874, in sage.geometry.polyhedron.base.Polyhedron_base._triangulate_normaliz
Failed example:
    K._triangulate_normaliz(engine='normaliz')
Expected:
    Traceback (most recent call last):
    ...
    TypeError: The polyhedron's backend should be 'normaliz'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base._triangulate_normaliz[1]>", line 1, in <module>
        K._triangulate_normaliz(engine='normaliz')
    TypeError: _triangulate_normaliz() got an unexpected keyword argument 'engine'
**********************************************************************
```




---

archive/issue_comments_348763.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-04-26T14:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348763",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348764.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T17:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348764",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348765.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-04-27T17:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348765",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348766.json:
```json
{
    "body": "I think I ended up being a little vague about the error messages. In Python, error messages start with a lowercase letter and do not end with a period/full-stop. While I do not expect you to change them all, I think it is good not to make it further from the general convention. I know this is not documented, but is sort of an agreement. So if you want to keep things the way they are, then you can go ahead and set a positive review. Although I would appreciate you changing them (or at least making a uniform convention for all of your added error messages).",
    "created_at": "2019-04-29T23:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348766",
    "user": "https://github.com/tscrim"
}
```

I think I ended up being a little vague about the error messages. In Python, error messages start with a lowercase letter and do not end with a period/full-stop. While I do not expect you to change them all, I think it is good not to make it further from the general convention. I know this is not documented, but is sort of an agreement. So if you want to keep things the way they are, then you can go ahead and set a positive review. Although I would appreciate you changing them (or at least making a uniform convention for all of your added error messages).



---

archive/issue_comments_348767.json:
```json
{
    "body": "One comment:\n\n\n```\n+# FLINT is a standard package and E-ANTIC is a standard pakcage. We\n```\n\n\nthe 2nd occ. of standard -> optional",
    "created_at": "2019-04-30T08:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348767",
    "user": "https://github.com/seblabbe"
}
```

One comment:


```
+# FLINT is a standard package and E-ANTIC is a standard pakcage. We
```


the 2nd occ. of standard -> optional



---

archive/issue_comments_348768.json:
```json
{
    "body": "Replying to [comment:86 tscrim]:\n> I think I ended up being a little vague about the error messages. In Python, error messages start with a lowercase letter and do not end with a period/full-stop. While I do not expect you to change them all, I think it is good not to make it further from the general convention. I know this is not documented, but is sort of an agreement. So if you want to keep things the way they are, then you can go ahead and set a positive review. Although I would appreciate you changing them (or at least making a uniform convention for all of your added error messages).\n\nOh, I see. No problem, I will change it.",
    "created_at": "2019-04-30T08:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348768",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:86 tscrim]:
> I think I ended up being a little vague about the error messages. In Python, error messages start with a lowercase letter and do not end with a period/full-stop. While I do not expect you to change them all, I think it is good not to make it further from the general convention. I know this is not documented, but is sort of an agreement. So if you want to keep things the way they are, then you can go ahead and set a positive review. Although I would appreciate you changing them (or at least making a uniform convention for all of your added error messages).

Oh, I see. No problem, I will change it.



---

archive/issue_comments_348769.json:
```json
{
    "body": "This is still using `is_package_installed`.",
    "created_at": "2019-04-30T10:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348769",
    "user": "https://github.com/jdemeyer"
}
```

This is still using `is_package_installed`.



---

archive/issue_comments_348770.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-04-30T10:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348770",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348771.json:
```json
{
    "body": "Instead of putting `Latte().require()` in a `try` block, you can just check `if Latte().is_present()`\n\nIt can be argued which kind of error should be given here (I would go for `RuntimeError`), but certainly not a `TypeError`:\n\n```\nraise TypeError(\"The induced rational measure can only be computed with the optional packages `latte_int`, or `pynormaliz`\")\n```\n",
    "created_at": "2019-04-30T10:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348771",
    "user": "https://github.com/jdemeyer"
}
```

Instead of putting `Latte().require()` in a `try` block, you can just check `if Latte().is_present()`

It can be argued which kind of error should be given here (I would go for `RuntimeError`), but certainly not a `TypeError`:

```
raise TypeError("The induced rational measure can only be computed with the optional packages `latte_int`, or `pynormaliz`")
```




---

archive/issue_comments_348772.json:
```json
{
    "body": "Replying to [comment:42 mkoeppe]:\n> I think what may be intended here is to subclass `sage.features.PythonModule`.\n\nNot subclassing, just use it like `PythonModule(\"package.submodule\").is_present()` or whatever.",
    "created_at": "2019-04-30T10:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348772",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:42 mkoeppe]:
> I think what may be intended here is to subclass `sage.features.PythonModule`.

Not subclassing, just use it like `PythonModule("package.submodule").is_present()` or whatever.



---

archive/issue_comments_348773.json:
```json
{
    "body": "More in detail: replace\n\n```\n        try:\n            import PyNormaliz\n        except ImportError:\n            raise ImportError(\"This backend requires PyNormaliz. To install PyNormaliz, type 'sage -i pynormaliz' in the terminal.\")\n```\n\nby\n\n```\nfrom sage.features import PythonModule\n\n        PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n        import PyNormaliz\n```\n",
    "created_at": "2019-04-30T10:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348773",
    "user": "https://github.com/jdemeyer"
}
```

More in detail: replace

```
        try:
            import PyNormaliz
        except ImportError:
            raise ImportError("This backend requires PyNormaliz. To install PyNormaliz, type 'sage -i pynormaliz' in the terminal.")
```

by

```
from sage.features import PythonModule

        PythonModule("PyNormaliz", spkg="pynormaliz").require()
        import PyNormaliz
```




---

archive/issue_comments_348774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-30T12:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348775.json:
```json
{
    "body": "I fixed the error messages, typos, and the `require()` of `PyNormaliz`.\n\nReady for review again.",
    "created_at": "2019-04-30T12:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348775",
    "user": "https://github.com/jplab"
}
```

I fixed the error messages, typos, and the `require()` of `PyNormaliz`.

Ready for review again.



---

archive/issue_comments_348776.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-04-30T12:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348776",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348777.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-04-30T12:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348777",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348778.json:
```json
{
    "body": "[comment:89]",
    "created_at": "2019-04-30T12:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348778",
    "user": "https://github.com/jdemeyer"
}
```

[comment:89]



---

archive/issue_comments_348779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-30T12:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348780.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-04-30T12:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348780",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348781.json:
```json
{
    "body": "... forgot about this latte/pynormaliz switch there. Hopefully complete now.",
    "created_at": "2019-04-30T12:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348781",
    "user": "https://github.com/jplab"
}
```

... forgot about this latte/pynormaliz switch there. Hopefully complete now.



---

archive/issue_comments_348782.json:
```json
{
    "body": "I would still recommend to change the type of exception: `TypeError` makes no sense here.",
    "created_at": "2019-04-30T12:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348782",
    "user": "https://github.com/jdemeyer"
}
```

I would still recommend to change the type of exception: `TypeError` makes no sense here.



---

archive/issue_comments_348783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-30T15:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348784.json:
```json
{
    "body": "... sorry for the omission, and thanks for the coaching on the features module.",
    "created_at": "2019-04-30T15:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348784",
    "user": "https://github.com/jplab"
}
```

... sorry for the omission, and thanks for the coaching on the features module.



---

archive/issue_comments_348785.json:
```json
{
    "body": "Thank you for changing the error message strings.\n\nYou also need to make a changes in the `combinat/rigged_configurations/kleber_tree.py`\n\n```diff\n         try:\n             poly = Polyhedron(ieqs=ieqs, backend='normaliz')\n             self._has_normaliz = True\n-        except ImportError:\n+        except FeatureNotPresentError:\n             poly = Polyhedron(ieqs=ieqs)\n             self._has_normaliz = False\n```\n\nto reflect the new error message is thrown. That should take care of all of the errors reported on the patchbot (for when `normaliz` is not installed).\n\nModulo that, I am happy with this and am willing to set a positive review. Jeroen, any other comments?",
    "created_at": "2019-05-01T00:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348785",
    "user": "https://github.com/tscrim"
}
```

Thank you for changing the error message strings.

You also need to make a changes in the `combinat/rigged_configurations/kleber_tree.py`

```diff
         try:
             poly = Polyhedron(ieqs=ieqs, backend='normaliz')
             self._has_normaliz = True
-        except ImportError:
+        except FeatureNotPresentError:
             poly = Polyhedron(ieqs=ieqs)
             self._has_normaliz = False
```

to reflect the new error message is thrown. That should take care of all of the errors reported on the patchbot (for when `normaliz` is not installed).

Modulo that, I am happy with this and am willing to set a positive review. Jeroen, any other comments?



---

archive/issue_comments_348786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-01T07:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348787.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-01T07:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348788.json:
```json
{
    "body": "You forgot to import `FeatureNotPresentError` in `kleber_tree.py`.",
    "created_at": "2019-05-01T10:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348788",
    "user": "https://github.com/tscrim"
}
```

You forgot to import `FeatureNotPresentError` in `kleber_tree.py`.



---

archive/issue_comments_348789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-01T15:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348790.json:
```json
{
    "body": "... it has been a long workshop.",
    "created_at": "2019-05-01T15:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348790",
    "user": "https://github.com/jplab"
}
```

... it has been a long workshop.



---

archive/issue_comments_348791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T06:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348792.json:
```json
{
    "body": "The last commit refactors things in the spirit of #27716.\n\nIt is now completely ready for review... No more forgotten things hopefully.",
    "created_at": "2019-05-02T07:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348792",
    "user": "https://github.com/jplab"
}
```

The last commit refactors things in the spirit of #27716.

It is now completely ready for review... No more forgotten things hopefully.



---

archive/issue_comments_348793.json:
```json
{
    "body": "You definitely seem to have done quite a bit in your workshop. However, now there are serious things failing: I am getting an infinite recursion happening that ends with\n\n```\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)\n    193         PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n    194         import PyNormaliz\n--> 195         return self._nmz_result(normaliz_cone, property)\n    196 \n    197     def _init_from_normaliz_cone(self, normaliz_cone):\n\n... last 1 frames repeated, from the frame below ...\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)\n    193         PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n    194         import PyNormaliz\n--> 195         return self._nmz_result(normaliz_cone, property)\n    196 \n    197     def _init_from_normaliz_cone(self, normaliz_cone):\n\nRuntimeError: maximum recursion depth exceeded in cmp\n```\n\nA function that only calls itself will definitely infinitely recurse. `;)`\n\nAdditionally, a couple of little details noted by the patchbot from pyflakes for `backend_normaliz.py`:\n\nIn `def _cone_generators(pynormaliz_cone):`, you have\n\n```\nreturn self._nmz_result(pynormaliz_cone, \"Generators\")\n```\n\nIn particular, `self` is not been defined in this ``@`staticmethod`.\n\nDo you require the `import PyNormaliz` here in `_nmz_result`:\n\n```\n        PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n        import PyNormaliz\n        return self._nmz_result(normaliz_cone, property)\n```\n",
    "created_at": "2019-05-02T08:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348793",
    "user": "https://github.com/tscrim"
}
```

You definitely seem to have done quite a bit in your workshop. However, now there are serious things failing: I am getting an infinite recursion happening that ends with

```
/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)
    193         PythonModule("PyNormaliz", spkg="pynormaliz").require()
    194         import PyNormaliz
--> 195         return self._nmz_result(normaliz_cone, property)
    196 
    197     def _init_from_normaliz_cone(self, normaliz_cone):

... last 1 frames repeated, from the frame below ...

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)
    193         PythonModule("PyNormaliz", spkg="pynormaliz").require()
    194         import PyNormaliz
--> 195         return self._nmz_result(normaliz_cone, property)
    196 
    197     def _init_from_normaliz_cone(self, normaliz_cone):

RuntimeError: maximum recursion depth exceeded in cmp
```

A function that only calls itself will definitely infinitely recurse. `;)`

Additionally, a couple of little details noted by the patchbot from pyflakes for `backend_normaliz.py`:

In `def _cone_generators(pynormaliz_cone):`, you have

```
return self._nmz_result(pynormaliz_cone, "Generators")
```

In particular, `self` is not been defined in this ``@`staticmethod`.

Do you require the `import PyNormaliz` here in `_nmz_result`:

```
        PythonModule("PyNormaliz", spkg="pynormaliz").require()
        import PyNormaliz
        return self._nmz_result(normaliz_cone, property)
```




---

archive/issue_comments_348794.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-02T08:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348794",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348795.json:
```json
{
    "body": "O\u00ef o\u00ef o\u00ef... Will fix this, asap.\n\nReplying to [comment:109 tscrim]:\n> You definitely seem to have done quite a bit in your workshop. However, now there are serious things failing: I am getting an infinite recursion happening that ends with\n> {{{\n> /home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)\n>     193         PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n>     194         import PyNormaliz\n> --> 195         return self._nmz_result(normaliz_cone, property)\n>     196 \n>     197     def _init_from_normaliz_cone(self, normaliz_cone):\n> \n> ... last 1 frames repeated, from the frame below ...\n> \n> /home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)\n>     193         PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n>     194         import PyNormaliz\n> --> 195         return self._nmz_result(normaliz_cone, property)\n>     196 \n>     197     def _init_from_normaliz_cone(self, normaliz_cone):\n> \n> RuntimeError: maximum recursion depth exceeded in cmp\n> }}}\n> A function that only calls itself will definitely infinitely recurse. `;)`\n> \n> Additionally, a couple of little details noted by the patchbot from pyflakes for `backend_normaliz.py`:\n> \n> In `def _cone_generators(pynormaliz_cone):`, you have\n> {{{\n> return self._nmz_result(pynormaliz_cone, \"Generators\")\n> }}}\n> In particular, `self` is not been defined in this ``@`staticmethod`.\n> \n> Do you require the `import PyNormaliz` here in `_nmz_result`:\n> {{{\n>         PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n>         import PyNormaliz\n>         return self._nmz_result(normaliz_cone, property)\n> }}}",
    "created_at": "2019-05-02T14:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348795",
    "user": "https://github.com/jplab"
}
```

O o o... Will fix this, asap.

Replying to [comment:109 tscrim]:
> You definitely seem to have done quite a bit in your workshop. However, now there are serious things failing: I am getting an infinite recursion happening that ends with
> {{{
> /home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)
>     193         PythonModule("PyNormaliz", spkg="pynormaliz").require()
>     194         import PyNormaliz
> --> 195         return self._nmz_result(normaliz_cone, property)
>     196 
>     197     def _init_from_normaliz_cone(self, normaliz_cone):
> 
> ... last 1 frames repeated, from the frame below ...
> 
> /home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_normaliz.pyc in _nmz_result(self, normaliz_cone, property)
>     193         PythonModule("PyNormaliz", spkg="pynormaliz").require()
>     194         import PyNormaliz
> --> 195         return self._nmz_result(normaliz_cone, property)
>     196 
>     197     def _init_from_normaliz_cone(self, normaliz_cone):
> 
> RuntimeError: maximum recursion depth exceeded in cmp
> }}}
> A function that only calls itself will definitely infinitely recurse. `;)`
> 
> Additionally, a couple of little details noted by the patchbot from pyflakes for `backend_normaliz.py`:
> 
> In `def _cone_generators(pynormaliz_cone):`, you have
> {{{
> return self._nmz_result(pynormaliz_cone, "Generators")
> }}}
> In particular, `self` is not been defined in this ``@`staticmethod`.
> 
> Do you require the `import PyNormaliz` here in `_nmz_result`:
> {{{
>         PythonModule("PyNormaliz", spkg="pynormaliz").require()
>         import PyNormaliz
>         return self._nmz_result(normaliz_cone, property)
> }}}



---

archive/issue_comments_348796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T16:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348797.json:
```json
{
    "body": "Replying to [comment:109 tscrim]:\n\n> A function that only calls itself will definitely infinitely recurse. `;)`\n>\n\nI love those...\n \n> Additionally, a couple of little details noted by the patchbot from pyflakes for `backend_normaliz.py`:\n> \n> In `def _cone_generators(pynormaliz_cone):`, you have\n> {{{\n> return self._nmz_result(pynormaliz_cone, \"Generators\")\n> }}}\n> In particular, `self` is not been defined in this ``@`staticmethod`.\n\nIs now fixed.\n\n> Do you require the `import PyNormaliz` here in `_nmz_result`:\n> {{{\n>         PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n>         import PyNormaliz\n>         return self._nmz_result(normaliz_cone, property)\n> }}}\n\nThis was the cause of the infinite recursion. It is now fixed.",
    "created_at": "2019-05-02T16:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348797",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:109 tscrim]:

> A function that only calls itself will definitely infinitely recurse. `;)`
>

I love those...
 
> Additionally, a couple of little details noted by the patchbot from pyflakes for `backend_normaliz.py`:
> 
> In `def _cone_generators(pynormaliz_cone):`, you have
> {{{
> return self._nmz_result(pynormaliz_cone, "Generators")
> }}}
> In particular, `self` is not been defined in this ``@`staticmethod`.

Is now fixed.

> Do you require the `import PyNormaliz` here in `_nmz_result`:
> {{{
>         PythonModule("PyNormaliz", spkg="pynormaliz").require()
>         import PyNormaliz
>         return self._nmz_result(normaliz_cone, property)
> }}}

This was the cause of the infinite recursion. It is now fixed.



---

archive/issue_comments_348798.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-02T16:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348798",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348799.json:
```json
{
    "body": "Needs review again!",
    "created_at": "2019-05-09T14:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348799",
    "user": "https://github.com/mkoeppe"
}
```

Needs review again!



---

archive/issue_comments_348800.json:
```json
{
    "body": "LGTM.",
    "created_at": "2019-05-09T22:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348800",
    "user": "https://github.com/tscrim"
}
```

LGTM.



---

archive/issue_comments_348801.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-09T22:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348801",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348802.json:
```json
{
    "body": "Replying to [comment:115 tscrim]:\n> LGTM.\n\nGreat news!",
    "created_at": "2019-05-10T05:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348802",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:115 tscrim]:
> LGTM.

Great news!



---

archive/issue_comments_348803.json:
```json
{
    "body": "\n```\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 5295, in sage.geometry.polyhedron.base.Polyhedron_base.volume\nFailed example:\n    P.volume(measure='induced_rational')  # optional - latte_int\nExpected:\n    3/2\nGot:\n    1\n**********************************************************************\n1 item had failures:\n   1 of  47 in sage.geometry.polyhedron.base.Polyhedron_base.volume\n    [1137 tests, 1 failure, 48.32 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2019-05-14T07:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348803",
    "user": "https://github.com/vbraun"
}
```


```
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 5295, in sage.geometry.polyhedron.base.Polyhedron_base.volume
Failed example:
    P.volume(measure='induced_rational')  # optional - latte_int
Expected:
    3/2
Got:
    1
**********************************************************************
1 item had failures:
   1 of  47 in sage.geometry.polyhedron.base.Polyhedron_base.volume
    [1137 tests, 1 failure, 48.32 s]
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_348804.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-05-14T07:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348804",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_348805.json:
```json
{
    "body": "Replying to [comment:117 vbraun]:\n> {{{\n> **********************************************************************\n> File \"src/sage/geometry/polyhedron/base.py\", line 5295, in sage.geometry.polyhedron.base.Polyhedron_base.volume\n> Failed example:\n>     P.volume(measure='induced_rational')  # optional - latte_int\n> Expected:\n>     3/2\n> Got:\n>     1\n> **********************************************************************\n> 1 item had failures:\n>    1 of  47 in sage.geometry.polyhedron.base.Polyhedron_base.volume\n>     [1137 tests, 1 failure, 48.32 s]\n> ----------------------------------------------------------------------\n> sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed\n> ----------------------------------------------------------------------\n> }}}\n\nHm. Annoying.\n\nI can reproduce this with `--optional=4ti2,bliss,dochtml,e_antic,gfortran,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,python2,sage,topcom`\n\nand all tests pass with `pynormaliz` added. Dammit.",
    "created_at": "2019-05-14T08:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348805",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:117 vbraun]:
> {{{
> **********************************************************************
> File "src/sage/geometry/polyhedron/base.py", line 5295, in sage.geometry.polyhedron.base.Polyhedron_base.volume
> Failed example:
>     P.volume(measure='induced_rational')  # optional - latte_int
> Expected:
>     3/2
> Got:
>     1
> **********************************************************************
> 1 item had failures:
>    1 of  47 in sage.geometry.polyhedron.base.Polyhedron_base.volume
>     [1137 tests, 1 failure, 48.32 s]
> ----------------------------------------------------------------------
> sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed
> ----------------------------------------------------------------------
> }}}

Hm. Annoying.

I can reproduce this with `--optional=4ti2,bliss,dochtml,e_antic,gfortran,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,python2,sage,topcom`

and all tests pass with `pynormaliz` added. Dammit.



---

archive/issue_comments_348806.json:
```json
{
    "body": "Replying to [comment:118 jipilab]:\n> Replying to [comment:117 vbraun]:\n> > {{{\n> > **********************************************************************\n> > File \"src/sage/geometry/polyhedron/base.py\", line 5295, in sage.geometry.polyhedron.base.Polyhedron_base.volume\n> > Failed example:\n> >     P.volume(measure='induced_rational')  # optional - latte_int\n> > Expected:\n> >     3/2\n> > Got:\n> >     1\n> > **********************************************************************\n> > 1 item had failures:\n> >    1 of  47 in sage.geometry.polyhedron.base.Polyhedron_base.volume\n> >     [1137 tests, 1 failure, 48.32 s]\n> > ----------------------------------------------------------------------\n> > sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed\n> > ----------------------------------------------------------------------\n> > }}}\n> \n> Hm. Annoying.\n> \n> I can reproduce this with `--optional=4ti2,bliss,dochtml,e_antic,gfortran,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,python2,sage,topcom`\n> \n> and all tests pass with `pynormaliz` added. Dammit.\n\nGot it! It's from a previous test... That's a easy fix. I forgot to put both latte_it and pynormaliz as optional...",
    "created_at": "2019-05-14T08:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348806",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:118 jipilab]:
> Replying to [comment:117 vbraun]:
> > {{{
> > **********************************************************************
> > File "src/sage/geometry/polyhedron/base.py", line 5295, in sage.geometry.polyhedron.base.Polyhedron_base.volume
> > Failed example:
> >     P.volume(measure='induced_rational')  # optional - latte_int
> > Expected:
> >     3/2
> > Got:
> >     1
> > **********************************************************************
> > 1 item had failures:
> >    1 of  47 in sage.geometry.polyhedron.base.Polyhedron_base.volume
> >     [1137 tests, 1 failure, 48.32 s]
> > ----------------------------------------------------------------------
> > sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed
> > ----------------------------------------------------------------------
> > }}}
> 
> Hm. Annoying.
> 
> I can reproduce this with `--optional=4ti2,bliss,dochtml,e_antic,gfortran,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,python2,sage,topcom`
> 
> and all tests pass with `pynormaliz` added. Dammit.

Got it! It's from a previous test... That's a easy fix. I forgot to put both latte_it and pynormaliz as optional...



---

archive/issue_comments_348807.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-14T08:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348808.json:
```json
{
    "body": "Needs review again...",
    "created_at": "2019-05-14T08:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348808",
    "user": "https://github.com/jplab"
}
```

Needs review again...



---

archive/issue_comments_348809.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-14T08:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348809",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348810.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-15T00:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348810",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348811.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-21T12:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24854#issuecomment-348811",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062925.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-21T12:16:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24854",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24854#event-62925"
}
```
