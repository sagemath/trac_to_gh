# Issue 28765: spkg-configure.m4 for sqlite

archive/issues_028765.json:
```json
{
    "body": "CC:  @embray @dimpase @isuruf\n\nSQLite is another package that many people will have installed (firefox uses it, for example) and that has few dependencies in Sage (only readline). \n\nlibsqlite3 is used by Python during its build. Some Python packages need sufficiently new versions. We set the lower bound slightly lower than the current version available on XCode.\n\nWe detect it using `AC_RUN_IFELSE` because on macOS without homebrew, there is no pkgconfig file.\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29002\n\n",
    "closed_at": "2020-01-22T20:43:53Z",
    "created_at": "2020-01-13T15:14:49Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "spkg-configure.m4 for sqlite",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28765",
    "user": "https://github.com/orlitzky"
}
```
CC:  @embray @dimpase @isuruf

SQLite is another package that many people will have installed (firefox uses it, for example) and that has few dependencies in Sage (only readline). 

libsqlite3 is used by Python during its build. Some Python packages need sufficiently new versions. We set the lower bound slightly lower than the current version available on XCode.

We detect it using `AC_RUN_IFELSE` because on macOS without homebrew, there is no pkgconfig file.




Issue created by migration from https://trac.sagemath.org/ticket/29002





---

archive/issue_comments_405762.json:
```json
{
    "body": "I don't think we need such a new version, but 3.29.0 (from 2019-07-10) is the oldest one in Gentoo that I can test against. Should we accept versions back to 3.27 or 3.16 (or further) for Debian?\n\n---\nNew commits:",
    "created_at": "2020-01-13T15:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405762",
    "user": "https://github.com/orlitzky"
}
```

I don't think we need such a new version, but 3.29.0 (from 2019-07-10) is the oldest one in Gentoo that I can test against. Should we accept versions back to 3.27 or 3.16 (or further) for Debian?

---
New commits:



---

archive/issue_comments_405763.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-13T15:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405763",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_405764.json:
```json
{
    "body": "I'm testing this with sqlite 3.20 on Fedora 26 now. (My Debian system has 3.27).",
    "created_at": "2020-01-14T12:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405764",
    "user": "https://github.com/dimpase"
}
```

I'm testing this with sqlite 3.20 on Fedora 26 now. (My Debian system has 3.27).



---

archive/issue_comments_405765.json:
```json
{
    "body": "could you make the minimal version 3.20? Otherwise, all good. (I modified the version being 3.20 and tested with such sqlite)\n\nOn Fedora the packages are named `sqlite` and `sqlite-devel` - these ought to be listed in the corresponding docs - perhaps on another ticket.",
    "created_at": "2020-01-14T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405765",
    "user": "https://github.com/dimpase"
}
```

could you make the minimal version 3.20? Otherwise, all good. (I modified the version being 3.20 and tested with such sqlite)

On Fedora the packages are named `sqlite` and `sqlite-devel` - these ought to be listed in the corresponding docs - perhaps on another ticket.



---

archive/issue_comments_405766.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-14T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405766",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-01-14T15:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_405768.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-01-14T15:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_405769.json:
```json
{
    "body": "Done, but the commit hook set this back to needs_review.",
    "created_at": "2020-01-14T15:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405769",
    "user": "https://github.com/orlitzky"
}
```

Done, but the commit hook set this back to needs_review.



---

archive/issue_comments_405770.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-14T15:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405770",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405771.json:
```json
{
    "body": "missing author full name please",
    "created_at": "2020-01-14T20:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405771",
    "user": "https://github.com/fchapoton"
}
```

missing author full name please



---

archive/issue_comments_405772.json:
```json
{
    "body": "Sorry, I'm new at this.",
    "created_at": "2020-01-14T21:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405772",
    "user": "https://github.com/orlitzky"
}
```

Sorry, I'm new at this.



---

archive/issue_comments_405773.json:
```json
{
    "body": "This does not accept the system sqlite3 on macOS because we are installing readline -- but that is irrelevant because the system sqlite3 is linked against libedit, not readline.",
    "created_at": "2020-01-15T16:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405773",
    "user": "https://github.com/mkoeppe"
}
```

This does not accept the system sqlite3 on macOS because we are installing readline -- but that is irrelevant because the system sqlite3 is linked against libedit, not readline.



---

archive/issue_comments_405774.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-15T16:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405774",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405775.json:
```json
{
    "body": "```\negret:~/s/sage/sage-rebasing/worktree-venv (t/27824/public/27824-python3-spkg-configure *$)$ otool -L /usr/lib/libsqlite3.dylib \n/usr/lib/libsqlite3.dylib:\n\t/usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current version 308.4.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)\negret:~/s/sage/sage-rebasing/worktree-venv (t/27824/public/27824-python3-spkg-configure *$)$ otool -L /usr/bin/sqlite3 \n/usr/bin/sqlite3:\n\t/usr/lib/libncurses.5.4.dylib (compatibility version 5.4.0, current version 5.4.0)\n\t/usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)\n```",
    "created_at": "2020-01-15T17:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405775",
    "user": "https://github.com/mkoeppe"
}
```

```
egret:~/s/sage/sage-rebasing/worktree-venv (t/27824/public/27824-python3-spkg-configure *$)$ otool -L /usr/lib/libsqlite3.dylib 
/usr/lib/libsqlite3.dylib:
	/usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current version 308.4.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)
egret:~/s/sage/sage-rebasing/worktree-venv (t/27824/public/27824-python3-spkg-configure *$)$ otool -L /usr/bin/sqlite3 
/usr/bin/sqlite3:
	/usr/lib/libncurses.5.4.dylib (compatibility version 5.4.0, current version 5.4.0)
	/usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)
```



---

archive/issue_comments_405776.json:
```json
{
    "body": "Is the executable `sqlite3` used at all in Sage? That is the only thing that depends on readline on Linux.\nOn Debian, `libsqlite3.so` and `/usr/bin/sqlite3` are provided by different packages.",
    "created_at": "2020-01-15T17:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405776",
    "user": "https://github.com/mkoeppe"
}
```

Is the executable `sqlite3` used at all in Sage? That is the only thing that depends on readline on Linux.
On Debian, `libsqlite3.so` and `/usr/bin/sqlite3` are provided by different packages.



---

archive/issue_comments_405777.json:
```json
{
    "body": "how does pkg-config even know about MacOS's sqlite3?",
    "created_at": "2020-01-15T17:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405777",
    "user": "https://github.com/dimpase"
}
```

how does pkg-config even know about MacOS's sqlite3?



---

archive/issue_comments_405778.json:
```json
{
    "body": "Replying to [comment:12 mkoeppe]:\n> Is the executable `sqlite3` used at all in Sage? \n\nApart from providing the shortcut `sage -sqlite`, apparently not.\n\nShould the spkg-configure check for the availability of the binary?",
    "created_at": "2020-01-15T17:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405778",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:12 mkoeppe]:
> Is the executable `sqlite3` used at all in Sage? 

Apart from providing the shortcut `sage -sqlite`, apparently not.

Should the spkg-configure check for the availability of the binary?



---

archive/issue_comments_405779.json:
```json
{
    "body": "Replying to [comment:13 dimpase]:\n> how does pkg-config even know about MacOS's sqlite3? \n\nhomebrew's pkg-config knows it.",
    "created_at": "2020-01-15T17:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405779",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:13 dimpase]:
> how does pkg-config even know about MacOS's sqlite3? 

homebrew's pkg-config knows it.



---

archive/issue_comments_405780.json:
```json
{
    "body": "then what does prevent one from having a homebrew-installed readline?",
    "created_at": "2020-01-15T17:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405780",
    "user": "https://github.com/dimpase"
}
```

then what does prevent one from having a homebrew-installed readline?



---

archive/issue_comments_405781.json:
```json
{
    "body": "Anything regarding readline is irrelevant for macOS's sqlite.",
    "created_at": "2020-01-15T17:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405781",
    "user": "https://github.com/mkoeppe"
}
```

Anything regarding readline is irrelevant for macOS's sqlite.



---

archive/issue_comments_405782.json:
```json
{
    "body": "By the way, I don't quite get the point of SAGE_SPKG_DEPCHECK here at all. If we install our own readline, how is that relevant for the functioning of the system's sqlite3 package?",
    "created_at": "2020-01-15T17:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405782",
    "user": "https://github.com/mkoeppe"
}
```

By the way, I don't quite get the point of SAGE_SPKG_DEPCHECK here at all. If we install our own readline, how is that relevant for the functioning of the system's sqlite3 package?



---

archive/issue_comments_405783.json:
```json
{
    "body": "For now, the sage sqlite package depends on readline, so the dep check is the right thing to do.\n\nBut, if sage doesn't care whether or not sqlite was built with readline support, then why don't we build it without readline support and remove the dependency from the spkg? Afterwards we would drop the dep check here, too, and everything would work out.\n\nPersonally, I would say that's a good idea, but I know there's a dissenting opinion that sage should install an independently-usable sqlite package, and that we should insist that the version on the system is comparable to the spkg.",
    "created_at": "2020-01-15T17:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405783",
    "user": "https://github.com/orlitzky"
}
```

For now, the sage sqlite package depends on readline, so the dep check is the right thing to do.

But, if sage doesn't care whether or not sqlite was built with readline support, then why don't we build it without readline support and remove the dependency from the spkg? Afterwards we would drop the dep check here, too, and everything would work out.

Personally, I would say that's a good idea, but I know there's a dissenting opinion that sage should install an independently-usable sqlite package, and that we should insist that the version on the system is comparable to the spkg.



---

archive/issue_comments_405784.json:
```json
{
    "body": "Replying to [comment:19 mjo]:\n> For now, the sage sqlite package depends on readline, so the dep check is the right thing to do.\n\n\nTo my understanding, PKG_CHECK_MODULES is used to guard specifically against link-time confusion of libraries and their dependencies. \n\n> But, if sage doesn't care whether or not sqlite was built with readline support, then why don't we build it without readline support and remove the dependency from the spkg? Afterwards we would drop the dep check here, too, and everything would work out.\n\n\nActually, the `sqlite3` on macOS is fully functional - it just provides command line editing through `libedit`, not `libreadline`.",
    "created_at": "2020-01-15T17:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405784",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:19 mjo]:
> For now, the sage sqlite package depends on readline, so the dep check is the right thing to do.


To my understanding, PKG_CHECK_MODULES is used to guard specifically against link-time confusion of libraries and their dependencies. 

> But, if sage doesn't care whether or not sqlite was built with readline support, then why don't we build it without readline support and remove the dependency from the spkg? Afterwards we would drop the dep check here, too, and everything would work out.


Actually, the `sqlite3` on macOS is fully functional - it just provides command line editing through `libedit`, not `libreadline`.



---

archive/issue_comments_405785.json:
```json
{
    "body": "By the way, on macOS, I get \n\n```\npkg-config --modversion sqlite3\n3.8.10.2\n```\nIs that too old?",
    "created_at": "2020-01-15T17:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405785",
    "user": "https://github.com/mkoeppe"
}
```

By the way, on macOS, I get 

```
pkg-config --modversion sqlite3
3.8.10.2
```
Is that too old?



---

archive/issue_comments_405786.json:
```json
{
    "body": "I would propose the following change (updated):\n\n```diff\ndiff --git a/build/pkgs/sqlite/spkg-configure.m4 b/build/pkgs/sqlite/spkg-configure.m4\nindex 00bf6cb14a..44c37e57cb 100644\n--- a/build/pkgs/sqlite/spkg-configure.m4\n+++ b/build/pkgs/sqlite/spkg-configure.m4\n@@ -1,8 +1,7 @@\n SAGE_SPKG_CONFIGURE([sqlite], [\n-  SAGE_SPKG_DEPCHECK([readline], [\n     PKG_CHECK_MODULES([SQLITE],\n-                      [sqlite3 >= 3.20.0],\n-                      [],\n+                      [sqlite3 >= 3.8.10],\n+                      [AC_CHECK_PROG([SQLITE3], sqlite3, [],\n+                        [AC_MSG_WARN([libsqlite3 is found, so we do not install the sqlite spkg, but sqlite3 is not found, so \"sage -sqlite3\" will not work])])],\n                       [sage_spkg_install_sqlite=yes])\n-  ])\n ])\n\n```",
    "created_at": "2020-01-15T18:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405786",
    "user": "https://github.com/mkoeppe"
}
```

I would propose the following change (updated):

```diff
diff --git a/build/pkgs/sqlite/spkg-configure.m4 b/build/pkgs/sqlite/spkg-configure.m4
index 00bf6cb14a..44c37e57cb 100644
--- a/build/pkgs/sqlite/spkg-configure.m4
+++ b/build/pkgs/sqlite/spkg-configure.m4
@@ -1,8 +1,7 @@
 SAGE_SPKG_CONFIGURE([sqlite], [
-  SAGE_SPKG_DEPCHECK([readline], [
     PKG_CHECK_MODULES([SQLITE],
-                      [sqlite3 >= 3.20.0],
-                      [],
+                      [sqlite3 >= 3.8.10],
+                      [AC_CHECK_PROG([SQLITE3], sqlite3, [],
+                        [AC_MSG_WARN([libsqlite3 is found, so we do not install the sqlite spkg, but sqlite3 is not found, so "sage -sqlite3" will not work])])],
                       [sage_spkg_install_sqlite=yes])
-  ])
 ])

```



---

archive/issue_comments_405787.json:
```json
{
    "body": "I note that the previous update tickets for the sqlite spkg were only motivated by build system issues, or because \"it's time to upgrade\". So I don't think the version has to be very new to work for any of our code. For example:\n- #27303 - Upgrade sqlite3 to 3.27.1\n- #22687- update sqlite to version 3.17\n- #16098 - Update sqlite to 3.8.4.3",
    "created_at": "2020-01-15T18:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405787",
    "user": "https://github.com/mkoeppe"
}
```

I note that the previous update tickets for the sqlite spkg were only motivated by build system issues, or because "it's time to upgrade". So I don't think the version has to be very new to work for any of our code. For example:
- #27303 - Upgrade sqlite3 to 3.27.1
- #22687- update sqlite to version 3.17
- #16098 - Update sqlite to 3.8.4.3



---

archive/issue_comments_405788.json:
```json
{
    "body": "AC_CHECK_PROG is not used correctly in comment:22 - 3rd and 4rd parameters of it are values to be assigned to the variable from the 1st parameter, not actions to be performed...",
    "created_at": "2020-01-15T18:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405788",
    "user": "https://github.com/dimpase"
}
```

AC_CHECK_PROG is not used correctly in comment:22 - 3rd and 4rd parameters of it are values to be assigned to the variable from the 1st parameter, not actions to be performed...



---

archive/issue_comments_405789.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> By the way, on macOS, I get \n> \n> ```\n> pkg-config --modversion sqlite3\n> 3.8.10.2\n> ```\n> Is that too old?\n\n\nYeah, the lower bound is at 3.20 right now.\n\n\n>I would propose the following change (updated)\n\n\nOk, I agree. The dependency on readline *replaces* a dependency on editline (you have to pick one), so simply dropping the dependency from the sqlite package is not the option I thought it was. Moreover, readline/editline accomplish the same thing, so the dep check is counterproductive here.\n\nI don't think we even need to check for the sqlite3 executable. Zero people will run the system sqlite using sage -sqlite3, and even fewer than zero people read the ./configure output.",
    "created_at": "2020-01-15T18:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405789",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:21 mkoeppe]:
> By the way, on macOS, I get 
> 
> ```
> pkg-config --modversion sqlite3
> 3.8.10.2
> ```
> Is that too old?


Yeah, the lower bound is at 3.20 right now.


>I would propose the following change (updated)


Ok, I agree. The dependency on readline *replaces* a dependency on editline (you have to pick one), so simply dropping the dependency from the sqlite package is not the option I thought it was. Moreover, readline/editline accomplish the same thing, so the dep check is counterproductive here.

I don't think we even need to check for the sqlite3 executable. Zero people will run the system sqlite using sage -sqlite3, and even fewer than zero people read the ./configure output.



---

archive/issue_comments_405790.json:
```json
{
    "body": "cryptominisat package plays with SQL, in fact it can generate some SQL data, and sqlite3 is listed as its dependency.",
    "created_at": "2020-01-15T18:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405790",
    "user": "https://github.com/dimpase"
}
```

cryptominisat package plays with SQL, in fact it can generate some SQL data, and sqlite3 is listed as its dependency.



---

archive/issue_comments_405791.json:
```json
{
    "body": "Replying to [comment:26 dimpase]:\n> cryptominisat package plays with SQL, in fact it can generate some SQL data, and sqlite3 is listed as its dependency.\n> \n\n\nRight, and we still have the pkg-config check to ensure that sqlite3 is installed. Are there any distros that install it *without* the CLI? I doubt it... and that's the only reason we would need an extra check for it.",
    "created_at": "2020-01-15T18:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405791",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:26 dimpase]:
> cryptominisat package plays with SQL, in fact it can generate some SQL data, and sqlite3 is listed as its dependency.
> 


Right, and we still have the pkg-config check to ensure that sqlite3 is installed. Are there any distros that install it *without* the CLI? I doubt it... and that's the only reason we would need an extra check for it.



---

archive/issue_comments_405792.json:
```json
{
    "body": "Replying to [comment:25 mjo]:\n> Replying to [comment:21 mkoeppe]:\n> > {{{\n> > pkg-config --modversion sqlite3\n> > 3.8.10.2\n> > }}}\n> > Is that too old?\n\n> \n> Yeah, the lower bound is at 3.20 right now.\n\n\nI can see that - but my question is why.",
    "created_at": "2020-01-15T18:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405792",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:25 mjo]:
> Replying to [comment:21 mkoeppe]:
> > {{{
> > pkg-config --modversion sqlite3
> > 3.8.10.2
> > }}}
> > Is that too old?

> 
> Yeah, the lower bound is at 3.20 right now.


I can see that - but my question is why.



---

archive/issue_comments_405793.json:
```json
{
    "body": "Replying to [comment:28 mkoeppe]:\n> \n> I can see that - but my question is why.\n\n\nMainly just because the further back in time we go, the less valid my testing with v3.29 becomes. New commits incoming.",
    "created_at": "2020-01-15T18:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405793",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:28 mkoeppe]:
> 
> I can see that - but my question is why.


Mainly just because the further back in time we go, the less valid my testing with v3.29 becomes. New commits incoming.



---

archive/issue_comments_405794.json:
```json
{
    "body": "Replying to [comment:27 mjo]:\n>  Are there any distros that install it *without* the CLI? I doubt it... and that's the only reason we would need an extra check for it.\n\nYes, if one installs `libsqlite3-dev` on Debian, the CLI is not installed.",
    "created_at": "2020-01-15T18:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405794",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:27 mjo]:
>  Are there any distros that install it *without* the CLI? I doubt it... and that's the only reason we would need an extra check for it.

Yes, if one installs `libsqlite3-dev` on Debian, the CLI is not installed.



---

archive/issue_comments_405795.json:
```json
{
    "body": "Replying to [comment:29 mjo]:\n> Replying to [comment:28 mkoeppe]:\n> > \n> > I can see that - but my question is why.\n\n> \n> Mainly just because the further back in time we go, the less valid my testing with v3.29 becomes. New commits incoming.\n\nTests of what? I can test on macOS if necessary. I think we should support the default libsqlite that is shipped with the current XCode on macOS.",
    "created_at": "2020-01-15T18:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405795",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:29 mjo]:
> Replying to [comment:28 mkoeppe]:
> > 
> > I can see that - but my question is why.

> 
> Mainly just because the further back in time we go, the less valid my testing with v3.29 becomes. New commits incoming.

Tests of what? I can test on macOS if necessary. I think we should support the default libsqlite that is shipped with the current XCode on macOS.



---

archive/issue_comments_405796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-15T18:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405797.json:
```json
{
    "body": "Replying to [comment:26 dimpase]:\n> cryptominisat package plays with SQL, in fact it can generate some SQL data, and sqlite3 is listed as its dependency.\n> \n\nBut no specific version of sqlite is tested for in cryptominisat's build system, as far as I can see.",
    "created_at": "2020-01-15T18:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405797",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:26 dimpase]:
> cryptominisat package plays with SQL, in fact it can generate some SQL data, and sqlite3 is listed as its dependency.
> 

But no specific version of sqlite is tested for in cryptominisat's build system, as far as I can see.



---

archive/issue_comments_405798.json:
```json
{
    "body": "Replying to [comment:30 mkoeppe]:\n> Yes, if one installs `libsqlite3-dev` on Debian, the CLI is not installed.\n\n\nJFC. Should we fall back to the spkg if no CLI is found, then? I think Dima's point is that people will want to run the sqlite CLI in one way or another, to e.g. look at the cryptominisat data.",
    "created_at": "2020-01-15T18:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405798",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:30 mkoeppe]:
> Yes, if one installs `libsqlite3-dev` on Debian, the CLI is not installed.


JFC. Should we fall back to the spkg if no CLI is found, then? I think Dima's point is that people will want to run the sqlite CLI in one way or another, to e.g. look at the cryptominisat data.



---

archive/issue_comments_405799.json:
```json
{
    "body": "Replying to [comment:34 mjo]:\n> Should we fall back to the spkg if no CLI is found, then? I think Dima's point is that people will want to run the sqlite CLI in one way or another, to e.g. look at the cryptominisat data.\n\nFine with me.",
    "created_at": "2020-01-15T19:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405799",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:34 mjo]:
> Should we fall back to the spkg if no CLI is found, then? I think Dima's point is that people will want to run the sqlite CLI in one way or another, to e.g. look at the cryptominisat data.

Fine with me.



---

archive/issue_comments_405800.json:
```json
{
    "body": "Hmmm, can you try a full build on macOS against the system sqlite now? Since the spkg python also links against readline, I'm not 100% sure there won't be collisions between the readline symbols from python and the editline symbols from sqlite. Hopefully the linkage is isolated to the CLI and it won't matter.",
    "created_at": "2020-01-15T19:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405800",
    "user": "https://github.com/orlitzky"
}
```

Hmmm, can you try a full build on macOS against the system sqlite now? Since the spkg python also links against readline, I'm not 100% sure there won't be collisions between the readline symbols from python and the editline symbols from sqlite. Hopefully the linkage is isolated to the CLI and it won't matter.



---

archive/issue_comments_405801.json:
```json
{
    "body": "As you can see in comment 11, the library is not linked against `libedit`, only the executable is.",
    "created_at": "2020-01-15T19:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405801",
    "user": "https://github.com/mkoeppe"
}
```

As you can see in comment 11, the library is not linked against `libedit`, only the executable is.



---

archive/issue_comments_405802.json:
```json
{
    "body": "I think I'm fine with not checking for existence of sqlite3 executable at all.",
    "created_at": "2020-01-15T19:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405802",
    "user": "https://github.com/dimpase"
}
```

I think I'm fine with not checking for existence of sqlite3 executable at all.



---

archive/issue_comments_405803.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-01-15T19:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405803",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_405804.json:
```json
{
    "body": "Ok, I think it's safe too. If anyone shows up to complain later, the leg work is already done. We just have to add an additional AC_CHECK_PROG for sqlite3 and install the spkg if not found.",
    "created_at": "2020-01-16T02:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405804",
    "user": "https://github.com/orlitzky"
}
```

Ok, I think it's safe too. If anyone shows up to complain later, the leg work is already done. We just have to add an additional AC_CHECK_PROG for sqlite3 and install the spkg if not found.



---

archive/issue_comments_405805.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-17T14:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405805",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405806.json:
```json
{
    "body": "I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?",
    "created_at": "2020-01-17T14:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405806",
    "user": "https://github.com/embray"
}
```

I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?



---

archive/issue_comments_405807.json:
```json
{
    "body": "Erik, isn't your Ubuntu past EOL?",
    "created_at": "2020-01-17T14:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405807",
    "user": "https://github.com/dimpase"
}
```

Erik, isn't your Ubuntu past EOL?



---

archive/issue_comments_405808.json:
```json
{
    "body": "Replying to [comment:42 embray]:\n> I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?\n\nWhich Ubuntu is that?",
    "created_at": "2020-01-17T14:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405808",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:42 embray]:
> I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?

Which Ubuntu is that?



---

archive/issue_comments_405809.json:
```json
{
    "body": "But I think I would also be in favor of falling back to AC_CHECK_LIB, in fact. MacOS (without homebrew) has sqlite3 but no sqlite.pc.",
    "created_at": "2020-01-17T14:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405809",
    "user": "https://github.com/mkoeppe"
}
```

But I think I would also be in favor of falling back to AC_CHECK_LIB, in fact. MacOS (without homebrew) has sqlite3 but no sqlite.pc.



---

archive/issue_comments_405810.json:
```json
{
    "body": "Unfortunately AX_LIB_SQLITE3 from autoconf-archive is not good, it tries to parse header files to find out the version.",
    "created_at": "2020-01-17T15:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405810",
    "user": "https://github.com/mkoeppe"
}
```

Unfortunately AX_LIB_SQLITE3 from autoconf-archive is not good, it tries to parse header files to find out the version.



---

archive/issue_comments_405811.json:
```json
{
    "body": "What's wrong with that?  In any case, I'd be okay for a fallback to not check the version.  Having pkgconfig and a version check is definitely preferable as a first pass...",
    "created_at": "2020-01-17T16:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405811",
    "user": "https://github.com/embray"
}
```

What's wrong with that?  In any case, I'd be okay for a fallback to not check the version.  Having pkgconfig and a version check is definitely preferable as a first pass...



---

archive/issue_comments_405812.json:
```json
{
    "body": "Replying to [comment:44 mkoeppe]:\n> Replying to [comment:42 embray]:\n> > I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?\n\n> Which Ubuntu is that?\n\nI'm testing this on bionic (18.04).",
    "created_at": "2020-01-17T16:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405812",
    "user": "https://github.com/embray"
}
```

Replying to [comment:44 mkoeppe]:
> Replying to [comment:42 embray]:
> > I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?

> Which Ubuntu is that?

I'm testing this on bionic (18.04).



---

archive/issue_comments_405813.json:
```json
{
    "body": "Replying to [comment:48 embray]:\n> Replying to [comment:44 mkoeppe]:\n> > Replying to [comment:42 embray]:\n> > > I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?\n\n> > Which Ubuntu is that?\n> \n> I'm testing this on bionic (18.04).\n\n\nMy bad, it turns out I didn't have libsqlite3-dev installed (thought I did).  After that I have the .pc file.  Still would be nice to have a fallback though if possible.",
    "created_at": "2020-01-17T16:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405813",
    "user": "https://github.com/embray"
}
```

Replying to [comment:48 embray]:
> Replying to [comment:44 mkoeppe]:
> > Replying to [comment:42 embray]:
> > > I agree that the sqlite3 CLI should not be required.  But this doesn't seem to work for me; my Ubuntu doesn't install a sqlite.pc?  Couldn't we also fall back on a AC_CHECK_LIB?

> > Which Ubuntu is that?
> 
> I'm testing this on bionic (18.04).


My bad, it turns out I didn't have libsqlite3-dev installed (thought I did).  After that I have the .pc file.  Still would be nice to have a fallback though if possible.



---

archive/issue_comments_405814.json:
```json
{
    "body": "One can write an `AC_RUN_IFELSE` test that calls `sqlite3_libversion_number()`.",
    "created_at": "2020-01-17T16:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405814",
    "user": "https://github.com/dimpase"
}
```

One can write an `AC_RUN_IFELSE` test that calls `sqlite3_libversion_number()`.



---

archive/issue_comments_405815.json:
```json
{
    "body": "although it's probably an overkill.",
    "created_at": "2020-01-17T16:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405815",
    "user": "https://github.com/dimpase"
}
```

although it's probably an overkill.



---

archive/issue_comments_405816.json:
```json
{
    "body": "Replying to [comment:47 embray]:\n> What's wrong with that? \nEverything. It cannot reliably succeed to parse the correct file that would be used by the compiler.\nAnd it did fail on macOS for exactly that reason.",
    "created_at": "2020-01-17T16:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405816",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:47 embray]:
> What's wrong with that? 
Everything. It cannot reliably succeed to parse the correct file that would be used by the compiler.
And it did fail on macOS for exactly that reason.



---

archive/issue_comments_405817.json:
```json
{
    "body": "Replying to [comment:50 dimpase]:\n> One can write an `AC_RUN_IFELSE` test that calls `sqlite3_libversion_number()`.\n\nThat's the correct solution, I can work on this if you're not faster.",
    "created_at": "2020-01-17T16:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405817",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:50 dimpase]:
> One can write an `AC_RUN_IFELSE` test that calls `sqlite3_libversion_number()`.

That's the correct solution, I can work on this if you're not faster.



---

archive/issue_comments_405818.json:
```json
{
    "body": "Replying to [comment:52 mkoeppe]:\n> Replying to [comment:47 embray]:\n> > What's wrong with that? \n\n> Everything. It cannot reliably succeed to parse the correct file that would be used by the compiler.\n> And it did fail on macOS for exactly that reason.\n\n\nAh, of course.  My brain went completely past literally parsing the header file directly to parsing the output of a test program that prints the value of a macro sqlite3.h or something :)",
    "created_at": "2020-01-17T16:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405818",
    "user": "https://github.com/embray"
}
```

Replying to [comment:52 mkoeppe]:
> Replying to [comment:47 embray]:
> > What's wrong with that? 

> Everything. It cannot reliably succeed to parse the correct file that would be used by the compiler.
> And it did fail on macOS for exactly that reason.


Ah, of course.  My brain went completely past literally parsing the header file directly to parsing the output of a test program that prints the value of a macro sqlite3.h or something :)



---

archive/issue_comments_405819.json:
```json
{
    "body": "Does the MacOS version (without homebrew) also install the library and development headers? Otherwise we'd be adding a fallback for nobody.\n\nIf we wind up digging through headers and libraries anyway, the pkg-config check becomes redundant.",
    "created_at": "2020-01-17T16:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405819",
    "user": "https://github.com/orlitzky"
}
```

Does the MacOS version (without homebrew) also install the library and development headers? Otherwise we'd be adding a fallback for nobody.

If we wind up digging through headers and libraries anyway, the pkg-config check becomes redundant.



---

archive/issue_comments_405820.json:
```json
{
    "body": "Replying to [comment:53 mkoeppe]:\n> Replying to [comment:50 dimpase]:\n> > One can write an `AC_RUN_IFELSE` test that calls `sqlite3_libversion_number()`.\n\n> That's the correct solution, I can work on this if you're not faster.\n\nplease go ahead, I have to write a paper and presentations now :-)\n\nWe certainly already have examples of using `AC_RUN_IFELSE`, e.g. in\n`build/pkgs/ntl/spkg-configure.m4`",
    "created_at": "2020-01-17T16:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405820",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:53 mkoeppe]:
> Replying to [comment:50 dimpase]:
> > One can write an `AC_RUN_IFELSE` test that calls `sqlite3_libversion_number()`.

> That's the correct solution, I can work on this if you're not faster.

please go ahead, I have to write a paper and presentations now :-)

We certainly already have examples of using `AC_RUN_IFELSE`, e.g. in
`build/pkgs/ntl/spkg-configure.m4`



---

archive/issue_comments_405821.json:
```json
{
    "body": "Replying to [comment:55 mjo]:\n> Does the MacOS version (without homebrew) also install the library and development headers? \n\n\nYes. Part of XCode.",
    "created_at": "2020-01-17T16:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405821",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:55 mjo]:
> Does the MacOS version (without homebrew) also install the library and development headers? 


Yes. Part of XCode.



---

archive/issue_comments_405822.json:
```json
{
    "body": "This now works on macOS with current XCode even if no homebrew is in PATH.\n\n---\nNew commits:",
    "created_at": "2020-01-17T22:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405822",
    "user": "https://github.com/mkoeppe"
}
```

This now works on macOS with current XCode even if no homebrew is in PATH.

---
New commits:



---

archive/issue_comments_405823.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-01-17T22:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405823",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405824.json:
```json
{
    "body": "By the way, the check using pkgconfig is a bit questionable because Python, as far as I can see, does not actually use pkgconfig to find the library, and the results obtained by `PKG_CHECK_MODULES`, the variables `SQLITE_CFLAGS` and `SQLITE_LIBS`, are not passed to Python's build system.",
    "created_at": "2020-01-17T22:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405824",
    "user": "https://github.com/mkoeppe"
}
```

By the way, the check using pkgconfig is a bit questionable because Python, as far as I can see, does not actually use pkgconfig to find the library, and the results obtained by `PKG_CHECK_MODULES`, the variables `SQLITE_CFLAGS` and `SQLITE_LIBS`, are not passed to Python's build system.



---

archive/issue_comments_405825.json:
```json
{
    "body": "But that is not a problem at least on macOS with homebrew. By default it provides the pc for the system-installed library, `/usr/local/Homebrew/Library/Homebrew/os/mac/pkgconfig/10.15/sqlite3.pc`, which is 3.8.10.2. The homebrew-provided library is installed \"keg-only\" and informs at installation that \"For pkg-config to find sqlite you may need to set:`export PKG_CONFIG_PATH=\"/usr/local/opt/sqlite/lib/pkgconfig\"`. That provides 3.30.1.",
    "created_at": "2020-01-17T22:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405825",
    "user": "https://github.com/mkoeppe"
}
```

But that is not a problem at least on macOS with homebrew. By default it provides the pc for the system-installed library, `/usr/local/Homebrew/Library/Homebrew/os/mac/pkgconfig/10.15/sqlite3.pc`, which is 3.8.10.2. The homebrew-provided library is installed "keg-only" and informs at installation that "For pkg-config to find sqlite you may need to set:`export PKG_CONFIG_PATH="/usr/local/opt/sqlite/lib/pkgconfig"`. That provides 3.30.1.



---

archive/issue_comments_405826.json:
```json
{
    "body": "why are you using sqlite3_libversion() rather than sqlite3_libversion_number() ?\nthe latter returns `int` you are assembling by hand from the output of sqlite3_libversion()...",
    "created_at": "2020-01-17T23:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405826",
    "user": "https://github.com/dimpase"
}
```

why are you using sqlite3_libversion() rather than sqlite3_libversion_number() ?
the latter returns `int` you are assembling by hand from the output of sqlite3_libversion()...



---

archive/issue_comments_405827.json:
```json
{
    "body": "No, I'm converting the required version from its components.",
    "created_at": "2020-01-17T23:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405827",
    "user": "https://github.com/mkoeppe"
}
```

No, I'm converting the required version from its components.



---

archive/issue_comments_405828.json:
```json
{
    "body": "Replying to [comment:60 mkoeppe]:\n> By the way, the check using pkgconfig is a bit questionable because Python, as far as I can see, does not actually use pkgconfig to find the library, ...\n\n\nEverything we do in these spkg-configure files is a bit questionable =)\n\nBasically we're trying to fake the checks that already (or should already) take place in the upstream packages, but as simply and with as little code as possible. A \"perfect\" implementation of spkg-configure for libfoo would copy/paste every upstream check for libfoo. But that's crazy, so we try to get away with something less than perfect, but still functional. If it works in 95% of cases and is harmless in the others, that's a win.\n\n...which brings me to your custom version check. I believe that it works, but it's way too complicated for what we need to do. Keep in mind that we don't really care about the version of sqlite3. I only bothered to check it with pkg-config because it's trivial to do with pkg-config. As far as I can tell, you can cover the known cases with a combination of `AC_CHECK_HEADER([sqlite3.h],...)` and `AC_SEARCH_LIBS([(sqlite3_libversion],[sqlite3],...)`. That's still not perfect, because it doesn't check for every function that python uses, but if it works for the people CC'ed on this ticket it will probably work for everyone.\n\nThere's no reason to keep the PKG_CHECK_MODULES around at that point. If the first test works sometimes and the second test works all the time, why try both?",
    "created_at": "2020-01-18T00:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405828",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:60 mkoeppe]:
> By the way, the check using pkgconfig is a bit questionable because Python, as far as I can see, does not actually use pkgconfig to find the library, ...


Everything we do in these spkg-configure files is a bit questionable =)

Basically we're trying to fake the checks that already (or should already) take place in the upstream packages, but as simply and with as little code as possible. A "perfect" implementation of spkg-configure for libfoo would copy/paste every upstream check for libfoo. But that's crazy, so we try to get away with something less than perfect, but still functional. If it works in 95% of cases and is harmless in the others, that's a win.

...which brings me to your custom version check. I believe that it works, but it's way too complicated for what we need to do. Keep in mind that we don't really care about the version of sqlite3. I only bothered to check it with pkg-config because it's trivial to do with pkg-config. As far as I can tell, you can cover the known cases with a combination of `AC_CHECK_HEADER([sqlite3.h],...)` and `AC_SEARCH_LIBS([(sqlite3_libversion],[sqlite3],...)`. That's still not perfect, because it doesn't check for every function that python uses, but if it works for the people CC'ed on this ticket it will probably work for everyone.

There's no reason to keep the PKG_CHECK_MODULES around at that point. If the first test works sometimes and the second test works all the time, why try both?



---

archive/issue_comments_405829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-18T01:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405830.json:
```json
{
    "body": "Thanks for the discussion. I have removed the PKG_CHECK_MODULES.\n\nRegarding the version check, I am following the recommendations of upstream: https://www.sqlite.org/c3ref/libversion.html",
    "created_at": "2020-01-18T01:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405830",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the discussion. I have removed the PKG_CHECK_MODULES.

Regarding the version check, I am following the recommendations of upstream: https://www.sqlite.org/c3ref/libversion.html



---

archive/issue_comments_405831.json:
```json
{
    "body": "My point about the version check is that your program is currently doing four things:\n\n1. Ensuring that sqlite3.h is in the include path.\n2. Ensuring that the `sqlite3_libversion()` function is in the `sqlite3` library.\n3. Doing some math to see if the version of sqlite3 is newer than 3.8.7.\n4. Setting `LIBS+=\" -lsqlite3\"` if everything worked out, or setting `sage_spkg_install_sqlite=yes` if it didn't.\n\nThat's all good, but the third item is superfluous since we don't really care what version of sqlite3 you have (so long as it works). And if you remove the version check, then items 1, 2, and 4 can all be accomplished with AC_CHECK_HEADER and AC_SEARCH_LIBS in three or four lines.",
    "created_at": "2020-01-18T01:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405831",
    "user": "https://github.com/orlitzky"
}
```

My point about the version check is that your program is currently doing four things:

1. Ensuring that sqlite3.h is in the include path.
2. Ensuring that the `sqlite3_libversion()` function is in the `sqlite3` library.
3. Doing some math to see if the version of sqlite3 is newer than 3.8.7.
4. Setting `LIBS+=" -lsqlite3"` if everything worked out, or setting `sage_spkg_install_sqlite=yes` if it didn't.

That's all good, but the third item is superfluous since we don't really care what version of sqlite3 you have (so long as it works). And if you remove the version check, then items 1, 2, and 4 can all be accomplished with AC_CHECK_HEADER and AC_SEARCH_LIBS in three or four lines.



---

archive/issue_comments_405832.json:
```json
{
    "body": "Replying to [comment:67 mjo]:\n> ... we don't really care what version of sqlite3 you have (so long as it works)\n\n\nThe version of sqlite3 for a python build was an issue as recently as 2017 here:\nhttps://bugs.python.org/issue29098\n\nI don't have time to determine a more precise bound. But we do need to check *some* lower bound for the version (or test features of sqlite3).",
    "created_at": "2020-01-18T02:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405832",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:67 mjo]:
> ... we don't really care what version of sqlite3 you have (so long as it works)


The version of sqlite3 for a python build was an issue as recently as 2017 here:
https://bugs.python.org/issue29098

I don't have time to determine a more precise bound. But we do need to check *some* lower bound for the version (or test features of sqlite3).



---

archive/issue_comments_405833.json:
```json
{
    "body": "Replying to [comment:68 mkoeppe]:\n> Replying to [comment:67 mjo]:\n> > ... we don't really care what version of sqlite3 you have (so long as it works)\n  \n> \n> The version of sqlite3 for a python build was an issue as recently as 2017 here:\n> https://bugs.python.org/issue29098\n\n\nThey changed that code so that older versions of sqlite will work.\n\n> I don't have time to determine a more precise bound. But we do need to check *some* lower bound for the version (or test features of sqlite3).\n\n\nWhy? Python itself doesn't even bother.",
    "created_at": "2020-01-18T02:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405833",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:68 mkoeppe]:
> Replying to [comment:67 mjo]:
> > ... we don't really care what version of sqlite3 you have (so long as it works)
  
> 
> The version of sqlite3 for a python build was an issue as recently as 2017 here:
> https://bugs.python.org/issue29098


They changed that code so that older versions of sqlite will work.

> I don't have time to determine a more precise bound. But we do need to check *some* lower bound for the version (or test features of sqlite3).


Why? Python itself doesn't even bother.



---

archive/issue_comments_405834.json:
```json
{
    "body": "Replying to [comment:69 mjo]:\n> Replying to [comment:68 mkoeppe]:\n> > Replying to [comment:67 mjo]:\n> > > ... we don't really care what version of sqlite3 you have (so long as it works)\n  \n> > \n> > The version of sqlite3 for a python build was an issue as recently as 2017 here:\n> > https://bugs.python.org/issue29098\n\n> \n> They changed that code so that older versions of sqlite will work.\n\n\nWhich versions do?",
    "created_at": "2020-01-18T02:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405834",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:69 mjo]:
> Replying to [comment:68 mkoeppe]:
> > Replying to [comment:67 mjo]:
> > > ... we don't really care what version of sqlite3 you have (so long as it works)
  
> > 
> > The version of sqlite3 for a python build was an issue as recently as 2017 here:
> > https://bugs.python.org/issue29098

> 
> They changed that code so that older versions of sqlite will work.


Which versions do?



---

archive/issue_comments_405835.json:
```json
{
    "body": "Replying to [comment:70 mkoeppe]:\n> > \n> > They changed that code so that older versions of sqlite will work.\n\n> \n> Which versions do?\n\n\nPython doesn't do a version check, and doesn't document any version bounds, so presumably all of them.\n\nPut another way: if we find a version that makes it past *our* version-less check but that breaks python... then that's a python bug.",
    "created_at": "2020-01-18T02:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405835",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:70 mkoeppe]:
> > 
> > They changed that code so that older versions of sqlite will work.

> 
> Which versions do?


Python doesn't do a version check, and doesn't document any version bounds, so presumably all of them.

Put another way: if we find a version that makes it past *our* version-less check but that breaks python... then that's a python bug.



---

archive/issue_comments_405836.json:
```json
{
    "body": "But it is not the goal of sage-the-distribution to provoke python bugs.\n\nWe vendor a version of sqlite so that the vendored python can build.",
    "created_at": "2020-01-18T02:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405836",
    "user": "https://github.com/mkoeppe"
}
```

But it is not the goal of sage-the-distribution to provoke python bugs.

We vendor a version of sqlite so that the vendored python can build.



---

archive/issue_comments_405837.json:
```json
{
    "body": "Replying to [comment:72 mkoeppe]:\n> But it is not the goal of sage-the-distribution to provoke python bugs.\n> \n\n\n\nYou make it sound so negative =)\n\n**If** there's a version of sqlite that doesn't work with python, and **if** someone tries to build sage with it (both unlikely), then we report the bug upstream. At that point -- depending on the upstream fix -- we either do nothing or amend this spkg-configure with a lower bound.\n\nOtherwise, we're just making things complicated for no ostensible reason. Since nobody is going to test every 3.x version of sqlite, we're still ultimately guessing at the lower version bound. My guess just happens to be 3.0.0.\n\nIf it's wrong, we can change it, but 3.0.0 is more likely to be correct than any other untested bound, and simplifies this check as a bonus.",
    "created_at": "2020-01-18T03:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405837",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:72 mkoeppe]:
> But it is not the goal of sage-the-distribution to provoke python bugs.
> 



You make it sound so negative =)

**If** there's a version of sqlite that doesn't work with python, and **if** someone tries to build sage with it (both unlikely), then we report the bug upstream. At that point -- depending on the upstream fix -- we either do nothing or amend this spkg-configure with a lower bound.

Otherwise, we're just making things complicated for no ostensible reason. Since nobody is going to test every 3.x version of sqlite, we're still ultimately guessing at the lower version bound. My guess just happens to be 3.0.0.

If it's wrong, we can change it, but 3.0.0 is more likely to be correct than any other untested bound, and simplifies this check as a bonus.



---

archive/issue_comments_405838.json:
```json
{
    "body": "I think one reason for these checks is to make supporting sage(lib) a bearable job. We don't want to bog down in corner cases on museum-grade OSes, just cause they might carry a museum-grade version of sqlite3.\n\nSo I am for keeping a version check. \n\nOne other thing - for better of worse, spkg-configure.m4 in other packages undefine local m4 variables they happen to define, whereas here it does not happen.\nThey use `m4_pushdef/m4_popdef` pair of macros for these purposes.\nCan we keep to the same style here?",
    "created_at": "2020-01-18T09:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405838",
    "user": "https://github.com/dimpase"
}
```

I think one reason for these checks is to make supporting sage(lib) a bearable job. We don't want to bog down in corner cases on museum-grade OSes, just cause they might carry a museum-grade version of sqlite3.

So I am for keeping a version check. 

One other thing - for better of worse, spkg-configure.m4 in other packages undefine local m4 variables they happen to define, whereas here it does not happen.
They use `m4_pushdef/m4_popdef` pair of macros for these purposes.
Can we keep to the same style here?



---

archive/issue_comments_405839.json:
```json
{
    "body": "Replying to [comment:74 dimpase]:\n> I think one reason for these checks is to make supporting sage(lib) a bearable job. We don't want to bog down in corner cases on museum-grade OSes, just cause they might carry a museum-grade version of sqlite3.\n> \n> So I am for keeping a version check. \n> \n\n\nThat's a bit ironic considering that four people have wasted hours replacing\n\n```\nSAGE_SPKG_CONFIGURE([sqlite], [\n  PKG_CHECK_MODULES([SQLITE],\n                    [sqlite3 >= 3.8.7],\n                    [],\n                    [sage_spkg_install_sqlite=yes])\n])\n```\n\nwith\n\n```\nSAGE_SPKG_CONFIGURE([sqlite], [\n  m4_define([sqlite3_min_version_major], [3])\n  m4_define([sqlite3_min_version_minor], [8])\n  m4_define([sqlite3_min_version_micro], [7])\n  m4_define([sqlite3_min_version], [sqlite3_min_version_major.sqlite3_min_version_minor.sqlite3_min_version_micro])\n  AC_MSG_CHECKING([libsqlite3 >= sqlite3_min_version])\n                     dnl https://www.sqlite.org/c3ref/libversion.html\n                     dnl https://www.sqlite.org/c3ref/c_source_id.html\n                     SQLITE_SAVED_LIBS=\"$LIBS\"\n                     LIBS=\"$LIBS -lsqlite3\"\n                     AC_RUN_IFELSE([\n                       AC_LANG_PROGRAM([[\n                                         #include <sqlite3.h>\n                                         #include <assert.h>\n                                         #include <stdlib.h>\n                                         #include <string.h>\n                                       ]],\n                                       [[\n                                         assert( strcmp(sqlite3_libversion(),SQLITE_VERSION)==0 );\n                                         if (SQLITE_VERSION_NUMBER < ]]sqlite3_min_version_major[[*1000000 + ]]sqlite3_min_version_minor[[*1000 + ]]sqlite3_min_version_micro[[)\n                                           exit(1);\n                                         else\n                                           exit(0);\n                                       ]])\n                       ],\n                       [AC_MSG_RESULT([yes])],\n                       [AC_MSG_RESULT([no])\n                        LIBS=\"$SQLITE_SAVED_LIBS\"\n                        sage_spkg_install_sqlite=yes])\n])\n```\n\nto support one version of sqlite on one proprietary OS whose maintainers went out of their way to delete an important file from the package.\n\nsagelib doesn't even use sqlite, it's a dependency of a dependency",
    "created_at": "2020-01-18T15:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405839",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:74 dimpase]:
> I think one reason for these checks is to make supporting sage(lib) a bearable job. We don't want to bog down in corner cases on museum-grade OSes, just cause they might carry a museum-grade version of sqlite3.
> 
> So I am for keeping a version check. 
> 


That's a bit ironic considering that four people have wasted hours replacing

```
SAGE_SPKG_CONFIGURE([sqlite], [
  PKG_CHECK_MODULES([SQLITE],
                    [sqlite3 >= 3.8.7],
                    [],
                    [sage_spkg_install_sqlite=yes])
])
```

with

```
SAGE_SPKG_CONFIGURE([sqlite], [
  m4_define([sqlite3_min_version_major], [3])
  m4_define([sqlite3_min_version_minor], [8])
  m4_define([sqlite3_min_version_micro], [7])
  m4_define([sqlite3_min_version], [sqlite3_min_version_major.sqlite3_min_version_minor.sqlite3_min_version_micro])
  AC_MSG_CHECKING([libsqlite3 >= sqlite3_min_version])
                     dnl https://www.sqlite.org/c3ref/libversion.html
                     dnl https://www.sqlite.org/c3ref/c_source_id.html
                     SQLITE_SAVED_LIBS="$LIBS"
                     LIBS="$LIBS -lsqlite3"
                     AC_RUN_IFELSE([
                       AC_LANG_PROGRAM([[
                                         #include <sqlite3.h>
                                         #include <assert.h>
                                         #include <stdlib.h>
                                         #include <string.h>
                                       ]],
                                       [[
                                         assert( strcmp(sqlite3_libversion(),SQLITE_VERSION)==0 );
                                         if (SQLITE_VERSION_NUMBER < ]]sqlite3_min_version_major[[*1000000 + ]]sqlite3_min_version_minor[[*1000 + ]]sqlite3_min_version_micro[[)
                                           exit(1);
                                         else
                                           exit(0);
                                       ]])
                       ],
                       [AC_MSG_RESULT([yes])],
                       [AC_MSG_RESULT([no])
                        LIBS="$SQLITE_SAVED_LIBS"
                        sage_spkg_install_sqlite=yes])
])
```

to support one version of sqlite on one proprietary OS whose maintainers went out of their way to delete an important file from the package.

sagelib doesn't even use sqlite, it's a dependency of a dependency



---

archive/issue_comments_405840.json:
```json
{
    "body": "Replying to [comment:75 mjo]:\n>  considering that four people have wasted hours \n\n\nExcuse me, m4 and autotools are my hobby.",
    "created_at": "2020-01-18T18:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405840",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:75 mjo]:
>  considering that four people have wasted hours 


Excuse me, m4 and autotools are my hobby.



---

archive/issue_comments_405841.json:
```json
{
    "body": "Replying to [comment:74 dimpase]:\n> spkg-configure.m4 in other packages undefine local m4 variables they happen to define, whereas here it does not happen.\n> They use `m4_pushdef/m4_popdef` pair of macros for these purposes.\n> Can we keep to the same style here?\n\n\nGood idea, will do.",
    "created_at": "2020-01-18T18:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405841",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:74 dimpase]:
> spkg-configure.m4 in other packages undefine local m4 variables they happen to define, whereas here it does not happen.
> They use `m4_pushdef/m4_popdef` pair of macros for these purposes.
> Can we keep to the same style here?


Good idea, will do.



---

archive/issue_comments_405842.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-18T18:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405843.json:
```json
{
    "body": "Ready for review.",
    "created_at": "2020-01-18T18:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405843",
    "user": "https://github.com/mkoeppe"
}
```

Ready for review.



---

archive/issue_comments_405844.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-19T20:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405844",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405845.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-01-19T20:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405845",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_405846.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-01-19T21:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405846",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_405847.json:
```json
{
    "body": "Replying to [comment:76 mkoeppe]:\n> Replying to [comment:75 mjo]:\n> >  considering that four people have wasted hours \n\n> \n> Excuse me, m4 and autotools are my hobby.\n\n\nHAHA :)\n\nI'm also +1 for keeping the version check; personally I would lower the minimum version 3.0.0 until/unless a stronger minimum is actually determined.  But 3.8.7 is still old-enough that it should be satisfied on most system so I'm okay with it.",
    "created_at": "2020-01-22T12:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405847",
    "user": "https://github.com/embray"
}
```

Replying to [comment:76 mkoeppe]:
> Replying to [comment:75 mjo]:
> >  considering that four people have wasted hours 

> 
> Excuse me, m4 and autotools are my hobby.


HAHA :)

I'm also +1 for keeping the version check; personally I would lower the minimum version 3.0.0 until/unless a stronger minimum is actually determined.  But 3.8.7 is still old-enough that it should be satisfied on most system so I'm okay with it.



---

archive/issue_comments_405848.json:
```json
{
    "body": "Replying to [comment:84 embray]:\n>  I would lower the minimum version 3.0.0 until/unless a stronger minimum is actually determined.  But 3.8.7 is still old-enough that it should be satisfied on most system so I'm okay with it.\n\n\n3.0.0 was released in 2004. https://www.sqlite.org/chronology.html",
    "created_at": "2020-01-22T15:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405848",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:84 embray]:
>  I would lower the minimum version 3.0.0 until/unless a stronger minimum is actually determined.  But 3.8.7 is still old-enough that it should be satisfied on most system so I'm okay with it.


3.0.0 was released in 2004. https://www.sqlite.org/chronology.html



---

archive/issue_comments_405849.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-22T20:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405849",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073454.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-22T20:43:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28765#event-73454"
}
```



---

archive/issue_comments_405850.json:
```json
{
    "body": "It turns out there are some tests that fail if the sqlite3 executable is not installed:\n\n```\nsage -t --long --warn-long 78.2 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 608, in sage.tests.cmdline.test_executable\nFailed example:\n    out.startswith(\"3.\")\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 610, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/home/sage/sage/src/bin/sage: line 546: exec: sqlite3: not found\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 612, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   3 of 236 in sage.tests.cmdline.test_executable\n    [235 tests, 3 failures, 45.53 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 78.2 src/sage/tests/cmdline.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\n\nSo, technically it is a regression of `sage -sqlite3` does not work.  I don't think this is very important functionality and it would probably be better if it were slowly deprecated (I think the same should be the case for most `sage -<program name>`--rather, that most of those should be undocumented, and that there should be a generic interface for running executables that might be installed in the Sage distribution).\n\nIn the meantime, I'm leaning towards we need to check for it...",
    "created_at": "2020-01-28T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405850",
    "user": "https://github.com/embray"
}
```

It turns out there are some tests that fail if the sqlite3 executable is not installed:

```
sage -t --long --warn-long 78.2 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 608, in sage.tests.cmdline.test_executable
Failed example:
    out.startswith("3.")
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 610, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/home/sage/sage/src/bin/sage: line 546: exec: sqlite3: not found\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 612, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   3 of 236 in sage.tests.cmdline.test_executable
    [235 tests, 3 failures, 45.53 s]
----------------------------------------------------------------------
sage -t --long --warn-long 78.2 src/sage/tests/cmdline.py  # 3 doctests failed
----------------------------------------------------------------------
```

So, technically it is a regression of `sage -sqlite3` does not work.  I don't think this is very important functionality and it would probably be better if it were slowly deprecated (I think the same should be the case for most `sage -<program name>`--rather, that most of those should be undocumented, and that there should be a generic interface for running executables that might be installed in the Sage distribution).

In the meantime, I'm leaning towards we need to check for it...



---

archive/issue_comments_405851.json:
```json
{
    "body": "Replying to [comment:87 embray]:\n> It turns out there are some tests that fail if the sqlite3 executable is not installed:\n\n\n[ Snip... ]\n\n> So, technically it is a regression of `sage -sqlite3` does not work.\n\n\nIndeed. I just got bitten by this (trying to ebuild 9.1.beta2 from scratch rather than upgrading).\n\n>  I don't think this is very important functionality and it would probably be better if it were slowly deprecated (I think the same should be the case for most `sage -<program name>`--rather, that most of those should be undocumented, and that there should be a generic interface for running executables that might be installed in the Sage distribution).\n\n\nI tend to disagree : an unsuspecting user might have a hard time to understand why \"our\" version replaces the one he/she installed in his/her system if he/she runs out utility that installs system shortcuts for Sage-installed programs  ...\n\n> \n> In the meantime, I'm leaning towards we need to check for it...\n\n\nIndeed. But since `sqlite` is so widely used, we might alsoi depend on the relevant packages (easy for Unices, possibly not so easy for Windows (Madison ?), and possible Apple shenanigans...).\n\nBTW, our move to reduce the size of Sage-the-distribution should reopen the question of what are our minimal dependencies. I would have no problem to depend on `sqlite`, more on `Maxima` (Lisp interpreters !) and even more on `R` (size, dependencies on OpenSSL, etc...)\n\nShould that be disciussed on [sage-devel](https://groups.google.com/forum/#!forum/sage-devel) ?\n\nIn the meantime, should we open a new ticket ?",
    "created_at": "2020-01-30T11:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405851",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:87 embray]:
> It turns out there are some tests that fail if the sqlite3 executable is not installed:


[ Snip... ]

> So, technically it is a regression of `sage -sqlite3` does not work.


Indeed. I just got bitten by this (trying to ebuild 9.1.beta2 from scratch rather than upgrading).

>  I don't think this is very important functionality and it would probably be better if it were slowly deprecated (I think the same should be the case for most `sage -<program name>`--rather, that most of those should be undocumented, and that there should be a generic interface for running executables that might be installed in the Sage distribution).


I tend to disagree : an unsuspecting user might have a hard time to understand why "our" version replaces the one he/she installed in his/her system if he/she runs out utility that installs system shortcuts for Sage-installed programs  ...

> 
> In the meantime, I'm leaning towards we need to check for it...


Indeed. But since `sqlite` is so widely used, we might alsoi depend on the relevant packages (easy for Unices, possibly not so easy for Windows (Madison ?), and possible Apple shenanigans...).

BTW, our move to reduce the size of Sage-the-distribution should reopen the question of what are our minimal dependencies. I would have no problem to depend on `sqlite`, more on `Maxima` (Lisp interpreters !) and even more on `R` (size, dependencies on OpenSSL, etc...)

Should that be disciussed on [sage-devel](https://groups.google.com/forum/#!forum/sage-devel) ?

In the meantime, should we open a new ticket ?



---

archive/issue_comments_405852.json:
```json
{
    "body": "Replying to [comment:88 charpent]:\n> Replying to [comment:87 embray]:\n> > It turns out there are some tests that fail if the sqlite3 executable is not installed:\n\n> \n> [ Snip... ]\n> \n> > So, technically it is a regression of `sage -sqlite3` does not work.\n\n> \n> Indeed. I just got bitten by this (trying to ebuild 9.1.beta2 from scratch rather than upgrading).\n> \n> >  I don't think this is very important functionality and it would probably be better if it were slowly deprecated (I think the same should be the case for most `sage -<program name>`--rather, that most of those should be undocumented, and that there should be a generic interface for running executables that might be installed in the Sage distribution).\n\n> \n> I tend to disagree : an unsuspecting user might have a hard time to understand why \"our\" version replaces the one he/she installed in his/her system if he/she runs out utility that installs system shortcuts for Sage-installed programs  ...\n> \n\nIn the long run there should be no sqlite or libsqlite bundled into Sage.\n\n\n> > \n> > In the meantime, I'm leaning towards we need to check for it...\n\n> \n> Indeed. But since `sqlite` is so widely used, we might alsoi depend on the relevant packages (easy for Unices, possibly not so easy for Windows (Madison ?), and possible Apple shenanigans...).\n> \n> BTW, our move to reduce the size of Sage-the-distribution should reopen the question of what are our minimal dependencies. I would have no problem to depend on `sqlite`, more on `Maxima` (Lisp interpreters !) and even more on `R` (size, dependencies on OpenSSL, etc...)\n> \n\nI won't worry too much about R, as it's already more or less sorted.\nMaxima/ECL is harder, as it's tigher integrated into Sage, and as ECL is moving very slowly nowadays (and with significant changes to come).\n\n\n\n\n> Should that be disciussed on [sage-devel](https://groups.google.com/forum/#!forum/sage-devel) ?\n> \n> In the meantime, should we open a new ticket ?\n\n\nyes, please, for deprecating/removing `sage -FOO` functionality for `FOO=sqlite` and other values like this, right?\n\n>",
    "created_at": "2020-01-30T11:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405852",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:88 charpent]:
> Replying to [comment:87 embray]:
> > It turns out there are some tests that fail if the sqlite3 executable is not installed:

> 
> [ Snip... ]
> 
> > So, technically it is a regression of `sage -sqlite3` does not work.

> 
> Indeed. I just got bitten by this (trying to ebuild 9.1.beta2 from scratch rather than upgrading).
> 
> >  I don't think this is very important functionality and it would probably be better if it were slowly deprecated (I think the same should be the case for most `sage -<program name>`--rather, that most of those should be undocumented, and that there should be a generic interface for running executables that might be installed in the Sage distribution).

> 
> I tend to disagree : an unsuspecting user might have a hard time to understand why "our" version replaces the one he/she installed in his/her system if he/she runs out utility that installs system shortcuts for Sage-installed programs  ...
> 

In the long run there should be no sqlite or libsqlite bundled into Sage.


> > 
> > In the meantime, I'm leaning towards we need to check for it...

> 
> Indeed. But since `sqlite` is so widely used, we might alsoi depend on the relevant packages (easy for Unices, possibly not so easy for Windows (Madison ?), and possible Apple shenanigans...).
> 
> BTW, our move to reduce the size of Sage-the-distribution should reopen the question of what are our minimal dependencies. I would have no problem to depend on `sqlite`, more on `Maxima` (Lisp interpreters !) and even more on `R` (size, dependencies on OpenSSL, etc...)
> 

I won't worry too much about R, as it's already more or less sorted.
Maxima/ECL is harder, as it's tigher integrated into Sage, and as ECL is moving very slowly nowadays (and with significant changes to come).




> Should that be disciussed on [sage-devel](https://groups.google.com/forum/#!forum/sage-devel) ?
> 
> In the meantime, should we open a new ticket ?


yes, please, for deprecating/removing `sage -FOO` functionality for `FOO=sqlite` and other values like this, right?

>



---

archive/issue_comments_405853.json:
```json
{
    "body": "`@`embray Thanks for spotting this and for opening the follow-up ticket:\n- #29092 sqlite3 CLI executable should be checked for at configure time\nI agree that this needs to be fixed.",
    "created_at": "2020-01-30T16:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405853",
    "user": "https://github.com/mkoeppe"
}
```

`@`embray Thanks for spotting this and for opening the follow-up ticket:
- #29092 sqlite3 CLI executable should be checked for at configure time
I agree that this needs to be fixed.



---

archive/issue_comments_405854.json:
```json
{
    "body": "I have opened:\n- #29111 Specify a subset of sage command line options that are supported by sagelib - rather than sage-the-distribution",
    "created_at": "2020-01-30T16:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28765#issuecomment-405854",
    "user": "https://github.com/mkoeppe"
}
```

I have opened:
- #29111 Specify a subset of sage command line options that are supported by sagelib - rather than sage-the-distribution
