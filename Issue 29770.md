# Issue 29770: Allow regular partition tuples to have different \ell values on different components

Issue created by migration from https://trac.sagemath.org/ticket/30007

Original creator: heluani

Original creation time: 2020-06-28 10:01:50

Keywords: partition tuples

Regular partition tuples are common in enumerating bases of infinite dimensional vector spaces coming from representation theory. It is often useful to have different \ell values for different components. For example. For example, the basis for the Fock space of two free Bosons and three free Fermions would have a basis parametrized for partition tuples of level 5 where only three components would need to be 2-regular and 2 components would not need to be regular. This ticket implements that. If one passes to PartitionTuples both a level and a tuple as regular value (instead of just a number) it returns a class "VectorRegularPartitionTuples"


---

Comment by heluani created at 2020-06-28 10:07:30

Changing status from new to needs_review.


---

Comment by tscrim created at 2020-06-29 01:07:14

This seems quite redundant with the current regular partition tuples. I think it would be better to simply extend that functionality to convert a single level into the vector case (by copying the level to each entry) and extend the current code to handle the tuple. Perhaps a special value (either `None` or `0` for those that need not be regular?


---

Comment by heluani created at 2020-06-29 01:50:26

Replying to [comment:2 tscrim]:
> This seems quite redundant with the current regular partition tuples. I think it would be better to simply extend that functionality to convert a single level into the vector case (by copying the level to each entry) and extend the current code to handle the tuple. Perhaps a special value (either `None` or `0` for those that need not be regular?

I agree, originally I was trying to touch as little as possible existing code. 

The main issue that drove me to write a separate class is the level 1 case: partition tuples of level 1 return Partitions. This breaks code like VertexAlgebras that rely on having a PartitionTuple. By including this functionality in the existing code and passing a parameter regular as a tuple of length 1, the natural thing to do would be to return a RegularPartition. 

If that is the case I'll need to refactor on vertex algebras to import RegularPartitionTuples_level directly. But I wanted to express here my preference that Partition tuples of level 1 should be Partition Tuples and not Partitions. It makes unnecessarily harder to write generic code that works with partition tuples of a fixed level to try the level 1 case differently. 

On the other hand changing this behaviour could break existing code, hence my choice to add a small separate class.


---

Comment by tscrim created at 2020-06-29 02:58:10

I don't think that is a good enough reason to duplicate all of the code. The reason we this is done this way is because partitions have more information that can be used and there is very little functional difference between the two in terms of methods. (Of course, we you are iterating over a partition tuple, this is a problem.) I had the same issue when doing the Fock space implementation, but I just had cases in my code to handle the level 1 case separately.

One way you can work around this is if the level is given as a tuple of size 1, then it returns a partition tuple of level 1 for that very special input. This would be the minimal change that does not effect existing code, but it does introduce a slight discrepancy between similar-but-not-equal inputs. However, I think this is justified, provided you put a `.. NOTE::`/`.. WARNING::` in the doc making this clear.

I wouldn't worry too much about not touching existing code. Duplication causes more issues with consistency and more work to things to fix later on (this would be what is called technical debt).


---

Comment by git created at 2020-06-29 17:24:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by heluani created at 2020-06-29 17:38:02

I think this version does what you suggested. It seems from that diff that I was working over an old version of the file, there are some changes that I didn't include. I'll rebase it


---

Comment by git created at 2020-06-29 18:03:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-30 17:56:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-03 03:47:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-03 04:03:11

I made some reviewer changes. If my changes are good, then you can set a positive review.


---

Comment by heluani created at 2020-07-03 19:47:56

The case `regular=0`, that's why it's a positive integer or a tuple of non-negative integers. So I rephrased the description of the class `PartitionTuples` where this is relevant. In the regular classes that's fine cause all those classes receive a tuple, and for tuples `0` is allowed. I also added a couple of missing spaces in the errors raised. Let me know if this is fine.


---

Comment by tscrim created at 2020-07-03 22:00:41

Are there changes you were going to push or is this just explaining your previous commits?


---

Comment by heluani created at 2020-07-03 23:09:58

That was just explaining the previous commit, I wasn't sure if that would be alright with you


---

Comment by tscrim created at 2020-07-03 23:13:10

Then if you are fine with my changes, you can set a positive review.


---

Comment by heluani created at 2020-07-04 00:41:57

Replying to [comment:14 tscrim]:
> Then if you are fine with my changes, you can set a positive review.
Oh crap my push never went through! Here's a commit with the change I mentioned. I apologize.


---

Comment by git created at 2020-07-04 00:43:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-04 01:52:01

This is not quite right. Perhaps this:

```diff
     - ``regular`` -- a positive integer or a tuple of non-negative
       integers; if an integer, the highest multiplicity an entry may
-      have in a component plus `1`.
+      have in a component plus `1`
 
     If a level `k` is specified and ``regular`` is a tuple of integers
     `\ell_1, \ldots, \ell_k`, then this specifies partition tuples `\mu`
-    such that `\mu_i` is `\ell_i`-regular. If ``regular`` is an integer
-    `\ell`, then we set `\ell_i = \ell` for all `i`, with `0`
-    representing `\infty`-regular (equivalently, partitions without
-    restrictions)
+    such that `\mu_i` is `\ell_i`-regular, where `0` here
+    represents `\infty`-regular partitions (equivalently, partitions
+    without restrictions). If ``regular`` is an integer `\ell`, then
+    we set `\ell_i = \ell` for all `i`.
```

(Note also the periods.)


---

Comment by heluani created at 2020-07-04 15:03:36

That looks good to me


---

Comment by git created at 2020-07-04 18:46:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by heluani created at 2020-07-04 18:48:00

Changing status from needs_review to positive_review.


---

Comment by heluani created at 2020-07-05 03:41:55

Assigning it to review again so that it is picked by the bot even though I just made your change


---

Comment by heluani created at 2020-07-05 03:41:55

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2020-07-05 03:47:22

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-07-05 03:47:22

I tested it and it was fine.


---

Comment by vbraun created at 2020-07-08 19:33:02

Resolution: fixed
