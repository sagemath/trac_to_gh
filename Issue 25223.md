# Issue 25223: Add .is_square() function for symbolic expression

Issue created by migration from https://trac.sagemath.org/ticket/25460

Original creator: vklein

Original creation time: 2018-05-29 14:56:07

CC:  vdelecroix

Fix the following behaviour :

```
sage: f(n)=n^2
sage: f(2).is_square()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-2-07de71372bf0> in <module>()
----> 1 f(Integer(2)).is_square()

/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/structure/element.pyx in sage.structure.element.CommutativeRingElement.is_square (build/cythonized/sage/structure/element.c:20900)()
   3020             framework.
   3021         """
-> 3022         raise NotImplementedError("is_square() not implemented for elements of %s" % self.parent())
   3023 
   3024     def sqrt(self, extend=True, all=False, name=None):

NotImplementedError: is_square() not implemented for elements of Symbolic Ring
```





---

Comment by vklein created at 2018-05-29 15:08:35

Set assignee to vklein.


---

Comment by vklein created at 2018-05-29 15:35:56

Changing status from new to needs_review.


---

Comment by vklein created at 2018-05-29 15:35:56

New commits:


---

Comment by vklein created at 2018-05-29 16:00:51

Currently `is_square((x-1)^2)` return `True` the last commit don't do that.


---

Comment by vklein created at 2018-05-29 16:00:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-05-30 08:22:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-30 08:25:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2018-05-30 08:26:48

Enable is_square to manage non numeric expression.


---

Comment by vklein created at 2018-05-30 08:26:48

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2018-05-30 13:05:32

Note that `is_square` is completely broken for symbolic expression. Moving it as a method is not helping in any way.

```
sage: x = SR.var('x')
sage: is_square((cos(x) + 1)^2)
True
sage: is_square((cos(x) + 1)^2, True)   # WTF?
Traceback (most recetn call last):
...
TypeError: unable to convert 2 - 1/2*x^2 + 1/24*x^4 - 1/720*x^6 + 1/40320*x^8 - 1/3628800*x^10 + 1/479001600*x^12 - 1/87178291200*x^14 + 1/20922789888000*x^16 + O(x^18) to a symbolic expression
```

And for example, the following should be `False`

```
sage: is_square(cos(x) - cos(x).taylor(x, 0, 20))
True
```


I would suggest to let this method raise `NotImplementedError` whenever it is not possible to call `is_square` on the underlying pyobject.


---

Comment by vklein created at 2018-05-30 13:16:33

This mean `is_square((x-1)^2)` (with #24677) will have a different behaviour, are you ok with that ?


---

Comment by vdelecroix created at 2018-05-30 13:17:29

Replying to [comment:9 vklein]:
> This mean `is_square((x-1)^2)` (with #24677) will have a different behaviour, are you ok with that ?

yes


---

Comment by git created at 2018-05-30 13:54:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2018-05-30 13:56:06

Done


---

Comment by vdelecroix created at 2018-05-30 13:59:54


```
try:
    obj = self.pyobject()
except TypeError:
    raise NotImplementedError("is_square() not implemented for non numeric elements of Symbolic Ring")

return obj.is_square()
```



---

Comment by git created at 2018-05-30 14:14:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2018-05-30 14:15:13

Ok


---

Comment by vdelecroix created at 2018-05-30 21:47:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-01 15:42:05

Resolution: fixed
