# Issue 25223: Add .is_square() function for symbolic expression

archive/issues_025223.json:
```json
{
    "body": "CC:  vdelecroix\n\nFix the following behaviour :\n\n```\nsage: f(n)=n^2\nsage: f(2).is_square()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-2-07de71372bf0> in <module>()\n----> 1 f(Integer(2)).is_square()\n\n/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/structure/element.pyx in sage.structure.element.CommutativeRingElement.is_square (build/cythonized/sage/structure/element.c:20900)()\n   3020             framework.\n   3021         \"\"\"\n-> 3022         raise NotImplementedError(\"is_square() not implemented for elements of %s\" % self.parent())\n   3023 \n   3024     def sqrt(self, extend=True, all=False, name=None):\n\nNotImplementedError: is_square() not implemented for elements of Symbolic Ring\n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25460\n\n",
    "created_at": "2018-05-29T14:56:07Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Add .is_square() function for symbolic expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25223",
    "user": "vklein"
}
```
CC:  vdelecroix

Fix the following behaviour :

```
sage: f(n)=n^2
sage: f(2).is_square()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-2-07de71372bf0> in <module>()
----> 1 f(Integer(2)).is_square()

/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/structure/element.pyx in sage.structure.element.CommutativeRingElement.is_square (build/cythonized/sage/structure/element.c:20900)()
   3020             framework.
   3021         """
-> 3022         raise NotImplementedError("is_square() not implemented for elements of %s" % self.parent())
   3023 
   3024     def sqrt(self, extend=True, all=False, name=None):

NotImplementedError: is_square() not implemented for elements of Symbolic Ring
```




Issue created by migration from https://trac.sagemath.org/ticket/25460





---

archive/issue_comments_355262.json:
```json
{
    "body": "Set assignee to vklein.",
    "created_at": "2018-05-29T15:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355262",
    "user": "vklein"
}
```

Set assignee to vklein.



---

archive/issue_comments_355263.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-29T15:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355263",
    "user": "vklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_355264.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-29T15:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355264",
    "user": "vklein"
}
```

New commits:



---

archive/issue_comments_355265.json:
```json
{
    "body": "Currently `is_square((x-1)^2)` return `True` the last commit don't do that.",
    "created_at": "2018-05-29T16:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355265",
    "user": "vklein"
}
```

Currently `is_square((x-1)^2)` return `True` the last commit don't do that.



---

archive/issue_comments_355266.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-29T16:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355266",
    "user": "vklein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_355267.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-30T08:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355267",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355268.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-30T08:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355268",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_355269.json:
```json
{
    "body": "Enable is_square to manage non numeric expression.",
    "created_at": "2018-05-30T08:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355269",
    "user": "vklein"
}
```

Enable is_square to manage non numeric expression.



---

archive/issue_comments_355270.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-30T08:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355270",
    "user": "vklein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355271.json:
```json
{
    "body": "Note that `is_square` is completely broken for symbolic expression. Moving it as a method is not helping in any way.\n\n```\nsage: x = SR.var('x')\nsage: is_square((cos(x) + 1)^2)\nTrue\nsage: is_square((cos(x) + 1)^2, True)   # WTF?\nTraceback (most recetn call last):\n...\nTypeError: unable to convert 2 - 1/2*x^2 + 1/24*x^4 - 1/720*x^6 + 1/40320*x^8 - 1/3628800*x^10 + 1/479001600*x^12 - 1/87178291200*x^14 + 1/20922789888000*x^16 + O(x^18) to a symbolic expression\n```\n\nAnd for example, the following should be `False`\n\n```\nsage: is_square(cos(x) - cos(x).taylor(x, 0, 20))\nTrue\n```\n\n\nI would suggest to let this method raise `NotImplementedError` whenever it is not possible to call `is_square` on the underlying pyobject.",
    "created_at": "2018-05-30T13:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355271",
    "user": "vdelecroix"
}
```

Note that `is_square` is completely broken for symbolic expression. Moving it as a method is not helping in any way.

```
sage: x = SR.var('x')
sage: is_square((cos(x) + 1)^2)
True
sage: is_square((cos(x) + 1)^2, True)   # WTF?
Traceback (most recetn call last):
...
TypeError: unable to convert 2 - 1/2*x^2 + 1/24*x^4 - 1/720*x^6 + 1/40320*x^8 - 1/3628800*x^10 + 1/479001600*x^12 - 1/87178291200*x^14 + 1/20922789888000*x^16 + O(x^18) to a symbolic expression
```

And for example, the following should be `False`

```
sage: is_square(cos(x) - cos(x).taylor(x, 0, 20))
True
```


I would suggest to let this method raise `NotImplementedError` whenever it is not possible to call `is_square` on the underlying pyobject.



---

archive/issue_comments_355272.json:
```json
{
    "body": "This mean `is_square((x-1)^2)` (with #24677) will have a different behaviour, are you ok with that ?",
    "created_at": "2018-05-30T13:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355272",
    "user": "vklein"
}
```

This mean `is_square((x-1)^2)` (with #24677) will have a different behaviour, are you ok with that ?



---

archive/issue_comments_355273.json:
```json
{
    "body": "Replying to [comment:9 vklein]:\n> This mean `is_square((x-1)^2)` (with #24677) will have a different behaviour, are you ok with that ?\n\nyes",
    "created_at": "2018-05-30T13:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355273",
    "user": "vdelecroix"
}
```

Replying to [comment:9 vklein]:
> This mean `is_square((x-1)^2)` (with #24677) will have a different behaviour, are you ok with that ?

yes



---

archive/issue_comments_355274.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-30T13:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355274",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_355275.json:
```json
{
    "body": "Done",
    "created_at": "2018-05-30T13:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355275",
    "user": "vklein"
}
```

Done



---

archive/issue_comments_355276.json:
```json
{
    "body": "\n```\ntry:\n    obj = self.pyobject()\nexcept TypeError:\n    raise NotImplementedError(\"is_square() not implemented for non numeric elements of Symbolic Ring\")\n\nreturn obj.is_square()\n```\n",
    "created_at": "2018-05-30T13:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355276",
    "user": "vdelecroix"
}
```


```
try:
    obj = self.pyobject()
except TypeError:
    raise NotImplementedError("is_square() not implemented for non numeric elements of Symbolic Ring")

return obj.is_square()
```




---

archive/issue_comments_355277.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-30T14:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355277",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_355278.json:
```json
{
    "body": "Ok",
    "created_at": "2018-05-30T14:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355278",
    "user": "vklein"
}
```

Ok



---

archive/issue_comments_355279.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-30T21:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355279",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355280.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-01T15:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25223#issuecomment-355280",
    "user": "vbraun"
}
```

Resolution: fixed
