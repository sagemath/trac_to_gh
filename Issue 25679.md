# Issue 25679: implement Packed Words

Issue created by migration from Trac.

Original creator: hmlodecki

Original creation time: 2018-07-24 17:30:47

CC:  tscrim darij zabrocki alauve amypang hmlodecki fhivert vivianepons mathzeta2

Keywords: sagedays@icerm, packed words, CHAs

Combinatorial class of packed words

These object are trivially in bijection with Ordered set partitions. (counted by the Fubini numbers (A000670))

(use in the Hopf algebra WQSym)

This ticket is a replacement for the old ticket #15611 which should be closed.


---

Attachment


---

Comment by hmlodecki created at 2018-07-24 17:51:39

Add branch


---

Comment by git created at 2018-07-24 18:08:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-24 20:16:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-25 13:52:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-25 13:59:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2018-07-25 14:00:56

Changing status from new to needs_review.


---

Comment by hmlodecki created at 2018-07-25 14:00:56

Left weak order and right weak order will be useful for some basis in WQSym


---

Comment by embray created at 2018-07-25 15:56:01

I can't provide any useful feedback on the math, but here are a few minor nitpicks:


```diff
+#       Copyright (C) 2012 Jean-Baptiste Priez <jbp`@`kerios.fr>,
```


I assume you'll want to update this to 2018


```diff
+    :func:`sage.combinat.permutation.to_standard`) for *packed words*.
+    EXEMPLES::
```


EXEMPLES -> EXAMPLES; also I think normally there should be an additional blank line before the "EXAMPLES" heading.


```diff
+    for set in li:
+        for p in set:
+            dic[p] = i
+        i += 1
```


Please try to avoid using Python built-ins like `set` as a variable name.  It's reasonably unambiguous here, but can still be confusing (especially to editors).  If you're hell-bend on naming the variable "set", I'll sometimes do something like `_set` or `set_`.


```diff
+    return PackedWord(dic.values())
```


For Python 3 compatibility please make sure that `PackedWord` can accept an arbitrary iterable its argument.  I believe this might already be the case for `ClonableArray` and subclasses thereof, but I'm not positive.  Otherwise, this would have be something like `list(dic.values())` unfortunately.


```diff
+            #sage: PackedWord([2,2,1,0,4])
+            #Traceback (most recent call last)
+            #...
+            #AssertionError: This is not a packed word
```

this is commented out for some reason?


```diff
+        assert(len(s) == 0 or (max(s) == len(s) and min(s) == 1)
+            ), "This is not a packed word %s" % str(self)
```


`str(self)` is unnecessary; it can just be `self` (the `str()` is implied by the `%s` format code).  I think we're mostly preferring new-style string formatting these days, but I don't think there's a policy either way.


```diff
+        import collections
```


Please avoid in-line imports unless it's absolutely necessary.  I guarantee `collections` is already being imported elsewhere in Sage, so there's no reason not to put it at the top-level of the module.

There are some other in-line imports elsewhere you might want to check on.  For imports from Sage this is sometimes more necessary to avoid circular imports or slow import times, though a lot of that can also be avoided using `LazyImport` instead.


```diff
+        return [Set(d[k]) for k in sorted(d.keys())]
```


`.keys()` is unnecessary here; just `sorted(d)` will work.


```diff
+    def combinatorial_class_of_size(self, size):
+        assert(size >= 0), "size (%d) must be a positive integer" % size
+        return PackedWords(size)
```


Missing docstring here.


```diff
+        if res.size() != self._size:
+            raise ValueError, "Wrong size of word"
+        return res
```


This is old-style `raise` syntax which should not be used.  Instead use `raise ValueError("Wrong size of word")`.

General comment: Please also use spaces around operators such as `>` and `+` and after commas more often than not, in PEP-8 style.


---

Comment by chapoton created at 2018-07-25 18:26:44

For py3 compatibiity:

* do not use it.next() but instead next(it)

* do not use xrange but range


---

Comment by git created at 2018-07-25 19:17:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2018-07-25 19:21:52

For the copyright, I didn't change because some functions are comming from Jean-Baptiste Priez and he wrote it in 2012.
For "PackedWord(dic.values())" I checked that the following thing works, is that a good check?
sage: PackedWord(xrange(1,5))
[1, 2, 3, 4]


---

Comment by mantepse created at 2018-07-25 20:15:42

* I think it would be better to avoid `Set` in library code.  It comes with great performance penalty.

* A proposal for a replacement of the introductory text:

```
Packed words are a way to represent ordered set partitions.
A word `w` with letters in `\{1,...,n\}` is a packed word if for each number `k > 1` appearing in `w`, the number `k - 1` appears in `w` too.

Thus, `w` can be obtained from an ordered set partition by setting `w_i=j` if `i` belongs to the `j`-th block.
```



---

Comment by git created at 2018-07-25 21:31:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-07-26 12:33:54

Also, anytime you have latex code, you should make the string "raw" by starting the (doc)strings with `r"""`.


---

Comment by git created at 2018-07-26 14:59:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-26 23:05:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-26 23:22:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2018-07-27 13:55:35

Minor docstring comments:

* Lots of docstrings that should be sentences are missing periods.

* check() method docstring should be 'Check that' not 'Checks that' (there may be a few other minor grammatical things like that).

* to_ordered_set_partition() docstring should start 'Build an' not 'This method build an'

* to_composition() should mention what a parikh vector is.

* In the docstrings for inversion and coinversions, I'm not sure if the use of the individual character for an exponentiated 2 will work in general

*left_weak_order_greater docstring should say 'information' not 'informations'

* packed_word_size __init__ method doesn't have a doctest.


---

Comment by git created at 2018-07-27 22:19:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-10 02:41:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-08-10 02:44:17

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-08-10 02:44:17

I have rewritten some parts of the code to directly use some of the feature of the base classes and category you are using. I also made a bunch of doc related fixes and improvements. However, the definition of a left coinversion was exactly the same as that of an inversion. So that will need to be added (currently it is a `???`). Other than that, if my changes are good, then it will be a positive review (I think I have taken care of all of Kevin's comments).


---

Comment by chapoton created at 2018-08-23 16:28:42

missing blank line in the doc added inside src/sage/combinat/set_partition_ordered.py


---

Comment by git created at 2018-09-25 20:34:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-09-25 22:41:04

Back to needs review?


---

Comment by alauve created at 2018-09-26 03:33:45

Let me have a "pre review" look first, Travis. Hugo and I are both in Montreal right now, so can go over some aspects of it together.


---

Comment by hmlodecki created at 2018-09-26 18:46:33

First of all, thank you Travis for all the improvements.

Your remarque on inversions make me rework on it. I think it is better to based it on 1 because it is that way on permutations and the coherence is important.

Also I have some other remarques and questions :
* The terme **coinversion** is not good so I think it's better to name it **inversions_value_left**, **inversions_position_right**...
* But now I'm realizing that it might be better to use options like //inversions(side="right",support="position")//. What do you think ?
* An other question is : is it a good convention to return the (greater,lower) when thes are **values** and (lower,greater) when thes are **positions** ?


---

Comment by tscrim created at 2018-09-26 22:48:13

I am not really sure. These things sound like they would have lots of convention choices depending on who you ask. I would just choose what convention you think is best (for your definition of best) and just clearly spell it out. If there are things in the literature (including what you might be writing), IMO it is generally better to stick to that.


---

Comment by git created at 2018-09-27 18:27:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-27 20:43:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-01 07:58:16

Is this now ready for re-review?


---

Comment by alauve created at 2018-10-01 11:45:32

Not yet. Close.


---

Comment by git created at 2018-10-02 23:01:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2018-10-02 23:06:43

It remains some TODO mostly about `check`, `_element_constructor_` and `__contains__` or english improvements.
I'll propose something tomorrow about the first point.


---

Comment by alauve created at 2018-10-02 23:25:01

Looks nice so far, Hugo. (I see a few small issues). Don't worry about english improvements. I'll handle these (and the small issues I alluded to) after your next push.

*EDIT:* I should mention that if somebody else wants to chime-in about how `check`, `_element_constructor_` and `__contains__` should work in concert, now would be the time.


---

Comment by hmlodecki created at 2018-10-02 23:31:03

I forgot to say that I'm also currently working on right and left weak order intervals.


---

Comment by git created at 2018-10-02 23:43:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-04 18:12:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-06 06:29:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2018-10-06 06:46:52

I think this ticket is now ready for a deeper-than-superficial glance.

**Two questions for Hugo:**

* Is there a quick way to check whether or not something is greater / lesser
   in right- or left-weak order? E.g., for ordinary weak order, `pi < sigma` if 
   the inversions of `pi` (or `pi.inverse()`) are a subset of that of `sigma` (or `sigma.inverse()`)

* Doing some computations, it looks like the left and right posets are graded. Is that so? If so, I think it would be better to use `RecursivelyEnumeratedSet` to search for elements in the interval [u1, u2] instead of building all of `u1.right_weak_order_greater()`

If either of the above are true, then I believe you can speed-up your interval code.

And **one question for others** regarding check/contains/element_constructor/eq:

* is this the right convention?: 
   we want `a in B` is "True" if and only if `a == B(a)` is "True"   

I didn't actually check this yet, but thought I'd ask.


---

Comment by hmlodecki created at 2018-10-08 23:55:11

For the first question, I don't know if there is, it is possible so I'll check that. 
For the second, you are totally right, I'll change it.


---

Comment by tscrim created at 2018-10-09 06:54:55

Replying to [comment:38 alauve]:
> * is this the right convention?: 
>    we want `a in B` is "True" if and only if `a == B(a)` is "True"   

Well, for `a == B(a)`, that also runs a coercion, so it (generically) roughly does `B(a) == B(a)`. What you are really after is does `B(a)` fail or not (but often `B(a)` does the containment check before proceeding).


---

Comment by alauve created at 2018-10-09 15:05:00

Replying to [comment:40 tscrim]:

> Replying to [comment:38 alauve]:
> > * is this the right convention?: 
> >    we want `a in B` is "True" if and only if `a == B(a)` is "True"   
> 
> Well, for `a == B(a)`, that also runs a coercion, so it (generically) roughly does `B(a) == B(a)`. What you are really after is does `B(a)` fail or not (but often `B(a)` does the containment check before proceeding).
.

I'm not quite sure what I'm after, but thought the equality test might be part of the story...

I see very different behavior within `Partitions`, `SetPartitions` and `OrderedSetPartitions`:


```
sage: [2,1] in Partitions()
True
sage: [{1,2},{3}] in SetPartitions()
False
sage: [[1,2],[3]] in OrderedSetPartitions()
True
sage: [[1,2],[3]] in OrderedSetPartitions(3)
False
sage: [set([1,2]), set([3])] in OrderedSetPartitions(3)
TypeError: X (=set([1, 2])) must be a Set
```


I'm not sure which convention to follow. And consequently, I'm not sure how to divvy up the tasks of creating elements between `check`, `__contains__`, and `_element_constructor_`.


---

Comment by hmlodecki created at 2018-10-10 18:17:42

> Is there a quick way to check whether or not something is greater / lesser in right- or left-weak order? E.g., for ordinary weak order, `pi < sigma` if the inversions of `pi` (or `pi.inverse()`) are a subset of that of `sigma` (or `sigma.inverse()`)

After some research, there is a very quick way to check with the inversions. I also need a new methode support(). I think I'll create methodes `is_greater(self, pw, side='right')` and `is_smaller(self, pw, side='right')` with this check and use it in the interval methode.

I should have done it before, sorry.


---

Comment by git created at 2018-10-12 00:37:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2018-10-12 23:20:33

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-10-13 00:02:16

Mostly looks good. Some comments:

IMO, it is better to not have as much shorthand, so ``\forall i <= d < j, u_i > u_j`.` -> ``u_i > u_j` for all `i \leq d < j.``

Formatting change

```
    TODO:

        - perhaps reformat the display of packed words of sizes 0..3.
          (I need to look at the documentation to see.)
```


```
    .. TODO::

        Perhaps reformat the display of packed words of sizes 0..3.
```

or is that a todo for yourself before including it into Sage?


```diff
-        ``osp`` -- an object or iterable (e.g., a list of lists)
-        that defines an ordered set partition.
+        - ``osp`` -- an object or iterable (e.g., a list of lists)
+          that defines an ordered set partition
```


The `TODO:` in the `_element_constructor_` does make sense to do and can be removed.

`.. rubric::` -> `.. RUBRIC::`

I don't understand why there is a `.. rubric` in the `OUTPUT:` of `inversions`. It looks more like it is just in the wrong place.


```diff
-        - ``side`` -- "left" or "right": the side of the weak order of inversions
-        - ``support`` -- "position" or "value": the support of the result
+        - ``side`` -- ``"left"`` or ``"right"``; the side of the weak order of inversions
+        - ``support`` -- ``"position"`` or ``"value"``; the support of the result
```



---

Comment by tscrim created at 2018-10-13 00:03:55

Oh, I see what you are doing with the `inversions()` doc. I don't think that is so useful. I think it would be better to move all of those `.. RUBRIC::` to the main part before the `INPUT:` and then have the `EXAMPLES::` interspersed with maybe a few sentences saying what each test is doing compared the others.


---

Comment by git created at 2018-10-16 18:10:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-16 18:22:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-16 18:41:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2018-10-16 18:43:12

I do not know if that's what you thought about ``inversions()`` doc.
----
New commits:


---

Comment by chapoton created at 2018-10-17 06:31:32

patchbot plugin says

```
++        INPUT::
+wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, etc) inserted on 1 non-empty lines
```

It should be `INPUT:`


---

Comment by git created at 2018-10-17 15:43:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-10-17 15:50:24

and patchbot also says that doc does not build:

```
+[dochtml] OSError: /home/jdemeyer/sage-patchbot/local/lib/python2.7/site-packages/sage/combinat/packed_words.py:docstring of sage.combinat.packed_words.PackedWords.from_ordered_set_partition:6: WARNING: Unexpected indentation.
```



---

Comment by hmlodecki created at 2018-10-17 15:59:42

Sorry I don't understand the error... How can I fix it ?


---

Comment by chapoton created at 2018-10-17 16:01:23

in fact, this doc-building error was probably caused by the bad INPUT::

let me launch my bot to check that doc now builds


---

Comment by chapoton created at 2018-10-18 07:41:40

ok, doc builds correctly. There remains only a few failing doctests.


---

Comment by git created at 2018-10-19 00:00:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2018-10-19 00:02:31

It is the only failling doctest I saw, if there are more I don't know where it is.


---

Comment by chapoton created at 2018-10-19 06:26:33

did you look at the patchbot report ? (click on the round icon at top right, and then click on "shortlog" in the top report.)

```
sage -t --long src/sage/combinat/set_partition_ordered.py  # 1 doctest failed
sage -t --long src/sage/combinat/packed_words.py  # 3 doctests failed
```

You did fix the first one only.


---

Comment by alauve created at 2018-10-19 14:44:59

First, I suppose we don't need to run exactly the same test twice:


```
File "src/sage/combinat/packed_words.py", line 108, in sage.combinat.packed_words.PackedWord.__init__
Failed example:
    TestSuite(PackedWords()).run()  # long time
Expected nothing
Got:
    Failure in _test_an_element:
    (...)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/categories/sets_cat.py", line 1099, in _test_an_element
        tester.assertEqual(self(an_element), an_element, "element construction is not idempotent")
      File "/Applications/sage/local/lib/python2.7/unittest/case.py", line 513, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/Applications/sage/local/lib/python2.7/unittest/case.py", line 506, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: element construction is not idempotent
```


and then again later in the file:


```
File "src/sage/combinat/packed_words.py", line 1474, in sage.combinat.packed_words.PackedWords_all.__init__
Failed example:
    TestSuite(PackedWords()).run()  # long time
Expected nothing
Got:
    (...)
```


I'll try to track down the problem, which seems to be that for some `a`, we don't have the expected answer to `PackedWords(a) == a`.


---

Comment by alauve created at 2018-10-19 14:57:40

Okay, this wasn't too hard to track down (see below). I should have a fix pushed today.


```
sage: P = PackedWords()
sage: w = P.an_element(); w
[]
sage: pw = P(w); pw
[]
sage: w.parent()
Packed words of size 0
sage: pw.parent()
Packed words
sage: w == pw
False
```



---

Comment by git created at 2018-10-19 15:19:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2018-10-19 15:19:59

All tests pass now.


---

Comment by tscrim created at 2018-10-19 15:30:42

Implementing that `__iter__` I think is not the correct fix. In fact, it should not be creating any elements whose parent is `PackedWords_all` because of the `facade=True`. I think what you need to do is switch `(PackedWords, DisjointUnionEnumeratedSets)` -> `(DisjointUnionEnumeratedSets, PackedWords)` so the `DisjointUnionEnumeratedSets` is first in the MRO (and remove the `__iter__` method).


---

Comment by alauve created at 2018-10-19 15:33:33

okay. let me try that route.


---

Comment by alauve created at 2018-10-19 15:41:13

Hmm. Maybe not. Seems to break the `PackedWord` constructor ...


```
sage: PackedWords()([2,3,1])
[2, 3, 1]
sage: PackedWord([2,3,1])   
(...)
TypeError: _element_constructor_facade() got an unexpected keyword argument 'check'
```



---

Comment by tscrim created at 2018-10-19 15:45:28

I don't think `PackedWord` should take a `check` input as user input cannot be trusted in general. If someone wants to skip the checking, they should be creating the correct parent anyways I think (and then when constructing the element directly, then pass the `check`).


---

Comment by alauve created at 2018-10-19 16:04:55

Well, Hugo and I are unsure how check works and when it should be used.

We tried to follow examples in, say, `SetPartition` and `Tableau` but perhaps these aren't good models.


---

Comment by alauve created at 2018-10-19 16:25:18

Also, because of the changed MRO, it seems a contains method should be added to `PackedWords_all` to "overload" the default one from `DisjointUnionEnumeratedSets`. This is annoying, and I surely did not settle on the right solution, but I just added

```
__contains__ = PackedWords.__contains__
```

to the `PackedWords_all` class.

My first stab at dropping `check` made many, many more tests fail, so I need a little guidance here.


---

Comment by tscrim created at 2018-10-19 16:50:40

Sorry, I don't have any more time this morning. I can try to look at it tonight.


---

Comment by hmlodecki created at 2018-11-07 14:33:06

Hi, I made some tests and I found an other unexpected result : 

```
sage: p = PackedWords(3).random_element()
sage: p == PackedWord(p)
False
sage: type(p)
<class '__main__.PackedWords_size_with_category.element_class'>
sage: type(PackedWord(p))
<class '__main__.PackedWords_all_with_category.element_class'>
```


One solution I found to prevent this is to replace the last line of the file

```
return self.element_class(self, osp.to_packed_word(), check=False)
```

by 

```
 return PackedWord(osp.to_packed_word())
```

But it might not be the best solution.

About the questions above, it goes beyond my skills.


---

Comment by tscrim created at 2018-11-08 14:25:22

That is not what you want to do. 

The issue is a lack of coercion from `PackedWords(3)` -> `PackedWords()` because the element class takes the parent into account for the equality. However, if you do the coercion, you also need to change the hash, which also takes into account the parent. (Equal things in Python must have equal hashes.) However, the better fix is flipping the MRO as mentioned in comment:64. I should (finally) be able to look at this either today or tomorrow. Sorry about the delay.


---

Comment by chapoton created at 2018-12-31 16:28:25

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-12-31 16:28:25

the branch is now red, ticket needs to be rebased on latest develop


---

Comment by git created at 2018-12-31 20:30:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-12-31 20:31:12

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-12-31 20:31:12

rebasing done


---

Comment by embray created at 2019-01-07 14:30:08

To be clear, making a merge commit from the trunk is not "rebasing".  Rebasing is taking a branch from an old trunk (i.e. an old version of the develop branch), snipping it off, and transplanting those commits on top of the new trunk as if they were made there in the first place: https://www.atlassian.com/git/tutorials/merging-vs-rebasing

I prefer, in most cases, to use rebasing when updating development branches because it results in a cleaner commit history, and since it's just a development branch (typically that no one else is working on) there is no danger in slightly rewriting said history since it's just work under development anyways.


---

Comment by git created at 2019-01-11 16:00:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2019-01-11 16:05:48

To handle the contains errors returned by `TestSuite`, we decided to try out the `SetFactory` mechanisms. 
Comments welcome.

(We still have some test errors to trackdown.)


---

Comment by git created at 2019-01-11 17:17:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2019-01-11 17:20:37

It remains one probleme, it is about the methodes that are in `PackedWordsBaseClass` that we want to use with just `PackedWords.a_methode`.


---

Comment by git created at 2019-01-14 19:05:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-01 15:36:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2019-02-11 16:53:28

Patchbot says there's still 4 methods that are missing doctests.

In the method `pack`, replace `uniq(li)` with `sorted(set(li))`. You can also remove the associated import for `uniq`.

TestSuite is having an issue with `add_constraints`, though I can't tell what it's trying to do well enough to guess what it may be.


---

Comment by git created at 2019-02-12 10:30:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-12 10:34:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-03-17 12:29:20

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2019-03-17 12:29:20

* failing doctests, see bot reports

* do not use EXAMPLES:: several times in the same function "inversions"

* `support == None` should be `support is None`

* is_lequal is missing EXAMPLES::

* in constraint, too many empty lines after EXAMPLES::

* use `.. TODO::` for todos

* remove the commentied iterator


---

Comment by git created at 2019-07-08 09:35:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 13:30:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hmlodecki created at 2019-07-08 13:33:57

I fixed all these documentation problems.

Replying to [comment:86 chapoton]:
> * failing doctests, see bot reports
> 
> * do not use EXAMPLES:: several times in the same function "inversions"
> 
> * `support == None` should be `support is None`
> 
> * is_lequal is missing EXAMPLES::
> 
> * in constraint, too many empty lines after EXAMPLES::
> 
> * use `.. TODO::` for todos
> 
> * remove the commentied iterator


---

Comment by hmlodecki created at 2019-07-08 13:35:54

Changing status from needs_work to needs_review.


---

Comment by hmlodecki created at 2019-07-12 09:39:47

Changing keywords from "sagedays@icerm, packed words, CHAs" to "sagedays@icerm, packed words, CHAs, fpsac2019".


---

Comment by tscrim created at 2019-07-14 09:47:08

Be careful about containment checks:

```
        if pw in Permutations():
            m = pw.size()
        elif pw in PackedWords():
            m = pw._max
```

If `pw` is a list that is, e.g., a permutation, then the code will fail:

```
sage: [1,3,2] in Permutations()
True
```

What you really want to do is get the parent, so use the `parent` *function* (not the method). You should add a test that this works with lists (or raises an appropriate error).

`type(self)` is preferred over `self.__class__` (this is something I learned last year or so).

I am about 1/3 of the way through, but I have to go now. I will get through more later today.


---

Comment by chapoton created at 2019-11-29 15:01:01

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2019-11-29 15:01:01

not python3 compatible (problems with +range, for instance)


---

Comment by git created at 2020-03-18 13:36:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-15 08:24:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-15 08:26:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-15 08:37:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-15 08:42:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-07-15 08:43:57

There are now two broken doctests.
