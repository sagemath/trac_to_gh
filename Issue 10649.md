# Issue 10649: speed up matrix actions on Manin symbols

archive/issues_010649.json:
```json
{
    "body": "Assignee: @craigcitro\n\nCC:  @loefflerd\n\nKeywords: manin symbol binomial\n\nThe patch (basically written by William at #8614) speeds up these actions by changing the way the binomial coefficients are obtained.\n\nSome timings (the weight seems to be the important parameter here):\n\n\nBEFORE THE PATCH:\n\n\n```\nsage: from sage.modular.modsym.manin_symbols import ManinSymbolList_gamma0             \nsage: m = ManinSymbolList_gamma0(5, 8)                                                 \nsage: timeit(\"n = m.apply_T(4)\")                                                       \n625 loops, best of 3: 132 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                      \n625 loops, best of 3: 26 \u00b5s per loop\nsage: m = ManinSymbolList_gamma0(5, 30)                                                \nsage: timeit(\"n = m.apply_T(4)\")                                                       \n625 loops, best of 3: 541 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                      \n625 loops, best of 3: 25.8 \u00b5s per loop\nsage: m = ManinSymbolList_gamma0(5, 100)                                               \nsage: timeit(\"n = m.apply_T(4)\")                                                       \n125 loops, best of 3: 1.92 ms per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                      \n625 loops, best of 3: 25.8 \u00b5s per loop\nsage: eps = DirichletGroup(4).gen(0)                                                   \nsage: from sage.modular.modsym.manin_symbols import ManinSymbolList_character          \nsage: m = ManinSymbolList_character(eps, 2)                                            \nsage: timeit(\"n = m.apply_T(4)\")                                                       \n625 loops, best of 3: 141 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                      \n625 loops, best of 3: 103 \u00b5s per loop\nsage: m = ManinSymbolList_character(eps, 30)                                           \nsage: timeit(\"n = m.apply_T(4)\")                                                       \n125 loops, best of 3: 2.75 ms per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                      \n625 loops, best of 3: 105 \u00b5s per loop\nsage: m = ManinSymbolList_character(eps, 100)                                          \nsage: timeit(\"n = m.apply_T(4)\")                                                       \n25 loops, best of 3: 9.35 ms per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                      \n625 loops, best of 3: 103 \u00b5s per loop\n```\n\n\nAFTER THE PATCH:\n\n\n```\nsage: from sage.modular.modsym.manin_symbols import ManinSymbolList_gamma0                \nsage: m = ManinSymbolList_gamma0(5, 8)                                                    \nsage: timeit(\"n = m.apply_T(4)\")                                                          \n625 loops, best of 3: 21.6 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                         \n625 loops, best of 3: 13.8 \u00b5s per loop\nsage: m = ManinSymbolList_gamma0(5, 30)                                                   \nsage: timeit(\"n = m.apply_T(4)\")                                                          \n625 loops, best of 3: 74.4 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                         \n625 loops, best of 3: 13.7 \u00b5s per loop\nsage: m = ManinSymbolList_gamma0(5, 100)                                                  \nsage: timeit(\"n = m.apply_T(4)\")                                                          \n625 loops, best of 3: 297 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                         \n625 loops, best of 3: 13.8 \u00b5s per loop\nsage: eps = DirichletGroup(4).gen(0)                                                      \nsage: from sage.modular.modsym.manin_symbols import ManinSymbolList_character             \nsage: m = ManinSymbolList_character(eps, 2)                                               \nsage: timeit(\"n = m.apply_T(4)\")                                                          \n625 loops, best of 3: 126 \u00b5s per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                         \n625 loops, best of 3: 90.5 \u00b5s per loop\nsage: m = ManinSymbolList_character(eps, 30)                                              \nsage: timeit(\"n = m.apply_T(4)\")                                                          \n125 loops, best of 3: 2.26 ms per loop\nsage: timeit(\"n = m.apply_TT(4)\")                                                         \n625 loops, best of 3: 91.3 \u00b5s per loop\nsage: m = ManinSymbolList_character(eps, 100)                                             \nsage: timeit(\"n = m.apply_T(4)\") \n125 loops, best of 3: 7.7 ms per loop\nsage: timeit(\"n = m.apply_TT(4)\")\n625 loops, best of 3: 90.6 \u00b5s per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10709\n\n",
    "created_at": "2011-01-29T05:47:49Z",
    "labels": [
        "modular forms",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "speed up matrix actions on Manin symbols",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10649",
    "user": "@aghitza"
}
```
Assignee: @craigcitro

CC:  @loefflerd

Keywords: manin symbol binomial

The patch (basically written by William at #8614) speeds up these actions by changing the way the binomial coefficients are obtained.

Some timings (the weight seems to be the important parameter here):


BEFORE THE PATCH:


```
sage: from sage.modular.modsym.manin_symbols import ManinSymbolList_gamma0             
sage: m = ManinSymbolList_gamma0(5, 8)                                                 
sage: timeit("n = m.apply_T(4)")                                                       
625 loops, best of 3: 132 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                      
625 loops, best of 3: 26 µs per loop
sage: m = ManinSymbolList_gamma0(5, 30)                                                
sage: timeit("n = m.apply_T(4)")                                                       
625 loops, best of 3: 541 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                      
625 loops, best of 3: 25.8 µs per loop
sage: m = ManinSymbolList_gamma0(5, 100)                                               
sage: timeit("n = m.apply_T(4)")                                                       
125 loops, best of 3: 1.92 ms per loop
sage: timeit("n = m.apply_TT(4)")                                                      
625 loops, best of 3: 25.8 µs per loop
sage: eps = DirichletGroup(4).gen(0)                                                   
sage: from sage.modular.modsym.manin_symbols import ManinSymbolList_character          
sage: m = ManinSymbolList_character(eps, 2)                                            
sage: timeit("n = m.apply_T(4)")                                                       
625 loops, best of 3: 141 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                      
625 loops, best of 3: 103 µs per loop
sage: m = ManinSymbolList_character(eps, 30)                                           
sage: timeit("n = m.apply_T(4)")                                                       
125 loops, best of 3: 2.75 ms per loop
sage: timeit("n = m.apply_TT(4)")                                                      
625 loops, best of 3: 105 µs per loop
sage: m = ManinSymbolList_character(eps, 100)                                          
sage: timeit("n = m.apply_T(4)")                                                       
25 loops, best of 3: 9.35 ms per loop
sage: timeit("n = m.apply_TT(4)")                                                      
625 loops, best of 3: 103 µs per loop
```


AFTER THE PATCH:


```
sage: from sage.modular.modsym.manin_symbols import ManinSymbolList_gamma0                
sage: m = ManinSymbolList_gamma0(5, 8)                                                    
sage: timeit("n = m.apply_T(4)")                                                          
625 loops, best of 3: 21.6 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                         
625 loops, best of 3: 13.8 µs per loop
sage: m = ManinSymbolList_gamma0(5, 30)                                                   
sage: timeit("n = m.apply_T(4)")                                                          
625 loops, best of 3: 74.4 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                         
625 loops, best of 3: 13.7 µs per loop
sage: m = ManinSymbolList_gamma0(5, 100)                                                  
sage: timeit("n = m.apply_T(4)")                                                          
625 loops, best of 3: 297 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                         
625 loops, best of 3: 13.8 µs per loop
sage: eps = DirichletGroup(4).gen(0)                                                      
sage: from sage.modular.modsym.manin_symbols import ManinSymbolList_character             
sage: m = ManinSymbolList_character(eps, 2)                                               
sage: timeit("n = m.apply_T(4)")                                                          
625 loops, best of 3: 126 µs per loop
sage: timeit("n = m.apply_TT(4)")                                                         
625 loops, best of 3: 90.5 µs per loop
sage: m = ManinSymbolList_character(eps, 30)                                              
sage: timeit("n = m.apply_T(4)")                                                          
125 loops, best of 3: 2.26 ms per loop
sage: timeit("n = m.apply_TT(4)")                                                         
625 loops, best of 3: 91.3 µs per loop
sage: m = ManinSymbolList_character(eps, 100)                                             
sage: timeit("n = m.apply_T(4)") 
125 loops, best of 3: 7.7 ms per loop
sage: timeit("n = m.apply_TT(4)")
625 loops, best of 3: 90.6 µs per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/10709





---

archive/issue_comments_111764.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-29T05:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111764",
    "user": "@aghitza"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111765.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-01-29T10:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111765",
    "user": "@loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111766.json:
```json
{
    "body": "I don't like the following:\n\n```\nsage: a = ZZ(10); b = (2*a).binomial(a, algorithm=\"spam\")\nsage: b is None\nTrue\n```\n\nIt should probably raise an error if the algorithm is unrecognized, not just fall of the end of the function and return None.\n\nAlso, the \"algorithm = mpir\" option doesn't seem to allow the computation to be interrupted with Ctrl-C, so if you feed it a very large number by mistake you end up with no alternative but to kill your entire sage session. (The Pari implementation seems to handle interrupts better.) \n\nFinally, I'd very much prefer it if the generic \"binomial\" function, called with an integer object, just called the binomial method of that object, and allowed the user to specify an algorithm there instead.",
    "created_at": "2011-01-29T10:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111766",
    "user": "@loefflerd"
}
```

I don't like the following:

```
sage: a = ZZ(10); b = (2*a).binomial(a, algorithm="spam")
sage: b is None
True
```

It should probably raise an error if the algorithm is unrecognized, not just fall of the end of the function and return None.

Also, the "algorithm = mpir" option doesn't seem to allow the computation to be interrupted with Ctrl-C, so if you feed it a very large number by mistake you end up with no alternative but to kill your entire sage session. (The Pari implementation seems to handle interrupts better.) 

Finally, I'd very much prefer it if the generic "binomial" function, called with an integer object, just called the binomial method of that object, and allowed the user to specify an algorithm there instead.



---

archive/issue_comments_111767.json:
```json
{
    "body": "s/instead/as well/.",
    "created_at": "2011-01-29T10:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111767",
    "user": "@loefflerd"
}
```

s/instead/as well/.



---

archive/issue_comments_111768.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-01-29T12:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111768",
    "user": "@aghitza"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111769.json:
```json
{
    "body": "Replying to [comment:2 davidloeffler]:\n> I don't like the following:\n> {{{\n> sage: a = ZZ(10); b = (2*a).binomial(a, algorithm=\"spam\")\n> sage: b is None\n> True\n> }}}\n> It should probably raise an error if the algorithm is unrecognized, not just fall of the end of the function and return None.\n\nDone.\n\n> Also, the \"algorithm = mpir\" option doesn't seem to allow the computation to be interrupted with Ctrl-C, so if you feed it a very large number by mistake you end up with no alternative but to kill your entire sage session. (The Pari implementation seems to handle interrupts better.) \n\nFixed.\n\n> Finally, I'd very much prefer it if the generic \"binomial\" function, called with an integer object, just called the binomial method of that object, and allowed the user to specify an algorithm there instead. \n\nDone.",
    "created_at": "2011-01-29T12:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111769",
    "user": "@aghitza"
}
```

Replying to [comment:2 davidloeffler]:
> I don't like the following:
> {{{
> sage: a = ZZ(10); b = (2*a).binomial(a, algorithm="spam")
> sage: b is None
> True
> }}}
> It should probably raise an error if the algorithm is unrecognized, not just fall of the end of the function and return None.

Done.

> Also, the "algorithm = mpir" option doesn't seem to allow the computation to be interrupted with Ctrl-C, so if you feed it a very large number by mistake you end up with no alternative but to kill your entire sage session. (The Pari implementation seems to handle interrupts better.) 

Fixed.

> Finally, I'd very much prefer it if the generic "binomial" function, called with an integer object, just called the binomial method of that object, and allowed the user to specify an algorithm there instead. 

Done.



---

archive/issue_comments_111770.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-01-29T14:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111770",
    "user": "@loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111771.json:
```json
{
    "body": "According to patchbot the new patch causes a doctest to fail in combinat (something to do with Catalan numbers).",
    "created_at": "2011-01-29T14:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111771",
    "user": "@loefflerd"
}
```

According to patchbot the new patch causes a doctest to fail in combinat (something to do with Catalan numbers).



---

archive/issue_comments_111772.json:
```json
{
    "body": "Attachment [trac_10709.patch](tarball://root/attachments/some-uuid/ticket10709/trac_10709.patch) by @aghitza created at 2011-01-29 22:30:31",
    "created_at": "2011-01-29T22:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111772",
    "user": "@aghitza"
}
```

Attachment [trac_10709.patch](tarball://root/attachments/some-uuid/ticket10709/trac_10709.patch) by @aghitza created at 2011-01-29 22:30:31



---

archive/issue_comments_111773.json:
```json
{
    "body": "Replying to [comment:5 davidloeffler]:\n> According to patchbot the new patch causes a doctest to fail in combinat (something to do with Catalan numbers).\n\nFixed and added a doctest to make sure I don't break it again.",
    "created_at": "2011-01-29T22:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111773",
    "user": "@aghitza"
}
```

Replying to [comment:5 davidloeffler]:
> According to patchbot the new patch causes a doctest to fail in combinat (something to do with Catalan numbers).

Fixed and added a doctest to make sure I don't break it again.



---

archive/issue_comments_111774.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-01-29T22:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111774",
    "user": "@aghitza"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111775.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-30T10:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111775",
    "user": "@loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111776.json:
```json
{
    "body": "Looks fine now.",
    "created_at": "2011-01-30T10:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111776",
    "user": "@loefflerd"
}
```

Looks fine now.



---

archive/issue_comments_111777.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-18T13:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10649#issuecomment-111777",
    "user": "@jdemeyer"
}
```

Resolution: fixed
