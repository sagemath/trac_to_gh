# Issue 10987: Symbolic Ring is_integral_domain() throws exception

archive/issues_010987.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  rws\n\nKeywords: symbolics matrix\n\nThe symbolic ring (SR) in sage is considered a field:\n\n\n```\n  sage: SR.is_field()\n  True\n```\n\nbut it is not considered an integer domain:\n\n\n```\n  sage: SR.is_integer_domain()\n  NotImplementedError                       Traceback (most recent call last)\n\n/***/sage-4.6.2-linux-32bit-ubuntu_10.04_lts-i686-Linux-i686-Linux/<ipython console> in <module>()\n\n/***/sage-4.6.2-linux-32bit-ubuntu_10.04_lts-i686-Linux-i686-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_right (sage/matrix/matrix2.c:3387)()\n\n/***/sage-4.6.2-linux-32bit-ubuntu_10.04_lts-i686-Linux-i686-Linux/local/lib/python2.6/site-packages/sage/rings/ring.so in sage.rings.ring.Ring.is_integral_domain (sage/rings/ring.c:6035)()\n\nNotImplementedError:\n```\n\nHowever, functions like matrix's **solve_right()** (correctly) test for the ring being integral domain before testing for the ring being a field. Thus, matrices with symbolic entries fail with an exception when trying to use **solve_right()** and related functions.\n\nThis behavior was introduced by ticket #10481 where they (correctly) changed the behavior of **is_integral_domain() **of a ring to raise an exception instead of returning it.\n\nThe problems is that **SR** does not override **is_integral_domain() **correctly. I propose the addition of the following function to sage/symbolic/rings.pyx\n\n\n```python\n    def is_integral_domain(self, proof = True):\n        \"\"\"\n        Returns True, since the symbolic expression ring is reported as a\n        field.\n        \n        EXAMPLES::\n        \n            sage: SR.is_integral_domain()\n            True\n        \"\"\"\n        return True\n```\n\n\nWhat do you think?\n\nIssue created by migration from https://trac.sagemath.org/ticket/11126\n\n",
    "created_at": "2011-04-04T17:00:42Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "Symbolic Ring is_integral_domain() throws exception",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10987",
    "user": "duenez"
}
```
Assignee: burcin

CC:  rws

Keywords: symbolics matrix

The symbolic ring (SR) in sage is considered a field:


```
  sage: SR.is_field()
  True
```

but it is not considered an integer domain:


```
  sage: SR.is_integer_domain()
  NotImplementedError                       Traceback (most recent call last)

/***/sage-4.6.2-linux-32bit-ubuntu_10.04_lts-i686-Linux-i686-Linux/<ipython console> in <module>()

/***/sage-4.6.2-linux-32bit-ubuntu_10.04_lts-i686-Linux-i686-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_right (sage/matrix/matrix2.c:3387)()

/***/sage-4.6.2-linux-32bit-ubuntu_10.04_lts-i686-Linux-i686-Linux/local/lib/python2.6/site-packages/sage/rings/ring.so in sage.rings.ring.Ring.is_integral_domain (sage/rings/ring.c:6035)()

NotImplementedError:
```

However, functions like matrix's **solve_right()** (correctly) test for the ring being integral domain before testing for the ring being a field. Thus, matrices with symbolic entries fail with an exception when trying to use **solve_right()** and related functions.

This behavior was introduced by ticket #10481 where they (correctly) changed the behavior of **is_integral_domain() **of a ring to raise an exception instead of returning it.

The problems is that **SR** does not override **is_integral_domain() **correctly. I propose the addition of the following function to sage/symbolic/rings.pyx


```python
    def is_integral_domain(self, proof = True):
        """
        Returns True, since the symbolic expression ring is reported as a
        field.
        
        EXAMPLES::
        
            sage: SR.is_integral_domain()
            True
        """
        return True
```


What do you think?

Issue created by migration from https://trac.sagemath.org/ticket/11126





---

archive/issue_comments_119169.json:
```json
{
    "body": "This seemed to be fixed at some point. Worked for me in `5.5.rc0`.\n\n```\nsage: SR.is_integral_domain()\nTrue\n```\n",
    "created_at": "2012-12-10T22:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119169",
    "user": "tscrim"
}
```

This seemed to be fixed at some point. Worked for me in `5.5.rc0`.

```
sage: SR.is_integral_domain()
True
```




---

archive/issue_comments_119170.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-10T22:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119170",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_119171.json:
```json
{
    "body": "An error is actually the more appropriate thing to return, since the symbolic ring is neither a field nor an integral domain and code that is interested in knowing these things is likely making invalid use of the symbolic ring:\n\n```\nkronecker_delta(x,0)*(1-kronecker_delta(x,0))\n```\n",
    "created_at": "2012-12-10T23:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119171",
    "user": "nbruin"
}
```

An error is actually the more appropriate thing to return, since the symbolic ring is neither a field nor an integral domain and code that is interested in knowing these things is likely making invalid use of the symbolic ring:

```
kronecker_delta(x,0)*(1-kronecker_delta(x,0))
```




---

archive/issue_comments_119172.json:
```json
{
    "body": "The problem with SR not being reported as a field (or integral domain) is that several Linear Algebra methods require this behavior. For example solving a linear system with symbolic variables, eigen-value computation, etc. Or at least that was the original reason why I raised this issue. It might no longer be true.\n\nCheers,\n\nEdgar",
    "created_at": "2012-12-11T14:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119172",
    "user": "duenez"
}
```

The problem with SR not being reported as a field (or integral domain) is that several Linear Algebra methods require this behavior. For example solving a linear system with symbolic variables, eigen-value computation, etc. Or at least that was the original reason why I raised this issue. It might no longer be true.

Cheers,

Edgar



---

archive/issue_comments_119173.json:
```json
{
    "body": "Replying to [comment:3 duenez]:\n> The problem with SR not being reported as a field (or integral domain) is that several Linear Algebra methods require this behavior. For example solving a linear system with symbolic variables, eigen-value computation, etc. Or at least that was the original reason why I raised this issue. It might no longer be true.\n\nI have little doubt it still is. I suspect that one should just be pragmatic with SR and just keep fingers crossed when trying computations with SR. If they succeed: great! The answer might even be correct. If not: formulate the problem in another way.",
    "created_at": "2012-12-11T17:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119173",
    "user": "nbruin"
}
```

Replying to [comment:3 duenez]:
> The problem with SR not being reported as a field (or integral domain) is that several Linear Algebra methods require this behavior. For example solving a linear system with symbolic variables, eigen-value computation, etc. Or at least that was the original reason why I raised this issue. It might no longer be true.

I have little doubt it still is. I suspect that one should just be pragmatic with SR and just keep fingers crossed when trying computations with SR. If they succeed: great! The answer might even be correct. If not: formulate the problem in another way.



---

archive/issue_comments_119174.json:
```json
{
    "body": "I am a bit confused... It seems to me you are suggesting that I should simply accept that sage might refuse to perform symbolic calculations when solving systems of linear equations... or worse yet, perform them and be wrong. Also, I should just deal with it if it doesn't work like I want.\n\nIf this is not what you meant, I apologize, but if it is, I think you are having a very alienating attitude towards your user-base. Sure, one has to be thankful for what one receives for free. I appreciate sage so very much. But to tell me to \"suck it up\" is hardly the way. Is it really that unreasonable to ask for some intelligent discussion about the implementation, definition and use of the symbolic ring?\n\nIf you ask me, you either split symbolics into symbolic group, ring, field, etc., or decide to be as permissive as possible with the operations that you are allowing and shift the responsibility into the user. Ideally you would expose which assumptions were used, or which assumptions should be used when performing a symbolic calculation.\n\nRegards,",
    "created_at": "2012-12-17T10:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119174",
    "user": "duenez"
}
```

I am a bit confused... It seems to me you are suggesting that I should simply accept that sage might refuse to perform symbolic calculations when solving systems of linear equations... or worse yet, perform them and be wrong. Also, I should just deal with it if it doesn't work like I want.

If this is not what you meant, I apologize, but if it is, I think you are having a very alienating attitude towards your user-base. Sure, one has to be thankful for what one receives for free. I appreciate sage so very much. But to tell me to "suck it up" is hardly the way. Is it really that unreasonable to ask for some intelligent discussion about the implementation, definition and use of the symbolic ring?

If you ask me, you either split symbolics into symbolic group, ring, field, etc., or decide to be as permissive as possible with the operations that you are allowing and shift the responsibility into the user. Ideally you would expose which assumptions were used, or which assumptions should be used when performing a symbolic calculation.

Regards,



---

archive/issue_comments_119175.json:
```json
{
    "body": "Replying to [comment:5 duenez]:\n> I am a bit confused... It seems to me you are suggesting that I should simply accept that sage might refuse to perform symbolic calculations when solving systems of linear equations... or worse yet, perform them and be wrong. Also, I should just deal with it if it doesn't work like I want.\n\nWhat I suspect is happening is that linear algebra over SR tries to use generic linear algebra code which wants to know some properties of the ring it's working over in order to know how to proceed (i.e., is it a field? an integral domain?). The symbolic ring doesn't really fit such a rigorous approach and I suspect that most of its benefits stem from that: It's just an algebra of \"expression trees\". If SR were honest, and report it's not a field and not an integral domain, hardly anything would work. There's a benefit to lying and a lot of things WILL sort of work, because zero-divisors are relatively hard to construct. However, they do exist in SR, so I suspect that you can construct linear algebra examples for which a wrong answer is generated, because the code runs into a zero divisor (which was promised to not exist by claiming it's an integral domain).\n\nSR is just trying to be a bit too much to expect a rigorous algebraic approach to apply to it and still end up with something useful. Testing equality in it is known to be undecidable.\n\nI certainly wouldn't want to stand in the way of an intelligent discussion to improve the situation. Great mathematics happens in the face of great problems. I just thought a word of caution to moderate expectations was in order.\n\nA similar thing happens (for different reasons) with the \"numerical\" rings. RR and CC claim to be fields too, but due to the numerical nature of the representation of their elements, they are not. Operations aren't even commutative and any float operations that rely on true equality testing are inherently broken. Linear algebra there is really quite tenuous and we can't rely on the generic approaches at all.\nHow to deal with that is an entire field of mathematics.\n\n(now note that SR in fact contains float arithmetic as well to see that you can't really hope that generic approaches are always safe for SR).",
    "created_at": "2012-12-19T07:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119175",
    "user": "nbruin"
}
```

Replying to [comment:5 duenez]:
> I am a bit confused... It seems to me you are suggesting that I should simply accept that sage might refuse to perform symbolic calculations when solving systems of linear equations... or worse yet, perform them and be wrong. Also, I should just deal with it if it doesn't work like I want.

What I suspect is happening is that linear algebra over SR tries to use generic linear algebra code which wants to know some properties of the ring it's working over in order to know how to proceed (i.e., is it a field? an integral domain?). The symbolic ring doesn't really fit such a rigorous approach and I suspect that most of its benefits stem from that: It's just an algebra of "expression trees". If SR were honest, and report it's not a field and not an integral domain, hardly anything would work. There's a benefit to lying and a lot of things WILL sort of work, because zero-divisors are relatively hard to construct. However, they do exist in SR, so I suspect that you can construct linear algebra examples for which a wrong answer is generated, because the code runs into a zero divisor (which was promised to not exist by claiming it's an integral domain).

SR is just trying to be a bit too much to expect a rigorous algebraic approach to apply to it and still end up with something useful. Testing equality in it is known to be undecidable.

I certainly wouldn't want to stand in the way of an intelligent discussion to improve the situation. Great mathematics happens in the face of great problems. I just thought a word of caution to moderate expectations was in order.

A similar thing happens (for different reasons) with the "numerical" rings. RR and CC claim to be fields too, but due to the numerical nature of the representation of their elements, they are not. Operations aren't even commutative and any float operations that rely on true equality testing are inherently broken. Linear algebra there is really quite tenuous and we can't rely on the generic approaches at all.
How to deal with that is an entire field of mathematics.

(now note that SR in fact contains float arithmetic as well to see that you can't really hope that generic approaches are always safe for SR).



---

archive/issue_comments_119176.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-03-08T14:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119176",
    "user": "knsam"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_119177.json:
```json
{
    "body": "Given the discussion here, I think we should discuss this further and decide. Certainly, it seems to me that this is not sage_invalid. I shall set this to needs_info while we discuss this issue.",
    "created_at": "2013-03-08T14:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119177",
    "user": "knsam"
}
```

Given the discussion here, I think we should discuss this further and decide. Certainly, it seems to me that this is not sage_invalid. I shall set this to needs_info while we discuss this issue.



---

archive/issue_comments_119178.json:
```json
{
    "body": "Hi!\n\nWhy not adding a subset of symbolic Ring which forms a Field?\nI think a good choice would be the subset of all symbolic functions which are\nmeromorphic. \n\nThe Meromorph functions form a field, and contain most of the symbolic functions in use. Additionally this could be handy if we want to introduce differential algebras for symbolic integration and differentiation.",
    "created_at": "2013-12-19T13:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119178",
    "user": "maldun"
}
```

Hi!

Why not adding a subset of symbolic Ring which forms a Field?
I think a good choice would be the subset of all symbolic functions which are
meromorphic. 

The Meromorph functions form a field, and contain most of the symbolic functions in use. Additionally this could be handy if we want to introduce differential algebras for symbolic integration and differentiation.



---

archive/issue_comments_119179.json:
```json
{
    "body": "Changing keywords from \"symbolics matrix\" to \"symbolic ring category\".",
    "created_at": "2015-01-21T09:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119179",
    "user": "pbruin"
}
```

Changing keywords from "symbolics matrix" to "symbolic ring category".



---

archive/issue_comments_119180.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-03-20T14:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119180",
    "user": "pbruin"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_119181.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-03-21T09:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119181",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_119182.json:
```json
{
    "body": "Hello,\n\nI really do not like the strategy. Starting to have special cases for the symbolic ring will be a nightmare to write and maintain. The symbolic ring is definitely an ugly (and very useful) piece of code but it should not be intrusive. Not speaking about the fact that a line like `from sage.symbolic.ring import SymbolicRing` takes time to be executed. The current situtation that makes SR thinks that it is a field looks much more natural to me: keep the bullshit in one place.\n\nAnd do you really think that we should support elliptic curves over the symbolic ring? I saw that there is an example in the doc, but we could just ignore it. From my perspective, `SR` should not even be a ring.\n\nCould you give more motivation of changing the current situation? I do not get it from the ticket description?\n\nVincent",
    "created_at": "2015-03-21T09:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119182",
    "user": "vdelecroix"
}
```

Hello,

I really do not like the strategy. Starting to have special cases for the symbolic ring will be a nightmare to write and maintain. The symbolic ring is definitely an ugly (and very useful) piece of code but it should not be intrusive. Not speaking about the fact that a line like `from sage.symbolic.ring import SymbolicRing` takes time to be executed. The current situtation that makes SR thinks that it is a field looks much more natural to me: keep the bullshit in one place.

And do you really think that we should support elliptic curves over the symbolic ring? I saw that there is an example in the doc, but we could just ignore it. From my perspective, `SR` should not even be a ring.

Could you give more motivation of changing the current situation? I do not get it from the ticket description?

Vincent



---

archive/issue_comments_119183.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-03-23T12:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119183",
    "user": "pbruin"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_119184.json:
```json
{
    "body": "I agree that my patch has to be improved.  However, I think that this can be done without globally pretending that the symbolic ring is a field.",
    "created_at": "2015-03-23T12:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10987#issuecomment-119184",
    "user": "pbruin"
}
```

I agree that my patch has to be improved.  However, I think that this can be done without globally pretending that the symbolic ring is a field.
