# Issue 16193: Small speedup for OA(None,p^c)

archive/issues_016193.json:
```json
{
    "body": "CC:  @videlec\n\nWhen n is a prime power we know from the start the maximum value of k. With a couple of lines, we avoid calling `is_prime_power` n+1 times for nothing.\n\nNathann\n\nA dishonest timing:\n\n```\nsage: %timeit designs.orthogonal_array(None,2**16,t=2,existence=True) # before\n1 loops, best of 3: 1.16 s per loop\nsage: %timeit designs.orthogonal_array(None,2**16,t=2,existence=True) # after\n10000 loops, best of 3: 19.9 \u00b5s per loop\n```\n\n\nThis ticket also fixes a couple of bugs, i.e. `designs.orthogonal_array(None,n,t=30,existence=True)` and `designs.orthogonal_array(None,0,existence=True)`.\n\nNathann\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/16430\n\n",
    "created_at": "2014-06-03T09:40:13Z",
    "labels": [
        "component: combinatorial designs"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Small speedup for OA(None,p^c)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16193",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @videlec

When n is a prime power we know from the start the maximum value of k. With a couple of lines, we avoid calling `is_prime_power` n+1 times for nothing.

Nathann

A dishonest timing:

```
sage: %timeit designs.orthogonal_array(None,2**16,t=2,existence=True) # before
1 loops, best of 3: 1.16 s per loop
sage: %timeit designs.orthogonal_array(None,2**16,t=2,existence=True) # after
10000 loops, best of 3: 19.9 Âµs per loop
```


This ticket also fixes a couple of bugs, i.e. `designs.orthogonal_array(None,n,t=30,existence=True)` and `designs.orthogonal_array(None,0,existence=True)`.

Nathann

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/16430





---

archive/issue_comments_211153.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-03T09:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211153",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211154.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-03T09:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211155.json:
```json
{
    "body": "Hi Nathann,\n\nIf the cache in #16460 is used, then this would not be needed anymore. As if `is_prime_power` is called then we would set the cache directly to `n+1` whatever was the value of `k` from the call.\n\nDo you still want to keep it?\n\nVincent",
    "created_at": "2014-06-09T14:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211155",
    "user": "https://github.com/videlec"
}
```

Hi Nathann,

If the cache in #16460 is used, then this would not be needed anymore. As if `is_prime_power` is called then we would set the cache directly to `n+1` whatever was the value of `k` from the call.

Do you still want to keep it?

Vincent



---

archive/issue_comments_211156.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-09T14:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211156",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211157.json:
```json
{
    "body": "Right right...\n\nNathann",
    "created_at": "2014-06-09T14:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211157",
    "user": "https://github.com/nathanncohen"
}
```

Right right...

Nathann



---

archive/issue_comments_211158.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-09T14:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211158",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_211159.json:
```json
{
    "body": "OOops nononono ! It fixes bugs too !!",
    "created_at": "2014-06-09T14:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211159",
    "user": "https://github.com/nathanncohen"
}
```

OOops nononono ! It fixes bugs too !!



---

archive/issue_comments_211160.json:
```json
{
    "body": "I will update this in a second. First I send you the review of #16461\n\nNathann",
    "created_at": "2014-06-09T14:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211160",
    "user": "https://github.com/nathanncohen"
}
```

I will update this in a second. First I send you the review of #16461

Nathann



---

archive/issue_comments_211161.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-09T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211161",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_211162.json:
```json
{
    "body": "Okay, actually I think that the best is to review this ticket as it is. It also fixes two bugs that need to be fixed anyway, and we will be able to remove those two specific line for prime powers when the caching mechanism will make it in.\n\nNathann",
    "created_at": "2014-06-09T14:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211162",
    "user": "https://github.com/nathanncohen"
}
```

Okay, actually I think that the best is to review this ticket as it is. It also fixes two bugs that need to be fixed anyway, and we will be able to remove those two specific line for prime powers when the caching mechanism will make it in.

Nathann



---

archive/issue_comments_211163.json:
```json
{
    "body": "Hum\n\n```\nsage: designs.orthogonal_array(None,5,t=3,existence=True)\n1\nsage: designs.orthogonal_array(None,5,t=3)\nTraceback (most recent call last):\n...\nValueError: undefined for k less than 2\n```\n\nWhy do you allow `t=3` when `existence` is set to `True`?\n\nVincent",
    "created_at": "2014-06-19T21:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211163",
    "user": "https://github.com/videlec"
}
```

Hum

```
sage: designs.orthogonal_array(None,5,t=3,existence=True)
1
sage: designs.orthogonal_array(None,5,t=3)
Traceback (most recent call last):
...
ValueError: undefined for k less than 2
```

Why do you allow `t=3` when `existence` is set to `True`?

Vincent



---

archive/issue_comments_211164.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-19T21:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211164",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_211165.json:
```json
{
    "body": "Yo !\n\n> Why do you allow `t=3` when `existence` is set to `True`?\n\nWell, we could even return 2. Any two columns would do. Anyway, let's return 0 as we have no code to return the actual OA for the moment.\n\nNathann",
    "created_at": "2014-06-20T08:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211165",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> Why do you allow `t=3` when `existence` is set to `True`?

Well, we could even return 2. Any two columns would do. Anyway, let's return 0 as we have no code to return the actual OA for the moment.

Nathann



---

archive/issue_comments_211166.json:
```json
{
    "body": "Okayyyyyyyyy... I fixed several things, as this ticket seems to be a \"small bugfixes\" dictionary `:-P`\n\n1) More explicit error messages in _check_pbd. This function will be rewritten in Cython later anyway, but this way we will not forget the error messages.\n\n2) We can always build an `OA(1341,0)`, i.e. the empty list\n\n3) There is always an `orthogonal_array(t,n,t=t)`. It is just the result of `[k]^k`\n\n4) I fixed the \"undefined for `t<k` bug you mentionned, but I wondered if there was a reason to have such an exception. I mean, if you want a property to hold \"for any t columns\", it holds in particular when you have <t columns doesn't it ? So I would vote for removing this exception. If you agree with it I will add a commit, while in the updated branch the problem is avoided without touching this line\n\n5) I return an `OA(t,n,t)` directly to avoid calling `is_orthogonal_array`. It is safe because the orthogonal array I return IS an orthogonal array, and I do it because `is_orthogonal_array` does not support t>2 yet. But then, those orthogonal arrays are the only ones we can return with t>2.\n\nNathann",
    "created_at": "2014-06-20T10:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211166",
    "user": "https://github.com/nathanncohen"
}
```

Okayyyyyyyyy... I fixed several things, as this ticket seems to be a "small bugfixes" dictionary `:-P`

1) More explicit error messages in _check_pbd. This function will be rewritten in Cython later anyway, but this way we will not forget the error messages.

2) We can always build an `OA(1341,0)`, i.e. the empty list

3) There is always an `orthogonal_array(t,n,t=t)`. It is just the result of `[k]^k`

4) I fixed the "undefined for `t<k` bug you mentionned, but I wondered if there was a reason to have such an exception. I mean, if you want a property to hold "for any t columns", it holds in particular when you have <t columns doesn't it ? So I would vote for removing this exception. If you agree with it I will add a commit, while in the updated branch the problem is avoided without touching this line

5) I return an `OA(t,n,t)` directly to avoid calling `is_orthogonal_array`. It is safe because the orthogonal array I return IS an orthogonal array, and I do it because `is_orthogonal_array` does not support t>2 yet. But then, those orthogonal arrays are the only ones we can return with t>2.

Nathann



---

archive/issue_comments_211167.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-06-20T10:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211167",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_211168.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-20T10:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211169.json:
```json
{
    "body": "Hi,\n\nEverything looks good. I have micro modifs that makes it look better at u/vdelecroix/16430. If you like it take it. And you can set to positive review whatever you choose.\n\nVincent",
    "created_at": "2014-06-23T15:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211169",
    "user": "https://github.com/videlec"
}
```

Hi,

Everything looks good. I have micro modifs that makes it look better at u/vdelecroix/16430. If you like it take it. And you can set to positive review whatever you choose.

Vincent



---

archive/issue_comments_211170.json:
```json
{
    "body": "Yo !\n\n> Everything looks good. I have micro modifs that makes it look better at u/vdelecroix/16430. If you like it take it. And you can set to positive review whatever you choose.\n\nI find weird that `IntegerRange` only writes two points in `{0, .., 5}`, but okay... Is there any reason for that ? `:-P`\n\n\n```\n     .. SEEALSO::\n\n-        :func:`orthogonal_array` -- a tranversal design `TD(k,n)` is equivalent to an\n         orthogonal array `OA(k,n,2)`.\n```\n\n\nNathann",
    "created_at": "2014-06-23T15:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211170",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> Everything looks good. I have micro modifs that makes it look better at u/vdelecroix/16430. If you like it take it. And you can set to positive review whatever you choose.

I find weird that `IntegerRange` only writes two points in `{0, .., 5}`, but okay... Is there any reason for that ? `:-P`


```
     .. SEEALSO::

-        :func:`orthogonal_array` -- a tranversal design `TD(k,n)` is equivalent to an
         orthogonal array `OA(k,n,2)`.
```


Nathann



---

archive/issue_comments_211171.json:
```json
{
    "body": "Replying to [comment:15 ncohen]:\n> Yo !\n> \n> > Everything looks good. I have micro modifs that makes it look better at u/vdelecroix/16430. If you like it take it. And you can set to positive review whatever you choose.\n> \n> I find weird that `IntegerRange` only writes two points in `{0, .., 5}`, but okay... Is there any reason for that ? `:-P`\n\nMe too. And the reason is to fit with ellipsis:\n\n```\nsage: [1..5]\n[1, 2, 3, 4, 5]\n```\n\n\nVincent",
    "created_at": "2014-06-23T15:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211171",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:15 ncohen]:
> Yo !
> 
> > Everything looks good. I have micro modifs that makes it look better at u/vdelecroix/16430. If you like it take it. And you can set to positive review whatever you choose.
> 
> I find weird that `IntegerRange` only writes two points in `{0, .., 5}`, but okay... Is there any reason for that ? `:-P`

Me too. And the reason is to fit with ellipsis:

```
sage: [1..5]
[1, 2, 3, 4, 5]
```


Vincent



---

archive/issue_comments_211172.json:
```json
{
    "body": "Yo !\n\n> Me too. And the reason is to fit with ellipsis:\n> {{{\n> sage: [1..5]\n> [1, 2, 3, 4, 5]\n> }}}\n\nAnd yet you can't copy/paste the output of this IntegerRange into Sage code, it is not the same syntax ..\n\nWell, if you can write back the line of the SEEALSO that you remove we can set this ticket to positive review. I have to admit that I preferred the writing `[1,...,5]` to `{1, ..,5}` though ...\n\nNathann",
    "created_at": "2014-06-23T15:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211172",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> Me too. And the reason is to fit with ellipsis:
> {{{
> sage: [1..5]
> [1, 2, 3, 4, 5]
> }}}

And yet you can't copy/paste the output of this IntegerRange into Sage code, it is not the same syntax ..

Well, if you can write back the line of the SEEALSO that you remove we can set this ticket to positive review. I have to admit that I preferred the writing `[1,...,5]` to `{1, ..,5}` though ...

Nathann



---

archive/issue_comments_211173.json:
```json
{
    "body": "Replying to [comment:17 ncohen]:\n> Yo !\n> \n> > Me too. And the reason is to fit with ellipsis:\n> > {{{\n> > sage: [1..5]\n> > [1, 2, 3, 4, 5]\n> > }}}\n> \n> And yet you can't copy/paste the output of this IntegerRange into Sage code, it is not the same syntax ..\n> \n> Well, if you can write back the line of the SEEALSO that you remove we can set this ticket to positive review. I have to admit that I preferred the writing `[1,...,5]` to `{1, ..,5}` though ...\n\nBut I did not like the [0, ...,0]. The best thing to do would be to improve `IntegerRange` ;-) Sorry for the SEEALSO this is back.\n\nVincent\n----\nNew commits:",
    "created_at": "2014-06-23T16:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211173",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:17 ncohen]:
> Yo !
> 
> > Me too. And the reason is to fit with ellipsis:
> > {{{
> > sage: [1..5]
> > [1, 2, 3, 4, 5]
> > }}}
> 
> And yet you can't copy/paste the output of this IntegerRange into Sage code, it is not the same syntax ..
> 
> Well, if you can write back the line of the SEEALSO that you remove we can set this ticket to positive review. I have to admit that I preferred the writing `[1,...,5]` to `{1, ..,5}` though ...

But I did not like the [0, ...,0]. The best thing to do would be to improve `IntegerRange` ;-) Sorry for the SEEALSO this is back.

Vincent
----
New commits:



---

archive/issue_comments_211174.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-23T16:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211174",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211175.json:
```json
{
    "body": "Yo !\n\n> But I did not like the [0, ...,0]. The best thing to do would be to improve `IntegerRange` ;-) \n\nLet's do that then.\n\n> Sorry for the SEEALSO this is back.\n\nCool, thanks !\n\nNathann",
    "created_at": "2014-06-23T16:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211175",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> But I did not like the [0, ...,0]. The best thing to do would be to improve `IntegerRange` ;-) 

Let's do that then.

> Sorry for the SEEALSO this is back.

Cool, thanks !

Nathann



---

archive/issue_comments_211176.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-24T00:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16193#issuecomment-211176",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
