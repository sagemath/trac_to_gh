# Issue 29035: doctest in padic_lattice_element.py gives error in current develop branch

Issue created by migration from https://trac.sagemath.org/ticket/29272

Original creator: @SagnikDey92

Original creation time: 2020-03-03 10:15:49

CC:  kedlaya edgarcosta tscrim roed chapoton caruso saraedum dimpase dlucas dkrenn tmonteil jsrn @kliem

This is the error when doctesting in src/sage/rings/padics/padic_lattice_element.py:

```
File "src/sage/rings/padics/padic_lattice_element.py", line 19, in sage.rings.padics.padic_lattice_element
Failed example:
    R = ZpLF(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/rings/padics/padic_lattice_element.py", line 25, in sage.rings.padics.padic_lattice_element
Failed example:
    R = QpLC(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/rings/padics/padic_lattice_element.py", line 31, in sage.rings.padics.padic_lattice_element
Failed example:
    R = QpLF(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   3 of   5 in sage.rings.padics.padic_lattice_element
    [270 tests, 3 failures, 0.61 s]
----------------------------------------------------------------------
sage -t --warn-long 68.1 src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 0.6 seconds
```


Probably requires a simple change in the doctest.


---

Comment by mkoeppe created at 2020-03-22 15:07:14

Changing component from documentation to padics.


---

Comment by mkoeppe created at 2020-03-22 15:07:14

Changing priority from minor to critical.


---

Comment by chapoton created at 2020-03-22 15:13:26

see #20601 for some old related ticket


---

Comment by mkoeppe created at 2020-03-22 16:16:03

Strange that this would only be noticed now?
----
New commits:


---

Comment by mkoeppe created at 2020-03-22 16:16:22

Changing status from new to needs_review.


---

Comment by roed created at 2020-03-22 17:35:59

With this branch, we're getting test failures on the [patchbot](https://patchbot.sagemath.org/log/29272/Darwin/Darwin%20Kernel%20Version%2018.5.0:%20Mon%20Mar%2011%2020:40:32%20PDT%202019;%20root:xnu-4903.251.3~3/RELEASE_X86_64/x86_64/18.5.0/steenrod/2020-03-22%2017:00:26?short) where the FutureWarnings appear, so we clearly can't just remove them.  I'm not sure why they appear sometime and not other times....


---

Comment by roed created at 2020-03-22 17:35:59

Changing status from needs_review to needs_info.


---

Comment by mkoeppe created at 2020-03-24 17:48:12

Are the doctests in one block like this parallelized?


---

Comment by roed created at 2020-03-24 18:44:12

No, they should be run in series since they're within one block.


---

Comment by roed created at 2020-03-24 18:46:36

Another solution (that I should check with Xavier and Julian about) is to remove the experimental designation.  We haven't worked on the lattice precision interface for a while, so maybe we should just think about what interface changes we want to make, make them, and then remove these warnings.

We've got a work week planned in mid April where we could look into this.


---

Comment by dimpase created at 2020-03-25 01:53:45

Replying to [comment:6 roed]:
> With this branch, we're getting test failures on the [patchbot](https://patchbot.sagemath.org/log/29272/Darwin/Darwin%20Kernel%20Version%2018.5.0:%20Mon%20Mar%2011%2020:40:32%20PDT%202019;%20root:xnu-4903.251.3~3/RELEASE_X86_64/x86_64/18.5.0/steenrod/2020-03-22%2017:00:26?short) where the FutureWarnings appear, so we clearly can't just remove them.  I'm not sure why they appear sometime and not other times....

what is so special about this bot?
These test errors are happening most everywhere, I believe I wrote about it on some of your tickets, without any replies


---

Comment by @mwageringel created at 2020-03-31 16:39:10

Changing status from needs_info to needs_review.


---

Comment by @mwageringel created at 2020-03-31 16:39:10

This issue does not occur when running the long tests, but only when running the short tests, so this is not a problem on the patchbots. This might be a weird interaction between the doctest framework filtering duplicate warnings and the `experimental` decorator trying to avoid duplicate warnings.

This problem can be solved by reordering the doctests, so that the long test cases are executed after the short ones. Here is a branch that does this.
----
New commits:


---

Comment by @kliem created at 2020-03-31 17:28:37

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-03-31 17:28:37

LGTM.

(Lowering the stacklevel to 3 would have worked as well, but this is so much simpler).


---

Comment by vbraun created at 2020-04-09 22:45:09

Resolution: fixed
