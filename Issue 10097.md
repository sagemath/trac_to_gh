# Issue 10097: Flaky doctest in

archive/issues_010097.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  boothby drkirkby @malb mariah simonking @vbraun @williamstein\n\nWith #10004 merged into 4.6.alpha3, I get the doctest failures\n{{{#!\nsage -t -long  -force_lib devel/sage/sage/interfaces/expect.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/devel/sage-main/sage/interfaces/expect.py\", line 596:\n    sage: L = [t[1] for t in f(range(5))]\nExpected nothing\nGot:\n    [Errno 16] Device or resource busy: '/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/.sage/temp/cleo/32313/dir_0/.nfs00000000007d541a0000abe9'\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/devel/sage-main/sage/interfaces/expect.py\", line 603:\n    sage: L = [t[1] for t in f(range(5))]\nExpected nothing\nGot:\n    [Errno 16] Device or resource busy: '/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/.sage/temp/cleo/32313/dir_1/.nfs00000000007d541a0000abf1'\n```\n\non the Skynet machines cleo, eno, fulvia, and sextus.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10098\n\n",
    "created_at": "2010-10-07T22:09:38Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "Flaky doctest in",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10097",
    "user": "https://github.com/qed777"
}
```
Assignee: mvngu

CC:  boothby drkirkby @malb mariah simonking @vbraun @williamstein

With #10004 merged into 4.6.alpha3, I get the doctest failures
{{{#!
sage -t -long  -force_lib devel/sage/sage/interfaces/expect.py
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/devel/sage-main/sage/interfaces/expect.py", line 596:
    sage: L = [t[1] for t in f(range(5))]
Expected nothing
Got:
    [Errno 16] Device or resource busy: '/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/.sage/temp/cleo/32313/dir_0/.nfs00000000007d541a0000abe9'
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/devel/sage-main/sage/interfaces/expect.py", line 603:
    sage: L = [t[1] for t in f(range(5))]
Expected nothing
Got:
    [Errno 16] Device or resource busy: '/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.6.alpha3/.sage/temp/cleo/32313/dir_1/.nfs00000000007d541a0000abf1'
```

on the Skynet machines cleo, eno, fulvia, and sextus.

Issue created by migration from https://trac.sagemath.org/ticket/10098





---

archive/issue_comments_101722.json:
```json
{
    "body": "This is reminiscent of #9501 / #9616.  Since the fix at #10004 works (right?), maybe we should tag these tests as \"not tested\" instead of reverting the patch?  Or is there another way?",
    "created_at": "2010-10-07T22:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101722",
    "user": "https://github.com/qed777"
}
```

This is reminiscent of #9501 / #9616.  Since the fix at #10004 works (right?), maybe we should tag these tests as "not tested" instead of reverting the patch?  Or is there another way?



---

archive/issue_comments_101723.json:
```json
{
    "body": "Replying to [comment:1 mpatel]:\n> This is reminiscent of #9501 / #9616.  Since the fix at #10004 works (right?),\n\nI hope so...\n\n> maybe we should tag these tests as \"not tested\" instead of reverting the patch?  Or is there another way?\n\nWhat doees \"device busy\" exactly mean? Can one trac this down? Actually the purpose of #10004 was to avoid conflicts (race conditions) on the hard disk.",
    "created_at": "2010-10-07T23:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101723",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:1 mpatel]:
> This is reminiscent of #9501 / #9616.  Since the fix at #10004 works (right?),

I hope so...

> maybe we should tag these tests as "not tested" instead of reverting the patch?  Or is there another way?

What doees "device busy" exactly mean? Can one trac this down? Actually the purpose of #10004 was to avoid conflicts (race conditions) on the hard disk.



---

archive/issue_comments_101724.json:
```json
{
    "body": "I think this is a filesystem quirk (a problem?), but I'm not sure.  David, Mariah, and Volker, any thoughts?",
    "created_at": "2010-10-09T08:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101724",
    "user": "https://github.com/qed777"
}
```

I think this is a filesystem quirk (a problem?), but I'm not sure.  David, Mariah, and Volker, any thoughts?



---

archive/issue_comments_101725.json:
```json
{
    "body": "Did that appear at the same time as the \"sync\" was removed from NFS? Or did we upgrade the `expect` python module?\n\nI think something is tripping over the following fact: In UNIX, you can open a file, then delete it, then delete the containing directory. The file is still open for business until you close it. But NFS doesn't have inodes, so if you delete an open file the NFS volume will contain a fake directory entry `.nfs00000000007d541a0000abf1` that only disappears when you close the file. I guess that the  \"Device or resource busy\" error is from trying to delete the non-empty directory. Either because the open file descriptor was leaked or because of some concurrency issue with NFS.",
    "created_at": "2010-10-09T09:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101725",
    "user": "https://github.com/vbraun"
}
```

Did that appear at the same time as the "sync" was removed from NFS? Or did we upgrade the `expect` python module?

I think something is tripping over the following fact: In UNIX, you can open a file, then delete it, then delete the containing directory. The file is still open for business until you close it. But NFS doesn't have inodes, so if you delete an open file the NFS volume will contain a fake directory entry `.nfs00000000007d541a0000abf1` that only disappears when you close the file. I guess that the  "Device or resource busy" error is from trying to delete the non-empty directory. Either because the open file descriptor was leaked or because of some concurrency issue with NFS.



---

archive/issue_comments_101726.json:
```json
{
    "body": "Replying to [comment:3 mpatel]:\n> I think this is a filesystem quirk (a problem?), but I'm not sure.  David, Mariah, and Volker, any thoughts?\n\nI tend to agree in this case - it looks like file systems issues. \n\nHowever, I've seen problems with the pexpect interface on systems which use local file systems. I'm not convinced it is a very reliable tool myself. \n\nI made a point on sage-devel half an hour or so ago, but I'll make it briefly here. The SQlite developers take testing very seriously \n\nhttp://www.sqlite.org/testing.html \n\nTheir test code is more than 600 times as big as code in the SQlite database!\n\nThey advise against the use of NFS as fcntl() file locking is broken on many NFS implementations.\n\nhttp://www.sqlite.org/faq.html#q5\n\nMy own money would be that if a Sun running Solaris was serving another Sun running Solaris, it would work! But perhaps I'm biased - I tend to trust Solaris more than random collections of Linux. (Of course, when William disabled the ZIL log on a ZFS file system on disk.math to improve performance, all bets were off. That is well documented to be a bad policy, and should never be used except for test purposes). \n\nDave",
    "created_at": "2010-10-09T11:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101726",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Replying to [comment:3 mpatel]:
> I think this is a filesystem quirk (a problem?), but I'm not sure.  David, Mariah, and Volker, any thoughts?

I tend to agree in this case - it looks like file systems issues. 

However, I've seen problems with the pexpect interface on systems which use local file systems. I'm not convinced it is a very reliable tool myself. 

I made a point on sage-devel half an hour or so ago, but I'll make it briefly here. The SQlite developers take testing very seriously 

http://www.sqlite.org/testing.html 

Their test code is more than 600 times as big as code in the SQlite database!

They advise against the use of NFS as fcntl() file locking is broken on many NFS implementations.

http://www.sqlite.org/faq.html#q5

My own money would be that if a Sun running Solaris was serving another Sun running Solaris, it would work! But perhaps I'm biased - I tend to trust Solaris more than random collections of Linux. (Of course, when William disabled the ZIL log on a ZFS file system on disk.math to improve performance, all bets were off. That is well documented to be a bad policy, and should never be used except for test purposes). 

Dave



---

archive/issue_comments_101727.json:
```json
{
    "body": "Replying to [comment:4 vbraun]:\n> Did that appear at the same time as the \"sync\" was removed from NFS? Or did we upgrade the `expect` python module?\n\nAs far as I'm aware, the Skynet cluster is administered independently (by Mariah Lenox) from the Sage cluster.  I don't know whether Mariah has made any recent changes to Skynet's NFS configuration.\n\nWe made some changes to `sage.interfaces.expect` at #10004.\n\n> I think something is tripping over the following fact: In UNIX, you can open a file, then delete it, then delete the containing directory. The file is still open for business until you close it. But NFS doesn't have inodes, so if you delete an open file the NFS volume will contain a fake directory entry `.nfs00000000007d541a0000abf1` that only disappears when you close the file. I guess that the  \"Device or resource busy\" error is from trying to delete the non-empty directory. Either because the open file descriptor was leaked or because of some concurrency issue with NFS.\n\nThanks!  I've tried to make an example:\n\n```python\nsage: import os\nsage: os.mkdir('dir')\nsage: f = open('dir/foo', 'w')\nsage: os.listdir('dir')\n['foo']\nsage: # Now 'rm dir/foo' in a separate window.\nsage: sage: os.listdir('dir')\n['.nfs000000000143f92500013636']\nsage:  os.unlink('dir/.nfs000000000143f92500013636')\n---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n\n/home/mpatel/<ipython console> in <module>()\n\nOSError: [Errno 16] Device or resource busy: 'dir/.nfs000000000143f92500013636'\nsage: os.rmdir('dir')\n---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n\n/home/mpatel/<ipython console> in <module>()\n\nOSError: [Errno 39] Directory not empty: 'dir'\nsage: f.close()\nsage: os.rmdir('dir')\nsage: \n```\n\n\nFor the problem in the description, I suppose Sage tries to empty a temporary directory.  What if we wrap that in a `try-except` block?",
    "created_at": "2010-10-10T08:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101727",
    "user": "https://github.com/qed777"
}
```

Replying to [comment:4 vbraun]:
> Did that appear at the same time as the "sync" was removed from NFS? Or did we upgrade the `expect` python module?

As far as I'm aware, the Skynet cluster is administered independently (by Mariah Lenox) from the Sage cluster.  I don't know whether Mariah has made any recent changes to Skynet's NFS configuration.

We made some changes to `sage.interfaces.expect` at #10004.

> I think something is tripping over the following fact: In UNIX, you can open a file, then delete it, then delete the containing directory. The file is still open for business until you close it. But NFS doesn't have inodes, so if you delete an open file the NFS volume will contain a fake directory entry `.nfs00000000007d541a0000abf1` that only disappears when you close the file. I guess that the  "Device or resource busy" error is from trying to delete the non-empty directory. Either because the open file descriptor was leaked or because of some concurrency issue with NFS.

Thanks!  I've tried to make an example:

```python
sage: import os
sage: os.mkdir('dir')
sage: f = open('dir/foo', 'w')
sage: os.listdir('dir')
['foo']
sage: # Now 'rm dir/foo' in a separate window.
sage: sage: os.listdir('dir')
['.nfs000000000143f92500013636']
sage:  os.unlink('dir/.nfs000000000143f92500013636')
---------------------------------------------------------------------------
OSError                                   Traceback (most recent call last)

/home/mpatel/<ipython console> in <module>()

OSError: [Errno 16] Device or resource busy: 'dir/.nfs000000000143f92500013636'
sage: os.rmdir('dir')
---------------------------------------------------------------------------
OSError                                   Traceback (most recent call last)

/home/mpatel/<ipython console> in <module>()

OSError: [Errno 39] Directory not empty: 'dir'
sage: f.close()
sage: os.rmdir('dir')
sage: 
```


For the problem in the description, I suppose Sage tries to empty a temporary directory.  What if we wrap that in a `try-except` block?



---

archive/issue_comments_101728.json:
```json
{
    "body": "Replying to [comment:6 mpatel]:\n\n> As far as I'm aware, the Skynet cluster is administered independently (by Mariah Lenox) from the Sage cluster.  I don't know whether Mariah has made any recent changes to Skynet's NFS configuration.\n\nThinking about it, Skynet was made unavailable a few days ago for scheduled maintenance, so some changes have been made there.",
    "created_at": "2010-10-10T08:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101728",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Replying to [comment:6 mpatel]:

> As far as I'm aware, the Skynet cluster is administered independently (by Mariah Lenox) from the Sage cluster.  I don't know whether Mariah has made any recent changes to Skynet's NFS configuration.

Thinking about it, Skynet was made unavailable a few days ago for scheduled maintenance, so some changes have been made there.



---

archive/issue_comments_101729.json:
```json
{
    "body": "I think this shows the value of a suggestion I've made before on other ticket(s).\n\nIf we knew the exact date/time of the tests (pass or fail), we could look at the logs on the machine and see if there was a problem. Problems with NFS are often logged - I've seen them logged on t2.math, when William had disabled the ZIL. We can even tie them up with user name - here's a few errors logged for both Simon and John. \n\n\n```\nSep 12 09:05:40 t2 nfs: [ID 814820 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]Lost OP_CLOSE request for fs /home, file ./palmieri/.sage-t2/temp/t2/23760/qsieve_0/lprels.1005.23843 (rn\node_pt: 0x30009d028d8), dir <null string> (0x0) for server disk\nSep 12 09:05:40 t2 nfs: [ID 581112 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Starting recovery for mount /home (mi 0x60040c42000 mi_recovflags [0x40]) on server disk, rnode_pt1 .\n/palmieri/.sage-t2/temp/t2/23760/qsieve_0/lprels.1005.23843 (0x30009d028d8), rnode_pt2 <null string> (0x0)\nSep 12 09:05:40 t2 nfs: [ID 273629 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Recovery done for mount /home (mi 0x60040c42000) on server disk, rnode_pt1 ./palmieri/.sage-t2/temp/t\n2/23760/qsieve_0/lprels.1005.23843 (0x30009d028d8), rnode_pt2 <null string> (0x0)\nSep 12 09:05:40 t2 nfs: [ID 220977 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS op OP_CLOSE got error 4 causing recovery action NR_LOST_STATE_RQST.\nSep 12 09:05:40 t2 nfs: [ID 814820 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]Lost OP_CLOSE request for fs /home, file ./palmieri/.sage-t2/ipython/history-sage (rnode_pt: 0x300375c68f\n0), dir <null string> (0x0) for server disk\nSep 12 09:05:40 t2 nfs: [ID 581112 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Starting recovery for mount /home (mi 0x60040c42000 mi_recovflags [0x40]) on server disk, rnode_pt1 .\n/palmieri/.sage-t2/ipython/history-sage (0x300375c68f0), rnode_pt2 <null string> (0x0)\nSep 12 09:05:40 t2 nfs: [ID 273629 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Recovery done for mount /home (mi 0x60040c42000) on server disk, rnode_pt1 ./palmieri/.sage-t2/ipytho\nn/history-sage (0x300375c68f0), rnode_pt2 <null string> (0x0)\nSep 12 09:05:40 t2 nfs: [ID 236337 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS op OP_CLOSE got error NFS4ERR_STALE causing recovery action NR_STALE.\nSep 12 09:05:40 t2 nfs: [ID 286389 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]File ./SimonKing/.sage/temp/t2/13276/dir_2/.nfsD44308 (rnode_pt: 3000da37bd8) was closed due to NFS recov\nery error on server disk(failed to recover from NFS4ERR_STALE NFS4ERR_STALE)\n```\n\n\nIf the doc tests had the exact times, it would go some way to helping determine if the system detected a problem.",
    "created_at": "2010-10-10T09:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101729",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

I think this shows the value of a suggestion I've made before on other ticket(s).

If we knew the exact date/time of the tests (pass or fail), we could look at the logs on the machine and see if there was a problem. Problems with NFS are often logged - I've seen them logged on t2.math, when William had disabled the ZIL. We can even tie them up with user name - here's a few errors logged for both Simon and John. 


```
Sep 12 09:05:40 t2 nfs: [ID 814820 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]Lost OP_CLOSE request for fs /home, file ./palmieri/.sage-t2/temp/t2/23760/qsieve_0/lprels.1005.23843 (rn
ode_pt: 0x30009d028d8), dir <null string> (0x0) for server disk
Sep 12 09:05:40 t2 nfs: [ID 581112 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Starting recovery for mount /home (mi 0x60040c42000 mi_recovflags [0x40]) on server disk, rnode_pt1 .
/palmieri/.sage-t2/temp/t2/23760/qsieve_0/lprels.1005.23843 (0x30009d028d8), rnode_pt2 <null string> (0x0)
Sep 12 09:05:40 t2 nfs: [ID 273629 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Recovery done for mount /home (mi 0x60040c42000) on server disk, rnode_pt1 ./palmieri/.sage-t2/temp/t
2/23760/qsieve_0/lprels.1005.23843 (0x30009d028d8), rnode_pt2 <null string> (0x0)
Sep 12 09:05:40 t2 nfs: [ID 220977 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS op OP_CLOSE got error 4 causing recovery action NR_LOST_STATE_RQST.
Sep 12 09:05:40 t2 nfs: [ID 814820 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]Lost OP_CLOSE request for fs /home, file ./palmieri/.sage-t2/ipython/history-sage (rnode_pt: 0x300375c68f
0), dir <null string> (0x0) for server disk
Sep 12 09:05:40 t2 nfs: [ID 581112 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Starting recovery for mount /home (mi 0x60040c42000 mi_recovflags [0x40]) on server disk, rnode_pt1 .
/palmieri/.sage-t2/ipython/history-sage (0x300375c68f0), rnode_pt2 <null string> (0x0)
Sep 12 09:05:40 t2 nfs: [ID 273629 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS Recovery done for mount /home (mi 0x60040c42000) on server disk, rnode_pt1 ./palmieri/.sage-t2/ipytho
n/history-sage (0x300375c68f0), rnode_pt2 <null string> (0x0)
Sep 12 09:05:40 t2 nfs: [ID 236337 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]NFS op OP_CLOSE got error NFS4ERR_STALE causing recovery action NR_STALE.
Sep 12 09:05:40 t2 nfs: [ID 286389 kern.info] NOTICE: [NFS4][Server: disk][Mntpt: /home]File ./SimonKing/.sage/temp/t2/13276/dir_2/.nfsD44308 (rnode_pt: 3000da37bd8) was closed due to NFS recov
ery error on server disk(failed to recover from NFS4ERR_STALE NFS4ERR_STALE)
```


If the doc tests had the exact times, it would go some way to helping determine if the system detected a problem.



---

archive/issue_comments_101730.json:
```json
{
    "body": "Replying to [comment:6 mpatel]:\n> For the problem in the description, I suppose Sage tries to empty a temporary directory.  What if we wrap that in a `try-except` block?\n\nIt's already wrapped in a such block.  From near the end of `sage.parallel.use_fork.p_iter_fork.__call__`:\n\n```python\n       finally:\n\n            # Clean up all temporary files.                                     \n            try:\n                for X in os.listdir(dir):\n                    os.unlink(os.path.join(dir, X))\n                os.rmdir(dir)\n            except OSError, msg:\n                if self.verbose:\n                    print msg\n```\n\n\nChanging the doctest to\n\n```python\n@parallel(verbose=False)\ndef f(n):\n    return gap._local_tmpfile()\n\nL = [t[1] for t in f(range(5))]\nlen(set(L))\n```\n\nshould \"fix\" the problem.  This example is not intended to test `use_fork`, which has it's own tests, so we could justify doing this here.",
    "created_at": "2010-10-10T09:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101730",
    "user": "https://github.com/qed777"
}
```

Replying to [comment:6 mpatel]:
> For the problem in the description, I suppose Sage tries to empty a temporary directory.  What if we wrap that in a `try-except` block?

It's already wrapped in a such block.  From near the end of `sage.parallel.use_fork.p_iter_fork.__call__`:

```python
       finally:

            # Clean up all temporary files.                                     
            try:
                for X in os.listdir(dir):
                    os.unlink(os.path.join(dir, X))
                os.rmdir(dir)
            except OSError, msg:
                if self.verbose:
                    print msg
```


Changing the doctest to

```python
@parallel(verbose=False)
def f(n):
    return gap._local_tmpfile()

L = [t[1] for t in f(range(5))]
len(set(L))
```

should "fix" the problem.  This example is not intended to test `use_fork`, which has it's own tests, so we could justify doing this here.



---

archive/issue_comments_101731.json:
```json
{
    "body": "Or, perhaps, we could optionally re-`raise` in `__call__` (see the previous comment) and wrap `L = [t[1] for t in f(range(5))]` in a `try-except` block.  We'd just `pass` if the exception is of the form in the description.  This might also help with the very similar problem at #9501, #9616, and #9631.",
    "created_at": "2010-10-10T09:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101731",
    "user": "https://github.com/qed777"
}
```

Or, perhaps, we could optionally re-`raise` in `__call__` (see the previous comment) and wrap `L = [t[1] for t in f(range(5))]` in a `try-except` block.  We'd just `pass` if the exception is of the form in the description.  This might also help with the very similar problem at #9501, #9616, and #9631.



---

archive/issue_comments_101732.json:
```json
{
    "body": "The only use of `verbose` is to print something in case of a timeout and if the temp files could not be cleaned up. The former is pretty much intentional (you have to set a timeout), the latter is a fact of life on some OS/filesystem combinations. I think we should just change the default to `verbose=False`.",
    "created_at": "2010-10-10T10:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101732",
    "user": "https://github.com/vbraun"
}
```

The only use of `verbose` is to print something in case of a timeout and if the temp files could not be cleaned up. The former is pretty much intentional (you have to set a timeout), the latter is a fact of life on some OS/filesystem combinations. I think we should just change the default to `verbose=False`.



---

archive/issue_comments_101733.json:
```json
{
    "body": "Replying to [comment:11 vbraun]:\n> The only use of `verbose` is to print something in case of a timeout and if the temp files could not be cleaned up. The former is pretty much intentional (you have to set a timeout), the latter is a fact of life on some OS/filesystem combinations. I think we should just change the default to `verbose=False`.\n\nUsers of forking ``@`parallel` could activate the potentially useful timeout messages with `verbose=True`.  If they didn't do this, they'd still learn about timeouts from the results, although not until all subprocesses had ended or been killed.  Is this OK?  I don't use `@`parallel very often.",
    "created_at": "2010-10-12T00:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101733",
    "user": "https://github.com/qed777"
}
```

Replying to [comment:11 vbraun]:
> The only use of `verbose` is to print something in case of a timeout and if the temp files could not be cleaned up. The former is pretty much intentional (you have to set a timeout), the latter is a fact of life on some OS/filesystem combinations. I think we should just change the default to `verbose=False`.

Users of forking ``@`parallel` could activate the potentially useful timeout messages with `verbose=True`.  If they didn't do this, they'd still learn about timeouts from the results, although not until all subprocesses had ended or been killed.  Is this OK?  I don't use `@`parallel very often.



---

archive/issue_comments_101734.json:
```json
{
    "body": "Use `verbose=False` by default for forking ``@`parallel`.",
    "created_at": "2010-10-12T01:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101734",
    "user": "https://github.com/qed777"
}
```

Use `verbose=False` by default for forking ``@`parallel`.



---

archive/issue_comments_101735.json:
```json
{
    "body": "Attachment [trac_10098-use_fork_verbose.patch](tarball://root/attachments/some-uuid/ticket10098/trac_10098-use_fork_verbose.patch) by @qed777 created at 2010-10-12 01:08:58\n\nI've added a patch using Volker's suggestion.",
    "created_at": "2010-10-12T01:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101735",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_10098-use_fork_verbose.patch](tarball://root/attachments/some-uuid/ticket10098/trac_10098-use_fork_verbose.patch) by @qed777 created at 2010-10-12 01:08:58

I've added a patch using Volker's suggestion.



---

archive/issue_comments_101736.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-12T01:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101736",
    "user": "https://github.com/qed777"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_101737.json:
```json
{
    "body": "Hi, did you CC me because you need a reviewer? Or is there a particular question I should answer?",
    "created_at": "2010-10-12T12:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101737",
    "user": "https://github.com/malb"
}
```

Hi, did you CC me because you need a reviewer? Or is there a particular question I should answer?



---

archive/issue_comments_101738.json:
```json
{
    "body": "Replying to [comment:17 malb]:\n> Hi, did you CC me because you need a reviewer? Or is there a particular question I should answer?\n\nOops. I should have added a comment like this:\n\nMartin, Simon, Tom, and William, do you have any objections to changing the `verbose` parameter of the forking ``@`parallel` decorator to default to `False`?  The patch above does this, but I'm not sure if it's OK to some of the potential heavy users of the decorator (see [comment:12 this comment]).  With the patch, we'll suppress the NFS-related doctest messages in the description.\n\nAlternatively, we could use ``@`parallel(verbose=False)` in individual doctests.",
    "created_at": "2010-10-12T22:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101738",
    "user": "https://github.com/qed777"
}
```

Replying to [comment:17 malb]:
> Hi, did you CC me because you need a reviewer? Or is there a particular question I should answer?

Oops. I should have added a comment like this:

Martin, Simon, Tom, and William, do you have any objections to changing the `verbose` parameter of the forking ``@`parallel` decorator to default to `False`?  The patch above does this, but I'm not sure if it's OK to some of the potential heavy users of the decorator (see [comment:12 this comment]).  With the patch, we'll suppress the NFS-related doctest messages in the description.

Alternatively, we could use ``@`parallel(verbose=False)` in individual doctests.



---

archive/issue_comments_101739.json:
```json
{
    "body": "We can use a similar workaround at #9501/#9616/#9631, if we add a `verbose` parameter to `fork` and propagate its value to `Parallel`.",
    "created_at": "2010-10-13T01:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101739",
    "user": "https://github.com/qed777"
}
```

We can use a similar workaround at #9501/#9616/#9631, if we add a `verbose` parameter to `fork` and propagate its value to `Parallel`.



---

archive/issue_comments_101740.json:
```json
{
    "body": "Replying to [comment:18 mpatel]:\n> Martin, Simon, Tom, and William, do you have any objections to changing the `verbose` parameter of the forking ``@`parallel` decorator to default to `False`?  The patch above does this, but I'm not sure if it's OK to some of the potential heavy users of the decorator (see [comment:12 this comment]).  With the patch, we'll suppress the NFS-related doctest messages in the description.\n> \n> Alternatively, we could use ``@`parallel(verbose=False)` in individual doctests.\n\nI think something like \"verbose\" should not be default. A warning about a device being busy is not necessary from my point of view if the program is designed to deal with that problem (so that the \"problem\" is in fact no problem).",
    "created_at": "2010-10-13T07:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101740",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:18 mpatel]:
> Martin, Simon, Tom, and William, do you have any objections to changing the `verbose` parameter of the forking ``@`parallel` decorator to default to `False`?  The patch above does this, but I'm not sure if it's OK to some of the potential heavy users of the decorator (see [comment:12 this comment]).  With the patch, we'll suppress the NFS-related doctest messages in the description.
> 
> Alternatively, we could use ``@`parallel(verbose=False)` in individual doctests.

I think something like "verbose" should not be default. A warning about a device being busy is not necessary from my point of view if the program is designed to deal with that problem (so that the "problem" is in fact no problem).



---

archive/issue_comments_101741.json:
```json
{
    "body": "Replying to [comment:18 mpatel]:\n> Martin, Simon, Tom, and William, do you have any objections to changing the `verbose` parameter of the forking ``@`parallel` decorator to default to `False`?  \n\nThat is fine with me (I'm actually not a heavy user of the decorator :))",
    "created_at": "2010-10-13T12:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101741",
    "user": "https://github.com/malb"
}
```

Replying to [comment:18 mpatel]:
> Martin, Simon, Tom, and William, do you have any objections to changing the `verbose` parameter of the forking ``@`parallel` decorator to default to `False`?  

That is fine with me (I'm actually not a heavy user of the decorator :))



---

archive/issue_comments_101742.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-10-17T01:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101742",
    "user": "https://github.com/qed777"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_101743.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-10-21T08:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10097#issuecomment-101743",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed
