# Issue 28095: dot2tex fails self-tests

Issue created by migration from https://trac.sagemath.org/ticket/28332

Original creator: tmonteil

Original creation time: 2019-08-08 05:38:00

CC:  tscrim

Probably due to #27684, dot2tex fails to pass self-tests, both on 32 and 64 bits archs, `sage -f -c dot2tex` leads to:


```
[dot2tex-2.11.3.p0] Running the test suite for dot2tex-2.11.3.p0...
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] spkg-check: Running test_dot2tex.py...
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] ...............EE....EE..................................
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_head_label_pstricks (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 412, in test_head_label_pstricks
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks")
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_head_label_pstricks_duplicate (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 436, in test_head_label_pstricks_duplicate
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks", duplicate=True)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_tail_label_pstricks (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 424, in test_tail_label_pstricks
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks")
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_tail_label_pstricks_duplicate (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 448, in test_tail_label_pstricks_duplicate
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks", duplicate=True)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Ran 57 tests in 5.814s
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] FAILED (errors=4)
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] spkg-check: Running test_dotparsing.py...
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] ................
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Ran 16 tests in 0.001s
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] OK
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] Error(s) running dot2tex's test suite.
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] real	0m5.918s
[dot2tex-2.11.3.p0] user	0m5.581s
[dot2tex-2.11.3.p0] sys	0m0.347s
[dot2tex-2.11.3.p0] ************************************************************************
[dot2tex-2.11.3.p0] Error testing package dot2tex-2.11.3.p0
[dot2tex-2.11.3.p0] ************************************************************************
```





---

Comment by tmonteil created at 2019-08-08 05:53:11

OK, pstricks is a new depedency of dot2tex self-tests.


---

Comment by tmonteil created at 2019-08-08 05:53:11

Changing keywords from "" to "sdl".


---

Comment by tmonteil created at 2019-08-08 05:54:49

New commits:


---

Comment by tmonteil created at 2019-08-08 05:54:49

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-08-08 06:04:49

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-08-08 06:04:49

Okay, that would explain why I remember it passing all of its tests when I upgraded the spkg. I have a full texlive install on my computer because I need it for writing my papers. Thank you for figuring out what changed.


---

Comment by vbraun created at 2019-08-10 13:08:37

Resolution: fixed
