# Issue 28095: dot2tex fails self-tests

archive/issues_028095.json:
```json
{
    "body": "CC:  @tscrim\n\nProbably due to #27684, dot2tex fails to pass self-tests, both on 32 and 64 bits archs, `sage -f -c dot2tex` leads to:\n\n\n```\n[dot2tex-2.11.3.p0] Running the test suite for dot2tex-2.11.3.p0...\n[dot2tex-2.11.3.p0] ############################################################\n[dot2tex-2.11.3.p0] spkg-check: Running test_dot2tex.py...\n[dot2tex-2.11.3.p0] ############################################################\n[dot2tex-2.11.3.p0] ...............EE....EE..................................\n[dot2tex-2.11.3.p0] ======================================================================\n[dot2tex-2.11.3.p0] ERROR: test_head_label_pstricks (__main__.HeadAndTailLabelTest)\n[dot2tex-2.11.3.p0] ----------------------------------------------------------------------\n[dot2tex-2.11.3.p0] Traceback (most recent call last):\n[dot2tex-2.11.3.p0]   File \"test_dot2tex.py\", line 412, in test_head_label_pstricks\n[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format=\"pstricks\")\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py\", line 62, in dot2tex\n[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3125, in convert_graph\n[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3075, in main\n[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 800, in convert\n[dot2tex-2.11.3.p0]     return self.do_preview_preproc()\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1062, in do_preview_preproc\n[dot2tex-2.11.3.p0]     sys.exit(1)\n[dot2tex-2.11.3.p0] SystemExit: 1\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] ======================================================================\n[dot2tex-2.11.3.p0] ERROR: test_head_label_pstricks_duplicate (__main__.HeadAndTailLabelTest)\n[dot2tex-2.11.3.p0] ----------------------------------------------------------------------\n[dot2tex-2.11.3.p0] Traceback (most recent call last):\n[dot2tex-2.11.3.p0]   File \"test_dot2tex.py\", line 436, in test_head_label_pstricks_duplicate\n[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format=\"pstricks\", duplicate=True)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py\", line 62, in dot2tex\n[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3125, in convert_graph\n[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3075, in main\n[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 800, in convert\n[dot2tex-2.11.3.p0]     return self.do_preview_preproc()\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1062, in do_preview_preproc\n[dot2tex-2.11.3.p0]     sys.exit(1)\n[dot2tex-2.11.3.p0] SystemExit: 1\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] ======================================================================\n[dot2tex-2.11.3.p0] ERROR: test_tail_label_pstricks (__main__.HeadAndTailLabelTest)\n[dot2tex-2.11.3.p0] ----------------------------------------------------------------------\n[dot2tex-2.11.3.p0] Traceback (most recent call last):\n[dot2tex-2.11.3.p0]   File \"test_dot2tex.py\", line 424, in test_tail_label_pstricks\n[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format=\"pstricks\")\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py\", line 62, in dot2tex\n[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3125, in convert_graph\n[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3075, in main\n[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 800, in convert\n[dot2tex-2.11.3.p0]     return self.do_preview_preproc()\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1062, in do_preview_preproc\n[dot2tex-2.11.3.p0]     sys.exit(1)\n[dot2tex-2.11.3.p0] SystemExit: 1\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] ======================================================================\n[dot2tex-2.11.3.p0] ERROR: test_tail_label_pstricks_duplicate (__main__.HeadAndTailLabelTest)\n[dot2tex-2.11.3.p0] ----------------------------------------------------------------------\n[dot2tex-2.11.3.p0] Traceback (most recent call last):\n[dot2tex-2.11.3.p0]   File \"test_dot2tex.py\", line 448, in test_tail_label_pstricks_duplicate\n[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format=\"pstricks\", duplicate=True)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py\", line 62, in dot2tex\n[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3125, in convert_graph\n[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 3075, in main\n[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 800, in convert\n[dot2tex-2.11.3.p0]     return self.do_preview_preproc()\n[dot2tex-2.11.3.p0]   File \"/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1062, in do_preview_preproc\n[dot2tex-2.11.3.p0]     sys.exit(1)\n[dot2tex-2.11.3.p0] SystemExit: 1\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] ----------------------------------------------------------------------\n[dot2tex-2.11.3.p0] Ran 57 tests in 5.814s\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] FAILED (errors=4)\n[dot2tex-2.11.3.p0] ############################################################\n[dot2tex-2.11.3.p0] spkg-check: Running test_dotparsing.py...\n[dot2tex-2.11.3.p0] ############################################################\n[dot2tex-2.11.3.p0] ................\n[dot2tex-2.11.3.p0] ----------------------------------------------------------------------\n[dot2tex-2.11.3.p0] Ran 16 tests in 0.001s\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] OK\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] Error(s) running dot2tex's test suite.\n[dot2tex-2.11.3.p0] \n[dot2tex-2.11.3.p0] real\t0m5.918s\n[dot2tex-2.11.3.p0] user\t0m5.581s\n[dot2tex-2.11.3.p0] sys\t0m0.347s\n[dot2tex-2.11.3.p0] ************************************************************************\n[dot2tex-2.11.3.p0] Error testing package dot2tex-2.11.3.p0\n[dot2tex-2.11.3.p0] ************************************************************************\n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28332\n\n",
    "created_at": "2019-08-08T05:38:00Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "dot2tex fails self-tests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28095",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
CC:  @tscrim

Probably due to #27684, dot2tex fails to pass self-tests, both on 32 and 64 bits archs, `sage -f -c dot2tex` leads to:


```
[dot2tex-2.11.3.p0] Running the test suite for dot2tex-2.11.3.p0...
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] spkg-check: Running test_dot2tex.py...
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] ...............EE....EE..................................
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_head_label_pstricks (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 412, in test_head_label_pstricks
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks")
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_head_label_pstricks_duplicate (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 436, in test_head_label_pstricks_duplicate
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks", duplicate=True)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_tail_label_pstricks (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 424, in test_tail_label_pstricks
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks")
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ======================================================================
[dot2tex-2.11.3.p0] ERROR: test_tail_label_pstricks_duplicate (__main__.HeadAndTailLabelTest)
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Traceback (most recent call last):
[dot2tex-2.11.3.p0]   File "test_dot2tex.py", line 448, in test_tail_label_pstricks_duplicate
[dot2tex-2.11.3.p0]     source = dot2tex.dot2tex(self.test_graph, autosize=True, format="pstricks", duplicate=True)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/__init__.py", line 62, in dot2tex
[dot2tex-2.11.3.p0]     return d2t.convert_graph(dotsource, **kwargs)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3125, in convert_graph
[dot2tex-2.11.3.p0]     tex = main(True, dotsource, options)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 3075, in main
[dot2tex-2.11.3.p0]     s = conv.convert(dotdata)
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 800, in convert
[dot2tex-2.11.3.p0]     return self.do_preview_preproc()
[dot2tex-2.11.3.p0]   File "/opt/sagemath/sage-source/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1062, in do_preview_preproc
[dot2tex-2.11.3.p0]     sys.exit(1)
[dot2tex-2.11.3.p0] SystemExit: 1
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Ran 57 tests in 5.814s
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] FAILED (errors=4)
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] spkg-check: Running test_dotparsing.py...
[dot2tex-2.11.3.p0] ############################################################
[dot2tex-2.11.3.p0] ................
[dot2tex-2.11.3.p0] ----------------------------------------------------------------------
[dot2tex-2.11.3.p0] Ran 16 tests in 0.001s
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] OK
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] Error(s) running dot2tex's test suite.
[dot2tex-2.11.3.p0] 
[dot2tex-2.11.3.p0] real	0m5.918s
[dot2tex-2.11.3.p0] user	0m5.581s
[dot2tex-2.11.3.p0] sys	0m0.347s
[dot2tex-2.11.3.p0] ************************************************************************
[dot2tex-2.11.3.p0] Error testing package dot2tex-2.11.3.p0
[dot2tex-2.11.3.p0] ************************************************************************
```




Issue created by migration from https://trac.sagemath.org/ticket/28332





---

archive/issue_comments_396493.json:
```json
{
    "body": "OK, pstricks is a new depedency of dot2tex self-tests.",
    "created_at": "2019-08-08T05:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396493",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

OK, pstricks is a new depedency of dot2tex self-tests.



---

archive/issue_comments_396494.json:
```json
{
    "body": "Changing keywords from \"\" to \"sdl\".",
    "created_at": "2019-08-08T05:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396494",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "" to "sdl".



---

archive/issue_comments_396495.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-08-08T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396495",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

New commits:



---

archive/issue_comments_396496.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-08T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396496",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_396497.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-08T06:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396497",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_396498.json:
```json
{
    "body": "Okay, that would explain why I remember it passing all of its tests when I upgraded the spkg. I have a full texlive install on my computer because I need it for writing my papers. Thank you for figuring out what changed.",
    "created_at": "2019-08-08T06:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396498",
    "user": "https://github.com/tscrim"
}
```

Okay, that would explain why I remember it passing all of its tests when I upgraded the spkg. I have a full texlive install on my computer because I need it for writing my papers. Thank you for figuring out what changed.



---

archive/issue_events_026040.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-08-10T13:08:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28095#event-26040"
}
```



---

archive/issue_comments_396499.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-10T13:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28095#issuecomment-396499",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
