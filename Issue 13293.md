# Issue 13293: Disable sage --info test for bdists

Issue created by migration from https://trac.sagemath.org/ticket/13497

Original creator: jdemeyer

Original creation time: 2012-09-16 18:28:30

Assignee: mvngu

The doctest introduced for `sage --info` at #12606 fails for bdist distributions because those don't ship spkgs.


---

Comment by jdemeyer created at 2012-09-16 18:28:55

Changing priority from critical to blocker.


---

Comment by jhpalmieri created at 2012-09-17 04:36:39

Here's another option: instead of disabling the test, sage-bdist can store the info in the placeholder spkg file, and sage-spkg can read it from there. See the attached patches. In sage-bdist, we could instead use `sage -i --info ...` instead of the code stolen from sage-spkg.

This isn't very well tested, but it's an idea.


---

Attachment

root repo


---

Comment by jhpalmieri created at 2012-09-17 04:39:57

scripts repo


---

Attachment

Maybe better would be to create an _actual_ spkg but only put `SPKG.txt` in it...

But my feeling is that we're overdoing things.  I would still simply disable the test.


---

Attachment


---

Comment by jhpalmieri created at 2012-09-18 16:40:15

Your patch fixes the test, which is good. I guess the only question is whether we want to fix `sage --info ...` for bdists? Or document that it doesn't work for them? (Or is that two questions?)

I think that rewriting sage-bdist to create tar files which contain only one file, SPKG.txt, might not be a bad idea. Running sage-bdist would take a little longer, but one more aspect of Sage would function for bdists. (I also don't like the fact that as sage-bdist currently works, every original spkg file is copied and then overwritten with the placeholder file; this wastes time and disk space.)


---

Comment by jdemeyer created at 2012-09-19 07:26:17

Replying to [comment:5 jhpalmieri]:
> I think that rewriting sage-bdist to create tar files which contain only one file, SPKG.txt, might not be a bad idea.

On the other hand, I always disliked the "placeholder" spkgs in bdists and would actually prefer not to ship them (i.e. have `spkg/standard` essentially empty, apart from `deps`).  Introducing these was a kludge to fix a problem in `newest_version` (now fixed in `spkg/install`).


---

Comment by jdemeyer created at 2012-09-19 14:01:06

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-09-19 14:39:15

Since you brought up the topic of `sage --info` and bdists, I feel uncomfortable with a documented feature of Sage not working with bdists. What do you think? I'm almost willing to give this a positive review, but I'm uncomfortable...


---

Comment by jdemeyer created at 2012-09-23 16:28:11

Replying to [comment:8 jhpalmieri]:
> Since you brought up the topic of `sage --info` and bdists, I feel uncomfortable with a documented feature of Sage not working with bdists. What do you think?
I would argue that `sage --info` does work within bdists.  The problem isn't `sage --info`, the problem is that we're shipping spkgs which aren't spkgs.  With your reasoning, `sage -i` is also broken.

That's why I think it would be better to not ship the fake `.spkg` files anymore for bdists (as far as I can tell, they are not needed anymore): #13522


---

Comment by jhpalmieri created at 2012-09-23 19:35:20

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-09-24 06:37:16

Resolution: fixed
