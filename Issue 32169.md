# Issue 32169: Make "./configure --enable-editable" the default

Issue created by migration from https://trac.sagemath.org/ticket/32406

Original creator: mkoeppe

Original creation time: 2021-08-22 00:31:43

CC:  @kliem dimpase mjo @tobiasdiez saraedum fbissey jhpalmieri was nbruin

This has been available since 9.3, has been improved in 9.4, and is ready for general consumption

https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library


---

Comment by mjo created at 2021-09-10 15:00:17

This would avoid the occasional WTF when one forgets to "make" after editing a file, but I've always thought the separation of source and build trees was one of the things that sage got right. Even with modern python projects, you usually want to byte-compile and/or pip-install after changing anything, so the build step is not unexpected. It is tediously slow, though, for sure.


---

Comment by mkoeppe created at 2021-09-10 18:06:15

Thanks for the discussion. I'm actually pretty sure that using `pip install -e` is widely used by Python developers though; but that is probably also connected to the widespread use of virtual environments for specific tasks. 

It is true that if one just has one "global" environment (and the monolithic nature of the Sage install with hours of compile time tend to lead to that), the isolation of that environment from the source tree is indeed useful.

So perhaps we need to wait until venv use becomes more popular in Sage developer circles. #32442 is intended to increase venv awareness.


---

Comment by slelievre created at 2021-12-29 06:19:38

Remove dependency on #32442, see ticket:29039#comment:163.


---

Comment by mkoeppe created at 2022-05-12 00:46:09

New commits:


---

Comment by git created at 2022-05-12 01:26:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-12 18:22:42

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2022-05-12 21:06:48

Shouldn't the editable mode be disabled on some ci workflows so that the `so` and `o` files are not included in the docker containers or dist? Or are they excluded by other means?


---

Comment by mkoeppe created at 2022-05-12 22:44:56

The so files are needed at runtime


---

Comment by mkoeppe created at 2022-05-12 23:28:13

cc:ing maintainer of the user-facing Docker image


---

Comment by git created at 2022-07-21 22:14:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-07-21 22:17:16

â€‹https://groups.google.com/g/sage-devel/c/0GV8_O1VwbI (May 2022) only received positive responses, so let's get this in please


---

Comment by jhpalmieri created at 2022-07-22 00:09:20

Would it be possible to handle Cython files the same way Python files are handled?

Some timings on my creaky old laptop:

- with this branch, if I change `quaternion_algebra_cython.pyx` and run `make build`: it takes about 70 seconds.
- with this branch, if I change nothing and run `make build`, it takes about 60 seconds.
- with the `develop` branch, if I change `quaternion_algebra_cython.pyx`, `make build` takes about 35 seconds.
- with the `develop` branch, if I change nothing, `make build` takes about 30 seconds.

So this change does have a cost. Presumably it's not as large a difference on a faster computer.


---

Comment by mkoeppe created at 2022-07-22 00:13:55

Replying to [comment:18 jhpalmieri]:
> Would it be possible to handle Cython files the same way Python files are handled?

No, they need to be compiled


---

Comment by mkoeppe created at 2022-07-22 00:17:52

I'll check where the speed difference is coming from


---

Comment by mkoeppe created at 2022-07-22 01:04:16

I can confirm that it is slower with `--enable-editable`, but the difference is much smaller on my machine. Typical timings of `make sagelib-no-deps`:

With `./configure --enable-editable` (= new default):
- no change: `make sagelib-no-deps  25.19s user 9.92s system 98% cpu 35.817 total`
- after `touch src/sage/algebras/quaternion_algebra_cython.pyx`: `make sagelib-no-deps  21.77s user 8.55s system 97% cpu 31.039 total`
With `./configure --disable-editable` (= same as default on the `develop` branch):
- no change: `make sagelib-no-deps  16.72s user 7.43s system 91% cpu 26.297 total`
- after `touch src/sage/algebras/quaternion_algebra_cython.pyx`: `make sagelib-no-deps  18.00s user 7.74s system 91% cpu 28.023 total`


---

Comment by git created at 2022-07-22 01:36:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-22 01:36:43

It's faster now


---

Comment by jhpalmieri created at 2022-07-22 17:37:52

Yes, it is indeed faster, and the timing is not very different whether I change a single file or don't change anything.

I feel like, in a perfect world, Sage upon startup would automatically detect if it had to recompile because of a change to a Cython file, and conversely, 'sage -b' would be a no-op if no files had been changed. But if that's possible, it's for another ticket.


---

Comment by mkoeppe created at 2022-07-22 17:41:34

We can probably add a check for that to display a hint (in a follow-up ticket), but it would be very nonstandard to recompile automatically. I've added this idea to #31406


---

Comment by jhpalmieri created at 2022-07-22 18:26:22

I think a recompile hint would be great!

How many more eyes do we need on this before a positive review? It feels like a major change, but it also feels like it's a simplification.


---

Comment by mkoeppe created at 2022-07-22 18:38:22

It's well tested already, and if anything goes wrong there's the easy recourse of using `configure --disable-editable`


---

Comment by jhpalmieri created at 2022-07-22 18:43:57

I'll give it a bit more time in case others want to chime in. If no one responds, I'll set it to positive review later.


---

Comment by jhpalmieri created at 2022-07-23 18:45:54

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-07-23 18:51:42

Thanks!


---

Comment by vbraun created at 2022-08-01 20:23:09

Resolution: fixed
