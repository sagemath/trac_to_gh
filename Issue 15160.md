# Issue 15160: Bug in product of symmetric functions

archive/issues_015160.json:
```json
{
    "body": "CC:  sage-combinat @anneschilling @asbuch @mguaypaq @saliola @darijgr tfeulner\n\nFor partitions with first part >123 the product of Schur functions has problems.\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: s[121,1]*s[2,1] # ok\ns[121, 2, 1, 1] + s[121, 2, 2] + s[121, 3, 1] + s[122, 1, 1, 1] + 2*s[122, 2, 1] + s[122, 3] + s[123, 1, 1] + s[123, 2]\nsage: s[122,1]*s[2,1] # not ok\n2*s[1]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15397\n\n",
    "created_at": "2013-11-11T12:28:03Z",
    "labels": [
        "component: combinatorics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Bug in product of symmetric functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15160",
    "user": "https://github.com/zabrocki"
}
```
CC:  sage-combinat @anneschilling @asbuch @mguaypaq @saliola @darijgr tfeulner

For partitions with first part >123 the product of Schur functions has problems.

```
sage: s = SymmetricFunctions(QQ).s()
sage: s[121,1]*s[2,1] # ok
s[121, 2, 1, 1] + s[121, 2, 2] + s[121, 3, 1] + s[122, 1, 1, 1] + 2*s[122, 2, 1] + s[122, 3] + s[123, 1, 1] + s[123, 2]
sage: s[122,1]*s[2,1] # not ok
2*s[1]
```


Issue created by migration from https://trac.sagemath.org/ticket/15397





---

archive/issue_comments_194403.json:
```json
{
    "body": "This bug was reported to me by Mercedes Rosas.  I haven't experimented yet to identify the problem precisely.\n\nSince the product of Schur functions is done with lrcalc (which may or may not be where the bug is) I included Anders Buch in the cc of the developers list (this is the 'report upstream').",
    "created_at": "2013-11-11T12:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194403",
    "user": "https://github.com/zabrocki"
}
```

This bug was reported to me by Mercedes Rosas.  I haven't experimented yet to identify the problem precisely.

Since the product of Schur functions is done with lrcalc (which may or may not be where the bug is) I included Anders Buch in the cc of the developers list (this is the 'report upstream').



---

archive/issue_comments_194404.json:
```json
{
    "body": "Remark:\n\nI do not have similarly incorrect answers with the product of monomial symmetric functions.\n\n```\nsage: m = SymmetricFunctions(QQ).m()\nsage: m[122,1]*m[2,1]\n2*m[122, 2, 1, 1] + 2*m[122, 2, 2] + m[122, 3, 1] + m[123, 2, 1] + m[123, 3] + 2*m[124, 1, 1] + m[124, 2]\nsage: m[600,1]*m[2,1]\n2*m[600, 2, 1, 1] + 2*m[600, 2, 2] + m[600, 3, 1] + m[601, 2, 1] + m[601, 3] + 2*m[602, 1, 1] + m[602, 2]\n```",
    "created_at": "2013-11-11T12:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194404",
    "user": "https://github.com/zabrocki"
}
```

Remark:

I do not have similarly incorrect answers with the product of monomial symmetric functions.

```
sage: m = SymmetricFunctions(QQ).m()
sage: m[122,1]*m[2,1]
2*m[122, 2, 1, 1] + 2*m[122, 2, 2] + m[122, 3, 1] + m[123, 2, 1] + m[123, 3] + 2*m[124, 1, 1] + m[124, 2]
sage: m[600,1]*m[2,1]
2*m[600, 2, 1, 1] + 2*m[600, 2, 2] + m[600, 3, 1] + m[601, 2, 1] + m[601, 3] + 2*m[602, 1, 1] + m[602, 2]
```



---

archive/issue_comments_194405.json:
```json
{
    "body": "My first test indicates that the bug does not lie in lrcalc, but is actually a problem in symmetrica.\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: symmetrica.mult_schur_schur(s[122,1],s[2,1])\n2*s[1]\n```",
    "created_at": "2013-11-11T13:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194405",
    "user": "https://github.com/zabrocki"
}
```

My first test indicates that the bug does not lie in lrcalc, but is actually a problem in symmetrica.

```
sage: s = SymmetricFunctions(QQ).s()
sage: symmetrica.mult_schur_schur(s[122,1],s[2,1])
2*s[1]
```



---

archive/issue_comments_194406.json:
```json
{
    "body": "One fix for this bug could be to switch the product from symmetrica to lrcalc since the problem seems to be within symmetrica:\n\n```\nsage: import sage.libs.lrcalc.lrcalc as lrcalc\nsage: sage.libs.lrcalc.lrcalc.mult([122,1],[2,1])\n{[122, 2, 1, 1]: 1,\n [122, 2, 2]: 1,\n [122, 3, 1]: 1,\n [123, 1, 1, 1]: 1,\n [123, 2, 1]: 2,\n [123, 3]: 1,\n [124, 1, 1]: 1,\n [124, 2]: 1}\n```\nlrcalc seems to have a known reported bug in #14625 (to my eye, significantly less serious).  Any advice?",
    "created_at": "2013-11-11T14:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194406",
    "user": "https://github.com/zabrocki"
}
```

One fix for this bug could be to switch the product from symmetrica to lrcalc since the problem seems to be within symmetrica:

```
sage: import sage.libs.lrcalc.lrcalc as lrcalc
sage: sage.libs.lrcalc.lrcalc.mult([122,1],[2,1])
{[122, 2, 1, 1]: 1,
 [122, 2, 2]: 1,
 [122, 3, 1]: 1,
 [123, 1, 1, 1]: 1,
 [123, 2, 1]: 2,
 [123, 3]: 1,
 [124, 1, 1]: 1,
 [124, 2]: 1}
```
lrcalc seems to have a known reported bug in #14625 (to my eye, significantly less serious).  Any advice?



---

archive/issue_comments_194407.json:
```json
{
    "body": "You can test the symmetrica bug is also triggered on the website for symmetrica \nat [this link](http://www.mathe2.uni-bayreuth.de/cgi-bin/axel/gensym.exe?outerproduct_schur?2?1?PARTITION?PARTITION).  Enter `[1,122]` and `[1,2]` and the same bug appears.  I suppose in any case it is worth digging around again in the symmetrica code to identify the problem.",
    "created_at": "2013-11-11T14:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194407",
    "user": "https://github.com/zabrocki"
}
```

You can test the symmetrica bug is also triggered on the website for symmetrica 
at [this link](http://www.mathe2.uni-bayreuth.de/cgi-bin/axel/gensym.exe?outerproduct_schur?2?1?PARTITION?PARTITION).  Enter `[1,122]` and `[1,2]` and the same bug appears.  I suppose in any case it is worth digging around again in the symmetrica code to identify the problem.



---

archive/issue_comments_194408.json:
```json
{
    "body": "An email message was sent to the addresses at the website for symmetrica as well as to Axel Kohnert (Nicolas indicated that he might be a contact for symmetrica).",
    "created_at": "2013-11-11T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194408",
    "user": "https://github.com/zabrocki"
}
```

An email message was sent to the addresses at the website for symmetrica as well as to Axel Kohnert (Nicolas indicated that he might be a contact for symmetrica).



---

archive/issue_comments_194409.json:
```json
{
    "body": "Wow, this is a terrible bug!!! One option would be to do the computations using lrcalc since we already have an interface to it and in addition ask Anders Buch to try to fix the lrcalc bug reported in #14625.",
    "created_at": "2013-11-11T19:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194409",
    "user": "https://github.com/anneschilling"
}
```

Wow, this is a terrible bug!!! One option would be to do the computations using lrcalc since we already have an interface to it and in addition ask Anders Buch to try to fix the lrcalc bug reported in #14625.



---

archive/issue_comments_194410.json:
```json
{
    "body": "I am not sure if \"Developers acknowledge bug.\" is quite accurate, but will have to do for now.  Axel Kohnert has been seriously hurt and is unconscious.  Adalbert Kerber from Bayreuth acknowledged the bug report though.\n\nI am posting here a patch to change the multiplication from symmetrica to lrcalc.  I don't consider it quite ready for review, but it seems to solve the problem.  As a happy side effect it also seems to have a serious speedup.\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: P = list(reversed(range(1,8)))\nsage: %time s(P)*s(P);\n```\nhas a speedup from 169.30s to 27.75s running on sage cloud.",
    "created_at": "2013-11-12T04:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194410",
    "user": "https://github.com/zabrocki"
}
```

I am not sure if "Developers acknowledge bug." is quite accurate, but will have to do for now.  Axel Kohnert has been seriously hurt and is unconscious.  Adalbert Kerber from Bayreuth acknowledged the bug report though.

I am posting here a patch to change the multiplication from symmetrica to lrcalc.  I don't consider it quite ready for review, but it seems to solve the problem.  As a happy side effect it also seems to have a serious speedup.

```
sage: s = SymmetricFunctions(QQ).s()
sage: P = list(reversed(range(1,8)))
sage: %time s(P)*s(P);
```
has a speedup from 169.30s to 27.75s running on sage cloud.



---

archive/issue_comments_194411.json:
```json
{
    "body": "Doing some more experimenting I have found minor modifications of how to trigger the bug and the second example has very bad behavior:\n\n```\nsage: s[123,1]*s[1,1]\n2*s[1]\nsage: s[123]*s[2,1]\nValueError                                Traceback (most recent call last)\n...\nValueError: [0, 0, ..., 0, 122, 2, 1] is not an element of Partitions\n```",
    "created_at": "2013-11-12T04:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194411",
    "user": "https://github.com/zabrocki"
}
```

Doing some more experimenting I have found minor modifications of how to trigger the bug and the second example has very bad behavior:

```
sage: s[123,1]*s[1,1]
2*s[1]
sage: s[123]*s[2,1]
ValueError                                Traceback (most recent call last)
...
ValueError: [0, 0, ..., 0, 122, 2, 1] is not an element of Partitions
```



---

archive/issue_comments_194412.json:
```json
{
    "body": "I guess I shouldn't have stopped there because:\n\n```\nsage: s([125])*s([3])\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: Segmentation fault\n```",
    "created_at": "2013-11-12T05:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194412",
    "user": "https://github.com/zabrocki"
}
```

I guess I shouldn't have stopped there because:

```
sage: s([125])*s([3])
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Segmentation fault
```



---

archive/issue_comments_194413.json:
```json
{
    "body": "Attachment [trac_15397_fix_with_lrcalc.patch](tarball://root/attachments/some-uuid/ticket15397/trac_15397_fix_with_lrcalc.patch) by @zabrocki created at 2013-11-12 12:53:24",
    "created_at": "2013-11-12T12:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194413",
    "user": "https://github.com/zabrocki"
}
```

Attachment [trac_15397_fix_with_lrcalc.patch](tarball://root/attachments/some-uuid/ticket15397/trac_15397_fix_with_lrcalc.patch) by @zabrocki created at 2013-11-12 12:53:24



---

archive/issue_comments_194414.json:
```json
{
    "body": "I don't see the fix for symmetrica.  There is clearly a bug there that one can recreate on their website.\n\nThe attached patch changes `_multiply` to `_multiply_basis` and then calls `lrcalc.mult`.  I believe that given what the former `_multiply` function did, it should have been a `_multiply_basis` all along.  I also added three doctests.\n\nThat does not mean that the bug in symmetrica should not be fixed.  The following command causes a `Segmentation fault`\n\n```\nsage: symmetrica.mult_schur_schur([125],[3])\n```\n\nMy recommendation is to review this patch and move on to fixing the problems with lrcalc mentioned in #14625.  Anders Buch has a version 1.1.7 of lrcalc while the version in Sage now is 1.1.6.",
    "created_at": "2013-11-12T13:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194414",
    "user": "https://github.com/zabrocki"
}
```

I don't see the fix for symmetrica.  There is clearly a bug there that one can recreate on their website.

The attached patch changes `_multiply` to `_multiply_basis` and then calls `lrcalc.mult`.  I believe that given what the former `_multiply` function did, it should have been a `_multiply_basis` all along.  I also added three doctests.

That does not mean that the bug in symmetrica should not be fixed.  The following command causes a `Segmentation fault`

```
sage: symmetrica.mult_schur_schur([125],[3])
```

My recommendation is to review this patch and move on to fixing the problems with lrcalc mentioned in #14625.  Anders Buch has a version 1.1.7 of lrcalc while the version in Sage now is 1.1.6.



---

archive/issue_comments_194415.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-12T13:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194415",
    "user": "https://github.com/zabrocki"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194416.json:
```json
{
    "body": "Changing keywords from \"\" to \"symmetrica, lrcalc, symmetric functions\".",
    "created_at": "2013-11-12T13:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194416",
    "user": "https://github.com/zabrocki"
}
```

Changing keywords from "" to "symmetrica, lrcalc, symmetric functions".



---

archive/issue_comments_194417.json:
```json
{
    "body": "The fix looks good to me!",
    "created_at": "2013-11-12T16:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194417",
    "user": "https://github.com/anneschilling"
}
```

The fix looks good to me!



---

archive/issue_comments_194418.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-12T16:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194418",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194419.json:
```json
{
    "body": "The bug in symmetrica was moved to ticket #15407",
    "created_at": "2013-11-13T03:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194419",
    "user": "https://github.com/zabrocki"
}
```

The bug in symmetrica was moved to ticket #15407



---

archive/issue_comments_194420.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-11-14T07:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15160#issuecomment-194420",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_044769.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-14T07:54:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15160",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15160#event-44769"
}
```
