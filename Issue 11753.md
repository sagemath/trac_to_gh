# Issue 11753: Attach ignores inheritance of classes spread over distinct files

archive/issues_011753.json:
```json
{
    "body": "Assignee: ncalexan\n\nCC:  mstreng\n\nKeywords: attach inheritance\n\nSuppose one has a file named aap.sage with the following contents:\n\n```\nclass Aap(SageObject):\n    pass  # Minimum example\n```\n\nand a file named noot.sage that looks like:\n\n```\nclass Noot(Aap):\n    pass  # Minimum example\n```\n\nOkay, and suppose one attaches both files:\n\n```\nsage: attach aap.sage\nsage: attach noot.sage\n```\n\nAfter working with both files for a while, one changes something in the class Aap and the file aap.sage becomes:\n\n```\nclass Aap(SageObject):\n    def mies(self):\n        print \"Wim, zus, Jet!\"\n```\n\nNow suppose that, *after* this change, one initializes a Noot object:\n\n```\nsage: noot = Noot()\n```\n\nThen the following gives an error:\n\n```\nsage: noot.mies()\n...\nAttributeError: 'Noot' object has no attribute 'mies'\n```\n\nIf, instead, one re-attaches the files, everything works fine:\n\n```\nsage: attach aap.sage\nsage: attach noot.sage\nsage: noot = Noot()\nsage: noot.mies()\nWim, zus, Jet!\n```\n\nOf course, the whole point of attaching files is that one shouldn't have to re-attach them.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11925\n\n",
    "created_at": "2011-10-14T22:38:02Z",
    "labels": [
        "sage-mode",
        "major",
        "bug"
    ],
    "title": "Attach ignores inheritance of classes spread over distinct files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11753",
    "user": "johanbosman"
}
```
Assignee: ncalexan

CC:  mstreng

Keywords: attach inheritance

Suppose one has a file named aap.sage with the following contents:

```
class Aap(SageObject):
    pass  # Minimum example
```

and a file named noot.sage that looks like:

```
class Noot(Aap):
    pass  # Minimum example
```

Okay, and suppose one attaches both files:

```
sage: attach aap.sage
sage: attach noot.sage
```

After working with both files for a while, one changes something in the class Aap and the file aap.sage becomes:

```
class Aap(SageObject):
    def mies(self):
        print "Wim, zus, Jet!"
```

Now suppose that, *after* this change, one initializes a Noot object:

```
sage: noot = Noot()
```

Then the following gives an error:

```
sage: noot.mies()
...
AttributeError: 'Noot' object has no attribute 'mies'
```

If, instead, one re-attaches the files, everything works fine:

```
sage: attach aap.sage
sage: attach noot.sage
sage: noot = Noot()
sage: noot.mies()
Wim, zus, Jet!
```

Of course, the whole point of attaching files is that one shouldn't have to re-attach them.

Issue created by migration from https://trac.sagemath.org/ticket/11925





---

archive/issue_comments_133759.json:
```json
{
    "body": "Changing assignee from ncalexan to jason.",
    "created_at": "2011-10-15T01:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11753#issuecomment-133759",
    "user": "johanbosman"
}
```

Changing assignee from ncalexan to jason.



---

archive/issue_comments_133760.json:
```json
{
    "body": "Changing component from sage-mode to misc.",
    "created_at": "2011-10-15T01:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11753#issuecomment-133760",
    "user": "johanbosman"
}
```

Changing component from sage-mode to misc.



---

archive/issue_comments_133761.json:
```json
{
    "body": "Possible solution: make 2 different modes, one in which only changed files are reloaded (speed), and one in which every file is reloaded as soon as one changes (solves your problem).\n\nThe new patch I'm writing at #11812 also introduces different modes: one in which sage files are preparsed through memory and one in which they are preparsed through a file. #11812 will have a big overlap with #11925. This means that maybe I could do both tickets at once, but at the very least one ticket should depend on the other to avoid conflicting patches.",
    "created_at": "2011-10-15T09:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11753#issuecomment-133761",
    "user": "mstreng"
}
```

Possible solution: make 2 different modes, one in which only changed files are reloaded (speed), and one in which every file is reloaded as soon as one changes (solves your problem).

The new patch I'm writing at #11812 also introduces different modes: one in which sage files are preparsed through memory and one in which they are preparsed through a file. #11812 will have a big overlap with #11925. This means that maybe I could do both tickets at once, but at the very least one ticket should depend on the other to avoid conflicting patches.



---

archive/issue_comments_133762.json:
```json
{
    "body": "Replying to [comment:2 mstreng]:\n> Possible solution: make 2 different modes, one in which only changed files are reloaded (speed), and one in which every file is reloaded as soon as one changes (solves your problem).\n\nStarting from #11812, this would mean extending sage.misc.preparser.load_attach_mode with an option like \"reload_all\", and to change sage.misc.preparser.modified_attached_files accordingly.",
    "created_at": "2011-10-16T13:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11753#issuecomment-133762",
    "user": "mstreng"
}
```

Replying to [comment:2 mstreng]:
> Possible solution: make 2 different modes, one in which only changed files are reloaded (speed), and one in which every file is reloaded as soon as one changes (solves your problem).

Starting from #11812, this would mean extending sage.misc.preparser.load_attach_mode with an option like "reload_all", and to change sage.misc.preparser.modified_attached_files accordingly.



---

archive/issue_comments_133763.json:
```json
{
    "body": "Workaround: end aap.sage with `load noot.sage`\n\nThat way, when aap.sage changes and is reloaded, noot.sage is loaded afterwards.",
    "created_at": "2011-10-16T16:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11753#issuecomment-133763",
    "user": "mstreng"
}
```

Workaround: end aap.sage with `load noot.sage`

That way, when aap.sage changes and is reloaded, noot.sage is loaded afterwards.



---

archive/issue_comments_133764.json:
```json
{
    "body": "I see Marco has given several work-arounds, which you can probably make work.  Be aware that circular dependencies will break the work-around, though.\n\nVarious people in the Python community have tried to address the issue, which is that loaded objects, in particular class definitions, do not modify existing objects but rather add new objects to the namespace.  Google \"reload.py\" or \"xreload.py\" to see attempts to solve this.  (Attempts that, in my experience, are worse than the problem.)\n\nThe only language/environment I know that hot-patches class definitions satisfactorily is Smalltalk, although I would be willing to bet Erlang and friends could do it too.  If you know of others, please tell me -- it is a canonically hard problem and I would love to know more solutions.",
    "created_at": "2011-10-28T19:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11753#issuecomment-133764",
    "user": "ncalexan"
}
```

I see Marco has given several work-arounds, which you can probably make work.  Be aware that circular dependencies will break the work-around, though.

Various people in the Python community have tried to address the issue, which is that loaded objects, in particular class definitions, do not modify existing objects but rather add new objects to the namespace.  Google "reload.py" or "xreload.py" to see attempts to solve this.  (Attempts that, in my experience, are worse than the problem.)

The only language/environment I know that hot-patches class definitions satisfactorily is Smalltalk, although I would be willing to bet Erlang and friends could do it too.  If you know of others, please tell me -- it is a canonically hard problem and I would love to know more solutions.
