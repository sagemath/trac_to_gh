# Issue 29441: Fraction field of Ore polynomial ring

Issue created by migration from https://trac.sagemath.org/ticket/29678

Original creator: caruso

Original creation time: 2020-05-12 10:56:14

We implement the fraction field of Ore polynomial rings.

The elements of the fraction field are represented by fractions of the form `denom^(-1) * num`.


---

Comment by caruso created at 2020-05-12 10:56:52

Last 10 new commits:


---

Comment by git created at 2020-05-12 23:03:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-14 22:46:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-17 16:55:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-25 21:29:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2020-06-25 21:30:14

Changing status from new to needs_review.


---

Comment by caruso created at 2020-06-25 21:30:14

There is still a small issue with category (elements are not instances of `parent.category().element_class`) but I don't know how I should fix it. Any ideas?


---

Comment by tscrim created at 2020-06-26 04:42:02

Typically that means you are returning elements that are not instances of `ParentObject.element_class`. If this is for a morphism parent, you can simply silence that warning. (This is a common practice as there can be many morphism types, but we don't (yet) have a good framework for these things. I have seen a workaround for this that just dynamically creates the new element class, but I forget where in the Sage code this is done.)


---

Comment by git created at 2020-07-05 11:20:21

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by caruso created at 2020-07-05 12:15:40

Here is my issue:


```
sage: k.<a> = GF(5^3)
sage: Frob = k.frobenius_endomorphism()
sage: S.<x> = k['x', Frob]
sage: K = S.fraction_field()
sage: K(x)._test_category()
Traceback (most recent call last):
...
AssertionError: False is not true
```


`K.category().element_class` is `sage.categories.algebras.Algebras.element_class` but `K(x)` is an instance is an instance of `sage.rings.polynomial.ore_function_element.OreFunction_with_large_center` which, apparently, does not define from the former (although `OreFunction_with_large_center` derives from `AlgebraElement`).


---

Comment by tscrim created at 2020-07-06 06:52:10

This should be your problem: In `OreFunctionField._element_constructor_`, you need to change

```diff
-self.Element(self, *args, **kwds)
+self.element_class(self, *args, **kwds)
```

This also needs to be changed for `OrePolynomialRing._element_constructor_`:

```diff
-C = self.Element
+C = self.element_class
```


One other thing: the `extend_to_fraction_field` needs doctests.


---

Comment by git created at 2020-07-06 16:14:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2020-07-06 16:16:12

Replying to [comment:12 tscrim]:
> This should be your problem: In `OreFunctionField._element_constructor_`, you need to change
> {{{#!diff
> -self.Element(self, *args, **kwds)
> +self.element_class(self, *args, **kwds)
> }}}
> This also needs to be changed for `OrePolynomialRing._element_constructor_`:
> {{{#!diff
> -C = self.Element
> +C = self.element_class
> }}}

Thanks, It indeed fixes the problem!

> One other thing: the `extend_to_fraction_field` needs doctests.

There were already doctests. But I've added one more.


---

Comment by git created at 2020-07-06 17:26:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-06 22:43:04

Replying to [comment:14 caruso]:
> Replying to [comment:12 tscrim]:
> > One other thing: the `extend_to_fraction_field` needs doctests.
> 
> There were already doctests. But I've added one more.

Wrong method: `RingDerivationWithoutTwist.extend_to_fraction_field`. Sorry, I didn't realize there was more than one.


---

Comment by tscrim created at 2020-07-06 22:43:36

Sorry, two places: `RingDerivationWithTwist_generic.extend_to_fraction_field` as well.


---

Comment by git created at 2020-07-08 17:17:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2020-07-08 17:22:50

Fixed.

Also, I tried to reorganize a bit the documentation and separate commutative polynomials from noncommutative polynomials. I created a new file `doc/en/reference/noncommutative_polynomial_rings/index.rst` but I probably did something wrong because this file is not found when building the documentation. Do you know what's going on, here?


---

Comment by tscrim created at 2020-07-09 02:47:53

I think you also need the `conf.py` file.


---

Comment by git created at 2020-07-09 23:17:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-09 23:19:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2020-07-09 23:20:13

Replying to [comment:20 tscrim]:
> I think you also need the `conf.py` file.

Oh, I see. Thanks.


---

Comment by tscrim created at 2020-07-09 23:33:23

Rather than be a direct file that refers back to `conf_sub.py`, the other folders are symlinks. Could you do the same thing here?


---

Comment by caruso created at 2020-07-10 05:52:58

My `conf.py` is a symlink, isn't it?


---

Comment by git created at 2020-07-10 05:53:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-10 06:03:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-10 06:04:43

Ah, I see. Git is just handling it in a strange way. Sorry for the noise.

However, no bare excepts.


---

Comment by caruso created at 2020-07-10 06:08:51

Btw, I saw that there are pyflakes warnings in `conf.py` due to the imports (on two consecutive lines):

```
from sage.docs.conf import release, exclude_patterns
from sage.docs.conf import *
```

Shouldn't we remove the second import?


---

Comment by tscrim created at 2020-07-10 06:16:51

I wouldn't touch the `conf.py` files here. That should be a separate ticket as that is outside of the scope and could have larger impact to Sage's doc.


---

Comment by caruso created at 2020-07-10 06:26:57

Replying to [comment:30 tscrim]:
> I wouldn't touch the `conf.py` files here. That should be a separate ticket as that is outside of the scope and could have larger impact to Sage's doc.

Yes, I agree.


---

Comment by tscrim created at 2020-07-10 07:59:50

The only thing missing from me giving this a positive review is taking care of the bare `except:` (this can catch keyboard interrupts I've been told, so it is essentially prohibited to have in Sage code).


---

Comment by tscrim created at 2020-07-10 08:18:55

Here is a version with my docbuild fixes from #29629.
----
New commits:


---

Comment by caruso created at 2020-07-11 07:19:55

OK, I've added an explicit list of exceptions.

I also rebased the commit on my branch because I thought you have forgotten to include the core of this ticket in your merge :-). I hope everything is now merged correctly.
----
Last 10 new commits:


---

Comment by tscrim created at 2020-07-11 07:32:51

Whoops, bad copy-paste of the branch name. `^^;;` If the patchbot comes back green, then positive review. Thank you.


---

Comment by caruso created at 2020-07-11 18:04:16

The patchbots reported a bunch of errors in the documentation (some files are not found). However, I'm not sure that they are related to this ticket. Do you know what's happening here?


---

Comment by tscrim created at 2020-07-12 03:36:04

In `ore_polynomial_ring.py`:

```diff
-:module:`sage.rings.polynomial.ore_function_field`
+:mod:`sage.rings.polynomial.ore_function_field`
```

That is at least the current docbuild failure.


---

Comment by git created at 2020-07-12 06:15:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-07-12 23:44:00

Thank you. LGTM.


---

Comment by tscrim created at 2020-07-12 23:44:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-07-19 07:24:26

Resolution: fixed
