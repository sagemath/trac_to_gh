# Issue 32986: make PARI the default for EllipticCurve_field.weierstrass_p

Issue created by migration from https://trac.sagemath.org/ticket/33223

Original creator: lorenz

Original creation time: 2022-01-24 03:12:06

CC:  cremona defeo vdelecroix




---

Comment by lorenz created at 2022-01-24 05:22:56

New commits:


---

Comment by lorenz created at 2022-01-24 05:22:56

Changing status from new to needs_review.


---

Comment by slabbe created at 2022-01-27 09:57:55

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2022-01-27 09:57:55

I confirm the new default is better:

```
sage: %timeit E.weierstrass_p(prec=1000, algorithm='fast')
268 ms ± 580 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit E.weierstrass_p(prec=1000, algorithm='pari')
58.3 ms ± 160 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit E.weierstrass_p(prec=1000, algorithm='quadratic')
86.4 ms ± 167 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit E.weierstrass_p(prec=1000)
57.7 ms ± 197 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```


While reviewing, I noticed typos in the documentation:

```
sage: E.weierstrass_p??
```


I suggest to fix as follows:


```diff
-        - ``mprec`` - precision
+        - ``prec`` - precision

-        - ``algorithm`` - string (default:``None``) an algorithm identifier
-                      indicating using the ``pari``, ``fast`` or ``quadratic``
-                      algorithm. If the algorithm is ``None``, then this
-                      function determines the best algorithm to use.
+        - ``algorithm`` - string (default: ``None``) an algorithm identifier
+          indicating using the ``pari``, ``fast`` or ``quadratic``
+          algorithm. If the algorithm is ``None``, then this
+          function determines the best algorithm to use.
```



---

Comment by git created at 2022-01-28 03:19:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-01-28 03:21:19

Changing status from needs_work to needs_review.


---

Comment by lorenz created at 2022-01-28 03:21:19

Thanks! Updated documentation.


---

Comment by slabbe created at 2022-01-28 10:20:09

I checked the changes. Looks good. Only one thing.

I don't agree with the following change:

```diff
-        - ``algorithm`` - string (default:``None``) an algorithm identifier
-                      indicating using the ``pari``, ``fast`` or ``quadratic``
-                      algorithm. If the algorithm is ``None``, then this
-                      function determines the best algorithm to use.
+        - ``algorithm`` -- an algorithm name or (default) ``None``:
+          See :func:`sage.schemes.elliptic_curves.ell_wp.weierstrass_p`
+          for a list of possible values.
```

Because for any user that get there, it is force one more step to get the possible values which is very often a question that comes to mind. Also, for normal user, they might just not be able to get to this other method.

In summary, I think it is better to leave it with an explicit list even if the information is doubled.


---

Comment by slabbe created at 2022-01-28 10:20:09

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2022-01-28 10:29:18

I agree with slabbe's comment.  (I hate it when a function has a *kwds argument and the docstring does not explain them but sends you some where else, which is similar.)


---

Comment by git created at 2022-01-29 07:00:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-01-29 07:03:36

Changing status from needs_work to needs_review.


---

Comment by lorenz created at 2022-01-29 07:03:36

Alright, makes sense. I changed it back (and added a comment to ell_wp.py to remind people of the duplication).


---

Comment by slabbe created at 2022-01-30 20:11:02

Thanks for the changes.

I still have some comments with respect to coding conventions in sage with respect to documentation. Sorry if it is troublesome: it is just some details.

The following change

```diff
-        - ``algorithm`` - string (default:``None``) an algorithm identifier
+        - ``algorithm`` -- string or (default) ``None``: an algorithm
```

does not respect the coding convention for the documentation. See https://doc.sagemath.org/html/en/developer/coding_basics.html To be more precise, please keep `string (default:``None``)` as is (twice).

Also, it would more exact to write 
```'pari'```
```'fast'```
```'quadratic'```
as opposed to 
```pari```
```fast```
```quadratic```. Observe that ```None``` is okay, since it is not about the string ```'None'```.


---

Comment by slabbe created at 2022-01-30 20:11:02

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-01-31 03:04:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-01-31 03:07:53

The reason I'd changed it was precisely that `None` is not a string, so saying that this parameter is "a string which defaults to `None`" is not type-correct. Realistically speaking it's clear enough either way.


---

Comment by lorenz created at 2022-01-31 03:07:53

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2022-01-31 09:27:42

How about:

```
        - ``algorithm`` -- string or ``None`` (default: ``None``):
          a choice of algorithm among ``"pari"``, ``"fast"``
          ``"quadratic"``; or ``None`` to let this function
          determine the best algorithm to use.
```



---

Comment by git created at 2022-01-31 10:14:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by lorenz created at 2022-01-31 10:17:33

Done, and squashed all the documentation edits to untangle the commit history a bit.


---

Comment by slelievre created at 2022-01-31 10:39:08

Looks good to me if other reviewers agree.


---

Comment by cremona created at 2022-01-31 10:52:39

Fine by me.  The moral of this story is never to label an algorithm as 'fast'.


---

Comment by slabbe created at 2022-02-01 20:44:15

Replying to [comment:19 cremona]:
> Fine by me.  The moral of this story is never to label an algorithm as 'fast'.

Indeed!


---

Comment by slabbe created at 2022-02-01 21:00:52

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2022-02-01 21:00:52

I confirm that `make` works including the doc:

```
[sagemath_doc_html-none] Build finished.
```

and `All tests passed!` in folder `sage -tp src/sage/schemes/elliptic_curves`.


---

Comment by lorenz created at 2022-02-02 03:55:42

Thanks everyone!


---

Comment by vbraun created at 2022-03-08 08:12:11

Resolution: fixed
