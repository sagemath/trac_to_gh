# Issue 10775: piecewise integrals of 0 fail

Issue created by migration from https://trac.sagemath.org/ticket/10841

Original creator: dsm

Original creation time: 2011-02-24 08:19:32

Assignee: tbd

CC:  kcrisman

As reported in [a sage-support thread](http://groups.google.com/group/sage-support/browse_thread/thread/7d0fdb331d05c557), in 4.6.1 we see that


```
sage: # succeeds
sage: f = Piecewise([[(0,1),1]])
sage: f.integral(x,0,1)
1
sage: # fails
sage: f = Piecewise([[(0,1),0]])
sage: f.integral(x,0,1)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/Applications/sage/local/lib/python2.6/site-packages/sage/all_cmdline.pyc in <module>()

/Applications/sage/local/lib/python2.6/site-packages/sage/functions/piecewise.pyc in integral(self, x, a, b, definite)
    789         """
    790         if a != None and b != None:
--> 791             F = self.integral(x)
    792             return F(b) - F(a)
    793 

/Applications/sage/local/lib/python2.6/site-packages/sage/functions/piecewise.pyc in integral(self, x, a, b, definite)
    831                 if definite or end != infinity:
    832                     area += fun.integral(x, start, end)
--> 833             new_pieces.append([(start, end), fun_integrated.function(x)])
    834 
    835         if definite:

/Applications/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()

/Applications/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()

/Applications/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2611)()

AttributeError: 'sage.rings.integer.Integer' object has no attribute 'function'
```


ultimately because 0 is special-cased:


```
sage: type(SR(0).integral(x))
<type 'sage.rings.integer.Integer'>
sage: type(SR(1).integral(x))
<type 'sage.symbolic.expression.Expression'>
```


and the code path for a zero in Piecewise.integral never coerces to SR, so .function fails.


---

Comment by dsm created at 2011-02-24 08:20:09

Changing component from PLEASE CHANGE to symbolics.


---

Comment by dsm created at 2011-02-24 08:20:09

Changing type from PLEASE CHANGE to defect.


---

Comment by dsm created at 2011-02-24 08:20:09

Changing assignee from tbd to burcin.


---

Comment by dsm created at 2011-02-24 08:20:09

Changing priority from major to minor.


---

Attachment


---

Comment by kcrisman created at 2011-02-24 14:49:11

I don't have time to review this now, but hopefully not too long.  Do all long tests pass with this change?  

Also, you should feel free to ask the webmaster (Harald Schilly) to add you to http://www.sagemath.org/development-map.html.


---

Comment by wdj created at 2011-02-24 16:17:09

Replying to [comment:3 kcrisman]:
> I don't have time to review this now, but hopefully not too long.  Do all long tests pass with this change?  
> 
> Also, you should feel free to ask the webmaster (Harald Schilly) to add you to http://www.sagemath.org/development-map.html.

I've tested this on one machine on an older version of Sage and sage -testall passed, except for 
failing the (presumably unrelated) R-interface file. Also, the code looks good, has the appropriate doctests
and seems to do what is claimed. I want to test it on one more machine before giving it a positive review though.


---

Comment by wdj created at 2011-02-24 16:17:09

Changing status from new to needs_review.


---

Comment by wdj created at 2011-02-24 19:49:14

Changing status from needs_review to positive_review.


---

Comment by wdj created at 2011-02-24 19:49:14

This applies fine to 4.6.2.rc0 and passes sage -testall -long. Patch reads okay and does what it claims to do.

Thanks very much for making the patch!


---

Comment by jdemeyer created at 2011-03-23 13:53:26

Problems while building the documentation:

```
dochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/functions/piecewise.py:docstring of sage.functions.piecewise.PiecewisePolynomial.integral:83: (WARNING/2) Literal block expected; none found.
```



---

Comment by jdemeyer created at 2011-03-23 13:53:26

Changing status from positive_review to needs_work.


---

Comment by kcrisman created at 2011-03-23 14:39:31

Apply only this patch


---

Attachment

This should fix the problem.


---

Comment by kcrisman created at 2011-03-23 14:40:57

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2011-03-23 14:42:58

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2011-03-23 14:42:58

Yes, it does. 

Note to DSM: it turns out that you only need the double colon in front of doctests.  So if there is verbiage between the `EXAMPLES` or `TESTS` and the actual indented tests, you only use a single colon there.


---

Comment by dsm created at 2011-03-23 14:49:25

Okay, so just so I'm clear: you must use only one colon after EXAMPLE[S] or TESTS if you're going to follow it with text at the indentation level of EXAMPLES and TESTS and not a more deeply indented code section.  If you use two colons, then what comes after *must* be an indented code section, whether you've used "EXAMPLES::" or "EXAMPLE:" and then text and then a bare "::" on a line.

[update: just read kcrisman's explanation. `:^)`]

So does this mean that the merger of my patch for trac #10088 broke the docs?


---

Comment by kcrisman created at 2011-03-23 15:12:02

Well, you'd think so, but it didn't - here's why.  It doesn't 'break' them, just causes a warning.  And if they aren't in the reference manual - as that file apparently isn't - it won't break them, since there is no warning, since they are never actually built.


---

Comment by kcrisman created at 2011-03-23 15:12:43

That's not to say such things shouldn't be fixed eventually.  But that would happen when such files are put into the reference manual; even I wouldn't do a ticket for something _that_ trivial.


---

Comment by jdemeyer created at 2011-03-25 12:30:32

Resolution: fixed
