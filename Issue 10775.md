# Issue 10775: piecewise integrals of 0 fail

archive/issues_010775.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @kcrisman\n\nAs reported in [a sage-support thread](http://groups.google.com/group/sage-support/browse_thread/thread/7d0fdb331d05c557), in 4.6.1 we see that\n\n\n```\nsage: # succeeds\nsage: f = Piecewise([[(0,1),1]])\nsage: f.integral(x,0,1)\n1\nsage: # fails\nsage: f = Piecewise([[(0,1),0]])\nsage: f.integral(x,0,1)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/all_cmdline.pyc in <module>()\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/functions/piecewise.pyc in integral(self, x, a, b, definite)\n    789         \"\"\"\n    790         if a != None and b != None:\n--> 791             F = self.integral(x)\n    792             return F(b) - F(a)\n    793 \n\n/Applications/sage/local/lib/python2.6/site-packages/sage/functions/piecewise.pyc in integral(self, x, a, b, definite)\n    831                 if definite or end != infinity:\n    832                     area += fun.integral(x, start, end)\n--> 833             new_pieces.append([(start, end), fun_integrated.function(x)])\n    834 \n    835         if definite:\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2611)()\n\nAttributeError: 'sage.rings.integer.Integer' object has no attribute 'function'\n```\n\n\nultimately because 0 is special-cased:\n\n\n```\nsage: type(SR(0).integral(x))\n<type 'sage.rings.integer.Integer'>\nsage: type(SR(1).integral(x))\n<type 'sage.symbolic.expression.Expression'>\n```\n\n\nand the code path for a zero in Piecewise.integral never coerces to SR, so .function fails.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10841\n\n",
    "created_at": "2011-02-24T08:19:32Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "piecewise integrals of 0 fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10775",
    "user": "dsm"
}
```
Assignee: tbd

CC:  @kcrisman

As reported in [a sage-support thread](http://groups.google.com/group/sage-support/browse_thread/thread/7d0fdb331d05c557), in 4.6.1 we see that


```
sage: # succeeds
sage: f = Piecewise([[(0,1),1]])
sage: f.integral(x,0,1)
1
sage: # fails
sage: f = Piecewise([[(0,1),0]])
sage: f.integral(x,0,1)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/Applications/sage/local/lib/python2.6/site-packages/sage/all_cmdline.pyc in <module>()

/Applications/sage/local/lib/python2.6/site-packages/sage/functions/piecewise.pyc in integral(self, x, a, b, definite)
    789         """
    790         if a != None and b != None:
--> 791             F = self.integral(x)
    792             return F(b) - F(a)
    793 

/Applications/sage/local/lib/python2.6/site-packages/sage/functions/piecewise.pyc in integral(self, x, a, b, definite)
    831                 if definite or end != infinity:
    832                     area += fun.integral(x, start, end)
--> 833             new_pieces.append([(start, end), fun_integrated.function(x)])
    834 
    835         if definite:

/Applications/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()

/Applications/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()

/Applications/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2611)()

AttributeError: 'sage.rings.integer.Integer' object has no attribute 'function'
```


ultimately because 0 is special-cased:


```
sage: type(SR(0).integral(x))
<type 'sage.rings.integer.Integer'>
sage: type(SR(1).integral(x))
<type 'sage.symbolic.expression.Expression'>
```


and the code path for a zero in Piecewise.integral never coerces to SR, so .function fails.

Issue created by migration from https://trac.sagemath.org/ticket/10841





---

archive/issue_comments_114062.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to symbolics.",
    "created_at": "2011-02-24T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114062",
    "user": "dsm"
}
```

Changing component from PLEASE CHANGE to symbolics.



---

archive/issue_comments_114063.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2011-02-24T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114063",
    "user": "dsm"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_114064.json:
```json
{
    "body": "Changing assignee from tbd to @burcin.",
    "created_at": "2011-02-24T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114064",
    "user": "dsm"
}
```

Changing assignee from tbd to @burcin.



---

archive/issue_comments_114065.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2011-02-24T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114065",
    "user": "dsm"
}
```

Changing priority from major to minor.



---

archive/issue_comments_114066.json:
```json
{
    "body": "Attachment [trac_10841_fix_piecewise_integrals_of_zero.patch](tarball://root/attachments/some-uuid/ticket10841/trac_10841_fix_piecewise_integrals_of_zero.patch) by dsm created at 2011-02-24 13:56:10",
    "created_at": "2011-02-24T13:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114066",
    "user": "dsm"
}
```

Attachment [trac_10841_fix_piecewise_integrals_of_zero.patch](tarball://root/attachments/some-uuid/ticket10841/trac_10841_fix_piecewise_integrals_of_zero.patch) by dsm created at 2011-02-24 13:56:10



---

archive/issue_comments_114067.json:
```json
{
    "body": "I don't have time to review this now, but hopefully not too long.  Do all long tests pass with this change?  \n\nAlso, you should feel free to ask the webmaster (Harald Schilly) to add you to http://www.sagemath.org/development-map.html.",
    "created_at": "2011-02-24T14:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114067",
    "user": "@kcrisman"
}
```

I don't have time to review this now, but hopefully not too long.  Do all long tests pass with this change?  

Also, you should feel free to ask the webmaster (Harald Schilly) to add you to http://www.sagemath.org/development-map.html.



---

archive/issue_comments_114068.json:
```json
{
    "body": "Replying to [comment:3 kcrisman]:\n> I don't have time to review this now, but hopefully not too long.  Do all long tests pass with this change?  \n> \n> Also, you should feel free to ask the webmaster (Harald Schilly) to add you to http://www.sagemath.org/development-map.html.\n\nI've tested this on one machine on an older version of Sage and sage -testall passed, except for \nfailing the (presumably unrelated) R-interface file. Also, the code looks good, has the appropriate doctests\nand seems to do what is claimed. I want to test it on one more machine before giving it a positive review though.",
    "created_at": "2011-02-24T16:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114068",
    "user": "@wdjoyner"
}
```

Replying to [comment:3 kcrisman]:
> I don't have time to review this now, but hopefully not too long.  Do all long tests pass with this change?  
> 
> Also, you should feel free to ask the webmaster (Harald Schilly) to add you to http://www.sagemath.org/development-map.html.

I've tested this on one machine on an older version of Sage and sage -testall passed, except for 
failing the (presumably unrelated) R-interface file. Also, the code looks good, has the appropriate doctests
and seems to do what is claimed. I want to test it on one more machine before giving it a positive review though.



---

archive/issue_comments_114069.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-24T16:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114069",
    "user": "@wdjoyner"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_114070.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-24T19:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114070",
    "user": "@wdjoyner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_114071.json:
```json
{
    "body": "This applies fine to 4.6.2.rc0 and passes sage -testall -long. Patch reads okay and does what it claims to do.\n\nThanks very much for making the patch!",
    "created_at": "2011-02-24T19:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114071",
    "user": "@wdjoyner"
}
```

This applies fine to 4.6.2.rc0 and passes sage -testall -long. Patch reads okay and does what it claims to do.

Thanks very much for making the patch!



---

archive/issue_comments_114072.json:
```json
{
    "body": "Problems while building the documentation:\n\n```\ndochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/functions/piecewise.py:docstring of sage.functions.piecewise.PiecewisePolynomial.integral:83: (WARNING/2) Literal block expected; none found.\n```\n",
    "created_at": "2011-03-23T13:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114072",
    "user": "@jdemeyer"
}
```

Problems while building the documentation:

```
dochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/functions/piecewise.py:docstring of sage.functions.piecewise.PiecewisePolynomial.integral:83: (WARNING/2) Literal block expected; none found.
```




---

archive/issue_comments_114073.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-03-23T13:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114073",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_114074.json:
```json
{
    "body": "Apply only this patch",
    "created_at": "2011-03-23T14:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114074",
    "user": "@kcrisman"
}
```

Apply only this patch



---

archive/issue_comments_114075.json:
```json
{
    "body": "Attachment [trac_10841_fix_piecewise_integrals_of_zero.2.patch](tarball://root/attachments/some-uuid/ticket10841/trac_10841_fix_piecewise_integrals_of_zero.2.patch) by @kcrisman created at 2011-03-23 14:40:57\n\nThis should fix the problem.",
    "created_at": "2011-03-23T14:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114075",
    "user": "@kcrisman"
}
```

Attachment [trac_10841_fix_piecewise_integrals_of_zero.2.patch](tarball://root/attachments/some-uuid/ticket10841/trac_10841_fix_piecewise_integrals_of_zero.2.patch) by @kcrisman created at 2011-03-23 14:40:57

This should fix the problem.



---

archive/issue_comments_114076.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-23T14:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114076",
    "user": "@kcrisman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_114077.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-23T14:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114077",
    "user": "@kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_114078.json:
```json
{
    "body": "Yes, it does. \n\nNote to DSM: it turns out that you only need the double colon in front of doctests.  So if there is verbiage between the `EXAMPLES` or `TESTS` and the actual indented tests, you only use a single colon there.",
    "created_at": "2011-03-23T14:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114078",
    "user": "@kcrisman"
}
```

Yes, it does. 

Note to DSM: it turns out that you only need the double colon in front of doctests.  So if there is verbiage between the `EXAMPLES` or `TESTS` and the actual indented tests, you only use a single colon there.



---

archive/issue_comments_114079.json:
```json
{
    "body": "Okay, so just so I'm clear: you must use only one colon after EXAMPLE[S] or TESTS if you're going to follow it with text at the indentation level of EXAMPLES and TESTS and not a more deeply indented code section.  If you use two colons, then what comes after *must* be an indented code section, whether you've used \"EXAMPLES::\" or \"EXAMPLE:\" and then text and then a bare \"::\" on a line.\n\n[update: just read kcrisman's explanation. `:^)`]\n\nSo does this mean that the merger of my patch for trac #10088 broke the docs?",
    "created_at": "2011-03-23T14:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114079",
    "user": "dsm"
}
```

Okay, so just so I'm clear: you must use only one colon after EXAMPLE[S] or TESTS if you're going to follow it with text at the indentation level of EXAMPLES and TESTS and not a more deeply indented code section.  If you use two colons, then what comes after *must* be an indented code section, whether you've used "EXAMPLES::" or "EXAMPLE:" and then text and then a bare "::" on a line.

[update: just read kcrisman's explanation. `:^)`]

So does this mean that the merger of my patch for trac #10088 broke the docs?



---

archive/issue_comments_114080.json:
```json
{
    "body": "Well, you'd think so, but it didn't - here's why.  It doesn't 'break' them, just causes a warning.  And if they aren't in the reference manual - as that file apparently isn't - it won't break them, since there is no warning, since they are never actually built.",
    "created_at": "2011-03-23T15:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114080",
    "user": "@kcrisman"
}
```

Well, you'd think so, but it didn't - here's why.  It doesn't 'break' them, just causes a warning.  And if they aren't in the reference manual - as that file apparently isn't - it won't break them, since there is no warning, since they are never actually built.



---

archive/issue_comments_114081.json:
```json
{
    "body": "That's not to say such things shouldn't be fixed eventually.  But that would happen when such files are put into the reference manual; even I wouldn't do a ticket for something *that* trivial.",
    "created_at": "2011-03-23T15:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114081",
    "user": "@kcrisman"
}
```

That's not to say such things shouldn't be fixed eventually.  But that would happen when such files are put into the reference manual; even I wouldn't do a ticket for something *that* trivial.



---

archive/issue_comments_114082.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-25T12:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10775#issuecomment-114082",
    "user": "@jdemeyer"
}
```

Resolution: fixed
