# Issue 14639: Minor improvments to 4ti2 interface

Issue created by migration from https://trac.sagemath.org/ticket/14843

Original creator: mmarco

Original creation time: 2013-06-30 23:32:35

Assignee: mmarco

CC:  mhansen broune mhampton

Keywords: 4ti2

Here is a patch that introduces these two minor improvements to 4ti2 interface:
-It allows to pass the lattice to the methods instead of the matrix, using the lat parmeter.
-Changes the verbose default to False, so we only get the output.

Example:


```
sage: four_ti_2.graver(lat=[[1,2,3],[1,1,1]])
[ 1  0 -1]
[ 0  1  2]
[ 1  1  1]
[ 2  1  0]
```



---

Attachment

Just curious:  Is anyone of you working on fixing (/upgrading) the optional 4ti2 spkg?

(IIRC there's a ticket for doing so, but I don't recall right now.)


---

Comment by leif created at 2013-07-01 11:56:55

Replying to [comment:1 leif]:
> Just curious:  Is anyone of you working on fixing (/upgrading) the optional 4ti2 spkg?
> 
> (IIRC there's a ticket for doing so, but I don't recall right now.)

There's #13498 at least...


---

Comment by mmarco created at 2013-07-01 12:07:25

Do you mean #13498?

In my case, 4ti2 spkg compiled without complaining... but it didn't detect GMP, and hence, didn't build the 4ti2gmp binary (which is used, for instance, by the groebner binary).

In order to use it, i had to link my system-wide 4ti2gmp to $SAGE/local/bin


---

Comment by dimpase created at 2013-09-07 13:39:52

Replying to [comment:2 leif]:
> Replying to [comment:1 leif]:
> > Just curious:  Is anyone of you working on fixing (/upgrading) the optional 4ti2 spkg?
> > 
> > (IIRC there's a ticket for doing so, but I don't recall right now.)
> 
> There's #13498 at least...

there is #15172.


---

Comment by dimpase created at 2013-09-08 12:58:58

rebased for 4ti2-1.6, #15172


---

Attachment

The work on the interface to `4ti2` ought to be based on the version 1.6, for 1.3 is very old. Thus I made the ticket dependent on #15172, and attached the corresponding rebased patch.

It seems that `lat=` only makes sense for `zsolve`, but not for `qsolve`, `circuits`, `rays`. This is confirmed by the doctests as well as by the source code comments. Please rectify this.


---

Comment by dimpase created at 2013-09-08 13:04:33

Changing status from new to needs_info.


---

Comment by chapoton created at 2014-07-25 14:56:10

I made a branch from the patch. Got two failing doctests on 6.3.beta6 :

```
Failed example:
    four_ti_2.circuits(lat=[[1,2,3],[1,1,1]])
Expected:
    [ 0  1  2]
    [ 1  0 -1]
    [ 2  1  0]
Got:
    Error: Unable to find 4ti2 executable `4ti2gmp'
    []
```

and

```
Failed example:
    four_ti_2.groebner(lat=[[1,2,3],[1,1,1]])
Expected:
    [-1  0  1]
    [ 2  1  0]
Got:
    Error: Unable to find 4ti2 executable `4ti2gmp'
    []

```

----
New commits:


---

Comment by chapoton created at 2014-07-25 14:57:04

Changing status from needs_info to needs_work.


---

Comment by dimpase created at 2014-07-25 15:07:08

Replying to [comment:9 chapoton]:
Did you do `sage -i 4ti2` ? If yes, then
do you have `4ti2gmp` in `SAGE_LOCAL/bin` ?


---

Comment by chapoton created at 2014-07-25 18:15:50

I had just installed 4ti2, before running the tests. But there is no `4ti2gmp` in `SAGE_LOCAL/bin`, only 4ti2int32 and 4ti2int64.


---

Comment by dimpase created at 2014-07-25 18:24:21

I can't reproduce this, I just tried installing 4ti2 on the latest Sage beta (on 64-bit Fedora Linux), and got it all there:

```
sage-6.3.beta6/local/bin]$ ls -l 4ti*
-rwxr-xr-x 1 dimpase tcs-staff 55501 Jul 25 16:17 4ti2gmp
-rwxr-xr-x 1 dimpase tcs-staff 55553 Jul 25 16:17 4ti2int32
-rwxr-xr-x 1 dimpase tcs-staff 55553 Jul 25 16:17 4ti2int64
```


please look into your install log to see is something has failed...

PS. It also works for me on OSX 10.9.4.


---

Comment by chapoton created at 2014-07-25 18:34:47

hmm, do you know where the log is ?

found in the log:

```
checking for GMP >= 3.1.1... configure: WARNING: GNU MP not found.
4ti2 will be built without support for arbitrary-precision computations.
configure: WARNING: Unable to use the GNU MP C++ library.
Please make sure that GNU MP was configured with "--enable-cxx".
4ti2 will be built without support for arbitrary-precision computations.
```



---

Comment by chapoton created at 2014-07-25 18:42:56

On another machine (where 4ti2gmp is present), got just one failure:

```
Failed example:
    four_ti_2.circuits(lat=[[1,2,3],[1,1,1]])
Expected:
    [ 0  1  2]
    [ 1  0 -1]
    [ 2  1  0]
Got:
    ERROR: No constraint matrix specified.
    ERROR: Expected matrix in 'project_3.mat'
    []
```



---

Comment by dimpase created at 2014-07-25 19:03:03

Replying to [comment:13 chapoton]:
> hmm, do you know where the log is ?
> 
> found in the log:
> {{{
> checking for GMP >= 3.1.1... configure: WARNING: GNU MP not found.
> 4ti2 will be built without support for arbitrary-precision computations.
> configure: WARNING: Unable to use the GNU MP C++ library.
> Please make sure that GNU MP was configured with "--enable-cxx".
> 4ti2 will be built without support for arbitrary-precision computations.
> }}}
It all works for me. Looks like your're either installing a wrong spkg, or something along these lines.
Attach the complete log here...


---

Attachment

log of the install of 4ti2


---

Comment by chapoton created at 2014-07-25 19:17:33

I am using `sage -i 4ti2`, which installs /4ti2-1.6.2.spkg

Here is the log for the "unique failure, gmp present" case


---

Comment by dimpase created at 2014-07-25 19:50:45

Replying to [comment:16 chapoton]:
> I am using `sage -i 4ti2`, which installs /4ti2-1.6.2.spkg
> 
> Here is the log for the "unique failure, gmp present" case
well, there is nothing interesting in the log in this case, I gather.

I think I never claimed that the patch I provided worked. Look at the comment 5 above. In particular it says that `circuits` don't seem to work with `lat=`.


---

Comment by mmarco created at 2014-07-25 20:09:05

So i guess that means that the doctest is wrong. It should be removed, right?


---

Comment by dimpase created at 2014-07-25 20:57:12

Changing status from needs_work to positive_review.


---

Comment by dimpase created at 2014-07-25 20:57:12

Looks good.
----
New commits:


---

Comment by vbraun created at 2014-07-26 00:06:45

Full name for author next time...


---

Comment by vbraun created at 2014-07-26 01:15:13

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-07-26 01:15:13

I guess these should be `#optional`

```
sage -t --long src/sage/interfaces/four_ti_2.py
**********************************************************************
File "src/sage/interfaces/four_ti_2.py", line 376, in sage.interfaces.four_ti_2.FourTi2.hilbert
Failed example:
    four_ti_2.hilbert(lat=[[1,2,3],[1,1,1]])
Expected:
    [2 1 0]
    [0 1 2]
    [1 1 1]
Got:
    /bin/sh: hilbert: command not found
    []
**********************************************************************
File "src/sage/interfaces/four_ti_2.py", line 399, in sage.interfaces.four_ti_2.FourTi2.graver
Failed example:
    four_ti_2.graver(lat=[[1,2,3],[1,1,1]])
Expected:
    [ 1  0 -1]
    [ 0  1  2]
    [ 1  1  1]
    [ 2  1  0]
Got:
    /bin/sh: graver: command not found
    []
**********************************************************************
File "src/sage/interfaces/four_ti_2.py", line 474, in sage.interfaces.four_ti_2.FourTi2.groebner
Failed example:
    four_ti_2.groebner(lat=[[1,2,3],[1,1,1]])
Expected:
    [-1  0  1]
    [ 2  1  0]
Got:
    /bin/sh: groebner: command not found
    []
**********************************************************************
3 items had failures:
   1 of   3 in sage.interfaces.four_ti_2.FourTi2.graver
   1 of   4 in sage.interfaces.four_ti_2.FourTi2.groebner
   1 of   3 in sage.interfaces.four_ti_2.FourTi2.hilbert
    [41 tests, 3 failures, 0.17 s]
```



---

Comment by chapoton created at 2014-07-26 07:56:09

I have added the optional to doctests where needed, plus replaced a few `...` by `....:` and a few `Runs` by `Run`
----
New commits:


---

Comment by chapoton created at 2014-07-26 07:56:09

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2014-07-26 11:37:47

OK, it's now good. Sorry for missing proper #optional tags in the previous try.


---

Comment by dimpase created at 2014-07-26 11:37:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-07-26 17:05:52

Resolution: fixed
