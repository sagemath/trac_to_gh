# Issue 25692: Python 3 fixes in homology/delta_complex.py

Issue created by migration from https://trac.sagemath.org/ticket/25929

Original creator: jhpalmieri

Original creation time: 2018-07-25 20:36:18

CC:  chapoton tscrim

As in the summary.


---

Comment by jhpalmieri created at 2018-07-25 20:38:56

There are lots of sorting issues in `sage/homology` – the code intentionally tries to sort almost everything, so as to get consistent matrices for boundary maps, etc. This naturally leads to problems with Python 3, because not only does it not want to sort everything, but in cases where sorting was not done explicitly (for a `set`, for example), the default sorting is different between Python 2 and Python 3. I've added a few general fixes for sorting and I've fixed the infinite recursion with `delta_complex.py`. I now get no doctest failures for `cell_complex.py` and `delta_complex.py`.


---

Comment by jhpalmieri created at 2018-07-25 20:40:04

Changing keywords from "" to "python3".


---

Comment by jhpalmieri created at 2018-07-25 20:40:04

Changing type from PLEASE CHANGE to defect.


---

Comment by jhpalmieri created at 2018-07-25 20:40:04

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2018-07-25 20:40:04

New commits:


---

Comment by git created at 2018-08-01 23:39:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-01 23:42:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2018-08-01 23:43:57

Compared to #25932, this ticket only changes `delta_complex.py`.


---

Comment by tscrim created at 2018-08-02 00:37:33

This change makes me nervous:

```diff
             sage: delta_g4 = delta_complexes.SurfaceOfGenus(4)
             sage: delta_g4.f_vector()
-            [1, 5, 33, 22]
+            [1, 3, 27, 18]
```

Is this related to what you mentioned in comment:1? I don't see how your changes could have affected this.


---

Comment by jhpalmieri created at 2018-08-02 01:11:34

It's related to that. The only change in the code inserts sorting into the `elementary_subdivision` method, which is used by `connected_sum`. Before, it was somewhat random which faces were removed and then had their boundaries glued together; with the sorting, it (a) is more deterministic and (b) can lead to different results. It happens that this leads to a smaller model for the surface of genus 4.

In more detail, suppose you want to compute a Delta complex model for a surface of genus n. You start with a torus, which has a Delta complex model with two triangles with some identifications along their boundaries. To avoid problems when forming the connected sum, first subdivide one of the triangles (the last one in the list). Then check to see if the new last face has any identifications along its boundaries. If you're unlucky, you might have to subdivide again. With a different sorting scheme, you might end up with a different "last" face, and also a different result from the subdivision (a different ordering on the new faces obtained from subdividing), and therefore you might have to subdivide a different number of times.

In this case, the new sorting lets us subdivide fewer times, so we get a smaller f-vector.


---

Comment by jhpalmieri created at 2018-08-02 16:48:41

Oh, and this ticket itself is an illustration that the sorting order matters: without the branch here, with Python 3's default sorting on `pi[n]`, after subdividing a cell with identifications along its boundary, the new last cell still has identifications along its boundary, so you get an infinite loop.


---

Comment by tscrim created at 2018-08-03 03:34:35

Thank you for the explanations. LGTM.


---

Comment by tscrim created at 2018-08-03 03:34:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-09-01 09:10:04

Resolution: fixed
