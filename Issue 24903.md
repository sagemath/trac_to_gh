# Issue 24903: Add spkg-legacy-uninstall scripts for most standard packages

archive/issues_024903.json:
```json
{
    "body": "This is a followup to #25139 and represents work that was originally done in #22510 to convert most packages to use `spkg-legacy-uninstall` and remove uninstall-related commands from their `spkg-install` scripts.\n\nThis work was brought over from an older branch and still needs some adjustment: It should incorporate the changes from the #24024 metaticket which conflict with some of these changes.  There are also some additional optional and experimental packages (and maybe a couple standard packages) that still need to be updated as well.\n\nProbably won't bother with that until and unless #25139 is approved of in some form that still includes the `spkg-legacy-uninstall` feature.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25140\n\n",
    "created_at": "2018-04-10T17:42:39Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-pending",
    "title": "Add spkg-legacy-uninstall scripts for most standard packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24903",
    "user": "embray"
}
```
This is a followup to #25139 and represents work that was originally done in #22510 to convert most packages to use `spkg-legacy-uninstall` and remove uninstall-related commands from their `spkg-install` scripts.

This work was brought over from an older branch and still needs some adjustment: It should incorporate the changes from the #24024 metaticket which conflict with some of these changes.  There are also some additional optional and experimental packages (and maybe a couple standard packages) that still need to be updated as well.

Probably won't bother with that until and unless #25139 is approved of in some form that still includes the `spkg-legacy-uninstall` feature.

Issue created by migration from https://trac.sagemath.org/ticket/25140





---

archive/issue_comments_350103.json:
```json
{
    "body": "Changing keywords from \"\" to \"uninstall\".",
    "created_at": "2018-04-10T17:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350103",
    "user": "embray"
}
```

Changing keywords from "" to "uninstall".



---

archive/issue_comments_350104.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2018-04-10T17:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350104",
    "user": "embray"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_350105.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-10T17:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350105",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_350106.json:
```json
{
    "body": "As a reminder, the goal of this is to make it so that `spkg-install` scripts do not modify the contents of `$SAGE_LOCAL` directly.",
    "created_at": "2018-07-10T17:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350106",
    "user": "embray"
}
```

As a reminder, the goal of this is to make it so that `spkg-install` scripts do not modify the contents of `$SAGE_LOCAL` directly.



---

archive/issue_comments_350107.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-10T17:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350107",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_350108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-11T16:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350108",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350109.json:
```json
{
    "body": "Added `spkg-legacy-uninstall` for a few packages that could use it.\n\nThis is now done for at least most, if not all packages that have DESTDIR support from #24024.  It doesn't make sense to do for packages that haven't been converted to the new install/uninstall method yet.  However, for any remaining packages that need to be converted, they should also get an `spkg-legacy-uninstall` at the same time, where appropriate.",
    "created_at": "2018-07-11T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350109",
    "user": "embray"
}
```

Added `spkg-legacy-uninstall` for a few packages that could use it.

This is now done for at least most, if not all packages that have DESTDIR support from #24024.  It doesn't make sense to do for packages that haven't been converted to the new install/uninstall method yet.  However, for any remaining packages that need to be converted, they should also get an `spkg-legacy-uninstall` at the same time, where appropriate.



---

archive/issue_comments_350110.json:
```json
{
    "body": "Feel free to set this to positive review if you are confident that this still works.",
    "created_at": "2018-07-17T15:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350110",
    "user": "saraedum"
}
```

Feel free to set this to positive review if you are confident that this still works.



---

archive/issue_comments_350111.json:
```json
{
    "body": "The pyflakes plugin found an actual bug in the elliptic_curves package; it wasn't otherwise caught since I didn't bump the package versions for this (it isn't really necessary to).\n\nI think I should fix that, and test doing a forced-reinstall of all these packages.  I know I did that a long time ago back when this was part of #22510, but that was then...",
    "created_at": "2018-07-17T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350111",
    "user": "embray"
}
```

The pyflakes plugin found an actual bug in the elliptic_curves package; it wasn't otherwise caught since I didn't bump the package versions for this (it isn't really necessary to).

I think I should fix that, and test doing a forced-reinstall of all these packages.  I know I did that a long time ago back when this was part of #22510, but that was then...



---

archive/issue_comments_350112.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-17T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350112",
    "user": "embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_350113.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-17T16:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350113",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_350114.json:
```json
{
    "body": "I believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350114",
    "user": "embray"
}
```

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_comments_350115.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-24T09:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350115",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_350116.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-07T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350116",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_350117.json:
```json
{
    "body": "First of all, there are merge conflicts.\n\nSecond, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).\n\nI'm not actively against this ticket, it's just that I don't see the point.",
    "created_at": "2018-08-07T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350117",
    "user": "jdemeyer"
}
```

First of all, there are merge conflicts.

Second, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).

I'm not actively against this ticket, it's just that I don't see the point.



---

archive/issue_comments_350118.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> First of all, there are merge conflicts.\n\nWell I mean, there weren't 2 weeks ago and that's obviously resolvable so it's not a big deal.\n\n> Second, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).\n> \n> I'm not actively against this ticket, it's just that I don't see the point.\n\nI'm not in any hurry on this and am also happy to do it gradually.  Though since it's already done I don't see the point in *not* just going ahead and merging this now either.  It would be more work at this point not to.",
    "created_at": "2018-08-08T13:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350118",
    "user": "embray"
}
```

Replying to [comment:13 jdemeyer]:
> First of all, there are merge conflicts.

Well I mean, there weren't 2 weeks ago and that's obviously resolvable so it's not a big deal.

> Second, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).
> 
> I'm not actively against this ticket, it's just that I don't see the point.

I'm not in any hurry on this and am also happy to do it gradually.  Though since it's already done I don't see the point in *not* just going ahead and merging this now either.  It would be more work at this point not to.



---

archive/issue_comments_350119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-08T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350119",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_350120.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-08T13:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350120",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_350121.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2018-08-09T00:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350121",
    "user": "saraedum"
}
```

Looks good to me.



---

archive/issue_comments_350122.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-09T00:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350122",
    "user": "saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350123.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-11T16:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350123",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_350124.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350124",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_350125.json:
```json
{
    "body": "When reinstalling an already installed elliptic_curves:\n\n```\n$ ./sage -p elliptic_curves\n[...]\nNo record that 'elliptic_curves' was ever installed; skipping uninstall\nCreating database /mnt/disk/home/release/Sage/local/share/cremona/cremona_mini.db\nTraceback (most recent call last):\n  File \"spkg-install.py\", line 89, in <module>\n    install_cremona()\n  File \"spkg-install.py\", line 31, in install_cremona\n    con.execute('CREATE TABLE t_class(rank INTEGER, class TEXT PRIMARY KEY,'\nsqlite3.OperationalError: table t_class already exists\n\nreal\t0m0.161s\nuser\t0m0.053s\nsys\t0m0.028s\n************************************************************************\nError installing package elliptic_curves-0.8.p0\n************************************************************************\n```\n\nThis breaks incremental rebuilds...",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350125",
    "user": "vbraun"
}
```

When reinstalling an already installed elliptic_curves:

```
$ ./sage -p elliptic_curves
[...]
No record that 'elliptic_curves' was ever installed; skipping uninstall
Creating database /mnt/disk/home/release/Sage/local/share/cremona/cremona_mini.db
Traceback (most recent call last):
  File "spkg-install.py", line 89, in <module>
    install_cremona()
  File "spkg-install.py", line 31, in install_cremona
    con.execute('CREATE TABLE t_class(rank INTEGER, class TEXT PRIMARY KEY,'
sqlite3.OperationalError: table t_class already exists

real	0m0.161s
user	0m0.053s
sys	0m0.028s
************************************************************************
Error installing package elliptic_curves-0.8.p0
************************************************************************
```

This breaks incremental rebuilds...



---

archive/issue_comments_350126.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350126",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_350127.json:
```json
{
    "body": "Please check that all packages can be installed twice before settings back to positive review.",
    "created_at": "2018-08-12T09:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350127",
    "user": "vbraun"
}
```

Please check that all packages can be installed twice before settings back to positive review.



---

archive/issue_comments_350128.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-08-14T15:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350128",
    "user": "embray"
}
```

New commits:



---

archive/issue_comments_350129.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-14T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350129",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350130.json:
```json
{
    "body": "Yes, there were still several problems with the spkg-install for elliptic_curves; I think it should just be updated in a separate ticket.  It should not have been included in this ticket in the first place since it was only intending to update packages that already had working DESTDIR support.\n----\nNew commits:",
    "created_at": "2018-08-14T16:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350130",
    "user": "embray"
}
```

Yes, there were still several problems with the spkg-install for elliptic_curves; I think it should just be updated in a separate ticket.  It should not have been included in this ticket in the first place since it was only intending to update packages that already had working DESTDIR support.
----
New commits:



---

archive/issue_comments_350131.json:
```json
{
    "body": "Retargeting some of my tickets (somewhat optimistically for now).",
    "created_at": "2018-12-28T14:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350131",
    "user": "embray"
}
```

Retargeting some of my tickets (somewhat optimistically for now).



---

archive/issue_comments_350132.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-09T17:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350132",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_350133.json:
```json
{
    "body": "Set assignee to embray.",
    "created_at": "2019-01-09T17:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350133",
    "user": "embray"
}
```

Set assignee to embray.



---

archive/issue_comments_350134.json:
```json
{
    "body": "Rebased this, though some of these are now handled in other tickets so I need to clean it up a bit more (focus only on packages that already otherwise have been fixed as part of #24024).",
    "created_at": "2019-01-09T17:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350134",
    "user": "embray"
}
```

Rebased this, though some of these are now handled in other tickets so I need to clean it up a bit more (focus only on packages that already otherwise have been fixed as part of #24024).



---

archive/issue_comments_350135.json:
```json
{
    "body": "Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.",
    "created_at": "2019-03-25T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24903",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24903#issuecomment-350135",
    "user": "embray"
}
```

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.
