# Issue 26251: Remove one usage of SAGE_ROOT in doctests

Issue created by migration from Trac.

Original creator: arojas

Original creation time: 2018-10-14 08:37:40

CC:  saraedum @timokau fbissey




---

Comment by arojas created at 2018-10-14 08:42:45

Changing status from new to needs_review.


---

Comment by arojas created at 2018-10-14 08:42:45

New commits:


---

Comment by arojas created at 2018-10-14 08:42:45

Changing keywords from "" to "packaging".


---

Comment by arojas created at 2018-10-14 08:42:45

Changing component from PLEASE CHANGE to doctest coverage.


---

Comment by arojas created at 2018-10-14 08:42:45

Changing type from PLEASE CHANGE to enhancement.


---

Comment by fbissey created at 2018-10-14 09:04:31

Yes I have that one in my bag. Technically here the issue is that the doctest won't find the same "sage" executable  (SAGE_LOCAL/bin/sage instead of SAGE_ROOT/sage). The ability to find an executable in a particular path (not necessarily part of `PATH`) is not tested. The modified test becomes redundant with 

```
        sage: from sage.misc.sage_ostools import have_program
        sage: have_program('ls')
        True
```

in the same series of doctests.

Do we have something that wouldn't be in a standard path that could be tested instead?


---

Comment by git created at 2018-10-14 09:10:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2018-10-14 09:13:55

I guess the only option that would work in all platforms/distros is SAGE_LOCAL/bin


---

Comment by fbissey created at 2018-10-14 09:20:26

Yes but that's just part of `PATH`. I am thinking if we want to do things right, we have to do something more complicated than that. If there wasn't that `SAGE_ROOT/sage` script in sage the distribution they would have had to write a totally different doctest for that functionality. I think that's what we have to do now.

So I think it needs to go that way.
* create a temporary directory 
* write a small executable script in that directory
* test the function
* remove the script
* do another test to try to find the executable in that directory again (to replace the other test you just removed and that should return false)
* clean up the temporary directory


---

Comment by arojas created at 2018-10-14 09:23:09

have_program doesn't search in PATH if a path= parameter is passed to it.


---

Comment by fbissey created at 2018-10-14 09:26:33

Hum you have a strong point here to simplify things. Do a replacement for `ls` in a wrong location and I'll be happy.


---

Comment by git created at 2018-10-14 12:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2018-10-14 13:01:19

Replying to [comment:8 fbissey]:
> Hum you have a strong point here to simplify things. Do a replacement for `ls` in a wrong location and I'll be happy.

Done


---

Comment by fbissey created at 2018-10-14 20:18:02

Author please. Unfortunately that won't make it into 8.4.


---

Comment by fbissey created at 2018-10-14 20:24:00

Changing status from needs_review to positive_review.


---

Comment by @timokau created at 2018-10-16 08:21:58

I kind of cheated my way around this by setting `SAGE_ROOT` to the location of the sage source, so I wasn't aware of the problem. This is very much better, thanks!


---

Comment by vbraun created at 2018-10-20 19:02:40

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
