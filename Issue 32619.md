# Issue 32619: Get rid of "# optional - build"

Issue created by migration from https://trac.sagemath.org/ticket/32856

Original creator: mkoeppe

Original creation time: 2021-11-11 21:35:47

CC:  jhpalmieri fbissey slabbe arojas

Most of its uses should be replaced by `# optional - sage_spkg`



---

Comment by mkoeppe created at 2021-11-21 02:36:35

New commits:


---

Comment by mkoeppe created at 2021-11-21 02:36:35

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2021-11-21 03:12:59

Also remove "build" from `TESTALL_FLAGS` in `Makefile`?


---

Comment by mkoeppe created at 2021-11-21 03:19:57

Ah, I knew I forgot something


---

Comment by git created at 2021-11-21 03:24:14

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by jhpalmieri created at 2021-11-30 01:05:56

The changes make sense to me. fbissey, arojas, et al.: can you please evaluate it from the distro point of view?


---

Comment by fbissey created at 2021-11-30 01:28:18

It is always a bit difficult when a big dependency is merged :(

Anyway focusing on the individual commits at the beginning. 
 * From the detection pattern I see in `sage-runtests`, I would have never tested something with a tag "build" before the change. 
 * The stuff in `sage_setup` will pass, I checked it. 
 * I replace `package.py` with a minimal file with no affected tests.
 * I am unsure what will happen in `tests/cmdline.py`, those tests would have been skipped before, I am not quite sure what happens to them now. I don't know how `sage_spkg` is triggered but if it is some of these tests will fail (`sage --info ...`).

By the way, I believe there is a space missing at https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/tests/cmdline.py?id=c9b48a3c200d4f41c576e339ebe0a37cbac074e0#n210
at the very least it is inconsistent with the rest.


---

Comment by mkoeppe created at 2021-11-30 01:39:17

Replying to [comment:10 fbissey]:
> I don't know how `sage_spkg` is triggered 

It is triggered by `sage -p` returning without error (see `SagePackageSystem._is_present`)


---

Comment by git created at 2021-11-30 01:40:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2021-11-30 01:41:45

Replying to [comment:11 mkoeppe]:
> Replying to [comment:10 fbissey]:
> > I don't know how `sage_spkg` is triggered 
> 
> It is triggered by `sage -p` returning without error (see `SagePackageSystem._is_present`)

Then I won't ever test that :)

```
fbissey@tarazed ~ $ sage -p
/usr/bin/sage: line 1087: exec: sage-spkg: not found
```



---

Comment by mkoeppe created at 2021-11-30 01:42:46

Excellent, this works as intended.


---

Comment by fbissey created at 2021-11-30 01:45:36

OK, all good to me then. Don't know about Antonio.


---

Comment by arojas created at 2021-11-30 16:20:07

Looks good to me too.


---

Comment by jhpalmieri created at 2021-11-30 19:29:51

Let's merge it, then.


---

Comment by jhpalmieri created at 2021-11-30 19:29:51

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-11-30 21:06:01

Thanks all for reviewing!


---

Comment by git created at 2021-12-12 17:58:57

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-12-12 17:58:57

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-12-12 17:59:43

Changing status from needs_review to positive_review.


---

Comment by git created at 2021-12-23 21:23:17

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-12-23 21:23:17

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-12-23 21:23:27

Merged updated #32759.


---

Comment by jhpalmieri created at 2021-12-23 23:15:37

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-12-24 00:07:10

Thank you.


---

Comment by vbraun created at 2022-01-02 12:32:20

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-01-02 12:32:20

tests...


---

Comment by jhpalmieri created at 2022-01-02 21:56:55

I'm having problems building this, in fact. There is a bad merge in `doctest/control.py` (`<<<<<<<<< HEAD` is present) and the new passage has `from sage.features.sagemath import sage_features`, but there is no `sage_features`. If I change to use `all_features`, then I get

```
TypeError: all_features() got an unexpected keyword argument 'logger'
```



---

Comment by git created at 2022-01-02 22:08:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-01-02 22:08:13

Merged updated #32759.


---

Comment by mkoeppe created at 2022-01-02 22:08:27

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2022-01-03 03:12:46

I think you're missing the most recent commit from #32759 — the one fixing output for a doctest.


---

Comment by git created at 2022-01-03 03:14:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2022-01-04 02:25:23

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2022-01-04 02:25:23

I think this is good now. All tests pass for me.


---

Comment by mkoeppe created at 2022-01-04 03:05:10

Thanks!


---

Comment by vbraun created at 2022-01-31 23:31:10

Resolution: fixed
