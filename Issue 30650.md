# Issue 30650: spkg-configure.m4 for 4ti2

archive/issues_030650.json:
```json
{
    "body": "CC:  @dimpase @orlitzky @slel @antonio-rojas @kiwifb @jengelh @kwankyu @seblabbe\n\nIn addition to adjustments to `src/sage/interfaces/four_ti_2.py`, also the following needs changing:\n\n```\nsrc/sage/sandpiles/sandpile.py:path_to_zsolve = os.path.join(SAGE_LOCAL, 'bin', 'zsolve')\n```\n\n\nhttps://repology.org/project/4ti2/versions\n\nIssue created by migration from https://trac.sagemath.org/ticket/30887\n\n",
    "created_at": "2020-11-11T01:24:52Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "spkg-configure.m4 for 4ti2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30650",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @orlitzky @slel @antonio-rojas @kiwifb @jengelh @kwankyu @seblabbe

In addition to adjustments to `src/sage/interfaces/four_ti_2.py`, also the following needs changing:

```
src/sage/sandpiles/sandpile.py:path_to_zsolve = os.path.join(SAGE_LOCAL, 'bin', 'zsolve')
```


https://repology.org/project/4ti2/versions

Issue created by migration from https://trac.sagemath.org/ticket/30887





---

archive/issue_comments_437573.json:
```json
{
    "body": "Changing keywords from \"\" to \"4ti2, spkg-configure.m4\".",
    "created_at": "2021-03-22T01:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437573",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "4ti2, spkg-configure.m4".



---

archive/issue_comments_437574.json:
```json
{
    "body": "Here is distro information to get things started.\n----\nNew commits:",
    "created_at": "2021-03-22T01:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437574",
    "user": "https://github.com/slel"
}
```

Here is distro information to get things started.
----
New commits:



---

archive/issue_comments_437575.json:
```json
{
    "body": "`latte_int` uses `4ti2` as a library. The test is here: https://github.com/latte-int/latte/blob/master/m4/4ti2-check.m4#L48",
    "created_at": "2021-03-23T19:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437575",
    "user": "https://github.com/mkoeppe"
}
```

`latte_int` uses `4ti2` as a library. The test is here: https://github.com/latte-int/latte/blob/master/m4/4ti2-check.m4#L48



---

archive/issue_comments_437576.json:
```json
{
    "body": "Also `Py4ti2` (to be added in #31363) uses `4ti2` as a library - https://github.com/alfsan/Py4ti2/blob/master/setup.py",
    "created_at": "2021-03-23T19:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437576",
    "user": "https://github.com/mkoeppe"
}
```

Also `Py4ti2` (to be added in #31363) uses `4ti2` as a library - https://github.com/alfsan/Py4ti2/blob/master/setup.py



---

archive/issue_comments_437577.json:
```json
{
    "body": "`singular` is able to use `4ti2` via the command-line interface. Checks are done in https://github.com/Singular/Singular/blob/spielwiese/configure.ac#L352\n\n```\nconfigure.ac:AC_CHECK_PROGS([FOURTITWO_HILBERT], [hilbert 4ti2-hilbert])\nconfigure.ac:AC_CHECK_PROGS([FOURTITWO_MARKOV], [markov 4ti2-markov])\nconfigure.ac:AC_CHECK_PROGS([FOURTITWO_GRAVER], [graver 4ti2-graver])\n```\n",
    "created_at": "2021-03-23T19:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437577",
    "user": "https://github.com/mkoeppe"
}
```

`singular` is able to use `4ti2` via the command-line interface. Checks are done in https://github.com/Singular/Singular/blob/spielwiese/configure.ac#L352

```
configure.ac:AC_CHECK_PROGS([FOURTITWO_HILBERT], [hilbert 4ti2-hilbert])
configure.ac:AC_CHECK_PROGS([FOURTITWO_MARKOV], [markov 4ti2-markov])
configure.ac:AC_CHECK_PROGS([FOURTITWO_GRAVER], [graver 4ti2-graver])
```




---

archive/issue_comments_437578.json:
```json
{
    "body": "`src/sage/interfaces/four_ti_2.py` calls the executables \n\n```\n$ grep call src/sage/interfaces/four_ti_2.py\n    def call(self, command, project, verbose=True):\n            sage: four_ti_2.call(\"groebner\", \"test_file\", False) # optional - 4ti2\n        subprocess.call(cmd, shell=True, cwd=self.directory())\n        self.call('zsolve -q', project)\n        self.call('qsolve -q -parbitrary', project)\n        self.call('rays -q -parbitrary', project)\n        self.call('hilbert -q', project)\n        self.call('graver -q', project)\n        self.call('ppi 2> /dev/null', n)\n        self.call('circuits -q -parbitrary', project)\n        self.call('groebner -q -parbitrary', project)\n```\n\nand does not know that Debian installs them with an executable prefix.",
    "created_at": "2021-03-23T19:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437578",
    "user": "https://github.com/mkoeppe"
}
```

`src/sage/interfaces/four_ti_2.py` calls the executables 

```
$ grep call src/sage/interfaces/four_ti_2.py
    def call(self, command, project, verbose=True):
            sage: four_ti_2.call("groebner", "test_file", False) # optional - 4ti2
        subprocess.call(cmd, shell=True, cwd=self.directory())
        self.call('zsolve -q', project)
        self.call('qsolve -q -parbitrary', project)
        self.call('rays -q -parbitrary', project)
        self.call('hilbert -q', project)
        self.call('graver -q', project)
        self.call('ppi 2> /dev/null', n)
        self.call('circuits -q -parbitrary', project)
        self.call('groebner -q -parbitrary', project)
```

and does not know that Debian installs them with an executable prefix.



---

archive/issue_comments_437579.json:
```json
{
    "body": "`polymake` calls the executables `groebner`, `zsolve`, `circuits`, which are configurable (https://github.com/polymake/polymake/blob/c2a326f240b11a06e1b1d5fd1c2ca7278bbe60a2/apps/polytope/rules/_4ti2.rules) but it does not know that Debian installs them with an executable prefix",
    "created_at": "2021-03-23T20:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437579",
    "user": "https://github.com/mkoeppe"
}
```

`polymake` calls the executables `groebner`, `zsolve`, `circuits`, which are configurable (https://github.com/polymake/polymake/blob/c2a326f240b11a06e1b1d5fd1c2ca7278bbe60a2/apps/polytope/rules/_4ti2.rules) but it does not know that Debian installs them with an executable prefix



---

archive/issue_comments_437580.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-23T23:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437580",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_437581.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T02:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-06-23T23:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_437583.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T23:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437584.json:
```json
{
    "body": "On `ubuntu-focal-maximal`:\n\n```\nChecking whether SageMath should install SPKG 4ti2...\nchecking whether any of gmp mpir glpk zlib is installed as or will be installed as SPKG... no\nchecking for hilbert... no\nchecking for 4ti2-hilbert... 4ti2-hilbert\nchecking for markov... no\nchecking for 4ti2-markov... 4ti2-markov\nchecking for graver... no\nchecking for 4ti2-graver... 4ti2-graver\nchecking for zsolve... no\nchecking for 4ti2-zsolve... 4ti2-zsolve\nchecking for qsolve... no\nchecking for 4ti2-qsolve... 4ti2-qsolve\nchecking for rays... no\nchecking for 4ti2-rays... 4ti2-rays\nchecking for ppi... no\nchecking for 4ti2-ppi... 4ti2-ppi\nchecking for circuits... no\nchecking for 4ti2-circuits... 4ti2-circuits\nchecking for groebner... no\nchecking for 4ti2-groebner... 4ti2-groebner\nchecking for library 4ti2gmp... no\nconfigure: no suitable system package found for SPKG 4ti2\n```\n",
    "created_at": "2021-06-23T23:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437584",
    "user": "https://github.com/mkoeppe"
}
```

On `ubuntu-focal-maximal`:

```
Checking whether SageMath should install SPKG 4ti2...
checking whether any of gmp mpir glpk zlib is installed as or will be installed as SPKG... no
checking for hilbert... no
checking for 4ti2-hilbert... 4ti2-hilbert
checking for markov... no
checking for 4ti2-markov... 4ti2-markov
checking for graver... no
checking for 4ti2-graver... 4ti2-graver
checking for zsolve... no
checking for 4ti2-zsolve... 4ti2-zsolve
checking for qsolve... no
checking for 4ti2-qsolve... 4ti2-qsolve
checking for rays... no
checking for 4ti2-rays... 4ti2-rays
checking for ppi... no
checking for 4ti2-ppi... 4ti2-ppi
checking for circuits... no
checking for 4ti2-circuits... 4ti2-circuits
checking for groebner... no
checking for 4ti2-groebner... 4ti2-groebner
checking for library 4ti2gmp... no
configure: no suitable system package found for SPKG 4ti2
```




---

archive/issue_comments_437585.json:
```json
{
    "body": "Ubuntu packaging does not have the headers and has the shared libs in a nonstandard place - can't use",
    "created_at": "2021-06-24T00:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437585",
    "user": "https://github.com/mkoeppe"
}
```

Ubuntu packaging does not have the headers and has the shared libs in a nonstandard place - can't use



---

archive/issue_comments_437586.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T01:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437586",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437587.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-24T01:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437587",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437588.json:
```json
{
    "body": "I didn't realize that `zsolve` is a part of `4ti2`. Gentoo isn't following debian naming (for now). It all look OK from a Gentoo point of view. I'll give it a proper run through later tonight.",
    "created_at": "2021-06-24T01:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437588",
    "user": "https://github.com/kiwifb"
}
```

I didn't realize that `zsolve` is a part of `4ti2`. Gentoo isn't following debian naming (for now). It all look OK from a Gentoo point of view. I'll give it a proper run through later tonight.



---

archive/issue_comments_437589.json:
```json
{
    "body": "Works and doctest with system 4ti2 on Gentoo.",
    "created_at": "2021-06-25T01:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437589",
    "user": "https://github.com/kiwifb"
}
```

Works and doctest with system 4ti2 on Gentoo.



---

archive/issue_comments_437590.json:
```json
{
    "body": "The 4ti2 binaries in openSUSE, since the package's inception in 2012 (so way before the Debian package by the looks of it), are available as e.g. /usr/bin/4ti2_zsolve, i.e. with a underscore rather than a dash. Alternatively, one can extend $PATH to include /usr/libexec/4ti2 and get them by their original name that way.",
    "created_at": "2021-07-01T21:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437590",
    "user": "https://github.com/jengelh"
}
```

The 4ti2 binaries in openSUSE, since the package's inception in 2012 (so way before the Debian package by the looks of it), are available as e.g. /usr/bin/4ti2_zsolve, i.e. with a underscore rather than a dash. Alternatively, one can extend $PATH to include /usr/libexec/4ti2 and get them by their original name that way.



---

archive/issue_comments_437591.json:
```json
{
    "body": "OK, we can check for the prefix `4ti2_` here too",
    "created_at": "2021-07-01T21:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437591",
    "user": "https://github.com/mkoeppe"
}
```

OK, we can check for the prefix `4ti2_` here too



---

archive/issue_comments_437592.json:
```json
{
    "body": "You may want to send a pull request to Singular and Polymake so that these packages accept system 4ti2 on SuSE",
    "created_at": "2021-07-01T21:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437592",
    "user": "https://github.com/mkoeppe"
}
```

You may want to send a pull request to Singular and Polymake so that these packages accept system 4ti2 on SuSE



---

archive/issue_comments_437593.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-01T21:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437594.json:
```json
{
    "body": "Let's get this in please",
    "created_at": "2021-07-06T18:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437594",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please



---

archive/issue_comments_437595.json:
```json
{
    "body": "`AC_TRY_LINK` is obsolete. We spent some time removing these in #30668. `autoupdate` produces\n\n```diff\ndiff --git a/build/pkgs/4ti2/spkg-configure.m4 b/build/pkgs/4ti2/spkg-configure.m4\nindex e01562c50d..a16da8fc4b 100644\n--- a/build/pkgs/4ti2/spkg-configure.m4\n+++ b/build/pkgs/4ti2/spkg-configure.m4\n@@ -17,13 +17,12 @@ SAGE_SPKG_CONFIGURE([4ti2], [\n         FORTYTWO_LIBS=\"-l4ti2gmp -lzsolve\"\n         CXXFLAGS=\"${BACKUP_CXXFLAGS} ${FORTYTWO_CXXFLAGS} ${GMP_CFLAGS}\"\n         LIBS=\"${BACKUP_LIBS} ${FORTYTWO_LIBS} ${GMP_LIBS}\"\n-        AC_TRY_LINK([\n+        AC_LINK_IFELSE([AC_LANG_PROGRAM([[\n #include \"4ti2/4ti2.h\"\n-],\n-[ _4ti2_rays_create_state(_4ti2_PREC_INT_ARB);\n-], [\n+]], [[ _4ti2_rays_create_state(_4ti2_PREC_INT_ARB);\n+]])],[\n         AC_MSG_RESULT([yes])\n-], [\n+],[\n         AC_MSG_RESULT([no])\n         sage_spkg_install_4ti2=yes\n ])\n```\n\nand it appears to work.",
    "created_at": "2021-07-07T09:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437595",
    "user": "https://github.com/dimpase"
}
```

`AC_TRY_LINK` is obsolete. We spent some time removing these in #30668. `autoupdate` produces

```diff
diff --git a/build/pkgs/4ti2/spkg-configure.m4 b/build/pkgs/4ti2/spkg-configure.m4
index e01562c50d..a16da8fc4b 100644
--- a/build/pkgs/4ti2/spkg-configure.m4
+++ b/build/pkgs/4ti2/spkg-configure.m4
@@ -17,13 +17,12 @@ SAGE_SPKG_CONFIGURE([4ti2], [
         FORTYTWO_LIBS="-l4ti2gmp -lzsolve"
         CXXFLAGS="${BACKUP_CXXFLAGS} ${FORTYTWO_CXXFLAGS} ${GMP_CFLAGS}"
         LIBS="${BACKUP_LIBS} ${FORTYTWO_LIBS} ${GMP_LIBS}"
-        AC_TRY_LINK([
+        AC_LINK_IFELSE([AC_LANG_PROGRAM([[
 #include "4ti2/4ti2.h"
-],
-[ _4ti2_rays_create_state(_4ti2_PREC_INT_ARB);
-], [
+]], [[ _4ti2_rays_create_state(_4ti2_PREC_INT_ARB);
+]])],[
         AC_MSG_RESULT([yes])
-], [
+],[
         AC_MSG_RESULT([no])
         sage_spkg_install_4ti2=yes
 ])
```

and it appears to work.



---

archive/issue_comments_437596.json:
```json
{
    "body": "by the way, with system `4ti2`, I have not found a way to tell Sage it is \"installed\" (./configure does pick it up all right); I tried `./configure --with-system-4ti2=force --enable-4ti2=yes`\nand still `4ti2` does not appear in the list of optional packages while doing `./sage -t ...`.\n\nSurely I can add it explicitly to `--optional`, but this is very suboptimal.",
    "created_at": "2021-07-07T09:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437596",
    "user": "https://github.com/dimpase"
}
```

by the way, with system `4ti2`, I have not found a way to tell Sage it is "installed" (./configure does pick it up all right); I tried `./configure --with-system-4ti2=force --enable-4ti2=yes`
and still `4ti2` does not appear in the list of optional packages while doing `./sage -t ...`.

Surely I can add it explicitly to `--optional`, but this is very suboptimal.



---

archive/issue_comments_437597.json:
```json
{
    "body": "Replying to [comment:27 dimpase]:\n> `AC_TRY_LINK` is obsolete. We spent some time removing these in #30668. `autoupdate` produces\n\nCan you push this to the ticket please?",
    "created_at": "2021-07-07T19:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437597",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:27 dimpase]:
> `AC_TRY_LINK` is obsolete. We spent some time removing these in #30668. `autoupdate` produces

Can you push this to the ticket please?



---

archive/issue_comments_437598.json:
```json
{
    "body": "Replying to [comment:28 dimpase]:\n> by the way, with system `4ti2`, I have not found a way to tell Sage it is \"installed\" (./configure does pick it up all right); I tried `./configure --with-system-4ti2=force --enable-4ti2=yes`\n> and still `4ti2` does not appear in the list of optional packages while doing `./sage -t ...`.\n> \n> Surely I can add it explicitly to `--optional`, but this is very suboptimal.\n\nRight, that's an important point. For optional packages with `spkg-configure.m4` we don't have a mechanism yet to put them on the default \"optional\" list. I ran into this trap also recently on the lrslib ticket. That's basically #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)",
    "created_at": "2021-07-07T19:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437598",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:28 dimpase]:
> by the way, with system `4ti2`, I have not found a way to tell Sage it is "installed" (./configure does pick it up all right); I tried `./configure --with-system-4ti2=force --enable-4ti2=yes`
> and still `4ti2` does not appear in the list of optional packages while doing `./sage -t ...`.
> 
> Surely I can add it explicitly to `--optional`, but this is very suboptimal.

Right, that's an important point. For optional packages with `spkg-configure.m4` we don't have a mechanism yet to put them on the default "optional" list. I ran into this trap also recently on the lrslib ticket. That's basically #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)



---

archive/issue_comments_437599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-07T21:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437600.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-08T17:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437600",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437601.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-08T18:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437601",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437602.json:
```json
{
    "body": "I have now added a `has_4ti2` to `sage.doctest.external`, so that the 4ti2 tests are at least run if `./sage -t --optional=sage,external` is used. \n\nI get that `internet` shouldn't be probed without an additional option, but I think that at least for some \"safe\" features such as `imagemagick`, `rubiks`, `4ti2`, `pandoc`, it really shouldn't require the use of `external` to check for these.",
    "created_at": "2021-07-08T19:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437602",
    "user": "https://github.com/mkoeppe"
}
```

I have now added a `has_4ti2` to `sage.doctest.external`, so that the 4ti2 tests are at least run if `./sage -t --optional=sage,external` is used. 

I get that `internet` shouldn't be probed without an additional option, but I think that at least for some "safe" features such as `imagemagick`, `rubiks`, `4ti2`, `pandoc`, it really shouldn't require the use of `external` to check for these.



---

archive/issue_comments_437603.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> I get that `internet` shouldn't be probed without an additional option, but I think that at least for some \"safe\" features such as `imagemagick`, `rubiks`, `4ti2`, `pandoc`, it really shouldn't require the use of `external` to check for these. \n\n(that's for another ticket.)",
    "created_at": "2021-07-08T20:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437603",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:34 mkoeppe]:
> I get that `internet` shouldn't be probed without an additional option, but I think that at least for some "safe" features such as `imagemagick`, `rubiks`, `4ti2`, `pandoc`, it really shouldn't require the use of `external` to check for these. 

(that's for another ticket.)



---

archive/issue_comments_437604.json:
```json
{
    "body": "This is now #32174 (doctests: Detect \"safe\" external features even if `--optional=external` is not used).",
    "created_at": "2021-07-10T18:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437604",
    "user": "https://github.com/mkoeppe"
}
```

This is now #32174 (doctests: Detect "safe" external features even if `--optional=external` is not used).



---

archive/issue_comments_437605.json:
```json
{
    "body": "needs a rebase",
    "created_at": "2021-07-19T14:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437605",
    "user": "https://github.com/dimpase"
}
```

needs a rebase



---

archive/issue_comments_437606.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-07-19T14:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437606",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_437607.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-19T18:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437607",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437608.json:
```json
{
    "body": "lgtm",
    "created_at": "2021-07-19T18:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437608",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_437609.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-07-19T18:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437609",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_437610.json:
```json
{
    "body": "Tests fail",
    "created_at": "2021-07-21T20:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437610",
    "user": "https://github.com/vbraun"
}
```

Tests fail



---

archive/issue_comments_437611.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-21T20:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437611",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_437612.json:
```json
{
    "body": "Volker, there are dozens of different ways external packages, vendored or not, with dependencies, may fail. More info please.",
    "created_at": "2021-07-21T22:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437612",
    "user": "https://github.com/dimpase"
}
```

Volker, there are dozens of different ways external packages, vendored or not, with dependencies, may fail. More info please.



---

archive/issue_comments_437613.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-25T05:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437613",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437614.json:
```json
{
    "body": "Works fine with and without 4ti2 installed. If there is a failure on some machine, we obviously need more information than \"tests fail\".",
    "created_at": "2021-07-25T05:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437614",
    "user": "https://github.com/mkoeppe"
}
```

Works fine with and without 4ti2 installed. If there is a failure on some machine, we obviously need more information than "tests fail".



---

archive/issue_comments_437615.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-07-25T05:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437615",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_437616.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-25T20:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437616",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_437617.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 43.6 --random-seed=0 src/sage/misc/dev_tools.py\n**********************************************************************\nFile \"src/sage/misc/dev_tools.py\", line 487, in sage.misc.dev_tools.import_statements\nFailed example:\n    import_statements('SAGE_ENV')\nExpected:\n    from sage.env import SAGE_ENV\nGot:\n    # ** Warning **: several modules for the object {'UNAME': 'Linux', 'HOSTNAME': 'zen', 'LOCAL_IDENTIFIER': 'zen.1421426', 'SAGE_VERSION': '9.4.beta6', 'SAGE_DATE': '2021-07-24', 'SAGE_VERSION_BANNER': 'SageMath version 9.4.beta6, Release Date: 2021-07-24', 'SAGE_VENV': '/home/release/Sage/local', 'SAGE_LIB': '/home/release/Sage/local/lib64/python3.9/site-packages', 'SAGE_EXTCODE': '/home/release/Sage/local/lib64/python3.9/site-packages/sage/ext_data', 'SAGE_VENV_SPKG_INST': '/home/release/Sage/local/var/lib/sage/installed', 'SAGE_LOCAL': '/home/release/Sage/local', 'SAGE_SHARE': '/home/release/Sage/local/share', 'SAGE_DOC': '/home/release/Sage/local/share/doc/sage', 'SAGE_SPKG_INST': '/home/release/Sage/local/var/lib/sage/installed', 'SAGE_ROOT': '/home/release/Sage', 'SAGE_SRC': '/home/release/Sage/src', 'SAGE_DOC_SRC': '/home/release/Sage/src/doc', 'SAGE_PKGS': '/home/release/Sage/build/pkgs', 'SAGE_ROOT_GIT': '/home/release/Sage/.git', 'DOT_SAGE': '/home/release/.sage/', 'SAGE_STARTUP_FILE': '/home/release/.sage/init-doctests.sage', 'SAGE_ARCHFLAGS': 'unset', 'SAGE_PKG_CONFIG_PATH': '/home/release/Sage/local/lib/pkgconfig', 'CONWAY_POLYNOMIALS_DATA_DIR': '/home/release/Sage/local/share/conway_polynomials', 'GRAPHS_DATA_DIR': '/home/release/Sage/local/share/graphs', 'ELLCURVE_DATA_DIR': '/home/release/Sage/local/share/ellcurves', 'POLYTOPE_DATA_DIR': '/home/release/Sage/local/share/reflexive_polytopes', 'GAP_ROOT_DIR': '/home/release/Sage/local/share/gap', 'THEBE_DIR': '/home/release/Sage/local/share/thebe', 'COMBINATORIAL_DESIGN_DATA_DIR': '/home/release/Sage/local/share/combinatorial_designs', 'CREMONA_MINI_DATA_DIR': '/home/release/Sage/local/share/cremona', 'CREMONA_LARGE_DATA_DIR': '/home/release/Sage/local/share/cremona', 'JMOL_DIR': '/home/release/Sage/local/share/jmol', 'MATHJAX_DIR': '/home/release/Sage/local/share/mathjax', 'MTXLIB': '/home/release/Sage/local/share/meataxe', 'THREEJS_DIR': '/home/release/Sage/local/share/threejs-sage', 'PPLPY_DOCS': '/home/release/Sage/local/share/doc/pplpy', 'MAXIMA': '/home/release/Sage/local/bin/maxima', 'MAXIMA_FAS': '/home/release/Sage/local/lib/ecl/maxima.fas', 'KENZO_FAS': '/home/release/Sage/local/lib/ecl/kenzo.fas', 'SAGE_NAUTY_BINS_PREFIX': '', 'FOURTITWO_HILBERT': '', 'FOURTITWO_MARKOV': '', 'FOURTITWO_GRAVER': '', 'FOURTITWO_ZSOLVE': '', 'FOURTITWO_QSOLVE': '', 'FOURTITWO_RAYS': '', 'FOURTITWO_PPI': '', 'FOURTITWO_CIRCUITS': '', 'FOURTITWO_GROEBNER': '', 'ARB_LIBRARY': 'arb', 'CBLAS_PC_MODULES': 'cblas', 'ECL_CONFIG': '/home/release/Sage/local/bin/ecl-config', 'NTL_INCDIR': '', 'NTL_LIBDIR': '', 'LIE_INFO_DIR': '/home/release/Sage/local/lib/LiE', 'OPENMP_CFLAGS': '-fopenmp', 'OPENMP_CXXFLAGS': '-fopenmp', 'SAGE_BANNER': '', 'SAGE_IMPORTALL': 'yes', 'SINGULAR_SO': '/home/release/Sage/local/lib/libSingular-4.2.0.so', 'GAP_SO': '/home/release/Sage/local/lib/libgap.so.0.0.0'}: sage.all, sage.all_cmdline, sage.env, sage.features.four_ti_2, sage.repl.ipython_kernel.all_jupyter\n    from sage.env import SAGE_ENV\n**********************************************************************\n1 item had failures:\n   1 of  37 in sage.misc.dev_tools.import_statements\n    [60 tests, 1 failure, 0.22 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 43.6 --random-seed=0 src/sage/misc/dev_tools.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2021-07-25T20:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437617",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long --warn-long 43.6 --random-seed=0 src/sage/misc/dev_tools.py
**********************************************************************
File "src/sage/misc/dev_tools.py", line 487, in sage.misc.dev_tools.import_statements
Failed example:
    import_statements('SAGE_ENV')
Expected:
    from sage.env import SAGE_ENV
Got:
    # ** Warning **: several modules for the object {'UNAME': 'Linux', 'HOSTNAME': 'zen', 'LOCAL_IDENTIFIER': 'zen.1421426', 'SAGE_VERSION': '9.4.beta6', 'SAGE_DATE': '2021-07-24', 'SAGE_VERSION_BANNER': 'SageMath version 9.4.beta6, Release Date: 2021-07-24', 'SAGE_VENV': '/home/release/Sage/local', 'SAGE_LIB': '/home/release/Sage/local/lib64/python3.9/site-packages', 'SAGE_EXTCODE': '/home/release/Sage/local/lib64/python3.9/site-packages/sage/ext_data', 'SAGE_VENV_SPKG_INST': '/home/release/Sage/local/var/lib/sage/installed', 'SAGE_LOCAL': '/home/release/Sage/local', 'SAGE_SHARE': '/home/release/Sage/local/share', 'SAGE_DOC': '/home/release/Sage/local/share/doc/sage', 'SAGE_SPKG_INST': '/home/release/Sage/local/var/lib/sage/installed', 'SAGE_ROOT': '/home/release/Sage', 'SAGE_SRC': '/home/release/Sage/src', 'SAGE_DOC_SRC': '/home/release/Sage/src/doc', 'SAGE_PKGS': '/home/release/Sage/build/pkgs', 'SAGE_ROOT_GIT': '/home/release/Sage/.git', 'DOT_SAGE': '/home/release/.sage/', 'SAGE_STARTUP_FILE': '/home/release/.sage/init-doctests.sage', 'SAGE_ARCHFLAGS': 'unset', 'SAGE_PKG_CONFIG_PATH': '/home/release/Sage/local/lib/pkgconfig', 'CONWAY_POLYNOMIALS_DATA_DIR': '/home/release/Sage/local/share/conway_polynomials', 'GRAPHS_DATA_DIR': '/home/release/Sage/local/share/graphs', 'ELLCURVE_DATA_DIR': '/home/release/Sage/local/share/ellcurves', 'POLYTOPE_DATA_DIR': '/home/release/Sage/local/share/reflexive_polytopes', 'GAP_ROOT_DIR': '/home/release/Sage/local/share/gap', 'THEBE_DIR': '/home/release/Sage/local/share/thebe', 'COMBINATORIAL_DESIGN_DATA_DIR': '/home/release/Sage/local/share/combinatorial_designs', 'CREMONA_MINI_DATA_DIR': '/home/release/Sage/local/share/cremona', 'CREMONA_LARGE_DATA_DIR': '/home/release/Sage/local/share/cremona', 'JMOL_DIR': '/home/release/Sage/local/share/jmol', 'MATHJAX_DIR': '/home/release/Sage/local/share/mathjax', 'MTXLIB': '/home/release/Sage/local/share/meataxe', 'THREEJS_DIR': '/home/release/Sage/local/share/threejs-sage', 'PPLPY_DOCS': '/home/release/Sage/local/share/doc/pplpy', 'MAXIMA': '/home/release/Sage/local/bin/maxima', 'MAXIMA_FAS': '/home/release/Sage/local/lib/ecl/maxima.fas', 'KENZO_FAS': '/home/release/Sage/local/lib/ecl/kenzo.fas', 'SAGE_NAUTY_BINS_PREFIX': '', 'FOURTITWO_HILBERT': '', 'FOURTITWO_MARKOV': '', 'FOURTITWO_GRAVER': '', 'FOURTITWO_ZSOLVE': '', 'FOURTITWO_QSOLVE': '', 'FOURTITWO_RAYS': '', 'FOURTITWO_PPI': '', 'FOURTITWO_CIRCUITS': '', 'FOURTITWO_GROEBNER': '', 'ARB_LIBRARY': 'arb', 'CBLAS_PC_MODULES': 'cblas', 'ECL_CONFIG': '/home/release/Sage/local/bin/ecl-config', 'NTL_INCDIR': '', 'NTL_LIBDIR': '', 'LIE_INFO_DIR': '/home/release/Sage/local/lib/LiE', 'OPENMP_CFLAGS': '-fopenmp', 'OPENMP_CXXFLAGS': '-fopenmp', 'SAGE_BANNER': '', 'SAGE_IMPORTALL': 'yes', 'SINGULAR_SO': '/home/release/Sage/local/lib/libSingular-4.2.0.so', 'GAP_SO': '/home/release/Sage/local/lib/libgap.so.0.0.0'}: sage.all, sage.all_cmdline, sage.env, sage.features.four_ti_2, sage.repl.ipython_kernel.all_jupyter
    from sage.env import SAGE_ENV
**********************************************************************
1 item had failures:
   1 of  37 in sage.misc.dev_tools.import_statements
    [60 tests, 1 failure, 0.22 s]
----------------------------------------------------------------------
sage -t --long --warn-long 43.6 --random-seed=0 src/sage/misc/dev_tools.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_437618.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-25T20:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437618",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437619.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-25T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437619",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437620.json:
```json
{
    "body": "Thanks, fixed.",
    "created_at": "2021-07-25T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437620",
    "user": "https://github.com/mkoeppe"
}
```

Thanks, fixed.



---

archive/issue_comments_437621.json:
```json
{
    "body": "Let's get this in please.",
    "created_at": "2021-10-03T21:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437621",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please.



---

archive/issue_comments_437622.json:
```json
{
    "body": "All good here with both distro packaging and building from source against system 4ti2",
    "created_at": "2021-10-04T20:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437622",
    "user": "https://github.com/antonio-rojas"
}
```

All good here with both distro packaging and building from source against system 4ti2



---

archive/issue_comments_437623.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-04T20:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437623",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437624.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-10-04T20:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437624",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_437625.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-10T10:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30650#issuecomment-437625",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_028134.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-10T10:17:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30650",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30650#event-28134"
}
```
