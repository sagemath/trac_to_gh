# Issue 33065: fpylll might not find system-wide fplll's strategies json

archive/issues_033065.json:
```json
{
    "body": "This in particular is observed on Debian 11, see\nhttps://github.com/fplll/fpylll/issues/221\n\n\n```\nsage: from sage.modules.free_module_integer import IntegerLattice\nsage: L = IntegerLattice(sage.crypto.gen_lattice(type='modular', m=10, seed=1337, dual=True))\nsage: L.shortest_vector()\nterminate called after throwing an instance of 'std::runtime_error'\n  what():  Cannot open strategies file.\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n~/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)()\n   1942             try:\n-> 1943                 return cache[k]\n   1944             except TypeError:  # k is not hashable\n\nKeyError: ((True, 'fplll'), ())\n...\n```\n\n\nThe latter is an extract from a failing doctest.\n\nWhile it's fixed in fplll's master, we need a fix for the current fpylll.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33302\n\n",
    "created_at": "2022-02-06T11:38:23Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "fpylll might not find system-wide fplll's strategies json",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33065",
    "user": "https://github.com/dimpase"
}
```
This in particular is observed on Debian 11, see
https://github.com/fplll/fpylll/issues/221


```
sage: from sage.modules.free_module_integer import IntegerLattice
sage: L = IntegerLattice(sage.crypto.gen_lattice(type='modular', m=10, seed=1337, dual=True))
sage: L.shortest_vector()
terminate called after throwing an instance of 'std::runtime_error'
  what():  Cannot open strategies file.
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
~/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: ((True, 'fplll'), ())
...
```


The latter is an extract from a failing doctest.

While it's fixed in fplll's master, we need a fix for the current fpylll.

Issue created by migration from https://trac.sagemath.org/ticket/33302





---

archive/issue_comments_470773.json:
```json
{
    "body": "I think it should be enough to update FPLLL to fix this, no? I can cut a new release (for both).",
    "created_at": "2022-02-07T10:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470773",
    "user": "https://github.com/malb"
}
```

I think it should be enough to update FPLLL to fix this, no? I can cut a new release (for both).



---

archive/issue_comments_470774.json:
```json
{
    "body": "We are allowing system-wide versions of fplll. I.e. we are stuck with this little bug for some time.",
    "created_at": "2022-02-07T11:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470774",
    "user": "https://github.com/dimpase"
}
```

We are allowing system-wide versions of fplll. I.e. we are stuck with this little bug for some time.



---

archive/issue_comments_470775.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470775",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_470776.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470776",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_470777.json:
```json
{
    "body": "I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.",
    "created_at": "2022-02-11T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470777",
    "user": "https://github.com/malb"
}
```

I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.



---

archive/issue_comments_470778.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-11T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470778",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_470779.json:
```json
{
    "body": "Replying to [comment:4 malb]:\n> I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.\n\nThanks. On Debian 11 BKZ.DEFAULT_STRATEGY is not full path, it's just `default.json`. So the path has to be prepended.\nIn some other cases it's full path, so either nothing should be prepended, or it can be done as in the patch.",
    "created_at": "2022-02-11T12:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470779",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:4 malb]:
> I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.

Thanks. On Debian 11 BKZ.DEFAULT_STRATEGY is not full path, it's just `default.json`. So the path has to be prepended.
In some other cases it's full path, so either nothing should be prepended, or it can be done as in the patch.



---

archive/issue_comments_470780.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-16T23:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470780",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_029928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-16T23:57:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33065#event-29928"
}
```



---

archive/issue_comments_470781.json:
```json
{
    "body": "Again on `opensuse-tumbleweed` - #33448",
    "created_at": "2022-03-02T04:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33065",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33065#issuecomment-470781",
    "user": "https://github.com/mkoeppe"
}
```

Again on `opensuse-tumbleweed` - #33448
