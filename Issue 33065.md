# Issue 33065: fpylll might not find system-wide fplll's strategies json

Issue created by migration from https://trac.sagemath.org/ticket/33302

Original creator: dimpase

Original creation time: 2022-02-06 11:38:23

This in particular is observed on Debian 11, see
https://github.com/fplll/fpylll/issues/221


```
sage: from sage.modules.free_module_integer import IntegerLattice
sage: L = IntegerLattice(sage.crypto.gen_lattice(type='modular', m=10, seed=1337, dual=True))
sage: L.shortest_vector()
terminate called after throwing an instance of 'std::runtime_error'
  what():  Cannot open strategies file.
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
~/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: ((True, 'fplll'), ())
...
```


The latter is an extract from a failing doctest.

While it's fixed in fplll's master, we need a fix for the current fpylll.


---

Comment by malb created at 2022-02-07 10:59:05

I think it should be enough to update FPLLL to fix this, no? I can cut a new release (for both).


---

Comment by dimpase created at 2022-02-07 11:24:30

We are allowing system-wide versions of fplll. I.e. we are stuck with this little bug for some time.


---

Comment by dimpase created at 2022-02-09 15:32:01

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-02-09 15:32:01

New commits:


---

Comment by malb created at 2022-02-11 11:25:29

I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.


---

Comment by malb created at 2022-02-11 11:25:29

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2022-02-11 12:42:05

Replying to [comment:4 malb]:
> I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.

Thanks. On Debian 11 BKZ.DEFAULT_STRATEGY is not full path, it's just `default.json`. So the path has to be prepended.
In some other cases it's full path, so either nothing should be prepended, or it can be done as in the patch.


---

Comment by vbraun created at 2022-02-16 23:57:01

Resolution: fixed


---

Comment by mkoeppe created at 2022-03-02 04:28:11

Again on `opensuse-tumbleweed` - #33448
