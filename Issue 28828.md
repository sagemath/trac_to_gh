# Issue 28828: Inverse function for `gale_transform`

Issue created by migration from https://trac.sagemath.org/ticket/29065

Original creator: @kliem

Original creation time: 2020-01-22 13:15:36

CC:  jipilab @laisrast yzh

Keywords: polytopes, gale transform

One can obtain a gale diagram from a polyhedron. Some interesting examples of polyhedra are obtained by the reverse approach.

We implement a method that converts a gale diagram to a `Polyhedron`.

This is a preparation for adding polytopes to the library obtained from the Gale diagram (e.g. #27728).


---

Comment by @kliem created at 2020-01-22 13:16:49

New commits:


---

Comment by @kliem created at 2020-01-22 13:16:49

Changing status from new to needs_review.


---

Comment by git created at 2020-01-23 11:14:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-01-23 20:35:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LaisRast created at 2020-01-30 11:38:03

Small remarks:
* Typos:

```diff
-    The vectors are scalled automatically such that they add up to zero.
+    The vectors are scaled automatically such that they add up to zero.
```


```diff
-        # The vectors of our gale transform shall add up to one.
+        # The vectors of our gale transform shall add up to zero.
```


* Maybe explain why you want the sum of all `vectors` to be zero. Something like "so that the right kernel of `vectors` has the one vector in it".


---

Comment by git created at 2020-01-30 14:53:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-02-04 14:42:26

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2020-02-04 14:42:26

Here are some comments:

 - I would name the function `gale_transform_to_polytope` since there is no unbounded case here.


```diff
def gale_transform_to_polyhedron(vectors, base_ring=None, backend=None):
    r"""
-    Return the polytope from a (linear) gale transform.
+    Return the polytope associated to the list of vectors forming a Gale transform.

    This function is the inverse of
    :meth:`~sage.geometry.polyhedron.base.Polyhedron_base.gale_transform`
-    up to projective isomorphism.
+    up to projective transformation.
```



```
+    The vectors are scaled automatically such that they add up to zero.
```


This needs to be more clear. Is it: The _vertices_ of the polytope are scaled so that the sum of their coordinates is zero? I believe not, right? Then it should say that the centroid (which is what you mean, I'm pretty sure) should be the origin.

I think that the following sentence should be changed to reflect what the function does internally (if it is not the case, you mention in the comments in the code that you do it, this should be mentioned here too!).


```diff
+    The function is much faster and gives nicer representation if this
+    is already the case.
```



```diff
+    INPUT:
+
-    - ``vectors`` -- the vectors of the gale transform
+    - ``vectors`` -- the ordered vectors of the Gale transform
```


Please use the suggested format when using default values for optional parameters:


```
+    - ``base_ring`` -- (optional) the base ring to be used for the construction
+
+    - ``backend`` -- (optional) the backend to use to create the polytope
+
```


gale transform -> Gale transform (but not in names of functions...)

straight forward -> straightforward


---

Comment by @kliem created at 2020-02-05 10:26:50

This comment is totally cryptic to me. Should I change the format? To what? There is tons of different styles for this all over the place.

The [coding conventions](http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content/) suggest the following:


```
- ``base_ring`` -- string (default: `None`); the base ring to be used for the construction
```


Why is the order of the vectors of importance?

Replying to [comment:7 jipilab]:
> 
> Please use the suggested format when using default values for optional parameters:
> 
> {{{
> +    - ``base_ring`` -- (optional) the base ring to be used for the construction
> +
> +    - ``backend`` -- (optional) the backend to use to create the polytope
> +
> }}}
> 
> gale transform -> Gale transform (but not in names of functions...)
> 
> straight forward -> straightforward


---

Comment by @kliem created at 2020-02-05 10:48:18

New commits:


---

Comment by @kliem created at 2020-02-05 10:48:18

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2020-02-06 12:51:48

Replying to [comment:8 gh-kliem]:
> This comment is totally cryptic to me. Should I change the format? To what? There is tons of different styles for this all over the place.
> 
> The [coding conventions](http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content/) suggest the following:
> 
> {{{
> - ``base_ring`` -- string (default: `None`); the base ring to be used for the construction
> }}}
>
I like the above convention, yes.
 
> Why is the order of the vectors of importance?
> 

Essentially, to make things clear and smooth, it is practical to talk about a "labeled" set of vector, where the set of labels has a total order a.k.a. essentially numbered from 1 to k.

In practice, when one uses Gale duality, to go from primal to dual notions and vice-versa, it is important to have a precise ground set in order to do the translations: complementation should be well-defined, and as soon as you get into the oriented matroid business, it is important to get the signs right... This is why it is a soothing measure to mention here in the first line of the documentation that we do care that this is an (ordered) list of vectors.

This will make our life easier when explaining/doing things.


---

Comment by jipilab created at 2020-02-06 12:55:39

About this, we should also add a reference to another book.

I suggest the Triangulations book of De Loera, Rambau, Santos. Definition 2.5.1 and Definition 4.1.35.

Essentially, this function is not necessarily to get a polytope, right?

Or does it really check for the polytopality property?

I see the possibility here to split into two functions...


---

Comment by jipilab created at 2020-02-07 10:05:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-02-07 14:14:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-02-07 14:14:11

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-02-07 14:14:11

New commits:
----
New commits:


---

Comment by jipilab created at 2020-02-07 15:40:32

Tiny things:


```diff
+        .. SEEALSO::
+
-            :func`~sage.geometry.polyhedron.library.gale_transform_to_polyhedron`.
+            :func`~sage.geometry.polyhedron.library.gale_transform_to_polytope`.
```



```diff
-    OUTPUT: An ordered point confuration as list of vectors.
+    OUTPUT: An ordered point configuration as list of vectors.
```



```diff
-    One can also specify the backend to be used interally::
+    One can also specify the backend to be used internally::
```



```diff
-    The input vectors are checked for being totally cyclic::
+    The input vectors should be totally cyclic::
```



```diff
-        # of the polyhedron. So dehomogenization is straight forward.
+        # of the polyhedron. So dehomogenization is straightforward.
```


I find the "algorithm" part a bit hard to understand, but that might just be me. I will see if I can come up with an suggestion of improvement.


---

Comment by jipilab created at 2020-02-07 15:40:32

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-02-07 20:21:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-02-07 20:22:45

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-02-07 20:22:45

I hope this is better now. I completely rewrote the algorithm part.


---

Comment by jipilab created at 2020-03-17 10:48:08

Tiny things:


```diff
+        sage: gale_transform_to_polytope(
+        ....:     [(1,1), (-1,-1), (1,0),
+        ....:      (-1,0), (1,-1), (-2,1)],
+        ....:     backend='cdd', base_ring=RDF)
+        A 3-dimensional polyhedron in RDF^3 defined as the convex hull of 6 vertices
```


I know that cdd is the only backend handling RDF, but perhaps it would be good to still check the backend like the example just before...

Question: is this test equivalent to the fact that it is not the correct polytope:


```diff
+    if not P.n_vertices() == len(vertices):
+        raise ValueError("the gale transform does not correspond to a polytope")
```


It would be good to give a reference for that line in the code in a comment. I want to make sure to catch this error if and only if the thing go wrong (so that other types of errors are not hidden by that failing/passing like it happened a lot in polyhedron stuff...). 

In `gale_transform_to_primal`, be careful in describing _all_ the details properly. We do not assume that the centroid of the vectors to be the origin, but rather


```diff
-    We assume the centroid of the (input) vectors to be the origin.
-    We stack ``Matrix(vectors)`` by a row of ones.
-    The right kernel of this is the dual point configuration.
+    If the centroid of the (input) vectors is not the origin, we do an appropriate transformation to make it so.
+    We add a row of ones on top of ``Matrix(vectors)``.
+    The right kernel of this larger matrix is the dual configuration space, and a basis of this space provides the dual point configuration.
```


Then paragraph 3 and 4 of the algorithm are a bit hard to parse... Perhaps rework them a bit?


---

Comment by jipilab created at 2020-03-17 10:48:17

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-03-17 15:03:16

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-03-17 15:03:16

Last 10 new commits:


---

Comment by jipilab created at 2020-03-20 15:03:00

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2020-03-20 15:03:00

You will hate me for this, but "centroid" is the wrong term. 

What you mean is "center" (the centroid method is not implemented yet, see https://ask.sagemath.org/question/8092/compute-the-centroid-of-a-polytope/ ... which is also to be implemented ...Sighhhhhh).

One small thing:


```diff
-    convex if and only if every hyperplane contains at least two vectors of
+    convex and if and only if every hyperplane contains at least two vectors of
```


Otherwise, looks very good!


---

Comment by git created at 2020-03-20 15:09:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-03-20 15:10:45

:-)


---

Comment by @kliem created at 2020-03-20 15:10:45

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2020-03-20 16:41:08

I'm working on #27728 which depends on this ticket, and I might have some more feedback about the functions. Let's wait for that and the bots.


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by jipilab created at 2020-04-19 13:36:55

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2020-04-19 13:36:55

Ok, looks good. If there are more modifications on this function, they can be addressed in #27728.


---

Comment by vbraun created at 2020-04-22 20:52:39

Resolution: fixed
