# Issue 23362: making local_data and check_prime from Elliptic curves to accept P in QQ

archive/issues_023362.json:
```json
{
    "body": "CC:  cremona\n\nI noticed that one could do.\n\n\n\n```\nE = EllipticCurve(QQ, \"35a2\")\nE.local_data(ZZ(5)); \n```\n\nbut not\n\n```\nE.local_data(QQ(5));\n```\n\n\nHowever, if we base change to a number field `K`, it works if we pass an element of `K`\n\n```\nK.<i> = NumberField(x^2+1)\nE = EllipticCurve([1 + i, 0, 1, 0, 0])\nE.local_data(2*i + 1)\nE.local_data(K(3))\n```\n\nbut\n\n```\nE.local_data(3)\n```\n\nwoudln't.\n\nI tried to fix that.\n\nps: the right implementation here should be along the lines, \n\n```\nP = K.fractional_ideal(P)\nif P.is_prime():\n    if K is QQ:\n        return P.gen();\n    else:\n        return P;\n```\n\nbut `QQ` doesn't have fractional ideals, see #23595\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23599\n\n",
    "created_at": "2017-08-08T18:40:20Z",
    "labels": [
        "elliptic curves",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "making local_data and check_prime from Elliptic curves to accept P in QQ",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23362",
    "user": "edgarcosta"
}
```
CC:  cremona

I noticed that one could do.



```
E = EllipticCurve(QQ, "35a2")
E.local_data(ZZ(5)); 
```

but not

```
E.local_data(QQ(5));
```


However, if we base change to a number field `K`, it works if we pass an element of `K`

```
K.<i> = NumberField(x^2+1)
E = EllipticCurve([1 + i, 0, 1, 0, 0])
E.local_data(2*i + 1)
E.local_data(K(3))
```

but

```
E.local_data(3)
```

woudln't.

I tried to fix that.

ps: the right implementation here should be along the lines, 

```
P = K.fractional_ideal(P)
if P.is_prime():
    if K is QQ:
        return P.gen();
    else:
        return P;
```

but `QQ` doesn't have fractional ideals, see #23595



Issue created by migration from https://trac.sagemath.org/ticket/23599





---

archive/issue_comments_327007.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-08T20:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327007",
    "user": "edgarcosta"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_327008.json:
```json
{
    "body": "Not that I can claim to understand types in sage completely, but your change:\n\n```\n-        if isinstance(P, integer_types + (Integer,)):\n+        if P in ZZ or isinstance(P, integer_types + (Integer,)):\n```\n\nseems to complicate a line without changing the criterion, no?",
    "created_at": "2017-08-09T10:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327008",
    "user": "wuthrich"
}
```

Not that I can claim to understand types in sage completely, but your change:

```
-        if isinstance(P, integer_types + (Integer,)):
+        if P in ZZ or isinstance(P, integer_types + (Integer,)):
```

seems to complicate a line without changing the criterion, no?



---

archive/issue_comments_327009.json:
```json
{
    "body": "Ah, now I see. Of course that is what you want, P=QQ(3) gives now True. Sorry for the noise.",
    "created_at": "2017-08-09T11:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327009",
    "user": "wuthrich"
}
```

Ah, now I see. Of course that is what you want, P=QQ(3) gives now True. Sorry for the noise.



---

archive/issue_comments_327010.json:
```json
{
    "body": "I approve of these changes (in principle, I have not looked at the details).   There are still many places where QQ (and elements of QQ) are not treated the same as for number fields, and missing methods for QQ and rationals which exist for general number fields.  I don't think it will ever be possible to eliminate these inconsistencies globally for a number of reasons:\n1. We have different types (classes) for elements of QQ and ZZ, and that will surely stay true, while we have no separate type for an integral element of a number field.\n2. Number theorists are quite happy with K.ideal(2) returning a fractional ideal -- which is non-trivial! -- but QQ.ideal(2) returns the unit ideal.  Basically that's because algebraists are pedantic and say quite correctly that the ideal of QQ generated by 2 is the unit ideal since 2 is a unit in the field.  Of course we can do ZZ.ideal(2) to get the ideal; but not ZZ.ideal(1/2), i.e. we have integral ideals of ZZ but not fractional ones.  So this is in fact related to the distinct classes for ZZ and QQ but none for rings of integers generally.\n\nHence (in conclusion!) the best we can do is tinker with code in the way this ticket does so that natural constructions work as widely as possible.  Thanks, Edgar.",
    "created_at": "2017-08-09T11:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327010",
    "user": "cremona"
}
```

I approve of these changes (in principle, I have not looked at the details).   There are still many places where QQ (and elements of QQ) are not treated the same as for number fields, and missing methods for QQ and rationals which exist for general number fields.  I don't think it will ever be possible to eliminate these inconsistencies globally for a number of reasons:
1. We have different types (classes) for elements of QQ and ZZ, and that will surely stay true, while we have no separate type for an integral element of a number field.
2. Number theorists are quite happy with K.ideal(2) returning a fractional ideal -- which is non-trivial! -- but QQ.ideal(2) returns the unit ideal.  Basically that's because algebraists are pedantic and say quite correctly that the ideal of QQ generated by 2 is the unit ideal since 2 is a unit in the field.  Of course we can do ZZ.ideal(2) to get the ideal; but not ZZ.ideal(1/2), i.e. we have integral ideals of ZZ but not fractional ones.  So this is in fact related to the distinct classes for ZZ and QQ but none for rings of integers generally.

Hence (in conclusion!) the best we can do is tinker with code in the way this ticket does so that natural constructions work as widely as possible.  Thanks, Edgar.



---

archive/issue_comments_327011.json:
```json
{
    "body": "Changing keywords from \"\" to \"days88\".",
    "created_at": "2017-08-22T21:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327011",
    "user": "jen"
}
```

Changing keywords from "" to "days88".



---

archive/issue_comments_327012.json:
```json
{
    "body": "Merged.\n\nPlays well.  All tests pass.  Documentation looks good.\n----\nNew commits:",
    "created_at": "2017-08-24T23:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327012",
    "user": "aly.deines"
}
```

Merged.

Plays well.  All tests pass.  Documentation looks good.
----
New commits:



---

archive/issue_comments_327013.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-24T23:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327013",
    "user": "aly.deines"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327014.json:
```json
{
    "body": "Author name missing...",
    "created_at": "2017-09-10T22:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327014",
    "user": "vbraun"
}
```

Author name missing...



---

archive/issue_comments_327015.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-10T22:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327015",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_327016.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-09-11T00:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327016",
    "user": "edgarcosta"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_327017.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-15T07:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23362#issuecomment-327017",
    "user": "vbraun"
}
```

Resolution: fixed
