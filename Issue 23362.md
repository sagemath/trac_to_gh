# Issue 23362: making local_data and check_prime from Elliptic curves to accept P in QQ

Issue created by migration from https://trac.sagemath.org/ticket/23599

Original creator: edgarcosta

Original creation time: 2017-08-08 18:40:20

CC:  cremona

I noticed that one could do.



```
E = EllipticCurve(QQ, "35a2")
E.local_data(ZZ(5)); 
```

but not

```
E.local_data(QQ(5));
```


However, if we base change to a number field `K`, it works if we pass an element of `K`

```
K.<i> = NumberField(x^2+1)
E = EllipticCurve([1 + i, 0, 1, 0, 0])
E.local_data(2*i + 1)
E.local_data(K(3))
```

but

```
E.local_data(3)
```

woudln't.

I tried to fix that.

ps: the right implementation here should be along the lines, 

```
P = K.fractional_ideal(P)
if P.is_prime():
    if K is QQ:
        return P.gen();
    else:
        return P;
```

but `QQ` doesn't have fractional ideals, see #23595




---

Comment by edgarcosta created at 2017-08-08 20:04:37

Changing status from new to needs_review.


---

Comment by wuthrich created at 2017-08-09 10:31:37

Not that I can claim to understand types in sage completely, but your change:

```
-        if isinstance(P, integer_types + (Integer,)):
+        if P in ZZ or isinstance(P, integer_types + (Integer,)):
```

seems to complicate a line without changing the criterion, no?


---

Comment by wuthrich created at 2017-08-09 11:02:56

Ah, now I see. Of course that is what you want, P=QQ(3) gives now True. Sorry for the noise.


---

Comment by cremona created at 2017-08-09 11:34:07

I approve of these changes (in principle, I have not looked at the details).   There are still many places where QQ (and elements of QQ) are not treated the same as for number fields, and missing methods for QQ and rationals which exist for general number fields.  I don't think it will ever be possible to eliminate these inconsistencies globally for a number of reasons:
   1. We have different types (classes) for elements of QQ and ZZ, and that will surely stay true, while we have no separate type for an integral element of a number field.
   2. Number theorists are quite happy with K.ideal(2) returning a fractional ideal -- which is non-trivial! -- but QQ.ideal(2) returns the unit ideal.  Basically that's because algebraists are pedantic and say quite correctly that the ideal of QQ generated by 2 is the unit ideal since 2 is a unit in the field.  Of course we can do ZZ.ideal(2) to get the ideal; but not ZZ.ideal(1/2), i.e. we have integral ideals of ZZ but not fractional ones.  So this is in fact related to the distinct classes for ZZ and QQ but none for rings of integers generally.

Hence (in conclusion!) the best we can do is tinker with code in the way this ticket does so that natural constructions work as widely as possible.  Thanks, Edgar.


---

Comment by jen created at 2017-08-22 21:15:52

Changing keywords from "" to "days88".


---

Comment by aly.deines created at 2017-08-24 23:10:05

Merged.

Plays well.  All tests pass.  Documentation looks good.
----
New commits:


---

Comment by aly.deines created at 2017-08-24 23:10:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-09-10 22:08:07

Author name missing...


---

Comment by vbraun created at 2017-09-10 22:08:07

Changing status from positive_review to needs_work.


---

Comment by edgarcosta created at 2017-09-11 00:11:49

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-09-15 07:31:07

Resolution: fixed
