# Issue 29379: maxima asks for assumption but then rejects it as redundant

archive/issues_029379.json:
```json
{
    "body": "Keywords: maxima\n\nAs reported in #29608, maxima sometimes asks for additional information, but then reports that the information is redundant when an attempt is made to provide the appropriate assumption. The problem seems to go away if the assumption is put inside a `with hold` clause.\n\n```\nsage: var('m');\nsage: assume(m, 'integer')\nsage: D = cos((4 * m + 1)*arcsin(1/sqrt(x^2 + 1)))/sqrt(x^2/(x^2 + 1));\nsage: limit(D, x=0)\n---------------------------------------------------------------------------\nRuntimeError               Traceback (most recent call last)\n    <snip>\nRuntimeError: ECL says: Maxima asks: Is cos((4*%pi*_SAGE_VAR_m+%pi)/2) \npositive, negative or zero?\n\nDuring handling of the above exception, another exception occurred:\n    <snip>\nValueError: Computation failed since Maxima requested additional constraints; \nusing the 'assume' command before evaluation *may* help (example of legal syntax \nis 'assume(cos((4*%pi*m+%pi)/2)>0)', see `assume?` for more details)\nIs cos((4*%pi*m+%pi)/2) positive, negative or zero?\n\nsage: assume(cos((4*pi*m+pi)/2) == 0)\n---------------------------------------------------------------------------\nValueError                 Traceback (most recent call last)\n    <snip>\nValueError: Assumption is redundant\n\nsage: with hold:\n....:     assume(cos((4*pi*m+pi)/2) == 0)\n....:     \nsage: limit(D, x=0)\n0\n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29616\n\n",
    "created_at": "2020-04-29T06:46:51Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "title": "maxima asks for assumption but then rejects it as redundant",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29379",
    "user": "@DaveWitteMorris"
}
```
Keywords: maxima

As reported in #29608, maxima sometimes asks for additional information, but then reports that the information is redundant when an attempt is made to provide the appropriate assumption. The problem seems to go away if the assumption is put inside a `with hold` clause.

```
sage: var('m');
sage: assume(m, 'integer')
sage: D = cos((4 * m + 1)*arcsin(1/sqrt(x^2 + 1)))/sqrt(x^2/(x^2 + 1));
sage: limit(D, x=0)
---------------------------------------------------------------------------
RuntimeError               Traceback (most recent call last)
    <snip>
RuntimeError: ECL says: Maxima asks: Is cos((4*%pi*_SAGE_VAR_m+%pi)/2) 
positive, negative or zero?

During handling of the above exception, another exception occurred:
    <snip>
ValueError: Computation failed since Maxima requested additional constraints; 
using the 'assume' command before evaluation *may* help (example of legal syntax 
is 'assume(cos((4*%pi*m+%pi)/2)>0)', see `assume?` for more details)
Is cos((4*%pi*m+%pi)/2) positive, negative or zero?

sage: assume(cos((4*pi*m+pi)/2) == 0)
---------------------------------------------------------------------------
ValueError                 Traceback (most recent call last)
    <snip>
ValueError: Assumption is redundant

sage: with hold:
....:     assume(cos((4*pi*m+pi)/2) == 0)
....:     
sage: limit(D, x=0)
0
```




Issue created by migration from https://trac.sagemath.org/ticket/29616





---

archive/issue_comments_416644.json:
```json
{
    "body": "I'm no expert, but my guess is that pynac (or somebody else) knows that the left side of the assumption is 0, and decides to be helpful by simplifying it to 0. Thus, maxima receives the assumption `0 == 0`, and quite reasonably rejects this as being redundant.\n\n```\nsage: var('m');\nsage: assume(m, 'integer')\nsage: cos((4*pi*m+pi)/2)\n0\n```\n\n\nSuggestions for how to fix this? If my diagnosis is correct, I think pynac (or whoever) should be prevented from messing up assumptions before they are passed to maxima.",
    "created_at": "2020-04-29T06:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29379#issuecomment-416644",
    "user": "@DaveWitteMorris"
}
```

I'm no expert, but my guess is that pynac (or somebody else) knows that the left side of the assumption is 0, and decides to be helpful by simplifying it to 0. Thus, maxima receives the assumption `0 == 0`, and quite reasonably rejects this as being redundant.

```
sage: var('m');
sage: assume(m, 'integer')
sage: cos((4*pi*m+pi)/2)
0
```


Suggestions for how to fix this? If my diagnosis is correct, I think pynac (or whoever) should be prevented from messing up assumptions before they are passed to maxima.



---

archive/issue_comments_416645.json:
```json
{
    "body": "Changing keywords from \"maxima\" to \"maxima, assume\".",
    "created_at": "2020-04-29T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29379#issuecomment-416645",
    "user": "@DaveWitteMorris"
}
```

Changing keywords from "maxima" to "maxima, assume".



---

archive/issue_comments_416646.json:
```json
{
    "body": "Changing component from interfaces to symbolics.",
    "created_at": "2020-04-29T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29379#issuecomment-416646",
    "user": "@DaveWitteMorris"
}
```

Changing component from interfaces to symbolics.



---

archive/issue_comments_416647.json:
```json
{
    "body": "I now see that my previous comment largely states the obvious; since `assume` is a function, the evaluation of `assume(statement)` entails evaluating `statement`, and then calling `assume` on the result. I think the bug is that the evaluation of `statement` is done by a different backend than the one that needs `statement`. \n\nCan this be fixed somehow? If not, and there is no harm in surrounding assumptions with `with hold`, perhaps this workaround should be suggested in the documentation.",
    "created_at": "2020-04-29T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29379#issuecomment-416647",
    "user": "@DaveWitteMorris"
}
```

I now see that my previous comment largely states the obvious; since `assume` is a function, the evaluation of `assume(statement)` entails evaluating `statement`, and then calling `assume` on the result. I think the bug is that the evaluation of `statement` is done by a different backend than the one that needs `statement`. 

Can this be fixed somehow? If not, and there is no harm in surrounding assumptions with `with hold`, perhaps this workaround should be suggested in the documentation.



---

archive/issue_comments_416648.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29379#issuecomment-416648",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_416649.json:
```json
{
    "body": "Another problem is that sagemath (following maxima) is giving the wrong value for the limit. The correct answer is `4*m + 1`, not `0`. A ticket to fix this is at #34140.",
    "created_at": "2022-07-09T18:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29379#issuecomment-416649",
    "user": "@DaveWitteMorris"
}
```

Another problem is that sagemath (following maxima) is giving the wrong value for the limit. The correct answer is `4*m + 1`, not `0`. A ticket to fix this is at #34140.
