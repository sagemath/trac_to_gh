# Issue 26442: clean generic_graph.py (part 13) - searches and constructors

archive/issues_026442.json:
```json
{
    "body": "CC:  @tscrim @fchapoton\n\nHere, we clean (PEP8 and avoid `.vertices` / `.edges`/ methods:\n- searches: `breadth_first_search`, `depth_first_search` (`lex_BFS` is done in #26630)\n- constructors: `add_clique`, `add_cycle`, `add_path`, `complement`, `to_simple`, `disjoint_union`, `union`, `cartesian_product`, `tensor_product`, `lexicographic_product`, `strong_product`, `disjunctive_product` (methos `transitive_...` are done in #26634)\n\nIssue created by migration from https://trac.sagemath.org/ticket/26679\n\n",
    "created_at": "2018-11-11T15:03:47Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "clean generic_graph.py (part 13) - searches and constructors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26442",
    "user": "https://github.com/dcoudert"
}
```
CC:  @tscrim @fchapoton

Here, we clean (PEP8 and avoid `.vertices` / `.edges`/ methods:
- searches: `breadth_first_search`, `depth_first_search` (`lex_BFS` is done in #26630)
- constructors: `add_clique`, `add_cycle`, `add_path`, `complement`, `to_simple`, `disjoint_union`, `union`, `cartesian_product`, `tensor_product`, `lexicographic_product`, `strong_product`, `disjunctive_product` (methos `transitive_...` are done in #26634)

Issue created by migration from https://trac.sagemath.org/ticket/26679





---

archive/issue_comments_371717.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-11-11T15:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371717",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_371718.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-11T15:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371718",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_371719.json:
```json
{
    "body": "The changes are breaking the construction of `graphs.EllinghamHorton54Graph()`, but so far I don't understand what's going on.\n\nIn method `union`, if, instead of \n\n```diff\n-        G.add_vertices(self.vertices())\n-        G.add_vertices(other.vertices())\n-        G.add_edges(self.edges())\n-        G.add_edges(other.edges())\n+        G.add_vertices(self)\n+        G.add_vertices(other)\n+        G.add_edges(self.edge_iterator())\n+        G.add_edges(other.edge_iterator())\n```\n\nI let the line `G.add_vertices(other.vertices())`, I don't have errors anymore O_o\n\nAny suggestion on possible cause of this issue?",
    "created_at": "2018-11-11T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371719",
    "user": "https://github.com/dcoudert"
}
```

The changes are breaking the construction of `graphs.EllinghamHorton54Graph()`, but so far I don't understand what's going on.

In method `union`, if, instead of 

```diff
-        G.add_vertices(self.vertices())
-        G.add_vertices(other.vertices())
-        G.add_edges(self.edges())
-        G.add_edges(other.edges())
+        G.add_vertices(self)
+        G.add_vertices(other)
+        G.add_edges(self.edge_iterator())
+        G.add_edges(other.edge_iterator())
```

I let the line `G.add_vertices(other.vertices())`, I don't have errors anymore O_o

Any suggestion on possible cause of this issue?



---

archive/issue_comments_371720.json:
```json
{
    "body": "My understanding is the following.\n- `graphs.EllinghamHorton54Graph()` uses twice `disjoint_union`, and makes assumption on the name of vertices after each operation\n- `disjoint_union` relabels the vertices of the graphs according the ordering `list(G)`, and then calls `union`.\n- When adding vertices in the graph `G` resulting from the union of `self` and `other`, the order in which vertices are added to `G` fixes the ordering `list(G)`. So, a later call to `disjoint_union`, that relabels the graphs using the ordering `list(G)` might result in a different result.\nSo, either we decide that the proposed changes, avoiding to use `.vertices()`, is ok and then I have to update method `EllinghamHorton54Graph` according the new ordering, or it is not ok and we must let `G.add_vertices(self.vertices())` and `G.add_vertices(other.vertices())` in `union`.\n\nIn my opinion, the current situation in which `disjoint_union` relies on the ordering `list(G)` and `union` relies on the ordering `G.vertices()` is not good.\n\nI can open a specific ticket if needed.",
    "created_at": "2018-11-17T10:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371720",
    "user": "https://github.com/dcoudert"
}
```

My understanding is the following.
- `graphs.EllinghamHorton54Graph()` uses twice `disjoint_union`, and makes assumption on the name of vertices after each operation
- `disjoint_union` relabels the vertices of the graphs according the ordering `list(G)`, and then calls `union`.
- When adding vertices in the graph `G` resulting from the union of `self` and `other`, the order in which vertices are added to `G` fixes the ordering `list(G)`. So, a later call to `disjoint_union`, that relabels the graphs using the ordering `list(G)` might result in a different result.
So, either we decide that the proposed changes, avoiding to use `.vertices()`, is ok and then I have to update method `EllinghamHorton54Graph` according the new ordering, or it is not ok and we must let `G.add_vertices(self.vertices())` and `G.add_vertices(other.vertices())` in `union`.

In my opinion, the current situation in which `disjoint_union` relies on the ordering `list(G)` and `union` relies on the ordering `G.vertices()` is not good.

I can open a specific ticket if needed.



---

archive/issue_comments_371721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-07T00:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371722.json:
```json
{
    "body": "I have reverted modifications of method `union` and created a dedicated ticket (#26851).",
    "created_at": "2018-12-07T00:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371722",
    "user": "https://github.com/dcoudert"
}
```

I have reverted modifications of method `union` and created a dedicated ticket (#26851).



---

archive/issue_comments_371723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-26T12:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371724.json:
```json
{
    "body": "no merge conflict with 8.7.beta3.",
    "created_at": "2019-02-09T10:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371724",
    "user": "https://github.com/dcoudert"
}
```

no merge conflict with 8.7.beta3.



---

archive/issue_comments_371725.json:
```json
{
    "body": "\n```\n             sage: if product_size != expected:\n-            ....:     print(\"Something is really wrong here...\", product_size, \"!=\", expected)\n+            ....:     raise ValueError(\"something is really wrong here... {} != {}\".format(product_size, expected))\n```\n\nI am not sure why raising a ValueError would be better here ? \\\\\nAnd to begin with the message has little value.\nIn similar cases i think we usually do something like: \n\n```\nsage: product_size == expected\nTrue\n```\n\nThis comment is more a question and not a blocking point.\n\nSome pep8 comments :\n- 1. Multiple space after keyword :\nline 17058 `if (neighbors is None and not isinstance(start, list) and  distance is None`\n- 2. Blank line contains whitespace: l 17465.\n- 3. Missing whitespace after ',' : \nl 17890 `G.add_vertices((u,v) for u in self for v in other)`\\\\\n\nl 17972 `G.add_vertices((u,v) ...`\\\\\n\nl 18043 `G.add_vertices((u,v) ...`",
    "created_at": "2019-02-12T19:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371725",
    "user": "https://github.com/vinklein"
}
```


```
             sage: if product_size != expected:
-            ....:     print("Something is really wrong here...", product_size, "!=", expected)
+            ....:     raise ValueError("something is really wrong here... {} != {}".format(product_size, expected))
```

I am not sure why raising a ValueError would be better here ? \\
And to begin with the message has little value.
In similar cases i think we usually do something like: 

```
sage: product_size == expected
True
```

This comment is more a question and not a blocking point.

Some pep8 comments :
- 1. Multiple space after keyword :
line 17058 `if (neighbors is None and not isinstance(start, list) and  distance is None`
- 2. Blank line contains whitespace: l 17465.
- 3. Missing whitespace after ',' : 
l 17890 `G.add_vertices((u,v) for u in self for v in other)`\\

l 17972 `G.add_vertices((u,v) ...`\\

l 18043 `G.add_vertices((u,v) ...`



---

archive/issue_comments_371726.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-13T07:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371727.json:
```json
{
    "body": "Right, the test is much better like that. Thank you.",
    "created_at": "2019-02-13T07:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371727",
    "user": "https://github.com/dcoudert"
}
```

Right, the test is much better like that. Thank you.



---

archive/issue_comments_371728.json:
```json
{
    "body": "You're welcome.\n\nLooks good to me.",
    "created_at": "2019-02-13T08:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371728",
    "user": "https://github.com/vinklein"
}
```

You're welcome.

Looks good to me.



---

archive/issue_comments_371729.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-13T08:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371729",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_024570.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-02-14T19:45:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26442#event-24570"
}
```



---

archive/issue_comments_371730.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-14T19:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26442#issuecomment-371730",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
