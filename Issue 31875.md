# Issue 31875: Bug in Chart.__init__ regarding the determination of top charts

Issue created by migration from https://trac.sagemath.org/ticket/32112

Original creator: egourgoulhon

Original creation time: 2021-07-03 14:46:31

CC:  mkoeppe tscrim @mjungmath vbraun

Keywords: coordinate chart

As noticed in #31901#comment:28, there is an issue when constructing two charts sharing the same coordinate symbols but not being otherwise related:

```
sage: M = Manifold(2, 'M', structure='topological')
sage: U = M.open_subset('U')
sage: V = M.open_subset('V')
sage: XU = U.chart('x y')
sage: XV = V.chart('x y')
sage: M.top_charts()
[Chart (U, (x, y))]
```

The chart `XV` should also appear as a top chart on `M`. 


---

Comment by egourgoulhon created at 2021-07-03 14:50:10

New commits:


---

Comment by egourgoulhon created at 2021-07-03 14:50:10

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-07-03 16:43:22

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-07-03 16:43:22

Thanks! This is working well.


---

Comment by mkoeppe created at 2021-07-03 18:35:33

It would have been good to do this on top of #32009 though


---

Comment by egourgoulhon created at 2021-07-04 15:42:11

Thanks for the review.

Replying to [comment:3 mkoeppe]:
> It would have been good to do this on top of #32009 though

Could you explain why? I mean, why `_domain` should become a Cython attribute?


---

Comment by mkoeppe created at 2021-07-04 16:20:20

In #31894 I hope to make `Chart` a subclass of `sage.categories.map.Map` so that all functionalities of morphisms such as composition etc. become available. `Map` is a Cython class in which `_domain` happens to be a Cython attribute.


---

Comment by mkoeppe created at 2021-07-04 23:51:30

As #32009 came back with a bug, I have made the present ticket a dependency of #32009 instead.


---

Comment by egourgoulhon created at 2021-07-05 09:17:27

Replying to [comment:5 mkoeppe]:
> In #31894 I hope to make `Chart` a subclass of `sage.categories.map.Map` so that all functionalities of morphisms such as composition etc. become available. `Map` is a Cython class in which `_domain` happens to be a Cython attribute.

Thanks for the explanation.


---

Comment by mkoeppe created at 2021-07-24 19:00:57

Resolution: fixed


---

Comment by mkoeppe created at 2021-07-24 19:00:57

Apparently this has been merged as part of #32089.
