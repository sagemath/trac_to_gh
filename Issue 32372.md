# Issue 32372: Remove more unnecessary uses of SR and symbolic functions in sage.combinat

Issue created by migration from https://trac.sagemath.org/ticket/32609

Original creator: mkoeppe

Original creation time: 2021-10-02 16:53:58

CC:  tscrim

Follow-up on #32411.

Use of `floor`/`ceil` from `sage.functions` can be avoided.

Modules that only need symbolics in some methods should avoid module-level imports from `sage.functions`, `sage.symbolic`, `sage.calculus`


```
src/sage/categories/loop_crystals.py:from sage.functions.other import ceil
src/sage/combinat/binary_recurrence_sequences.py:from sage.functions.log import log
src/sage/combinat/binary_recurrence_sequences.py:from sage.functions.other import sqrt
src/sage/combinat/crystals/littelmann_path.py:from sage.functions.other import floor
src/sage/combinat/crystals/tensor_product.py:from sage.functions.other import floor, ceil
src/sage/combinat/crystals/tensor_product_element.pyx:from sage.functions.other import ceil
src/sage/combinat/diagram_algebras.py:from sage.functions.other import floor, ceil
src/sage/combinat/finite_state_machine.py:from sage.calculus.var import var
src/sage/combinat/finite_state_machine.py:from sage.functions.trig import atan2
src/sage/combinat/k_tableau.py:from sage.functions.generalized import sgn
src/sage/combinat/parallelogram_polyomino.py:from sage.functions.trig import cos, sin
src/sage/combinat/parallelogram_polyomino.py:from sage.functions.other import sqrt
src/sage/combinat/partition.py:from sage.symbolic.ring import var
src/sage/combinat/partition_algebra.py:from sage.functions.all import ceil
src/sage/combinat/root_system/coxeter_type.py:from sage.symbolic.ring import SR
src/sage/combinat/sine_gordon.py:from sage.functions.trig import cos, sin
src/sage/combinat/sine_gordon.py:from sage.symbolic.constants import pi, I
src/sage/combinat/sine_gordon.py:from sage.functions.log import exp
src/sage/combinat/sine_gordon.py:from sage.functions.other import ceil
src/sage/combinat/sine_gordon.py:from sage.symbolic.ring import SR
src/sage/combinat/sine_gordon.py:from sage.functions.other import real_part, imag_part
src/sage/combinat/sloane_functions.py:from sage.functions.all import prime_pi
src/sage/combinat/symmetric_group_representations.py:from sage.symbolic.ring import SR
src/sage/combinat/symmetric_group_representations.py:from sage.functions.all import sqrt
```



---

Comment by mkoeppe created at 2022-02-27 23:02:15

New commits:


---

Comment by mkoeppe created at 2022-02-27 23:02:45

Changing status from new to needs_review.


---

Comment by git created at 2022-02-27 23:13:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 00:45:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-02-28 01:06:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 01:31:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 02:24:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 03:06:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 03:12:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 03:15:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 03:19:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 03:27:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 03:57:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 05:43:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2022-02-28 21:58:26

Some more parts can be made symbolics-free,
though sometimes it makes things convoluted.

*File `src/sage/categories/algebra_functor.py`*

We can bypass using `sqrt(5)` to construct `ZZ[sqrt(5)]`:


```
    sage: G = GL(2, 7)
    sage: K = QuadraticField(5, 'srqt5')
    sage: Zr5 = K.order(K.gen())  # This is ZZ[sqrt(5)]
    sage: OG = GroupAlgebra(G, Zr5)
    sage: OG(2)
    2*[1 0]
    [0 1]
    sage: OG(G(2))
    [2 0]
    [0 2]
 
    sage: OG(FormalSum([ (1, G(2)), (2, RR(0.77)) ]) )
    Traceback (most recent call last):
    ...
    TypeError: Attempt to coerce non-integral RealNumber to Integer
    sage: OG(OG.base_ring().basis()[1])
    sqrt5*[1 0]
    [0 1]
```


Keeping the clearer `ZZ[sqrt(5)]` and adding
`# optional - sage.symbolic` makes sense too.

I wish `sqrt(5)` gave an element in a number field
or `AA` or `QQbar`, not in the symbolic ring...

*File `src/sage/categories/coxeter_groups.py`*

Using a polynomial variable can bypass symbolics here:


```diff
                 sage: W = CoxeterGroups().example()
-                sage: sum((x^w.length()) for w in W) - expand(prod(sum(x^i for i in range(j+1)) for j in range(4))) # This is scandalously slow!!!  # optional - sage.symbolic
+                sage: x = polygen(ZZ)
+                sage: s = sum(x^w.length() for w in W)
+                sage: p = prod(sum(x^i for i in range(j)) for j in range(1, 5))
+                sage: s - p
                 0
```


The 2009 "scandalously slow" comment can probably go?

*File `src/sage/categories/pushout.py`*

Using `sqrt(3.)` and `(2.)^(1/3)` makes this symbolics-free:


```diff
-            sage: K.<a> = NumberField(x^3-2, embedding=CDF(1/2*I*2^(1/3)*sqrt(3) - 1/2*2^(1/3)))
+            sage: cbrt2 = CDF(2)^(1/3)
+            sage: zeta3 = CDF(-1/2, sqrt(3.)/2)
+            sage: K.<a> = NumberField(x^3 - 2, embedding=cbrt2 * zeta3)
```



---

Comment by mkoeppe created at 2022-02-28 22:20:28

Replying to [comment:17 slelievre]:
> Some more parts can be made symbolics-free,
> though sometimes it makes things convoluted.
> 
> *File `src/sage/categories/algebra_functor.py`*
> 
> We can bypass using `sqrt(5)` to construct `ZZ[sqrt(5)]`:
> 
> {{{
>     sage: G = GL(2, 7)
>     sage: K = QuadraticField(5, 'srqt5')
>     sage: Zr5 = K.order(K.gen())  # This is ZZ[sqrt(5)]

Or just `ZZ[AA(5).sqrt()]`


---

Comment by git created at 2022-02-28 22:23:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-28 22:27:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-28 22:27:39

Replying to [comment:17 slelievre]:
> *File `src/sage/categories/coxeter_groups.py`*
> 
> Using a polynomial variable can bypass symbolics here [...]

Thanks, I've made a similar change


---

Comment by git created at 2022-02-28 22:37:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2022-02-28 23:19:56

I like `ZZ[AA(5).sqrt()]` but it does not name
the generator `sqrt5` as `ZZ[sqrt(5)]`:

```
sage: ZZ[sqrt(5)]
Order in Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?
sage: ZZ[AA(5).sqrt()]
Order in Number Field in a with defining polynomial x^2 - 5 with a = 2.236067977499790?
```

so you need to change:

```diff
     sage: OG(OG.base_ring().basis()[1])
-    sqrt5*[1 0]
+    a*[1 0]
     [0 1]
```



---

Comment by git created at 2022-02-28 23:27:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-01 06:27:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-01 06:30:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-01 18:30:50

The remaining doctest failure (and the pyflakes warnings) seen in the patchbot run are not from this ticket.


---

Comment by git created at 2022-03-08 17:46:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2022-03-09 11:26:00

If bots go green or only report errors unrelated to this, positive review.


---

Comment by mkoeppe created at 2022-03-09 22:15:14

Patchbot failures and pyflakes warnings are unrelated.


---

Comment by mkoeppe created at 2022-03-09 22:15:25

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-03-09 22:15:25

Thank you!


---

Comment by vbraun created at 2022-03-12 15:11:17

Resolution: fixed
