# Issue 28271: An API for testing if a parent's element “are” real/complex numbers

archive/issues_028271.json:
```json
{
    "body": "See commit messages.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28508\n\n",
    "created_at": "2019-09-16T14:28:54Z",
    "labels": [
        "coercion",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "An API for testing if a parent's element \u201care\u201d real/complex numbers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28271",
    "user": "@mezzarobba"
}
```
See commit messages.

Issue created by migration from https://trac.sagemath.org/ticket/28508





---

archive/issue_comments_399299.json:
```json
{
    "body": "Not well tested on my side, because my Sage build uses versions of various packages with which lots of doctests fail. Let's see what the patchbot says.",
    "created_at": "2019-09-16T14:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399299",
    "user": "@mezzarobba"
}
```

Not well tested on my side, because my Sage build uses versions of various packages with which lots of doctests fail. Let's see what the patchbot says.



---

archive/issue_comments_399300.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-16T14:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399300",
    "user": "@mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_399301.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-16T14:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399301",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_399302.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-17T14:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399302",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_399303.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-18T09:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399303",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_399304.json:
```json
{
    "body": "Should be okay now...",
    "created_at": "2019-09-18T09:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399304",
    "user": "@mezzarobba"
}
```

Should be okay now...



---

archive/issue_comments_399305.json:
```json
{
    "body": "Could you clarify the specification of the functions? I find the sentence `can be canonically considered a subring of` a bit vague. For example `RR` (the mpfr floating point real number in Sage) is **not** a ring and hence not a subring of the real numbers.",
    "created_at": "2019-09-19T08:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399305",
    "user": "@videlec"
}
```

Could you clarify the specification of the functions? I find the sentence `can be canonically considered a subring of` a bit vague. For example `RR` (the mpfr floating point real number in Sage) is **not** a ring and hence not a subring of the real numbers.



---

archive/issue_comments_399306.json:
```json
{
    "body": "Maybe you meant `subset`?",
    "created_at": "2019-09-19T08:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399306",
    "user": "@videlec"
}
```

Maybe you meant `subset`?



---

archive/issue_comments_399307.json:
```json
{
    "body": "Could you also justify the terminology `numerical`? For me it would have been hard to find out this method. The keywords I would have tried are `real`, `subset`, `real embedded`. Also, numerical sounds like numerical analysis which refers mostly to floating point computations.",
    "created_at": "2019-09-19T08:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399307",
    "user": "@videlec"
}
```

Could you also justify the terminology `numerical`? For me it would have been hard to find out this method. The keywords I would have tried are `real`, `subset`, `real embedded`. Also, numerical sounds like numerical analysis which refers mostly to floating point computations.



---

archive/issue_comments_399308.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-09-19T08:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399308",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_399309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-19T08:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399309",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399310.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-09-19T08:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399310",
    "user": "@mezzarobba"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_399311.json:
```json
{
    "body": "Hi Vincent,\n\nThank you for your comments.\n\nI agree that the documentation is not great. The idea was just to factor out the idiom `RR(2).has_coerce_map_from(P)` that is used in a number of places, and to cache the result. (I also think that a way to test if a ring is a subring of the reals would be a good think to have, but that's not the point of this ticket.)\n\nI'm happy with improving the documentation again if you have a better wording to suggest. However, I would prefer not to make changes that require rebasing #28517 without a really compelling reason at this point, because I'm starting to lack on time for all that, and #28517 is frankly a lot more important. If we want to rename the new functions or something like that, I think it will be easier to do it once #28517 has been reviewd.",
    "created_at": "2019-09-19T08:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399311",
    "user": "@mezzarobba"
}
```

Hi Vincent,

Thank you for your comments.

I agree that the documentation is not great. The idea was just to factor out the idiom `RR(2).has_coerce_map_from(P)` that is used in a number of places, and to cache the result. (I also think that a way to test if a ring is a subring of the reals would be a good think to have, but that's not the point of this ticket.)

I'm happy with improving the documentation again if you have a better wording to suggest. However, I would prefer not to make changes that require rebasing #28517 without a really compelling reason at this point, because I'm starting to lack on time for all that, and #28517 is frankly a lot more important. If we want to rename the new functions or something like that, I think it will be easier to do it once #28517 has been reviewd.



---

archive/issue_comments_399312.json:
```json
{
    "body": "Salut Marc,\n\nI definitely agree that factorizing the various \"is my ring a subring of real numbers\" into a method is good idea. But since this ticket is fixing naming conventions, they should be thought carefully.\n\nThough as nothing is pulled in the global Sage namespace and we can fix names later on.",
    "created_at": "2019-09-19T08:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399312",
    "user": "@videlec"
}
```

Salut Marc,

I definitely agree that factorizing the various "is my ring a subring of real numbers" into a method is good idea. But since this ticket is fixing naming conventions, they should be thought carefully.

Though as nothing is pulled in the global Sage namespace and we can fix names later on.



---

archive/issue_comments_399313.json:
```json
{
    "body": "- In `parent_is_numerical` docstring:\n  - `this parent or type` -> `the parent or type ``P```\n  - `typecan` -> `type can`\n\nFor efficiency reason, we might want to special case standard Python types in `parent_is_numerical` and `parent_is_real_numerical` rather than relying on `py_scalar_parent`.\n\nIt would be good to also tests non standard Python types such as `gmpy2.mpz`, `gmpy2.mpq`, `gmpy2.mpfr`, `gmpy2.mpc`.",
    "created_at": "2019-09-19T09:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399313",
    "user": "@videlec"
}
```

- In `parent_is_numerical` docstring:
  - `this parent or type` -> `the parent or type ``P```
  - `typecan` -> `type can`

For efficiency reason, we might want to special case standard Python types in `parent_is_numerical` and `parent_is_real_numerical` rather than relying on `py_scalar_parent`.

It would be good to also tests non standard Python types such as `gmpy2.mpz`, `gmpy2.mpq`, `gmpy2.mpfr`, `gmpy2.mpc`.



---

archive/issue_comments_399314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-19T09:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399314",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_399315.json:
```json
{
    "body": "Replying to [comment:13 vdelecroix]:\n> - In `parent_is_numerical` docstring:\n>   - `this parent or type` -> `the parent or type ``P```\n>   - `typecan` -> `type can`\n\nDone, thanks.\n\n> For efficiency reason, we might want to special case standard Python types in `parent_is_numerical` and `parent_is_real_numerical` rather than relying on `py_scalar_parent`.\n\nI think that's premature. `py_scalar_parent` is quite fast, and non-Sage objects aren't used that much in time-critical code.\n\n> It would be good to also tests non standard Python types such as `gmpy2.mpz`, `gmpy2.mpq`, `gmpy2.mpfr`, `gmpy2.mpc`.\n\nDone.",
    "created_at": "2019-09-19T09:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399315",
    "user": "@mezzarobba"
}
```

Replying to [comment:13 vdelecroix]:
> - In `parent_is_numerical` docstring:
>   - `this parent or type` -> `the parent or type ``P```
>   - `typecan` -> `type can`

Done, thanks.

> For efficiency reason, we might want to special case standard Python types in `parent_is_numerical` and `parent_is_real_numerical` rather than relying on `py_scalar_parent`.

I think that's premature. `py_scalar_parent` is quite fast, and non-Sage objects aren't used that much in time-critical code.

> It would be good to also tests non standard Python types such as `gmpy2.mpz`, `gmpy2.mpq`, `gmpy2.mpfr`, `gmpy2.mpc`.

Done.



---

archive/issue_comments_399316.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-19T09:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399316",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_399317.json:
```json
{
    "body": "Thank you!",
    "created_at": "2019-09-19T09:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399317",
    "user": "@mezzarobba"
}
```

Thank you!



---

archive/issue_comments_399318.json:
```json
{
    "body": "Fails on python 3, multiple occurances of:\n\n```\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 380, in sage.structure.coerce.parent_is_numerical\nFailed example:\n    [parent_is_numerical(R) for R in SR, QQ['x'], QQ[['x']], str]\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1121, in compile_and_execute\n        compiled = compiler(example)\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 649, in compiler\n        compileflags, 1)\n      File \"<doctest sage.structure.coerce.parent_is_numerical[3]>\", line 1\n        [parent_is_numerical(R) for R in SR, QQ['x'], QQ[['x']], str]\n                                           ^\n    SyntaxError: invalid syntax\n**********************************************************************\n```\n",
    "created_at": "2019-10-05T07:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399318",
    "user": "@vbraun"
}
```

Fails on python 3, multiple occurances of:

```
**********************************************************************
File "src/sage/structure/coerce.pyx", line 380, in sage.structure.coerce.parent_is_numerical
Failed example:
    [parent_is_numerical(R) for R in SR, QQ['x'], QQ[['x']], str]
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1121, in compile_and_execute
        compiled = compiler(example)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 649, in compiler
        compileflags, 1)
      File "<doctest sage.structure.coerce.parent_is_numerical[3]>", line 1
        [parent_is_numerical(R) for R in SR, QQ['x'], QQ[['x']], str]
                                           ^
    SyntaxError: invalid syntax
**********************************************************************
```




---

archive/issue_comments_399319.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-10-05T07:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399319",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_399320.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-05T09:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399320",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399321.json:
```json
{
    "body": "Replying to [comment:18 vbraun]:\n> Fails on python 3,\n\nThank you. Fixed (I think).",
    "created_at": "2019-10-05T09:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399321",
    "user": "@mezzarobba"
}
```

Replying to [comment:18 vbraun]:
> Fails on python 3,

Thank you. Fixed (I think).



---

archive/issue_comments_399322.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-05T09:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399322",
    "user": "@mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_399323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-14T15:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399323",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_399324.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-20T22:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28271#issuecomment-399324",
    "user": "@vbraun"
}
```

Resolution: fixed
