# Issue 28271: An API for testing if a parent's element “are” real/complex numbers

Issue created by migration from https://trac.sagemath.org/ticket/28508

Original creator: mmezzarobba

Original creation time: 2019-09-16 14:28:54

See commit messages.


---

Comment by mmezzarobba created at 2019-09-16 14:30:36

Not well tested on my side, because my Sage build uses versions of various packages with which lots of doctests fail. Let's see what the patchbot says.


---

Comment by mmezzarobba created at 2019-09-16 14:30:36

Changing status from new to needs_review.


---

Comment by git created at 2019-09-16 14:32:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-09-17 14:38:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-09-18 09:41:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2019-09-18 09:41:31

Should be okay now...


---

Comment by vdelecroix created at 2019-09-19 08:19:35

Could you clarify the specification of the functions? I find the sentence `can be canonically considered a subring of` a bit vague. For example `RR` (the mpfr floating point real number in Sage) is *not* a ring and hence not a subring of the real numbers.


---

Comment by vdelecroix created at 2019-09-19 08:19:49

Maybe you meant `subset`?


---

Comment by vdelecroix created at 2019-09-19 08:24:11

Could you also justify the terminology `numerical`? For me it would have been hard to find out this method. The keywords I would have tried are `real`, `subset`, `real embedded`. Also, numerical sounds like numerical analysis which refers mostly to floating point computations.


---

Comment by vdelecroix created at 2019-09-19 08:43:44

Changing status from needs_review to needs_info.


---

Comment by git created at 2019-09-19 08:49:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2019-09-19 08:52:52

Changing status from needs_info to needs_review.


---

Comment by mmezzarobba created at 2019-09-19 08:52:52

Hi Vincent,

Thank you for your comments.

I agree that the documentation is not great. The idea was just to factor out the idiom `RR(2).has_coerce_map_from(P)` that is used in a number of places, and to cache the result. (I also think that a way to test if a ring is a subring of the reals would be a good think to have, but that's not the point of this ticket.)

I'm happy with improving the documentation again if you have a better wording to suggest. However, I would prefer not to make changes that require rebasing #28517 without a really compelling reason at this point, because I'm starting to lack on time for all that, and #28517 is frankly a lot more important. If we want to rename the new functions or something like that, I think it will be easier to do it once #28517 has been reviewd.


---

Comment by vdelecroix created at 2019-09-19 08:56:12

Salut Marc,

I definitely agree that factorizing the various "is my ring a subring of real numbers" into a method is good idea. But since this ticket is fixing naming conventions, they should be thought carefully.

Though as nothing is pulled in the global Sage namespace and we can fix names later on.


---

Comment by vdelecroix created at 2019-09-19 09:15:20

- In `parent_is_numerical` docstring:
  - `this parent or type` -> `the parent or type ``P```
  - `typecan` -> `type can`

For efficiency reason, we might want to special case standard Python types in `parent_is_numerical` and `parent_is_real_numerical` rather than relying on `py_scalar_parent`.

It would be good to also tests non standard Python types such as `gmpy2.mpz`, `gmpy2.mpq`, `gmpy2.mpfr`, `gmpy2.mpc`.


---

Comment by git created at 2019-09-19 09:28:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2019-09-19 09:30:58

Replying to [comment:13 vdelecroix]:
> - In `parent_is_numerical` docstring:
>   - `this parent or type` -> `the parent or type ``P```
>   - `typecan` -> `type can`

Done, thanks.

> For efficiency reason, we might want to special case standard Python types in `parent_is_numerical` and `parent_is_real_numerical` rather than relying on `py_scalar_parent`.

I think that's premature. `py_scalar_parent` is quite fast, and non-Sage objects aren't used that much in time-critical code.

> It would be good to also tests non standard Python types such as `gmpy2.mpz`, `gmpy2.mpq`, `gmpy2.mpfr`, `gmpy2.mpc`.

Done.


---

Comment by vdelecroix created at 2019-09-19 09:36:48

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2019-09-19 09:49:17

Thank you!


---

Comment by vbraun created at 2019-10-05 07:57:24

Fails on python 3, multiple occurances of:

```
**********************************************************************
File "src/sage/structure/coerce.pyx", line 380, in sage.structure.coerce.parent_is_numerical
Failed example:
    [parent_is_numerical(R) for R in SR, QQ['x'], QQ[['x']], str]
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1121, in compile_and_execute
        compiled = compiler(example)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 649, in compiler
        compileflags, 1)
      File "<doctest sage.structure.coerce.parent_is_numerical[3]>", line 1
        [parent_is_numerical(R) for R in SR, QQ['x'], QQ[['x']], str]
                                           ^
    SyntaxError: invalid syntax
**********************************************************************
```



---

Comment by vbraun created at 2019-10-05 07:57:24

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-10-05 09:36:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2019-10-05 09:37:20

Replying to [comment:18 vbraun]:
> Fails on python 3,

Thank you. Fixed (I think).


---

Comment by mmezzarobba created at 2019-10-05 09:37:20

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2019-10-14 15:13:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-10-20 22:19:04

Resolution: fixed
