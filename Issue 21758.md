# Issue 21758: Fix comparison operators of PoorManMap

archive/issues_021758.json:
```json
{
    "body": "PoorManMap currently only implements `__eq__` but not `__hash__` nor `__neq__`.\n\nThis ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `__eq__` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21995\n\n",
    "created_at": "2016-11-29T23:29:19Z",
    "labels": [
        "categories",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Fix comparison operators of PoorManMap",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21758",
    "user": "saraedum"
}
```
PoorManMap currently only implements `__eq__` but not `__hash__` nor `__neq__`.

This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `__eq__` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.

Issue created by migration from https://trac.sagemath.org/ticket/21995





---

archive/issue_comments_301890.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-29T23:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301890",
    "user": "saraedum"
}
```

New commits:



---

archive/issue_comments_301891.json:
```json
{
    "body": "I still have to wait for my sage to build to check that this actually works.",
    "created_at": "2016-11-29T23:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301891",
    "user": "saraedum"
}
```

I still have to wait for my sage to build to check that this actually works.



---

archive/issue_comments_301892.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-29T23:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301892",
    "user": "saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_301893.json:
```json
{
    "body": "I just realized that PoorManMap is inherited from PoorManMapCompose. Got to fix that one as well.",
    "created_at": "2016-11-29T23:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301893",
    "user": "saraedum"
}
```

I just realized that PoorManMap is inherited from PoorManMapCompose. Got to fix that one as well.



---

archive/issue_comments_301894.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-29T23:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301894",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_301895.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-29T23:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301895",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301896.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T00:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301896",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_301897.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-30T01:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301897",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_301898.json:
```json
{
    "body": "Xavier Caruso proposed to simplify this by integrating the compose map logic into `PoorManMap`.",
    "created_at": "2016-11-30T01:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301898",
    "user": "saraedum"
}
```

Xavier Caruso proposed to simplify this by integrating the compose map logic into `PoorManMap`.



---

archive/issue_comments_301899.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-30T02:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301899",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301900.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T02:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301900",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_301901.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2016-11-30T03:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301901",
    "user": "roed"
}
```

Looks good to me.



---

archive/issue_comments_301902.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-30T03:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301902",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301903.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-11-30T03:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301903",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_301904.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-11-30T03:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301904",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_301905.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-30T03:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301905",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301906.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2016-11-30T05:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301906",
    "user": "caruso"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_301907.json:
```json
{
    "body": "(Sorry, I got troubles with my Internet connexion yesterday.)\n\nI've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)",
    "created_at": "2016-11-30T05:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301907",
    "user": "caruso"
}
```

(Sorry, I got troubles with my Internet connexion yesterday.)

I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)



---

archive/issue_comments_301908.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-11-30T05:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301908",
    "user": "caruso"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_301909.json:
```json
{
    "body": "Mostly to cc myself, but there should not be periods at the ends of each of the `INPUT:`s.",
    "created_at": "2016-11-30T17:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301909",
    "user": "tscrim"
}
```

Mostly to cc myself, but there should not be periods at the ends of each of the `INPUT:`s.



---

archive/issue_comments_301910.json:
```json
{
    "body": "tscrim: I agree. But there's actually an example for that here http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content",
    "created_at": "2016-11-30T17:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301910",
    "user": "saraedum"
}
```

tscrim: I agree. But there's actually an example for that here http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content



---

archive/issue_comments_301911.json:
```json
{
    "body": "*grumbles as bangs head into desk* That explains the uptake in (grammatically incorrect) periods. Looking further, there are a couple of other things to fix there too. I will fix all of that on a separate ticket.",
    "created_at": "2016-11-30T17:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301911",
    "user": "tscrim"
}
```

*grumbles as bangs head into desk* That explains the uptake in (grammatically incorrect) periods. Looking further, there are a couple of other things to fix there too. I will fix all of that on a separate ticket.



---

archive/issue_comments_301912.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-30T19:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301912",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301913.json:
```json
{
    "body": "Replying to [comment:16 caruso]:\n> I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)\n\nOops. I fixed that doctest. And I also added some checks when the domains and codomains are parents. But if they are just iterables, I am not sure what to do? Checking for equality seems to restrictive: for `f*g`, the codomain of `g` should be contained in the domain of `f` but they do not have to be equal I think. In any case, comparing them (whether for equality or containment) is quite costly, i.e., O(cardinality) at best. And I would need to special case if the (co)domain is an iterable because then it could well be infinite.\nWhat do you think?",
    "created_at": "2016-11-30T19:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301913",
    "user": "saraedum"
}
```

Replying to [comment:16 caruso]:
> I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)

Oops. I fixed that doctest. And I also added some checks when the domains and codomains are parents. But if they are just iterables, I am not sure what to do? Checking for equality seems to restrictive: for `f*g`, the codomain of `g` should be contained in the domain of `f` but they do not have to be equal I think. In any case, comparing them (whether for equality or containment) is quite costly, i.e., O(cardinality) at best. And I would need to special case if the (co)domain is an iterable because then it could well be infinite.
What do you think?



---

archive/issue_comments_301914.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-30T19:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301914",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301915.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T19:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301915",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_301916.json:
```json
{
    "body": "Looks fine to me.\n\nJust a small remark: in the doctest of `__call__`, it's better to use g*f than f*g.",
    "created_at": "2016-12-03T19:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301916",
    "user": "caruso"
}
```

Looks fine to me.

Just a small remark: in the doctest of `__call__`, it's better to use g*f than f*g.



---

archive/issue_comments_301917.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T21:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301917",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301918.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-13T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301918",
    "user": "caruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301919.json:
```json
{
    "body": "Ok, thanks. That's nice.",
    "created_at": "2016-12-13T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301919",
    "user": "caruso"
}
```

Ok, thanks. That's nice.



---

archive/issue_comments_301920.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-14T23:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21758#issuecomment-301920",
    "user": "vbraun"
}
```

Resolution: fixed
