# Issue 21758: Fix comparison operators of PoorManMap

Issue created by migration from https://trac.sagemath.org/ticket/21995

Original creator: saraedum

Original creation time: 2016-11-29 23:29:19

PoorManMap currently only implements `__eq__` but not `__hash__` nor `__neq__`.

This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `__eq__` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.


---

Comment by saraedum created at 2016-11-29 23:35:59

New commits:


---

Comment by saraedum created at 2016-11-29 23:42:37

I still have to wait for my sage to build to check that this actually works.


---

Comment by saraedum created at 2016-11-29 23:42:37

Changing status from new to needs_review.


---

Comment by saraedum created at 2016-11-29 23:43:43

I just realized that PoorManMap is inherited from PoorManMapCompose. Got to fix that one as well.


---

Comment by saraedum created at 2016-11-29 23:43:43

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-11-29 23:58:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-11-30 00:01:10

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2016-11-30 01:46:00

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2016-11-30 01:46:00

Xavier Caruso proposed to simplify this by integrating the compose map logic into `PoorManMap`.


---

Comment by git created at 2016-11-30 02:05:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-11-30 02:05:39

Changing status from needs_work to needs_review.


---

Comment by roed created at 2016-11-30 03:06:13

Looks good to me.


---

Comment by roed created at 2016-11-30 03:06:32

Changing status from needs_review to positive_review.


---

Comment by git created at 2016-11-30 03:28:17

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2016-11-30 03:28:17

Changing status from positive_review to needs_review.


---

Comment by roed created at 2016-11-30 03:30:52

Changing status from needs_review to positive_review.


---

Comment by caruso created at 2016-11-30 05:51:20

Changing status from positive_review to needs_info.


---

Comment by caruso created at 2016-11-30 05:51:20

(Sorry, I got troubles with my Internet connexion yesterday.)

I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)


---

Comment by caruso created at 2016-11-30 05:56:23

Changing status from needs_info to needs_work.


---

Comment by tscrim created at 2016-11-30 17:43:04

Mostly to cc myself, but there should not be periods at the ends of each of the `INPUT:`s.


---

Comment by saraedum created at 2016-11-30 17:50:08

tscrim: I agree. But there's actually an example for that here http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content


---

Comment by tscrim created at 2016-11-30 17:54:04

*grumbles as bangs head into desk* That explains the uptake in (grammatically incorrect) periods. Looking further, there are a couple of other things to fix there too. I will fix all of that on a separate ticket.


---

Comment by git created at 2016-11-30 19:26:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-11-30 19:53:44

Replying to [comment:16 caruso]:
> I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)

Oops. I fixed that doctest. And I also added some checks when the domains and codomains are parents. But if they are just iterables, I am not sure what to do? Checking for equality seems to restrictive: for `f*g`, the codomain of `g` should be contained in the domain of `f` but they do not have to be equal I think. In any case, comparing them (whether for equality or containment) is quite costly, i.e., O(cardinality) at best. And I would need to special case if the (co)domain is an iterable because then it could well be infinite.
What do you think?


---

Comment by git created at 2016-11-30 19:53:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-11-30 19:54:21

Changing status from needs_work to needs_review.


---

Comment by caruso created at 2016-12-03 19:57:04

Looks fine to me.

Just a small remark: in the doctest of `__call__`, it's better to use g*f than f*g.


---

Comment by git created at 2016-12-13 21:26:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2016-12-13 21:30:19

Changing status from needs_review to positive_review.


---

Comment by caruso created at 2016-12-13 21:30:19

Ok, thanks. That's nice.


---

Comment by vbraun created at 2016-12-14 23:15:49

Resolution: fixed
