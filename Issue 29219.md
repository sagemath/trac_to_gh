# Issue 29219: Meta-ticket: Support gcc 10 (fedora-32)

Issue created by migration from https://trac.sagemath.org/ticket/29456

Original creator: mkoeppe

Original creation time: 2020-04-03 13:44:42

CC:  dimpase mjo fbissey vbraun enriqueartal alexjbest heluani charpent

Various packages have build errors with gcc 10, which is shipped with `fedora-32`. 
Hopefully we can wait for upstream to fix these errors.

- gf2x: #29390 gf2x build fails on `fedora-32-minimal`
- scipy: see #29443: Update scipy to 1.2.3 (last release supporting py2) 
- sympow: see #3360
- palp


---

Comment by mkoeppe created at 2020-04-26 04:23:00

Changing priority from major to critical.


---

Comment by fbissey created at 2020-04-26 05:25:27

Any more details on palp?


---

Comment by fbissey created at 2020-04-26 05:26:29

Also, if we are targeting 9.2 we can move to higher scipy.


---

Comment by mkoeppe created at 2020-04-26 06:33:51

Replying to [comment:3 fbissey]:
> Any more details on palp?
For example here: https://github.com/mkoeppe/sage/runs/618646432?check_suite_focus=true


---

Comment by mkoeppe created at 2020-04-26 06:35:20

Replying to [comment:4 fbissey]:
> Also, if we are targeting 9.2 we can move to higher scipy.
As far as I can see there is no release yet with the fix


---

Comment by mkoeppe created at 2020-04-26 06:36:14

Question is whether we want to fix this for 9.1 already.


---

Comment by mkoeppe created at 2020-04-26 18:55:49

Presumably Fedora 32 has patched packages.


---

Comment by dimpase created at 2020-04-27 02:03:29

Replying to [comment:5 mkoeppe]:
> Replying to [comment:3 fbissey]:
> > Any more details on palp?
> For example here: https://github.com/mkoeppe/sage/runs/618646432?check_suite_focus=true

```
2020-04-26T04:55:26.7728042Z   [palp-2.1.p2]   MoriCone.c: In function 'Triang2dSFan':
2020-04-26T04:55:26.7728579Z   [palp-2.1.p2]   MoriCone.c:489:48: warning: 'Z[0]' may be used uninitialized in this function [-Wmaybe-uninitialized]
2020-04-26T04:55:26.7729093Z   [palp-2.1.p2]     489 | #define BZangle(a,b) (ConeAngle(B.x[Z[a]],B.x[Z[b]])) // Gale-points
2020-04-26T04:55:26.7729654Z   [palp-2.1.p2]         |                                                ^
2020-04-26T04:55:26.7730199Z   [palp-2.1.p2]   gcc -O3 -W -Wall  -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE   -c -o SingularInput.o SingularInput.c
2020-04-26T04:55:26.7730774Z   [palp-2.1.p2]   gcc -O3 -W -Wall  -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -o poly.x poly.o Coord.o Rat.o Vertex.o Polynf.o LG.o
2020-04-26T04:55:26.7731343Z   [palp-2.1.p2]   gcc -O3 -W -Wall  -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -o class.x class.o Coord.o Rat.o Vertex.o Polynf.o Subpoly.o Subadd.o Subdb.o
2020-04-26T04:55:26.7731892Z   [palp-2.1.p2]   gcc -O3 -W -Wall  -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -o cws.x cws.o Coord.o Rat.o Vertex.o Polynf.o LG.o
2020-04-26T04:55:26.7732465Z   [palp-2.1.p2]   gcc -O3 -W -Wall  -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -o nef.x nef.o Coord.o Rat.o Vertex.o Polynf.o E_Poly.o Nefpart.o LG.o
2020-04-26T04:55:26.7733264Z   [palp-2.1.p2]   gcc -O3 -W -Wall  -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -o mori.x mori.o Coord.o Rat.o Vertex.o Polynf.o MoriCone.o SingularInput.o LG.o
2020-04-26T04:55:26.7733900Z   [palp-2.1.p2]   /usr/bin/ld: MoriCone.o:(.bss+0x0): multiple definition of `nr_SR_elements'; mori.o:(.bss+0x10): first defined here
2020-04-26T04:55:26.7734659Z   [palp-2.1.p2]   /usr/bin/ld: SingularInput.o:(.bss+0x0): multiple definition of `nr_SR_elements'; mori.o:(.bss+0x10): first defined here
2020-04-26T04:55:26.7735158Z   [palp-2.1.p2]   /usr/bin/ld: SingularInput.o: in function `HyperSurfSingular':
2020-04-26T04:55:26.7735673Z   [palp-2.1.p2]   SingularInput.c:(.text+0x1e1): warning: the use of `tmpnam' is dangerous, better use `mkstemp'
2020-04-26T04:55:26.7736112Z   [palp-2.1.p2]   collect2: error: ld returned 1 exit status
2020-04-26T04:55:26.7736565Z   [palp-2.1.p2]   make[4]: *** [Makefile:50: mori] Error 1
2020-04-26T04:55:26.7737028Z   [palp-2.1.p2]   make[4]: Target 'all' not remade because of errors.
2020-04-26T04:55:26.7737532Z   [palp-2.1.p2]   make[4]: Leaving directory '/sage/local/var/tmp/sage/build/palp-2.1.p2/src'
2020-04-26T04:55:26.7738036Z   [palp-2.1.p2]   ********************************************************************************
2020-04-26T04:55:26.7738482Z   [palp-2.1.p2]   Error building palp-2.1.p2
```

- before the logs exprire...


---

Comment by enriqueartal created at 2020-05-11 06:34:16

Besides the packages cited in the description (cannot say about gf2x) gap_packages does not build, due to cohomolo package.


---

Comment by @timokau created at 2020-05-19 14:29:25

Palp 2.11 mentions gcc 10 compatibility:

> palp-2.11.tar.gz: Small change in Mori.h for compatibility with gcc_10 and other minor patches (thanks to J. Puydt) [May 18, 2020]. 
-- http://hep.itp.tuwien.ac.at/~kreuzer/CY/CYpalp.html


---

Comment by @timokau created at 2020-05-19 15:46:43

Unfortunately I'm not sure if the upstream source tarball for palp 2.11 is finalized though. Since I've packaged it 3 days ago (https://github.com/NixOS/nixpkgs/pull/87944) the tarball silently changed.


---

Comment by fbissey created at 2020-05-19 19:57:36

Replying to [comment:21 gh-timokau]:
> Unfortunately I'm not sure if the upstream source tarball for palp 2.11 is finalized though. Since I've packaged it 3 days ago (https://github.com/NixOS/nixpkgs/pull/87944) the tarball silently changed.

I just adopted the patch already shipped in fedora until a new release.

* sympow is fixed by upgrading to the new fork.
* scipy can be fixed by adding some fortran flags until they fix the code, `-std=legacy` I think. I otherwise built sage-on-gentoo successfully with gcc-10 but I am not sure I have scanned absolutely all the packages.


---

Comment by @timokau created at 2020-05-28 15:06:11

For what it's worth, upstream confirmed that palp 2.11 is stable and no further changes are expected.


---

Comment by mkoeppe created at 2020-05-28 18:19:32

Changing keywords from "" to "sd109".


---

Comment by mkoeppe created at 2020-06-14 19:21:40

I have opened #29859 for `palp`


---

Comment by dimpase created at 2020-07-05 11:39:22

Homebrew is pushing to use gcc10, their current gcc+gfortran is gcc10, and their current openblas, scipy are all gcc10-dependent.


---

Comment by mkoeppe created at 2020-07-10 17:47:56

Last 10 new commits:


---

Comment by mkoeppe created at 2020-07-10 17:48:58

Tests run at https://github.com/mkoeppe/sage/actions/runs/164860999


---

Comment by git created at 2020-07-11 22:13:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-11 22:14:44

Again testing with CI fixes from #29929 at https://github.com/mkoeppe/sage/actions/runs/165937251


---

Comment by git created at 2020-07-12 05:19:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-12 05:22:58

New tests (using #30118) at https://github.com/mkoeppe/sage/actions/runs/166179877


---

Comment by git created at 2020-07-13 21:40:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-13 21:40:39

Test with updated #29766 at https://github.com/mkoeppe/sage/actions/runs/167913617


---

Comment by enriqueartal created at 2020-07-14 13:19:13

Tested successfully, up to the download of numpy and scipy.


---

Comment by mkoeppe created at 2020-07-14 16:55:11

Tests running at https://github.com/mkoeppe/sage/actions/runs/168165380


---

Comment by git created at 2020-07-14 17:03:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-14 22:53:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-15 05:50:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-07 19:34:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2020-08-07 19:36:09

Re-enabled gcc 10. Tests run at https://github.com/mkoeppe/sage/actions/runs/199625493


---

Comment by git created at 2020-08-10 16:16:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by enriqueartal created at 2020-08-11 15:13:50

I have just built it successfully. It failed the installation of gap_packages because of package cohomolo but it also fails to compile in gap itself.


---

Comment by mkoeppe created at 2020-08-11 15:17:43

Thanks for testing!

If there's no ticket for gap_packages yet, could you open one please?


---

Comment by dimpase created at 2020-08-11 15:41:07

Replying to [comment:52 mkoeppe]:
> Thanks for testing!
> 
> If there's no ticket for gap_packages yet, could you open one please?

I just opened https://github.com/gap-packages/cohomolo/issues/24
(verified that it's a problem with gcc-10 on Gentoo)


---

Comment by mkoeppe created at 2020-08-18 15:15:51

Changing status from new to needs_review.


---

Comment by vbraun created at 2020-08-18 23:05:51

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-08-19 00:01:54

Thanks.


---

Comment by charpent created at 2020-08-19 13:58:12

Replying to [comment:56 vbraun]:

FWIW, worked for me for the upgrade to 9.2.beta9...


---

Comment by vbraun created at 2020-08-20 22:23:01

Resolution: fixed


---

Comment by dimpase created at 2020-08-23 08:34:57

this seems not to be in beta9, right? should it be in beta10?
