# Issue 21010: py3 remove __cmp__ in lazy_import.pyx

archive/issues_021010.json:
```json
{
    "body": "CC:  @tscrim @jdemeyer @a-andre\n\nas a tiny step towards python3, let us avoid using cmp for lazy import.\n\nLet us just try to delete `__cmp__` from this file. There remains `__richcmp__`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21247\n\n",
    "created_at": "2016-08-14T12:30:10Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "py3 remove __cmp__ in lazy_import.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21010",
    "user": "https://github.com/fchapoton"
}
```
CC:  @tscrim @jdemeyer @a-andre

as a tiny step towards python3, let us avoid using cmp for lazy import.

Let us just try to delete `__cmp__` from this file. There remains `__richcmp__`.

Issue created by migration from https://trac.sagemath.org/ticket/21247





---

archive/issue_comments_290652.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-08-14T12:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290652",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_290653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-14T12:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290653",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_290654.json:
```json
{
    "body": "The `__cmp__` in `lazy_import.pyx` should stay because it is part of a framework (lazy imports) and not an individual class.\n\nSo I propose to close this as invalid/wontfix.",
    "created_at": "2016-08-15T07:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290654",
    "user": "https://github.com/jdemeyer"
}
```

The `__cmp__` in `lazy_import.pyx` should stay because it is part of a framework (lazy imports) and not an individual class.

So I propose to close this as invalid/wontfix.



---

archive/issue_comments_290655.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-08-15T07:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290655",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_290656.json:
```json
{
    "body": "But is this really needed ?\n\nDoes removing it break something ?\n\nHow to get rid of the `cmp` inside this method ?\n\nI may be doing stupid things, but your very short comments are not really helpful.",
    "created_at": "2016-08-15T07:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290656",
    "user": "https://github.com/fchapoton"
}
```

But is this really needed ?

Does removing it break something ?

How to get rid of the `cmp` inside this method ?

I may be doing stupid things, but your very short comments are not really helpful.



---

archive/issue_comments_290657.json:
```json
{
    "body": "Replying to [comment:4 chapoton]:\n> I may be doing stupid things, but your very short comments are not really helpful.\n\nI'm writing short comments mainly because I have not thought very much about it. I'd rather write a short comment now with the idea that we can still think about it or discuss later.",
    "created_at": "2016-08-15T08:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290657",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 chapoton]:
> I may be doing stupid things, but your very short comments are not really helpful.

I'm writing short comments mainly because I have not thought very much about it. I'd rather write a short comment now with the idea that we can still think about it or discuss later.



---

archive/issue_comments_290658.json:
```json
{
    "body": "Here is a more concrete proposal: keep this `cmp` for now and deal with it later, when most/all of the other files have been converted to use Python 3 comparisons.",
    "created_at": "2016-08-15T08:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290658",
    "user": "https://github.com/jdemeyer"
}
```

Here is a more concrete proposal: keep this `cmp` for now and deal with it later, when most/all of the other files have been converted to use Python 3 comparisons.



---

archive/issue_comments_290659.json:
```json
{
    "body": "patchbot is green (except for timeout failure in Tutte polynomials, which is a disease of this patchbot)",
    "created_at": "2016-08-19T19:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290659",
    "user": "https://github.com/fchapoton"
}
```

patchbot is green (except for timeout failure in Tutte polynomials, which is a disease of this patchbot)



---

archive/issue_comments_290660.json:
```json
{
    "body": "ping ?",
    "created_at": "2016-08-23T07:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290660",
    "user": "https://github.com/fchapoton"
}
```

ping ?



---

archive/issue_comments_290661.json:
```json
{
    "body": "I would like to propose this for review again, as this does not break anything.\n\nMaybe we cannot allow to say \"let us not remove this cmp now, wait until all the others have been removed\" about every instance of cmp, after all. :)",
    "created_at": "2016-09-02T19:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290661",
    "user": "https://github.com/fchapoton"
}
```

I would like to propose this for review again, as this does not break anything.

Maybe we cannot allow to say "let us not remove this cmp now, wait until all the others have been removed" about every instance of cmp, after all. :)



---

archive/issue_comments_290662.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-09-02T19:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290662",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_290663.json:
```json
{
    "body": "Replying to [comment:9 chapoton]:\n> Maybe we cannot allow to say \"let us not remove this cmp now, wait until all the others have been removed\" about every instance of cmp, after all. :)\n\nNot *every* instance of `cmp()`, just this one specifically.",
    "created_at": "2016-09-02T20:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290663",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 chapoton]:
> Maybe we cannot allow to say "let us not remove this cmp now, wait until all the others have been removed" about every instance of cmp, after all. :)

Not *every* instance of `cmp()`, just this one specifically.



---

archive/issue_comments_290664.json:
```json
{
    "body": "Could you please explain why you think this should not be done now ?\n\n* Does \"being part of a framework\" means something precise ?\n\n* The bot is green, so this does not break anything.\n\n* We remove `__cmp__` but there is still `__richcmp__`.",
    "created_at": "2016-09-10T10:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290664",
    "user": "https://github.com/fchapoton"
}
```

Could you please explain why you think this should not be done now ?

* Does "being part of a framework" means something precise ?

* The bot is green, so this does not break anything.

* We remove `__cmp__` but there is still `__richcmp__`.



---

archive/issue_comments_290665.json:
```json
{
    "body": "Since you seem to be insisting a lot, here is a possible compromise:\n\n```python\ndef __cmp__(self, other):\n    raise NotImplementedError(\"Old-style comparisons are not supported for lazily imported objects\")\n```\n\n\nThat will raise an exception when somebody tries to use this `__cmp__`. So if you break something, you will break it *explicitly* and people don't have to figure out that a subtle change in lazy imports broke their use case.\n\nIf this passes patchbot testing, so you can set the ticket to positive_review.",
    "created_at": "2016-09-11T07:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290665",
    "user": "https://github.com/jdemeyer"
}
```

Since you seem to be insisting a lot, here is a possible compromise:

```python
def __cmp__(self, other):
    raise NotImplementedError("Old-style comparisons are not supported for lazily imported objects")
```


That will raise an exception when somebody tries to use this `__cmp__`. So if you break something, you will break it *explicitly* and people don't have to figure out that a subtle change in lazy imports broke their use case.

If this passes patchbot testing, so you can set the ticket to positive_review.



---

archive/issue_comments_290666.json:
```json
{
    "body": "Sorry for insisting so much, but I am really bothered by not being able to compile all Cython files with py3. And the \"cmp()\" problem is the first obstacle. So the road must go through getting rid of all \"cmp()\" in pyx files, with no exception.\n\nLet us see what the patchbot says.\n\n----\nNew commits:",
    "created_at": "2016-09-11T11:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290666",
    "user": "https://github.com/fchapoton"
}
```

Sorry for insisting so much, but I am really bothered by not being able to compile all Cython files with py3. And the "cmp()" problem is the first obstacle. So the road must go through getting rid of all "cmp()" in pyx files, with no exception.

Let us see what the patchbot says.

----
New commits:



---

archive/issue_comments_290667.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-12T08:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290667",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_290668.json:
```json
{
    "body": "Can you keep the doctest please (showing that the exception is indeed raised).",
    "created_at": "2016-09-12T08:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290668",
    "user": "https://github.com/jdemeyer"
}
```

Can you keep the doctest please (showing that the exception is indeed raised).



---

archive/issue_comments_290669.json:
```json
{
    "body": "In fact, the doctest just works, showing that this method is never called. What should I do ?",
    "created_at": "2016-09-12T08:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290669",
    "user": "https://github.com/fchapoton"
}
```

In fact, the doctest just works, showing that this method is never called. What should I do ?



---

archive/issue_comments_290670.json:
```json
{
    "body": "I will have a look.",
    "created_at": "2016-09-12T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290670",
    "user": "https://github.com/jdemeyer"
}
```

I will have a look.



---

archive/issue_comments_290671.json:
```json
{
    "body": "Here is the explanation: `cmp(x,y)` only calls `x.__cmp__(y)` if the types of `x` and `y` are equal. So we need both `x` and `y` to be a lazy import.",
    "created_at": "2016-09-12T11:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290671",
    "user": "https://github.com/jdemeyer"
}
```

Here is the explanation: `cmp(x,y)` only calls `x.__cmp__(y)` if the types of `x` and `y` are equal. So we need both `x` and `y` to be a lazy import.



---

archive/issue_comments_290672.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-12T11:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290672",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_290673.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-09-12T11:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290673",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_290674.json:
```json
{
    "body": "Ok, looks good to me, and bot is green. Jeroen, if you agree, please set to positive review.",
    "created_at": "2016-09-13T07:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290674",
    "user": "https://github.com/fchapoton"
}
```

Ok, looks good to me, and bot is green. Jeroen, if you agree, please set to positive review.



---

archive/issue_comments_290675.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-13T07:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290675",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_290676.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-16T06:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21010#issuecomment-290676",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-16T06:55:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21010",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21010#event-19919"
}
```
