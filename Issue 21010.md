# Issue 21010: py3 remove __cmp__ in lazy_import.pyx

Issue created by migration from https://trac.sagemath.org/ticket/21247

Original creator: chapoton

Original creation time: 2016-08-14 12:30:10

CC:  tscrim jdemeyer aapitzsch

as a tiny step towards python3, let us avoid using cmp for lazy import.

Let us just try to delete `__cmp__` from this file. There remains `__richcmp__`.


---

Comment by chapoton created at 2016-08-14 12:30:47

New commits:


---

Comment by chapoton created at 2016-08-14 12:30:47

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-08-15 07:33:02

The `__cmp__` in `lazy_import.pyx` should stay because it is part of a framework (lazy imports) and not an individual class.

So I propose to close this as invalid/wontfix.


---

Comment by jdemeyer created at 2016-08-15 07:33:16

Changing status from needs_review to needs_info.


---

Comment by chapoton created at 2016-08-15 07:47:47

But is this really needed ?

Does removing it break something ?

How to get rid of the `cmp` inside this method ?

I may be doing stupid things, but your very short comments are not really helpful.


---

Comment by jdemeyer created at 2016-08-15 08:00:11

Replying to [comment:4 chapoton]:
> I may be doing stupid things, but your very short comments are not really helpful.

I'm writing short comments mainly because I have not thought very much about it. I'd rather write a short comment now with the idea that we can still think about it or discuss later.


---

Comment by jdemeyer created at 2016-08-15 08:02:00

Here is a more concrete proposal: keep this `cmp` for now and deal with it later, when most/all of the other files have been converted to use Python 3 comparisons.


---

Comment by chapoton created at 2016-08-19 19:24:34

patchbot is green (except for timeout failure in Tutte polynomials, which is a disease of this patchbot)


---

Comment by chapoton created at 2016-08-23 07:43:47

ping ?


---

Comment by chapoton created at 2016-09-02 19:46:53

I would like to propose this for review again, as this does not break anything.

Maybe we cannot allow to say "let us not remove this cmp now, wait until all the others have been removed" about every instance of cmp, after all. :)


---

Comment by chapoton created at 2016-09-02 19:46:53

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2016-09-02 20:44:50

Replying to [comment:9 chapoton]:
> Maybe we cannot allow to say "let us not remove this cmp now, wait until all the others have been removed" about every instance of cmp, after all. :)

Not _every_ instance of `cmp()`, just this one specifically.


---

Comment by chapoton created at 2016-09-10 10:34:39

Could you please explain why you think this should not be done now ?

* Does "being part of a framework" means something precise ?

* The bot is green, so this does not break anything.

* We remove `__cmp__` but there is still `__richcmp__`.


---

Comment by jdemeyer created at 2016-09-11 07:03:56

Since you seem to be insisting a lot, here is a possible compromise:

```python
def __cmp__(self, other):
    raise NotImplementedError("Old-style comparisons are not supported for lazily imported objects")
```


That will raise an exception when somebody tries to use this `__cmp__`. So if you break something, you will break it _explicitly_ and people don't have to figure out that a subtle change in lazy imports broke their use case.

If this passes patchbot testing, so you can set the ticket to positive_review.


---

Comment by chapoton created at 2016-09-11 11:20:31

Sorry for insisting so much, but I am really bothered by not being able to compile all Cython files with py3. And the "cmp()" problem is the first obstacle. So the road must go through getting rid of all "cmp()" in pyx files, with no exception.

Let us see what the patchbot says.

----
New commits:


---

Comment by jdemeyer created at 2016-09-12 08:19:26

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-09-12 08:19:26

Can you keep the doctest please (showing that the exception is indeed raised).


---

Comment by chapoton created at 2016-09-12 08:20:23

In fact, the doctest just works, showing that this method is never called. What should I do ?


---

Comment by jdemeyer created at 2016-09-12 09:35:09

I will have a look.


---

Comment by jdemeyer created at 2016-09-12 11:47:36

Here is the explanation: `cmp(x,y)` only calls `x.__cmp__(y)` if the types of `x` and `y` are equal. So we need both `x` and `y` to be a lazy import.


---

Comment by jdemeyer created at 2016-09-12 11:48:13

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-09-12 11:48:13

New commits:


---

Comment by chapoton created at 2016-09-13 07:10:37

Ok, looks good to me, and bot is green. Jeroen, if you agree, please set to positive review.


---

Comment by jdemeyer created at 2016-09-13 07:25:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-16 06:55:24

Resolution: fixed
