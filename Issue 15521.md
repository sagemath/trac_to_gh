# Issue 15521: Reimplement short vector enumeration

archive/issues_015521.json:
```json
{
    "body": "CC:  akoutsianas\n\nQuadraticForm(...).short_vector_list_up_to_length(...) currently uses PARI, which provides an incorrect implementation (see #13531). Here is a correct one, which is also faster. For comparison, here are the timings before and after\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n1 loops, best of 3: 1.1 s per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 7.42 s per loop\n```\n\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n1 loops, best of 3: 360 ms per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 11.5 s per loop\n```\n\n\nAs a big bonus (at least to me), we have a version that doesn't come with conversion to vectors:\n\n```\nsage: from sage.quadratic_forms.enumerate_short_vectors.enumerate_short_vectors_python import short_vectors\nsage: %timeit short_vectors(qf.matrix(), 0, 1000)\n10 loops, best of 3: 65.7 ms per loop\n```\n\n\nThis depends on boost::python, which hopefully will be integrated soon. Until then, note that you have to have boost_python library installed (we have the headers already).\n\nIssue created by migration from https://trac.sagemath.org/ticket/15758\n\n",
    "created_at": "2014-01-29T08:19:47Z",
    "labels": [
        "quadratic forms",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Reimplement short vector enumeration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15521",
    "user": "mraum"
}
```
CC:  akoutsianas

QuadraticForm(...).short_vector_list_up_to_length(...) currently uses PARI, which provides an incorrect implementation (see #13531). Here is a correct one, which is also faster. For comparison, here are the timings before and after

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
1 loops, best of 3: 1.1 s per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 7.42 s per loop
```


```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
1 loops, best of 3: 360 ms per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 11.5 s per loop
```


As a big bonus (at least to me), we have a version that doesn't come with conversion to vectors:

```
sage: from sage.quadratic_forms.enumerate_short_vectors.enumerate_short_vectors_python import short_vectors
sage: %timeit short_vectors(qf.matrix(), 0, 1000)
10 loops, best of 3: 65.7 ms per loop
```


This depends on boost::python, which hopefully will be integrated soon. Until then, note that you have to have boost_python library installed (we have the headers already).

Issue created by migration from https://trac.sagemath.org/ticket/15758





---

archive/issue_comments_200521.json:
```json
{
    "body": "I know it's not needs_review, but you cannot yet rely on C++11. With GCC 4.6.3:\n\n```\ncc1plus: error: unrecognized command line option \u2018-std=c++11\u2019\n```\n\n----\nLast 10 new commits:",
    "created_at": "2014-01-29T14:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15521#issuecomment-200521",
    "user": "jdemeyer"
}
```

I know it's not needs_review, but you cannot yet rely on C++11. With GCC 4.6.3:

```
cc1plus: error: unrecognized command line option ‘-std=c++11’
```

----
Last 10 new commits:



---

archive/issue_comments_200522.json:
```json
{
    "body": "On my system, the following changes were needed to make this compile:\n\n```diff\ndiff --git a/src/module_list.py b/src/module_list.py\nindex e3a6ea9..c567ee6 100755\n--- a/src/module_list.py\n+++ b/src/module_list.py\n@@ -1475,9 +1475,9 @@ ext_modules = [\n               depends = ['sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors_boost_python.hpp',\n                          'sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors.hpp'],\n               language = 'c++',\n-              extra_compile_args=['-std=c++11'],\n+              extra_compile_args=[\"-std=c++0x\"],\n               include_dirs = [SAGE_INC, SAGE_INC + '/python2.7', 'sage/c_libs/include'],\n-              libraries = ['stdc++', 'boost_python', 'mpfi', 'mpfr', 'gmp']),\n+              libraries = ['stdc++', 'boost_python-2.7', 'mpfi', 'mpfr', 'gmp']),\n \n     Extension('sage.quadratic_forms.quadratic_form__evaluate',\n               sources = ['sage/quadratic_forms/quadratic_form__evaluate.pyx']),\n```\n\nI don't know if everybody will be happy that the compiler now needs to support `-std=c++0x` (personally, I don't mind, especially given that Sage's GCC does support it).",
    "created_at": "2014-01-29T14:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15521#issuecomment-200522",
    "user": "jdemeyer"
}
```

On my system, the following changes were needed to make this compile:

```diff
diff --git a/src/module_list.py b/src/module_list.py
index e3a6ea9..c567ee6 100755
--- a/src/module_list.py
+++ b/src/module_list.py
@@ -1475,9 +1475,9 @@ ext_modules = [
               depends = ['sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors_boost_python.hpp',
                          'sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors.hpp'],
               language = 'c++',
-              extra_compile_args=['-std=c++11'],
+              extra_compile_args=["-std=c++0x"],
               include_dirs = [SAGE_INC, SAGE_INC + '/python2.7', 'sage/c_libs/include'],
-              libraries = ['stdc++', 'boost_python', 'mpfi', 'mpfr', 'gmp']),
+              libraries = ['stdc++', 'boost_python-2.7', 'mpfi', 'mpfr', 'gmp']),
 
     Extension('sage.quadratic_forms.quadratic_form__evaluate',
               sources = ['sage/quadratic_forms/quadratic_form__evaluate.pyx']),
```

I don't know if everybody will be happy that the compiler now needs to support `-std=c++0x` (personally, I don't mind, especially given that Sage's GCC does support it).



---

archive/issue_comments_200523.json:
```json
{
    "body": "According to [the changelog of fpLLL](http://perso.ens-lyon.fr/damien.stehle/fplll/ChangeLog.txt), a \"short lattice vector enumeration algorithm\" appeared in version 3.0 of fpLLL, which is a standard spkg of Sage. Why not interfacing with this implementation ?",
    "created_at": "2014-02-01T23:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15521#issuecomment-200523",
    "user": "tmonteil"
}
```

According to [the changelog of fpLLL](http://perso.ens-lyon.fr/damien.stehle/fplll/ChangeLog.txt), a "short lattice vector enumeration algorithm" appeared in version 3.0 of fpLLL, which is a standard spkg of Sage. Why not interfacing with this implementation ?



---

archive/issue_comments_200524.json:
```json
{
    "body": "Honestly, before I implemented this (quite some time ago), I didn't find the short vector implementation in fpLLL's documentation. And I still don't.\n\nIt's a pity for my code, but I'm definitely in favor of wrapping the missing parts of fpLLL instead of my code. Clearly, fpLLL is a much more advanced implementation than I could implement.\n\nDoes anybody know how to invoke enumeration? It seems that topenum.h contains a class for this, but I can't figure out, what kind of date Enumerator.subTree contains.",
    "created_at": "2014-02-02T10:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15521#issuecomment-200524",
    "user": "mraum"
}
```

Honestly, before I implemented this (quite some time ago), I didn't find the short vector implementation in fpLLL's documentation. And I still don't.

It's a pity for my code, but I'm definitely in favor of wrapping the missing parts of fpLLL instead of my code. Clearly, fpLLL is a much more advanced implementation than I could implement.

Does anybody know how to invoke enumeration? It seems that topenum.h contains a class for this, but I can't figure out, what kind of date Enumerator.subTree contains.



---

archive/issue_comments_200525.json:
```json
{
    "body": "See #15976 for an interface to fpLLL's shortest vector implementation.",
    "created_at": "2014-03-19T17:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15521#issuecomment-200525",
    "user": "malb"
}
```

See #15976 for an interface to fpLLL's shortest vector implementation.



---

archive/issue_comments_200526.json:
```json
{
    "body": "As far as I know, the fpLLL library only deals with sublattices of `ZZ^n`, while pari can deal with enumerating short vectors when the Gram matrix is real.  This is very important for my applications!  So I would very much like this ticket to be revived.\n\nMeanwhile, here is a bug report with the QuadraticForm class in this context, since it does not pass the optional flag=2 to pari's qfminim function when the Gram matrix is real:\n\n```\nsage: A = random_matrix(RR,5)\nsage: A = A*A.transpose()\nsage: Q = QuadraticForm(A)\nsage: Q.short_vector_list_up_to_length(2)\n...\nPariError: incorrect type in qfminim0\n```\n",
    "created_at": "2014-10-29T12:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15521#issuecomment-200526",
    "user": "cremona"
}
```

As far as I know, the fpLLL library only deals with sublattices of `ZZ^n`, while pari can deal with enumerating short vectors when the Gram matrix is real.  This is very important for my applications!  So I would very much like this ticket to be revived.

Meanwhile, here is a bug report with the QuadraticForm class in this context, since it does not pass the optional flag=2 to pari's qfminim function when the Gram matrix is real:

```
sage: A = random_matrix(RR,5)
sage: A = A*A.transpose()
sage: Q = QuadraticForm(A)
sage: Q.short_vector_list_up_to_length(2)
...
PariError: incorrect type in qfminim0
```

