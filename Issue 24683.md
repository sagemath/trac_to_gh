# Issue 24683: Failing doctests in r.py on OpenSuSE with system readline

archive/issues_024683.json:
```json
{
    "body": "From https://groups.google.com/forum/#!topic/sage-devel/AWGonGw0tvo\n\nOn OpenSuSE with system readline several doctests in r.py get the additional line printed:\n`    sh: /home/ralf/sage/local/lib/libreadline.so.6: no version information available (required by sh)`\nwhich makes them fail.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24920\n\n",
    "created_at": "2018-03-06T16:33:22Z",
    "labels": [
        "doctest coverage",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Failing doctests in r.py on OpenSuSE with system readline",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24683",
    "user": "@rwst"
}
```
From https://groups.google.com/forum/#!topic/sage-devel/AWGonGw0tvo

On OpenSuSE with system readline several doctests in r.py get the additional line printed:
`    sh: /home/ralf/sage/local/lib/libreadline.so.6: no version information available (required by sh)`
which makes them fail.

Issue created by migration from https://trac.sagemath.org/ticket/24920





---

archive/issue_comments_346401.json:
```json
{
    "body": "Which doctests fail and precisely how do they fail?",
    "created_at": "2018-03-06T19:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346401",
    "user": "@jdemeyer"
}
```

Which doctests fail and precisely how do they fail?



---

archive/issue_comments_346402.json:
```json
{
    "body": "Can #24919 fix this, possibly by checking for system readline at start of build?",
    "created_at": "2018-03-07T16:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346402",
    "user": "@rwst"
}
```

Can #24919 fix this, possibly by checking for system readline at start of build?



---

archive/issue_comments_346403.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2018-03-07T16:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346403",
    "user": "@rwst"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_346404.json:
```json
{
    "body": "Looks like R is somewhere setting `LD_LIBRARY_PATH` when rendering docs. It shouldn't, we don't need nor want it. In particular, `sh` should just use the system libraries.",
    "created_at": "2018-04-01T08:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346404",
    "user": "@vbraun"
}
```

Looks like R is somewhere setting `LD_LIBRARY_PATH` when rendering docs. It shouldn't, we don't need nor want it. In particular, `sh` should just use the system libraries.



---

archive/issue_comments_346405.json:
```json
{
    "body": "Looks like R depends on setting its own `LD_LIBRARY_PATH` in `local/lib/R/etc/ldpaths`, thats terrible.",
    "created_at": "2018-04-01T09:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346405",
    "user": "@vbraun"
}
```

Looks like R depends on setting its own `LD_LIBRARY_PATH` in `local/lib/R/etc/ldpaths`, thats terrible.



---

archive/issue_comments_346406.json:
```json
{
    "body": "Possibly related stackoverflow post: https://superuser.com/questions/735736/no-version-information-available-required-by-usr-bin-ssh",
    "created_at": "2018-05-23T06:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346406",
    "user": "@rwst"
}
```

Possibly related stackoverflow post: https://superuser.com/questions/735736/no-version-information-available-required-by-usr-bin-ssh



---

archive/issue_comments_346407.json:
```json
{
    "body": "Debian and sage-on-gentoo now use https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/dt-r-no-readline.patch because R hangs with newer readline. I suspect it would also help here.",
    "created_at": "2018-05-23T08:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346407",
    "user": "@kiwifb"
}
```

Debian and sage-on-gentoo now use https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/dt-r-no-readline.patch because R hangs with newer readline. I suspect it would also help here.



---

archive/issue_comments_346408.json:
```json
{
    "body": "Cannot confirm. Still fails with that patch. In principle readline is already linked in R, so you may be able to switch off its usage, but the library is still loaded.",
    "created_at": "2018-05-24T05:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346408",
    "user": "@rwst"
}
```

Cannot confirm. Still fails with that patch. In principle readline is already linked in R, so you may be able to switch off its usage, but the library is still loaded.



---

archive/issue_comments_346409.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2020-09-03T03:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24683#issuecomment-346409",
    "user": "@mkoeppe"
}
```

Changing priority from critical to major.
