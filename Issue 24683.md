# Issue 24683: Failing doctests in r.py on OpenSuSE with system readline

Issue created by migration from https://trac.sagemath.org/ticket/24920

Original creator: rws

Original creation time: 2018-03-06 16:33:22

From https://groups.google.com/forum/#!topic/sage-devel/AWGonGw0tvo

On OpenSuSE with system readline several doctests in r.py get the additional line printed:
`    sh: /home/ralf/sage/local/lib/libreadline.so.6: no version information available (required by sh)`
which makes them fail.


---

Comment by jdemeyer created at 2018-03-06 19:35:19

Which doctests fail and precisely how do they fail?


---

Comment by rws created at 2018-03-07 16:46:19

Can #24919 fix this, possibly by checking for system readline at start of build?


---

Comment by rws created at 2018-03-07 16:46:37

Changing status from new to needs_info.


---

Comment by vbraun created at 2018-04-01 08:56:06

Looks like R is somewhere setting `LD_LIBRARY_PATH` when rendering docs. It shouldn't, we don't need nor want it. In particular, `sh` should just use the system libraries.


---

Comment by vbraun created at 2018-04-01 09:02:55

Looks like R depends on setting its own `LD_LIBRARY_PATH` in `local/lib/R/etc/ldpaths`, thats terrible.


---

Comment by rws created at 2018-05-23 06:19:04

Possibly related stackoverflow post: https://superuser.com/questions/735736/no-version-information-available-required-by-usr-bin-ssh


---

Comment by fbissey created at 2018-05-23 08:17:45

Debian and sage-on-gentoo now use https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/dt-r-no-readline.patch because R hangs with newer readline. I suspect it would also help here.


---

Comment by rws created at 2018-05-24 05:41:00

Cannot confirm. Still fails with that patch. In principle readline is already linked in R, so you may be able to switch off its usage, but the library is still loaded.


---

Comment by mkoeppe created at 2020-09-03 03:00:42

Changing priority from critical to major.
