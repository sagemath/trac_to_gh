# Issue 12710: Allows a generalized Cartan matrix as input for Dynkin diagrams

Issue created by migration from Trac.

Original creator: stumpc5

Original creation time: 2012-04-26 14:29:20

Assignee: sage-combinat

CC:  sage-combinat

Keywords: Weyl group, Dynkin diagram, Cartan matrix

Dynkin diagrams can currently not be constructed using a generalized Cartan matrix.

This patch implements this.


---

Comment by stumpc5 created at 2012-04-26 14:31:52

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-07-27 20:40:08

Please fill in your real name as Author.


---

Comment by hthomas created at 2012-11-11 06:33:41

Hi Christian--

Your code is checking that all the off-diagonal entries in the input matrix are strictly negative.  That seems a bit over-enthusiastic.  

A doctest for the new functionality would also be good.  

cheers,

Hugh


---

Comment by hthomas created at 2012-11-11 06:38:51

Hi Christian--

Why does this have #8327 listed as a dependency?  

cheers,

Hugh


---

Comment by stumpc5 created at 2012-11-11 08:28:26

Replying to [comment:5 hthomas]:
> Hi Christian--
> 
> Your code is checking that all the off-diagonal entries in the input matrix are strictly negative.  That seems a bit over-enthusiastic.  
> 
> A doctest for the new functionality would also be good.  

Hi Hugh!

Thanks for bringing back my/our attention to this ticket!

I will be too busy to actively work on this patch in the next two weeks, but feel free to take it over and review/finish it if you like! I will now provide a version that you can work with (in particular, I deleted the dependency). Of course, you can as well wait until I finish the patch, if you prefer.

Best, Christian


---

Attachment


---

Comment by stumpc5 created at 2012-11-11 08:53:54

I updated the patch on the combinat queue and also uploaded it here. The negative entries test was accidentally fixed in the following patch on reflection groups rather than in this patch. I replaced all `asserts` by `ValueErrors` (since I was told that's the way to do it some time ago).

As said, Hugh: feel free to take it over, or to review it as is.

Best, Christian


---

Comment by tscrim created at 2013-04-12 14:09:20

I will take this over (since no progress has been made recently) and base it on #14137.


---

Comment by tscrim created at 2013-04-12 14:09:20

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by tscrim created at 2013-04-12 21:06:34

New version of the patch ready for review.

For patchbot:

Apply: trac_12882-matrix_as_dynkin_diagram-ts.patch


---

Comment by tscrim created at 2013-04-12 21:06:34

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2013-06-01 16:26:20

Rebased patch.

Apply: trac_12882-matrix_as_dynkin_diagram-ts.patch


---

Comment by bsalisbury1 created at 2013-06-21 18:31:04

Hi Travis,

This patch does not pass all of it's doctests.  Also, is it a good idea to add a note to the documentation saying that only Cartan matrices whose Cartan types are implemented in Sage are legal input?  For example, the Cartan matrix 

```
CartanMatrix([[2,-3],[-3,2]])
```

yields an error.  Can you also provide an example of inputting a Cartan matrix and an index set in the documentation?  

-Ben


---

Comment by bsalisbury1 created at 2013-06-21 18:32:47

Changing keywords from "Weyl group, Dynkin diagram, Cartan matrix" to "Weyl group, Dynkin diagram, Cartan matrix, days49".


---

Comment by tscrim created at 2013-06-22 15:52:11

Hey Ben,

New version of the patch which passes all doctests and adds the example. Thanks for reviewing this.

Best,

Travis

For patchbot:

Apply: trac_12882-matrix_as_dynkin_diagram-ts.patch


---

Comment by tscrim created at 2013-06-23 21:32:14

Hey Ben,

Okay, `is_finite()` and `is_affine()` are working now for arbitrary Cartan matrices.

Best,

Travis


---

Comment by tscrim created at 2013-06-23 21:32:51

For patchbot:

Apply: trac_12882-matrix_as_dynkin_diagram-ts.patch


---

Comment by bsalisbury1 created at 2013-06-24 13:29:25

Changing status from needs_review to positive_review.


---

Comment by bsalisbury1 created at 2013-06-24 13:29:25

Hi Travis,

Thank you for making those changes!

-Ben


---

Comment by jdemeyer created at 2013-08-04 06:03:59

There are obvious doctest failures with the patchbot:

```
sage -t devel/sage/sage/combinat/root_system/dynkin_diagram.py
**********************************************************************
File "devel/sage/sage/combinat/root_system/dynkin_diagram.py", line 145, in sage.combinat.root_system.dynkin_diagram.DynkinDiagram
Failed example:
    DI.index_set()
Expected:
    (3, 5)
Got:
    [3, 5]
**********************************************************************
File "devel/sage/sage/combinat/root_system/dynkin_diagram.py", line 149, in sage.combinat.root_system.dynkin_diagram.DynkinDiagram
Failed example:
    DII.index_set()
Expected:
    ('x', -1)
Got:
    [-1, 'x']
**********************************************************************
```



---

Comment by jdemeyer created at 2013-08-04 06:03:59

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2013-08-08 00:11:33

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2013-08-08 00:11:33

Ah, there's a dependency from #14516 for those doctests. Ben and I were doing this on the combinat queue which had that patch applied.

```
sage -t root_system/dynkin_diagram.py
    [88 tests, 3.67 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 4.1 seconds
    cpu time: 1.8 seconds
    cumulative wall time: 3.7 seconds
```


For patchbot:

Apply: trac_12882-matrix_as_dynkin_diagram-ts.patch​


---

Comment by jdemeyer created at 2013-08-16 08:09:35

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-08-16 08:09:35


```
sage -t devel/sage/sage/combinat/root_system/dynkin_diagram.py
**********************************************************************
File "devel/sage/sage/combinat/root_system/dynkin_diagram.py", line 149, in sage.combinat.root_system.dynkin_diagram.DynkinDiagram
Failed example:
    DII.index_set()
Expected:
    ('x', -1)
Got:
    (-1, 'x')
**********************************************************************
```



---

Comment by tscrim created at 2013-08-16 15:29:16

Okay, I've made the offending test return a sorted list. However this should be overkill since `index_set` just makes the call to `vertices`, which returns a sorted list, into a tuple (i.e. there doesn't seem to be a set/dict being returned...). Here's the patches have applied on `5.11.rc0`:

```
trac_14882-backtrack_longtime-dg.patch
trac_13589-categories-c3_under_control-nt.patch
trac_14507-tropical_semiring-ts.patch
trac_7983-major_index_and_other_tableau_fixes-dg.patch
trac_7983-review-ts.patch
trac_8386_really_just_moving-fc.patch
trac_8386_big_clean_fc.patch
trac_8386_assert_removal.patch
trac_14808-recoils_of_permutations-ts.patch
trac_10630-vector_partition-ap.patch
trac_14870-fix_int_mod_QQ-ts.patch
trac_14787-gyw_stats-bs.patch
trac_14787-pdf_fix-ts.patch
trac_14573-path_realizations-ts.patch
trac_11407-list_clone_improve-fh.patch
trac_14516-crystals_speedup-ts.patch
trac_12882-matrix_as_dynkin_diagram-ts.patch
```

So I'm confused about why we're getting different results (and slightly worried).

Anyways, Ben could you do a quick re-review of the patch? Thanks.

For patchbot:

Apply: trac_12882-matrix_as_dynkin_diagram-ts.patch​


---

Comment by bsalisbury1 created at 2013-08-16 15:49:41

I ran the tests again on `5.12.beta0` on the entire root_system folder with following patches applied:

```
applying trac_14610-LSenergy-ms.patch
applying trac9107_nesting_nested_classes.patch
applying trac_9107_fix_cross_reference.patch
applying trac_14787-gyw_stats-bs.patch
applying trac_14787-pdf_fix-ts.patch
applying trac_14573-path_realizations-ts.patch
applying trac_11407-list_clone_improve-fh.patch
applying trac_14516-crystals_speedup-ts.patch
applying trac_12882-matrix_as_dynkin_diagram-ts.patch
```

All tests passed

```
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 235.7 seconds
    cpu time: 212.6 seconds
    cumulative wall time: 233.4 seconds
```

and in particular:

```
sage -t --long root_system/dynkin_diagram.py
    [88 tests, 0.53 s]
```

I also copied and ran those tests in Sage directly, and received the expected result:

```
sage: CII = CartanMatrix([[2, -3], [-4, 2]])
sage: DII = DynkinDiagram(CII, (-1, 'x'))
sage: DII.index_set()
('x', -1)
```



---

Comment by bsalisbury1 created at 2013-08-16 15:49:54

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-08-18 12:45:41

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-08-18 12:45:41

Still doesn't work:

```
sage -t devel/sage/sage/combinat/root_system/dynkin_diagram.py
**********************************************************************
File "devel/sage/sage/combinat/root_system/dynkin_diagram.py", line 149, in sage.combinat.root_system.dynkin_diagram.DynkinDiagram
Failed example:
    sorted(DII.index_set())
Expected:
    ['x', -1]
Got:
    [-1, 'x']
**********************************************************************
```



---

Comment by tscrim created at 2013-08-18 15:00:55

Jeroen, so somehow your system (and the patchbot's) is sorting things differently than ours. Do you have any idea about why this is happening? I don't want to change the output of the doctest because then it will fail on our computers. (My guess as to why we're only seeing this here because it's the only time we're doctesting a sorted list with a string and an integer.)


---

Comment by jdemeyer created at 2013-08-19 04:57:02

Replying to [comment:27 tscrim]:
> My guess as to why we're only seeing this here because it's the only time we're doctesting a sorted list with a string and an integer.
Yes, it seems that comparing a string and an integer simply isn't well-defined.


---

Comment by tscrim created at 2013-08-19 15:22:08

Changing status from needs_work to needs_review.


---

Attachment

Here's a new version of the patch which sidesteps the issue by making it indexed by two strings. Jeroen, could you check to make sure the tests also pass for you? Thanks.


---

Comment by chapoton created at 2013-08-21 09:49:32

apply only trac_12882-matrix_as_dynkin_diagram-ts.patch​


---

Comment by chapoton created at 2013-08-21 09:59:51

apply trac_12882-matrix_as_dynkin_diagram-ts.patch


---

Comment by tscrim created at 2013-08-22 18:34:32

Hey Ben,

Could you check to make sure this works for you still? I've given the patchbot a kick and we'll check against that going green.

Best,

Travis


---

Comment by chapoton created at 2013-08-22 18:44:48

it seems that the patchbot is (or was?) broken (it tries to apply very old dependencies)


---

Comment by bsalisbury1 created at 2013-08-22 20:29:11

All tests passed for me.


---

Comment by bsalisbury1 created at 2013-08-22 20:29:11

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-08-28 06:52:12

Resolution: fixed
