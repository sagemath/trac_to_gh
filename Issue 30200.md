# Issue 30200: Special Implementation of random_element() for Laurent Series Rings

Issue created by migration from https://trac.sagemath.org/ticket/30437

Original creator: @n-vi

Original creation time: 2020-08-25 09:48:52

CC:  slelievre

Keywords: laurent, random

Currently, using the random_element() function on laurent-series rings returns only integers coerced into those rings, rather than more complex elements.

For example:

```
sage: S.<s> = LaurentSeriesRing(GF(3))
sage: S.random_element()                                                                                                                   
2
```


This happens because the implementation that is used is the generic one from src/sage/rings/ring.pyx

```                                                                                                   
sage: S.random_element?                                                                                                                    
Docstring:     
   Return a random integer coerced into this ring,
...
File:           ~/workspace/padic_project/sage/local/lib/python3.7/site-packages/sage/rings/ring.pyx
Type:           builtin_function_or_method
```


In this ticket I try to add a special implementation of random_element() for laurent series rings, which does not return only integers.


---

Comment by @n-vi created at 2020-08-25 10:27:28

Changing status from new to needs_review.


---

Comment by @n-vi created at 2020-08-25 10:27:28

New commits:


---

Comment by git created at 2020-08-26 15:46:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2020-08-31 02:20:19

Changing component from PLEASE CHANGE to commutative algebra.


---

Comment by slelievre created at 2020-08-31 02:20:19

Thanks for working on this!  Some suggestions:

- For docstrings, the style guide recommends a short first line
  with imperative "Return" rather than descriptive "Returns"

- Avoid trailing whitespace

- Remove unneeded parentheses in `if` statement

- The word "coefficient" has a typo (4 times)

- rst needs double-backticks for typewriter style



```diff
     def random_element(self, algorithm='default'):
         r"""
-        Returns a random element of ``self``, optionally using the ``algorithm``
-        argument to decide how it generates the element. Algorithms currently
-        implemented:
+        Return a random element of this Laurent series ring.
+
+        The optional ``algorithm`` parameter decides how elements are generated.
+        Algorithms currently implemented:
 
-        - default: Choose an integer `shift` using the standard
-          distribution on the integers.  Then choose a list of coeeficients
-          using the random_element function of the base ring, and construct 
-          a new element based on those coeeficients, so that the i'th 
-          coeeficient corresponds to the (i+shift) power of the uniformizer.
-          The amount of coeeficients is determined by the default_prec of the ring.
+        - ``'default'``: Choose an integer ``shift`` using the standard
+          distribution on the integers.  Then choose a list of coefficients
+          using the ``random_element`` function of the base ring, and construct
+          a new element based on those coefficients, so that the i-th
+          coefficient corresponds to the (i+shift)-th power of the uniformizer.
+          The amount of coefficients is determined by the ``default_prec``
+          of the ring. Note that this method only creates non-exact elements.
 
         EXAMPLES::
 
             sage: S.<s> = LaurentSeriesRing(GF(3))
             sage: S.random_element()
             s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4 + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)
         """
-        if (algorithm == 'default'):
+        if algorithm == 'default':
             shift = ZZ.random_element()
-            return self([self.base_ring().random_element() for k in range(self.default_prec())], 
+            return self([self.base_ring().random_element() for k in range(self.default_prec())],
                         shift).O(shift + self.default_prec())
         else:
-            raise NotImplementedError("Don't know %s algorithm"%algorithm)
+            raise ValueError("algorithm cannot be %s" % algorithm)
```



---

Comment by slelievre created at 2020-08-31 02:20:19

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-09-07 10:29:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @n-vi created at 2020-09-07 10:35:19

Thank you Samuel Leli√®vre for your review and comments.

I implemented the changes you suggested in the ticket.


---

Comment by @n-vi created at 2020-09-07 10:36:18

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2020-09-07 17:04:53

Please mark the random example as such; and I suggest some extra wrapping:


```diff
         EXAMPLES::

             sage: S.<s> = LaurentSeriesRing(GF(3))
-            sage: S.random_element()
-            s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4 + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)
+            sage: S.random_element()  # random
+            s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4
+            + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)
         """
         if algorithm == 'default':
             shift = ZZ.random_element()
-            return self([self.base_ring().random_element() for k in range(self.default_prec())],
-                         shift).O(shift + self.default_prec())
+            return self([self.base_ring().random_element()
+                         for k in range(self.default_prec())],
+                        shift).O(shift + self.default_prec())
         else:
             raise ValueError("algorithm cannot be %s" % algorithm)
```



---

Comment by slelievre created at 2020-09-07 17:04:53

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-09-07 17:19:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @n-vi created at 2020-09-07 17:20:21

Thanks, I updated the code.


---

Comment by @n-vi created at 2020-09-07 17:20:42

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2020-09-07 17:35:09

Thanks!


---

Comment by slelievre created at 2020-09-07 17:35:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-09-18 20:22:53

Resolution: fixed
