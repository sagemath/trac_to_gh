# Issue 30200: Special Implementation of random_element() for Laurent Series Rings

archive/issues_030200.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: laurent, random\n\nCurrently, using the random_element() function on laurent-series rings returns only integers coerced into those rings, rather than more complex elements.\n\nFor example:\n\n```\nsage: S.<s> = LaurentSeriesRing(GF(3))\nsage: S.random_element()                                                                                                                   \n2\n```\n\n\nThis happens because the implementation that is used is the generic one from src/sage/rings/ring.pyx\n\n```                                                                                                   \nsage: S.random_element?                                                                                                                    \nDocstring:     \n   Return a random integer coerced into this ring,\n...\nFile:           ~/workspace/padic_project/sage/local/lib/python3.7/site-packages/sage/rings/ring.pyx\nType:           builtin_function_or_method\n```\n\n\nIn this ticket I try to add a special implementation of random_element() for laurent series rings, which does not return only integers.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30437\n\n",
    "created_at": "2020-08-25T09:48:52Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Special Implementation of random_element() for Laurent Series Rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30200",
    "user": "@n-vi"
}
```
CC:  @slel

Keywords: laurent, random

Currently, using the random_element() function on laurent-series rings returns only integers coerced into those rings, rather than more complex elements.

For example:

```
sage: S.<s> = LaurentSeriesRing(GF(3))
sage: S.random_element()                                                                                                                   
2
```


This happens because the implementation that is used is the generic one from src/sage/rings/ring.pyx

```                                                                                                   
sage: S.random_element?                                                                                                                    
Docstring:     
   Return a random integer coerced into this ring,
...
File:           ~/workspace/padic_project/sage/local/lib/python3.7/site-packages/sage/rings/ring.pyx
Type:           builtin_function_or_method
```


In this ticket I try to add a special implementation of random_element() for laurent series rings, which does not return only integers.

Issue created by migration from https://trac.sagemath.org/ticket/30437





---

archive/issue_comments_430435.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-25T10:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430435",
    "user": "@n-vi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430436.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-08-25T10:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430436",
    "user": "@n-vi"
}
```

New commits:



---

archive/issue_comments_430437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-26T15:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430437",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430438.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to commutative algebra.",
    "created_at": "2020-08-31T02:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430438",
    "user": "@slel"
}
```

Changing component from PLEASE CHANGE to commutative algebra.



---

archive/issue_comments_430439.json:
```json
{
    "body": "Thanks for working on this!  Some suggestions:\n\n- For docstrings, the style guide recommends a short first line\n  with imperative \"Return\" rather than descriptive \"Returns\"\n\n- Avoid trailing whitespace\n\n- Remove unneeded parentheses in `if` statement\n\n- The word \"coefficient\" has a typo (4 times)\n\n- rst needs double-backticks for typewriter style\n\n\n\n```diff\n     def random_element(self, algorithm='default'):\n         r\"\"\"\n-        Returns a random element of ``self``, optionally using the ``algorithm``\n-        argument to decide how it generates the element. Algorithms currently\n-        implemented:\n+        Return a random element of this Laurent series ring.\n+\n+        The optional ``algorithm`` parameter decides how elements are generated.\n+        Algorithms currently implemented:\n \n-        - default: Choose an integer `shift` using the standard\n-          distribution on the integers.  Then choose a list of coeeficients\n-          using the random_element function of the base ring, and construct \n-          a new element based on those coeeficients, so that the i'th \n-          coeeficient corresponds to the (i+shift) power of the uniformizer.\n-          The amount of coeeficients is determined by the default_prec of the ring.\n+        - ``'default'``: Choose an integer ``shift`` using the standard\n+          distribution on the integers.  Then choose a list of coefficients\n+          using the ``random_element`` function of the base ring, and construct\n+          a new element based on those coefficients, so that the i-th\n+          coefficient corresponds to the (i+shift)-th power of the uniformizer.\n+          The amount of coefficients is determined by the ``default_prec``\n+          of the ring. Note that this method only creates non-exact elements.\n \n         EXAMPLES::\n \n             sage: S.<s> = LaurentSeriesRing(GF(3))\n             sage: S.random_element()\n             s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4 + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)\n         \"\"\"\n-        if (algorithm == 'default'):\n+        if algorithm == 'default':\n             shift = ZZ.random_element()\n-            return self([self.base_ring().random_element() for k in range(self.default_prec())], \n+            return self([self.base_ring().random_element() for k in range(self.default_prec())],\n                         shift).O(shift + self.default_prec())\n         else:\n-            raise NotImplementedError(\"Don't know %s algorithm\"%algorithm)\n+            raise ValueError(\"algorithm cannot be %s\" % algorithm)\n```\n",
    "created_at": "2020-08-31T02:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430439",
    "user": "@slel"
}
```

Thanks for working on this!  Some suggestions:

- For docstrings, the style guide recommends a short first line
  with imperative "Return" rather than descriptive "Returns"

- Avoid trailing whitespace

- Remove unneeded parentheses in `if` statement

- The word "coefficient" has a typo (4 times)

- rst needs double-backticks for typewriter style



```diff
     def random_element(self, algorithm='default'):
         r"""
-        Returns a random element of ``self``, optionally using the ``algorithm``
-        argument to decide how it generates the element. Algorithms currently
-        implemented:
+        Return a random element of this Laurent series ring.
+
+        The optional ``algorithm`` parameter decides how elements are generated.
+        Algorithms currently implemented:
 
-        - default: Choose an integer `shift` using the standard
-          distribution on the integers.  Then choose a list of coeeficients
-          using the random_element function of the base ring, and construct 
-          a new element based on those coeeficients, so that the i'th 
-          coeeficient corresponds to the (i+shift) power of the uniformizer.
-          The amount of coeeficients is determined by the default_prec of the ring.
+        - ``'default'``: Choose an integer ``shift`` using the standard
+          distribution on the integers.  Then choose a list of coefficients
+          using the ``random_element`` function of the base ring, and construct
+          a new element based on those coefficients, so that the i-th
+          coefficient corresponds to the (i+shift)-th power of the uniformizer.
+          The amount of coefficients is determined by the ``default_prec``
+          of the ring. Note that this method only creates non-exact elements.
 
         EXAMPLES::
 
             sage: S.<s> = LaurentSeriesRing(GF(3))
             sage: S.random_element()
             s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4 + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)
         """
-        if (algorithm == 'default'):
+        if algorithm == 'default':
             shift = ZZ.random_element()
-            return self([self.base_ring().random_element() for k in range(self.default_prec())], 
+            return self([self.base_ring().random_element() for k in range(self.default_prec())],
                         shift).O(shift + self.default_prec())
         else:
-            raise NotImplementedError("Don't know %s algorithm"%algorithm)
+            raise ValueError("algorithm cannot be %s" % algorithm)
```




---

archive/issue_comments_430440.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-31T02:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430440",
    "user": "@slel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-07T10:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430441",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430442.json:
```json
{
    "body": "Thank you Samuel Leli\u00e8vre for your review and comments.\n\nI implemented the changes you suggested in the ticket.",
    "created_at": "2020-09-07T10:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430442",
    "user": "@n-vi"
}
```

Thank you Samuel Lelièvre for your review and comments.

I implemented the changes you suggested in the ticket.



---

archive/issue_comments_430443.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-07T10:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430443",
    "user": "@n-vi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430444.json:
```json
{
    "body": "Please mark the random example as such; and I suggest some extra wrapping:\n\n\n```diff\n         EXAMPLES::\n\n             sage: S.<s> = LaurentSeriesRing(GF(3))\n-            sage: S.random_element()\n-            s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4 + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)\n+            sage: S.random_element()  # random\n+            s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4\n+            + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)\n         \"\"\"\n         if algorithm == 'default':\n             shift = ZZ.random_element()\n-            return self([self.base_ring().random_element() for k in range(self.default_prec())],\n-                         shift).O(shift + self.default_prec())\n+            return self([self.base_ring().random_element()\n+                         for k in range(self.default_prec())],\n+                        shift).O(shift + self.default_prec())\n         else:\n             raise ValueError(\"algorithm cannot be %s\" % algorithm)\n```\n",
    "created_at": "2020-09-07T17:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430444",
    "user": "@slel"
}
```

Please mark the random example as such; and I suggest some extra wrapping:


```diff
         EXAMPLES::

             sage: S.<s> = LaurentSeriesRing(GF(3))
-            sage: S.random_element()
-            s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4 + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)
+            sage: S.random_element()  # random
+            s^-8 + s^-7 + s^-6 + s^-5 + s^-1 + s + s^3 + s^4
+            + s^5 + 2*s^6 + s^7 + s^11 + O(s^12)
         """
         if algorithm == 'default':
             shift = ZZ.random_element()
-            return self([self.base_ring().random_element() for k in range(self.default_prec())],
-                         shift).O(shift + self.default_prec())
+            return self([self.base_ring().random_element()
+                         for k in range(self.default_prec())],
+                        shift).O(shift + self.default_prec())
         else:
             raise ValueError("algorithm cannot be %s" % algorithm)
```




---

archive/issue_comments_430445.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-07T17:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430445",
    "user": "@slel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430446.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-07T17:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430446",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430447.json:
```json
{
    "body": "Thanks, I updated the code.",
    "created_at": "2020-09-07T17:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430447",
    "user": "@n-vi"
}
```

Thanks, I updated the code.



---

archive/issue_comments_430448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-07T17:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430448",
    "user": "@n-vi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430449.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-09-07T17:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430449",
    "user": "@slel"
}
```

Thanks!



---

archive/issue_comments_430450.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-07T17:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430450",
    "user": "@slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-18T20:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30200#issuecomment-430451",
    "user": "@vbraun"
}
```

Resolution: fixed
