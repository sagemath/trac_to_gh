# Issue 31927: more typing annotations in combinat folder

Issue created by migration from https://trac.sagemath.org/ticket/32164

Original creator: chapoton

Original creation time: 2021-07-08 16:13:36

CC:  @tobiasdiez tscrim

Add minimal typing annotations in the files

```
src/sage/combinat/dyck_word.py
src/sage/combinat/e_one_star.py
src/sage/combinat/non_decreasing_parking_function.py
src/sage/combinat/tamari_lattices.py
```



---

Comment by chapoton created at 2021-07-08 16:14:36

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-07-08 16:14:36

New commits:


---

Comment by mkoeppe created at 2021-07-08 16:36:23


```
             heights[i + 1] = height
         return tuple(heights)
 
-    def associated_parenthesis(self, pos):
+    def associated_parenthesis(self, pos) -> Union[int, None]:
         r"""
         Report the position for the parenthesis in ``self`` that matches the
         one at position ``pos``.
```

I'm really only guessing here, but I think `Optional[int]` may be more idiomatic


---

Comment by chapoton created at 2021-07-09 11:24:01

It seems that the best syntax is `int | None` starting from python 3.10 :

https://stackoverflow.com/questions/51710037/how-should-i-use-the-optional-type-hint


---

Comment by mkoeppe created at 2021-07-09 21:54:58

Thanks for the pointer; it will be a while though until we can use features introduced in 3.10.

I'm not sure if I would agree with the API change here. This is a getter/setter-style method; I don't know if making a change just to be able to add a type decoration is justified:

```
-    def color(self, color=None):
+    def color(self, color=None) -> Color:
         r"""
         Return or change the color of the face.
 
         INPUT:
 
         - ``color`` - string, rgb tuple, color (optional, default: ``None``)
           the new color to assign to the face. If ``None``, it returns the
           color of the face.
 
         OUTPUT:
 
-            color
+        color
 
         EXAMPLES::
 
             sage: from sage.combinat.e_one_star import Face
             sage: f = Face((0,2,0), 3)
             sage: f.color()
             RGB color (0.0, 0.0, 1.0)
             sage: f.color('red')
-            sage: f.color()
             RGB color (1.0, 0.0, 0.0)
-
         """
-        if color is None:
-            return self._color
-        else:
+        if color is not None:
             self._color = Color(color)
+        return self._color
```



---

Comment by @tobiasdiez created at 2021-07-09 22:39:19

The or syntax `int | None` should be possible already in 3.7 with the future import.

For the color function, if the change to always return something is not intended, this kind of situation is usually resolved by specifying overloads (https://docs.python.org/3/library/typing.html#typing.overload), i.e something like


```
@overload
def color(self, color: None) -> Color:
    ...
@overload
def color(self, color: Color) -> None:
    ...
def color(self, color):
   implementation
```



---

Comment by git created at 2021-07-11 06:33:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-07-11 06:40:24

I have undone the change to `color` and removed its annotation.

I also used the new syntax for union annotation elsewhere in the same file.


---

Comment by mkoeppe created at 2021-07-11 21:00:44

LGTM and also passes tests also on Python 3.7.11.


---

Comment by mkoeppe created at 2021-07-11 21:00:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-24 15:28:02

Resolution: fixed
