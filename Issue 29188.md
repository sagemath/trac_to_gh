# Issue 29188: local-conda-forge-macos-standard: Build error with numpy

archive/issues_029188.json:
```json
{
    "body": "CC:  isuruf dimpase jdemeyer embray slelievre vbraun\n\nnumpy build fails on macOS with conda-forge (https://github.com/mkoeppe/sage/runs/542501526)\n\n```\nTraceback (most recent call last):\n  File \"numpy/core/setup_common.py\", line 241, in check_long_double_representation\n    ltype = long_double_representation(pyod(obj))\n  File \"numpy/core/setup_common.py\", line 401, in long_double_representation\n    raise ValueError(\"Could not lock sequences (%s)\" % saw)\nValueError: Could not lock sequences (None)\n```\n\n\nThis can be tested with #29415:\n\n```\n  tox -e local-conda-forge-macos-standard\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29425\n\n",
    "created_at": "2020-03-29T14:47:04Z",
    "labels": [
        "porting",
        "critical",
        "bug"
    ],
    "title": "local-conda-forge-macos-standard: Build error with numpy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29188",
    "user": "mkoeppe"
}
```
CC:  isuruf dimpase jdemeyer embray slelievre vbraun

numpy build fails on macOS with conda-forge (https://github.com/mkoeppe/sage/runs/542501526)

```
Traceback (most recent call last):
  File "numpy/core/setup_common.py", line 241, in check_long_double_representation
    ltype = long_double_representation(pyod(obj))
  File "numpy/core/setup_common.py", line 401, in long_double_representation
    raise ValueError("Could not lock sequences (%s)" % saw)
ValueError: Could not lock sequences (None)
```


This can be tested with #29415:

```
  tox -e local-conda-forge-macos-standard
```


Issue created by migration from https://trac.sagemath.org/ticket/29425





---

archive/issue_comments_413564.json:
```json
{
    "body": "Can you try setting `NPY_DISTUTILS_APPEND_FLAGS=1` in the numpy build script?",
    "created_at": "2020-03-29T20:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413564",
    "user": "isuruf"
}
```

Can you try setting `NPY_DISTUTILS_APPEND_FLAGS=1` in the numpy build script?



---

archive/issue_comments_413565.json:
```json
{
    "body": "This didn't make a difference",
    "created_at": "2020-03-29T22:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413565",
    "user": "mkoeppe"
}
```

This didn't make a difference



---

archive/issue_comments_413566.json:
```json
{
    "body": "Upgrading numpy to 1.18.2 fixes it; but this will require a Cython upgrade too",
    "created_at": "2020-03-30T00:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413566",
    "user": "mkoeppe"
}
```

Upgrading numpy to 1.18.2 fixes it; but this will require a Cython upgrade too



---

archive/issue_comments_413567.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-03-30T00:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413567",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_413568.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-30T01:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413568",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_413569.json:
```json
{
    "body": "Tests run at https://github.com/mkoeppe/sage/actions/runs/66127777",
    "created_at": "2020-03-30T01:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413569",
    "user": "mkoeppe"
}
```

Tests run at https://github.com/mkoeppe/sage/actions/runs/66127777



---

archive/issue_comments_413570.json:
```json
{
    "body": "Cython URL can be set to `https://pypi.io/packages/source/C/Cython/Cython-VERSION.tar.gz`",
    "created_at": "2020-03-30T01:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413570",
    "user": "isuruf"
}
```

Cython URL can be set to `https://pypi.io/packages/source/C/Cython/Cython-VERSION.tar.gz`



---

archive/issue_comments_413571.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-30T01:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413571",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_413572.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-03-30T01:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413572",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_413573.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-30T02:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413573",
    "user": "isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413574.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-03-30T12:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413574",
    "user": "mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_413575.json:
```json
{
    "body": "Breaks py2 builds\n\n```\nTraceback (most recent call last):\n  File \"setup.py\", line 32, in <module>\n    raise RuntimeError(\"Python version >= 3.5 required.\")\nRuntimeError: Python version >= 3.5 required.\n}}",
    "created_at": "2020-03-30T12:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413575",
    "user": "mkoeppe"
}
```

Breaks py2 builds

```
Traceback (most recent call last):
  File "setup.py", line 32, in <module>
    raise RuntimeError("Python version >= 3.5 required.")
RuntimeError: Python version >= 3.5 required.
}}



---

archive/issue_comments_413576.json:
```json
{
    "body": "Setting milestone to 9.2, which is presumably the first py3-only release",
    "created_at": "2020-03-30T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413576",
    "user": "mkoeppe"
}
```

Setting milestone to 9.2, which is presumably the first py3-only release



---

archive/issue_comments_413577.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-03-30T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413577",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_413578.json:
```json
{
    "body": "I'll check whether an update to NumPy 1.16.6 (supports py2) also fixes the problem.",
    "created_at": "2020-03-30T12:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413578",
    "user": "mkoeppe"
}
```

I'll check whether an update to NumPy 1.16.6 (supports py2) also fixes the problem.



---

archive/issue_comments_413579.json:
```json
{
    "body": "That is #29429 - Upgrade numpy to 1.16.6 (last release supporting py2)",
    "created_at": "2020-03-30T22:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413579",
    "user": "mkoeppe"
}
```

That is #29429 - Upgrade numpy to 1.16.6 (last release supporting py2)



---

archive/issue_comments_413580.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2020-03-31T13:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413580",
    "user": "mkoeppe"
}
```

Changing priority from critical to major.



---

archive/issue_comments_413581.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-04-08T20:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413581",
    "user": "mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_413582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-05-10T20:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413582",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_413583.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-05-10T20:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413583",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_413584.json:
```json
{
    "body": "(untested)",
    "created_at": "2020-05-10T20:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413584",
    "user": "mkoeppe"
}
```

(untested)



---

archive/issue_comments_413585.json:
```json
{
    "body": "I am trying to use it. I had a first problem, it did not download the required version of cython, solved by downloading and putting it in upstream. The same happened for numpy, but it does not look for the package in upstream and failed. By some reason, giac also fail with a message like \"undefined reference to `__gmpn_add_nc'\"",
    "created_at": "2020-05-13T15:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413585",
    "user": "enriqueartal"
}
```

I am trying to use it. I had a first problem, it did not download the required version of cython, solved by downloading and putting it in upstream. The same happened for numpy, but it does not look for the package in upstream and failed. By some reason, giac also fail with a message like "undefined reference to `__gmpn_add_nc'"



---

archive/issue_comments_413586.json:
```json
{
    "body": "To enable automatic downloads, use `./configure --enable-download-from-upstream-url`.",
    "created_at": "2020-05-13T19:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413586",
    "user": "mkoeppe"
}
```

To enable automatic downloads, use `./configure --enable-download-from-upstream-url`.



---

archive/issue_comments_413587.json:
```json
{
    "body": "The giac build failure - is this in a build from scratch?",
    "created_at": "2020-05-13T19:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413587",
    "user": "mkoeppe"
}
```

The giac build failure - is this in a build from scratch?



---

archive/issue_comments_413588.json:
```json
{
    "body": "No, maybe it is a problem of mixing gcc9 and gcc10\n\nReplying to [comment:27 mkoeppe]:\n> The giac build failure - is this in a build from scratch?",
    "created_at": "2020-05-13T21:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413588",
    "user": "enriqueartal"
}
```

No, maybe it is a problem of mixing gcc9 and gcc10

Replying to [comment:27 mkoeppe]:
> The giac build failure - is this in a build from scratch?



---

archive/issue_comments_413589.json:
```json
{
    "body": "Both numpy and scipy can be reached, but the following problem appears. If solved, I will try to build from scratch.\n\nInstalling scipy-1.4.1\nDownload error on https://pypi.org/simple/pybind11/: [Errno 110] Connection timed out -- Some packages may not be found!\nCouldn't find index page for 'pybind11' (maybe misspelled?)",
    "created_at": "2020-05-14T13:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413589",
    "user": "enriqueartal"
}
```

Both numpy and scipy can be reached, but the following problem appears. If solved, I will try to build from scratch.

Installing scipy-1.4.1
Download error on https://pypi.org/simple/pybind11/: [Errno 110] Connection timed out -- Some packages may not be found!
Couldn't find index page for 'pybind11' (maybe misspelled?)



---

archive/issue_comments_413590.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-05-14T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413590",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_413591.json:
```json
{
    "body": "Thanks for catching this. This is an additional dependency that we need to ship.\nhttps://github.com/scipy/scipy/blob/master/pyproject.toml",
    "created_at": "2020-05-14T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413591",
    "user": "mkoeppe"
}
```

Thanks for catching this. This is an additional dependency that we need to ship.
https://github.com/scipy/scipy/blob/master/pyproject.toml



---

archive/issue_comments_413592.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-14T19:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413592",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_413593.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-05-14T19:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413593",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_413594.json:
```json
{
    "body": "I compiled from scratch using gcc10. Besides the expected  failures of palp and sympow, these are the last lines of the log of scipy. \n\n\n    error: Command \"gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -fPIC -O3 -funroll-loops -Iscipy/sparse/linalg/eigen/arpack/ARPACK/SRC -I/home/artal/sage/local/lib/python3.7/site-packages/numpy/core/include -c -c scipy/sparse/linalg/eigen/arpack/ARPACK/SRC/dsaitr.f -o build/temp.linux-x86_64-3.7/scipy/sparse/linalg/eigen/arpack/ARPACK/SRC/dsaitr.o\" failed with exit status 1\n    Running setup.py install for scipy: finished with status 'error'\nCleaning up...\n  Removing source in /tmp/pip-req-build-yghxywzq\nRemoved build tracker '/tmp/pip-req-tracker-maw6u14m'\nCommand \"/home/artal/sage/local/bin/python3 -u -c \"import setuptools, tokenize;__file__='/tmp/pip-req-build-yghxywzq/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" --no-user-cfg install --record /tmp/pip-record-axtqqq0z/install-record.txt --single-version-externally-managed --root /home/artal/sage/local/var/tmp/sage/build/scipy-1.4.1/inst --compile\" failed with error code 1 in /tmp/pip-req-build-yghxywzq/\nException information:\nTraceback (most recent call last):\n  File \"/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/cli/base_command.py\", line 143, in main\n    status = self.run(options, args)\n  File \"/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/commands/install.py\", line 366, in run\n    use_user_site=options.use_user_site,\n  File \"/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/req/__init__.py\", line 49, in install_given_reqs\n    **kwargs\n  File \"/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/req/req_install.py\", line 791, in install\n    spinner=spinner,\n  File \"/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/utils/misc.py\", line 705, in call_subprocess\n    % (command_desc, proc.returncode, cwd))\npip._internal.exceptions.InstallationError: Command \"/home/artal/sage/local/bin/python3 -u -c \"import setuptools, tokenize;__file__='/tmp/pip-req-build-yghxywzq/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" --no-user-cfg install --record /tmp/pip-record-axtqqq0z/install-record.txt --single-version-externally-managed --root /home/artal/sage/local/var/tmp/sage/build/scipy-1.4.1/inst --compile\" failed with error code 1 in /tmp/pip-req-build-yghxywzq/\nError: installing with pip3 failed",
    "created_at": "2020-05-15T18:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413594",
    "user": "enriqueartal"
}
```

I compiled from scratch using gcc10. Besides the expected  failures of palp and sympow, these are the last lines of the log of scipy. 


    error: Command "gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -fPIC -O3 -funroll-loops -Iscipy/sparse/linalg/eigen/arpack/ARPACK/SRC -I/home/artal/sage/local/lib/python3.7/site-packages/numpy/core/include -c -c scipy/sparse/linalg/eigen/arpack/ARPACK/SRC/dsaitr.f -o build/temp.linux-x86_64-3.7/scipy/sparse/linalg/eigen/arpack/ARPACK/SRC/dsaitr.o" failed with exit status 1
    Running setup.py install for scipy: finished with status 'error'
Cleaning up...
  Removing source in /tmp/pip-req-build-yghxywzq
Removed build tracker '/tmp/pip-req-tracker-maw6u14m'
Command "/home/artal/sage/local/bin/python3 -u -c "import setuptools, tokenize;__file__='/tmp/pip-req-build-yghxywzq/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" --no-user-cfg install --record /tmp/pip-record-axtqqq0z/install-record.txt --single-version-externally-managed --root /home/artal/sage/local/var/tmp/sage/build/scipy-1.4.1/inst --compile" failed with error code 1 in /tmp/pip-req-build-yghxywzq/
Exception information:
Traceback (most recent call last):
  File "/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/cli/base_command.py", line 143, in main
    status = self.run(options, args)
  File "/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/commands/install.py", line 366, in run
    use_user_site=options.use_user_site,
  File "/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/req/__init__.py", line 49, in install_given_reqs
    **kwargs
  File "/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/req/req_install.py", line 791, in install
    spinner=spinner,
  File "/home/artal/sage/local/lib/python3.7/site-packages/pip/_internal/utils/misc.py", line 705, in call_subprocess
    % (command_desc, proc.returncode, cwd))
pip._internal.exceptions.InstallationError: Command "/home/artal/sage/local/bin/python3 -u -c "import setuptools, tokenize;__file__='/tmp/pip-req-build-yghxywzq/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" --no-user-cfg install --record /tmp/pip-record-axtqqq0z/install-record.txt --single-version-externally-managed --root /home/artal/sage/local/var/tmp/sage/build/scipy-1.4.1/inst --compile" failed with error code 1 in /tmp/pip-req-build-yghxywzq/
Error: installing with pip3 failed



---

archive/issue_comments_413595.json:
```json
{
    "body": "what's the status of here? are we really waiting for gcc10 starting to work?",
    "created_at": "2020-05-29T09:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413595",
    "user": "dimpase"
}
```

what's the status of here? are we really waiting for gcc10 starting to work?



---

archive/issue_comments_413596.json:
```json
{
    "body": "No, just waiting for review of this ticket and its dependency #29480.",
    "created_at": "2020-05-29T15:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413596",
    "user": "mkoeppe"
}
```

No, just waiting for review of this ticket and its dependency #29480.



---

archive/issue_comments_413597.json:
```json
{
    "body": "I get doctest errors due to\n\n```\nDeprecationWarning: scipy.array is deprecated and will be removed in SciPy 2.0.0, use numpy.array instead\n```\n\nnamely, \n\n```\nsage -t --warn-long 76.6 src/sage/graphs/generic_graph.py\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 9789, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    G.pagerank(algorithm=\"Scipy\") # abs tol 1e-9\nExpected:\n    {1: 0.16112205885619563,\n     2: 0.1619531043247219,\n     3: 0.16112205885619563,\n     4: 0.2374999999999999,\n     5: 0.17775588228760858,\n     6: 0.100546895675278}\nGot:\n    doctest:warning\n....\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py\", line 1104, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.?[7]>\", line 1, in <module>\n        G.pagerank(algorithm=\"Scipy\") # abs tol 1e-9\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/graphs/generic_graph.py\", line 9880, in pagerank\n        dangling=dangling)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/networkx/algorithms/link_analysis/pagerank_alg.py\", line 429, in pagerank_scipy\n        S = scipy.array(M.sum(axis=1)).flatten()\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/scipy/_lib/deprecation.py\", line 19, in call\n        stacklevel=stacklevel)\n      File \"/usr/lib64/python3.7/warnings.py\", line 110, in _showwarnmsg\n        msg.file, msg.line)\n    :\n    DeprecationWarning: scipy.array is deprecated and will be removed in SciPy 2.0.0, use numpy.array instead\n```\n\n\nit seems that these warnings are coming from scipy itself, or from networkx\n(which in turn calls scipy).\n\nLet me see if upgrading networkx helps.",
    "created_at": "2020-05-29T17:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413597",
    "user": "dimpase"
}
```

I get doctest errors due to

```
DeprecationWarning: scipy.array is deprecated and will be removed in SciPy 2.0.0, use numpy.array instead
```

namely, 

```
sage -t --warn-long 76.6 src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 9789, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    G.pagerank(algorithm="Scipy") # abs tol 1e-9
Expected:
    {1: 0.16112205885619563,
     2: 0.1619531043247219,
     3: 0.16112205885619563,
     4: 0.2374999999999999,
     5: 0.17775588228760858,
     6: 0.100546895675278}
Got:
    doctest:warning
....
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py", line 1104, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.?[7]>", line 1, in <module>
        G.pagerank(algorithm="Scipy") # abs tol 1e-9
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/graphs/generic_graph.py", line 9880, in pagerank
        dangling=dangling)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/networkx/algorithms/link_analysis/pagerank_alg.py", line 429, in pagerank_scipy
        S = scipy.array(M.sum(axis=1)).flatten()
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/scipy/_lib/deprecation.py", line 19, in call
        stacklevel=stacklevel)
      File "/usr/lib64/python3.7/warnings.py", line 110, in _showwarnmsg
        msg.file, msg.line)
    :
    DeprecationWarning: scipy.array is deprecated and will be removed in SciPy 2.0.0, use numpy.array instead
```


it seems that these warnings are coming from scipy itself, or from networkx
(which in turn calls scipy).

Let me see if upgrading networkx helps.



---

archive/issue_comments_413598.json:
```json
{
    "body": "No, with networkx 2.4 one still gets these warnings, but they are fixed upstream, just not yet released, see \nhttps://github.com/networkx/networkx/commit/ea19baaff252468f5a911260430e057393d9637d",
    "created_at": "2020-05-29T17:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413598",
    "user": "dimpase"
}
```

No, with networkx 2.4 one still gets these warnings, but they are fixed upstream, just not yet released, see 
https://github.com/networkx/networkx/commit/ea19baaff252468f5a911260430e057393d9637d



---

archive/issue_comments_413599.json:
```json
{
    "body": "So we can patch networkx, or modify doctests, or suppress warning somehow (for the latter, I vaguely remember it's possible, but can't find it in docs)",
    "created_at": "2020-05-29T17:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413599",
    "user": "dimpase"
}
```

So we can patch networkx, or modify doctests, or suppress warning somehow (for the latter, I vaguely remember it's possible, but can't find it in docs)



---

archive/issue_comments_413600.json:
```json
{
    "body": "Filtering out doctest warnings was done on one of the recent glpk tickets",
    "created_at": "2020-05-29T22:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413600",
    "user": "mkoeppe"
}
```

Filtering out doctest warnings was done on one of the recent glpk tickets



---

archive/issue_comments_413601.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-30T22:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413601",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413602.json:
```json
{
    "body": "Replying to [comment:40 mkoeppe]:\n> Filtering out doctest warnings was done on one of the recent glpk tickets\nI don't know how to filter multiline warnings with python backtraces.\n\nOK, I've opened #29766 to fix this. This one is good to go, modulo the latter.",
    "created_at": "2020-05-30T22:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413602",
    "user": "dimpase"
}
```

Replying to [comment:40 mkoeppe]:
> Filtering out doctest warnings was done on one of the recent glpk tickets
I don't know how to filter multiline warnings with python backtraces.

OK, I've opened #29766 to fix this. This one is good to go, modulo the latter.



---

archive/issue_comments_413603.json:
```json
{
    "body": "drop the networkx dependency with the latest patch (and rebase over latest beta).",
    "created_at": "2020-06-01T10:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413603",
    "user": "dimpase"
}
```

drop the networkx dependency with the latest patch (and rebase over latest beta).



---

archive/issue_comments_413604.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-01T10:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413604",
    "user": "dimpase"
}
```

New commits:



---

archive/issue_comments_413605.json:
```json
{
    "body": "Replying to [comment:40 mkoeppe]:\n> Filtering out doctest warnings was done on one of the recent glpk tickets\n\nadded the last commit to suppress the warning in the proper Pythonic way. The rest stays (mod rebase)",
    "created_at": "2020-06-01T10:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413605",
    "user": "dimpase"
}
```

Replying to [comment:40 mkoeppe]:
> Filtering out doctest warnings was done on one of the recent glpk tickets

added the last commit to suppress the warning in the proper Pythonic way. The rest stays (mod rebase)



---

archive/issue_comments_413606.json:
```json
{
    "body": "I'm getting various test failures",
    "created_at": "2020-06-04T22:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413606",
    "user": "vbraun"
}
```

I'm getting various test failures



---

archive/issue_comments_413607.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-06-04T22:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413607",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_413608.json:
```json
{
    "body": "An upgrade ticket like this really needs to be run on the [GitHub](GitHub) test infrastructure...",
    "created_at": "2020-06-04T22:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413608",
    "user": "mkoeppe"
}
```

An upgrade ticket like this really needs to be run on the [GitHub](GitHub) test infrastructure...



---

archive/issue_comments_413609.json:
```json
{
    "body": "running GH Actions test here https://github.com/dimpase/sage/pull/9",
    "created_at": "2020-06-04T22:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413609",
    "user": "dimpase"
}
```

running GH Actions test here https://github.com/dimpase/sage/pull/9



---

archive/issue_comments_413610.json:
```json
{
    "body": "Replying to [comment:47 mkoeppe]:\n> An upgrade ticket like this really needs to be run on the [GitHub](GitHub) test infrastructure...\nUnfortunately there seem to be problems with runner setups, e.g. here \nhttps://github.com/dimpase/sage/runs/740349791?check_suite_focus=true\n- this is `docker (archlinux-latest, standard-gcc_spkg)`\nI see\n\n```\n2020-06-04T22:39:01.9688082Z Suggested packages:\n2020-06-04T22:39:01.9688790Z   python3-pytest python-setuptools-doc\n```\n\nand a lot of \n\n```\n2020-06-05T03:08:41.2134392Z Failure: ModuleNotFoundError (No module named 'pytest') ... ERROR\n```\n\nwhich seems to suggest that `python3-pytest` is a requirement.\n\nDo you know how to fix this?\n\n(there are other errors pointing at internal problems of runners)\n\nCan we easily extend setup to use our own runners?",
    "created_at": "2020-06-05T13:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413610",
    "user": "dimpase"
}
```

Replying to [comment:47 mkoeppe]:
> An upgrade ticket like this really needs to be run on the [GitHub](GitHub) test infrastructure...
Unfortunately there seem to be problems with runner setups, e.g. here 
https://github.com/dimpase/sage/runs/740349791?check_suite_focus=true
- this is `docker (archlinux-latest, standard-gcc_spkg)`
I see

```
2020-06-04T22:39:01.9688082Z Suggested packages:
2020-06-04T22:39:01.9688790Z   python3-pytest python-setuptools-doc
```

and a lot of 

```
2020-06-05T03:08:41.2134392Z Failure: ModuleNotFoundError (No module named 'pytest') ... ERROR
```

which seems to suggest that `python3-pytest` is a requirement.

Do you know how to fix this?

(there are other errors pointing at internal problems of runners)

Can we easily extend setup to use our own runners?



---

archive/issue_comments_413611.json:
```json
{
    "body": "Apparently, running the testsuite of networkx requires pytest. Let's discuss this on #29766.\n\nI don't think this has anything to do with [GitHub](GitHub).",
    "created_at": "2020-06-06T04:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413611",
    "user": "mkoeppe"
}
```

Apparently, running the testsuite of networkx requires pytest. Let's discuss this on #29766.

I don't think this has anything to do with [GitHub](GitHub).



---

archive/issue_comments_413612.json:
```json
{
    "body": "In the meantime, numpy 1.18.5 has appeared",
    "created_at": "2020-06-06T05:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413612",
    "user": "mkoeppe"
}
```

In the meantime, numpy 1.18.5 has appeared



---

archive/issue_comments_413613.json:
```json
{
    "body": "Tests (with #29766) run at https://github.com/mkoeppe/sage/pull/38/checks\n----\nNew commits:",
    "created_at": "2020-06-06T05:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413613",
    "user": "mkoeppe"
}
```

Tests (with #29766) run at https://github.com/mkoeppe/sage/pull/38/checks
----
New commits:



---

archive/issue_comments_413614.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-06T05:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413614",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_413615.json:
```json
{
    "body": "Can this ticket be tested successfully by itself or only as part of the `networkx` upgrade in #29766?  If the latter, then let's close this ticket and merge it into #29766.",
    "created_at": "2020-06-06T18:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413615",
    "user": "mkoeppe"
}
```

Can this ticket be tested successfully by itself or only as part of the `networkx` upgrade in #29766?  If the latter, then let's close this ticket and merge it into #29766.



---

archive/issue_comments_413616.json:
```json
{
    "body": "Replying to [comment:56 mkoeppe]:\n> Can this ticket be tested successfully by itself or only as part of the `networkx` upgrade in #29766?  If the latter, then let's close this ticket and merge it into #29766.\n\nno, this one does not need #29766",
    "created_at": "2020-06-06T20:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413616",
    "user": "dimpase"
}
```

Replying to [comment:56 mkoeppe]:
> Can this ticket be tested successfully by itself or only as part of the `networkx` upgrade in #29766?  If the latter, then let's close this ticket and merge it into #29766.

no, this one does not need #29766



---

archive/issue_comments_413617.json:
```json
{
    "body": "OK, running a new test without #29766 at https://github.com/mkoeppe/sage/pull/39/checks",
    "created_at": "2020-06-06T21:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413617",
    "user": "mkoeppe"
}
```

OK, running a new test without #29766 at https://github.com/mkoeppe/sage/pull/39/checks



---

archive/issue_comments_413618.json:
```json
{
    "body": "Replying to [comment:57 dimpase]:\n> Replying to [comment:56 mkoeppe]:\n> > Can this ticket be tested successfully by itself or only as part of the `networkx` upgrade in #29766?  If the latter, then let's close this ticket and merge it into #29766.\n> \n> no, this one does not need #29766\n\nActually, on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), I see lots of failures from the `networkx` testsuite such as this one:\n\n```\nFile \"/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py\", line 249, in networkx.drawing.nx_pylab.draw_networkx\nFailed example:\n    nx.draw(G)\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/lib/python3.7/doctest.py\", line 1329, in __run\n        compileflags, 1), test.globs)\n      File \"<doctest networkx.drawing.nx_pylab.draw_networkx[1]>\", line 1, in <module>\n        nx.draw(G)\n      File \"/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py\", line 126, in draw\n        draw_networkx(G, pos=pos, ax=ax, **kwds)\n      File \"/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py\", line 278, in draw_networkx\n        edge_collection = draw_networkx_edges(G, pos, arrows=arrows, **kwds)\n      File \"/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py\", line 611, in draw_networkx_edges\n        if cb.is_numlike(alpha):\n    AttributeError: module 'matplotlib.cbook' has no attribute 'is_numlike'\n```\n",
    "created_at": "2020-06-07T02:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413618",
    "user": "mkoeppe"
}
```

Replying to [comment:57 dimpase]:
> Replying to [comment:56 mkoeppe]:
> > Can this ticket be tested successfully by itself or only as part of the `networkx` upgrade in #29766?  If the latter, then let's close this ticket and merge it into #29766.
> 
> no, this one does not need #29766

Actually, on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), I see lots of failures from the `networkx` testsuite such as this one:

```
File "/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py", line 249, in networkx.drawing.nx_pylab.draw_networkx
Failed example:
    nx.draw(G)
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/lib/python3.7/doctest.py", line 1329, in __run
        compileflags, 1), test.globs)
      File "<doctest networkx.drawing.nx_pylab.draw_networkx[1]>", line 1, in <module>
        nx.draw(G)
      File "/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py", line 126, in draw
        draw_networkx(G, pos=pos, ax=ax, **kwds)
      File "/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py", line 278, in draw_networkx
        edge_collection = draw_networkx_edges(G, pos, arrows=arrows, **kwds)
      File "/sage/local/var/tmp/sage/build/networkx-2.2/src/networkx/drawing/nx_pylab.py", line 611, in draw_networkx_edges
        if cb.is_numlike(alpha):
    AttributeError: module 'matplotlib.cbook' has no attribute 'is_numlike'
```




---

archive/issue_comments_413619.json:
```json
{
    "body": "Therefore, let's close this ticket and continue on #29766.",
    "created_at": "2020-06-07T03:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413619",
    "user": "mkoeppe"
}
```

Therefore, let's close this ticket and continue on #29766.



---

archive/issue_comments_413620.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-11T22:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413620",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413621.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-06-20T06:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29188#issuecomment-413621",
    "user": "chapoton"
}
```

Resolution: duplicate
