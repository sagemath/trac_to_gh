# Issue 30780: build/bin/sage-spkg-info: Format dependencies file; remove redundant "dependencies" sections from SPKG.rst

archive/issues_030780.json:
```json
{
    "body": "CC:  jhpalmieri slabbe slelievre dimpase vdelecroix @tobiasdiez\n\nKeywords: sd111\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31017\n\n",
    "created_at": "2020-12-06T18:34:10Z",
    "labels": [
        "build",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "build/bin/sage-spkg-info: Format dependencies file; remove redundant \"dependencies\" sections from SPKG.rst",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30780",
    "user": "mkoeppe"
}
```
CC:  jhpalmieri slabbe slelievre dimpase vdelecroix @tobiasdiez

Keywords: sd111



Issue created by migration from https://trac.sagemath.org/ticket/31017





---

archive/issue_comments_440069.json:
```json
{
    "body": "Simple clean regexp processing like\n\n```\nfor a in build/pkgs/*/dependencies; do echo $((for d in $(sed -n '2,$d;/#/d;s/[$][(][-a-z]* [^)]*[)]//g;s/[$|,()]/ /g;s,[^ /]*/[^ ]*,,g;s/findstring//g;s/OPTIONAL_INSTALLED_PACKAGES//;p' $a); do echo $d; done) | sort); done\n```\n\ndoes the job",
    "created_at": "2021-01-18T03:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440069",
    "user": "mkoeppe"
}
```

Simple clean regexp processing like

```
for a in build/pkgs/*/dependencies; do echo $((for d in $(sed -n '2,$d;/#/d;s/[$][(][-a-z]* [^)]*[)]//g;s/[$|,()]/ /g;s,[^ /]*/[^ ]*,,g;s/findstring//g;s/OPTIONAL_INSTALLED_PACKAGES//;p' $a); do echo $d; done) | sort); done
```

does the job



---

archive/issue_comments_440070.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440070",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_440071.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-05-15T04:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440071",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_440072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T04:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440072",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T04:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440073",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T04:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440074",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440075.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-15T04:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440075",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_440076.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T06:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440076",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440077.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-15T06:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440077",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_440078.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T06:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440078",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440079.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-15T08:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440079",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_440080.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-24T16:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440080",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_440081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-24T16:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440081",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440082.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-24T16:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440082",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_440083.json:
```json
{
    "body": "while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)\n\nDependencies are currently tracked  in several ways: \n\n* `build/pkgs/<...>/dependencies` (which get into generated Makefiles)\n* pip (there are requirements.txt, maybe other ways?)\n* something else ???",
    "created_at": "2022-05-26T09:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440083",
    "user": "dimpase"
}
```

while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)

Dependencies are currently tracked  in several ways: 

* `build/pkgs/<...>/dependencies` (which get into generated Makefiles)
* pip (there are requirements.txt, maybe other ways?)
* something else ???



---

archive/issue_comments_440084.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-26T13:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440084",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440085.json:
```json
{
    "body": "lgtm",
    "created_at": "2022-05-26T13:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440085",
    "user": "dimpase"
}
```

lgtm



---

archive/issue_comments_440086.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-05-26T14:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440086",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_440087.json:
```json
{
    "body": "Replying to [comment:24 dimpase]:\n> while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)\n\nHas this observation been reproduced? Then a ticket for it should be opened",
    "created_at": "2022-05-26T14:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440087",
    "user": "mkoeppe"
}
```

Replying to [comment:24 dimpase]:
> while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)

Has this observation been reproduced? Then a ticket for it should be opened



---

archive/issue_comments_440088.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> Replying to [comment:24 dimpase]:\n> > while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)\n> \n> Has this observation been reproduced? Then a ticket for it should be opened\n\nyes it has been reproduced. I'll open a ticket.",
    "created_at": "2022-05-26T18:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440088",
    "user": "dimpase"
}
```

Replying to [comment:27 mkoeppe]:
> Replying to [comment:24 dimpase]:
> > while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)
> 
> Has this observation been reproduced? Then a ticket for it should be opened

yes it has been reproduced. I'll open a ticket.



---

archive/issue_comments_440089.json:
```json
{
    "body": "aand, while trying to reproduce the latter, I ran unto a bug:\n\n```\n$ make jupyterlab_widgets\n...\nmake[1]: Entering directory '/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/build/make'\nmake[1]: *** No rule to make target 'jupyter_packagingjupyterlab', needed by 'ipympl'.  Stop.\nmake[1]: Leaving directory '/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/build/make'\n\nreal    0m0.018s\nuser    0m0.017s\nsys     0m0.001s\n***************************************************************\nError building Sage.\n```\n",
    "created_at": "2022-05-26T18:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440089",
    "user": "dimpase"
}
```

aand, while trying to reproduce the latter, I ran unto a bug:

```
$ make jupyterlab_widgets
...
make[1]: Entering directory '/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/build/make'
make[1]: *** No rule to make target 'jupyter_packagingjupyterlab', needed by 'ipympl'.  Stop.
make[1]: Leaving directory '/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/build/make'

real    0m0.018s
user    0m0.017s
sys     0m0.001s
***************************************************************
Error building Sage.
```




---

archive/issue_comments_440090.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-05-26T18:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440090",
    "user": "dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_440091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-26T19:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440092.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-26T19:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440092",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_440093.json:
```json
{
    "body": "Thanks for catching this",
    "created_at": "2022-05-26T19:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440093",
    "user": "mkoeppe"
}
```

Thanks for catching this



---

archive/issue_comments_440094.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-26T20:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440094",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440095.json:
```json
{
    "body": "ok, this works",
    "created_at": "2022-05-26T20:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440095",
    "user": "dimpase"
}
```

ok, this works



---

archive/issue_comments_440096.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-05-26T20:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440096",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_440097.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-05-27T19:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440097",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_440098.json:
```json
{
    "body": "Merge failure on top of:\n\n3b7d542342 Trac #33916: tweak tox.ini: activate more pycodestyle checks in cython files\n\n7c9c0f7a21 Trac #33910: installing jupyterlab causes sagelib rebuild\n\n3af284d113 Trac #33905: pep and other details in dynamics\n\n9a586e259b Trac #33901: sage-bootstrap-python doesn't work when pyenv shadows all usable pythons in PATH\n\n221fee8ba0 Trac #33739: Migrate gitpod to conda\n\n24579c942f Trac #33601: Documentation: Add 'furo' theme\n\n490d27a212 Trac #32937: Drop Python 3.7 support in Sage 9.7\n\n24d7d6af87 Trac #31937: Update markupsafe to 2.1.1, jinja2 to 3.1.2\n\n4aedae2596 Trac #29941: Modularization of sagelib: Break out separate packages sagemath-environment, sagemath-repl\n\n70ec4e67ab Trac #25872: Modular decomposition bug\n\n5fb2a6ea44 Updated [SageMath](SageMath) version to 9.7.beta1\n\n\n\nmerge was not clean: conflicts in build/pkgs/mathjax/SPKG.rst",
    "created_at": "2022-05-27T19:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440098",
    "user": "vbraun"
}
```

Merge failure on top of:

3b7d542342 Trac #33916: tweak tox.ini: activate more pycodestyle checks in cython files

7c9c0f7a21 Trac #33910: installing jupyterlab causes sagelib rebuild

3af284d113 Trac #33905: pep and other details in dynamics

9a586e259b Trac #33901: sage-bootstrap-python doesn't work when pyenv shadows all usable pythons in PATH

221fee8ba0 Trac #33739: Migrate gitpod to conda

24579c942f Trac #33601: Documentation: Add 'furo' theme

490d27a212 Trac #32937: Drop Python 3.7 support in Sage 9.7

24d7d6af87 Trac #31937: Update markupsafe to 2.1.1, jinja2 to 3.1.2

4aedae2596 Trac #29941: Modularization of sagelib: Break out separate packages sagemath-environment, sagemath-repl

70ec4e67ab Trac #25872: Modular decomposition bug

5fb2a6ea44 Updated [SageMath](SageMath) version to 9.7.beta1



merge was not clean: conflicts in build/pkgs/mathjax/SPKG.rst



---

archive/issue_comments_440099.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-05-27T19:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440099",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_440100.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-05-27T19:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440100",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_440101.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-29T11:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30780#issuecomment-440101",
    "user": "vbraun"
}
```

Resolution: fixed
