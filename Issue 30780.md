# Issue 30780: build/bin/sage-spkg-info: Format dependencies file; remove redundant "dependencies" sections from SPKG.rst

Issue created by migration from https://trac.sagemath.org/ticket/31017

Original creator: mkoeppe

Original creation time: 2020-12-06 18:34:10

CC:  jhpalmieri slabbe slelievre dimpase vdelecroix @tobiasdiez

Keywords: sd111




---

Comment by mkoeppe created at 2021-01-18 03:47:58

Simple clean regexp processing like

```
for a in build/pkgs/*/dependencies; do echo $((for d in $(sed -n '2,$d;/#/d;s/[$][(][-a-z]* [^)]*[)]//g;s/[$|,()]/ /g;s,[^ /]*/[^ ]*,,g;s/findstring//g;s/OPTIONAL_INSTALLED_PACKAGES//;p' $a); do echo $d; done) | sort); done
```

does the job


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2022-05-15 04:18:10

New commits:


---

Comment by git created at 2022-05-15 04:41:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-05-15 04:45:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-05-15 04:51:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-15 04:51:55

Changing status from new to needs_review.


---

Comment by git created at 2022-05-15 06:19:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-15 06:25:26

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-05-15 06:59:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-15 08:17:06

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-05-24 16:39:47

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-05-24 16:55:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-24 16:55:54

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2022-05-26 09:56:23

while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)

Dependencies are currently tracked  in several ways: 

* `build/pkgs/<...>/dependencies` (which get into generated Makefiles)
* pip (there are requirements.txt, maybe other ways?)
* something else ???


---

Comment by dimpase created at 2022-05-26 13:49:15

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2022-05-26 13:49:15

lgtm


---

Comment by mkoeppe created at 2022-05-26 14:13:51

Thank you!


---

Comment by mkoeppe created at 2022-05-26 14:16:49

Replying to [comment:24 dimpase]:
> while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)

Has this observation been reproduced? Then a ticket for it should be opened


---

Comment by dimpase created at 2022-05-26 18:31:58

Replying to [comment:27 mkoeppe]:
> Replying to [comment:24 dimpase]:
> > while we're busy with deps here, it would be good to understand why installing `jupyterlab` triggers re-building of `sagelib` (as reported recently on sage-devel)
> 
> Has this observation been reproduced? Then a ticket for it should be opened

yes it has been reproduced. I'll open a ticket.


---

Comment by dimpase created at 2022-05-26 18:57:47

aand, while trying to reproduce the latter, I ran unto a bug:

```
$ make jupyterlab_widgets
...
make[1]: Entering directory '/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/build/make'
make[1]: *** No rule to make target 'jupyter_packagingjupyterlab', needed by 'ipympl'.  Stop.
make[1]: Leaving directory '/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/build/make'

real    0m0.018s
user    0m0.017s
sys     0m0.001s
***************************************************************
Error building Sage.
```



---

Comment by dimpase created at 2022-05-26 18:57:47

Changing status from positive_review to needs_work.


---

Comment by git created at 2022-05-26 19:03:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-26 19:05:33

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-05-26 19:05:33

Thanks for catching this


---

Comment by dimpase created at 2022-05-26 20:21:59

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2022-05-26 20:21:59

ok, this works


---

Comment by mkoeppe created at 2022-05-26 20:48:09

Thanks!


---

Comment by vbraun created at 2022-05-27 19:39:37

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-05-27 19:39:37

Merge failure on top of:

3b7d542342 Trac #33916: tweak tox.ini: activate more pycodestyle checks in cython files

7c9c0f7a21 Trac #33910: installing jupyterlab causes sagelib rebuild

3af284d113 Trac #33905: pep and other details in dynamics

9a586e259b Trac #33901: sage-bootstrap-python doesn't work when pyenv shadows all usable pythons in PATH

221fee8ba0 Trac #33739: Migrate gitpod to conda

24579c942f Trac #33601: Documentation: Add 'furo' theme

490d27a212 Trac #32937: Drop Python 3.7 support in Sage 9.7

24d7d6af87 Trac #31937: Update markupsafe to 2.1.1, jinja2 to 3.1.2

4aedae2596 Trac #29941: Modularization of sagelib: Break out separate packages sagemath-environment, sagemath-repl

70ec4e67ab Trac #25872: Modular decomposition bug

5fb2a6ea44 Updated [SageMath](SageMath) version to 9.7.beta1



merge was not clean: conflicts in build/pkgs/mathjax/SPKG.rst


---

Comment by git created at 2022-05-27 19:53:25

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-05-27 19:53:55

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-05-29 11:28:55

Resolution: fixed
