# Issue 15186: Add auto-rebasing mechanism for Cygwin

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2013-11-15 14:47:12

CC:  kcrisman dimpase jdemeyer jpflori tscrim

With Sage 5.12 (plus a few updated spkg, all of them available on trac), building Sage on Cygwin(32) is no harder than on Linux except for the need of rebasing a few times during the build process.
This could be automated in the following way
* try to build
* if that fails and we're on Cygwin,
* grep the failing logs for error messages cuased by fork issues
* if all erros are caused by fork issues:
 * rebase (using the oblivious option which can be run from bash, I think the script we included some time ago are ok),
 * go back to step one
* if not fails as usual

Having this would open the way to a buildbot or a patchbot for Cygwin.


---

Comment by embray created at 2017-04-13 10:25:09

I've found it simpler (and I have a patch) to just always rebase after every package build.  It doesn't actually add much noticeable overhead.  One thing I might want to do before pushing my patch is also make it so the `--quiet` flag can be passed through to rebase, since otherwise this sometimes generates a bit of noise that isn't helpful.

I would say this is almost necessary for Cygwin builds; especially in an automated context like running the patchbot.


---

Comment by embray created at 2017-04-13 10:25:09

Set assignee to embray.


---

Comment by embray created at 2017-04-21 12:23:02

Changing priority from major to blocker.


---

Comment by embray created at 2017-05-05 14:08:38

New method for rebasing DLLs continuously during Sage build, which should solve this issue.  I've updated the ticket description to explain exactly what this does and why, but I left the old description just for comparison.
----
New commits:


---

Comment by embray created at 2017-05-05 14:08:38

Changing status from new to needs_review.


---

Comment by git created at 2017-05-05 14:16:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2017-05-05 14:18:06

Changing status from needs_review to needs_work.


---

Comment by embray created at 2017-05-05 14:18:06

Looks like that last commit has a merge conflict.


---

Comment by git created at 2017-05-05 14:20:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-05-05 14:20:38

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2017-05-17 09:15:19

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2017-05-17 09:15:19

LGTM


---

Comment by jdemeyer created at 2017-05-17 11:28:19

In `src/Makefile.in`, is this really needed for the rebase script to work?

```
    (cd $(srcdir)                                       \
     && export SAGE_ROOT=/doesnotexist                          \
           SAGE_SRC=/doesnotexist                           \
           SAGE_SRC_ROOT=/doesnotexist                          \
           SAGE_DOC_SRC=/doesnotexist                           \
           SAGE_BUILD_DIR=/doesnotexist                         \
           SAGE_PKGS=$(abs_top_srcdir)/build/pkgs                   \
           SAGE_CYTHONIZED=$(abs_builddir)/build/cythonized             \
```


If not, it would be cleaner to write the rebase script on a new line instead of continuing with `&&`.

Minor comment which you might as well fix: you don't need the parentheses `(cd ... && ...)`. Those just create an extra subprocess for no reason.


---

Comment by jdemeyer created at 2017-05-17 11:28:19

Changing status from positive_review to needs_info.


---

Comment by jpflori created at 2017-05-17 12:15:30

Nah the rebase script does only care about SAGE_LOCAL.


---

Comment by jdemeyer created at 2017-05-18 07:24:48

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2017-05-18 07:24:48

New commits:


---

Comment by jpflori created at 2017-05-18 08:10:34

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2017-05-18 08:10:34

Ok, let's go with jeroen solution.


---

Comment by embray created at 2017-05-18 08:44:10

You're right, this is fine.


---

Comment by vbraun created at 2017-05-20 20:07:57

Resolution: fixed
