# Issue 23139: Equality testing of genera of quadratic forms over ZZ changes the genus and produces false results

archive/issues_023139.json:
```json
{
    "body": "Keywords: Genus\n\nsage: D4=QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))\nsage: G=D4.global_genus_symbol()\nsage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)\nTrue\nsage: G==copy(G)\nTrue\nsage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)\nFalse\n\nThe reason is that various functions unintentionally modify their input.\nSince a genus consists of lists containing lists, functions do just copy the lists but not deepcopy. \n\nFor example \nsage.quadratic_forms.genera.genus.canonical_2_adic_reduction\n\nmodifies its input which does not seem to be intended.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23376\n\n",
    "created_at": "2017-07-06T07:21:37Z",
    "labels": [
        "quadratic forms",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Equality testing of genera of quadratic forms over ZZ changes the genus and produces false results",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23139",
    "user": "sbrandhorst"
}
```
Keywords: Genus

sage: D4=QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))
sage: G=D4.global_genus_symbol()
sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
True
sage: G==copy(G)
True
sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
False

The reason is that various functions unintentionally modify their input.
Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy. 

For example 
sage.quadratic_forms.genera.genus.canonical_2_adic_reduction

modifies its input which does not seem to be intended.

Issue created by migration from https://trac.sagemath.org/ticket/23376





---

archive/issue_comments_323658.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-07-07T14:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323658",
    "user": "sbrandhorst"
}
```

New commits:



---

archive/issue_comments_323659.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-07T14:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323659",
    "user": "sbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_323660.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-08T22:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323660",
    "user": "sbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_323661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-10T06:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323661",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323662.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-10T07:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323662",
    "user": "sbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_323663.json:
```json
{
    "body": "(reformatting)",
    "created_at": "2017-07-13T17:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323663",
    "user": "vdelecroix"
}
```

(reformatting)



---

archive/issue_comments_323664.json:
```json
{
    "body": "Changing keywords from \"Genus\" to \"Genus,sd87\".",
    "created_at": "2017-07-18T18:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323664",
    "user": "sbrandhorst"
}
```

Changing keywords from "Genus" to "Genus,sd87".



---

archive/issue_comments_323665.json:
```json
{
    "body": "Changing keywords from \"Genus,sd87\" to \"Genus,sd91\".",
    "created_at": "2017-08-17T13:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323665",
    "user": "sbrandhorst"
}
```

Changing keywords from "Genus,sd87" to "Genus,sd91".



---

archive/issue_comments_323666.json:
```json
{
    "body": "Changing keywords from \"Genus,sd91\" to \"sd87, Genus, sd91\".",
    "created_at": "2017-09-04T20:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323666",
    "user": "edgarcosta"
}
```

Changing keywords from "Genus,sd91" to "sd87, Genus, sd91".



---

archive/issue_comments_323667.json:
```json
{
    "body": "You should leave the sd87 keyword there.",
    "created_at": "2017-09-04T20:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323667",
    "user": "edgarcosta"
}
```

You should leave the sd87 keyword there.



---

archive/issue_comments_323668.json:
```json
{
    "body": "Doesn't follow the doctest conventions; needs empty line after TESTS::",
    "created_at": "2017-09-30T17:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323668",
    "user": "jensberg"
}
```

Doesn't follow the doctest conventions; needs empty line after TESTS::



---

archive/issue_comments_323669.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-30T17:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323669",
    "user": "jensberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_323670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T17:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323671.json:
```json
{
    "body": "Fix looks good now.  Passes all doc tests and documentation builds.",
    "created_at": "2017-09-30T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323671",
    "user": "avarilly"
}
```

Fix looks good now.  Passes all doc tests and documentation builds.



---

archive/issue_comments_323672.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-09-30T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323672",
    "user": "avarilly"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_323673.json:
```json
{
    "body": "Reviewer name is missing...",
    "created_at": "2017-10-03T18:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323673",
    "user": "vbraun"
}
```

Reviewer name is missing...



---

archive/issue_comments_323674.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-03T18:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323674",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_323675.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-03T18:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323675",
    "user": "jensberg"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_323676.json:
```json
{
    "body": "Added reviewer names.",
    "created_at": "2017-10-03T18:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323676",
    "user": "jensberg"
}
```

Added reviewer names.



---

archive/issue_comments_323677.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-05T06:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23139#issuecomment-323677",
    "user": "vbraun"
}
```

Resolution: fixed
