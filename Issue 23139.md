# Issue 23139: Equality testing of genera of quadratic forms over ZZ changes the genus and produces false results

Issue created by migration from https://trac.sagemath.org/ticket/23376

Original creator: sbrandhorst

Original creation time: 2017-07-06 07:21:37

Keywords: Genus

sage: D4=QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))
sage: G=D4.global_genus_symbol()
sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
True
sage: G==copy(G)
True
sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
False

The reason is that various functions unintentionally modify their input.
Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy. 

For example 
sage.quadratic_forms.genera.genus.canonical_2_adic_reduction

modifies its input which does not seem to be intended.


---

Comment by sbrandhorst created at 2017-07-07 14:17:11

New commits:


---

Comment by sbrandhorst created at 2017-07-07 14:17:11

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2017-07-08 22:26:45

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-07-10 06:12:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-07-10 07:22:37

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2017-07-13 17:49:51

(reformatting)


---

Comment by sbrandhorst created at 2017-07-18 18:11:29

Changing keywords from "Genus" to "Genus,sd87".


---

Comment by sbrandhorst created at 2017-08-17 13:52:00

Changing keywords from "Genus,sd87" to "Genus,sd91".


---

Comment by edgarcosta created at 2017-09-04 20:07:23

Changing keywords from "Genus,sd91" to "sd87, Genus, sd91".


---

Comment by edgarcosta created at 2017-09-04 20:07:23

You should leave the sd87 keyword there.


---

Comment by jensberg created at 2017-09-30 17:22:25

Doesn't follow the doctest conventions; needs empty line after TESTS::


---

Comment by jensberg created at 2017-09-30 17:22:25

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-09-30 17:30:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by avarilly created at 2017-09-30 20:23:36

Fix looks good now.  Passes all doc tests and documentation builds.


---

Comment by avarilly created at 2017-09-30 20:23:36

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-10-03 18:34:47

Reviewer name is missing...


---

Comment by vbraun created at 2017-10-03 18:34:47

Changing status from positive_review to needs_work.


---

Comment by jensberg created at 2017-10-03 18:47:11

Changing status from needs_work to positive_review.


---

Comment by jensberg created at 2017-10-03 18:47:11

Added reviewer names.


---

Comment by vbraun created at 2017-10-05 06:54:12

Resolution: fixed
