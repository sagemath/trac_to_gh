# Issue 11184: Companion matrix constructor

archive/issues_011184.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  fidelbarrera\n\nThis will be used to construct the output of an upcoming rational canonical form.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11356\n\n",
    "created_at": "2011-05-20T04:08:32Z",
    "labels": [
        "linear algebra",
        "minor",
        "enhancement"
    ],
    "title": "Companion matrix constructor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11184",
    "user": "rbeezer"
}
```
Assignee: jason, was

CC:  fidelbarrera

This will be used to construct the output of an upcoming rational canonical form.

Issue created by migration from https://trac.sagemath.org/ticket/11356





---

archive/issue_comments_122914.json:
```json
{
    "body": "Attachment [trac_11356-companion-matrix.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix.patch) by rbeezer created at 2011-05-20 04:11:09",
    "created_at": "2011-05-20T04:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122914",
    "user": "rbeezer"
}
```

Attachment [trac_11356-companion-matrix.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix.patch) by rbeezer created at 2011-05-20 04:11:09



---

archive/issue_comments_122915.json:
```json
{
    "body": "Changing keywords from \"\" to \"beginner\".",
    "created_at": "2011-05-20T04:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122915",
    "user": "rbeezer"
}
```

Changing keywords from "" to "beginner".



---

archive/issue_comments_122916.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-20T04:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122916",
    "user": "rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_122917.json:
```json
{
    "body": "Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?",
    "created_at": "2011-05-23T18:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122917",
    "user": "jason"
}
```

Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?



---

archive/issue_comments_122918.json:
```json
{
    "body": "Reference: http://wiki.sagemath.org/magma#Miscpolyfunctions",
    "created_at": "2011-05-23T19:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122918",
    "user": "jason"
}
```

Reference: http://wiki.sagemath.org/magma#Miscpolyfunctions



---

archive/issue_comments_122919.json:
```json
{
    "body": "Replying to [comment:2 jason]:\n> Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?\n\nEverything I read about companion matrices and rational canonical form (Frobenius form) uses the \"right\" version.  It is the natural thing to use when you put your basis vectors into a matrix as columns, as is done with QR, Jordan form, and maybe others.\n\nSo I think \"right\" is the right default (pun intended), but \"bottom\" (and \"top\" and \"left\") are available for folks constructing less natural objects.",
    "created_at": "2011-05-24T17:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122919",
    "user": "rbeezer"
}
```

Replying to [comment:2 jason]:
> Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?

Everything I read about companion matrices and rational canonical form (Frobenius form) uses the "right" version.  It is the natural thing to use when you put your basis vectors into a matrix as columns, as is done with QR, Jordan form, and maybe others.

So I think "right" is the right default (pun intended), but "bottom" (and "top" and "left") are available for folks constructing less natural objects.



---

archive/issue_comments_122920.json:
```json
{
    "body": "Replying to [comment:4 rbeezer]:\n> Replying to [comment:2 jason]:\n> > Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?\n> \n> Everything I read about companion matrices and rational canonical form (Frobenius form) uses the \"right\" version.  It is the natural thing to use when you put your basis vectors into a matrix as columns, as is done with QR, Jordan form, and maybe others.\n\nYes, and my point is that since we follow the magma convention of putting basis vectors in rows, do we need to be consistent with their convention of format='bottom'?\nAnd yes, I've also always seen it with format='right' as well.",
    "created_at": "2011-05-24T17:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122920",
    "user": "jason"
}
```

Replying to [comment:4 rbeezer]:
> Replying to [comment:2 jason]:
> > Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?
> 
> Everything I read about companion matrices and rational canonical form (Frobenius form) uses the "right" version.  It is the natural thing to use when you put your basis vectors into a matrix as columns, as is done with QR, Jordan form, and maybe others.

Yes, and my point is that since we follow the magma convention of putting basis vectors in rows, do we need to be consistent with their convention of format='bottom'?
And yes, I've also always seen it with format='right' as well.



---

archive/issue_comments_122921.json:
```json
{
    "body": "Replying to [comment:5 jason]:\n\n> Yes, and my point is that since we follow the magma convention of putting basis vectors in rows, do we need to be consistent with their convention of format='bottom'?\n> And yes, I've also always seen it with format='right' as well.\n\nAnd my point is that \"follow the convention\" is stronger than the reality.  I like to say Sage has a \"preference\" for rows.  The RDF/CDF decompositions return basis vectors in columns, Jordan form returns basis vectors in columns and I'm sure I can find more.  So, if I can get a basis to convert to rational canonical form, then \"right\" will be the correct choice.  I think this is a place where consistency for other decompositions is to be preferred. \n\nBesides the overwhelming use of \"right\" in the literature.  I would rather not look oddball to newcomers, just to be consistent with a language with a miniscule audience.\n\nRob",
    "created_at": "2011-05-24T17:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122921",
    "user": "rbeezer"
}
```

Replying to [comment:5 jason]:

> Yes, and my point is that since we follow the magma convention of putting basis vectors in rows, do we need to be consistent with their convention of format='bottom'?
> And yes, I've also always seen it with format='right' as well.

And my point is that "follow the convention" is stronger than the reality.  I like to say Sage has a "preference" for rows.  The RDF/CDF decompositions return basis vectors in columns, Jordan form returns basis vectors in columns and I'm sure I can find more.  So, if I can get a basis to convert to rational canonical form, then "right" will be the correct choice.  I think this is a place where consistency for other decompositions is to be preferred. 

Besides the overwhelming use of "right" in the literature.  I would rather not look oddball to newcomers, just to be consistent with a language with a miniscule audience.

Rob



---

archive/issue_comments_122922.json:
```json
{
    "body": "Attachment [trac_11356-companion-matrix-v2.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix-v2.patch) by rbeezer created at 2011-06-12 03:51:17",
    "created_at": "2011-06-12T03:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122922",
    "user": "rbeezer"
}
```

Attachment [trac_11356-companion-matrix-v2.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix-v2.patch) by rbeezer created at 2011-06-12 03:51:17



---

archive/issue_comments_122923.json:
```json
{
    "body": "This needed rebasing, which is now the v2 patch.",
    "created_at": "2011-06-12T03:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122923",
    "user": "rbeezer"
}
```

This needed rebasing, which is now the v2 patch.



---

archive/issue_comments_122924.json:
```json
{
    "body": "Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:\n\n\n```\nsage: x = var('x'); sympoly = x^3 + 2*x + 5\nsage: parent(sympoly)\nSymbolic Ring\nsage: coefflist = [sympoly(x=0)] + [sympoly.coeff(x^k) for k in [1..sympoly.degree(x)]]; coefflist\n[5, 2, 0, 1]\nsage: companion_matrix(coefflist)\n...whatever...\n```\n\n\n(One might be tempted to use `.coeffs(x)`, but that leaves out zero coefficients.)",
    "created_at": "2011-06-17T17:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122924",
    "user": "ddrake"
}
```

Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:


```
sage: x = var('x'); sympoly = x^3 + 2*x + 5
sage: parent(sympoly)
Symbolic Ring
sage: coefflist = [sympoly(x=0)] + [sympoly.coeff(x^k) for k in [1..sympoly.degree(x)]]; coefflist
[5, 2, 0, 1]
sage: companion_matrix(coefflist)
...whatever...
```


(One might be tempted to use `.coeffs(x)`, but that leaves out zero coefficients.)



---

archive/issue_comments_122925.json:
```json
{
    "body": "Replying to [comment:8 ddrake]:\n> Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:\n\nExcellent idea.",
    "created_at": "2011-06-17T17:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122925",
    "user": "rbeezer"
}
```

Replying to [comment:8 ddrake]:
> Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:

Excellent idea.



---

archive/issue_comments_122926.json:
```json
{
    "body": "Changing keywords from \"beginner\" to \"beginner, sd31\".",
    "created_at": "2011-06-20T17:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122926",
    "user": "rbeezer"
}
```

Changing keywords from "beginner" to "beginner, sd31".



---

archive/issue_comments_122927.json:
```json
{
    "body": "Replying to [comment:8 ddrake]:\n> Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:\n\nDoctest section about symbolic polynomials has been expanded to reflect Dan's suggestion, and incorporated into a standalone v3 patch.  Thanks for the suggestion, Dan.",
    "created_at": "2011-06-20T17:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122927",
    "user": "rbeezer"
}
```

Replying to [comment:8 ddrake]:
> Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:

Doctest section about symbolic polynomials has been expanded to reflect Dan's suggestion, and incorporated into a standalone v3 patch.  Thanks for the suggestion, Dan.



---

archive/issue_comments_122928.json:
```json
{
    "body": "Replying to [comment:10 rbeezer]:\n> Doctest section about symbolic polynomials has been expanded to reflect Dan's suggestion, and incorporated into a standalone v3 patch.  Thanks for the suggestion, Dan.\n\nUh oh, your v2 and v3 patches seem identical...",
    "created_at": "2011-06-21T01:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122928",
    "user": "ddrake"
}
```

Replying to [comment:10 rbeezer]:
> Doctest section about symbolic polynomials has been expanded to reflect Dan's suggestion, and incorporated into a standalone v3 patch.  Thanks for the suggestion, Dan.

Uh oh, your v2 and v3 patches seem identical...



---

archive/issue_comments_122929.json:
```json
{
    "body": "Attachment [trac_11356-companion-matrix-v3.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix-v3.patch) by rbeezer created at 2011-06-21 02:52:11\n\nReplying to [comment:11 ddrake]:\n> Uh oh, your v2 and v3 patches seem identical...\n\nMust've forgotten an `hg qrefresh`.  Sorry for the hassle.\n\nReplaced the v3 patch with one that should be different than v2.  Thanks for the catch.",
    "created_at": "2011-06-21T02:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122929",
    "user": "rbeezer"
}
```

Attachment [trac_11356-companion-matrix-v3.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix-v3.patch) by rbeezer created at 2011-06-21 02:52:11

Replying to [comment:11 ddrake]:
> Uh oh, your v2 and v3 patches seem identical...

Must've forgotten an `hg qrefresh`.  Sorry for the hassle.

Replaced the v3 patch with one that should be different than v2.  Thanks for the catch.



---

archive/issue_comments_122930.json:
```json
{
    "body": "If you feed `companion_matrix` the empty list, it complains about an `IndexError`. I'd rather see it:\n\n* return the empty matrix, or\n* change line 2839 to `if n == 0 or or not poly[n] == 1:` so that the `ValueError` actually gets raised.\n\nReturning the empty matrix seems about right, but I can imagine people having strong opinions about the zero polynomial not being monic. I don't know about the conventions in this corner case, so do whatever seems best.",
    "created_at": "2011-06-22T22:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122930",
    "user": "ddrake"
}
```

If you feed `companion_matrix` the empty list, it complains about an `IndexError`. I'd rather see it:

* return the empty matrix, or
* change line 2839 to `if n == 0 or or not poly[n] == 1:` so that the `ValueError` actually gets raised.

Returning the empty matrix seems about right, but I can imagine people having strong opinions about the zero polynomial not being monic. I don't know about the conventions in this corner case, so do whatever seems best.



---

archive/issue_comments_122931.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-22T22:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122931",
    "user": "ddrake"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_122932.json:
```json
{
    "body": "Attachment [trac_11356-companion-matrix-v4.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix-v4.patch) by rbeezer created at 2011-06-22 23:27:37\n\nReplying to [comment:13 ddrake]:\n\nThanks, Dan.\n\nSeems like an input list of `[1]` should be a monic polynomial that creates an empty matrix.  Code does that before latest patch and a test of this has been added in the v4 patch.\n\nSo I made an input empty list fail in the v4 patch and added a test.  In this case, `n = -1`, so various existing array references will fail, thus requiring its own error message.  I tried to build an \"empty polynomial\" from an empty list, but just got the zero polynomial.  So I think an empty list is the only danger, thus the error message reads this way.",
    "created_at": "2011-06-22T23:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122932",
    "user": "rbeezer"
}
```

Attachment [trac_11356-companion-matrix-v4.patch](tarball://root/attachments/some-uuid/ticket11356/trac_11356-companion-matrix-v4.patch) by rbeezer created at 2011-06-22 23:27:37

Replying to [comment:13 ddrake]:

Thanks, Dan.

Seems like an input list of `[1]` should be a monic polynomial that creates an empty matrix.  Code does that before latest patch and a test of this has been added in the v4 patch.

So I made an input empty list fail in the v4 patch and added a test.  In this case, `n = -1`, so various existing array references will fail, thus requiring its own error message.  I tried to build an "empty polynomial" from an empty list, but just got the zero polynomial.  So I think an empty list is the only danger, thus the error message reads this way.



---

archive/issue_comments_122933.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-11T23:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122933",
    "user": "rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_122934.json:
```json
{
    "body": "Forgot to set this as \"needs review\" when I put up the v4 patch.",
    "created_at": "2011-07-11T23:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122934",
    "user": "rbeezer"
}
```

Forgot to set this as "needs review" when I put up the v4 patch.



---

archive/issue_comments_122935.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-19T19:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122935",
    "user": "davidloeffler"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_122936.json:
```json
{
    "body": "This looks great -- code is very clear and thorough with full documentation and tests, all of which pass. Positive review.",
    "created_at": "2011-07-19T19:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122936",
    "user": "davidloeffler"
}
```

This looks great -- code is very clear and thorough with full documentation and tests, all of which pass. Positive review.



---

archive/issue_comments_122937.json:
```json
{
    "body": "Replying to [comment:16 davidloeffler]:\n\nThanks, David, for taking the time to look at this. -Rob",
    "created_at": "2011-07-19T21:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122937",
    "user": "rbeezer"
}
```

Replying to [comment:16 davidloeffler]:

Thanks, David, for taking the time to look at this. -Rob



---

archive/issue_comments_122938.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-28T10:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11184#issuecomment-122938",
    "user": "jdemeyer"
}
```

Resolution: fixed
