# Issue 11184: Companion matrix constructor

Issue created by migration from Trac.

Original creator: rbeezer

Original creation time: 2011-05-20 04:08:32

Assignee: jason, was

CC:  fidelbarrera

This will be used to construct the output of an upcoming rational canonical form.


---

Attachment


---

Comment by rbeezer created at 2011-05-20 04:13:13

Changing keywords from "" to "beginner".


---

Comment by rbeezer created at 2011-05-20 04:13:13

Changing status from new to needs_review.


---

Comment by jason created at 2011-05-23 18:59:51

Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?


---

Comment by jason created at 2011-05-23 19:00:03

Reference: http://wiki.sagemath.org/magma#Miscpolyfunctions


---

Comment by rbeezer created at 2011-05-24 17:09:25

Replying to [comment:2 jason]:
> Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?

Everything I read about companion matrices and rational canonical form (Frobenius form) uses the "right" version.  It is the natural thing to use when you put your basis vectors into a matrix as columns, as is done with QR, Jordan form, and maybe others.

So I think "right" is the right default (pun intended), but "bottom" (and "top" and "left") are available for folks constructing less natural objects.


---

Comment by jason created at 2011-05-24 17:26:36

Replying to [comment:4 rbeezer]:
> Replying to [comment:2 jason]:
> > Note that Magma defaults to `format='bottom'`, I think.  Is there any consistency issues with us defaulting to `format='right'`, given that we follow the Magma convention of row vectors?
> 
> Everything I read about companion matrices and rational canonical form (Frobenius form) uses the "right" version.  It is the natural thing to use when you put your basis vectors into a matrix as columns, as is done with QR, Jordan form, and maybe others.

Yes, and my point is that since we follow the magma convention of putting basis vectors in rows, do we need to be consistent with their convention of format='bottom'?
And yes, I've also always seen it with format='right' as well.


---

Comment by rbeezer created at 2011-05-24 17:41:56

Replying to [comment:5 jason]:

> Yes, and my point is that since we follow the magma convention of putting basis vectors in rows, do we need to be consistent with their convention of format='bottom'?
> And yes, I've also always seen it with format='right' as well.

And my point is that "follow the convention" is stronger than the reality.  I like to say Sage has a "preference" for rows.  The RDF/CDF decompositions return basis vectors in columns, Jordan form returns basis vectors in columns and I'm sure I can find more.  So, if I can get a basis to convert to rational canonical form, then "right" will be the correct choice.  I think this is a place where consistency for other decompositions is to be preferred. 

Besides the overwhelming use of "right" in the literature.  I would rather not look oddball to newcomers, just to be consistent with a language with a miniscule audience.

Rob


---

Attachment


---

Comment by rbeezer created at 2011-06-12 03:52:28

This needed rebasing, which is now the v2 patch.


---

Comment by ddrake created at 2011-06-17 17:33:02

Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:


```
sage: x = var('x'); sympoly = x^3 + 2*x + 5
sage: parent(sympoly)
Symbolic Ring
sage: coefflist = [sympoly(x=0)] + [sympoly.coeff(x^k) for k in [1..sympoly.degree(x)]]; coefflist
[5, 2, 0, 1]
sage: companion_matrix(coefflist)
...whatever...
```


(One might be tempted to use `.coeffs(x)`, but that leaves out zero coefficients.)


---

Comment by rbeezer created at 2011-06-17 17:40:37

Replying to [comment:8 ddrake]:
> Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:

Excellent idea.


---

Comment by rbeezer created at 2011-06-20 17:40:50

Changing keywords from "beginner" to "beginner, sd31".


---

Comment by rbeezer created at 2011-06-20 17:40:50

Replying to [comment:8 ddrake]:
> Perhaps you should add a little suggestion for converting a symbolic polynomial to the kind of list this function needs; something like:

Doctest section about symbolic polynomials has been expanded to reflect Dan's suggestion, and incorporated into a standalone v3 patch.  Thanks for the suggestion, Dan.


---

Comment by ddrake created at 2011-06-21 01:52:58

Replying to [comment:10 rbeezer]:
> Doctest section about symbolic polynomials has been expanded to reflect Dan's suggestion, and incorporated into a standalone v3 patch.  Thanks for the suggestion, Dan.

Uh oh, your v2 and v3 patches seem identical...


---

Attachment

Replying to [comment:11 ddrake]:
> Uh oh, your v2 and v3 patches seem identical...

Must've forgotten an `hg qrefresh`.  Sorry for the hassle.

Replaced the v3 patch with one that should be different than v2.  Thanks for the catch.


---

Comment by ddrake created at 2011-06-22 22:44:06

If you feed `companion_matrix` the empty list, it complains about an `IndexError`. I'd rather see it:

  * return the empty matrix, or
  * change line 2839 to `if n == 0 or or not poly[n] == 1:` so that the `ValueError` actually gets raised.

Returning the empty matrix seems about right, but I can imagine people having strong opinions about the zero polynomial not being monic. I don't know about the conventions in this corner case, so do whatever seems best.


---

Comment by ddrake created at 2011-06-22 22:44:06

Changing status from needs_review to needs_work.


---

Attachment

Replying to [comment:13 ddrake]:

Thanks, Dan.

Seems like an input list of `[1]` should be a monic polynomial that creates an empty matrix.  Code does that before latest patch and a test of this has been added in the v4 patch.

So I made an input empty list fail in the v4 patch and added a test.  In this case, `n = -1`, so various existing array references will fail, thus requiring its own error message.  I tried to build an "empty polynomial" from an empty list, but just got the zero polynomial.  So I think an empty list is the only danger, thus the error message reads this way.


---

Comment by rbeezer created at 2011-07-11 23:21:31

Changing status from needs_work to needs_review.


---

Comment by rbeezer created at 2011-07-11 23:21:31

Forgot to set this as "needs review" when I put up the v4 patch.


---

Comment by davidloeffler created at 2011-07-19 19:27:24

Changing status from needs_review to positive_review.


---

Comment by davidloeffler created at 2011-07-19 19:27:24

This looks great -- code is very clear and thorough with full documentation and tests, all of which pass. Positive review.


---

Comment by rbeezer created at 2011-07-19 21:13:45

Replying to [comment:16 davidloeffler]:

Thanks, David, for taking the time to look at this. -Rob


---

Comment by jdemeyer created at 2011-07-28 10:25:01

Resolution: fixed
