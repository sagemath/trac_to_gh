# Issue 31588: Failure when testing sage_conf version

Issue created by migration from https://trac.sagemath.org/ticket/31825

Original creator: vbraun

Original creation time: 2021-05-13 11:01:14

CC:  jhpalmieri dimpase slelievre

I don't know why its important that sage_conf version is 'none', but it sometimes fails with the actual version number after doing some incremental builds:

```
sage -t --long --warn-long 46.6 --random-seed=0 src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 359, in sage.misc.package.installed_packages
Failed example:
    installed_packages()['sage_conf']  # optional - build
Expected:
    'none'
Got:
    '9.3'
**********************************************************************
```



---

Comment by mkoeppe created at 2021-05-13 15:24:43

This test is changed in #29013.


---

Comment by mkoeppe created at 2021-05-13 15:24:43

Changing status from new to needs_review.


---

Comment by vbraun created at 2021-05-24 10:17:11

Wrong ticket? the test doesn't appear to be changed in #29013 & failure persists with it


---

Comment by mkoeppe created at 2021-05-24 17:51:53

Sorry for the confusion. The version for `sage_conf` was introduced in #30913, and the fix of the doctest appears in #31577. I am going to cherry-pick from there.


---

Comment by mkoeppe created at 2021-05-24 17:51:53

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-05-24 18:03:42

Last 10 new commits:


---

Comment by mkoeppe created at 2021-05-24 18:03:42

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2021-05-27 11:10:44

lgtm


---

Comment by dimpase created at 2021-05-27 11:10:44

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-05-27 16:31:53

Thanks!


---

Comment by vbraun created at 2021-06-06 13:16:45

Resolution: fixed


---

Comment by chapoton created at 2021-06-07 06:11:16

now we have

```
sage -t --long --random-seed=0 src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 359, in sage.misc.package.installed_packages
Failed example:
    installed_packages()['sage_conf'] == sage.env.SAGE_VERSION # optional - build
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   4 in sage.misc.package.installed_packages
    [52 tests, 1 failure, 3.07 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/misc/package.py  # 1 doctest failed
```



---

Comment by vbraun created at 2021-06-07 21:37:22

I think thats whenever you do an incremental build over a Sage version release. Followup at #31928
