# Issue 15239: Involutions on NSym and QSym part I

archive/issues_015239.json:
```json
{
    "body": "CC:  @tscrim sage-combinat @zabrocki @vbraun\n\nKeywords: ncsf, nsym, qsym, sage-combinat, symmetric functions, compositions\n\nThis got much longer than I expected it to be because there are three \"classical\" involution on each of NSym and QSym and each can be computed on various bases. I ended up implementing only two of the involutions (star=rho and psi), leaving out omega (which is just a rescaled antipode) for part II.\n\nThe patch also fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?\n\nIssue created by migration from https://trac.sagemath.org/ticket/15476\n\n",
    "created_at": "2013-12-01T06:55:48Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Involutions on NSym and QSym part I",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15239",
    "user": "https://github.com/darijgr"
}
```
CC:  @tscrim sage-combinat @zabrocki @vbraun

Keywords: ncsf, nsym, qsym, sage-combinat, symmetric functions, compositions

This got much longer than I expected it to be because there are three "classical" involution on each of NSym and QSym and each can be computed on various bases. I ended up implementing only two of the involutions (star=rho and psi), leaving out omega (which is just a rescaled antipode) for part II.

The patch also fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?

Issue created by migration from https://trac.sagemath.org/ticket/15476





---

archive/issue_comments_195617.json:
```json
{
    "body": "Attachment [trac_15476-NSym-QSym-invols-1-dg.patch](tarball://root/attachments/some-uuid/ticket15476/trac_15476-NSym-QSym-invols-1-dg.patch) by @darijgr created at 2013-12-01 06:56:57",
    "created_at": "2013-12-01T06:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195617",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_15476-NSym-QSym-invols-1-dg.patch](tarball://root/attachments/some-uuid/ticket15476/trac_15476-NSym-QSym-invols-1-dg.patch) by @darijgr created at 2013-12-01 06:56:57



---

archive/issue_comments_195618.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-01T06:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195618",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195619.json:
```json
{
    "body": "Hey Darij,\n\nHere's the patch converted to a branch, along with some additional changes of mine which should net some (perhaps small) speedups (I didn't run any benchmarks, but attribute lookup is suppose to be faster than function calls). Specifically I changed `Compositions()(spam)` to `self._basis_keys(spam)` where appropriate. If you're happy with my changes, then you can set this to positive review.\n\nBest,\n\nTravis\n----\nNew commits:",
    "created_at": "2013-12-16T17:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195619",
    "user": "https://github.com/tscrim"
}
```

Hey Darij,

Here's the patch converted to a branch, along with some additional changes of mine which should net some (perhaps small) speedups (I didn't run any benchmarks, but attribute lookup is suppose to be faster than function calls). Specifically I changed `Compositions()(spam)` to `self._basis_keys(spam)` where appropriate. If you're happy with my changes, then you can set this to positive review.

Best,

Travis
----
New commits:



---

archive/issue_comments_195620.json:
```json
{
    "body": "Hi Travis,\n\nthanks a lot! I don't have git-sage running on this machine and I haven't had time to check all of your changes so far, but I can confirm that `_basis_keys` is the right way to go here. BUT please don't use `Composition([])`:\n\n```\nsage: %timeit S._basis_keys([])\n100000 loops, best of 3: 6.38 us per loop\nsage: %timeit Compositions()([])\n100000 loops, best of 3: 9 us per loop\nsage: %timeit Composition([])\n100000 loops, best of 3: 11 us per loop\n```\n\nGenerally, `Composition(something)` does some slow and dirty ducktyping and should be avoided whenever possible in code.",
    "created_at": "2013-12-16T17:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195620",
    "user": "https://github.com/darijgr"
}
```

Hi Travis,

thanks a lot! I don't have git-sage running on this machine and I haven't had time to check all of your changes so far, but I can confirm that `_basis_keys` is the right way to go here. BUT please don't use `Composition([])`:

```
sage: %timeit S._basis_keys([])
100000 loops, best of 3: 6.38 us per loop
sage: %timeit Compositions()([])
100000 loops, best of 3: 9 us per loop
sage: %timeit Composition([])
100000 loops, best of 3: 11 us per loop
```

Generally, `Composition(something)` does some slow and dirty ducktyping and should be avoided whenever possible in code.



---

archive/issue_comments_195621.json:
```json
{
    "body": "It's only used once and then the result is cached, and it's more readable. I don't have a strong opinion and will be happy to change it back.",
    "created_at": "2013-12-16T18:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195621",
    "user": "https://github.com/tscrim"
}
```

It's only used once and then the result is cached, and it's more readable. I don't have a strong opinion and will be happy to change it back.



---

archive/issue_comments_195622.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-17T02:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195622",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-17T02:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195624.json:
```json
{
    "body": "If you are fine with my added changes, feel free to set this to positive.\n\nThanks again for reviewing this undeservedly long patch...",
    "created_at": "2013-12-17T02:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195624",
    "user": "https://github.com/darijgr"
}
```

If you are fine with my added changes, feel free to set this to positive.

Thanks again for reviewing this undeservedly long patch...



---

archive/issue_comments_195625.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2013-12-17T06:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195625",
    "user": "https://github.com/tscrim"
}
```

Looks good to me.



---

archive/issue_comments_195626.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-17T06:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195626",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_045148.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15239#event-45148"
}
```



---

archive/issue_events_045149.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-02T22:07:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15239#event-45149"
}
```



---

archive/issue_comments_195627.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-02T22:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15239#issuecomment-195627",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
