# Issue 10652: Rows of a zero-row sparse matrix are incorrect

Issue created by migration from https://trac.sagemath.org/ticket/10714

Original creator: rbeezer

Original creation time: 2011-01-29 23:33:48

Assignee: jason, was

Row vectors from a sparse matrix are incorrect when the matrix has zero rows.


```
sage: D = matrix(0, 2, sparse=False)
sage: D.parent()
Full MatrixSpace of 0 by 2 dense matrices over Integer Ring
sage: D.nrows()
0
sage: D.rows()
[]
sage: S = matrix(0, 2, sparse=True)
sage: S.parent()
Full MatrixSpace of 0 by 2 sparse matrices over Integer Ring
sage: S.nrows()
0
sage: S.rows()
[(0, 0)]
```


`sage/matrix/matrix1.Matrix.sparse_rows()` is the place to look.


---

Comment by jason created at 2011-01-30 00:48:28

Good catch!  The rows returned should probably be sparse vectors too.


---

Comment by was created at 2011-01-30 03:23:15

Replying to [comment:1 jason]:
> Good catch!  The rows returned should probably be sparse vectors too.

It seems to me like they are sparse vectors.  


```
sage: S = matrix(0, 2, sparse=True)
sage: v = S.rows()[0]
sage: type(v)
<type 'sage.modules.free_module_element.FreeModuleElement_generic_sparse'>
sage: v.is_sparse()
True
```



---

Comment by jason created at 2011-01-30 03:33:29

Replying to [comment:2 was]:
> Replying to [comment:1 jason]:
> > Good catch!  The rows returned should probably be sparse vectors too.
> 
> It seems to me like they are sparse vectors.  
> 
> {{{
> sage: S = matrix(0, 2, sparse=True)
> sage: v = S.rows()[0]
> sage: type(v)
> <type 'sage.modules.free_module_element.FreeModuleElement_generic_sparse'>
> sage: v.is_sparse()
> True
> }}}

Great.


---

Comment by rbeezer created at 2011-01-30 03:42:24

Changing status from new to needs_review.


---

Attachment

The problem seems to be the `append()` at the outer level in the "finish up" stanza.

Patch just short-circuits when there are no rows and returns an empty list before anything happens to it.  Passes all tests on 4.6.2.alpha2.


---

Comment by rbeezer created at 2011-01-30 03:45:55

Replying to [comment:2 was]:
> It seems to me like they are sparse vectors.  

Correct.  Returned vectors have their entries specified by dictionaries when created, so they default to sparse.


---

Comment by rbeezer created at 2011-02-02 20:10:08

Changing status from needs_review to needs_work.


---

Comment by rbeezer created at 2011-02-02 20:10:08

Should have checked this sooner.  Columns behave poorly as well.  I'll work up a companion patch.


```
sage: A = matrix(2,0,[[],[]], sparse=True)
sage: A.parent()
Full MatrixSpace of 2 by 0 sparse matrices over Integer Ring
sage: A.columns()
[(0, 0)]
```



---

Comment by rbeezer created at 2011-02-03 18:21:48

Isomorphic fix for columns in second patch, but apply in the order: rows first, then columns.  Which seems appropriate.


---

Comment by rbeezer created at 2011-02-03 18:21:48

Changing status from needs_work to needs_review.


---

Comment by jason created at 2011-02-05 22:34:15

Looks great!  Thanks for your work on this!


---

Comment by jason created at 2011-02-05 22:34:15

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-02-08 08:51:08

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-02-08 08:51:08

Please change the commit message of the second patch.


---

Attachment


---

Comment by rbeezer created at 2011-02-08 17:55:47

Changing status from needs_work to positive_review.


---

Comment by rbeezer created at 2011-02-08 17:55:47

Commit message fixed - sorry about that.

Fixed patch replaces the old one, so apply "rows," then "columns."


---

Comment by jdemeyer created at 2011-02-16 08:50:29

Resolution: fixed
