# Issue 10652: Rows of a zero-row sparse matrix are incorrect

archive/issues_010652.json:
```json
{
    "body": "Assignee: jason, was\n\nRow vectors from a sparse matrix are incorrect when the matrix has zero rows.\n\n\n```\nsage: D = matrix(0, 2, sparse=False)\nsage: D.parent()\nFull MatrixSpace of 0 by 2 dense matrices over Integer Ring\nsage: D.nrows()\n0\nsage: D.rows()\n[]\nsage: S = matrix(0, 2, sparse=True)\nsage: S.parent()\nFull MatrixSpace of 0 by 2 sparse matrices over Integer Ring\nsage: S.nrows()\n0\nsage: S.rows()\n[(0, 0)]\n```\n\n\n`sage/matrix/matrix1.Matrix.sparse_rows()` is the place to look.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10714\n\n",
    "created_at": "2011-01-29T23:33:48Z",
    "labels": [
        "linear algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Rows of a zero-row sparse matrix are incorrect",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10652",
    "user": "@rbeezer"
}
```
Assignee: jason, was

Row vectors from a sparse matrix are incorrect when the matrix has zero rows.


```
sage: D = matrix(0, 2, sparse=False)
sage: D.parent()
Full MatrixSpace of 0 by 2 dense matrices over Integer Ring
sage: D.nrows()
0
sage: D.rows()
[]
sage: S = matrix(0, 2, sparse=True)
sage: S.parent()
Full MatrixSpace of 0 by 2 sparse matrices over Integer Ring
sage: S.nrows()
0
sage: S.rows()
[(0, 0)]
```


`sage/matrix/matrix1.Matrix.sparse_rows()` is the place to look.

Issue created by migration from https://trac.sagemath.org/ticket/10714





---

archive/issue_comments_111795.json:
```json
{
    "body": "Good catch!  The rows returned should probably be sparse vectors too.",
    "created_at": "2011-01-30T00:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111795",
    "user": "@jasongrout"
}
```

Good catch!  The rows returned should probably be sparse vectors too.



---

archive/issue_comments_111796.json:
```json
{
    "body": "Replying to [comment:1 jason]:\n> Good catch!  The rows returned should probably be sparse vectors too.\n\nIt seems to me like they are sparse vectors.  \n\n\n```\nsage: S = matrix(0, 2, sparse=True)\nsage: v = S.rows()[0]\nsage: type(v)\n<type 'sage.modules.free_module_element.FreeModuleElement_generic_sparse'>\nsage: v.is_sparse()\nTrue\n```\n",
    "created_at": "2011-01-30T03:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111796",
    "user": "@williamstein"
}
```

Replying to [comment:1 jason]:
> Good catch!  The rows returned should probably be sparse vectors too.

It seems to me like they are sparse vectors.  


```
sage: S = matrix(0, 2, sparse=True)
sage: v = S.rows()[0]
sage: type(v)
<type 'sage.modules.free_module_element.FreeModuleElement_generic_sparse'>
sage: v.is_sparse()
True
```




---

archive/issue_comments_111797.json:
```json
{
    "body": "Replying to [comment:2 was]:\n> Replying to [comment:1 jason]:\n> > Good catch!  The rows returned should probably be sparse vectors too.\n> \n> It seems to me like they are sparse vectors.  \n> \n> {{{\n> sage: S = matrix(0, 2, sparse=True)\n> sage: v = S.rows()[0]\n> sage: type(v)\n> <type 'sage.modules.free_module_element.FreeModuleElement_generic_sparse'>\n> sage: v.is_sparse()\n> True\n> }}}\n\nGreat.",
    "created_at": "2011-01-30T03:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111797",
    "user": "@jasongrout"
}
```

Replying to [comment:2 was]:
> Replying to [comment:1 jason]:
> > Good catch!  The rows returned should probably be sparse vectors too.
> 
> It seems to me like they are sparse vectors.  
> 
> {{{
> sage: S = matrix(0, 2, sparse=True)
> sage: v = S.rows()[0]
> sage: type(v)
> <type 'sage.modules.free_module_element.FreeModuleElement_generic_sparse'>
> sage: v.is_sparse()
> True
> }}}

Great.



---

archive/issue_comments_111798.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-30T03:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111798",
    "user": "@rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111799.json:
```json
{
    "body": "Attachment [trac_10714-rows-sparse-matrices.patch](tarball://root/attachments/some-uuid/ticket10714/trac_10714-rows-sparse-matrices.patch) by @rbeezer created at 2011-01-30 03:42:24\n\nThe problem seems to be the `append()` at the outer level in the \"finish up\" stanza.\n\nPatch just short-circuits when there are no rows and returns an empty list before anything happens to it.  Passes all tests on 4.6.2.alpha2.",
    "created_at": "2011-01-30T03:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111799",
    "user": "@rbeezer"
}
```

Attachment [trac_10714-rows-sparse-matrices.patch](tarball://root/attachments/some-uuid/ticket10714/trac_10714-rows-sparse-matrices.patch) by @rbeezer created at 2011-01-30 03:42:24

The problem seems to be the `append()` at the outer level in the "finish up" stanza.

Patch just short-circuits when there are no rows and returns an empty list before anything happens to it.  Passes all tests on 4.6.2.alpha2.



---

archive/issue_comments_111800.json:
```json
{
    "body": "Replying to [comment:2 was]:\n> It seems to me like they are sparse vectors.  \n\nCorrect.  Returned vectors have their entries specified by dictionaries when created, so they default to sparse.",
    "created_at": "2011-01-30T03:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111800",
    "user": "@rbeezer"
}
```

Replying to [comment:2 was]:
> It seems to me like they are sparse vectors.  

Correct.  Returned vectors have their entries specified by dictionaries when created, so they default to sparse.



---

archive/issue_comments_111801.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-02T20:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111801",
    "user": "@rbeezer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111802.json:
```json
{
    "body": "Should have checked this sooner.  Columns behave poorly as well.  I'll work up a companion patch.\n\n\n```\nsage: A = matrix(2,0,[[],[]], sparse=True)\nsage: A.parent()\nFull MatrixSpace of 2 by 0 sparse matrices over Integer Ring\nsage: A.columns()\n[(0, 0)]\n```\n",
    "created_at": "2011-02-02T20:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111802",
    "user": "@rbeezer"
}
```

Should have checked this sooner.  Columns behave poorly as well.  I'll work up a companion patch.


```
sage: A = matrix(2,0,[[],[]], sparse=True)
sage: A.parent()
Full MatrixSpace of 2 by 0 sparse matrices over Integer Ring
sage: A.columns()
[(0, 0)]
```




---

archive/issue_comments_111803.json:
```json
{
    "body": "Isomorphic fix for columns in second patch, but apply in the order: rows first, then columns.  Which seems appropriate.",
    "created_at": "2011-02-03T18:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111803",
    "user": "@rbeezer"
}
```

Isomorphic fix for columns in second patch, but apply in the order: rows first, then columns.  Which seems appropriate.



---

archive/issue_comments_111804.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-03T18:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111804",
    "user": "@rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111805.json:
```json
{
    "body": "Looks great!  Thanks for your work on this!",
    "created_at": "2011-02-05T22:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111805",
    "user": "@jasongrout"
}
```

Looks great!  Thanks for your work on this!



---

archive/issue_comments_111806.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-05T22:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111806",
    "user": "@jasongrout"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111807.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-02-08T08:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111807",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_111808.json:
```json
{
    "body": "Please change the commit message of the second patch.",
    "created_at": "2011-02-08T08:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111808",
    "user": "@jdemeyer"
}
```

Please change the commit message of the second patch.



---

archive/issue_comments_111809.json:
```json
{
    "body": "Attachment [trac_10714-columns-sparse-matrices.patch](tarball://root/attachments/some-uuid/ticket10714/trac_10714-columns-sparse-matrices.patch) by @rbeezer created at 2011-02-08 17:53:29",
    "created_at": "2011-02-08T17:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111809",
    "user": "@rbeezer"
}
```

Attachment [trac_10714-columns-sparse-matrices.patch](tarball://root/attachments/some-uuid/ticket10714/trac_10714-columns-sparse-matrices.patch) by @rbeezer created at 2011-02-08 17:53:29



---

archive/issue_comments_111810.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2011-02-08T17:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111810",
    "user": "@rbeezer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_111811.json:
```json
{
    "body": "Commit message fixed - sorry about that.\n\nFixed patch replaces the old one, so apply \"rows,\" then \"columns.\"",
    "created_at": "2011-02-08T17:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111811",
    "user": "@rbeezer"
}
```

Commit message fixed - sorry about that.

Fixed patch replaces the old one, so apply "rows," then "columns."



---

archive/issue_comments_111812.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-02-16T08:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10652#issuecomment-111812",
    "user": "@jdemeyer"
}
```

Resolution: fixed
