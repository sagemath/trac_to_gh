# Issue 24515: py3: unhandled exception in pynac

Issue created by migration from https://trac.sagemath.org/ticket/24752

Original creator: embray

Original creation time: 2018-02-16 13:47:54

CC:  rws

Keywords: pynac

There are several bugs like:


```
sage: arccoth(float(1.1))
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
AttributeError: type object 'float' has no attribute 'precision'

The above exception was the direct cause of the following exception:

SystemError                               Traceback (most recent call last)
<ipython-input-1-96f50dbce315> in <module>()
----> 1 arccoth(float(RealNumber('1.1')))

/home/embray/src/sagemath/sage-python3/local/lib/python3.6/site-packages/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11828)()
    993             res = self._evalf_try_(*args)
    994             if res is None:
--> 995                 res = super(BuiltinFunction, self).__call__(
    996                         *args, coerce=coerce, hold=hold)
    997

/home/embray/src/sagemath/sage-python3/local/lib/python3.6/site-packages/sage/symbolic/function.pyx in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6847)()
    487             res = g_function_evalv(self._serial, vec, hold)
    488         elif self._nargs == 1:
--> 489             res = g_function_eval1(self._serial,
    490                     (<Expression>args[0])._gobj, hold)
    491         elif self._nargs == 2:

SystemError: <built-in function __import__> returned a result with an error set
```


This is due to an unhandled exception elsewhere in `numeric.cpp`.  This is a problem on Python 2 as well, but by luck the exception is cleared later before it becomes a problem (whereas Python 3 is more aggressive in checking for unhandled exceptions when going into a function call).

Upstream PR: https://github.com/pynac/pynac/pull/307


---

Comment by jdemeyer created at 2018-02-16 14:20:27

Typically, pynac releases quickly after a bug-fix so we should wait for that.


---

Comment by embray created at 2018-02-16 14:34:21

I know, but it's still worth noting that this issue can be changed after the next pynac upgrade.


---

Comment by embray created at 2018-02-16 16:26:30

I believe the pynac update in #24745 will resolve several other Python 3 issues I've already fixed, but I guess not this one?


---

Comment by rws created at 2018-02-17 06:41:27

Yes, that one is completely different.

Usually we use bug report tickets that are fixed in Pynac for adding doctests but, since it came from a doctest, it's practically a duplicate of a yet-to-be-opened Pynac upgrade ticket. Alternatively, you could add your PR as patch here. The Pynac upgrade will then just remove it.


---

Comment by chapoton created at 2018-07-04 07:39:13

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-07-04 07:39:13

this should be closed now, please


---

Comment by chapoton created at 2018-07-04 08:02:54

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-07-04 16:38:51

Resolution: worksforme


---

Comment by embray created at 2018-07-04 16:39:31

Resolution changed from worksforme to 


---

Comment by embray created at 2018-07-04 16:39:31

Changing status from closed to new.


---

Comment by embray created at 2018-07-04 16:40:08

Changing status from new to needs_info.


---

Comment by embray created at 2018-07-04 16:40:08

Has there been another update to the minimal pynac version in Sage?  Because if not then I'm not sure we can call this fixed (and if so please note the relevant ticket).


---

Comment by chapoton created at 2018-07-04 17:42:29

Trac #24838 ?


---

Comment by chapoton created at 2018-07-09 09:03:54

ping ?


---

Comment by rws created at 2018-07-09 12:40:12

Yes, the PR listed in the description was merged with #24838.


---

Comment by rws created at 2018-07-09 12:40:12

Changing status from needs_info to positive_review.


---

Comment by embray created at 2018-07-10 11:41:40

Resolution: worksforme


---

Comment by embray created at 2018-07-10 11:41:40

Great, thanks.
