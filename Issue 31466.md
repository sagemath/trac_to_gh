# Issue 31466: Sheaves on manifolds

Issue created by migration from https://trac.sagemath.org/ticket/31703

Original creator: @mjungmath

Original creation time: 2021-04-20 13:18:09

CC:  egourgoulhon tscrim @tobiasdiez mkoeppe

As discussed in #29234#comment:7, sheaves will be a very useful addition to the manifolds code. In particular, they'd allow to unify tensor fields, scalar fields, vector bundle section etc. and thus get rid of code duplication since they all share the sheaf property.

My first intuition would be to implement them as a mix-in class.

Possibly helpful: #31677, #31680


---

Comment by @mjungmath created at 2021-05-03 15:45:54

See #30714#comment:10.


---

Comment by mkoeppe created at 2021-05-04 15:00:32

Sounds like we should add a functorial construction.


---

Comment by @mjungmath created at 2021-05-05 12:55:28

Replying to [comment:4 mkoeppe]:
> Sounds like we should add a functorial construction. 

What do you mean?


---

Comment by mkoeppe created at 2021-05-06 02:17:01

... similar to what's happening in `sage.categories.homsets`


---

Comment by @mjungmath created at 2021-05-06 08:21:17

I don't see how that might help us. We need something that is already compatible with the sheaf structure in the above classes.

Instead of a mix-in class, we can do that all via the category framework.


---

Comment by @mjungmath created at 2021-05-06 08:26:39

The problem I see with the category approach is that the implementation will be probably too concrete.


---

Comment by @mjungmath created at 2021-05-06 08:35:05

I will upload a proposal with category approach and put it under consideration.


---

Comment by git created at 2021-05-06 11:07:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-05-06 11:28:33

Does it make sense to keep track of the target category, i.e. sections of the presheaf over an open subset are objects of this category. Maybe as a generic parameter?


---

Comment by @mjungmath created at 2021-05-06 11:59:57

Replying to [comment:12 gh-tobiasdiez]:
> Does it make sense to keep track of the target category, i.e. sections of the presheaf over an open subset are objects of this category. Maybe as a generic parameter?

What do you mean?


---

Comment by @mjungmath created at 2021-05-06 12:05:48

But you are right. Strictly speaking, presheaves are families of section sets. The above proposal is very sloppy in that viewpoint. For now, it rather reflects something like the "category of presheaf section sets".


---

Comment by @mjungmath created at 2021-05-06 12:32:18

I think this whole category approach was non-sense after all...


---

Comment by @tobiasdiez created at 2021-05-06 12:33:24

What I meant is that your sections often have additional structure. For example, if you consider the presheaf $F$ of sections of a bundle of groups, then you can naturally multiply two such sections, i.e there are maps $F(U) \times F(U) \to F(U)$ for every open subset $U$ induced by the group multiplication. For example, the wedge product of differential forms can be described in such a way.


---

Comment by git created at 2021-05-15 10:10:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mjungmath created at 2021-05-15 10:11:44

Replying to [comment:16 gh-tobiasdiez]:
> What I meant is that your sections often have additional structure. For example, if you consider the presheaf $F$ of sections of a bundle of groups, then you can naturally multiply two such sections, i.e there are maps $F(U) \times F(U) \to F(U)$ for every open subset $U$ induced by the group multiplication. For example, the wedge product of differential forms can be described in such a way.

This behavior will naturally be captured by the corresponding parent of sections.


---

Comment by @mjungmath created at 2021-05-15 10:12:21

I have uploaded another approach. Feedback is welcome! :)


---

Comment by git created at 2021-05-15 14:30:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-15 14:44:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-05-15 14:50:19

This should reveal some more of the idea.


---

Comment by @mjungmath created at 2021-05-15 14:51:41

`_repr_` is probably not optimal, but at this stage I don't know how to do better.


---

Comment by mkoeppe created at 2021-05-16 16:27:40

I think you will want to make `Presheaf` a subclass of `Parent`. `PresheafSection` would be its element class.


---

Comment by @mjungmath created at 2021-05-16 16:35:01

In fact, `PresheafSection` shall be an element of a particular section set. For example: the (pre)sheaf of scalar fields is a family that assigns to each open subset the scalar field algebra on that open subset. Its elements, namely scalar fields, are the sections of the (pre)sheaf.

Thus, I don't think that a parent-element construction is what we want here, no?


---

Comment by @mjungmath created at 2021-05-22 16:26:44

For the gluing property we need concrete 'empty' sections we can endow with restrictions. But those sections cannot be provided by the parent directly since the element constructor always wants an input (otherwise it returns the zero element). Using the element class is not helpful either, because the sheaf does not know the input signature.

Any ideas how to elegantly circumvent this? Everything that comes into my mind is rather complicated.


---

Comment by git created at 2021-05-22 19:33:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-22 20:55:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-05-22 20:58:59

To circumvent the issue stated above, I delegated the constructions to an abstract method for now where the concrete implementation can take care of this. Though there are a lot of code snippets that fit better into this sheaf implementation because otherwise they would repeat. For example, `copy` shares a lot of common code.


---

Comment by git created at 2021-05-22 21:03:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-05-23 13:14:01

Do we really want to use restriction graphs an extension graphs as dictionaries, or is there a better solution available?


---

Comment by git created at 2021-05-24 16:45:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-05-24 16:46:36

`@`Matthias: Is that what you had in mind when speaking of functorial properties?


---

Comment by git created at 2021-05-24 17:09:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-24 17:21:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-24 17:36:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-24 20:33:05

Perhaps instead of passing a lambda function to `Presheaf`, define subclasses such as `ScalarFieldAlgebraPresheaf`. Then you can replace the method `scalar_field_algebra` with an attribute that is an instance of this class.


---

Comment by git created at 2021-05-24 21:04:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-05-24 21:25:16

Replying to [comment:38 mkoeppe]:
> Perhaps instead of passing a lambda function to `Presheaf`, define subclasses such as `ScalarFieldAlgebraPresheaf`. Then you can replace the method `scalar_field_algebra` with an attribute that is an instance of this class.

Things might still work fine with scalar fields. But as soon as we have tensor fields, things get more complicated. For example tensor field modules _must_ be constructed via the manifold's method `tensor_field_module` because the result depends on whether the manifold is parallelizable or not, and those finished constructions must be communicated back to the manifold again.


---

Comment by @mjungmath created at 2021-06-04 18:19:07

Replying to [comment:38 mkoeppe]:
> Perhaps instead of passing a lambda function to `Presheaf`, define subclasses such as `ScalarFieldAlgebraPresheaf`. Then you can replace the method `scalar_field_algebra` with an attribute that is an instance of this class.

Replying to [comment:40 gh-mjungmath]:
> Things might still work fine with scalar fields. But as soon as we have tensor fields, things get more complicated. For example tensor field modules _must_ be constructed via the manifold's method `tensor_field_module` because the result depends on whether the manifold is parallelizable or not, and those finished constructions must be communicated back to the manifold again.

Travis, Eric, what do you think about that?


---

Comment by egourgoulhon created at 2021-06-06 21:09:26

Replying to [comment:41 gh-mjungmath]:
> 
> Travis, Eric, what do you think about that?

First of all, I think it's a good idea to introduce sheaves. Regarding the lambda function in `Presheaf`, I agree with Michael's argument. Do you plan to re-implement some scalar field features, in particular the handling of restrictions, in this ticket?


---

Comment by mkoeppe created at 2021-06-11 03:32:10

See also `sage.schemes.toric.variety` for another place where sheaves already appear in Sage


---

Comment by @mjungmath created at 2021-07-24 15:35:27

Changing status from new to needs_info.


---

Comment by @mjungmath created at 2021-07-24 15:35:27

I could use some opinion. Also in which direction this ticket shall now develop. Some foundations are already laid.
