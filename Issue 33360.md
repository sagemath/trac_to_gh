# Issue 33360: Wrong computation of Hilbert polynomials

archive/issues_033360.json:
```json
{
    "body": "```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\n-t - 5\n```\nThe Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.\n\nInspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33597\n\n",
    "closed_at": "2022-10-11T09:14:48Z",
    "created_at": "2022-03-30T07:37:42Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Wrong computation of Hilbert polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33360",
    "user": "https://github.com/loefflerd"
}
```
```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
-t - 5
```
The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.

Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.

Issue created by migration from https://trac.sagemath.org/ticket/33597





---

archive/issue_events_088394.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33360#event-88394"
}
```



---

archive/issue_events_088395.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33360#event-88395"
}
```



---

archive/issue_events_088396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33360#event-88396"
}
```



---

archive/issue_comments_474411.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474411",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474412.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474412",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_474413.json:
```json
{
    "body": "bot is morally green, so please review",
    "created_at": "2022-09-28T14:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474413",
    "user": "https://github.com/fchapoton"
}
```

bot is morally green, so please review



---

archive/issue_comments_474414.json:
```json
{
    "body": "Sorry for hijacking this ticket. I made a few modifications to the patch so that\n\n(1) we do not assume `denom[0]` can be only `-1`.\n\n(2) the code is a bit more efficient.\n\nBefore your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial() \nsage: I.hilbert_polynomial()\n-t - 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 409 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 416 \u03bcs per loop\n```\nAfter your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 299 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 298 \u03bcs per loop\n```\nAfter my modifications\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 230 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 235 \u03bcs per loop\n```\n\nI am positive to the patch.",
    "created_at": "2022-09-30T04:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474414",
    "user": "https://github.com/kwankyu"
}
```

Sorry for hijacking this ticket. I made a few modifications to the patch so that

(1) we do not assume `denom[0]` can be only `-1`.

(2) the code is a bit more efficient.

Before your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial() 
sage: I.hilbert_polynomial()
-t - 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 409 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 416 μs per loop
```
After your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 299 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 298 μs per loop
```
After my modifications

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 230 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 235 μs per loop
```

I am positive to the patch.



---

archive/issue_comments_474415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-30T04:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474416.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474416",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474417.json:
```json
{
    "body": "ok, good to go, thanks",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474417",
    "user": "https://github.com/fchapoton"
}
```

ok, good to go, thanks



---

archive/issue_comments_474418.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-09-30T22:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474418",
    "user": "https://github.com/kwankyu"
}
```

Thank you!



---

archive/issue_events_088397.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-11T09:14:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33360#event-88397"
}
```



---

archive/issue_comments_474419.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-10-11T09:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474419",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
