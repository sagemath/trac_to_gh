# Issue 33360: Wrong computation of Hilbert polynomials

archive/issues_033360.json:
```json
{
    "body": "\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\n-t - 5\n```\n\nThe Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. \n\nInspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.\n\nI am rather suspicious about the correctness of the \"hilbert_series\" method as well, which also seems to assume the generators have degree 1.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33597\n\n",
    "created_at": "2022-03-30T07:37:42Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Wrong computation of Hilbert polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33360",
    "user": "@loefflerd"
}
```

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
-t - 5
```

The Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. 

Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.

I am rather suspicious about the correctness of the "hilbert_series" method as well, which also seems to assume the generators have degree 1.

Issue created by migration from https://trac.sagemath.org/ticket/33597





---

archive/issue_comments_474993.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474993",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474994.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474994",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_474995.json:
```json
{
    "body": "bot is morally green, so please review",
    "created_at": "2022-09-28T14:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474995",
    "user": "@fchapoton"
}
```

bot is morally green, so please review



---

archive/issue_comments_474996.json:
```json
{
    "body": "Sorry for hijacking this ticket. I made a few modifications to the patch so that\n\n(1) we do not assume `denom[0]` can be only `-1`.\n\n(2) the code is a bit more efficient.\n\nBefore your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial() \nsage: I.hilbert_polynomial()\n-t - 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 409 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 416 \u03bcs per loop\n```\n\nAfter your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 299 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 298 \u03bcs per loop\n```\n\nAfter my modifications\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 230 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 235 \u03bcs per loop\n```\n\n\nI am positive to the patch.",
    "created_at": "2022-09-30T04:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474996",
    "user": "@kwankyu"
}
```

Sorry for hijacking this ticket. I made a few modifications to the patch so that

(1) we do not assume `denom[0]` can be only `-1`.

(2) the code is a bit more efficient.

Before your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial() 
sage: I.hilbert_polynomial()
-t - 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 409 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 416 μs per loop
```

After your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 299 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 298 μs per loop
```

After my modifications

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 230 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 235 μs per loop
```


I am positive to the patch.



---

archive/issue_comments_474997.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-30T04:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474997",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474998.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474998",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474999.json:
```json
{
    "body": "ok, good to go, thanks",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-474999",
    "user": "@fchapoton"
}
```

ok, good to go, thanks



---

archive/issue_comments_475000.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-09-30T22:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-475000",
    "user": "@kwankyu"
}
```

Thank you!



---

archive/issue_comments_475001.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-10-11T09:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33360#issuecomment-475001",
    "user": "@vbraun"
}
```

Resolution: fixed
