# Issue 33360: Wrong computation of Hilbert polynomials

Issue created by migration from https://trac.sagemath.org/ticket/33597

Original creator: davidloeffler

Original creation time: 2022-03-30 07:37:42


```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
-t - 5
```

The Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. 

Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.

I am rather suspicious about the correctness of the "hilbert_series" method as well, which also seems to assume the generators have degree 1.


---

Comment by chapoton created at 2022-09-28 12:31:08

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-09-28 12:31:08

New commits:


---

Comment by chapoton created at 2022-09-28 14:29:08

bot is morally green, so please review


---

Comment by klee created at 2022-09-30 04:28:16

Sorry for hijacking this ticket. I made a few modifications to the patch so that

(1) we do not assume `denom[0]` can be only `-1`.

(2) the code is a bit more efficient.

Before your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial() 
sage: I.hilbert_polynomial()
-t - 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 409 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 416 μs per loop
```

After your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 299 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 298 μs per loop
```

After my modifications

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 230 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 235 μs per loop
```


I am positive to the patch.


---

Comment by git created at 2022-09-30 04:34:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-09-30 08:13:02

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2022-09-30 08:13:02

ok, good to go, thanks


---

Comment by klee created at 2022-09-30 22:35:48

Thank you!


---

Comment by vbraun created at 2022-10-11 09:14:48

Resolution: fixed
