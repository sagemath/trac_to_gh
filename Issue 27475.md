# Issue 27475: improve function field differentials to work over nested fields

Issue created by migration from https://trac.sagemath.org/ticket/27712

Original creator: @BrentBaccala

Original creation time: 2019-04-22 18:42:12

CC:  klee

Keywords: function fields

Differentials don't currently work right over nested function fields.  For example,


```
sage: K.<x> = FunctionField(GF(31))
sage: R.<y> = K[]
sage: L.<y> = K.extension(y^2 - x)
sage: R.<z> = L[]
sage: M.<z> = L.extension(z^2 - y)

sage: K.space_of_differentials()(x)
d(x)
sage: L.space_of_differentials()(x)
d(x)
sage: M.space_of_differentials()(x)
d(y)

sage: z.differential()
(8/x*z) d(y)
```


Yet dz = 1/(2*z) dy, which isn't (8/x*z):


```
sage: 1/(2*z) == (8/x*z)
False
```


This ticket is spun off from #26993


---

Comment by @BrentBaccala created at 2019-04-24 00:36:30

The patch adds an explicit instance variable to `DifferentialsSpace` that specifies the base differential that all of the other differentials will be expressed relative to.

If possible, the base differential is the generator of the base rational function field.  If this is not possible (because that generator is not a separating element), then the generator of the next higher field is considered until a suitable base differential is found.

I'm wondering if some means should be provided for the user to set the base generator, say if they wanted to use d(y) instead of d(x) when both are suitable.  Then we might have two different `DifferentialsSpace`s attached to the same function field, with two different base generators.  It really should only affect how the differentials are printed.  I'm not sure how to do it, so right now I'm just leaving it the way it is, and no means is provided for the user to pick the base differential.

But it solves the problem - the example listed in the ticket description is added as a test case.
----
New commits:


---

Comment by @BrentBaccala created at 2019-04-24 00:36:41

Changing status from new to needs_review.


---

Comment by git created at 2019-04-26 00:03:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-13 19:47:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-14 05:05:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-05-14 05:13:39

Brent, I refactored differentials module so that now basic arithmetic with differentials of arbitrary function fields is supported. I also tweaked your code a little bit to speed up.

If you are positive on my portion of the code, then you can set positive review.


---

Comment by @BrentBaccala created at 2019-05-15 14:08:04

Changing status from needs_review to positive_review.


---

Comment by @BrentBaccala created at 2019-05-15 14:08:04

LGTM


---

Comment by vbraun created at 2019-05-21 12:15:47

Resolution: fixed
