# Issue 29134: little tweak in mac-app

archive/issues_029134.json:
```json
{
    "body": "CC:  dimpase @maverickwoo @shlokatadistance iandrus slelievre vbraun\n\nabout grep command line options\n\nas suggested by https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0\n\nIssue created by migration from https://trac.sagemath.org/ticket/29371\n\n",
    "created_at": "2020-03-19T20:23:37Z",
    "labels": [
        "scripts",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "little tweak in mac-app",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29134",
    "user": "chapoton"
}
```
CC:  dimpase @maverickwoo @shlokatadistance iandrus slelievre vbraun

about grep command line options

as suggested by https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0

Issue created by migration from https://trac.sagemath.org/ticket/29371





---

archive/issue_comments_412492.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-19T20:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412492",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412493.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-03-19T20:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412493",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_412494.json:
```json
{
    "body": "I don't know how to test this because I can't produce a functioning app with or without this patch.",
    "created_at": "2020-03-20T03:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412494",
    "user": "jhpalmieri"
}
```

I don't know how to test this because I can't produce a functioning app with or without this patch.



---

archive/issue_comments_412495.json:
```json
{
    "body": "Well, this seems to be innocuous enough.\n\nThe proposer on sage-support could be the reviewer, but I cannot answer him there.",
    "created_at": "2020-03-20T07:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412495",
    "user": "chapoton"
}
```

Well, this seems to be innocuous enough.

The proposer on sage-support could be the reviewer, but I cannot answer him there.



---

archive/issue_comments_412496.json:
```json
{
    "body": "Perhaps Volker can review it.",
    "created_at": "2020-03-20T08:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412496",
    "user": "dimpase"
}
```

Perhaps Volker can review it.



---

archive/issue_comments_412497.json:
```json
{
    "body": "Changing keywords from \"\" to \"macOS, app\".",
    "created_at": "2020-03-20T15:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412497",
    "user": "slelievre"
}
```

Changing keywords from "" to "macOS, app".



---

archive/issue_comments_412498.json:
```json
{
    "body": "Cc a few extra \"macOS\" people.",
    "created_at": "2020-03-20T15:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412498",
    "user": "slelievre"
}
```

Cc a few extra "macOS" people.



---

archive/issue_comments_412499.json:
```json
{
    "body": "Hello, following the discussion from https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0, I had reported this previously about how it was breaking from the paths. it worked once with a temporary fix and the second time when I granted complete permissions to sagemath. I am however skeptical of the latter because it was rather odd for an application explicitly needing complete and direct drive access",
    "created_at": "2020-03-21T20:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412499",
    "user": "@Shlokatadistance"
}
```

Hello, following the discussion from https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0, I had reported this previously about how it was breaking from the paths. it worked once with a temporary fix and the second time when I granted complete permissions to sagemath. I am however skeptical of the latter because it was rather odd for an application explicitly needing complete and direct drive access



---

archive/issue_comments_412500.json:
```json
{
    "body": "Thank you for accepting my proposal.\nI managed to compile sage-9.0 + sag-9.0/src/mac-app and the version with the proposal it took 6 hours.\nI tested running the both version.\nThe older version is slightly slower.\nAlternatively, I tested the code of pipes.\n\n\n```sh\nmyhome$ cat sage.log | grep -i --context 1 'Notebook is running at' | grep --line-buffered -o -e \"http://.*\" \ngrep: Notebook is running at: No such file or directory \nmyhome$ cat sage.log | grep -i --line-buffered --context=1 'Notebook is running at' | grep --line-buffered -o -e \"http://.*\"  \n..... \nhttp://localhost:8888/?token=XXX...X\n```\n\n\nThe previous code is an error and the proposal detects the address. (ticket being hidden by XXX...X.\n\nI compare two versions  in new local account.",
    "created_at": "2020-03-23T16:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412500",
    "user": "@rana-aerea"
}
```

Thank you for accepting my proposal.
I managed to compile sage-9.0 + sag-9.0/src/mac-app and the version with the proposal it took 6 hours.
I tested running the both version.
The older version is slightly slower.
Alternatively, I tested the code of pipes.


```sh
myhome$ cat sage.log | grep -i --context 1 'Notebook is running at' | grep --line-buffered -o -e "http://.*" 
grep: Notebook is running at: No such file or directory 
myhome$ cat sage.log | grep -i --line-buffered --context=1 'Notebook is running at' | grep --line-buffered -o -e "http://.*"  
..... 
http://localhost:8888/?token=XXX...X
```


The previous code is an error and the proposal detects the address. (ticket being hidden by XXX...X.

I compare two versions  in new local account.



---

archive/issue_comments_412501.json:
```json
{
    "body": "Sorry, this was my fault in #28661.  On my Mac, I use GNU grep and I forgot about that when testing that revision. I confirm the equal sign in `--context=1` is indeed required. My apologies!\n\nHowever, I am not sure why `--line-buffered` is needed here even though having it shouldn't break things.",
    "created_at": "2020-03-24T04:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412501",
    "user": "@maverickwoo"
}
```

Sorry, this was my fault in #28661.  On my Mac, I use GNU grep and I forgot about that when testing that revision. I confirm the equal sign in `--context=1` is indeed required. My apologies!

However, I am not sure why `--line-buffered` is needed here even though having it shouldn't break things.



---

archive/issue_comments_412502.json:
```json
{
    "body": "so, who will dare to give a positive review, ladies and gentlemen ?",
    "created_at": "2020-03-24T07:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412502",
    "user": "chapoton"
}
```

so, who will dare to give a positive review, ladies and gentlemen ?



---

archive/issue_comments_412503.json:
```json
{
    "body": "I am working on it.\n\nMy trial:\n\nStep 1. Create a new account where no initialization is done for Jupyter.\n\nStep 2. Copy updated SageMath-9.0 and reference version (original SageMath-9.0) to some location accessible to the new account.\n\nStep 3. Compare the two versions in new account.\n\nCurrent Status:\nThe two versions I compiled both have absolute pathnames somewhere in them.\n\nCopying SageMath-9.0.app from the disk image did not change this situation.\n\nThe problem is that the path  (in bash script and somewhere I do not know)) points to the same new version.\n(!echo in Jupyter notebook shows missing of subdirectory of build directory and the subdirectory of the copied application.)\n\nI will make two copies of the source tree of Sagemath and compile them again.\nI think I can make some part of the comparison.\nBut I am afraid my environment differs from the user's environment.\n\nIf someone tells me how to make a relocatable copy of SageMath-9.0 or SageMath-9.1 and make a packages which resemble the distribution, I can do a better test.\n\nPartial Information I got so far:\n\nOriginal SageMath-9.0 has a incompatibility problem with insertion of new debugging messages.\nIndeed, it was unable to invoke jupyter server when I inserted two or three instances of echo commands.\n\n```python\n# @rana-aerea\n# debugging code\necho >&2 -e \"PATH=$PATH\" ;\n# echo >&2 -e \"SAGE_ROOT=$SAGE_ROOT\" ;\necho >&2 -e \"CWD=`pwd`\" ;\n```\n\n(I have no intension to include the three debugging messages in the distribution.)\n\nAnother observation is the log file misses all messages after the first one of these debugging information.\n\nRight now, coping of the updated version from the disk image finished.\nI added the same three commands of echo to SageMath-9.0/sage. I activated the second one, too.\nI double clicked this version.\nIn sage.log, I found the path, the SAGE_ROOT and the current working directory and more messages.\nThis is a side evidence of some function of the option \"--line buffered\".\nI do not see version information of sage itself.\n\nI continue my test. I think I can report the result in 24 hours.",
    "created_at": "2020-03-24T09:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412503",
    "user": "@rana-aerea"
}
```

I am working on it.

My trial:

Step 1. Create a new account where no initialization is done for Jupyter.

Step 2. Copy updated SageMath-9.0 and reference version (original SageMath-9.0) to some location accessible to the new account.

Step 3. Compare the two versions in new account.

Current Status:
The two versions I compiled both have absolute pathnames somewhere in them.

Copying SageMath-9.0.app from the disk image did not change this situation.

The problem is that the path  (in bash script and somewhere I do not know)) points to the same new version.
(!echo in Jupyter notebook shows missing of subdirectory of build directory and the subdirectory of the copied application.)

I will make two copies of the source tree of Sagemath and compile them again.
I think I can make some part of the comparison.
But I am afraid my environment differs from the user's environment.

If someone tells me how to make a relocatable copy of SageMath-9.0 or SageMath-9.1 and make a packages which resemble the distribution, I can do a better test.

Partial Information I got so far:

Original SageMath-9.0 has a incompatibility problem with insertion of new debugging messages.
Indeed, it was unable to invoke jupyter server when I inserted two or three instances of echo commands.

```python
# @rana-aerea
# debugging code
echo >&2 -e "PATH=$PATH" ;
# echo >&2 -e "SAGE_ROOT=$SAGE_ROOT" ;
echo >&2 -e "CWD=`pwd`" ;
```

(I have no intension to include the three debugging messages in the distribution.)

Another observation is the log file misses all messages after the first one of these debugging information.

Right now, coping of the updated version from the disk image finished.
I added the same three commands of echo to SageMath-9.0/sage. I activated the second one, too.
I double clicked this version.
In sage.log, I found the path, the SAGE_ROOT and the current working directory and more messages.
This is a side evidence of some function of the option "--line buffered".
I do not see version information of sage itself.

I continue my test. I think I can report the result in 24 hours.



---

archive/issue_comments_412504.json:
```json
{
    "body": "binary distributions of Sage are made using\nhttps://github.com/sagemath/binary-pkg",
    "created_at": "2020-03-25T15:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412504",
    "user": "dimpase"
}
```

binary distributions of Sage are made using
https://github.com/sagemath/binary-pkg



---

archive/issue_comments_412505.json:
```json
{
    "body": "Step 1: Delete sage.log\nStep 2: Invoke two copies one at a time. Open a Jupiter notebook and shutdown the kernel. Then view log.\n(Guest account and the account of compilation.)\n\nResult:\nIn both accounts, the comparison has the same conclusion.\nThe original version printed only one line of message in the sage.log.\nThe updated version printed several messages until the last message complaining kernel not found.\n\nThe conclusion of the review is \"go\".\n\nThank you for the message on binary distributions.\nI will study it and solve the problem of signature.",
    "created_at": "2020-03-25T15:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412505",
    "user": "@rana-aerea"
}
```

Step 1: Delete sage.log
Step 2: Invoke two copies one at a time. Open a Jupiter notebook and shutdown the kernel. Then view log.
(Guest account and the account of compilation.)

Result:
In both accounts, the comparison has the same conclusion.
The original version printed only one line of message in the sage.log.
The updated version printed several messages until the last message complaining kernel not found.

The conclusion of the review is "go".

Thank you for the message on binary distributions.
I will study it and solve the problem of signature.



---

archive/issue_comments_412506.json:
```json
{
    "body": "if you agree with the ticket, you should set the status to \"Positive Review\" and put your real name in the \"Author\" box of the ticket (use the Modify ticket button)",
    "created_at": "2020-03-25T17:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412506",
    "user": "chapoton"
}
```

if you agree with the ticket, you should set the status to "Positive Review" and put your real name in the "Author" box of the ticket (use the Modify ticket button)



---

archive/issue_comments_412507.json:
```json
{
    "body": "so nobody dares to give a positive review ? Damn...",
    "created_at": "2020-03-28T20:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412507",
    "user": "chapoton"
}
```

so nobody dares to give a positive review ? Damn...



---

archive/issue_comments_412508.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-28T21:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412508",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412509.json:
```json
{
    "body": "Okay, fine.",
    "created_at": "2020-03-28T21:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412509",
    "user": "jhpalmieri"
}
```

Okay, fine.



---

archive/issue_comments_412510.json:
```json
{
    "body": "I apologize for very slow response.\nI succeeded in compiling relocatable version of Sagemath.\nThe next thing I must do is to reflect the change in relocatable version.",
    "created_at": "2020-03-29T07:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412510",
    "user": "@rana-aerea"
}
```

I apologize for very slow response.
I succeeded in compiling relocatable version of Sagemath.
The next thing I must do is to reflect the change in relocatable version.



---

archive/issue_comments_412511.json:
```json
{
    "body": "I manage to produce disk-image-file of SageMath-9.1beta9 with the  proposed code of this ticket.\nThe resulting program solves the first bug reported in sage-support group \n\"Sage 9.0 macOS Jupyter Server failed to start\" ( https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0 ).\n\nThe bug was this: the pipes \"sage ... | tee ... | grep ... | grep ... \" got stuck after the second last stage of pipes terminated by error.\nThis caused tee to terminate. The termination occurred when the buffer was full.\nThen, the first stage also terminated in a way we cannot understand form the source code of the bash script sage.\n\nIf someone is aware of suppressing logs for saving Mac application from strange failure, I ask him/her/them to enable logging.",
    "created_at": "2020-03-29T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412511",
    "user": "@rana-aerea"
}
```

I manage to produce disk-image-file of SageMath-9.1beta9 with the  proposed code of this ticket.
The resulting program solves the first bug reported in sage-support group 
"Sage 9.0 macOS Jupyter Server failed to start" ( https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0 ).

The bug was this: the pipes "sage ... | tee ... | grep ... | grep ... " got stuck after the second last stage of pipes terminated by error.
This caused tee to terminate. The termination occurred when the buffer was full.
Then, the first stage also terminated in a way we cannot understand form the source code of the bash script sage.

If someone is aware of suppressing logs for saving Mac application from strange failure, I ask him/her/them to enable logging.



---

archive/issue_comments_412512.json:
```json
{
    "body": "The update now fixes the bug reported by Dr. Murray Eisenberg in \"Sage 9.0 macOS Jupyter Server failed to start\" ( https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0 ).",
    "created_at": "2020-03-29T15:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412512",
    "user": "@rana-aerea"
}
```

The update now fixes the bug reported by Dr. Murray Eisenberg in "Sage 9.0 macOS Jupyter Server failed to start" ( https://groups.google.com/forum/#!topic/sage-support/gf0aR8b_vk0 ).



---

archive/issue_comments_412513.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-05T08:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29134#issuecomment-412513",
    "user": "vbraun"
}
```

Resolution: fixed
