# Issue 18657: Automatic build error reporting

Issue created by migration from https://trac.sagemath.org/ticket/18894

Original creator: vbraun

Original creation time: 2015-07-13 21:40:03

CC:  jhpalmieri

Its likely that Sage fails to build on many distributions as the developers tend to use a pretty small subset. Also, it is time consuming to ask the few users that *do* complain to upload individual build logs. Instead, logs from failed builds should be uploaded automatically but
* only after sanitizing
* only after asking the user for permission
Compressed logs are about 2M so it is easily doable.

As concrete steps I'm proposing to
* replace `tee` with a python script that logs without spewing forth endless output and sane error propagation
* Only output from *failed* builds (and perhaps hung processes) should ever be dumped to the console
* Logs should always only be a single build log, and never have logs from multiple builds concatenated
* Upon failure, ask the user for permission to upload the logs to our server
* Implement a backend to store the logs
* Implement a webapp to view the logs
* Viewing the logs should be restricted to Sage developers (emails in git commit log), perhaps with the option of being invited by a developer



---

Comment by jdemeyer created at 2015-07-14 06:12:18

There are several points here I don't agree with or don't understand:
> * Only output from *failed* builds (and perhaps hung processes) should ever be dumped to the console
Why? If people type `make` and they see nothing, they will surely think there is a problem. I think it's good that people see that stuff is happening.
> * replace `tee` with a python script that logs without spewing forth endless output
I guess the "spewing forth endless output" part also refers to not dumping output to the console?
> * Logs should always only be a single build log, and never have logs from multiple builds concatenated
We have logs for individual packages (`logs/pkgs/gap-4.8.4.log`) and one log with everything (`logs/install.log`). Both have reasons to exist (`install.log` can diagnose race conditions in parallel builds).

And all this is obviously too much for one ticket. For example, the part about replacing `tee` should be a ticket by itself.


---

Comment by jdemeyer created at 2015-07-14 10:24:56

Replying to [ticket:18894 vbraun]:
> * Viewing the logs should be restricted to Sage developers (emails in git commit log), perhaps with the option of being invited by a developer

I don't see the need for this additional complication. Assuming we sanitize the logs and assuming that the user gives permission to make his logs public, what's the problem really?


---

Comment by vbraun created at 2015-07-14 22:50:11

Scope: Yes, this is not supposed to be implemented in a single ticket.

Make output: There should be some kind of feedback, but without dumping the whole output. A quickly increasing number of lines of output or something like that. Separated by package, also showing which package is currently building, etc.

Not concatenating logs: By that I mean that the log is always truncated at the beginning of a build. E.g. right now if you run "sage -f package" twice then there are the logs of the two builds concatenated. And in logs/package.log, whereas "make" logs to logs/package-version.log 

Access restriction: You can't really review the complete install.log for accidentally-leaked information due to its size. There is no reason why it should end up being public. Also an authentication service will be useful for managing uploads of upstream packages.


---

Comment by vbraun created at 2015-07-14 22:50:11

Changing type from enhancement to task.


---

Comment by jdemeyer created at 2015-07-15 04:28:53

Replying to [comment:4 vbraun]:
> Not concatenating logs: By that I mean that the log is always truncated at the beginning of a build. E.g. right now if you run "sage -f package" twice then there are the logs of the two builds concatenated. And in logs/package.log, whereas "make" logs to logs/package-version.log 
OK, I see.  I would suggest to keep the logs of the last N builds, for some small value of N.

Are you planning to send an email to sage-devel? I think it should be done, in case people really like their concatenated logs.


---

Comment by vbraun created at 2015-07-15 07:35:22

Concatenating logs really is just a trap for the unwary, I remember seeing reports on sage-devel where people got confused. Also, whats the point of log rotating? Nobody is going to remember what they did that lead to package.log.3, especially not if the .N changes with every build attempt. If you want to compare different logs then you need to label them, and then you can just copy the log to a different filename.


---

Comment by fbissey created at 2015-07-15 10:45:39

I'll speak now and probably regret it later.
 * individual logs labelled: yes please, as you may know in Gentoo there is time stamp as part of the label as in `sage-9999:20150713-221321.log`
 * something that sometimes annoys me during debugging. If there is a configuration command (`./configure blah` or some other) it would be nice to have it echoed as part of the log. With `configure` you can find a copy in `config.log` if a build fails or you chose to keep the building folder but it would be quicker to just have it in the log.


---

Comment by jhpalmieri created at 2015-07-15 15:21:45

Rather than labeling individual logs with a time stamp, how about creating a log directory with a timestamp in its name, maybe with a symlink to `latest`? I'm thinking of directories like `logs/build-TIMESTAMP`, `logs/build-latest`, etc. Then by default remove all but the three most recent? Or do we just leave them all there, as we do with our current logs?


---

Comment by mkoeppe created at 2020-04-13 00:27:30

We now have more comprehensive portability testing, so this seems less important.
