# Issue 29518: Multiprocessing in tensor computations does not work under macOS

Issue created by migration from https://trac.sagemath.org/ticket/29755

Original creator: egourgoulhon

Original creation time: 2020-05-29 13:03:53

Keywords: multiprocessing, parallelization, macOS

Multiprocessing, as implemented in differential geometry computations via

```
sage: Parallelism().set(nproc=8)
```

does not work under macOS. This has been reported by many users, a recent report being https://groups.google.com/d/msg/sage-support/0RsGgb3lmZg/zNTMFLH9AQAJ

Note there is no issue within the doctest framework, i.e. the doctests involving parallel computations implemented in `src/sage/manifolds/differentiable` and `src/sage/tensor/modules` are passed on macOS machines.


---

Comment by dimpase created at 2020-05-29 13:25:28

it is not clear how to see that it is broken. Could you point at a doctest that doesn't work at the Sage prompt?


---

Comment by egourgoulhon created at 2020-05-29 17:02:59

Replying to [comment:1 dimpase]:
> it is not clear how to see that it is broken. Could you point at a doctest that doesn't work at the Sage prompt?

For instance, the doctest about the [parallelization of the Lie derivative](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/tensorfield_paral.html#sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.lie_derivative), a short version of which is

```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: v = M.vector_field(-y, x)
sage: w = M.one_form(y^2*sin(x), x^3*cos(y))
sage: Parallelism().set(nproc=2)
sage: w.lie_derivative(v).display()
(-y^3*cos(x) + x^3*cos(y) + 2*x*y*sin(x)) dx 
 + (-x^4*sin(y) - 3*x^2*y*cos(y) - y^2*sin(x)) dy
```



---

Comment by egourgoulhon created at 2020-06-02 06:51:07

The OP at https://groups.google.com/d/msg/sage-support/0RsGgb3lmZg/WNxT_rzNAwAJ says that the problem is fixed in Sage 9.1. Dima, can you confirm this? (sorry I don't have any macOS computer at hand...). If yes, we may close this ticket.


---

Comment by dimpase created at 2020-06-07 17:09:05

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-06-07 17:09:05

works for me on macOS and Sage 9.2.beta0


---

Comment by dimpase created at 2020-06-07 17:09:52

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2020-06-08 07:04:58

Replying to [comment:4 dimpase]:
> works for me on macOS and Sage 9.2.beta0

Thank you Dima!


---

Comment by chapoton created at 2020-06-14 13:24:55

Resolution: worksforme
