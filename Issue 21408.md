# Issue 21408: Full symbolic sum function

Issue created by migration from https://trac.sagemath.org/ticket/21645

Original creator: rws

Original creation time: 2016-10-05 07:27:23

`sum(ex,...)` always gets sent to `calculus.symbolic_sum()` where Maxima is called. If unevaluated an anonymous function `sum` is returned.

```
sage: ex=sum(gamma(n), n,1,a)
sage: ex.operator()
sum
sage: type(_)
<class 'sage.symbolic.function_factory.NewSymbolicFunction'>
```


This is unsatisfactory in many regards. Calls always go through Maxima, even if one wants just a sum expression held unevaluated. Also the anonymous function cannot be evaluated or substituted. For these reasons making a full symbolic sum function is a natural decision.


---

Comment by tmonteil created at 2016-10-07 11:40:12

Indeed ! This issue is known for a while, see [this ask question](https://ask.sagemath.org/question/9649/how-to-turn-off-symbolic-sum-evaluation/) for a dirty workaround. Funnily, i recently got a similar request privately, and was about to open a ticket to add a `hold` parameter to symbolic sum, i guess this ticket will take care of that too.


---

Comment by rws created at 2016-11-10 16:20:23

New commits:


---

Comment by rws created at 2016-11-10 16:20:23

Changing status from new to needs_review.


---

Comment by git created at 2016-11-10 16:31:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2016-11-10 17:08:55

Looking at the patch, I see presently special work happens on maxima's return values, which replaces maxima's "inert" sum with sage's newly grown symbolic sum function. I think that's problematic (for instance, we could have nested sums, and the nested sums would escape this treatment). Also, the test used (`isinstance(op,SymbolicFunction)`) is a little suspicious: I think it would get the result from

```
sum(f(x),n,0,0)
```

wrong.

It should be possible to use the standard SR-to-maxima and maxima-to-SR translation dictionaries for this, just as functions like sin etc. get properly translated. Isn't the line

```
+        BuiltinFunction.__init__(self, "sum", nargs=4,
+                               conversions=dict(maxima='sum'))
```

already enough to get the required automatic translations? If not, perhaps there is a manual override somewhere else that needs to be *removed* to let the normal translation take its course?


---

Comment by git created at 2016-11-11 08:21:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-11-11 08:22:21

You're right!


---

Comment by nbruin created at 2016-11-12 02:03:51

Changing status from needs_review to positive_review.


---

Comment by nbruin created at 2016-11-12 02:03:51

Looks good and patchbot is happy (coverage plugin failure seems to be on code that this actual branch doesn't touch)


---

Comment by vbraun created at 2016-11-15 23:25:09

Resolution: fixed
