# Issue 28652: Rework the constructor of PermutationGroupElement

archive/issues_028415.json:
```json
{
    "body": "As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.\n\nHere are some performance gain comparing 9.0.beta3 (\"OLD\") against the code provided in the branch (\"NEW\")\n- Constructor\n\n```\nsage: S = SymmetricGroup(10)\nsage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])\nNEW: 10000 loops, best of 5: 3.94 \u00b5s per loop\nOLD: 10000 loops, best of 5: 227 \u00b5s per loop\nsage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])\nNEW: 10000 loops, best of 5: 10.5 \u00b5s per loop\nOLD: 10000 loops, best of 5: 201 \u00b5s per loop\nsage: %timeit -n 10000 S('(1,3,5)(2,7)')\nNEW: 10000 loops, best of 5: 5.3 \u00b5s per loop\nOLD: 10000 loops, best of 5: 230 \u00b5s per loop\n```\n  and\n\n```\nsage: P = PermutationGroup(['(1,2,3)'])\nsage: %timeit -n 10000 P('(1,2,3)')\nNEW: 10000 loops, best of 5: 134 \u00b5s per loop\nOLD: 10000 loops, best of 5: 211 \u00b5s per loop\n```\n  and\n\n```\n\nsage: %timeit -n 3000 PermutationGroupElement('(1,2,3)(4,7)')\nNEW: 3000 loops, best of 5: 64.2 \u00b5s per loop\nOLD: 3000 loops, best of 5: 251 \u00b5s per loop\nsage: %timeit -n 3000 PermutationGroupElement([1,5,2,3,4])\nNEW: 3000 loops, best of 5: 14.9 \u00b5s per loop\nOLD: 3000 loops, best of 5: 251 \u00b5s per loop\nsage: %timeit -n 3000 PermutationGroupElement([(1,5),(2,3,4)])\nNEW: 3000 loops, best of 5: 38.5 \u00b5s per loop\nOLD: 3000 loops, best of 5: 215 \u00b5s per loop\n```\n- iteration of monogen group\n\n```\nsage: P = S.subgroup([(1,2,3,4,5,6)])\nsage: %timeit for p in P: pass\nNEW: 100000 loops, best of 5: 2.71 \u00b5s per loop\nOLD: 1000 loops, best of 5: 252 \u00b5s per loop\n```\n- multiplication of permutation with distinct parents\n\n```\nsage: S = SymmetricGroup(7)\nsage: P = S.subgroup([(1,2,3,4,5,6,7)])\nsage: L1 = list(S)\nsage: L2 = list(P)\nsage: %%time\n....: for s1 in L1:\n....:     for s2 in L2:\n....:         q = s1 * s2\nNEW: Wall time: 11.4 ms\nOLD: Wall time: 1.42 s\n```\n\nCC:  @tscrim @fchapoton @simonbrandhorst\n\nBranch/Commit: 3df8290eccc7bcc1dfdd843858bab819d1058d69\n\nReviewer: Travis Scrimshaw\n\nAuthor: Vincent Delecroix\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28652\n\n",
    "closed_at": "2019-11-16T20:15:43Z",
    "created_at": "2019-10-25T00:59:03Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Rework the constructor of PermutationGroupElement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28652",
    "user": "https://github.com/videlec"
}
```
As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.

Here are some performance gain comparing 9.0.beta3 ("OLD") against the code provided in the branch ("NEW")
- Constructor

```
sage: S = SymmetricGroup(10)
sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])
NEW: 10000 loops, best of 5: 3.94 µs per loop
OLD: 10000 loops, best of 5: 227 µs per loop
sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])
NEW: 10000 loops, best of 5: 10.5 µs per loop
OLD: 10000 loops, best of 5: 201 µs per loop
sage: %timeit -n 10000 S('(1,3,5)(2,7)')
NEW: 10000 loops, best of 5: 5.3 µs per loop
OLD: 10000 loops, best of 5: 230 µs per loop
```
  and

```
sage: P = PermutationGroup(['(1,2,3)'])
sage: %timeit -n 10000 P('(1,2,3)')
NEW: 10000 loops, best of 5: 134 µs per loop
OLD: 10000 loops, best of 5: 211 µs per loop
```
  and

```

sage: %timeit -n 3000 PermutationGroupElement('(1,2,3)(4,7)')
NEW: 3000 loops, best of 5: 64.2 µs per loop
OLD: 3000 loops, best of 5: 251 µs per loop
sage: %timeit -n 3000 PermutationGroupElement([1,5,2,3,4])
NEW: 3000 loops, best of 5: 14.9 µs per loop
OLD: 3000 loops, best of 5: 251 µs per loop
sage: %timeit -n 3000 PermutationGroupElement([(1,5),(2,3,4)])
NEW: 3000 loops, best of 5: 38.5 µs per loop
OLD: 3000 loops, best of 5: 215 µs per loop
```
- iteration of monogen group

```
sage: P = S.subgroup([(1,2,3,4,5,6)])
sage: %timeit for p in P: pass
NEW: 100000 loops, best of 5: 2.71 µs per loop
OLD: 1000 loops, best of 5: 252 µs per loop
```
- multiplication of permutation with distinct parents

```
sage: S = SymmetricGroup(7)
sage: P = S.subgroup([(1,2,3,4,5,6,7)])
sage: L1 = list(S)
sage: L2 = list(P)
sage: %%time
....: for s1 in L1:
....:     for s2 in L2:
....:         q = s1 * s2
NEW: Wall time: 11.4 ms
OLD: Wall time: 1.42 s
```

CC:  @tscrim @fchapoton @simonbrandhorst

Branch/Commit: 3df8290eccc7bcc1dfdd843858bab819d1058d69

Reviewer: Travis Scrimshaw

Author: Vincent Delecroix

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28652





---

archive/issue_comments_556206.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-As part of #28539 we rewrite the constructor of `PermutationGroupElement` to make it much faster.\n+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.\n \n Author: Vincent Delecroix\n \n``````\n",
    "created_at": "2019-10-25T00:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556206",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-As part of #28539 we rewrite the constructor of `PermutationGroupElement` to make it much faster.
+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.
 
 Author: Vincent Delecroix
 
``````




---

archive/issue_comments_556207.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/28652\"",
    "created_at": "2019-10-25T04:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556207",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/28652"



---

archive/issue_comments_556208.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-10-25T04:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556208",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_556209.json:
```json
{
    "body": "Changing commit from \"\" to \"050a6b46f89dd606486409e8794a686d88e9e862\"",
    "created_at": "2019-10-25T04:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556209",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "050a6b46f89dd606486409e8794a686d88e9e862"



---

archive/issue_comments_556210.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-25T04:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556210",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_556211.json:
```json
{
    "body": "<a id='comment:3'></a>Apparemment, ca compile pas. Voir les patchbots.",
    "created_at": "2019-10-25T07:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556211",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>Apparemment, ca compile pas. Voir les patchbots.



---

archive/issue_comments_556212.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-25T11:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556212",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_556213.json:
```json
{
    "body": "<a id='comment:5'></a>J'ai du oubli\u00e9 le fichier `sage/groups/perm_gps/constructor.py`.",
    "created_at": "2019-10-26T01:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556213",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>J'ai du oublié le fichier `sage/groups/perm_gps/constructor.py`.



---

archive/issue_comments_556214.json:
```json
{
    "body": "Changing commit from \"050a6b46f89dd606486409e8794a686d88e9e862\" to \"e8c425bf32f0c4663637ea8f9260af5e61234ea1\"",
    "created_at": "2019-10-26T02:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "050a6b46f89dd606486409e8794a686d88e9e862" to "e8c425bf32f0c4663637ea8f9260af5e61234ea1"



---

archive/issue_comments_556215.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-26T02:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556216.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-26T02:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556216",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_556217.json:
```json
{
    "body": "<a id='comment:8'></a>failing doctests with py3 and pyflakes warnings, see the latest patchbot report",
    "created_at": "2019-10-26T09:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556217",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>failing doctests with py3 and pyflakes warnings, see the latest patchbot report



---

archive/issue_comments_556218.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-26T09:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556218",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_556219.json:
```json
{
    "body": "Changing commit from \"e8c425bf32f0c4663637ea8f9260af5e61234ea1\" to \"1903676e9ab596b7c4a8e8dc08b7348a34ad6a0e\"",
    "created_at": "2019-10-28T03:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e8c425bf32f0c4663637ea8f9260af5e61234ea1" to "1903676e9ab596b7c4a8e8dc08b7348a34ad6a0e"



---

archive/issue_comments_556220.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-10-28T03:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_556221.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-28T03:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556221",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_556222.json:
```json
{
    "body": "<a id='comment:11'></a>(rebased on 9.0.beta3)",
    "created_at": "2019-10-28T03:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556222",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>(rebased on 9.0.beta3)



---

archive/issue_comments_556223.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-28T12:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556223",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_556224.json:
```json
{
    "body": "<a id='comment:12'></a>badly broken and\n\n```\n+src/sage/combinat/permutation.py:256: 'sage.groups.perm_gps.constructor.PermutationGroupElement as PermutationConstructor' imported but unused\n+src/sage/combinat/permutation.py:439: undefined name 'PermutationGroupElement'\n+src/sage/combinat/permutation.py:6911: undefined name 'PermutationGroupElement'\n+\n+src/sage/geometry/polyhedron/normaliz_file_format.py:25: undefined name 'key'\n+src/sage/geometry/polyhedron/normaliz_file_format.py:30: undefined name 'key'\n+src/sage/geometry/polyhedron/normaliz_file_format.py:34: undefined name 'QQ'\n+src/sage/geometry/polyhedron/normaliz_file_format.py:38: undefined name 'x'\n```",
    "created_at": "2019-10-28T12:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556224",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>badly broken and

```
+src/sage/combinat/permutation.py:256: 'sage.groups.perm_gps.constructor.PermutationGroupElement as PermutationConstructor' imported but unused
+src/sage/combinat/permutation.py:439: undefined name 'PermutationGroupElement'
+src/sage/combinat/permutation.py:6911: undefined name 'PermutationGroupElement'
+
+src/sage/geometry/polyhedron/normaliz_file_format.py:25: undefined name 'key'
+src/sage/geometry/polyhedron/normaliz_file_format.py:30: undefined name 'key'
+src/sage/geometry/polyhedron/normaliz_file_format.py:34: undefined name 'QQ'
+src/sage/geometry/polyhedron/normaliz_file_format.py:38: undefined name 'x'
```



---

archive/issue_comments_556225.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-10-28T12:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_556226.json:
```json
{
    "body": "Changing commit from \"1903676e9ab596b7c4a8e8dc08b7348a34ad6a0e\" to \"1432b7ba16c98264e7cac3b61f4a8f2b6c195922\"",
    "created_at": "2019-10-28T12:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1903676e9ab596b7c4a8e8dc08b7348a34ad6a0e" to "1432b7ba16c98264e7cac3b61f4a8f2b6c195922"



---

archive/issue_comments_556227.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-28T12:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556227",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_556228.json:
```json
{
    "body": "<a id='comment:14'></a>D\u00e9sol\u00e9. J'ai fait n'importe quoi avec la branche.",
    "created_at": "2019-10-28T12:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556228",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>Désolé. J'ai fait n'importe quoi avec la branche.



---

archive/issue_comments_556229.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-28T14:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556230.json:
```json
{
    "body": "Changing commit from \"1432b7ba16c98264e7cac3b61f4a8f2b6c195922\" to \"da341eb7effb50095689b9a0920146788052c832\"",
    "created_at": "2019-10-28T14:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1432b7ba16c98264e7cac3b61f4a8f2b6c195922" to "da341eb7effb50095689b9a0920146788052c832"



---

archive/issue_comments_556231.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,39 @@\n+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.\n \n+Here are some performance gain comparing 9.0.beta3 (\"OLD\") against the code provided in the branch (\"NEW\")\n+- Constructor\n+\n+```\n+sage: S = SymmetricGroup(10)\n+sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])\n+NEW: 10000 loops, best of 5: 155 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 227 \u00b5s per loop\n+sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])\n+NEW: 10000 loops, best of 5: 168 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 201 \u00b5s per loop\n+```\n+- iteration of monogen group\n+\n+```\n+sage: P = S.subgroup([(1,2,3,4,5,6)])\n+sage: %timeit for p in P: pass\n+NEW: 100000 loops, best of 5: 2.71 \u00b5s per loop\n+OLD: 1000 loops, best of 5: 252 \u00b5s per loop\n+```\n+- multiplication of permutation with distinct parents\n+\n+```\n+sage: S = SymmetricGroup(7)\n+sage: P = S.subgroup([(1,2,3,4,5,6,7)])\n+sage: L1 = list(S)\n+sage: L2 = list(P)\n+sage: %%time\n+....: for s1 in L1:\n+....:     for s2 in L2:\n+....:         q = s1 * s2\n+NEW: Wall time: 11.4 ms\n+OLD: Wall time: 1.42 s\n+```\n \n Author: Vincent Delecroix\n \n``````\n",
    "created_at": "2019-10-28T14:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556231",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,39 @@
+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.
 
+Here are some performance gain comparing 9.0.beta3 ("OLD") against the code provided in the branch ("NEW")
+- Constructor
+
+```
+sage: S = SymmetricGroup(10)
+sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])
+NEW: 10000 loops, best of 5: 155 µs per loop
+OLD: 10000 loops, best of 5: 227 µs per loop
+sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])
+NEW: 10000 loops, best of 5: 168 µs per loop
+OLD: 10000 loops, best of 5: 201 µs per loop
+```
+- iteration of monogen group
+
+```
+sage: P = S.subgroup([(1,2,3,4,5,6)])
+sage: %timeit for p in P: pass
+NEW: 100000 loops, best of 5: 2.71 µs per loop
+OLD: 1000 loops, best of 5: 252 µs per loop
+```
+- multiplication of permutation with distinct parents
+
+```
+sage: S = SymmetricGroup(7)
+sage: P = S.subgroup([(1,2,3,4,5,6,7)])
+sage: L1 = list(S)
+sage: L2 = list(P)
+sage: %%time
+....: for s1 in L1:
+....:     for s2 in L2:
+....:         q = s1 * s2
+NEW: Wall time: 11.4 ms
+OLD: Wall time: 1.42 s
+```
 
 Author: Vincent Delecroix
 
``````




---

archive/issue_comments_556232.json:
```json
{
    "body": "<a id='comment:17'></a>This is still room for improvement for the constructor as it is 10x slower than\n\n```\nsage: %timeit -n 10000 Permutation([3,1,7,6,8,2,9,10,5,4])\n10000 loops, best of 5: 15 \u00b5s per loop\n```\nThough, with `check=False` it is now faster\n\n```\nsage: S = SymmetricGroup(10)\nsage: %timeit -n 10000 S([3,1,7,6,8,2,9,10,5,4], check=False)\nNEW: 10000 loops, best of 5: 4.16 \u00b5s per loop\nOLD: 10000 loops, best of 5: 59.3 \u00b5s per loop\n```",
    "created_at": "2019-10-28T14:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556232",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>This is still room for improvement for the constructor as it is 10x slower than

```
sage: %timeit -n 10000 Permutation([3,1,7,6,8,2,9,10,5,4])
10000 loops, best of 5: 15 µs per loop
```
Though, with `check=False` it is now faster

```
sage: S = SymmetricGroup(10)
sage: %timeit -n 10000 S([3,1,7,6,8,2,9,10,5,4], check=False)
NEW: 10000 loops, best of 5: 4.16 µs per loop
OLD: 10000 loops, best of 5: 59.3 µs per loop
```



---

archive/issue_comments_556233.json:
```json
{
    "body": "<a id='comment:18'></a>I don't quite understand\n\n```\n+[dochtml] Error building the documentation.\n+[dochtml] Traceback (most recent call last):\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n+[dochtml]     \"__main__\", fname, loader, pkg_name)\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/runpy.py\", line 72, in _run_code\n+[dochtml]     exec code in run_globals\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n+[dochtml]     main()\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1693, in main\n+[dochtml]     builder()\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 327, in _wrapper\n+[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 526, in _wrapper\n+[dochtml]     build_many(build_ref_doc, L)\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 280, in build_many\n+[dochtml]     _build_many(target, args, processes=NUM_THREADS)\n+[dochtml]   File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/utils.py\", line 283, in build_many\n+[dochtml]     raise worker_exc.original_exception\n+[dochtml] OSError: docstring of sage.plot.plot3d.base.Graphics3d.stl_ascii_string:48: WARNING: Block quote ends without a blank line; unexpected unindent.\n+Makefile:2040: recipe for target 'doc-html' failed\n```",
    "created_at": "2019-10-28T15:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556233",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>I don't quite understand

```
+[dochtml] Error building the documentation.
+[dochtml] Traceback (most recent call last):
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
+[dochtml]     "__main__", fname, loader, pkg_name)
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
+[dochtml]     exec code in run_globals
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
+[dochtml]     main()
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1693, in main
+[dochtml]     builder()
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 327, in _wrapper
+[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 526, in _wrapper
+[dochtml]     build_many(build_ref_doc, L)
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 280, in build_many
+[dochtml]     _build_many(target, args, processes=NUM_THREADS)
+[dochtml]   File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/utils.py", line 283, in build_many
+[dochtml]     raise worker_exc.original_exception
+[dochtml] OSError: docstring of sage.plot.plot3d.base.Graphics3d.stl_ascii_string:48: WARNING: Block quote ends without a blank line; unexpected unindent.
+Makefile:2040: recipe for target 'doc-html' failed
```



---

archive/issue_comments_556234.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-28T16:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556235.json:
```json
{
    "body": "Changing commit from \"da341eb7effb50095689b9a0920146788052c832\" to \"0ae58b68354c706ec2a6e590e6e9b468e34fafcc\"",
    "created_at": "2019-10-28T16:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "da341eb7effb50095689b9a0920146788052c832" to "0ae58b68354c706ec2a6e590e6e9b468e34fafcc"



---

archive/issue_comments_556236.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-28T16:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556237.json:
```json
{
    "body": "Changing commit from \"0ae58b68354c706ec2a6e590e6e9b468e34fafcc\" to \"49dce983238ef7755e43e606e291573d9be68121\"",
    "created_at": "2019-10-28T16:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556237",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0ae58b68354c706ec2a6e590e6e9b468e34fafcc" to "49dce983238ef7755e43e606e291573d9be68121"



---

archive/issue_comments_556238.json:
```json
{
    "body": "<a id='comment:21'></a>please undo your last change, and add a note besides saying DO NOT REMOVE",
    "created_at": "2019-10-28T16:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556238",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>please undo your last change, and add a note besides saying DO NOT REMOVE



---

archive/issue_comments_556239.json:
```json
{
    "body": "<a id='comment:22'></a>Why? The function call has a side effect. Not the affectation. Doesn't it?",
    "created_at": "2019-10-28T16:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556239",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>Why? The function call has a side effect. Not the affectation. Doesn't it?



---

archive/issue_comments_556240.json:
```json
{
    "body": "<a id='comment:23'></a>Well, it seems to have, if I remember correctly.Maybe some kind of reference-keeping, or whatever. This is not the first removal tentative, nad we should have added the warning before.",
    "created_at": "2019-10-28T16:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556240",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>Well, it seems to have, if I remember correctly.Maybe some kind of reference-keeping, or whatever. This is not the first removal tentative, nad we should have added the warning before.



---

archive/issue_comments_556241.json:
```json
{
    "body": "Changing commit from \"49dce983238ef7755e43e606e291573d9be68121\" to \"20e30ade9751f27ef30ea8d528468c9ce3a4b496\"",
    "created_at": "2019-10-28T17:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "49dce983238ef7755e43e606e291573d9be68121" to "20e30ade9751f27ef30ea8d528468c9ce3a4b496"



---

archive/issue_comments_556242.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-10-28T17:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_556243.json:
```json
{
    "body": "<a id='comment:25'></a>Cette fois le patchbot est content!",
    "created_at": "2019-10-29T13:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556243",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>Cette fois le patchbot est content!



---

archive/issue_comments_556244.json:
```json
{
    "body": "<a id='comment:26'></a>(1) May we please have, in the new file src/sage/groups/perm_gps/constructor.py:\n\n* some more explanations of what it contains and how it should be used\n\n* the standard Gnu license header\n\n* include this file in the doc somewhere\n\n(2) Typo: \"the code is assumes\"\n\n(3) please wrap the very long line starting \"raise ValueError(\"the parent must be provided to initialize a class Perm\"",
    "created_at": "2019-10-29T19:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556244",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>(1) May we please have, in the new file src/sage/groups/perm_gps/constructor.py:

* some more explanations of what it contains and how it should be used

* the standard Gnu license header

* include this file in the doc somewhere

(2) Typo: "the code is assumes"

(3) please wrap the very long line starting "raise ValueError("the parent must be provided to initialize a class Perm"



---

archive/issue_comments_556245.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-30T02:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556246.json:
```json
{
    "body": "Changing commit from \"20e30ade9751f27ef30ea8d528468c9ce3a4b496\" to \"931a5b17fa7299f70ff33d713324d323bda2b4ce\"",
    "created_at": "2019-10-30T02:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "20e30ade9751f27ef30ea8d528468c9ce3a4b496" to "931a5b17fa7299f70ff33d713324d323bda2b4ce"



---

archive/issue_comments_556247.json:
```json
{
    "body": "<a id='comment:28'></a>Thanks. Done!",
    "created_at": "2019-10-30T02:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556247",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>Thanks. Done!



---

archive/issue_comments_556248.json:
```json
{
    "body": "<a id='comment:29'></a>`@`Fr\u00e9d\u00e9ric: any further comment?",
    "created_at": "2019-10-31T15:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556248",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'></a>`@`Frédéric: any further comment?



---

archive/issue_comments_556249.json:
```json
{
    "body": "<a id='comment:30'></a>Some little details in the `constructor.py`:\n\n- `{1, ..., n}` -> `\\{1, \\ldots, n\\}` and in latex format (this gets automatically changed when called as `?` doc).\n- The error message should start with a lower case (a Python convention).\n\nShould the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.\n\nI am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.",
    "created_at": "2019-10-31T22:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556249",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>Some little details in the `constructor.py`:

- `{1, ..., n}` -> `\{1, \ldots, n\}` and in latex format (this gets automatically changed when called as `?` doc).
- The error message should start with a lower case (a Python convention).

Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.

I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.



---

archive/issue_comments_556250.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 tscrim]:\n> Some little details in the `constructor.py`:\n> \n> - `{1, ..., n}` -> `\\{1, \\ldots, n\\}` and in latex format (this gets automatically changed when called as `?` doc).\n> - The error message should start with a lower case (a Python convention).\n> \n> Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.\n\n\nBut then you can not call it from Python code.\n\n> I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.\n\n\nYou can not avoid having it in a separate file since they have the same name :-) Also the constructor file is pure python. I don't see the point of making it extremely fast. What is relevant is the timing I put in the ticket description (ie the `_element_constructor_` of permutation groups). Contrarily to the `PermutationGroupElement` constructor, the `_element_constructor_` of the parent is used by any method of permutation group that has to create elements.",
    "created_at": "2019-10-31T22:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556250",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>Replying to [comment:30 tscrim]:
> Some little details in the `constructor.py`:
> 
> - `{1, ..., n}` -> `\{1, \ldots, n\}` and in latex format (this gets automatically changed when called as `?` doc).
> - The error message should start with a lower case (a Python convention).
> 
> Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.


But then you can not call it from Python code.

> I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.


You can not avoid having it in a separate file since they have the same name :-) Also the constructor file is pure python. I don't see the point of making it extremely fast. What is relevant is the timing I put in the ticket description (ie the `_element_constructor_` of permutation groups). Contrarily to the `PermutationGroupElement` constructor, the `_element_constructor_` of the parent is used by any method of permutation group that has to create elements.



---

archive/issue_comments_556251.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 vdelecroix]:\n> Replying to [comment:30 tscrim]:\n> > Some little details in the `constructor.py`:\n> > \n> > - `{1, ..., n}` -> `\\{1, \\ldots, n\\}` and in latex format (this gets automatically changed when called as `?` doc).\n> > - The error message should start with a lower case (a Python convention).\n> > \n> > Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.\n\n> \n> But then you can not call it from Python code.\n\n\nOf course, but do we really want to be able to do that? They seem very internal and are only meant to be called as part of the constructor.\n\n> > I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.\n\n> \n> You can not avoid having it in a separate file since they have the same name :-) Also the constructor file is pure python. I don't see the point of making it extremely fast. What is relevant is the timing I put in the ticket description (ie the `_element_constructor_` of permutation groups). Contrarily to the `PermutationGroupElement` constructor, the `_element_constructor_` of the parent is used by any method of permutation group that has to create elements.\n\n\nThe name can easily be changed. `;)`  Although it sounds like what you are saying is that in library code, we should not use the constructor function. Why not also try and make it fast too? I trying to understand the logic of your design, and I am not saying it is bad/wrong, but I just don't yet comprehend it yet.",
    "created_at": "2019-10-31T22:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556251",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>Replying to [comment:31 vdelecroix]:
> Replying to [comment:30 tscrim]:
> > Some little details in the `constructor.py`:
> > 
> > - `{1, ..., n}` -> `\{1, \ldots, n\}` and in latex format (this gets automatically changed when called as `?` doc).
> > - The error message should start with a lower case (a Python convention).
> > 
> > Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.

> 
> But then you can not call it from Python code.


Of course, but do we really want to be able to do that? They seem very internal and are only meant to be called as part of the constructor.

> > I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.

> 
> You can not avoid having it in a separate file since they have the same name :-) Also the constructor file is pure python. I don't see the point of making it extremely fast. What is relevant is the timing I put in the ticket description (ie the `_element_constructor_` of permutation groups). Contrarily to the `PermutationGroupElement` constructor, the `_element_constructor_` of the parent is used by any method of permutation group that has to create elements.


The name can easily be changed. `;)`  Although it sounds like what you are saying is that in library code, we should not use the constructor function. Why not also try and make it fast too? I trying to understand the logic of your design, and I am not saying it is bad/wrong, but I just don't yet comprehend it yet.



---

archive/issue_comments_556252.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 tscrim]:\n> Replying to [comment:31 vdelecroix]:\n> > Replying to [comment:30 tscrim]:\n> > > Some little details in the `constructor.py`:\n> > > \n> > > - `{1, ..., n}` -> `\\{1, \\ldots, n\\}` and in latex format (this gets automatically changed when called as `?` doc).\n> > > - The error message should start with a lower case (a Python convention).\n> > > \n> > > Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.\n\n> > \n> > But then you can not call it from Python code.\n\n> \n> Of course, but do we really want to be able to do that? They seem very internal and are only meant to be called as part of the constructor.\n\n\nIt is always convenient to be able to mutate a permutation without having to reallocate space for a new permutation. Even from Python. This hidden cpdef functions allows me to do the following\n\n```\nsage: from itertools import permutations\nsage: p = PermutationGroupElement([1,2,3,4,5])\nsage: %time for q in permutations([1,2,3,4,5]): p._set_list_images(q, False)\nWall time: 45.1 \u00b5s\n```\nThe above is very convenient and infinitely faster than\n\n```\nsage: S = SymmetricGroup(5)\nsage: %time for q in permutations([1,2,3,4,5]): p = S(q)\nWall time: 22.6 ms\n```\n\nAs far as performance are concerned, I don't believe that here `cpdef` vs `cdef` matter in any way. Since `cdef` is just less flexible I would just stick with `cpdef`.\n\n> > > I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.\n\n> > \n> > You can not avoid having it in a separate file since they have the same name :-) Also the constructor file is pure python. I don't see the point of making it extremely fast. What is relevant is the timing I put in the ticket description (ie the `_element_constructor_` of permutation groups). Contrarily to the `PermutationGroupElement` constructor, the `_element_constructor_` of the parent is used by any method of permutation group that has to create elements.\n\n> \n> The name can easily be changed. `;)`  Although it sounds like what you are saying is that in library code, we should not use the constructor function.\n\n\nYes. You should use `my_parent(data)` and not `GenericConstructor(data)`. This is what is done everywhere in `sage.groups.perm_gps` (and also for matrix and co). I am not introducing any new design here.\n\n> Why not also try and make it fast too?\n\n\nYou are welcome to do so. But it comes as a second step anyway.\n\n> I trying to understand the logic of your design, and I am not saying it is bad/wrong, but I just don't yet comprehend it yet.\n\n\nI hope I clarified it :-)",
    "created_at": "2019-10-31T23:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556252",
    "user": "https://github.com/videlec"
}
```

<a id='comment:33'></a>Replying to [comment:32 tscrim]:
> Replying to [comment:31 vdelecroix]:
> > Replying to [comment:30 tscrim]:
> > > Some little details in the `constructor.py`:
> > > 
> > > - `{1, ..., n}` -> `\{1, \ldots, n\}` and in latex format (this gets automatically changed when called as `?` doc).
> > > - The error message should start with a lower case (a Python convention).
> > > 
> > > Should the `_set_*` really be `cpdef` and not just `cdef`? Past experiments I've done have shown that `cpdef` is slower.

> > 
> > But then you can not call it from Python code.

> 
> Of course, but do we really want to be able to do that? They seem very internal and are only meant to be called as part of the constructor.


It is always convenient to be able to mutate a permutation without having to reallocate space for a new permutation. Even from Python. This hidden cpdef functions allows me to do the following

```
sage: from itertools import permutations
sage: p = PermutationGroupElement([1,2,3,4,5])
sage: %time for q in permutations([1,2,3,4,5]): p._set_list_images(q, False)
Wall time: 45.1 µs
```
The above is very convenient and infinitely faster than

```
sage: S = SymmetricGroup(5)
sage: %time for q in permutations([1,2,3,4,5]): p = S(q)
Wall time: 22.6 ms
```

As far as performance are concerned, I don't believe that here `cpdef` vs `cdef` matter in any way. Since `cdef` is just less flexible I would just stick with `cpdef`.

> > > I am not sure I see the point of having the constructor in a separate file. It also causes us to do two imports in what I would see as the most common scenario, when `parent is None`. Also, in that case, I don't see the point of doing the check again since it was already done in constructing the parent. In other words, I think you should add `check = False` to that case.

> > 
> > You can not avoid having it in a separate file since they have the same name :-) Also the constructor file is pure python. I don't see the point of making it extremely fast. What is relevant is the timing I put in the ticket description (ie the `_element_constructor_` of permutation groups). Contrarily to the `PermutationGroupElement` constructor, the `_element_constructor_` of the parent is used by any method of permutation group that has to create elements.

> 
> The name can easily be changed. `;)`  Although it sounds like what you are saying is that in library code, we should not use the constructor function.


Yes. You should use `my_parent(data)` and not `GenericConstructor(data)`. This is what is done everywhere in `sage.groups.perm_gps` (and also for matrix and co). I am not introducing any new design here.

> Why not also try and make it fast too?


You are welcome to do so. But it comes as a second step anyway.

> I trying to understand the logic of your design, and I am not saying it is bad/wrong, but I just don't yet comprehend it yet.


I hope I clarified it :-)



---

archive/issue_comments_556253.json:
```json
{
    "body": "Changing component from combinatorics to performance.",
    "created_at": "2019-11-06T06:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556253",
    "user": "https://github.com/tscrim"
}
```

Changing component from combinatorics to performance.



---

archive/issue_comments_556254.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/28652\" to \"public/perm_groups/constructor_perm_gp_elt-28652\"",
    "created_at": "2019-11-06T06:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556254",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/vdelecroix/28652" to "public/perm_groups/constructor_perm_gp_elt-28652"



---

archive/issue_comments_556255.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 vdelecroix]:\n> Replying to [comment:32 tscrim]:\n> > Replying to [comment:31 vdelecroix]:\n> > > Replying to [comment:30 tscrim]:\n\n> It is always convenient to be able to mutate a permutation without having to reallocate space for a new permutation. Even from Python. This hidden cpdef functions allows me to do the following\n> {{{\n> sage: from itertools import permutations\n> sage: p = PermutationGroupElement([1,2,3,4,5])\n> sage: %time for q in permutations([1,2,3,4,5]): p._set_list_images(q, False)\n> Wall time: 45.1 \u00b5s\n> }}}\n> The above is very convenient and infinitely faster than\n> \n> ```\n> sage: S = SymmetricGroup(5)\n> sage: %time for q in permutations([1,2,3,4,5]): p = S(q)\n> Wall time: 22.6 ms\n> ```\n\n\nThat is an abuse of the code IMO (borderlining on a straw-man argument). You really should just be iterating over the corresponding permutation group here. However, I will not be arguing this point (see below).\n\n> As far as performance are concerned, I don't believe that here `cpdef` vs `cdef` matter in any way. Since `cdef` is just less flexible I would just stick with `cpdef`.\n\n\nI have seen slowdowns when writing things with `cpdef` versus `cdef`. In particular this comes from indirect calls:\n\n```\nsage: %%cython\n....: cpdef int f_cpdef():\n....:     return 5\n....: cdef int f_cdef():\n....:     return 5\n....: cdef int indirect_cpdef():\n....:     return f_cpdef()\n....: cdef int indirect_cdef():\n....:     return f_cdef()\n....: def test_cpdef():\n....:     return indirect_cpdef()\n....: def test_cdef():\n....:     return indirect_cdef()\n....: \nsage: %timeit test_cdef()\n100000000 loops, best of 3: 19.3 ns per loop\nsage: %timeit test_cpdef()\n100000000 loops, best of 3: 19.4 ns per loop\n```\nYes, I know ~1% slowdown is not much, but I am consistently getting it and it can stack up. I have seen 10-20% slowdowns in actual code by changing `cdef` to `cpdef`. Although this might not still exist in the current Cython version. I also am not noticing any change in timings for the simple tests I am running. So this isn't anything worth arguing about, but I just wanted to point it out.\n\n> > The name can easily be changed. `;)`  Although it sounds like what you are saying is that in library code, we should not use the constructor function.\n\n> \n> Yes. You should use `my_parent(data)` and not `GenericConstructor(data)`. This is what is done everywhere in `sage.groups.perm_gps` (and also for matrix and co). I am not introducing any new design here.\n\n\nWell, I guess you are making an equal swap in the other parts of the library code. Although we do get a bit of a slowdown:\n\n```\nsage: %timeit PermutationGroupElement([1,5,3,2,4])\nNEW: 10000 loops, best of 3: 167 \u00b5s per loop\nOLD: 10000 loops, best of 3: 162 \u00b5s per loop\n```\nHowever, this isn't really a big deal.\n\n> > Why not also try and make it fast too?\n\n> \n> You are welcome to do so. But it comes as a second step anyway.\n\n\nI also removed some of the to-and-from cycles in constructing permutation group elements. The code is a little more complex, but it does pick up some speed.\nTimings that have changed versus your branch:\n\n```\nsage: from sage.groups.perm_gps.permgroup_element import standardize_generator\nsage: %timeit standardize_generator([3,1,7,6,8,2,9,10,5,4])\nNEW: 100000 loops, best of 3: 3.65 \u00b5s per loop\nOLD: 10000 loops, best of 3: 22.4 \u00b5s per loop\nsage: g1 = PermutationGroupElement([(1,2),(3,4,5)])\nsage: g2 = PermutationGroup([('a','b')], domain=['a', 'b']).gens()[0]\nsage: %timeit g1 * g2\nNEW: 10000 loops, best of 3: 37.5 \u00b5s per loop\nOLD: 10000 loops, best of 3: 38.6 \u00b5s per loop\nsage: S = SymmetricGroup(10)\nsage: P = S.subgroup([(1,2,3,4,5,6,7)])\nsage: %timeit for p in P: S(p)\nNEW: 100000 loops, best of 3: 15.9 \u00b5s per loop\nOLD: 10000 loops, best of 3: 19.9 \u00b5s per loop\n```\n\nLet me know what you think.\n\n---\nNew commits:",
    "created_at": "2019-11-06T06:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556255",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>Replying to [comment:33 vdelecroix]:
> Replying to [comment:32 tscrim]:
> > Replying to [comment:31 vdelecroix]:
> > > Replying to [comment:30 tscrim]:

> It is always convenient to be able to mutate a permutation without having to reallocate space for a new permutation. Even from Python. This hidden cpdef functions allows me to do the following
> {{{
> sage: from itertools import permutations
> sage: p = PermutationGroupElement([1,2,3,4,5])
> sage: %time for q in permutations([1,2,3,4,5]): p._set_list_images(q, False)
> Wall time: 45.1 µs
> }}}
> The above is very convenient and infinitely faster than
> 
> ```
> sage: S = SymmetricGroup(5)
> sage: %time for q in permutations([1,2,3,4,5]): p = S(q)
> Wall time: 22.6 ms
> ```


That is an abuse of the code IMO (borderlining on a straw-man argument). You really should just be iterating over the corresponding permutation group here. However, I will not be arguing this point (see below).

> As far as performance are concerned, I don't believe that here `cpdef` vs `cdef` matter in any way. Since `cdef` is just less flexible I would just stick with `cpdef`.


I have seen slowdowns when writing things with `cpdef` versus `cdef`. In particular this comes from indirect calls:

```
sage: %%cython
....: cpdef int f_cpdef():
....:     return 5
....: cdef int f_cdef():
....:     return 5
....: cdef int indirect_cpdef():
....:     return f_cpdef()
....: cdef int indirect_cdef():
....:     return f_cdef()
....: def test_cpdef():
....:     return indirect_cpdef()
....: def test_cdef():
....:     return indirect_cdef()
....: 
sage: %timeit test_cdef()
100000000 loops, best of 3: 19.3 ns per loop
sage: %timeit test_cpdef()
100000000 loops, best of 3: 19.4 ns per loop
```
Yes, I know ~1% slowdown is not much, but I am consistently getting it and it can stack up. I have seen 10-20% slowdowns in actual code by changing `cdef` to `cpdef`. Although this might not still exist in the current Cython version. I also am not noticing any change in timings for the simple tests I am running. So this isn't anything worth arguing about, but I just wanted to point it out.

> > The name can easily be changed. `;)`  Although it sounds like what you are saying is that in library code, we should not use the constructor function.

> 
> Yes. You should use `my_parent(data)` and not `GenericConstructor(data)`. This is what is done everywhere in `sage.groups.perm_gps` (and also for matrix and co). I am not introducing any new design here.


Well, I guess you are making an equal swap in the other parts of the library code. Although we do get a bit of a slowdown:

```
sage: %timeit PermutationGroupElement([1,5,3,2,4])
NEW: 10000 loops, best of 3: 167 µs per loop
OLD: 10000 loops, best of 3: 162 µs per loop
```
However, this isn't really a big deal.

> > Why not also try and make it fast too?

> 
> You are welcome to do so. But it comes as a second step anyway.


I also removed some of the to-and-from cycles in constructing permutation group elements. The code is a little more complex, but it does pick up some speed.
Timings that have changed versus your branch:

```
sage: from sage.groups.perm_gps.permgroup_element import standardize_generator
sage: %timeit standardize_generator([3,1,7,6,8,2,9,10,5,4])
NEW: 100000 loops, best of 3: 3.65 µs per loop
OLD: 10000 loops, best of 3: 22.4 µs per loop
sage: g1 = PermutationGroupElement([(1,2),(3,4,5)])
sage: g2 = PermutationGroup([('a','b')], domain=['a', 'b']).gens()[0]
sage: %timeit g1 * g2
NEW: 10000 loops, best of 3: 37.5 µs per loop
OLD: 10000 loops, best of 3: 38.6 µs per loop
sage: S = SymmetricGroup(10)
sage: P = S.subgroup([(1,2,3,4,5,6,7)])
sage: %timeit for p in P: S(p)
NEW: 100000 loops, best of 3: 15.9 µs per loop
OLD: 10000 loops, best of 3: 19.9 µs per loop
```

Let me know what you think.

---
New commits:



---

archive/issue_comments_556256.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2019-11-06T06:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556256",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_556257.json:
```json
{
    "body": "Changing commit from \"931a5b17fa7299f70ff33d713324d323bda2b4ce\" to \"1cdef35cdf01b437bc569a47e006e264f3306a8f\"",
    "created_at": "2019-11-06T06:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556257",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "931a5b17fa7299f70ff33d713324d323bda2b4ce" to "1cdef35cdf01b437bc569a47e006e264f3306a8f"



---

archive/issue_comments_556258.json:
```json
{
    "body": "<a id='comment:35'></a>Hi Travis,\n\nWhy did you remove\n\n```diff\n@@ -507,12 +505,6 @@ cdef class PermutationGroupElement(MultiplicativeGroupElement):\n             ...\n             ValueError: invalid list of cycles to initialize a permutation\n         \"\"\"\n-        if parent is None:\n-            raise ValueError(\"the parent must be provided to initialize a class \"\n-                    \"PermutationGroupElement; use sage.groups.perm_groups.\"\n-                    \"constructor.PermutationGroupElement if you need the more \"\n-                    \"general constructor\")\n-\n```\nIt is intended as a deprecation message for people that would still use the class as the constructor.",
    "created_at": "2019-11-06T14:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556258",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'></a>Hi Travis,

Why did you remove

```diff
@@ -507,12 +505,6 @@ cdef class PermutationGroupElement(MultiplicativeGroupElement):
             ...
             ValueError: invalid list of cycles to initialize a permutation
         """
-        if parent is None:
-            raise ValueError("the parent must be provided to initialize a class "
-                    "PermutationGroupElement; use sage.groups.perm_groups."
-                    "constructor.PermutationGroupElement if you need the more "
-                    "general constructor")
-
```
It is intended as a deprecation message for people that would still use the class as the constructor.



---

archive/issue_comments_556259.json:
```json
{
    "body": "<a id='comment:36'></a>An error is not a deprecation message, and this way has the same effect with being more Pythonic. Really that information should be contained in the documentation anyways. Plus, if someone is now getting an error, it means they are explicitly importing it, which is only likely happen in library code.",
    "created_at": "2019-11-06T23:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556259",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>An error is not a deprecation message, and this way has the same effect with being more Pythonic. Really that information should be contained in the documentation anyways. Plus, if someone is now getting an error, it means they are explicitly importing it, which is only likely happen in library code.



---

archive/issue_comments_556260.json:
```json
{
    "body": "<a id='comment:37'></a>In the current version we have\n\n```\nsage: SymmetricGroup(['a','b','c'])(libgap.eval(\"(1,2,3)\"))\n('a','b','c')\n```\nThe above allows (very indirectly) to make the following \"works\"\n\n```\nsage: PermutationGroup(gap_group=libgap.SymmetricGroup(5), domain=[1,3,5,7,9])\nPermutation Group with generators [(1,3), (1,3,5,7,9)]\n```\nBut to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.\n\nWhat do you think?",
    "created_at": "2019-11-11T05:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556260",
    "user": "https://github.com/videlec"
}
```

<a id='comment:37'></a>In the current version we have

```
sage: SymmetricGroup(['a','b','c'])(libgap.eval("(1,2,3)"))
('a','b','c')
```
The above allows (very indirectly) to make the following "works"

```
sage: PermutationGroup(gap_group=libgap.SymmetricGroup(5), domain=[1,3,5,7,9])
Permutation Group with generators [(1,3), (1,3,5,7,9)]
```
But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.

What do you think?



---

archive/issue_comments_556261.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-11-11T05:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556261",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_556262.json:
```json
{
    "body": "Changing commit from \"1cdef35cdf01b437bc569a47e006e264f3306a8f\" to \"f085dc19dbb65eb890cac338b18f743845f38a32\"",
    "created_at": "2019-11-11T05:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556262",
    "user": "https://github.com/videlec"
}
```

Changing commit from "1cdef35cdf01b437bc569a47e006e264f3306a8f" to "f085dc19dbb65eb890cac338b18f743845f38a32"



---

archive/issue_comments_556263.json:
```json
{
    "body": "<a id='comment:38'></a>Last 10 new commits:",
    "created_at": "2019-11-11T05:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556263",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'></a>Last 10 new commits:



---

archive/issue_comments_556264.json:
```json
{
    "body": "Changing branch from \"public/perm_groups/constructor_perm_gp_elt-28652\" to \"u/vdelecroix/28652\"",
    "created_at": "2019-11-11T05:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556264",
    "user": "https://github.com/videlec"
}
```

Changing branch from "public/perm_groups/constructor_perm_gp_elt-28652" to "u/vdelecroix/28652"



---

archive/issue_comments_556265.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:37 vdelecroix]:\n> But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.\n> \n> What do you think?\n\n\nMy understanding is that `(lip)gap` only allows for a domain of `{1, ..., n}`. So in my mind this could almost be considered a \"feature\" of the Sage interface with `(lib)gap`. As such, I am leaning towards actually keeping the current behavior.\n\nIt would be nice if we could get rid of all those local imports in the `_set_other`...",
    "created_at": "2019-11-11T05:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556265",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>Replying to [comment:37 vdelecroix]:
> But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.
> 
> What do you think?


My understanding is that `(lip)gap` only allows for a domain of `{1, ..., n}`. So in my mind this could almost be considered a "feature" of the Sage interface with `(lib)gap`. As such, I am leaning towards actually keeping the current behavior.

It would be nice if we could get rid of all those local imports in the `_set_other`...



---

archive/issue_comments_556266.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/28652\" to \"public/perm_groups/constructor_perm_gp_elt-28652\"",
    "created_at": "2019-11-11T05:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556266",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/vdelecroix/28652" to "public/perm_groups/constructor_perm_gp_elt-28652"



---

archive/issue_comments_556267.json:
```json
{
    "body": "Changing commit from \"f085dc19dbb65eb890cac338b18f743845f38a32\" to \"1cdef35cdf01b437bc569a47e006e264f3306a8f\"",
    "created_at": "2019-11-11T05:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556267",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "f085dc19dbb65eb890cac338b18f743845f38a32" to "1cdef35cdf01b437bc569a47e006e264f3306a8f"



---

archive/issue_comments_556268.json:
```json
{
    "body": "<a id='comment:40'></a>Last 10 new commits:",
    "created_at": "2019-11-11T05:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556268",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>Last 10 new commits:



---

archive/issue_comments_556269.json:
```json
{
    "body": "Changing commit from \"1cdef35cdf01b437bc569a47e006e264f3306a8f\" to \"f085dc19dbb65eb890cac338b18f743845f38a32\"",
    "created_at": "2019-11-11T05:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556269",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "1cdef35cdf01b437bc569a47e006e264f3306a8f" to "f085dc19dbb65eb890cac338b18f743845f38a32"



---

archive/issue_comments_556270.json:
```json
{
    "body": "Changing branch from \"public/perm_groups/constructor_perm_gp_elt-28652\" to \"u/vdelecroix/28652\"",
    "created_at": "2019-11-11T05:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556270",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "public/perm_groups/constructor_perm_gp_elt-28652" to "u/vdelecroix/28652"



---

archive/issue_comments_556271.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:39 tscrim]:\n> Replying to [comment:37 vdelecroix]:\n> > But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.\n> > \n> > What do you think?\n\n> \n> My understanding is that `(lip)gap` only allows for a domain of `{1, ..., n}`. So in my mind this could almost be considered a \"feature\" of the Sage interface with `(lib)gap`. As such, I am leaning towards actually keeping the current behavior.\n\n\nI am fine with it but am worried that it is very much against the coercion `SymmetricGroup([1,3,5]) -> SymmetricGroup([1,2,3,4,5])`\n\n```\nsage: S1 = SymmetricGroup([1,3,5])\nsage: S2 = SymmetricGroup([1,2,3,4,5])\nsage: S2(S1([5,1,3]))\n(1,5,3)\n```\n\n> It would be nice if we could get rid of all those local imports in the `_set_other`...\n\n\nTwo of them which are Cython classes and can actually be cimported. For the rest one can probably hack a `_late_import` but it is not very nice.",
    "created_at": "2019-11-11T05:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556271",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'></a>Replying to [comment:39 tscrim]:
> Replying to [comment:37 vdelecroix]:
> > But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.
> > 
> > What do you think?

> 
> My understanding is that `(lip)gap` only allows for a domain of `{1, ..., n}`. So in my mind this could almost be considered a "feature" of the Sage interface with `(lib)gap`. As such, I am leaning towards actually keeping the current behavior.


I am fine with it but am worried that it is very much against the coercion `SymmetricGroup([1,3,5]) -> SymmetricGroup([1,2,3,4,5])`

```
sage: S1 = SymmetricGroup([1,3,5])
sage: S2 = SymmetricGroup([1,2,3,4,5])
sage: S2(S1([5,1,3]))
(1,5,3)
```

> It would be nice if we could get rid of all those local imports in the `_set_other`...


Two of them which are Cython classes and can actually be cimported. For the rest one can probably hack a `_late_import` but it is not very nice.



---

archive/issue_comments_556272.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:41 vdelecroix]:\n> Replying to [comment:39 tscrim]:\n> > Replying to [comment:37 vdelecroix]:\n> > > But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.\n> > > \n> > > What do you think?\n\n> > \n> > My understanding is that `(lip)gap` only allows for a domain of `{1, ..., n}`. So in my mind this could almost be considered a \"feature\" of the Sage interface with `(lib)gap`. As such, I am leaning towards actually keeping the current behavior.\n\n> \n> I am fine with it but am worried that it is very much against the coercion `SymmetricGroup([1,3,5]) -> SymmetricGroup([1,2,3,4,5])`\n> \n> ```\n> sage: S1 = SymmetricGroup([1,3,5])\n> sage: S2 = SymmetricGroup([1,2,3,4,5])\n> sage: S2(S1([5,1,3]))\n> (1,5,3)\n> ```\n\n\nI see `SymmetricGroup` as being a different object, and its elements are not `libgap` objects. IMO, you should only be manipulating the libgap objects if you know what you are doing trying to get extra speed out, unless you are working only in libgap.\n\n> > It would be nice if we could get rid of all those local imports in the `_set_other`...\n\n> \n> Two of them which are Cython classes and can actually be cimported. For the rest one can probably hack a `_late_import` but it is not very nice.\n\n\nFor the `Permutation`, I think it is okay to have it locally since it is last and already \"slow\" as it is a Python object. However, do we need to do that for the `pari_gen`?\n\nActually, since you moved the `standardize_generator`, we probably can do either `lazy_import` or maybe a standard import rather than locally.",
    "created_at": "2019-11-11T05:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556272",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>Replying to [comment:41 vdelecroix]:
> Replying to [comment:39 tscrim]:
> > Replying to [comment:37 vdelecroix]:
> > > But to my mind, both shouldn't be allowed at all. There should not be any silent conversion of the domain.
> > > 
> > > What do you think?

> > 
> > My understanding is that `(lip)gap` only allows for a domain of `{1, ..., n}`. So in my mind this could almost be considered a "feature" of the Sage interface with `(lib)gap`. As such, I am leaning towards actually keeping the current behavior.

> 
> I am fine with it but am worried that it is very much against the coercion `SymmetricGroup([1,3,5]) -> SymmetricGroup([1,2,3,4,5])`
> 
> ```
> sage: S1 = SymmetricGroup([1,3,5])
> sage: S2 = SymmetricGroup([1,2,3,4,5])
> sage: S2(S1([5,1,3]))
> (1,5,3)
> ```


I see `SymmetricGroup` as being a different object, and its elements are not `libgap` objects. IMO, you should only be manipulating the libgap objects if you know what you are doing trying to get extra speed out, unless you are working only in libgap.

> > It would be nice if we could get rid of all those local imports in the `_set_other`...

> 
> Two of them which are Cython classes and can actually be cimported. For the rest one can probably hack a `_late_import` but it is not very nice.


For the `Permutation`, I think it is okay to have it locally since it is last and already "slow" as it is a Python object. However, do we need to do that for the `pari_gen`?

Actually, since you moved the `standardize_generator`, we probably can do either `lazy_import` or maybe a standard import rather than locally.



---

archive/issue_comments_556273.json:
```json
{
    "body": "<a id='comment:43'></a>I have much cleaner code that get rid of `_set_other`... will come in a minute.",
    "created_at": "2019-11-11T06:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556273",
    "user": "https://github.com/videlec"
}
```

<a id='comment:43'></a>I have much cleaner code that get rid of `_set_other`... will come in a minute.



---

archive/issue_comments_556274.json:
```json
{
    "body": "Changing commit from \"f085dc19dbb65eb890cac338b18f743845f38a32\" to \"c1da9f39b0851570b5fc0e168e64dc961626e3cc\"",
    "created_at": "2019-11-11T06:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f085dc19dbb65eb890cac338b18f743845f38a32" to "c1da9f39b0851570b5fc0e168e64dc961626e3cc"



---

archive/issue_comments_556275.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T06:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556276.json:
```json
{
    "body": "<a id='comment:45'></a>I agree that initializing from (lib)gap is a bit hacky anyway. I added an example to the documentation of `__init__`.",
    "created_at": "2019-11-11T06:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556276",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'></a>I agree that initializing from (lib)gap is a bit hacky anyway. I added an example to the documentation of `__init__`.



---

archive/issue_comments_556277.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-11-11T06:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556277",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_556278.json:
```json
{
    "body": "<a id='comment:46'></a>LGTM. If the patchbot comes up green, then it is a positive review (including if you get rid of the local imports in `standardize_generator`).",
    "created_at": "2019-11-11T06:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556278",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>LGTM. If the patchbot comes up green, then it is a positive review (including if you get rid of the local imports in `standardize_generator`).



---

archive/issue_comments_556279.json:
```json
{
    "body": "<a id='comment:47'></a>Indeed, I am trying to remove the local imports in `constructor.py`.",
    "created_at": "2019-11-11T06:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556279",
    "user": "https://github.com/videlec"
}
```

<a id='comment:47'></a>Indeed, I am trying to remove the local imports in `constructor.py`.



---

archive/issue_comments_556280.json:
```json
{
    "body": "Changing commit from \"c1da9f39b0851570b5fc0e168e64dc961626e3cc\" to \"ae418aed58788a2721b1bfc88a2aa7536b7be387\"",
    "created_at": "2019-11-11T06:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c1da9f39b0851570b5fc0e168e64dc961626e3cc" to "ae418aed58788a2721b1bfc88a2aa7536b7be387"



---

archive/issue_comments_556281.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T06:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556282.json:
```json
{
    "body": "Changing commit from \"ae418aed58788a2721b1bfc88a2aa7536b7be387\" to \"1581736b11b63de50da1928870ecf435ee24a52a\"",
    "created_at": "2019-11-11T07:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ae418aed58788a2721b1bfc88a2aa7536b7be387" to "1581736b11b63de50da1928870ecf435ee24a52a"



---

archive/issue_comments_556283.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T07:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556284.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,56 @@\n+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.\n \n+Here are some performance gain comparing 9.0.beta3 (\"OLD\") against the code provided in the branch (\"NEW\")\n+- Constructor\n+\n+```\n+sage: S = SymmetricGroup(10)\n+sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])\n+NEW: 10000 loops, best of 5: 155 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 227 \u00b5s per loop\n+sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])\n+NEW: 10000 loops, best of 5: 168 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 201 \u00b5s per loop\n+sage: %timeit -n 10000 S('(1,3,5)(2,7)')\n+NEW: 10000 loops, best of 5: 159 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 230 \u00b5s per loop\n+```\n+  and\n+\n+```\n+\n+sage: %timeit -n 3000 PermutationGroupElement('(1,2,3)(4,7)')\n+NEW: 3000 loops, best of 5: 64.2 \u00b5s per loop\n+OLD: 3000 loops, best of 5: 251 \u00b5s per loop\n+sage: %timeit -n 3000 PermutationGroupElement([1,5,2,3,4])\n+NEW: 3000 loops, best of 5: 14.9 \u00b5s per loop\n+OLD: 3000 loops, best of 5: 251 \u00b5s per loop\n+sage: %timeit -n 3000 PermutationGroupElement([(1,5),(2,3,4)])\n+NEW: 3000 loops, best of 5: 38.5 \u00b5s per loop\n+OLD: 3000 loops, best of 5: 215 \u00b5s per loop\n+```\n+- iteration of monogen group\n+\n+```\n+sage: P = S.subgroup([(1,2,3,4,5,6)])\n+sage: %timeit for p in P: pass\n+NEW: 100000 loops, best of 5: 2.71 \u00b5s per loop\n+OLD: 1000 loops, best of 5: 252 \u00b5s per loop\n+```\n+- multiplication of permutation with distinct parents\n+\n+```\n+sage: S = SymmetricGroup(7)\n+sage: P = S.subgroup([(1,2,3,4,5,6,7)])\n+sage: L1 = list(S)\n+sage: L2 = list(P)\n+sage: %%time\n+....: for s1 in L1:\n+....:     for s2 in L2:\n+....:         q = s1 * s2\n+NEW: Wall time: 11.4 ms\n+OLD: Wall time: 1.42 s\n+```\n \n Author: Vincent Delecroix\n \n``````\n",
    "created_at": "2019-11-11T07:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556284",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,56 @@
+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.
 
+Here are some performance gain comparing 9.0.beta3 ("OLD") against the code provided in the branch ("NEW")
+- Constructor
+
+```
+sage: S = SymmetricGroup(10)
+sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])
+NEW: 10000 loops, best of 5: 155 µs per loop
+OLD: 10000 loops, best of 5: 227 µs per loop
+sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])
+NEW: 10000 loops, best of 5: 168 µs per loop
+OLD: 10000 loops, best of 5: 201 µs per loop
+sage: %timeit -n 10000 S('(1,3,5)(2,7)')
+NEW: 10000 loops, best of 5: 159 µs per loop
+OLD: 10000 loops, best of 5: 230 µs per loop
+```
+  and
+
+```
+
+sage: %timeit -n 3000 PermutationGroupElement('(1,2,3)(4,7)')
+NEW: 3000 loops, best of 5: 64.2 µs per loop
+OLD: 3000 loops, best of 5: 251 µs per loop
+sage: %timeit -n 3000 PermutationGroupElement([1,5,2,3,4])
+NEW: 3000 loops, best of 5: 14.9 µs per loop
+OLD: 3000 loops, best of 5: 251 µs per loop
+sage: %timeit -n 3000 PermutationGroupElement([(1,5),(2,3,4)])
+NEW: 3000 loops, best of 5: 38.5 µs per loop
+OLD: 3000 loops, best of 5: 215 µs per loop
+```
+- iteration of monogen group
+
+```
+sage: P = S.subgroup([(1,2,3,4,5,6)])
+sage: %timeit for p in P: pass
+NEW: 100000 loops, best of 5: 2.71 µs per loop
+OLD: 1000 loops, best of 5: 252 µs per loop
+```
+- multiplication of permutation with distinct parents
+
+```
+sage: S = SymmetricGroup(7)
+sage: P = S.subgroup([(1,2,3,4,5,6,7)])
+sage: L1 = list(S)
+sage: L2 = list(P)
+sage: %%time
+....: for s1 in L1:
+....:     for s2 in L2:
+....:         q = s1 * s2
+NEW: Wall time: 11.4 ms
+OLD: Wall time: 1.42 s
+```
 
 Author: Vincent Delecroix
 
``````




---

archive/issue_comments_556285.json:
```json
{
    "body": "<a id='comment:50'></a>`check=True` is way too slow compared the `PermutationGroupElement` constructor\n\n```\nsage: S = SymmetricGroup(10)\nsage: %timeit -n 10000 S('(1,3,5)(2,7)', check=True)\n10000 loops, best of 5: 160 \u00b5s per loop\nsage: %timeit -n 10000 S('(1,3,5)(2,7)', check=False)\n10000 loops, best of 5: 5.35 \u00b5s per loop\nsage: %timeit -n 10000 PermutationGroupElement('(1,3,5)(2,7)')\n10000 loops, best of 5: 62.4 \u00b5s per loop\n```",
    "created_at": "2019-11-11T07:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556285",
    "user": "https://github.com/videlec"
}
```

<a id='comment:50'></a>`check=True` is way too slow compared the `PermutationGroupElement` constructor

```
sage: S = SymmetricGroup(10)
sage: %timeit -n 10000 S('(1,3,5)(2,7)', check=True)
10000 loops, best of 5: 160 µs per loop
sage: %timeit -n 10000 S('(1,3,5)(2,7)', check=False)
10000 loops, best of 5: 5.35 µs per loop
sage: %timeit -n 10000 PermutationGroupElement('(1,3,5)(2,7)')
10000 loops, best of 5: 62.4 µs per loop
```



---

archive/issue_comments_556286.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-11T07:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556286",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_556287.json:
```json
{
    "body": "Changing commit from \"1581736b11b63de50da1928870ecf435ee24a52a\" to \"95e1b525c83dedb016d44487d3f03b8ca6820cae\"",
    "created_at": "2019-11-11T07:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1581736b11b63de50da1928870ecf435ee24a52a" to "95e1b525c83dedb016d44487d3f03b8ca6820cae"



---

archive/issue_comments_556288.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T07:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556289.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,64 @@\n+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.\n \n+Here are some performance gain comparing 9.0.beta3 (\"OLD\") against the code provided in the branch (\"NEW\")\n+- Constructor\n+\n+```\n+sage: S = SymmetricGroup(10)\n+sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])\n+NEW: 10000 loops, best of 5: 3.94 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 227 \u00b5s per loop\n+sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])\n+NEW: 10000 loops, best of 5: 10.5 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 201 \u00b5s per loop\n+sage: %timeit -n 10000 S('(1,3,5)(2,7)')\n+NEW: 10000 loops, best of 5: 5.3 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 230 \u00b5s per loop\n+```\n+  and\n+\n+```\n+sage: P = PermutationGroup(['(1,2,3)'])\n+sage: %timeit -n 10000 P('(1,2,3)')\n+NEW: 10000 loops, best of 5: 134 \u00b5s per loop\n+OLD: 10000 loops, best of 5: 211 \u00b5s per loop\n+```\n+  and\n+\n+```\n+\n+sage: %timeit -n 3000 PermutationGroupElement('(1,2,3)(4,7)')\n+NEW: 3000 loops, best of 5: 64.2 \u00b5s per loop\n+OLD: 3000 loops, best of 5: 251 \u00b5s per loop\n+sage: %timeit -n 3000 PermutationGroupElement([1,5,2,3,4])\n+NEW: 3000 loops, best of 5: 14.9 \u00b5s per loop\n+OLD: 3000 loops, best of 5: 251 \u00b5s per loop\n+sage: %timeit -n 3000 PermutationGroupElement([(1,5),(2,3,4)])\n+NEW: 3000 loops, best of 5: 38.5 \u00b5s per loop\n+OLD: 3000 loops, best of 5: 215 \u00b5s per loop\n+```\n+- iteration of monogen group\n+\n+```\n+sage: P = S.subgroup([(1,2,3,4,5,6)])\n+sage: %timeit for p in P: pass\n+NEW: 100000 loops, best of 5: 2.71 \u00b5s per loop\n+OLD: 1000 loops, best of 5: 252 \u00b5s per loop\n+```\n+- multiplication of permutation with distinct parents\n+\n+```\n+sage: S = SymmetricGroup(7)\n+sage: P = S.subgroup([(1,2,3,4,5,6,7)])\n+sage: L1 = list(S)\n+sage: L2 = list(P)\n+sage: %%time\n+....: for s1 in L1:\n+....:     for s2 in L2:\n+....:         q = s1 * s2\n+NEW: Wall time: 11.4 ms\n+OLD: Wall time: 1.42 s\n+```\n \n Author: Vincent Delecroix\n \n``````\n",
    "created_at": "2019-11-11T07:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556289",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,64 @@
+As part of #28539 we rewrite simplify some of the datastructure of `PermutationGroupElement` and rewrite the constructor to make it much faster.
 
+Here are some performance gain comparing 9.0.beta3 ("OLD") against the code provided in the branch ("NEW")
+- Constructor
+
+```
+sage: S = SymmetricGroup(10)
+sage: %timeit -n 10000 p = S([3,1,7,6,8,2,9,10,5,4])
+NEW: 10000 loops, best of 5: 3.94 µs per loop
+OLD: 10000 loops, best of 5: 227 µs per loop
+sage: %timeit -n 10000 p = S([(3,1),(7,6,8,2),(9,10,5,4)])
+NEW: 10000 loops, best of 5: 10.5 µs per loop
+OLD: 10000 loops, best of 5: 201 µs per loop
+sage: %timeit -n 10000 S('(1,3,5)(2,7)')
+NEW: 10000 loops, best of 5: 5.3 µs per loop
+OLD: 10000 loops, best of 5: 230 µs per loop
+```
+  and
+
+```
+sage: P = PermutationGroup(['(1,2,3)'])
+sage: %timeit -n 10000 P('(1,2,3)')
+NEW: 10000 loops, best of 5: 134 µs per loop
+OLD: 10000 loops, best of 5: 211 µs per loop
+```
+  and
+
+```
+
+sage: %timeit -n 3000 PermutationGroupElement('(1,2,3)(4,7)')
+NEW: 3000 loops, best of 5: 64.2 µs per loop
+OLD: 3000 loops, best of 5: 251 µs per loop
+sage: %timeit -n 3000 PermutationGroupElement([1,5,2,3,4])
+NEW: 3000 loops, best of 5: 14.9 µs per loop
+OLD: 3000 loops, best of 5: 251 µs per loop
+sage: %timeit -n 3000 PermutationGroupElement([(1,5),(2,3,4)])
+NEW: 3000 loops, best of 5: 38.5 µs per loop
+OLD: 3000 loops, best of 5: 215 µs per loop
+```
+- iteration of monogen group
+
+```
+sage: P = S.subgroup([(1,2,3,4,5,6)])
+sage: %timeit for p in P: pass
+NEW: 100000 loops, best of 5: 2.71 µs per loop
+OLD: 1000 loops, best of 5: 252 µs per loop
+```
+- multiplication of permutation with distinct parents
+
+```
+sage: S = SymmetricGroup(7)
+sage: P = S.subgroup([(1,2,3,4,5,6,7)])
+sage: L1 = list(S)
+sage: L2 = list(P)
+sage: %%time
+....: for s1 in L1:
+....:     for s2 in L2:
+....:         q = s1 * s2
+NEW: Wall time: 11.4 ms
+OLD: Wall time: 1.42 s
+```
 
 Author: Vincent Delecroix
 
``````




---

archive/issue_comments_556290.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-11T07:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556290",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_556291.json:
```json
{
    "body": "<a id='comment:53'></a>Thank you. Looks good and a very nice additional improvement. Just waiting on a green patchbot before setting to positive.",
    "created_at": "2019-11-11T10:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556291",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:53'></a>Thank you. Looks good and a very nice additional improvement. Just waiting on a green patchbot before setting to positive.



---

archive/issue_comments_556292.json:
```json
{
    "body": "<a id='comment:54'></a>failing doctests, see patchbot (the failures related to doc are not relevant)",
    "created_at": "2019-11-11T13:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556292",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:54'></a>failing doctests, see patchbot (the failures related to doc are not relevant)



---

archive/issue_comments_556293.json:
```json
{
    "body": "<a id='comment:55'></a>The first failure in `cubegroup.py` is serious, the other is trivial. Although the changed error message `invalid permutation to initialize a permutation` in the failing book test is strange; the original message is better IMO.",
    "created_at": "2019-11-11T13:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556293",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:55'></a>The first failure in `cubegroup.py` is serious, the other is trivial. Although the changed error message `invalid permutation to initialize a permutation` in the failing book test is strange; the original message is better IMO.



---

archive/issue_comments_556294.json:
```json
{
    "body": "Changing commit from \"95e1b525c83dedb016d44487d3f03b8ca6820cae\" to \"3df8290eccc7bcc1dfdd843858bab819d1058d69\"",
    "created_at": "2019-11-11T14:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "95e1b525c83dedb016d44487d3f03b8ca6820cae" to "3df8290eccc7bcc1dfdd843858bab819d1058d69"



---

archive/issue_comments_556295.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T14:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_556296.json:
```json
{
    "body": "<a id='comment:57'></a>Nothing too bad.",
    "created_at": "2019-11-11T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556296",
    "user": "https://github.com/videlec"
}
```

<a id='comment:57'></a>Nothing too bad.



---

archive/issue_comments_556297.json:
```json
{
    "body": "<a id='comment:58'></a>green bot",
    "created_at": "2019-11-11T18:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556297",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:58'></a>green bot



---

archive/issue_comments_556298.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-11T21:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556298",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_556299.json:
```json
{
    "body": "<a id='comment:59'></a>Thank you for keeping us informed of the patchbot status Fr\u00e9d\u00e9ric (although I am not sure if you consider yourself as a reviewer; please add yourself if you do).",
    "created_at": "2019-11-11T21:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556299",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:59'></a>Thank you for keeping us informed of the patchbot status Frédéric (although I am not sure if you consider yourself as a reviewer; please add yourself if you do).



---

archive/issue_comments_556300.json:
```json
{
    "body": "<a id='comment:60'></a>I am glad that we get this done! Thanks.",
    "created_at": "2019-11-12T02:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556300",
    "user": "https://github.com/videlec"
}
```

<a id='comment:60'></a>I am glad that we get this done! Thanks.



---

archive/issue_comments_556301.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/28652\" to \"3df8290eccc7bcc1dfdd843858bab819d1058d69\"",
    "created_at": "2019-11-16T20:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556301",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vdelecroix/28652" to "3df8290eccc7bcc1dfdd843858bab819d1058d69"



---

archive/issue_comments_556302.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-16T20:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28652#issuecomment-556302",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_072162.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-16T20:15:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28652",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28652#event-72162"
}
```
