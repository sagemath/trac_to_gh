# Issue 28596: Fix jmol permissions

archive/issues_028359.json:
```json
{
    "body": "This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong:\n\n```\n  drwxr-xr-x 24 palmieri staff  768 Sep 12 00:11 info\n  drwx------ 21 palmieri staff  672 Oct 12 10:28 jmol\n  drwxr-xr-x 80 palmieri staff 2560 Oct 12 10:28 jsmol\n  drwxr-xr-x  4 palmieri staff  128 Sep 12 00:11 jupyter\n```\n\n\n**CC:**  @jdemeyer @embray @novoselt\n\n**Branch/Commit:** [87c694f059e839a4bb12db80037f3c4398b56c2b](https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b)\n\n**Reviewer:** John Palmieri\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/28596\n\n",
    "closed_at": "2019-12-20T22:46:04Z",
    "created_at": "2019-10-12T17:13:45Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "title": "Fix jmol permissions",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/28596",
    "user": "https://github.com/jhpalmieri"
}
```
This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong:

```
  drwxr-xr-x 24 palmieri staff  768 Sep 12 00:11 info
  drwx------ 21 palmieri staff  672 Oct 12 10:28 jmol
  drwxr-xr-x 80 palmieri staff 2560 Oct 12 10:28 jsmol
  drwxr-xr-x  4 palmieri staff  128 Sep 12 00:11 jupyter
```


**CC:**  @jdemeyer @embray @novoselt

**Branch/Commit:** [87c694f059e839a4bb12db80037f3c4398b56c2b](https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b)

**Reviewer:** John Palmieri

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/28596





---

archive/issue_comments_448593.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n-This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong.\n+This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong:\n+\n+```\n+  drwxr-xr-x 24 palmieri staff  768 Sep 12 00:11 info\n+  drwx------ 21 palmieri staff  672 Oct 12 10:28 jmol\n+  drwxr-xr-x 80 palmieri staff 2560 Oct 12 10:28 jsmol\n+  drwxr-xr-x  4 palmieri staff  128 Sep 12 00:11 jupyter\n+```\n+\n``````\n",
    "created_at": "2019-10-12T17:29:00Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448593",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,9 @@
-This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong.
+This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong:
+
+```
+  drwxr-xr-x 24 palmieri staff  768 Sep 12 00:11 info
+  drwx------ 21 palmieri staff  672 Oct 12 10:28 jmol
+  drwxr-xr-x 80 palmieri staff 2560 Oct 12 10:28 jsmol
+  drwxr-xr-x  4 palmieri staff  128 Sep 12 00:11 jupyter
+```
+
``````




---

archive/issue_comments_448594.json:
```json
{
    "body": "<a id='comment:2'></a>\nI can see two solutions: change jmol's spkg-install script so it sets the right permissions, or set the permissions differently for all packages. Here is a branch which does the second of these: after unpacking the tarball into `src`, run `chmod +rx src`. Is this a bad idea for some reason?",
    "created_at": "2019-10-12T17:31:23Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448594",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I can see two solutions: change jmol's spkg-install script so it sets the right permissions, or set the permissions differently for all packages. Here is a branch which does the second of these: after unpacking the tarball into `src`, run `chmod +rx src`. Is this a bad idea for some reason?



---

archive/issue_comments_448595.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/jmol-permissions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/jmol-permissions)",
    "created_at": "2019-10-12T17:32:45Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448595",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/jmol-permissions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/jmol-permissions)



---

archive/issue_events_253350.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-12T17:32:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253350"
}
```



---

archive/issue_comments_448596.json:
```json
{
    "body": "**Commit:** [82e736b7c1f5f93042d61d34149150ab7d9cec2b](https://github.com/sagemath/sagetrac-mirror/commit/82e736b7c1f5f93042d61d34149150ab7d9cec2b)",
    "created_at": "2019-10-12T17:32:54Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448596",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [82e736b7c1f5f93042d61d34149150ab7d9cec2b](https://github.com/sagemath/sagetrac-mirror/commit/82e736b7c1f5f93042d61d34149150ab7d9cec2b)



---

archive/issue_comments_448597.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82e736b7c1f5f93042d61d34149150ab7d9cec2b\">82e736b</a></td><td><code>trac 28596: change permissions on src after unpacking each package's tarball.</code></td></tr></table>\n",
    "created_at": "2019-10-12T17:32:54Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448597",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82e736b7c1f5f93042d61d34149150ab7d9cec2b">82e736b</a></td><td><code>trac 28596: change permissions on src after unpacking each package's tarball.</code></td></tr></table>




---

archive/issue_comments_448598.json:
```json
{
    "body": "<a id='comment:5'></a>\nI want to do this for all packages to avoid similar situations in the future.",
    "created_at": "2019-10-12T17:34:13Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448598",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
I want to do this for all packages to avoid similar situations in the future.



---

archive/issue_comments_448599.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis does not seem to fix the doc building issue.",
    "created_at": "2019-10-12T18:59:33Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448599",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
This does not seem to fix the doc building issue.



---

archive/issue_comments_448600.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [chapoton](#comment%3A6):\n> This does not seem to fix the doc building issue.\n\n\nI don't know what doc building issue you're referencing.",
    "created_at": "2019-12-16T11:16:40Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448600",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Replying to [chapoton](#comment%3A6):
> This does not seem to fix the doc building issue.


I don't know what doc building issue you're referencing.



---

archive/issue_comments_448601.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere is the docbuild log where the problem appears:\n\nhttps://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-166-generic/atlas/2019-11-27%2010:02:21?plugin=docbuild\n\nThis prevents me from using this machine as a patchbot.",
    "created_at": "2019-12-16T13:31:49Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448601",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
Here is the docbuild log where the problem appears:

https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-166-generic/atlas/2019-11-27%2010:02:21?plugin=docbuild

This prevents me from using this machine as a patchbot.



---

archive/issue_comments_448602.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis behavior originates from #24567, and would be different if we'd gone with Jeroen's suggestion of a less restricted mask on the files than I used.\n\nI wrote at the time:\n\n> this should have no effect on the permissions applied when the files are installed, but I guess it depends in part on the installation mechanism\n\n\nWhich, incidentally was true at the time.  But the part of \"depends on the installation mechanism\" was also true, and the installation mechanism *did* change after that, in such a way that this did have an effect on the installed files.\n\nSo I think the better option here might be to try Jeroen's original suggestion of a less restrictive permission mask on the source tarball's extraction location.",
    "created_at": "2019-12-16T15:31:54Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448602",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
This behavior originates from #24567, and would be different if we'd gone with Jeroen's suggestion of a less restricted mask on the files than I used.

I wrote at the time:

> this should have no effect on the permissions applied when the files are installed, but I guess it depends in part on the installation mechanism


Which, incidentally was true at the time.  But the part of "depends on the installation mechanism" was also true, and the installation mechanism *did* change after that, in such a way that this did have an effect on the installed files.

So I think the better option here might be to try Jeroen's original suggestion of a less restrictive permission mask on the source tarball's extraction location.



---

archive/issue_events_253351.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-16T15:31:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253351"
}
```



---

archive/issue_events_253352.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-16T15:31:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253352"
}
```



---

archive/issue_comments_448603.json:
```json
{
    "body": "**Author:** Erik Bray",
    "created_at": "2019-12-16T16:04:53Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448603",
    "user": "https://github.com/embray"
}
```

**Author:** Erik Bray



---

archive/issue_comments_448604.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis approach fixes the issue closer to the source.  However, it would be good to test a full rebuild.  I don't know for sure if there aren't some pathological packages that can break because of this (and if so those packages should probably be fixed...).\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df58d4ba3705aedf929c355afe7347714afff89b\">df58d4b</a></td><td><code>Trac #28596: Apply less restricted permission mask to extracted source</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b\">87c694f</a></td><td><code>Add an spkg-legacy-uninstall for jmol.</code></td></tr></table>\n",
    "created_at": "2019-12-16T16:04:53Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448604",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
This approach fixes the issue closer to the source.  However, it would be good to test a full rebuild.  I don't know for sure if there aren't some pathological packages that can break because of this (and if so those packages should probably be fixed...).

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df58d4ba3705aedf929c355afe7347714afff89b">df58d4b</a></td><td><code>Trac #28596: Apply less restricted permission mask to extracted source</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b">87c694f</a></td><td><code>Add an spkg-legacy-uninstall for jmol.</code></td></tr></table>




---

archive/issue_comments_448605.json:
```json
{
    "body": "**Changing commit** from \"[82e736b7c1f5f93042d61d34149150ab7d9cec2b](https://github.com/sagemath/sagetrac-mirror/commit/82e736b7c1f5f93042d61d34149150ab7d9cec2b)\" to \"[87c694f059e839a4bb12db80037f3c4398b56c2b](https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b)\".",
    "created_at": "2019-12-16T16:04:53Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448605",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[82e736b7c1f5f93042d61d34149150ab7d9cec2b](https://github.com/sagemath/sagetrac-mirror/commit/82e736b7c1f5f93042d61d34149150ab7d9cec2b)" to "[87c694f059e839a4bb12db80037f3c4398b56c2b](https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b)".



---

archive/issue_comments_448606.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/jmol-permissions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/jmol-permissions)\" to \"[u/embray/ticket-28596](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28596)\".",
    "created_at": "2019-12-16T16:04:53Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448606",
    "user": "https://github.com/embray"
}
```

**Changing branch** from "[u/jhpalmieri/jmol-permissions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/jmol-permissions)" to "[u/embray/ticket-28596](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28596)".



---

archive/issue_events_253353.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-16T16:05:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253353"
}
```



---

archive/issue_events_253354.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-16T16:05:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253354"
}
```



---

archive/issue_comments_448607.json:
```json
{
    "body": "<a id='comment:12'></a>\nAll tests pass for me on OS X, with a build from scratch, and the permissions look okay.",
    "created_at": "2019-12-16T22:24:48Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448607",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
All tests pass for me on OS X, with a build from scratch, and the permissions look okay.



---

archive/issue_comments_448608.json:
```json
{
    "body": "<a id='comment:13'></a>\nthen it should be ok, no ?",
    "created_at": "2019-12-17T19:16:07Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448608",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
then it should be ok, no ?



---

archive/issue_comments_448609.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2019-12-17T19:17:04Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448609",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_events_253355.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-12-17T19:17:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253355"
}
```



---

archive/issue_events_253356.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-12-17T19:17:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253356"
}
```



---

archive/issue_comments_448610.json:
```json
{
    "body": "<a id='comment:14'></a>\nOkay with me.",
    "created_at": "2019-12-17T19:17:04Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448610",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Okay with me.



---

archive/issue_comments_448611.json:
```json
{
    "body": "<a id='comment:15'></a>\nI'm sure, if he were paying attention, Jeroen would be pleased to be vindicated :)",
    "created_at": "2019-12-18T10:22:44Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448611",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
I'm sure, if he were paying attention, Jeroen would be pleased to be vindicated :)



---

archive/issue_comments_448612.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/ticket-28596](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28596)\" to \"[87c694f059e839a4bb12db80037f3c4398b56c2b](https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b)\".",
    "created_at": "2019-12-20T22:46:04Z",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28596#issuecomment-448612",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/ticket-28596](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28596)" to "[87c694f059e839a4bb12db80037f3c4398b56c2b](https://github.com/sagemath/sagetrac-mirror/commit/87c694f059e839a4bb12db80037f3c4398b56c2b)".



---

archive/issue_events_253357.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-20T22:46:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253357"
}
```



---

archive/issue_events_253358.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-20T22:46:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28596",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28596#event-253358"
}
```
