# Issue 28870: meataxe not working with MatrixSpace

archive/issues_028633.json:
```json
{
    "assignees": [],
    "body": "the following contradicts the doc:\nwith `meataxe` installed, I get\n\n```\nsage: m=MatrixSpace(GF(2),5, 5, implementation='meataxe')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-6-f0ba29cfe335> in <module>()\n----> 1 m=MatrixSpace(GF(Integer(2)),Integer(5), Integer(5), implementation='meataxe')\n\n/home/dimpase/sage/local/lib/python3.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)()\n    332         \"\"\"\n    333         if cls.classcall is not None:\n--> 334             return cls.classcall(cls, *args, **kwds)\n    335         else:\n    336             # Fast version of type.__call__(cls, *args, **kwds)\n\n/home/dimpase/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation)\n    473             raise OverflowError(\"number of rows and columns may be at most %s\" % sys.maxsize)\n    474 \n--> 475         matrix_cls = get_matrix_class(base_ring, nrows, ncols, sparse, implementation)\n    476         return super(MatrixSpace, cls).__classcall__(\n    477                 cls, base_ring, nrows, ncols, sparse, matrix_cls)\n\n/home/dimpase/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in get_matrix_class(R, nrows, ncols, sparse, implementation)\n    305         # generic fallback\n    306         if implementation != 'generic' and implementation is not None:\n--> 307             raise ValueError(\"unknown matrix implementation %r over %r\" % (implementation, R))\n    308         else:\n    309             return matrix_generic_dense.Matrix_generic_dense\n\nValueError: unknown matrix implementation 'meataxe' over Finite Field of size 2\n```\n\nAnd, by the way, `gap` instead of `meataxe` appears to work, but is not documented. \n\nCC:  @videlec @simon-king-jena @Ivo-Maffei @jdemeyer\n\nBranch/Commit: **[u/SimonKing/meataxe_not_working_with_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/meataxe_not_working_with_matrixspace) @ [`6dcb637`](https://github.com/sagemath/sagetrac-mirror/commit/6dcb6379cc253594aeceaeaa86c68d28623c3916)**\n\nReviewer: **Dima Pasechnik, Travis Scrimshaw**\n\nAuthor: **Simon King**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28870_\n\n",
    "created_at": "2019-12-11T09:57:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "meataxe not working with MatrixSpace",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/28870",
    "user": "https://github.com/dimpase"
}
```
the following contradicts the doc:
with `meataxe` installed, I get

```
sage: m=MatrixSpace(GF(2),5, 5, implementation='meataxe')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-6-f0ba29cfe335> in <module>()
----> 1 m=MatrixSpace(GF(Integer(2)),Integer(5), Integer(5), implementation='meataxe')

/home/dimpase/sage/local/lib/python3.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)()
    332         """
    333         if cls.classcall is not None:
--> 334             return cls.classcall(cls, *args, **kwds)
    335         else:
    336             # Fast version of type.__call__(cls, *args, **kwds)

/home/dimpase/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation)
    473             raise OverflowError("number of rows and columns may be at most %s" % sys.maxsize)
    474 
--> 475         matrix_cls = get_matrix_class(base_ring, nrows, ncols, sparse, implementation)
    476         return super(MatrixSpace, cls).__classcall__(
    477                 cls, base_ring, nrows, ncols, sparse, matrix_cls)

/home/dimpase/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in get_matrix_class(R, nrows, ncols, sparse, implementation)
    305         # generic fallback
    306         if implementation != 'generic' and implementation is not None:
--> 307             raise ValueError("unknown matrix implementation %r over %r" % (implementation, R))
    308         else:
    309             return matrix_generic_dense.Matrix_generic_dense

ValueError: unknown matrix implementation 'meataxe' over Finite Field of size 2
```

And, by the way, `gap` instead of `meataxe` appears to work, but is not documented. 

CC:  @videlec @simon-king-jena @Ivo-Maffei @jdemeyer

Branch/Commit: **[u/SimonKing/meataxe_not_working_with_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/meataxe_not_working_with_matrixspace) @ [`6dcb637`](https://github.com/sagemath/sagetrac-mirror/commit/6dcb6379cc253594aeceaeaa86c68d28623c3916)**

Reviewer: **Dima Pasechnik, Travis Scrimshaw**

Author: **Simon King**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/28870_





---

archive/issue_events_396571.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-11T09:57:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396571"
}
```



---

archive/issue_events_396572.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-11T09:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396572"
}
```



---

archive/issue_events_396573.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-11T09:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396573"
}
```



---

archive/issue_events_396574.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-11T09:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396574"
}
```



---

archive/issue_comments_450586.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNote that I've opened #28871 for a different meataxe issue (compiler warnings for the meataxe wrappers in the sage library). But I don't think there is a dependency in one direction or the other.",
    "created_at": "2019-12-11T14:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450586",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">comment:1</div>

Note that I've opened #28871 for a different meataxe issue (compiler warnings for the meataxe wrappers in the sage library). But I don't think there is a dependency in one direction or the other.



---

archive/issue_comments_450587.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAfter installing meataxe and `sage -b`, one has\n\n```\nsage: M = random_matrix(GF(25,'x'),5)\nsage: type(M)\n<class 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nsage: M.parent().element_class\n<class 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\n```\n\nSo, meataxe as default implementation does work.",
    "created_at": "2019-12-11T14:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450587",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

After installing meataxe and `sage -b`, one has

```
sage: M = random_matrix(GF(25,'x'),5)
sage: type(M)
<class 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
sage: M.parent().element_class
<class 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
```

So, meataxe as default implementation does work.



---

archive/issue_comments_450588.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHere's the problem:\n\n```\nsage: sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(GF(5))\nTrue\n```\nThe non-default implementation \"meataxe\" would only be considered when `is_IntegerModRing(R)` returns False but `is_FiniteField(R)` returns True.\n\nWhat do you think: Would it be a good idea to totally rewrite the logic that is implemented in `get_matrix_class`? It seems rather convoluted to me. The easiest fix would of course be to *first* check whether we have a finite field and only later check whether we at least have an `IntegerModRing`.",
    "created_at": "2019-12-11T15:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450588",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Here's the problem:

```
sage: sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(GF(5))
True
```
The non-default implementation "meataxe" would only be considered when `is_IntegerModRing(R)` returns False but `is_FiniteField(R)` returns True.

What do you think: Would it be a good idea to totally rewrite the logic that is implemented in `get_matrix_class`? It seems rather convoluted to me. The easiest fix would of course be to *first* check whether we have a finite field and only later check whether we at least have an `IntegerModRing`.



---

archive/issue_comments_450589.json:
```json
{
    "body": "Branch: **[u/SimonKing/meataxe_not_working_with_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/meataxe_not_working_with_matrixspace)**",
    "created_at": "2019-12-11T21:17:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450589",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/meataxe_not_working_with_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/meataxe_not_working_with_matrixspace)**



---

archive/issue_comments_450590.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@simon-king-jena](#comment:3):\n> What do you think: Would it be a good idea to totally rewrite the logic that is implemented in `get_matrix_class`? It seems rather convoluted to me. The easiest fix would of course be to *first* check whether we have a finite field and only later check whether we at least have an `IntegerModRing`.\n\nWith the new commit, I switch the \"if-then\" branches for integer-mod-rings and for finite fields, which is needed since we want to treat finite prime fields as fields and not as integer-mod-rings.\n\nAlso, I added an example for `implementation='gap'`.\n\nI didn't run tests yet, but switch it to \"needs review\" anyway...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8df7de17d23ca85df0980a4c607168953482ca16\">8df7de1</a></td><td><code>Fix choice of an implementation for matrices over finite fields</code></td></tr></table>\n",
    "created_at": "2019-12-11T21:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450590",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@simon-king-jena](#comment:3):
> What do you think: Would it be a good idea to totally rewrite the logic that is implemented in `get_matrix_class`? It seems rather convoluted to me. The easiest fix would of course be to *first* check whether we have a finite field and only later check whether we at least have an `IntegerModRing`.

With the new commit, I switch the "if-then" branches for integer-mod-rings and for finite fields, which is needed since we want to treat finite prime fields as fields and not as integer-mod-rings.

Also, I added an example for `implementation='gap'`.

I didn't run tests yet, but switch it to "needs review" anyway...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8df7de17d23ca85df0980a4c607168953482ca16">8df7de1</a></td><td><code>Fix choice of an implementation for matrices over finite fields</code></td></tr></table>




---

archive/issue_events_396575.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-12-11T21:20:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396575"
}
```



---

archive/issue_comments_450591.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2019-12-11T21:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450591",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_450592.json:
```json
{
    "body": "Commit: **[`8df7de1`](https://github.com/sagemath/sagetrac-mirror/commit/8df7de17d23ca85df0980a4c607168953482ca16)**",
    "created_at": "2019-12-11T21:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450592",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`8df7de1`](https://github.com/sagemath/sagetrac-mirror/commit/8df7de17d23ca85df0980a4c607168953482ca16)**



---

archive/issue_comments_450593.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't know what pyflakes complains about (it says \"no such log\"). Anyway, without meataxe tests pass. So, hopefully the remaining question is whether they also pass with meataxe installed.",
    "created_at": "2019-12-12T11:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450593",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't know what pyflakes complains about (it says "no such log"). Anyway, without meataxe tests pass. So, hopefully the remaining question is whether they also pass with meataxe installed.



---

archive/issue_comments_450594.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nhow about also correcting the docstrings for `MatrixSpace` (and adding tests)?",
    "created_at": "2019-12-12T11:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450594",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

how about also correcting the docstrings for `MatrixSpace` (and adding tests)?



---

archive/issue_comments_450595.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@dimpase](#comment:7):\n> how about also correcting the docstrings for `MatrixSpace` (and adding tests)?\n\nMakes sense. So far, I only added a test concerning gap for `get_matrix_class`, but `MatrixSpace` clearly is more visible. Maybe in the `matrix` constructor, too?",
    "created_at": "2019-12-12T12:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450595",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@dimpase](#comment:7):
> how about also correcting the docstrings for `MatrixSpace` (and adding tests)?

Makes sense. So far, I only added a test concerning gap for `get_matrix_class`, but `MatrixSpace` clearly is more visible. Maybe in the `matrix` constructor, too?



---

archive/issue_comments_450596.json:
```json
{
    "body": "Changed commit from **[`8df7de1`](https://github.com/sagemath/sagetrac-mirror/commit/8df7de17d23ca85df0980a4c607168953482ca16)** to **[`6dcb637`](https://github.com/sagemath/sagetrac-mirror/commit/6dcb6379cc253594aeceaeaa86c68d28623c3916)**",
    "created_at": "2019-12-12T15:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450596",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8df7de1`](https://github.com/sagemath/sagetrac-mirror/commit/8df7de17d23ca85df0980a4c607168953482ca16)** to **[`6dcb637`](https://github.com/sagemath/sagetrac-mirror/commit/6dcb6379cc253594aeceaeaa86c68d28623c3916)**



---

archive/issue_comments_450597.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6dcb6379cc253594aeceaeaa86c68d28623c3916\">6dcb637</a></td><td><code>Add further tests to document that the meataxe backend works</code></td></tr></table>\n",
    "created_at": "2019-12-12T15:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450597",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6dcb6379cc253594aeceaeaa86c68d28623c3916">6dcb637</a></td><td><code>Add further tests to document that the meataxe backend works</code></td></tr></table>




---

archive/issue_comments_450598.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI added another optional test in the documentation of `MatrixSpace`. I did not add to the `matrix` constructor, because so far choosing an implementation is not documented there at all (AFAIC).\n\nAlso, I saw that the optional meataxe tests are marked as `# optional: meataxe`, whereas all other optional tests are marked as `# optional - bla`. To be consistent, I changed to `# optional - meataxe` (but I guess it did work before, so, it is just a cosmetic change.",
    "created_at": "2019-12-12T15:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450598",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

I added another optional test in the documentation of `MatrixSpace`. I did not add to the `matrix` constructor, because so far choosing an implementation is not documented there at all (AFAIC).

Also, I saw that the optional meataxe tests are marked as `# optional: meataxe`, whereas all other optional tests are marked as `# optional - bla`. To be consistent, I changed to `# optional - meataxe` (but I guess it did work before, so, it is just a cosmetic change.



---

archive/issue_comments_450599.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\ncc-ing Jeroen in case he has any comments about the change in `get_matrix_class` logic since (IIRC) he was the person who last rewrote that constructor.",
    "created_at": "2019-12-13T03:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450599",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

cc-ing Jeroen in case he has any comments about the change in `get_matrix_class` logic since (IIRC) he was the person who last rewrote that constructor.



---

archive/issue_comments_450600.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450600",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Ticket retargeted after milestone closed



---

archive/issue_events_396576.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396576"
}
```



---

archive/issue_events_396577.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396577"
}
```



---

archive/issue_comments_450601.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nPing...",
    "created_at": "2020-01-10T20:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450601",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

Ping...



---

archive/issue_comments_450602.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik, Travis Scrimshaw**",
    "created_at": "2020-01-11T18:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450602",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Dima Pasechnik, Travis Scrimshaw**



---

archive/issue_events_396578.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-01-11T18:34:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396578"
}
```



---

archive/issue_events_396579.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-01-11T18:34:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396579"
}
```



---

archive/issue_comments_450603.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLGTM.\n\nDima, I added you as a reviewer for [comment:7](#comment:7).",
    "created_at": "2020-01-11T18:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450603",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

LGTM.

Dima, I added you as a reviewer for [comment:7](#comment:7).



---

archive/issue_comments_450604.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nVarious failures of the form\n\n```\nsage -t --warn-long 44.0 src/sage/dynamics/arithmetic_dynamics/projective_ds.py\n**********************************************************************\nFile \"src/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 6156, in sage.dynamics.arithmetic_dynamics.projective_ds.?.conjugating_set\nFailed example:\n    m = f.conjugating_set(g)[0]\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.dynamics.arithmetic_dynamics.projective_ds.?.conjugating_set[42]>\", line 1, in <module>\n        m = f.conjugating_set(g)[Integer(0)]\n      File \"/home/release/Sage/local/lib/python3.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 6216, in conjugating_set\n        bol,m = m2.is_similar(m1, transformation=True)\n      File \"sage/matrix/matrix2.pyx\", line 10977, in sage.matrix.matrix2.Matrix.is_similar (build/cythonized/sage/matrix/matrix2.c:77253)\n        _, SA = A.jordan_form(transformation=True)\n      File \"sage/matrix/matrix2.pyx\", line 10242, in sage.matrix.matrix2.Matrix.jordan_form (build/cythonized/sage/matrix/matrix2.c:72434)\n        evals = A.charpoly().roots()\n      File \"sage/matrix/matrix_cyclo_dense.pyx\", line 1263, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense.charpoly (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:12236)\n        f = self._charpoly_multimodular(var, proof=proof)\n      File \"sage/matrix/matrix_cyclo_dense.pyx\", line 1368, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense._charpoly_multimodular (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:13543)\n        X = A._charpoly_mod(p)\n      File \"sage/matrix/matrix_cyclo_dense.pyx\", line 1302, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense._charpoly_mod (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:12517)\n        R, denom = self._reductions(p)\n      File \"sage/matrix/matrix_cyclo_dense.pyx\", line 1439, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense._reductions (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:14366)\n        ans = R._matrices_from_rows(self._nrows, self._ncols)\n      File \"sage/structure/element.pyx\", line 487, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4608)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 500, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4717)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 394, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2614)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'sage.matrix.matrix_generic_dense.Matrix_generic_dense' object has no attribute '_matrices_from_rows'\n**********************************************************************\n```",
    "created_at": "2020-01-18T14:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450604",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

Various failures of the form

```
sage -t --warn-long 44.0 src/sage/dynamics/arithmetic_dynamics/projective_ds.py
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 6156, in sage.dynamics.arithmetic_dynamics.projective_ds.?.conjugating_set
Failed example:
    m = f.conjugating_set(g)[0]
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.dynamics.arithmetic_dynamics.projective_ds.?.conjugating_set[42]>", line 1, in <module>
        m = f.conjugating_set(g)[Integer(0)]
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 6216, in conjugating_set
        bol,m = m2.is_similar(m1, transformation=True)
      File "sage/matrix/matrix2.pyx", line 10977, in sage.matrix.matrix2.Matrix.is_similar (build/cythonized/sage/matrix/matrix2.c:77253)
        _, SA = A.jordan_form(transformation=True)
      File "sage/matrix/matrix2.pyx", line 10242, in sage.matrix.matrix2.Matrix.jordan_form (build/cythonized/sage/matrix/matrix2.c:72434)
        evals = A.charpoly().roots()
      File "sage/matrix/matrix_cyclo_dense.pyx", line 1263, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense.charpoly (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:12236)
        f = self._charpoly_multimodular(var, proof=proof)
      File "sage/matrix/matrix_cyclo_dense.pyx", line 1368, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense._charpoly_multimodular (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:13543)
        X = A._charpoly_mod(p)
      File "sage/matrix/matrix_cyclo_dense.pyx", line 1302, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense._charpoly_mod (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:12517)
        R, denom = self._reductions(p)
      File "sage/matrix/matrix_cyclo_dense.pyx", line 1439, in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense._reductions (build/cythonized/sage/matrix/matrix_cyclo_dense.cpp:14366)
        ans = R._matrices_from_rows(self._nrows, self._ncols)
      File "sage/structure/element.pyx", line 487, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4608)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 500, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4717)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 394, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2614)
        raise AttributeError(dummy_error_message)
    AttributeError: 'sage.matrix.matrix_generic_dense.Matrix_generic_dense' object has no attribute '_matrices_from_rows'
**********************************************************************
```



---

archive/issue_events_396580.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-18T14:13:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396580"
}
```



---

archive/issue_events_396581.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-18T14:13:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396581"
}
```



---

archive/issue_comments_450605.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@vbraun](#comment:15):\n> Various failures of the form\n> \n> ```\n> ...\n>     AttributeError: 'sage.matrix.matrix_generic_dense.Matrix_generic_dense' object has no attribute '_matrices_from_rows'\n> **********************************************************************\n> ```\n\nInteresting. According to \"git blame\", that method was introduced by Burcin Erocal 10 years ago. Why has that error never shown up before?\n\nThe method `_matrices_from_rows` is defined in `src/sage/matrix/matrix_modn_dense_template.pxi`. So, perhaps Matrix_gfpn_dense should use the template?",
    "created_at": "2020-01-18T14:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450605",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@vbraun](#comment:15):
> Various failures of the form
> 
> ```
> ...
>     AttributeError: 'sage.matrix.matrix_generic_dense.Matrix_generic_dense' object has no attribute '_matrices_from_rows'
> **********************************************************************
> ```

Interesting. According to "git blame", that method was introduced by Burcin Erocal 10 years ago. Why has that error never shown up before?

The method `_matrices_from_rows` is defined in `src/sage/matrix/matrix_modn_dense_template.pxi`. So, perhaps Matrix_gfpn_dense should use the template?



---

archive/issue_comments_450606.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@simon-king-jena](#comment:16):\n> The method `_matrices_from_rows` is defined in `src/sage/matrix/matrix_modn_dense_template.pxi`. So, perhaps Matrix_gfpn_dense should use the template?\n\nApparently not. Its first line states \"Dense matrices over `\\ZZ/n\\ZZ` for `n` small using the LinBox library (FFLAS/FFPACK).\"\n\nActually it could be that the creation of matrices from rows is defined for general matrices anyway. And as there is only a single line of code that actually uses `_matrices_from_rows`, it may very well be a better solution to nuke `_matrices_from_rows`.",
    "created_at": "2020-01-18T15:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450606",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@simon-king-jena](#comment:16):
> The method `_matrices_from_rows` is defined in `src/sage/matrix/matrix_modn_dense_template.pxi`. So, perhaps Matrix_gfpn_dense should use the template?

Apparently not. Its first line states "Dense matrices over `\ZZ/n\ZZ` for `n` small using the LinBox library (FFLAS/FFPACK)."

Actually it could be that the creation of matrices from rows is defined for general matrices anyway. And as there is only a single line of code that actually uses `_matrices_from_rows`, it may very well be a better solution to nuke `_matrices_from_rows`.



---

archive/issue_comments_450607.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI was mistaken about the purpose of `_matrices_from_rows`: It isn't about slicing but it is a very technical and hardly natural construction.\n\n`src/sage/matrix/matrix_cyclo_dense.pyx` is the only place in which this method. It is supposed to be with a matrix over ZZ/nZZ, but meataxe is strictly over a field. Moreover, by default, meataxe should only be used in Sage when there is a finite NON-PRIME field. Hence, even over ZZ/(prime(ZZ), meataxe should normally not be used.\n\nSo, one could argue that the matrix implementation used in `src/sage/matrix/matrix_cyclo_dense.pyx` should be hard-coded. Would that be a solution that you could accept?",
    "created_at": "2020-01-18T15:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450607",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">comment:18</div>

I was mistaken about the purpose of `_matrices_from_rows`: It isn't about slicing but it is a very technical and hardly natural construction.

`src/sage/matrix/matrix_cyclo_dense.pyx` is the only place in which this method. It is supposed to be with a matrix over ZZ/nZZ, but meataxe is strictly over a field. Moreover, by default, meataxe should only be used in Sage when there is a finite NON-PRIME field. Hence, even over ZZ/(prime(ZZ), meataxe should normally not be used.

So, one could argue that the matrix implementation used in `src/sage/matrix/matrix_cyclo_dense.pyx` should be hard-coded. Would that be a solution that you could accept?



---

archive/issue_events_396582.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396582"
}
```



---

archive/issue_events_396583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396583"
}
```



---

archive/issue_comments_450608.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nMoving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450608",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_396584.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396584"
}
```



---

archive/issue_events_396585.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396585"
}
```



---

archive/issue_events_396586.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396586"
}
```



---

archive/issue_events_396587.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396587"
}
```



---

archive/issue_comments_450609.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450609",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_396588.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396588"
}
```



---

archive/issue_events_396589.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396589"
}
```



---

archive/issue_comments_450610.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28870#issuecomment-450610",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_396590.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396590"
}
```



---

archive/issue_events_396591.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396591"
}
```



---

archive/issue_events_396592.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396592"
}
```



---

archive/issue_events_396593.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396593"
}
```



---

archive/issue_events_396594.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396594"
}
```



---

archive/issue_events_396595.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28870",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28870#event-396595"
}
```
