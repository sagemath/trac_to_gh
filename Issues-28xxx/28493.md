# Issue 28493: Update to primecount 5.1

archive/issues_028256.json:
```json
{
    "body": "The C++ API no longer exposes the different methods, see https://github.com/kimwalisch/primecount/releases/tag/v5.1\n\nTarball: https://codeload.github.com/kimwalisch/primecount/tar.gz/v5.1\n\n\nCC:  @videlec @timokau @kiwifb @isuruf @saraedum\n\nBranch/Commit: [d3170a4395f46556f476d1a829b2a6b1d26e850a](https://github.com/sagemath/sagetrac-mirror/commit/d3170a4395f46556f476d1a829b2a6b1d26e850a)\n\nReviewer: Vincent Delecroix\n\nAuthor: Antonio Rojas\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28493\n\n",
    "closed_at": "2019-10-05T07:58:02Z",
    "created_at": "2019-09-14T15:54:35Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Update to primecount 5.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28493",
    "user": "https://github.com/antonio-rojas"
}
```
The C++ API no longer exposes the different methods, see https://github.com/kimwalisch/primecount/releases/tag/v5.1

Tarball: https://codeload.github.com/kimwalisch/primecount/tar.gz/v5.1


CC:  @videlec @timokau @kiwifb @isuruf @saraedum

Branch/Commit: [d3170a4395f46556f476d1a829b2a6b1d26e850a](https://github.com/sagemath/sagetrac-mirror/commit/d3170a4395f46556f476d1a829b2a6b1d26e850a)

Reviewer: Vincent Delecroix

Author: Antonio Rojas

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28493





---

archive/issue_comments_554081.json:
```json
{
    "body": "Changing branch from \"\" to \"u/arojas/update_to_primecount_5_1\"",
    "created_at": "2019-09-14T16:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554081",
    "user": "https://github.com/antonio-rojas"
}
```

Changing branch from "" to "u/arojas/update_to_primecount_5_1"



---

archive/issue_comments_554082.json:
```json
{
    "body": "Changing commit from \"\" to \"23a6eaa5e2983f71c7cef0d4beb30defb83351be\"",
    "created_at": "2019-09-14T16:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554082",
    "user": "https://github.com/antonio-rojas"
}
```

Changing commit from "" to "23a6eaa5e2983f71c7cef0d4beb30defb83351be"



---

archive/issue_comments_554083.json:
```json
{
    "body": "<a id='comment:2'></a>\n---\nNew commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[23a6eaa](https://github.com/sagemath/sagetrac-mirror/commit/23a6eaa5e2983f71c7cef0d4beb30defb83351be)|`Update primecount to 5.1`|",
    "created_at": "2019-09-14T16:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554083",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'></a>
---
New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[23a6eaa](https://github.com/sagemath/sagetrac-mirror/commit/23a6eaa5e2983f71c7cef0d4beb30defb83351be)|`Update primecount to 5.1`|



---

archive/issue_comments_554084.json:
```json
{
    "body": "Changing author from \"\" to \"Antonio Rojas\"",
    "created_at": "2019-09-14T16:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554084",
    "user": "https://github.com/antonio-rojas"
}
```

Changing author from "" to "Antonio Rojas"



---

archive/issue_comments_554085.json:
```json
{
    "body": "<a id='comment:3'></a>\nI can't get it to show the deprecation message - does it not work in cython?",
    "created_at": "2019-09-14T16:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554085",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:3'></a>
I can't get it to show the deprecation message - does it not work in cython?



---

archive/issue_comments_554086.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n+The C++ API no longer exposes the different methods, see https://github.com/kimwalisch/primecount/releases/tag/v5.1\n \n+Tarball: https://codeload.github.com/kimwalisch/primecount/tar.gz/v5.1\n+\n``````\n",
    "created_at": "2019-09-14T16:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554086",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
+The C++ API no longer exposes the different methods, see https://github.com/kimwalisch/primecount/releases/tag/v5.1
 
+Tarball: https://codeload.github.com/kimwalisch/primecount/tar.gz/v5.1
+
``````




---

archive/issue_comments_554087.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt should work but I also don't see the deprecation message.\n\nThe message shows in the doctest environment since with the following modification the tests pass\n\n```diff\ndiff --git a/src/sage/interfaces/primecount.pyx b/src/sage/interfaces/primecount.pyx\nindex fe69d26748..623240d39f 100644\n--- a/src/sage/interfaces/primecount.pyx\n+++ b/src/sage/interfaces/primecount.pyx\n@@ -38,6 +38,13 @@ cpdef int64_t prime_pi(int64_t n, method=None) except -1:\n \n         sage: prime_pi(1000) == 168                     # optional - primecount\n         True\n+\n+        sage: prime_pi(1000, method='deleglise_rivat') == 168\n+        doctest:warning\n+        ...\n+        DeprecationWarning: primecount 5.x no longer supports the 'method' parameter\n+        See https://trac.sagemath.org/28493 for details.\n+        True\n     \"\"\"\n     cdef int64_t ans\n     if method is not None:\n```",
    "created_at": "2019-09-14T18:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554087",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
It should work but I also don't see the deprecation message.

The message shows in the doctest environment since with the following modification the tests pass

```diff
diff --git a/src/sage/interfaces/primecount.pyx b/src/sage/interfaces/primecount.pyx
index fe69d26748..623240d39f 100644
--- a/src/sage/interfaces/primecount.pyx
+++ b/src/sage/interfaces/primecount.pyx
@@ -38,6 +38,13 @@ cpdef int64_t prime_pi(int64_t n, method=None) except -1:
 
         sage: prime_pi(1000) == 168                     # optional - primecount
         True
+
+        sage: prime_pi(1000, method='deleglise_rivat') == 168
+        doctest:warning
+        ...
+        DeprecationWarning: primecount 5.x no longer supports the 'method' parameter
+        See https://trac.sagemath.org/28493 for details.
+        True
     """
     cdef int64_t ans
     if method is not None:
```



---

archive/issue_comments_554088.json:
```json
{
    "body": "<a id='comment:6'></a>\nYou are right. It seems that all `DeprecationWarning` from Cython code are turned off. Two other examples from `matroids/matroid.pyx` and `matrix/matrix_integer_dense.pyx`.\n\n```\nsage: matroids.Uniform(2, 3).is_3connected(separation=True)\n(True, None)\nsage: matrix(2, [2,1,1,1])._invert_unit()\n[ 1 -1]\n[-1  2]\n```",
    "created_at": "2019-09-14T18:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554088",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
You are right. It seems that all `DeprecationWarning` from Cython code are turned off. Two other examples from `matroids/matroid.pyx` and `matrix/matrix_integer_dense.pyx`.

```
sage: matroids.Uniform(2, 3).is_3connected(separation=True)
(True, None)
sage: matrix(2, [2,1,1,1])._invert_unit()
[ 1 -1]
[-1  2]
```



---

archive/issue_comments_554089.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-14T18:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554089",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_554090.json:
```json
{
    "body": "<a id='comment:7'></a>\nSetting to needs_review then, since the problem is not in this patch",
    "created_at": "2019-09-14T18:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554090",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'></a>
Setting to needs_review then, since the problem is not in this patch



---

archive/issue_comments_554091.json:
```json
{
    "body": "<a id='comment:8'></a>\nCC'ing other packagers, in case they also package this",
    "created_at": "2019-09-14T18:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554091",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:8'></a>
CC'ing other packagers, in case they also package this



---

archive/issue_comments_554092.json:
```json
{
    "body": "<a id='comment:9'></a>\nStill, the deprecation would better be doctested... see my patch [comment:5].",
    "created_at": "2019-09-15T13:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554092",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
Still, the deprecation would better be doctested... see my patch [comment:5].



---

archive/issue_comments_554093.json:
```json
{
    "body": "<a id='comment:10'></a>\nSee #28500 for the problem with deprecation not showing up.",
    "created_at": "2019-09-15T13:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554093",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
See #28500 for the problem with deprecation not showing up.



---

archive/issue_comments_554094.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[d3170a4](https://github.com/sagemath/sagetrac-mirror/commit/d3170a4395f46556f476d1a829b2a6b1d26e850a)|`Test deprecation warning`|",
    "created_at": "2019-09-15T13:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[d3170a4](https://github.com/sagemath/sagetrac-mirror/commit/d3170a4395f46556f476d1a829b2a6b1d26e850a)|`Test deprecation warning`|



---

archive/issue_comments_554095.json:
```json
{
    "body": "Changing commit from \"23a6eaa5e2983f71c7cef0d4beb30defb83351be\" to \"d3170a4395f46556f476d1a829b2a6b1d26e850a\"",
    "created_at": "2019-09-15T13:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "23a6eaa5e2983f71c7cef0d4beb30defb83351be" to "d3170a4395f46556f476d1a829b2a6b1d26e850a"



---

archive/issue_comments_554096.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2019-09-15T14:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554096",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_554097.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-15T14:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554097",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_554098.json:
```json
{
    "body": "<a id='comment:12'></a>\nthanks",
    "created_at": "2019-09-15T14:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554098",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>
thanks



---

archive/issue_events_080816.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-30T08:12:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28493#event-80816"
}
```



---

archive/issue_comments_554099.json:
```json
{
    "body": "<a id='comment:13'></a>\nmoving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554099",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
moving milestone to 9.0 (after release of 8.9)



---

archive/issue_events_080817.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-05T07:58:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28493#event-80817"
}
```



---

archive/issue_comments_554100.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-05T07:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554100",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_554101.json:
```json
{
    "body": "Changing branch from \"u/arojas/update_to_primecount_5_1\" to \"d3170a4395f46556f476d1a829b2a6b1d26e850a\"",
    "created_at": "2019-10-05T07:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28493#issuecomment-554101",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/arojas/update_to_primecount_5_1" to "d3170a4395f46556f476d1a829b2a6b1d26e850a"
