# Issue 28037: topcom should not set itself up as default "engine".

archive/issues_027800.json:
```json
{
    "body": "if you have topcom installed, the following shows that `sleep` dominates the runtime (on bigger examples it's even much worse,\nsee somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)\n\n```\nsage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])\nsage: %prun p.volume()  \nncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        5    0.202    0.040    0.202    0.040 {time.sleep}\n        3    0.006    0.002    0.006    0.002 {posix.read}\n        1    0.004    0.004    0.004    0.004 {posix.forkpty}\n        4    0.002    0.000    0.002    0.000 {select.select}\n        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)\n```\n\n---\n\nas well, `make topcom-clean` must work; currently it does not remove the corresponding binaries, and after runnig it still\n\n```\nsage: P=PointConfiguration([(0,1/3),(0,1),(1/3,1)])\nsage: P._have_TOPCOM()\nTrue\n```\nand topcom is kept as the default engine...\n\n\nCC:  @seblabbe @vbraun @mkoeppe\n\nBranch/Commit: e4cdf639a1128b80c586f77140f57eae1f8ada0c\n\nReviewer: Dima Pasechnik\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28037\n\n",
    "closed_at": "2019-06-28T04:29:29Z",
    "created_at": "2019-06-21T10:10:32Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "topcom should not set itself up as default \"engine\".",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28037",
    "user": "https://github.com/dimpase"
}
```
if you have topcom installed, the following shows that `sleep` dominates the runtime (on bigger examples it's even much worse,
see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)

```
sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])
sage: %prun p.volume()  
ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        5    0.202    0.040    0.202    0.040 {time.sleep}
        3    0.006    0.002    0.006    0.002 {posix.read}
        1    0.004    0.004    0.004    0.004 {posix.forkpty}
        4    0.002    0.000    0.002    0.000 {select.select}
        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)
```

---

as well, `make topcom-clean` must work; currently it does not remove the corresponding binaries, and after runnig it still

```
sage: P=PointConfiguration([(0,1/3),(0,1),(1/3,1)])
sage: P._have_TOPCOM()
True
```
and topcom is kept as the default engine...


CC:  @seblabbe @vbraun @mkoeppe

Branch/Commit: e4cdf639a1128b80c586f77140f57eae1f8ada0c

Reviewer: Dima Pasechnik

Author: Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28037





---

archive/issue_comments_418042.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+if you have topcom installed, the following shows that \\`sleep\\` dominates the runtime (on bigger examples it's even much worse,\n+see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)\n+\n+\\`\\`\\`\n+sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])\n+sage: %prun p.volume()  \n+ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n+        5    0.202    0.040    0.202    0.040 {time.sleep}\n+        3    0.006    0.002    0.006    0.002 {posix.read}\n+        1    0.004    0.004    0.004    0.004 {posix.forkpty}\n+        4    0.002    0.000    0.002    0.000 {select.select}\n+        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)\n \n \n Comment: 1\n```\n",
    "created_at": "2019-06-21T10:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418042",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,15 @@
+if you have topcom installed, the following shows that \`sleep\` dominates the runtime (on bigger examples it's even much worse,
+see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)
+
+\`\`\`
+sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])
+sage: %prun p.volume()  
+ncalls  tottime  percall  cumtime  percall filename:lineno(function)
+        5    0.202    0.040    0.202    0.040 {time.sleep}
+        3    0.006    0.002    0.006    0.002 {posix.read}
+        1    0.004    0.004    0.004    0.004 {posix.forkpty}
+        4    0.002    0.000    0.002    0.000 {select.select}
+        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)
 
 
 Comment: 1
```




---

archive/issue_comments_418043.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,26 @@\n+if you have topcom installed, the following shows that \\`sleep\\` dominates the runtime (on bigger examples it's even much worse,\n+see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)\n+\n+\\`\\`\\`\n+sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])\n+sage: %prun p.volume()  \n+ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n+        5    0.202    0.040    0.202    0.040 {time.sleep}\n+        3    0.006    0.002    0.006    0.002 {posix.read}\n+        1    0.004    0.004    0.004    0.004 {posix.forkpty}\n+        4    0.002    0.000    0.002    0.000 {select.select}\n+        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)\n+\n+\n+----\n+\n+as well, \\`make topcom-clean\\` must work; currently it does not remove the corresponding binaries, and after runnig it still\n+{{{\n+sage: P=PointConfiguration([(0,1/3),(0,1),(1/3,1)])\n+sage: P._have_TOPCOM()\n+True\n+}}}\n+and topcom is kept as the default engine...\n \n \n Comment: 1\n```\n",
    "created_at": "2019-06-21T10:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418043",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,26 @@
+if you have topcom installed, the following shows that \`sleep\` dominates the runtime (on bigger examples it's even much worse,
+see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)
+
+\`\`\`
+sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])
+sage: %prun p.volume()  
+ncalls  tottime  percall  cumtime  percall filename:lineno(function)
+        5    0.202    0.040    0.202    0.040 {time.sleep}
+        3    0.006    0.002    0.006    0.002 {posix.read}
+        1    0.004    0.004    0.004    0.004 {posix.forkpty}
+        4    0.002    0.000    0.002    0.000 {select.select}
+        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)
+
+
+----
+
+as well, \`make topcom-clean\` must work; currently it does not remove the corresponding binaries, and after runnig it still
+{{{
+sage: P=PointConfiguration([(0,1/3),(0,1),(1/3,1)])
+sage: P._have_TOPCOM()
+True
+}}}
+and topcom is kept as the default engine...
 
 
 Comment: 1
```




---

archive/issue_comments_418044.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,27 @@\n+if you have topcom installed, the following shows that \\`sleep\\` dominates the runtime (on bigger examples it's even much worse,\n+see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)\n+\n+\\`\\`\\`\n+sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])\n+sage: %prun p.volume()  \n+ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n+        5    0.202    0.040    0.202    0.040 {time.sleep}\n+        3    0.006    0.002    0.006    0.002 {posix.read}\n+        1    0.004    0.004    0.004    0.004 {posix.forkpty}\n+        4    0.002    0.000    0.002    0.000 {select.select}\n+        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)\n+\\`\\`\\`\n+\n+---\n+\n+as well, \\`make topcom-clean\\` must work; currently it does not remove the corresponding binaries, and after runnig it still\n+\n+\\`\\`\\`\n+sage: P=PointConfiguration([(0,1/3),(0,1),(1/3,1)])\n+sage: P._have_TOPCOM()\n+True\n+\\`\\`\\`\n+and topcom is kept as the default engine...\n \n \n Comment: 1\n```\n",
    "created_at": "2019-06-21T10:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418044",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,27 @@
+if you have topcom installed, the following shows that \`sleep\` dominates the runtime (on bigger examples it's even much worse,
+see somewhat misnamed thread [here](https://groups.google.com/d/msg/sage-devel/a4bhT34LLas/zcWsxH-nBAAJ)
+
+\`\`\`
+sage: p = Polyhedron([(0,1/3),(0,1),(1/3,1)])
+sage: %prun p.volume()  
+ncalls  tottime  percall  cumtime  percall filename:lineno(function)
+        5    0.202    0.040    0.202    0.040 {time.sleep}
+        3    0.006    0.002    0.006    0.002 {posix.read}
+        1    0.004    0.004    0.004    0.004 {posix.forkpty}
+        4    0.002    0.000    0.002    0.000 {select.select}
+        2    0.001    0.000    0.218    0.109 point_configuration.py:671(_TOPCOM_communicate)
+\`\`\`
+
+---
+
+as well, \`make topcom-clean\` must work; currently it does not remove the corresponding binaries, and after runnig it still
+
+\`\`\`
+sage: P=PointConfiguration([(0,1/3),(0,1),(1/3,1)])
+sage: P._have_TOPCOM()
+True
+\`\`\`
+and topcom is kept as the default engine...
 
 
 Comment: 1
```




---

archive/issue_comments_418045.json:
```json
{
    "body": "<a id='comment:4'></a>There is no `sleep` call in the file `point_configuration.py`. I am wondering in which line of which file are the `time.sleep` calls being done?",
    "created_at": "2019-06-24T08:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418045",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>There is no `sleep` call in the file `point_configuration.py`. I am wondering in which line of which file are the `time.sleep` calls being done?



---

archive/issue_comments_418046.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 slabbe]:\n> There is no `sleep` call in the file `point_configuration.py`. I am wondering in which line of which file are the `time.sleep` calls being done?\n\n\nthey come from the topcom's pexpect interface.\n\n```\npexpect-4.6.0/pexpect $ grep -R \"time.sleep\" .\n./pty_spawn.py:            time.sleep(0.1)\n./pty_spawn.py:            time.sleep(self.delaybeforesend)\n./pty_spawn.py:            time.sleep(self.delayafterterminate)\n./pty_spawn.py:            time.sleep(self.delayafterterminate)\n./pty_spawn.py:            time.sleep(self.delayafterterminate)\n./pty_spawn.py:                time.sleep(self.delayafterterminate)\n./pty_spawn.py:            time.sleep(self.delayafterterminate)\n./spawnbase.py:        # Set this to None to skip the time.sleep() call completely.\n./spawnbase.py:        # Set this to None to skip the time.sleep() call completely: that\n./expect.py:                    time.sleep(self.spawn.delayafterread)\n./pxssh.py:        time.sleep(0.1)\n```",
    "created_at": "2019-06-24T08:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418046",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>Replying to [comment:4 slabbe]:
> There is no `sleep` call in the file `point_configuration.py`. I am wondering in which line of which file are the `time.sleep` calls being done?


they come from the topcom's pexpect interface.

```
pexpect-4.6.0/pexpect $ grep -R "time.sleep" .
./pty_spawn.py:            time.sleep(0.1)
./pty_spawn.py:            time.sleep(self.delaybeforesend)
./pty_spawn.py:            time.sleep(self.delayafterterminate)
./pty_spawn.py:            time.sleep(self.delayafterterminate)
./pty_spawn.py:            time.sleep(self.delayafterterminate)
./pty_spawn.py:                time.sleep(self.delayafterterminate)
./pty_spawn.py:            time.sleep(self.delayafterterminate)
./spawnbase.py:        # Set this to None to skip the time.sleep() call completely.
./spawnbase.py:        # Set this to None to skip the time.sleep() call completely: that
./expect.py:                    time.sleep(self.spawn.delayafterread)
./pxssh.py:        time.sleep(0.1)
```



---

archive/issue_comments_418047.json:
```json
{
    "body": "<a id='comment:6'></a>This removes TOPCOM from being the default engine for triangulations. While this fixes the issue, maybe there exist examples where using TOPCOM as default engine would be desirable?\n\n---\nNew commits:",
    "created_at": "2019-06-25T14:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418047",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>This removes TOPCOM from being the default engine for triangulations. While this fixes the issue, maybe there exist examples where using TOPCOM as default engine would be desirable?

---
New commits:



---

archive/issue_comments_418048.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-26T23:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418048",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418049.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 slabbe]:\n> This removes TOPCOM from being the default engine for triangulations. While this fixes the issue, maybe there exist examples where using TOPCOM as default engine would be desirable?\n\n\nNo objections to changing the default engine as in the proposed patch.\n\nFor computing one triangulation, if I remember correctly, there's nothing special in TOPCOM; it just computes a regular triangulation via cddlib. Using normaliz for computing a triangulation is probably faster.\n\nFor listing all triangulations, TOPCOM is probably the best choice for nontrivial examples, but the interfacing should be improved.",
    "created_at": "2019-06-26T23:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418049",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Replying to [comment:6 slabbe]:
> This removes TOPCOM from being the default engine for triangulations. While this fixes the issue, maybe there exist examples where using TOPCOM as default engine would be desirable?


No objections to changing the default engine as in the proposed patch.

For computing one triangulation, if I remember correctly, there's nothing special in TOPCOM; it just computes a regular triangulation via cddlib. Using normaliz for computing a triangulation is probably faster.

For listing all triangulations, TOPCOM is probably the best choice for nontrivial examples, but the interfacing should be improved.



---

archive/issue_comments_418050.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-27T07:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418050",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418051.json:
```json
{
    "body": "<a id='comment:9'></a>OK, let's get it in.",
    "created_at": "2019-06-27T07:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418051",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>OK, let's get it in.



---

archive/issue_comments_418052.json:
```json
{
    "body": "<a id='comment:10'></a>by the way, the bot says\n\n```\n+src/sage/geometry/triangulation/point_configuration.py:1919: undefined name 'ker'\n+src/sage/geometry/triangulation/point_configuration.py:1923: local variable 'ker' is assigned to but never used\n```\ndoes this make sense to fix?",
    "created_at": "2019-06-27T07:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418052",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>by the way, the bot says

```
+src/sage/geometry/triangulation/point_configuration.py:1919: undefined name 'ker'
+src/sage/geometry/triangulation/point_configuration.py:1923: local variable 'ker' is assigned to but never used
```
does this make sense to fix?



---

archive/issue_comments_418053.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-06-27T08:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_418054.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-06-27T08:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_418055.json:
```json
{
    "body": "<a id='comment:12'></a>I updated the doc according to the new default behavior.\n\nI need to catch a plane today and will be unavailable during the next week. I had no time now to fix the ker thing (I don't understand how this part of code can work as the `ker` is indeed not defined before being used). So I let you do the follow up if needed.",
    "created_at": "2019-06-27T08:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418055",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:12'></a>I updated the doc according to the new default behavior.

I need to catch a plane today and will be unavailable during the next week. I had no time now to fix the ker thing (I don't understand how this part of code can work as the `ker` is indeed not defined before being used). So I let you do the follow up if needed.



---

archive/issue_comments_418056.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 slabbe]:\n> I updated the doc according to the new default behavior.\n> \n> I need to catch a plane today and will be unavailable during the next week. I had no time now to fix the ker thing (I don't understand how this part of code can work as the `ker` is indeed not defined before being used). So I let you do the follow up if needed.\n\n\nI think it's actually OK, as on the 1st run of the loop the condition where `ker` is used is never reached (as `edges == []` at this moment, so `if edges ...` stops at evaluating `edges` and does not see `ker`); and then `ker` is set, and all is kosher.",
    "created_at": "2019-06-27T09:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418056",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>Replying to [comment:12 slabbe]:
> I updated the doc according to the new default behavior.
> 
> I need to catch a plane today and will be unavailable during the next week. I had no time now to fix the ker thing (I don't understand how this part of code can work as the `ker` is indeed not defined before being used). So I let you do the follow up if needed.


I think it's actually OK, as on the 1st run of the loop the condition where `ker` is used is never reached (as `edges == []` at this moment, so `if edges ...` stops at evaluating `edges` and does not see `ker`); and then `ker` is set, and all is kosher.



---

archive/issue_comments_418057.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-27T09:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418057",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418058.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-28T04:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28037#issuecomment-418058",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069493.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-28T04:29:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28037",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28037#event-69493"
}
```
