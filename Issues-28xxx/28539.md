# Issue 28539: Optimization for small permutation groups

archive/issues_028302.json:
```json
{
    "body": "This ticket proposes micro optimizations for small permutation\ngroups. The rationale is to handle the situation where we have\nbillions of combinatorial objects and need to run through their\nautomorphism groups most of which are trivial or let's say have\nsize at most 100. An even more concrete application is given by\n[admcycles MR 14](https://gitlab.com/jo314schmitt/admcycles/merge_requests/14)\nwhere there is an attempt to use graph automorphisms from Sage\ninstead of a handmade implementation. This turns out to result\nin a major slowdown! For example\n\n```\nsage: from admcycles.admcycles import Hyperell\nsage: %time H = Hyperell(3)\n```\ntakes 13.5 s on master but with MR 14 takes 17.4 s.\n\nThe profiling points to\n\n- the constructor `__init__` of `PermutationGroupElement`:\n  see #28652\n- the `subgroup` method of `PermutationGroupElement`\n- the product `p1 * p2` when `p1` is a symmetric group element\n  and `p2` is a permutation group on the same domain:\n  see #28652 (and also the bug #28544)\n- `__iter__` for `PermutationGroupElement` (that currently\n  involves computing a strong generating scheme):\n  see #28652 and #28653\n\nThe optimizations proposed in this ticket noticeably speed up\nthe `Hyperell(3)` computation mentioned above: from 17.4 s with\nthe previous Sage implementation or 13.5 s with admcycle's\nprevious handmade implementation, the timing goes down to 9 s.\n\n**CC:**  @tscrim @fchapoton @simonbrandhorst\n\n**Branch:** [u/vdelecroix/28539](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/28539)\n\n**Commit:** [44bd8638bebbed543ff6f3c13846893ebca17f8b](https://github.com/sagemath/sagetrac-mirror/commit/44bd8638bebbed543ff6f3c13846893ebca17f8b)\n\n**Author:** Vincent Delecroix\n\n**Status:** needs_work\n\n**Dependencies:** #28544, #28652, #28653\n\nIssue created by migration from https://trac.sagemath.org/ticket/28539\n\n",
    "created_at": "2019-09-26T11:16:12Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Optimization for small permutation groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28539",
    "user": "https://github.com/videlec"
}
```
This ticket proposes micro optimizations for small permutation
groups. The rationale is to handle the situation where we have
billions of combinatorial objects and need to run through their
automorphism groups most of which are trivial or let's say have
size at most 100. An even more concrete application is given by
[admcycles MR 14](https://gitlab.com/jo314schmitt/admcycles/merge_requests/14)
where there is an attempt to use graph automorphisms from Sage
instead of a handmade implementation. This turns out to result
in a major slowdown! For example

```
sage: from admcycles.admcycles import Hyperell
sage: %time H = Hyperell(3)
```
takes 13.5 s on master but with MR 14 takes 17.4 s.

The profiling points to

- the constructor `__init__` of `PermutationGroupElement`:
  see #28652
- the `subgroup` method of `PermutationGroupElement`
- the product `p1 * p2` when `p1` is a symmetric group element
  and `p2` is a permutation group on the same domain:
  see #28652 (and also the bug #28544)
- `__iter__` for `PermutationGroupElement` (that currently
  involves computing a strong generating scheme):
  see #28652 and #28653

The optimizations proposed in this ticket noticeably speed up
the `Hyperell(3)` computation mentioned above: from 17.4 s with
the previous Sage implementation or 13.5 s with admcycle's
previous handmade implementation, the timing goes down to 9 s.

**CC:**  @tscrim @fchapoton @simonbrandhorst

**Branch:** [u/vdelecroix/28539](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/28539)

**Commit:** [44bd8638bebbed543ff6f3c13846893ebca17f8b](https://github.com/sagemath/sagetrac-mirror/commit/44bd8638bebbed543ff6f3c13846893ebca17f8b)

**Author:** Vincent Delecroix

**Status:** needs_work

**Dependencies:** #28544, #28652, #28653

Issue created by migration from https://trac.sagemath.org/ticket/28539





---

archive/issue_comments_529343.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f67ffcc1bcfcd460a6364948e0c875573f31675c\">f67ffcc</a></td><td><code>WIP: make small perm group faster</code></td></tr></table>\n",
    "created_at": "2019-09-26T11:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529343",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f67ffcc1bcfcd460a6364948e0c875573f31675c">f67ffcc</a></td><td><code>WIP: make small perm group faster</code></td></tr></table>




---

archive/issue_comments_529344.json:
```json
{
    "body": "**Commit:** [f67ffcc1bcfcd460a6364948e0c875573f31675c](https://github.com/sagemath/sagetrac-mirror/commit/f67ffcc1bcfcd460a6364948e0c875573f31675c)",
    "created_at": "2019-09-26T11:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529344",
    "user": "https://github.com/videlec"
}
```

**Commit:** [f67ffcc1bcfcd460a6364948e0c875573f31675c](https://github.com/sagemath/sagetrac-mirror/commit/f67ffcc1bcfcd460a6364948e0c875573f31675c)



---

archive/issue_comments_529345.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/28539](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/28539)",
    "created_at": "2019-09-26T11:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529345",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/28539](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/28539)



---

archive/issue_comments_529346.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,3 +11,5 @@\n - the `.subgroup` method of `PermutationGroupElement`\n - the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain\n - `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme)\n+\n+Implementing these optimizations lower the `Hyperell(3)` computation mentioned above from 17.4 sec to 9 sec.\n``````\n",
    "created_at": "2019-09-28T15:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529346",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,3 +11,5 @@
 - the `.subgroup` method of `PermutationGroupElement`
 - the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain
 - `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme)
+
+Implementing these optimizations lower the `Hyperell(3)` computation mentioned above from 17.4 sec to 9 sec.
``````




---

archive/issue_comments_529347.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/096659c01162baf6b5d636892be2ba9ef9eddcf7\">096659c</a></td><td><code>28539: rework constructor of PermutationGroupElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d23d92160997f6928547228c423e69058ac270c\">2d23d92</a></td><td><code>28539: faster multiplication and iteration</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d00d370600628267fe190a12b052f493a93358a6\">d00d370</a></td><td><code>28539: fix some doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5888249fc1586dd44d245145525f4119a913a89a\">5888249</a></td><td><code>28539: mark not tested bug tracked in #28544</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0dbcc3383eac6497c1f7c0711e17b9e831cfeb14\">0dbcc33</a></td><td><code>28539: reynolds operator and Galois conjugation</code></td></tr></table>\n",
    "created_at": "2019-09-30T08:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529347",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/096659c01162baf6b5d636892be2ba9ef9eddcf7">096659c</a></td><td><code>28539: rework constructor of PermutationGroupElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d23d92160997f6928547228c423e69058ac270c">2d23d92</a></td><td><code>28539: faster multiplication and iteration</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d00d370600628267fe190a12b052f493a93358a6">d00d370</a></td><td><code>28539: fix some doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5888249fc1586dd44d245145525f4119a913a89a">5888249</a></td><td><code>28539: mark not tested bug tracked in #28544</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0dbcc3383eac6497c1f7c0711e17b9e831cfeb14">0dbcc33</a></td><td><code>28539: reynolds operator and Galois conjugation</code></td></tr></table>




---

archive/issue_comments_529348.json:
```json
{
    "body": "**Changing commit** from \"[f67ffcc1bcfcd460a6364948e0c875573f31675c](https://github.com/sagemath/sagetrac-mirror/commit/f67ffcc1bcfcd460a6364948e0c875573f31675c)\" to \"[0dbcc3383eac6497c1f7c0711e17b9e831cfeb14](https://github.com/sagemath/sagetrac-mirror/commit/0dbcc3383eac6497c1f7c0711e17b9e831cfeb14)\".",
    "created_at": "2019-09-30T08:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f67ffcc1bcfcd460a6364948e0c875573f31675c](https://github.com/sagemath/sagetrac-mirror/commit/f67ffcc1bcfcd460a6364948e0c875573f31675c)" to "[0dbcc3383eac6497c1f7c0711e17b9e831cfeb14](https://github.com/sagemath/sagetrac-mirror/commit/0dbcc3383eac6497c1f7c0711e17b9e831cfeb14)".



---

archive/issue_comments_529349.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-09-30T08:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529349",
    "user": "https://github.com/videlec"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_529350.json:
```json
{
    "body": "<a id='comment:5'></a>\nhmm some py2/py3 issue I guess.",
    "created_at": "2019-09-30T12:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529350",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
hmm some py2/py3 issue I guess.



---

archive/issue_comments_529351.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2019-09-30T12:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529351",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_529352.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c629059dafe513cc0574e9239df5c9286988b00\">2c62905</a></td><td><code>28539: rework constructor of PermutationGroupElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55d3e8a1bc997cf30895aa2eae94d595e9a02054\">55d3e8a</a></td><td><code>28539: faster multiplication and iteration</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b027f910bec4d19cf2c739c0024bac62132ea0a1\">b027f91</a></td><td><code>28539: fix some doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d77c23d04de2755a280705121cebe887087c051\">5d77c23</a></td><td><code>28539: mark not tested bug tracked in #28544</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ca3833fff437f52136279a0c6273954f093a8b1\">6ca3833</a></td><td><code>28539: reynolds operator and Galois conjugation</code></td></tr></table>\n",
    "created_at": "2019-09-30T14:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c629059dafe513cc0574e9239df5c9286988b00">2c62905</a></td><td><code>28539: rework constructor of PermutationGroupElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55d3e8a1bc997cf30895aa2eae94d595e9a02054">55d3e8a</a></td><td><code>28539: faster multiplication and iteration</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b027f910bec4d19cf2c739c0024bac62132ea0a1">b027f91</a></td><td><code>28539: fix some doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d77c23d04de2755a280705121cebe887087c051">5d77c23</a></td><td><code>28539: mark not tested bug tracked in #28544</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ca3833fff437f52136279a0c6273954f093a8b1">6ca3833</a></td><td><code>28539: reynolds operator and Galois conjugation</code></td></tr></table>




---

archive/issue_comments_529353.json:
```json
{
    "body": "**Changing commit** from \"[0dbcc3383eac6497c1f7c0711e17b9e831cfeb14](https://github.com/sagemath/sagetrac-mirror/commit/0dbcc3383eac6497c1f7c0711e17b9e831cfeb14)\" to \"[6ca3833fff437f52136279a0c6273954f093a8b1](https://github.com/sagemath/sagetrac-mirror/commit/6ca3833fff437f52136279a0c6273954f093a8b1)\".",
    "created_at": "2019-09-30T14:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0dbcc3383eac6497c1f7c0711e17b9e831cfeb14](https://github.com/sagemath/sagetrac-mirror/commit/0dbcc3383eac6497c1f7c0711e17b9e831cfeb14)" to "[6ca3833fff437f52136279a0c6273954f093a8b1](https://github.com/sagemath/sagetrac-mirror/commit/6ca3833fff437f52136279a0c6273954f093a8b1)".



---

archive/issue_comments_529354.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44bd8638bebbed543ff6f3c13846893ebca17f8b\">44bd863</a></td><td><code>28539: fix more doctests (python2 and python3)</code></td></tr></table>\n",
    "created_at": "2019-09-30T15:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44bd8638bebbed543ff6f3c13846893ebca17f8b">44bd863</a></td><td><code>28539: fix more doctests (python2 and python3)</code></td></tr></table>




---

archive/issue_comments_529355.json:
```json
{
    "body": "**Changing commit** from \"[6ca3833fff437f52136279a0c6273954f093a8b1](https://github.com/sagemath/sagetrac-mirror/commit/6ca3833fff437f52136279a0c6273954f093a8b1)\" to \"[44bd8638bebbed543ff6f3c13846893ebca17f8b](https://github.com/sagemath/sagetrac-mirror/commit/44bd8638bebbed543ff6f3c13846893ebca17f8b)\".",
    "created_at": "2019-09-30T15:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6ca3833fff437f52136279a0c6273954f093a8b1](https://github.com/sagemath/sagetrac-mirror/commit/6ca3833fff437f52136279a0c6273954f093a8b1)" to "[44bd8638bebbed543ff6f3c13846893ebca17f8b](https://github.com/sagemath/sagetrac-mirror/commit/44bd8638bebbed543ff6f3c13846893ebca17f8b)".



---

archive/issue_comments_529356.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2019-09-30T15:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529356",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_529357.json:
```json
{
    "body": "<a id='comment:9'></a>\nStill failing. And proliferation of #py2 and # py3 does not seem to be a good solution.",
    "created_at": "2019-10-01T06:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529357",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
Still failing. And proliferation of #py2 and # py3 does not seem to be a good solution.



---

archive/issue_comments_529358.json:
```json
{
    "body": "<a id='comment:10'></a>\nI agree with Fr\u00e9d\u00e9ric that adding a whole bunch of `# py2` and `# py3` tags is not a good solution. I am assuming this comes from this change:\n\n```diff\n-        return self.iteration(algorithm=\"SGS\")\n+        if len(self._gens) == 1:\n+            return self._iteration_monogen()\n+        elif self.cardinality() <= 100:\n+            return self.iteration(algorithm=\"BFS\")\n+        else:\n+            return self.iteration(algorithm=\"SGS\")\n```\nand the `BFS` option calls `RecursivelyEnumeratedSet`, which has consistency problems on Python3 IIRC. So we have to solve that bigger problem first.\n\nI have some other comments:\n\nI don't see the point of going to cycles just to convert back here:\n\n```\nreturn grp.element_class(self.to_cycles(singletons=False), grp, check=False)\n```\nI know this was already done, but it seems useless as the `PermutationGroupElement` stores things internally as a list in essentially the same way.\n\nI would probably Cythonize `from_cycles`.\n\nIs there a reason why `_set_identity` and `_set_list_images` are `cpdef` and not just `cdef` (which is faster when being called by C code)? By being `cpdef`, they also need doctests.",
    "created_at": "2019-10-02T01:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529358",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
I agree with Frédéric that adding a whole bunch of `# py2` and `# py3` tags is not a good solution. I am assuming this comes from this change:

```diff
-        return self.iteration(algorithm="SGS")
+        if len(self._gens) == 1:
+            return self._iteration_monogen()
+        elif self.cardinality() <= 100:
+            return self.iteration(algorithm="BFS")
+        else:
+            return self.iteration(algorithm="SGS")
```
and the `BFS` option calls `RecursivelyEnumeratedSet`, which has consistency problems on Python3 IIRC. So we have to solve that bigger problem first.

I have some other comments:

I don't see the point of going to cycles just to convert back here:

```
return grp.element_class(self.to_cycles(singletons=False), grp, check=False)
```
I know this was already done, but it seems useless as the `PermutationGroupElement` stores things internally as a list in essentially the same way.

I would probably Cythonize `from_cycles`.

Is there a reason why `_set_identity` and `_set_list_images` are `cpdef` and not just `cdef` (which is faster when being called by C code)? By being `cpdef`, they also need doctests.



---

archive/issue_comments_529359.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2019-10-02T01:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529359",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_529360.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks for the feedback. I will cut the ticket and start by optimizing the constructor. Optimizing the iterator will be postponed to another one.",
    "created_at": "2019-10-02T03:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529360",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Thanks for the feedback. I will cut the ticket and start by optimizing the constructor. Optimizing the iterator will be postponed to another one.



---

archive/issue_comments_529361.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n takes 13.5 sec on master but with MR 14 takes 17.4 sec.\n \n The profiling points to\n-- the constructor `__init__` of `PermutationGroupElement`\n+- the constructor `__init__` of `PermutationGroupElement`: see #28652\n - the `.subgroup` method of `PermutationGroupElement`\n - the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain\n - `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme)\n``````\n",
    "created_at": "2019-10-25T01:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529361",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 takes 13.5 sec on master but with MR 14 takes 17.4 sec.
 
 The profiling points to
-- the constructor `__init__` of `PermutationGroupElement`
+- the constructor `__init__` of `PermutationGroupElement`: see #28652
 - the `.subgroup` method of `PermutationGroupElement`
 - the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain
 - `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme)
``````




---

archive/issue_comments_529362.json:
```json
{
    "body": "**Dependencies:** #28652",
    "created_at": "2019-10-25T01:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529362",
    "user": "https://github.com/videlec"
}
```

**Dependencies:** #28652



---

archive/issue_comments_529363.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n The profiling points to\n - the constructor `__init__` of `PermutationGroupElement`: see #28652\n - the `.subgroup` method of `PermutationGroupElement`\n-- the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain\n-- `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme)\n+- the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain: see #28652 (and also the bug #28544)\n+- `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme): see #28652 and #28653\n \n Implementing these optimizations lower the `Hyperell(3)` computation mentioned above from 17.4 sec to 9 sec.\n``````\n",
    "created_at": "2019-10-25T04:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529363",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 The profiling points to
 - the constructor `__init__` of `PermutationGroupElement`: see #28652
 - the `.subgroup` method of `PermutationGroupElement`
-- the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain
-- `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme)
+- the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain: see #28652 (and also the bug #28544)
+- `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme): see #28652 and #28653
 
 Implementing these optimizations lower the `Hyperell(3)` computation mentioned above from 17.4 sec to 9 sec.
``````




---

archive/issue_comments_529364.json:
```json
{
    "body": "**Changing dependencies** from \"#28652\" to \"#28544, #28652, #28653\".",
    "created_at": "2019-10-25T04:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529364",
    "user": "https://github.com/videlec"
}
```

**Changing dependencies** from "#28652" to "#28544, #28652, #28653".



---

archive/issue_comments_529365.json:
```json
{
    "body": "<a id='comment:14'></a>\nSee also #28674 which should eventually solve the consistency problems of `RecursivelyEnumeratedSet`.",
    "created_at": "2019-10-29T23:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529365",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:14'></a>
See also #28674 which should eventually solve the consistency problems of `RecursivelyEnumeratedSet`.



---

archive/issue_comments_529366.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [gh-mwageringel](#comment%3A14):\n> See also #28674 which should eventually solve the consistency problems of `RecursivelyEnumeratedSet`.\n\n\nI don't think that the enumeration order is relevant here. This is convenient for doctests and only shows the weakness of them.",
    "created_at": "2019-10-31T15:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529366",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Replying to [gh-mwageringel](#comment%3A14):
> See also #28674 which should eventually solve the consistency problems of `RecursivelyEnumeratedSet`.


I don't think that the enumeration order is relevant here. This is convenient for doctests and only shows the weakness of them.



---

archive/issue_events_080642.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80642"
}
```



---

archive/issue_comments_529367.json:
```json
{
    "body": "<a id='comment:16'></a>\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529367",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_529368.json:
```json
{
    "body": "<a id='comment:17'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529368",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_080643.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80643"
}
```



---

archive/issue_events_080644.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80644"
}
```



---

archive/issue_comments_529369.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,32 @@\n-This ticket stands for micro optimizations for small permutation groups. The rationale is to handle the situation where we have a billion of combinatorial objects and need to run through their automorphism groups most of which are trivial or let say, <= 100 elements. An even more concrete application is given by the [admcycles MR 14](https://gitlab.com/jo314schmitt/admcycles/merge_requests/14) where there is a tentative to use graph automorphisms from Sage instead of an handmade implementation. It turns out that this is slowing down a lot! For example\n+This ticket proposes micro optimizations for small permutation\n+groups. The rationale is to handle the situation where we have\n+billions of combinatorial objects and need to run through their\n+automorphism groups most of which are trivial or let's say have\n+size at most 100. An even more concrete application is given by\n+[admcycles MR 14](https://gitlab.com/jo314schmitt/admcycles/merge_requests/14)\n+where there is an attempt to use graph automorphisms from Sage\n+instead of a handmade implementation. This turns out to result\n+in a major slowdown! For example\n \n ```\n sage: from admcycles.admcycles import Hyperell\n sage: %time H = Hyperell(3)\n ```\n-takes 13.5 sec on master but with MR 14 takes 17.4 sec.\n+takes 13.5 s on master but with MR 14 takes 17.4 s.\n \n The profiling points to\n-- the constructor `__init__` of `PermutationGroupElement`: see #28652\n-- the `.subgroup` method of `PermutationGroupElement`\n-- the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain: see #28652 (and also the bug #28544)\n-- `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme): see #28652 and #28653\n \n-Implementing these optimizations lower the `Hyperell(3)` computation mentioned above from 17.4 sec to 9 sec.\n+- the constructor `__init__` of `PermutationGroupElement`:\n+  see #28652\n+- the `subgroup` method of `PermutationGroupElement`\n+- the product `p1 * p2` when `p1` is a symmetric group element\n+  and `p2` is a permutation group on the same domain:\n+  see #28652 (and also the bug #28544)\n+- `__iter__` for `PermutationGroupElement` (that currently\n+  involves computing a strong generating scheme):\n+  see #28652 and #28653\n+\n+The optimizations proposed in this ticket noticeably speed up\n+the `Hyperell(3)` computation mentioned above: from 17.4 s with\n+the previous Sage implementation or 13.5 s with admcycle's\n+previous handmade implementation, the timing goes down to 9 s.\n``````\n",
    "created_at": "2020-08-31T20:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529369",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,32 @@
-This ticket stands for micro optimizations for small permutation groups. The rationale is to handle the situation where we have a billion of combinatorial objects and need to run through their automorphism groups most of which are trivial or let say, <= 100 elements. An even more concrete application is given by the [admcycles MR 14](https://gitlab.com/jo314schmitt/admcycles/merge_requests/14) where there is a tentative to use graph automorphisms from Sage instead of an handmade implementation. It turns out that this is slowing down a lot! For example
+This ticket proposes micro optimizations for small permutation
+groups. The rationale is to handle the situation where we have
+billions of combinatorial objects and need to run through their
+automorphism groups most of which are trivial or let's say have
+size at most 100. An even more concrete application is given by
+[admcycles MR 14](https://gitlab.com/jo314schmitt/admcycles/merge_requests/14)
+where there is an attempt to use graph automorphisms from Sage
+instead of a handmade implementation. This turns out to result
+in a major slowdown! For example
 
 ```
 sage: from admcycles.admcycles import Hyperell
 sage: %time H = Hyperell(3)
 ```
-takes 13.5 sec on master but with MR 14 takes 17.4 sec.
+takes 13.5 s on master but with MR 14 takes 17.4 s.
 
 The profiling points to
-- the constructor `__init__` of `PermutationGroupElement`: see #28652
-- the `.subgroup` method of `PermutationGroupElement`
-- the product `p1 * p2` when `p1` is a symmetric group element and `p2` is a permutation group on the same domain: see #28652 (and also the bug #28544)
-- `__iter__` for `PermutationGroupElement` (that currently involves computing a strong generating scheme): see #28652 and #28653
 
-Implementing these optimizations lower the `Hyperell(3)` computation mentioned above from 17.4 sec to 9 sec.
+- the constructor `__init__` of `PermutationGroupElement`:
+  see #28652
+- the `subgroup` method of `PermutationGroupElement`
+- the product `p1 * p2` when `p1` is a symmetric group element
+  and `p2` is a permutation group on the same domain:
+  see #28652 (and also the bug #28544)
+- `__iter__` for `PermutationGroupElement` (that currently
+  involves computing a strong generating scheme):
+  see #28652 and #28653
+
+The optimizations proposed in this ticket noticeably speed up
+the `Hyperell(3)` computation mentioned above: from 17.4 s with
+the previous Sage implementation or 13.5 s with admcycle's
+previous handmade implementation, the timing goes down to 9 s.
``````




---

archive/issue_comments_529370.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2020-08-31T20:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529370",
    "user": "https://github.com/slel"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_529371.json:
```json
{
    "body": "<a id='comment:18'></a>\nSupporting Python 2 is no longer needed now.",
    "created_at": "2020-08-31T20:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529371",
    "user": "https://github.com/slel"
}
```

<a id='comment:18'></a>
Supporting Python 2 is no longer needed now.



---

archive/issue_events_080645.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80645"
}
```



---

archive/issue_events_080646.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80646"
}
```



---

archive/issue_comments_529372.json:
```json
{
    "body": "<a id='comment:20'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529372",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_080647.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80647"
}
```



---

archive/issue_events_080648.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80648"
}
```



---

archive/issue_comments_529373.json:
```json
{
    "body": "<a id='comment:21'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28539#issuecomment-529373",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_080649.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80649"
}
```



---

archive/issue_events_080650.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80650"
}
```



---

archive/issue_events_080651.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80651"
}
```



---

archive/issue_events_080652.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80652"
}
```



---

archive/issue_events_080653.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80653"
}
```



---

archive/issue_events_080654.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80654"
}
```



---

archive/issue_events_080655.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80655"
}
```



---

archive/issue_events_080656.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28539",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28539#event-80656"
}
```
