# Issue 28502: MR36: Use Sphinx hash function

archive/issues_028265.json:
```json
{
    "assignees": [],
    "body": "https://gitlab.com/sagemath/sage/merge_requests/36:\n\n`make doc` rebuilds lots of things every time. Just run `make doc` twice to see how this is broken currently.\n\nThis is a major problem with our docker builds. Their test-dev stage times out all the time because of this.\n\nThere are several underlying problems it seems:\n\n* the hash function that Sphinx uses has changed, our code uses the wrong hash function\n* rebuilds depend on the mtime of .pyc files not on the actual .py files. (this is a problem with the docker builds.)\n* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. Maybe the pickle is somehow platform dependent which makes this breaks when the docker image is pulled on a different platform?\n\nDepends on #28041\n\n**CC:**  @slel @nthiery @embray @roed314 @videlec\n\n**Keywords:** docker, ci\n\n**Branch/Commit:** [b37257c69a4924271047dd8e54c50e3ab1d4f8b7](https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7)\n\n**Reviewer:** John Palmieri\n\n**Author:** Julian R\u00fcth\n\nIssue created by migration from https://trac.sagemath.org/ticket/28502\n\n",
    "closed_at": "2019-11-07T23:30:12Z",
    "created_at": "2019-09-15T16:16:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20documentation",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "MR36: Use Sphinx hash function",
    "type": "issue",
    "updated_at": "2019-11-07T23:30:12Z",
    "url": "https://github.com/sagemath/sage/issues/28502",
    "user": "https://github.com/sagetrac-galois"
}
```
https://gitlab.com/sagemath/sage/merge_requests/36:

`make doc` rebuilds lots of things every time. Just run `make doc` twice to see how this is broken currently.

This is a major problem with our docker builds. Their test-dev stage times out all the time because of this.

There are several underlying problems it seems:

* the hash function that Sphinx uses has changed, our code uses the wrong hash function
* rebuilds depend on the mtime of .pyc files not on the actual .py files. (this is a problem with the docker builds.)
* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. Maybe the pickle is somehow platform dependent which makes this breaks when the docker image is pulled on a different platform?

Depends on #28041

**CC:**  @slel @nthiery @embray @roed314 @videlec

**Keywords:** docker, ci

**Branch/Commit:** [b37257c69a4924271047dd8e54c50e3ab1d4f8b7](https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7)

**Reviewer:** John Palmieri

**Author:** Julian Rüth

Issue created by migration from https://trac.sagemath.org/ticket/28502





---

archive/issue_events_252348.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-09-15T16:19:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "08517b",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252348"
}
```



---

archive/issue_events_252349.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-09-15T16:19:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252349"
}
```



---

archive/issue_comments_447067.json:
```json
{
    "body": "**Description changed:**\n``````diff\n\n``````\n",
    "created_at": "2019-09-15T16:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447067",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff

``````




---

archive/issue_comments_447068.json:
```json
{
    "body": "<a id='comment:1'></a>\nCCing some people who care about docker images. This is responsible for a fraction of our automated docker builds failing. They fail the `test-dev` stage which checks that `make doc` does not take too long. Sometimes it just finshes in time, sometimes it takes too long.",
    "created_at": "2019-09-15T16:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447068",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:1'></a>
CCing some people who care about docker images. This is responsible for a fraction of our automated docker builds failing. They fail the `test-dev` stage which checks that `make doc` does not take too long. Sometimes it just finshes in time, sometimes it takes too long.



---

archive/issue_comments_447069.json:
```json
{
    "body": "<a id='comment:2'></a>\nNote that Sphinx's current hash function is\n\n```\ndef get_stable_hash(obj):\n    # type: (Any) -> unicode\n    \"\"\"\n    Return a stable hash for a Python data structure.  We can't just use\n    the md5 of str(obj) since for example dictionary items are enumerated\n    in unpredictable order due to hash randomization in newer Pythons.\n    \"\"\"\n    if isinstance(obj, dict):\n        return get_stable_hash(list(obj.items()))\n    elif isinstance(obj, (list, tuple)):\n        obj = sorted(get_stable_hash(o) for o in obj)\n    return md5(text_type(obj).encode('utf8')).hexdigest()\n```\n\nI assume it used to be just the last line at some point.",
    "created_at": "2019-09-15T16:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447069",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>
Note that Sphinx's current hash function is

```
def get_stable_hash(obj):
    # type: (Any) -> unicode
    """
    Return a stable hash for a Python data structure.  We can't just use
    the md5 of str(obj) since for example dictionary items are enumerated
    in unpredictable order due to hash randomization in newer Pythons.
    """
    if isinstance(obj, dict):
        return get_stable_hash(list(obj.items()))
    elif isinstance(obj, (list, tuple)):
        obj = sorted(get_stable_hash(o) for o in obj)
    return md5(text_type(obj).encode('utf8')).hexdigest()
```

I assume it used to be just the last line at some point.



---

archive/issue_comments_447070.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3a8d31f5c79c4d720ea97bf085351cb41a40450\">d3a8d31</a></td><td><code>Do not sort explicitly</code></td></tr></table>\n",
    "created_at": "2019-09-15T16:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447070",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:3'></a>
New commits added to merge request.  I updated the commit SHA-1.  **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3a8d31f5c79c4d720ea97bf085351cb41a40450">d3a8d31</a></td><td><code>Do not sort explicitly</code></td></tr></table>




---

archive/issue_comments_447071.json:
```json
{
    "body": "**Changing commit** from \"[6be239c8950800ab79b0d06514b602c14f69ccfb](https://github.com/sagemath/sagetrac-mirror/commit/6be239c8950800ab79b0d06514b602c14f69ccfb)\" to \"[d3a8d31f5c79c4d720ea97bf085351cb41a40450](https://github.com/sagemath/sagetrac-mirror/commit/d3a8d31f5c79c4d720ea97bf085351cb41a40450)\".",
    "created_at": "2019-09-15T16:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447071",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[6be239c8950800ab79b0d06514b602c14f69ccfb](https://github.com/sagemath/sagetrac-mirror/commit/6be239c8950800ab79b0d06514b602c14f69ccfb)" to "[d3a8d31f5c79c4d720ea97bf085351cb41a40450](https://github.com/sagemath/sagetrac-mirror/commit/d3a8d31f5c79c4d720ea97bf085351cb41a40450)".



---

archive/issue_comments_447072.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,13 +1,5 @@\n-Julian R\u00fcth ([@saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/36:\n+https://gitlab.com/sagemath/sage/merge_requests/36:\n \n----\n+`make doc` rebuilds lots of things every time. Just run `make doc` twice to see how this is broken currently.\n \n-```markdown\n-otherwise lots of doc rebuilds (this is a huge problem with building\n-docker images.)\n-```\n-\n-\n-\n-\n-\n+This is a major problem with our docker builds. Their test-dev stage times out all the time because of this.\n``````\n",
    "created_at": "2019-09-15T16:24:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447072",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,13 +1,5 @@
-Julian Rüth ([@saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/36:
+https://gitlab.com/sagemath/sage/merge_requests/36:
 
----
+`make doc` rebuilds lots of things every time. Just run `make doc` twice to see how this is broken currently.
 
-```markdown
-otherwise lots of doc rebuilds (this is a huge problem with building
-docker images.)
-```
-
-
-
-
-
+This is a major problem with our docker builds. Their test-dev stage times out all the time because of this.
``````




---

archive/issue_comments_447073.json:
```json
{
    "body": "<a id='comment:5'></a>\nUnfortunately, this is not the only problem. Docs are still rebuilding during docker builds.",
    "created_at": "2019-09-15T17:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447073",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>
Unfortunately, this is not the only problem. Docs are still rebuilding during docker builds.



---

archive/issue_events_252350.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-09-15T17:11:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252350"
}
```



---

archive/issue_events_252351.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-09-15T17:11:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252351"
}
```



---

archive/issue_comments_447074.json:
```json
{
    "body": "**Changing commit** from \"[d3a8d31f5c79c4d720ea97bf085351cb41a40450](https://github.com/sagemath/sagetrac-mirror/commit/d3a8d31f5c79c4d720ea97bf085351cb41a40450)\" to \"[3aff80ee4e13fabbab944761ae99ea9b22f35374](https://github.com/sagemath/sagetrac-mirror/commit/3aff80ee4e13fabbab944761ae99ea9b22f35374)\".",
    "created_at": "2019-09-15T17:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447074",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[d3a8d31f5c79c4d720ea97bf085351cb41a40450](https://github.com/sagemath/sagetrac-mirror/commit/d3a8d31f5c79c4d720ea97bf085351cb41a40450)" to "[3aff80ee4e13fabbab944761ae99ea9b22f35374](https://github.com/sagemath/sagetrac-mirror/commit/3aff80ee4e13fabbab944761ae99ea9b22f35374)".



---

archive/issue_comments_447075.json:
```json
{
    "body": "<a id='comment:6'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3aff80ee4e13fabbab944761ae99ea9b22f35374\">3aff80e</a></td><td><code>add debug info</code></td></tr></table>\n",
    "created_at": "2019-09-15T17:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447075",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:6'></a>
New commits added to merge request.  I updated the commit SHA-1.  **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3aff80ee4e13fabbab944761ae99ea9b22f35374">3aff80e</a></td><td><code>add debug info</code></td></tr></table>




---

archive/issue_comments_447076.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  This was a forced push.  **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8acd2774d842f2c20777f248df68b842f8ba15b9\">8acd277</a></td><td><code>Use upstream BuildInfo instead of rolling our own</code></td></tr></table>\n",
    "created_at": "2019-09-15T18:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447076",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:7'></a>
New commits added to merge request.  I updated the commit SHA-1.  This was a forced push.  **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8acd2774d842f2c20777f248df68b842f8ba15b9">8acd277</a></td><td><code>Use upstream BuildInfo instead of rolling our own</code></td></tr></table>




---

archive/issue_comments_447077.json:
```json
{
    "body": "**Changing commit** from \"[3aff80ee4e13fabbab944761ae99ea9b22f35374](https://github.com/sagemath/sagetrac-mirror/commit/3aff80ee4e13fabbab944761ae99ea9b22f35374)\" to \"[8acd2774d842f2c20777f248df68b842f8ba15b9](https://github.com/sagemath/sagetrac-mirror/commit/8acd2774d842f2c20777f248df68b842f8ba15b9)\".",
    "created_at": "2019-09-15T18:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447077",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[3aff80ee4e13fabbab944761ae99ea9b22f35374](https://github.com/sagemath/sagetrac-mirror/commit/3aff80ee4e13fabbab944761ae99ea9b22f35374)" to "[8acd2774d842f2c20777f248df68b842f8ba15b9](https://github.com/sagemath/sagetrac-mirror/commit/8acd2774d842f2c20777f248df68b842f8ba15b9)".



---

archive/issue_comments_447078.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"docker, ci\".",
    "created_at": "2019-09-15T19:40:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447078",
    "user": "https://github.com/saraedum"
}
```

**Changing keywords** from "" to "docker, ci".



---

archive/issue_comments_447079.json:
```json
{
    "body": "**Changing commit** from \"[8acd2774d842f2c20777f248df68b842f8ba15b9](https://github.com/sagemath/sagetrac-mirror/commit/8acd2774d842f2c20777f248df68b842f8ba15b9)\" to \"[15a267ae12b69fad05550bcb9e3e49f3037001ad](https://github.com/sagemath/sagetrac-mirror/commit/15a267ae12b69fad05550bcb9e3e49f3037001ad)\".",
    "created_at": "2019-09-16T00:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447079",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[8acd2774d842f2c20777f248df68b842f8ba15b9](https://github.com/sagemath/sagetrac-mirror/commit/8acd2774d842f2c20777f248df68b842f8ba15b9)" to "[15a267ae12b69fad05550bcb9e3e49f3037001ad](https://github.com/sagemath/sagetrac-mirror/commit/15a267ae12b69fad05550bcb9e3e49f3037001ad)".



---

archive/issue_comments_447080.json:
```json
{
    "body": "<a id='comment:9'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15a267ae12b69fad05550bcb9e3e49f3037001ad\">15a267a</a></td><td><code>Do not depend on .pyc files</code></td></tr></table>\n",
    "created_at": "2019-09-16T00:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447080",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:9'></a>
New commits added to merge request.  I updated the commit SHA-1.  **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15a267ae12b69fad05550bcb9e3e49f3037001ad">15a267a</a></td><td><code>Do not depend on .pyc files</code></td></tr></table>




---

archive/issue_comments_447081.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,9 @@\n `make doc` rebuilds lots of things every time. Just run `make doc` twice to see how this is broken currently.\n \n This is a major problem with our docker builds. Their test-dev stage times out all the time because of this.\n+\n+There are several underlying problems it seems:\n+\n+* the hash function that Sphinx uses has changed, our code uses the wrong hash function\n+* rebuilds depend on the mtime of .pyc files not on the actual .py files. (this is a problem with the docker builds.)\n+* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. I have no clue what's going on here.\n``````\n",
    "created_at": "2019-09-16T00:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447081",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,9 @@
 `make doc` rebuilds lots of things every time. Just run `make doc` twice to see how this is broken currently.
 
 This is a major problem with our docker builds. Their test-dev stage times out all the time because of this.
+
+There are several underlying problems it seems:
+
+* the hash function that Sphinx uses has changed, our code uses the wrong hash function
+* rebuilds depend on the mtime of .pyc files not on the actual .py files. (this is a problem with the docker builds.)
+* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. I have no clue what's going on here.
``````




---

archive/issue_comments_447082.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,4 +8,4 @@\n \n * the hash function that Sphinx uses has changed, our code uses the wrong hash function\n * rebuilds depend on the mtime of .pyc files not on the actual .py files. (this is a problem with the docker builds.)\n-* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. I have no clue what's going on here.\n+* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. Maybe the pickle is somehow platform dependent which makes this breaks when the docker image is pulled on a different platform?\n``````\n",
    "created_at": "2019-09-16T00:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447082",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,4 +8,4 @@
 
 * the hash function that Sphinx uses has changed, our code uses the wrong hash function
 * rebuilds depend on the mtime of .pyc files not on the actual .py files. (this is a problem with the docker builds.)
-* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. I have no clue what's going on here.
+* often config changes are detected because the `ipython_rgxout` has changed in the configuration. This is a `_sre.SRE_Pattern`. Maybe the pickle is somehow platform dependent which makes this breaks when the docker image is pulled on a different platform?
``````




---

archive/issue_comments_447083.json:
```json
{
    "body": "**Changing commit** from \"[15a267ae12b69fad05550bcb9e3e49f3037001ad](https://github.com/sagemath/sagetrac-mirror/commit/15a267ae12b69fad05550bcb9e3e49f3037001ad)\" to \"[3847a6453d111838a1f0e5be51ca41014a6f3bec](https://github.com/sagemath/sagetrac-mirror/commit/3847a6453d111838a1f0e5be51ca41014a6f3bec)\".",
    "created_at": "2019-09-16T06:19:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447083",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[15a267ae12b69fad05550bcb9e3e49f3037001ad](https://github.com/sagemath/sagetrac-mirror/commit/15a267ae12b69fad05550bcb9e3e49f3037001ad)" to "[3847a6453d111838a1f0e5be51ca41014a6f3bec](https://github.com/sagemath/sagetrac-mirror/commit/3847a6453d111838a1f0e5be51ca41014a6f3bec)".



---

archive/issue_comments_447084.json:
```json
{
    "body": "<a id='comment:12'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a229ffcedaf9d27fb7389d6612a65e58ead938e3\">a229ffc</a></td><td><code>Undo docker changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22da0878d4de129b13b4847c4090808601d9b27a\">22da087</a></td><td><code>do not remove config.status from dev image</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3d9c146ae520ed9198835bc3c100428f9a9b26a\">c3d9c14</a></td><td><code>Keep misc-clean around longer in Makefile</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54319874059f41512b6e812f020aed93eb7d0c0e\">5431987</a></td><td><code>Merge remote-tracking branch 'trac/develop' into 28041</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45268e7aef055f0c180d45235f636b1683091532\">45268e7</a></td><td><code>fix grammar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a9dd58910e1b04f1e21ae23673022592513b3b8\">9a9dd58</a></td><td><code>Merge remote-tracking branch 'trac/develop' into 28041</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89c78f8b903f225a5f2b18cc41adc245c9326964\">89c78f8</a></td><td><code>Cleanup py-3 script</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d02785aa8dca73ba9d19f9fc486d5bed8c6200a\">1d02785</a></td><td><code>Add a test-hook for build-from-clean</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca243324e4d9706a0c189193beebec09eed33a2b\">ca24332</a></td><td><code>Do not run build-from-latest for explicit builds</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3847a6453d111838a1f0e5be51ca41014a6f3bec\">3847a64</a></td><td><code>Merge remote-tracking branch 'trac/u/saraedum/28041' into stable-hash</code></td></tr></table>\n",
    "created_at": "2019-09-16T06:19:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447084",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:12'></a>
New commits added to merge request.  I updated the commit SHA-1.  **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a229ffcedaf9d27fb7389d6612a65e58ead938e3">a229ffc</a></td><td><code>Undo docker changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22da0878d4de129b13b4847c4090808601d9b27a">22da087</a></td><td><code>do not remove config.status from dev image</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3d9c146ae520ed9198835bc3c100428f9a9b26a">c3d9c14</a></td><td><code>Keep misc-clean around longer in Makefile</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54319874059f41512b6e812f020aed93eb7d0c0e">5431987</a></td><td><code>Merge remote-tracking branch 'trac/develop' into 28041</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45268e7aef055f0c180d45235f636b1683091532">45268e7</a></td><td><code>fix grammar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a9dd58910e1b04f1e21ae23673022592513b3b8">9a9dd58</a></td><td><code>Merge remote-tracking branch 'trac/develop' into 28041</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89c78f8b903f225a5f2b18cc41adc245c9326964">89c78f8</a></td><td><code>Cleanup py-3 script</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d02785aa8dca73ba9d19f9fc486d5bed8c6200a">1d02785</a></td><td><code>Add a test-hook for build-from-clean</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca243324e4d9706a0c189193beebec09eed33a2b">ca24332</a></td><td><code>Do not run build-from-latest for explicit builds</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3847a6453d111838a1f0e5be51ca41014a6f3bec">3847a64</a></td><td><code>Merge remote-tracking branch 'trac/u/saraedum/28041' into stable-hash</code></td></tr></table>




---

archive/issue_comments_447085.json:
```json
{
    "body": "**Dependencies:** #28041",
    "created_at": "2019-09-16T06:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447085",
    "user": "https://github.com/saraedum"
}
```

**Dependencies:** #28041



---

archive/issue_comments_447086.json:
```json
{
    "body": "<a id='comment:13'></a>\nThe changes seem to do the trick now as long as the same architecture runs `build-from-latest` and `test-dev`. The third bullet point from the summary should probably go into a followup ticket then. It's not as urgent and seems to be an upstream issue.",
    "created_at": "2019-09-16T06:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447086",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:13'></a>
The changes seem to do the trick now as long as the same architecture runs `build-from-latest` and `test-dev`. The third bullet point from the summary should probably go into a followup ticket then. It's not as urgent and seems to be an upstream issue.



---

archive/issue_comments_447087.json:
```json
{
    "body": "**Changing commit** from \"[3847a6453d111838a1f0e5be51ca41014a6f3bec](https://github.com/sagemath/sagetrac-mirror/commit/3847a6453d111838a1f0e5be51ca41014a6f3bec)\" to \"[ce1cb69a8e1cd73372be7cfb991d19d980b257a5](https://github.com/sagemath/sagetrac-mirror/commit/ce1cb69a8e1cd73372be7cfb991d19d980b257a5)\".",
    "created_at": "2019-09-16T09:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447087",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[3847a6453d111838a1f0e5be51ca41014a6f3bec](https://github.com/sagemath/sagetrac-mirror/commit/3847a6453d111838a1f0e5be51ca41014a6f3bec)" to "[ce1cb69a8e1cd73372be7cfb991d19d980b257a5](https://github.com/sagemath/sagetrac-mirror/commit/ce1cb69a8e1cd73372be7cfb991d19d980b257a5)".



---

archive/issue_comments_447088.json:
```json
{
    "body": "<a id='comment:14'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34749893e2c6591b034cd9f7869e0aee8062f7a2\">3474989</a></td><td><code>Protect workaround so we do not drop it easily in future upgrades</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce1cb69a8e1cd73372be7cfb991d19d980b257a5\">ce1cb69</a></td><td><code>Debugging why the docbuild is not more parallel</code></td></tr></table>\n",
    "created_at": "2019-09-16T09:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447088",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:14'></a>
New commits added to merge request.  I updated the commit SHA-1.  **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34749893e2c6591b034cd9f7869e0aee8062f7a2">3474989</a></td><td><code>Protect workaround so we do not drop it easily in future upgrades</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce1cb69a8e1cd73372be7cfb991d19d980b257a5">ce1cb69</a></td><td><code>Debugging why the docbuild is not more parallel</code></td></tr></table>




---

archive/issue_comments_447089.json:
```json
{
    "body": "**Changing commit** from \"[ce1cb69a8e1cd73372be7cfb991d19d980b257a5](https://github.com/sagemath/sagetrac-mirror/commit/ce1cb69a8e1cd73372be7cfb991d19d980b257a5)\" to \"[b37257c69a4924271047dd8e54c50e3ab1d4f8b7](https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7)\".",
    "created_at": "2019-09-16T10:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447089",
    "user": "https://github.com/sagetrac-galois"
}
```

**Changing commit** from "[ce1cb69a8e1cd73372be7cfb991d19d980b257a5](https://github.com/sagemath/sagetrac-mirror/commit/ce1cb69a8e1cd73372be7cfb991d19d980b257a5)" to "[b37257c69a4924271047dd8e54c50e3ab1d4f8b7](https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7)".



---

archive/issue_comments_447090.json:
```json
{
    "body": "<a id='comment:15'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3edf62003ecff0bd2b74872e47b8b33a316cbe26\">3edf620</a></td><td><code>Restore pass on exception</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f545047a320fe4c94bdc738f47e4451a871513fb\">f545047</a></td><td><code>Revert \"Debugging why the docbuild is not more parallel\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7\">b37257c</a></td><td><code>Parts of the docbuild are not parallel</code></td></tr></table>\n",
    "created_at": "2019-09-16T10:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447090",
    "user": "https://github.com/sagetrac-galois"
}
```

<a id='comment:15'></a>
New commits added to merge request.  I updated the commit SHA-1.  **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3edf62003ecff0bd2b74872e47b8b33a316cbe26">3edf620</a></td><td><code>Restore pass on exception</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f545047a320fe4c94bdc738f47e4451a871513fb">f545047</a></td><td><code>Revert "Debugging why the docbuild is not more parallel"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7">b37257c</a></td><td><code>Parts of the docbuild are not parallel</code></td></tr></table>




---

archive/issue_comments_447091.json:
```json
{
    "body": "<a id='comment:16'></a>\nSeems to work fine. There are no unnecessary rebuilds of documentation anymore.\n\nThe python 3 test-dev failed but that's an unrelated issue: #28507.",
    "created_at": "2019-09-16T12:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447091",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:16'></a>
Seems to work fine. There are no unnecessary rebuilds of documentation anymore.

The python 3 test-dev failed but that's an unrelated issue: #28507.



---

archive/issue_events_252352.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-09-16T12:32:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252352"
}
```



---

archive/issue_events_252353.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-09-16T12:32:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252353"
}
```



---

archive/issue_comments_447092.json:
```json
{
    "body": "<a id='comment:17'></a>\nNow that the dependency is in, this needs review :)\n\nAnd with this we should finally get working docker images automatically again.\n\nNote that I added the `!!!` because something like that used to be there but was dropped during a Sphinx upgrade.",
    "created_at": "2019-10-05T16:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447092",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:17'></a>
Now that the dependency is in, this needs review :)

And with this we should finally get working docker images automatically again.

Note that I added the `!!!` because something like that used to be there but was dropped during a Sphinx upgrade.



---

archive/issue_comments_447093.json:
```json
{
    "body": "<a id='comment:18'></a>\nThis seems okay to me. It leads to some speed-up (60 seconds without this, 45 seconds with). You could achieve even more if you could convince Sage/Sphinx to not remerge the environment/index files if nothing has changed. On my machine, that might account for about 15 seconds (out of the 45 seconds total).",
    "created_at": "2019-10-29T18:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447093",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
This seems okay to me. It leads to some speed-up (60 seconds without this, 45 seconds with). You could achieve even more if you could convince Sage/Sphinx to not remerge the environment/index files if nothing has changed. On my machine, that might account for about 15 seconds (out of the 45 seconds total).



---

archive/issue_comments_447094.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2019-11-04T21:15:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447094",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_events_252354.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-04T21:15:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252354"
}
```



---

archive/issue_events_252355.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-04T21:15:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252355"
}
```



---

archive/issue_events_252356.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2019-11-05T22:09:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252356"
}
```



---

archive/issue_events_252357.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2019-11-05T22:09:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252357"
}
```



---

archive/issue_comments_447095.json:
```json
{
    "body": "<a id='comment:21'></a>\nI haven't had much time on Sage lately so I didn't see this until now.  This is great; thank you for debugging this.",
    "created_at": "2019-11-06T12:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447095",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
I haven't had much time on Sage lately so I didn't see this until now.  This is great; thank you for debugging this.



---

archive/issue_comments_447096.json:
```json
{
    "body": "**Changing branch** from \"[u/galois/mrs/36/stable-hash](https://github.com/sagemath/sagetrac-mirror/tree/u/galois/mrs/36/stable-hash)\" to \"[b37257c69a4924271047dd8e54c50e3ab1d4f8b7](https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7)\".",
    "created_at": "2019-11-07T23:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28502#issuecomment-447096",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/galois/mrs/36/stable-hash](https://github.com/sagemath/sagetrac-mirror/tree/u/galois/mrs/36/stable-hash)" to "[b37257c69a4924271047dd8e54c50e3ab1d4f8b7](https://github.com/sagemath/sagetrac-mirror/commit/b37257c69a4924271047dd8e54c50e3ab1d4f8b7)".



---

archive/issue_events_252358.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-07T23:30:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252358"
}
```



---

archive/issue_events_252359.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0976a5cf93f3abb071b61eec62a23a2e91b1f888",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-11-07T23:30:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28502",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28502#event-252359"
}
```
