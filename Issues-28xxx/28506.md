# Issue 28506: Direct sum of polyhedron is broken, so is minkowski difference and face truncation

archive/issues_028269.json:
```json
{
    "body": "The following returns a `TypeError`:\n\n```\nsage: s2 = polytopes.simplex(2)\nsage: s3 = polytopes.simplex(3)\nsage: t = s2.direct_sum(s3)\n```\n\nH-Polyhedra might have non-integral vertices and it is hard to tell from the H-Representation, whether this this is the case.\n\nWe fix `direct_sum`, `minkowski_difference` and `face_truncation` to try the quotient ring, if the given base ring does not work.\n\nCC:  @laisrast @kliem\n\nKeywords: polytopes\n\nBranch/Commit: 6756d8a870674020479fcceef4a8d450fb87ea4f\n\nReviewer: Jean-Philippe Labb\u00e9\n\nAuthor: Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28506\n\n",
    "closed_at": "2019-11-07T23:30:10Z",
    "created_at": "2019-09-16T11:57:17Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Direct sum of polyhedron is broken, so is minkowski difference and face truncation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28506",
    "user": "https://github.com/jplab"
}
```
The following returns a `TypeError`:

```
sage: s2 = polytopes.simplex(2)
sage: s3 = polytopes.simplex(3)
sage: t = s2.direct_sum(s3)
```

H-Polyhedra might have non-integral vertices and it is hard to tell from the H-Representation, whether this this is the case.

We fix `direct_sum`, `minkowski_difference` and `face_truncation` to try the quotient ring, if the given base ring does not work.

CC:  @laisrast @kliem

Keywords: polytopes

Branch/Commit: 6756d8a870674020479fcceef4a8d450fb87ea4f

Reviewer: Jean-Philippe Labbé

Author: Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28506





---

archive/issue_comments_553071.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'll fix it. Should be fast.\n\nAs far as I know, it's difficult to determine, whether this operation can be done with ring `ZZ`. So there are basically two options:\n\n- try the operation with coerced base rings and go to quotient field, if it fails (this is how `intersection` handles it)\n- just go to field in all cases.\n\nWhat do you think is better?",
    "created_at": "2019-09-16T13:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553071",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
I'll fix it. Should be fast.

As far as I know, it's difficult to determine, whether this operation can be done with ring `ZZ`. So there are basically two options:

- try the operation with coerced base rings and go to quotient field, if it fails (this is how `intersection` handles it)
- just go to field in all cases.

What do you think is better?



---

archive/issue_comments_553072.json:
```json
{
    "body": "<a id='comment:2'></a>\n`minkowski_difference` fails for the same reason. This fails, as coercing base rings may not suffice:\n\n```\nsage: Q = Polyhedron([[1,0],[0,1]])\nsage: S = Polyhedron([[0,0],[1,2]])\nsage: S.minkowski_difference(Q)\n```\n\nSame for `face_truncation` (also there is no example of linear coefficients in the docstring):\n\n```\nsage: P = polytopes.permutahedron(3)\nsage: P.face_truncation(P.faces(0)[0], linear_coefficients=[0,1,2], cut_frac=1)\n```",
    "created_at": "2019-09-16T13:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553072",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
`minkowski_difference` fails for the same reason. This fails, as coercing base rings may not suffice:

```
sage: Q = Polyhedron([[1,0],[0,1]])
sage: S = Polyhedron([[0,0],[1,2]])
sage: S.minkowski_difference(Q)
```

Same for `face_truncation` (also there is no example of linear coefficients in the docstring):

```
sage: P = polytopes.permutahedron(3)
sage: P.face_truncation(P.faces(0)[0], linear_coefficients=[0,1,2], cut_frac=1)
```



---

archive/issue_comments_553073.json:
```json
{
    "body": "<a id='comment:3'></a>\nI did both approaches. The approach that always takes the fraction is pushed into `public/28506-bis`.\n\nI guess there are pros and cons of both methods. I think most important cons are:\n- `try ... except` might take more much more time (I assume it can theoretically compute almost everything)\n- `try ... except` is a bad approach, if there was ever a thing as a lazy polyhedron (but then again, its a bad idea to set up a lazy Polyhedron in `ZZ` from inequalities and don't check, whether this works)\n- always taking fraction field changes the behavior of the methods (and it looks awful for Minkowski decomposition)\n \n---\nNew commits:\n|                                                                                                                                          |                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[fa1a517](https://git.sagemath.org/sage.git/commit?id=fa1a517823f48f6853f578ab94eacb7678d06ec9)|`added doctests that 28506 is fixed`|\n|[e86ea8b](https://git.sagemath.org/sage.git/commit?id=e86ea8b2bbd1fdd017aa22a9318d3f08c3c3cfe6)|`fixed 28506 by trying fraction field at failure`|",
    "created_at": "2019-09-16T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553073",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
I did both approaches. The approach that always takes the fraction is pushed into `public/28506-bis`.

I guess there are pros and cons of both methods. I think most important cons are:
- `try ... except` might take more much more time (I assume it can theoretically compute almost everything)
- `try ... except` is a bad approach, if there was ever a thing as a lazy polyhedron (but then again, its a bad idea to set up a lazy Polyhedron in `ZZ` from inequalities and don't check, whether this works)
- always taking fraction field changes the behavior of the methods (and it looks awful for Minkowski decomposition)
 
---
New commits:
|                                                                                                                                          |                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[fa1a517](https://git.sagemath.org/sage.git/commit?id=fa1a517823f48f6853f578ab94eacb7678d06ec9)|`added doctests that 28506 is fixed`|
|[e86ea8b](https://git.sagemath.org/sage.git/commit?id=e86ea8b2bbd1fdd017aa22a9318d3f08c3c3cfe6)|`fixed 28506 by trying fraction field at failure`|



---

archive/issue_comments_553074.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2019-09-16T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553074",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_553075.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-16T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553075",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_553076.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,6 @@\n sage: t = s2.direct_sum(s3)\n ```\n \n+H-Polyhedra might have non-integral vertices and it is hard to tell from the H-Representation, whether this this is the case.\n+\n+We fix `direct_sum`, `minkowski_difference` and `face_truncation` to try the quotient ring, if the given base ring does not work.\n``````\n",
    "created_at": "2019-09-16T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553076",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,6 @@
 sage: t = s2.direct_sum(s3)
 ```
 
+H-Polyhedra might have non-integral vertices and it is hard to tell from the H-Representation, whether this this is the case.
+
+We fix `direct_sum`, `minkowski_difference` and `face_truncation` to try the quotient ring, if the given base ring does not work.
``````




---

archive/issue_comments_553077.json:
```json
{
    "body": "Changing branch from \"\" to \"public/28506\"",
    "created_at": "2019-09-16T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553077",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/28506"



---

archive/issue_comments_553078.json:
```json
{
    "body": "Changing commit from \"\" to \"e86ea8b2bbd1fdd017aa22a9318d3f08c3c3cfe6\"",
    "created_at": "2019-09-16T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553078",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "e86ea8b2bbd1fdd017aa22a9318d3f08c3c3cfe6"



---

archive/issue_comments_553079.json:
```json
{
    "body": "<a id='comment:4'></a>\nBtw, the constructor sets up all H-Polyhedra with base ring as field unless one specifies a specific base ring.\n\nActually, I think this is the better approach, as construction should be done with a parent, for which they are well-defined, e.g.:\n\n- intersection of Polyhedra in `ZZ^2` are only well-defined in `QQ^2`, it's strange if some constructions have parent `ZZ^2`, while others have parent `QQ^2`\n- `face_truncation` for Polyhedra over `ZZ` is only well-defined if we lift them up to `QQ`",
    "created_at": "2019-09-16T16:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553079",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>
Btw, the constructor sets up all H-Polyhedra with base ring as field unless one specifies a specific base ring.

Actually, I think this is the better approach, as construction should be done with a parent, for which they are well-defined, e.g.:

- intersection of Polyhedra in `ZZ^2` are only well-defined in `QQ^2`, it's strange if some constructions have parent `ZZ^2`, while others have parent `QQ^2`
- `face_truncation` for Polyhedra over `ZZ` is only well-defined if we lift them up to `QQ`



---

archive/issue_comments_553080.json:
```json
{
    "body": "<a id='comment:5'></a>\nOne comment:\n\nThe tests should actually return something, so I would remove `t = ` and let the output get printed.\n\nI am still a bit puzzled as to why it did not work for direct sum. What was going on there?",
    "created_at": "2019-09-20T08:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553080",
    "user": "https://github.com/jplab"
}
```

<a id='comment:5'></a>
One comment:

The tests should actually return something, so I would remove `t = ` and let the output get printed.

I am still a bit puzzled as to why it did not work for direct sum. What was going on there?



---

archive/issue_comments_553081.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jipilab](#comment%3A5):\n> One comment:\n> \n> The tests should actually return something, so I would remove `t = ` and let the output get printed.\n\n\nOk. Will do it.\n> \n> I am still a bit puzzled as to why it did not work for direct sum. What was going on there?\n\n\n```\nsage: s2 = polytopes.simplex(2)\nsage: s2.base_ring()\nInteger Ring\nsage: s = polytopes.simplex(2)\nsage: s.base_ring()\nInteger Ring\nsage: s = s.change_ring(QQ)\nsage: t = s.direct_sum(s)\nsage: t.vertices()\n(A vertex at (0, 0, 1, 0, 0, 0),\n A vertex at (0, 1, 0, 0, 0, 0),\n A vertex at (1, 0, 0, 0, 0, 0),\n A vertex at (1/3, 1/3, 1/3, -1/3, -1/3, 2/3),\n A vertex at (1/3, 1/3, 1/3, -1/3, 2/3, -1/3),\n A vertex at (1/3, 1/3, 1/3, 2/3, -1/3, -1/3))\n```\n\nDoes this answer your question? As mentioned, direct sum (as well as intersection, minkowski difference and face truncation) are only defined for polytopes/polyhedra over a field.\n\nIn the same way, that `sage: 6/2` returns a rational, I think those operations should return a polytope with base ring constructed by first coercing and then taking the fraction field.",
    "created_at": "2019-09-20T09:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553081",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
Replying to [jipilab](#comment%3A5):
> One comment:
> 
> The tests should actually return something, so I would remove `t = ` and let the output get printed.


Ok. Will do it.
> 
> I am still a bit puzzled as to why it did not work for direct sum. What was going on there?


```
sage: s2 = polytopes.simplex(2)
sage: s2.base_ring()
Integer Ring
sage: s = polytopes.simplex(2)
sage: s.base_ring()
Integer Ring
sage: s = s.change_ring(QQ)
sage: t = s.direct_sum(s)
sage: t.vertices()
(A vertex at (0, 0, 1, 0, 0, 0),
 A vertex at (0, 1, 0, 0, 0, 0),
 A vertex at (1, 0, 0, 0, 0, 0),
 A vertex at (1/3, 1/3, 1/3, -1/3, -1/3, 2/3),
 A vertex at (1/3, 1/3, 1/3, -1/3, 2/3, -1/3),
 A vertex at (1/3, 1/3, 1/3, 2/3, -1/3, -1/3))
```

Does this answer your question? As mentioned, direct sum (as well as intersection, minkowski difference and face truncation) are only defined for polytopes/polyhedra over a field.

In the same way, that `sage: 6/2` returns a rational, I think those operations should return a polytope with base ring constructed by first coercing and then taking the fraction field.



---

archive/issue_comments_553082.json:
```json
{
    "body": "<a id='comment:7'></a>\nAs mentioned. I think this approach is actually more suitable and at some point, we should change `intersection` accordingly.\n\n---\nNew commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[20ad51f](https://git.sagemath.org/sage.git/commit?id=20ad51f952b05e8ec8888e54501365f72ca527a4)|`fixed 28506 by always taking fraction field`|",
    "created_at": "2019-09-20T09:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553082",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>
As mentioned. I think this approach is actually more suitable and at some point, we should change `intersection` accordingly.

---
New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[20ad51f](https://git.sagemath.org/sage.git/commit?id=20ad51f952b05e8ec8888e54501365f72ca527a4)|`fixed 28506 by always taking fraction field`|



---

archive/issue_comments_553083.json:
```json
{
    "body": "Changing commit from \"e86ea8b2bbd1fdd017aa22a9318d3f08c3c3cfe6\" to \"20ad51f952b05e8ec8888e54501365f72ca527a4\"",
    "created_at": "2019-09-20T09:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553083",
    "user": "https://github.com/kliem"
}
```

Changing commit from "e86ea8b2bbd1fdd017aa22a9318d3f08c3c3cfe6" to "20ad51f952b05e8ec8888e54501365f72ca527a4"



---

archive/issue_comments_553084.json:
```json
{
    "body": "Changing branch from \"public/28506\" to \"public/28506-bis\"",
    "created_at": "2019-09-20T09:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553084",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/28506" to "public/28506-bis"



---

archive/issue_comments_553085.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-kliem](#comment%3A6):\n> Replying to [jipilab](#comment%3A5):\n> > One comment:\n> > \n> > The tests should actually return something, so I would remove `t = ` and let the output get printed.\n\n> \n> Ok. Will do it.\n> > \n> > I am still a bit puzzled as to why it did not work for direct sum. What was going on there?\n\n> \n> {{{\n> sage: s2 = polytopes.simplex(2)\n> sage: s2.base_ring()\n> Integer Ring\n> sage: s = polytopes.simplex(2)\n> sage: s.base_ring()\n> Integer Ring\n> sage: s = s.change_ring(QQ)\n> sage: t = s.direct_sum(s)\n> sage: t.vertices()\n> (A vertex at (0, 0, 1, 0, 0, 0),\n>  A vertex at (0, 1, 0, 0, 0, 0),\n>  A vertex at (1, 0, 0, 0, 0, 0),\n>  A vertex at (1/3, 1/3, 1/3, -1/3, -1/3, 2/3),\n>  A vertex at (1/3, 1/3, 1/3, -1/3, 2/3, -1/3),\n>  A vertex at (1/3, 1/3, 1/3, 2/3, -1/3, -1/3))\n> }}}\n> \n> Does this answer your question? As mentioned, direct sum (as well as intersection, minkowski difference and face truncation) are only defined for polytopes/polyhedra over a field.\n\n\nYes, this examples clarifies it. It should probably go right among the first examples to illustrate the construction.\n\nI was extremely confused, but now it makes sense. The problem is when we translate one of them to have center be the origin... \n\n> \n> In the same way, that `sage: 6/2` returns a rational, I think those operations should return a polytope with base ring constructed by first coercing and then taking the fraction field.\n\n\nYes, sounds reasonable.",
    "created_at": "2019-09-20T14:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553085",
    "user": "https://github.com/jplab"
}
```

<a id='comment:8'></a>
Replying to [gh-kliem](#comment%3A6):
> Replying to [jipilab](#comment%3A5):
> > One comment:
> > 
> > The tests should actually return something, so I would remove `t = ` and let the output get printed.

> 
> Ok. Will do it.
> > 
> > I am still a bit puzzled as to why it did not work for direct sum. What was going on there?

> 
> {{{
> sage: s2 = polytopes.simplex(2)
> sage: s2.base_ring()
> Integer Ring
> sage: s = polytopes.simplex(2)
> sage: s.base_ring()
> Integer Ring
> sage: s = s.change_ring(QQ)
> sage: t = s.direct_sum(s)
> sage: t.vertices()
> (A vertex at (0, 0, 1, 0, 0, 0),
>  A vertex at (0, 1, 0, 0, 0, 0),
>  A vertex at (1, 0, 0, 0, 0, 0),
>  A vertex at (1/3, 1/3, 1/3, -1/3, -1/3, 2/3),
>  A vertex at (1/3, 1/3, 1/3, -1/3, 2/3, -1/3),
>  A vertex at (1/3, 1/3, 1/3, 2/3, -1/3, -1/3))
> }}}
> 
> Does this answer your question? As mentioned, direct sum (as well as intersection, minkowski difference and face truncation) are only defined for polytopes/polyhedra over a field.


Yes, this examples clarifies it. It should probably go right among the first examples to illustrate the construction.

I was extremely confused, but now it makes sense. The problem is when we translate one of them to have center be the origin... 

> 
> In the same way, that `sage: 6/2` returns a rational, I think those operations should return a polytope with base ring constructed by first coercing and then taking the fraction field.


Yes, sounds reasonable.



---

archive/issue_comments_553086.json:
```json
{
    "body": "Changing commit from \"20ad51f952b05e8ec8888e54501365f72ca527a4\" to \"ce30313f34389112c87c250181e16c3c9f211917\"",
    "created_at": "2019-09-20T19:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553086",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "20ad51f952b05e8ec8888e54501365f72ca527a4" to "ce30313f34389112c87c250181e16c3c9f211917"



---

archive/issue_comments_553087.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[ce30313](https://git.sagemath.org/sage.git/commit/?id=ce30313f34389112c87c250181e16c3c9f211917)|`added output to doctest`|",
    "created_at": "2019-09-20T19:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[ce30313](https://git.sagemath.org/sage.git/commit/?id=ce30313f34389112c87c250181e16c3c9f211917)|`added output to doctest`|



---

archive/issue_comments_553088.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jipilab](#comment%3A8):\n> Replying to [gh-kliem](#comment%3A6):\n> > Replying to [jipilab](#comment%3A5):\n> > > One comment:\n> > > \n> > > The tests should actually return something, so I would remove `t = ` and let the output get printed.\n\n> > \n> > Ok. Will do it.\n> > > \n> > > I am still a bit puzzled as to why it did not work for direct sum. What was going on there?\n\n> > \n> > {{{\n> > sage: s2 = polytopes.simplex(2)\n> > sage: s2.base_ring()\n> > Integer Ring\n> > sage: s = polytopes.simplex(2)\n> > sage: s.base_ring()\n> > Integer Ring\n> > sage: s = s.change_ring(QQ)\n> > sage: t = s.direct_sum(s)\n> > sage: t.vertices()\n> > (A vertex at (0, 0, 1, 0, 0, 0),\n> >  A vertex at (0, 1, 0, 0, 0, 0),\n> >  A vertex at (1, 0, 0, 0, 0, 0),\n> >  A vertex at (1/3, 1/3, 1/3, -1/3, -1/3, 2/3),\n> >  A vertex at (1/3, 1/3, 1/3, -1/3, 2/3, -1/3),\n> >  A vertex at (1/3, 1/3, 1/3, 2/3, -1/3, -1/3))\n> > }}}\n> > \n> > Does this answer your question? As mentioned, direct sum (as well as intersection, minkowski difference and face truncation) are only defined for polytopes/polyhedra over a field.\n\n> \n> Yes, this examples clarifies it. It should probably go right among the first examples to illustrate the construction.\n\n\nI could of course do it. But doesn't the existing example already illustrate this?\n\n> \n> I was extremely confused, but now it makes sense. The problem is when we translate one of them to have center be the origin... \n> \n> > \n> > In the same way, that `sage: 6/2` returns a rational, I think those operations should return a polytope with base ring constructed by first coercing and then taking the fraction field.\n\n> \n> Yes, sounds reasonable.",
    "created_at": "2019-09-20T19:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553088",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>
Replying to [jipilab](#comment%3A8):
> Replying to [gh-kliem](#comment%3A6):
> > Replying to [jipilab](#comment%3A5):
> > > One comment:
> > > 
> > > The tests should actually return something, so I would remove `t = ` and let the output get printed.

> > 
> > Ok. Will do it.
> > > 
> > > I am still a bit puzzled as to why it did not work for direct sum. What was going on there?

> > 
> > {{{
> > sage: s2 = polytopes.simplex(2)
> > sage: s2.base_ring()
> > Integer Ring
> > sage: s = polytopes.simplex(2)
> > sage: s.base_ring()
> > Integer Ring
> > sage: s = s.change_ring(QQ)
> > sage: t = s.direct_sum(s)
> > sage: t.vertices()
> > (A vertex at (0, 0, 1, 0, 0, 0),
> >  A vertex at (0, 1, 0, 0, 0, 0),
> >  A vertex at (1, 0, 0, 0, 0, 0),
> >  A vertex at (1/3, 1/3, 1/3, -1/3, -1/3, 2/3),
> >  A vertex at (1/3, 1/3, 1/3, -1/3, 2/3, -1/3),
> >  A vertex at (1/3, 1/3, 1/3, 2/3, -1/3, -1/3))
> > }}}
> > 
> > Does this answer your question? As mentioned, direct sum (as well as intersection, minkowski difference and face truncation) are only defined for polytopes/polyhedra over a field.

> 
> Yes, this examples clarifies it. It should probably go right among the first examples to illustrate the construction.


I could of course do it. But doesn't the existing example already illustrate this?

> 
> I was extremely confused, but now it makes sense. The problem is when we translate one of them to have center be the origin... 
> 
> > 
> > In the same way, that `sage: 6/2` returns a rational, I think those operations should return a polytope with base ring constructed by first coercing and then taking the fraction field.

> 
> Yes, sounds reasonable.



---

archive/issue_comments_553089.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[7080349](https://git.sagemath.org/sage.git/commit/?id=7080349f1d4255d8211657689181cc13b9096977)|`fixed minkowski decomposition`|",
    "created_at": "2019-09-20T19:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[7080349](https://git.sagemath.org/sage.git/commit/?id=7080349f1d4255d8211657689181cc13b9096977)|`fixed minkowski decomposition`|



---

archive/issue_comments_553090.json:
```json
{
    "body": "Changing commit from \"ce30313f34389112c87c250181e16c3c9f211917\" to \"7080349f1d4255d8211657689181cc13b9096977\"",
    "created_at": "2019-09-20T19:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ce30313f34389112c87c250181e16c3c9f211917" to "7080349f1d4255d8211657689181cc13b9096977"



---

archive/issue_comments_553091.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [gh-kliem](#comment%3A10):\n> I could of course do it. But doesn't the existing example already illustrate this?\n> \n\n\nTrue.",
    "created_at": "2019-09-23T07:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553091",
    "user": "https://github.com/jplab"
}
```

<a id='comment:12'></a>
Replying to [gh-kliem](#comment%3A10):
> I could of course do it. But doesn't the existing example already illustrate this?
> 


True.



---

archive/issue_comments_553092.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jean-Philippe Labb\u00e9\"",
    "created_at": "2019-10-14T09:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553092",
    "user": "https://github.com/jplab"
}
```

Changing reviewer from "" to "Jean-Philippe Labbé"



---

archive/issue_events_071494.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-10-14T09:37:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28506#event-71494"
}
```



---

archive/issue_comments_553093.json:
```json
{
    "body": "<a id='comment:13'></a>\nThe \"some tests::\" might be superfluous. I would remove it.",
    "created_at": "2019-10-14T09:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553093",
    "user": "https://github.com/jplab"
}
```

<a id='comment:13'></a>
The "some tests::" might be superfluous. I would remove it.



---

archive/issue_comments_553094.json:
```json
{
    "body": "Changing commit from \"7080349f1d4255d8211657689181cc13b9096977\" to \"b1c81876e5c2a7b765df8984320ca1d3514764b6\"",
    "created_at": "2019-10-14T11:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7080349f1d4255d8211657689181cc13b9096977" to "b1c81876e5c2a7b765df8984320ca1d3514764b6"



---

archive/issue_comments_553095.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[b1c8187](https://git.sagemath.org/sage.git/commit/?id=b1c81876e5c2a7b765df8984320ca1d3514764b6)|`small changes in documentation`|",
    "created_at": "2019-10-14T11:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[b1c8187](https://git.sagemath.org/sage.git/commit/?id=b1c81876e5c2a7b765df8984320ca1d3514764b6)|`small changes in documentation`|



---

archive/issue_comments_553096.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-27T15:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553096",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_553097.json:
```json
{
    "body": "<a id='comment:15'></a>\nSome tests are failing in the thematic tutorial. See patchbots.",
    "created_at": "2019-10-27T15:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553097",
    "user": "https://github.com/jplab"
}
```

<a id='comment:15'></a>
Some tests are failing in the thematic tutorial. See patchbots.



---

archive/issue_comments_553098.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-28T06:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553098",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_553099.json:
```json
{
    "body": "Changing commit from \"b1c81876e5c2a7b765df8984320ca1d3514764b6\" to \"47514e7d31f9d22227ea16c67b18fb4330f134f4\"",
    "created_at": "2019-10-28T06:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553099",
    "user": "https://github.com/kliem"
}
```

Changing commit from "b1c81876e5c2a7b765df8984320ca1d3514764b6" to "47514e7d31f9d22227ea16c67b18fb4330f134f4"



---

archive/issue_comments_553100.json:
```json
{
    "body": "Changing branch from \"public/28506-bis\" to \"public/28506-reb2\"",
    "created_at": "2019-10-28T06:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553100",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/28506-bis" to "public/28506-reb2"



---

archive/issue_comments_553101.json:
```json
{
    "body": "<a id='comment:16'></a>\nNew commits:\n|                                                                                                                                          |                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[fc62aa6](https://git.sagemath.org/sage.git/commit?id=fc62aa606c96ae32474f44cc5708f8a8149c9dee)|`fixed trac 28506`|\n|[fa4ddc1](https://git.sagemath.org/sage.git/commit?id=fa4ddc15c4aed0a8f68f9d8b41450a21e5fc37ee)|`fixed failing doctest in documentation`|\n|[47514e7](https://git.sagemath.org/sage.git/commit?id=47514e7d31f9d22227ea16c67b18fb4330f134f4)|`Fixed trac 28506`|",
    "created_at": "2019-10-28T06:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553101",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>
New commits:
|                                                                                                                                          |                  |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[fc62aa6](https://git.sagemath.org/sage.git/commit?id=fc62aa606c96ae32474f44cc5708f8a8149c9dee)|`fixed trac 28506`|
|[fa4ddc1](https://git.sagemath.org/sage.git/commit?id=fa4ddc15c4aed0a8f68f9d8b41450a21e5fc37ee)|`fixed failing doctest in documentation`|
|[47514e7](https://git.sagemath.org/sage.git/commit?id=47514e7d31f9d22227ea16c67b18fb4330f134f4)|`Fixed trac 28506`|



---

archive/issue_comments_553102.json:
```json
{
    "body": "Changing commit from \"47514e7d31f9d22227ea16c67b18fb4330f134f4\" to \"6756d8a870674020479fcceef4a8d450fb87ea4f\"",
    "created_at": "2019-10-28T06:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "47514e7d31f9d22227ea16c67b18fb4330f134f4" to "6756d8a870674020479fcceef4a8d450fb87ea4f"



---

archive/issue_comments_553103.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[6756d8a](https://git.sagemath.org/sage.git/commit/?id=6756d8a870674020479fcceef4a8d450fb87ea4f)|`fixed trac 28506`|",
    "created_at": "2019-10-28T06:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[6756d8a](https://git.sagemath.org/sage.git/commit/?id=6756d8a870674020479fcceef4a8d450fb87ea4f)|`fixed trac 28506`|



---

archive/issue_comments_553104.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-01T17:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553104",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_553105.json:
```json
{
    "body": "<a id='comment:18'></a>\nLGTM",
    "created_at": "2019-11-01T17:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553105",
    "user": "https://github.com/jplab"
}
```

<a id='comment:18'></a>
LGTM



---

archive/issue_events_071495.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-07T23:30:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28506#event-71495"
}
```



---

archive/issue_comments_553106.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-07T23:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553106",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_553107.json:
```json
{
    "body": "Changing branch from \"public/28506-reb2\" to \"6756d8a870674020479fcceef4a8d450fb87ea4f\"",
    "created_at": "2019-11-07T23:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28506#issuecomment-553107",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/28506-reb2" to "6756d8a870674020479fcceef4a8d450fb87ea4f"
