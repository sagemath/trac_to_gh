# Issue 28585: Finite field roots

archive/issues_028348.json:
```json
{
    "body": "Implemented a \"new\" algorithm for nth root in finite fields/rings (adapted from the paper \"On taking roots in finite fields\" by Adelman et al. 1977). My tests show similar or slightly better performance at small prime moduli and significantly better performance in many cases at large prime moduli. This performance increase is mainly due to not relying on K.multiplicative_generator() which needs to factor (p-1) and leads to erratic performance.\n\nAuthor: Hauke Neitzel\n\nBranch: u/gh-theHawke/finite_field_roots\n\nStatus: needs_work\n\nCommit: 5845925c14f13ffc54fc934e9caa0f30c12f5543\n\nIssue created by migration from https://trac.sagemath.org/ticket/28585\n\n",
    "created_at": "2019-10-10T00:56:15Z",
    "labels": [
        "component: finite rings"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Finite field roots",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28585",
    "user": "https://github.com/theHawke"
}
```
Implemented a "new" algorithm for nth root in finite fields/rings (adapted from the paper "On taking roots in finite fields" by Adelman et al. 1977). My tests show similar or slightly better performance at small prime moduli and significantly better performance in many cases at large prime moduli. This performance increase is mainly due to not relying on K.multiplicative_generator() which needs to factor (p-1) and leads to erratic performance.

Author: Hauke Neitzel

Branch: u/gh-theHawke/finite_field_roots

Status: needs_work

Commit: 5845925c14f13ffc54fc934e9caa0f30c12f5543

Issue created by migration from https://trac.sagemath.org/ticket/28585





---

archive/issue_comments_554688.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-theHawke/finite_field_roots\"",
    "created_at": "2019-10-10T00:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554688",
    "user": "https://github.com/theHawke"
}
```

Changing branch from "" to "u/gh-theHawke/finite_field_roots"



---

archive/issue_comments_554689.json:
```json
{
    "body": "Changing commit from \"\" to \"533fd5d6cd806a0190571eb4c6a990afda140878\"",
    "created_at": "2019-10-10T01:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554689",
    "user": "https://github.com/theHawke"
}
```

Changing commit from "" to "533fd5d6cd806a0190571eb4c6a990afda140878"



---

archive/issue_comments_554690.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to finite rings.",
    "created_at": "2019-10-10T01:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554690",
    "user": "https://github.com/theHawke"
}
```

Changing component from PLEASE CHANGE to finite rings.



---

archive/issue_comments_554691.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+Implemented a \"new\" algorithm for nth root in finite fields/rings (adapted from the paper \"On taking roots in finite fields\" by Adelman et al. 1977). My tests show similar or slightly better performance at small prime moduli and significantly better performance in many cases at large prime moduli. This performance increase is mainly due to not relying on K.multiplicative_generator() which needs to factor (p-1) and leads to erratic performance.\n \n Comment: 1\n \n``````\n",
    "created_at": "2019-10-10T01:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554691",
    "user": "https://github.com/theHawke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+Implemented a "new" algorithm for nth root in finite fields/rings (adapted from the paper "On taking roots in finite fields" by Adelman et al. 1977). My tests show similar or slightly better performance at small prime moduli and significantly better performance in many cases at large prime moduli. This performance increase is mainly due to not relying on K.multiplicative_generator() which needs to factor (p-1) and leads to erratic performance.
 
 Comment: 1
 
``````




---

archive/issue_comments_554692.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-10-10T01:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554692",
    "user": "https://github.com/theHawke"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_554693.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-10T01:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554693",
    "user": "https://github.com/theHawke"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_554694.json:
```json
{
    "body": "Changing author from \"\" to \"Hauke Neitzel\"",
    "created_at": "2019-10-10T01:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554694",
    "user": "https://github.com/theHawke"
}
```

Changing author from "" to "Hauke Neitzel"



---

archive/issue_comments_554695.json:
```json
{
    "body": "<a id='comment:4'></a>The branch points to 9.0.beta0; did you perhaps forget to push your branch?",
    "created_at": "2019-10-10T14:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554695",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>The branch points to 9.0.beta0; did you perhaps forget to push your branch?



---

archive/issue_comments_554696.json:
```json
{
    "body": "Changing commit from \"533fd5d6cd806a0190571eb4c6a990afda140878\" to \"359dd4bf96871e9679a0fdb6193808414df5a0e0\"",
    "created_at": "2019-10-10T17:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "533fd5d6cd806a0190571eb4c6a990afda140878" to "359dd4bf96871e9679a0fdb6193808414df5a0e0"



---

archive/issue_comments_554697.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-10T17:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554697",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554698.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 pbruin]:\n> The branch points to 9.0.beta0; did you perhaps forget to push your branch?\n\n\nApologies, I didn't realize `git trac create` forks from develop instead of the current branch.\n\nEDIT: Also apologies that it is not compiling, \"it was working fine yesterday\" and I have no idea what Cython is trying to tell me.\n\nEDIT2: it was unicode quotes in the citation of the paper, ~600 lines down",
    "created_at": "2019-10-10T19:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554698",
    "user": "https://github.com/theHawke"
}
```

<a id='comment:6'></a>Replying to [comment:4 pbruin]:
> The branch points to 9.0.beta0; did you perhaps forget to push your branch?


Apologies, I didn't realize `git trac create` forks from develop instead of the current branch.

EDIT: Also apologies that it is not compiling, "it was working fine yesterday" and I have no idea what Cython is trying to tell me.

EDIT2: it was unicode quotes in the citation of the paper, ~600 lines down



---

archive/issue_comments_554699.json:
```json
{
    "body": "Changing commit from \"359dd4bf96871e9679a0fdb6193808414df5a0e0\" to \"a10ba65c6a11613ee2271ec556bd1872c017f479\"",
    "created_at": "2019-10-10T21:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "359dd4bf96871e9679a0fdb6193808414df5a0e0" to "a10ba65c6a11613ee2271ec556bd1872c017f479"



---

archive/issue_comments_554700.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-10T21:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554701.json:
```json
{
    "body": "<a id='comment:8'></a>Hi,\n\nPlease post your benchmarks instead of writing `My tests show similar or slightly better performance at small prime moduli and significantly better performance in many cases at large prime moduli.`",
    "created_at": "2019-10-14T15:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554701",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Hi,

Please post your benchmarks instead of writing `My tests show similar or slightly better performance at small prime moduli and significantly better performance in many cases at large prime moduli.`



---

archive/issue_comments_554702.json:
```json
{
    "body": "<a id='comment:9'></a>The option `algorithm=\"AMM\"` should be documented in the `INPUT` section somewhere.",
    "created_at": "2019-10-14T15:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554702",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>The option `algorithm="AMM"` should be documented in the `INPUT` section somewhere.



---

archive/issue_comments_554703.json:
```json
{
    "body": "<a id='comment:10'></a>There musts be tests associated to your new algorithm in the section `EXAMPLES:` and possibly `TESTS:`.",
    "created_at": "2019-10-14T15:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554703",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>There musts be tests associated to your new algorithm in the section `EXAMPLES:` and possibly `TESTS:`.



---

archive/issue_comments_554704.json:
```json
{
    "body": "<a id='comment:11'></a>It is often better to avoid coercion (ie comparison, operation, etc of elements with distinct parents). For example\n- `g**((q-1)/r) == 1` -> `(g**((q-1)/r)).is_one()`\n- `A*G**lam != 1` -> `not (A*G**lam).is_one()`\n- `J = 0` -> `J = K.zero()`\n- `J == 0` -> `J.is_zero()`\n- `g += 1` -> `g += one` where `one` would have been initialized to `K.one()`",
    "created_at": "2019-10-14T15:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554704",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>It is often better to avoid coercion (ie comparison, operation, etc of elements with distinct parents). For example
- `g**((q-1)/r) == 1` -> `(g**((q-1)/r)).is_one()`
- `A*G**lam != 1` -> `not (A*G**lam).is_one()`
- `J = 0` -> `J = K.zero()`
- `J == 0` -> `J.is_zero()`
- `g += 1` -> `g += one` where `one` would have been initialized to `K.one()`



---

archive/issue_comments_554705.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-14T15:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554705",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_554706.json:
```json
{
    "body": "Changing commit from \"a10ba65c6a11613ee2271ec556bd1872c017f479\" to \"495b65b7719d3dbf143cd60d789b645e968d6f94\"",
    "created_at": "2019-10-15T01:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a10ba65c6a11613ee2271ec556bd1872c017f479" to "495b65b7719d3dbf143cd60d789b645e968d6f94"



---

archive/issue_comments_554707.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-15T01:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554708.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-16T01:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554709.json:
```json
{
    "body": "Changing commit from \"495b65b7719d3dbf143cd60d789b645e968d6f94\" to \"18d1b1a446973d4efd1326320b94eb874caba524\"",
    "created_at": "2019-10-16T01:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "495b65b7719d3dbf143cd60d789b645e968d6f94" to "18d1b1a446973d4efd1326320b94eb874caba524"



---

archive/issue_comments_554710.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:11 vdelecroix]:\n> It is often better to avoid coercion (ie comparison, operation, etc of elements with distinct parents). For example\n> - `g**((q-1)/r) == 1` -> `(g**((q-1)/r)).is_one()`\n> - `A*G**lam != 1` -> `not (A*G**lam).is_one()`\n> - `J = 0` -> `J = K.zero()`\n> - `J == 0` -> `J.is_zero()`\n> - `g += 1` -> `g += one` where `one` would have been initialized to `K.one()`\n\n\nThank you for the feedback!\n\nI have now included the algorithm in the `INPUT`, `EXAMPLES` and `TEST` sections and I have attached my small benchmark script to this ticket.\n\nI have also integrated your suggestions with regard to coercion, however since `J` is an exponent like `k` and `v`, I believe it should always be an integer and shouldn't be an element of `K`.\n\nLastly, I have expanded the algorithm to include the `self.is_one()` case.",
    "created_at": "2019-10-16T02:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554710",
    "user": "https://github.com/theHawke"
}
```

<a id='comment:15'></a>Replying to [comment:11 vdelecroix]:
> It is often better to avoid coercion (ie comparison, operation, etc of elements with distinct parents). For example
> - `g**((q-1)/r) == 1` -> `(g**((q-1)/r)).is_one()`
> - `A*G**lam != 1` -> `not (A*G**lam).is_one()`
> - `J = 0` -> `J = K.zero()`
> - `J == 0` -> `J.is_zero()`
> - `g += 1` -> `g += one` where `one` would have been initialized to `K.one()`


Thank you for the feedback!

I have now included the algorithm in the `INPUT`, `EXAMPLES` and `TEST` sections and I have attached my small benchmark script to this ticket.

I have also integrated your suggestions with regard to coercion, however since `J` is an exponent like `k` and `v`, I believe it should always be an integer and shouldn't be an element of `K`.

Lastly, I have expanded the algorithm to include the `self.is_one()` case.



---

archive/issue_comments_554711.json:
```json
{
    "body": "small benchmark comparing the two algorithms",
    "created_at": "2019-10-16T02:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554711",
    "user": "https://github.com/theHawke"
}
```

small benchmark comparing the two algorithms



---

archive/issue_comments_554712.json:
```json
{
    "body": "Attachment [root_test_output.txt](tarball://root/attachments/some-uuid/ticket28585/root_test_output.txt) by @theHawke created at 2019-10-16 02:18:37\n\nsample output of the benchmark",
    "created_at": "2019-10-16T02:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554712",
    "user": "https://github.com/theHawke"
}
```

Attachment [root_test_output.txt](tarball://root/attachments/some-uuid/ticket28585/root_test_output.txt) by @theHawke created at 2019-10-16 02:18:37

sample output of the benchmark



---

archive/issue_comments_554713.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-16T02:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554713",
    "user": "https://github.com/theHawke"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_554714.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T00:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554715.json:
```json
{
    "body": "Changing commit from \"18d1b1a446973d4efd1326320b94eb874caba524\" to \"9d6a86e461e505eb57fbd8e90f9b4977a98847a7\"",
    "created_at": "2019-10-22T00:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "18d1b1a446973d4efd1326320b94eb874caba524" to "9d6a86e461e505eb57fbd8e90f9b4977a98847a7"



---

archive/issue_comments_554716.json:
```json
{
    "body": "<a id='comment:18'></a>You introduced this doctest\n\n```\nsage: a._nth_root_common(4, True, \"AMM\", cunningham = True) # optional - cunningham\n```\nwith no output!",
    "created_at": "2019-10-27T06:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554716",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>You introduced this doctest

```
sage: a._nth_root_common(4, True, "AMM", cunningham = True) # optional - cunningham
```
with no output!



---

archive/issue_comments_554717.json:
```json
{
    "body": "<a id='comment:19'></a>It would be better to not duplicate\n\n```\n            if all:\n                nthroot = g**q1overn\n                L = [self]\n                for i in range(1,n):\n                    self *= nthroot\n                    L.append(self)\n                return L\n```\n(you could move that out of the `if/else`)",
    "created_at": "2019-10-27T06:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554717",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>It would be better to not duplicate

```
            if all:
                nthroot = g**q1overn
                L = [self]
                for i in range(1,n):
                    self *= nthroot
                    L.append(self)
                return L
```
(you could move that out of the `if/else`)



---

archive/issue_comments_554718.json:
```json
{
    "body": "Changing commit from \"9d6a86e461e505eb57fbd8e90f9b4977a98847a7\" to \"3d4fcb664c33fe52bc95991cdbba6b0772deb388\"",
    "created_at": "2019-10-27T13:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9d6a86e461e505eb57fbd8e90f9b4977a98847a7" to "3d4fcb664c33fe52bc95991cdbba6b0772deb388"



---

archive/issue_comments_554719.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-27T13:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554720.json:
```json
{
    "body": "<a id='comment:21'></a>There are trailing whitespaces in several place (ie space sign before line break). Please remove them. They appear in red if you do `git diff YOUR_BRANCH MAIN_BRANCH`.",
    "created_at": "2019-10-27T17:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554720",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>There are trailing whitespaces in several place (ie space sign before line break). Please remove them. They appear in red if you do `git diff YOUR_BRANCH MAIN_BRANCH`.



---

archive/issue_comments_554721.json:
```json
{
    "body": "<a id='comment:22'></a>This is ugly\n\n```\nif y.nth_root(r)**r != y: raise RuntimeError\nif y.nth_root(r, algorithm='AMM')**r != y: raise RuntimeError\nif (y^41).nth_root(41*r)**(41*r) != y^41: raise RuntimeError\nif (y^41).nth_root(41*r, algorithm='AMM')**(41*r) != y^41: raise RuntimeError\nif (y^307).nth_root(307*r)**(307*r) != y^307: raise RuntimeError\nif (y^307).nth_root(307*r, algorithm='AMM')**(307*r) != y^307: raise RuntimeError\n```\nWhat about\n\n```\nfor s, algo in product([1,41,307], ['Johnston', 'AMM']):\n    assert (y^s).nth_root(s*r, algorithm=algo)**(s*r) == y^s\n```\n(you need a `from itertools import product`)",
    "created_at": "2019-10-27T17:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554721",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>This is ugly

```
if y.nth_root(r)**r != y: raise RuntimeError
if y.nth_root(r, algorithm='AMM')**r != y: raise RuntimeError
if (y^41).nth_root(41*r)**(41*r) != y^41: raise RuntimeError
if (y^41).nth_root(41*r, algorithm='AMM')**(41*r) != y^41: raise RuntimeError
if (y^307).nth_root(307*r)**(307*r) != y^307: raise RuntimeError
if (y^307).nth_root(307*r, algorithm='AMM')**(307*r) != y^307: raise RuntimeError
```
What about

```
for s, algo in product([1,41,307], ['Johnston', 'AMM']):
    assert (y^s).nth_root(s*r, algorithm=algo)**(s*r) == y^s
```
(you need a `from itertools import product`)



---

archive/issue_comments_554722.json:
```json
{
    "body": "<a id='comment:23'></a>More interestingly, if AMM is faster for larger moduli why not make it the default in these cases? Would this dispatch be reasonable:\n- if moduli is small just use Johnston\n- if moduli is large\n    - if a multiplicative generator is already available use Johnston\n    - if not use AMM",
    "created_at": "2019-10-27T17:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554722",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>More interestingly, if AMM is faster for larger moduli why not make it the default in these cases? Would this dispatch be reasonable:
- if moduli is small just use Johnston
- if moduli is large
    - if a multiplicative generator is already available use Johnston
    - if not use AMM



---

archive/issue_comments_554723.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 vdelecroix]:\n> More interestingly, if AMM is faster for larger moduli why not make it the default in these cases? Would this dispatch be reasonable:\n> - if moduli is small just use Johnston\n> - if moduli is large\n>     - if a multiplicative generator is already available use Johnston\n>     - if not use AMM\n\n\nSince AMM is actually slightly faster even at small moduli, it could also be made the default in general unless the multiplicative generator is available.\n\nThat said, I am not sure how to check whether the generator is available. There does seem to be some caching but I can't see a way to explicitly check it.",
    "created_at": "2019-10-27T19:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554723",
    "user": "https://github.com/theHawke"
}
```

<a id='comment:24'></a>Replying to [comment:23 vdelecroix]:
> More interestingly, if AMM is faster for larger moduli why not make it the default in these cases? Would this dispatch be reasonable:
> - if moduli is small just use Johnston
> - if moduli is large
>     - if a multiplicative generator is already available use Johnston
>     - if not use AMM


Since AMM is actually slightly faster even at small moduli, it could also be made the default in general unless the multiplicative generator is available.

That said, I am not sure how to check whether the generator is available. There does seem to be some caching but I can't see a way to explicitly check it.



---

archive/issue_comments_554724.json:
```json
{
    "body": "<a id='comment:25'></a>There is some caching\n\n```\nsage: R = Zmod(next_prime(2**10))\nsage: r = R.multiplicative_generator()\nsage: R.multiplicative_generator() is r\nTrue\n```\nor finite fields\n\n```\nsage: R = GF(next_prime(2**10)**2)\nsage: r = R.multiplicative_generator()\nsage: R.multiplicative_generator() is r\nTrue\n```\nThe cache is implemented via the decorator ``@`cached_method`. To access the cache here is what could be done\n\n```\ngen = R.multiplictative_generator.cache\nif gen is not None:\n    # gen is the multiplicative generator\n    ...\nelse:\n    # do not trigger multiplicative generator computation\n    ...\n```\n\nYou should also check timings over very small moduli, e.g things like `GF(2^5)` or `GF(3^10)`.",
    "created_at": "2019-10-27T20:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554724",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>There is some caching

```
sage: R = Zmod(next_prime(2**10))
sage: r = R.multiplicative_generator()
sage: R.multiplicative_generator() is r
True
```
or finite fields

```
sage: R = GF(next_prime(2**10)**2)
sage: r = R.multiplicative_generator()
sage: R.multiplicative_generator() is r
True
```
The cache is implemented via the decorator ``@`cached_method`. To access the cache here is what could be done

```
gen = R.multiplictative_generator.cache
if gen is not None:
    # gen is the multiplicative generator
    ...
else:
    # do not trigger multiplicative generator computation
    ...
```

You should also check timings over very small moduli, e.g things like `GF(2^5)` or `GF(3^10)`.



---

archive/issue_comments_554725.json:
```json
{
    "body": "Benchmark script for comparing the two algortihms in various situations",
    "created_at": "2019-10-29T21:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554725",
    "user": "https://github.com/theHawke"
}
```

Benchmark script for comparing the two algortihms in various situations



---

archive/issue_comments_554726.json:
```json
{
    "body": "Attachment [root_test_output.2.txt](tarball://root/attachments/some-uuid/ticket28585/root_test_output.2.txt) by @theHawke created at 2019-10-29 21:41:01\n\nsample output of the benchmark (new version)",
    "created_at": "2019-10-29T21:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554726",
    "user": "https://github.com/theHawke"
}
```

Attachment [root_test_output.2.txt](tarball://root/attachments/some-uuid/ticket28585/root_test_output.2.txt) by @theHawke created at 2019-10-29 21:41:01

sample output of the benchmark (new version)



---

archive/issue_comments_554727.json:
```json
{
    "body": "<a id='comment:26'></a>I added a couple new tests to the benchmarks. Unless you want to set a threshold at something like 11 I don't think it is worth using Johnston for small values.\n\nWhether a particular finite field is faster with Johnston or AMM seems to be fairly randomly distributed with AMM's advantage getting slightly larger as the fields order increases (goes up to 85% AMM better for orders below 10000).\n\nI would suggest making the default simply depend on the availability of a cached multiplicative generator.",
    "created_at": "2019-10-29T22:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554727",
    "user": "https://github.com/theHawke"
}
```

<a id='comment:26'></a>I added a couple new tests to the benchmarks. Unless you want to set a threshold at something like 11 I don't think it is worth using Johnston for small values.

Whether a particular finite field is faster with Johnston or AMM seems to be fairly randomly distributed with AMM's advantage getting slightly larger as the fields order increases (goes up to 85% AMM better for orders below 10000).

I would suggest making the default simply depend on the availability of a cached multiplicative generator.



---

archive/issue_comments_554728.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-29T22:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_554729.json:
```json
{
    "body": "Changing commit from \"3d4fcb664c33fe52bc95991cdbba6b0772deb388\" to \"5845925c14f13ffc54fc934e9caa0f30c12f5543\"",
    "created_at": "2019-10-29T22:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d4fcb664c33fe52bc95991cdbba6b0772deb388" to "5845925c14f13ffc54fc934e9caa0f30c12f5543"



---

archive/issue_events_071812.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71812"
}
```



---

archive/issue_comments_554730.json:
```json
{
    "body": "<a id='comment:28'></a>Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554730",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>Ticket retargeted after milestone closed



---

archive/issue_comments_554731.json:
```json
{
    "body": "<a id='comment:29'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554731",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_071813.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71813"
}
```



---

archive/issue_events_071814.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71814"
}
```



---

archive/issue_events_071815.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71815"
}
```



---

archive/issue_events_071816.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71816"
}
```



---

archive/issue_comments_554732.json:
```json
{
    "body": "<a id='comment:31'></a>The reference would better go in the dedicated file `$SAGE_ROOT/src/doc/en/reference/references/index.rst`. You can make citations using [ReST citations](https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html#citations).",
    "created_at": "2020-10-10T21:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554732",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>The reference would better go in the dedicated file `$SAGE_ROOT/src/doc/en/reference/references/index.rst`. You can make citations using [ReST citations](https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html#citations).



---

archive/issue_comments_554733.json:
```json
{
    "body": "<a id='comment:32'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_071817.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71817"
}
```



---

archive/issue_events_071818.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71818"
}
```



---

archive/issue_events_071819.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71819"
}
```



---

archive/issue_events_071820.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71820"
}
```



---

archive/issue_comments_554734.json:
```json
{
    "body": "<a id='comment:33'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554734",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_554735.json:
```json
{
    "body": "<a id='comment:34'></a>no longer applies",
    "created_at": "2021-09-18T09:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554735",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:34'></a>no longer applies



---

archive/issue_comments_554736.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-18T09:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28585#issuecomment-554736",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_071821.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71821"
}
```



---

archive/issue_events_071822.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71822"
}
```



---

archive/issue_events_071823.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71823"
}
```



---

archive/issue_events_071824.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71824"
}
```



---

archive/issue_events_071825.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71825"
}
```



---

archive/issue_events_071826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28585",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28585#event-71826"
}
```
