# Issue 28341: Allow doc to build with SAGE_PARI_CFG undefined

archive/issues_028104.json:
```json
{
    "body": "Follow up to #28242 which introduced `SAGE_PARI_CFG` in documentation build to identity whether or not pari is external.\n\nThis is inconvenient to distros and the behavior for external `pari` should be assumed if `SAGE_PARI_CFG` is undefined.\n\nCC:  @dimpase @timokau\n\nBranch/Commit: 27f17ffa52d68349ea978cea1f2acc5c55e52c19\n\nReviewer: Dima Pasechnik\n\nAuthor: Fran\u00e7ois Bissey\n\nDependencies: #28242\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28341\n\n",
    "closed_at": "2019-08-13T22:39:20Z",
    "created_at": "2019-08-11T01:02:32Z",
    "labels": [
        "component: distribution",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Allow doc to build with SAGE_PARI_CFG undefined",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28341",
    "user": "https://github.com/kiwifb"
}
```
Follow up to #28242 which introduced `SAGE_PARI_CFG` in documentation build to identity whether or not pari is external.

This is inconvenient to distros and the behavior for external `pari` should be assumed if `SAGE_PARI_CFG` is undefined.

CC:  @dimpase @timokau

Branch/Commit: 27f17ffa52d68349ea978cea1f2acc5c55e52c19

Reviewer: Dima Pasechnik

Author: François Bissey

Dependencies: #28242

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28341





---

archive/issue_comments_549774.json:
```json
{
    "body": "<a id='comment:1'></a>\nWill replace `os.environ['SAGE_PARI_CFG']` by `os.environ.get('SAGE_PARI_CFG')` in `sage_setuo/docbuild/__init__.py`.",
    "created_at": "2019-08-11T01:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549774",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
Will replace `os.environ['SAGE_PARI_CFG']` by `os.environ.get('SAGE_PARI_CFG')` in `sage_setuo/docbuild/__init__.py`.



---

archive/issue_comments_549775.json:
```json
{
    "body": "<a id='comment:3'></a>\n`@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?",
    "created_at": "2019-08-11T22:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549775",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
`@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?



---

archive/issue_comments_549776.json:
```json
{
    "body": "<a id='comment:5'></a>\nusing SAGE_PARI_CFG in docbuild is a hack.\nOne should really test whether the external pari is multithreaded, this is something that can be done, I just didn't do. \n\nSAGE_PARI_CFG is storing the location of pari.cfg, something hard to find out, and needed to install gp2c, see https://git.sagemath.org/sage.git/diff/build/pkgs/gp2c/spkg-configure.m4?id=46772dbb31f2be940bda299136455f495c6a21dc",
    "created_at": "2019-08-11T22:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549776",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
using SAGE_PARI_CFG in docbuild is a hack.
One should really test whether the external pari is multithreaded, this is something that can be done, I just didn't do. 

SAGE_PARI_CFG is storing the location of pari.cfg, something hard to find out, and needed to install gp2c, see https://git.sagemath.org/sage.git/diff/build/pkgs/gp2c/spkg-configure.m4?id=46772dbb31f2be940bda299136455f495c6a21dc



---

archive/issue_comments_549777.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [dimpase](#comment%3A5):\n> using SAGE_PARI_CFG in docbuild is a hack.\n> One should really test whether the external pari is multithreaded, this is something that can be done, I just didn't do. \n> \n> SAGE_PARI_CFG is storing the location of pari.cfg, something hard to find out, and needed to install gp2c, see https://git.sagemath.org/sage.git/diff/build/pkgs/gp2c/spkg-configure.m4?id=46772dbb31f2be940bda299136455f495c6a21dc\n\n\nYes, I figured that out. On the other hand `sage_setup/docbuild/__init__.py` may not be the right place to check. So at the moment I just want to make sure that on distro where you don't run `configure` you get the same result as what you would expect if sage doesn't build `pari` but finds it on the system.",
    "created_at": "2019-08-11T22:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549777",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Replying to [dimpase](#comment%3A5):
> using SAGE_PARI_CFG in docbuild is a hack.
> One should really test whether the external pari is multithreaded, this is something that can be done, I just didn't do. 
> 
> SAGE_PARI_CFG is storing the location of pari.cfg, something hard to find out, and needed to install gp2c, see https://git.sagemath.org/sage.git/diff/build/pkgs/gp2c/spkg-configure.m4?id=46772dbb31f2be940bda299136455f495c6a21dc


Yes, I figured that out. On the other hand `sage_setup/docbuild/__init__.py` may not be the right place to check. So at the moment I just want to make sure that on distro where you don't run `configure` you get the same result as what you would expect if sage doesn't build `pari` but finds it on the system.



---

archive/issue_comments_549778.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [fbissey](#comment%3A3):\n> `@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?\n\n\nThis is the value I *set*. But you can just unconditionally switch to the appropriate docbuilder in Gentoo.",
    "created_at": "2019-08-11T22:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549778",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
Replying to [fbissey](#comment%3A3):
> `@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?


This is the value I *set*. But you can just unconditionally switch to the appropriate docbuilder in Gentoo.



---

archive/issue_comments_549779.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [dimpase](#comment%3A7):\n> Replying to [fbissey](#comment%3A3):\n> > `@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?\n\n> \n> This is the value I *set*. But you can just unconditionally switch to the appropriate docbuilder in Gentoo.\n\n\nI remarked on that in #28242. This is about having something working out of the box without extra patching or settings. Just using `os.environ.get()` already does enable me to build the doc without `SAGE_PARI_CFG` being set, which is a progress. I am testing the alternative builder now. Not that I can currently build the doc on Volker's branch because there is a label missing in the doc for manifolds from one of the tickets he is trying to merge.",
    "created_at": "2019-08-11T23:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549779",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Replying to [dimpase](#comment%3A7):
> Replying to [fbissey](#comment%3A3):
> > `@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?

> 
> This is the value I *set*. But you can just unconditionally switch to the appropriate docbuilder in Gentoo.


I remarked on that in #28242. This is about having something working out of the box without extra patching or settings. Just using `os.environ.get()` already does enable me to build the doc without `SAGE_PARI_CFG` being set, which is a progress. I am testing the alternative builder now. Not that I can currently build the doc on Volker's branch because there is a label missing in the doc for manifolds from one of the tickets he is trying to merge.



---

archive/issue_comments_549780.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-12T00:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549780",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_549781.json:
```json
{
    "body": "<a id='comment:9'></a>\nLast 10 new commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[b622942](https://git.sagemath.org/sage.git/commit?id=b622942d9e72ecbf5c863b46a1bac0d60c163c28)|`spkg-configure for pari_elldata`|\n|[2e11aed](https://git.sagemath.org/sage.git/commit?id=2e11aed9dfd4572b0185c727509fb31b765a95d2)|`spkg-configure's for PARI packages`|\n|[183f47c](https://git.sagemath.org/sage.git/commit?id=183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5)|`check for PARI packages in PARI's spkg-configure`|\n|[72f3c20](https://git.sagemath.org/sage.git/commit?id=72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee)|`spkg-configure for gp2c`|\n|[6eac550](https://git.sagemath.org/sage.git/commit?id=6eac55053f1e633c4d1638d23070467735149055)|`as pari might become dummy, test with GAP`|\n|[ac207d5](https://git.sagemath.org/sage.git/commit?id=ac207d5eed575e96f43ab44475d4a4625639a7a7)|`don't export GP_DATA_DIR, remove other, unneeded GP* vars`|\n|[317f090](https://git.sagemath.org/sage.git/commit?id=317f0909d0d7ffbd17f32edf99f5b47eae3d6c49)|`proper dependency resolution (all tests in PARI spkg-config)`|\n|[2c26115](https://git.sagemath.org/sage.git/commit?id=2c26115cd1752a3728793966785a451b2334a865)|`docbuild workaround for external PARI`|\n|[dd2b3fa](https://git.sagemath.org/sage.git/commit?id=dd2b3faae58e7bad2c3109829b7468eb9902cbf5)|`redirect gp errors to config.log`|\n|[27f17ff](https://git.sagemath.org/sage.git/commit?id=27f17ffa52d68349ea978cea1f2acc5c55e52c19)|`Add appropriate fallback if SAGE_PARI_CFG is missing`|",
    "created_at": "2019-08-12T00:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549781",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Last 10 new commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[b622942](https://git.sagemath.org/sage.git/commit?id=b622942d9e72ecbf5c863b46a1bac0d60c163c28)|`spkg-configure for pari_elldata`|
|[2e11aed](https://git.sagemath.org/sage.git/commit?id=2e11aed9dfd4572b0185c727509fb31b765a95d2)|`spkg-configure's for PARI packages`|
|[183f47c](https://git.sagemath.org/sage.git/commit?id=183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5)|`check for PARI packages in PARI's spkg-configure`|
|[72f3c20](https://git.sagemath.org/sage.git/commit?id=72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee)|`spkg-configure for gp2c`|
|[6eac550](https://git.sagemath.org/sage.git/commit?id=6eac55053f1e633c4d1638d23070467735149055)|`as pari might become dummy, test with GAP`|
|[ac207d5](https://git.sagemath.org/sage.git/commit?id=ac207d5eed575e96f43ab44475d4a4625639a7a7)|`don't export GP_DATA_DIR, remove other, unneeded GP* vars`|
|[317f090](https://git.sagemath.org/sage.git/commit?id=317f0909d0d7ffbd17f32edf99f5b47eae3d6c49)|`proper dependency resolution (all tests in PARI spkg-config)`|
|[2c26115](https://git.sagemath.org/sage.git/commit?id=2c26115cd1752a3728793966785a451b2334a865)|`docbuild workaround for external PARI`|
|[dd2b3fa](https://git.sagemath.org/sage.git/commit?id=dd2b3faae58e7bad2c3109829b7468eb9902cbf5)|`redirect gp errors to config.log`|
|[27f17ff](https://git.sagemath.org/sage.git/commit?id=27f17ffa52d68349ea978cea1f2acc5c55e52c19)|`Add appropriate fallback if SAGE_PARI_CFG is missing`|



---

archive/issue_comments_549782.json:
```json
{
    "body": "Changing commit from \"\" to \"27f17ffa52d68349ea978cea1f2acc5c55e52c19\"",
    "created_at": "2019-08-12T00:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549782",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "" to "27f17ffa52d68349ea978cea1f2acc5c55e52c19"



---

archive/issue_comments_549783.json:
```json
{
    "body": "Changing author from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2019-08-12T00:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549783",
    "user": "https://github.com/kiwifb"
}
```

Changing author from "" to "François Bissey"



---

archive/issue_comments_549784.json:
```json
{
    "body": "Changing dependencies from \"\" to \"28242\"",
    "created_at": "2019-08-12T00:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549784",
    "user": "https://github.com/kiwifb"
}
```

Changing dependencies from "" to "28242"



---

archive/issue_comments_549785.json:
```json
{
    "body": "Changing branch from \"\" to \"u/fbissey/pari_cfg_doc\"",
    "created_at": "2019-08-12T00:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549785",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "" to "u/fbissey/pari_cfg_doc"



---

archive/issue_comments_549786.json:
```json
{
    "body": "Changing dependencies from \"28242\" to \"#28242\"",
    "created_at": "2019-08-12T05:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549786",
    "user": "https://github.com/dimpase"
}
```

Changing dependencies from "28242" to "#28242"



---

archive/issue_comments_549787.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2019-08-12T05:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549787",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_549788.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-12T05:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549788",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_549789.json:
```json
{
    "body": "<a id='comment:11'></a>\nlgtm",
    "created_at": "2019-08-12T05:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549789",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
lgtm



---

archive/issue_events_070781.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-13T22:39:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28341#event-70781"
}
```



---

archive/issue_comments_549790.json:
```json
{
    "body": "Changing branch from \"u/fbissey/pari_cfg_doc\" to \"27f17ffa52d68349ea978cea1f2acc5c55e52c19\"",
    "created_at": "2019-08-13T22:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549790",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/fbissey/pari_cfg_doc" to "27f17ffa52d68349ea978cea1f2acc5c55e52c19"



---

archive/issue_comments_549791.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-13T22:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28341#issuecomment-549791",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
