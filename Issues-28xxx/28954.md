# Issue 28954: polynomial degree is broken for weighted block orders

archive/issues_028717.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: T = TermOrder('wdegrevlex', (1,2,3,4))\nsage: R = PolynomialRing(QQ, 'x', 12, order=T+T+T)\nsage: [x.degree() for x in R.gens()]    # wrong\n[1, 2, 3, 4, 1, 1, 1, 1, 1, 1, 1, 1]\n\nsage: from sage.libs.singular.function_factory import ff\nsage: [ff.deg(x, ring=R) for x in R.gens()]    # correct\n[1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]\n```\n\n\nCC:  @kwankyu jpflori\n\nKeywords: **singular**\n\nBranch/Commit: **[0100ac0](https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d)**\n\nReviewer: **Markus Wageringel**\n\nAuthor: **Kwankyu Lee**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28954_\n\n",
    "closed_at": "2020-01-20T21:18:30Z",
    "created_at": "2020-01-05T18:38:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "polynomial degree is broken for weighted block orders",
    "type": "issue",
    "updated_at": "2020-01-20T21:18:30Z",
    "url": "https://github.com/sagemath/sage/issues/28954",
    "user": "https://github.com/mwageringel"
}
```

```
sage: T = TermOrder('wdegrevlex', (1,2,3,4))
sage: R = PolynomialRing(QQ, 'x', 12, order=T+T+T)
sage: [x.degree() for x in R.gens()]    # wrong
[1, 2, 3, 4, 1, 1, 1, 1, 1, 1, 1, 1]

sage: from sage.libs.singular.function_factory import ff
sage: [ff.deg(x, ring=R) for x in R.gens()]    # correct
[1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]
```


CC:  @kwankyu jpflori

Keywords: **singular**

Branch/Commit: **[0100ac0](https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d)**

Reviewer: **Markus Wageringel**

Author: **Kwankyu Lee**

_Issue created by migration from https://trac.sagemath.org/ticket/28954_





---

archive/issue_events_379580.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-01-05T18:38:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379580"
}
```



---

archive/issue_events_379581.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-01-05T18:38:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379581"
}
```



---

archive/issue_events_379582.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-01-05T18:38:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379582"
}
```



---

archive/issue_events_379583.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-01-05T18:38:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379583"
}
```



---

archive/issue_comments_455133.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nA related changed is \n\n[#21631 comment:23](https://github.com/sagemath/sage/issues/21631#comment:23)\n\nAt least I checked reverting to `p_WTotaldegree` solves the present problem. But there must have been some reason to have used `p_WDegree`.",
    "created_at": "2020-01-06T04:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455133",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:1'>Comment 1:</a>
A related changed is 

[#21631 comment:23](https://github.com/sagemath/sage/issues/21631#comment:23)

At least I checked reverting to `p_WTotaldegree` solves the present problem. But there must have been some reason to have used `p_WDegree`.



---

archive/issue_comments_455134.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThe reason for that change seems to be to fix the example in [[#17254 comment:199](https://github.com/sagemath/sage/issues/17254#comment:199)] where a matrix ordering is used. Interestingly though, with current versions of Singular, the degree with a matrix ordering is not based on the first row of the matrix anymore:\n\n```\nsage: R.<x,y,z> = PolynomialRing(QQ, 3, order=TermOrder(matrix([3,0,1,1,1,0,1,0,0])))\nsage: [a.degree() for a in R.gens()]\n[3, 0, 1]\nsage: [a._singular_().deg() for a in R.gens()]\n[3, 0, 1]   # singular 3.1.7p1\n[1, 1, 1]   # singular 4.1.1p2\n```\n\nTherefore, I think the degree function in Sage should be changed to return results consistent with Singular in case of matrix orderings. Based on [this document](https://github.com/Singular/Sources/blob/ed085278a0d1c84d197cb3b6dea54a2e5cbabdc0/libpolys/polys/monomials/degree.txt), I replaced `p_WDegree` by `p_FDeg`, which fixes both examples here \u2013 though I am not completely certain this is the correct function to call.\n\nI guess such a behavior change would need a deprecation period. How would one implement this in practice?",
    "created_at": "2020-01-06T18:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455134",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'>Comment 3:</a>
The reason for that change seems to be to fix the example in [[#17254 comment:199](https://github.com/sagemath/sage/issues/17254#comment:199)] where a matrix ordering is used. Interestingly though, with current versions of Singular, the degree with a matrix ordering is not based on the first row of the matrix anymore:

```
sage: R.<x,y,z> = PolynomialRing(QQ, 3, order=TermOrder(matrix([3,0,1,1,1,0,1,0,0])))
sage: [a.degree() for a in R.gens()]
[3, 0, 1]
sage: [a._singular_().deg() for a in R.gens()]
[3, 0, 1]   # singular 3.1.7p1
[1, 1, 1]   # singular 4.1.1p2
```

Therefore, I think the degree function in Sage should be changed to return results consistent with Singular in case of matrix orderings. Based on [this document](https://github.com/Singular/Sources/blob/ed085278a0d1c84d197cb3b6dea54a2e5cbabdc0/libpolys/polys/monomials/degree.txt), I replaced `p_WDegree` by `p_FDeg`, which fixes both examples here – though I am not completely certain this is the correct function to call.

I guess such a behavior change would need a deprecation period. How would one implement this in practice?



---

archive/issue_comments_455135.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nSingular's deg function calls `p_LDeg` [(source)](https://github.com/Singular/Sources/blob/Release-4-1-2/Singular/iparith.cc#L3866), so we should use that instead. This eliminates the need to explicitly loop over the monomials.",
    "created_at": "2020-01-06T19:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455135",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:4'>Comment 4:</a>
Singular's deg function calls `p_LDeg` [(source)](https://github.com/Singular/Sources/blob/Release-4-1-2/Singular/iparith.cc#L3866), so we should use that instead. This eliminates the need to explicitly loop over the monomials.



---

archive/issue_comments_455136.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI am quite certain that the best thing to do is to patch `polynomial.pyx` such that\n\n```\ncdef long singular_polynomial_deg(poly *p, poly *x, ring *r):\n    ...\n    if x == NULL:\n        return p_WTotaldegree(p,r)\n\n    cdef int i = 0\n    ...\n```\nNote that the \"loop\" thing is not necessary. So this will speed up things.\n\nBut then we get \n\n```\nsage: R.<x,y,z> = PolynomialRing(QQ, 3, order=TermOrder(matrix([3,0,1,1,1,0,1,0,0])))\nsage: [a.degree() for a in R.gens()]\n[-3, 0, -1]\nsage: [a._singular_().deg() for a in R.gens()]\n[1, 1, 1]\n```\nI don't care the Singular degrees. They are  `p_Totaldegree` (via `p_FDeg` via `p_LDeg`), as expected since Singular' deg function calls `p_LDeg`.\n\nBut the negative values above look strange. They are negative because the value `OrdSgn` is -1 for the ring. It means that the monomial ordering of R is not well-ordering. This is wrong! It is well-ordering since the first nonzero values of each column of the matrix is positive. So `OrdSgn` should be 1. I suspect that there is a bug somewhere in Sage or possibly in Singular. But I could not look deep into the Singular code to find the bug...",
    "created_at": "2020-01-07T08:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455136",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:5'>Comment 5:</a>
I am quite certain that the best thing to do is to patch `polynomial.pyx` such that

```
cdef long singular_polynomial_deg(poly *p, poly *x, ring *r):
    ...
    if x == NULL:
        return p_WTotaldegree(p,r)

    cdef int i = 0
    ...
```
Note that the "loop" thing is not necessary. So this will speed up things.

But then we get 

```
sage: R.<x,y,z> = PolynomialRing(QQ, 3, order=TermOrder(matrix([3,0,1,1,1,0,1,0,0])))
sage: [a.degree() for a in R.gens()]
[-3, 0, -1]
sage: [a._singular_().deg() for a in R.gens()]
[1, 1, 1]
```
I don't care the Singular degrees. They are  `p_Totaldegree` (via `p_FDeg` via `p_LDeg`), as expected since Singular' deg function calls `p_LDeg`.

But the negative values above look strange. They are negative because the value `OrdSgn` is -1 for the ring. It means that the monomial ordering of R is not well-ordering. This is wrong! It is well-ordering since the first nonzero values of each column of the matrix is positive. So `OrdSgn` should be 1. I suspect that there is a bug somewhere in Sage or possibly in Singular. But I could not look deep into the Singular code to find the bug...



---

archive/issue_comments_455137.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\n> Note that the \"loop\" thing is not necessary. So this will speed up things.\n\nThis is wrong. I forgot that the monomial ordering might be incompatible with degrees. Anyway, this part needs to be optimized as this would affect the overall performance of polynomial arithmetic of Sage...",
    "created_at": "2020-01-07T11:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455137",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:6'>Comment 6:</a>
> Note that the "loop" thing is not necessary. So this will speed up things.

This is wrong. I forgot that the monomial ordering might be incompatible with degrees. Anyway, this part needs to be optimized as this would affect the overall performance of polynomial arithmetic of Sage...



---

archive/issue_comments_455138.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThe bug in Singular about the wrong `OrdSgn` value was reported in \n\nhttps://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2899",
    "created_at": "2020-01-08T02:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455138",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'>Comment 7:</a>
The bug in Singular about the wrong `OrdSgn` value was reported in 

https://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2899



---

archive/issue_comments_455139.json:
```json
{
    "body": "Author: **Kwankyu Lee**",
    "created_at": "2020-01-13T04:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455139",
    "user": "https://github.com/kwankyu"
}
```

Author: **Kwankyu Lee**



---

archive/issue_comments_455140.json:
```json
{
    "body": "Branch: **[u/klee/28954](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/28954)**",
    "created_at": "2020-01-13T04:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455140",
    "user": "https://github.com/kwankyu"
}
```

Branch: **[u/klee/28954](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/28954)**



---

archive/issue_comments_455141.json:
```json
{
    "body": "Commit: **[b8f53f7](https://github.com/sagemath/sagetrac-mirror/commit/b8f53f72e817e78722ad1b40d70aa9071426700b)**",
    "created_at": "2020-01-13T04:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455141",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[b8f53f7](https://github.com/sagemath/sagetrac-mirror/commit/b8f53f72e817e78722ad1b40d70aa9071426700b)**



---

archive/issue_comments_455142.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-13T04:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455142",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455143.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ccd0d206c574b696481f161e364b46b67fd2ef9\">7ccd0d2</a></td><td><code>Use p_WTotalDegree for Sage degree</code></td></tr></table>\n",
    "created_at": "2020-01-13T04:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455143",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ccd0d206c574b696481f161e364b46b67fd2ef9">7ccd0d2</a></td><td><code>Use p_WTotalDegree for Sage degree</code></td></tr></table>




---

archive/issue_comments_455144.json:
```json
{
    "body": "Changed commit from **[b8f53f7](https://github.com/sagemath/sagetrac-mirror/commit/b8f53f72e817e78722ad1b40d70aa9071426700b)** to **[7ccd0d2](https://github.com/sagemath/sagetrac-mirror/commit/7ccd0d206c574b696481f161e364b46b67fd2ef9)**",
    "created_at": "2020-01-13T04:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455144",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b8f53f7](https://github.com/sagemath/sagetrac-mirror/commit/b8f53f72e817e78722ad1b40d70aa9071426700b)** to **[7ccd0d2](https://github.com/sagemath/sagetrac-mirror/commit/7ccd0d206c574b696481f161e364b46b67fd2ef9)**



---

archive/issue_comments_455145.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThe branch modulo the fix in Singular part fixes the bug of this ticket.\n\nI wish to remove the loop thing for the cases when the monomial ordering is compatible with the degrees, to speed up Sage polynomial arithmetic. But I don't know how to detect these cases, and this issue is for another ticket.\n\nPerhaps we need to delay this ticket until the fix in Singular is available in Sage...",
    "created_at": "2020-01-13T04:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455145",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:11'>Comment 11:</a>
The branch modulo the fix in Singular part fixes the bug of this ticket.

I wish to remove the loop thing for the cases when the monomial ordering is compatible with the degrees, to speed up Sage polynomial arithmetic. But I don't know how to detect these cases, and this issue is for another ticket.

Perhaps we need to delay this ticket until the fix in Singular is available in Sage...



---

archive/issue_comments_455146.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\n@mwageringel:\n\nI don't object to using `p_LDeg` if this is practically (that is, ignoring not-so-useful matrix orderings) consistent with the rest of Sage, as this has advantage in performance.",
    "created_at": "2020-01-13T04:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455146",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:12'>Comment 12:</a>
@mwageringel:

I don't object to using `p_LDeg` if this is practically (that is, ignoring not-so-useful matrix orderings) consistent with the rest of Sage, as this has advantage in performance.



---

archive/issue_comments_455147.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nShould we not add the upstream fix as a patch here? The regular upgrade of Singular might still take quite a while.\n\n\nReplying to [@kwankyu](#comment%3A12):\n> I don't object to using `p_LDeg` if this is practically (that is, ignoring not-so-useful matrix orderings) consistent with the rest of Sage, as this has advantage in performance.\n\n\nThis would be a practical thing to do, as it leaves it to Singular to provide an efficient implementation. Note that this only affects matrix orderings with zeros in the first row \u2013 if the entries in the first row are positive, these are returned as degrees as before.\n\n(A potential downside of this is that it forces Singular's notion of degree upon Sage, whereas, if one ignores the Singular backend, Sage could have its own notion. In Macaulay2 for example, the notions of degree and weight are independent. For now, this seems fine though, as much of polynomial arithmetics in Sage is dictated by the Singular backend anyway.)",
    "created_at": "2020-01-14T20:14:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455147",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:13'>Comment 13:</a>
Should we not add the upstream fix as a patch here? The regular upgrade of Singular might still take quite a while.


Replying to [@kwankyu](#comment%3A12):
> I don't object to using `p_LDeg` if this is practically (that is, ignoring not-so-useful matrix orderings) consistent with the rest of Sage, as this has advantage in performance.


This would be a practical thing to do, as it leaves it to Singular to provide an efficient implementation. Note that this only affects matrix orderings with zeros in the first row – if the entries in the first row are positive, these are returned as degrees as before.

(A potential downside of this is that it forces Singular's notion of degree upon Sage, whereas, if one ignores the Singular backend, Sage could have its own notion. In Macaulay2 for example, the notions of degree and weight are independent. For now, this seems fine though, as much of polynomial arithmetics in Sage is dictated by the Singular backend anyway.)



---

archive/issue_comments_455148.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@mwageringel](#comment%3A13):\n> Should we not add the upstream fix as a patch here? The regular upgrade of Singular might still take quite a while.\n\nIf we do not wait the regular upgrade of Singular, the upstream fix should go to the Singular package of Sage, as a patch (and be removed when the regular upgrade arrives). I guess this is not a good thing to do.\n\n> > I don't object to using `p_LDeg` if this is practically (that is, ignoring not-so-useful matrix orderings) consistent with the rest of Sage, as this has advantage in performance.\n\n> \n> This would be a practical thing to do, as it leaves it to Singular to provide an efficient implementation. Note that this only affects matrix orderings with zeros in the first row \u2013 if the entries in the first row are positive, these are returned as degrees as before.\n\nAfter looking into the implementation of `p_LDeg` in Singular and some experiments, it seems that `p_LDeg` is not that faster than the loop thing with `p_WTotaldegree` as I expected initially. \n\nThen I don't see any advantage of using `p_LDeg` while introducing a backward incompatible change in regard to matrix orderings.\n\nI would prefer the present branch and bear with the bug until Singular gets the regular upgrade.",
    "created_at": "2020-01-15T10:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455148",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@mwageringel](#comment%3A13):
> Should we not add the upstream fix as a patch here? The regular upgrade of Singular might still take quite a while.

If we do not wait the regular upgrade of Singular, the upstream fix should go to the Singular package of Sage, as a patch (and be removed when the regular upgrade arrives). I guess this is not a good thing to do.

> > I don't object to using `p_LDeg` if this is practically (that is, ignoring not-so-useful matrix orderings) consistent with the rest of Sage, as this has advantage in performance.

> 
> This would be a practical thing to do, as it leaves it to Singular to provide an efficient implementation. Note that this only affects matrix orderings with zeros in the first row – if the entries in the first row are positive, these are returned as degrees as before.

After looking into the implementation of `p_LDeg` in Singular and some experiments, it seems that `p_LDeg` is not that faster than the loop thing with `p_WTotaldegree` as I expected initially. 

Then I don't see any advantage of using `p_LDeg` while introducing a backward incompatible change in regard to matrix orderings.

I would prefer the present branch and bear with the bug until Singular gets the regular upgrade.



---

archive/issue_comments_455149.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n> After looking into the implementation of `p_LDeg` in Singular and some experiments, it seems that `p_LDeg` is not that faster than the loop thing with `p_WTotaldegree` as I expected initially. \n\nThis is wrong. I did more experiments. \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('degrevlex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.18 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('degrevlex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.47 ms per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('lex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.25 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('lex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n625 loops, best of 3: 777 \u03bcs per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('wdeglex',(1,2,3,4)))\nsage: [a.degree() for a in R.gens()]\n[1, 2, 3, 4]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n500\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.88 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('wdeglex',(1,2,3,4)))\nsage: [a.degree() for a in R.gens()]\n[1, 2, 3, 4]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n500\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.54 ms per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('deglex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.81 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('deglex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.75 ms per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: m = matrix(4,[4,3,2,1,1,0,0,0,0,1,0,0,0,0,1,0])\nsage: m\n[4 3 2 1]\n[1 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))\nsage: [a.degree() for a in R.gens()]\n[4, 3, 2, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n500\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.84 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: m = matrix(4,[4,3,2,1,1,0,0,0,0,1,0,0,0,0,1,0])\nsage: m\n[4 3 2 1]\n[1 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))\nsage: [a.degree() for a in R.gens()]\n[4, 3, 2, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n500\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.84 ms per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: m = matrix(2,[3,2,1,0])\nsage: m\n[3 2]\n[1 0]\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m)+TermOrder(m))\nsage: [a.degree() for a in R.gens()]\n[3, 2, 3, 2]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n500\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.17 ms per loop\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.18 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: m = matrix(2,[3,2,1,0])\nsage: m\n[3 2]\n[1 0]\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m)+TermOrder(m))\nsage: [a.degree() for a in R.gens()]\n[3, 2, 3, 2]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n500\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.26 ms per loop\nsage: timeit('f.degree()')\n125 loops, best of 3: 3.28 ms per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('neglex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.18 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('neglex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n625 loops, best of 3: 750 \u03bcs per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: m = matrix(4,[4,0,2,1,1,0,0,0,0,1,0,0,0,0,1,0])\nsage: m\n[4 0 2 1]\n[1 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))\nsage: [a.degree() for a in R.gens()]\n[4, 0, 2, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n400\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.82 ms per loop\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.78 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: m = matrix(4,[4,0,2,1,1,0,0,0,0,1,0,0,0,0,1,0])\nsage: m\n[4 0 2 1]\n[1 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n625 loops, best of 3: 1.33 ms per loop\nsage: timeit('f.degree()')\n625 loops, best of 3: 1.37 ms per loop\n```\nwith `p_LDeg`\n\n---\n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('invlex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n125 loops, best of 3: 2.21 ms per loop\n```\nwith `p_WTotaldegree` vs \n\n```\nsage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('invlex'))\nsage: [a.degree() for a in R.gens()]\n[1, 1, 1, 1]\nsage: f = (x - y*z - 2*z + w)^100\nsage: f.degree()\n200\nsage: timeit('f.degree()')\n625 loops, best of 3: 766 \u03bcs per loop\n```\nwith `p_LDeg`",
    "created_at": "2020-01-15T15:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455149",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:15'>Comment 15:</a>
> After looking into the implementation of `p_LDeg` in Singular and some experiments, it seems that `p_LDeg` is not that faster than the loop thing with `p_WTotaldegree` as I expected initially. 

This is wrong. I did more experiments. 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('degrevlex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 3.18 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('degrevlex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 2.47 ms per loop
```
with `p_LDeg`

---

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('lex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 2.25 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('lex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
625 loops, best of 3: 777 μs per loop
```
with `p_LDeg`

---

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('wdeglex',(1,2,3,4)))
sage: [a.degree() for a in R.gens()]
[1, 2, 3, 4]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
500
sage: timeit('f.degree()')
125 loops, best of 3: 3.88 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('wdeglex',(1,2,3,4)))
sage: [a.degree() for a in R.gens()]
[1, 2, 3, 4]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
500
sage: timeit('f.degree()')
125 loops, best of 3: 2.54 ms per loop
```
with `p_LDeg`

---

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('deglex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 3.81 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('deglex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 2.75 ms per loop
```
with `p_LDeg`

---

```
sage: m = matrix(4,[4,3,2,1,1,0,0,0,0,1,0,0,0,0,1,0])
sage: m
[4 3 2 1]
[1 0 0 0]
[0 1 0 0]
[0 0 1 0]
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))
sage: [a.degree() for a in R.gens()]
[4, 3, 2, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
500
sage: timeit('f.degree()')
125 loops, best of 3: 2.84 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: m = matrix(4,[4,3,2,1,1,0,0,0,0,1,0,0,0,0,1,0])
sage: m
[4 3 2 1]
[1 0 0 0]
[0 1 0 0]
[0 0 1 0]
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))
sage: [a.degree() for a in R.gens()]
[4, 3, 2, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
500
sage: timeit('f.degree()')
125 loops, best of 3: 2.84 ms per loop
```
with `p_LDeg`

---

```
sage: m = matrix(2,[3,2,1,0])
sage: m
[3 2]
[1 0]
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m)+TermOrder(m))
sage: [a.degree() for a in R.gens()]
[3, 2, 3, 2]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
500
sage: timeit('f.degree()')
125 loops, best of 3: 3.17 ms per loop
sage: timeit('f.degree()')
125 loops, best of 3: 3.18 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: m = matrix(2,[3,2,1,0])
sage: m
[3 2]
[1 0]
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m)+TermOrder(m))
sage: [a.degree() for a in R.gens()]
[3, 2, 3, 2]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
500
sage: timeit('f.degree()')
125 loops, best of 3: 3.26 ms per loop
sage: timeit('f.degree()')
125 loops, best of 3: 3.28 ms per loop
```
with `p_LDeg`

---

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('neglex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 2.18 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('neglex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
625 loops, best of 3: 750 μs per loop
```
with `p_LDeg`

---

```
sage: m = matrix(4,[4,0,2,1,1,0,0,0,0,1,0,0,0,0,1,0])
sage: m
[4 0 2 1]
[1 0 0 0]
[0 1 0 0]
[0 0 1 0]
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))
sage: [a.degree() for a in R.gens()]
[4, 0, 2, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
400
sage: timeit('f.degree()')
125 loops, best of 3: 2.82 ms per loop
sage: timeit('f.degree()')
125 loops, best of 3: 2.78 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: m = matrix(4,[4,0,2,1,1,0,0,0,0,1,0,0,0,0,1,0])
sage: m
[4 0 2 1]
[1 0 0 0]
[0 1 0 0]
[0 0 1 0]
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder(m))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
625 loops, best of 3: 1.33 ms per loop
sage: timeit('f.degree()')
625 loops, best of 3: 1.37 ms per loop
```
with `p_LDeg`

---

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('invlex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
125 loops, best of 3: 2.21 ms per loop
```
with `p_WTotaldegree` vs 

```
sage: R.<x,y,z,w>=PolynomialRing(QQ,order=TermOrder('invlex'))
sage: [a.degree() for a in R.gens()]
[1, 1, 1, 1]
sage: f = (x - y*z - 2*z + w)^100
sage: f.degree()
200
sage: timeit('f.degree()')
625 loops, best of 3: 766 μs per loop
```
with `p_LDeg`



---

archive/issue_comments_455150.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\n> I would prefer the present branch and bear with the bug until Singular gets the regular upgrade. \n\nNow I prefer using `p_LDeg'!",
    "created_at": "2020-01-15T15:13:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455150",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:16'>Comment 16:</a>
> I would prefer the present branch and bear with the bug until Singular gets the regular upgrade. 

Now I prefer using `p_LDeg'!



---

archive/issue_comments_455151.json:
```json
{
    "body": "Changed commit from **[7ccd0d2](https://github.com/sagemath/sagetrac-mirror/commit/7ccd0d206c574b696481f161e364b46b67fd2ef9)** to **[896d628](https://github.com/sagemath/sagetrac-mirror/commit/896d628d5e3de70e01afac79f484c2fc22687b0e)**",
    "created_at": "2020-01-16T02:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455151",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7ccd0d2](https://github.com/sagemath/sagetrac-mirror/commit/7ccd0d206c574b696481f161e364b46b67fd2ef9)** to **[896d628](https://github.com/sagemath/sagetrac-mirror/commit/896d628d5e3de70e01afac79f484c2fc22687b0e)**



---

archive/issue_comments_455152.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/896d628d5e3de70e01afac79f484c2fc22687b0e\">896d628</a></td><td><code>Use p_LDeg for degree</code></td></tr></table>\n",
    "created_at": "2020-01-16T02:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455152",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/896d628d5e3de70e01afac79f484c2fc22687b0e">896d628</a></td><td><code>Use p_LDeg for degree</code></td></tr></table>




---

archive/issue_events_379584.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2020-01-16T03:05:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379584"
}
```



---

archive/issue_comments_455153.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06c2c54e251d6dc69dbb01f36c18990881e8c808\">06c2c54</a></td><td><code>Doctest fixes</code></td></tr></table>\n",
    "created_at": "2020-01-16T03:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455153",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06c2c54e251d6dc69dbb01f36c18990881e8c808">06c2c54</a></td><td><code>Doctest fixes</code></td></tr></table>




---

archive/issue_comments_455154.json:
```json
{
    "body": "Changed commit from **[896d628](https://github.com/sagemath/sagetrac-mirror/commit/896d628d5e3de70e01afac79f484c2fc22687b0e)** to **[06c2c54](https://github.com/sagemath/sagetrac-mirror/commit/06c2c54e251d6dc69dbb01f36c18990881e8c808)**",
    "created_at": "2020-01-16T03:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455154",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[896d628](https://github.com/sagemath/sagetrac-mirror/commit/896d628d5e3de70e01afac79f484c2fc22687b0e)** to **[06c2c54](https://github.com/sagemath/sagetrac-mirror/commit/06c2c54e251d6dc69dbb01f36c18990881e8c808)**



---

archive/issue_comments_455155.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@kwankyu](#comment%3A14):\n> If we do not wait the regular upgrade of Singular, the upstream fix should go to the Singular package of Sage, as a patch (and be removed when the regular upgrade arrives). I guess this is not a good thing to do.\n\nOk, if we use `p_LDeg`, we do not actually need the upstream fix.\n\nCould you add a doctest for the example in the ticket description, please? Also, I think we should keep one example of a matrix ordering with zeros in the first row, in order to document the fact that standard grading is now used in that case.\n\nFinally, the imports `p_Deg, p_Totaldegree, p_WTotaldegree, p_WDegree` are not used anymore and could be removed.\n\nOtherwise, this looks good to me. Thanks a lot for the comparisons and the fix.",
    "created_at": "2020-01-16T21:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455155",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@kwankyu](#comment%3A14):
> If we do not wait the regular upgrade of Singular, the upstream fix should go to the Singular package of Sage, as a patch (and be removed when the regular upgrade arrives). I guess this is not a good thing to do.

Ok, if we use `p_LDeg`, we do not actually need the upstream fix.

Could you add a doctest for the example in the ticket description, please? Also, I think we should keep one example of a matrix ordering with zeros in the first row, in order to document the fact that standard grading is now used in that case.

Finally, the imports `p_Deg, p_Totaldegree, p_WTotaldegree, p_WDegree` are not used anymore and could be removed.

Otherwise, this looks good to me. Thanks a lot for the comparisons and the fix.



---

archive/issue_comments_455156.json:
```json
{
    "body": "Reviewer: **Markus Wageringel**",
    "created_at": "2020-01-16T21:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455156",
    "user": "https://github.com/mwageringel"
}
```

Reviewer: **Markus Wageringel**



---

archive/issue_comments_455157.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d\">0100ac0</a></td><td><code>Fixes for reviewer comments</code></td></tr></table>\n",
    "created_at": "2020-01-17T02:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455157",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d">0100ac0</a></td><td><code>Fixes for reviewer comments</code></td></tr></table>




---

archive/issue_comments_455158.json:
```json
{
    "body": "Changed commit from **[06c2c54](https://github.com/sagemath/sagetrac-mirror/commit/06c2c54e251d6dc69dbb01f36c18990881e8c808)** to **[0100ac0](https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d)**",
    "created_at": "2020-01-17T02:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455158",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[06c2c54](https://github.com/sagemath/sagetrac-mirror/commit/06c2c54e251d6dc69dbb01f36c18990881e8c808)** to **[0100ac0](https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d)**



---

archive/issue_comments_455159.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@mwageringel](#comment%3A20):\n> Replying to [@kwankyu](#comment%3A14):\n> > If we do not wait the regular upgrade of Singular, the upstream fix should go to the Singular package of Sage, as a patch (and be removed when the regular upgrade arrives). I guess this is not a good thing to do.\n\n> \n> Ok, if we use `p_LDeg`, we do not actually need the upstream fix.\n\nRight.\n \n> Could you add a doctest for the example in the ticket description, please? Also, I think we should keep one example of a matrix ordering with zeros in the first row, in order to document the fact that standard grading is now used in that case.\n\nDone.\n\n> Finally, the imports `p_Deg, p_Totaldegree, p_WTotaldegree, p_WDegree` are not used anymore and could be removed.\n\nDone.",
    "created_at": "2020-01-17T02:54:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455159",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@mwageringel](#comment%3A20):
> Replying to [@kwankyu](#comment%3A14):
> > If we do not wait the regular upgrade of Singular, the upstream fix should go to the Singular package of Sage, as a patch (and be removed when the regular upgrade arrives). I guess this is not a good thing to do.

> 
> Ok, if we use `p_LDeg`, we do not actually need the upstream fix.

Right.
 
> Could you add a doctest for the example in the ticket description, please? Also, I think we should keep one example of a matrix ordering with zeros in the first row, in order to document the fact that standard grading is now used in that case.

Done.

> Finally, the imports `p_Deg, p_Totaldegree, p_WTotaldegree, p_WDegree` are not used anymore and could be removed.

Done.



---

archive/issue_comments_455160.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nThank you.",
    "created_at": "2020-01-17T08:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455160",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:23'>Comment 23:</a>
Thank you.



---

archive/issue_events_379585.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-01-17T08:21:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379585"
}
```



---

archive/issue_events_379586.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-01-17T08:21:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379586"
}
```



---

archive/issue_comments_455161.json:
```json
{
    "body": "Changed branch from **[u/klee/28954](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/28954)** to **[0100ac0](https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d)**",
    "created_at": "2020-01-20T21:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28954#issuecomment-455161",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/klee/28954](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/28954)** to **[0100ac0](https://github.com/sagemath/sagetrac-mirror/commit/0100ac05053ca466fadabc168577971d11e2e97d)**



---

archive/issue_events_379587.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-20T21:18:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379587"
}
```



---

archive/issue_events_379588.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f0b2140404744866ba0e985a52d0dbef8e31706c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-20T21:18:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28954",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28954#event-379588"
}
```
