# Issue 28414: p_group_cohomology does not build on Python3

archive/issues_028177.json:
```json
{
    "body": "The aim of this ticket is to provide a new version of the optional `p_group_cohomology` spkg so that it builds and passes tests both with python-2 and python-3.\n\nHopefully the version number 3.3 (two times three) is appropriate.\n\n[Package documentation](https://users.fmi.uni-jena.de/cohomology/documentation/)\n\n[Source ball](https://users.fmi.uni-jena.de/cohomology/p_group_cohomology-3.3.tar.xz)\n\n[p_group_cohomology at Travis CI](https://travis-ci.org/sagemath/p_group_cohomology)\n\n**CC:**  @simon-king-jena\n\n**Keywords:** py3\n\n**Branch:** [6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)\n\n**Reviewer:** John Palmieri\n\n**Author:** Simon King\n\n**Dependencies:** #28444\n\nIssue created by migration from https://trac.sagemath.org/ticket/28414\n\n",
    "closed_at": "2019-10-30T23:47:51Z",
    "created_at": "2019-08-27T20:46:29Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "p_group_cohomology does not build on Python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28414",
    "user": "https://github.com/dimpase"
}
```
The aim of this ticket is to provide a new version of the optional `p_group_cohomology` spkg so that it builds and passes tests both with python-2 and python-3.

Hopefully the version number 3.3 (two times three) is appropriate.

[Package documentation](https://users.fmi.uni-jena.de/cohomology/documentation/)

[Source ball](https://users.fmi.uni-jena.de/cohomology/p_group_cohomology-3.3.tar.xz)

[p_group_cohomology at Travis CI](https://travis-ci.org/sagemath/p_group_cohomology)

**CC:**  @simon-king-jena

**Keywords:** py3

**Branch:** [6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)

**Reviewer:** John Palmieri

**Author:** Simon King

**Dependencies:** #28444

Issue created by migration from https://trac.sagemath.org/ticket/28414





---

archive/issue_comments_446874.json:
```json
{
    "body": "<a id='comment:1'></a>\n`cmp` is also not supported in Python 3, and for a dictionary `d`, you should do `x in d` rather than `d.has_key(x)`.",
    "created_at": "2019-08-27T23:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446874",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
`cmp` is also not supported in Python 3, and for a dictionary `d`, you should do `x in d` rather than `d.has_key(x)`.



---

archive/issue_comments_446875.json:
```json
{
    "body": "<a id='comment:2'></a>\nSimon, I have made some progress in converting this to Python 3. Let me know and I can email you some diff files.",
    "created_at": "2019-08-27T23:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446875",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Simon, I have made some progress in converting this to Python 3. Let me know and I can email you some diff files.



---

archive/issue_comments_446876.json:
```json
{
    "body": "<a id='comment:3'></a>\nHi John, in fact Python-3-compatibility was one of the things that I considered for the next package version. So, if you already have a diff, I'd appreciate to see it!",
    "created_at": "2019-08-28T04:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446876",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
Hi John, in fact Python-3-compatibility was one of the things that I considered for the next package version. So, if you already have a diff, I'd appreciate to see it!



---

archive/issue_comments_446877.json:
```json
{
    "body": "<a id='comment:4'></a>\nI just sent email to your Jena address. I can get the package to build, but it doesn't work yet. An illustration of one problem:\n\n```\nsage: load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/src/bin/sage-ipython:1: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead\n  #!/usr/bin/env sage-python23\nWARNING: Files on disk have been moved or are not writeable.\n> Will try to recover later.\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/rich_output/display_manager.py:623: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead\n  has_rich_repr = isinstance(obj, SageObject) and hasattr(obj, '_rich_repr_')\n8gp3: Files on disk have been moved - trying to get things right\n---------------------------------------------------------------------------\nUnicodeDecodeError                        Traceback (most recent call last)\n<ipython-input-5-9bd7fbf5ad54> in <module>()\n----> 1 load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/IPython/core/displayhook.py in __call__(self, result)\n    244             self.start_displayhook()\n    245             self.write_output_prompt()\n--> 246             format_dict, md_dict = self.compute_format_data(result)\n    247             self.update_user_ns(result)\n    248             self.fill_exec_result(result)\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/IPython/core/displayhook.py in compute_format_data(self, result)\n    148 \n    149         \"\"\"\n--> 150         return self.shell.display_formatter.format(result)\n    151 \n    152     # This can be set to True by the write_output_prompt method in a subclass\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/display/formatter.py in format(self, obj, include, exclude)\n    198         \"\"\"\n    199         # First, use Sage rich output if there is any\n--> 200         sage_format, sage_metadata = self.dm.displayhook(obj)\n    201         assert PLAIN_TEXT in sage_format, 'plain text is always present'\n    202         if not set(sage_format.keys()).issubset(self.default_mime()):\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/rich_output/display_manager.py in displayhook(self, obj)\n    809             return\n    810         self._backend.set_underscore_variable(obj)\n--> 811         plain_text, rich_output = self._rich_output_formatter(obj, dict())\n    812         return self._backend.displayhook(plain_text, rich_output)\n    813 \n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/rich_output/display_manager.py in _rich_output_formatter(self, obj, rich_repr_kwds)\n    621         rich_output = None\n    622         plain_text = None\n--> 623         has_rich_repr = isinstance(obj, SageObject) and hasattr(obj, '_rich_repr_')\n    624         if has_rich_repr:\n    625             rich_output = self._call_rich_repr(obj, rich_repr_kwds)\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__getattr__()\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()\n    149 \n    150     ## Load file by absolute filename\n--> 151     with open(filename, 'rb') as fobj:\n    152         X = loads(fobj.read(), compress=compress)\n    153     try:\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()\n    150     ## Load file by absolute filename\n    151     with open(filename, 'rb') as fobj:\n--> 152         X = loads(fobj.read(), compress=compress)\n    153     try:\n    154         X._default_filename = os.path.abspath(filename)\n\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()\n    967 \n    968     unpickler = SageUnpickler(io.BytesIO(s))\n--> 969     return unpickler.load()\n    970 \n    971 \n\nUnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n```",
    "created_at": "2019-08-28T17:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446877",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
I just sent email to your Jena address. I can get the package to build, but it doesn't work yet. An illustration of one problem:

```
sage: load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')
/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/src/bin/sage-ipython:1: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
  #!/usr/bin/env sage-python23
WARNING: Files on disk have been moved or are not writeable.
> Will try to recover later.
/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/rich_output/display_manager.py:623: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
  has_rich_repr = isinstance(obj, SageObject) and hasattr(obj, '_rich_repr_')
8gp3: Files on disk have been moved - trying to get things right
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-5-9bd7fbf5ad54> in <module>()
----> 1 load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/IPython/core/displayhook.py in __call__(self, result)
    244             self.start_displayhook()
    245             self.write_output_prompt()
--> 246             format_dict, md_dict = self.compute_format_data(result)
    247             self.update_user_ns(result)
    248             self.fill_exec_result(result)

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/IPython/core/displayhook.py in compute_format_data(self, result)
    148 
    149         """
--> 150         return self.shell.display_formatter.format(result)
    151 
    152     # This can be set to True by the write_output_prompt method in a subclass

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/display/formatter.py in format(self, obj, include, exclude)
    198         """
    199         # First, use Sage rich output if there is any
--> 200         sage_format, sage_metadata = self.dm.displayhook(obj)
    201         assert PLAIN_TEXT in sage_format, 'plain text is always present'
    202         if not set(sage_format.keys()).issubset(self.default_mime()):

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/rich_output/display_manager.py in displayhook(self, obj)
    809             return
    810         self._backend.set_underscore_variable(obj)
--> 811         plain_text, rich_output = self._rich_output_formatter(obj, dict())
    812         return self._backend.displayhook(plain_text, rich_output)
    813 

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/repl/rich_output/display_manager.py in _rich_output_formatter(self, obj, rich_repr_kwds)
    621         rich_output = None
    622         plain_text = None
--> 623         has_rich_repr = isinstance(obj, SageObject) and hasattr(obj, '_rich_repr_')
    624         if has_rich_repr:
    625             rich_output = self._call_rich_repr(obj, rich_repr_kwds)

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__getattr__()

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()
    149 
    150     ## Load file by absolute filename
--> 151     with open(filename, 'rb') as fobj:
    152         X = loads(fobj.read(), compress=compress)
    153     try:

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()
    150     ## Load file by absolute filename
    151     with open(filename, 'rb') as fobj:
--> 152         X = loads(fobj.read(), compress=compress)
    153     try:
    154         X._default_filename = os.path.abspath(filename)

/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()
    967 
    968     unpickler = SageUnpickler(io.BytesIO(s))
--> 969     return unpickler.load()
    970 
    971 

UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)
```



---

archive/issue_comments_446878.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> I just sent email to your Jena address. I can get the package to build, but it doesn't work yet.\n\n\nThank you very much, I received the patch.\n\n> An illustration of one problem:\n> \n> ```\n> sage: load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')\n> /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/src/bin/sage-ipython:1: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead\n> ...\n> UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n> ```\n\n\nThat probably is harmless. I.e., I should use \"warning\", and apparently in some unpickling method I use \"str\" where it should be \"bytes\".",
    "created_at": "2019-08-28T17:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446878",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Replying to [jhpalmieri](#comment%3A4):
> I just sent email to your Jena address. I can get the package to build, but it doesn't work yet.


Thank you very much, I received the patch.

> An illustration of one problem:
> 
> ```
> sage: load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')
> /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.9.beta8/src/bin/sage-ipython:1: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
> ...
> UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)
> ```


That probably is harmless. I.e., I should use "warning", and apparently in some unpickling method I use "str" where it should be "bytes".



---

archive/issue_comments_446879.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes, and I would like to track down the `str` vs. `bytes` issue. It would be nice if I could get basic functionality like `CohomologyRing(8,3)` to work.",
    "created_at": "2019-08-28T17:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446879",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
Yes, and I would like to track down the `str` vs. `bytes` issue. It would be nice if I could get basic functionality like `CohomologyRing(8,3)` to work.



---

archive/issue_comments_446880.json:
```json
{
    "body": "<a id='comment:7'></a>\nChanging `logger.warn` (or `coho_logger.warn`) to `X.warning` fixes the deprecation message. I don't know about the str/bytes issue.",
    "created_at": "2019-08-28T18:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446880",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Changing `logger.warn` (or `coho_logger.warn`) to `X.warning` fixes the deprecation message. I don't know about the str/bytes issue.



---

archive/issue_comments_446881.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jhpalmieri](#comment%3A7):\n> Changing `logger.warn` (or `coho_logger.warn`) to `X.warning` fixes the deprecation message. I don't know about the str/bytes issue.\n\n\nI did change `.warn(` into `.warning(` everywhere (so, no need to include it in a diff).\n\nConcerning str vs. byte: There is only one occurrence of `cdef str`, and this gets assigned to the output of `<some singular object>.name()`. Is that output really a string in python-3? If not, it should be changed to `cdef bytes`. However, so far the error in unpickling stuff looks mysterious to me, as the traceback doesn't mention where the problem actually occurs in my code.",
    "created_at": "2019-08-29T05:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446881",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
Replying to [jhpalmieri](#comment%3A7):
> Changing `logger.warn` (or `coho_logger.warn`) to `X.warning` fixes the deprecation message. I don't know about the str/bytes issue.


I did change `.warn(` into `.warning(` everywhere (so, no need to include it in a diff).

Concerning str vs. byte: There is only one occurrence of `cdef str`, and this gets assigned to the output of `<some singular object>.name()`. Is that output really a string in python-3? If not, it should be changed to `cdef bytes`. However, so far the error in unpickling stuff looks mysterious to me, as the traceback doesn't mention where the problem actually occurs in my code.



---

archive/issue_comments_446882.json:
```json
{
    "body": "<a id='comment:9'></a>\nCould the problem be in the way the .sobj files were produced? What if you regenerate them using Python 3?",
    "created_at": "2019-08-29T05:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446882",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Could the problem be in the way the .sobj files were produced? What if you regenerate them using Python 3?



---

archive/issue_comments_446883.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> Could the problem be in the way the .sobj files were produced? What if you regenerate them using Python 3?\n\n\nYou mean Python 3 is severely backwards incompatible and cannot deal with old pickles? That would be a show stopper for Sage, I think.\n\nNote that at some point in the past I inserted code to regenerate very old pickles and translate them automatically to a new format. However, I would certainly not like to regenerate several gigabytes of data in the web repository.\n\nNote that the problem occurs together with a warning:\n\n```\nWARNING: Files on disk have been moved or are not writeable.\n> Will try to recover later.\n...\n8gp3: Files on disk have been moved - trying to get things right\n```\nMaybe that indicates where the problem comes from. So, let's recall how storing the modular cohomology ring of a prime power group is solved.\n\nVery early in the package development I found that is is terribly slow to pack all data of a ring in a single file. It simply takes so long and requires so much memory (at least in some cases) that it is not feasible to automatically store intermediate results of a lengthy computation (which evidently is a reasonable thing to do).\n\nMy solution was to not store a ring in a single file but distribute the data in a folder. So, the actual .sobj pickle file only contains basic information but is not stand-alone. In particular, the p_group_cohomology spkg needs to know where the data folder is located, the .sobj file has to be in the data folder and also it needs write permission for otherwise it couldn't do a continuation of the cohomology ring's computation. What is stored in the web repository is a compressed tar file of the data folder (i.e., when the web repository is accessed, then the tar file is downloaded, unpacked, and then the cohomology ring is loaded from there).\n\nBy default, the data folder's location is composed from the location of the current workspace (which are global variables) and from the identifier of the group (which is stored in the .sobj file).\n\nThe warning mentioned above occurs when the data folder's default location cannot be accessed. And in that case, I do some trickery --- and perhaps that trickery doesn't work in Python 3? Namely:\n- When an object is obtained from reading a pickle file, then Python (at least Python 2) stores the original file location as an attribute of the object. However, that attribute is only available *after* successful unpickling.\n- Therefore, when initially the location of the data folder cannot be determined, an *unitialised* cohomology ring is returned.\n- As soon as the uninitialised cohomology ring is touched (I think constructing its repr is enough), initialisation is triggered. Namely, recall that the location of the .sobj file is stored as an attribute of the uninitialised ring and that the .sobj file is supposed to be located in the data folder -- voil\u00e0, you can now determine the data folder and finish initialisation of the cohomology ring.\n\nIf the .sobj file's location is not stored as an attribute in Python 3 then I have a problem.",
    "created_at": "2019-08-29T06:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446883",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>
Replying to [jhpalmieri](#comment%3A9):
> Could the problem be in the way the .sobj files were produced? What if you regenerate them using Python 3?


You mean Python 3 is severely backwards incompatible and cannot deal with old pickles? That would be a show stopper for Sage, I think.

Note that at some point in the past I inserted code to regenerate very old pickles and translate them automatically to a new format. However, I would certainly not like to regenerate several gigabytes of data in the web repository.

Note that the problem occurs together with a warning:

```
WARNING: Files on disk have been moved or are not writeable.
> Will try to recover later.
...
8gp3: Files on disk have been moved - trying to get things right
```
Maybe that indicates where the problem comes from. So, let's recall how storing the modular cohomology ring of a prime power group is solved.

Very early in the package development I found that is is terribly slow to pack all data of a ring in a single file. It simply takes so long and requires so much memory (at least in some cases) that it is not feasible to automatically store intermediate results of a lengthy computation (which evidently is a reasonable thing to do).

My solution was to not store a ring in a single file but distribute the data in a folder. So, the actual .sobj pickle file only contains basic information but is not stand-alone. In particular, the p_group_cohomology spkg needs to know where the data folder is located, the .sobj file has to be in the data folder and also it needs write permission for otherwise it couldn't do a continuation of the cohomology ring's computation. What is stored in the web repository is a compressed tar file of the data folder (i.e., when the web repository is accessed, then the tar file is downloaded, unpacked, and then the cohomology ring is loaded from there).

By default, the data folder's location is composed from the location of the current workspace (which are global variables) and from the identifier of the group (which is stored in the .sobj file).

The warning mentioned above occurs when the data folder's default location cannot be accessed. And in that case, I do some trickery --- and perhaps that trickery doesn't work in Python 3? Namely:
- When an object is obtained from reading a pickle file, then Python (at least Python 2) stores the original file location as an attribute of the object. However, that attribute is only available *after* successful unpickling.
- Therefore, when initially the location of the data folder cannot be determined, an *unitialised* cohomology ring is returned.
- As soon as the uninitialised cohomology ring is touched (I think constructing its repr is enough), initialisation is triggered. Namely, recall that the location of the .sobj file is stored as an attribute of the uninitialised ring and that the .sobj file is supposed to be located in the data folder -- voilà, you can now determine the data folder and finish initialisation of the cohomology ring.

If the .sobj file's location is not stored as an attribute in Python 3 then I have a problem.



---

archive/issue_comments_446884.json:
```json
{
    "body": "<a id='comment:11'></a>\nQuestion: How to test whether something has a type that qualifies it as a filename? Is `isinstance(self._property_dict['_need_new_root'],basestring)` ok in Python-3?",
    "created_at": "2019-08-29T07:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446884",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>
Question: How to test whether something has a type that qualifies it as a filename? Is `isinstance(self._property_dict['_need_new_root'],basestring)` ok in Python-3?



---

archive/issue_comments_446885.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [SimonKing](#comment%3A11):\n> Question: How to test whether something has a type that qualifies it as a filename? Is `isinstance(self._property_dict['_need_new_root'],basestring)` ok in Python-3?\n\n\nHere is what I found in the \"internetz\" concerning how to test if something is a string in a way that works in python 2 and 3:\n\n```\nimport six\n\nif isinstance(obj, six.string_types):\n    print('obj is a string!')\n```\nSo, I think I should fix this.",
    "created_at": "2019-08-29T09:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446885",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'></a>
Replying to [SimonKing](#comment%3A11):
> Question: How to test whether something has a type that qualifies it as a filename? Is `isinstance(self._property_dict['_need_new_root'],basestring)` ok in Python-3?


Here is what I found in the "internetz" concerning how to test if something is a string in a way that works in python 2 and 3:

```
import six

if isinstance(obj, six.string_types):
    print('obj is a string!')
```
So, I think I should fix this.



---

archive/issue_comments_446886.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [SimonKing](#comment%3A10):\n> If the .sobj file's location is not stored as an attribute in Python 3 then I have a problem.\n\n\nHooray:\n\n```\n# in Sage-with-python-2\nsage: P = CombinatorialFreeModule(ZZ,'x')\nsage: save(P,'../../pickle')\n```\n\n```\n# BOTH with python-2 and python-3\nsage: B = load('../../pickle.sobj')\nsage: B._default_filename\n'/home/king/Sage/pickle.sobj'\n```\nSo, the old trick should still work.",
    "created_at": "2019-08-29T09:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446886",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'></a>
Replying to [SimonKing](#comment%3A10):
> If the .sobj file's location is not stored as an attribute in Python 3 then I have a problem.


Hooray:

```
# in Sage-with-python-2
sage: P = CombinatorialFreeModule(ZZ,'x')
sage: save(P,'../../pickle')
```

```
# BOTH with python-2 and python-3
sage: B = load('../../pickle.sobj')
sage: B._default_filename
'/home/king/Sage/pickle.sobj'
```
So, the old trick should still work.



---

archive/issue_comments_446887.json:
```json
{
    "body": "<a id='comment:14'></a>\nCurrently, I get the following behaviour:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.set_workspace(tmp_dir())\nsage: H = CohomologyRing(8,3,from_scratch=True,options='debug')\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/26693/dir_f6_f2ei3/'\nComputing basic setup for Small Group number 1 of order 2\nComputing basic setup for Small Group number 2 of order 4\nComputing basic setup for Small Group number 3 of order 8\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-d1c5c11acd7a> in <module>()\n----> 1 H = CohomologyRing(Integer(8),Integer(3),from_scratch=True,options='debug')\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)\n   1707             if q < 128:\n   1708                 extras['websource'] = False\n-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1710             return OUT\n   1711 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)\n   1246                 OUT = COHO(gap(KEY[0]), **extras)\n   1247         else:\n-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)\n   1249         _gap_reset_random_seed()\n   1250         try:\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__init__()\n\nTypeError: expected bytes, str found\n```\nand\n\n```\nsage: H = CohomologyRing(8,3,options='debug')\nLocal data found at /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3/H8gp3.sobj\nCreating symbolic links from /home/king/.sage/temp/klap/26693/dir_f6_f2ei3/8gp3 to /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3\nGroup data are rooted at '/home/king/.sage/temp/klap/26693/dir_f6_f2ei3/'\nThe state descriptor of the to-be-unpickled ring is expected to be provided at '/home/king/.sage/temp/klap/26693/dir_f6_f2ei3/8gp3/dat/State.sobj'\n---------------------------------------------------------------------------\nUnicodeDecodeError                        Traceback (most recent call last)\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)\n   1154                 coho_options['@use_this_root@'] = root_workspace\n-> 1155                 OUT = load(os.path.join(root_workspace,file_name)) # realpath here?\n   1156                 if '@use_this_root@' in coho_options:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()\n    150     ## Load file by absolute filename\n--> 151     with open(filename, 'rb') as fobj:\n    152         X = loads(fobj.read(), compress=compress)\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()\n    151     with open(filename, 'rb') as fobj:\n--> 152         X = loads(fobj.read(), compress=compress)\n    153     try:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()\n    968     unpickler = SageUnpickler(io.BytesIO(s))\n--> 969     return unpickler.load()\n    970 \n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO_unpickle()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()\n    150     ## Load file by absolute filename\n--> 151     with open(filename, 'rb') as fobj:\n    152         X = loads(fobj.read(), compress=compress)\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()\n    151     with open(filename, 'rb') as fobj:\n--> 152         X = loads(fobj.read(), compress=compress)\n    153     try:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()\n    968     unpickler = SageUnpickler(io.BytesIO(s))\n--> 969     return unpickler.load()\n    970 \n\nUnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n\nDuring handling of the above exception, another exception occurred:\n\nOSError                                   Traceback (most recent call last)\n<ipython-input-4-927128be23f4> in <module>()\n----> 1 H = CohomologyRing(Integer(8),Integer(3),options='debug')\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)\n   1707             if q < 128:\n   1708                 extras['websource'] = False\n-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1710             return OUT\n   1711 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)\n   1159                 if '@use_this_root@' in coho_options:\n   1160                     del coho_options['@use_this_root@']\n-> 1161                 raise IOError(\"Saved data at %s are not readable: %s\"%(os.path.join(root_local_sources,file_name), msg))\n   1162         ## 4. Search web repository\n   1163         elif kwds.get('websource')!=False and (not from_scratch):\n\nOSError: Saved data at /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3/H8gp3.sobj are not readable: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n```\nSo, that's something I can now try to debug.",
    "created_at": "2019-08-29T10:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446887",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>
Currently, I get the following behaviour:

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.set_workspace(tmp_dir())
sage: H = CohomologyRing(8,3,from_scratch=True,options='debug')
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/26693/dir_f6_f2ei3/'
Computing basic setup for Small Group number 1 of order 2
Computing basic setup for Small Group number 2 of order 4
Computing basic setup for Small Group number 3 of order 8
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-d1c5c11acd7a> in <module>()
----> 1 H = CohomologyRing(Integer(8),Integer(3),from_scratch=True,options='debug')

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)
   1707             if q < 128:
   1708                 extras['websource'] = False
-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1710             return OUT
   1711 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)
   1246                 OUT = COHO(gap(KEY[0]), **extras)
   1247         else:
-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)
   1249         _gap_reset_random_seed()
   1250         try:

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__init__()

TypeError: expected bytes, str found
```
and

```
sage: H = CohomologyRing(8,3,options='debug')
Local data found at /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3/H8gp3.sobj
Creating symbolic links from /home/king/.sage/temp/klap/26693/dir_f6_f2ei3/8gp3 to /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3
Group data are rooted at '/home/king/.sage/temp/klap/26693/dir_f6_f2ei3/'
The state descriptor of the to-be-unpickled ring is expected to be provided at '/home/king/.sage/temp/klap/26693/dir_f6_f2ei3/8gp3/dat/State.sobj'
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)
   1154                 coho_options['@use_this_root@'] = root_workspace
-> 1155                 OUT = load(os.path.join(root_workspace,file_name)) # realpath here?
   1156                 if '@use_this_root@' in coho_options:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()
    150     ## Load file by absolute filename
--> 151     with open(filename, 'rb') as fobj:
    152         X = loads(fobj.read(), compress=compress)

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()
    151     with open(filename, 'rb') as fobj:
--> 152         X = loads(fobj.read(), compress=compress)
    153     try:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()
    968     unpickler = SageUnpickler(io.BytesIO(s))
--> 969     return unpickler.load()
    970 

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO_unpickle()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()
    150     ## Load file by absolute filename
--> 151     with open(filename, 'rb') as fobj:
    152         X = loads(fobj.read(), compress=compress)

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()
    151     with open(filename, 'rb') as fobj:
--> 152         X = loads(fobj.read(), compress=compress)
    153     try:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()
    968     unpickler = SageUnpickler(io.BytesIO(s))
--> 969     return unpickler.load()
    970 

UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)

During handling of the above exception, another exception occurred:

OSError                                   Traceback (most recent call last)
<ipython-input-4-927128be23f4> in <module>()
----> 1 H = CohomologyRing(Integer(8),Integer(3),options='debug')

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)
   1707             if q < 128:
   1708                 extras['websource'] = False
-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1710             return OUT
   1711 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)
   1159                 if '@use_this_root@' in coho_options:
   1160                     del coho_options['@use_this_root@']
-> 1161                 raise IOError("Saved data at %s are not readable: %s"%(os.path.join(root_local_sources,file_name), msg))
   1162         ## 4. Search web repository
   1163         elif kwds.get('websource')!=False and (not from_scratch):

OSError: Saved data at /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3/H8gp3.sobj are not readable: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)
```
So, that's something I can now try to debug.



---

archive/issue_comments_446888.json:
```json
{
    "body": "<a id='comment:15'></a>\nin case you need them, sage has its own compatibility functions \"bytes_to_str\" and \"str_to_bytes\", to be found in sage.cpython.string and working in both py2 and py3",
    "created_at": "2019-08-29T11:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446888",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
in case you need them, sage has its own compatibility functions "bytes_to_str" and "str_to_bytes", to be found in sage.cpython.string and working in both py2 and py3



---

archive/issue_comments_446889.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [chapoton](#comment%3A15):\n> in case you need them, sage has its own compatibility functions \"bytes_to_str\" and \"str_to_bytes\", to be found in sage.cpython.string and working in both py2 and py3\n\n\nThank you! I don't know yet whether or not I'll need them, but certainly it is good to know.",
    "created_at": "2019-08-29T11:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446889",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:16'></a>
Replying to [chapoton](#comment%3A15):
> in case you need them, sage has its own compatibility functions "bytes_to_str" and "str_to_bytes", to be found in sage.cpython.string and working in both py2 and py3


Thank you! I don't know yet whether or not I'll need them, but certainly it is good to know.



---

archive/issue_comments_446890.json:
```json
{
    "body": "<a id='comment:17'></a>\nI found that this fails in `RESL.__init__`:\n\n```\n        tmprstem = os.path.join(res_folder,rstem)\n        tmpgstem = os.path.join(gps_folder,gstem)\n        self.Data = newResolWithGroupLoaded(tmprstem,tmpgstem,1)\n```\nApparently tmprstem or tmpgstem are strings, but the C function `newResolWithGroupLoaded` expects `char *` --- is there no automatic conversion from py3-string to  `char*`?",
    "created_at": "2019-08-29T11:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446890",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:17'></a>
I found that this fails in `RESL.__init__`:

```
        tmprstem = os.path.join(res_folder,rstem)
        tmpgstem = os.path.join(gps_folder,gstem)
        self.Data = newResolWithGroupLoaded(tmprstem,tmpgstem,1)
```
Apparently tmprstem or tmpgstem are strings, but the C function `newResolWithGroupLoaded` expects `char *` --- is there no automatic conversion from py3-string to  `char*`?



---

archive/issue_comments_446891.json:
```json
{
    "body": "<a id='comment:18'></a>\nMaybe try\n\n```\nself.Data = newResolWithGroupLoaded(str_to_bytes(tmprstem),str_to_bytes(tmpgstem),1)\n```\n..with no guarantee..",
    "created_at": "2019-08-29T12:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446891",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
Maybe try

```
self.Data = newResolWithGroupLoaded(str_to_bytes(tmprstem),str_to_bytes(tmpgstem),1)
```
..with no guarantee..



---

archive/issue_comments_446892.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [chapoton](#comment%3A18):\n> Maybe try\n> \n> ```\n> self.Data = newResolWithGroupLoaded(str_to_bytes(tmprstem),str_to_bytes(tmpgstem),1)\n> ```\n> ..with no guarantee..\n\n\nThat is likely to work. Another potential solution would be to generally work with bytes. I.e., let self.gstem be a bytes and then do `os.path.join(self.res_folder, b'A'+self.gstem+b'.sobj'))` etc.\n\nWhat would be the preferred way?",
    "created_at": "2019-08-29T12:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446892",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:19'></a>
Replying to [chapoton](#comment%3A18):
> Maybe try
> 
> ```
> self.Data = newResolWithGroupLoaded(str_to_bytes(tmprstem),str_to_bytes(tmpgstem),1)
> ```
> ..with no guarantee..


That is likely to work. Another potential solution would be to generally work with bytes. I.e., let self.gstem be a bytes and then do `os.path.join(self.res_folder, b'A'+self.gstem+b'.sobj'))` etc.

What would be the preferred way?



---

archive/issue_comments_446893.json:
```json
{
    "body": "<a id='comment:20'></a>\nbeware that you cannot concatenate bytes and str, so everything must become bytes. Not the way to go in my opinion.. moreover, not sure that os.* can handle bytes\n\nEDIT:\n\nindeed:\n\n```\nsage: os.path.join('home', b'jojo')\n...\nTypeError: Can't mix strings and bytes in path components\n```",
    "created_at": "2019-08-29T12:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446893",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
beware that you cannot concatenate bytes and str, so everything must become bytes. Not the way to go in my opinion.. moreover, not sure that os.* can handle bytes

EDIT:

indeed:

```
sage: os.path.join('home', b'jojo')
...
TypeError: Can't mix strings and bytes in path components
```



---

archive/issue_comments_446894.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [chapoton](#comment%3A20):\n> beware that you cannot concatenate bytes and str, so everything must become bytes. Not the way to go in my opinion.. moreover, not sure that os.* can handle bytes\n> \n> EDIT:\n> \n> indeed:\n> \n> ```\n> sage: os.path.join('home', b'jojo')\n> ...\n> TypeError: Can't mix strings and bytes in path components\n> ```\n\n\nThis only shows that it cannot mix both types. In fact, if both are bytes then things work:\n\n```\nsage: os.path.join(b'home', b'foo')\nb'home/foo'\n```\nProbably it would be a long and tedious work to change everything to bytes. In principle I would be willing to do that work, but if there is a different solution involving less work and only a slight overhead, I'd prefer that.\n\nCurrently, using `str_to_bytes` when passing a string to a C function does seem to work.",
    "created_at": "2019-08-29T12:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446894",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>
Replying to [chapoton](#comment%3A20):
> beware that you cannot concatenate bytes and str, so everything must become bytes. Not the way to go in my opinion.. moreover, not sure that os.* can handle bytes
> 
> EDIT:
> 
> indeed:
> 
> ```
> sage: os.path.join('home', b'jojo')
> ...
> TypeError: Can't mix strings and bytes in path components
> ```


This only shows that it cannot mix both types. In fact, if both are bytes then things work:

```
sage: os.path.join(b'home', b'foo')
b'home/foo'
```
Probably it would be a long and tedious work to change everything to bytes. In principle I would be willing to do that work, but if there is a different solution involving less work and only a slight overhead, I'd prefer that.

Currently, using `str_to_bytes` when passing a string to a C function does seem to work.



---

archive/issue_comments_446895.json:
```json
{
    "body": "<a id='comment:22'></a>\nWTF? I just see that I have the following argument types of `COCH.__init__`:\n\n```\ndef __init__(self, PARENT, int n, char *Nick, L, ydeg=None, rdeg=None, is_polyrep=False)\n```\n\nI suppose Nick shouldn't be `char*` but (if anything) str. Or better not type it at all.",
    "created_at": "2019-08-29T12:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446895",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'></a>
WTF? I just see that I have the following argument types of `COCH.__init__`:

```
def __init__(self, PARENT, int n, char *Nick, L, ydeg=None, rdeg=None, is_polyrep=False)
```

I suppose Nick shouldn't be `char*` but (if anything) str. Or better not type it at all.



---

archive/issue_comments_446896.json:
```json
{
    "body": "<a id='comment:23'></a>\nI think I should also fix the following compiler warning (there are several similar):\n\n```\npGroupCohomology/cohomology.c: In function \u2018__pyx_pf_16pGroupCohomology_10cohomology_12explore_one_parameter\u2019:\npGroupCohomology/cohomology.c:17678:35: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_16; __pyx_t_7+=1) {\n```",
    "created_at": "2019-08-29T12:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446896",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:23'></a>
I think I should also fix the following compiler warning (there are several similar):

```
pGroupCohomology/cohomology.c: In function ‘__pyx_pf_16pGroupCohomology_10cohomology_12explore_one_parameter’:
pGroupCohomology/cohomology.c:17678:35: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_16; __pyx_t_7+=1) {
```



---

archive/issue_comments_446897.json:
```json
{
    "body": "<a id='comment:24'></a>\nI guesss getting the following error is a progress, although it seems a bit strange to me:\n\n```\nsage: H = CohomologyRing(8,3,from_scratch=True,options='debug')\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/31253/dir_88iattmw/'\nComputing basic setup for Small Group number 1 of order 2\nComputing basic setup for Small Group number 2 of order 4\nComputing basic setup for Small Group number 3 of order 8\n> export action matrices\nInitialising maximal p-elementary abelian subgroups\nInserting SmallGroup(2,1) as a subgroup\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/31253/dir_88iattmw/'\n> export action matrices\nUnable to save basic ring setup\nTraceback (most recent call last):\n  File \"sage/misc/persist.pyx\", line 240, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)\n    obj.save(filename=filename, compress=compress, **kwargs)\nAttributeError: 'tuple' object has no attribute 'save'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"sage/misc/persist.pyx\", line 240, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3636)\n    obj.save(filename=filename, compress=compress, **kwargs)\n  File \"sage/structure/sage_object.pyx\", line 424, in sage.structure.sage_object.SageObject.save (build/cythonized/sage/structure/sage_object.c:3328)\n    filename = _base_save(self, filename, compress=compress)\n  File \"sage/misc/persist.pyx\", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)\n    with open(filename, 'wb') as fobj:\n  File \"sage/misc/persist.pyx\", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)\n    fobj.write(_base_dumps(obj, compress=compress))\n  File \"sage/misc/persist.pyx\", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)\n    gherkin = SagePickler.dumps(obj)\n  File \"sage/misc/persist.pyx\", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)\n    pickler.dump(obj)\n  File \"pGroupCohomology/cohomology.pyx\", line 3464, in pGroupCohomology.cohomology.COHO.__reduce__\n  File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py\", line 85, in safe_save\n    save (obj, path)\n  File \"sage/misc/persist.pyx\", line 242, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)\n    _base_save(obj, filename, compress=compress)\n  File \"sage/misc/persist.pyx\", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)\n    with open(filename, 'wb') as fobj:\n  File \"sage/misc/persist.pyx\", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)\n    fobj.write(_base_dumps(obj, compress=compress))\n  File \"sage/misc/persist.pyx\", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)\n    gherkin = SagePickler.dumps(obj)\n  File \"sage/misc/persist.pyx\", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)\n    pickler.dump(obj)\nTypeError: can't pickle dict_items objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"sage/misc/persist.pyx\", line 240, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)\n    obj.save(filename=filename, compress=compress, **kwargs)\nAttributeError: 'tuple' object has no attribute 'save'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py\", line 1254, in _get_p_group_from_scratch\n    safe_save(OUT, OUT.autosave_name())\n  File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py\", line 85, in safe_save\n    save (obj, path)\n  File \"sage/misc/persist.pyx\", line 242, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)\n    _base_save(obj, filename, compress=compress)\n  File \"sage/misc/persist.pyx\", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)\n    with open(filename, 'wb') as fobj:\n  File \"sage/misc/persist.pyx\", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)\n    fobj.write(_base_dumps(obj, compress=compress))\n  File \"sage/misc/persist.pyx\", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)\n    gherkin = SagePickler.dumps(obj)\n  File \"sage/misc/persist.pyx\", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)\n    pickler.dump(obj)\n  File \"pGroupCohomology/cohomology.pyx\", line 3464, in pGroupCohomology.cohomology.COHO.__reduce__\n  File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py\", line 85, in safe_save\n    save (obj, path)\n  File \"sage/misc/persist.pyx\", line 242, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)\n    _base_save(obj, filename, compress=compress)\n  File \"sage/misc/persist.pyx\", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)\n    with open(filename, 'wb') as fobj:\n  File \"sage/misc/persist.pyx\", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)\n    fobj.write(_base_dumps(obj, compress=compress))\n  File \"sage/misc/persist.pyx\", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)\n    gherkin = SagePickler.dumps(obj)\n  File \"sage/misc/persist.pyx\", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)\n    pickler.dump(obj)\nTypeError: can't pickle dict_items objects\nComputing next term\n> rk P_02 =   1\nWe have to choose 1 new generator in degree 1\n> There is 1 Duflot regular generator in degree 1\nSummary: 0 relations and 1 generators in degree 1\nRing approximation computed out to degree 1!\nStoring approximation data\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()\n    239         try:\n--> 240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n\nAttributeError: 'pGroupCohomology.resolution.RESL' object has no attribute 'save'\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()\n    239         try:\n--> 240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n\nAttributeError: 'dict_items' object has no attribute 'save'\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3636)()\n    239         try:\n--> 240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject.save (build/cythonized/sage/structure/sage_object.c:3328)()\n    423 \n--> 424         filename = _base_save(self, filename, compress=compress)\n    425 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()\n    178 \n--> 179     with open(filename, 'wb') as fobj:\n    180         fobj.write(_base_dumps(obj, compress=compress))\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()\n    179     with open(filename, 'wb') as fobj:\n--> 180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()\n    256 \n--> 257     gherkin = SagePickler.dumps(obj)\n    258 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()\n    835         pickler = cls(buf, **kwargs)\n--> 836         pickler.dump(obj)\n    837         return buf.getvalue()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__reduce__()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__getstate__()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)\n     84         os.unlink(path)\n---> 85     save (obj, path)\n     86 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()\n    241         except (AttributeError, RuntimeError, TypeError):\n--> 242             _base_save(obj, filename, compress=compress)\n    243     else:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()\n    178 \n--> 179     with open(filename, 'wb') as fobj:\n    180         fobj.write(_base_dumps(obj, compress=compress))\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()\n    179     with open(filename, 'wb') as fobj:\n--> 180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()\n    256 \n--> 257     gherkin = SagePickler.dumps(obj)\n    258 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()\n    835         pickler = cls(buf, **kwargs)\n--> 836         pickler.dump(obj)\n    837         return buf.getvalue()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__reduce__()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.exportLifts()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.LIFTcontainer.export()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)\n     84         os.unlink(path)\n---> 85     save (obj, path)\n     86 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()\n    241         except (AttributeError, RuntimeError, TypeError):\n--> 242             _base_save(obj, filename, compress=compress)\n    243     else:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()\n    178 \n--> 179     with open(filename, 'wb') as fobj:\n    180         fobj.write(_base_dumps(obj, compress=compress))\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()\n    179     with open(filename, 'wb') as fobj:\n--> 180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()\n    256 \n--> 257     gherkin = SagePickler.dumps(obj)\n    258 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()\n    835         pickler = cls(buf, **kwargs)\n--> 836         pickler.dump(obj)\n    837         return buf.getvalue()\n\nTypeError: can't pickle dict_items objects\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()\n    239         try:\n--> 240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n\nAttributeError: 'pGroupCohomology.resolution.RESL' object has no attribute 'save'\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()\n    239         try:\n--> 240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n\nAttributeError: 'dict_items' object has no attribute 'save'\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-d1c5c11acd7a> in <module>()\n----> 1 H = CohomologyRing(Integer(8),Integer(3),from_scratch=True,options='debug')\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)\n   1707             if q < 128:\n   1708                 extras['websource'] = False\n-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1710             return OUT\n   1711 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)\n   1246                 OUT = COHO(gap(KEY[0]), **extras)\n   1247         else:\n-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)\n   1249         _gap_reset_random_seed()\n   1250         try:\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InitSubgroups()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InsertSubgroup()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.make()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.next()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)\n     83     if os.path.islink(path):\n     84         os.unlink(path)\n---> 85     save (obj, path)\n     86 \n     87 ###################################\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()\n    240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n--> 242             _base_save(obj, filename, compress=compress)\n    243     else:\n    244         # Saving an object to an image file.\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()\n    177     filename = _normalize_filename(filename)\n    178 \n--> 179     with open(filename, 'wb') as fobj:\n    180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()\n    178 \n    179     with open(filename, 'wb') as fobj:\n--> 180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n    182     return filename\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()\n    255     \"\"\"\n    256 \n--> 257     gherkin = SagePickler.dumps(obj)\n    258 \n    259     if compress:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()\n    834         buf = io.BytesIO()\n    835         pickler = cls(buf, **kwargs)\n--> 836         pickler.dump(obj)\n    837         return buf.getvalue()\n    838 \n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__reduce__()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__getstate__()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)\n     83     if os.path.islink(path):\n     84         os.unlink(path)\n---> 85     save (obj, path)\n     86 \n     87 ###################################\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()\n    240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n--> 242             _base_save(obj, filename, compress=compress)\n    243     else:\n    244         # Saving an object to an image file.\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()\n    177     filename = _normalize_filename(filename)\n    178 \n--> 179     with open(filename, 'wb') as fobj:\n    180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()\n    178 \n    179     with open(filename, 'wb') as fobj:\n--> 180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n    182     return filename\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()\n    255     \"\"\"\n    256 \n--> 257     gherkin = SagePickler.dumps(obj)\n    258 \n    259     if compress:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()\n    834         buf = io.BytesIO()\n    835         pickler = cls(buf, **kwargs)\n--> 836         pickler.dump(obj)\n    837         return buf.getvalue()\n    838 \n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__reduce__()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.exportLifts()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.LIFTcontainer.export()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)\n     83     if os.path.islink(path):\n     84         os.unlink(path)\n---> 85     save (obj, path)\n     86 \n     87 ###################################\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()\n    240             obj.save(filename=filename, compress=compress, **kwargs)\n    241         except (AttributeError, RuntimeError, TypeError):\n--> 242             _base_save(obj, filename, compress=compress)\n    243     else:\n    244         # Saving an object to an image file.\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()\n    177     filename = _normalize_filename(filename)\n    178 \n--> 179     with open(filename, 'wb') as fobj:\n    180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()\n    178 \n    179     with open(filename, 'wb') as fobj:\n--> 180         fobj.write(_base_dumps(obj, compress=compress))\n    181 \n    182     return filename\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()\n    255     \"\"\"\n    256 \n--> 257     gherkin = SagePickler.dumps(obj)\n    258 \n    259     if compress:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()\n    834         buf = io.BytesIO()\n    835         pickler = cls(buf, **kwargs)\n--> 836         pickler.dump(obj)\n    837         return buf.getvalue()\n    838 \n\nTypeError: can't pickle dict_items objects\n```\nWhat are `dict_items`, and why can't they be pickled?",
    "created_at": "2019-08-29T12:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446897",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:24'></a>
I guesss getting the following error is a progress, although it seems a bit strange to me:

```
sage: H = CohomologyRing(8,3,from_scratch=True,options='debug')
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/31253/dir_88iattmw/'
Computing basic setup for Small Group number 1 of order 2
Computing basic setup for Small Group number 2 of order 4
Computing basic setup for Small Group number 3 of order 8
> export action matrices
Initialising maximal p-elementary abelian subgroups
Inserting SmallGroup(2,1) as a subgroup
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/31253/dir_88iattmw/'
> export action matrices
Unable to save basic ring setup
Traceback (most recent call last):
  File "sage/misc/persist.pyx", line 240, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)
    obj.save(filename=filename, compress=compress, **kwargs)
AttributeError: 'tuple' object has no attribute 'save'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "sage/misc/persist.pyx", line 240, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3636)
    obj.save(filename=filename, compress=compress, **kwargs)
  File "sage/structure/sage_object.pyx", line 424, in sage.structure.sage_object.SageObject.save (build/cythonized/sage/structure/sage_object.c:3328)
    filename = _base_save(self, filename, compress=compress)
  File "sage/misc/persist.pyx", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)
    with open(filename, 'wb') as fobj:
  File "sage/misc/persist.pyx", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)
    fobj.write(_base_dumps(obj, compress=compress))
  File "sage/misc/persist.pyx", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)
    gherkin = SagePickler.dumps(obj)
  File "sage/misc/persist.pyx", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)
    pickler.dump(obj)
  File "pGroupCohomology/cohomology.pyx", line 3464, in pGroupCohomology.cohomology.COHO.__reduce__
  File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py", line 85, in safe_save
    save (obj, path)
  File "sage/misc/persist.pyx", line 242, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)
    _base_save(obj, filename, compress=compress)
  File "sage/misc/persist.pyx", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)
    with open(filename, 'wb') as fobj:
  File "sage/misc/persist.pyx", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)
    fobj.write(_base_dumps(obj, compress=compress))
  File "sage/misc/persist.pyx", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)
    gherkin = SagePickler.dumps(obj)
  File "sage/misc/persist.pyx", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)
    pickler.dump(obj)
TypeError: can't pickle dict_items objects

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "sage/misc/persist.pyx", line 240, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)
    obj.save(filename=filename, compress=compress, **kwargs)
AttributeError: 'tuple' object has no attribute 'save'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py", line 1254, in _get_p_group_from_scratch
    safe_save(OUT, OUT.autosave_name())
  File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py", line 85, in safe_save
    save (obj, path)
  File "sage/misc/persist.pyx", line 242, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)
    _base_save(obj, filename, compress=compress)
  File "sage/misc/persist.pyx", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)
    with open(filename, 'wb') as fobj:
  File "sage/misc/persist.pyx", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)
    fobj.write(_base_dumps(obj, compress=compress))
  File "sage/misc/persist.pyx", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)
    gherkin = SagePickler.dumps(obj)
  File "sage/misc/persist.pyx", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)
    pickler.dump(obj)
  File "pGroupCohomology/cohomology.pyx", line 3464, in pGroupCohomology.cohomology.COHO.__reduce__
  File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py", line 85, in safe_save
    save (obj, path)
  File "sage/misc/persist.pyx", line 242, in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)
    _base_save(obj, filename, compress=compress)
  File "sage/misc/persist.pyx", line 179, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)
    with open(filename, 'wb') as fobj:
  File "sage/misc/persist.pyx", line 180, in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)
    fobj.write(_base_dumps(obj, compress=compress))
  File "sage/misc/persist.pyx", line 257, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)
    gherkin = SagePickler.dumps(obj)
  File "sage/misc/persist.pyx", line 836, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)
    pickler.dump(obj)
TypeError: can't pickle dict_items objects
Computing next term
> rk P_02 =   1
We have to choose 1 new generator in degree 1
> There is 1 Duflot regular generator in degree 1
Summary: 0 relations and 1 generators in degree 1
Ring approximation computed out to degree 1!
Storing approximation data
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()
    239         try:
--> 240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):

AttributeError: 'pGroupCohomology.resolution.RESL' object has no attribute 'save'

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()
    239         try:
--> 240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):

AttributeError: 'dict_items' object has no attribute 'save'

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3636)()
    239         try:
--> 240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject.save (build/cythonized/sage/structure/sage_object.c:3328)()
    423 
--> 424         filename = _base_save(self, filename, compress=compress)
    425 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()
    178 
--> 179     with open(filename, 'wb') as fobj:
    180         fobj.write(_base_dumps(obj, compress=compress))

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()
    179     with open(filename, 'wb') as fobj:
--> 180         fobj.write(_base_dumps(obj, compress=compress))
    181 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()
    256 
--> 257     gherkin = SagePickler.dumps(obj)
    258 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()
    835         pickler = cls(buf, **kwargs)
--> 836         pickler.dump(obj)
    837         return buf.getvalue()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__reduce__()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__getstate__()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)
     84         os.unlink(path)
---> 85     save (obj, path)
     86 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()
    241         except (AttributeError, RuntimeError, TypeError):
--> 242             _base_save(obj, filename, compress=compress)
    243     else:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()
    178 
--> 179     with open(filename, 'wb') as fobj:
    180         fobj.write(_base_dumps(obj, compress=compress))

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()
    179     with open(filename, 'wb') as fobj:
--> 180         fobj.write(_base_dumps(obj, compress=compress))
    181 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()
    256 
--> 257     gherkin = SagePickler.dumps(obj)
    258 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()
    835         pickler = cls(buf, **kwargs)
--> 836         pickler.dump(obj)
    837         return buf.getvalue()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__reduce__()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.exportLifts()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.LIFTcontainer.export()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)
     84         os.unlink(path)
---> 85     save (obj, path)
     86 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()
    241         except (AttributeError, RuntimeError, TypeError):
--> 242             _base_save(obj, filename, compress=compress)
    243     else:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()
    178 
--> 179     with open(filename, 'wb') as fobj:
    180         fobj.write(_base_dumps(obj, compress=compress))

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()
    179     with open(filename, 'wb') as fobj:
--> 180         fobj.write(_base_dumps(obj, compress=compress))
    181 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()
    256 
--> 257     gherkin = SagePickler.dumps(obj)
    258 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()
    835         pickler = cls(buf, **kwargs)
--> 836         pickler.dump(obj)
    837         return buf.getvalue()

TypeError: can't pickle dict_items objects

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()
    239         try:
--> 240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):

AttributeError: 'pGroupCohomology.resolution.RESL' object has no attribute 'save'

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3627)()
    239         try:
--> 240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):

AttributeError: 'dict_items' object has no attribute 'save'

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-3-d1c5c11acd7a> in <module>()
----> 1 H = CohomologyRing(Integer(8),Integer(3),from_scratch=True,options='debug')

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)
   1707             if q < 128:
   1708                 extras['websource'] = False
-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1710             return OUT
   1711 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)
   1246                 OUT = COHO(gap(KEY[0]), **extras)
   1247         else:
-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)
   1249         _gap_reset_random_seed()
   1250         try:

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InitSubgroups()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InsertSubgroup()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.make()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.next()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)
     83     if os.path.islink(path):
     84         os.unlink(path)
---> 85     save (obj, path)
     86 
     87 ###################################

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()
    240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):
--> 242             _base_save(obj, filename, compress=compress)
    243     else:
    244         # Saving an object to an image file.

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()
    177     filename = _normalize_filename(filename)
    178 
--> 179     with open(filename, 'wb') as fobj:
    180         fobj.write(_base_dumps(obj, compress=compress))
    181 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()
    178 
    179     with open(filename, 'wb') as fobj:
--> 180         fobj.write(_base_dumps(obj, compress=compress))
    181 
    182     return filename

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()
    255     """
    256 
--> 257     gherkin = SagePickler.dumps(obj)
    258 
    259     if compress:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()
    834         buf = io.BytesIO()
    835         pickler = cls(buf, **kwargs)
--> 836         pickler.dump(obj)
    837         return buf.getvalue()
    838 

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__reduce__()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__getstate__()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)
     83     if os.path.islink(path):
     84         os.unlink(path)
---> 85     save (obj, path)
     86 
     87 ###################################

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()
    240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):
--> 242             _base_save(obj, filename, compress=compress)
    243     else:
    244         # Saving an object to an image file.

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()
    177     filename = _normalize_filename(filename)
    178 
--> 179     with open(filename, 'wb') as fobj:
    180         fobj.write(_base_dumps(obj, compress=compress))
    181 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()
    178 
    179     with open(filename, 'wb') as fobj:
--> 180         fobj.write(_base_dumps(obj, compress=compress))
    181 
    182     return filename

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()
    255     """
    256 
--> 257     gherkin = SagePickler.dumps(obj)
    258 
    259     if compress:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()
    834         buf = io.BytesIO()
    835         pickler = cls(buf, **kwargs)
--> 836         pickler.dump(obj)
    837         return buf.getvalue()
    838 

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__reduce__()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.exportLifts()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.LIFTcontainer.export()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/auxiliaries.py in safe_save(obj, path)
     83     if os.path.islink(path):
     84         os.unlink(path)
---> 85     save (obj, path)
     86 
     87 ###################################

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.save (build/cythonized/sage/misc/persist.c:3694)()
    240             obj.save(filename=filename, compress=compress, **kwargs)
    241         except (AttributeError, RuntimeError, TypeError):
--> 242             _base_save(obj, filename, compress=compress)
    243     else:
    244         # Saving an object to an image file.

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3318)()
    177     filename = _normalize_filename(filename)
    178 
--> 179     with open(filename, 'wb') as fobj:
    180         fobj.write(_base_dumps(obj, compress=compress))
    181 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_save (build/cythonized/sage/misc/persist.c:3253)()
    178 
    179     with open(filename, 'wb') as fobj:
--> 180         fobj.write(_base_dumps(obj, compress=compress))
    181 
    182     return filename

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3898)()
    255     """
    256 
--> 257     gherkin = SagePickler.dumps(obj)
    258 
    259     if compress:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6613)()
    834         buf = io.BytesIO()
    835         pickler = cls(buf, **kwargs)
--> 836         pickler.dump(obj)
    837         return buf.getvalue()
    838 

TypeError: can't pickle dict_items objects
```
What are `dict_items`, and why can't they be pickled?



---

archive/issue_comments_446898.json:
```json
{
    "body": "<a id='comment:25'></a>\nIf d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).\n\nYou may need to wrap with list(d.items()) for pickling.",
    "created_at": "2019-08-29T13:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446898",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).

You may need to wrap with list(d.items()) for pickling.



---

archive/issue_comments_446899.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [chapoton](#comment%3A25):\n> If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).\n> \n> You may need to wrap with list(d.items()) for pickling.\n\n\nWouldn't that considerably slow things down, at least in Python-2? After all, `d.items()` is a list, and `list(...)` applied to a list creates a (shallow) copy of that list.",
    "created_at": "2019-08-29T21:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446899",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:26'></a>
Replying to [chapoton](#comment%3A25):
> If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).
> 
> You may need to wrap with list(d.items()) for pickling.


Wouldn't that considerably slow things down, at least in Python-2? After all, `d.items()` is a list, and `list(...)` applied to a list creates a (shallow) copy of that list.



---

archive/issue_comments_446900.json:
```json
{
    "body": "<a id='comment:27'></a>\nThere is a considerable progress now (after putting `list` around `.items()`):\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.set_workspace(tmp_dir())\nsage: H = CohomologyRing(8,3,from_scratch=True,options='debug')\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/2449/dir_dxt9xtpq/'\nComputing basic setup for Small Group number 1 of order 2\nComputing basic setup for Small Group number 2 of order 4\nComputing basic setup for Small Group number 3 of order 8\n> export action matrices\nInitialising maximal p-elementary abelian subgroups\nInserting SmallGroup(2,1) as a subgroup\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/2449/dir_dxt9xtpq/'\n> export action matrices\nComputing next term\n> rk P_02 =   1\nWe have to choose 1 new generator in degree 1\n> There is 1 Duflot regular generator in degree 1\nSummary: 0 relations and 1 generators in degree 1\nRing approximation computed out to degree 1!\nStoring approximation data\nDetermine degree 2 standard monomials\nWe got 1 standard monomials\nMonomial 0\n> Candidate: c_1_0^2\n> Express monomial as a Cochain\nCompute c_1_0*c_1_0\nCompose chain maps R_2 -> R_1 -> R_0\nLift with Urbild Groebner basis in degree 1\nload Urbild Groebner basis\nDecomposable cochain found\n\nThere is no new generator in degree 2\nSummary: 0 relations and 0 generators in degree 2\nRing approximation computed out to degree 2!\nStoring approximation data\nInserting SmallGroup(4,2) as a subgroup\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/2449/dir_dxt9xtpq/'\n> export action matrices\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-3-d1c5c11acd7a> in <module>()\n----> 1 H = CohomologyRing(Integer(8),Integer(3),from_scratch=True,options='debug')\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)\n   1707             if q < 128:\n   1708                 extras['websource'] = False\n-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1710             return OUT\n   1711 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)\n   1246                 OUT = COHO(gap(KEY[0]), **extras)\n   1247         else:\n-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)\n   1249         _gap_reset_random_seed()\n   1250         try:\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InitSubgroups()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InsertSubgroup()\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)\n   1707             if q < 128:\n   1708                 extras['websource'] = False\n-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1710             return OUT\n   1711 \n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)\n   1246                 OUT = COHO(gap(KEY[0]), **extras)\n   1247         else:\n-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)\n   1249         _gap_reset_random_seed()\n   1250         try:\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()\n\nKeyError: 'autoliftElAb'\n```\nThe good news is that for the first time cohomology rings were computed in py-3 (namely cohomology rings of elementary abelian groups).",
    "created_at": "2019-08-29T21:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446900",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:27'></a>
There is a considerable progress now (after putting `list` around `.items()`):

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.set_workspace(tmp_dir())
sage: H = CohomologyRing(8,3,from_scratch=True,options='debug')
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/2449/dir_dxt9xtpq/'
Computing basic setup for Small Group number 1 of order 2
Computing basic setup for Small Group number 2 of order 4
Computing basic setup for Small Group number 3 of order 8
> export action matrices
Initialising maximal p-elementary abelian subgroups
Inserting SmallGroup(2,1) as a subgroup
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/2449/dir_dxt9xtpq/'
> export action matrices
Computing next term
> rk P_02 =   1
We have to choose 1 new generator in degree 1
> There is 1 Duflot regular generator in degree 1
Summary: 0 relations and 1 generators in degree 1
Ring approximation computed out to degree 1!
Storing approximation data
Determine degree 2 standard monomials
We got 1 standard monomials
Monomial 0
> Candidate: c_1_0^2
> Express monomial as a Cochain
Compute c_1_0*c_1_0
Compose chain maps R_2 -> R_1 -> R_0
Lift with Urbild Groebner basis in degree 1
load Urbild Groebner basis
Decomposable cochain found

There is no new generator in degree 2
Summary: 0 relations and 0 generators in degree 2
Ring approximation computed out to degree 2!
Storing approximation data
Inserting SmallGroup(4,2) as a subgroup
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/2449/dir_dxt9xtpq/'
> export action matrices
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-3-d1c5c11acd7a> in <module>()
----> 1 H = CohomologyRing(Integer(8),Integer(3),from_scratch=True,options='debug')

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)
   1707             if q < 128:
   1708                 extras['websource'] = False
-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1710             return OUT
   1711 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)
   1246                 OUT = COHO(gap(KEY[0]), **extras)
   1247         else:
-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)
   1249         _gap_reset_random_seed()
   1250         try:

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InitSubgroups()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.InsertSubgroup()

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in __call__(self, *args, **kwds)
   1707             if q < 128:
   1708                 extras['websource'] = False
-> 1709             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1710             return OUT
   1711 

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/factory.py in _get_p_group_from_scratch(self, KEY, q, GStem, GroupName, **kwds)
   1246                 OUT = COHO(gap(KEY[0]), **extras)
   1247         else:
-> 1248             OUT = COHO(KEY[0],KEY[1], **extras)
   1249         _gap_reset_random_seed()
   1250         try:

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()

KeyError: 'autoliftElAb'
```
The good news is that for the first time cohomology rings were computed in py-3 (namely cohomology rings of elementary abelian groups).



---

archive/issue_comments_446901.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [SimonKing](#comment%3A26):\n> Replying to [chapoton](#comment%3A25):\n> > If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).\n> > \n> > You may need to wrap with list(d.items()) for pickling.\n\n> \n> Wouldn't that considerably slow things down, at least in Python-2? After all, `d.items()` is a list, and `list(...)` applied to a list creates a (shallow) copy of that list.\n\n\nYou could use a `try ... except` block to deal with the Python 2 case quickly. Sage will soon (I hope) default to Python 3, so I don't think this is worth it, though.",
    "created_at": "2019-08-29T22:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446901",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
Replying to [SimonKing](#comment%3A26):
> Replying to [chapoton](#comment%3A25):
> > If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).
> > 
> > You may need to wrap with list(d.items()) for pickling.

> 
> Wouldn't that considerably slow things down, at least in Python-2? After all, `d.items()` is a list, and `list(...)` applied to a list creates a (shallow) copy of that list.


You could use a `try ... except` block to deal with the Python 2 case quickly. Sage will soon (I hope) default to Python 3, so I don't think this is worth it, though.



---

archive/issue_comments_446902.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [SimonKing](#comment%3A27):\n> There is a considerable progress now (after putting `list` around `.items()`):\n> ...\n\n>{{{\n> KeyError: 'autoliftElAb'\n> }}}\n\n\nApparently I forgot to create a shallow copy in some places in which I temporarily stored the global options -- it doesn't work to recreate a dict from its items in Py-3, and that's why I got the key error above:\n\n```\nsage: D = {1:2}\nsage: I = D.items()\nsage: D.clear()\nsage: D.update(I)\nsage: D\n{}\n```\nIn Py-2, one would get\n\n```\nsage: D\n{1: 2}\n```",
    "created_at": "2019-08-30T12:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446902",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:29'></a>
Replying to [SimonKing](#comment%3A27):
> There is a considerable progress now (after putting `list` around `.items()`):
> ...

>{{{
> KeyError: 'autoliftElAb'
> }}}


Apparently I forgot to create a shallow copy in some places in which I temporarily stored the global options -- it doesn't work to recreate a dict from its items in Py-3, and that's why I got the key error above:

```
sage: D = {1:2}
sage: I = D.items()
sage: D.clear()
sage: D.update(I)
sage: D
{}
```
In Py-2, one would get

```
sage: D
{1: 2}
```



---

archive/issue_comments_446903.json:
```json
{
    "body": "<a id='comment:30'></a>\nHooray!\n\nI am now in a position to completely compute `CohomologyRing(8,3)` from scratch. Unfortunately reading old data doesn't work yet, but certainly it is a progress :-)",
    "created_at": "2019-08-30T12:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446903",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:30'></a>
Hooray!

I am now in a position to completely compute `CohomologyRing(8,3)` from scratch. Unfortunately reading old data doesn't work yet, but certainly it is a progress :-)



---

archive/issue_comments_446904.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [SimonKing](#comment%3A12):\n> \n> ```\n> import six\n> ```\n\n\nPlease don't do this in Cython files. There is almost never a reason to use `six` in Cython since Cython handles most of the Python 2/3 incompatibilities for you.",
    "created_at": "2019-08-30T13:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446904",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replying to [SimonKing](#comment%3A12):
> 
> ```
> import six
> ```


Please don't do this in Cython files. There is almost never a reason to use `six` in Cython since Cython handles most of the Python 2/3 incompatibilities for you.



---

archive/issue_comments_446905.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [SimonKing](#comment%3A26):\n> Replying to [chapoton](#comment%3A25):\n> > If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).\n> > \n> > You may need to wrap with list(d.items()) for pickling.\n\n> \n> Wouldn't that considerably slow things down, at least in Python-2?\n\n\nUse `list(d.iteritems())` in Cython.",
    "created_at": "2019-08-30T13:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446905",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Replying to [SimonKing](#comment%3A26):
> Replying to [chapoton](#comment%3A25):
> > If d is a dict, then d.items() is no longer a list, but a view (some special kind of iterable).
> > 
> > You may need to wrap with list(d.items()) for pickling.

> 
> Wouldn't that considerably slow things down, at least in Python-2?


Use `list(d.iteritems())` in Cython.



---

archive/issue_comments_446906.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [jdemeyer](#comment%3A31):\n> Replying to [SimonKing](#comment%3A12):\n> > \n> > ```\n> > import six\n> > ```\n\n> \n> Please don't do this in Cython files. There is almost never a reason to use `six` in Cython since Cython handles most of the Python 2/3 incompatibilities for you.\n\n\nI am not dealing with incompatibilities in that case. I import six in order to be able to safely test for string types. How to, if I don't use six?",
    "created_at": "2019-08-30T13:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446906",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:33'></a>
Replying to [jdemeyer](#comment%3A31):
> Replying to [SimonKing](#comment%3A12):
> > 
> > ```
> > import six
> > ```

> 
> Please don't do this in Cython files. There is almost never a reason to use `six` in Cython since Cython handles most of the Python 2/3 incompatibilities for you.


I am not dealing with incompatibilities in that case. I import six in order to be able to safely test for string types. How to, if I don't use six?



---

archive/issue_comments_446907.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A32):\n> Use `list(d.iteritems())` in Cython.\n\n\nWould this also work fast if Cython doesn't know that d is a dict? Should I do\n`list(<dict>(self._D).iteritems())`, for instance?",
    "created_at": "2019-08-30T13:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446907",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A32):
> Use `list(d.iteritems())` in Cython.


Would this also work fast if Cython doesn't know that d is a dict? Should I do
`list(<dict>(self._D).iteritems())`, for instance?



---

archive/issue_comments_446908.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [SimonKing](#comment%3A33):\n> I import six in order to be able to safely test for string types. How to, if I don't use six?\n\n\nFirst of all, you should check whether you really need to test for \"string types\". Can you use duck typing instead? If for some reason, duck typing is hard, then it depends what you mean precisely with \"string types\".\n\nSince you were mentioning filenames: `isinstance(s, (bytes, unicode))` are valid types for filenames both in Python 2 and Python 3. Note that Python 3 also has https://docs.python.org/3/library/pathlib.html, a custom class to deal specifically with filenames.",
    "created_at": "2019-08-30T15:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446908",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Replying to [SimonKing](#comment%3A33):
> I import six in order to be able to safely test for string types. How to, if I don't use six?


First of all, you should check whether you really need to test for "string types". Can you use duck typing instead? If for some reason, duck typing is hard, then it depends what you mean precisely with "string types".

Since you were mentioning filenames: `isinstance(s, (bytes, unicode))` are valid types for filenames both in Python 2 and Python 3. Note that Python 3 also has https://docs.python.org/3/library/pathlib.html, a custom class to deal specifically with filenames.



---

archive/issue_comments_446909.json:
```json
{
    "body": "Pickle that isn't readable in Python-3",
    "created_at": "2019-09-01T22:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446909",
    "user": "https://github.com/simon-king-jena"
}
```

Pickle that isn't readable in Python-3



---

archive/attachments_021261.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "State.sobj",
    "asset_url": "tarball://root/attachments/some-uuid/ticket28414/State.sobj",
    "created_at": "2019-09-01T23:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.sobj",
    "user": "https://github.com/simon-king-jena"
}
```



---

archive/issue_comments_446910.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> I can get the package to build, but it doesn't work yet. An illustration of one problem:\n> \n> ```\n> sage: load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')\n> ... \n> UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n> ```\n\n\nI tried to track down that problem, and currently it seems to me that it is due to a very bad backwards incompatibility in Python. You can reproduce it as follows:\n- Download attachment:State.sobj\n- Install the optional meataxe spkg (this may involve `sage -b`, so that some optional module in the Sage library is built)\n- Define some unpickle helper:\n\n  ```\n  sage: from sage.matrix.matrix_gfpn_dense import mtx_unpickle\n  sage: class unpickle_old_mtx:\n  ....:     def __call__(self, *args, **kwds):\n  ....:         return mtx_unpickle(*args, **kwds)\n  ....:     \n  sage: register_unpickle_override('pGroupCohomology.mtx', 'MTX_unpickle_class', unpickle_old_mtx)\n  ```\n\nNow, in Sage-with-Py-2, loading the file works:\n\n```\nsage: X = load('/home/king/Projekte/coho/tests/State.sobj')\nsage: X\n([[1,\n   [(2, 1),\n    [\n[1 0 0 0 0 0 0 0]                                                                                                                   \n[0 0 0 1 1 1 1 1], [[1 0 0 0 0 0 0 0], '/home/king/SPKG/database/8gp3/sgp/8gp3sg1_1', '/home/king/SPKG/database/8gp3/sgp/8gp3sg1_2']\n]]],\n  [2,\n   [(4, 2),\n    [\n[1 0 0 0 0 0 0 0]                                                                                                                   \n[0 0 0 1 1 1 1 1]                                                                                                                   \n[0 1 0 0 0 0 0 0]                                                                                                                   \n[0 0 0 0 0 1 0 1], [[1 0 0 0 0 0 0 0], '/home/king/SPKG/database/8gp3/sgp/8gp3sg2_1', '/home/king/SPKG/database/8gp3/sgp/8gp3sg2_2']\n]]],\n  [3,\n   [(4, 2),\n    [\n[1 0 0 0 0 0 0 0]                                                                                                                   \n[0 0 0 1 1 1 1 1]                                                                                                                   \n[0 0 1 0 0 0 0 0]                                                                                                                   \n[0 0 0 0 0 0 1 1], [[1 0 0 0 0 0 0 0], '/home/king/SPKG/database/8gp3/sgp/8gp3sg3_1', '/home/king/SPKG/database/8gp3/sgp/8gp3sg3_2']\n]]]],\n [2, 1, 1],\n 1,\n 1,\n '8gp3/',\n ['b_1_0*b_1_1'],\n '8gp3/dat/',\n [((4, 2), '/home/king/.sage/pGroupCohomology/db/4gp2/H4gp2'),\n  ((2, 1), '/home/king/.sage/pGroupCohomology/db/2gp1/H2gp1')],\n '8gp3/dat/',\n [],\n '8gp3/sgp/',\n 2,\n [2, 3],\n [2, 2],\n 2,\n 2,\n ['b_1_0*b_1_1'],\n [[2, 'c_2_2', [0 0 1], 1, 0],\n  [1, 'b_1_0', [1 0], 0, 0],\n  [1, 'b_1_1', [0 1], 0, 0]],\n [[0, [['1', ['1']]]],\n  [1, [['b_1_0', ['b_1_0']], ['b_1_1', ['b_1_1']]]],\n  [2,\n   [['c_2_2', ['c_2_2']],\n    ['b_1_0', ['b_1_0^2']],\n    ['b_1_1', ['b_1_0*b_1_1', 'b_1_1^2']]]]],\n {},\n 0.24,\n True,\n 'Monomials',\n 2,\n None,\n '',\n 0,\n '8gp3',\n '8gp3/dat/R8gp3.sobj',\n 1,\n ['0'],\n ['b_1_0 + b_1_1'],\n None,\n [('_max_module_deg', 0),\n  ('sgpDickson', [((4, 2), [[1, 'c_1_1', [0 1]]])]),\n  ('useFactorization', True),\n  ('useElimination', False),\n  ('GroupDescr', 'Dihedral group of order 8'),\n  ('_key', ((8, 3), '/home/king/SPKG/database/8gp3/dat/State')),\n  ('auto', 4),\n  ('Restriction_2', ['c_1_0*c_1_1+c_1_0^2', 'c_1_1', '0']),\n  ('GroupName', 'D8'),\n  ('DicksonExp', 3),\n  ('_parameters_do_exist', True),\n  ('KeepBases', None),\n  ('completeGroebner', True),\n  ('_SymondsTestdata', ['c_2_2', 'b_1_1', 'b_1_0']),\n  ('_parameters_for_criterion', ['c_2_2', 'b_1_1', 'b_1_0']),\n  ('root', '/home/king/SPKG/database/'),\n  ('Restriction_3', ['c_1_0*c_1_1+c_1_0^2', '0', 'c_1_1']),\n  ('_method', 'Symonds')],\n [(('dependent_parameters',), [['c_2_2', 'b_1_1', 'b_1_0'], 2])])\n```\nHowever, Sage-with-Py-3 yields the error found by John:\n\n```\nsage: X = load('/home/king/Projekte/coho/tests/State.sobj')\n---------------------------------------------------------------------------\nUnicodeDecodeError                        Traceback (most recent call last)\n<ipython-input-4-74e7e91f9969> in <module>()\n----> 1 X = load('/home/king/Projekte/coho/tests/State.sobj')\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()\n    149 \n    150     ## Load file by absolute filename\n--> 151     with open(filename, 'rb') as fobj:\n    152         X = loads(fobj.read(), compress=compress)\n    153     try:\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()\n    150     ## Load file by absolute filename\n    151     with open(filename, 'rb') as fobj:\n--> 152         X = loads(fobj.read(), compress=compress)\n    153     try:\n    154         X._default_filename = os.path.abspath(filename)\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()\n    967 \n    968     unpickler = SageUnpickler(io.BytesIO(s))\n--> 969     return unpickler.load()\n    970 \n    971 \n\nUnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n```\n\nAnd the point is: Python-3 even is unable to read the pickle file as a string! In Python-2, reading the file is no problem at all.\n\n```\nking@klap:~$ ~/Sage/git/py3/sage -python\nPython 3.7.3 (default, Aug 27 2019, 23:22:23) \n[GCC 5.4.0 20160609] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> f = open('/home/king/Projekte/coho/tests/State.sobj')\n>>> f.read()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/home/king/Sage/git/py3/local/lib/python3.7/codecs.py\", line 322, in decode\n    (result, consumed) = self._buffer_decode(data, self.errors, final)\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0x9c in position 1: invalid start byte\n>>> \nking@klap:~$ ~/Sage/git/sage/sage --python\nPython 2.7.15 (default, Jul 26 2019, 11:49:43) \n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> f = open('/home/king/Projekte/coho/tests/State.sobj')\n>>> f.read()\n'x\\x9c\\x95U\\x8bZ\\x1bE\\x14&!\\x91\\x92J\\x8b\\x82V\\xbc\\x94x\\xedXl\\x96\\x04\\xaah\\x95B\\x0b\\x05]\\xc1\\x16\\x18\\xad\\x97\\xe9:\\xd9\\x1dv\\xb7d3{v7\\nU,^\\xd8B\\xbd\\xd6\\xfb\\xfd\\xae\\xcf\\xd0\\xa7\\xf0E|\\t\\xcfl\\xb2\\x08\\xf5\\xab_I\\xbe\\x9d\\xefd\\xe6?\\xe7\\xfc\\xe7?g6kY\\xc2 \\x83O\\x96\\xe8\\x19\\x06\\xed\\xc4\\x0c\\xb9-J\\x81[\\xb7\\xc3\\x92[\\x8f\\x84-\\x82\\x82\\xc7\\x97\\x84\\x91\\xfe\\x80\\x1c\\xcdT\\xd6\\xe7 \\xef\\xa0QF\\xe3\\xa6\\x18:\\x18\\xec!\\xc4\\xf4\\xa7\\x02\\xd9\\xf0OJGz\\xb2&\\xed\\x95\\x92\\x17-\\x17f\\x16\\xce\\x1a\\x8d\\xba\\xef\\x9aK5a\\x985\\x1e\\x86\\x05\\xe8\\x94PX\\x85\\xbd\\xf4\\x80a\\x84|Q\\x18\\x8b2H1\\x98\\xd80\\xe0\\xe6\\x8d\\xb0J\\xf4,~\\xf7\\xd0\\xecZ\\xffF4\\x07]\\x0c\\xf6\\x11\\xa7\\xa0v3\\xb8\\x9bY\\xdb\\xc4\\xcd\\xfdt@\\xc3lB[B?m\\xfe\\xb4>\\xa5Y<\\xe2U\\x1e\\nm\\xc4\\xf6\\x87\\xb4\\xd0\\xf6\\x13#\\xb4\\xcbF\\x19\\xbaw\\x03\\xaf\\xc0-\\x02?\\x0cn\\xc5\\x9c\\x0cz\\x88*x\\x18\\x0b\\xeeuZ\\x12\\xdc\\x16\\xc3\\xed\\x0c\\x0e\\xb4X\\xe5\\x90Un\\xad\\x7f,\\xaf\\xd8\\xde\\xc1\\xa0\\xef?l\\xef\\xbc\\xf1\\xf4\\x15d{\\xd7n\\xe0\\x15\\xb8\\xbb\\xc9\\xf6\\x1e\\xa2\\xb738\\xb8\\xc5\\xb6?e[\\x8c\\xe1^\\x06\\xf7\\xedd[lWl\\xefg\\xf0\\x00qvAo\\x08\\xe9=\\xb8\\x1bx\\x05\\x1e\\x12M~\\x87\\x9a\\x9adD:?$5\\x1e\\xa6\\xf9\\xc4\\x8f\\xc1a\\xba\\xb7j\\x94\\x8d\\xc1\\xc3j-\\xc3\\x00\\xa7\\x9d\\xc9\\t\\xc6\\xc7\\xd3G\\x88\\xd3\\xeb\\xa0\\xf6G\\xa8\\xb6\\x8d@I\\r\\xaev\\xed\\x08jVU\\x1b\\xb6\\xfd\\x8a6\\xad\\xd6\\x18JN\\xde\\xc1\\x81\\xd5n\\xd0\\xb5b\\xfbemZ\\xad1\\x0c\\x8a\\xed,Z\\xb6\\xaaQMG\\x99\\xa42W\\x941\\x84\\xc6\\x10\\x16;\\xbc\\xb5}45\\x1e\\x15\\xceQ\\xe5\\xf1\\xd8\\xce\\x1aG8\\x83\\xc7\\xf1\\x1e>\\x81\\xf2\\xd0\\xbci\\xa8\\x8e\\x1eK\\x07\\xa8\\x9df\\x8aj\\x80\\x9eD\\xbb\\r\\xc3>\\x85\\x97\\x95\\xe6\\x13w\\x18MA\\xd9\\xd6\\x94\\x1d\\xd7\\xdb\\x12\\xd0\\xd8\\x16\\xa8\\x0c\\xe3\\xdb@c\\nt\"\\x01!\\xea$\\xe6\\x9c z\\x1b\\x83I\\x06\\xa7\\x08v\\x82\\xc1\\x14\\xae\\\\p<\\x9dN\\xde\\nO#\\xe6\\x19\\xe2\\x8c2\\xd0\\xd3\\xac\\xcf\\xaa\\xd3\\x19\\xe2\\x8c3\\x98M\\x93<\\xc7\\x93\\x06\\x9fN\\xae\\xcb\\x19\\xf4\\x99#\\xce1\\x06\\xf3i9\\x0b\\xca\\x87\\x924\\xc4\\xf3\\x0c^\\xa0\\x1d\\x89}\\xae\\x02g\\xd5\\xe1\\x8b$\\x8d\\xf5\\x12\\x83\\x97\\xc9N\\x85^i\\x82\\xcb\\x08f\\xc9,\\xad\\xc2\\xb9\\xa9\\xe3\\x7f]=\\xf3\\xf7\\xfa\\xc1\\xab\\x1b\\xb4sF\\xd6\\xa5\\xe7\\xf2Z\\x08F\\xaa\\xf5\\xab\\xb3\\x14\\xcb\\xa49\\xd5*\\xe0\\xb4g\\xab}s\\xca*\\x85\\xb2z^\\xd5W\\xa5\\x99A\\x94\\xdf\\xa4]I\\xbe\\xe2@\\xb1\\x99\\xd1\\xe2\\xb3\\x0c\\x04\\xa1\\xfb\\r\\x8f/\\x1b\\x9e\\xb4\\x1a\\xf8\\n\\xb3\\x84\\r\\x8b*\\xc1 &\\xb0cph\\x01\\x87`\\x02\\xdf]\\xa1\\xac\\x83\\xcb\\xe0\\xbcs\\x84\\xc1\\x12\\x83Z\\xa2\\xbf\\x99D\\xf2\\xae\\xd5\\xbf.x\\x0c\\x12\\x1f\\x9fv7Bq\\x8a\\x9b\\x91\\x0c\\xdc\\x0b<r1\\x08l\\xc4\\x10\\xd0}\\xb8?Ys=\\xb7\\xde\\xdc\\r7c\\x88h!\\x99\\xd2\\t\\x11\\x9a\\x014h\\xdf\\x84\\xeb\\x08+\\xe0\\xb5\\xa2\\xad\\xb6\\x8br\\xb1(\\x03K\\x04\\xc5\\x11x-\\x86\\xd7i\\xceX\\x12+\\xb0\\xac\\xe8\\x8e \\xdd\\x95t6/\\xc4\\xf0\\x06=\\xf4\\xff\\xd7W\\xe94\\x1f\\xf1H\\xc4\\xf0f\\x0c\\xab4\\xc7\\x1b\\x91\\x84\\xb7\\xf4\\\\\\x0c\\x17i\\xd7\\x9c\\x08\\xa3\\xc05\\x153l\\xed\\x1a\\x83\\xb7\\t\\xed1\\x93v%%\\x0f\\x98\\xad\\xc6\\xbe\\x93j\\xf0.J\\x86\\xb1\\xde\\xa3\\x9dI\\t\\xb3\\xdc\\x13\\xb0N\\xb3\\x13#\\x10\\xc7p\\x89\\x16Z\\x12N.\\xfb\\xb0\\xa1\\xb7\\xc7\\xb0I{\\r\\x9f\\x07\\x08\\x8bD\\x10\\x1a\\x964\\xc4\\xb2\\x1bFp\\x19\\xd5y\\x9fv\\xeaB\\xf8\\'\\x90l\\x08\\x1f\\xcc\\xc6\\xf0!\\xed6\\xa5\\xe7\\xd7\\x10\\x8b\\xd1E\\xb5.\\x02\\xf8\\x08\\x81\\x1f\\xd3nc~\\xc5\\x93u+\\\\@\\xc6\\xaaB\\xf8\\x84\\xc1\\x15\\x9cLg\\xdc\\x19E>\\x9f\\xd2\\xbe\\xedi\\xd4_\\x91\\x19\\xb8h+\\xcd?c\\xf0\\xf9\\xbf\\xd0/h.\\x902\\x82/i\\xdfu\\xa5\\x83\\xafb\\xf8z\\xa7<C\\xf0\\r\\x83o\\xaf#\\xcfw\\xa8J\\xaa\\xd0\\xf7\\x98\\xe3\\x07\\xdaa \\x15GZ\\xf0#\\xedhQ\\x87\\x9fb\\xf8\\x19\\xef\\xc7/\\xb4\\xd7\\x12\\xbe\\xa8[\\xa2\\x1em#\\r\\xbf\\xae\\xc3o\\x0c~\\'\\xce\\x15=\\x8b1\\xfe\\xe0\\x11\\xfcY\\xfa\\x07\\x14\\x1f\\x95\\xac'\n```",
    "created_at": "2019-09-01T23:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446910",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:36'></a>
Replying to [jhpalmieri](#comment%3A4):
> I can get the package to build, but it doesn't work yet. An illustration of one problem:
> 
> ```
> sage: load('/Users/palmieri/.sage/pGroupCohomology/db/8gp3/H8gp3.sobj')
> ... 
> UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)
> ```


I tried to track down that problem, and currently it seems to me that it is due to a very bad backwards incompatibility in Python. You can reproduce it as follows:
- Download attachment:State.sobj
- Install the optional meataxe spkg (this may involve `sage -b`, so that some optional module in the Sage library is built)
- Define some unpickle helper:

  ```
  sage: from sage.matrix.matrix_gfpn_dense import mtx_unpickle
  sage: class unpickle_old_mtx:
  ....:     def __call__(self, *args, **kwds):
  ....:         return mtx_unpickle(*args, **kwds)
  ....:     
  sage: register_unpickle_override('pGroupCohomology.mtx', 'MTX_unpickle_class', unpickle_old_mtx)
  ```

Now, in Sage-with-Py-2, loading the file works:

```
sage: X = load('/home/king/Projekte/coho/tests/State.sobj')
sage: X
([[1,
   [(2, 1),
    [
[1 0 0 0 0 0 0 0]                                                                                                                   
[0 0 0 1 1 1 1 1], [[1 0 0 0 0 0 0 0], '/home/king/SPKG/database/8gp3/sgp/8gp3sg1_1', '/home/king/SPKG/database/8gp3/sgp/8gp3sg1_2']
]]],
  [2,
   [(4, 2),
    [
[1 0 0 0 0 0 0 0]                                                                                                                   
[0 0 0 1 1 1 1 1]                                                                                                                   
[0 1 0 0 0 0 0 0]                                                                                                                   
[0 0 0 0 0 1 0 1], [[1 0 0 0 0 0 0 0], '/home/king/SPKG/database/8gp3/sgp/8gp3sg2_1', '/home/king/SPKG/database/8gp3/sgp/8gp3sg2_2']
]]],
  [3,
   [(4, 2),
    [
[1 0 0 0 0 0 0 0]                                                                                                                   
[0 0 0 1 1 1 1 1]                                                                                                                   
[0 0 1 0 0 0 0 0]                                                                                                                   
[0 0 0 0 0 0 1 1], [[1 0 0 0 0 0 0 0], '/home/king/SPKG/database/8gp3/sgp/8gp3sg3_1', '/home/king/SPKG/database/8gp3/sgp/8gp3sg3_2']
]]]],
 [2, 1, 1],
 1,
 1,
 '8gp3/',
 ['b_1_0*b_1_1'],
 '8gp3/dat/',
 [((4, 2), '/home/king/.sage/pGroupCohomology/db/4gp2/H4gp2'),
  ((2, 1), '/home/king/.sage/pGroupCohomology/db/2gp1/H2gp1')],
 '8gp3/dat/',
 [],
 '8gp3/sgp/',
 2,
 [2, 3],
 [2, 2],
 2,
 2,
 ['b_1_0*b_1_1'],
 [[2, 'c_2_2', [0 0 1], 1, 0],
  [1, 'b_1_0', [1 0], 0, 0],
  [1, 'b_1_1', [0 1], 0, 0]],
 [[0, [['1', ['1']]]],
  [1, [['b_1_0', ['b_1_0']], ['b_1_1', ['b_1_1']]]],
  [2,
   [['c_2_2', ['c_2_2']],
    ['b_1_0', ['b_1_0^2']],
    ['b_1_1', ['b_1_0*b_1_1', 'b_1_1^2']]]]],
 {},
 0.24,
 True,
 'Monomials',
 2,
 None,
 '',
 0,
 '8gp3',
 '8gp3/dat/R8gp3.sobj',
 1,
 ['0'],
 ['b_1_0 + b_1_1'],
 None,
 [('_max_module_deg', 0),
  ('sgpDickson', [((4, 2), [[1, 'c_1_1', [0 1]]])]),
  ('useFactorization', True),
  ('useElimination', False),
  ('GroupDescr', 'Dihedral group of order 8'),
  ('_key', ((8, 3), '/home/king/SPKG/database/8gp3/dat/State')),
  ('auto', 4),
  ('Restriction_2', ['c_1_0*c_1_1+c_1_0^2', 'c_1_1', '0']),
  ('GroupName', 'D8'),
  ('DicksonExp', 3),
  ('_parameters_do_exist', True),
  ('KeepBases', None),
  ('completeGroebner', True),
  ('_SymondsTestdata', ['c_2_2', 'b_1_1', 'b_1_0']),
  ('_parameters_for_criterion', ['c_2_2', 'b_1_1', 'b_1_0']),
  ('root', '/home/king/SPKG/database/'),
  ('Restriction_3', ['c_1_0*c_1_1+c_1_0^2', '0', 'c_1_1']),
  ('_method', 'Symonds')],
 [(('dependent_parameters',), [['c_2_2', 'b_1_1', 'b_1_0'], 2])])
```
However, Sage-with-Py-3 yields the error found by John:

```
sage: X = load('/home/king/Projekte/coho/tests/State.sobj')
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-4-74e7e91f9969> in <module>()
----> 1 X = load('/home/king/Projekte/coho/tests/State.sobj')

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2824)()
    149 
    150     ## Load file by absolute filename
--> 151     with open(filename, 'rb') as fobj:
    152         X = loads(fobj.read(), compress=compress)
    153     try:

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2774)()
    150     ## Load file by absolute filename
    151     with open(filename, 'rb') as fobj:
--> 152         X = loads(fobj.read(), compress=compress)
    153     try:
    154         X._default_filename = os.path.abspath(filename)

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()
    967 
    968     unpickler = SageUnpickler(io.BytesIO(s))
--> 969     return unpickler.load()
    970 
    971 

UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)
```

And the point is: Python-3 even is unable to read the pickle file as a string! In Python-2, reading the file is no problem at all.

```
king@klap:~$ ~/Sage/git/py3/sage -python
Python 3.7.3 (default, Aug 27 2019, 23:22:23) 
[GCC 5.4.0 20160609] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> f = open('/home/king/Projekte/coho/tests/State.sobj')
>>> f.read()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/king/Sage/git/py3/local/lib/python3.7/codecs.py", line 322, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0x9c in position 1: invalid start byte
>>> 
king@klap:~$ ~/Sage/git/sage/sage --python
Python 2.7.15 (default, Jul 26 2019, 11:49:43) 
[GCC 5.4.0 20160609] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> f = open('/home/king/Projekte/coho/tests/State.sobj')
>>> f.read()
'x\x9c\x95U\x8bZ\x1bE\x14&!\x91\x92J\x8b\x82V\xbc\x94x\xedXl\x96\x04\xaah\x95B\x0b\x05]\xc1\x16\x18\xad\x97\xe9:\xd9\x1dv\xb7d3{v7\nU,^\xd8B\xbd\xd6\xfb\xfd\xae\xcf\xd0\xa7\xf0E|\t\xcfl\xb2\x08\xf5\xab_I\xbe\x9d\xefd\xe6?\xe7\xfc\xe7?g6kY\xc2 \x83O\x96\xe8\x19\x06\xed\xc4\x0c\xb9-J\x81[\xb7\xc3\x92[\x8f\x84-\x82\x82\xc7\x97\x84\x91\xfe\x80\x1c\xcdT\xd6\xe7 \xef\xa0QF\xe3\xa6\x18:\x18\xec!\xc4\xf4\xa7\x02\xd9\xf0OJGz\xb2&\xed\x95\x92\x17-\x17f\x16\xce\x1a\x8d\xba\xef\x9aK5a\x985\x1e\x86\x05\xe8\x94PX\x85\xbd\xf4\x80a\x84|Q\x18\x8b2H1\x98\xd80\xe0\xe6\x8d\xb0J\xf4,~\xf7\xd0\xecZ\xffF4\x07]\x0c\xf6\x11\xa7\xa0v3\xb8\x9bY\xdb\xc4\xcd\xfdt@\xc3lB[B?m\xfe\xb4>\xa5Y<\xe2U\x1e\nm\xc4\xf6\x87\xb4\xd0\xf6\x13#\xb4\xcbF\x19\xbaw\x03\xaf\xc0-\x02?\x0cn\xc5\x9c\x0cz\x88*x\x18\x0b\xeeuZ\x12\xdc\x16\xc3\xed\x0c\x0e\xb4X\xe5\x90Un\xad\x7f,\xaf\xd8\xde\xc1\xa0\xef?l\xef\xbc\xf1\xf4\x15d{\xd7n\xe0\x15\xb8\xbb\xc9\xf6\x1e\xa2\xb738\xb8\xc5\xb6?e[\x8c\xe1^\x06\xf7\xedd[lWl\xefg\xf0\x00qvAo\x08\xe9=\xb8\x1bx\x05\x1e\x12M~\x87\x9a\x9adD:?$5\x1e\xa6\xf9\xc4\x8f\xc1a\xba\xb7j\x94\x8d\xc1\xc3j-\xc3\x00\xa7\x9d\xc9\t\xc6\xc7\xd3G\x88\xd3\xeb\xa0\xf6G\xa8\xb6\x8d@I\r\xaev\xed\x08jVU\x1b\xb6\xfd\x8a6\xad\xd6\x18JN\xde\xc1\x81\xd5n\xd0\xb5b\xfbemZ\xad1\x0c\x8a\xed,Z\xb6\xaaQMG\x99\xa42W\x941\x84\xc6\x10\x16;\xbc\xb5}45\x1e\x15\xceQ\xe5\xf1\xd8\xce\x1aG8\x83\xc7\xf1\x1e>\x81\xf2\xd0\xbci\xa8\x8e\x1eK\x07\xa8\x9df\x8aj\x80\x9eD\xbb\r\xc3>\x85\x97\x95\xe6\x13w\x18MA\xd9\xd6\x94\x1d\xd7\xdb\x12\xd0\xd8\x16\xa8\x0c\xe3\xdb@c\nt"\x01!\xea$\xe6\x9c z\x1b\x83I\x06\xa7\x08v\x82\xc1\x14\xae\\p<\x9dN\xde\nO#\xe6\x19\xe2\x8c2\xd0\xd3\xac\xcf\xaa\xd3\x19\xe2\x8c3\x98M\x93<\xc7\x93\x06\x9fN\xae\xcb\x19\xf4\x99#\xce1\x06\xf3i9\x0b\xca\x87\x924\xc4\xf3\x0c^\xa0\x1d\x89}\xae\x02g\xd5\xe1\x8b$\x8d\xf5\x12\x83\x97\xc9N\x85^i\x82\xcb\x08f\xc9,\xad\xc2\xb9\xa9\xe3\x7f]=\xf3\xf7\xfa\xc1\xab\x1b\xb4sF\xd6\xa5\xe7\xf2Z\x08F\xaa\xf5\xab\xb3\x14\xcb\xa49\xd5*\xe0\xb4g\xab}s\xca*\x85\xb2z^\xd5W\xa5\x99A\x94\xdf\xa4]I\xbe\xe2@\xb1\x99\xd1\xe2\xb3\x0c\x04\xa1\xfb\r\x8f/\x1b\x9e\xb4\x1a\xf8\n\xb3\x84\r\x8b*\xc1 &\xb0cph\x01\x87`\x02\xdf]\xa1\xac\x83\xcb\xe0\xbcs\x84\xc1\x12\x83Z\xa2\xbf\x99D\xf2\xae\xd5\xbf.x\x0c\x12\x1f\x9fv7Bq\x8a\x9b\x91\x0c\xdc\x0b<r1\x08l\xc4\x10\xd0}\xb8?Ys=\xb7\xde\xdc\r7c\x88h!\x99\xd2\t\x11\x9a\x014h\xdf\x84\xeb\x08+\xe0\xb5\xa2\xad\xb6\x8br\xb1(\x03K\x04\xc5\x11x-\x86\xd7i\xceX\x12+\xb0\xac\xe8\x8e \xdd\x95t6/\xc4\xf0\x06=\xf4\xff\xd7W\xe94\x1f\xf1H\xc4\xf0f\x0c\xab4\xc7\x1b\x91\x84\xb7\xf4\\\x0c\x17i\xd7\x9c\x08\xa3\xc05\x153l\xed\x1a\x83\xb7\t\xed1\x93v%%\x0f\x98\xad\xc6\xbe\x93j\xf0.J\x86\xb1\xde\xa3\x9dI\t\xb3\xdc\x13\xb0N\xb3\x13#\x10\xc7p\x89\x16Z\x12N.\xfb\xb0\xa1\xb7\xc7\xb0I{\r\x9f\x07\x08\x8bD\x10\x1a\x964\xc4\xb2\x1bFp\x19\xd5y\x9fv\xeaB\xf8\'\x90l\x08\x1f\xcc\xc6\xf0!\xed6\xa5\xe7\xd7\x10\x8b\xd1E\xb5.\x02\xf8\x08\x81\x1f\xd3nc~\xc5\x93u+\\@\xc6\xaaB\xf8\x84\xc1\x15\x9cLg\xdc\x19E>\x9f\xd2\xbe\xedi\xd4_\x91\x19\xb8h+\xcd?c\xf0\xf9\xbf\xd0/h.\x902\x82/i\xdfu\xa5\x83\xafb\xf8z\xa7<C\xf0\r\x83o\xaf#\xcfw\xa8J\xaa\xd0\xf7\x98\xe3\x07\xdaa \x15GZ\xf0#\xedhQ\x87\x9fb\xf8\x19\xef\xc7/\xb4\xd7\x12\xbe\xa8[\xa2\x1em#\r\xbf\xae\xc3o\x0c~\'\xce\x15=\x8b1\xfe\xe0\x11\xfcY\xfa\x07\x14\x1f\x95\xac'
```



---

archive/issue_comments_446911.json:
```json
{
    "body": "<a id='comment:37'></a>\nThis works fine in python3:\n\n```\nsage: with open('State.sobj', 'rb') as f:\n....:     f.read()\n```",
    "created_at": "2019-09-02T07:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446911",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>
This works fine in python3:

```
sage: with open('State.sobj', 'rb') as f:
....:     f.read()
```



---

archive/issue_comments_446912.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [chapoton](#comment%3A37):\n> This works fine in python3:\n> \n> ```\n> sage: with open('State.sobj', 'rb') as f:\n> ....:     f.read()\n> ```\n\n\nDo I understand that it works because `b` means \"binary\"? But of course the real question is why Python 3 cannot unpickle from that file.\n\nI tried to dig a bit deeper into Sage's `load` function (I guess the error is hidden there), and indeed `load()` uses `with open(filename, 'rb') as fobj:`. So, the unpickling problem is something else:\n\n```\nsage: from sage.matrix.matrix_gfpn_dense import mtx_unpickle\nsage: filename = '/home/king/Projekte/coho/tests/State.sobj'\nsage: compress = True\nsage: class unpickle_old_mtx:\n....:     def __call__(self, *args, **kwds):\n....:         return mtx_unpickle(*args, **kwds)\n....:     \nsage: register_unpickle_override('pGroupCohomology.mtx', 'MTX_unpickle_class', unpickle_old_mtx)\n# The following is copied from Sage's load() function.\nsage:     ## Load file by absolute filename\n....:     with open(filename, 'rb') as fobj:\n....:         X = loads(fobj.read(), compress=compress)\n....:     try:\n....:         X._default_filename = os.path.abspath(filename)\n....:     except AttributeError:\n....:         pass\n....: \n---------------------------------------------------------------------------\nUnicodeDecodeError                        Traceback (most recent call last)\n<ipython-input-9-654643a51ef6> in <module>()\n      1 ## Load file by absolute filename\n      2 with open(filename, 'rb') as fobj:\n----> 3     X = loads(fobj.read(), compress=compress)\n      4 try:\n      5     X._default_filename = os.path.abspath(filename)\n\n/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()\n    967 \n    968     unpickler = SageUnpickler(io.BytesIO(s))\n--> 969     return unpickler.load()\n    970 \n    971 \n\nUnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)\n```\nSo, now we see that the error occurs in `SageUnpickler(io.BytesIO(x)).load()`.",
    "created_at": "2019-09-02T08:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446912",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:38'></a>
Replying to [chapoton](#comment%3A37):
> This works fine in python3:
> 
> ```
> sage: with open('State.sobj', 'rb') as f:
> ....:     f.read()
> ```


Do I understand that it works because `b` means "binary"? But of course the real question is why Python 3 cannot unpickle from that file.

I tried to dig a bit deeper into Sage's `load` function (I guess the error is hidden there), and indeed `load()` uses `with open(filename, 'rb') as fobj:`. So, the unpickling problem is something else:

```
sage: from sage.matrix.matrix_gfpn_dense import mtx_unpickle
sage: filename = '/home/king/Projekte/coho/tests/State.sobj'
sage: compress = True
sage: class unpickle_old_mtx:
....:     def __call__(self, *args, **kwds):
....:         return mtx_unpickle(*args, **kwds)
....:     
sage: register_unpickle_override('pGroupCohomology.mtx', 'MTX_unpickle_class', unpickle_old_mtx)
# The following is copied from Sage's load() function.
sage:     ## Load file by absolute filename
....:     with open(filename, 'rb') as fobj:
....:         X = loads(fobj.read(), compress=compress)
....:     try:
....:         X._default_filename = os.path.abspath(filename)
....:     except AttributeError:
....:         pass
....: 
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-9-654643a51ef6> in <module>()
      1 ## Load file by absolute filename
      2 with open(filename, 'rb') as fobj:
----> 3     X = loads(fobj.read(), compress=compress)
      4 try:
      5     X._default_filename = os.path.abspath(filename)

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:7270)()
    967 
    968     unpickler = SageUnpickler(io.BytesIO(s))
--> 969     return unpickler.load()
    970 
    971 

UnicodeDecodeError: 'ascii' codec can't decode byte 0x80 in position 0: ordinal not in range(128)
```
So, now we see that the error occurs in `SageUnpickler(io.BytesIO(x)).load()`.



---

archive/issue_comments_446913.json:
```json
{
    "body": "<a id='comment:39'></a>\nI find it very difficult to track down. But the fact that one does see a mentioning of `pGroupCohomology.mtx` when one forgets to `register_unpickle_override(...)` seems to indicate that the error occurs when an mtx matrix is unpickled.\n\nSo, I am now trying to find if this is really the case or not.",
    "created_at": "2019-09-02T15:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446913",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:39'></a>
I find it very difficult to track down. But the fact that one does see a mentioning of `pGroupCohomology.mtx` when one forgets to `register_unpickle_override(...)` seems to indicate that the error occurs when an mtx matrix is unpickled.

So, I am now trying to find if this is really the case or not.



---

archive/issue_comments_446914.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [SimonKing](#comment%3A39):\n> I find it very difficult to track down. But the fact that one does see a mentioning of `pGroupCohomology.mtx` when one forgets to `register_unpickle_override(...)` seems to indicate that the error occurs when an mtx matrix is unpickled.\n> \n> So, I am now trying to find if this is really the case or not.\n\n\nIt isn't. I inserted a print statement at the beginning of `mtx_unpickle`, but it isn't shown before the error triggered by `load('/home/king/Projekte/coho/tests/State.sobj')` is raised.\n\nI'll open a ticket for that problem.",
    "created_at": "2019-09-02T15:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446914",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:40'></a>
Replying to [SimonKing](#comment%3A39):
> I find it very difficult to track down. But the fact that one does see a mentioning of `pGroupCohomology.mtx` when one forgets to `register_unpickle_override(...)` seems to indicate that the error occurs when an mtx matrix is unpickled.
> 
> So, I am now trying to find if this is really the case or not.


It isn't. I inserted a print statement at the beginning of `mtx_unpickle`, but it isn't shown before the error triggered by `load('/home/king/Projekte/coho/tests/State.sobj')` is raised.

I'll open a ticket for that problem.



---

archive/issue_comments_446915.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [SimonKing](#comment%3A40):\n> I'll open a ticket for that problem.\n\n\nIt is #28444. I am now convinced that the problem is in Python-3 resp. in Sage's unpickling, but not in MeatAxe.",
    "created_at": "2019-09-02T15:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446915",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:41'></a>
Replying to [SimonKing](#comment%3A40):
> I'll open a ticket for that problem.


It is #28444. I am now convinced that the problem is in Python-3 resp. in Sage's unpickling, but not in MeatAxe.



---

archive/issue_comments_446916.json:
```json
{
    "body": "**Dependencies:** #28444",
    "created_at": "2019-09-02T16:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446916",
    "user": "https://github.com/simon-king-jena"
}
```

**Dependencies:** #28444



---

archive/issue_comments_446917.json:
```json
{
    "body": "<a id='comment:43'></a>\nIt seems that #28444 fixes the problem for p_group_cohomology on Python-3. With the current unpublished code for the package, I get\n\n```\n$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.9.beta9, Release Date: 2019-09-02               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.set_workspace(tmp_dir())\nsage: H = CohomologyRing(8,3,options='debug')\nLocal data found at /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3/H8gp3.sobj\nCreating symbolic links from /home/king/.sage/temp/klap/7894/dir_05fi7c3s/8gp3 to /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3\nGet original root and GStem\n/home/king/SPKG/database 8gp3\nnow, StateFile is /home/king/.sage/temp/klap/7894/dir_05fi7c3s/8gp3/dat/State.sobj\nTry to get (8, 3) from cache\nGroup data are rooted at '/home/king/.sage/temp/klap/7894/dir_05fi7c3s/'\nThe state descriptor of the to-be-unpickled ring is expected to be provided at '/home/king/.sage/temp/klap/7894/dir_05fi7c3s/8gp3/dat/State.sobj'\nSetting state\n> export action matrices\nDifferential reloaded\n> rk P_02 =   3\nDifferential reloaded\n> rk P_03 =   4\nImport monomials\nChecking compatibility of SmallGroups library and stored cohomology ring\nsage: print(H)\n\nCohomology ring of Dihedral group of order 8 with coefficients in GF(2)\n\nComputation complete\nMinimal list of generators:\n[c_2_2: 2-Cocycle in H^*(D8; GF(2)),\n b_1_0: 1-Cocycle in H^*(D8; GF(2)),\n b_1_1: 1-Cocycle in H^*(D8; GF(2))]\nMinimal list of algebraic relations:\n[b_1_0*b_1_1]\n```\nHooray...",
    "created_at": "2019-09-07T16:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446917",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:43'></a>
It seems that #28444 fixes the problem for p_group_cohomology on Python-3. With the current unpublished code for the package, I get

```
$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.9.beta9, Release Date: 2019-09-02               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.set_workspace(tmp_dir())
sage: H = CohomologyRing(8,3,options='debug')
Local data found at /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3/H8gp3.sobj
Creating symbolic links from /home/king/.sage/temp/klap/7894/dir_05fi7c3s/8gp3 to /home/king/Sage/git/py3/local/share/pGroupCohomology/8gp3
Get original root and GStem
/home/king/SPKG/database 8gp3
now, StateFile is /home/king/.sage/temp/klap/7894/dir_05fi7c3s/8gp3/dat/State.sobj
Try to get (8, 3) from cache
Group data are rooted at '/home/king/.sage/temp/klap/7894/dir_05fi7c3s/'
The state descriptor of the to-be-unpickled ring is expected to be provided at '/home/king/.sage/temp/klap/7894/dir_05fi7c3s/8gp3/dat/State.sobj'
Setting state
> export action matrices
Differential reloaded
> rk P_02 =   3
Differential reloaded
> rk P_03 =   4
Import monomials
Checking compatibility of SmallGroups library and stored cohomology ring
sage: print(H)

Cohomology ring of Dihedral group of order 8 with coefficients in GF(2)

Computation complete
Minimal list of generators:
[c_2_2: 2-Cocycle in H^*(D8; GF(2)),
 b_1_0: 1-Cocycle in H^*(D8; GF(2)),
 b_1_1: 1-Cocycle in H^*(D8; GF(2))]
Minimal list of algebraic relations:
[b_1_0*b_1_1]
```
Hooray...



---

archive/issue_comments_446918.json:
```json
{
    "body": "<a id='comment:44'></a>\nStrangely, while I can compute some cohomology rings, the following computation fails in py3:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.doctest_setup()\nsage: H = CohomologyRing(32,4)\nsage: H.make()\n```\nReason: Automatic saving does not work, and apparently it is because `H.__getstate__()` returns Singular elements, which cannot be pickled. It seems I did take care of it, as `H.__getstate__()` in py2 only returns the class `sage.interfaces.singular.SingularElement` and not the instance, but for some reasons it doesn't in py3.",
    "created_at": "2019-09-11T10:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446918",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:44'></a>
Strangely, while I can compute some cohomology rings, the following computation fails in py3:

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.doctest_setup()
sage: H = CohomologyRing(32,4)
sage: H.make()
```
Reason: Automatic saving does not work, and apparently it is because `H.__getstate__()` returns Singular elements, which cannot be pickled. It seems I did take care of it, as `H.__getstate__()` in py2 only returns the class `sage.interfaces.singular.SingularElement` and not the instance, but for some reasons it doesn't in py3.



---

archive/issue_comments_446919.json:
```json
{
    "body": "<a id='comment:45'></a>\nQuestion: Has the mechanism of tab completion changed between py2 and py3? I notice that tab completion on a cohomology ring works in py2, but doesn't work (no error, but no completion either) in py3.",
    "created_at": "2019-09-11T10:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446919",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:45'></a>
Question: Has the mechanism of tab completion changed between py2 and py3? I notice that tab completion on a cohomology ring works in py2, but doesn't work (no error, but no completion either) in py3.



---

archive/issue_comments_446920.json:
```json
{
    "body": "<a id='comment:46'></a>\ntab completion is done by ipython, which should be upgraded (they've switched to Python 3 only, so we're using an old version, which in turn might lag in its Python 3 support).\n\nI suggest not to worry about it now.",
    "created_at": "2019-09-11T10:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446920",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>
tab completion is done by ipython, which should be upgraded (they've switched to Python 3 only, so we're using an old version, which in turn might lag in its Python 3 support).

I suggest not to worry about it now.



---

archive/issue_comments_446921.json:
```json
{
    "body": "<a id='comment:47'></a>\nAha! The culprit for pickle problem is `pGroupCohomology.cohomology.pickle_gap_data`, which inspite of its name also takes care of singular elements. In Py2:\n\n```\nsage: self = CohomologyRing(32,4)\nsage: self.make()\nsage: G = self._decorator_cache['_parameter_restrictions',frozenset({'c_2_2'}),('radical', True)]\nsage: G\n[[(polynomial ring, over a field, global ordering\n   // coefficients: ZZ/2\n   // number of vars : 2\n   //        block   1 : ordering M\n   //                  : names    c_1_0 c_1_1\n   //                  : weights      1     1\n   //                  : weights     -1     0\n   //        block   2 : ordering C,\n   <repr(<sage.interfaces.singular.SingularElement at 0x7ff4a0cca690>) failed: AttributeError: 'NoneType' object has no attribute 'group'>,\n   <repr(<sage.interfaces.singular.SingularElement at 0x7ff4a0cca500>) failed: AttributeError: 'NoneType' object has no attribute 'group'>)],\n 2]\nsage: pickle_gap_data(G)\n[[(<class 'sage.interfaces.singular.SingularElement'>,\n   <class 'sage.interfaces.singular.SingularElement'>,\n   <class 'sage.interfaces.singular.SingularElement'>)],\n 2]\n```\nIn Py3:\n\n```\nsage: pickle_gap_data(G)\n[[(polynomial ring, over a field, global ordering\n   // coefficients: ZZ/2\n   // number of vars : 2\n   //        block   1 : ordering M\n   //                  : names    c_1_0 c_1_1\n   //                  : weights      1     1\n   //                  : weights     -1     0\n   //        block   2 : ordering C,\n   <repr(<sage.interfaces.singular.SingularElement at 0x7f6475b86a20>) failed: AttributeError: 'NoneType' object has no attribute 'group'>,\n   <repr(<sage.interfaces.singular.SingularElement at 0x7f6475b86dc8>) failed: AttributeError: 'NoneType' object has no attribute 'group'>)],\n 2]\n```",
    "created_at": "2019-09-11T11:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446921",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:47'></a>
Aha! The culprit for pickle problem is `pGroupCohomology.cohomology.pickle_gap_data`, which inspite of its name also takes care of singular elements. In Py2:

```
sage: self = CohomologyRing(32,4)
sage: self.make()
sage: G = self._decorator_cache['_parameter_restrictions',frozenset({'c_2_2'}),('radical', True)]
sage: G
[[(polynomial ring, over a field, global ordering
   // coefficients: ZZ/2
   // number of vars : 2
   //        block   1 : ordering M
   //                  : names    c_1_0 c_1_1
   //                  : weights      1     1
   //                  : weights     -1     0
   //        block   2 : ordering C,
   <repr(<sage.interfaces.singular.SingularElement at 0x7ff4a0cca690>) failed: AttributeError: 'NoneType' object has no attribute 'group'>,
   <repr(<sage.interfaces.singular.SingularElement at 0x7ff4a0cca500>) failed: AttributeError: 'NoneType' object has no attribute 'group'>)],
 2]
sage: pickle_gap_data(G)
[[(<class 'sage.interfaces.singular.SingularElement'>,
   <class 'sage.interfaces.singular.SingularElement'>,
   <class 'sage.interfaces.singular.SingularElement'>)],
 2]
```
In Py3:

```
sage: pickle_gap_data(G)
[[(polynomial ring, over a field, global ordering
   // coefficients: ZZ/2
   // number of vars : 2
   //        block   1 : ordering M
   //                  : names    c_1_0 c_1_1
   //                  : weights      1     1
   //                  : weights     -1     0
   //        block   2 : ordering C,
   <repr(<sage.interfaces.singular.SingularElement at 0x7f6475b86a20>) failed: AttributeError: 'NoneType' object has no attribute 'group'>,
   <repr(<sage.interfaces.singular.SingularElement at 0x7f6475b86dc8>) failed: AttributeError: 'NoneType' object has no attribute 'group'>)],
 2]
```



---

archive/issue_comments_446922.json:
```json
{
    "body": "<a id='comment:48'></a>\nOuch. A nasty thing.\n\nIn `pickle_gap_data`, I test if the input is an iterable class, and if it is and if the class is a builtin, then the `pickle_gap_data` traverses the items of the input and creates from the individual results a modified copy of the input. In code:\n\n```python\n    try:\n        I = iter(G)\n    except:\n        return G\n    if isinstance(G,dict):\n        return dict((pickle_gap_data(k), pickle_gap_data(v)) for k,v in G.items())\n    if getattr(type(G), '__module__', None) == '__builtin__':\n        return type(G)(pickle_gap_data(X) for X in I)\n    return G\n```\nThe problem is that in Py3 we get\n\n```\nsage: getattr(list, '__module__', None)\n'builtins'\n```\n\nQuestion: How to test in a py2/py3 invariant way whether a type is a builtin?\n\nThat asked, are there more iterable builtins than list, tuple, str/bytes and dict? I guess it is safer to just explicitly test for list and tuple. EDIT Like this:\n\n```python\n    if isinstance(G, dict):\n        return dict((pickle_gap_data(k), pickle_gap_data(v)) for k,v in G.items())\n    if isinstance(G, (list, tuple)):\n        return type(G)(pickle_gap_data(X) for X in G)\n    return G\n```",
    "created_at": "2019-09-11T11:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446922",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:48'></a>
Ouch. A nasty thing.

In `pickle_gap_data`, I test if the input is an iterable class, and if it is and if the class is a builtin, then the `pickle_gap_data` traverses the items of the input and creates from the individual results a modified copy of the input. In code:

```python
    try:
        I = iter(G)
    except:
        return G
    if isinstance(G,dict):
        return dict((pickle_gap_data(k), pickle_gap_data(v)) for k,v in G.items())
    if getattr(type(G), '__module__', None) == '__builtin__':
        return type(G)(pickle_gap_data(X) for X in I)
    return G
```
The problem is that in Py3 we get

```
sage: getattr(list, '__module__', None)
'builtins'
```

Question: How to test in a py2/py3 invariant way whether a type is a builtin?

That asked, are there more iterable builtins than list, tuple, str/bytes and dict? I guess it is safer to just explicitly test for list and tuple. EDIT Like this:

```python
    if isinstance(G, dict):
        return dict((pickle_gap_data(k), pickle_gap_data(v)) for k,v in G.items())
    if isinstance(G, (list, tuple)):
        return type(G)(pickle_gap_data(X) for X in G)
    return G
```



---

archive/issue_comments_446923.json:
```json
{
    "body": "<a id='comment:49'></a>\nAn iterable is an object with an `__iter__` method or/and `__getitem__` method defined.\nSo perhaps you can test for their presense. (These methods may be broken, but OK...)",
    "created_at": "2019-09-11T12:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446923",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>
An iterable is an object with an `__iter__` method or/and `__getitem__` method defined.
So perhaps you can test for their presense. (These methods may be broken, but OK...)



---

archive/issue_comments_446924.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [dimpase](#comment%3A49):\n> An iterable is an object with an `__iter__` method or/and `__getitem__` method defined.\n> So perhaps you can test for their presense. (These methods may be broken, but OK...)\n\n\nYou misunderstood. The problem was not how to test if something is iterable but how to test if that iterable is a builtin. But, as I said in my previous post, probably this isn't the actual problem anyway. What I want is to deal with strings, lists, tuples and dicts. Period. So, I could be more explicit (and I already tested that the error from [comment:44](#comment%3A44) can be fixed in that way).",
    "created_at": "2019-09-11T12:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446924",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:50'></a>
Replying to [dimpase](#comment%3A49):
> An iterable is an object with an `__iter__` method or/and `__getitem__` method defined.
> So perhaps you can test for their presense. (These methods may be broken, but OK...)


You misunderstood. The problem was not how to test if something is iterable but how to test if that iterable is a builtin. But, as I said in my previous post, probably this isn't the actual problem anyway. What I want is to deal with strings, lists, tuples and dicts. Period. So, I could be more explicit (and I already tested that the error from [comment:44](#comment%3A44) can be fixed in that way).



---

archive/issue_comments_446925.json:
```json
{
    "body": "<a id='comment:51'></a>\nIn Python-2, one implemented `c.__nonzero__()` and then `bool(c)` would work. It seems that in Python-3, something else needs to be done. Is it perhaps the case that I need to implement `__bool__`?\n\nWhat should I do to make stuff work both in py-2 and py-3? Implement *both* `__bool__` and `__nonzero__`? Or would it be enough to *replace* `__nonzero__` with `__bool__`?",
    "created_at": "2019-09-12T12:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446925",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:51'></a>
In Python-2, one implemented `c.__nonzero__()` and then `bool(c)` would work. It seems that in Python-3, something else needs to be done. Is it perhaps the case that I need to implement `__bool__`?

What should I do to make stuff work both in py-2 and py-3? Implement *both* `__bool__` and `__nonzero__`? Or would it be enough to *replace* `__nonzero__` with `__bool__`?



---

archive/issue_comments_446926.json:
```json
{
    "body": "<a id='comment:52'></a>\nI found this\n\n```python\nclass test:\n    def __bool__(self):\n        return False\n    __nonzero__=__bool__\n\n```\n[here](https://stackoverflow.com/questions/2233786/overriding-bool-for-custom-class).",
    "created_at": "2019-09-12T12:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446926",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:52'></a>
I found this

```python
class test:
    def __bool__(self):
        return False
    __nonzero__=__bool__

```
[here](https://stackoverflow.com/questions/2233786/overriding-bool-for-custom-class).



---

archive/issue_comments_446927.json:
```json
{
    "body": "<a id='comment:53'></a>\nThere is a problem with the logging module: In Python-2, I get\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.doctest_setup()\nsage: P = CohomologyRing(9,2,options='debug')\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/19448/dir_0MUJxK/'\nComputing basic setup for Small Group number 1 of order 3\nComputing basic setup for Small Group number 2 of order 9\nResolution of GF(3)[9gp2]: \n          > export action matrices\nH^*(SmallGroup(9,2); GF(3)): \n          Initialising maximal p-elementary abelian subgroups\n```\nwhereas in Python-3 I get\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.doctest_setup()\nsage: P = CohomologyRing(9,2,options='debug')\nWe compute this cohomology ring from scratch\nGroup data are rooted at '/home/king/.sage/temp/klap/18649/dir_9bz1_9bh/'\nComputing basic setup for Small Group number 1 of order 3\nComputing basic setup for Small Group number 2 of order 9\n> export action matrices\nInitialising maximal p-elementary abelian subgroups\n```\nSo, the indentation is gone, and (whats worse) the logging doesn't indicate what object the log comes from (which I found very useful for debugging, as in the computation of a single cohomology ring often many other rings are involved).\n\nCan someone please give me a pointer to a page explaining the differences between py-2 and py-3 in the logging module?",
    "created_at": "2019-09-12T12:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446927",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:53'></a>
There is a problem with the logging module: In Python-2, I get

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.doctest_setup()
sage: P = CohomologyRing(9,2,options='debug')
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/19448/dir_0MUJxK/'
Computing basic setup for Small Group number 1 of order 3
Computing basic setup for Small Group number 2 of order 9
Resolution of GF(3)[9gp2]: 
          > export action matrices
H^*(SmallGroup(9,2); GF(3)): 
          Initialising maximal p-elementary abelian subgroups
```
whereas in Python-3 I get

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.doctest_setup()
sage: P = CohomologyRing(9,2,options='debug')
We compute this cohomology ring from scratch
Group data are rooted at '/home/king/.sage/temp/klap/18649/dir_9bz1_9bh/'
Computing basic setup for Small Group number 1 of order 3
Computing basic setup for Small Group number 2 of order 9
> export action matrices
Initialising maximal p-elementary abelian subgroups
```
So, the indentation is gone, and (whats worse) the logging doesn't indicate what object the log comes from (which I found very useful for debugging, as in the computation of a single cohomology ring often many other rings are involved).

Can someone please give me a pointer to a page explaining the differences between py-2 and py-3 in the logging module?



---

archive/issue_comments_446928.json:
```json
{
    "body": "<a id='comment:54'></a>\nReplying to [SimonKing](#comment%3A53):\n> Can someone please give me a pointer to a page explaining the differences between py-2 and py-3 in the logging module?\n\n\nBy looking at the code of the logging module in Python-2 and Python-3, I see where the problem comes from. In the following, `self` denotes an instance of `pGroupCohomology.auxiliary.CohoFormatter`, which sub-classes `loggin.Formatter`.\n\nIn Python-2, `logging.Formatter.format(self, record)` uses `self._fmt` to format the output. In Python-3, `self._fmt` is not used. Instead, `self._style._fmt` is consulted, where `self._style` is one of the styles in `logging._STYLES`.\n\nThe point is: So far, my custom `self.format` modifies `self._fmt` and then calls the default `.format()`. However, in Python-3, when calling the default `.format()`, the attribute `self._fmt` plays no role, but this is where I currently put the format into.\n\nSimple way out: Do not call `logging.Formatter.format` in `CohoFormatter.format`.\n\nBut I wonder: Is there a recommended way to make the logging format change from call to call?\n\nBy this, I mean: Make the output of `CohoFormatter.format(self, record)` depend on `record.args[0]`, in the sense that the output makes visible whether `record.args[0]` is the same object as in the previous call to `CohoFormatter.format`.\n\nOr, more radically: What kind of logging approach would you recommend, what do you find most easy to comprehend/parse as a human (I am not interested in automatic parsing of the logging messages)?\n\nI somehow like the current approach, which is: Assume that certain objects (say, `ZZ` and `RR`) are involved in a computation, and each object may issue a logging message. Then, stream of messages is arranged in blocks of messages coming from a single object, each block being prepended by an identifier of the object. I.e., if `ZZ` gives two messages, then `RR` gives three messages and then again `ZZ` gives a message, the output would be\n\n```\nInteger Ring:\n    message 1\n    message 2\nRational Field:\n    message 3\n    message 4\n    message 5\nInteger Ring:\n    message 6\n```\n1. Do you like this thematic arrangement of messages (which is provided by `coho_logger` in Python 2, but fails in Python-3)?\n2. If yes: Can you recommend a clean and easy way to achieve it both in Python 2 and Python 3? Ideally, one should still be able to include time information in the logging, which currently is not supported.\n3. If no: What logging format would you recommend?",
    "created_at": "2019-09-17T14:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446928",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:54'></a>
Replying to [SimonKing](#comment%3A53):
> Can someone please give me a pointer to a page explaining the differences between py-2 and py-3 in the logging module?


By looking at the code of the logging module in Python-2 and Python-3, I see where the problem comes from. In the following, `self` denotes an instance of `pGroupCohomology.auxiliary.CohoFormatter`, which sub-classes `loggin.Formatter`.

In Python-2, `logging.Formatter.format(self, record)` uses `self._fmt` to format the output. In Python-3, `self._fmt` is not used. Instead, `self._style._fmt` is consulted, where `self._style` is one of the styles in `logging._STYLES`.

The point is: So far, my custom `self.format` modifies `self._fmt` and then calls the default `.format()`. However, in Python-3, when calling the default `.format()`, the attribute `self._fmt` plays no role, but this is where I currently put the format into.

Simple way out: Do not call `logging.Formatter.format` in `CohoFormatter.format`.

But I wonder: Is there a recommended way to make the logging format change from call to call?

By this, I mean: Make the output of `CohoFormatter.format(self, record)` depend on `record.args[0]`, in the sense that the output makes visible whether `record.args[0]` is the same object as in the previous call to `CohoFormatter.format`.

Or, more radically: What kind of logging approach would you recommend, what do you find most easy to comprehend/parse as a human (I am not interested in automatic parsing of the logging messages)?

I somehow like the current approach, which is: Assume that certain objects (say, `ZZ` and `RR`) are involved in a computation, and each object may issue a logging message. Then, stream of messages is arranged in blocks of messages coming from a single object, each block being prepended by an identifier of the object. I.e., if `ZZ` gives two messages, then `RR` gives three messages and then again `ZZ` gives a message, the output would be

```
Integer Ring:
    message 1
    message 2
Rational Field:
    message 3
    message 4
    message 5
Integer Ring:
    message 6
```
1. Do you like this thematic arrangement of messages (which is provided by `coho_logger` in Python 2, but fails in Python-3)?
2. If yes: Can you recommend a clean and easy way to achieve it both in Python 2 and Python 3? Ideally, one should still be able to include time information in the logging, which currently is not supported.
3. If no: What logging format would you recommend?



---

archive/issue_comments_446929.json:
```json
{
    "body": "<a id='comment:55'></a>\nInstead of setting `self._fmt`, can you instead run `self.basicConfig(format=FORMAT)`? (https://docs.python.org/3/library/logging.html#logging.basicConfig) There are also ways of having several formatters (https://docs.python.org/3.7/library/logging.config.html#user-defined-objects), so maybe you can make use of that somehow.",
    "created_at": "2019-09-17T18:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446929",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:55'></a>
Instead of setting `self._fmt`, can you instead run `self.basicConfig(format=FORMAT)`? (https://docs.python.org/3/library/logging.html#logging.basicConfig) There are also ways of having several formatters (https://docs.python.org/3.7/library/logging.config.html#user-defined-objects), so maybe you can make use of that somehow.



---

archive/issue_comments_446930.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [jhpalmieri](#comment%3A55):\n> Instead of setting `self._fmt`, can you instead run `self.basicConfig(format=FORMAT)`? (https://docs.python.org/3/library/logging.html#logging.basicConfig) There are also ways of having several formatters (https://docs.python.org/3.7/library/logging.config.html#user-defined-objects), so maybe you can make use of that somehow.\n\n\nFrom these links, I get the impression that each call to the logger results in the creation of a *new* formatter. Is that really the case?",
    "created_at": "2019-09-17T21:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446930",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:56'></a>
Replying to [jhpalmieri](#comment%3A55):
> Instead of setting `self._fmt`, can you instead run `self.basicConfig(format=FORMAT)`? (https://docs.python.org/3/library/logging.html#logging.basicConfig) There are also ways of having several formatters (https://docs.python.org/3.7/library/logging.config.html#user-defined-objects), so maybe you can make use of that somehow.


From these links, I get the impression that each call to the logger results in the creation of a *new* formatter. Is that really the case?



---

archive/issue_comments_446931.json:
```json
{
    "body": "<a id='comment:57'></a>\nI don't know, I only looked at the links, too. It's worth trying.\n\n(My impression from the links was that you could create several formatters and then switch from one to another on the fly.)",
    "created_at": "2019-09-17T23:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446931",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:57'></a>
I don't know, I only looked at the links, too. It's worth trying.

(My impression from the links was that you could create several formatters and then switch from one to another on the fly.)



---

archive/issue_comments_446932.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [jhpalmieri](#comment%3A57):\n> I don't know, I only looked at the links, too. It's worth trying.\n> \n> (My impression from the links was that you could create several formatters and then switch from one to another on the fly.)\n\n\nSure. But I am unsure how a change of formatter could solve the problem without impact on performance.\n\nIf logging is in \"warn\" mode, then there are of course still silent calls to `coho_logger.debug`. I want that (1) these calls are cheap (i.e., they shouldn't involve creation of Python objects) and (2) the message blocks should not take into account silent messages, i.e., a block shouldn't be closed if a silent message comes from a different object.\n\nOf course, it should be that what I do with the formatter should rather be done with a handler, or maybe a filter. So, I will try to understand what exactly what handlers and filters do.\n\nAnd, as in point 3. of [comment:54](#comment%3A54): Would you recommend a different formatting of log messages?",
    "created_at": "2019-09-18T07:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446932",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:58'></a>
Replying to [jhpalmieri](#comment%3A57):
> I don't know, I only looked at the links, too. It's worth trying.
> 
> (My impression from the links was that you could create several formatters and then switch from one to another on the fly.)


Sure. But I am unsure how a change of formatter could solve the problem without impact on performance.

If logging is in "warn" mode, then there are of course still silent calls to `coho_logger.debug`. I want that (1) these calls are cheap (i.e., they shouldn't involve creation of Python objects) and (2) the message blocks should not take into account silent messages, i.e., a block shouldn't be closed if a silent message comes from a different object.

Of course, it should be that what I do with the formatter should rather be done with a handler, or maybe a filter. So, I will try to understand what exactly what handlers and filters do.

And, as in point 3. of [comment:54](#comment%3A54): Would you recommend a different formatting of log messages?



---

archive/issue_comments_446933.json:
```json
{
    "body": "<a id='comment:59'></a>\nCurrently I am reading [logging HOWTO](https://docs.python.org/3/howto/logging.html) and [logging Cookbook](https://docs.python.org/3/howto/logging-cookbook.html), and at the moment it seems to me that I want to use `logging.LoggingAdapter`, because it allows to add contextual information (which is what I'd like to use, unless people tell me a nicer way log format).",
    "created_at": "2019-09-18T13:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446933",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:59'></a>
Currently I am reading [logging HOWTO](https://docs.python.org/3/howto/logging.html) and [logging Cookbook](https://docs.python.org/3/howto/logging-cookbook.html), and at the moment it seems to me that I want to use `logging.LoggingAdapter`, because it allows to add contextual information (which is what I'd like to use, unless people tell me a nicer way log format).



---

archive/issue_comments_446934.json:
```json
{
    "body": "<a id='comment:60'></a>\nI think I now know what to do: The customisation should be done in a Formatter, i.e., the existing solution was a good approach. Only the `format()` method should be different: Before calling `super(CohoFormatter, self).format(record)`, I should add some attribute to the `record` that is then used in the formatter's format string.",
    "created_at": "2019-09-18T17:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446934",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:60'></a>
I think I now know what to do: The customisation should be done in a Formatter, i.e., the existing solution was a good approach. Only the `format()` method should be different: Before calling `super(CohoFormatter, self).format(record)`, I should add some attribute to the `record` that is then used in the formatter's format string.



---

archive/issue_comments_446935.json:
```json
{
    "body": "<a id='comment:61'></a>\nI think I solved the problem. I can now optionally add time information to the log, such as here:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.doctest_setup()\nsage: CohomologyRing.global_options('debug')\nsage: CohomologyRing.global_options('time')\nsage: H = CohomologyRing(720,763,prime=3)\n    2019-09-18 20:54:20,277: Try to compute a Sylow 3-subgroup\n    2019-09-18 20:54:20,283: Try to find the SmallGroups address of the Sylow subgroup\n    2019-09-18 20:54:20,288: We compute this cohomology ring from scratch\n    2019-09-18 20:54:20,289: Group data are rooted at '/home/king/.sage/temp/klap/962/dir_tnhvqeq7/'\n    2019-09-18 20:54:20,293: Computing basic setup for Small Group number 1 of order 3\n    2019-09-18 20:54:20,405: Computing basic setup for Small Group number 2 of order 9\nResolution of GF(3)[9gp2]:\n    2019-09-18 20:54:20,466: > export action matrices\nH^*(SmallGroup(9,2); GF(3)):\n    2019-09-18 20:54:20,517: Initialising maximal p-elementary abelian subgroups\n    2019-09-18 20:54:20,555: Computing intermediate subgroup\n    2019-09-18 20:54:20,567: Try to find the SmallGroups address of the intermediate subgroup\n    2019-09-18 20:54:20,603: Computing group order\n    2019-09-18 20:54:20,604: The group is of order 72\n    2019-09-18 20:54:20,609: Computing intermediate subgroup\nResolution of GF(3)[SmallGroup(9,2)]:\n    2019-09-18 20:54:20,625: Computing next term\n    2019-09-18 20:54:20,644: > rk P_02 =   3\nH^*(SmallGroup(9,2); GF(3)):\n    2019-09-18 20:54:20,647: We have to choose 2 new generators in degree 1\n    2019-09-18 20:54:20,648: > There are 2 nilpotent generators in degree 1\n...\n```\n\nHowever, what I'd find even nicer if the sum of the cputimes of Sage and Singular since start of logging was shown, not just the walltime, as above.\n\nNote that the indentation has changed, which means that I will have to change various doc tests, but that will be doable.",
    "created_at": "2019-09-18T19:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446935",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:61'></a>
I think I solved the problem. I can now optionally add time information to the log, such as here:

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.doctest_setup()
sage: CohomologyRing.global_options('debug')
sage: CohomologyRing.global_options('time')
sage: H = CohomologyRing(720,763,prime=3)
    2019-09-18 20:54:20,277: Try to compute a Sylow 3-subgroup
    2019-09-18 20:54:20,283: Try to find the SmallGroups address of the Sylow subgroup
    2019-09-18 20:54:20,288: We compute this cohomology ring from scratch
    2019-09-18 20:54:20,289: Group data are rooted at '/home/king/.sage/temp/klap/962/dir_tnhvqeq7/'
    2019-09-18 20:54:20,293: Computing basic setup for Small Group number 1 of order 3
    2019-09-18 20:54:20,405: Computing basic setup for Small Group number 2 of order 9
Resolution of GF(3)[9gp2]:
    2019-09-18 20:54:20,466: > export action matrices
H^*(SmallGroup(9,2); GF(3)):
    2019-09-18 20:54:20,517: Initialising maximal p-elementary abelian subgroups
    2019-09-18 20:54:20,555: Computing intermediate subgroup
    2019-09-18 20:54:20,567: Try to find the SmallGroups address of the intermediate subgroup
    2019-09-18 20:54:20,603: Computing group order
    2019-09-18 20:54:20,604: The group is of order 72
    2019-09-18 20:54:20,609: Computing intermediate subgroup
Resolution of GF(3)[SmallGroup(9,2)]:
    2019-09-18 20:54:20,625: Computing next term
    2019-09-18 20:54:20,644: > rk P_02 =   3
H^*(SmallGroup(9,2); GF(3)):
    2019-09-18 20:54:20,647: We have to choose 2 new generators in degree 1
    2019-09-18 20:54:20,648: > There are 2 nilpotent generators in degree 1
...
```

However, what I'd find even nicer if the sum of the cputimes of Sage and Singular since start of logging was shown, not just the walltime, as above.

Note that the indentation has changed, which means that I will have to change various doc tests, but that will be doable.



---

archive/issue_comments_446936.json:
```json
{
    "body": "<a id='comment:62'></a>\nSigh.\n\nAfter solving the log problem, I find that meanwhile the code ONLY works in Python-3, not Python-2.\n\nFirst problem:\n\n```\nclass FOO(object):\n    def __bool__(self):\n        return something\n    __nonzero__ = __bool__\n```\nworks in Py3, but not in Py2, although it was recommended in some stackoverflow discussion. In Py2 it results in `NameError: name '__bool__' is not defined`. How to fix it without code duplication?\n\nSecond problem:\n\n```\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pGroupCohomology/factory.py in <module>()\n     47 import re,os\n     48 \n---> 49 import urllib.request, urllib.error\n     50 import tarfile\n     51 import logging\n\nImportError: No module named request\n```\nHow to deal with urllib in a py2/py3-compatible way?",
    "created_at": "2019-09-18T21:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446936",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:62'></a>
Sigh.

After solving the log problem, I find that meanwhile the code ONLY works in Python-3, not Python-2.

First problem:

```
class FOO(object):
    def __bool__(self):
        return something
    __nonzero__ = __bool__
```
works in Py3, but not in Py2, although it was recommended in some stackoverflow discussion. In Py2 it results in `NameError: name '__bool__' is not defined`. How to fix it without code duplication?

Second problem:

```
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pGroupCohomology/factory.py in <module>()
     47 import re,os
     48 
---> 49 import urllib.request, urllib.error
     50 import tarfile
     51 import logging

ImportError: No module named request
```
How to deal with urllib in a py2/py3-compatible way?



---

archive/issue_comments_446937.json:
```json
{
    "body": "<a id='comment:63'></a>\nFor the `urllib` issue: http://python3porting.com/noconv.html#import-errors suggests code like\n\n```\ntry:\n    from urllib.request import ...\nexcept ImportError:\n    from urllib import ...\n```\nI can't reproduce the first problem. With Python 2, if I do\n\n```\nsage: class FOO(object):\n....:     def __bool__(self):\n....:         return something\n....:     __nonzero__ = __bool__\n....:     \nsage: a = FOO()\nsage: a.__nonzero__()\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-3-74dab0bd3f82> in <module>()\n----> 1 a.__nonzero__()\n\n<ipython-input-1-ec93abb3d539> in __bool__(self)\n      1 class FOO(object):\n      2     def __bool__(self):\n----> 3         return something\n      4     __nonzero__ = __bool__\n      5 \n\nNameError: global name 'something' is not defined\n```\nso `a.__nonzero__()` is certainly calling `__bool__`. If I change the `return` line to something sensible, it works.",
    "created_at": "2019-09-18T21:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446937",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'></a>
For the `urllib` issue: http://python3porting.com/noconv.html#import-errors suggests code like

```
try:
    from urllib.request import ...
except ImportError:
    from urllib import ...
```
I can't reproduce the first problem. With Python 2, if I do

```
sage: class FOO(object):
....:     def __bool__(self):
....:         return something
....:     __nonzero__ = __bool__
....:     
sage: a = FOO()
sage: a.__nonzero__()
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-3-74dab0bd3f82> in <module>()
----> 1 a.__nonzero__()

<ipython-input-1-ec93abb3d539> in __bool__(self)
      1 class FOO(object):
      2     def __bool__(self):
----> 3         return something
      4     __nonzero__ = __bool__
      5 

NameError: global name 'something' is not defined
```
so `a.__nonzero__()` is certainly calling `__bool__`. If I change the `return` line to something sensible, it works.



---

archive/issue_comments_446938.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [jhpalmieri](#comment%3A63):\n> For the `urllib` issue: http://python3porting.com/noconv.html#import-errors suggests code like\n> \n> ```\n> try:\n>     from urllib.request import ...\n> except ImportError:\n>     from urllib import ...\n> ```\n\n\nOK, thank you.\n\n> I can't reproduce the first problem. With Python 2, if I do\n\n\nThe \"something\" was of course figuratively. Anyway, the problem seems to be that I am using a cdef class here:. In Sage-with-py2:\n\n```\nsage: cython('''\n....: class Foo:\n....:     def __bool__(self):\n....:         return True\n....:     __nonzero__ = __bool__\n....: ''')\nsage: cython('''\n....: cdef class Foo:\n....:     def __bool__(self):\n....:         return True\n....:     __nonzero__ = __bool__\n....: ''')\nERROR:root:An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line string', (1, 0))\n\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-2-91e48d391924> in <module>()\n      4         return True\n      5     __nonzero__ = __bool__\n----> 6 ''')\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3697)()\n    352             True\n    353         \"\"\"\n--> 354         return self.get_object()(*args, **kwds)\n    355 \n    356     def __repr__(self):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cython.pyc in cython_compile(code, **kwds)\n    649     with open(tmpfile,'w') as f:\n    650         f.write(code)\n--> 651     return cython_import_all(tmpfile, get_globals(), **kwds)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cython.pyc in cython_import_all(filename, globals, **kwds)\n    539       code\n    540     \"\"\"\n--> 541     m = cython_import(filename, **kwds)\n    542     for k, x in iteritems(m.__dict__):\n    543         if k[0] != '_':\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cython.pyc in cython_import(filename, **kwds)\n    519     try:\n    520         sys.path.append(build_dir)\n--> 521         return builtins.__import__(name)\n    522     finally:\n    523         sys.path = oldpath\n\n/home/king/.sage/temp/klap/23274/spyx/_home_king__sage_temp_klap_23274_tmp_FgSymA_pyx/_home_king__sage_temp_klap_23274_tmp_FgSymA_pyx_0.pyx in init _home_king__sage_temp_klap_23274_tmp_FgSymA_pyx_0()\n      3     def __bool__(self):\n      4         return True\n----> 5     __nonzero__ = __bool__\n\nNameError: name '__bool__' is not defined\n```\nwhereas in Sage-with-py3 I get\n\n```\nsage: cython('''\n....: class Foo:\n....:     def __bool__(self):\n....:         return True\n....:     __nonzero__ = __bool__\n....: ''')\nsage: cython('''\n....: cdef class Foo:\n....:     def __bool__(self):\n....:         return True\n....:     __nonzero__ = __bool__\n....: ''')\n```\nSo, what to do?",
    "created_at": "2019-09-18T22:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446938",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:64'></a>
Replying to [jhpalmieri](#comment%3A63):
> For the `urllib` issue: http://python3porting.com/noconv.html#import-errors suggests code like
> 
> ```
> try:
>     from urllib.request import ...
> except ImportError:
>     from urllib import ...
> ```


OK, thank you.

> I can't reproduce the first problem. With Python 2, if I do


The "something" was of course figuratively. Anyway, the problem seems to be that I am using a cdef class here:. In Sage-with-py2:

```
sage: cython('''
....: class Foo:
....:     def __bool__(self):
....:         return True
....:     __nonzero__ = __bool__
....: ''')
sage: cython('''
....: cdef class Foo:
....:     def __bool__(self):
....:         return True
....:     __nonzero__ = __bool__
....: ''')
ERROR:root:An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line string', (1, 0))

---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-2-91e48d391924> in <module>()
      4         return True
      5     __nonzero__ = __bool__
----> 6 ''')

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3697)()
    352             True
    353         """
--> 354         return self.get_object()(*args, **kwds)
    355 
    356     def __repr__(self):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cython.pyc in cython_compile(code, **kwds)
    649     with open(tmpfile,'w') as f:
    650         f.write(code)
--> 651     return cython_import_all(tmpfile, get_globals(), **kwds)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cython.pyc in cython_import_all(filename, globals, **kwds)
    539       code
    540     """
--> 541     m = cython_import(filename, **kwds)
    542     for k, x in iteritems(m.__dict__):
    543         if k[0] != '_':

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cython.pyc in cython_import(filename, **kwds)
    519     try:
    520         sys.path.append(build_dir)
--> 521         return builtins.__import__(name)
    522     finally:
    523         sys.path = oldpath

/home/king/.sage/temp/klap/23274/spyx/_home_king__sage_temp_klap_23274_tmp_FgSymA_pyx/_home_king__sage_temp_klap_23274_tmp_FgSymA_pyx_0.pyx in init _home_king__sage_temp_klap_23274_tmp_FgSymA_pyx_0()
      3     def __bool__(self):
      4         return True
----> 5     __nonzero__ = __bool__

NameError: name '__bool__' is not defined
```
whereas in Sage-with-py3 I get

```
sage: cython('''
....: class Foo:
....:     def __bool__(self):
....:         return True
....:     __nonzero__ = __bool__
....: ''')
sage: cython('''
....: cdef class Foo:
....:     def __bool__(self):
....:         return True
....:     __nonzero__ = __bool__
....: ''')
```
So, what to do?



---

archive/issue_comments_446939.json:
```json
{
    "body": "<a id='comment:65'></a>\nI don't know Cython, but replacing `__nonzero__ = __bool__` with\n\n```\ndef __nonzero__(self):\n    return self.__bool__()\n```\nseems to work.",
    "created_at": "2019-09-18T22:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446939",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:65'></a>
I don't know Cython, but replacing `__nonzero__ = __bool__` with

```
def __nonzero__(self):
    return self.__bool__()
```
seems to work.



---

archive/issue_comments_446940.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [jhpalmieri](#comment%3A65):\n> I don't know Cython, but replacing `__nonzero__ = __bool__` with\n> \n> ```\n> def __nonzero__(self):\n>     return self.__bool__()\n> ```\n> seems to work.\n\n\nSure. that's what I basically meant with \"code duplication\". It is an additional call, thus, if the boolean value of a cochain is tested very often then one will see a slow-down. But I don't know if it actually *is* tested very often.\n\nAnyway, with this code cuplication, things seem to work. Hooray!\n\nAt the moment, it seems that most of the remaining work will be to change the expected output for those tests that use logging.",
    "created_at": "2019-09-18T22:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446940",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:66'></a>
Replying to [jhpalmieri](#comment%3A65):
> I don't know Cython, but replacing `__nonzero__ = __bool__` with
> 
> ```
> def __nonzero__(self):
>     return self.__bool__()
> ```
> seems to work.


Sure. that's what I basically meant with "code duplication". It is an additional call, thus, if the boolean value of a cochain is tested very often then one will see a slow-down. But I don't know if it actually *is* tested very often.

Anyway, with this code cuplication, things seem to work. Hooray!

At the moment, it seems that most of the remaining work will be to change the expected output for those tests that use logging.



---

archive/issue_comments_446941.json:
```json
{
    "body": "<a id='comment:67'></a>\nMy hope is that we can drop Python 2 support pretty soon, or at least make sure that Python 3 works well, even if it as the expense of performance with Python 2. Does `__nonzero__` do anything with Python 3? If so, maybe you could do something like\n\n```\nfrom six import PY2\nif PY2:\n    def __nonzero__(self):\n        ...\n```\nto avoid the extra call when using Python 3.",
    "created_at": "2019-09-18T23:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446941",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:67'></a>
My hope is that we can drop Python 2 support pretty soon, or at least make sure that Python 3 works well, even if it as the expense of performance with Python 2. Does `__nonzero__` do anything with Python 3? If so, maybe you could do something like

```
from six import PY2
if PY2:
    def __nonzero__(self):
        ...
```
to avoid the extra call when using Python 3.



---

archive/issue_comments_446942.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [jhpalmieri](#comment%3A67):\n> My hope is that we can drop Python 2 support pretty soon, or at least make sure that Python 3 works well, even if it as the expense of performance with Python 2. Does `__nonzero__` do anything with Python 3? If so, maybe you could do something like\n> \n> ```\n> from six import PY2\n> if PY2:\n>     def __nonzero__(self):\n>         ...\n> ```\n> to avoid the extra call when using Python 3.\n\n\nI don't think that `__nonzero__` does anything in Python 3. But now as you mention it: It is possible (and is actually used in some places in the cythonised parts of the Sage library and also in the current not-yet-published code of the cohomology package) to make the code depend on the language level. I.e., I could have definitions for `__nonzero__` and for `__bool__`, but only one of them would be compiled.",
    "created_at": "2019-09-18T23:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446942",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:68'></a>
Replying to [jhpalmieri](#comment%3A67):
> My hope is that we can drop Python 2 support pretty soon, or at least make sure that Python 3 works well, even if it as the expense of performance with Python 2. Does `__nonzero__` do anything with Python 3? If so, maybe you could do something like
> 
> ```
> from six import PY2
> if PY2:
>     def __nonzero__(self):
>         ...
> ```
> to avoid the extra call when using Python 3.


I don't think that `__nonzero__` does anything in Python 3. But now as you mention it: It is possible (and is actually used in some places in the cythonised parts of the Sage library and also in the current not-yet-published code of the cohomology package) to make the code depend on the language level. I.e., I could have definitions for `__nonzero__` and for `__bool__`, but only one of them would be compiled.



---

archive/issue_comments_446943.json:
```json
{
    "body": "<a id='comment:69'></a>\nOne detail: According to unit_test_64, there is no significant speed difference between the py2 and py3 versions. In any case, the cputime obtained as sum of the cputime() and Singular's timer is only half of the walltime. Do I recall correctly that the time used to save data on disk is not measured by cputime()? Is there an easy way to determine that time, too?",
    "created_at": "2019-09-19T12:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446943",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:69'></a>
One detail: According to unit_test_64, there is no significant speed difference between the py2 and py3 versions. In any case, the cputime obtained as sum of the cputime() and Singular's timer is only half of the walltime. Do I recall correctly that the time used to save data on disk is not measured by cputime()? Is there an easy way to determine that time, too?



---

archive/issue_comments_446944.json:
```json
{
    "body": "<a id='comment:70'></a>\nI don't  think it makes much sense measuring time to save to disk, as it varies wildly between different OS's, different hardware, different configuration of buffering, etc etc. \n\nOften saving is completely asyncronous from the computation due to buffering and separate threads run to do buffer flushing, etc.",
    "created_at": "2019-09-19T12:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446944",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:70'></a>
I don't  think it makes much sense measuring time to save to disk, as it varies wildly between different OS's, different hardware, different configuration of buffering, etc etc. 

Often saving is completely asyncronous from the computation due to buffering and separate threads run to do buffer flushing, etc.



---

archive/issue_comments_446945.json:
```json
{
    "body": "<a id='comment:71'></a>\nNow I am totally baffled. Is it not the case that comparison is supposed to be implemented by `__richcmp__`? Apparently `__richcmp__` isn't called anymore.\n\nThe following corresponds to the code in `pGroupCohomology.dickson`, that did work in the past:\n\n```\nsage: cython(\"\"\"\n....: from sage.structure.richcmp import richcmp, op_LT, op_NE, op_GT\n....: from sage.all import GF\n....: class DICKSON:\n....:     def __init__(self,p):\n....:         self.K = GF(p)\n....:     def __richcmp__(self, other, op):\n....:         print(\"Comparison called\")\n....:         return richcmp(self.K, other.K, op)\n....: \"\"\")\n```\nNow, rich comparison fails both in py2 and py3:\n\n```\nsage: D = DICKSON(5)\nsage: F = loads(dumps(D))\nsage: D == F\nFalse\nsage: F.K == D.K\nTrue\n```\nWhat has changed, how to fix it?",
    "created_at": "2019-09-19T12:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446945",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:71'></a>
Now I am totally baffled. Is it not the case that comparison is supposed to be implemented by `__richcmp__`? Apparently `__richcmp__` isn't called anymore.

The following corresponds to the code in `pGroupCohomology.dickson`, that did work in the past:

```
sage: cython("""
....: from sage.structure.richcmp import richcmp, op_LT, op_NE, op_GT
....: from sage.all import GF
....: class DICKSON:
....:     def __init__(self,p):
....:         self.K = GF(p)
....:     def __richcmp__(self, other, op):
....:         print("Comparison called")
....:         return richcmp(self.K, other.K, op)
....: """)
```
Now, rich comparison fails both in py2 and py3:

```
sage: D = DICKSON(5)
sage: F = loads(dumps(D))
sage: D == F
False
sage: F.K == D.K
True
```
What has changed, how to fix it?



---

archive/issue_comments_446946.json:
```json
{
    "body": "<a id='comment:72'></a>\nAha! I see in sage.misc.unknown that a decorator `@richcmp_method` is used. So, I guess I need to use it, too.",
    "created_at": "2019-09-19T12:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446946",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:72'></a>
Aha! I see in sage.misc.unknown that a decorator `@richcmp_method` is used. So, I guess I need to use it, too.



---

archive/issue_comments_446947.json:
```json
{
    "body": "<a id='comment:73'></a>\nReplying to [SimonKing](#comment%3A72):\n> Aha! I see in sage.misc.unknown that a decorator `@richcmp_method` is used. So, I guess I need to use it, too.\n\n\nHooray:\n\n```\nsage: cython(\"\"\"\n....: from sage.structure.richcmp import richcmp, richcmp_method\n....: from sage.all import GF\n....: @richcmp_method\n....: class DICKSON(object):\n....:     def __init__(self,p):\n....:         self.K = GF(p)\n....:     def __richcmp__(self, other, op):\n....:         print(\"Comparison called\")\n....:         return richcmp(self.K, other.K, op)\n....: \"\"\")\nsage: D = DICKSON(5)\nsage: F = loads(dumps(D))\nsage: D == F\nComparison called\nTrue\n```",
    "created_at": "2019-09-19T12:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446947",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:73'></a>
Replying to [SimonKing](#comment%3A72):
> Aha! I see in sage.misc.unknown that a decorator `@richcmp_method` is used. So, I guess I need to use it, too.


Hooray:

```
sage: cython("""
....: from sage.structure.richcmp import richcmp, richcmp_method
....: from sage.all import GF
....: @richcmp_method
....: class DICKSON(object):
....:     def __init__(self,p):
....:         self.K = GF(p)
....:     def __richcmp__(self, other, op):
....:         print("Comparison called")
....:         return richcmp(self.K, other.K, op)
....: """)
sage: D = DICKSON(5)
sage: F = loads(dumps(D))
sage: D == F
Comparison called
True
```



---

archive/issue_comments_446948.json:
```json
{
    "body": "<a id='comment:74'></a>\nAt the moment, tests in `dickson`, `auxiliaries`, `resolution` and `factory` pass both in Py2 and Py3. In `isomorphism_test`, there are currently two failing tests, and it seems to me that they reveal a Py3-bug in `cartesian_product_iterator`:\n\n```\nFile \"/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py\", line 353, in pGroupCohomology.isomorphism_test.IsomorphismTest.explore_isomorphisms\nFailed example:\n    T.explore_isomorphisms()\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 1944, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10139)\n        return cache[k]\n    KeyError: (((3, 5, 4, 6, 7, 1, 2), 0, True), ())\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/mrange.py\", line 139, in _xmrange_iter\n        curr_elt = [next(i) for i in curr_iters[:-1]] + [None]\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/mrange.py\", line 139, in <listcomp>\n        curr_elt = [next(i) for i in curr_iters[:-1]] + [None]\n    StopIteration\n\n    The above exception was the direct cause of the following exception:\n\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest pGroupCohomology.isomorphism_test.IsomorphismTest.explore_isomorphisms[10]>\", line 1, in <module>\n        T.explore_isomorphisms()\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/isomorphism_test.py\", line 402, in explore_isomorphisms\n        Cands = self.candidates_of_gens(tuple([p[4] for p in Sizes]),len(self.rigid_generators))\n      File \"sage/misc/cachefunc.pyx\", line 1949, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)\n        w = self._instance_call(*args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1825, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)\n        return self.f(self._instance, *args, **kwds)\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/isomorphism_test.py\", line 644, in candidates_of_gens\n        for Ims1,Ims2 in cartesian_product_iterator([FirstHalf, SecondHalf]):\n    RuntimeError: generator raised StopIteration\n```\nI will investigate which values of `FirstHalf` and `SecondHalf` trigger it.",
    "created_at": "2019-09-20T05:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446948",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:74'></a>
At the moment, tests in `dickson`, `auxiliaries`, `resolution` and `factory` pass both in Py2 and Py3. In `isomorphism_test`, there are currently two failing tests, and it seems to me that they reveal a Py3-bug in `cartesian_product_iterator`:

```
File "/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py", line 353, in pGroupCohomology.isomorphism_test.IsomorphismTest.explore_isomorphisms
Failed example:
    T.explore_isomorphisms()
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 1944, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10139)
        return cache[k]
    KeyError: (((3, 5, 4, 6, 7, 1, 2), 0, True), ())

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/mrange.py", line 139, in _xmrange_iter
        curr_elt = [next(i) for i in curr_iters[:-1]] + [None]
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/mrange.py", line 139, in <listcomp>
        curr_elt = [next(i) for i in curr_iters[:-1]] + [None]
    StopIteration

    The above exception was the direct cause of the following exception:

    Traceback (most recent call last):
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest pGroupCohomology.isomorphism_test.IsomorphismTest.explore_isomorphisms[10]>", line 1, in <module>
        T.explore_isomorphisms()
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/isomorphism_test.py", line 402, in explore_isomorphisms
        Cands = self.candidates_of_gens(tuple([p[4] for p in Sizes]),len(self.rigid_generators))
      File "sage/misc/cachefunc.pyx", line 1949, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)
        w = self._instance_call(*args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1825, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)
        return self.f(self._instance, *args, **kwds)
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/pGroupCohomology/isomorphism_test.py", line 644, in candidates_of_gens
        for Ims1,Ims2 in cartesian_product_iterator([FirstHalf, SecondHalf]):
    RuntimeError: generator raised StopIteration
```
I will investigate which values of `FirstHalf` and `SecondHalf` trigger it.



---

archive/issue_comments_446949.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [SimonKing](#comment%3A74):\n> I will investigate which values of `FirstHalf` and `SecondHalf` trigger it.\n\n\nSee #28521\n\nEDIT: I am not sure if I'll make #28521 a dependency or simply work around the bug.",
    "created_at": "2019-09-20T07:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446949",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:75'></a>
Replying to [SimonKing](#comment%3A74):
> I will investigate which values of `FirstHalf` and `SecondHalf` trigger it.


See #28521

EDIT: I am not sure if I'll make #28521 a dependency or simply work around the bug.



---

archive/issue_comments_446950.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [SimonKing](#comment%3A74):\n> At the moment, tests in `dickson`, `auxiliaries`, `resolution` and `factory` pass both in Py2 and Py3. \n\n\nWhen working around the cartesian_product_iterator bug, the tests in `isomorphism_test` pass both in Py2 and Py3. Yay!",
    "created_at": "2019-09-20T07:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446950",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:76'></a>
Replying to [SimonKing](#comment%3A74):
> At the moment, tests in `dickson`, `auxiliaries`, `resolution` and `factory` pass both in Py2 and Py3. 


When working around the cartesian_product_iterator bug, the tests in `isomorphism_test` pass both in Py2 and Py3. Yay!



---

archive/issue_comments_446951.json:
```json
{
    "body": "<a id='comment:77'></a>\nTwo errors in Py3 concern `__div__`, namely\n\n```\nRunning doctests with ID 2019-09-21-07-26-57-20b48344.\nUsing --optional=build,dochtml,gap_packages,libsemigroups,meataxe,memlimit,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 47.4 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx\n**********************************************************************\nFile \"/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx\", line 3131, in pGroupCohomology.cochain.MODCOCH.__div__\nFailed example:\n    print(H.1/3) #indirect doctest\nExpected:\n    (a_6_0)/(3): 6-Cocycle in H^*(SmallGroup(400,206); GF(5))\n    defined by\n    2*c_2_1*c_2_2*a_1_0*a_1_1\nGot:\n    (a_6_0)*(2): 6-Cocycle in H^*(SmallGroup(400,206); GF(5))\n    defined by\n    2*c_2_1*c_2_2*a_1_0*a_1_1\n**********************************************************************\nFile \"/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx\", line 3139, in pGroupCohomology.cochain.MODCOCH.__div__\nFailed example:\n    H.2/H.1\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: Can not divide by <class 'pGroupCohomology.cochain.MODCOCH'>\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest pGroupCohomology.cochain.MODCOCH.__div__[6]>\", line 1, in <module>\n        H.gen(2)/H.gen(1)\n      File \"sage/structure/element.pyx\", line 1718, in sage.structure.element.Element.__truediv__ (build/cythonized/sage/structure/element.c:12780)\n        return (<Element>left)._div_(right)\n      File \"sage/structure/element.pyx\", line 2654, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18184)\n        frac = self._parent.fraction_field()\n    TypeError: 'NoneType' object is not callable\n**********************************************************************\n1 item had failures:\n   2 of   8 in pGroupCohomology.cochain.MODCOCH.__div__\n    [1490 tests, 2 failures, 465.54 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 47.4 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 470.6 seconds\n    cpu time: 249.3 seconds\n    cumulative wall time: 465.5 seconds\n```\n\nThe first error seems to indicate that `H.1/3` is automatically translated to `H.1*2`, which does make sense modulo 5, but which I did not implement like this. And the second error is nothing that I implemented.\n\nIn fact I overrode `__div__` for `COCH` and `MODCOCH`. Is it perhaps the case that overriding `__div__` won't work in Py3?",
    "created_at": "2019-09-21T05:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446951",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:77'></a>
Two errors in Py3 concern `__div__`, namely

```
Running doctests with ID 2019-09-21-07-26-57-20b48344.
Using --optional=build,dochtml,gap_packages,libsemigroups,meataxe,memlimit,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 47.4 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx
**********************************************************************
File "/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx", line 3131, in pGroupCohomology.cochain.MODCOCH.__div__
Failed example:
    print(H.1/3) #indirect doctest
Expected:
    (a_6_0)/(3): 6-Cocycle in H^*(SmallGroup(400,206); GF(5))
    defined by
    2*c_2_1*c_2_2*a_1_0*a_1_1
Got:
    (a_6_0)*(2): 6-Cocycle in H^*(SmallGroup(400,206); GF(5))
    defined by
    2*c_2_1*c_2_2*a_1_0*a_1_1
**********************************************************************
File "/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx", line 3139, in pGroupCohomology.cochain.MODCOCH.__div__
Failed example:
    H.2/H.1
Expected:
    Traceback (most recent call last):
    ...
    TypeError: Can not divide by <class 'pGroupCohomology.cochain.MODCOCH'>
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest pGroupCohomology.cochain.MODCOCH.__div__[6]>", line 1, in <module>
        H.gen(2)/H.gen(1)
      File "sage/structure/element.pyx", line 1718, in sage.structure.element.Element.__truediv__ (build/cythonized/sage/structure/element.c:12780)
        return (<Element>left)._div_(right)
      File "sage/structure/element.pyx", line 2654, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18184)
        frac = self._parent.fraction_field()
    TypeError: 'NoneType' object is not callable
**********************************************************************
1 item had failures:
   2 of   8 in pGroupCohomology.cochain.MODCOCH.__div__
    [1490 tests, 2 failures, 465.54 s]
----------------------------------------------------------------------
sage -t --long --warn-long 47.4 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 470.6 seconds
    cpu time: 249.3 seconds
    cumulative wall time: 465.5 seconds
```

The first error seems to indicate that `H.1/3` is automatically translated to `H.1*2`, which does make sense modulo 5, but which I did not implement like this. And the second error is nothing that I implemented.

In fact I overrode `__div__` for `COCH` and `MODCOCH`. Is it perhaps the case that overriding `__div__` won't work in Py3?



---

archive/issue_comments_446952.json:
```json
{
    "body": "<a id='comment:78'></a>\nIn py3, there is `__truediv__` and `__floordiv__`",
    "created_at": "2019-09-21T06:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446952",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:78'></a>
In py3, there is `__truediv__` and `__floordiv__`



---

archive/issue_comments_446953.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [chapoton](#comment%3A78):\n> In py3, there is `__truediv__` and `__floordiv__`\n\n\nI see. Do I understand correctly that in order to make my code Py2 and Py3 compatible, I should implement `__truediv__`, `__floordiv__` **and** `__div__`?\n\nOn the other hand, I reckon that Sage has default implementations of the double underscore methods, that I should rather not override.\n\nSo, given a `RingElement`, what methods do I need to implement for providing division by an element of the base field, and what do I need to implement for making clear that division of two ring elements doesn't work?\n\nI guess I should implement a `fraction_field` method for cohomology rings. Of course, since cohomology rings can have zero divisors, a fraction field will not always exist. So, should in that situation `fraction_field` return `NotImplemented`, or raise a `ValueError`, or what else?\n\nDo I need to provide a single-underscore `_div_` method, in addition to the `fraction_field`?\n\nHow to implement division by a base field element (I guess `_div_` is for division of two ring elements)?",
    "created_at": "2019-09-21T07:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446953",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:79'></a>
Replying to [chapoton](#comment%3A78):
> In py3, there is `__truediv__` and `__floordiv__`


I see. Do I understand correctly that in order to make my code Py2 and Py3 compatible, I should implement `__truediv__`, `__floordiv__` **and** `__div__`?

On the other hand, I reckon that Sage has default implementations of the double underscore methods, that I should rather not override.

So, given a `RingElement`, what methods do I need to implement for providing division by an element of the base field, and what do I need to implement for making clear that division of two ring elements doesn't work?

I guess I should implement a `fraction_field` method for cohomology rings. Of course, since cohomology rings can have zero divisors, a fraction field will not always exist. So, should in that situation `fraction_field` return `NotImplemented`, or raise a `ValueError`, or what else?

Do I need to provide a single-underscore `_div_` method, in addition to the `fraction_field`?

How to implement division by a base field element (I guess `_div_` is for division of two ring elements)?



---

archive/issue_comments_446954.json:
```json
{
    "body": "<a id='comment:80'></a>\nReplying to [SimonKing](#comment%3A79):\n> Replying to [chapoton](#comment%3A78):\n> > In py3, there is `__truediv__` and `__floordiv__`\n\n> \n> I see. Do I understand correctly that in order to make my code Py2 and Py3 compatible, I should implement `__truediv__`, `__floordiv__` **and** `__div__`?\n> \n> On the other hand, I reckon that Sage has default implementations of the double underscore methods, that I should rather not override.\n\n\nI think I'll proceed as follows:\n- Implement a `fraction_field` method for cohomology rings raising a TypeError (note that `ZZ.quo(6).fraction_field()` raises a TypeError, too)\n- Do NOT implement `_div_` -- the attempt to divide two elements of a cohomology ring will result in the TypeError raised by the `fraction_field()` method\n- Division of a cohomology element by an element of the base field will automatically work, by *multiplying* the inverse of the field element with the cohomology element, using `_lmul_/_rmul_`. I should add an example/test in the documentation of the `_lmul_/_rmul_` methods",
    "created_at": "2019-09-21T11:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446954",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:80'></a>
Replying to [SimonKing](#comment%3A79):
> Replying to [chapoton](#comment%3A78):
> > In py3, there is `__truediv__` and `__floordiv__`

> 
> I see. Do I understand correctly that in order to make my code Py2 and Py3 compatible, I should implement `__truediv__`, `__floordiv__` **and** `__div__`?
> 
> On the other hand, I reckon that Sage has default implementations of the double underscore methods, that I should rather not override.


I think I'll proceed as follows:
- Implement a `fraction_field` method for cohomology rings raising a TypeError (note that `ZZ.quo(6).fraction_field()` raises a TypeError, too)
- Do NOT implement `_div_` -- the attempt to divide two elements of a cohomology ring will result in the TypeError raised by the `fraction_field()` method
- Division of a cohomology element by an element of the base field will automatically work, by *multiplying* the inverse of the field element with the cohomology element, using `_lmul_/_rmul_`. I should add an example/test in the documentation of the `_lmul_/_rmul_` methods



---

archive/issue_comments_446955.json:
```json
{
    "body": "<a id='comment:81'></a>\nReplying to [SimonKing](#comment%3A68):\n> I don't think that `__nonzero__` does anything in Python 3. But now as you mention it: It is possible (and is actually used in some places in the cythonised parts of the Sage library and also in the current not-yet-published code of the cohomology package) to make the code depend on the language level. I.e., I could have definitions for `__nonzero__` and for `__bool__`, but only one of them would be compiled.\n\n\nThis did work, to some extent. But not really reliably. Therefore, to be on the safe side, I will implement both methods in both python versions, since the code duplication is only small.",
    "created_at": "2019-09-21T12:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446955",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:81'></a>
Replying to [SimonKing](#comment%3A68):
> I don't think that `__nonzero__` does anything in Python 3. But now as you mention it: It is possible (and is actually used in some places in the cythonised parts of the Sage library and also in the current not-yet-published code of the cohomology package) to make the code depend on the language level. I.e., I could have definitions for `__nonzero__` and for `__bool__`, but only one of them would be compiled.


This did work, to some extent. But not really reliably. Therefore, to be on the safe side, I will implement both methods in both python versions, since the code duplication is only small.



---

archive/issue_comments_446956.json:
```json
{
    "body": "<a id='comment:82'></a>\nI am currently dealing with different but mathematically equivalent behaviour: Apparently, previously Singular did not always do tail reduction, i.e., some rings in the database do not have a fully reduced representation of the relation ideal. For example, here are relations for the cohomology of `SmallGroup(64,14)`:\n\n```\nsage: H.rels()   # not tail reduced, result obtained with py2\n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1^2',\n 'a_1_0*a_3_3+a_2_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\n```\nversus\n\n```\nsage: H.rels()   # tail reduced, obtained with Py3\n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_0*a_3_3+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1*a_1_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\n```\nAs you can see, the relation `a_2_1<sup>2+a_2_1*a_1_1</sup>2` could be used to reduce the tail of `a_1_1*a_3_3+a_2_1^2`. Also, the sorting of the relations is different.\n\nThe question is how to deal with it. I guess I could proceed as follows:\n\n```\nsage: if (2, 8) < sys.version_info:\n....:     expected_rels = ['a_1_0^2', 'a_1_0*a_1_1', 'a_1_1^3', 'a_2_1*a_1_0',\n....:           'a_2_1^2+a_2_1*a_1_1^2', 'a_1_0*a_3_3+a_2_1*a_1_1^2',\n....:           'a_1_1*a_3_3+a_2_1*a_1_1^2', 'a_2_1*a_3_3', 'a_3_3^2']\n....: else:\n....:     expected_rels = ['a_1_0^2', 'a_1_0*a_1_1', 'a_1_1^3', 'a_2_1*a_1_0',\n....:           'a_2_1^2+a_2_1*a_1_1^2', 'a_1_1*a_3_3+a_2_1^2',\n....:           'a_1_0*a_3_3+a_2_1^2', 'a_2_1*a_3_3', 'a_3_3^2']\n....:     \nsage: H.rels() == expected_rels\nTrue\n```",
    "created_at": "2019-09-22T13:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446956",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:82'></a>
I am currently dealing with different but mathematically equivalent behaviour: Apparently, previously Singular did not always do tail reduction, i.e., some rings in the database do not have a fully reduced representation of the relation ideal. For example, here are relations for the cohomology of `SmallGroup(64,14)`:

```
sage: H.rels()   # not tail reduced, result obtained with py2
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1^2',
 'a_1_0*a_3_3+a_2_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
```
versus

```
sage: H.rels()   # tail reduced, obtained with Py3
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_0*a_3_3+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1*a_1_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
```
As you can see, the relation `a_2_1<sup>2+a_2_1*a_1_1</sup>2` could be used to reduce the tail of `a_1_1*a_3_3+a_2_1^2`. Also, the sorting of the relations is different.

The question is how to deal with it. I guess I could proceed as follows:

```
sage: if (2, 8) < sys.version_info:
....:     expected_rels = ['a_1_0^2', 'a_1_0*a_1_1', 'a_1_1^3', 'a_2_1*a_1_0',
....:           'a_2_1^2+a_2_1*a_1_1^2', 'a_1_0*a_3_3+a_2_1*a_1_1^2',
....:           'a_1_1*a_3_3+a_2_1*a_1_1^2', 'a_2_1*a_3_3', 'a_3_3^2']
....: else:
....:     expected_rels = ['a_1_0^2', 'a_1_0*a_1_1', 'a_1_1^3', 'a_2_1*a_1_0',
....:           'a_2_1^2+a_2_1*a_1_1^2', 'a_1_1*a_3_3+a_2_1^2',
....:           'a_1_0*a_3_3+a_2_1^2', 'a_2_1*a_3_3', 'a_3_3^2']
....:     
sage: H.rels() == expected_rels
True
```



---

archive/issue_comments_446957.json:
```json
{
    "body": "<a id='comment:83'></a>\nSigh. I am suffering from \"interesting\" debugging sessions. At the moment, it seems to me that some errors in the py2-version only occur, when I first install `p_group_cohomology` in the py2-install of Sage, then install `p_group_cohomology` in the py3-install of Sage, and only then do tests in the py2-install.",
    "created_at": "2019-09-22T17:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446957",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:83'></a>
Sigh. I am suffering from "interesting" debugging sessions. At the moment, it seems to me that some errors in the py2-version only occur, when I first install `p_group_cohomology` in the py2-install of Sage, then install `p_group_cohomology` in the py3-install of Sage, and only then do tests in the py2-install.



---

archive/issue_comments_446958.json:
```json
{
    "body": "<a id='comment:84'></a>\nI had a bad experience with doing py2/3 things on the same account, the problems was apparently in the content of `~/.sage/`.",
    "created_at": "2019-09-22T17:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446958",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:84'></a>
I had a bad experience with doing py2/3 things on the same account, the problems was apparently in the content of `~/.sage/`.



---

archive/issue_comments_446959.json:
```json
{
    "body": "<a id='comment:85'></a>\nReplying to [dimpase](#comment%3A84):\n> I had a bad experience with doing py2/3 things on the same account, the problems was apparently in the content of `~/.sage/`.\n\n\nYou mean by testing the p_group_cohomology package, or something else?\n\nIndeed I had the same impression concerning `~/.sage/`. Fortunately most of the trouble could be solved by putting `str()` around some data (because I got unicode where a string was expected - so, perhaps a rogue py3-pickle got misinterpreted in py2).",
    "created_at": "2019-09-22T20:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446959",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:85'></a>
Replying to [dimpase](#comment%3A84):
> I had a bad experience with doing py2/3 things on the same account, the problems was apparently in the content of `~/.sage/`.


You mean by testing the p_group_cohomology package, or something else?

Indeed I had the same impression concerning `~/.sage/`. Fortunately most of the trouble could be solved by putting `str()` around some data (because I got unicode where a string was expected - so, perhaps a rogue py3-pickle got misinterpreted in py2).



---

archive/issue_comments_446960.json:
```json
{
    "body": "<a id='comment:86'></a>\nReplying to [SimonKing](#comment%3A85):\n> Replying to [dimpase](#comment%3A84):\n> > I had a bad experience with doing py2/3 things on the same account, the problems was apparently in the content of `~/.sage/`.\n\n> \n> You mean by testing the p_group_cohomology package, or something else?\n> \n> Indeed I had the same impression concerning `~/.sage/`. Fortunately most of the trouble could be solved by putting `str()` around some data (because I got unicode where a string was expected - so, perhaps a rogue py3-pickle got misinterpreted in py2).\n\n\nI was getting different output from a test, IIRC it was releated to unicode, and the problem went away after I removed `~/.sage/`. I thought it might have been related to ipython, but who knowns.",
    "created_at": "2019-09-22T20:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446960",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:86'></a>
Replying to [SimonKing](#comment%3A85):
> Replying to [dimpase](#comment%3A84):
> > I had a bad experience with doing py2/3 things on the same account, the problems was apparently in the content of `~/.sage/`.

> 
> You mean by testing the p_group_cohomology package, or something else?
> 
> Indeed I had the same impression concerning `~/.sage/`. Fortunately most of the trouble could be solved by putting `str()` around some data (because I got unicode where a string was expected - so, perhaps a rogue py3-pickle got misinterpreted in py2).


I was getting different output from a test, IIRC it was releated to unicode, and the problem went away after I removed `~/.sage/`. I thought it might have been related to ipython, but who knowns.



---

archive/issue_comments_446961.json:
```json
{
    "body": "<a id='comment:87'></a>\nI tried to solve it by doing an explicit conversion to str whenever there is data that is expected of this type. And instead of `if isinstance(bla, str)`, I now do `if isinstance(bla, (str, unicode))`, where I define `unicode=str` in py3.\n\nSo far, this seems to work. And after all, most users will have only one Sage installation anyway.",
    "created_at": "2019-09-23T08:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446961",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:87'></a>
I tried to solve it by doing an explicit conversion to str whenever there is data that is expected of this type. And instead of `if isinstance(bla, str)`, I now do `if isinstance(bla, (str, unicode))`, where I define `unicode=str` in py3.

So far, this seems to work. And after all, most users will have only one Sage installation anyway.



---

archive/issue_comments_446962.json:
```json
{
    "body": "<a id='comment:88'></a>\nReplying to [SimonKing](#comment%3A13):\n> Replying to [SimonKing](#comment%3A10):\n> > If the .sobj file's location is not stored as an attribute in Python 3 then I have a problem.\n\n> \n> Hooray:\n> \n> ```\n> # in Sage-with-python-2\n> sage: P = CombinatorialFreeModule(ZZ,'x')\n> sage: save(P,'../../pickle')\n> ```\n> \n> ```\n> # BOTH with python-2 and python-3\n> sage: B = load('../../pickle.sobj')\n> sage: B._default_filename\n> '/home/king/Sage/pickle.sobj'\n> ```\n> So, the old trick should still work.\n\n\nI wonder if I shouldn't improve the trick.\n\nCurrently, if the initialisation of an unpickled object can not be finished, it is the `__getattr__` method that would trigger the completion of initialisation based on the value of `self._default_filename` that is set by Sage's `loads()` after unpickling the object and before returning it.\n\nBut what if I turn `_default_filename` into a property? I could make it so that its setter triggers the completion of initialisation, to the effect that the object returned by `loads()` will be valid. The trickery would be in the property setter, not in `__getattr__`.",
    "created_at": "2019-09-23T12:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446962",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:88'></a>
Replying to [SimonKing](#comment%3A13):
> Replying to [SimonKing](#comment%3A10):
> > If the .sobj file's location is not stored as an attribute in Python 3 then I have a problem.

> 
> Hooray:
> 
> ```
> # in Sage-with-python-2
> sage: P = CombinatorialFreeModule(ZZ,'x')
> sage: save(P,'../../pickle')
> ```
> 
> ```
> # BOTH with python-2 and python-3
> sage: B = load('../../pickle.sobj')
> sage: B._default_filename
> '/home/king/Sage/pickle.sobj'
> ```
> So, the old trick should still work.


I wonder if I shouldn't improve the trick.

Currently, if the initialisation of an unpickled object can not be finished, it is the `__getattr__` method that would trigger the completion of initialisation based on the value of `self._default_filename` that is set by Sage's `loads()` after unpickling the object and before returning it.

But what if I turn `_default_filename` into a property? I could make it so that its setter triggers the completion of initialisation, to the effect that the object returned by `loads()` will be valid. The trickery would be in the property setter, not in `__getattr__`.



---

archive/issue_comments_446963.json:
```json
{
    "body": "<a id='comment:89'></a>\nI am puzzled about the appearance of unicode. For example, consider these two lines in my code:\n\n```python\n        root = str(kwds.get('root', COHO.workspace))\n        coho_logger.debug(\"Group data are rooted at %r\", None, root)\n```\nThe logging appears in the following session (in Sage-with-py2, where I first installed the package in Sage-with-py3 and then in Sage-with-py2):\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.doctest_setup()\nsage: CohomologyRing.global_options('debug')\nsage: from pGroupCohomology.cohomology import COHO\nsage: _ = COHO()\n<module>:\n    Group data are rooted at u'/home/king/.sage/temp/klap/6618/dir_T5Im2o/'\n```\nSo, apparently the variable `root` in the code snipped above is a `unicode`, although I **explicitly** converted it to a `str`. Moreover:\n\n```\nsage: COHO.workspace\n'/home/king/.sage/temp/klap/6618/dir_T5Im2o/'\nsage: type(COHO.workspace)\n<type 'str'>\n```\nIn other words: There is an attribute `COHO.workspace` of type `str`, and when I convert it to a `str` then a `unicode` results. WTF???",
    "created_at": "2019-09-24T06:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446963",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:89'></a>
I am puzzled about the appearance of unicode. For example, consider these two lines in my code:

```python
        root = str(kwds.get('root', COHO.workspace))
        coho_logger.debug("Group data are rooted at %r", None, root)
```
The logging appears in the following session (in Sage-with-py2, where I first installed the package in Sage-with-py3 and then in Sage-with-py2):

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.doctest_setup()
sage: CohomologyRing.global_options('debug')
sage: from pGroupCohomology.cohomology import COHO
sage: _ = COHO()
<module>:
    Group data are rooted at u'/home/king/.sage/temp/klap/6618/dir_T5Im2o/'
```
So, apparently the variable `root` in the code snipped above is a `unicode`, although I **explicitly** converted it to a `str`. Moreover:

```
sage: COHO.workspace
'/home/king/.sage/temp/klap/6618/dir_T5Im2o/'
sage: type(COHO.workspace)
<type 'str'>
```
In other words: There is an attribute `COHO.workspace` of type `str`, and when I convert it to a `str` then a `unicode` results. WTF???



---

archive/issue_comments_446964.json:
```json
{
    "body": "<a id='comment:90'></a>\nI don't see a full picture here, as it's unclear which sessions are in py2 and which are in py3.\n\nIt might be that iPython installs some kind of display hook that sets `str` to convert to unicode. There is code in `src/sage/repl/rich_output` that might be doing this.\n\nThat is to say that unicode you see printed might be happening due to on the fly conversion, set up by `DisplayManager`.",
    "created_at": "2019-09-24T08:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446964",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:90'></a>
I don't see a full picture here, as it's unclear which sessions are in py2 and which are in py3.

It might be that iPython installs some kind of display hook that sets `str` to convert to unicode. There is code in `src/sage/repl/rich_output` that might be doing this.

That is to say that unicode you see printed might be happening due to on the fly conversion, set up by `DisplayManager`.



---

archive/issue_comments_446965.json:
```json
{
    "body": "<a id='comment:91'></a>\nReplying to [dimpase](#comment%3A90):\n> I don't see a full picture here, as it's unclear which sessions are in py2 and which are in py3.\n\n\nIs there unicode in py3?\n\nThe common topic is: In some cases I get a TypeError saying that a str was expected, but got unicode. And a log shows that a variable is of type unicode after an EXPLICIT(!) cast to str.\n\nIn all mentioned cases, I proceeded as follows:\n1. Install the package in Sage-with-py2\n2. Install the package in Sage-with-py3\n3. Test in Sage-with-py2\n\nSage-with-py2 and Sage-with-py3 are of course in different folders. What they share: The git repository (but different git worktrees), and DOT_SAGE.\n\nBut it is all very flaky. I just inserted a couple of print statements in my code to investigate more deeply, did the above double-install procedure --- and suddenly the type was str, not unicode.\n\n> It might be that iPython installs some kind of display hook that sets `str` to convert to unicode. There is code in `src/sage/repl/rich_output` that might be doing this.\n\n\nIt is not only the output but the type inside of the code. In some cases, I get a TypeError.",
    "created_at": "2019-09-24T08:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446965",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:91'></a>
Replying to [dimpase](#comment%3A90):
> I don't see a full picture here, as it's unclear which sessions are in py2 and which are in py3.


Is there unicode in py3?

The common topic is: In some cases I get a TypeError saying that a str was expected, but got unicode. And a log shows that a variable is of type unicode after an EXPLICIT(!) cast to str.

In all mentioned cases, I proceeded as follows:
1. Install the package in Sage-with-py2
2. Install the package in Sage-with-py3
3. Test in Sage-with-py2

Sage-with-py2 and Sage-with-py3 are of course in different folders. What they share: The git repository (but different git worktrees), and DOT_SAGE.

But it is all very flaky. I just inserted a couple of print statements in my code to investigate more deeply, did the above double-install procedure --- and suddenly the type was str, not unicode.

> It might be that iPython installs some kind of display hook that sets `str` to convert to unicode. There is code in `src/sage/repl/rich_output` that might be doing this.


It is not only the output but the type inside of the code. In some cases, I get a TypeError.



---

archive/issue_comments_446966.json:
```json
{
    "body": "<a id='comment:92'></a>\nDo you see these errors while running doctests? I gather there is `--nodotsage` option you can use while running tests, so you may try to see whether you can reproduce this without DOT_SAGE. \n\nAnother thing to try is to wipe out DOT_SAGE each time you switch from pyX to py(5-X), and see whether this make the error to go away.",
    "created_at": "2019-09-24T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446966",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:92'></a>
Do you see these errors while running doctests? I gather there is `--nodotsage` option you can use while running tests, so you may try to see whether you can reproduce this without DOT_SAGE. 

Another thing to try is to wipe out DOT_SAGE each time you switch from pyX to py(5-X), and see whether this make the error to go away.



---

archive/issue_comments_446967.json:
```json
{
    "body": "<a id='comment:93'></a>\nanother way to work around this might be just to convert all your strings to unicode.",
    "created_at": "2019-09-24T09:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446967",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:93'></a>
another way to work around this might be just to convert all your strings to unicode.



---

archive/issue_comments_446968.json:
```json
{
    "body": "<a id='comment:94'></a>\nI am afraid that it is currently not possible for anybody else to reproduce the following, because I didn't publish my code yet. But anyway, here is what I did:\n\n1. Insert type information, so that the mentioned code snippet now is\n\n  ```python\n        root = str(kwds.get('root', COHO.workspace))\n        coho_logger.debug(\"Group data are rooted at %r. Type: %r\", None, root, type(root))\n   ```\n2. Install it in py3\n3. Install it in py2\n4. In Py3, run the following:\n\n  ```\n  sage: from pGroupCohomology import CohomologyRing\n  sage: CohomologyRing.doctest_setup()\n  sage: H = CohomologyRing(64,14, from_scratch=True)\n  sage: H.make()\n   ```\n5. In Py2, run the following:\n\n  ```\n  sage: from pGroupCohomology import CohomologyRing\n  sage: from pGroupCohomology.cohomology import COHO\n  sage: CohomologyRing.doctest_setup()\n  sage: CohomologyRing.global_options('debug')\n  sage: _ = COHO()\n  <module>:\n      Group data are rooted at u'/home/king/.sage/temp/klap/14917/dir_20mizE/'. Type: <type 'unicode'>\n   ```\n\nSo, the type REALLY is unicode, even though I did an EXPLICIT conversion to str.\n\nThen, I continued:\n6. Move the old `~/.sage` and create a new one.\n7. Start Sage-with-py2, and repeat the test:\n\n  ```\n  Setting permissions of DOT_SAGE directory so only you can read and write it.\n  sage: from pGroupCohomology import CohomologyRing\n  sage: from pGroupCohomology.cohomology import COHO\n  sage: CohomologyRing.doctest_setup()\n  sage: CohomologyRing.global_options('debug')\n  sage: _ = COHO()\n  <module>:\n      Group data are rooted at u'/home/king/.sage/temp/klap/15112/dir_fYCkwo/'. Type: <type 'unicode'>\n  sage: type(COHO.workspace)\n  <type 'str'>\n  \n   ```\n\nSo, removing DOT_SAGE didn't help. For comparison, do the same in Py3:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: from pGroupCohomology.cohomology import COHO\nsage: CohomologyRing.doctest_setup()\nsage: CohomologyRing.global_options('debug')\nsage: _ = COHO()\n<module>:\n    Group data are rooted at '/home/king/.sage/temp/klap/15493/dir_81mwix3u/'. Type: <class 'str'>\n```\nwhich of course is no surprise, as python-3 has no `unicode`.\n\nNote that the line `_ = COHO()` does not involve taking an old pickle from a repository. It merely creates a new instance of `COHO` and initialises it only to the point where the current workspace is assigned to the attribute `.root`.\n\nSummary: The class attribute `COHO.workspace` is of type str. The dictionary `kwds` is empty. `str(kwds.get('root', COHO.workspace)))` returns the unicode version of `COHO.workspace. I.e., converting a str to a str results in a unicode.",
    "created_at": "2019-09-24T10:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446968",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:94'></a>
I am afraid that it is currently not possible for anybody else to reproduce the following, because I didn't publish my code yet. But anyway, here is what I did:

1. Insert type information, so that the mentioned code snippet now is

  ```python
        root = str(kwds.get('root', COHO.workspace))
        coho_logger.debug("Group data are rooted at %r. Type: %r", None, root, type(root))
   ```
2. Install it in py3
3. Install it in py2
4. In Py3, run the following:

  ```
  sage: from pGroupCohomology import CohomologyRing
  sage: CohomologyRing.doctest_setup()
  sage: H = CohomologyRing(64,14, from_scratch=True)
  sage: H.make()
   ```
5. In Py2, run the following:

  ```
  sage: from pGroupCohomology import CohomologyRing
  sage: from pGroupCohomology.cohomology import COHO
  sage: CohomologyRing.doctest_setup()
  sage: CohomologyRing.global_options('debug')
  sage: _ = COHO()
  <module>:
      Group data are rooted at u'/home/king/.sage/temp/klap/14917/dir_20mizE/'. Type: <type 'unicode'>
   ```

So, the type REALLY is unicode, even though I did an EXPLICIT conversion to str.

Then, I continued:
6. Move the old `~/.sage` and create a new one.
7. Start Sage-with-py2, and repeat the test:

  ```
  Setting permissions of DOT_SAGE directory so only you can read and write it.
  sage: from pGroupCohomology import CohomologyRing
  sage: from pGroupCohomology.cohomology import COHO
  sage: CohomologyRing.doctest_setup()
  sage: CohomologyRing.global_options('debug')
  sage: _ = COHO()
  <module>:
      Group data are rooted at u'/home/king/.sage/temp/klap/15112/dir_fYCkwo/'. Type: <type 'unicode'>
  sage: type(COHO.workspace)
  <type 'str'>
  
   ```

So, removing DOT_SAGE didn't help. For comparison, do the same in Py3:

```
sage: from pGroupCohomology import CohomologyRing
sage: from pGroupCohomology.cohomology import COHO
sage: CohomologyRing.doctest_setup()
sage: CohomologyRing.global_options('debug')
sage: _ = COHO()
<module>:
    Group data are rooted at '/home/king/.sage/temp/klap/15493/dir_81mwix3u/'. Type: <class 'str'>
```
which of course is no surprise, as python-3 has no `unicode`.

Note that the line `_ = COHO()` does not involve taking an old pickle from a repository. It merely creates a new instance of `COHO` and initialises it only to the point where the current workspace is assigned to the attribute `.root`.

Summary: The class attribute `COHO.workspace` is of type str. The dictionary `kwds` is empty. `str(kwds.get('root', COHO.workspace)))` returns the unicode version of `COHO.workspace. I.e., converting a str to a str results in a unicode.



---

archive/issue_comments_446969.json:
```json
{
    "body": "<a id='comment:95'></a>\nJust to document that we are talking about a Heisenbug: I wanted to test whether it is perhaps the case that `str==unicode`. Therefore, I changed the code snippet to\n\n```\n        root = str(kwds.get('root', COHO.workspace))\n        coho_logger.debug(\"Group data are rooted at %r. Type: %r, %r, %r\", None, root, type(root), type(COHO.workspace), str)\n```\n, installed it in py2 (only), and rerun the test in py2:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: from pGroupCohomology.cohomology import COHO\nsage: CohomologyRing.doctest_setup()\nsage: CohomologyRing.global_options('debug')\nsage: _ = COHO()\n<module>:\n    Group data are rooted at '/home/king/.sage/temp/klap/16014/dir_M5saF0/'. Type: <type 'str'>, <type 'str'>, <type 'str'>\n```\nHence, no bug. \"Hooray\".\n\nStart a sage-with-py3-session and do\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing.doctest_setup()\nsage: H = CohomologyRing(64,14, from_scratch=True)\nsage: H.make()\n```\nThe hope was of course that it triggers something. But the test in py2 does not have a unicode problem. \"Hooray\".\n\nBut I am sure that the problem will pop up sooner or later.",
    "created_at": "2019-09-24T10:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446969",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:95'></a>
Just to document that we are talking about a Heisenbug: I wanted to test whether it is perhaps the case that `str==unicode`. Therefore, I changed the code snippet to

```
        root = str(kwds.get('root', COHO.workspace))
        coho_logger.debug("Group data are rooted at %r. Type: %r, %r, %r", None, root, type(root), type(COHO.workspace), str)
```
, installed it in py2 (only), and rerun the test in py2:

```
sage: from pGroupCohomology import CohomologyRing
sage: from pGroupCohomology.cohomology import COHO
sage: CohomologyRing.doctest_setup()
sage: CohomologyRing.global_options('debug')
sage: _ = COHO()
<module>:
    Group data are rooted at '/home/king/.sage/temp/klap/16014/dir_M5saF0/'. Type: <type 'str'>, <type 'str'>, <type 'str'>
```
Hence, no bug. "Hooray".

Start a sage-with-py3-session and do

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing.doctest_setup()
sage: H = CohomologyRing(64,14, from_scratch=True)
sage: H.make()
```
The hope was of course that it triggers something. But the test in py2 does not have a unicode problem. "Hooray".

But I am sure that the problem will pop up sooner or later.



---

archive/issue_comments_446970.json:
```json
{
    "body": "<a id='comment:96'></a>\nTo make sure that this bug doesn't pop up again, I inserted a test whether the python version is less than (2,8) and `root` is of type unicode. In this case, I print some information and then raise a runtime error. I guess it's the best that I can do for now.\n\nAfter recompiling and rerunning the above tests, they went fine again. But sooner or later it will return, and then the diagnostic tests I inserted will perhaps tell more clearly what is happening.",
    "created_at": "2019-09-24T11:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446970",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:96'></a>
To make sure that this bug doesn't pop up again, I inserted a test whether the python version is less than (2,8) and `root` is of type unicode. In this case, I print some information and then raise a runtime error. I guess it's the best that I can do for now.

After recompiling and rerunning the above tests, they went fine again. But sooner or later it will return, and then the diagnostic tests I inserted will perhaps tell more clearly what is happening.



---

archive/issue_comments_446971.json:
```json
{
    "body": "<a id='comment:97'></a>\nOr another idea: Since it is Cython code, I could do `cdef str root = ...`.",
    "created_at": "2019-09-24T11:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446971",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:97'></a>
Or another idea: Since it is Cython code, I could do `cdef str root = ...`.



---

archive/issue_comments_446972.json:
```json
{
    "body": "<a id='comment:98'></a>\nHooray!\n\nThe inserted test already showed something:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: from pGroupCohomology.cohomology import COHO\nsage: CohomologyRing.doctest_setup()\nsage: CohomologyRing.global_options('debug')\nsage: _ = COHO()\nCritical bug in python.\nkwds.get('root', COHO.workspace) is <type 'str'>\nCOHO.workspace is <type 'str'>\nstr=<type 'unicode'>, unicode=<type 'unicode'>\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-5-a303ce041f27> in <module>()\n----> 1 _ = COHO()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()\n\nRuntimeError: An explicit cast to <str> resulted in a unicode object\n```\nAha! For some silly reason, we have `str == unicode`!!\n\nEDIT: The above was printed like this:\n\n```python\n        if (2, 8) > sys.version_info and isinstance(root, unicode):\n            print(\"Critical bug in python.\")\n            print(\"kwds.get('root', COHO.workspace) is %r\"%type(kwds.get('root', COHO.workspace)))\n            print(\"COHO.workspace is %r\"%type(COHO.workspace))\n            print(\"str=%r, unicode=%r\"%(str,unicode))\n            raise RuntimeError(\"An explicit cast to <str> resulted in a unicode object\")\n```",
    "created_at": "2019-09-24T11:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446972",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:98'></a>
Hooray!

The inserted test already showed something:

```
sage: from pGroupCohomology import CohomologyRing
sage: from pGroupCohomology.cohomology import COHO
sage: CohomologyRing.doctest_setup()
sage: CohomologyRing.global_options('debug')
sage: _ = COHO()
Critical bug in python.
kwds.get('root', COHO.workspace) is <type 'str'>
COHO.workspace is <type 'str'>
str=<type 'unicode'>, unicode=<type 'unicode'>
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-5-a303ce041f27> in <module>()
----> 1 _ = COHO()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()

RuntimeError: An explicit cast to <str> resulted in a unicode object
```
Aha! For some silly reason, we have `str == unicode`!!

EDIT: The above was printed like this:

```python
        if (2, 8) > sys.version_info and isinstance(root, unicode):
            print("Critical bug in python.")
            print("kwds.get('root', COHO.workspace) is %r"%type(kwds.get('root', COHO.workspace)))
            print("COHO.workspace is %r"%type(COHO.workspace))
            print("str=%r, unicode=%r"%(str,unicode))
            raise RuntimeError("An explicit cast to <str> resulted in a unicode object")
```



---

archive/issue_comments_446973.json:
```json
{
    "body": "<a id='comment:99'></a>\nHow to cope with it? Shall I test upon importing of the module whether `str == unicode` in Python-2, and raise an error whose message tells to recompile?",
    "created_at": "2019-09-24T11:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446973",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:99'></a>
How to cope with it? Shall I test upon importing of the module whether `str == unicode` in Python-2, and raise an error whose message tells to recompile?



---

archive/issue_comments_446974.json:
```json
{
    "body": "<a id='comment:0'></a>\nSo, would this still pop up if right before running these tests you removed `~/.sage/` ?",
    "created_at": "2019-09-24T12:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446974",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
So, would this still pop up if right before running these tests you removed `~/.sage/` ?



---

archive/issue_comments_446975.json:
```json
{
    "body": "<a id='comment:101'></a>\nReplying to [dimpase](#comment%3A100):\n> So, would this still pop up if right before running these tests you removed `~/.sage/` ?\n\n\nSee [comment:94](#comment%3A94). There, it didn't help. Now, it doesn't either:\n\n```\nking@klap:~/Sage/git$ mv ~/.sage/ ~/.sageBAK\nking@klap:~/Sage/git$ mkdir ~/.sage\nking@klap:~/Sage/git$ sage/sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.9.beta8, Release Date: 2019-08-25               \u2502\n\u2502 Using Python 2.7.15. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nSetting permissions of DOT_SAGE directory so only you can read and write it.\nsage: from pGroupCohomology import CohomologyRing\nsage: from pGroupCohomology.cohomology import COHO\nsage: CohomologyRing.doctest_setup()\nsage: CohomologyRing.global_options('debug')\nsage: _ = COHO()\nCritical bug in python.\nkwds.get('root', COHO.workspace) is <type 'str'>\nCOHO.workspace is <type 'str'>\nstr=<type 'unicode'>, unicode=<type 'unicode'>\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-5-a303ce041f27> in <module>()\n----> 1 _ = COHO()\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()\n\nRuntimeError: An explicit cast to <str> resulted in a unicode object\n```",
    "created_at": "2019-09-24T12:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446975",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:101'></a>
Replying to [dimpase](#comment%3A100):
> So, would this still pop up if right before running these tests you removed `~/.sage/` ?


See [comment:94](#comment%3A94). There, it didn't help. Now, it doesn't either:

```
king@klap:~/Sage/git$ mv ~/.sage/ ~/.sageBAK
king@klap:~/Sage/git$ mkdir ~/.sage
king@klap:~/Sage/git$ sage/sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.9.beta8, Release Date: 2019-08-25               │
│ Using Python 2.7.15. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
Setting permissions of DOT_SAGE directory so only you can read and write it.
sage: from pGroupCohomology import CohomologyRing
sage: from pGroupCohomology.cohomology import COHO
sage: CohomologyRing.doctest_setup()
sage: CohomologyRing.global_options('debug')
sage: _ = COHO()
Critical bug in python.
kwds.get('root', COHO.workspace) is <type 'str'>
COHO.workspace is <type 'str'>
str=<type 'unicode'>, unicode=<type 'unicode'>
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-5-a303ce041f27> in <module>()
----> 1 _ = COHO()

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__init__()

RuntimeError: An explicit cast to <str> resulted in a unicode object
```



---

archive/issue_comments_446976.json:
```json
{
    "body": "<a id='comment:2'></a>\nI wonder if the problem occurs because I am not installing the development versions of my package from an actual \"package\" (using `sage -i p_group_cohomology`), but directly from the sources. I.e., in the `src` folder of my development tree, I do\n\n```\nsage -python setup.py build\nsage -pip install . --upgrade\n```\nI know that `sage -python setup.py build` does create .c files in the src folder, but since the changed module is recompiled both in py2 and py3, I thought that it doesn't matter. And for efficiency, I want that only modules are recompiled that have changed.\n\nSo, I would like to test if the problem persists when separating the py2- and py3 build folders. When doing `sage -python setup.py build`, is it somehow possible to prescribe in what folder the `.c` and `.pyc` files are created? Then, I could choose separate folders for py2 and py3.",
    "created_at": "2019-09-24T13:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446976",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
I wonder if the problem occurs because I am not installing the development versions of my package from an actual "package" (using `sage -i p_group_cohomology`), but directly from the sources. I.e., in the `src` folder of my development tree, I do

```
sage -python setup.py build
sage -pip install . --upgrade
```
I know that `sage -python setup.py build` does create .c files in the src folder, but since the changed module is recompiled both in py2 and py3, I thought that it doesn't matter. And for efficiency, I want that only modules are recompiled that have changed.

So, I would like to test if the problem persists when separating the py2- and py3 build folders. When doing `sage -python setup.py build`, is it somehow possible to prescribe in what folder the `.c` and `.pyc` files are created? Then, I could choose separate folders for py2 and py3.



---

archive/issue_comments_446977.json:
```json
{
    "body": "<a id='comment:3'></a>\nI am now putting `cythonize(..., build_dir=os.path.join(\"build\",\"c_files-{}.{}\".format(version_info.major, version_info.minor)))` into my `setup.py`. In that way, the c-files will be created in separate directories for both Sage versions.\n\nLet's see if this is enough to solve the problem!",
    "created_at": "2019-09-24T14:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446977",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
I am now putting `cythonize(..., build_dir=os.path.join("build","c_files-{}.{}".format(version_info.major, version_info.minor)))` into my `setup.py`. In that way, the c-files will be created in separate directories for both Sage versions.

Let's see if this is enough to solve the problem!



---

archive/issue_comments_446978.json:
```json
{
    "body": "<a id='comment:4'></a>\nPS: Even if it solves the problem, I will test upon import whether str is unicode in py2, and if it is, raise a `RuntimeError` advising to recompile. I hope this error will never pop up...",
    "created_at": "2019-09-24T17:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446978",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>
PS: Even if it solves the problem, I will test upon import whether str is unicode in py2, and if it is, raise a `RuntimeError` advising to recompile. I hope this error will never pop up...



---

archive/issue_comments_446979.json:
```json
{
    "body": "<a id='comment:5'></a>\nAfter changing setup.py so that the .c files will be in different folders for different python versions, tests in cohomology.pyx pass both with py2 and py3 and then py2 again. So, I can now turn to modular_cohomology.pyx and finally __init__.py (which contains a long doc string, namely the \"general overview\" of the package).",
    "created_at": "2019-09-24T19:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446979",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
After changing setup.py so that the .c files will be in different folders for different python versions, tests in cohomology.pyx pass both with py2 and py3 and then py2 again. So, I can now turn to modular_cohomology.pyx and finally __init__.py (which contains a long doc string, namely the "general overview" of the package).



---

archive/issue_comments_446980.json:
```json
{
    "body": "<a id='comment:6'></a>\nHooray! When I ran `sage -tp 2 --force-lib --long --warn-long 60.1`, all tests passed both in python 2 and python 3. I don't know how significant the run time differences are. In any case, here are the details:\n\n```\nPython-3\n========\nRunning doctests with ID 2019-09-25-00-50-30-78efa273.\nUsing --optional=build,dochtml,gap_packages,libsemigroups,meataxe,memlimit,mpir,python2,sage\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 13 files using 2 threads.\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx\n    [1481 tests, 350.33 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cohomology.pyx\n    [1445 tests, 363.25 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py\n**********************************************************************\nFile \"/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py\", line 67, in pGroupCohomology.isomorphism_test.IsomorphismTest\nWarning, slow doctest:\n    T.explore_isomorphisms()        # long time\nTest ran for 122.79 s\n    [213 tests, 221.05 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/modular_cohomology.pyx\n    [459 tests, 274.13 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/factory.py\n    [229 tests, 126.99 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/__init__.py\n    [343 tests, 96.76 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/dickson.pyx\n    [28 tests, 1.53 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/auxiliaries.py\n    [39 tests, 0.79 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/barcode.py\n    [143 tests, 10.31 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution_bindings.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pyx\n    [882 tests, 22.95 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 765.7 seconds\n    cpu time: 939.6 seconds\n    cumulative wall time: 1468.1 seconds\n\nPython-2\n========\nRunning doctests with ID 2019-09-25-01-04-47-fa1de7f4.\nGit branch: matrix_implementation_keyword\nUsing --optional=build,ccache,dochtml,frobby,gap_packages,gdb,gfortran,libsemigroups,meataxe,memlimit,mpir,p_group_cohomology,python2,sage\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 13 files using 2 threads.\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx\n    [1481 tests, 437.44 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cohomology.pyx\n    [1445 tests, 465.15 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py\n**********************************************************************\nFile \"/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py\", line 67, in pGroupCohomology.isomorphism_test.IsomorphismTest\nWarning, slow doctest:\n    T.explore_isomorphisms()        # long time\nTest ran for 116.79 s\n    [213 tests, 229.85 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/modular_cohomology.pyx\n    [459 tests, 312.40 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/factory.py\n    [229 tests, 124.88 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/__init__.py\n    [343 tests, 96.86 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pyx\n    [882 tests, 21.38 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/dickson.pyx\n    [28 tests, 1.63 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/auxiliaries.py\n    [39 tests, 0.78 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution_bindings.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/barcode.py\n    [143 tests, 14.90 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 873.5 seconds\n    cpu time: 996.8 seconds\n    cumulative wall time: 1705.3 seconds\n```\n\nHence, tomorrow (i.e., in central European time, today in a few hours `:-)`) I will create a new package version and post it here for review.",
    "created_at": "2019-09-24T23:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446980",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
Hooray! When I ran `sage -tp 2 --force-lib --long --warn-long 60.1`, all tests passed both in python 2 and python 3. I don't know how significant the run time differences are. In any case, here are the details:

```
Python-3
========
Running doctests with ID 2019-09-25-00-50-30-78efa273.
Using --optional=build,dochtml,gap_packages,libsemigroups,meataxe,memlimit,mpir,python2,sage
Sorting sources by runtime so that slower doctests are run first....
Doctesting 13 files using 2 threads.
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx
    [1481 tests, 350.33 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cohomology.pyx
    [1445 tests, 363.25 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py
**********************************************************************
File "/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py", line 67, in pGroupCohomology.isomorphism_test.IsomorphismTest
Warning, slow doctest:
    T.explore_isomorphisms()        # long time
Test ran for 122.79 s
    [213 tests, 221.05 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/modular_cohomology.pyx
    [459 tests, 274.13 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/factory.py
    [229 tests, 126.99 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/__init__.py
    [343 tests, 96.76 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/dickson.pyx
    [28 tests, 1.53 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/auxiliaries.py
    [39 tests, 0.79 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/barcode.py
    [143 tests, 10.31 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution_bindings.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pyx
    [882 tests, 22.95 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 765.7 seconds
    cpu time: 939.6 seconds
    cumulative wall time: 1468.1 seconds

Python-2
========
Running doctests with ID 2019-09-25-01-04-47-fa1de7f4.
Git branch: matrix_implementation_keyword
Using --optional=build,ccache,dochtml,frobby,gap_packages,gdb,gfortran,libsemigroups,meataxe,memlimit,mpir,p_group_cohomology,python2,sage
Sorting sources by runtime so that slower doctests are run first....
Doctesting 13 files using 2 threads.
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pyx
    [1481 tests, 437.44 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cochain.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/cohomology.pyx
    [1445 tests, 465.15 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py
**********************************************************************
File "/home/king/Projekte/coho/coho-devel/src/pGroupCohomology/isomorphism_test.py", line 67, in pGroupCohomology.isomorphism_test.IsomorphismTest
Warning, slow doctest:
    T.explore_isomorphisms()        # long time
Test ran for 116.79 s
    [213 tests, 229.85 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/modular_cohomology.pyx
    [459 tests, 312.40 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/factory.py
    [229 tests, 124.88 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/__init__.py
    [343 tests, 96.86 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution.pyx
    [882 tests, 21.38 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/dickson.pyx
    [28 tests, 1.63 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/auxiliaries.py
    [39 tests, 0.78 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/resolution_bindings.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 60.1 /home/king/Projekte/coho/coho-devel/src/pGroupCohomology/barcode.py
    [143 tests, 14.90 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 873.5 seconds
    cpu time: 996.8 seconds
    cumulative wall time: 1705.3 seconds
```

Hence, tomorrow (i.e., in central European time, today in a few hours `:-)`) I will create a new package version and post it here for review.



---

archive/issue_comments_446981.json:
```json
{
    "body": "<a id='comment:7'></a>\nSomething more to do: I think I should add a test showing what happens when moving the directory associated with a cohomology ring. The package can cope with moved data, based on some trickery in the attribute `_default_filename` that is defined by Sage's unpickler. I've turned `_default_filename` into a property (with getter, setter and deleter), and its documentation should contain the new test.",
    "created_at": "2019-09-24T23:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446981",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
Something more to do: I think I should add a test showing what happens when moving the directory associated with a cohomology ring. The package can cope with moved data, based on some trickery in the attribute `_default_filename` that is defined by Sage's unpickler. I've turned `_default_filename` into a property (with getter, setter and deleter), and its documentation should contain the new test.



---

archive/issue_comments_446982.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm afraid that another test failure popped up. So, I cannot post the new version yet.",
    "created_at": "2019-09-25T17:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446982",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
I'm afraid that another test failure popped up. So, I cannot post the new version yet.



---

archive/issue_comments_446983.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,21 +1,3 @@\n+The aim of this ticket is to provide a new version of the optional `p_group_cohomology` spkg so that it builds and passes tests both with python-2 and python-3.\n \n-```\n-[p_group_cohomology-3.2] Installing p_group_cohomology-3.2\n-[p_group_cohomology-3.2] \n-[p_group_cohomology-3.2] Error compiling Cython file:\n-[p_group_cohomology-3.2] ------------------------------------------------------------\n-[p_group_cohomology-3.2] ...\n-[p_group_cohomology-3.2]     ## If it doesn't, then we need to find out *after* loading\n-[p_group_cohomology-3.2]     second_cache_attempt = False\n-[p_group_cohomology-3.2]     if not coho_options.has_key('@newroot@'):\n-[p_group_cohomology-3.2]         try:\n-[p_group_cohomology-3.2]             OUT = _cache.get((GroupKey,StateFile)) or _cache.get((GroupKey,StateFile[:-5]))\n-[p_group_cohomology-3.2]         except StandardError, msg:\n-[p_group_cohomology-3.2]               ^\n-[p_group_cohomology-3.2] ------------------------------------------------------------\n-[p_group_cohomology-3.2] \n-[p_group_cohomology-3.2] pGroupCohomology/cohomology.pyx:160:15: undeclared name not builtin: StandardError\n-[p_group_cohomology-3.2] \n-```\n-`StandardError` has been removed in Python3.\n-Cf. e.g. http://python3porting.com/differences.html#standarderror\n+Hopefully the version number 3.3 (two times three) is appropriate.\n``````\n",
    "created_at": "2019-09-25T17:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446983",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,21 +1,3 @@
+The aim of this ticket is to provide a new version of the optional `p_group_cohomology` spkg so that it builds and passes tests both with python-2 and python-3.
 
-```
-[p_group_cohomology-3.2] Installing p_group_cohomology-3.2
-[p_group_cohomology-3.2] 
-[p_group_cohomology-3.2] Error compiling Cython file:
-[p_group_cohomology-3.2] ------------------------------------------------------------
-[p_group_cohomology-3.2] ...
-[p_group_cohomology-3.2]     ## If it doesn't, then we need to find out *after* loading
-[p_group_cohomology-3.2]     second_cache_attempt = False
-[p_group_cohomology-3.2]     if not coho_options.has_key('@newroot@'):
-[p_group_cohomology-3.2]         try:
-[p_group_cohomology-3.2]             OUT = _cache.get((GroupKey,StateFile)) or _cache.get((GroupKey,StateFile[:-5]))
-[p_group_cohomology-3.2]         except StandardError, msg:
-[p_group_cohomology-3.2]               ^
-[p_group_cohomology-3.2] ------------------------------------------------------------
-[p_group_cohomology-3.2] 
-[p_group_cohomology-3.2] pGroupCohomology/cohomology.pyx:160:15: undeclared name not builtin: StandardError
-[p_group_cohomology-3.2] 
-```
-`StandardError` has been removed in Python3.
-Cf. e.g. http://python3porting.com/differences.html#standarderror
+Hopefully the version number 3.3 (two times three) is appropriate.
``````




---

archive/issue_comments_446984.json:
```json
{
    "body": "<a id='comment:9'></a>\nAfter fixing the failed test (in which I forgot to save something before loading it), I added a new feature to `unit_test_64`: Previously it was only tested whether the generator degrees and the Poincar\u00e9 series of a freshly computed cohomology ring is consistent with what is stored in the database; now I test whether the new ring and the stored ring are isomorphic.\n\nIndeed they are, for all groups of order 64. More precisely: In many cases the generators of the relation ideal are not identical. But in all cases, mapping the i-th generator of the new ring to the i-th generator of the old ring results in an isomorphism.\n\nThere is one remaining py3 issue, though: When I try to build the documentation, I get the error \"No module named sphinx\". The documentation does build, when I use py2. What can I do to fix it in py3?\n\nEDIT: Is it not the case that sphinx is installed in Sage for building its documentation, both in py2 and py3? I am not sure if I ever tried to build the documentation of Sage-with-py3, though. Will sphinx be installed when I do a plain `make` in Sage (i.e., when I build the docs)?",
    "created_at": "2019-09-25T23:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446984",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>
After fixing the failed test (in which I forgot to save something before loading it), I added a new feature to `unit_test_64`: Previously it was only tested whether the generator degrees and the Poincaré series of a freshly computed cohomology ring is consistent with what is stored in the database; now I test whether the new ring and the stored ring are isomorphic.

Indeed they are, for all groups of order 64. More precisely: In many cases the generators of the relation ideal are not identical. But in all cases, mapping the i-th generator of the new ring to the i-th generator of the old ring results in an isomorphism.

There is one remaining py3 issue, though: When I try to build the documentation, I get the error "No module named sphinx". The documentation does build, when I use py2. What can I do to fix it in py3?

EDIT: Is it not the case that sphinx is installed in Sage for building its documentation, both in py2 and py3? I am not sure if I ever tried to build the documentation of Sage-with-py3, though. Will sphinx be installed when I do a plain `make` in Sage (i.e., when I build the docs)?



---

archive/issue_comments_446985.json:
```json
{
    "body": "<a id='comment:0'></a>\nSphinx should be installed, yes. Look for `SAGE_ROOT/local/lib/python3.7/site-packages/sphinx/`. If you run Sage, can you `import sphinx`?\n\nEdit: this is for a Python 3 build of Sage.",
    "created_at": "2019-09-25T23:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446985",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:0'></a>
Sphinx should be installed, yes. Look for `SAGE_ROOT/local/lib/python3.7/site-packages/sphinx/`. If you run Sage, can you `import sphinx`?

Edit: this is for a Python 3 build of Sage.



---

archive/issue_comments_446986.json:
```json
{
    "body": "<a id='comment:111'></a>\nReplying to [jhpalmieri](#comment%3A110):\n> Sphinx should be installed, yes. Look for `SAGE_ROOT/local/lib/python3.7/site-packages/sphinx/`. If you run Sage, can you `import sphinx`?\n\n\nIt was a trivial mistake: In the doc's Makefile, I had `SPHINXBUILD   = python -msphinx`, but since python means python-2 even in a py3-install of Sage, I have to use `SPHINXBUILD   = sage -python -msphinx`",
    "created_at": "2019-09-26T06:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446986",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:111'></a>
Replying to [jhpalmieri](#comment%3A110):
> Sphinx should be installed, yes. Look for `SAGE_ROOT/local/lib/python3.7/site-packages/sphinx/`. If you run Sage, can you `import sphinx`?


It was a trivial mistake: In the doc's Makefile, I had `SPHINXBUILD   = python -msphinx`, but since python means python-2 even in a py3-install of Sage, I have to use `SPHINXBUILD   = sage -python -msphinx`



---

archive/issue_comments_446987.json:
```json
{
    "body": "**Branch:** [u/SimonKing/p_group_cohomology_in_py_3](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/p_group_cohomology_in_py_3)",
    "created_at": "2019-09-26T07:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446987",
    "user": "https://github.com/simon-king-jena"
}
```

**Branch:** [u/SimonKing/p_group_cohomology_in_py_3](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/p_group_cohomology_in_py_3)



---

archive/issue_events_255787.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-09-26T07:05:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255787"
}
```



---

archive/issue_comments_446988.json:
```json
{
    "body": "<a id='comment:3'></a>\nI checked that the package builds and passes tests in Sage-with-py3. I checked that when running the tests directly on the sources (not during package installation) the tests pass in Sage-with-py2. I recommend that whoever reviews this tries the package both in py2 and in py3.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e0d11e758f4565b718f4cdf8f957fa6ef6b8d7d\">2e0d11e</a></td><td><code>Pass unpickling options to pickle.load, default encoding 'latin1'. Accept both str and bytes in mtx_unpickle</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c105cdcada53eed019bba4f4d26cf7fe7e72c22\">8c105cd</a></td><td><code>Make str_to_bytes/bytes_to_str accept both str and bytes input.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8a074883997bfdd5afde3065c4a33002914999b\">c8a0748</a></td><td><code>Add tests for #28444</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89ac77aa44fd3bab4399791fa72e088a52058a8e\">89ac77a</a></td><td><code>Fix keyword for py3-only test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36930248d6df66a94fe8a86d411e9105595eb8e9\">3693024</a></td><td><code>Fix doc strings in sage.misc.persist</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0828eea650db44b6a5fd6c8f16a8382ff82f04a\">f0828ee</a></td><td><code>Add a comment regarding the expected data type for an unpickle helper</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba41ebee5b46fb2fb72eae988678ab0579309dc5\">ba41ebe</a></td><td><code>Fix two typos in a comment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/463806c6cebb3120e20df0f19a216dd529553741\">463806c</a></td><td><code>Upgrade p_group_cohomology to version 3.3</code></td></tr></table>\n",
    "created_at": "2019-09-26T07:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446988",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
I checked that the package builds and passes tests in Sage-with-py3. I checked that when running the tests directly on the sources (not during package installation) the tests pass in Sage-with-py2. I recommend that whoever reviews this tries the package both in py2 and in py3.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e0d11e758f4565b718f4cdf8f957fa6ef6b8d7d">2e0d11e</a></td><td><code>Pass unpickling options to pickle.load, default encoding 'latin1'. Accept both str and bytes in mtx_unpickle</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c105cdcada53eed019bba4f4d26cf7fe7e72c22">8c105cd</a></td><td><code>Make str_to_bytes/bytes_to_str accept both str and bytes input.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8a074883997bfdd5afde3065c4a33002914999b">c8a0748</a></td><td><code>Add tests for #28444</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89ac77aa44fd3bab4399791fa72e088a52058a8e">89ac77a</a></td><td><code>Fix keyword for py3-only test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36930248d6df66a94fe8a86d411e9105595eb8e9">3693024</a></td><td><code>Fix doc strings in sage.misc.persist</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0828eea650db44b6a5fd6c8f16a8382ff82f04a">f0828ee</a></td><td><code>Add a comment regarding the expected data type for an unpickle helper</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba41ebee5b46fb2fb72eae988678ab0579309dc5">ba41ebe</a></td><td><code>Fix two typos in a comment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/463806c6cebb3120e20df0f19a216dd529553741">463806c</a></td><td><code>Upgrade p_group_cohomology to version 3.3</code></td></tr></table>




---

archive/issue_comments_446989.json:
```json
{
    "body": "**Commit:** [463806c6cebb3120e20df0f19a216dd529553741](https://github.com/sagemath/sagetrac-mirror/commit/463806c6cebb3120e20df0f19a216dd529553741)",
    "created_at": "2019-09-26T07:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446989",
    "user": "https://github.com/simon-king-jena"
}
```

**Commit:** [463806c6cebb3120e20df0f19a216dd529553741](https://github.com/sagemath/sagetrac-mirror/commit/463806c6cebb3120e20df0f19a216dd529553741)



---

archive/issue_comments_446990.json:
```json
{
    "body": "**Author:** Simon King",
    "created_at": "2019-09-26T07:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446990",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Simon King



---

archive/issue_comments_446991.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n The aim of this ticket is to provide a new version of the optional `p_group_cohomology` spkg so that it builds and passes tests both with python-2 and python-3.\n \n Hopefully the version number 3.3 (two times three) is appropriate.\n+\n+[Package documentation](https://users.fmi.uni-jena.de/cohomology/documentation/)\n+\n+[Source ball](https://users.fmi.uni-jena.de/cohomology/p_group_cohomology-3.3.tar.xz)\n``````\n",
    "created_at": "2019-09-26T07:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446991",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 The aim of this ticket is to provide a new version of the optional `p_group_cohomology` spkg so that it builds and passes tests both with python-2 and python-3.
 
 Hopefully the version number 3.3 (two times three) is appropriate.
+
+[Package documentation](https://users.fmi.uni-jena.de/cohomology/documentation/)
+
+[Source ball](https://users.fmi.uni-jena.de/cohomology/p_group_cohomology-3.3.tar.xz)
``````




---

archive/issue_comments_446992.json:
```json
{
    "body": "<a id='comment:4'></a>\nHooray! In Py2, `sage -f -c p_group_cohomology` results in\n\n```\n...\n[p_group_cohomology-3.3] Running the test suite for p_group_cohomology-3.3...\n[p_group_cohomology-3.3] make[2]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'\n[p_group_cohomology-3.3] Making check in src\n[p_group_cohomology-3.3] make[3]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] make  mnttest.sh\n[p_group_cohomology-3.3] make[4]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] test -r ./test.reg || cp ./test.reg .\n[p_group_cohomology-3.3] make[4]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] make  check-TESTS\n[p_group_cohomology-3.3] make[4]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] make[5]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] PASS: mnttest.sh\n[p_group_cohomology-3.3] ============================================================================\n[p_group_cohomology-3.3] Testsuite summary for modular_resolution 1.1\n[p_group_cohomology-3.3] ============================================================================\n[p_group_cohomology-3.3] # TOTAL: 1\n[p_group_cohomology-3.3] # PASS:  1\n[p_group_cohomology-3.3] # SKIP:  0\n[p_group_cohomology-3.3] # XFAIL: 0\n[p_group_cohomology-3.3] # FAIL:  0\n[p_group_cohomology-3.3] # XPASS: 0\n[p_group_cohomology-3.3] # ERROR: 0\n[p_group_cohomology-3.3] ============================================================================\n[p_group_cohomology-3.3] make[5]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] make[4]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] make[3]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'\n[p_group_cohomology-3.3] make[3]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'\n[p_group_cohomology-3.3] make[3]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'\n[p_group_cohomology-3.3] make[2]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'\n[p_group_cohomology-3.3] Running doctests with ID 2019-09-26-11-19-11-b01ece2b.\n[p_group_cohomology-3.3] Git branch: t/28414/p_group_cohomology_in_py_3\n[p_group_cohomology-3.3] Using --optional=build,ccache,dochtml,frobby,gap_packages,gdb,gfortran,libsemigroups,meataxe,memlimit,mpir,python2,sage\n[p_group_cohomology-3.3] Sorting sources by runtime so that slower doctests are run first....\n[p_group_cohomology-3.3] Doctesting 13 files using 3 threads.\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/modular_cohomology.pyx\n[p_group_cohomology-3.3]     [459 tests, 456.02 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/cochain.pxd\n[p_group_cohomology-3.3]     [0 tests, 0.00 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/cochain.pyx\n[p_group_cohomology-3.3]     [1481 tests, 599.35 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/cohomology.pyx\n[p_group_cohomology-3.3]     [1465 tests, 606.86 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/isomorphism_test.py\n[p_group_cohomology-3.3] **********************************************************************\n[p_group_cohomology-3.3] File \"pGroupCohomology-3.3/pGroupCohomology/isomorphism_test.py\", line 67, in pGroupCohomology.isomorphism_test.IsomorphismTest\n[p_group_cohomology-3.3] Warning, slow doctest:\n[p_group_cohomology-3.3]     T.explore_isomorphisms()        # long time\n[p_group_cohomology-3.3] Test ran for 161.47 s\n[p_group_cohomology-3.3]     [213 tests, 307.72 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/__init__.py\n[p_group_cohomology-3.3]     [343 tests, 148.33 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/factory.py\n[p_group_cohomology-3.3] **********************************************************************\n[p_group_cohomology-3.3] File \"pGroupCohomology-3.3/pGroupCohomology/factory.py\", line 133, in pGroupCohomology.factory.unit_test_64\n[p_group_cohomology-3.3] Warning, slow doctest:\n[p_group_cohomology-3.3]     L, t = unit_test_64(from_scratch=False)    # long time\n[p_group_cohomology-3.3] Test ran for 99.46 s\n[p_group_cohomology-3.3]     [229 tests, 209.64 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/resolution.pxd\n[p_group_cohomology-3.3]     [0 tests, 0.00 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/resolution.pyx\n[p_group_cohomology-3.3]     [882 tests, 26.85 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/dickson.pyx\n[p_group_cohomology-3.3]     [28 tests, 1.41 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/barcode.py\n[p_group_cohomology-3.3]     [143 tests, 21.04 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/resolution_bindings.pxd\n[p_group_cohomology-3.3]     [0 tests, 0.00 s]\n[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/auxiliaries.py\n[p_group_cohomology-3.3]     [39 tests, 0.92 s]\n[p_group_cohomology-3.3] ----------------------------------------------------------------------\n[p_group_cohomology-3.3] All tests passed!\n[p_group_cohomology-3.3] ----------------------------------------------------------------------\n[p_group_cohomology-3.3] Total time for all tests: 815.2 seconds\n[p_group_cohomology-3.3]     cpu time: 1261.3 seconds\n[p_group_cohomology-3.3]     cumulative wall time: 2378.1 seconds\n[p_group_cohomology-3.3] \n[p_group_cohomology-3.3] real\t13m52.051s\n[p_group_cohomology-3.3] user\t22m48.984s\n[p_group_cohomology-3.3] sys\t4m1.098s\n[p_group_cohomology-3.3] Successfully installed p_group_cohomology-3.3\n[p_group_cohomology-3.3] Deleting temporary build directory\n[p_group_cohomology-3.3] /home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3\n[p_group_cohomology-3.3] Finished installing p_group_cohomology-3.3.spkg\nmake[1]: Leaving directory '/home/king/Sage/git/sage/build/make'\n\nreal\t27m19.468s\nuser\t30m7.398s\nsys\t4m10.930s\nSage build/upgrade complete!\n```\nIn Py3, I had more warnings about slow tests (six instead of two, if I recall correctly), but perhaps my laptop (or its harddisk) was busy with other things.\n\nNow I am running `unit_test_64` in Python-2. Note that in Python-3 I got about 20 (or even more) examples where the freshly computed relation ideal was presented by a different set of generators than what was stored in the database. But, as I have mentioned in [comment:82](#comment%3A82), this seems to be Singular not doing all tail reduction in py2.",
    "created_at": "2019-09-26T09:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446992",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>
Hooray! In Py2, `sage -f -c p_group_cohomology` results in

```
...
[p_group_cohomology-3.3] Running the test suite for p_group_cohomology-3.3...
[p_group_cohomology-3.3] make[2]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'
[p_group_cohomology-3.3] Making check in src
[p_group_cohomology-3.3] make[3]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] make  mnttest.sh
[p_group_cohomology-3.3] make[4]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] test -r ./test.reg || cp ./test.reg .
[p_group_cohomology-3.3] make[4]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] make  check-TESTS
[p_group_cohomology-3.3] make[4]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] make[5]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] PASS: mnttest.sh
[p_group_cohomology-3.3] ============================================================================
[p_group_cohomology-3.3] Testsuite summary for modular_resolution 1.1
[p_group_cohomology-3.3] ============================================================================
[p_group_cohomology-3.3] # TOTAL: 1
[p_group_cohomology-3.3] # PASS:  1
[p_group_cohomology-3.3] # SKIP:  0
[p_group_cohomology-3.3] # XFAIL: 0
[p_group_cohomology-3.3] # FAIL:  0
[p_group_cohomology-3.3] # XPASS: 0
[p_group_cohomology-3.3] # ERROR: 0
[p_group_cohomology-3.3] ============================================================================
[p_group_cohomology-3.3] make[5]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] make[4]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] make[3]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1/src'
[p_group_cohomology-3.3] make[3]: Entering directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'
[p_group_cohomology-3.3] make[3]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'
[p_group_cohomology-3.3] make[2]: Leaving directory '/home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3/src/modular_resolution-1.1'
[p_group_cohomology-3.3] Running doctests with ID 2019-09-26-11-19-11-b01ece2b.
[p_group_cohomology-3.3] Git branch: t/28414/p_group_cohomology_in_py_3
[p_group_cohomology-3.3] Using --optional=build,ccache,dochtml,frobby,gap_packages,gdb,gfortran,libsemigroups,meataxe,memlimit,mpir,python2,sage
[p_group_cohomology-3.3] Sorting sources by runtime so that slower doctests are run first....
[p_group_cohomology-3.3] Doctesting 13 files using 3 threads.
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/modular_cohomology.pyx
[p_group_cohomology-3.3]     [459 tests, 456.02 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/cochain.pxd
[p_group_cohomology-3.3]     [0 tests, 0.00 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/cochain.pyx
[p_group_cohomology-3.3]     [1481 tests, 599.35 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/cohomology.pyx
[p_group_cohomology-3.3]     [1465 tests, 606.86 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/isomorphism_test.py
[p_group_cohomology-3.3] **********************************************************************
[p_group_cohomology-3.3] File "pGroupCohomology-3.3/pGroupCohomology/isomorphism_test.py", line 67, in pGroupCohomology.isomorphism_test.IsomorphismTest
[p_group_cohomology-3.3] Warning, slow doctest:
[p_group_cohomology-3.3]     T.explore_isomorphisms()        # long time
[p_group_cohomology-3.3] Test ran for 161.47 s
[p_group_cohomology-3.3]     [213 tests, 307.72 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/__init__.py
[p_group_cohomology-3.3]     [343 tests, 148.33 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/factory.py
[p_group_cohomology-3.3] **********************************************************************
[p_group_cohomology-3.3] File "pGroupCohomology-3.3/pGroupCohomology/factory.py", line 133, in pGroupCohomology.factory.unit_test_64
[p_group_cohomology-3.3] Warning, slow doctest:
[p_group_cohomology-3.3]     L, t = unit_test_64(from_scratch=False)    # long time
[p_group_cohomology-3.3] Test ran for 99.46 s
[p_group_cohomology-3.3]     [229 tests, 209.64 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/resolution.pxd
[p_group_cohomology-3.3]     [0 tests, 0.00 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/resolution.pyx
[p_group_cohomology-3.3]     [882 tests, 26.85 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/dickson.pyx
[p_group_cohomology-3.3]     [28 tests, 1.41 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/barcode.py
[p_group_cohomology-3.3]     [143 tests, 21.04 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/resolution_bindings.pxd
[p_group_cohomology-3.3]     [0 tests, 0.00 s]
[p_group_cohomology-3.3] sage -t --long --warn-long 80.0 pGroupCohomology-3.3/pGroupCohomology/auxiliaries.py
[p_group_cohomology-3.3]     [39 tests, 0.92 s]
[p_group_cohomology-3.3] ----------------------------------------------------------------------
[p_group_cohomology-3.3] All tests passed!
[p_group_cohomology-3.3] ----------------------------------------------------------------------
[p_group_cohomology-3.3] Total time for all tests: 815.2 seconds
[p_group_cohomology-3.3]     cpu time: 1261.3 seconds
[p_group_cohomology-3.3]     cumulative wall time: 2378.1 seconds
[p_group_cohomology-3.3] 
[p_group_cohomology-3.3] real	13m52.051s
[p_group_cohomology-3.3] user	22m48.984s
[p_group_cohomology-3.3] sys	4m1.098s
[p_group_cohomology-3.3] Successfully installed p_group_cohomology-3.3
[p_group_cohomology-3.3] Deleting temporary build directory
[p_group_cohomology-3.3] /home/king/Sage/git/sage/local/var/tmp/sage/build/p_group_cohomology-3.3
[p_group_cohomology-3.3] Finished installing p_group_cohomology-3.3.spkg
make[1]: Leaving directory '/home/king/Sage/git/sage/build/make'

real	27m19.468s
user	30m7.398s
sys	4m10.930s
Sage build/upgrade complete!
```
In Py3, I had more warnings about slow tests (six instead of two, if I recall correctly), but perhaps my laptop (or its harddisk) was busy with other things.

Now I am running `unit_test_64` in Python-2. Note that in Python-3 I got about 20 (or even more) examples where the freshly computed relation ideal was presented by a different set of generators than what was stored in the database. But, as I have mentioned in [comment:82](#comment%3A82), this seems to be Singular not doing all tail reduction in py2.



---

archive/issue_comments_446993.json:
```json
{
    "body": "<a id='comment:115'></a>\nReplying to [SimonKing](#comment%3A114):\n> Now I am running `unit_test_64` in Python-2. Note that in Python-3 I got about 20 (or even more) examples where the freshly computed relation ideal was presented by a different set of generators than what was stored in the database.\n\n\nJust for the record: In the py2 version, the freshly computed results were identical (not only equal up to generator choice) to the stored results.",
    "created_at": "2019-09-26T11:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446993",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:115'></a>
Replying to [SimonKing](#comment%3A114):
> Now I am running `unit_test_64` in Python-2. Note that in Python-3 I got about 20 (or even more) examples where the freshly computed relation ideal was presented by a different set of generators than what was stored in the database.


Just for the record: In the py2 version, the freshly computed results were identical (not only equal up to generator choice) to the stored results.



---

archive/issue_comments_446994.json:
```json
{
    "body": "<a id='comment:6'></a>\nBy the way, at the recent Sage Days in Bonn, I learnt how to host the package repository at github and use Travis CI to some extent. I have posted the link to the ticket description.\n\nNote, however, that testing it on Travis CI with python-3 will be difficult: I was told that the current Sage-with-py3 docker image is rather outdated, and also I don't know how I should write my `.travis.yml` so that the automatic tests involve both py2 and py3. The answer on sage-devel didn't help me much. Is someone reading this who can tell me how I should modify `.travis.yml`?",
    "created_at": "2019-09-26T12:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446994",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
By the way, at the recent Sage Days in Bonn, I learnt how to host the package repository at github and use Travis CI to some extent. I have posted the link to the ticket description.

Note, however, that testing it on Travis CI with python-3 will be difficult: I was told that the current Sage-with-py3 docker image is rather outdated, and also I don't know how I should write my `.travis.yml` so that the automatic tests involve both py2 and py3. The answer on sage-devel didn't help me much. Is someone reading this who can tell me how I should modify `.travis.yml`?



---

archive/issue_comments_446995.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n [Package documentation](https://users.fmi.uni-jena.de/cohomology/documentation/)\n \n [Source ball](https://users.fmi.uni-jena.de/cohomology/p_group_cohomology-3.3.tar.xz)\n+\n+[p_group_cohomology at Travis CI](https://travis-ci.org/sagemath/p_group_cohomology)\n``````\n",
    "created_at": "2019-09-26T12:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446995",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 [Package documentation](https://users.fmi.uni-jena.de/cohomology/documentation/)
 
 [Source ball](https://users.fmi.uni-jena.de/cohomology/p_group_cohomology-3.3.tar.xz)
+
+[p_group_cohomology at Travis CI](https://travis-ci.org/sagemath/p_group_cohomology)
``````




---

archive/issue_comments_446996.json:
```json
{
    "body": "<a id='comment:7'></a>\nSuppose I delete `.sage/pGroupCohomology/`, to force the package to reinstall those files. Then\n- if I build with Python 2 first and then Python 3, all tests pass.\n- if I build with Python 3 first and then Python 2, I get failures:\n\n```\n[p_group_cohomology-3.3]     IOError: Saved data at /Users/jpalmier/.sage/pGroupCohomology/db/4gp2/H4gp2.sobj are not readable: expected bytes, unicode found\n```\n\nI guess I have a few questions:\n- is it possible (and not too much work to implement) for the Python 3 version to build `.sobj` files which are readable by Python 2?\n- if not, should the package discard the existing `.sobj` file and rebuild in this case? \n- more generally, if there is any error reading the `.sobj` file \u2014 maybe somehow the file got corrupted \u2014 should it just rebuild?\n\nThis particular problem should not happen much: people won't be switching from Python 3 to Python 2 very much. So don't work too hard to get the Python 3 version to produce `.sobj` files which are readable by Python 2.",
    "created_at": "2019-09-26T19:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446996",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Suppose I delete `.sage/pGroupCohomology/`, to force the package to reinstall those files. Then
- if I build with Python 2 first and then Python 3, all tests pass.
- if I build with Python 3 first and then Python 2, I get failures:

```
[p_group_cohomology-3.3]     IOError: Saved data at /Users/jpalmier/.sage/pGroupCohomology/db/4gp2/H4gp2.sobj are not readable: expected bytes, unicode found
```

I guess I have a few questions:
- is it possible (and not too much work to implement) for the Python 3 version to build `.sobj` files which are readable by Python 2?
- if not, should the package discard the existing `.sobj` file and rebuild in this case? 
- more generally, if there is any error reading the `.sobj` file — maybe somehow the file got corrupted — should it just rebuild?

This particular problem should not happen much: people won't be switching from Python 3 to Python 2 very much. So don't work too hard to get the Python 3 version to produce `.sobj` files which are readable by Python 2.



---

archive/issue_comments_446997.json:
```json
{
    "body": "<a id='comment:118'></a>\nReplying to [jhpalmieri](#comment%3A117):\n> Suppose I delete `.sage/pGroupCohomology/`, to force the package to reinstall those files. Then\n> - if I build with Python 2 first and then Python 3, all tests pass.\n> - if I build with Python 3 first and then Python 2, I get failures:\n> \n> ```\n> [p_group_cohomology-3.3]     IOError: Saved data at /Users/jpalmier/.sage/pGroupCohomology/db/4gp2/H4gp2.sobj are not readable: expected bytes, unicode found\n> ```\n\n\nIt was a good idea to do such tests. And I am surprised about the error message: There is no use of bytes in the whole cohomology package. Perhaps the error is about unpickling a MeatAxe matrix (`sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense`)? But this was supposed to be fixed in #28444.\n\n> I guess I have a few questions:\n> - is it possible (and not too much work to implement) for the Python 3 version to build `.sobj` files which are readable by Python 2?\n\n\nI thought they were.\n\n> - if not, should the package discard the existing `.sobj` file and rebuild in this case? \n> - more generally, if there is any error reading the `.sobj` file \u2014 maybe somehow the file got corrupted \u2014 should it just rebuild?\n\n\nIt is already the case that if some data source provides data in legacy format, it will automatically be overwritten by a new pickle.\n\n> This particular problem should not happen much: people won't be switching from Python 3 to Python 2 very much. So don't work too hard to get the Python 3 version to produce `.sobj` files which are readable by Python 2.\n\n\nBut it should still work and needs to be investigated.\n\nI'll follow your instructions (remove `.sage/pGroupCOhomology`, install (and also test?) with Python 3 and then install with Python 2 and see what is happening.",
    "created_at": "2019-09-26T19:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446997",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:118'></a>
Replying to [jhpalmieri](#comment%3A117):
> Suppose I delete `.sage/pGroupCohomology/`, to force the package to reinstall those files. Then
> - if I build with Python 2 first and then Python 3, all tests pass.
> - if I build with Python 3 first and then Python 2, I get failures:
> 
> ```
> [p_group_cohomology-3.3]     IOError: Saved data at /Users/jpalmier/.sage/pGroupCohomology/db/4gp2/H4gp2.sobj are not readable: expected bytes, unicode found
> ```


It was a good idea to do such tests. And I am surprised about the error message: There is no use of bytes in the whole cohomology package. Perhaps the error is about unpickling a MeatAxe matrix (`sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense`)? But this was supposed to be fixed in #28444.

> I guess I have a few questions:
> - is it possible (and not too much work to implement) for the Python 3 version to build `.sobj` files which are readable by Python 2?


I thought they were.

> - if not, should the package discard the existing `.sobj` file and rebuild in this case? 
> - more generally, if there is any error reading the `.sobj` file — maybe somehow the file got corrupted — should it just rebuild?


It is already the case that if some data source provides data in legacy format, it will automatically be overwritten by a new pickle.

> This particular problem should not happen much: people won't be switching from Python 3 to Python 2 very much. So don't work too hard to get the Python 3 version to produce `.sobj` files which are readable by Python 2.


But it should still work and needs to be investigated.

I'll follow your instructions (remove `.sage/pGroupCOhomology`, install (and also test?) with Python 3 and then install with Python 2 and see what is happening.



---

archive/issue_comments_446998.json:
```json
{
    "body": "<a id='comment:119'></a>\nReplying to [SimonKing](#comment%3A118):\n> I'll follow your instructions (remove `.sage/pGroupCOhomology`, install (and also test?) with Python 3 and then install with Python 2 and see what is happening.\n\n\nI installed and tested when I did this, but just now I hit the same error with:\n\n- delete `.sage/pGroupCohomology'\n- in Python 3, install the package\n- then run Sage: \n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing(16, 2)\nH^*(SmallGroup(16,2); GF(2))\n```\n- in Python 2, install the package\n- then run Sage:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: CohomologyRing(16, 2)\n---------------------------------------------------------------------------\nIOError                                   Traceback (most recent call last)\n<ipython-input-2-e1924d996e12> in <module>()\n----> 1 CohomologyRing(Integer(16), Integer(2))\n\n/Users/jpalmier/Desktop/Sage/sage_builds/py2/sage-8.9.rc1/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in __call__(self, *args, **kwds)\n   1778             if q < 128:\n   1779                 extras['websource'] = False\n-> 1780             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1781             return OUT\n   1782 \n\n/Users/jpalmier/Desktop/Sage/sage_builds/py2/sage-8.9.rc1/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)\n   1209                 if '@use_this_root@' in coho_options:\n   1210                     del coho_options['@use_this_root@']\n-> 1211                 raise IOError(\"Saved data at %s are not readable: %s\"%(os.path.join(root_workspace,file_name), msg))\n   1212         ## 3. Link with local sources and load from there\n   1213         elif root_local_sources and os.access(os.path.join(root_local_sources,file_name), os.R_OK) and not from_scratch:\n\nIOError: Saved data at /Users/jpalmier/.sage/pGroupCohomology/db/16gp2/H16gp2.sobj are not readable: NEWOBJ class argument isn't a type object\n```",
    "created_at": "2019-09-26T20:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446998",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:119'></a>
Replying to [SimonKing](#comment%3A118):
> I'll follow your instructions (remove `.sage/pGroupCOhomology`, install (and also test?) with Python 3 and then install with Python 2 and see what is happening.


I installed and tested when I did this, but just now I hit the same error with:

- delete `.sage/pGroupCohomology'
- in Python 3, install the package
- then run Sage: 

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing(16, 2)
H^*(SmallGroup(16,2); GF(2))
```
- in Python 2, install the package
- then run Sage:

```
sage: from pGroupCohomology import CohomologyRing
sage: CohomologyRing(16, 2)
---------------------------------------------------------------------------
IOError                                   Traceback (most recent call last)
<ipython-input-2-e1924d996e12> in <module>()
----> 1 CohomologyRing(Integer(16), Integer(2))

/Users/jpalmier/Desktop/Sage/sage_builds/py2/sage-8.9.rc1/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in __call__(self, *args, **kwds)
   1778             if q < 128:
   1779                 extras['websource'] = False
-> 1780             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1781             return OUT
   1782 

/Users/jpalmier/Desktop/Sage/sage_builds/py2/sage-8.9.rc1/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)
   1209                 if '@use_this_root@' in coho_options:
   1210                     del coho_options['@use_this_root@']
-> 1211                 raise IOError("Saved data at %s are not readable: %s"%(os.path.join(root_workspace,file_name), msg))
   1212         ## 3. Link with local sources and load from there
   1213         elif root_local_sources and os.access(os.path.join(root_local_sources,file_name), os.R_OK) and not from_scratch:

IOError: Saved data at /Users/jpalmier/.sage/pGroupCohomology/db/16gp2/H16gp2.sobj are not readable: NEWOBJ class argument isn't a type object
```



---

archive/issue_comments_446999.json:
```json
{
    "body": "<a id='comment:0'></a>\nProbably the following would work, too (so that it is not always needed to reinstall):\n- Have the package both in py2 and py3\n- Create a permanent workspace and store a cohomology ring created with py3\n- Try to load the cohomology ring from that permanent workspace with py2\n\nAnyway, after doing the py3 test suit, I can confirm what you reported: The stuff in `.sage/pGroupCohomology/db/16gp2` cannot be unpickled with py2. In particular, the state descriptor cannot be loaded:\n\n```\nsage: S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-2796f9b01dc5> in <module>()\n----> 1 S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2845)()\n    157 \n    158     ## Load file by absolute filename\n--> 159     with open(filename, 'rb') as fobj:\n    160         X = loads(fobj.read(), compress=compress, **kwargs)\n    161     try:\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2795)()\n    158     ## Load file by absolute filename\n    159     with open(filename, 'rb') as fobj:\n--> 160         X = loads(fobj.read(), compress=compress, **kwargs)\n    161     try:\n    162         X._default_filename = os.path.abspath(filename)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:6929)()\n   1043 \n   1044     unpickler = SageUnpickler(io.BytesIO(s), **kwargs)\n-> 1045     return unpickler.load()\n   1046 \n   1047 \n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._BaseUnpickler.load (build/cythonized/sage/misc/persist.c:5806)()\n    655 \n    656         def load(self):\n--> 657             return self._unpickler.load()\n    658 \n    659         def noload(self):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/factory.pyx in sage.structure.factory.lookup_global (build/cythonized/sage/structure/factory.c:4615)()\n    748         Integer Ring\n    749     \"\"\"\n--> 750     name = bytes_to_str(name, encoding='ASCII')\n    751     try:\n    752         return factory_unpickles[name]\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/cpython/string.pxd in sage.cpython.string.bytes_to_str (build/cythonized/sage/structure/factory.c:5038)()\n     55         return b\n     56     if type(b) is not bytes:\n---> 57         raise TypeError(f\"expected bytes, {type(b).__name__} found\")\n     58 \n     59     if PY_MAJOR_VERSION <= 2:\n\nTypeError: expected bytes, unicode found\n```\nAnd I guess this can be fixed in `bytes_to_str`: After the changes in #28444, `bytes_to_str` is more tolerant about the input type (it may be str), but it should be even more so. It should (in py2) accept unicode.",
    "created_at": "2019-09-26T21:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-446999",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:0'></a>
Probably the following would work, too (so that it is not always needed to reinstall):
- Have the package both in py2 and py3
- Create a permanent workspace and store a cohomology ring created with py3
- Try to load the cohomology ring from that permanent workspace with py2

Anyway, after doing the py3 test suit, I can confirm what you reported: The stuff in `.sage/pGroupCohomology/db/16gp2` cannot be unpickled with py2. In particular, the state descriptor cannot be loaded:

```
sage: S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-2796f9b01dc5> in <module>()
----> 1 S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2845)()
    157 
    158     ## Load file by absolute filename
--> 159     with open(filename, 'rb') as fobj:
    160         X = loads(fobj.read(), compress=compress, **kwargs)
    161     try:

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2795)()
    158     ## Load file by absolute filename
    159     with open(filename, 'rb') as fobj:
--> 160         X = loads(fobj.read(), compress=compress, **kwargs)
    161     try:
    162         X._default_filename = os.path.abspath(filename)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:6929)()
   1043 
   1044     unpickler = SageUnpickler(io.BytesIO(s), **kwargs)
-> 1045     return unpickler.load()
   1046 
   1047 

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._BaseUnpickler.load (build/cythonized/sage/misc/persist.c:5806)()
    655 
    656         def load(self):
--> 657             return self._unpickler.load()
    658 
    659         def noload(self):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/structure/factory.pyx in sage.structure.factory.lookup_global (build/cythonized/sage/structure/factory.c:4615)()
    748         Integer Ring
    749     """
--> 750     name = bytes_to_str(name, encoding='ASCII')
    751     try:
    752         return factory_unpickles[name]

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/cpython/string.pxd in sage.cpython.string.bytes_to_str (build/cythonized/sage/structure/factory.c:5038)()
     55         return b
     56     if type(b) is not bytes:
---> 57         raise TypeError(f"expected bytes, {type(b).__name__} found")
     58 
     59     if PY_MAJOR_VERSION <= 2:

TypeError: expected bytes, unicode found
```
And I guess this can be fixed in `bytes_to_str`: After the changes in #28444, `bytes_to_str` is more tolerant about the input type (it may be str), but it should be even more so. It should (in py2) accept unicode.



---

archive/issue_comments_447000.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think it's good enough if py2-created pickles work with py3.\n\nRequire the opposite compatibility seems to be an overkill.",
    "created_at": "2019-09-26T21:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447000",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
I think it's good enough if py2-created pickles work with py3.

Require the opposite compatibility seems to be an overkill.



---

archive/issue_comments_447001.json:
```json
{
    "body": "<a id='comment:122'></a>\nReplying to [dimpase](#comment%3A121):\n> I think it's good enough if py2-created pickles work with py3.\n> \n> Require the opposite compatibility seems to be an overkill.\n\n\nI believe the fix (in #28540) would be relatively easy.\n\nIf you think that we shouldn't worry so much about reading py3-pickles in py2, then of course the group cohomology package can be reviewed as it is now. If I am right about #28640, then #28540 will fix the unpickling of py3-cohomology in py2 without any change in the package.",
    "created_at": "2019-09-26T22:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447001",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:122'></a>
Replying to [dimpase](#comment%3A121):
> I think it's good enough if py2-created pickles work with py3.
> 
> Require the opposite compatibility seems to be an overkill.


I believe the fix (in #28540) would be relatively easy.

If you think that we shouldn't worry so much about reading py3-pickles in py2, then of course the group cohomology package can be reviewed as it is now. If I am right about #28640, then #28540 will fix the unpickling of py3-cohomology in py2 without any change in the package.



---

archive/issue_comments_447002.json:
```json
{
    "body": "<a id='comment:123'></a>\nReplying to [SimonKing](#comment%3A120):\n\n> And I guess this can be fixed in `bytes_to_str`: After the changes in #28444, `bytes_to_str` is more tolerant about the input type (it may be str), but it should be even more so. It should (in py2) accept unicode.\n\n\nI think that at this point it's becoming pretty clear you should use a routine that is not named `bytes_to_str`, but a routine \"ensure_str\", which in py3 accepts unicode=str and return the result unchanged, and also accepts py2's \"bytes=str\" objects and assumes it's \"latin1\" encoded, because that's what it would have been as a \"str\" in py2.\n\nYou are clearly NOT converting a \"bytes\" object to a \"str\" here; you are ensuring something is a \"str\", doing some conversions if necessary. You should use a routine that reflects that in its name if you need specific behaviour.\n\nThe reason why I care is because you are changing routines in sage.cpython.string, which people will expect to contain widely valid; well-defined routines. Stretching them up with hacks for specific purposes will lead to silent erroneous behaviour further down the line, when these routines are used in other contexts because they sound like the right tool (but aren't).\n\nIf it gets a py3 \"unicode\" object in py2, ideally it could just leave it as unicode, because that should be valid in str contexts in py2 for the most time as well. But we may be far from the ideal in py2. A safe choice would be `str(<unicode>)` to ensure you actually get a py2 str. That uses \"ascii\" encoding, so it may fail. You could allow for \"UTF-8\" but that would not round-trip correctly with the \"latin1\" on the other side. Using \"latin1\" for encoding unicode-to-str on py2 may also fail, because not all unicode code points have an encoding in \"latin1\".",
    "created_at": "2019-09-26T22:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447002",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:123'></a>
Replying to [SimonKing](#comment%3A120):

> And I guess this can be fixed in `bytes_to_str`: After the changes in #28444, `bytes_to_str` is more tolerant about the input type (it may be str), but it should be even more so. It should (in py2) accept unicode.


I think that at this point it's becoming pretty clear you should use a routine that is not named `bytes_to_str`, but a routine "ensure_str", which in py3 accepts unicode=str and return the result unchanged, and also accepts py2's "bytes=str" objects and assumes it's "latin1" encoded, because that's what it would have been as a "str" in py2.

You are clearly NOT converting a "bytes" object to a "str" here; you are ensuring something is a "str", doing some conversions if necessary. You should use a routine that reflects that in its name if you need specific behaviour.

The reason why I care is because you are changing routines in sage.cpython.string, which people will expect to contain widely valid; well-defined routines. Stretching them up with hacks for specific purposes will lead to silent erroneous behaviour further down the line, when these routines are used in other contexts because they sound like the right tool (but aren't).

If it gets a py3 "unicode" object in py2, ideally it could just leave it as unicode, because that should be valid in str contexts in py2 for the most time as well. But we may be far from the ideal in py2. A safe choice would be `str(<unicode>)` to ensure you actually get a py2 str. That uses "ascii" encoding, so it may fail. You could allow for "UTF-8" but that would not round-trip correctly with the "latin1" on the other side. Using "latin1" for encoding unicode-to-str on py2 may also fail, because not all unicode code points have an encoding in "latin1".



---

archive/issue_comments_447003.json:
```json
{
    "body": "<a id='comment:124'></a>\nReplying to [nbruin](#comment%3A123):\n> The reason why I care is because you are changing routines in sage.cpython.string, which people will expect to contain widely valid; well-defined routines. Stretching them up with hacks for specific purposes will lead to silent erroneous behaviour further down the line, when these routines are used in other contexts because they sound like the right tool (but aren't).\n\n\nAgreed. I have already changed the topic of #28540.\n \n> If it gets a py3 \"unicode\" object in py2, ideally it could just leave it as unicode, because that should be valid in str contexts in py2 for the most time as well. But we may be far from the ideal in py2. A safe choice would be `str(<unicode>)` to ensure you actually get a py2 str. That uses \"ascii\" encoding, so it may fail.\n\n\nThe application (and the place where #28540 should be changed) is `sage.structure.factory.lookup_global`. This function used to only accept str. By #28444, it also accepts bytes, which makes it possible to unpickle a py2-pickle in py3.\n\nI suggest in #28540 that it also accepts a unicode. This makes it possible to unpickle a py3-pickle in py2.\n\nAgain, I won't make this a dependency for the cohomology package.",
    "created_at": "2019-09-26T23:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447003",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:124'></a>
Replying to [nbruin](#comment%3A123):
> The reason why I care is because you are changing routines in sage.cpython.string, which people will expect to contain widely valid; well-defined routines. Stretching them up with hacks for specific purposes will lead to silent erroneous behaviour further down the line, when these routines are used in other contexts because they sound like the right tool (but aren't).


Agreed. I have already changed the topic of #28540.
 
> If it gets a py3 "unicode" object in py2, ideally it could just leave it as unicode, because that should be valid in str contexts in py2 for the most time as well. But we may be far from the ideal in py2. A safe choice would be `str(<unicode>)` to ensure you actually get a py2 str. That uses "ascii" encoding, so it may fail.


The application (and the place where #28540 should be changed) is `sage.structure.factory.lookup_global`. This function used to only accept str. By #28444, it also accepts bytes, which makes it possible to unpickle a py2-pickle in py3.

I suggest in #28540 that it also accepts a unicode. This makes it possible to unpickle a py3-pickle in py2.

Again, I won't make this a dependency for the cohomology package.



---

archive/issue_comments_447004.json:
```json
{
    "body": "<a id='comment:5'></a>\n#28540 brought an improvement:\n\n```\nsage: from pGroupCohomology import CohomologyRing\nsage: H = CohomologyRing(16,2,options='debug')\n_get_p_group_from_cache_or_db:\n    Data found at /home/king/.sage/pGroupCohomology/db/16gp2/H16gp2.sobj\n    Group data are rooted at '/home/king/.sage/pGroupCohomology/db'.\nLoading a cohomology ring:\n    The state descriptor of the to-be-unpickled ring is expected to be provided at u'/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj'\n---------------------------------------------------------------------------\nIOError                                   Traceback (most recent call last)\n<ipython-input-2-a62afc150e39> in <module>()\n----> 1 H = CohomologyRing(Integer(16),Integer(2),options='debug')\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in __call__(self, *args, **kwds)\n   1778             if q < 128:\n   1779                 extras['websource'] = False\n-> 1780             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))\n   1781             return OUT\n   1782 \n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)\n   1209                 if '@use_this_root@' in coho_options:\n   1210                     del coho_options['@use_this_root@']\n-> 1211                 raise IOError(\"Saved data at %s are not readable: %s\"%(os.path.join(root_workspace,file_name), msg))\n   1212         ## 3. Link with local sources and load from there\n   1213         elif root_local_sources and os.access(os.path.join(root_local_sources,file_name), os.R_OK) and not from_scratch:\n\nIOError: Saved data at /home/king/.sage/pGroupCohomology/db/16gp2/H16gp2.sobj are not readable: NEWOBJ class argument isn't a type object\n```\nSo, the previous error arising in lookup_global has gone.\n\nI am afraid the new error looks more like an error that needs to be fixed in the package, not in the Sage library. We will see...",
    "created_at": "2019-09-26T23:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447004",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
#28540 brought an improvement:

```
sage: from pGroupCohomology import CohomologyRing
sage: H = CohomologyRing(16,2,options='debug')
_get_p_group_from_cache_or_db:
    Data found at /home/king/.sage/pGroupCohomology/db/16gp2/H16gp2.sobj
    Group data are rooted at '/home/king/.sage/pGroupCohomology/db'.
Loading a cohomology ring:
    The state descriptor of the to-be-unpickled ring is expected to be provided at u'/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj'
---------------------------------------------------------------------------
IOError                                   Traceback (most recent call last)
<ipython-input-2-a62afc150e39> in <module>()
----> 1 H = CohomologyRing(Integer(16),Integer(2),options='debug')

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in __call__(self, *args, **kwds)
   1778             if q < 128:
   1779                 extras['websource'] = False
-> 1780             OUT = self._check_compatibility(CacheKey, self._get_p_group_from_cache_or_db(GStem, KEY, **extras) or self._get_p_group_from_scratch(KEY, q, GStem, GroupName, **extras))
   1781             return OUT
   1782 

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/pGroupCohomology/factory.pyc in _get_p_group_from_cache_or_db(self, GStem, KEY, **kwds)
   1209                 if '@use_this_root@' in coho_options:
   1210                     del coho_options['@use_this_root@']
-> 1211                 raise IOError("Saved data at %s are not readable: %s"%(os.path.join(root_workspace,file_name), msg))
   1212         ## 3. Link with local sources and load from there
   1213         elif root_local_sources and os.access(os.path.join(root_local_sources,file_name), os.R_OK) and not from_scratch:

IOError: Saved data at /home/king/.sage/pGroupCohomology/db/16gp2/H16gp2.sobj are not readable: NEWOBJ class argument isn't a type object
```
So, the previous error arising in lookup_global has gone.

I am afraid the new error looks more like an error that needs to be fixed in the package, not in the Sage library. We will see...



---

archive/issue_comments_447005.json:
```json
{
    "body": "<a id='comment:6'></a>\nNext step of debugging.\n\nIn Py2, where we still have py3-pickles in `DOT_SAGE`:\n\n```\nsage: from pGroupCohomology.cohomology import COHO\nsage: H = COHO()\nsage: S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')\nsage: H.__setstate__(S)\n---------------------------------------------------------------------------\nIOError                                   Traceback (most recent call last)\n<ipython-input-4-9c79e2f6e0a6> in <module>()\n----> 1 H.__setstate__(S)\n\npGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__setstate__()\n\nIOError: Unable to read resolution saved at /home/king/Sage/git/sage/local/share/pGroupCohomology/16gp2/dat/R16gp2.sobj\n```\nThe same in py3:\n\n```\nsage: from pGroupCohomology.cohomology import COHO\nsage: H = COHO()\nsage: S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')\nsage: H.__setstate__(S)\nsage: print(H)\n\nCohomology ring of Small Group number 2 of order 16 with coefficients in GF(2)\n\nComputation complete\nMinimal list of generators:\n[c_2_1: 2-Cocycle in H^*(SmallGroup(16,2); GF(2)),\n c_2_2: 2-Cocycle in H^*(SmallGroup(16,2); GF(2)),\n c_1_0: 1-Cocycle in H^*(SmallGroup(16,2); GF(2)),\n c_1_1: 1-Cocycle in H^*(SmallGroup(16,2); GF(2))]\nMinimal list of algebraic relations:\n[c_1_0^2,\n c_1_1^2]\n```\nSo, the error is now moved to `__setstate__`. I guess I'll fix it there.",
    "created_at": "2019-09-26T23:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447005",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
Next step of debugging.

In Py2, where we still have py3-pickles in `DOT_SAGE`:

```
sage: from pGroupCohomology.cohomology import COHO
sage: H = COHO()
sage: S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')
sage: H.__setstate__(S)
---------------------------------------------------------------------------
IOError                                   Traceback (most recent call last)
<ipython-input-4-9c79e2f6e0a6> in <module>()
----> 1 H.__setstate__(S)

pGroupCohomology/cohomology.pyx in pGroupCohomology.cohomology.COHO.__setstate__()

IOError: Unable to read resolution saved at /home/king/Sage/git/sage/local/share/pGroupCohomology/16gp2/dat/R16gp2.sobj
```
The same in py3:

```
sage: from pGroupCohomology.cohomology import COHO
sage: H = COHO()
sage: S = load('/home/king/.sage/pGroupCohomology/db/16gp2/dat/State.sobj')
sage: H.__setstate__(S)
sage: print(H)

Cohomology ring of Small Group number 2 of order 16 with coefficients in GF(2)

Computation complete
Minimal list of generators:
[c_2_1: 2-Cocycle in H^*(SmallGroup(16,2); GF(2)),
 c_2_2: 2-Cocycle in H^*(SmallGroup(16,2); GF(2)),
 c_1_0: 1-Cocycle in H^*(SmallGroup(16,2); GF(2)),
 c_1_1: 1-Cocycle in H^*(SmallGroup(16,2); GF(2))]
Minimal list of algebraic relations:
[c_1_0^2,
 c_1_1^2]
```
So, the error is now moved to `__setstate__`. I guess I'll fix it there.



---

archive/issue_comments_447006.json:
```json
{
    "body": "<a id='comment:7'></a>\nMeanwhile I know at what point the error mentioned in [comment:125](#comment%3A125) arises:\n\n```\nsage: pg_RESL_sparse_unpickle_class = unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')\nsage: si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())\n---------------------------------------------------------------------------\nUnpicklingError                           Traceback (most recent call last)\n<ipython-input-2-855d0a850e70> in <module>()\n----> 1 si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/explain_pickle.pyc in unpickle_newobj(klass, args)\n   2438         return pers[int(id)]\n   2439 \n-> 2440     return SageUnpickler.loads(pickle, persistent_load=pers_load)\n   2441 \n   2442 \n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SageUnpickler.loads (build/cythonized/sage/misc/persist.c:6467)()\n    962         \"\"\"\n    963 \n--> 964         return cls(io.BytesIO(data), **kwargs).load()\n    965 \n    966 \n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._BaseUnpickler.load (build/cythonized/sage/misc/persist.c:5806)()\n    655 \n    656         def load(self):\n--> 657             return self._unpickler.load()\n    658 \n    659         def noload(self):\n\nUnpicklingError: NEWOBJ class argument isn't a type object\n```\nBut I do not have the faintest idea yet what this error means. For comparison, in py3 I get\n\n```\nsage: pg_RESL_sparse_unpickle_class = unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')\nsage: si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())\nsage: si1\n<pGroupCohomology.resolution.RESL_sparse_unpickle_class object at 0x7f2ee987abe0>\n```\n\nI'm guessing that a class in Python-3 is a type, but in Python-2 it generally isn't. Is that the meaning of the error? But isn't it the case that a class defined in Cython (here: resolution.pyx) automatically is a type?\n\nAnyway, I'll try to turn `class RESL_sparse_unpickle_class` into `class RESL_sparse_unpickle_class(object)` and see if it helps.",
    "created_at": "2019-09-27T10:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447006",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
Meanwhile I know at what point the error mentioned in [comment:125](#comment%3A125) arises:

```
sage: pg_RESL_sparse_unpickle_class = unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')
sage: si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())
---------------------------------------------------------------------------
UnpicklingError                           Traceback (most recent call last)
<ipython-input-2-855d0a850e70> in <module>()
----> 1 si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/explain_pickle.pyc in unpickle_newobj(klass, args)
   2438         return pers[int(id)]
   2439 
-> 2440     return SageUnpickler.loads(pickle, persistent_load=pers_load)
   2441 
   2442 

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.SageUnpickler.loads (build/cythonized/sage/misc/persist.c:6467)()
    962         """
    963 
--> 964         return cls(io.BytesIO(data), **kwargs).load()
    965 
    966 

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._BaseUnpickler.load (build/cythonized/sage/misc/persist.c:5806)()
    655 
    656         def load(self):
--> 657             return self._unpickler.load()
    658 
    659         def noload(self):

UnpicklingError: NEWOBJ class argument isn't a type object
```
But I do not have the faintest idea yet what this error means. For comparison, in py3 I get

```
sage: pg_RESL_sparse_unpickle_class = unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')
sage: si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())
sage: si1
<pGroupCohomology.resolution.RESL_sparse_unpickle_class object at 0x7f2ee987abe0>
```

I'm guessing that a class in Python-3 is a type, but in Python-2 it generally isn't. Is that the meaning of the error? But isn't it the case that a class defined in Cython (here: resolution.pyx) automatically is a type?

Anyway, I'll try to turn `class RESL_sparse_unpickle_class` into `class RESL_sparse_unpickle_class(object)` and see if it helps.



---

archive/issue_comments_447007.json:
```json
{
    "body": "<a id='comment:128'></a>\nReplying to [SimonKing](#comment%3A127):\n> Anyway, I'll try to turn `class RESL_sparse_unpickle_class` into `class RESL_sparse_unpickle_class(object)` and see if it helps.\n\n\nNope.\n\n```\nsage: from pGroupCohomology.resolution import RESL_sparse_unpickle_class\nsage: RESL_sparse_unpickle_class\n<class 'pGroupCohomology.resolution.RESL_sparse_unpickle_class'>\nsage: isinstance(_, type)\nTrue\n```\nbut still\n\n```\nsage: pg_RESL_sparse_unpickle_class = unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')\nsage: si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())\nTraceback (most recent call last):\n...\nUnpicklingError: NEWOBJ class argument isn't a type object\n```",
    "created_at": "2019-09-27T10:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447007",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:128'></a>
Replying to [SimonKing](#comment%3A127):
> Anyway, I'll try to turn `class RESL_sparse_unpickle_class` into `class RESL_sparse_unpickle_class(object)` and see if it helps.


Nope.

```
sage: from pGroupCohomology.resolution import RESL_sparse_unpickle_class
sage: RESL_sparse_unpickle_class
<class 'pGroupCohomology.resolution.RESL_sparse_unpickle_class'>
sage: isinstance(_, type)
True
```
but still

```
sage: pg_RESL_sparse_unpickle_class = unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')
sage: si1 = unpickle_newobj(pg_RESL_sparse_unpickle_class, ())
Traceback (most recent call last):
...
UnpicklingError: NEWOBJ class argument isn't a type object
```



---

archive/issue_comments_447008.json:
```json
{
    "body": "<a id='comment:9'></a>\nOdd. After trying again, the error is gone. In Py2:\n\n```\nsage: R = load(\"/home/king/.sage/pGroupCohomology/db/16gp2/dat/R16gp2.sobj\")\n---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n<ipython-input-1-c703eea54ef8> in <module>()\n----> 1 R = load(\"/home/king/.sage/pGroupCohomology/db/16gp2/dat/R16gp2.sobj\")\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2845)()\n    157 \n    158     ## Load file by absolute filename\n--> 159     with open(filename, 'rb') as fobj:\n    160         X = loads(fobj.read(), compress=compress, **kwargs)\n    161     try:\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2795)()\n    158     ## Load file by absolute filename\n    159     with open(filename, 'rb') as fobj:\n--> 160         X = loads(fobj.read(), compress=compress, **kwargs)\n    161     try:\n    162         X._default_filename = os.path.abspath(filename)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:6929)()\n   1043 \n   1044     unpickler = SageUnpickler(io.BytesIO(s), **kwargs)\n-> 1045     return unpickler.load()\n   1046 \n   1047 \n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._BaseUnpickler.load (build/cythonized/sage/misc/persist.c:5806)()\n    655 \n    656         def load(self):\n--> 657             return self._unpickler.load()\n    658 \n    659         def noload(self):\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL_sparse_unpickle_class.__call__()\n\npGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__init__()\n\nOSError: Bad file format in file pgroup.c (line 404)\n```\nSo, now complain about NEWOBJ any more.",
    "created_at": "2019-09-27T10:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447008",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>
Odd. After trying again, the error is gone. In Py2:

```
sage: R = load("/home/king/.sage/pGroupCohomology/db/16gp2/dat/R16gp2.sobj")
---------------------------------------------------------------------------
OSError                                   Traceback (most recent call last)
<ipython-input-1-c703eea54ef8> in <module>()
----> 1 R = load("/home/king/.sage/pGroupCohomology/db/16gp2/dat/R16gp2.sobj")

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2845)()
    157 
    158     ## Load file by absolute filename
--> 159     with open(filename, 'rb') as fobj:
    160         X = loads(fobj.read(), compress=compress, **kwargs)
    161     try:

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2795)()
    158     ## Load file by absolute filename
    159     with open(filename, 'rb') as fobj:
--> 160         X = loads(fobj.read(), compress=compress, **kwargs)
    161     try:
    162         X._default_filename = os.path.abspath(filename)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist.loads (build/cythonized/sage/misc/persist.c:6929)()
   1043 
   1044     unpickler = SageUnpickler(io.BytesIO(s), **kwargs)
-> 1045     return unpickler.load()
   1046 
   1047 

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/persist.pyx in sage.misc.persist._BaseUnpickler.load (build/cythonized/sage/misc/persist.c:5806)()
    655 
    656         def load(self):
--> 657             return self._unpickler.load()
    658 
    659         def noload(self):

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL_sparse_unpickle_class.__call__()

pGroupCohomology/resolution.pyx in pGroupCohomology.resolution.RESL.__init__()

OSError: Bad file format in file pgroup.c (line 404)
```
So, now complain about NEWOBJ any more.



---

archive/issue_comments_447009.json:
```json
{
    "body": "<a id='comment:0'></a>\nSpoke too soon. Immediately after this different error (i.e., in the same session), I again got the \"NEWOBJ\" error.",
    "created_at": "2019-09-27T10:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447009",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:0'></a>
Spoke too soon. Immediately after this different error (i.e., in the same session), I again got the "NEWOBJ" error.



---

archive/issue_comments_447010.json:
```json
{
    "body": "<a id='comment:1'></a>\n\n```\nsage: from pGroupCohomology.resolution import RESL_sparse_unpickle_class\nsage: pg_RESL_sparse_unpickle_class is RESL_sparse_unpickle_class\nFalse\n```\nIn a different session, I got the answer \"True\".\n\nAnyway, the error about \"NEWOBJ\" comes from python. It seems that python decided to kill data persistency. I tried to work around to the extent that py2-pickles of cohomology rings seem to be legible in py3. But I think I will not work further on making py3-pickles legible in py2.\n\nAnother question: Why is the branch of this ticket shown red?",
    "created_at": "2019-09-27T10:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447010",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>

```
sage: from pGroupCohomology.resolution import RESL_sparse_unpickle_class
sage: pg_RESL_sparse_unpickle_class is RESL_sparse_unpickle_class
False
```
In a different session, I got the answer "True".

Anyway, the error about "NEWOBJ" comes from python. It seems that python decided to kill data persistency. I tried to work around to the extent that py2-pickles of cohomology rings seem to be legible in py3. But I think I will not work further on making py3-pickles legible in py2.

Another question: Why is the branch of this ticket shown red?



---

archive/issue_comments_447011.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe oddity is: Sometimes `pg_RESL_sparce_unpickle_class` is `RESL_sparse_unpickle_class` and sometimes it isn't. When the error occurs, I get\n\n```\nsage: pg_RESL_sparse_unpickle_class\n<class pGroupCohomology.auxiliaries.unpickle_old_resl at 0x7fb8d4f549a8>\n```\nIt is not nice that `unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')` sometimes returns something else. But perhaps it is worth trying to make this class inherit from `object`.",
    "created_at": "2019-09-27T11:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447011",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
The oddity is: Sometimes `pg_RESL_sparce_unpickle_class` is `RESL_sparse_unpickle_class` and sometimes it isn't. When the error occurs, I get

```
sage: pg_RESL_sparse_unpickle_class
<class pGroupCohomology.auxiliaries.unpickle_old_resl at 0x7fb8d4f549a8>
```
It is not nice that `unpickle_global('pGroupCohomology.resolution', 'RESL_sparse_unpickle_class')` sometimes returns something else. But perhaps it is worth trying to make this class inherit from `object`.



---

archive/issue_comments_447012.json:
```json
{
    "body": "<a id='comment:133'></a>\nReplying to [SimonKing](#comment%3A132):\n> But perhaps it is worth trying to make this class inherit from `object`.\n\n\nNope, didn't help. As there doesn't seem to be an easy fix, I do not plan to work further on it.\n\nDo I understand correctly that I have to rebase on the current develop branch?",
    "created_at": "2019-09-27T11:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447012",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:133'></a>
Replying to [SimonKing](#comment%3A132):
> But perhaps it is worth trying to make this class inherit from `object`.


Nope, didn't help. As there doesn't seem to be an easy fix, I do not plan to work further on it.

Do I understand correctly that I have to rebase on the current develop branch?



---

archive/issue_comments_447013.json:
```json
{
    "body": "**Changing commit** from \"[463806c6cebb3120e20df0f19a216dd529553741](https://github.com/sagemath/sagetrac-mirror/commit/463806c6cebb3120e20df0f19a216dd529553741)\" to \"[7ad6a4a35c9af94d1692a17e1b8855f49d60a38e](https://github.com/sagemath/sagetrac-mirror/commit/7ad6a4a35c9af94d1692a17e1b8855f49d60a38e)\".",
    "created_at": "2019-09-27T11:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[463806c6cebb3120e20df0f19a216dd529553741](https://github.com/sagemath/sagetrac-mirror/commit/463806c6cebb3120e20df0f19a216dd529553741)" to "[7ad6a4a35c9af94d1692a17e1b8855f49d60a38e](https://github.com/sagemath/sagetrac-mirror/commit/7ad6a4a35c9af94d1692a17e1b8855f49d60a38e)".



---

archive/issue_comments_447014.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ad6a4a35c9af94d1692a17e1b8855f49d60a38e\">7ad6a4a</a></td><td><code>Upgrade p_group_cohomology to version 3.3</code></td></tr></table>\n",
    "created_at": "2019-09-27T11:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ad6a4a35c9af94d1692a17e1b8855f49d60a38e">7ad6a4a</a></td><td><code>Upgrade p_group_cohomology to version 3.3</code></td></tr></table>




---

archive/issue_comments_447015.json:
```json
{
    "body": "<a id='comment:5'></a>\nMaybe it would be simpler, if any error arises reading a pickle, to just delete and reproduce the pickle file. Compatibility going from Python 3 to Python 2 may be annoying to debug and to fix, and besides, there may be other errors that we haven't foreseen.",
    "created_at": "2019-09-27T14:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447015",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Maybe it would be simpler, if any error arises reading a pickle, to just delete and reproduce the pickle file. Compatibility going from Python 3 to Python 2 may be annoying to debug and to fix, and besides, there may be other errors that we haven't foreseen.



---

archive/issue_comments_447016.json:
```json
{
    "body": "<a id='comment:6'></a>\nOr as you say, to just not work on the Py3 -> Py2 conversion. That's fine with me.",
    "created_at": "2019-09-27T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447016",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
Or as you say, to just not work on the Py3 -> Py2 conversion. That's fine with me.



---

archive/issue_comments_447017.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am using unpickle_override for `RESL_sparse_unpickle_class`, but I am not sure if that's needed at all.",
    "created_at": "2019-09-27T16:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447017",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
I am using unpickle_override for `RESL_sparse_unpickle_class`, but I am not sure if that's needed at all.



---

archive/issue_comments_447018.json:
```json
{
    "body": "<a id='comment:8'></a>\nBummer. Apparently I have destroyed the git repository for my py3 installation. It says:\n\n```\nking@klap:~/Sage/git/py3$ git lg\nfatal: your current branch 't/28444/fix_backwards_incompatibility_of_unpickling_in_python_3' does not have any commits yet\n```\nand ALL files in the Sage tree are untracked. How has that happened, and how to fix it?",
    "created_at": "2019-09-27T17:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447018",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
Bummer. Apparently I have destroyed the git repository for my py3 installation. It says:

```
king@klap:~/Sage/git/py3$ git lg
fatal: your current branch 't/28444/fix_backwards_incompatibility_of_unpickling_in_python_3' does not have any commits yet
```
and ALL files in the Sage tree are untracked. How has that happened, and how to fix it?



---

archive/issue_comments_447019.json:
```json
{
    "body": "<a id='comment:9'></a>\nHopefully John has a version of this branch just before you did that fateful forced push.\n\nThere could be copies left on patchbots, maybe\nLinuxMint/18.2/x86_64/4.8.0-53-generic/pc78-math\npatchbot does have it...",
    "created_at": "2019-09-27T18:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447019",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
Hopefully John has a version of this branch just before you did that fateful forced push.

There could be copies left on patchbots, maybe
LinuxMint/18.2/x86_64/4.8.0-53-generic/pc78-math
patchbot does have it...



---

archive/issue_comments_447020.json:
```json
{
    "body": "<a id='comment:0'></a>\nUnfortunately I don't, but there are the commits in [comment:113](#comment%3A113) which are still accessible.",
    "created_at": "2019-09-27T18:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447020",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:0'></a>
Unfortunately I don't, but there are the commits in [comment:113](#comment%3A113) which are still accessible.



---

archive/issue_comments_447021.json:
```json
{
    "body": "<a id='comment:1'></a>\nyes, indeed, these commits are available in the full \"git fetch trac\" - I have them locally, in case they get gc'd.",
    "created_at": "2019-09-27T18:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447021",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
yes, indeed, these commits are available in the full "git fetch trac" - I have them locally, in case they get gc'd.



---

archive/issue_comments_447022.json:
```json
{
    "body": "<a id='comment:142'></a>\nReplying to [dimpase](#comment%3A139):\n> Hopefully John has a version of this branch just before you did that fateful forced push.\n\n\n1. What's wrong with the forced push? IMHO, that has nothing to to with the problem whatsoever. The forced push is nothing more than a rebasing of the previously committed branch. After pushing it, I could still work.\n2. The branch is still present in my git repository. Perhaps I didn't make it clear. I have a single git repository with two worktrees, one for py2, one for py3. The py2 worktree is fine (AFAIC), in particular I can checkout any branch. However, it seems that I deleted the branch on which the py3 worktree was living, with `git branch -d`. As a result, all files in the py3 worktree are now untracked, as is shown by `git status`, and `git log` says that there has never been a commit. Again, I am talking about only one of my two worktrees.\n3. The deleted branch is the branch from #28444, not from here. That branch is merged in \"develop\", that's why I did `git branch -d` on it.\n\nSo, from my perspective, \"solving the problem\" means \"allowing me to do `git checkout <branchname>` in the py3-worktree\" -- this currently is refused, because git claims that I should first commit or stash the whole Sage library.",
    "created_at": "2019-09-27T19:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447022",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:142'></a>
Replying to [dimpase](#comment%3A139):
> Hopefully John has a version of this branch just before you did that fateful forced push.


1. What's wrong with the forced push? IMHO, that has nothing to to with the problem whatsoever. The forced push is nothing more than a rebasing of the previously committed branch. After pushing it, I could still work.
2. The branch is still present in my git repository. Perhaps I didn't make it clear. I have a single git repository with two worktrees, one for py2, one for py3. The py2 worktree is fine (AFAIC), in particular I can checkout any branch. However, it seems that I deleted the branch on which the py3 worktree was living, with `git branch -d`. As a result, all files in the py3 worktree are now untracked, as is shown by `git status`, and `git log` says that there has never been a commit. Again, I am talking about only one of my two worktrees.
3. The deleted branch is the branch from #28444, not from here. That branch is merged in "develop", that's why I did `git branch -d` on it.

So, from my perspective, "solving the problem" means "allowing me to do `git checkout <branchname>` in the py3-worktree" -- this currently is refused, because git claims that I should first commit or stash the whole Sage library.



---

archive/issue_comments_447023.json:
```json
{
    "body": "<a id='comment:3'></a>\nWould `git checkout -f <branch_name>` possibly help? Or would I possibly destroy even more?",
    "created_at": "2019-09-27T20:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447023",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
Would `git checkout -f <branch_name>` possibly help? Or would I possibly destroy even more?



---

archive/issue_comments_447024.json:
```json
{
    "body": "<a id='comment:4'></a>\nYou could try `git stash` and then `git checkout BRANCH` and then `git stash COMMAND` for some value of `COMMAND`: `git stash pop`? `git stash apply`? `git stash branch NEW`?",
    "created_at": "2019-09-27T20:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447024",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
You could try `git stash` and then `git checkout BRANCH` and then `git stash COMMAND` for some value of `COMMAND`: `git stash pop`? `git stash apply`? `git stash branch NEW`?



---

archive/issue_comments_447025.json:
```json
{
    "body": "<a id='comment:145'></a>\nReplying to [jhpalmieri](#comment%3A144):\n> You could try `git stash` and then `git checkout BRANCH` and then `git stash COMMAND` for some value of `COMMAND`: `git stash pop`? `git stash apply`? `git stash branch NEW`?\n\n\nCertainly not. I do in fact not have any uncommitted changes! Instead, git believes that I have uncommitted changes (indeed it believes that the whole sage library is completely new), because git is convinced that I am on a branch with an empty commit history -- namely, it has allowed me to delete the branch on which I was checked out.",
    "created_at": "2019-09-27T20:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447025",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:145'></a>
Replying to [jhpalmieri](#comment%3A144):
> You could try `git stash` and then `git checkout BRANCH` and then `git stash COMMAND` for some value of `COMMAND`: `git stash pop`? `git stash apply`? `git stash branch NEW`?


Certainly not. I do in fact not have any uncommitted changes! Instead, git believes that I have uncommitted changes (indeed it believes that the whole sage library is completely new), because git is convinced that I am on a branch with an empty commit history -- namely, it has allowed me to delete the branch on which I was checked out.



---

archive/issue_comments_447026.json:
```json
{
    "body": "<a id='comment:6'></a>\nYou could first also make a copy of the whole directory, in case `git stash` etc. screws things up even more. How much can you recover by doing `diff -r /path/to/py2/worktree /path/to/py3/worktree`, or maybe `git diff /path/to/py2/worktree /path/to/py3/worktree`?",
    "created_at": "2019-09-27T20:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447026",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
You could first also make a copy of the whole directory, in case `git stash` etc. screws things up even more. How much can you recover by doing `diff -r /path/to/py2/worktree /path/to/py3/worktree`, or maybe `git diff /path/to/py2/worktree /path/to/py3/worktree`?



---

archive/issue_comments_447027.json:
```json
{
    "body": "<a id='comment:147'></a>\nReplying to [jhpalmieri](#comment%3A146):\n> You could first also make a copy of the whole directory,\n\n\nHopefully the other worktree (that is still working!) is the whole directory.\n\n> in case `git stash` etc. screws things up even more. How much can you recover by doing `diff -r /path/to/py2/worktree /path/to/py3/worktree`, or maybe `git diff /path/to/py2/worktree /path/to/py3/worktree`?\n\n\nThat would be a mega-patch. It would be the diff of an empty folder and the complete Sage sources.",
    "created_at": "2019-09-27T20:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447027",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:147'></a>
Replying to [jhpalmieri](#comment%3A146):
> You could first also make a copy of the whole directory,


Hopefully the other worktree (that is still working!) is the whole directory.

> in case `git stash` etc. screws things up even more. How much can you recover by doing `diff -r /path/to/py2/worktree /path/to/py3/worktree`, or maybe `git diff /path/to/py2/worktree /path/to/py3/worktree`?


That would be a mega-patch. It would be the diff of an empty folder and the complete Sage sources.



---

archive/issue_comments_447028.json:
```json
{
    "body": "<a id='comment:148'></a>\nReplying to [SimonKing](#comment%3A147):\n> Replying to [jhpalmieri](#comment%3A146):\n> > You could first also make a copy of the whole directory,\n\n> \n> Hopefully the other worktree (that is still working!) is the whole directory.\n> \n> > in case `git stash` etc. screws things up even more. How much can you recover by doing `diff -r /path/to/py2/worktree /path/to/py3/worktree`, or maybe `git diff /path/to/py2/worktree /path/to/py3/worktree`?\n\n> \n> That would be a mega-patch. It would be the diff of an empty folder and the complete Sage sources.\n\n\nWhy? `diff -r ...` should just compare the files, and the files exist in both places, regardless of whether they're tracked by git.\n\nBy the way, if the branch still exists, can you create a new workspace using that branch?",
    "created_at": "2019-09-27T20:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447028",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:148'></a>
Replying to [SimonKing](#comment%3A147):
> Replying to [jhpalmieri](#comment%3A146):
> > You could first also make a copy of the whole directory,

> 
> Hopefully the other worktree (that is still working!) is the whole directory.
> 
> > in case `git stash` etc. screws things up even more. How much can you recover by doing `diff -r /path/to/py2/worktree /path/to/py3/worktree`, or maybe `git diff /path/to/py2/worktree /path/to/py3/worktree`?

> 
> That would be a mega-patch. It would be the diff of an empty folder and the complete Sage sources.


Why? `diff -r ...` should just compare the files, and the files exist in both places, regardless of whether they're tracked by git.

By the way, if the branch still exists, can you create a new workspace using that branch?



---

archive/issue_comments_447029.json:
```json
{
    "body": "<a id='comment:149'></a>\nReplying to [jhpalmieri](#comment%3A148):\n> Why? `diff -r ...` should just compare the files, and the files exist in both places, regardless of whether they're tracked by git.\n\n\nI see. Then the diff is empty.\n\n> By the way, if the branch still exists, can you create a new workspace using that branch?\n\n\nThat's my question. The branch for this ticket still exists, in fact it is the branch that is currently checked out in my py2 worktree. However, git won't allow me to do any normal (non-forced) operation on my py3 worktree, as the branch that was checked out there was deleted, thus, git assumes that my py3 worktree has no commit history and has a couple of thousands new files.",
    "created_at": "2019-09-27T20:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447029",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:149'></a>
Replying to [jhpalmieri](#comment%3A148):
> Why? `diff -r ...` should just compare the files, and the files exist in both places, regardless of whether they're tracked by git.


I see. Then the diff is empty.

> By the way, if the branch still exists, can you create a new workspace using that branch?


That's my question. The branch for this ticket still exists, in fact it is the branch that is currently checked out in my py2 worktree. However, git won't allow me to do any normal (non-forced) operation on my py3 worktree, as the branch that was checked out there was deleted, thus, git assumes that my py3 worktree has no commit history and has a couple of thousands new files.



---

archive/issue_comments_447030.json:
```json
{
    "body": "<a id='comment:0'></a>\nSo if the two worktrees aren't any different from the content point of view, maybe you should just create an entirely new worktree, in a new directory, using the existing branch, and delete the old one. It means you will have to rebuild Sage in the new worktree. I guess that's what you're trying to avoid?\n\nAlternatively, you could rename the old directory (`OLD -> TEMP`), create a new worktree where the old one used to be (`OLD`). Then in the shell, but without telling git, you could delete that newly created directory and rename `TEMP` back to `OLD`. Then see what git says. I think git keeps track of its worktree information in the original folder, not in the newly created one. By the way, is there anything in `.git/worktrees/`? If so, you might need to remove that before you go through this procedure.",
    "created_at": "2019-09-27T21:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447030",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:0'></a>
So if the two worktrees aren't any different from the content point of view, maybe you should just create an entirely new worktree, in a new directory, using the existing branch, and delete the old one. It means you will have to rebuild Sage in the new worktree. I guess that's what you're trying to avoid?

Alternatively, you could rename the old directory (`OLD -> TEMP`), create a new worktree where the old one used to be (`OLD`). Then in the shell, but without telling git, you could delete that newly created directory and rename `TEMP` back to `OLD`. Then see what git says. I think git keeps track of its worktree information in the original folder, not in the newly created one. By the way, is there anything in `.git/worktrees/`? If so, you might need to remove that before you go through this procedure.



---

archive/issue_comments_447031.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'm getting a few doctest failures with a Python 3 build of Sage, version 9.0.beta0. All failures have the form\n\n```\nFile \"pGroupCohomology-3.3/pGroupCohomology/cohomology.pyx\", line 4591, in pGroupCohomology.cohomology.COHO.__dir__\nFailed example:\n    [a for a in dir(H) if a.startswith('f')]    #indirect doctest\nExpected:\n    ['filter_degree_type',\n     'filter_regular_gready_parameters',\n     'filter_regular_parameters',\n     'find_dickson',\n     'find_dickson_in_subgroup',\n     'find_small_last_parameter',\n     'firstOdd',\n     'fraction_field',\n     'from_base_ring']\nGot:\n    ['filter_degree_type',\n     'filter_regular_gready_parameters',\n     'filter_regular_parameters',\n     'find_dickson',\n     'find_dickson_in_subgroup',\n     'find_small_last_parameter',\n     'firstOdd',\n     'fraction_field',\n     'free_module',\n     'from_base_ring']\n```",
    "created_at": "2019-10-10T17:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447031",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
I'm getting a few doctest failures with a Python 3 build of Sage, version 9.0.beta0. All failures have the form

```
File "pGroupCohomology-3.3/pGroupCohomology/cohomology.pyx", line 4591, in pGroupCohomology.cohomology.COHO.__dir__
Failed example:
    [a for a in dir(H) if a.startswith('f')]    #indirect doctest
Expected:
    ['filter_degree_type',
     'filter_regular_gready_parameters',
     'filter_regular_parameters',
     'find_dickson',
     'find_dickson_in_subgroup',
     'find_small_last_parameter',
     'firstOdd',
     'fraction_field',
     'from_base_ring']
Got:
    ['filter_degree_type',
     'filter_regular_gready_parameters',
     'filter_regular_parameters',
     'find_dickson',
     'find_dickson_in_subgroup',
     'find_small_last_parameter',
     'firstOdd',
     'fraction_field',
     'free_module',
     'from_base_ring']
```



---

archive/issue_comments_447032.json:
```json
{
    "body": "<a id='comment:2'></a>\nSame with Python 2 and Sage 9.0.beta0.",
    "created_at": "2019-10-10T17:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447032",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Same with Python 2 and Sage 9.0.beta0.



---

archive/issue_comments_447033.json:
```json
{
    "body": "<a id='comment:153'></a>\nReplying to [jhpalmieri](#comment%3A151):\n> \n> ```\n>      'free_module',\n> ```\n\n\nSo, if I understand correctly, the problem is both in py2 and py3., and it is about an additional entry in the dir. That should be solvable...",
    "created_at": "2019-10-28T22:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447033",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:153'></a>
Replying to [jhpalmieri](#comment%3A151):
> 
> ```
>      'free_module',
> ```


So, if I understand correctly, the problem is both in py2 and py3., and it is about an additional entry in the dir. That should be solvable...



---

archive/issue_comments_447034.json:
```json
{
    "body": "<a id='comment:4'></a>\nIs that kind of doctest too fragile? How important is it? You could certainly change it to `startswith('fi')` or add `'free_module'` to the list, but maybe there are more robust options. `'fraction_field' in dir(H)`? I guess I don't know what it's supposed to be testing.",
    "created_at": "2019-10-28T22:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447034",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Is that kind of doctest too fragile? How important is it? You could certainly change it to `startswith('fi')` or add `'free_module'` to the list, but maybe there are more robust options. `'fraction_field' in dir(H)`? I guess I don't know what it's supposed to be testing.



---

archive/issue_comments_447035.json:
```json
{
    "body": "<a id='comment:155'></a>\nReplying to [jhpalmieri](#comment%3A154):\n> Is that kind of doctest too fragile? How important is it? You could certainly change it to `startswith('fi')` or add `'free_module'` to the list, but maybe there are more robust options. `'fraction_field' in dir(H)`? I guess I don't know what it's supposed to be testing.\n\n\nIt is supposed to test introspection and autocompletion (which doesn't work in Py-3, if I understand correctly).\n\nOn the other hand, it is true that all methods in that list that do not start with \"fi\" are inherited and are thus easily changed. Perhaps it is best to insert an ellipsis.",
    "created_at": "2019-10-28T22:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447035",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:155'></a>
Replying to [jhpalmieri](#comment%3A154):
> Is that kind of doctest too fragile? How important is it? You could certainly change it to `startswith('fi')` or add `'free_module'` to the list, but maybe there are more robust options. `'fraction_field' in dir(H)`? I guess I don't know what it's supposed to be testing.


It is supposed to test introspection and autocompletion (which doesn't work in Py-3, if I understand correctly).

On the other hand, it is true that all methods in that list that do not start with "fi" are inherited and are thus easily changed. Perhaps it is best to insert an ellipsis.



---

archive/issue_comments_447036.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da\">c247f13</a></td><td><code>Fix some introspection tests</code></td></tr></table>\n",
    "created_at": "2019-10-28T22:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da">c247f13</a></td><td><code>Fix some introspection tests</code></td></tr></table>




---

archive/issue_comments_447037.json:
```json
{
    "body": "**Changing commit** from \"[7ad6a4a35c9af94d1692a17e1b8855f49d60a38e](https://github.com/sagemath/sagetrac-mirror/commit/7ad6a4a35c9af94d1692a17e1b8855f49d60a38e)\" to \"[c247f13fd6e6ae3d3feeef41ebba1a78346744da](https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da)\".",
    "created_at": "2019-10-28T22:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7ad6a4a35c9af94d1692a17e1b8855f49d60a38e](https://github.com/sagemath/sagetrac-mirror/commit/7ad6a4a35c9af94d1692a17e1b8855f49d60a38e)" to "[c247f13fd6e6ae3d3feeef41ebba1a78346744da](https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da)".



---

archive/issue_comments_447038.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have updated the tarball and the checksum\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da\">c247f13</a></td><td><code>Fix some introspection tests</code></td></tr></table>\n",
    "created_at": "2019-10-28T22:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447038",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
I have updated the tarball and the checksum

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da">c247f13</a></td><td><code>Fix some introspection tests</code></td></tr></table>




---

archive/issue_comments_447039.json:
```json
{
    "body": "<a id='comment:8'></a>\nHooray, with some long tests:\n\n```\n$ ./sage -f -c p_group_cohomology\n...\n[p_group_cohomology-3.3] ----------------------------------------------------------------------\n[p_group_cohomology-3.3] All tests passed!\n[p_group_cohomology-3.3] ----------------------------------------------------------------------\n...\n[sagelib-8.9.rc1] real\t0m18.161s\n[sagelib-8.9.rc1] user\t0m5.983s\n[sagelib-8.9.rc1] sys\t0m1.083s\nmake[2]: Leaving directory '/home/king/Sage/git/py3/build/make'\nmake[1]: Leaving directory '/home/king/Sage/git/py3/build/make'\n\nreal\t0m18.438s\nuser\t0m6.252s\nsys\t0m1.126s\nSage build/upgrade complete!\n```\nSo, it seems to work!",
    "created_at": "2019-10-28T23:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447039",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
Hooray, with some long tests:

```
$ ./sage -f -c p_group_cohomology
...
[p_group_cohomology-3.3] ----------------------------------------------------------------------
[p_group_cohomology-3.3] All tests passed!
[p_group_cohomology-3.3] ----------------------------------------------------------------------
...
[sagelib-8.9.rc1] real	0m18.161s
[sagelib-8.9.rc1] user	0m5.983s
[sagelib-8.9.rc1] sys	0m1.083s
make[2]: Leaving directory '/home/king/Sage/git/py3/build/make'
make[1]: Leaving directory '/home/king/Sage/git/py3/build/make'

real	0m18.438s
user	0m6.252s
sys	0m1.126s
Sage build/upgrade complete!
```
So, it seems to work!



---

archive/issue_comments_447040.json:
```json
{
    "body": "<a id='comment:9'></a>\nI still get one failure:\n\n```\nFile \"pGroupCohomology-3.3/pGroupCohomology/cohomology.pyx\", line 4814, in pGroupCohomology.cohomology.COHO.__getattr__\nFailed example:\n    tc.completions('H.f',globals())\nExpected:\n    ['H.filter_degree_type',\n     'H.filter_regular_gready_parameters',\n     'H.filter_regular_parameters',\n     'H.find_dickson',\n     'H.find_dickson_in_subgroup',\n     'H.find_small_last_parameter',\n     'H.firstOdd',\n     'H.fraction_field',\n     'H.from_base_ring']\nGot:\n    ['H.filter_degree_type',\n     'H.filter_regular_gready_parameters',\n     'H.filter_regular_parameters',\n     'H.find_dickson',\n     'H.find_dickson_in_subgroup',\n     'H.find_small_last_parameter',\n     'H.firstOdd',\n     'H.fraction_field',\n     'H.free_module',\n     'H.from_base_ring']\n```",
    "created_at": "2019-10-29T05:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447040",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
I still get one failure:

```
File "pGroupCohomology-3.3/pGroupCohomology/cohomology.pyx", line 4814, in pGroupCohomology.cohomology.COHO.__getattr__
Failed example:
    tc.completions('H.f',globals())
Expected:
    ['H.filter_degree_type',
     'H.filter_regular_gready_parameters',
     'H.filter_regular_parameters',
     'H.find_dickson',
     'H.find_dickson_in_subgroup',
     'H.find_small_last_parameter',
     'H.firstOdd',
     'H.fraction_field',
     'H.from_base_ring']
Got:
    ['H.filter_degree_type',
     'H.filter_regular_gready_parameters',
     'H.filter_regular_parameters',
     'H.find_dickson',
     'H.find_dickson_in_subgroup',
     'H.find_small_last_parameter',
     'H.firstOdd',
     'H.fraction_field',
     'H.free_module',
     'H.from_base_ring']
```



---

archive/issue_comments_447041.json:
```json
{
    "body": "<a id='comment:0'></a>\nToo bad that those tests work for me, i.e., it is easy to miss one of those tests.\n\nTrying again (in a few minutes...).",
    "created_at": "2019-10-29T05:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447041",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:0'></a>
Too bad that those tests work for me, i.e., it is easy to miss one of those tests.

Trying again (in a few minutes...).



---

archive/issue_comments_447042.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0\">6c5dafc</a></td><td><code>Silence another flaky doctest</code></td></tr></table>\n",
    "created_at": "2019-10-29T05:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0">6c5dafc</a></td><td><code>Silence another flaky doctest</code></td></tr></table>




---

archive/issue_comments_447043.json:
```json
{
    "body": "**Changing commit** from \"[c247f13fd6e6ae3d3feeef41ebba1a78346744da](https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da)\" to \"[6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)\".",
    "created_at": "2019-10-29T05:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c247f13fd6e6ae3d3feeef41ebba1a78346744da](https://github.com/sagemath/sagetrac-mirror/commit/c247f13fd6e6ae3d3feeef41ebba1a78346744da)" to "[6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)".



---

archive/issue_comments_447044.json:
```json
{
    "body": "<a id='comment:2'></a>\nShould be fixed now.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0\">6c5dafc</a></td><td><code>Silence another flaky doctest</code></td></tr></table>\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0\">6c5dafc</a></td><td><code>Silence another flaky doctest</code></td></tr></table>\n",
    "created_at": "2019-10-29T05:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447044",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
Should be fixed now.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0">6c5dafc</a></td><td><code>Silence another flaky doctest</code></td></tr></table>

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0">6c5dafc</a></td><td><code>Silence another flaky doctest</code></td></tr></table>




---

archive/issue_comments_447045.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2019-10-29T15:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447045",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_447046.json:
```json
{
    "body": "<a id='comment:3'></a>\n\n```\nAll tests passed!\n```",
    "created_at": "2019-10-29T15:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447046",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>

```
All tests passed!
```



---

archive/issue_events_255788.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-29T15:28:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255788"
}
```



---

archive/issue_events_255789.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-29T15:28:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255789"
}
```



---

archive/issue_events_255790.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-29T19:29:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255790"
}
```



---

archive/issue_events_255791.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-29T19:29:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255791"
}
```



---

archive/issue_events_255792.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-30T23:47:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255792"
}
```



---

archive/issue_events_255793.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-30T23:47:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28414#event-255793"
}
```



---

archive/issue_comments_447047.json:
```json
{
    "body": "**Changing branch** from \"[u/SimonKing/p_group_cohomology_in_py_3](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/p_group_cohomology_in_py_3)\" to \"[6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)\".",
    "created_at": "2019-10-30T23:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447047",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/SimonKing/p_group_cohomology_in_py_3](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/p_group_cohomology_in_py_3)" to "[6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)".



---

archive/issue_comments_447048.json:
```json
{
    "body": "<a id='comment:6'></a>\n`sdh_X` scripts call `sdh_die` themselves, so doing\n`sdh_X || sdh_die ...` is equivalent to simply `sdh_X`.\n\nThe intention of calling `sdh_die` to produce a meaninful error message is commendable, but these after `||` just won't be called.\n\nIt's better to modify `sdh_X` to allow for custiom error messages, I suppose.",
    "created_at": "2019-11-12T16:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447048",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
`sdh_X` scripts call `sdh_die` themselves, so doing
`sdh_X || sdh_die ...` is equivalent to simply `sdh_X`.

The intention of calling `sdh_die` to produce a meaninful error message is commendable, but these after `||` just won't be called.

It's better to modify `sdh_X` to allow for custiom error messages, I suppose.



---

archive/issue_comments_447049.json:
```json
{
    "body": "**Changing commit** from \"[6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)\" to \"\".",
    "created_at": "2019-11-12T16:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28414#issuecomment-447049",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0](https://github.com/sagemath/sagetrac-mirror/commit/6c5dafcd777ae5b36b22b4e2fd1bb242d7af5cd0)" to "".
