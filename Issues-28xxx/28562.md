# Issue 28562: Tensor Fields: Better Zero Treatment

archive/issues_028325.json:
```json
{
    "body": "The zero element is always a special element. Therefore it should be treated as such. It should shorten computations and certainly be immutable. This ticket is devoted to that topic. (Similarly for the one element in the scalar field and mixed form algebra).\n\nThis ticket is part of the metaticket #28519.\n\n**Features**\n\n- an assertion error arises when altering the fixed elements zero or one\n- a new attribute `_is_zero` is added to tensor fields and mixed form (similar to scalar fields)\n- computations with involved zero or one are shortened by using a simple check\n- due to immutability of algebra elements, no copies are returned anymore for scalar field operations with zero or one\n- `_is_zero` attribute is applied for copies\n\nCC:  @tscrim @egourgoulhon\n\nKeywords: manifolds, tensor fields, scalar fields, mixed forms\n\nReviewer: Eric Gourgoulhon, Travis Scrimshaw\n\nAuthor: Michael Jung\n\nBranch: f2928f882a5a8eb345dd11c308e895d615f9de9d\n\nCommit: f2928f882a5a8eb345dd11c308e895d615f9de9d\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28562\n\n",
    "closed_at": "2019-10-26T22:20:26Z",
    "created_at": "2019-10-06T09:59:02Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Tensor Fields: Better Zero Treatment",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28562",
    "user": "https://github.com/DeRhamSource"
}
```
The zero element is always a special element. Therefore it should be treated as such. It should shorten computations and certainly be immutable. This ticket is devoted to that topic. (Similarly for the one element in the scalar field and mixed form algebra).

This ticket is part of the metaticket #28519.

**Features**

- an assertion error arises when altering the fixed elements zero or one
- a new attribute `_is_zero` is added to tensor fields and mixed form (similar to scalar fields)
- computations with involved zero or one are shortened by using a simple check
- due to immutability of algebra elements, no copies are returned anymore for scalar field operations with zero or one
- `_is_zero` attribute is applied for copies

CC:  @tscrim @egourgoulhon

Keywords: manifolds, tensor fields, scalar fields, mixed forms

Reviewer: Eric Gourgoulhon, Travis Scrimshaw

Author: Michael Jung

Branch: f2928f882a5a8eb345dd11c308e895d615f9de9d

Commit: f2928f882a5a8eb345dd11c308e895d615f9de9d

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28562





---

archive/issue_comments_399550.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-10-06T10:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399550",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_399551.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-06T12:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399552.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-07T19:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399553.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to geometry.",
    "created_at": "2019-10-07T19:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399553",
    "user": "https://github.com/DeRhamSource"
}
```

Changing component from PLEASE CHANGE to geometry.



---

archive/issue_comments_399554.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-07T19:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399554",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_399555.json:
```json
{
    "body": "<a id='comment:8'></a>In `MixedForm`, the zero (and one element for scalar fields) is treated separately. The code in there is not very beautiful, but it works for now. However, I plan to reorganize the code of mixed forms anyway (see #28519).",
    "created_at": "2019-10-07T19:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399555",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:8'></a>In `MixedForm`, the zero (and one element for scalar fields) is treated separately. The code in there is not very beautiful, but it works for now. However, I plan to reorganize the code of mixed forms anyway (see #28519).



---

archive/issue_comments_399556.json:
```json
{
    "body": "<a id='comment:9'></a>Also, I removed the `_zero_element` attribute in the free modules and replaced it by a cached `zero()` method. This is a better solution, I guess.",
    "created_at": "2019-10-07T19:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399556",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:9'></a>Also, I removed the `_zero_element` attribute in the free modules and replaced it by a cached `zero()` method. This is a better solution, I guess.



---

archive/issue_comments_399557.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-07T20:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399558.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-07T20:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399559.json:
```json
{
    "body": "<a id='comment:12'></a>The code snippet (see commits 5d30100 and \u200bd949a13) was quite messy. Well, it still is. At least it is readable and works for now. It gets a little bit better after merging (see #28519).\n\nI will think about a better solution. But I guess, this requires a complete reorganization of the mixed form code.",
    "created_at": "2019-10-07T20:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399559",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:12'></a>The code snippet (see commits 5d30100 and â€‹d949a13) was quite messy. Well, it still is. At least it is readable and works for now. It gets a little bit better after merging (see #28519).

I will think about a better solution. But I guess, this requires a complete reorganization of the mixed form code.



---

archive/issue_comments_399560.json:
```json
{
    "body": "<a id='comment:13'></a>After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. (As a mathematician, I feel the urge to solve or fix a problem/error as soon as it occurs. Here: Doctest errors.) The thing is, due to our little discussion in #28519, the doctest must be flawed since mixed forms defined via preconstructed forms get altered.\n\nSo, I 'm going to delete this snippet again and modify the affected doctests.\n\nDo you agree with my conclusion and procedure?\n\nA further doctest change is devoted to #28578.",
    "created_at": "2019-10-08T23:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399560",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:13'></a>After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. (As a mathematician, I feel the urge to solve or fix a problem/error as soon as it occurs. Here: Doctest errors.) The thing is, due to our little discussion in #28519, the doctest must be flawed since mixed forms defined via preconstructed forms get altered.

So, I 'm going to delete this snippet again and modify the affected doctests.

Do you agree with my conclusion and procedure?

A further doctest change is devoted to #28578.



---

archive/issue_comments_399561.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-10-08T23:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399561",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_399562.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 gh-DeRhamSource]:\n> After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. \n\n\nWhich code snippet are you talking about? All the code in this ticket branch?",
    "created_at": "2019-10-09T08:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399562",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>Replying to [comment:13 gh-DeRhamSource]:
> After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. 


Which code snippet are you talking about? All the code in this ticket branch?



---

archive/issue_comments_399563.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 egourgoulhon]:\n> Replying to [comment:13 gh-DeRhamSource]:\n> > After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. \n\n> \n> Which code snippet are you talking about? All the code in this ticket branch?\n> \n\nNo, only the last two/three commits. Namely the changes in `set_restriction` of `mixed_form.py`.",
    "created_at": "2019-10-09T08:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399563",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:16'></a>Replying to [comment:15 egourgoulhon]:
> Replying to [comment:13 gh-DeRhamSource]:
> > After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. 

> 
> Which code snippet are you talking about? All the code in this ticket branch?
> 

No, only the last two/three commits. Namely the changes in `set_restriction` of `mixed_form.py`.



---

archive/issue_comments_399564.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:13 gh-DeRhamSource]:\n> After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. (As a mathematician, I feel the urge to solve or fix a problem/error as soon as it occurs. Here: Doctest errors.) The thing is, due to our little discussion in #28519, the doctest must be flawed since mixed forms defined via preconstructed forms get altered.\n> \n> So, I 'm going to delete this snippet again and modify the affected doctests.\n> \n> Do you agree with my conclusion and procedure?\n\n\nI am not sure to understand what you have in mind; I would say please go on and implement what you think is the best solution.",
    "created_at": "2019-10-09T13:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399564",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:17'></a>Replying to [comment:13 gh-DeRhamSource]:
> After a bit of thinking, I came to the conclusion that the code snippet should be obsolete. (As a mathematician, I feel the urge to solve or fix a problem/error as soon as it occurs. Here: Doctest errors.) The thing is, due to our little discussion in #28519, the doctest must be flawed since mixed forms defined via preconstructed forms get altered.
> 
> So, I 'm going to delete this snippet again and modify the affected doctests.
> 
> Do you agree with my conclusion and procedure?


I am not sure to understand what you have in mind; I would say please go on and implement what you think is the best solution.



---

archive/issue_comments_399565.json:
```json
{
    "body": "<a id='comment:18'></a>\n```\nsage: M = Manifold(2, 'M') # the 2-dimensional sphere S^2\nsage: U = M.open_subset('U') # complement of the North pole\nsage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole\nsage: V = M.open_subset('V') # complement of the South pole\nsage: c_uv.<u,v> = V.chart() # stereographic coordinates from the South pole\nsage: M.declare_union(U,V)   # S^2 is the union of U and V\nsage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),\n....:                intersection_name='W', restrictions1= x^2+y^2!=0,\n....:                restrictions2= u^2+v^2!=0)\nsage: uv_to_xy = xy_to_uv.inverse()\nsage: e_xy = c_xy.frame(); e_uv = c_uv.frame()\nsage: f = M.scalar_field(x, name='f')\nsage: omega = M.diff_form(1, name='omega')\nsage: omega[e_xy,0] = x\nsage: F = M.mixed_form(name='F', comp=[f, omega, 0])\nsage: F.add_comp_by_continuation(e_xy, U.intersection(V), c_xy)\nsage: F.add_comp_by_continuation(e_uv, U.intersection(V), c_uv)\n```\n\nThis is an example of how I used `add_comp_by_continuation` in the doctest. Obviously, this is a *bad* example. To ensure the \"immutability\" of mixed forms, the `comp` attribute should be used for already fully defined differential forms only. Whenever a incremental definition is explicitly wanted, `F[1][e_xy,0] = x` or `F[1] = M.one_form({e_xy: [x,0]}, name='omega')` should be used instead, and **then** `add_comp_by_continuation` is reasonable to use.\n\nAt least, that is my suggestion of how to use mixed forms.\n\nTravis? Would you agree?",
    "created_at": "2019-10-10T14:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399565",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:18'></a>
```
sage: M = Manifold(2, 'M') # the 2-dimensional sphere S^2
sage: U = M.open_subset('U') # complement of the North pole
sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole
sage: V = M.open_subset('V') # complement of the South pole
sage: c_uv.<u,v> = V.chart() # stereographic coordinates from the South pole
sage: M.declare_union(U,V)   # S^2 is the union of U and V
sage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),
....:                intersection_name='W', restrictions1= x^2+y^2!=0,
....:                restrictions2= u^2+v^2!=0)
sage: uv_to_xy = xy_to_uv.inverse()
sage: e_xy = c_xy.frame(); e_uv = c_uv.frame()
sage: f = M.scalar_field(x, name='f')
sage: omega = M.diff_form(1, name='omega')
sage: omega[e_xy,0] = x
sage: F = M.mixed_form(name='F', comp=[f, omega, 0])
sage: F.add_comp_by_continuation(e_xy, U.intersection(V), c_xy)
sage: F.add_comp_by_continuation(e_uv, U.intersection(V), c_uv)
```

This is an example of how I used `add_comp_by_continuation` in the doctest. Obviously, this is a *bad* example. To ensure the "immutability" of mixed forms, the `comp` attribute should be used for already fully defined differential forms only. Whenever a incremental definition is explicitly wanted, `F[1][e_xy,0] = x` or `F[1] = M.one_form({e_xy: [x,0]}, name='omega')` should be used instead, and **then** `add_comp_by_continuation` is reasonable to use.

At least, that is my suggestion of how to use mixed forms.

Travis? Would you agree?



---

archive/issue_comments_399566.json:
```json
{
    "body": "<a id='comment:19'></a>I am not sure I completely understand the question, or the subtleties in the use case. So I don't think I can make a reasonable comment here.",
    "created_at": "2019-10-10T14:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399566",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>I am not sure I completely understand the question, or the subtleties in the use case. So I don't think I can make a reasonable comment here.



---

archive/issue_comments_399567.json:
```json
{
    "body": "<a id='comment:20'></a>Mh. Sorry for that. I try again: The thing in the example above is that the zero element gets manipulated via `add_comp_by_continuation`, or `set_restriction` respectively. This indicates, the whole example (even if there is no zero element involved) is a bad use of this methods.\n\nBetter would be:\n\n\n```\nsage: M = Manifold(2, 'M') # the 2-dimensional sphere S^2\nsage: U = M.open_subset('U') # complement of the North pole\nsage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole\nsage: V = M.open_subset('V') # complement of the South pole\nsage: c_uv.<u,v> = V.chart() # stereographic coordinates from the South pole\nsage: M.declare_union(U,V)   # S^2 is the union of U and V\nsage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),\n....:                intersection_name='W', restrictions1= x^2+y^2!=0,\n....:                restrictions2= u^2+v^2!=0)\nsage: uv_to_xy = xy_to_uv.inverse()\nsage: e_xy = c_xy.frame(); e_uv = c_uv.frame()\nsage: f = M.scalar_field(x, name='f')\nsage: f.add_expr_by_continuation(c_uv, U.intersection(V))\nsage: omega = M.diff_form(1, name='omega')\nsage: omega[e_xy,0] = x\nsage: omega.add_comp_by_continuation(e_uv, U.intersection(V), c_uv)\nsage: F = M.mixed_form(name='F', comp=[f, omega, 0])\n```\n\nYet, I noticed that `add_comp_by_continuation` seems not being convenient at all. It runs into problems as soon as there is a homogeneous component defined which should not be altered or has no tensor component in the corresponding intersection domain. Therefore, if one single homogeneous component shall be zero, and all other components shall be continued, which is a reasonable use, this methods fails to fulfill its purpose.\n\nSorry, I'm not that much into that kind of thinking, especially the immutability of sage objects, and may confuse all around me including myself. :D",
    "created_at": "2019-10-10T15:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399567",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:20'></a>Mh. Sorry for that. I try again: The thing in the example above is that the zero element gets manipulated via `add_comp_by_continuation`, or `set_restriction` respectively. This indicates, the whole example (even if there is no zero element involved) is a bad use of this methods.

Better would be:


```
sage: M = Manifold(2, 'M') # the 2-dimensional sphere S^2
sage: U = M.open_subset('U') # complement of the North pole
sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole
sage: V = M.open_subset('V') # complement of the South pole
sage: c_uv.<u,v> = V.chart() # stereographic coordinates from the South pole
sage: M.declare_union(U,V)   # S^2 is the union of U and V
sage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),
....:                intersection_name='W', restrictions1= x^2+y^2!=0,
....:                restrictions2= u^2+v^2!=0)
sage: uv_to_xy = xy_to_uv.inverse()
sage: e_xy = c_xy.frame(); e_uv = c_uv.frame()
sage: f = M.scalar_field(x, name='f')
sage: f.add_expr_by_continuation(c_uv, U.intersection(V))
sage: omega = M.diff_form(1, name='omega')
sage: omega[e_xy,0] = x
sage: omega.add_comp_by_continuation(e_uv, U.intersection(V), c_uv)
sage: F = M.mixed_form(name='F', comp=[f, omega, 0])
```

Yet, I noticed that `add_comp_by_continuation` seems not being convenient at all. It runs into problems as soon as there is a homogeneous component defined which should not be altered or has no tensor component in the corresponding intersection domain. Therefore, if one single homogeneous component shall be zero, and all other components shall be continued, which is a reasonable use, this methods fails to fulfill its purpose.

Sorry, I'm not that much into that kind of thinking, especially the immutability of sage objects, and may confuse all around me including myself. :D



---

archive/issue_comments_399568.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-10T21:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399568",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399569.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-10-10T21:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399569",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_399570.json:
```json
{
    "body": "<a id='comment:22'></a>What about this?",
    "created_at": "2019-10-10T21:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399570",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:22'></a>What about this?



---

archive/issue_comments_399571.json:
```json
{
    "body": "<a id='comment:23'></a>I guess it depends on how you define zero. Although if I think of this like a graded module, `0` exists in all graded parts simultaneously, so by analogy, the `add_comp_by_continuation` does work correctly. Although as a computer implementation that requires some more precision, this might not be feasible.",
    "created_at": "2019-10-11T01:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399571",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>I guess it depends on how you define zero. Although if I think of this like a graded module, `0` exists in all graded parts simultaneously, so by analogy, the `add_comp_by_continuation` does work correctly. Although as a computer implementation that requires some more precision, this might not be feasible.



---

archive/issue_comments_399572.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-11T07:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399572",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_399573.json:
```json
{
    "body": "<a id='comment:24'></a>Yes, you're absolutely right. So, seeing things more from the mathematical point of view is always the way to go, right?\n\nThe problem here is that `add_comp_by_continuation` invokes the `add_comp` method for tensor fields which raises an error when it is used by the zero element. To make it usable in this case, a separate treatment of zero must be implemented.",
    "created_at": "2019-10-11T07:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399573",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:24'></a>Yes, you're absolutely right. So, seeing things more from the mathematical point of view is always the way to go, right?

The problem here is that `add_comp_by_continuation` invokes the `add_comp` method for tensor fields which raises an error when it is used by the zero element. To make it usable in this case, a separate treatment of zero must be implemented.



---

archive/issue_comments_399574.json:
```json
{
    "body": "<a id='comment:25'></a>I started the whole thing again from scratch since `add_comp_by_continuation` did not work properly in a mathematical manner.\n\nMoreover, I (hopefully) improved the preexisting code.\n\nIn the commits, there are two alternatives presented: One using a flag `check_elements` and one using a separate method without security check. I'd prefer the second solution. It is completely hidden for the user and may become convenient when more checks are established in the future.",
    "created_at": "2019-10-12T12:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399574",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:25'></a>I started the whole thing again from scratch since `add_comp_by_continuation` did not work properly in a mathematical manner.

Moreover, I (hopefully) improved the preexisting code.

In the commits, there are two alternatives presented: One using a flag `check_elements` and one using a separate method without security check. I'd prefer the second solution. It is completely hidden for the user and may become convenient when more checks are established in the future.



---

archive/issue_comments_399575.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-12T12:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399575",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_399576.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-12T12:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399576",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399577.json:
```json
{
    "body": "<a id='comment:27'></a>What I wanted to say with my previous message: I am not a professional programmer, however I had quite a few difficulties in modifying the code and perform a proper debugging. There are some code redundancies and hidden dependencies which could be susceptible for further modifications (like: a modification of `add_comp` in `tensorfield.py` caused severe troubles in `automorphismfield.py`). Perhaps, some code delegations and/or reusabilities are useful in the farther future?",
    "created_at": "2019-10-12T17:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399577",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:27'></a>What I wanted to say with my previous message: I am not a professional programmer, however I had quite a few difficulties in modifying the code and perform a proper debugging. There are some code redundancies and hidden dependencies which could be susceptible for further modifications (like: a modification of `add_comp` in `tensorfield.py` caused severe troubles in `automorphismfield.py`). Perhaps, some code delegations and/or reusabilities are useful in the farther future?



---

archive/issue_comments_399578.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-12T18:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399578",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399579.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-12T19:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399580.json:
```json
{
    "body": "<a id='comment:30'></a>I just gave a quick look at the latest version. Looks good. I'll have a deeper look tomorrow.",
    "created_at": "2019-10-13T21:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399580",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:30'></a>I just gave a quick look at the latest version. Looks good. I'll have a deeper look tomorrow.



---

archive/issue_comments_399581.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-17T09:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399582.json:
```json
{
    "body": "<a id='comment:32'></a>I've finally gone through the ticket. The impression stated in comment:30 is confirmed: this is a nice improvement of the code! Thank you. I have made minor modifications, which have been pushed in the above branch. In particular \n- the pyflake error reported by the patchbot is corrected\n- `t(0)` has been changed to `t.zero()` and `gl(1)` to `gl.one()` (to skip one function call)\n- some `add/set_comp(basis)` have been changed to `add/set_comp(basis=basis)`\n- the treatment of zero has been added in `FreeModuleTensor._sub_()`\n\nDo you agree with these changes?\n\n---\nNew commits:",
    "created_at": "2019-10-22T10:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399582",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:32'></a>I've finally gone through the ticket. The impression stated in comment:30 is confirmed: this is a nice improvement of the code! Thank you. I have made minor modifications, which have been pushed in the above branch. In particular 
- the pyflake error reported by the patchbot is corrected
- `t(0)` has been changed to `t.zero()` and `gl(1)` to `gl.one()` (to skip one function call)
- some `add/set_comp(basis)` have been changed to `add/set_comp(basis=basis)`
- the treatment of zero has been added in `FreeModuleTensor._sub_()`

Do you agree with these changes?

---
New commits:



---

archive/issue_comments_399583.json:
```json
{
    "body": "<a id='comment:33'></a>Yes, looks good! :)",
    "created_at": "2019-10-22T10:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399583",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:33'></a>Yes, looks good! :)



---

archive/issue_comments_399584.json:
```json
{
    "body": "<a id='comment:34'></a>I just have two trivial changes:\n\n```diff\n-The components w.r.t. basis e have been kept::\n+The components with respect to basis ``e`` have been kept::\n```\nand in `automorphismfield.py`:\n\n```\n    def add_comp(self, basis=None):\n        r\"\"\"\n\n        Return the components of ``self`` w.r.t. a given module basis for\n        assignment, keeping the components w.r.t. other bases.\n\n        To delete the components w.r.t. other bases, use the method\n        :meth:`set_comp` instead.\n```\nremove the blank line after `r\"\"\"` and same thing of spelling out `w.r.t.` (although I suspect this is done elsewhere, I think it is better to avoid abbreviations like this as this is a more \"formal\" document, but I don't care too much).",
    "created_at": "2019-10-22T14:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399584",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>I just have two trivial changes:

```diff
-The components w.r.t. basis e have been kept::
+The components with respect to basis ``e`` have been kept::
```
and in `automorphismfield.py`:

```
    def add_comp(self, basis=None):
        r"""

        Return the components of ``self`` w.r.t. a given module basis for
        assignment, keeping the components w.r.t. other bases.

        To delete the components w.r.t. other bases, use the method
        :meth:`set_comp` instead.
```
remove the blank line after `r"""` and same thing of spelling out `w.r.t.` (although I suspect this is done elsewhere, I think it is better to avoid abbreviations like this as this is a more "formal" document, but I don't care too much).



---

archive/issue_comments_399585.json:
```json
{
    "body": "<a id='comment:35'></a>On my side, one last remark: the names of the methods `_add_comp_unsafe()` and `_set_comp_unsafe()` give the impression that they are really dangerous methods that should be avoided, while they are key methods, doing most of the work of `add_comp()` and `set_comp()`. \nSince they are *private* methods, I don't think it is necessary to insist too much on their \"unsafe\" aspect, which is truly unsafe only when invoked on the special elements zero and one. Wouldn't something like `_add_comp_nocheck()` and `_set_comp_nocheck()` be better names? Travis, do you have an opinion on that?",
    "created_at": "2019-10-22T14:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399585",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:35'></a>On my side, one last remark: the names of the methods `_add_comp_unsafe()` and `_set_comp_unsafe()` give the impression that they are really dangerous methods that should be avoided, while they are key methods, doing most of the work of `add_comp()` and `set_comp()`. 
Since they are *private* methods, I don't think it is necessary to insist too much on their "unsafe" aspect, which is truly unsafe only when invoked on the special elements zero and one. Wouldn't something like `_add_comp_nocheck()` and `_set_comp_nocheck()` be better names? Travis, do you have an opinion on that?



---

archive/issue_comments_399586.json:
```json
{
    "body": "<a id='comment:36'></a>This naming convention matches what is done for vectors (and maybe matrices?) in Sage. Although in that case, if you mess with things in the wrong way, you will crash Sage. However, given the nomenclature of other methods, I think `*_unsafe` is the way to go.",
    "created_at": "2019-10-22T14:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399586",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>This naming convention matches what is done for vectors (and maybe matrices?) in Sage. Although in that case, if you mess with things in the wrong way, you will crash Sage. However, given the nomenclature of other methods, I think `*_unsafe` is the way to go.



---

archive/issue_comments_399587.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:36 tscrim]:\n> This naming convention matches what is done for vectors (and maybe matrices?) in Sage. \n\n\nAh yes! (`grep -r \"_unsafe\"` in `src/sage` returns 872 entries; I was not aware of that). So OK for `*_unsafe` then...",
    "created_at": "2019-10-22T14:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399587",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:37'></a>Replying to [comment:36 tscrim]:
> This naming convention matches what is done for vectors (and maybe matrices?) in Sage. 


Ah yes! (`grep -r "_unsafe"` in `src/sage` returns 872 entries; I was not aware of that). So OK for `*_unsafe` then...



---

archive/issue_comments_399588.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T15:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399589.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:34 tscrim]:\n> I just have two trivial changes:\n> \n> ```diff\n> -The components w.r.t. basis e have been kept::\n> +The components with respect to basis ``e`` have been kept::\n> ```\n\n\nSince this issue is not just devoted to this ticket, I vote for a new ticket on that.\n\n> and in `automorphismfield.py`:\n> \n> ```\n>     def add_comp(self, basis=None):\n>         r\"\"\"\n> \n>         Return the components of ``self`` w.r.t. a given module basis for\n>         assignment, keeping the components w.r.t. other bases.\n> \n>         To delete the components w.r.t. other bases, use the method\n>         :meth:`set_comp` instead.\n> ```\n> remove the blank line after `r\"\"\"` and same thing of spelling out `w.r.t.` (although I suspect this is done elsewhere, I think it is better to avoid abbreviations like this as this is a more \"formal\" document, but I don't care too much).\n\n\nDone.",
    "created_at": "2019-10-22T15:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399589",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:39'></a>Replying to [comment:34 tscrim]:
> I just have two trivial changes:
> 
> ```diff
> -The components w.r.t. basis e have been kept::
> +The components with respect to basis ``e`` have been kept::
> ```


Since this issue is not just devoted to this ticket, I vote for a new ticket on that.

> and in `automorphismfield.py`:
> 
> ```
>     def add_comp(self, basis=None):
>         r"""
> 
>         Return the components of ``self`` w.r.t. a given module basis for
>         assignment, keeping the components w.r.t. other bases.
> 
>         To delete the components w.r.t. other bases, use the method
>         :meth:`set_comp` instead.
> ```
> remove the blank line after `r"""` and same thing of spelling out `w.r.t.` (although I suspect this is done elsewhere, I think it is better to avoid abbreviations like this as this is a more "formal" document, but I don't care too much).


Done.



---

archive/issue_comments_399590.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:39 gh-DeRhamSource]:\n> Replying to [comment:34 tscrim]:\n> > I just have two trivial changes:\n> > \n> > ```diff\n> > -The components w.r.t. basis e have been kept::\n> > +The components with respect to basis ``e`` have been kept::\n> > ```\n\n> \n> Since this issue is not just devoted to this ticket, I vote for a new ticket on that.\n> \n\n\nIndeed. I am afraid I am responsible for most of these `w.r.t.` ;-)",
    "created_at": "2019-10-22T18:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399590",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:40'></a>Replying to [comment:39 gh-DeRhamSource]:
> Replying to [comment:34 tscrim]:
> > I just have two trivial changes:
> > 
> > ```diff
> > -The components w.r.t. basis e have been kept::
> > +The components with respect to basis ``e`` have been kept::
> > ```

> 
> Since this issue is not just devoted to this ticket, I vote for a new ticket on that.
> 


Indeed. I am afraid I am responsible for most of these `w.r.t.` ;-)



---

archive/issue_comments_399591.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-22T18:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399591",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_399592.json:
```json
{
    "body": "<a id='comment:41'></a>Thanks for your work on this!",
    "created_at": "2019-10-22T18:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399592",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:41'></a>Thanks for your work on this!



---

archive/issue_comments_399593.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-26T22:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28562#issuecomment-399593",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_071705.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-26T22:20:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28562",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28562#event-71705"
}
```
