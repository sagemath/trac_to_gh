# Issue 28721: Document sage-dist-helpers

archive/issues_028484.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nDocument the bash functions `sdh_make` and friends in the Sage developer's guide. (Currently they are only documented in their source file, `build/bin/sage-dist-helpers`.)\n\nComponent: **documentation**\n\nAuthor: **John Palmieri**\n\nBranch/Commit: **[`33abf8f`](https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28721_\n\n",
    "closed_at": "2019-11-16T20:15:23Z",
    "created_at": "2019-11-12T04:15:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Document sage-dist-helpers",
    "type": "issue",
    "updated_at": "2019-11-16T20:15:23Z",
    "url": "https://github.com/sagemath/sage/issues/28721",
    "user": "https://github.com/jhpalmieri"
}
```
<div id="comment:0"></div>

Document the bash functions `sdh_make` and friends in the Sage developer's guide. (Currently they are only documented in their source file, `build/bin/sage-dist-helpers`.)

Component: **documentation**

Author: **John Palmieri**

Branch/Commit: **[`33abf8f`](https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/28721_





---

archive/issue_events_391482.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-12T04:15:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391482"
}
```



---

archive/issue_events_391483.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-12T04:15:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391483"
}
```



---

archive/issue_events_391484.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-12T04:15:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391484"
}
```



---

archive/issue_events_391485.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-12T04:15:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391485"
}
```



---

archive/issue_comments_447896.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/sdh-docs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sdh-docs)**",
    "created_at": "2019-11-12T04:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447896",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/sdh-docs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sdh-docs)**



---

archive/issue_events_391486.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-11-12T04:15:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391486"
}
```



---

archive/issue_comments_447897.json:
```json
{
    "body": "Commit: **[`bbd044a`](https://github.com/sagemath/sagetrac-mirror/commit/bbd044a85231ed4834c3aeccf3c69c38cc95ff20)**",
    "created_at": "2019-11-12T04:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447897",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`bbd044a`](https://github.com/sagemath/sagetrac-mirror/commit/bbd044a85231ed4834c3aeccf3c69c38cc95ff20)**



---

archive/issue_comments_447898.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbd044a85231ed4834c3aeccf3c69c38cc95ff20\"><code>bbd044a</code></a></td><td><code>trac 28721: document the functions in sage-dist-helpers.</code></td></tr></table>\n",
    "created_at": "2019-11-12T04:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447898",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbd044a85231ed4834c3aeccf3c69c38cc95ff20"><code>bbd044a</code></a></td><td><code>trac 28721: document the functions in sage-dist-helpers.</code></td></tr></table>




---

archive/issue_comments_447899.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe pattern `sdh_XYZ || sdh_die ...` one sees in few places is not necessary, and `sdh_XYZ` alone suffices, isn't it?\n\nBy looking at the code of e.g. `sdh_configure`\none sees that `sdh_die` is actually called in `sdh_configure`, and so chaining them\nas above is pointless (the part after `||` won't be called).\n\nThis should be mentioned in the docs.",
    "created_at": "2019-11-12T09:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447899",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

The pattern `sdh_XYZ || sdh_die ...` one sees in few places is not necessary, and `sdh_XYZ` alone suffices, isn't it?

By looking at the code of e.g. `sdh_configure`
one sees that `sdh_die` is actually called in `sdh_configure`, and so chaining them
as above is pointless (the part after `||` won't be called).

This should be mentioned in the docs.



---

archive/issue_comments_447900.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nBy the way, there was already a ticket for this task at #24023.\n\nSomething I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.",
    "created_at": "2019-11-12T14:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447900",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

By the way, there was already a ticket for this task at #24023.

Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.



---

archive/issue_comments_447901.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIn any case, this is definitely good enough for now, thank you for taking care of it.",
    "created_at": "2019-11-12T14:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447901",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

In any case, this is definitely good enough for now, thank you for taking care of it.



---

archive/issue_comments_447902.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@embray](#comment%3A4):\n> By the way, there was already a ticket for this task at #24023.\n\nOops, sorry.\n\n> Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.\n\nMaybe we can leave #24023 open for that.",
    "created_at": "2019-11-12T16:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447902",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@embray](#comment%3A4):
> By the way, there was already a ticket for this task at #24023.

Oops, sorry.

> Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.

Maybe we can leave #24023 open for that.



---

archive/issue_comments_447903.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jhpalmieri](#comment%3A6):\n> Replying to [@embray](#comment%3A4):\n> > By the way, there was already a ticket for this task at #24023.\n> \n> \n> Oops, sorry.\n\nNo problem.  Personally I sometimes even prefer opening separate tickets for specific solutions to a problem from the ticket for the problem itself.\n\n> > Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.\n> \n> \n> Maybe we can leave #24023 open for that.\n\nThat makes sense.",
    "created_at": "2019-11-12T16:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447903",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jhpalmieri](#comment%3A6):
> Replying to [@embray](#comment%3A4):
> > By the way, there was already a ticket for this task at #24023.
> 
> 
> Oops, sorry.

No problem.  Personally I sometimes even prefer opening separate tickets for specific solutions to a problem from the ticket for the problem itself.

> > Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.
> 
> 
> Maybe we can leave #24023 open for that.

That makes sense.



---

archive/issue_comments_447904.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc\"><code>33abf8f</code></a></td><td><code>trac 28721: do not combine sdh_BLAH with sdh_die</code></td></tr></table>\n",
    "created_at": "2019-11-12T16:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447904",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc"><code>33abf8f</code></a></td><td><code>trac 28721: do not combine sdh_BLAH with sdh_die</code></td></tr></table>




---

archive/issue_comments_447905.json:
```json
{
    "body": "Changed commit from **[`bbd044a`](https://github.com/sagemath/sagetrac-mirror/commit/bbd044a85231ed4834c3aeccf3c69c38cc95ff20)** to **[`33abf8f`](https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc)**",
    "created_at": "2019-11-12T16:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447905",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bbd044a`](https://github.com/sagemath/sagetrac-mirror/commit/bbd044a85231ed4834c3aeccf3c69c38cc95ff20)** to **[`33abf8f`](https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc)**



---

archive/issue_comments_447906.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@dimpase](#comment%3A3):\n> The pattern `sdh_XYZ || sdh_die ...` one sees in few places is not necessary, and `sdh_XYZ` alone suffices, isn't it?\n> \n> By looking at the code of e.g. `sdh_configure`\n> one sees that `sdh_die` is actually called in `sdh_configure`, and so chaining them\n> as above is pointless (the part after `||` won't be called).\n> \n> This should be mentioned in the docs.\n\nI added a note about this.",
    "created_at": "2019-11-12T16:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447906",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@dimpase](#comment%3A3):
> The pattern `sdh_XYZ || sdh_die ...` one sees in few places is not necessary, and `sdh_XYZ` alone suffices, isn't it?
> 
> By looking at the code of e.g. `sdh_configure`
> one sees that `sdh_die` is actually called in `sdh_configure`, and so chaining them
> as above is pointless (the part after `||` won't be called).
> 
> This should be mentioned in the docs.

I added a note about this.



---

archive/issue_events_391487.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-11-12T22:39:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391487"
}
```



---

archive/issue_events_391488.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-11-12T22:39:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391488"
}
```



---

archive/issue_comments_447907.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-11-12T22:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447907",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_447908.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThanks. Looks good to me; the still missing part is package de-installation, and the related JSON files, but it can be on another ticket.",
    "created_at": "2019-11-12T22:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447908",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

Thanks. Looks good to me; the still missing part is package de-installation, and the related JSON files, but it can be on another ticket.



---

archive/issue_comments_447909.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nspecifically about JSON files, de-installation is handled by `build/sage_bootstrap/uninstall.py`, and there are good docs there, but I don't know where these JSON files are written.\n\nI have a vague recollection I knew it once, but it's not clear to me now, without digging through the whole command chain and makefiles... :-(",
    "created_at": "2019-11-12T22:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447909",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

specifically about JSON files, de-installation is handled by `build/sage_bootstrap/uninstall.py`, and there are good docs there, but I don't know where these JSON files are written.

I have a vague recollection I knew it once, but it's not clear to me now, without digging through the whole command chain and makefiles... :-(



---

archive/issue_comments_447910.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSeems to be written by `build/bin/sage-spkg`, starting at line 1000:\n\n```\nPKG_NAME_INSTALLED=\"$SAGE_SPKG_INST/$PKG_NAME\"\ncat > \"$PKG_NAME_INSTALLED\" << __EOF__\n{\n    \"package_name\": \"$PKG_BASE\",\n    \"package_version\": \"$PKG_VER\",\n    \"install_date\": \"$(date)\",\n    \"system_uname\": \"$(uname -a)\",\n    \"sage_version\": \"$(cat \"${SAGE_ROOT}/VERSION.txt\")\",\n    \"test_result\": \"$TEST_SUITE_RESULT\",\n    \"files\": [\n        $FILE_LIST\n    ]\n}\n__EOF__\n```\nThe file manifest is constructed at line 899-900:\n\n```\n    # Generate installed file manifest\n    FILE_LIST=\"$(cd \"$PREFIX\" && find . -type f -o -type l | sed 's|^\\./||' | sort)\"\n```",
    "created_at": "2019-11-12T23:36:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447910",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Seems to be written by `build/bin/sage-spkg`, starting at line 1000:

```
PKG_NAME_INSTALLED="$SAGE_SPKG_INST/$PKG_NAME"
cat > "$PKG_NAME_INSTALLED" << __EOF__
{
    "package_name": "$PKG_BASE",
    "package_version": "$PKG_VER",
    "install_date": "$(date)",
    "system_uname": "$(uname -a)",
    "sage_version": "$(cat "${SAGE_ROOT}/VERSION.txt")",
    "test_result": "$TEST_SUITE_RESULT",
    "files": [
        $FILE_LIST
    ]
}
__EOF__
```
The file manifest is constructed at line 899-900:

```
    # Generate installed file manifest
    FILE_LIST="$(cd "$PREFIX" && find . -type f -o -type l | sed 's|^\./||' | sort)"
```



---

archive/issue_comments_447911.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/sdh-docs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sdh-docs)** to **[`33abf8f`](https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc)**",
    "created_at": "2019-11-16T20:15:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28721#issuecomment-447911",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/sdh-docs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sdh-docs)** to **[`33abf8f`](https://github.com/sagemath/sagetrac-mirror/commit/33abf8f4c01a7c2f5e2ca0ae4abefbad6267b5bc)**



---

archive/issue_events_391489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-16T20:15:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391489"
}
```



---

archive/issue_events_391490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a55e518077ff5857da26a2d8c595396a125c49fa",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-11-16T20:15:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28721",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28721#event-391490"
}
```
