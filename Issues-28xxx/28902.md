# Issue 28902: Cythonize hypergeometric trace formula

archive/issues_028665.json:
```json
{
    "assignees": [],
    "body": "The goal of this ticket is to improve upon this comparison between Magma:\n\n```\n> H := HypergeometricData([3],[4]);\n> time EulerFactor(H, 1/2, 1000003);                                           \n1000003*$.1^2 - 788*$.1 + 1\nTime: 2.840\n> H := HypergeometricData([10],[5]);  \n> time EulerFactor(H, 1/2, 1009);\n1018081*$.1^4 + 8072*$.1^3 + 590*$.1^2 + 8*$.1 + 1\nTime: 4.890\n> H := HypergeometricData([[10,6],[5,4]]);\n> time EulerFactor(H, 1/2, 61);\n11694146092834141*$.1^6 - 14271143697997*$.1^5 - 13901224364*$.1^4 + \n    104106138*$.1^3 - 61244*$.1^2 - 277*$.1 + 1\nTime: 4.670\n```\nand Sage:\n\n```\nsage: from sage.modular.hypergeometric_motive import HypergeometricData as HG\nsage: H = HG(cyclotomic=[[3],[4]])\nsage: time H.euler_factor(2, 1000003)\nWall time: 1min 5s\n1000003*T^2 - 788*T + 1\nsage: H = HG(cyclotomic=[[10],[5]])\nsage: time H.euler_factor(2, 1009)\nWall time: 49 s\n1018081*T^4 + 8072*T^3 + 590*T^2 + 8*T + 1\nsage: H = HG(cyclotomic=[[10,6],[5,4]])\nsage: time H.euler_factor(2, 61)\nWall time: 14.8 s\n11694146092834141*T^6 - 14271143697997*T^5 - 13901224364*T^4 + 104106138*T^3 - 61244*T^2 - 277*T + 1\n```\nby moving two bottleneck steps into Cython.\n\n- Computing Gauss sums via the Gross-Koblitz formula, in the `gauss_table` function in `rings/padics/padic_generic_element.pyx`.\n  - We refactor Sage's implementation of the p-adic Gamma function to expose some internals as C functions.\n  - When possible, we do the p-adic computations using C longs.\n  - We short-circuit the computation when the working precision equals 1. This benefits the case of a degree-2 L-function.\n  - We enable global caching of the Gauss sums, as in Magma's `HypergeometricMotiveSaveLimit` function.\n- Computing products of Gauss sums needed for the hypergeometric trace formula, in the `hgm_coeffs` function in `modular/hypergeometric_misc.pyx`.\n  - We again use C longs when possible.\n\n\nCC:  @roed314\n\nKeywords: **hypergeometric motives**\n\nBranch/Commit: **[a7bfd25](https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89)**\n\nReviewer: **David Roe, Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Kiran Kedlaya**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28902_\n\n",
    "closed_at": "2020-01-11T17:45:04Z",
    "created_at": "2019-12-20T17:30:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20modular%20forms",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Cythonize hypergeometric trace formula",
    "type": "issue",
    "updated_at": "2020-01-11T17:45:04Z",
    "url": "https://github.com/sagemath/sage/issues/28902",
    "user": "https://github.com/kedlaya"
}
```
The goal of this ticket is to improve upon this comparison between Magma:

```
> H := HypergeometricData([3],[4]);
> time EulerFactor(H, 1/2, 1000003);                                           
1000003*$.1^2 - 788*$.1 + 1
Time: 2.840
> H := HypergeometricData([10],[5]);  
> time EulerFactor(H, 1/2, 1009);
1018081*$.1^4 + 8072*$.1^3 + 590*$.1^2 + 8*$.1 + 1
Time: 4.890
> H := HypergeometricData([[10,6],[5,4]]);
> time EulerFactor(H, 1/2, 61);
11694146092834141*$.1^6 - 14271143697997*$.1^5 - 13901224364*$.1^4 + 
    104106138*$.1^3 - 61244*$.1^2 - 277*$.1 + 1
Time: 4.670
```
and Sage:

```
sage: from sage.modular.hypergeometric_motive import HypergeometricData as HG
sage: H = HG(cyclotomic=[[3],[4]])
sage: time H.euler_factor(2, 1000003)
Wall time: 1min 5s
1000003*T^2 - 788*T + 1
sage: H = HG(cyclotomic=[[10],[5]])
sage: time H.euler_factor(2, 1009)
Wall time: 49 s
1018081*T^4 + 8072*T^3 + 590*T^2 + 8*T + 1
sage: H = HG(cyclotomic=[[10,6],[5,4]])
sage: time H.euler_factor(2, 61)
Wall time: 14.8 s
11694146092834141*T^6 - 14271143697997*T^5 - 13901224364*T^4 + 104106138*T^3 - 61244*T^2 - 277*T + 1
```
by moving two bottleneck steps into Cython.

- Computing Gauss sums via the Gross-Koblitz formula, in the `gauss_table` function in `rings/padics/padic_generic_element.pyx`.
  - We refactor Sage's implementation of the p-adic Gamma function to expose some internals as C functions.
  - When possible, we do the p-adic computations using C longs.
  - We short-circuit the computation when the working precision equals 1. This benefits the case of a degree-2 L-function.
  - We enable global caching of the Gauss sums, as in Magma's `HypergeometricMotiveSaveLimit` function.
- Computing products of Gauss sums needed for the hypergeometric trace formula, in the `hgm_coeffs` function in `modular/hypergeometric_misc.pyx`.
  - We again use C longs when possible.


CC:  @roed314

Keywords: **hypergeometric motives**

Branch/Commit: **[a7bfd25](https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89)**

Reviewer: **David Roe, Frédéric Chapoton**

Author: **Kiran Kedlaya**

_Issue created by migration from https://trac.sagemath.org/ticket/28902_





---

archive/issue_events_378849.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-12-20T17:30:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378849"
}
```



---

archive/issue_events_378850.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-12-20T17:30:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20modular%20forms",
    "label_color": "0000ff",
    "label_name": "component: modular forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378850"
}
```



---

archive/issue_events_378851.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-12-20T17:30:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378851"
}
```



---

archive/issue_events_378852.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-12-20T17:30:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378852"
}
```



---

archive/issue_comments_454109.json:
```json
{
    "body": "Branch: **[u/kedlaya/cythonize_hgm](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm)**",
    "created_at": "2019-12-20T17:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454109",
    "user": "https://github.com/kedlaya"
}
```

Branch: **[u/kedlaya/cythonize_hgm](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm)**



---

archive/issue_comments_454110.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nOne additional change: I refined the precision bound a bit. Particularly in degree 2, it makes a substantial difference to work with one p-adic digit rather than two (the computation of p-adic Gamma scales noticeably linearly in the number of digits).\n\nTimings I recorded on this branch (same machine as before):\n\n```\nsage: from sage.modular.hypergeometric_motive import HypergeometricData as HG\nsage: H = HG(cyclotomic=[[3],[4]])\nsage: time H.euler_factor(2, 1000003)\nWall time: 13 s\n1000003*T^2 - 788*T + 1\nsage: H = HG(cyclotomic=[[10],[5]])\nsage: time H.euler_factor(2, 1009)\nWall time: 14.6 s\n1018081*T^4 + 8072*T^3 + 590*T^2 + 8*T + 1\nsage: H = HG(cyclotomic=[[10,6],[5,4]])\nsage: time H.euler_factor(2, 61)\nWall time: 4.87 s\n11694146092834141*T^6 - 14271143697997*T^5 - 13901224364*T^4 + 104106138*T^3 - 61244*T^2 - 277*T + 1\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d23d2e8ab6160bf3d4508f2cf6a29d0c97929e80\">d23d2e8</a></td><td><code>Cythonize hypergeometric trace formula</code></td></tr></table>\n",
    "created_at": "2019-12-20T17:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454110",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:2'>Comment 2:</a>
One additional change: I refined the precision bound a bit. Particularly in degree 2, it makes a substantial difference to work with one p-adic digit rather than two (the computation of p-adic Gamma scales noticeably linearly in the number of digits).

Timings I recorded on this branch (same machine as before):

```
sage: from sage.modular.hypergeometric_motive import HypergeometricData as HG
sage: H = HG(cyclotomic=[[3],[4]])
sage: time H.euler_factor(2, 1000003)
Wall time: 13 s
1000003*T^2 - 788*T + 1
sage: H = HG(cyclotomic=[[10],[5]])
sage: time H.euler_factor(2, 1009)
Wall time: 14.6 s
1018081*T^4 + 8072*T^3 + 590*T^2 + 8*T + 1
sage: H = HG(cyclotomic=[[10,6],[5,4]])
sage: time H.euler_factor(2, 61)
Wall time: 4.87 s
11694146092834141*T^6 - 14271143697997*T^5 - 13901224364*T^4 + 104106138*T^3 - 61244*T^2 - 277*T + 1
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d23d2e8ab6160bf3d4508f2cf6a29d0c97929e80">d23d2e8</a></td><td><code>Cythonize hypergeometric trace formula</code></td></tr></table>




---

archive/issue_comments_454111.json:
```json
{
    "body": "Commit: **[d23d2e8](https://github.com/sagemath/sagetrac-mirror/commit/d23d2e8ab6160bf3d4508f2cf6a29d0c97929e80)**",
    "created_at": "2019-12-20T17:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454111",
    "user": "https://github.com/kedlaya"
}
```

Commit: **[d23d2e8](https://github.com/sagemath/sagetrac-mirror/commit/d23d2e8ab6160bf3d4508f2cf6a29d0c97929e80)**



---

archive/issue_comments_454112.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0948ef0161d6caa325af127624421e646dfca697\">0948ef0</a></td><td><code>Move evaluation of Dwork expansion to a cdef function</code></td></tr></table>\n",
    "created_at": "2019-12-21T18:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454112",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0948ef0161d6caa325af127624421e646dfca697">0948ef0</a></td><td><code>Move evaluation of Dwork expansion to a cdef function</code></td></tr></table>




---

archive/issue_comments_454113.json:
```json
{
    "body": "Changed commit from **[d23d2e8](https://github.com/sagemath/sagetrac-mirror/commit/d23d2e8ab6160bf3d4508f2cf6a29d0c97929e80)** to **[0948ef0](https://github.com/sagemath/sagetrac-mirror/commit/0948ef0161d6caa325af127624421e646dfca697)**",
    "created_at": "2019-12-21T18:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454113",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d23d2e8](https://github.com/sagemath/sagetrac-mirror/commit/d23d2e8ab6160bf3d4508f2cf6a29d0c97929e80)** to **[0948ef0](https://github.com/sagemath/sagetrac-mirror/commit/0948ef0161d6caa325af127624421e646dfca697)**



---

archive/issue_comments_454114.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nIn this commit, I moved the evaluation of the Mahler series for `p`-adic Gamma into a helper cdef function; this eliminates some Python call overhead. As a bonus, I can undo the change in call syntax to `dwork_expansion` and thereby restore backward compatibility.\n\nI also made some additional optimizations in the case where the working precision is 1, as in the first of my examples.\n\nFinally, I moved the precomputation of the Mahler series into `padics/misc.py`. This seems like a step backward since that is not a Cython file, but conceptually it seemed to make sense, and it doesn't have much effect on the timings.\n\nWith this commit, the timings are down to 9.15s, 11s, 3.81s. Some cleanup and doctests still needed.",
    "created_at": "2019-12-21T18:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454114",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:4'>Comment 4:</a>
In this commit, I moved the evaluation of the Mahler series for `p`-adic Gamma into a helper cdef function; this eliminates some Python call overhead. As a bonus, I can undo the change in call syntax to `dwork_expansion` and thereby restore backward compatibility.

I also made some additional optimizations in the case where the working precision is 1, as in the first of my examples.

Finally, I moved the precomputation of the Mahler series into `padics/misc.py`. This seems like a step backward since that is not a Cython file, but conceptually it seemed to make sense, and it doesn't have much effect on the timings.

With this commit, the timings are down to 9.15s, 11s, 3.81s. Some cleanup and doctests still needed.



---

archive/issue_comments_454115.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3064b8100e02ec65d92b81f953098a9cbd19649\">f3064b8</a></td><td><code>Add early abort in main loop of hgm_coeffs</code></td></tr></table>\n",
    "created_at": "2019-12-21T21:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454115",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3064b8100e02ec65d92b81f953098a9cbd19649">f3064b8</a></td><td><code>Add early abort in main loop of hgm_coeffs</code></td></tr></table>




---

archive/issue_comments_454116.json:
```json
{
    "body": "Changed commit from **[0948ef0](https://github.com/sagemath/sagetrac-mirror/commit/0948ef0161d6caa325af127624421e646dfca697)** to **[f3064b8](https://github.com/sagemath/sagetrac-mirror/commit/f3064b8100e02ec65d92b81f953098a9cbd19649)**",
    "created_at": "2019-12-21T21:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454116",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0948ef0](https://github.com/sagemath/sagetrac-mirror/commit/0948ef0161d6caa325af127624421e646dfca697)** to **[f3064b8](https://github.com/sagemath/sagetrac-mirror/commit/f3064b8100e02ec65d92b81f953098a9cbd19649)**



---

archive/issue_comments_454117.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6051397d9ee22fffde14966404a26376bfbef325\">6051397</a></td><td><code>Add doctests</code></td></tr></table>\n",
    "created_at": "2019-12-21T22:10:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454117",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6051397d9ee22fffde14966404a26376bfbef325">6051397</a></td><td><code>Add doctests</code></td></tr></table>




---

archive/issue_comments_454118.json:
```json
{
    "body": "Changed commit from **[f3064b8](https://github.com/sagemath/sagetrac-mirror/commit/f3064b8100e02ec65d92b81f953098a9cbd19649)** to **[6051397](https://github.com/sagemath/sagetrac-mirror/commit/6051397d9ee22fffde14966404a26376bfbef325)**",
    "created_at": "2019-12-21T22:10:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454118",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f3064b8](https://github.com/sagemath/sagetrac-mirror/commit/f3064b8100e02ec65d92b81f953098a9cbd19649)** to **[6051397](https://github.com/sagemath/sagetrac-mirror/commit/6051397d9ee22fffde14966404a26376bfbef325)**



---

archive/issue_comments_454119.json:
```json
{
    "body": "Changed commit from **[6051397](https://github.com/sagemath/sagetrac-mirror/commit/6051397d9ee22fffde14966404a26376bfbef325)** to **[04d14f2](https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716)**",
    "created_at": "2019-12-21T23:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454119",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6051397](https://github.com/sagemath/sagetrac-mirror/commit/6051397d9ee22fffde14966404a26376bfbef325)** to **[04d14f2](https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716)**



---

archive/issue_comments_454120.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716\">04d14f2</a></td><td><code>Add cdef local variable to dwork_mahler_coeffs</code></td></tr></table>\n",
    "created_at": "2019-12-21T23:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454120",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716">04d14f2</a></td><td><code>Add cdef local variable to dwork_mahler_coeffs</code></td></tr></table>




---

archive/issue_comments_454121.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThis batch of commits implements a speedup to `hgm_coeffs`: it turns out that some of the coefficients are forced to be zero for combinatorial reasons, and it is helpful to order the computation so that this vanishing can be detected for an early abort. The relevance of this will vary with the hypergeometric data.\n\nFor the examples I am testing, the latest timings are 5.48s, 7.81s, 2.77s.\n\nI also added doctests to restore 100% coverage in the affected files.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716\">04d14f2</a></td><td><code>Add cdef local variable to dwork_mahler_coeffs</code></td></tr></table>\n",
    "created_at": "2019-12-21T23:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454121",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:8'>Comment 8:</a>
This batch of commits implements a speedup to `hgm_coeffs`: it turns out that some of the coefficients are forced to be zero for combinatorial reasons, and it is helpful to order the computation so that this vanishing can be detected for an early abort. The relevance of this will vary with the hypergeometric data.

For the examples I am testing, the latest timings are 5.48s, 7.81s, 2.77s.

I also added doctests to restore 100% coverage in the affected files.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716">04d14f2</a></td><td><code>Add cdef local variable to dwork_mahler_coeffs</code></td></tr></table>




---

archive/issue_comments_454122.json:
```json
{
    "body": "Changed commit from **[04d14f2](https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716)** to **[7c1e45a](https://github.com/sagemath/sagetrac-mirror/commit/7c1e45a9cf7f365d69b2a8b7efddc2e266859c85)**",
    "created_at": "2019-12-22T06:54:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454122",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[04d14f2](https://github.com/sagemath/sagetrac-mirror/commit/04d14f2a62f0a27e481c14c5a762053176a83716)** to **[7c1e45a](https://github.com/sagemath/sagetrac-mirror/commit/7c1e45a9cf7f365d69b2a8b7efddc2e266859c85)**



---

archive/issue_comments_454123.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c1e45a9cf7f365d69b2a8b7efddc2e266859c85\">7c1e45a</a></td><td><code>In HGM, get p_ring from an always defined entity</code></td></tr></table>\n",
    "created_at": "2019-12-22T06:54:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454123",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c1e45a9cf7f365d69b2a8b7efddc2e266859c85">7c1e45a</a></td><td><code>In HGM, get p_ring from an always defined entity</code></td></tr></table>




---

archive/issue_comments_454124.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3160926eb753e7290e62f5d84577e8f3e7061509\">3160926</a></td><td><code>Optimizations in inner loop of gauss_table</code></td></tr></table>\n",
    "created_at": "2019-12-22T23:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454124",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3160926eb753e7290e62f5d84577e8f3e7061509">3160926</a></td><td><code>Optimizations in inner loop of gauss_table</code></td></tr></table>




---

archive/issue_comments_454125.json:
```json
{
    "body": "Changed commit from **[7c1e45a](https://github.com/sagemath/sagetrac-mirror/commit/7c1e45a9cf7f365d69b2a8b7efddc2e266859c85)** to **[3160926](https://github.com/sagemath/sagetrac-mirror/commit/3160926eb753e7290e62f5d84577e8f3e7061509)**",
    "created_at": "2019-12-22T23:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454125",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7c1e45a](https://github.com/sagemath/sagetrac-mirror/commit/7c1e45a9cf7f365d69b2a8b7efddc2e266859c85)** to **[3160926](https://github.com/sagemath/sagetrac-mirror/commit/3160926eb753e7290e62f5d84577e8f3e7061509)**



---

archive/issue_comments_454126.json:
```json
{
    "body": "Changed commit from **[3160926](https://github.com/sagemath/sagetrac-mirror/commit/3160926eb753e7290e62f5d84577e8f3e7061509)** to **[ebad8fb](https://github.com/sagemath/sagetrac-mirror/commit/ebad8fbdeff9f848afba85655e87ae2c8ff8cdde)**",
    "created_at": "2019-12-23T23:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454126",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3160926](https://github.com/sagemath/sagetrac-mirror/commit/3160926eb753e7290e62f5d84577e8f3e7061509)** to **[ebad8fb](https://github.com/sagemath/sagetrac-mirror/commit/ebad8fbdeff9f848afba85655e87ae2c8ff8cdde)**



---

archive/issue_comments_454127.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1519c36e44beb7bdb00de0d6329e7608c45fad4\">a1519c3</a></td><td><code>Refactor: dwork_mahler_coeffs to padic_generic_element.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebad8fbdeff9f848afba85655e87ae2c8ff8cdde\">ebad8fb</a></td><td><code>Use longs when possible in gauss_table</code></td></tr></table>\n",
    "created_at": "2019-12-23T23:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454127",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1519c36e44beb7bdb00de0d6329e7608c45fad4">a1519c3</a></td><td><code>Refactor: dwork_mahler_coeffs to padic_generic_element.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebad8fbdeff9f848afba85655e87ae2c8ff8cdde">ebad8fb</a></td><td><code>Use longs when possible in gauss_table</code></td></tr></table>




---

archive/issue_comments_454128.json:
```json
{
    "body": "Changed commit from **[ebad8fb](https://github.com/sagemath/sagetrac-mirror/commit/ebad8fbdeff9f848afba85655e87ae2c8ff8cdde)** to **[e5138ac](https://github.com/sagemath/sagetrac-mirror/commit/e5138ac7fc79d14fa9032183a3570801d2f4a38f)**",
    "created_at": "2019-12-24T02:03:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454128",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ebad8fb](https://github.com/sagemath/sagetrac-mirror/commit/ebad8fbdeff9f848afba85655e87ae2c8ff8cdde)** to **[e5138ac](https://github.com/sagemath/sagetrac-mirror/commit/e5138ac7fc79d14fa9032183a3570801d2f4a38f)**



---

archive/issue_comments_454129.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48dfb028b9bef400d076687887e20ed82c84aab3\">48dfb02</a></td><td><code>Make _gauss_table a class attribute to simplify cache management</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56e1b7e46799b6f7c6aa22556e650fb8817fea8b\">56e1b7e</a></td><td><code>Pass integer part of gauss_table as an array of longs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5138ac7fc79d14fa9032183a3570801d2f4a38f\">e5138ac</a></td><td><code>Use longs when possible in hgm_coeffs</code></td></tr></table>\n",
    "created_at": "2019-12-24T02:03:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454129",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48dfb028b9bef400d076687887e20ed82c84aab3">48dfb02</a></td><td><code>Make _gauss_table a class attribute to simplify cache management</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56e1b7e46799b6f7c6aa22556e650fb8817fea8b">56e1b7e</a></td><td><code>Pass integer part of gauss_table as an array of longs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5138ac7fc79d14fa9032183a3570801d2f4a38f">e5138ac</a></td><td><code>Use longs when possible in hgm_coeffs</code></td></tr></table>




---

archive/issue_comments_454130.json:
```json
{
    "body": "Changed branch from **[u/kedlaya/cythonize_hgm](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm)** to **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)**",
    "created_at": "2019-12-25T16:26:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454130",
    "user": "https://github.com/kedlaya"
}
```

Changed branch from **[u/kedlaya/cythonize_hgm](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm)** to **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)**



---

archive/issue_comments_454131.json:
```json
{
    "body": "Changed commit from **[e5138ac](https://github.com/sagemath/sagetrac-mirror/commit/e5138ac7fc79d14fa9032183a3570801d2f4a38f)** to none",
    "created_at": "2019-12-25T16:26:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454131",
    "user": "https://github.com/kedlaya"
}
```

Changed commit from **[e5138ac](https://github.com/sagemath/sagetrac-mirror/commit/e5138ac7fc79d14fa9032183a3570801d2f4a38f)** to none



---

archive/issue_comments_454132.json:
```json
{
    "body": "Commit: **[9fc8f1b](https://github.com/sagemath/sagetrac-mirror/commit/9fc8f1b29dc9372452b5baa1614553c9110b548f)**",
    "created_at": "2019-12-25T16:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454132",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[9fc8f1b](https://github.com/sagemath/sagetrac-mirror/commit/9fc8f1b29dc9372452b5baa1614553c9110b548f)**



---

archive/issue_comments_454133.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9fc8f1b29dc9372452b5baa1614553c9110b548f\">9fc8f1b</a></td><td><code>Summary commit of Cythonization of HGMs</code></td></tr></table>\n",
    "created_at": "2019-12-25T16:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454133",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9fc8f1b29dc9372452b5baa1614553c9110b548f">9fc8f1b</a></td><td><code>Summary commit of Cythonization of HGMs</code></td></tr></table>




---

archive/issue_comments_454134.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nTo clean things up, I squashed the preceding commits and the next one into a single commit on a new branch. Timings in the three examples are now quite comparable with Magma: 3.57s, 4.75s, 2.73s.\n\nTo test things more deeply (particularly the cacheing functionality), I reran a computation from the LMFDB: this iterates over all hypergeometric data of degree 2 through 10 and computes various Euler factors. All answers agree with Magma.\n\nAt this point I think I'm ready to put this to review.",
    "created_at": "2019-12-25T16:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454134",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:15'>Comment 15:</a>
To clean things up, I squashed the preceding commits and the next one into a single commit on a new branch. Timings in the three examples are now quite comparable with Magma: 3.57s, 4.75s, 2.73s.

To test things more deeply (particularly the cacheing functionality), I reran a computation from the LMFDB: this iterates over all hypergeometric data of degree 2 through 10 and computes various Euler factors. All answers agree with Magma.

At this point I think I'm ready to put this to review.



---

archive/issue_comments_454135.json:
```json
{
    "body": "Author: **Kiran Kedlaya**",
    "created_at": "2019-12-25T16:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454135",
    "user": "https://github.com/kedlaya"
}
```

Author: **Kiran Kedlaya**



---

archive/issue_events_378853.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-12-25T16:30:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378853"
}
```



---

archive/issue_comments_454136.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,9 +32,13 @@\n Wall time: 14.8 s\n 11694146092834141*T^6 - 14271143697997*T^5 - 13901224364*T^4 + 104106138*T^3 - 61244*T^2 - 277*T + 1\n ```\n-by moving some bottleneck steps into Cython.\n+by moving two bottleneck steps into Cython.\n \n-- `dwork_expansion`, used to compute the p-adic Gamma function.\n-- Computing Gauss sums via the Gross-Koblitz formula. These should be cached if one is going to compute the trace formula multiple times for the same prime (Magma already provides this option).\n-- Computing the coefficients of the hypergeometric trace formula. These should be cached if one is going to fix the hypergeometric data and the prime, and loop over parameter values.\n+- Computing Gauss sums via the Gross-Koblitz formula, in the `gauss_table` function in `rings/padics/padic_generic_element.pyx`.\n+  - We refactor Sage's implementation of the p-adic Gamma function to expose some internals as C functions.\n+  - When possible, we do the p-adic computations using C longs.\n+  - We short-circuit the computation when the working precision equals 1. This benefits the case of a degree-2 L-function.\n+  - We enable global caching of the Gauss sums, as in Magma's `HypergeometricMotiveSaveLimit` function.\n+- Computing products of Gauss sums needed for the hypergeometric trace formula, in the `hgm_coeffs` function in `modular/hypergeometric_misc.pyx`.\n+  - We again use C longs when possible.\n \n``````\n",
    "created_at": "2019-12-25T16:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454136",
    "user": "https://github.com/kedlaya"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,9 +32,13 @@
 Wall time: 14.8 s
 11694146092834141*T^6 - 14271143697997*T^5 - 13901224364*T^4 + 104106138*T^3 - 61244*T^2 - 277*T + 1
 ```
-by moving some bottleneck steps into Cython.
+by moving two bottleneck steps into Cython.
 
-- `dwork_expansion`, used to compute the p-adic Gamma function.
-- Computing Gauss sums via the Gross-Koblitz formula. These should be cached if one is going to compute the trace formula multiple times for the same prime (Magma already provides this option).
-- Computing the coefficients of the hypergeometric trace formula. These should be cached if one is going to fix the hypergeometric data and the prime, and loop over parameter values.
+- Computing Gauss sums via the Gross-Koblitz formula, in the `gauss_table` function in `rings/padics/padic_generic_element.pyx`.
+  - We refactor Sage's implementation of the p-adic Gamma function to expose some internals as C functions.
+  - When possible, we do the p-adic computations using C longs.
+  - We short-circuit the computation when the working precision equals 1. This benefits the case of a degree-2 L-function.
+  - We enable global caching of the Gauss sums, as in Magma's `HypergeometricMotiveSaveLimit` function.
+- Computing products of Gauss sums needed for the hypergeometric trace formula, in the `hgm_coeffs` function in `modular/hypergeometric_misc.pyx`.
+  - We again use C longs when possible.
 
``````




---

archive/issue_comments_454137.json:
```json
{
    "body": "Changed commit from **[9fc8f1b](https://github.com/sagemath/sagetrac-mirror/commit/9fc8f1b29dc9372452b5baa1614553c9110b548f)** to **[98fc6b7](https://github.com/sagemath/sagetrac-mirror/commit/98fc6b7b245185f5bf1f369907fa501eb865e738)**",
    "created_at": "2019-12-27T02:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454137",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9fc8f1b](https://github.com/sagemath/sagetrac-mirror/commit/9fc8f1b29dc9372452b5baa1614553c9110b548f)** to **[98fc6b7](https://github.com/sagemath/sagetrac-mirror/commit/98fc6b7b245185f5bf1f369907fa501eb865e738)**



---

archive/issue_comments_454138.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/848c5153e3ae401051ef77e54bb3660b85d1f668\">848c515</a></td><td><code>Summary commit of Cythonization of HGMs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65d3cacb324e4d02c82b8d25a00979d697ee1c6e\">65d3cac</a></td><td><code>Fix pyflakes issues in hypergeometric_motive.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98fc6b7b245185f5bf1f369907fa501eb865e738\">98fc6b7</a></td><td><code>Merge remote-tracking branch 'refs/remotes/trac/u/kedlaya/cythonize_hgm_v2' into cythonize_hgm_v2</code></td></tr></table>\n",
    "created_at": "2019-12-27T02:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454138",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/848c5153e3ae401051ef77e54bb3660b85d1f668">848c515</a></td><td><code>Summary commit of Cythonization of HGMs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65d3cacb324e4d02c82b8d25a00979d697ee1c6e">65d3cac</a></td><td><code>Fix pyflakes issues in hypergeometric_motive.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98fc6b7b245185f5bf1f369907fa501eb865e738">98fc6b7</a></td><td><code>Merge remote-tracking branch 'refs/remotes/trac/u/kedlaya/cythonize_hgm_v2' into cythonize_hgm_v2</code></td></tr></table>




---

archive/issue_comments_454139.json:
```json
{
    "body": "Changed commit from **[98fc6b7](https://github.com/sagemath/sagetrac-mirror/commit/98fc6b7b245185f5bf1f369907fa501eb865e738)** to **[3b3873d](https://github.com/sagemath/sagetrac-mirror/commit/3b3873d77e4ee5c88fea86ad25e8d9649e8a5ccb)**",
    "created_at": "2019-12-30T17:55:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454139",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[98fc6b7](https://github.com/sagemath/sagetrac-mirror/commit/98fc6b7b245185f5bf1f369907fa501eb865e738)** to **[3b3873d](https://github.com/sagemath/sagetrac-mirror/commit/3b3873d77e4ee5c88fea86ad25e8d9649e8a5ccb)**



---

archive/issue_comments_454140.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b3873d77e4ee5c88fea86ad25e8d9649e8a5ccb\">3b3873d</a></td><td><code>Remove non-ASCII character from docstring</code></td></tr></table>\n",
    "created_at": "2019-12-30T17:55:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454140",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b3873d77e4ee5c88fea86ad25e8d9649e8a5ccb">3b3873d</a></td><td><code>Remove non-ASCII character from docstring</code></td></tr></table>




---

archive/issue_comments_454141.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nSome of the patchbots found a non-ASCII issue. This should fix that.",
    "created_at": "2019-12-30T17:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454141",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:18'>Comment 18:</a>
Some of the patchbots found a non-ASCII issue. This should fix that.



---

archive/issue_comments_454142.json:
```json
{
    "body": "Changed branch from **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)** to **[u/roed/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/cythonize_hgm_v2)**",
    "created_at": "2019-12-31T08:52:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454142",
    "user": "https://github.com/roed314"
}
```

Changed branch from **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)** to **[u/roed/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/cythonize_hgm_v2)**



---

archive/issue_comments_454143.json:
```json
{
    "body": "Reviewer: **David Roe**",
    "created_at": "2019-12-31T08:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454143",
    "user": "https://github.com/roed314"
}
```

Reviewer: **David Roe**



---

archive/issue_comments_454144.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nI made a few minor changes and one somewhat substantial one (switching from a Python list to a C array of long longs, which gave a 33% speedup in the second example when I tested).  If you're happy with the changes and tests pass, I'm happy to give this ticket a positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d70c8420027e08f9bf3cd372a42632d8603735c5\">d70c842</a></td><td><code>Minor tweaks and change to long long* for dwork coeffs when using longs</code></td></tr></table>\n",
    "created_at": "2019-12-31T08:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454144",
    "user": "https://github.com/roed314"
}
```

<a id='comment:20'>Comment 20:</a>
I made a few minor changes and one somewhat substantial one (switching from a Python list to a C array of long longs, which gave a 33% speedup in the second example when I tested).  If you're happy with the changes and tests pass, I'm happy to give this ticket a positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d70c8420027e08f9bf3cd372a42632d8603735c5">d70c842</a></td><td><code>Minor tweaks and change to long long* for dwork coeffs when using longs</code></td></tr></table>




---

archive/issue_comments_454145.json:
```json
{
    "body": "Changed commit from **[3b3873d](https://github.com/sagemath/sagetrac-mirror/commit/3b3873d77e4ee5c88fea86ad25e8d9649e8a5ccb)** to **[d70c842](https://github.com/sagemath/sagetrac-mirror/commit/d70c8420027e08f9bf3cd372a42632d8603735c5)**",
    "created_at": "2019-12-31T08:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454145",
    "user": "https://github.com/roed314"
}
```

Changed commit from **[3b3873d](https://github.com/sagemath/sagetrac-mirror/commit/3b3873d77e4ee5c88fea86ad25e8d9649e8a5ccb)** to **[d70c842](https://github.com/sagemath/sagetrac-mirror/commit/d70c8420027e08f9bf3cd372a42632d8603735c5)**



---

archive/issue_comments_454146.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cb678864d998407a536a9cf04fab1b218aa0375\">0cb6788</a></td><td><code>Remove unnecessary import</code></td></tr></table>\n",
    "created_at": "2019-12-31T09:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454146",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cb678864d998407a536a9cf04fab1b218aa0375">0cb6788</a></td><td><code>Remove unnecessary import</code></td></tr></table>




---

archive/issue_comments_454147.json:
```json
{
    "body": "Changed commit from **[d70c842](https://github.com/sagemath/sagetrac-mirror/commit/d70c8420027e08f9bf3cd372a42632d8603735c5)** to **[0cb6788](https://github.com/sagemath/sagetrac-mirror/commit/0cb678864d998407a536a9cf04fab1b218aa0375)**",
    "created_at": "2019-12-31T09:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454147",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d70c842](https://github.com/sagemath/sagetrac-mirror/commit/d70c8420027e08f9bf3cd372a42632d8603735c5)** to **[0cb6788](https://github.com/sagemath/sagetrac-mirror/commit/0cb678864d998407a536a9cf04fab1b218aa0375)**



---

archive/issue_comments_454148.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nlooks good to me\n\nside note (no action needed) : pep8 does not require `**` to be framed with spaces, but does require that for `/` and `*`",
    "created_at": "2020-01-01T07:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454148",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'>Comment 22:</a>
looks good to me

side note (no action needed) : pep8 does not require `**` to be framed with spaces, but does require that for `/` and `*`



---

archive/issue_events_378854.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-01T07:46:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378854"
}
```



---

archive/issue_events_378855.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-01T07:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378855"
}
```



---

archive/issue_comments_454149.json:
```json
{
    "body": "Changed reviewer from **David Roe** to **David Roe, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2020-01-01T07:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454149",
    "user": "https://github.com/fchapoton"
}
```

Changed reviewer from **David Roe** to **David Roe, Frédéric Chapoton**



---

archive/issue_comments_454150.json:
```json
{
    "body": "Changed branch from **[u/roed/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/cythonize_hgm_v2)** to **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)**",
    "created_at": "2020-01-01T15:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454150",
    "user": "https://github.com/kedlaya"
}
```

Changed branch from **[u/roed/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/cythonize_hgm_v2)** to **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)**



---

archive/issue_comments_454151.json:
```json
{
    "body": "Changed commit from **[0cb6788](https://github.com/sagemath/sagetrac-mirror/commit/0cb678864d998407a536a9cf04fab1b218aa0375)** to **[c1aa950](https://github.com/sagemath/sagetrac-mirror/commit/c1aa950114146fb0de0648359ea8784d324467de)**",
    "created_at": "2020-01-01T15:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454151",
    "user": "https://github.com/kedlaya"
}
```

Changed commit from **[0cb6788](https://github.com/sagemath/sagetrac-mirror/commit/0cb678864d998407a536a9cf04fab1b218aa0375)** to **[c1aa950](https://github.com/sagemath/sagetrac-mirror/commit/c1aa950114146fb0de0648359ea8784d324467de)**



---

archive/issue_comments_454152.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nIf we're going to use an array of long longs, I think it makes more sense to use a Python array (which is almost as efficient) so that we can send it directly from one subroutine to the other without conversion to a Python list. \n\nBesides making that change, I also found an overflow bug that I had introduced in this branch and added a doctest for it.\n\nTimings for my three examples are now 2.0s, 3.4s, 2.9s. In particular we are now beating Magma in all of these cases (though they are far from exhaustive).\n\nI also enabled the use of the long-based code when cacheing, which wasn't happening before. Not that this makes any appreciable difference when cacheing, but I wanted my LMFDB test run to stress-test this modification.\n\nPatchbots seem satisfied with the earlier versions, but maybe it's worth waiting to see some runs from this latest commit.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a14aedb2934c07d38f9997ce4ddaa81ae4ce75fe\">a14aedb</a></td><td><code>Summary commit of Cythonization of HGMs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4090795c4312daadcc8a19e13ba8149d6371b340\">4090795</a></td><td><code>Fix pyflakes issues in hypergeometric_motive.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8f085e51829e1d8ab25b62d69a354848d32bfd9\">a8f085e</a></td><td><code>Remove non-ASCII character from docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0de275bd836d0f5962ce113c80dd93de221490f\">e0de275</a></td><td><code>Merge branch 'u/kedlaya/cythonize_hgm_v2' of git://trac.sagemath.org/sage into cythonize_hgm_v2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90c7d441b7026c01bab2b81f47ec7f7afe12b720\">90c7d44</a></td><td><code>Merge branch 'u/roed/cythonize_hgm_v2' of git://trac.sagemath.org/sage into cythonize_hgm_v2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62f9b7c0886fffaaf581005e1107068c2f159a60\">62f9b7c</a></td><td><code>Pass arrays of long longs back and forth when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbaa0f7684fcc9f4998d6034e88a45511c24ce73\">bbaa0f7</a></td><td><code>Fix overflow in Gauss sums; use longs when cacheing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1aa950114146fb0de0648359ea8784d324467de\">c1aa950</a></td><td><code>Pass table precision manually to hgm_coeffs</code></td></tr></table>\n",
    "created_at": "2020-01-01T15:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454152",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:25'>Comment 25:</a>
If we're going to use an array of long longs, I think it makes more sense to use a Python array (which is almost as efficient) so that we can send it directly from one subroutine to the other without conversion to a Python list. 

Besides making that change, I also found an overflow bug that I had introduced in this branch and added a doctest for it.

Timings for my three examples are now 2.0s, 3.4s, 2.9s. In particular we are now beating Magma in all of these cases (though they are far from exhaustive).

I also enabled the use of the long-based code when cacheing, which wasn't happening before. Not that this makes any appreciable difference when cacheing, but I wanted my LMFDB test run to stress-test this modification.

Patchbots seem satisfied with the earlier versions, but maybe it's worth waiting to see some runs from this latest commit.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a14aedb2934c07d38f9997ce4ddaa81ae4ce75fe">a14aedb</a></td><td><code>Summary commit of Cythonization of HGMs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4090795c4312daadcc8a19e13ba8149d6371b340">4090795</a></td><td><code>Fix pyflakes issues in hypergeometric_motive.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8f085e51829e1d8ab25b62d69a354848d32bfd9">a8f085e</a></td><td><code>Remove non-ASCII character from docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0de275bd836d0f5962ce113c80dd93de221490f">e0de275</a></td><td><code>Merge branch 'u/kedlaya/cythonize_hgm_v2' of git://trac.sagemath.org/sage into cythonize_hgm_v2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90c7d441b7026c01bab2b81f47ec7f7afe12b720">90c7d44</a></td><td><code>Merge branch 'u/roed/cythonize_hgm_v2' of git://trac.sagemath.org/sage into cythonize_hgm_v2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62f9b7c0886fffaaf581005e1107068c2f159a60">62f9b7c</a></td><td><code>Pass arrays of long longs back and forth when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbaa0f7684fcc9f4998d6034e88a45511c24ce73">bbaa0f7</a></td><td><code>Fix overflow in Gauss sums; use longs when cacheing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1aa950114146fb0de0648359ea8784d324467de">c1aa950</a></td><td><code>Pass table precision manually to hgm_coeffs</code></td></tr></table>




---

archive/issue_events_378856.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-01T17:07:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378856"
}
```



---

archive/issue_events_378857.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-01T17:07:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378857"
}
```



---

archive/issue_comments_454153.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de82d2e0390faaf250fc06723e33c60a8ab2a444\">de82d2e</a></td><td><code>Fix doctest in hypergeometric_misc</code></td></tr></table>\n",
    "created_at": "2020-01-01T18:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454153",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>Comment 27:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de82d2e0390faaf250fc06723e33c60a8ab2a444">de82d2e</a></td><td><code>Fix doctest in hypergeometric_misc</code></td></tr></table>




---

archive/issue_comments_454154.json:
```json
{
    "body": "Changed commit from **[c1aa950](https://github.com/sagemath/sagetrac-mirror/commit/c1aa950114146fb0de0648359ea8784d324467de)** to **[de82d2e](https://github.com/sagemath/sagetrac-mirror/commit/de82d2e0390faaf250fc06723e33c60a8ab2a444)**",
    "created_at": "2020-01-01T18:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454154",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c1aa950](https://github.com/sagemath/sagetrac-mirror/commit/c1aa950114146fb0de0648359ea8784d324467de)** to **[de82d2e](https://github.com/sagemath/sagetrac-mirror/commit/de82d2e0390faaf250fc06723e33c60a8ab2a444)**



---

archive/issue_comments_454155.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nFixed a doctest failure caught by patchbot.",
    "created_at": "2020-01-01T18:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454155",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:28'>Comment 28:</a>
Fixed a doctest failure caught by patchbot.



---

archive/issue_comments_454156.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\ngreen bot, I am setting back to positive",
    "created_at": "2020-01-01T21:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454156",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'>Comment 29:</a>
green bot, I am setting back to positive



---

archive/issue_events_378858.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-01T21:06:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378858"
}
```



---

archive/issue_events_378859.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-01T21:06:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378859"
}
```



---

archive/issue_events_378860.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-04T11:18:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378860"
}
```



---

archive/issue_events_378861.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-04T11:18:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378861"
}
```



---

archive/issue_comments_454157.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nI'm getting this on the python2 buildbot\n\n```\n**********************************************************************\nFile \"src/sage/modular/hypergeometric_misc.pyx\", line 19, in sage.modular.hypergeometric_misc.?\nFailed example:\n    H.euler_factor(2, 7, cache_p=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.hypergeometric_misc.?[4]>\", line 1, in <module>\n        H.euler_factor(Integer(2), Integer(7), cache_p=True)\n      File \"sage/misc/cachefunc.pyx\", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)\n        w = self._instance_call(*args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)\n        return self.f(self._instance, *args, **kwds)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/modular/hypergeometric_motive.py\", line 1498, in euler_factor\n        for i in range(bound)]\n      File \"sage/misc/cachefunc.pyx\", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)\n        w = self._instance_call(*args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)\n        return self.f(self._instance, *args, **kwds)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/modular/hypergeometric_motive.py\", line 1234, in padic_H_value\n        trcoeffs = hgm_coeffs(p, f, prec, gamma, m, D, gtab, use_longs)\n      File \"sage/modular/hypergeometric_misc.pyx\", line 6, in sage.modular.hypergeometric_misc.hgm_coeffs (build/cythonized/sage/modular/hypergeometric_misc.c:2809)\n        cpdef hgm_coeffs(long long p, int f, int prec, gamma, array.array m, int D,\n      File \"sage/modular/hypergeometric_misc.pyx\", line 37, in sage.modular.hypergeometric_misc.hgm_coeffs (build/cythonized/sage/modular/hypergeometric_misc.c:1674)\n        cdef array.array digit_count = array.array('Q', [0]) * q1\n    ValueError: bad typecode (must be c, b, B, u, h, H, i, I, l, L, f or d)\n```",
    "created_at": "2020-01-04T11:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454157",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'>Comment 30:</a>
I'm getting this on the python2 buildbot

```
**********************************************************************
File "src/sage/modular/hypergeometric_misc.pyx", line 19, in sage.modular.hypergeometric_misc.?
Failed example:
    H.euler_factor(2, 7, cache_p=True)
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.hypergeometric_misc.?[4]>", line 1, in <module>
        H.euler_factor(Integer(2), Integer(7), cache_p=True)
      File "sage/misc/cachefunc.pyx", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)
        w = self._instance_call(*args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)
        return self.f(self._instance, *args, **kwds)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/modular/hypergeometric_motive.py", line 1498, in euler_factor
        for i in range(bound)]
      File "sage/misc/cachefunc.pyx", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)
        w = self._instance_call(*args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)
        return self.f(self._instance, *args, **kwds)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/modular/hypergeometric_motive.py", line 1234, in padic_H_value
        trcoeffs = hgm_coeffs(p, f, prec, gamma, m, D, gtab, use_longs)
      File "sage/modular/hypergeometric_misc.pyx", line 6, in sage.modular.hypergeometric_misc.hgm_coeffs (build/cythonized/sage/modular/hypergeometric_misc.c:2809)
        cpdef hgm_coeffs(long long p, int f, int prec, gamma, array.array m, int D,
      File "sage/modular/hypergeometric_misc.pyx", line 37, in sage.modular.hypergeometric_misc.hgm_coeffs (build/cythonized/sage/modular/hypergeometric_misc.c:1674)
        cdef array.array digit_count = array.array('Q', [0]) * q1
    ValueError: bad typecode (must be c, b, B, u, h, H, i, I, l, L, f or d)
```



---

archive/issue_comments_454158.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89\">a7bfd25</a></td><td><code>Use Py2-compatible arrays</code></td></tr></table>\n",
    "created_at": "2020-01-04T17:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454158",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:31'>Comment 31:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89">a7bfd25</a></td><td><code>Use Py2-compatible arrays</code></td></tr></table>




---

archive/issue_comments_454159.json:
```json
{
    "body": "Changed commit from **[de82d2e](https://github.com/sagemath/sagetrac-mirror/commit/de82d2e0390faaf250fc06723e33c60a8ab2a444)** to **[a7bfd25](https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89)**",
    "created_at": "2020-01-04T17:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454159",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[de82d2e](https://github.com/sagemath/sagetrac-mirror/commit/de82d2e0390faaf250fc06723e33c60a8ab2a444)** to **[a7bfd25](https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89)**



---

archive/issue_comments_454160.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nOh hmm, an array of long longs is only a Py3 thing. But I really need to be sure that I have 64-bit integers to avoid overflows in the Cython code.\n\nThe easiest thing to do is first, limit input so that `p**f < 2**32` (which is close to the practical computational limit of what we can do anyway), change the arrays to longs (which might only be 32-bit), but make sure that their entries are cast to long longs before doing arithmetic with them. Implemented in this commit; let's wait and see what the patchbots say.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89\">a7bfd25</a></td><td><code>Use Py2-compatible arrays</code></td></tr></table>\n",
    "created_at": "2020-01-04T17:23:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454160",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:32'>Comment 32:</a>
Oh hmm, an array of long longs is only a Py3 thing. But I really need to be sure that I have 64-bit integers to avoid overflows in the Cython code.

The easiest thing to do is first, limit input so that `p**f < 2**32` (which is close to the practical computational limit of what we can do anyway), change the arrays to longs (which might only be 32-bit), but make sure that their entries are cast to long longs before doing arithmetic with them. Implemented in this commit; let's wait and see what the patchbots say.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89">a7bfd25</a></td><td><code>Use Py2-compatible arrays</code></td></tr></table>




---

archive/issue_comments_454161.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nPatchbot seem satisfied. Now let's see whether the Py2 buildbot is too.",
    "created_at": "2020-01-05T20:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454161",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:33'>Comment 33:</a>
Patchbot seem satisfied. Now let's see whether the Py2 buildbot is too.



---

archive/issue_events_378862.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-06T07:17:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378862"
}
```



---

archive/issue_events_378863.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-01-06T07:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378863"
}
```



---

archive/issue_comments_454162.json:
```json
{
    "body": "Changed branch from **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)** to **[a7bfd25](https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89)**",
    "created_at": "2020-01-11T17:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28902#issuecomment-454162",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/kedlaya/cythonize_hgm_v2](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/cythonize_hgm_v2)** to **[a7bfd25](https://github.com/sagemath/sagetrac-mirror/commit/a7bfd25cbbbc799536da393188fe7094fe6d5d89)**



---

archive/issue_events_378864.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-11T17:45:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378864"
}
```



---

archive/issue_events_378865.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0e4041927e7f9053a6d3760d9a5088baf1f72ea5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-11T17:45:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28902",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28902#event-378865"
}
```
