# Issue 28321: py3: rationals can not be initialized from a pair of big Python ints

archive/issues_028084.json:
```json
{
    "body": "\n```\nsage: QQ((2r**100,3r**100))\n---------------------------------------------------------------------------\nOverflowError                             Traceback (most recent call last)\n<ipython-input-2-091103d07f87> in <module>()\n----> 1 QQ((2**Integer(100),3**Integer(100)))\n\n/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9197)()\n    898         if mor is not None:\n    899             if no_extra_args:\n--> 900                 return mor._call_(x)\n    901             else:\n    902                 return mor._call_with_args(x, args, kwds)\n\n/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4556)()\n    160                 print(type(C), C)\n    161                 print(type(C._element_constructor), C._element_constructor)\n--> 162             raise\n    163 \n    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4448)()\n    155         cdef Parent C = self._codomain\n    156         try:\n--> 157             return C._element_constructor(x)\n    158         except Exception:\n    159             if print_warnings:\n\n/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Rational.__init__ (build/cythonized/sage/rings/rational.c:6386)()\n    520         \"\"\"\n    521         if x is not None:\n--> 522             self.__set_value(x, base)\n    523 \n    524     def __reduce__(self):\n\n/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Rational.__set_value (build/cythonized/sage/rings/rational.c:7608)()\n    615             if isinstance(num, int) and isinstance(denom, int):\n    616                 if denom >= 0:\n--> 617                     mpq_set_si(self.value, num, denom)\n    618                 else:\n    619                     mpq_set_si(self.value, -num, -denom)\n\nOverflowError: Python int too large to convert to C long\n```\n\nBranch/Commit: ef9ae6904a4620e36c75866f94cc337d5e524ef2\n\nReviewer: Jeroen Demeyer, Vincent Delecroix\n\nAuthor: Vincent Delecroix, Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28321\n\n",
    "closed_at": "2019-08-21T22:27:42Z",
    "created_at": "2019-08-04T09:39:18Z",
    "labels": [
        "component: python3",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "py3: rationals can not be initialized from a pair of big Python ints",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28321",
    "user": "https://github.com/videlec"
}
```

```
sage: QQ((2r**100,3r**100))
---------------------------------------------------------------------------
OverflowError                             Traceback (most recent call last)
<ipython-input-2-091103d07f87> in <module>()
----> 1 QQ((2**Integer(100),3**Integer(100)))

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9197)()
    898         if mor is not None:
    899             if no_extra_args:
--> 900                 return mor._call_(x)
    901             else:
    902                 return mor._call_with_args(x, args, kwds)

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4556)()
    160                 print(type(C), C)
    161                 print(type(C._element_constructor), C._element_constructor)
--> 162             raise
    163 
    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4448)()
    155         cdef Parent C = self._codomain
    156         try:
--> 157             return C._element_constructor(x)
    158         except Exception:
    159             if print_warnings:

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Rational.__init__ (build/cythonized/sage/rings/rational.c:6386)()
    520         """
    521         if x is not None:
--> 522             self.__set_value(x, base)
    523 
    524     def __reduce__(self):

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Rational.__set_value (build/cythonized/sage/rings/rational.c:7608)()
    615             if isinstance(num, int) and isinstance(denom, int):
    616                 if denom >= 0:
--> 617                     mpq_set_si(self.value, num, denom)
    618                 else:
    619                     mpq_set_si(self.value, -num, -denom)

OverflowError: Python int too large to convert to C long
```

Branch/Commit: ef9ae6904a4620e36c75866f94cc337d5e524ef2

Reviewer: Jeroen Demeyer, Vincent Delecroix

Author: Vincent Delecroix, Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28321





---

archive/issue_comments_550709.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-04T09:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550709",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_550710.json:
```json
{
    "body": "Changing commit from \"\" to \"50cce861e438f965a283dfbf6b83d3aa06732559\"",
    "created_at": "2019-08-04T09:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550710",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "50cce861e438f965a283dfbf6b83d3aa06732559"



---

archive/issue_comments_550711.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/28321\"",
    "created_at": "2019-08-04T09:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550711",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/28321"



---

archive/issue_comments_550712.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[50cce86](https://github.com/sagemath/sagetrac-mirror/commit/50cce861e438f965a283dfbf6b83d3aa06732559)|`fix rational constructor`|",
    "created_at": "2019-08-04T09:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550712",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[50cce86](https://github.com/sagemath/sagetrac-mirror/commit/50cce861e438f965a283dfbf6b83d3aa06732559)|`fix rational constructor`|



---

archive/issue_comments_550713.json:
```json
{
    "body": "Changing commit from \"50cce861e438f965a283dfbf6b83d3aa06732559\" to \"ab164da54b408b68f67e194b1403010d56e1fce1\"",
    "created_at": "2019-08-04T13:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "50cce861e438f965a283dfbf6b83d3aa06732559" to "ab164da54b408b68f67e194b1403010d56e1fce1"



---

archive/issue_comments_550714.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[ab164da](https://github.com/sagemath/sagetrac-mirror/commit/ab164da54b408b68f67e194b1403010d56e1fce1)|`fix rational constructor`|",
    "created_at": "2019-08-04T13:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[ab164da](https://github.com/sagemath/sagetrac-mirror/commit/ab164da54b408b68f67e194b1403010d56e1fce1)|`fix rational constructor`|



---

archive/issue_comments_550715.json:
```json
{
    "body": "<a id='comment:3'></a>\nClarifying that this is a Python 3 issue.",
    "created_at": "2019-08-04T20:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550715",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Clarifying that this is a Python 3 issue.



---

archive/issue_events_080034.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "rename": {
        "from": "rationals can not be initialized from a pair of big Python ints",
        "to": "py3: rationals can not be initialized from a pair of big Python ints"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28321#event-80034"
}
```



---

archive/issue_comments_550716.json:
```json
{
    "body": "<a id='comment:4'></a>\nPositive review if this passes tests also on Python 2.",
    "created_at": "2019-08-04T20:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550716",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Positive review if this passes tests also on Python 2.



---

archive/issue_comments_550717.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2019-08-04T20:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550717",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_550718.json:
```json
{
    "body": "<a id='comment:6'></a>\n`mpz_set_pylong` with Python2 seems unhappy when providing `int`... do you have an idea on how to sort this out?\n\nI just ran into this problem again with #28370.",
    "created_at": "2019-08-20T08:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550718",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
`mpz_set_pylong` with Python2 seems unhappy when providing `int`... do you have an idea on how to sort this out?

I just ran into this problem again with #28370.



---

archive/issue_comments_550719.json:
```json
{
    "body": "Changing author from \"Vincent Delecroix\" to \"Vincent Delecroix, Jeroen Demeyer\"",
    "created_at": "2019-08-20T09:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550719",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Vincent Delecroix" to "Vincent Delecroix, Jeroen Demeyer"



---

archive/issue_comments_550720.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/28321\" to \"u/jdemeyer/28321\"",
    "created_at": "2019-08-20T09:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550720",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/vdelecroix/28321" to "u/jdemeyer/28321"



---

archive/issue_comments_550721.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe correct solution is to have separate cases for `long` and `int`, keeping in mind that the `long` type on Python 3 is actually called `int`.\n\n---\nNew commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[d9e8bc5](https://github.com/sagemath/sagetrac-mirror/commit/d9e8bc5d8c5ae00e806a79ae1783cd364bc23d2f)|`fix rational constructor`|\n|[ef9ae69](https://github.com/sagemath/sagetrac-mirror/commit/ef9ae6904a4620e36c75866f94cc337d5e524ef2)|`Fix conversion from Python 2 ints to QQ`|",
    "created_at": "2019-08-20T09:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
The correct solution is to have separate cases for `long` and `int`, keeping in mind that the `long` type on Python 3 is actually called `int`.

---
New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[d9e8bc5](https://github.com/sagemath/sagetrac-mirror/commit/d9e8bc5d8c5ae00e806a79ae1783cd364bc23d2f)|`fix rational constructor`|
|[ef9ae69](https://github.com/sagemath/sagetrac-mirror/commit/ef9ae6904a4620e36c75866f94cc337d5e524ef2)|`Fix conversion from Python 2 ints to QQ`|



---

archive/issue_comments_550722.json:
```json
{
    "body": "Changing commit from \"ab164da54b408b68f67e194b1403010d56e1fce1\" to \"ef9ae6904a4620e36c75866f94cc337d5e524ef2\"",
    "created_at": "2019-08-20T09:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550722",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "ab164da54b408b68f67e194b1403010d56e1fce1" to "ef9ae6904a4620e36c75866f94cc337d5e524ef2"



---

archive/issue_comments_550723.json:
```json
{
    "body": "<a id='comment:10'></a>\nI see. Thanks!",
    "created_at": "2019-08-20T09:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550723",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
I see. Thanks!



---

archive/issue_comments_550724.json:
```json
{
    "body": "<a id='comment:11'></a>\nTests pass with your version!",
    "created_at": "2019-08-20T11:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550724",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Tests pass with your version!



---

archive/issue_comments_550725.json:
```json
{
    "body": "Changing reviewer from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Vincent Delecroix\"",
    "created_at": "2019-08-20T11:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550725",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "Jeroen Demeyer" to "Jeroen Demeyer, Vincent Delecroix"



---

archive/issue_comments_550726.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-20T11:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550726",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_550727.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/28321\" to \"ef9ae6904a4620e36c75866f94cc337d5e524ef2\"",
    "created_at": "2019-08-21T22:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550727",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/28321" to "ef9ae6904a4620e36c75866f94cc337d5e524ef2"



---

archive/issue_comments_550728.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-21T22:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28321#issuecomment-550728",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080035.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-21T22:27:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28321",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28321#event-80035"
}
```
