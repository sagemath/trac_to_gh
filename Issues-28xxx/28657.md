# Issue 28657: Build Sage without "python"

archive/issues_028420.json:
```json
{
    "assignees": [],
    "body": "Some new linux releases don't seem to include a `python` executable. They have `python3` but no `python` or `python2`. Sage should build on such systems.\n\n\nCC:  @isuruf @kiwifb @timokau @antonio-rojas\n\nBranch: **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)**\n\nReviewer: **Volker Braun**\n\nAuthor: **John Palmieri**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28657_\n\n",
    "closed_at": "2019-11-08T20:31:40Z",
    "created_at": "2019-10-25T21:08:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Build Sage without \"python\"",
    "type": "issue",
    "updated_at": "2019-11-18T19:48:27Z",
    "url": "https://github.com/sagemath/sage/issues/28657",
    "user": "https://github.com/jhpalmieri"
}
```
Some new linux releases don't seem to include a `python` executable. They have `python3` but no `python` or `python2`. Sage should build on such systems.


CC:  @isuruf @kiwifb @timokau @antonio-rojas

Branch: **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)**

Reviewer: **Volker Braun**

Author: **John Palmieri**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/28657_





---

archive/issue_events_390672.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-25T21:08:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390672"
}
```



---

archive/issue_events_390673.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-25T21:08:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390673"
}
```



---

archive/issue_events_390674.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-25T21:08:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390674"
}
```



---

archive/issue_events_390675.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-25T21:08:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390675"
}
```



---

archive/issue_comments_446949.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/no-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-python)**",
    "created_at": "2019-10-25T21:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446949",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/no-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-python)**



---

archive/issue_comments_446950.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHere is an attempt. It probably needs work, but please test it.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d00060bd4f4b5a85df580ed4c08ebc11f282898\"><code>2d00060</code></a></td><td><code>trac 28657: build Sage when there is no 'python' present.</code></td></tr></table>\n",
    "created_at": "2019-10-25T21:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446950",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

Here is an attempt. It probably needs work, but please test it.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d00060bd4f4b5a85df580ed4c08ebc11f282898"><code>2d00060</code></a></td><td><code>trac 28657: build Sage when there is no 'python' present.</code></td></tr></table>




---

archive/issue_comments_446951.json:
```json
{
    "body": "Commit: **[`2d00060`](https://github.com/sagemath/sagetrac-mirror/commit/2d00060bd4f4b5a85df580ed4c08ebc11f282898)**",
    "created_at": "2019-10-25T21:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446951",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`2d00060`](https://github.com/sagemath/sagetrac-mirror/commit/2d00060bd4f4b5a85df580ed4c08ebc11f282898)**



---

archive/issue_events_390676.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-25T21:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390676"
}
```



---

archive/issue_comments_446952.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSee https://wiki.ubuntu.com/BionicBeaver/ReleaseNotes, for example: \"Python 2 is no longer installed by default.\"",
    "created_at": "2019-10-25T21:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446952",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

See https://wiki.ubuntu.com/BionicBeaver/ReleaseNotes, for example: "Python 2 is no longer installed by default."



---

archive/issue_events_390677.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-26T23:51:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390677"
}
```



---

archive/issue_events_390678.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-26T23:51:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390678"
}
```



---

archive/issue_comments_446953.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAre you sure there really are Linuxes without `python` (but with `python3`) ? E.g. in Gentoo `python` equals `python3` since few years...",
    "created_at": "2019-10-28T17:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446953",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Are you sure there really are Linuxes without `python` (but with `python3`) ? E.g. in Gentoo `python` equals `python3` since few years...



---

archive/issue_comments_446954.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI just installed an Ubuntu 19.10 virtual machine. I opened a terminal, typed \"pyt\" and hit the TAB key: it completed to \"python3\". There is no command \"python\".",
    "created_at": "2019-10-28T18:38:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446954",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

I just installed an Ubuntu 19.10 virtual machine. I opened a terminal, typed "pyt" and hit the TAB key: it completed to "python3". There is no command "python".



---

archive/issue_comments_446955.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\ndoes \n\n```\napt install python \n```\nprovide Python(3) ?",
    "created_at": "2019-10-28T19:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446955",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

does 

```
apt install python 
```
provide Python(3) ?



---

archive/issue_comments_446956.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIt provides `python2`. (Edit: and `python`, symlinked to `python2`.)",
    "created_at": "2019-10-28T20:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446956",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

It provides `python2`. (Edit: and `python`, symlinked to `python2`.)



---

archive/issue_comments_446957.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nhmm, but that's insane that all the scripts needing just python need to be changed, no? \n\nI would just install a symbolic link to python3 somewhere...",
    "created_at": "2019-10-28T20:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446957",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

hmm, but that's insane that all the scripts needing just python need to be changed, no? 

I would just install a symbolic link to python3 somewhere...



---

archive/issue_comments_446958.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI am not an Ubuntu expert, but I think that they were worried that old Python scripts might not be compatible with Python 3, so better not to make a symbolic link: just let people install Python 2 if they need it.",
    "created_at": "2019-10-28T21:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446958",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

I am not an Ubuntu expert, but I think that they were worried that old Python scripts might not be compatible with Python 3, so better not to make a symbolic link: just let people install Python 2 if they need it.



---

archive/issue_comments_446959.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWhy not just create a link to python3 at `build/bin/python` ?\n\nThis patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.",
    "created_at": "2019-10-30T08:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446959",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Why not just create a link to python3 at `build/bin/python` ?

This patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.



---

archive/issue_comments_446960.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8905fe639777a452c9cfa4d53b14267a07b1f7bb\"><code>8905fe6</code></a></td><td><code>trac 28657: build Sage when there is no 'python' present.</code></td></tr></table>\n",
    "created_at": "2019-10-30T17:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446960",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8905fe639777a452c9cfa4d53b14267a07b1f7bb"><code>8905fe6</code></a></td><td><code>trac 28657: build Sage when there is no 'python' present.</code></td></tr></table>




---

archive/issue_comments_446961.json:
```json
{
    "body": "Changed commit from **[`2d00060`](https://github.com/sagemath/sagetrac-mirror/commit/2d00060bd4f4b5a85df580ed4c08ebc11f282898)** to **[`8905fe6`](https://github.com/sagemath/sagetrac-mirror/commit/8905fe639777a452c9cfa4d53b14267a07b1f7bb)**",
    "created_at": "2019-10-30T17:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446961",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2d00060`](https://github.com/sagemath/sagetrac-mirror/commit/2d00060bd4f4b5a85df580ed4c08ebc11f282898)** to **[`8905fe6`](https://github.com/sagemath/sagetrac-mirror/commit/8905fe639777a452c9cfa4d53b14267a07b1f7bb)**



---

archive/issue_comments_446962.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nRemoved changes to `ipython/spkg-install` which would have conflicted with #28673.\n\nReplying to [@dimpase](#comment:12):\n> Why not just create a link to python3 at `build/bin/python` ?\n\nThat's basically what `sage-system-python` is already.\n \n> This patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.\n\nWhen installing a package, should we be using Sage's Python or the system Python? There are three established choices: during Sage's build use `sage-system-python` or `sage-python23` (which means the Python that Sage builds: it uses either `python2` or `python3` from `$SAGE_LOCAL/bin/`). During runtime, There is also the script `sage-python`, which just runs `python2` or `python3`. We should probably use that one more and `sage-python23` less.",
    "created_at": "2019-10-30T17:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446962",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

Removed changes to `ipython/spkg-install` which would have conflicted with #28673.

Replying to [@dimpase](#comment:12):
> Why not just create a link to python3 at `build/bin/python` ?

That's basically what `sage-system-python` is already.
 
> This patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.

When installing a package, should we be using Sage's Python or the system Python? There are three established choices: during Sage's build use `sage-system-python` or `sage-python23` (which means the Python that Sage builds: it uses either `python2` or `python3` from `$SAGE_LOCAL/bin/`). During runtime, There is also the script `sage-python`, which just runs `python2` or `python3`. We should probably use that one more and `sage-python23` less.



---

archive/issue_comments_446963.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI'm testing a branch which uses `sage-python` more and `sage-python23` less. If it works, I'll push it.",
    "created_at": "2019-10-30T17:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446963",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

I'm testing a branch which uses `sage-python` more and `sage-python23` less. If it works, I'll push it.



---

archive/issue_comments_446964.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4835fc864600883bb7a710f4196495d9a07aab8\"><code>d4835fc</code></a></td><td><code>trac 28657: build Sage when there is no 'python' present.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f04cb2891c6990fe0888f72546518b2e57bba369\"><code>f04cb28</code></a></td><td><code>trac 28657: use sage-python instead of sage-python23 when possible.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85\"><code>7a27daa</code></a></td><td><code>trac 28657: use sage-python or sage-system-python instead of sage-python23</code></td></tr></table>\n",
    "created_at": "2019-10-30T18:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446964",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4835fc864600883bb7a710f4196495d9a07aab8"><code>d4835fc</code></a></td><td><code>trac 28657: build Sage when there is no 'python' present.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f04cb2891c6990fe0888f72546518b2e57bba369"><code>f04cb28</code></a></td><td><code>trac 28657: use sage-python instead of sage-python23 when possible.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85"><code>7a27daa</code></a></td><td><code>trac 28657: use sage-python or sage-system-python instead of sage-python23</code></td></tr></table>




---

archive/issue_comments_446965.json:
```json
{
    "body": "Changed commit from **[`8905fe6`](https://github.com/sagemath/sagetrac-mirror/commit/8905fe639777a452c9cfa4d53b14267a07b1f7bb)** to **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)**",
    "created_at": "2019-10-30T18:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446965",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8905fe6`](https://github.com/sagemath/sagetrac-mirror/commit/8905fe639777a452c9cfa4d53b14267a07b1f7bb)** to **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)**



---

archive/issue_comments_446966.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nCC'ing some of the packaging people to see what they think.",
    "created_at": "2019-10-30T18:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446966",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

CC'ing some of the packaging people to see what they think.



---

archive/issue_comments_446967.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\nNow, think of a situation where Sage's Python and system Python are the same thing.\nIt is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.\nAnd long-term it is probably the only viable option for Sage.\n\nSo, the fewer different Pythons we have around, the better...",
    "created_at": "2019-10-30T18:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446967",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

Now, think of a situation where Sage's Python and system Python are the same thing.
It is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.
And long-term it is probably the only viable option for Sage.

So, the fewer different Pythons we have around, the better...



---

archive/issue_comments_446968.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@dimpase](#comment:18):\n> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\nI agree, and that's why my changes in `build/pkgs` are almost exclusively to use `sage-system-python`. The one exception is `entrypoints`, which installs a Python module. \n\n> Now, think of a situation where Sage's Python and system Python are the same thing.\n> It is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.\n> And long-term it is probably the only viable option for Sage.\n> \n> So, the fewer different Pythons we have around, the better...\n\nRight now we are using four different ones: `python`, `sage-system-python`, `sage-python23`, and `sage-python`. The main point here is to eliminate the use of `python`. I also wonder if we should avoid `sage-python23`, since it explicitly calls `SAGE_LOCAL/bin/python[2 or 3]`, and instead use `sage-python`, which runs `exec python2` or `exec python3`, letting the PATH determine where to find the program. I've done a little in that direction (changing `sage-python23` to `sage-python`), but more could be done. It doesn't need to be done on this ticket.",
    "created_at": "2019-10-30T18:53:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446968",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@dimpase](#comment:18):
> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

I agree, and that's why my changes in `build/pkgs` are almost exclusively to use `sage-system-python`. The one exception is `entrypoints`, which installs a Python module. 

> Now, think of a situation where Sage's Python and system Python are the same thing.
> It is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.
> And long-term it is probably the only viable option for Sage.
> 
> So, the fewer different Pythons we have around, the better...

Right now we are using four different ones: `python`, `sage-system-python`, `sage-python23`, and `sage-python`. The main point here is to eliminate the use of `python`. I also wonder if we should avoid `sage-python23`, since it explicitly calls `SAGE_LOCAL/bin/python[2 or 3]`, and instead use `sage-python`, which runs `exec python2` or `exec python3`, letting the PATH determine where to find the program. I've done a little in that direction (changing `sage-python23` to `sage-python`), but more could be done. It doesn't need to be done on this ticket.



---

archive/issue_comments_446969.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@dimpase](#comment:10):\n> hmm, but that's insane that all the scripts needing just python need to be changed, no? \n> \n> I would just install a symbolic link to python3 somewhere...\n\nThis was because `python` -> `python3` link was explicitly recommended against in PEP-0394. In April 2018, this was changed to make it okay for virtual envs and in June 2019, it was okay for the distributor to decide.",
    "created_at": "2019-10-30T18:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446969",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@dimpase](#comment:10):
> hmm, but that's insane that all the scripts needing just python need to be changed, no? 
> 
> I would just install a symbolic link to python3 somewhere...

This was because `python` -> `python3` link was explicitly recommended against in PEP-0394. In April 2018, this was changed to make it okay for virtual envs and in June 2019, it was okay for the distributor to decide.



---

archive/issue_comments_446970.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@dimpase](#comment:18):\n> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\nRight, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.",
    "created_at": "2019-10-30T19:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446970",
    "user": "https://github.com/timokau"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@dimpase](#comment:18):
> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.



---

archive/issue_comments_446971.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@timokau](#comment:21):\n> Replying to [@dimpase](#comment:18):\n> > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\n> \n> Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.\n\nHow are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?",
    "created_at": "2019-10-30T19:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446971",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@timokau](#comment:21):
> Replying to [@dimpase](#comment:18):
> > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

> 
> Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.

How are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?



---

archive/issue_comments_446972.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jhpalmieri](#comment:22):\n> Replying to [@timokau](#comment:21):\n> > Replying to [@dimpase](#comment:18):\n> > > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\n> > \n> > Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.\n\n> \n> How are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?\n\nThe distro *is* the \"system\", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.",
    "created_at": "2019-10-30T21:43:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446972",
    "user": "https://github.com/timokau"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jhpalmieri](#comment:22):
> Replying to [@timokau](#comment:21):
> > Replying to [@dimpase](#comment:18):
> > > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

> > 
> > Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.

> 
> How are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?

The distro *is* the "system", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.



---

archive/issue_comments_446973.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@timokau](#comment:23):\n> The distro *is* the \"system\", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.\n\nThen you can interpret this ticket as being an effort to allow the use of either `python` or `python3` as dependencies, rather than insisting on `python`. Or just change the dependency to `python3`.",
    "created_at": "2019-10-30T21:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446973",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@timokau](#comment:23):
> The distro *is* the "system", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.

Then you can interpret this ticket as being an effort to allow the use of either `python` or `python3` as dependencies, rather than insisting on `python`. Or just change the dependency to `python3`.



---

archive/issue_comments_446974.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAre we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.",
    "created_at": "2019-11-07T23:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446974",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.



---

archive/issue_comments_446975.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2019-11-07T23:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446975",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_390679.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-07T23:40:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390679"
}
```



---

archive/issue_events_390680.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-07T23:40:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390680"
}
```



---

archive/issue_comments_446976.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@vbraun](#comment:25):\n> Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.\n\nWell, I was trying to solve all problems for all time, but I'll take what I can get.",
    "created_at": "2019-11-07T23:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446976",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@vbraun](#comment:25):
> Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.

Well, I was trying to solve all problems for all time, but I'll take what I can get.



---

archive/issue_comments_446977.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nShould have looked at this more closely earlier. This is 0 improvement for sage-on-distro that don't want to install `sage-system-python` or `sage-python` or `sage-python23`. Possibly it requires more patching. I only see this as a transition period hopefully.",
    "created_at": "2019-11-07T23:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446977",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:28" align="right">comment:28</div>

Should have looked at this more closely earlier. This is 0 improvement for sage-on-distro that don't want to install `sage-system-python` or `sage-python` or `sage-python23`. Possibly it requires more patching. I only see this as a transition period hopefully.



---

archive/issue_comments_446978.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nIt doesn't make anything worse for distros, I hope, and it should allow you to set the dependency to `python3` instead of `python`, for systems where those are different.",
    "created_at": "2019-11-07T23:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446978",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

It doesn't make anything worse for distros, I hope, and it should allow you to set the dependency to `python3` instead of `python`, for systems where those are different.



---

archive/issue_comments_446979.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI don't know about other distros but Gentoo has its own mechanism to switch between python versions. Without having to worry about `python` being `python2` or `python3`, this is switched at a more fundamental level and there are ways to maintain \"exceptions\". So stuff like replacing `python` by `sage-python` in `src/sage/doctest/control.py` is actually harmful. I install sage for python2.7, python3.6 and python3.7 simultaneously and I don't need to patch anything for it know which `python` it is currently running.",
    "created_at": "2019-11-08T00:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446979",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

I don't know about other distros but Gentoo has its own mechanism to switch between python versions. Without having to worry about `python` being `python2` or `python3`, this is switched at a more fundamental level and there are ways to maintain "exceptions". So stuff like replacing `python` by `sage-python` in `src/sage/doctest/control.py` is actually harmful. I install sage for python2.7, python3.6 and python3.7 simultaneously and I don't need to patch anything for it know which `python` it is currently running.



---

archive/issue_comments_446980.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nWhat do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`?",
    "created_at": "2019-11-08T00:07:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446980",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:31" align="right">comment:31</div>

What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`?



---

archive/issue_comments_446981.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jhpalmieri](#comment:31):\n> What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`? \n\nhttps://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/sage-9999.ebuild#L178\n\nand thanks to your work I have now noticed there is one file in `src/ext` with the stuff.\n\nThe link above is only part of the solution anyway. Gentoo has an install helper called `python_doscript` that will wrap python scripts so multiple python versions are not a problem. So yes, I'll admit it, I don't have to have a sage-python thingy because I already have a better solution and you don't have one.",
    "created_at": "2019-11-08T00:13:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446981",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jhpalmieri](#comment:31):
> What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`? 

https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/sage-9999.ebuild#L178

and thanks to your work I have now noticed there is one file in `src/ext` with the stuff.

The link above is only part of the solution anyway. Gentoo has an install helper called `python_doscript` that will wrap python scripts so multiple python versions are not a problem. So yes, I'll admit it, I don't have to have a sage-python thingy because I already have a better solution and you don't have one.



---

archive/issue_comments_446982.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nIf you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.",
    "created_at": "2019-11-08T00:31:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446982",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.



---

archive/issue_comments_446983.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nTo be honest I think we should wait for the dust about python2/3 to clear out. Once python2 is out of support the incentive to keep it will be reduced drastically.",
    "created_at": "2019-11-08T00:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446983",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34" align="right">comment:34</div>

To be honest I think we should wait for the dust about python2/3 to clear out. Once python2 is out of support the incentive to keep it will be reduced drastically.



---

archive/issue_comments_446984.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jhpalmieri](#comment:33):\n> If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.\n\nActually in the end I may have some :)\n* line 643: use `sys.executable` so it is always the python you are currently using.\n* line 1034 and associated doctests. Again `sys.executable` could be used and `...` be put in doctest since we don't know what that particular result is. But there is a first simplification `sage-runtests` is executable and already starts with `#!/usr/bin/env sage-python` in your case why do you need to override the `#!` here? In fact why do you even need the full path? It is already in your `$PATH` at this stage.",
    "created_at": "2019-11-08T04:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446984",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jhpalmieri](#comment:33):
> If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.

Actually in the end I may have some :)
* line 643: use `sys.executable` so it is always the python you are currently using.
* line 1034 and associated doctests. Again `sys.executable` could be used and `...` be put in doctest since we don't know what that particular result is. But there is a first simplification `sage-runtests` is executable and already starts with `#!/usr/bin/env sage-python` in your case why do you need to override the `#!` here? In fact why do you even need the full path? It is already in your `$PATH` at this stage.



---

archive/issue_comments_446985.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nSee #28709 for a followup incorporating these ideas.",
    "created_at": "2019-11-08T18:39:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446985",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">comment:36</div>

See #28709 for a followup incorporating these ideas.



---

archive/issue_events_390681.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-08T20:31:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390681"
}
```



---

archive/issue_events_390682.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9d8ca86b1efd2322be37bb39f1da5f25f80a4899",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-11-08T20:31:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28657#event-390682"
}
```



---

archive/issue_comments_446986.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/no-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-python)** to **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)**",
    "created_at": "2019-11-08T20:31:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446986",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/no-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-python)** to **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)**



---

archive/issue_comments_446987.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nIt seems that this broke the docker images, see #28738.\n\nIs it intentional that we now need a system Python to be installed to run Sage? Or is the situation in the docker image somehow special and other users won't be affected by this?\n\nWhat confuses me is the following in `sage`:\n\n```\n# Check to see if the whole Sage install tree has moved.  If so,\n# change various hardcoded paths.  Skip this if we don't have write\n# access to $SAGE_LOCAL (e.g. when running as a different user) or\n# if Python and sage-location haven't been installed yet.\nmaybe_sage_location()\n{\n    if [ -w \"$SAGE_LOCAL\" ]; then\n        if [ -x \"$SAGE_LOCAL/bin/python\" ] && [ -x \"$SAGE_LOCAL/bin/sage-location\" ]; then\n            sage-location || exit $?\n        fi\n    fi\n}\n```\n\nBut `sage-location` uses the system Python, so the check for `$SAGE_LOCAL/bin/python` seems to be wrong.",
    "created_at": "2019-11-17T21:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446987",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:38" align="right">comment:38</div>

It seems that this broke the docker images, see #28738.

Is it intentional that we now need a system Python to be installed to run Sage? Or is the situation in the docker image somehow special and other users won't be affected by this?

What confuses me is the following in `sage`:

```
# Check to see if the whole Sage install tree has moved.  If so,
# change various hardcoded paths.  Skip this if we don't have write
# access to $SAGE_LOCAL (e.g. when running as a different user) or
# if Python and sage-location haven't been installed yet.
maybe_sage_location()
{
    if [ -w "$SAGE_LOCAL" ]; then
        if [ -x "$SAGE_LOCAL/bin/python" ] && [ -x "$SAGE_LOCAL/bin/sage-location" ]; then
            sage-location || exit $?
        fi
    fi
}
```

But `sage-location` uses the system Python, so the check for `$SAGE_LOCAL/bin/python` seems to be wrong.



---

archive/issue_comments_446988.json:
```json
{
    "body": "Changed commit from **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)** to none",
    "created_at": "2019-11-17T21:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446988",
    "user": "https://github.com/saraedum"
}
```

Changed commit from **[`7a27daa`](https://github.com/sagemath/sagetrac-mirror/commit/7a27daaaac2f1107cd2d7e80b669ad0c35e09d85)** to none



---

archive/issue_comments_446989.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nIt's explained in the comment, at least somewhat: I think the point is, don't bother to do this check if `local/bin/python` doesn't exist, because the Sage install tree is incomplete. \n\nIn any case, it would be better to check for the existence of `local/bin/python` or `local/bin/python3`.",
    "created_at": "2019-11-18T01:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446989",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

It's explained in the comment, at least somewhat: I think the point is, don't bother to do this check if `local/bin/python` doesn't exist, because the Sage install tree is incomplete. 

In any case, it would be better to check for the existence of `local/bin/python` or `local/bin/python3`.



---

archive/issue_comments_446990.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nIsn't moving the sage tree after build long deprecated?",
    "created_at": "2019-11-18T10:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446990",
    "user": "https://github.com/timokau"
}
```

<div id="comment:40" align="right">comment:40</div>

Isn't moving the sage tree after build long deprecated?



---

archive/issue_comments_446991.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nYou can move the Sage tree at most once. This is how (for example) OS X binary distributions work: they are built with a placeholder for SAGE_ROOT, and then the first time it runs, the placeholder gets replaced with the permanent home. The script `sage-location` should print an error most of the time if you try to move the Sage tree.",
    "created_at": "2019-11-18T19:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446991",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">comment:41</div>

You can move the Sage tree at most once. This is how (for example) OS X binary distributions work: they are built with a placeholder for SAGE_ROOT, and then the first time it runs, the placeholder gets replaced with the permanent home. The script `sage-location` should print an error most of the time if you try to move the Sage tree.



---

archive/issue_comments_446992.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI don't think you can move a \"normal\" Sage tree at all. It needs to be specially prepared to be movable, and such a prepared tree does not work without first being moved.",
    "created_at": "2019-11-18T19:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28657#issuecomment-446992",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

I don't think you can move a "normal" Sage tree at all. It needs to be specially prepared to be movable, and such a prepared tree does not work without first being moved.
