# Issue 28155: Check for formality of GCDA's

archive/issues_027918.json:
```json
{
    "body": "Implement criteria to determine if a graded commutative differential algebra is formal or not.\n\nWhile I was at it, I also added some auxiliary functions that might be useful, forced it to use a more reasonable ordering when listing the basis of a homogenous part, and cleaned the style a little bit.\n\nThe algorithm used is described in https://arxiv.org/abs/1909.07761\n\nCC:  @jhpalmieri @slel @dimpase @tscrim\n\nReviewer: Travis Scrimshaw, John Palmieri\n\nAuthor: Miguel Marco, Victor Manero\n\nBranch: e95c78ac7cbaffa8e17444b1dc309c2d1cf37a48\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28155\n\n",
    "closed_at": "2019-10-21T22:43:55Z",
    "created_at": "2019-07-10T12:33:43Z",
    "labels": [
        "component: algebraic topology"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Check for formality of GCDA's",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28155",
    "user": "https://github.com/miguelmarco"
}
```
Implement criteria to determine if a graded commutative differential algebra is formal or not.

While I was at it, I also added some auxiliary functions that might be useful, forced it to use a more reasonable ordering when listing the basis of a homogenous part, and cleaned the style a little bit.

The algorithm used is described in https://arxiv.org/abs/1909.07761

CC:  @jhpalmieri @slel @dimpase @tscrim

Reviewer: Travis Scrimshaw, John Palmieri

Author: Miguel Marco, Victor Manero

Branch: e95c78ac7cbaffa8e17444b1dc309c2d1cf37a48

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28155





---

archive/issue_comments_419643.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+Implement criteria to determine if a graded commutative differential algebra is formal or not.\n \n+While I was at it, I also added some auxiliary functions that might be useful, forced it to use a more reasonable ordering when listing the basis of a homogenous part, and cleaned the style a little bit.\n \n Comment: 1\n \n```\n",
    "created_at": "2019-07-10T12:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419643",
    "user": "https://github.com/miguelmarco"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+Implement criteria to determine if a graded commutative differential algebra is formal or not.
 
+While I was at it, I also added some auxiliary functions that might be useful, forced it to use a more reasonable ordering when listing the basis of a homogenous part, and cleaned the style a little bit.
 
 Comment: 1
 
```




---

archive/issue_comments_419644.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-07-10T12:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419644",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_events_069916.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2019-07-10T12:41:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28155#event-69916"
}
```



---

archive/issue_comments_419645.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebra.",
    "created_at": "2019-07-17T10:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419645",
    "user": "https://github.com/miguelmarco"
}
```

Changing component from PLEASE CHANGE to algebra.



---

archive/issue_comments_419646.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-07-17T10:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419646",
    "user": "https://github.com/miguelmarco"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_419647.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-23T12:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419647",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419648.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+Implement criteria to determine if a graded commutative differential algebra is formal or not.\n \n+While I was at it, I also added some auxiliary functions that might be useful, forced it to use a more reasonable ordering when listing the basis of a homogenous part, and cleaned the style a little bit.\n+\n+The algorithm used is described in https://arxiv.org/abs/1909.07761\n \n Comment: 1\n \n```\n",
    "created_at": "2019-09-19T09:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419648",
    "user": "https://github.com/miguelmarco"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+Implement criteria to determine if a graded commutative differential algebra is formal or not.
 
+While I was at it, I also added some auxiliary functions that might be useful, forced it to use a more reasonable ordering when listing the basis of a homogenous part, and cleaned the style a little bit.
+
+The algorithm used is described in https://arxiv.org/abs/1909.07761
 
 Comment: 1
 
```




---

archive/issue_comments_419649.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-19T11:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419650.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-19T11:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419650",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_419651.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2019-09-19T11:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419651",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_comments_419652.json:
```json
{
    "body": "Changing component from algebra to algebraic topology.",
    "created_at": "2019-09-19T11:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419652",
    "user": "https://github.com/miguelmarco"
}
```

Changing component from algebra to algebraic topology.



---

archive/issue_events_069917.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2019-09-19T11:42:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28155#event-69917"
}
```



---

archive/issue_events_069918.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2019-09-19T11:42:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28155#event-69918"
}
```



---

archive/issue_comments_419653.json:
```json
{
    "body": "<a id='comment:8'></a>It looks good overall. Here are my comments:\n\nYou do not need to create the entire list here:\n\n```diff\n-return sum([a * b for (a, b) in zip(cohomcoefs, C.basis().values())])\n+return sum(a * b for (a, b) in zip(cohomcoefs, C.basis().values()))\n```\nAlso, is that expected to work if `C.basis()` is empty (if that even occurs)?\n\nSimilar here\n\n```diff\n-if any([N1[n] != N2[n] for n in range(1, i + 1)]):\n+if any(N1[n] != N2[n] for n in range(1, i + 1)):\n```\nand here\n\n```diff\n-if all([c.is_coboundary() for c in tocheck]):\n+if all(c.is_coboundary() for c in tocheck):\n```\n\nSage follows python convention of errors starting with lower case:\n\n```\n-raise NotImplementedError(\"The implemented criteria cannot determine formality\")\n+raise NotImplementedError(\"the implemented criteria cannot determine formality\")\n```\n\nOur conventions for `INPUT:` docstrings:\n\n```diff\n-        - ``i`` -- integer; the degree up to which the formality is checked.\n+        - ``i`` -- integer; the degree up to which the formality is checked\n \n         - ``max_iterations`` -- integer (default: `3`); the maximum number of\n-          iterations used in the computation of the minimal model.\n+          iterations used in the computation of the minimal model\n```\n\n```diff\n         - ``max_degree`` -- integer (default: `3`); the degree up to which the\n-          numerical invariants are computed.\n+          numerical invariants are computed\n \n         - ``max_iterations`` -- integer (default: `3`); the maximum number of iterations\n-          used to compute the minimal model, if it is not already cached.\n+          used to compute the minimal model, if it is not already cached\n```\n\nIt is not always a good idea to strictly follow PEP8 when writing code. It leads to things like this:\n\n```\n                                     ['x{}'.format(i)\n                                         for i in range(len(chgens))],\n```\nwhere the break makes it harder to read the code. Not that this will cause me to hold up the ticket once everything else is done, but it might be worthwhile to go through and consider on the changes you made.",
    "created_at": "2019-09-19T12:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419653",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>It looks good overall. Here are my comments:

You do not need to create the entire list here:

```diff
-return sum([a * b for (a, b) in zip(cohomcoefs, C.basis().values())])
+return sum(a * b for (a, b) in zip(cohomcoefs, C.basis().values()))
```
Also, is that expected to work if `C.basis()` is empty (if that even occurs)?

Similar here

```diff
-if any([N1[n] != N2[n] for n in range(1, i + 1)]):
+if any(N1[n] != N2[n] for n in range(1, i + 1)):
```
and here

```diff
-if all([c.is_coboundary() for c in tocheck]):
+if all(c.is_coboundary() for c in tocheck):
```

Sage follows python convention of errors starting with lower case:

```
-raise NotImplementedError("The implemented criteria cannot determine formality")
+raise NotImplementedError("the implemented criteria cannot determine formality")
```

Our conventions for `INPUT:` docstrings:

```diff
-        - ``i`` -- integer; the degree up to which the formality is checked.
+        - ``i`` -- integer; the degree up to which the formality is checked
 
         - ``max_iterations`` -- integer (default: `3`); the maximum number of
-          iterations used in the computation of the minimal model.
+          iterations used in the computation of the minimal model
```

```diff
         - ``max_degree`` -- integer (default: `3`); the degree up to which the
-          numerical invariants are computed.
+          numerical invariants are computed
 
         - ``max_iterations`` -- integer (default: `3`); the maximum number of iterations
-          used to compute the minimal model, if it is not already cached.
+          used to compute the minimal model, if it is not already cached
```

It is not always a good idea to strictly follow PEP8 when writing code. It leads to things like this:

```
                                     ['x{}'.format(i)
                                         for i in range(len(chgens))],
```
where the break makes it harder to read the code. Not that this will cause me to hold up the ticket once everything else is done, but it might be worthwhile to go through and consider on the changes you made.



---

archive/issue_comments_419654.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-20T09:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419655.json:
```json
{
    "body": "<a id='comment:10'></a>I made the suggested changes.\n\n\n> Also, is that expected to work if `C.basis()` is empty (if that even occurs)?\n> \n\n\nIt is expected to return the zero element of a trivial cohomology group. It did return zero as an integer. I have forced a conversion to the corresponding cohomology group, and added a corresponding test.\n\n---\nNew commits:",
    "created_at": "2019-09-20T09:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419655",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:10'></a>I made the suggested changes.


> Also, is that expected to work if `C.basis()` is empty (if that even occurs)?
> 


It is expected to return the zero element of a trivial cohomology group. It did return zero as an integer. I have forced a conversion to the corresponding cohomology group, and added a corresponding test.

---
New commits:



---

archive/issue_comments_419656.json:
```json
{
    "body": "<a id='comment:11'></a>Thank you. One last thing to address is the pyflakes (see the patchbot). For instance, since you do not use the minimal model, you can just do this:\n\n```diff\n-MH = H.minimal_model(i, max_iterations)\n+H.minimal_model(i, max_iterations)\n```",
    "created_at": "2019-09-20T12:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419656",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>Thank you. One last thing to address is the pyflakes (see the patchbot). For instance, since you do not use the minimal model, you can just do this:

```diff
-MH = H.minimal_model(i, max_iterations)
+H.minimal_model(i, max_iterations)
```



---

archive/issue_comments_419657.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-20T14:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419658.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-20T21:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419658",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419659.json:
```json
{
    "body": "<a id='comment:13'></a>Thank you.",
    "created_at": "2019-09-20T21:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419659",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Thank you.



---

archive/issue_comments_419660.json:
```json
{
    "body": "<a id='comment:14'></a>moving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419660",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>moving milestone to 9.0 (after release of 8.9)



---

archive/issue_events_069919.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-30T08:12:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28155#event-69919"
}
```



---

archive/issue_events_069920.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-30T08:12:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28155#event-69920"
}
```



---

archive/issue_comments_419661.json:
```json
{
    "body": "<a id='comment:15'></a>I'm getting a lot of \n\n```\nFile \"src/sage/algebras/commutative_dga.py\", line 2888, in sage.algebras.commutative_dga.DifferentialGCAlgebra.Element.cohomology_class\nFailed example:\n    a.cohomology_class()\nExpected:\n    B[[e1*e3*e5]] - 3*B[[e2*e3*e5]]\nGot:\n    -3*B[[e2*e3*e5]] + B[[e1*e3*e5]]\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.algebras.commutative_dga.DifferentialGCAlgebra.Element.cohomology_class\n    [600 tests, 1 failure, 26.78 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/algebras/commutative_dga.py  # 1 doctest failed\n----------------------------------------------------------------------\n\n```",
    "created_at": "2019-10-03T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419661",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>I'm getting a lot of 

```
File "src/sage/algebras/commutative_dga.py", line 2888, in sage.algebras.commutative_dga.DifferentialGCAlgebra.Element.cohomology_class
Failed example:
    a.cohomology_class()
Expected:
    B[[e1*e3*e5]] - 3*B[[e2*e3*e5]]
Got:
    -3*B[[e2*e3*e5]] + B[[e1*e3*e5]]
**********************************************************************
1 item had failures:
   1 of  11 in sage.algebras.commutative_dga.DifferentialGCAlgebra.Element.cohomology_class
    [600 tests, 1 failure, 26.78 s]
----------------------------------------------------------------------
sage -t --long src/sage/algebras/commutative_dga.py  # 1 doctest failed
----------------------------------------------------------------------

```



---

archive/issue_comments_419662.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-10-03T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419662",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_419663.json:
```json
{
    "body": "<a id='comment:16'></a>Oddly enough, I see this intermittently with Python 2 but not at all with Python 3. In a Python 2 Sage session:\n\n```\nsage: A.<e1,e2,e3,e4,e5> = GradedCommutativeAlgebra(QQ)\nsage: B = A.cdg_algebra({e5:e1*e2+e3*e4})\nsage: B.inject_variables()\nDefining e1, e2, e3, e4, e5\nsage: a = e1*e3*e5-3*e2*e3*e5\nsage: a.cohomology_class()\nB[[e1*e3*e5]] - 3*B[[e2*e3*e5]]\nsage: a.cohomology_class()\n-3*B[[e2*e3*e5]] + B[[e1*e3*e5]]}}}",
    "created_at": "2019-10-03T18:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419663",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>Oddly enough, I see this intermittently with Python 2 but not at all with Python 3. In a Python 2 Sage session:

```
sage: A.<e1,e2,e3,e4,e5> = GradedCommutativeAlgebra(QQ)
sage: B = A.cdg_algebra({e5:e1*e2+e3*e4})
sage: B.inject_variables()
Defining e1, e2, e3, e4, e5
sage: a = e1*e3*e5-3*e2*e3*e5
sage: a.cohomology_class()
B[[e1*e3*e5]] - 3*B[[e2*e3*e5]]
sage: a.cohomology_class()
-3*B[[e2*e3*e5]] + B[[e1*e3*e5]]}}}



---

archive/issue_comments_419664.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-15T09:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419665.json:
```json
{
    "body": "<a id='comment:18'></a>It seems to be a problem with `CohomologyClass`. I did it `CachedRepresentation`, which seems to solve the problem of returning different representations in the same session. However, I still get errors every time I run the testsuite.\n\nIs there any flag or environment variable that could affect the order in which the basis of a `CombinatorialFreeModule`are represented depending on the fact that we are in an interactive shell or running the testsuite?\n\n---\nNew commits:",
    "created_at": "2019-10-15T09:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419665",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:18'></a>It seems to be a problem with `CohomologyClass`. I did it `CachedRepresentation`, which seems to solve the problem of returning different representations in the same session. However, I still get errors every time I run the testsuite.

Is there any flag or environment variable that could affect the order in which the basis of a `CombinatorialFreeModule`are represented depending on the fact that we are in an interactive shell or running the testsuite?

---
New commits:



---

archive/issue_comments_419666.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-15T10:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419667.json:
```json
{
    "body": "<a id='comment:20'></a>Ok, I think I solved it.\n\n---\nNew commits:",
    "created_at": "2019-10-15T10:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419667",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:20'></a>Ok, I think I solved it.

---
New commits:



---

archive/issue_comments_419668.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-15T10:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419668",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419669.json:
```json
{
    "body": "<a id='comment:21'></a>Using `CachedRepresentation` should not be necessary, since you're using `sorting_key=...`, and this seems to be borne out in some testing that I did. So I think it should be removed.",
    "created_at": "2019-10-15T17:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419669",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>Using `CachedRepresentation` should not be necessary, since you're using `sorting_key=...`, and this seems to be borne out in some testing that I did. So I think it should be removed.



---

archive/issue_comments_419670.json:
```json
{
    "body": "<a id='comment:22'></a>I found that ithout `CachedRepresentation` , each time that the cohomology class of an element is computed, we get a different object. In particular, when we create the cohomology group, it takes as basis the specific instances of the cohomology classes of the generators that were created in that particular call. Hence, when we call it again, we get a different group.\n\n\nThat is, without `CachedRepresentation` we get this:\n\n```\nsage: A.<e1,e2,e3,e4,e5> = GradedCommutativeAlgebra(QQ)\nsage: B = A.cdg_algebra({e5:e1*e2+e3*e4})\nsage: B.inject_variables()\nDefining e1, e2, e3, e4, e5\nsage: a = e1*e3*e5-3*e2*e3*e5\nsage: C = B.cohomology(3)\nsage: a.cohomology_class() in C\nFalse\n```\n\nEven if the parent of `a.cohomology_class()` should be `C` :\n\n```\nsage: C\nFree module generated by {[e1*e2*e5 - e3*e4*e5], [e1*e3*e5], [e2*e3*e5], [e1*e4*e5], [e2*e4*e5]} over Rational Field\nsage: a.cohomology_class().parent()\nFree module generated by {[e1*e2*e5 - e3*e4*e5], [e1*e3*e5], [e2*e3*e5], [e1*e4*e5], [e2*e4*e5]} over Rational Field\n```\n\nThey look the same, but are different objects because they have been created with different  generators.\n\nIndeed:\n\n```\nsage: B.cohomology(3) is B.cohomology(3)\nFalse\nsage: B.cohomology(3) == B.cohomology(3)\nFalse\n```",
    "created_at": "2019-10-15T17:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419670",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:22'></a>I found that ithout `CachedRepresentation` , each time that the cohomology class of an element is computed, we get a different object. In particular, when we create the cohomology group, it takes as basis the specific instances of the cohomology classes of the generators that were created in that particular call. Hence, when we call it again, we get a different group.


That is, without `CachedRepresentation` we get this:

```
sage: A.<e1,e2,e3,e4,e5> = GradedCommutativeAlgebra(QQ)
sage: B = A.cdg_algebra({e5:e1*e2+e3*e4})
sage: B.inject_variables()
Defining e1, e2, e3, e4, e5
sage: a = e1*e3*e5-3*e2*e3*e5
sage: C = B.cohomology(3)
sage: a.cohomology_class() in C
False
```

Even if the parent of `a.cohomology_class()` should be `C` :

```
sage: C
Free module generated by {[e1*e2*e5 - e3*e4*e5], [e1*e3*e5], [e2*e3*e5], [e1*e4*e5], [e2*e4*e5]} over Rational Field
sage: a.cohomology_class().parent()
Free module generated by {[e1*e2*e5 - e3*e4*e5], [e1*e3*e5], [e2*e3*e5], [e1*e4*e5], [e2*e4*e5]} over Rational Field
```

They look the same, but are different objects because they have been created with different  generators.

Indeed:

```
sage: B.cohomology(3) is B.cohomology(3)
False
sage: B.cohomology(3) == B.cohomology(3)
False
```



---

archive/issue_comments_419671.json:
```json
{
    "body": "<a id='comment:23'></a>Can you add some of these as doctests, then?",
    "created_at": "2019-10-15T18:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419671",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>Can you add some of these as doctests, then?



---

archive/issue_comments_419672.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-16T09:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419673.json:
```json
{
    "body": "<a id='comment:25'></a>Doctests added.",
    "created_at": "2019-10-16T09:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419673",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:25'></a>Doctests added.



---

archive/issue_comments_419674.json:
```json
{
    "body": "<a id='comment:27'></a>Thank you. I've made a few small docstring fixes. If you're happy with my changes, please set to positive review on my behalf.\n\n---\nLast 10 new commits:",
    "created_at": "2019-10-16T17:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419674",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>Thank you. I've made a few small docstring fixes. If you're happy with my changes, please set to positive review on my behalf.

---
Last 10 new commits:



---

archive/issue_comments_419675.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-16T17:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419675",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419676.json:
```json
{
    "body": "<a id='comment:28'></a>Thank you!",
    "created_at": "2019-10-16T17:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419676",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:28'></a>Thank you!



---

archive/issue_comments_419677.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-21T22:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419677",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069921.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-21T22:43:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28155#event-69921"
}
```



---

archive/issue_comments_419678.json:
```json
{
    "body": "<a id='comment:31'></a>I am now annoyed at the requirement that generators have to be entered in increasing order of degree. If the code cares that much about the ordering, it should sort itself and save its preferred ordering, but why should a user who has an algebra with a natural ordering of the generators have to manually reorder them to fit the code? This seems backward to me.",
    "created_at": "2022-09-24T17:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419678",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>I am now annoyed at the requirement that generators have to be entered in increasing order of degree. If the code cares that much about the ordering, it should sort itself and save its preferred ordering, but why should a user who has an algebra with a natural ordering of the generators have to manually reorder them to fit the code? This seems backward to me.



---

archive/issue_comments_419679.json:
```json
{
    "body": "<a id='comment:32'></a>Following up in #34582.",
    "created_at": "2022-09-24T18:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28155#issuecomment-419679",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>Following up in #34582.
