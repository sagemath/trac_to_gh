# Issue 28908: Indeterminacy locus and image of morphisms of schemes

archive/issues_028908.json:
```json
{
    "body": "Implemented indeterminacy locus and image of morphisms of affine and projective schemes.\n\nAlong the way, cleaned up some files in schemes module.\n\n---\nThe author was supported by NRF of Korea 2019, 2020\n\nIssue created by migration from https://trac.sagemath.org/ticket/29145\n\n",
    "closed_at": "2020-02-11T21:05:51Z",
    "created_at": "2020-02-03T07:12:39Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Indeterminacy locus and image of morphisms of schemes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28908",
    "user": "https://github.com/kwankyu"
}
```
Implemented indeterminacy locus and image of morphisms of affine and projective schemes.

Along the way, cleaned up some files in schemes module.

---
The author was supported by NRF of Korea 2019, 2020

Issue created by migration from https://trac.sagemath.org/ticket/29145





---

archive/issue_comments_408781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-03T09:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408782.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-03T09:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408782",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-04T02:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-02-04T02:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_408785.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-04T03:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-04T06:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408787.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-02-04T06:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_408788.json:
```json
{
    "body": "A few things:\n\nIt would be good to have a more clear indication for this list here\n\n```diff\n             sage: g.representatives()\n             [Scheme morphism:\n                From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n                x^2 - y^2 - y\n                To:   Affine Space of dimension 1 over Rational Field\n                Defn: Defined on coordinates by sending (x, y) to\n-                     (x/y), Scheme morphism:\n+                     (x/y),\n+             Scheme morphism:\n                From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n                x^2 - y^2 - y\n                To:   Affine Space of dimension 1 over Rational Field\n                Defn: Defined on coordinates by sending (x, y) to\n                      ((y + 1)/x)]\n```\nand similar changes for the other tests in this method.\n\nDo you need to move the `SchemeMorphism.__init__(self, parent)` in `SchemeMorphism_polynomial.__init__`? I feel it would be better to do it after the possible error messages for when those are raised so as to not do unnecessary work (granted, if it is needed to be initialized for the tests, then this comment is moot).\n\nPEP8:\n\n```diff\n-p = source_ring(poly.numerator())/source_ring(poly.denominator())\n+p = source_ring(poly.numerator()) / source_ring(poly.denominator())\n```\n\nI don't understand this bit of code:\n\n```\n        if not self.codomain().is_projective():\n            pass\n```\nThere is no `else` statement attached, so I feel it can be removed.\n\nIs the `Chow_form` still usable by instances of `AlgebraicScheme_subscheme_projective`? Are they suppose to be?",
    "created_at": "2020-02-08T22:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408788",
    "user": "https://github.com/tscrim"
}
```

A few things:

It would be good to have a more clear indication for this list here

```diff
             sage: g.representatives()
             [Scheme morphism:
                From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
                x^2 - y^2 - y
                To:   Affine Space of dimension 1 over Rational Field
                Defn: Defined on coordinates by sending (x, y) to
-                     (x/y), Scheme morphism:
+                     (x/y),
+             Scheme morphism:
                From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
                x^2 - y^2 - y
                To:   Affine Space of dimension 1 over Rational Field
                Defn: Defined on coordinates by sending (x, y) to
                      ((y + 1)/x)]
```
and similar changes for the other tests in this method.

Do you need to move the `SchemeMorphism.__init__(self, parent)` in `SchemeMorphism_polynomial.__init__`? I feel it would be better to do it after the possible error messages for when those are raised so as to not do unnecessary work (granted, if it is needed to be initialized for the tests, then this comment is moot).

PEP8:

```diff
-p = source_ring(poly.numerator())/source_ring(poly.denominator())
+p = source_ring(poly.numerator()) / source_ring(poly.denominator())
```

I don't understand this bit of code:

```
        if not self.codomain().is_projective():
            pass
```
There is no `else` statement attached, so I feel it can be removed.

Is the `Chow_form` still usable by instances of `AlgebraicScheme_subscheme_projective`? Are they suppose to be?



---

archive/issue_comments_408789.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> A few things:\n> \n> It would be good to have a more clear indication for this list here\n> \n> ```diff\n>              sage: g.representatives()\n>              [Scheme morphism:\n>                 From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n>                 x^2 - y^2 - y\n>                 To:   Affine Space of dimension 1 over Rational Field\n>                 Defn: Defined on coordinates by sending (x, y) to\n> -                     (x/y), Scheme morphism:\n> +                     (x/y),\n> +             Scheme morphism:\n>                 From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n>                 x^2 - y^2 - y\n>                 To:   Affine Space of dimension 1 over Rational Field\n>                 Defn: Defined on coordinates by sending (x, y) to\n>                       ((y + 1)/x)]\n> ```\n> and similar changes for the other tests in this method.\n\n\nOK. Done.\n\n> Do you need to move the `SchemeMorphism.__init__(self, parent)` in `SchemeMorphism_polynomial.__init__`? I feel it would be better to do it after the possible error messages for when those are raised so as to not do unnecessary work (granted, if it is needed to be initialized for the tests, then this comment is moot).\n\n\nNo. You are right. I wrongly thought it is needed. Moved back.\n\n> PEP8:\n> \n> ```diff\n> -p = source_ring(poly.numerator())/source_ring(poly.denominator())\n> +p = source_ring(poly.numerator()) / source_ring(poly.denominator())\n> ```\n\n\nDone.\n \n> I don't understand this bit of code:\n> \n> ```\n>         if not self.codomain().is_projective():\n>             pass\n> ```\n> There is no `else` statement attached, so I feel it can be removed.\n\n\nThis part was \"to do\", and then I somehow  forgot.. Now I filled the missing part, which is for morphisms from projective subscheme to affine space. Thank you for spotting this!\n> \n> Is the `Chow_form` still usable by instances of `AlgebraicScheme_subscheme_projective`? Are they suppose to be?\n\n\n`Chow_form` method assumes the base ring is a field.  Methods of `AlgebraicScheme_subscheme_projective` should assume just rings. So it would be usable when the assumption is met.",
    "created_at": "2020-02-10T02:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408789",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:11 tscrim]:
> A few things:
> 
> It would be good to have a more clear indication for this list here
> 
> ```diff
>              sage: g.representatives()
>              [Scheme morphism:
>                 From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
>                 x^2 - y^2 - y
>                 To:   Affine Space of dimension 1 over Rational Field
>                 Defn: Defined on coordinates by sending (x, y) to
> -                     (x/y), Scheme morphism:
> +                     (x/y),
> +             Scheme morphism:
>                 From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
>                 x^2 - y^2 - y
>                 To:   Affine Space of dimension 1 over Rational Field
>                 Defn: Defined on coordinates by sending (x, y) to
>                       ((y + 1)/x)]
> ```
> and similar changes for the other tests in this method.


OK. Done.

> Do you need to move the `SchemeMorphism.__init__(self, parent)` in `SchemeMorphism_polynomial.__init__`? I feel it would be better to do it after the possible error messages for when those are raised so as to not do unnecessary work (granted, if it is needed to be initialized for the tests, then this comment is moot).


No. You are right. I wrongly thought it is needed. Moved back.

> PEP8:
> 
> ```diff
> -p = source_ring(poly.numerator())/source_ring(poly.denominator())
> +p = source_ring(poly.numerator()) / source_ring(poly.denominator())
> ```


Done.
 
> I don't understand this bit of code:
> 
> ```
>         if not self.codomain().is_projective():
>             pass
> ```
> There is no `else` statement attached, so I feel it can be removed.


This part was "to do", and then I somehow  forgot.. Now I filled the missing part, which is for morphisms from projective subscheme to affine space. Thank you for spotting this!
> 
> Is the `Chow_form` still usable by instances of `AlgebraicScheme_subscheme_projective`? Are they suppose to be?


`Chow_form` method assumes the base ring is a field.  Methods of `AlgebraicScheme_subscheme_projective` should assume just rings. So it would be usable when the assumption is met.



---

archive/issue_comments_408790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-10T02:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-02-10T02:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_408792.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-10T13:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408792",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_408793.json:
```json
{
    "body": "Thank you for the changes and explanations. LGTM.",
    "created_at": "2020-02-10T13:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408793",
    "user": "https://github.com/tscrim"
}
```

Thank you for the changes and explanations. LGTM.



---

archive/issue_comments_408794.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-11T21:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28908#issuecomment-408794",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073946.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-02-11T21:05:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28908",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28908#event-73946"
}
```
