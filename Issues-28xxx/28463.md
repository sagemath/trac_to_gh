# Issue 28463: .neighbors() error in polyhedron.representation

archive/issues_028226.json:
```json
{
    "body": "The following Error happens in Sage8.9.beta8:\n\n```\nsage: s = polytopes.simplex(7)\nsage: f = s.faces(3)[0]\nsage: sf = s.stack(f)\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-3-fae09a40457d> in <module>()\n----> 1 sf = s.stack(f)\n\n/home/jplabbe/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in stack(self, face, position)\n   4135         neighboring_facets = set()\n   4136         for facet in face_star:\n-> 4137             for neighbor_facet in facet.neighbors():\n   4138                 if neighbor_facet not in face_star:\n   4139                     neighboring_facets.add(neighbor_facet)\n\n/home/jplabbe/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/representation.py in neighbors(self)\n    463         adjacency_matrix = self.polyhedron().facet_adjacency_matrix()\n    464         for x in self.polyhedron().Hrep_generator():\n--> 465             if adjacency_matrix[self.index(), x.index()] == 1:\n    466                 yield x\n    467 \n\n/home/jplabbe/sage/local/lib/python3.7/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__getitem__ (build/cythonized/sage/matrix/matrix0.c:7282)()\n    963                     col += ncols\n    964                 if col < 0 or col >= ncols:\n--> 965                     raise IndexError(\"matrix index out of range\")\n    966                 single_col = 1\n    967 \n\nIndexError: matrix index out of range\n```\n\nWe fix `neighbors` of `polyhedron.representation` to only specify inequalities/facets. In case of a non-full-dimensional polyhedron, the method had an index shift and did not return anything valuable (if not an error). The method appears to be used only in `stack`, so we do not set a deprecation warning (even so the method is now returning an error for equalities).\n\nAlso, we do some minor changes to `stack`:\n- fix a bug: the stacked vertex needs to be in the relative interior of the `locus_polyhedron` (not just contained in),\n- errors for non-proper faces,\n- remove a redundant test (all vertices of a polyhedron satisfy all of its inequalities/equalites).\n\nCC:  @laisrast @kliem\n\nKeywords: polytopes, stack, representation, neighbors\n\nReviewer: Jean-Philippe Labb\u00e9\n\nAuthor: Jonathan Kliem\n\nBranch: f4c89fe44a14a833ddc5f153f754d4ab26502f63\n\nCommit: f4c89fe44a14a833ddc5f153f754d4ab26502f63\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28463\n\n",
    "closed_at": "2019-10-23T22:58:05Z",
    "created_at": "2019-09-09T07:30:35Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": ".neighbors() error in polyhedron.representation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28463",
    "user": "https://github.com/jplab"
}
```
The following Error happens in Sage8.9.beta8:

```
sage: s = polytopes.simplex(7)
sage: f = s.faces(3)[0]
sage: sf = s.stack(f)
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-3-fae09a40457d> in <module>()
----> 1 sf = s.stack(f)

/home/jplabbe/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in stack(self, face, position)
   4135         neighboring_facets = set()
   4136         for facet in face_star:
-> 4137             for neighbor_facet in facet.neighbors():
   4138                 if neighbor_facet not in face_star:
   4139                     neighboring_facets.add(neighbor_facet)

/home/jplabbe/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/representation.py in neighbors(self)
    463         adjacency_matrix = self.polyhedron().facet_adjacency_matrix()
    464         for x in self.polyhedron().Hrep_generator():
--> 465             if adjacency_matrix[self.index(), x.index()] == 1:
    466                 yield x
    467 

/home/jplabbe/sage/local/lib/python3.7/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__getitem__ (build/cythonized/sage/matrix/matrix0.c:7282)()
    963                     col += ncols
    964                 if col < 0 or col >= ncols:
--> 965                     raise IndexError("matrix index out of range")
    966                 single_col = 1
    967 

IndexError: matrix index out of range
```

We fix `neighbors` of `polyhedron.representation` to only specify inequalities/facets. In case of a non-full-dimensional polyhedron, the method had an index shift and did not return anything valuable (if not an error). The method appears to be used only in `stack`, so we do not set a deprecation warning (even so the method is now returning an error for equalities).

Also, we do some minor changes to `stack`:
- fix a bug: the stacked vertex needs to be in the relative interior of the `locus_polyhedron` (not just contained in),
- errors for non-proper faces,
- remove a redundant test (all vertices of a polyhedron satisfy all of its inequalities/equalites).

CC:  @laisrast @kliem

Keywords: polytopes, stack, representation, neighbors

Reviewer: Jean-Philippe Labb√©

Author: Jonathan Kliem

Branch: f4c89fe44a14a833ddc5f153f754d4ab26502f63

Commit: f4c89fe44a14a833ddc5f153f754d4ab26502f63

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28463





---

archive/issue_comments_398132.json:
```json
{
    "body": "<a id='comment:1'></a>This is actually a serious problem. See\n\n```\nsage: P = polytopes.simplex()\n....: F1 = P.Hrepresentation()[1]\n....: list(F1.neighbors())\n....:\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-11-3a4d81457d82> in <module>()\n      1 P = polytopes.simplex()\n      2 F = P.Hrepresentation()[Integer(1)]\n----> 3 list(F.neighbors())\n\n/usr/lib/python2.7/site-packages/sage/geometry/polyhedron/representation.pyc in neighbors(self)\n    463         adjacency_matrix = self.polyhedron().facet_adjacency_matrix()\n    464         for x in self.polyhedron().Hrep_generator():\n--> 465             if adjacency_matrix[self.index(), x.index()] == 1:\n    466                 yield x\n    467\n\n/usr/lib/python2.7/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__getitem__ (build/cythonized/sage/matrix/matrix0.c:7281)()\n    963                     col += ncols\n    964                 if col < 0 or col >= ncols:\n--> 965                     raise IndexError(\"matrix index out of range\")\n    966                 single_col = 1\n    967\n\nIndexError: matrix index out of range\n```\n\nThe method `neighbors()` says that it iterates over the adjacent inequalities *and equations*. However, its code uses the `facet_adjacency_matrix()` method which returns the adjacency of just the inequalities.\nTo solve this, I think we should introduce `H_adjacency_matrix()`, and use it in the code of `neighbors()`.",
    "created_at": "2019-09-09T11:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398132",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:1'></a>This is actually a serious problem. See

```
sage: P = polytopes.simplex()
....: F1 = P.Hrepresentation()[1]
....: list(F1.neighbors())
....:
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-11-3a4d81457d82> in <module>()
      1 P = polytopes.simplex()
      2 F = P.Hrepresentation()[Integer(1)]
----> 3 list(F.neighbors())

/usr/lib/python2.7/site-packages/sage/geometry/polyhedron/representation.pyc in neighbors(self)
    463         adjacency_matrix = self.polyhedron().facet_adjacency_matrix()
    464         for x in self.polyhedron().Hrep_generator():
--> 465             if adjacency_matrix[self.index(), x.index()] == 1:
    466                 yield x
    467

/usr/lib/python2.7/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__getitem__ (build/cythonized/sage/matrix/matrix0.c:7281)()
    963                     col += ncols
    964                 if col < 0 or col >= ncols:
--> 965                     raise IndexError("matrix index out of range")
    966                 single_col = 1
    967

IndexError: matrix index out of range
```

The method `neighbors()` says that it iterates over the adjacent inequalities *and equations*. However, its code uses the `facet_adjacency_matrix()` method which returns the adjacency of just the inequalities.
To solve this, I think we should introduce `H_adjacency_matrix()`, and use it in the code of `neighbors()`.



---

archive/issue_comments_398133.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-10T22:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398133",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398134.json:
```json
{
    "body": "<a id='comment:2'></a>I added a suggested fix.\n\nI changed `neighbors` to only include `facets`/`inequalities`. There is no meaning in checking anything else anyway, is there?\n\nAdditionally I changed a few things, which I noticed about `stacked`.\n\nAs `neighbors` did not work for polyhedra with equalities and is not altered for those with without, I don't think a deprecation error is needed.\n\n---\nNew commits:",
    "created_at": "2019-09-10T22:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398134",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>I added a suggested fix.

I changed `neighbors` to only include `facets`/`inequalities`. There is no meaning in checking anything else anyway, is there?

Additionally I changed a few things, which I noticed about `stacked`.

As `neighbors` did not work for polyhedra with equalities and is not altered for those with without, I don't think a deprecation error is needed.

---
New commits:



---

archive/issue_comments_398135.json:
```json
{
    "body": "Changing keywords from \"polytopes, stack\" to \"polytopes, stack, representation, neighbors\".",
    "created_at": "2019-09-10T22:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398135",
    "user": "https://github.com/kliem"
}
```

Changing keywords from "polytopes, stack" to "polytopes, stack, representation, neighbors".



---

archive/issue_comments_398136.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-11T04:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398137.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-09-12T06:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398137",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_398138.json:
```json
{
    "body": "<a id='comment:4'></a>A few comments:\n\n- You should put \"Checking that :trac:`28463` is fixed::\" in the docstring before the failing test coming from this ticket.\n\n- I would not refer to an internal variable in the TEST block, but try to say it in words.\n\n- It would be good to show the new raised ValueError at the end of the examples to say that you should do this on proper faces only (but really at the end, so that \"working examples\" come first...)\n\n- Careful with 1 empty line after `::` and indentation of code blocks, otherwise documentation won't build.\n\n- You introduced two useless empty lines it seems.\n\n- Please reread what you changed in `representation` it seems contradictory \"Does not work for inequalities::\" and \"AssertionError: must be inequality\" is at best very confusing.\n\n- I don't know what you are talking about with a deprecation: you are changing the behavior of the function, not changing a name or an option. In principle, this change is not wished. That is: we may break a lot of code doing so. That said, the code was broken, so fair enough. But the question remains: is there internal code that breaks due to a weird use of `neighbor()`? Could you check that? Then, I would say it should be a TypeError and not an AssertionError.",
    "created_at": "2019-09-12T06:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398138",
    "user": "https://github.com/jplab"
}
```

<a id='comment:4'></a>A few comments:

- You should put "Checking that :trac:`28463` is fixed::" in the docstring before the failing test coming from this ticket.

- I would not refer to an internal variable in the TEST block, but try to say it in words.

- It would be good to show the new raised ValueError at the end of the examples to say that you should do this on proper faces only (but really at the end, so that "working examples" come first...)

- Careful with 1 empty line after `::` and indentation of code blocks, otherwise documentation won't build.

- You introduced two useless empty lines it seems.

- Please reread what you changed in `representation` it seems contradictory "Does not work for inequalities::" and "AssertionError: must be inequality" is at best very confusing.

- I don't know what you are talking about with a deprecation: you are changing the behavior of the function, not changing a name or an option. In principle, this change is not wished. That is: we may break a lot of code doing so. That said, the code was broken, so fair enough. But the question remains: is there internal code that breaks due to a weird use of `neighbor()`? Could you check that? Then, I would say it should be a TypeError and not an AssertionError.



---

archive/issue_comments_398139.json:
```json
{
    "body": "<a id='comment:5'></a>A small remark. The docstring of `neighbors` still says inequalities and *equations*:\n\n```\n    Iterate over the adjacent facets (i.e. inequalities/equations)\n```",
    "created_at": "2019-09-12T09:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398139",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:5'></a>A small remark. The docstring of `neighbors` still says inequalities and *equations*:

```
    Iterate over the adjacent facets (i.e. inequalities/equations)
```



---

archive/issue_comments_398140.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-12T21:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398141.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:4 jipilab]:\n> A few comments:\n> \n> - You should put \"Checking that :trac:`28463` is fixed::\" in the docstring before the failing test coming from this ticket.\n> \n> - I would not refer to an internal variable in the TEST block, but try to say it in words.\n> \n> - It would be good to show the new raised ValueError at the end of the examples to say that you should do this on proper faces only (but really at the end, so that \"working examples\" come first...)\n> \n> - Careful with 1 empty line after `::` and indentation of code blocks, otherwise documentation won't build.\n> \n> - You introduced two useless empty lines it seems.\n\nMy editor deletes trailing white spaces by default.\n> \n> - Please reread what you changed in `representation` it seems contradictory \"Does not work for inequalities::\" and \"AssertionError: must be inequality\" is at best very confusing.\n> \n> - I don't know what you are talking about with a deprecation: you are changing the behavior of the function, not changing a name or an option. In principle, this change is not wished. That is: we may break a lot of code doing so. That said, the code was broken, so fair enough. But the question remains: is there internal code that breaks due to a weird use of `neighbor()`? Could you check that? Then, I would say it should be a TypeError and not an AssertionError.",
    "created_at": "2019-09-12T21:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398141",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>Replying to [comment:4 jipilab]:
> A few comments:
> 
> - You should put "Checking that :trac:`28463` is fixed::" in the docstring before the failing test coming from this ticket.
> 
> - I would not refer to an internal variable in the TEST block, but try to say it in words.
> 
> - It would be good to show the new raised ValueError at the end of the examples to say that you should do this on proper faces only (but really at the end, so that "working examples" come first...)
> 
> - Careful with 1 empty line after `::` and indentation of code blocks, otherwise documentation won't build.
> 
> - You introduced two useless empty lines it seems.

My editor deletes trailing white spaces by default.
> 
> - Please reread what you changed in `representation` it seems contradictory "Does not work for inequalities::" and "AssertionError: must be inequality" is at best very confusing.
> 
> - I don't know what you are talking about with a deprecation: you are changing the behavior of the function, not changing a name or an option. In principle, this change is not wished. That is: we may break a lot of code doing so. That said, the code was broken, so fair enough. But the question remains: is there internal code that breaks due to a weird use of `neighbor()`? Could you check that? Then, I would say it should be a TypeError and not an AssertionError.



---

archive/issue_comments_398142.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-09-12T21:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398142",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_398143.json:
```json
{
    "body": "<a id='comment:9'></a>\n```diff\n-        Checking that stacked point needs to be in the interior of\n-        ``locus_polyhedron``::\n+        The stacked vertex may not satisfy any inequality\n+        defining the original polyhedron::\n```\n\nThis is making it less precise. Why not say:\n\n```diff\n+        Taking the stacking vertex too far with the parameter `XXX` may result in a failure to produce the desired (combinatorial type of) polytope.\n```\n\nYou forgot to indent the sage blocks.\n\nHave you looked at the other places where `.neighbors` is used in the polyhedron folder?",
    "created_at": "2019-09-13T06:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398143",
    "user": "https://github.com/jplab"
}
```

<a id='comment:9'></a>
```diff
-        Checking that stacked point needs to be in the interior of
-        ``locus_polyhedron``::
+        The stacked vertex may not satisfy any inequality
+        defining the original polyhedron::
```

This is making it less precise. Why not say:

```diff
+        Taking the stacking vertex too far with the parameter `XXX` may result in a failure to produce the desired (combinatorial type of) polytope.
```

You forgot to indent the sage blocks.

Have you looked at the other places where `.neighbors` is used in the polyhedron folder?



---

archive/issue_comments_398144.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-09-13T06:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398144",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_398145.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jipilab]:\n> {{{\n> #!diff\n> -        Checking that stacked point needs to be in the interior of\n> -        ``locus_polyhedron``::\n> +        The stacked vertex may not satisfy any inequality\n> +        defining the original polyhedron::\n> }}}\n> \n> This is making it less precise. Why not say:\n> \n> \n> ```\n> #!diff\n> +        Taking the stacking vertex too far with the parameter `XXX` may result in a failure to produce the desired (combinatorial type of) polytope.\n> ```\n\n\nActually, I did fix a bug in stacked as well. The set of permittable points should be the relative interior of `locus_polyhedron`. This is not the way it was before. Maybe I should really set up another ticket for the fixes in `stack` and describe this in the ticket.\n\n`position=4` is in the boundary of `locus_polyhedron` and before my fix it returned a wrong combinatorial type.\n> \n> You forgot to indent the sage blocks.\n> \n> Have you looked at the other places where `.neighbors` is used in the polyhedron folder?\n\n\nNot yet. The tests passed and so I figured it's fine. Also `neighbors` returned complete nonsense for non-fulldimensional cases due to index shifting. So if anyone has successfully used it, he or she got really lucky. Nevertheless, I can check.",
    "created_at": "2019-09-13T08:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398145",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>Replying to [comment:9 jipilab]:
> {{{
> #!diff
> -        Checking that stacked point needs to be in the interior of
> -        ``locus_polyhedron``::
> +        The stacked vertex may not satisfy any inequality
> +        defining the original polyhedron::
> }}}
> 
> This is making it less precise. Why not say:
> 
> 
> ```
> #!diff
> +        Taking the stacking vertex too far with the parameter `XXX` may result in a failure to produce the desired (combinatorial type of) polytope.
> ```


Actually, I did fix a bug in stacked as well. The set of permittable points should be the relative interior of `locus_polyhedron`. This is not the way it was before. Maybe I should really set up another ticket for the fixes in `stack` and describe this in the ticket.

`position=4` is in the boundary of `locus_polyhedron` and before my fix it returned a wrong combinatorial type.
> 
> You forgot to indent the sage blocks.
> 
> Have you looked at the other places where `.neighbors` is used in the polyhedron folder?


Not yet. The tests passed and so I figured it's fine. Also `neighbors` returned complete nonsense for non-fulldimensional cases due to index shifting. So if anyone has successfully used it, he or she got really lucky. Nevertheless, I can check.



---

archive/issue_comments_398146.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 gh-kliem]:\n> Replying to [comment:9 jipilab]:\n> > {{{\n> > #!diff\n> > -        Checking that stacked point needs to be in the interior of\n> > -        ``locus_polyhedron``::\n> > +        The stacked vertex may not satisfy any inequality\n> > +        defining the original polyhedron::\n> > }}}\n> > \n> > This is making it less precise. Why not say:\n> > \n> > \n> > ```\n> > #!diff\n> > +        Taking the stacking vertex too far with the parameter `XXX` may result in a failure to produce the desired (combinatorial type of) polytope.\n> > ```\n\n> \n> Actually, I did fix a bug in stacked as well. The set of permittable points should be the relative interior of `locus_polyhedron`. This is not the way it was before. Maybe I should really set up another ticket for the fixes in `stack` and describe this in the ticket.\n\n\nNo, I believe it is fine. This ticket is about the fact that stacking was not working (originally). So I would say that one can fix the bug and adapt the description of the ticket accordingly.\n\n\n> \n> `position=4` is in the boundary of `locus_polyhedron` and before my fix it returned a wrong combinatorial type.\n\n\nOne more reason to mention this in the documentation before this test (how should I know that this is what is tested???).\n\n> > \n> > You forgot to indent the sage blocks.\n> > \n> > Have you looked at the other places where `.neighbors` is used in the polyhedron folder?\n\n> \n> Not yet. The tests passed and so I figured it's fine. \n\n\nExactly, that's my point: just checking the tests is not enough. One should do a grep to see where this function is used _internally_.",
    "created_at": "2019-09-13T10:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398146",
    "user": "https://github.com/jplab"
}
```

<a id='comment:12'></a>Replying to [comment:11 gh-kliem]:
> Replying to [comment:9 jipilab]:
> > {{{
> > #!diff
> > -        Checking that stacked point needs to be in the interior of
> > -        ``locus_polyhedron``::
> > +        The stacked vertex may not satisfy any inequality
> > +        defining the original polyhedron::
> > }}}
> > 
> > This is making it less precise. Why not say:
> > 
> > 
> > ```
> > #!diff
> > +        Taking the stacking vertex too far with the parameter `XXX` may result in a failure to produce the desired (combinatorial type of) polytope.
> > ```

> 
> Actually, I did fix a bug in stacked as well. The set of permittable points should be the relative interior of `locus_polyhedron`. This is not the way it was before. Maybe I should really set up another ticket for the fixes in `stack` and describe this in the ticket.


No, I believe it is fine. This ticket is about the fact that stacking was not working (originally). So I would say that one can fix the bug and adapt the description of the ticket accordingly.


> 
> `position=4` is in the boundary of `locus_polyhedron` and before my fix it returned a wrong combinatorial type.


One more reason to mention this in the documentation before this test (how should I know that this is what is tested???).

> > 
> > You forgot to indent the sage blocks.
> > 
> > Have you looked at the other places where `.neighbors` is used in the polyhedron folder?

> 
> Not yet. The tests passed and so I figured it's fine. 


Exactly, that's my point: just checking the tests is not enough. One should do a grep to see where this function is used _internally_.



---

archive/issue_comments_398147.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-13T19:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398148.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-09-13T19:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398148",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_398149.json:
```json
{
    "body": "<a id='comment:14'></a>New commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[01c5c19](https://git.sagemath.org/sage.git/commit?id=01c5c190ff7ae068fd201c479df6ba8d5a0b3110)|`improved docstring`|\n---\nNew commits:",
    "created_at": "2019-09-13T19:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398149",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[01c5c19](https://git.sagemath.org/sage.git/commit?id=01c5c190ff7ae068fd201c479df6ba8d5a0b3110)|`improved docstring`|
---
New commits:



---

archive/issue_comments_398150.json:
```json
{
    "body": "<a id='comment:16'></a>Two minor things:\n\npermittable -> possible, permitted, allowed\n`position` -> ``position``\n\n\nOnce you fix these and the pyflakes error at line 8112, you can set it to positive review on my behalf.\n\nP.S. Welcome back to work!",
    "created_at": "2019-10-14T09:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398150",
    "user": "https://github.com/jplab"
}
```

<a id='comment:16'></a>Two minor things:

permittable -> possible, permitted, allowed
`position` -> ``position``


Once you fix these and the pyflakes error at line 8112, you can set it to positive review on my behalf.

P.S. Welcome back to work!



---

archive/issue_comments_398151.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-14T09:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398151",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_398152.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-14T10:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398153.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 jipilab]:\n> Two minor things:\n> \n> permittable -> possible, permitted, allowed\n> `position` -> ``position``\n> \n> \n> Once you fix these and the pyflakes error at line 8112, you can set it to positive review on my behalf.\n\n\nI can't even locate that error. I don't know in which line this appears (I don't find a version, where line 8112 could have resulted in this error.)\n> \n> P.S. Welcome back to work!",
    "created_at": "2019-10-14T10:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398153",
    "user": "https://github.com/kliem"
}
```

<a id='comment:18'></a>Replying to [comment:16 jipilab]:
> Two minor things:
> 
> permittable -> possible, permitted, allowed
> `position` -> ``position``
> 
> 
> Once you fix these and the pyflakes error at line 8112, you can set it to positive review on my behalf.


I can't even locate that error. I don't know in which line this appears (I don't find a version, where line 8112 could have resulted in this error.)
> 
> P.S. Welcome back to work!



---

archive/issue_comments_398154.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-14T10:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398154",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_398155.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-15T07:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398156.json:
```json
{
    "body": "<a id='comment:21'></a>I guess this is the case now. I'll put in on positive review.\n\nReplying to [comment:16 jipilab]:\n> Two minor things:\n> \n> permittable -> possible, permitted, allowed\n> `position` -> ``position``\n> \n> \n> Once you fix these and the pyflakes error at line 8112, you can set it to positive review on my behalf.\n> \n> P.S. Welcome back to work!",
    "created_at": "2019-10-21T13:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398156",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>I guess this is the case now. I'll put in on positive review.

Replying to [comment:16 jipilab]:
> Two minor things:
> 
> permittable -> possible, permitted, allowed
> `position` -> ``position``
> 
> 
> Once you fix these and the pyflakes error at line 8112, you can set it to positive review on my behalf.
> 
> P.S. Welcome back to work!



---

archive/issue_comments_398157.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-21T13:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398157",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_071309.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-21T19:00:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28463#event-71309"
}
```



---

archive/issue_comments_398158.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-23T22:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28463#issuecomment-398158",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_071310.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-23T22:58:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28463",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28463#event-71310"
}
```
