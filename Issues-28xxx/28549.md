# Issue 28549: Make it possible to build on WSL

archive/issues_028312.json:
```json
{
    "body": "This ticket is to inform you about how to build sage with the Windows Subsystem for Linux and to provide the necessary changes to make this work. Since this is my first contribution to sage, please let me know if I've overseen something obvious and please be lenient in case I broke some written or unwritten rules.\n\n# Steps to build sage on WSL\nincluding set-up git infrastructure since this is partly different on Windows as well.\n\n## Prerequisites\n* [Install WSL (Ubuntu 18.04 LTS)](https://docs.microsoft.com/en-us/windows/wsl/install-win10)\n\n## Git (run everything in git bash)\n* Clone repository\n* Correct line endings (necessary if global core.autocrlf is set to true):\n  {{{\ngit config --local core.autocrlf false \ngit rm --cached -r .\ngit reset --hard\n}}}\n* Setup remote trac (nessary if you want to contribute)\n  \n  Follow the instructions to set-up the ssh key https://help.github.com/en/articles/working-with-ssh-key-passphrases and then follow http://doc.sagemath.org/html/en/developer/trac.html#trac-authentication-through-ssh and http://doc.sagemath.org/html/en/developer/manual_git.html#chapter-manual-git\n\n```\ngit remote add trac git://trac.sagemath.org/sage.git -t master\ngit remote set-url --push trac git@trac.sagemath.org:sage.git\n```\n* Switch to development branch\n  {{{\ngit checkout develop\n}}}\n\n## Build sage (run everything from Ubuntu bash)\n* Install prerequisites \n  This is a slightly extended version of the [corresponding script for Linux](http://doc.sagemath.org/html/en/installation/source.html#linux-recommended-installation).\n   {{{\nsudo apt-get update\n\nsudo apt-get install binutils pixz gcc g++ gfortran make m4 perl tar git patch openssl libssl-dev libz-dev bc libbz2-dev liblzma-dev libgmp-dev libffi-dev libgf2x-dev libcurl4-openssl-dev curl yasm\nsudo apt-get install gettext libgettextpo-dev\nsudo apt-get install automake pkgconf\n}}}\n* Change into sage folder\n* Set how many cores you want to use for building (important, otherwise it will take ages)\n  {{{\nexport MAKE=\"make -j4\"\n}}}\n\n* Build (there will be errors on the way, so ignore them using the `-k` switch)\n  {{{ \nmake -k\n}}}\n* Test sage\n  {{{\n./sage\n2+2\n}}}\n\n\n# Changes necessary to make this work\nIn order to make the above procedure work, I had to change a few things on the way. I have pushed these changes to the branch `public/wls`.\n* Linux symlinks do not work under Windows. Thus, if you clone the repository the symlinks are replaced by ordinary text files containing the target path of the symlink. To fix this, I replaced the symlinks in `build/pgks/gfortran/` by the respective files in `build/pgks/gcc` and similarily in `build/pgks/python2/` by the respective files in `build/pgks/python3/`. (There is probably a more elegant way to do this)\n* Error\n  {{{ \n  spgk-install should not be marked executable in the build/pkgs directory\n}}}\n   was fixed by changing `build/bin/sage-spkg`. This is a quick hack and probably needs to be fixed properly. The trick used for cygwin does not work since `uname = Linux` when run from WSL.\n* Error \n  {{{\nOSError: [Errno 22] Invalid argument: './src/doc/pari/Programming_in_GP:_other_specific_functions.html'\nopen sage/upstream/giac-X.tar.bz2\n}}}\n   was fixed by changes in `tar_file.py`. This is also a quick hack and needs a better fix, e.g. rename the file to a valid name?\n* Error\n  {{{\nThe headers or library files could not be found for zlib,\na required dependency when compiling Pillow from source.\n\nPlease see the install instructions at:\n   https://pillow.readthedocs.io/en/latest/installation.html\n}}}\n   was fixed by deactivating `zlib` in `pillow/spkg-install`. Note sure if this has any negative side effects.\n\n# Remaining issues\nWith the above changes, the `make` build works in principle. There are a few small issues that needs further improvement.\n* Creating the documentation during `make` or by `./sage --docbuild all html` fails with the errors of the form\n  {{{\n  OSError: WARNING: Unable to fetch /mnt/c/sage/local/share/doc/sage/doctrees/en/reference/algebras/environment.pickle\nThere is a syntax error in your configuration file: invalid syntax (conf.py, line 1)\nBuild finished. The built documents can be found in /mnt/c/sage/local/share/doc/sage/inventory/en/reference/algebras\n}}}\n   I guess, the problem is that `conf.py` in `src\\doc\\en\\reference\\algebras` is a symbolic link.\n* At startup of sage, you get the warning\n  {{{\n/mnt/c/sage/local/lib/python2.7/site-packages/psutil/_pslinux.py:519: RuntimeWarning: 'sin' and 'sout' swap memory stats couldn't be determined and were set to 0 ([Errno 2] No such file or directory: '/proc/vmstat')\n  warnings.warn(msg, RuntimeWarning)\n}}}\n  Probably, there is nothing we can do, since this is a known limitation of WSL: https://github.com/microsoft/WSL/issues/1071\n\nCC:  @embray @slel @dimpase @soehms @pfasante\n\nKeywords: windows, wsl, build, make\n\nReviewer: Tobias Diez\n\nBranch: public/wls\n\nCommit: cd8116ead3b66e949c414bce76e154eddf69e47c\n\nResolution: worksforme\n\nIssue created by migration from https://trac.sagemath.org/ticket/28549\n\n",
    "closed_at": "2020-08-31T15:01:10Z",
    "created_at": "2019-10-02T10:40:02Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make it possible to build on WSL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28549",
    "user": "https://github.com/tobiasdiez"
}
```
This ticket is to inform you about how to build sage with the Windows Subsystem for Linux and to provide the necessary changes to make this work. Since this is my first contribution to sage, please let me know if I've overseen something obvious and please be lenient in case I broke some written or unwritten rules.

# Steps to build sage on WSL
including set-up git infrastructure since this is partly different on Windows as well.

## Prerequisites
* [Install WSL (Ubuntu 18.04 LTS)](https://docs.microsoft.com/en-us/windows/wsl/install-win10)

## Git (run everything in git bash)
* Clone repository
* Correct line endings (necessary if global core.autocrlf is set to true):
  {{{
git config --local core.autocrlf false 
git rm --cached -r .
git reset --hard
}}}
* Setup remote trac (nessary if you want to contribute)
  
  Follow the instructions to set-up the ssh key https://help.github.com/en/articles/working-with-ssh-key-passphrases and then follow http://doc.sagemath.org/html/en/developer/trac.html#trac-authentication-through-ssh and http://doc.sagemath.org/html/en/developer/manual_git.html#chapter-manual-git

```
git remote add trac git://trac.sagemath.org/sage.git -t master
git remote set-url --push trac git@trac.sagemath.org:sage.git
```
* Switch to development branch
  {{{
git checkout develop
}}}

## Build sage (run everything from Ubuntu bash)
* Install prerequisites 
  This is a slightly extended version of the [corresponding script for Linux](http://doc.sagemath.org/html/en/installation/source.html#linux-recommended-installation).
   {{{
sudo apt-get update

sudo apt-get install binutils pixz gcc g++ gfortran make m4 perl tar git patch openssl libssl-dev libz-dev bc libbz2-dev liblzma-dev libgmp-dev libffi-dev libgf2x-dev libcurl4-openssl-dev curl yasm
sudo apt-get install gettext libgettextpo-dev
sudo apt-get install automake pkgconf
}}}
* Change into sage folder
* Set how many cores you want to use for building (important, otherwise it will take ages)
  {{{
export MAKE="make -j4"
}}}

* Build (there will be errors on the way, so ignore them using the `-k` switch)
  {{{ 
make -k
}}}
* Test sage
  {{{
./sage
2+2
}}}


# Changes necessary to make this work
In order to make the above procedure work, I had to change a few things on the way. I have pushed these changes to the branch `public/wls`.
* Linux symlinks do not work under Windows. Thus, if you clone the repository the symlinks are replaced by ordinary text files containing the target path of the symlink. To fix this, I replaced the symlinks in `build/pgks/gfortran/` by the respective files in `build/pgks/gcc` and similarily in `build/pgks/python2/` by the respective files in `build/pgks/python3/`. (There is probably a more elegant way to do this)
* Error
  {{{ 
  spgk-install should not be marked executable in the build/pkgs directory
}}}
   was fixed by changing `build/bin/sage-spkg`. This is a quick hack and probably needs to be fixed properly. The trick used for cygwin does not work since `uname = Linux` when run from WSL.
* Error 
  {{{
OSError: [Errno 22] Invalid argument: './src/doc/pari/Programming_in_GP:_other_specific_functions.html'
open sage/upstream/giac-X.tar.bz2
}}}
   was fixed by changes in `tar_file.py`. This is also a quick hack and needs a better fix, e.g. rename the file to a valid name?
* Error
  {{{
The headers or library files could not be found for zlib,
a required dependency when compiling Pillow from source.

Please see the install instructions at:
   https://pillow.readthedocs.io/en/latest/installation.html
}}}
   was fixed by deactivating `zlib` in `pillow/spkg-install`. Note sure if this has any negative side effects.

# Remaining issues
With the above changes, the `make` build works in principle. There are a few small issues that needs further improvement.
* Creating the documentation during `make` or by `./sage --docbuild all html` fails with the errors of the form
  {{{
  OSError: WARNING: Unable to fetch /mnt/c/sage/local/share/doc/sage/doctrees/en/reference/algebras/environment.pickle
There is a syntax error in your configuration file: invalid syntax (conf.py, line 1)
Build finished. The built documents can be found in /mnt/c/sage/local/share/doc/sage/inventory/en/reference/algebras
}}}
   I guess, the problem is that `conf.py` in `src\doc\en\reference\algebras` is a symbolic link.
* At startup of sage, you get the warning
  {{{
/mnt/c/sage/local/lib/python2.7/site-packages/psutil/_pslinux.py:519: RuntimeWarning: 'sin' and 'sout' swap memory stats couldn't be determined and were set to 0 ([Errno 2] No such file or directory: '/proc/vmstat')
  warnings.warn(msg, RuntimeWarning)
}}}
  Probably, there is nothing we can do, since this is a known limitation of WSL: https://github.com/microsoft/WSL/issues/1071

CC:  @embray @slel @dimpase @soehms @pfasante

Keywords: windows, wsl, build, make

Reviewer: Tobias Diez

Branch: public/wls

Commit: cd8116ead3b66e949c414bce76e154eddf69e47c

Resolution: worksforme

Issue created by migration from https://trac.sagemath.org/ticket/28549





---

archive/issue_comments_425653.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-02T10:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425653",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425654.json:
```json
{
    "body": "<a id='comment:2'></a>Is there anything I need/can do? What is the procedure here (this is my first contribution to sage...)?",
    "created_at": "2019-11-08T14:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425654",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:2'></a>Is there anything I need/can do? What is the procedure here (this is my first contribution to sage...)?



---

archive/issue_events_071625.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-11-24T17:49:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71625"
}
```



---

archive/issue_comments_425655.json:
```json
{
    "body": "<a id='comment:4'></a>Is this for WSL 1 or WSL 2?  Also, my understanding was that symlinks work better now in WSL 2 but I haven't tried it or looked into it in detail.",
    "created_at": "2019-12-13T12:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425655",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>Is this for WSL 1 or WSL 2?  Also, my understanding was that symlinks work better now in WSL 2 but I haven't tried it or looked into it in detail.



---

archive/issue_comments_425656.json:
```json
{
    "body": "<a id='comment:5'></a>It's for WSL 1. As far as I know, WSL 2 is still in preview (or at least requires a insiders build of Windows).\n\nThe problem with the symbolic links could have been caused by the fact that I cloned the repository under Windows, which replaced the symbolic links with text files. It might work if you clone under WSL.",
    "created_at": "2019-12-13T13:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425656",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>It's for WSL 1. As far as I know, WSL 2 is still in preview (or at least requires a insiders build of Windows).

The problem with the symbolic links could have been caused by the fact that I cloned the repository under Windows, which replaced the symbolic links with text files. It might work if you clone under WSL.



---

archive/issue_comments_425657.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 gh-tobiasdiez]: \n> The problem with the symbolic links could have been caused by the fact that I cloned the repository under Windows, which replaced the symbolic links with text files. It might work if you clone under WSL.\n\n\nIndeed, I think any build process for Sage on WSL should be 100% under WSL.  This is likely also the cause of some of the permission problems you noted.",
    "created_at": "2019-12-13T13:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425657",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>Replying to [comment:5 gh-tobiasdiez]: 
> The problem with the symbolic links could have been caused by the fact that I cloned the repository under Windows, which replaced the symbolic links with text files. It might work if you clone under WSL.


Indeed, I think any build process for Sage on WSL should be 100% under WSL.  This is likely also the cause of some of the permission problems you noted.



---

archive/issue_events_071626.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71626"
}
```



---

archive/issue_events_071627.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71627"
}
```



---

archive/issue_comments_425658.json:
```json
{
    "body": "<a id='comment:7'></a>Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425658",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Ticket retargeted after milestone closed



---

archive/issue_comments_425659.json:
```json
{
    "body": "<a id='comment:8'></a>Using git in Windows with `git config --global core.symlinks true` may help. See #29295",
    "created_at": "2020-03-22T15:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425659",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Using git in Windows with `git config --global core.symlinks true` may help. See #29295



---

archive/issue_events_071628.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-17T08:21:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71628"
}
```



---

archive/issue_events_071629.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-17T08:21:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71629"
}
```



---

archive/issue_comments_425660.json:
```json
{
    "body": "<a id='comment:11'></a>I cannot view the branch on trac.\nhttps://github.com/sagemath/sagetrac-mirror/commits/public/wls\n\nand it looks quite outdated.\nRebase?",
    "created_at": "2020-04-17T08:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425660",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>I cannot view the branch on trac.
https://github.com/sagemath/sagetrac-mirror/commits/public/wls

and it looks quite outdated.
Rebase?



---

archive/issue_comments_425661.json:
```json
{
    "body": "<a id='comment:12'></a>It might outdated because the original commits are now already 7 months old. I would appreciate if I could get advice concerning the open points raised above. I don't want to rebase and then have to wait another year to get feedback. (Sorry for the slightly aggressive tone but honestly it wasn't a great experience so far contributing to sage.)",
    "created_at": "2020-04-17T11:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425661",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:12'></a>It might outdated because the original commits are now already 7 months old. I would appreciate if I could get advice concerning the open points raised above. I don't want to rebase and then have to wait another year to get feedback. (Sorry for the slightly aggressive tone but honestly it wasn't a great experience so far contributing to sage.)



---

archive/issue_comments_425662.json:
```json
{
    "body": "<a id='comment:13'></a>I think guidance regarding symlinks and lineendings when checking out on Windows should be added to the Installation Manual / Developer Manual. \n\nWe now have #29513 sage-spkg: Remove check for executable permission on spkg-install.in script templates",
    "created_at": "2020-04-17T15:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425662",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>I think guidance regarding symlinks and lineendings when checking out on Windows should be added to the Installation Manual / Developer Manual. 

We now have #29513 sage-spkg: Remove check for executable permission on spkg-install.in script templates



---

archive/issue_comments_425663.json:
```json
{
    "body": "<a id='comment:14'></a>The commit \"Do not extract files containing a colon in the name\" needs a better solution. Upstream bug report to avoid non-portable file names",
    "created_at": "2020-04-17T15:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425663",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>The commit "Do not extract files containing a colon in the name" needs a better solution. Upstream bug report to avoid non-portable file names



---

archive/issue_comments_425664.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:12 gh-tobiasdiez]:\n> It might outdated because the original commits are now already 7 months old. I would appreciate if I could get advice concerning the open points raised above. \n\n\nTrac notifications by email are not very reliable, unfortunately, so you may have missed comments 6 and 8 above.",
    "created_at": "2020-04-17T15:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425664",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Replying to [comment:12 gh-tobiasdiez]:
> It might outdated because the original commits are now already 7 months old. I would appreciate if I could get advice concerning the open points raised above. 


Trac notifications by email are not very reliable, unfortunately, so you may have missed comments 6 and 8 above.



---

archive/issue_comments_425665.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:14 mkoeppe]:\n> The commit \"Do not extract files containing a colon in the name\" needs a better solution. Upstream bug report to avoid non-portable file names\n\nSee #29521",
    "created_at": "2020-04-17T15:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425665",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:14 mkoeppe]:
> The commit "Do not extract files containing a colon in the name" needs a better solution. Upstream bug report to avoid non-portable file names

See #29521



---

archive/issue_events_071630.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-17T16:05:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71630"
}
```



---

archive/issue_events_071631.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-17T16:05:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71631"
}
```



---

archive/issue_comments_425666.json:
```json
{
    "body": "<a id='comment:18'></a>The zlib problem is likely not specific to WSL at all. Since 9.0 we have implemented lots of portability fixes for various distributions, including Ubuntu.",
    "created_at": "2020-04-17T21:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425666",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>The zlib problem is likely not specific to WSL at all. Since 9.0 we have implemented lots of portability fixes for various distributions, including Ubuntu.



---

archive/issue_comments_425667.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:12 gh-tobiasdiez]:\n>  (Sorry for the slightly aggressive tone but honestly it wasn't a great experience so far contributing to sage.)\n\n\napologies, this reflects the number of active contibutors to \"core\" Sage who use WSL (or Windows in general), unfortunately.\n\nAt least now we have started to test on Windows using [GitHub](GitHub) Actions, so if we managed this with WSL too we would be in a good shape here.",
    "created_at": "2020-04-18T00:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425667",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>Replying to [comment:12 gh-tobiasdiez]:
>  (Sorry for the slightly aggressive tone but honestly it wasn't a great experience so far contributing to sage.)


apologies, this reflects the number of active contibutors to "core" Sage who use WSL (or Windows in general), unfortunately.

At least now we have started to test on Windows using [GitHub](GitHub) Actions, so if we managed this with WSL too we would be in a good shape here.



---

archive/issue_comments_425668.json:
```json
{
    "body": "<a id='comment:20'></a>So here's what we need:\n- #29521 - to fix the colons\n- guidance regarding symlinks and lineendings when checking out on Windows should be added to the Installation Manual / Developer Manual (where git operation is discussed)\n- perhaps a check in configure to reject source trees that have been checked out with a wrong symlinks/lineendings mode. This would also be useful for Cygwin. \n\nI don't think automatic testing on WSL is necessary. WSL1 is really just a stock Linux distribution running on a slightly weird filesystem.",
    "created_at": "2020-04-18T01:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425668",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>So here's what we need:
- #29521 - to fix the colons
- guidance regarding symlinks and lineendings when checking out on Windows should be added to the Installation Manual / Developer Manual (where git operation is discussed)
- perhaps a check in configure to reject source trees that have been checked out with a wrong symlinks/lineendings mode. This would also be useful for Cygwin. 

I don't think automatic testing on WSL is necessary. WSL1 is really just a stock Linux distribution running on a slightly weird filesystem.



---

archive/issue_comments_425669.json:
```json
{
    "body": "<a id='comment:21'></a>So #29521 is done. Any takers for the stuff symlinks and lineendings?",
    "created_at": "2020-04-23T06:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425669",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>So #29521 is done. Any takers for the stuff symlinks and lineendings?



---

archive/issue_comments_425670.json:
```json
{
    "body": "<a id='comment:22'></a>regarding the need to test on WSL, there was a report on an error (off by 1 in some combinatorics) on WSL of a test with method 'bober' in it.\n\nhere:\nhttps://groups.google.com/forum/m/#!search/bober$20wsl/sage-devel/zuPzRgpSw3s\n\n```\nsage: number_of_partitions(241, algorithm='bober')\n114540884553039\nsage: number_of_partitions(241) # this one is correct\n114540884553038\n```",
    "created_at": "2020-04-23T07:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425670",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>regarding the need to test on WSL, there was a report on an error (off by 1 in some combinatorics) on WSL of a test with method 'bober' in it.

here:
https://groups.google.com/forum/m/#!search/bober$20wsl/sage-devel/zuPzRgpSw3s

```
sage: number_of_partitions(241, algorithm='bober')
114540884553039
sage: number_of_partitions(241) # this one is correct
114540884553038
```



---

archive/issue_comments_425671.json:
```json
{
    "body": "<a id='comment:24'></a>I'm astonished about all those complications reported in this ticket. After I had installed the Ubuntu 18.04 app under WSL2, I followed the Sage installation instructions for Ubuntu (using the recently communicated prerequisites). As far as I remember (it's just some weeks ago) there was no larger amount of troubleshooting to do than I usually do under Linux Mint (some LaTeX sty-files missing ...). But I did that below my home directory inside Ubuntu. \n\nWhat has been the reason to clone the sources into the Windows filesystem? My feeling is that most of the trouble reported here comes from that fact.\n\nConcerning the installation of Sage binaries the instructions for Ubuntu work without any trouble, too (I did it under `/opt/`). The most easiest way to have a running Sage under WSL is via `sudo apt-get sagemath`. But this is an older version (8.1). The bug I have reported on\n[sage-devel](https://groups.google.com/forum/#!topic/sage-devel/zuPzRgpSw3s) (see comment 22 above) is reproducible under the stable 9.0 binaries, as well, but not under the `apt` version.\n\n\nGenerally speaking, I am really impressed about the high compatibility with proper Ubuntu. The most annoying thing for me is that you can't use FUSE based mount options like sshfs, encfs .. (and it seems that they don't have a plan to fix that).\n\nBut I think, we should not announce to use Sage under WSL before all doctests are fixed. Here is the list from the log file attached to the sage-devel thread (the first item being the issue from comment 22):\n\n```\nsage -t --warn-long 44.8 src/sage/combinat/partitions.pyx  # 8 doctests failed\nsage -t --warn-long 44.8 src/sage/docs/conf.py  # 1 doctest failed\nsage -t --warn-long 44.8 src/sage/doctest/test.py  # 2 doctests failed\nsage -t --warn-long 44.8 src/sage/libs/glpk/error.pyx  # 1 doctest failed\nsage -t --warn-long 44.8 src/sage/matrix/matrix_mod2_dense.pyx  # Killed due to segmentation fault\nsage -t --warn-long 44.8 src/sage/misc/sagedoc.py  # 4 doctests failed\nsage -t --warn-long 44.8 src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed\nsage -t --warn-long 44.8 src/sage/rings/number_field/number_field_ideal_rel.py  # 1 doctest failed\n```",
    "created_at": "2020-04-24T07:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425671",
    "user": "https://github.com/soehms"
}
```

<a id='comment:24'></a>I'm astonished about all those complications reported in this ticket. After I had installed the Ubuntu 18.04 app under WSL2, I followed the Sage installation instructions for Ubuntu (using the recently communicated prerequisites). As far as I remember (it's just some weeks ago) there was no larger amount of troubleshooting to do than I usually do under Linux Mint (some LaTeX sty-files missing ...). But I did that below my home directory inside Ubuntu. 

What has been the reason to clone the sources into the Windows filesystem? My feeling is that most of the trouble reported here comes from that fact.

Concerning the installation of Sage binaries the instructions for Ubuntu work without any trouble, too (I did it under `/opt/`). The most easiest way to have a running Sage under WSL is via `sudo apt-get sagemath`. But this is an older version (8.1). The bug I have reported on
[sage-devel](https://groups.google.com/forum/#!topic/sage-devel/zuPzRgpSw3s) (see comment 22 above) is reproducible under the stable 9.0 binaries, as well, but not under the `apt` version.


Generally speaking, I am really impressed about the high compatibility with proper Ubuntu. The most annoying thing for me is that you can't use FUSE based mount options like sshfs, encfs .. (and it seems that they don't have a plan to fix that).

But I think, we should not announce to use Sage under WSL before all doctests are fixed. Here is the list from the log file attached to the sage-devel thread (the first item being the issue from comment 22):

```
sage -t --warn-long 44.8 src/sage/combinat/partitions.pyx  # 8 doctests failed
sage -t --warn-long 44.8 src/sage/docs/conf.py  # 1 doctest failed
sage -t --warn-long 44.8 src/sage/doctest/test.py  # 2 doctests failed
sage -t --warn-long 44.8 src/sage/libs/glpk/error.pyx  # 1 doctest failed
sage -t --warn-long 44.8 src/sage/matrix/matrix_mod2_dense.pyx  # Killed due to segmentation fault
sage -t --warn-long 44.8 src/sage/misc/sagedoc.py  # 4 doctests failed
sage -t --warn-long 44.8 src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed
sage -t --warn-long 44.8 src/sage/rings/number_field/number_field_ideal_rel.py  # 1 doctest failed
```



---

archive/issue_comments_425672.json:
```json
{
    "body": "<a id='comment:25'></a>if glpk comes from Ubuntu, then these `libs/glpk/error.pyx` and `numerical/backends/glpk_backend.pyx` are expected failures, due to Sage's patches.",
    "created_at": "2020-04-24T08:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425672",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>if glpk comes from Ubuntu, then these `libs/glpk/error.pyx` and `numerical/backends/glpk_backend.pyx` are expected failures, due to Sage's patches.



---

archive/issue_comments_425673.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks for the feedback.\n\nI think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. Although the file system support of WSL got better over time, transferring or accessing files that are in the Linux system from Windows is still an hassle. \n\nReplying to [comment:8 mkoeppe]:\n> Using git in Windows with `git config --global core.symlinks true` may help. See #29295\n\n\nThat might work.",
    "created_at": "2020-04-25T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425673",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>Thanks for the feedback.

I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. Although the file system support of WSL got better over time, transferring or accessing files that are in the Linux system from Windows is still an hassle. 

Replying to [comment:8 mkoeppe]:
> Using git in Windows with `git config --global core.symlinks true` may help. See #29295


That might work.



---

archive/issue_comments_425674.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 gh-tobiasdiez]:\n> Thanks for the feedback.\n> \n> I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. \n\n\nNeedless to say, running the result of the compilation, debugging, etc. will also happen on WSL.\nIt seems that at best we talk about editing the sources and using git on Windows\nin such a setup.",
    "created_at": "2020-04-25T14:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425674",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>Replying to [comment:26 gh-tobiasdiez]:
> Thanks for the feedback.
> 
> I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. 


Needless to say, running the result of the compilation, debugging, etc. will also happen on WSL.
It seems that at best we talk about editing the sources and using git on Windows
in such a setup.



---

archive/issue_comments_425675.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 gh-tobiasdiez]:\n> Thanks for the feedback.\n> \n> I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. \n\n\nYes, this would be nice and will need some work.\n\n> Although the file system support of WSL got better over time, transferring or accessing files that are in the Linux system from Windows is still an hassle. \n> \n> Replying to [comment:8 mkoeppe]:\n> > Using git in Windows with `git config --global core.symlinks true` may help. See #29295\n\n> \n> That might work.\n\n\nWell, as a first step, would you like to help document what already works for our upcoming 9.1 release?\n\nChanging the Sage build so it works with non-Unix lineendings and restructuring the build so that no symlinks are in the source repository [obviously, not by making copies...] is more work, which won't be ready for the 9.1 release, but would be a valuable contribution.",
    "created_at": "2020-04-25T16:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425675",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Replying to [comment:26 gh-tobiasdiez]:
> Thanks for the feedback.
> 
> I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. 


Yes, this would be nice and will need some work.

> Although the file system support of WSL got better over time, transferring or accessing files that are in the Linux system from Windows is still an hassle. 
> 
> Replying to [comment:8 mkoeppe]:
> > Using git in Windows with `git config --global core.symlinks true` may help. See #29295

> 
> That might work.


Well, as a first step, would you like to help document what already works for our upcoming 9.1 release?

Changing the Sage build so it works with non-Unix lineendings and restructuring the build so that no symlinks are in the source repository [obviously, not by making copies...] is more work, which won't be ready for the 9.1 release, but would be a valuable contribution.



---

archive/issue_comments_425676.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:25 dimpase]:\n> if glpk comes from Ubuntu, then these `libs/glpk/error.pyx` and `numerical/backends/glpk_backend.pyx` are expected failures, due to Sage's patches.\n\nBut at least those tests which lead to mathematical wrong answers should be fixed or marked with a note that they are not validated under WSL.",
    "created_at": "2020-04-25T19:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425676",
    "user": "https://github.com/soehms"
}
```

<a id='comment:29'></a>Replying to [comment:25 dimpase]:
> if glpk comes from Ubuntu, then these `libs/glpk/error.pyx` and `numerical/backends/glpk_backend.pyx` are expected failures, due to Sage's patches.

But at least those tests which lead to mathematical wrong answers should be fixed or marked with a note that they are not validated under WSL.



---

archive/issue_comments_425677.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:26 gh-tobiasdiez]:\n> Thanks for the feedback.\n> \n> I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. Although the file system support of WSL got better over time, transferring or accessing files that are in the Linux system from Windows is still an hassle. \n\n\nDid you try to synchronize directories between WSL and Windows (for example using Unison)?",
    "created_at": "2020-04-25T19:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425677",
    "user": "https://github.com/soehms"
}
```

<a id='comment:30'></a>Replying to [comment:26 gh-tobiasdiez]:
> Thanks for the feedback.
> 
> I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. Although the file system support of WSL got better over time, transferring or accessing files that are in the Linux system from Windows is still an hassle. 


Did you try to synchronize directories between WSL and Windows (for example using Unison)?



---

archive/issue_comments_425678.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:27 dimpase]:\n> Replying to [comment:26 gh-tobiasdiez]:\n> > Thanks for the feedback.\n> > \n> > I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. \n\n> \n> Needless to say, running the result of the compilation, debugging, etc. will also happen on WSL.\n> It seems that at best we talk about editing the sources and using git on Windows\n> in such a setup.\n\nExactly!\n>",
    "created_at": "2020-04-25T19:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425678",
    "user": "https://github.com/soehms"
}
```

<a id='comment:31'></a>Replying to [comment:27 dimpase]:
> Replying to [comment:26 gh-tobiasdiez]:
> > Thanks for the feedback.
> > 
> > I think checking out the code under Windows should be supported. I want to develop under Windows using my normal tool set, and only run the compilation under Linux. 

> 
> Needless to say, running the result of the compilation, debugging, etc. will also happen on WSL.
> It seems that at best we talk about editing the sources and using git on Windows
> in such a setup.

Exactly!
>



---

archive/issue_comments_425679.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:29 soehms]:\n> But at least those tests which lead to mathematical wrong answers should be fixed or marked with a note that they are not validated under WSL.\n> \nDefinitely. The failure with `number_of_partitions(241, algorithm='bober')` should become a separate ticket. Is this already a doctest?",
    "created_at": "2020-04-25T21:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425679",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Replying to [comment:29 soehms]:
> But at least those tests which lead to mathematical wrong answers should be fixed or marked with a note that they are not validated under WSL.
> 
Definitely. The failure with `number_of_partitions(241, algorithm='bober')` should become a separate ticket. Is this already a doctest?



---

archive/issue_comments_425680.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 mkoeppe]:\n> Is this already a doctest?\n\nYes, see the first line of the list shown in comment 24. I've just simplified that to it's first occurence which is reproducible 241 on both 9.1.rc0 and on stable 9.0 installed from binaries. \n\nBut, I have to correct my statement from comment 24, that the bug would not occur on version 8.1. That is not true, but here, 241 it not in the list of failures (see ticket #29600 I've created for that issue).",
    "created_at": "2020-04-27T06:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425680",
    "user": "https://github.com/soehms"
}
```

<a id='comment:33'></a>Replying to [comment:32 mkoeppe]:
> Is this already a doctest?

Yes, see the first line of the list shown in comment 24. I've just simplified that to it's first occurence which is reproducible 241 on both 9.1.rc0 and on stable 9.0 installed from binaries. 

But, I have to correct my statement from comment 24, that the bug would not occur on version 8.1. That is not true, but here, 241 it not in the list of failures (see ticket #29600 I've created for that issue).



---

archive/issue_comments_425681.json:
```json
{
    "body": "<a id='comment:34'></a>Friedrich, I hope you had a good start at Bosch this month and time enough left to contribute your experience on doing Sage under WSL.",
    "created_at": "2020-04-27T06:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425681",
    "user": "https://github.com/soehms"
}
```

<a id='comment:34'></a>Friedrich, I hope you had a good start at Bosch this month and time enough left to contribute your experience on doing Sage under WSL.



---

archive/issue_comments_425682.json:
```json
{
    "body": "<a id='comment:35'></a>Thanks, Sebastian!\n\nI think I also used WSL2 when building Sage in it. At least my experience was as yours: not more problems than under a normal Ubuntu. (However I also did everything within the WSL and tried to leave out Windows as much as possible.) So not sure how much I can help here..\n\nJust for reference: my google-groups post re my WSL try is here https://groups.google.com/forum/#!searchin/sage-devel/wsl|sort:date/sage-devel/WoEWxYmwQnI/aeqy6YxoDQAJ",
    "created_at": "2020-04-27T18:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425682",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:35'></a>Thanks, Sebastian!

I think I also used WSL2 when building Sage in it. At least my experience was as yours: not more problems than under a normal Ubuntu. (However I also did everything within the WSL and tried to leave out Windows as much as possible.) So not sure how much I can help here..

Just for reference: my google-groups post re my WSL try is here https://groups.google.com/forum/#!searchin/sage-devel/wsl|sort:date/sage-devel/WoEWxYmwQnI/aeqy6YxoDQAJ



---

archive/issue_comments_425683.json:
```json
{
    "body": "<a id='comment:36'></a>Let's close this ticket in favor of #25206 (Update README, installation manual and developer's guide on Windows (WSL and Cygwin))",
    "created_at": "2020-04-27T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425683",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>Let's close this ticket in favor of #25206 (Update README, installation manual and developer's guide on Windows (WSL and Cygwin))



---

archive/issue_comments_425684.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-27T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425684",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_071632.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-27T18:15:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71632"
}
```



---

archive/issue_events_071633.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-27T18:15:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71633"
}
```



---

archive/issue_comments_425685.json:
```json
{
    "body": "Changing keywords from \"windows, wls, build, make\" to \"windows, wsl, build, make\".",
    "created_at": "2020-06-25T19:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425685",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "windows, wls, build, make" to "windows, wsl, build, make".



---

archive/issue_comments_425686.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-23T19:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425686",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_425687.json:
```json
{
    "body": "<a id='comment:40'></a>I'm -1 on removing symlinks from the repository just to support git checkout on Windows (which does support symlinks in WSL).  If you want to develop Sage on Windows I think you should also use git through WSL and not using the native Windows git.  Same goes when using Cygwin (where this works fine).",
    "created_at": "2020-08-31T13:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425687",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>I'm -1 on removing symlinks from the repository just to support git checkout on Windows (which does support symlinks in WSL).  If you want to develop Sage on Windows I think you should also use git through WSL and not using the native Windows git.  Same goes when using Cygwin (where this works fine).



---

archive/issue_comments_425688.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-08-31T13:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425688",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_425689.json:
```json
{
    "body": "<a id='comment:41'></a>\n```diff\n\ndiff --git a/build/sage_bootstrap/package.py b/build/sage_bootstrap/package.py\nindex aff9212..3ee6c6a 100644\n--- a/build/sage_bootstrap/package.py\n+++ b/build/sage_bootstrap/package.py\n@@ -229,9 +229,11 @@ class Package(object):\n         self.__md5 = result.get('md5', None)\n         self.__sha1 = result.get('sha1', None)\n         self.__cksum = result.get('cksum', None)\n-        self.__tarball_pattern = result['tarball']\n+        self.__tarball_pattern = result.get('tarball', \"\")\n         # Name of the directory containing the checksums.ini file\n         self.__tarball_package_name = os.path.realpath(checksums_ini).split(os.sep)[-2]\n+        if not result.get('tarball'):\n+            log.warn(\"Could not find checksum in %s\" % checksums_ini)\n```\n\nThis can be written just `result.get('tarball')`, without specifying a default.  In this case the default is already `None`.  Then below you can write `if not self.__tarball_pattern:`.\n\nOut of curiosity though why would this happen?  Shouldn't this always be here?  And why an explicit check for `'tarball'` and not for the other required fields?",
    "created_at": "2020-08-31T13:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425689",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>
```diff

diff --git a/build/sage_bootstrap/package.py b/build/sage_bootstrap/package.py
index aff9212..3ee6c6a 100644
--- a/build/sage_bootstrap/package.py
+++ b/build/sage_bootstrap/package.py
@@ -229,9 +229,11 @@ class Package(object):
         self.__md5 = result.get('md5', None)
         self.__sha1 = result.get('sha1', None)
         self.__cksum = result.get('cksum', None)
-        self.__tarball_pattern = result['tarball']
+        self.__tarball_pattern = result.get('tarball', "")
         # Name of the directory containing the checksums.ini file
         self.__tarball_package_name = os.path.realpath(checksums_ini).split(os.sep)[-2]
+        if not result.get('tarball'):
+            log.warn("Could not find checksum in %s" % checksums_ini)
```

This can be written just `result.get('tarball')`, without specifying a default.  In this case the default is already `None`.  Then below you can write `if not self.__tarball_pattern:`.

Out of curiosity though why would this happen?  Shouldn't this always be here?  And why an explicit check for `'tarball'` and not for the other required fields?



---

archive/issue_comments_425690.json:
```json
{
    "body": "<a id='comment:42'></a>\n```diff\n\ndiff --git a/build/sage_bootstrap/uncompress/tar_file.py b/build/sage_bootstrap/uncompress/tar_file.py\nindex cf707e7..b6d8dc9 100644\n--- a/build/sage_bootstrap/uncompress/tar_file.py\n+++ b/build/sage_bootstrap/uncompress/tar_file.py\n@@ -116,6 +116,9 @@ class SageBaseTarFile(tarfile.TarFile):\n             The additional ``**kwargs`` are for Python 2/3 compatibility, since\n             different versions of this method accept additional arguments.\n         \"\"\"\n+        if \":\" in targetpath:\n+            return\n+\n         old_umask = os.umask(self.umask)\n         try:\n             super(SageBaseTarFile, self)._extract_member(tarinfo, targetpath,\n```\n\nThis check is overly broad since this will work on any POSIX system (and should work on WSL too but I understand it's presently a limitation with the NTFS filesystem).\n\nInstead perhaps it should try extracting the file anyways but properly handle whatever exception occurs when trying to extract it on WSL, and produce a warning as well.",
    "created_at": "2020-08-31T13:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425690",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>
```diff

diff --git a/build/sage_bootstrap/uncompress/tar_file.py b/build/sage_bootstrap/uncompress/tar_file.py
index cf707e7..b6d8dc9 100644
--- a/build/sage_bootstrap/uncompress/tar_file.py
+++ b/build/sage_bootstrap/uncompress/tar_file.py
@@ -116,6 +116,9 @@ class SageBaseTarFile(tarfile.TarFile):
             The additional ``**kwargs`` are for Python 2/3 compatibility, since
             different versions of this method accept additional arguments.
         """
+        if ":" in targetpath:
+            return
+
         old_umask = os.umask(self.umask)
         try:
             super(SageBaseTarFile, self)._extract_member(tarinfo, targetpath,
```

This check is overly broad since this will work on any POSIX system (and should work on WSL too but I understand it's presently a limitation with the NTFS filesystem).

Instead perhaps it should try extracting the file anyways but properly handle whatever exception occurs when trying to extract it on WSL, and produce a warning as well.



---

archive/issue_comments_425691.json:
```json
{
    "body": "<a id='comment:43'></a>This is a laudable effort and I want to support it, but I think as-is it's making too many changes to support this one one build environment, to the detriment of all other build environments (especially the removal of symlinks).  I think some of the git-related problems also stem from mixing native Windows and WSL gits, but please correct me if I'm wrong on that.  I haven't tried WSL since WSL2 came out some I'm not completely versed in what limitations exist or not (but I'm quite sure I recall it supporting symlinks just fine).\n\nI don't have access to a fast Windows machine right now, but when I get back to my office I will, and then I can try to help with this.",
    "created_at": "2020-08-31T13:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425691",
    "user": "https://github.com/embray"
}
```

<a id='comment:43'></a>This is a laudable effort and I want to support it, but I think as-is it's making too many changes to support this one one build environment, to the detriment of all other build environments (especially the removal of symlinks).  I think some of the git-related problems also stem from mixing native Windows and WSL gits, but please correct me if I'm wrong on that.  I haven't tried WSL since WSL2 came out some I'm not completely versed in what limitations exist or not (but I'm quite sure I recall it supporting symlinks just fine).

I don't have access to a fast Windows machine right now, but when I get back to my office I will, and then I can try to help with this.



---

archive/issue_comments_425692.json:
```json
{
    "body": "<a id='comment:44'></a>Note the milestone on this ticket...",
    "created_at": "2020-08-31T13:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425692",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>Note the milestone on this ticket...



---

archive/issue_comments_425693.json:
```json
{
    "body": "<a id='comment:45'></a>D'oh.  Sorry for the noise.  Regardless, it looks like there might have been some useful things in here?  Or is the colon-in-filename issue resolved now?",
    "created_at": "2020-08-31T14:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425693",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>D'oh.  Sorry for the noise.  Regardless, it looks like there might have been some useful things in here?  Or is the colon-in-filename issue resolved now?



---

archive/issue_comments_425694.json:
```json
{
    "body": "<a id='comment:46'></a>Yes, it's all done, see for example comment 21.",
    "created_at": "2020-08-31T14:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425694",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Yes, it's all done, see for example comment 21.



---

archive/issue_comments_425695.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-08-31T14:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425695",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_425696.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2020-08-31T15:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425696",
    "user": "https://github.com/embray"
}
```

Resolution: worksforme



---

archive/issue_events_071634.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-08-31T15:01:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28549#event-71634"
}
```



---

archive/issue_comments_425697.json:
```json
{
    "body": "<a id='comment:48'></a>Thanks embray for the review. This issue is indeed somewhat old, I've described how to set up a working build envirnmont using WSL here: #25206#comment:63",
    "created_at": "2020-08-31T20:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28549#issuecomment-425697",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:48'></a>Thanks embray for the review. This issue is indeed somewhat old, I've described how to set up a working build envirnmont using WSL here: #25206#comment:63
