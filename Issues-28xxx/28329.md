# Issue 28329: Suppress warnings from failed psutil statistics collection

archive/issues_028092.json:
```json
{
    "body": "I see this every time I start [SageMath](SageMath):\n\n```\n/home/mjo/src/sage.git/local/lib/python2.7/site-packages/psutil/_pslinux.py:489: RuntimeWarning: 'sin' and 'sout' swap memory stats couldn't be determined and were set to 0\n  warnings.warn(msg, RuntimeWarning)\nsage: \n```\n\nThe warning is displayed when psutil can't gather swap statistics, which in turn happens because my /proc/vmstat pseudo-file is missing \"pswpin\" and \"pswpout\" lines. (Why? Who knows.)\n\nWe don't need those statistics, however, so it should be possible to hide the warnings.\n\nCC:  @embray @jdemeyer\n\nBranch/Commit: 7d6f0aa1714620de4b1c45c27e46e71d316f75bb\n\nReviewer: Dima Pasechnik, Markus Wageringel\n\nAuthor: Michael Orlitzky\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28329\n\n",
    "closed_at": "2019-12-11T21:46:28Z",
    "created_at": "2019-08-06T21:18:38Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Suppress warnings from failed psutil statistics collection",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28329",
    "user": "https://github.com/orlitzky"
}
```
I see this every time I start [SageMath](SageMath):

```
/home/mjo/src/sage.git/local/lib/python2.7/site-packages/psutil/_pslinux.py:489: RuntimeWarning: 'sin' and 'sout' swap memory stats couldn't be determined and were set to 0
  warnings.warn(msg, RuntimeWarning)
sage: 
```

The warning is displayed when psutil can't gather swap statistics, which in turn happens because my /proc/vmstat pseudo-file is missing "pswpin" and "pswpout" lines. (Why? Who knows.)

We don't need those statistics, however, so it should be possible to hide the warnings.

CC:  @embray @jdemeyer

Branch/Commit: 7d6f0aa1714620de4b1c45c27e46e71d316f75bb

Reviewer: Dima Pasechnik, Markus Wageringel

Author: Michael Orlitzky

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28329





---

archive/issue_comments_542703.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-06T21:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542703",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_542704.json:
```json
{
    "body": "Changing commit from \"\" to \"d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a\"",
    "created_at": "2019-08-06T21:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542704",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "" to "d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a"



---

archive/issue_comments_542705.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mjo/ticket/28329\"",
    "created_at": "2019-08-06T21:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542705",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "" to "u/mjo/ticket/28329"



---

archive/issue_comments_542706.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Orlitzky\"",
    "created_at": "2019-08-06T21:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542706",
    "user": "https://github.com/orlitzky"
}
```

Changing author from "" to "Michael Orlitzky"



---

archive/issue_comments_542707.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[d93f0c7](https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a)|`Trac #28329: suppress warnings from failed swap statistics collection.`|",
    "created_at": "2019-08-06T21:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542707",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[d93f0c7](https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a)|`Trac #28329: suppress warnings from failed swap statistics collection.`|



---

archive/issue_comments_542708.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[6192e54](https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348)|`Trac #28329: suppress warnings from failed swap statistics collection.`|",
    "created_at": "2019-08-25T16:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[6192e54](https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348)|`Trac #28329: suppress warnings from failed swap statistics collection.`|



---

archive/issue_comments_542709.json:
```json
{
    "body": "Changing commit from \"d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a\" to \"6192e54fe6894b5c444e1a2cb7d0adeec1d94348\"",
    "created_at": "2019-08-25T16:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a" to "6192e54fe6894b5c444e1a2cb7d0adeec1d94348"



---

archive/issue_comments_542710.json:
```json
{
    "body": "<a id='comment:3'></a>\nI figured it out. Those two vmstat entries are missing if `CONFIG_VM_EVENT_COUNTERS` is unset in your kernel. Force-pushed with an updated commit message, and CCing the two people who look like the bosses of psutil.",
    "created_at": "2019-08-25T16:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542710",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>
I figured it out. Those two vmstat entries are missing if `CONFIG_VM_EVENT_COUNTERS` is unset in your kernel. Force-pushed with an updated commit message, and CCing the two people who look like the bosses of psutil.



---

archive/issue_events_087943.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T09:41:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28329#event-87943"
}
```



---

archive/issue_comments_542711.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks good to me, I tested this on Linux. \n\nOur psutil is old, due to its not ported to cygwin, so have have a patch, etc...",
    "created_at": "2019-12-08T09:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542711",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Looks good to me, I tested this on Linux. 

Our psutil is old, due to its not ported to cygwin, so have have a patch, etc...



---

archive/issue_comments_542712.json:
```json
{
    "body": "<a id='comment:6'></a>\nrebased over latest beta\n\n---\nNew commits:\n|                                                                                                                                          |                                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[f587997](https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63)|`Trac #28329: suppress warnings from failed swap statistics collection.`|",
    "created_at": "2019-12-08T09:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542712",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
rebased over latest beta

---
New commits:
|                                                                                                                                          |                                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[f587997](https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63)|`Trac #28329: suppress warnings from failed swap statistics collection.`|



---

archive/issue_comments_542713.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/28329\" to \"public/ticket/28329\"",
    "created_at": "2019-12-08T09:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542713",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "u/mjo/ticket/28329" to "public/ticket/28329"



---

archive/issue_comments_542714.json:
```json
{
    "body": "Changing commit from \"6192e54fe6894b5c444e1a2cb7d0adeec1d94348\" to \"f5879972ee564661fff42b13e67b11d7b8242a63\"",
    "created_at": "2019-12-08T09:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542714",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "6192e54fe6894b5c444e1a2cb7d0adeec1d94348" to "f5879972ee564661fff42b13e67b11d7b8242a63"



---

archive/issue_comments_542715.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [dimpase](#comment%3A4):\n> **Cc** embray added; ebray removed\n\n\nDerp, thanks Dima.",
    "created_at": "2019-12-08T13:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542715",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>
Replying to [dimpase](#comment%3A4):
> **Cc** embray added; ebray removed


Derp, thanks Dima.



---

archive/issue_comments_542716.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-08T17:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542716",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_542717.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2019-12-08T17:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542717",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_542718.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM, also tested on OSX 10.13. Actually, unless `warnings` is pretty much broken on a platform, it should be OK. So I brave to give it a positive review.",
    "created_at": "2019-12-08T17:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542718",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
LGTM, also tested on OSX 10.13. Actually, unless `warnings` is pretty much broken on a platform, it should be OK. So I brave to give it a positive review.



---

archive/issue_comments_542719.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.\n\n```\nFile \"src/sage/groups/matrix_gps/homset.py\", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset\nFailed example:\n    is_MatrixGroupHomset(M)\nExpected:\n    True\nGot:\n    ...\n    DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.\n    See https://trac.sagemath.org/25444 for details.\n    True\n```",
    "created_at": "2019-12-08T20:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542719",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:9'></a>
The patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.

```
File "src/sage/groups/matrix_gps/homset.py", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset
Failed example:
    is_MatrixGroupHomset(M)
Expected:
    True
Got:
    ...
    DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.
    See https://trac.sagemath.org/25444 for details.
    True
```



---

archive/issue_comments_542720.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [gh-mwageringel](#comment%3A9):\n> The patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.\n> \n> \n> ```\n> File \"src/sage/groups/matrix_gps/homset.py\", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset\n> Failed example:\n>     is_MatrixGroupHomset(M)\n> Expected:\n>     True\n> Got:\n>     ...\n>     DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.\n>     See https://trac.sagemath.org/25444 for details.\n>     True\n> ```\n\n\nCf #25444#comment:34\n\nI cannot imagine that this ticket has anything to do with that...",
    "created_at": "2019-12-08T20:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542720",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
Replying to [gh-mwageringel](#comment%3A9):
> The patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.
> 
> 
> ```
> File "src/sage/groups/matrix_gps/homset.py", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset
> Failed example:
>     is_MatrixGroupHomset(M)
> Expected:
>     True
> Got:
>     ...
>     DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.
>     See https://trac.sagemath.org/25444 for details.
>     True
> ```


Cf #25444#comment:34

I cannot imagine that this ticket has anything to do with that...



---

archive/issue_comments_542721.json:
```json
{
    "body": "<a id='comment:11'></a>\nbut apparently it does... hmm...",
    "created_at": "2019-12-08T20:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542721",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
but apparently it does... hmm...



---

archive/issue_comments_542722.json:
```json
{
    "body": "<a id='comment:12'></a>\nthe only possible reason seems to be that the state is modified by `warnings.simplefilter(\"ignore\")` and kept that way, or some other side effect happens...",
    "created_at": "2019-12-08T20:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542722",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
the only possible reason seems to be that the state is modified by `warnings.simplefilter("ignore")` and kept that way, or some other side effect happens...



---

archive/issue_comments_542723.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-12-08T20:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542723",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_542724.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A12):\n> the only possible reason seems to be that the state is modified by `warnings.simplefilter(\"ignore\")` and kept that way, or some other side effect happens...\n\n\nIndeed, if I understand correctly, according to [ticket:24755#comment:7], this seems to be the case and it is probably harmless:\n\n>> This also explained why we get erratic behavior w.r.t. warnings in the Sage doctests.  Although there aren't many cases directly in the doctests where we directly manipulate the warnings filter, there are at least a few (and probably more cases where we do so indirectly).  So every time that happens it resets whether a warning has been displayed =_=",
    "created_at": "2019-12-08T20:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542724",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A12):
> the only possible reason seems to be that the state is modified by `warnings.simplefilter("ignore")` and kept that way, or some other side effect happens...


Indeed, if I understand correctly, according to [ticket:24755#comment:7], this seems to be the case and it is probably harmless:

>> This also explained why we get erratic behavior w.r.t. warnings in the Sage doctests.  Although there aren't many cases directly in the doctests where we directly manipulate the warnings filter, there are at least a few (and probably more cases where we do so indirectly).  So every time that happens it resets whether a warning has been displayed =_=



---

archive/issue_comments_542725.json:
```json
{
    "body": "<a id='comment:15'></a>\nI just read the doc :-)\nhttps://docs.python.org/3/library/warnings.html\n\n```\nNote: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n```",
    "created_at": "2019-12-08T20:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542725",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
I just read the doc :-)
https://docs.python.org/3/library/warnings.html

```
Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
```



---

archive/issue_comments_542726.json:
```json
{
    "body": "<a id='comment:16'></a>\nJFC, what a time to be alive =)\n\nThanks for catching that, I'll fix it in a different way.",
    "created_at": "2019-12-08T21:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542726",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:16'></a>
JFC, what a time to be alive =)

Thanks for catching that, I'll fix it in a different way.



---

archive/issue_comments_542727.json:
```json
{
    "body": "<a id='comment:17'></a>\nBut, isn't the deprecation message in[comment:9](#comment%3A9) actually **correct** ?\n\nI.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?",
    "created_at": "2019-12-08T22:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542727",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
But, isn't the deprecation message in[comment:9](#comment%3A9) actually **correct** ?

I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?



---

archive/issue_comments_542728.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [dimpase](#comment%3A17):\n> But, isn't the deprecation message in[comment:9](#comment%3A9) actually **correct** ?\n> \n> I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?\n\n\nYes, it looks to me like that doctest should have been throwing a warning all along.\n\nNevertheless, I should be more careful when poking global state.",
    "created_at": "2019-12-08T22:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542728",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'></a>
Replying to [dimpase](#comment%3A17):
> But, isn't the deprecation message in[comment:9](#comment%3A9) actually **correct** ?
> 
> I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?


Yes, it looks to me like that doctest should have been throwing a warning all along.

Nevertheless, I should be more careful when poking global state.



---

archive/issue_comments_542729.json:
```json
{
    "body": "<a id='comment:19'></a>\nLet's see what goes wrong this time...\n\n---\nNew commits:\n|                                                                                                                                          |                                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[7d6f0aa](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)|`Trac #28329: suppress warnings from failed swap statistics collection.`|",
    "created_at": "2019-12-09T02:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542729",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'></a>
Let's see what goes wrong this time...

---
New commits:
|                                                                                                                                          |                                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[7d6f0aa](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)|`Trac #28329: suppress warnings from failed swap statistics collection.`|



---

archive/issue_comments_542730.json:
```json
{
    "body": "Changing commit from \"f5879972ee564661fff42b13e67b11d7b8242a63\" to \"7d6f0aa1714620de4b1c45c27e46e71d316f75bb\"",
    "created_at": "2019-12-09T02:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542730",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "f5879972ee564661fff42b13e67b11d7b8242a63" to "7d6f0aa1714620de4b1c45c27e46e71d316f75bb"



---

archive/issue_comments_542731.json:
```json
{
    "body": "Changing branch from \"public/ticket/28329\" to \"u/mjo/ticket/28329\"",
    "created_at": "2019-12-09T02:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542731",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "public/ticket/28329" to "u/mjo/ticket/28329"



---

archive/issue_comments_542732.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-09T02:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542732",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_542733.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-09T10:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542733",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_542734.json:
```json
{
    "body": "Changing reviewer from \"Dima Pasechnik\" to \"Dima Pasechnik, Markus Wageringel\"",
    "created_at": "2019-12-09T10:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542734",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Dima Pasechnik" to "Dima Pasechnik, Markus Wageringel"



---

archive/issue_comments_542735.json:
```json
{
    "body": "<a id='comment:20'></a>\nOK.",
    "created_at": "2019-12-09T10:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542735",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
OK.



---

archive/issue_comments_542736.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [dimpase](#comment%3A15):\n> I just read the doc :-)\n> https://docs.python.org/3/library/warnings.html\n> \n> ```\n> Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n> ```\n\n\nFor the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.",
    "created_at": "2019-12-09T10:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542736",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Replying to [dimpase](#comment%3A15):
> I just read the doc :-)
> https://docs.python.org/3/library/warnings.html
> 
> ```
> Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
> ```


For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.



---

archive/issue_comments_542737.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [mjo](#comment%3A18):\n> Replying to [dimpase](#comment%3A17):\n> > But, isn't the deprecation message in[comment:9](#comment%3A9) actually **correct** ?\n> > \n> > I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?\n  \n> \n> Yes, it looks to me like that doctest should have been throwing a warning all along.\n\n\nYes and no.  The way Sage's doctest runner handles warnings is actually broken and a bit arbitrary, in part due to #25444#comment:34\n\nIf the warning had already been displayed once in the course of testing a single module, it *should not* be displayed again while testing that same module.  But due to that bug in the warnings module, the warning state can get reset and be displayed again when it shouldn't be.",
    "created_at": "2019-12-09T10:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542737",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
Replying to [mjo](#comment%3A18):
> Replying to [dimpase](#comment%3A17):
> > But, isn't the deprecation message in[comment:9](#comment%3A9) actually **correct** ?
> > 
> > I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?
  
> 
> Yes, it looks to me like that doctest should have been throwing a warning all along.


Yes and no.  The way Sage's doctest runner handles warnings is actually broken and a bit arbitrary, in part due to #25444#comment:34

If the warning had already been displayed once in the course of testing a single module, it *should not* be displayed again while testing that same module.  But due to that bug in the warnings module, the warning state can get reset and be displayed again when it shouldn't be.



---

archive/issue_comments_542738.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [embray](#comment%3A21):\n> Replying to [dimpase](#comment%3A15):\n> > I just read the doc :-)\n> > https://docs.python.org/3/library/warnings.html\n> > \n> > ```\n> > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n> > ```\n\n> \n> For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.\n\n\nwell, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)",
    "created_at": "2019-12-09T10:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542738",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
Replying to [embray](#comment%3A21):
> Replying to [dimpase](#comment%3A15):
> > I just read the doc :-)
> > https://docs.python.org/3/library/warnings.html
> > 
> > ```
> > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
> > ```

> 
> For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.


well, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)



---

archive/issue_comments_542739.json:
```json
{
    "body": "<a id='comment:24'></a>\nMy own ptestlong more or less passed, with only some failures in glpk that are probably due to using the system copy instead of the bundled one. The failures don't involve warnings, anyway.\n\nReplying to [embray](#comment%3A22):\n> If the warning had already been displayed once in the course of testing a single module, it should not be displayed again while testing that same module.\n\n\nThere's only one test in that module, and the module only does one thing. I still think it should be displayed, but I'm not sure it's worth investigating if there are bigger known problems with warnings in doctests. With the new approach, we can at least be reasonably certain I haven't made anything worse.\n\nWhile the doctests may not be threaded, sage is a library, and we don't know what client code is doing with it -- so the safer the better.",
    "created_at": "2019-12-09T14:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542739",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:24'></a>
My own ptestlong more or less passed, with only some failures in glpk that are probably due to using the system copy instead of the bundled one. The failures don't involve warnings, anyway.

Replying to [embray](#comment%3A22):
> If the warning had already been displayed once in the course of testing a single module, it should not be displayed again while testing that same module.


There's only one test in that module, and the module only does one thing. I still think it should be displayed, but I'm not sure it's worth investigating if there are bigger known problems with warnings in doctests. With the new approach, we can at least be reasonably certain I haven't made anything worse.

While the doctests may not be threaded, sage is a library, and we don't know what client code is doing with it -- so the safer the better.



---

archive/issue_comments_542740.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [dimpase](#comment%3A23):\n> Replying to [embray](#comment%3A21):\n> > Replying to [dimpase](#comment%3A15):\n> > > I just read the doc :-)\n> > > https://docs.python.org/3/library/warnings.html\n> > > \n> > > ```\n> > > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n> > > ```\n\n> > \n> > For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.\n\n> \n> well, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)\n> \n\nThat only affects the REPL; in the tests there are only one thread running.",
    "created_at": "2019-12-09T16:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542740",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Replying to [dimpase](#comment%3A23):
> Replying to [embray](#comment%3A21):
> > Replying to [dimpase](#comment%3A15):
> > > I just read the doc :-)
> > > https://docs.python.org/3/library/warnings.html
> > > 
> > > ```
> > > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
> > > ```

> > 
> > For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.

> 
> well, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)
> 

That only affects the REPL; in the tests there are only one thread running.



---

archive/issue_events_087944.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-11T21:46:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28329#event-87944"
}
```



---

archive/issue_comments_542741.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-11T21:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542741",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_542742.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/28329\" to \"7d6f0aa1714620de4b1c45c27e46e71d316f75bb\"",
    "created_at": "2019-12-11T21:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28329#issuecomment-542742",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mjo/ticket/28329" to "7d6f0aa1714620de4b1c45c27e46e71d316f75bb"
