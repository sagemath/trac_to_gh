# Issue 28329: Suppress warnings from failed psutil statistics collection

archive/issues_028092.json:
```json
{
    "assignees": [],
    "body": "I see this every time I start [SageMath](../wiki/SageMath):\n\n```\n/home/mjo/src/sage.git/local/lib/python2.7/site-packages/psutil/_pslinux.py:489: RuntimeWarning: 'sin' and 'sout' swap memory stats couldn't be determined and were set to 0\n  warnings.warn(msg, RuntimeWarning)\nsage: \n```\n\nThe warning is displayed when psutil can't gather swap statistics, which in turn happens because my /proc/vmstat pseudo-file is missing \"pswpin\" and \"pswpout\" lines. (Why? Who knows.)\n\nWe don't need those statistics, however, so it should be possible to hide the warnings.\n\nCC:  @embray @jdemeyer\n\nComponent: **misc**\n\nAuthor: **Michael Orlitzky**\n\nBranch/Commit: **[`7d6f0aa`](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)**\n\nReviewer: **Dima Pasechnik, Markus Wageringel**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28329_\n\n",
    "closed_at": "2019-12-11T21:46:28Z",
    "created_at": "2019-08-06T21:18:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Suppress warnings from failed psutil statistics collection",
    "type": "issue",
    "updated_at": "2019-12-11T21:46:28Z",
    "url": "https://github.com/sagemath/sage/issues/28329",
    "user": "https://github.com/orlitzky"
}
```
I see this every time I start [SageMath](../wiki/SageMath):

```
/home/mjo/src/sage.git/local/lib/python2.7/site-packages/psutil/_pslinux.py:489: RuntimeWarning: 'sin' and 'sout' swap memory stats couldn't be determined and were set to 0
  warnings.warn(msg, RuntimeWarning)
sage: 
```

The warning is displayed when psutil can't gather swap statistics, which in turn happens because my /proc/vmstat pseudo-file is missing "pswpin" and "pswpout" lines. (Why? Who knows.)

We don't need those statistics, however, so it should be possible to hide the warnings.

CC:  @embray @jdemeyer

Component: **misc**

Author: **Michael Orlitzky**

Branch/Commit: **[`7d6f0aa`](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)**

Reviewer: **Dima Pasechnik, Markus Wageringel**

_Issue created by migration from https://trac.sagemath.org/ticket/28329_





---

archive/issue_events_385806.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2019-08-06T21:18:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385806"
}
```



---

archive/issue_events_385807.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2019-08-06T21:18:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385807"
}
```



---

archive/issue_events_385808.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2019-08-06T21:18:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385808"
}
```



---

archive/issue_events_385809.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2019-08-06T21:20:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385809"
}
```



---

archive/issue_comments_441374.json:
```json
{
    "body": "Commit: **[`d93f0c7`](https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a)**",
    "created_at": "2019-08-06T21:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441374",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[`d93f0c7`](https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a)**



---

archive/issue_comments_441375.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)**",
    "created_at": "2019-08-06T21:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441375",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)**



---

archive/issue_comments_441376.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2019-08-06T21:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441376",
    "user": "https://github.com/orlitzky"
}
```

Author: **Michael Orlitzky**



---

archive/issue_comments_441377.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a\"><code>d93f0c7</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>\n",
    "created_at": "2019-08-06T21:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441377",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a"><code>d93f0c7</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>




---

archive/issue_comments_441378.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348\"><code>6192e54</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>\n",
    "created_at": "2019-08-25T16:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441378",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348"><code>6192e54</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>




---

archive/issue_comments_441379.json:
```json
{
    "body": "Changed commit from **[`d93f0c7`](https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a)** to **[`6192e54`](https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348)**",
    "created_at": "2019-08-25T16:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441379",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d93f0c7`](https://github.com/sagemath/sagetrac-mirror/commit/d93f0c7d704eb1ce74dad47fdfe7ce766c034f8a)** to **[`6192e54`](https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348)**



---

archive/issue_comments_441380.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI figured it out. Those two vmstat entries are missing if `CONFIG_VM_EVENT_COUNTERS` is unset in your kernel. Force-pushed with an updated commit message, and CCing the two people who look like the bosses of psutil.",
    "created_at": "2019-08-25T16:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441380",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:3" align="right">comment:3</div>

I figured it out. Those two vmstat entries are missing if `CONFIG_VM_EVENT_COUNTERS` is unset in your kernel. Force-pushed with an updated commit message, and CCing the two people who look like the bosses of psutil.



---

archive/issue_events_385810.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T09:41:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385810"
}
```



---

archive/issue_events_385811.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T09:41:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385811"
}
```



---

archive/issue_comments_441381.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nLooks good to me, I tested this on Linux. \n\nOur psutil is old, due to its not ported to cygwin, so have have a patch, etc...",
    "created_at": "2019-12-08T09:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441381",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

Looks good to me, I tested this on Linux. 

Our psutil is old, due to its not ported to cygwin, so have have a patch, etc...



---

archive/issue_comments_441382.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nrebased over latest beta\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63\"><code>f587997</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>\n",
    "created_at": "2019-12-08T09:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441382",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

rebased over latest beta

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63"><code>f587997</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>




---

archive/issue_comments_441383.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)** to **[public/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28329)**",
    "created_at": "2019-12-08T09:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441383",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)** to **[public/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28329)**



---

archive/issue_events_385812.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T09:54:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385812"
}
```



---

archive/issue_events_385813.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T09:54:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385813"
}
```



---

archive/issue_comments_441384.json:
```json
{
    "body": "Changed commit from **[`6192e54`](https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348)** to **[`f587997`](https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63)**",
    "created_at": "2019-12-08T09:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441384",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`6192e54`](https://github.com/sagemath/sagetrac-mirror/commit/6192e54fe6894b5c444e1a2cb7d0adeec1d94348)** to **[`f587997`](https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63)**



---

archive/issue_comments_441385.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@dimpase](#comment%3A4):\n> **Cc** embray added; ebray removed\n\nDerp, thanks Dima.",
    "created_at": "2019-12-08T13:32:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441385",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@dimpase](#comment%3A4):
> **Cc** embray added; ebray removed

Derp, thanks Dima.



---

archive/issue_events_385814.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T17:46:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385814"
}
```



---

archive/issue_events_385815.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T17:46:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385815"
}
```



---

archive/issue_comments_441386.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-12-08T17:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441386",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_441387.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLGTM, also tested on OSX 10.13. Actually, unless `warnings` is pretty much broken on a platform, it should be OK. So I brave to give it a positive review.",
    "created_at": "2019-12-08T17:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441387",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

LGTM, also tested on OSX 10.13. Actually, unless `warnings` is pretty much broken on a platform, it should be OK. So I brave to give it a positive review.



---

archive/issue_comments_441388.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.\n\n```\nFile \"src/sage/groups/matrix_gps/homset.py\", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset\nFailed example:\n    is_MatrixGroupHomset(M)\nExpected:\n    True\nGot:\n    ...\n    DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.\n    See https://trac.sagemath.org/25444 for details.\n    True\n```",
    "created_at": "2019-12-08T20:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441388",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:9" align="right">comment:9</div>

The patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.

```
File "src/sage/groups/matrix_gps/homset.py", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset
Failed example:
    is_MatrixGroupHomset(M)
Expected:
    True
Got:
    ...
    DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.
    See https://trac.sagemath.org/25444 for details.
    True
```



---

archive/issue_comments_441389.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@mwageringel](#comment%3A9):\n> The patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.\n> \n> ```\n> File \"src/sage/groups/matrix_gps/homset.py\", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset\n> Failed example:\n>     is_MatrixGroupHomset(M)\n> Expected:\n>     True\n> Got:\n>     ...\n>     DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.\n>     See https://trac.sagemath.org/25444 for details.\n>     True\n> ```\n\nCf [#25444 comment:34](https://github.com/sagemath/sage/issues/25444#comment:34)\n\nI cannot imagine that this ticket has anything to do with that...",
    "created_at": "2019-12-08T20:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441389",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@mwageringel](#comment%3A9):
> The patchbots report a failure in `src/sage/groups/matrix_gps/homset.py`. I am not sure how it is caused by this ticket though.
> 
> ```
> File "src/sage/groups/matrix_gps/homset.py", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset
> Failed example:
>     is_MatrixGroupHomset(M)
> Expected:
>     True
> Got:
>     ...
>     DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.
>     See https://trac.sagemath.org/25444 for details.
>     True
> ```

Cf [#25444 comment:34](https://github.com/sagemath/sage/issues/25444#comment:34)

I cannot imagine that this ticket has anything to do with that...



---

archive/issue_comments_441390.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nbut apparently it does... hmm...",
    "created_at": "2019-12-08T20:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441390",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

but apparently it does... hmm...



---

archive/issue_comments_441391.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nthe only possible reason seems to be that the state is modified by `warnings.simplefilter(\"ignore\")` and kept that way, or some other side effect happens...",
    "created_at": "2019-12-08T20:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441391",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

the only possible reason seems to be that the state is modified by `warnings.simplefilter("ignore")` and kept that way, or some other side effect happens...



---

archive/issue_events_385816.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T20:16:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385816"
}
```



---

archive/issue_events_385817.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-08T20:16:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385817"
}
```



---

archive/issue_comments_441392.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment%3A12):\n> the only possible reason seems to be that the state is modified by `warnings.simplefilter(\"ignore\")` and kept that way, or some other side effect happens...\n\nIndeed, if I understand correctly, according to [[#24755 comment:7](https://github.com/sagemath/sage/issues/24755#comment:7)], this seems to be the case and it is probably harmless:\n\n>> This also explained why we get erratic behavior w.r.t. warnings in the Sage doctests.  Although there aren't many cases directly in the doctests where we directly manipulate the warnings filter, there are at least a few (and probably more cases where we do so indirectly).  So every time that happens it resets whether a warning has been displayed =_=",
    "created_at": "2019-12-08T20:25:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441392",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment%3A12):
> the only possible reason seems to be that the state is modified by `warnings.simplefilter("ignore")` and kept that way, or some other side effect happens...

Indeed, if I understand correctly, according to [[#24755 comment:7](https://github.com/sagemath/sage/issues/24755#comment:7)], this seems to be the case and it is probably harmless:

>> This also explained why we get erratic behavior w.r.t. warnings in the Sage doctests.  Although there aren't many cases directly in the doctests where we directly manipulate the warnings filter, there are at least a few (and probably more cases where we do so indirectly).  So every time that happens it resets whether a warning has been displayed =_=



---

archive/issue_comments_441393.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI just read the doc :-)\nhttps://docs.python.org/3/library/warnings.html\n\n```\nNote: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n```",
    "created_at": "2019-12-08T20:32:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441393",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

I just read the doc :-)
https://docs.python.org/3/library/warnings.html

```
Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
```



---

archive/issue_comments_441394.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nJFC, what a time to be alive =)\n\nThanks for catching that, I'll fix it in a different way.",
    "created_at": "2019-12-08T21:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441394",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:16" align="right">comment:16</div>

JFC, what a time to be alive =)

Thanks for catching that, I'll fix it in a different way.



---

archive/issue_comments_441395.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nBut, isn't the deprecation message in [comment:9](#comment%3A9) actually **correct** ?\n\nI.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?",
    "created_at": "2019-12-08T22:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441395",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

But, isn't the deprecation message in [comment:9](#comment%3A9) actually **correct** ?

I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?



---

archive/issue_comments_441396.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment%3A17):\n> But, isn't the deprecation message in [comment:9](#comment%3A9) actually **correct** ?\n> \n> I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?\n\nYes, it looks to me like that doctest should have been throwing a warning all along.\n\nNevertheless, I should be more careful when poking global state.",
    "created_at": "2019-12-08T22:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441396",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment%3A17):
> But, isn't the deprecation message in [comment:9](#comment%3A9) actually **correct** ?
> 
> I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?

Yes, it looks to me like that doctest should have been throwing a warning all along.

Nevertheless, I should be more careful when poking global state.



---

archive/issue_comments_441397.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nLet's see what goes wrong this time...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb\"><code>7d6f0aa</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>\n",
    "created_at": "2019-12-09T02:33:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441397",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:19" align="right">comment:19</div>

Let's see what goes wrong this time...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb"><code>7d6f0aa</code></a></td><td><code>Trac #28329: suppress warnings from failed swap statistics collection.</code></td></tr></table>




---

archive/issue_comments_441398.json:
```json
{
    "body": "Changed commit from **[`f587997`](https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63)** to **[`7d6f0aa`](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)**",
    "created_at": "2019-12-09T02:33:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441398",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[`f587997`](https://github.com/sagemath/sagetrac-mirror/commit/f5879972ee564661fff42b13e67b11d7b8242a63)** to **[`7d6f0aa`](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)**



---

archive/issue_comments_441399.json:
```json
{
    "body": "Changed branch from **[public/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28329)** to **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)**",
    "created_at": "2019-12-09T02:33:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441399",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[public/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28329)** to **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)**



---

archive/issue_events_385818.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2019-12-09T02:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385818"
}
```



---

archive/issue_events_385819.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2019-12-09T02:33:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385819"
}
```



---

archive/issue_events_385820.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-09T10:15:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385820"
}
```



---

archive/issue_events_385821.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-09T10:15:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385821"
}
```



---

archive/issue_comments_441400.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Markus Wageringel**",
    "created_at": "2019-12-09T10:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441400",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Markus Wageringel**



---

archive/issue_comments_441401.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOK.",
    "created_at": "2019-12-09T10:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441401",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

OK.



---

archive/issue_comments_441402.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@dimpase](#comment%3A15):\n> I just read the doc :-)\n> https://docs.python.org/3/library/warnings.html\n> \n> ```\n> Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n> ```\n\nFor the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.",
    "created_at": "2019-12-09T10:41:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441402",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@dimpase](#comment%3A15):
> I just read the doc :-)
> https://docs.python.org/3/library/warnings.html
> 
> ```
> Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
> ```

For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.



---

archive/issue_comments_441403.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@orlitzky](#comment%3A18):\n> Replying to [@dimpase](#comment%3A17):\n> > But, isn't the deprecation message in [comment:9](#comment%3A9) actually **correct** ?\n> > \n> > I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?\n\n> \n> Yes, it looks to me like that doctest should have been throwing a warning all along.\n\nYes and no.  The way Sage's doctest runner handles warnings is actually broken and a bit arbitrary, in part due to [#25444 comment:34](https://github.com/sagemath/sage/issues/25444#comment:34)\n\nIf the warning had already been displayed once in the course of testing a single module, it *should not* be displayed again while testing that same module.  But due to that bug in the warnings module, the warning state can get reset and be displayed again when it shouldn't be.",
    "created_at": "2019-12-09T10:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441403",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@orlitzky](#comment%3A18):
> Replying to [@dimpase](#comment%3A17):
> > But, isn't the deprecation message in [comment:9](#comment%3A9) actually **correct** ?
> > 
> > I.e. by right the test there should show a deprecation message, it just doesn't for a reason which probably has to do with threading (and this branch has kicked this can further down the road, so it started doing the right thing)?

> 
> Yes, it looks to me like that doctest should have been throwing a warning all along.

Yes and no.  The way Sage's doctest runner handles warnings is actually broken and a bit arbitrary, in part due to [#25444 comment:34](https://github.com/sagemath/sage/issues/25444#comment:34)

If the warning had already been displayed once in the course of testing a single module, it *should not* be displayed again while testing that same module.  But due to that bug in the warnings module, the warning state can get reset and be displayed again when it shouldn't be.



---

archive/issue_comments_441404.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@embray](#comment%3A21):\n> Replying to [@dimpase](#comment%3A15):\n> > I just read the doc :-)\n> > https://docs.python.org/3/library/warnings.html\n> > \n> > ```\n> > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n> > ```\n\n> \n> For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.\n\nwell, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)",
    "created_at": "2019-12-09T10:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441404",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@embray](#comment%3A21):
> Replying to [@dimpase](#comment%3A15):
> > I just read the doc :-)
> > https://docs.python.org/3/library/warnings.html
> > 
> > ```
> > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
> > ```

> 
> For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.

well, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)



---

archive/issue_comments_441405.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMy own ptestlong more or less passed, with only some failures in glpk that are probably due to using the system copy instead of the bundled one. The failures don't involve warnings, anyway.\n\nReplying to [@embray](#comment%3A22):\n> If the warning had already been displayed once in the course of testing a single module, it should not be displayed again while testing that same module.\n\nThere's only one test in that module, and the module only does one thing. I still think it should be displayed, but I'm not sure it's worth investigating if there are bigger known problems with warnings in doctests. With the new approach, we can at least be reasonably certain I haven't made anything worse.\n\nWhile the doctests may not be threaded, sage is a library, and we don't know what client code is doing with it -- so the safer the better.",
    "created_at": "2019-12-09T14:57:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441405",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:24" align="right">comment:24</div>

My own ptestlong more or less passed, with only some failures in glpk that are probably due to using the system copy instead of the bundled one. The failures don't involve warnings, anyway.

Replying to [@embray](#comment%3A22):
> If the warning had already been displayed once in the course of testing a single module, it should not be displayed again while testing that same module.

There's only one test in that module, and the module only does one thing. I still think it should be displayed, but I'm not sure it's worth investigating if there are bigger known problems with warnings in doctests. With the new approach, we can at least be reasonably certain I haven't made anything worse.

While the doctests may not be threaded, sage is a library, and we don't know what client code is doing with it -- so the safer the better.



---

archive/issue_comments_441406.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@dimpase](#comment%3A23):\n> Replying to [@embray](#comment%3A21):\n> > Replying to [@dimpase](#comment%3A15):\n> > > I just read the doc :-)\n> > > https://docs.python.org/3/library/warnings.html\n> > > \n> > > ```\n> > > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.\n> > > ```\n\n> > \n> > For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.\n\n> \n> well, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)\n> \n\nThat only affects the REPL; in the tests there are only one thread running.",
    "created_at": "2019-12-09T16:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441406",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@dimpase](#comment%3A23):
> Replying to [@embray](#comment%3A21):
> > Replying to [@dimpase](#comment%3A15):
> > > I just read the doc :-)
> > > https://docs.python.org/3/library/warnings.html
> > > 
> > > ```
> > > Note: this can only be guaranteed in a single-threaded application. If two or more threads use the catch_warnings context manager at the same time, the behavior is undefined.
> > > ```

> > 
> > For the record, sage's doctests run in multiple processes.  Sage is single-threaded and threads have nothing to do with this.

> 
> well, this is not true, cf. e.g. #22766 which shows how to crash Sage using the fact that it's not single-threaded :-)
> 

That only affects the REPL; in the tests there are only one thread running.



---

archive/issue_events_385822.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-11T21:46:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385822"
}
```



---

archive/issue_events_385823.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d253653a23bebdc1366604112d7833b19c5d897c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-12-11T21:46:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28329#event-385823"
}
```



---

archive/issue_comments_441407.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)** to **[`7d6f0aa`](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)**",
    "created_at": "2019-12-11T21:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28329",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28329#issuecomment-441407",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mjo/ticket/28329](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/28329)** to **[`7d6f0aa`](https://github.com/sagemath/sagetrac-mirror/commit/7d6f0aa1714620de4b1c45c27e46e71d316f75bb)**
