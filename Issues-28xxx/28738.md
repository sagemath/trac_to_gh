# Issue 28738: Docker SageMath install fails

archive/issues_028501.json:
```json
{
    "assignees": [],
    "body": "See https://gitlab.com/sagemath/sage/-/jobs/346689490#L2328\n\n```\n2328 Step 61/66 : RUN sudo $SAGE_ROOT/sage --nodotsage -c \"install_scripts('/usr/bin')\"\n2329  ---> Running in 1751eed7188f\n2330 /home/sage/sage/build/bin/sage-system-python: line 24: exec: : not found\n```\n\nDepends on #29090\n\nCC:  @embray @slel\n\nKeywords: **docker, ci**\n\nBranch/Commit: **[u/saraedum/docker-runtime-sage](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/docker-runtime-sage) @ [`9315240`](https://github.com/sagemath/sagetrac-mirror/commit/93152407ae99d9bcaa2c88218aa3397098fd0ffb)**\n\nComponent: **docker**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28738_\n\n",
    "closed_at": "2020-09-15T16:00:52Z",
    "created_at": "2019-11-14T18:41:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20docker",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Docker SageMath install fails",
    "type": "issue",
    "updated_at": "2020-09-15T16:00:52Z",
    "url": "https://github.com/sagemath/sage/issues/28738",
    "user": "https://github.com/saraedum"
}
```
See https://gitlab.com/sagemath/sage/-/jobs/346689490#L2328

```
2328 Step 61/66 : RUN sudo $SAGE_ROOT/sage --nodotsage -c "install_scripts('/usr/bin')"
2329  ---> Running in 1751eed7188f
2330 /home/sage/sage/build/bin/sage-system-python: line 24: exec: : not found
```

Depends on #29090

CC:  @embray @slel

Keywords: **docker, ci**

Branch/Commit: **[u/saraedum/docker-runtime-sage](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/docker-runtime-sage) @ [`9315240`](https://github.com/sagemath/sagetrac-mirror/commit/93152407ae99d9bcaa2c88218aa3397098fd0ffb)**

Component: **docker**

_Issue created by migration from https://trac.sagemath.org/ticket/28738_





---

archive/issue_events_394707.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-11-14T18:41:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394707"
}
```



---

archive/issue_events_394708.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-11-14T18:41:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20docker",
    "label_color": "000080",
    "label_name": "c: docker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394708"
}
```



---

archive/issue_events_394709.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-11-14T18:41:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394709"
}
```



---

archive/issue_events_394710.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-11-14T18:41:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394710"
}
```



---

archive/issue_comments_448323.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI have not checked what's causing this but Python 2 builds fail with this error.",
    "created_at": "2019-11-14T18:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448323",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:1" align="right">comment:1</div>

I have not checked what's causing this but Python 2 builds fail with this error.



---

archive/issue_comments_448324.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIt would appear that `sage-system-python` is, well, not finding the system python.  Far less clear is why that command would seem to be invoking `sage-system-python` in the first place...",
    "created_at": "2019-11-15T11:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448324",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

It would appear that `sage-system-python` is, well, not finding the system python.  Far less clear is why that command would seem to be invoking `sage-system-python` in the first place...



---

archive/issue_comments_448325.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nFWIW I was able to reproduce the problem locally, no problem.  But I haven't looked into what's causing it yet.",
    "created_at": "2019-11-15T16:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448325",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

FWIW I was able to reproduce the problem locally, no problem.  But I haven't looked into what's causing it yet.



---

archive/issue_comments_448326.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI see now.  Just recently (which is why I didn't see this at first; I hadn't pulled this update locally) in #28657 the `sage-location` script was changed to use `sage-system-python`, and `sage-location` is called by the main `sage` script.\n\nI'm not sure yet exactly why this change was made but it should be perfectly possible to work around.",
    "created_at": "2019-11-15T16:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448326",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

I see now.  Just recently (which is why I didn't see this at first; I hadn't pulled this update locally) in #28657 the `sage-location` script was changed to use `sage-system-python`, and `sage-location` is called by the main `sage` script.

I'm not sure yet exactly why this change was made but it should be perfectly possible to work around.



---

archive/issue_comments_448327.json:
```json
{
    "body": "Changed keywords from none to **docker, ci**",
    "created_at": "2019-11-17T21:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448327",
    "user": "https://github.com/saraedum"
}
```

Changed keywords from none to **docker, ci**



---

archive/issue_comments_448328.json:
```json
{
    "body": "Branch: **[u/saraedum/docker-runtime-sage](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/docker-runtime-sage)**",
    "created_at": "2019-11-17T21:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448328",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/docker-runtime-sage](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/docker-runtime-sage)**



---

archive/issue_comments_448329.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'm now installing Python as a runtime dependency. Not sure that's the best way to fix this; I asked on #28657.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93152407ae99d9bcaa2c88218aa3397098fd0ffb\">9315240</a></td><td><code>SageMath now requires system Python to be available at runtime</code></td></tr></table>\n",
    "created_at": "2019-11-17T22:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448329",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:7" align="right">comment:7</div>

I'm now installing Python as a runtime dependency. Not sure that's the best way to fix this; I asked on #28657.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93152407ae99d9bcaa2c88218aa3397098fd0ffb">9315240</a></td><td><code>SageMath now requires system Python to be available at runtime</code></td></tr></table>




---

archive/issue_comments_448330.json:
```json
{
    "body": "Commit: **[`9315240`](https://github.com/sagemath/sagetrac-mirror/commit/93152407ae99d9bcaa2c88218aa3397098fd0ffb)**",
    "created_at": "2019-11-17T22:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448330",
    "user": "https://github.com/saraedum"
}
```

Commit: **[`9315240`](https://github.com/sagemath/sagetrac-mirror/commit/93152407ae99d9bcaa2c88218aa3397098fd0ffb)**



---

archive/issue_comments_448331.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@embray](#comment:4):\n> I see now.  Just recently (which is why I didn't see this at first; I hadn't pulled this update locally) in #28657 the `sage-location` script was changed to use `sage-system-python`, and `sage-location` is called by the main `sage` script.\n> \n> I'm not sure yet exactly why this change was made but it should be perfectly possible to work around.\n\nThe change is explained in #28657: on some systems, for example the latest releases of Ubuntu, there is no `python` executable, just `python3`. On top of that, in a Python 3 build of Sage, we don't create a `python` executable. So we shouldn't expect `#!/usr/bin/env python` to work.\n\nIt sounds like `sage-system-python` is not robust enough, if it's not handling this situation.",
    "created_at": "2019-11-18T01:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448331",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@embray](#comment:4):
> I see now.  Just recently (which is why I didn't see this at first; I hadn't pulled this update locally) in #28657 the `sage-location` script was changed to use `sage-system-python`, and `sage-location` is called by the main `sage` script.
> 
> I'm not sure yet exactly why this change was made but it should be perfectly possible to work around.

The change is explained in #28657: on some systems, for example the latest releases of Ubuntu, there is no `python` executable, just `python3`. On top of that, in a Python 3 build of Sage, we don't create a `python` executable. So we shouldn't expect `#!/usr/bin/env python` to work.

It sounds like `sage-system-python` is not robust enough, if it's not handling this situation.



---

archive/issue_comments_448332.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOr `sage-location` should be able to use Sage's Python, if that's the only one available. Are there really systems with neither `python` nor `python3` on which Sage is expected to run?",
    "created_at": "2019-11-18T01:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448332",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

Or `sage-location` should be able to use Sage's Python, if that's the only one available. Are there really systems with neither `python` nor `python3` on which Sage is expected to run?



---

archive/issue_comments_448333.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jhpalmieri](#comment:9):\n> Or `sage-location` should be able to use Sage's Python, if that's the only one available. Are there really systems with neither `python` nor `python3` on which Sage is expected to run?\n\nThe [SageMath](../wiki/SageMath) download page at least does not say that you need Python.\n\nIs Python pre-installed on Windows these days?\n\nIt comes pre-installed on macOS, but that's bound to change I think:\n\n> Scripting language runtimes such as Python, Ruby, and Perl are included in macOS for compatibility with legacy software. In future versions of macOS, scripting language runtimes won\u2019t be available by default, and may require you to install an additional package. If your software depends on scripting languages, it\u2019s recommended that you bundle the runtime within the app. (49764202)",
    "created_at": "2019-11-18T11:05:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448333",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jhpalmieri](#comment:9):
> Or `sage-location` should be able to use Sage's Python, if that's the only one available. Are there really systems with neither `python` nor `python3` on which Sage is expected to run?

The [SageMath](../wiki/SageMath) download page at least does not say that you need Python.

Is Python pre-installed on Windows these days?

It comes pre-installed on macOS, but that's bound to change I think:

> Scripting language runtimes such as Python, Ruby, and Perl are included in macOS for compatibility with legacy software. In future versions of macOS, scripting language runtimes won’t be available by default, and may require you to install an additional package. If your software depends on scripting languages, it’s recommended that you bundle the runtime within the app. (49764202)



---

archive/issue_comments_448334.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448334",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Ticket retargeted after milestone closed



---

archive/issue_events_394711.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394711"
}
```



---

archive/issue_events_394712.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394712"
}
```



---

archive/issue_comments_448335.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSee also #29090 - \"configure forgets to check whether ANY Python is available on the system\"",
    "created_at": "2020-03-17T23:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448335",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

See also #29090 - "configure forgets to check whether ANY Python is available on the system"



---

archive/issue_comments_448336.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFixed by #29090.",
    "created_at": "2020-03-18T01:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448336",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Fixed by #29090.



---

archive/issue_comments_448337.json:
```json
{
    "body": "Dependencies: **#29090**",
    "created_at": "2020-03-18T02:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28738#issuecomment-448337",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29090**



---

archive/issue_events_394713.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-07T02:57:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394713"
}
```



---

archive/issue_events_394714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-07T02:57:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394714"
}
```



---

archive/issue_events_394715.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-07T02:57:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394715"
}
```



---

archive/issue_events_394716.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-07T02:57:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394716"
}
```



---

archive/issue_events_394717.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-09-15T16:00:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394717"
}
```



---

archive/issue_events_394718.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-09-15T16:00:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394718"
}
```



---

archive/issue_events_394719.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-09-15T16:00:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28738",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28738#event-394719"
}
```
