# Issue 28745: Add SAGE_ROOT/environment.yml for "conda env create -f".

archive/issues_028508.json:
```json
{
    "body": "These files describes the conda environment (conda package dependencies):\n\n`environment.yml` - describes conda packages that are useful for installing sage.\n\nThis would be a more idiomatic alternative to the `conda install` line that is shown at the end of `./configure`\n\nIn combination with the `spkg-configure` mechanism, this will speed up installation of Sage, in particular for users stuck on outdated OS distributions.\n\nOpen:\n- use [GitLab](GitLab) CI to actually check that sage builds with `environment.yml`\n- scripts to support keeping package versions in sync between `environment.yml`, sage-the-distribution (`build/pkgs`), and conda-forge packaging (https://github.com/conda-forge/sage-feedstock/tree/master/recipe, https://github.com/conda-forge/sagelib-feedstock/tree/master/recipe)\n\nSee also:\n- #28752 for a more ambitious conda ticket\n- #26668 Add documentation for implementing spkg-configure.m4 for SPKGs\n- #27330 Try to use as many system packages as possible\n\nCC:  @isuruf @saraedum @dimpase @embray\n\nKeywords: conda\n\nReviewer: Matthias Koeppe\n\nAuthor: Isuru Fernando\n\nBranch: 736e0064359a37b51f2e9421d54fd655b3b295a5\n\nDependencies: #30839, #30719, #30611\n\nCommit: 736e0064359a37b51f2e9421d54fd655b3b295a5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28745\n\n",
    "closed_at": "2020-11-29T11:57:38Z",
    "created_at": "2019-11-16T18:07:53Z",
    "labels": [
        "component: build",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Add SAGE_ROOT/environment.yml for \"conda env create -f\".",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28745",
    "user": "https://github.com/mkoeppe"
}
```
These files describes the conda environment (conda package dependencies):

`environment.yml` - describes conda packages that are useful for installing sage.

This would be a more idiomatic alternative to the `conda install` line that is shown at the end of `./configure`

In combination with the `spkg-configure` mechanism, this will speed up installation of Sage, in particular for users stuck on outdated OS distributions.

Open:
- use [GitLab](GitLab) CI to actually check that sage builds with `environment.yml`
- scripts to support keeping package versions in sync between `environment.yml`, sage-the-distribution (`build/pkgs`), and conda-forge packaging (https://github.com/conda-forge/sage-feedstock/tree/master/recipe, https://github.com/conda-forge/sagelib-feedstock/tree/master/recipe)

See also:
- #28752 for a more ambitious conda ticket
- #26668 Add documentation for implementing spkg-configure.m4 for SPKGs
- #27330 Try to use as many system packages as possible

CC:  @isuruf @saraedum @dimpase @embray

Keywords: conda

Reviewer: Matthias Koeppe

Author: Isuru Fernando

Branch: 736e0064359a37b51f2e9421d54fd655b3b295a5

Dependencies: #30839, #30719, #30611

Commit: 736e0064359a37b51f2e9421d54fd655b3b295a5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28745





---

archive/issue_comments_402123.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-11-17T19:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402123",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_402124.json:
```json
{
    "body": "Changing keywords from \"\" to \"conda\".",
    "created_at": "2019-11-17T19:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402124",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "conda".



---

archive/issue_comments_402125.json:
```json
{
    "body": "<a id='comment:3'></a>mkoeppe: I can only see one file in the diff here on trac. Did you forget to add the other?",
    "created_at": "2019-11-17T20:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402125",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>mkoeppe: I can only see one file in the diff here on trac. Did you forget to add the other?



---

archive/issue_comments_402126.json:
```json
{
    "body": "<a id='comment:4'></a>This is how far I got!",
    "created_at": "2019-11-17T20:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402126",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>This is how far I got!



---

archive/issue_comments_402127.json:
```json
{
    "body": "<a id='comment:5'></a>Any help and discussion is welcome.",
    "created_at": "2019-11-17T20:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Any help and discussion is welcome.



---

archive/issue_comments_402128.json:
```json
{
    "body": "<a id='comment:6'></a>First of all, I think it's great to explore ways to provide an //alternative// to the SPKG system. I have been wanting to use conda for this for a long time.\n\nI have not used conda-debug a lot but I think a combination of `conda debug [sagelib-recipe]`, `conda install sage`, `conda remove sagelib --force` should essentially do the right thing here as well.\n\nA proper `environment.yml` file, as you propose, probably makes more sense though. For me the question is how we can make sure that it is kept up to date. We might want to use [GitLab](GitLab) CI to actually check that sagelib builds with that environment.yml.\n\nIn the long run, it would be great if doctests passed, see https://github.com/conda-forge/sagelib-feedstock/issues/19.",
    "created_at": "2019-11-17T21:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402128",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:6'></a>First of all, I think it's great to explore ways to provide an //alternative// to the SPKG system. I have been wanting to use conda for this for a long time.

I have not used conda-debug a lot but I think a combination of `conda debug [sagelib-recipe]`, `conda install sage`, `conda remove sagelib --force` should essentially do the right thing here as well.

A proper `environment.yml` file, as you propose, probably makes more sense though. For me the question is how we can make sure that it is kept up to date. We might want to use [GitLab](GitLab) CI to actually check that sagelib builds with that environment.yml.

In the long run, it would be great if doctests passed, see https://github.com/conda-forge/sagelib-feedstock/issues/19.



---

archive/issue_comments_402129.json:
```json
{
    "body": "<a id='comment:7'></a>I am not sure I understand your intentions for the sage-the-distribution environment.yml. What would the workflow look like? Install that environment.yml, then force-uninstall the package that I want to work on? How would the SPKG system know which packages it needs to build now?",
    "created_at": "2019-11-17T21:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402129",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>I am not sure I understand your intentions for the sage-the-distribution environment.yml. What would the workflow look like? Install that environment.yml, then force-uninstall the package that I want to work on? How would the SPKG system know which packages it needs to build now?



---

archive/issue_comments_402130.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 saraedum]:\n> I am not sure I understand your intentions for the sage-the-distribution environment.yml. What would the workflow look like? Install that environment.yml, then force-uninstall the package that I want to work on? How would the SPKG system know which packages it needs to build now?\n\nThrough the spkg-configure mechanism that was introduced recently, sage-the-distribution decides whether to install its own version of the package; but this can be overridden using `configure` options such as `--with-system-glpk=force`. (Here \"system\", of course, from the viewpoint of sage, includes the conda packages.) Sage developers could use the conda environment to avoid compiling many packages by default, but still work on and install sage-the-distribution packages that override the packages provided by conda.",
    "created_at": "2019-11-17T21:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402130",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Replying to [comment:7 saraedum]:
> I am not sure I understand your intentions for the sage-the-distribution environment.yml. What would the workflow look like? Install that environment.yml, then force-uninstall the package that I want to work on? How would the SPKG system know which packages it needs to build now?

Through the spkg-configure mechanism that was introduced recently, sage-the-distribution decides whether to install its own version of the package; but this can be overridden using `configure` options such as `--with-system-glpk=force`. (Here "system", of course, from the viewpoint of sage, includes the conda packages.) Sage developers could use the conda environment to avoid compiling many packages by default, but still work on and install sage-the-distribution packages that override the packages provided by conda.



---

archive/issue_comments_402131.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 saraedum]:\n> We might want to use [GitLab](GitLab) CI to actually check that sagelib builds with that environment.yml.\n\n+1",
    "created_at": "2019-11-17T21:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402131",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Replying to [comment:6 saraedum]:
> We might want to use [GitLab](GitLab) CI to actually check that sagelib builds with that environment.yml.

+1



---

archive/issue_comments_402132.json:
```json
{
    "body": "<a id='comment:10'></a>So, to make this actually useful, we'd need the corresponding configure flags to use \"system\" for everything that is in environment.yml as well, right?",
    "created_at": "2019-11-17T21:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402132",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>So, to make this actually useful, we'd need the corresponding configure flags to use "system" for everything that is in environment.yml as well, right?



---

archive/issue_comments_402133.json:
```json
{
    "body": "<a id='comment:11'></a>But maybe we should split this into two tickets. One to do the sagelib environment.yml, and then this one to do the more complicated sage-the-distribution environment.yml.",
    "created_at": "2019-11-17T21:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402133",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>But maybe we should split this into two tickets. One to do the sagelib environment.yml, and then this one to do the more complicated sage-the-distribution environment.yml.



---

archive/issue_comments_402134.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:10 saraedum]:\n> So, to make this actually useful, we'd need the corresponding configure flags to use \"system\" for everything that is in environment.yml as well, right?\n\nNo, the default is already to use the \"system\" package when it is available and deemed suitable by the configure test.\nIt can be changed to using the sage distribution's package by using `configure --with-system-glpk=no`.",
    "created_at": "2019-11-17T21:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402134",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:10 saraedum]:
> So, to make this actually useful, we'd need the corresponding configure flags to use "system" for everything that is in environment.yml as well, right?

No, the default is already to use the "system" package when it is available and deemed suitable by the configure test.
It can be changed to using the sage distribution's package by using `configure --with-system-glpk=no`.



---

archive/issue_comments_402135.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 saraedum]:\n> But maybe we should split this into two tickets. One to do the sagelib environment.yml, and then this one to do the more complicated sage-the-distribution environment.yml.\n\nGood idea. I have created #28752 for that and have narrowed down the present ticket.",
    "created_at": "2019-11-17T21:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402135",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Replying to [comment:11 saraedum]:
> But maybe we should split this into two tickets. One to do the sagelib environment.yml, and then this one to do the more complicated sage-the-distribution environment.yml.

Good idea. I have created #28752 for that and have narrowed down the present ticket.



---

archive/issue_comments_402136.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:14 mkoeppe]:\n> Replying to [comment:11 saraedum]:\n> > But maybe we should split this into two tickets. One to do the sagelib environment.yml, and then this one to do the more complicated sage-the-distribution environment.yml.\n\n> Good idea. I have created #28752 for that and have narrowed down the present ticket.\n(Actually, the sagelib one is more complicated - see #28752!)",
    "created_at": "2019-11-17T21:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:14 mkoeppe]:
> Replying to [comment:11 saraedum]:
> > But maybe we should split this into two tickets. One to do the sagelib environment.yml, and then this one to do the more complicated sage-the-distribution environment.yml.

> Good idea. I have created #28752 for that and have narrowed down the present ticket.
(Actually, the sagelib one is more complicated - see #28752!)



---

archive/issue_comments_402137.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-18T15:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_402138.json:
```json
{
    "body": "<a id='comment:18'></a>This works reasonably well already (this is on macOS Mojave, with current miniconda 3). \nI had the problem that `automake` and `aclocal` installed by conda segfault, so I bootstrapped Sage using the homebrew binaries.\nThen, running `configure`, most packages that have `spkg-configure` scripts recognize the installed conda packages, with the following exceptions:\n\n```\nSAGE_SPKG_CONFIGURE_PERL_TERM_READLINE_GNU\nSAGE_SPKG_CONFIGURE_PARI_SEADATA_SMALL\nSAGE_SPKG_CONFIGURE_GF2X\nSAGE_SPKG_CONFIGURE_LIBSEMIGROUPS\nSAGE_SPKG_CONFIGURE_PATCH\nSAGE_SPKG_CONFIGURE_ISL\nSAGE_SPKG_CONFIGURE_PARI*\nSAGE_SPKG_CONFIGURE_ECLIB\nSAGE_SPKG_CONFIGURE_LCALC\n```\nThen, a parallel `make` succesfully compiled 135 packages but got stuck on `ecl-16.1.2.p5`, `openblas-0.3.6.p0`, and `tachyon-0.98.9.p7`.",
    "created_at": "2019-11-18T15:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402138",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>This works reasonably well already (this is on macOS Mojave, with current miniconda 3). 
I had the problem that `automake` and `aclocal` installed by conda segfault, so I bootstrapped Sage using the homebrew binaries.
Then, running `configure`, most packages that have `spkg-configure` scripts recognize the installed conda packages, with the following exceptions:

```
SAGE_SPKG_CONFIGURE_PERL_TERM_READLINE_GNU
SAGE_SPKG_CONFIGURE_PARI_SEADATA_SMALL
SAGE_SPKG_CONFIGURE_GF2X
SAGE_SPKG_CONFIGURE_LIBSEMIGROUPS
SAGE_SPKG_CONFIGURE_PATCH
SAGE_SPKG_CONFIGURE_ISL
SAGE_SPKG_CONFIGURE_PARI*
SAGE_SPKG_CONFIGURE_ECLIB
SAGE_SPKG_CONFIGURE_LCALC
```
Then, a parallel `make` succesfully compiled 135 packages but got stuck on `ecl-16.1.2.p5`, `openblas-0.3.6.p0`, and `tachyon-0.98.9.p7`.



---

archive/issue_comments_402139.json:
```json
{
    "body": "<a id='comment:21'></a>For pari, you need to install `pari-nftables` as well. Can you post the config.log so that we can debug why the other packages are not picked up?\n\nBtw, since this ticket focuses on spkg-configure, shouldn't the packages installed be limited to the ones with an spkg-configure?",
    "created_at": "2019-11-18T15:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402139",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:21'></a>For pari, you need to install `pari-nftables` as well. Can you post the config.log so that we can debug why the other packages are not picked up?

Btw, since this ticket focuses on spkg-configure, shouldn't the packages installed be limited to the ones with an spkg-configure?



---

archive/issue_comments_402140.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 isuruf]:\n> since this ticket focuses on spkg-configure, shouldn't the packages installed be limited to the ones with an spkg-configure?\n\nGood point.",
    "created_at": "2019-11-18T17:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402140",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Replying to [comment:21 isuruf]:
> since this ticket focuses on spkg-configure, shouldn't the packages installed be limited to the ones with an spkg-configure?

Good point.



---

archive/issue_comments_402141.json:
```json
{
    "body": "<a id='comment:24'></a>mkoeppe, I think your environment.yml missed the pins from https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/master/recipe/conda_build_config.yaml. I am adding them now.",
    "created_at": "2019-11-21T21:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402141",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:24'></a>mkoeppe, I think your environment.yml missed the pins from https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/master/recipe/conda_build_config.yaml. I am adding them now.



---

archive/issue_comments_402142.json:
```json
{
    "body": "<a id='comment:26'></a>mkoeppe, I update the environment yml. The only ones that don't work for me now are:\n\n* perl_term_readline_gnu\n* gp2c (from PARI)\n\nisuruf: are they packaged somewhere on conda-forge?\n\nAlso I have to rely on the system's pkgconf. Do we have pkgconf in conda-forge?\n\n---\nNew commits:",
    "created_at": "2019-11-21T22:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402142",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:26'></a>mkoeppe, I update the environment yml. The only ones that don't work for me now are:

* perl_term_readline_gnu
* gp2c (from PARI)

isuruf: are they packaged somewhere on conda-forge?

Also I have to rely on the system's pkgconf. Do we have pkgconf in conda-forge?

---
New commits:



---

archive/issue_comments_402143.json:
```json
{
    "body": "<a id='comment:27'></a>I'm building sage now with this environment.yml. Let's see how far I get\u2026",
    "created_at": "2019-11-21T22:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402143",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:27'></a>I'm building sage now with this environment.yml. Let's see how far I get…



---

archive/issue_comments_402144.json:
```json
{
    "body": "<a id='comment:28'></a>Thanks a lot, this is looking great.\n\nAs for `perl_term_readline_gnu`, as far as I understand, conda-forge packages `perl` and `perl-app-cpanminus` but not individual CPAN packages, and one is expected to install any packages using `cpanminus`.",
    "created_at": "2019-11-21T22:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402144",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Thanks a lot, this is looking great.

As for `perl_term_readline_gnu`, as far as I understand, conda-forge packages `perl` and `perl-app-cpanminus` but not individual CPAN packages, and one is expected to install any packages using `cpanminus`.



---

archive/issue_comments_402145.json:
```json
{
    "body": "<a id='comment:29'></a>`perl_term_readline_gnu` and `gp2c` are not packaged. `pkgconf` is in conda-forge as `pkg-config`",
    "created_at": "2019-11-21T22:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402145",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:29'></a>`perl_term_readline_gnu` and `gp2c` are not packaged. `pkgconf` is in conda-forge as `pkg-config`



---

archive/issue_comments_402146.json:
```json
{
    "body": "<a id='comment:30'></a>If you are on Debian or Ubuntu, you need to fix #28533",
    "created_at": "2019-11-21T22:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402146",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:30'></a>If you are on Debian or Ubuntu, you need to fix #28533



---

archive/issue_comments_402147.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:29 isuruf]:\n`pkgconf` is in conda-forge as `pkg-config`\n\nIs this really the same thing? There's at least no pkgconf binary in pkg-config. And judging from my ArchLinux's pkgconf and conda-forge's pkg-config --help, these seem to be two different things.",
    "created_at": "2019-11-21T22:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402147",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:31'></a>Replying to [comment:29 isuruf]:
`pkgconf` is in conda-forge as `pkg-config`

Is this really the same thing? There's at least no pkgconf binary in pkg-config. And judging from my ArchLinux's pkgconf and conda-forge's pkg-config --help, these seem to be two different things.



---

archive/issue_comments_402148.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:27 saraedum]:\n> I'm building sage now with this environment.yml. Let's see how far I get\u2026\n\n\npkgconf and tachyon failed to build.",
    "created_at": "2019-11-21T22:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402148",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:32'></a>Replying to [comment:27 saraedum]:
> I'm building sage now with this environment.yml. Let's see how far I get…


pkgconf and tachyon failed to build.



---

archive/issue_comments_402149.json:
```json
{
    "body": "<a id='comment:33'></a>SageMath sets the following for tachyon:\n\n```\n+PNGINC= -I$(SAGE_LOCAL)/include\n+PNGLIB= -L$(SAGE_LOCAL)/lib -lpng -lz\n```\n\nReporting to #27186 where the m4 script for libpng was added.",
    "created_at": "2019-11-21T23:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402149",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:33'></a>SageMath sets the following for tachyon:

```
+PNGINC= -I$(SAGE_LOCAL)/include
+PNGLIB= -L$(SAGE_LOCAL)/lib -lpng -lz
```

Reporting to #27186 where the m4 script for libpng was added.



---

archive/issue_comments_402150.json:
```json
{
    "body": "<a id='comment:34'></a>Tachyon's build is very confusing. It appears that they are ignoring the environment's CFLAGS.",
    "created_at": "2019-11-21T23:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402150",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:34'></a>Tachyon's build is very confusing. It appears that they are ignoring the environment's CFLAGS.



---

archive/issue_comments_402151.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:31 saraedum]:\n> Replying to [comment:29 isuruf]:\n> `pkgconf` is in conda-forge as `pkg-config`\n> \n> Is this really the same thing? There's at least no pkgconf binary in pkg-config. And judging from my ArchLinux's pkgconf and conda-forge's pkg-config --help, these seem to be two different things.\n\n\nThat's fine. They both do the same thing. https://github.com/pkgconf/pkgconf#compatibility-with-pkg-config",
    "created_at": "2019-11-21T23:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402151",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:35'></a>Replying to [comment:31 saraedum]:
> Replying to [comment:29 isuruf]:
> `pkgconf` is in conda-forge as `pkg-config`
> 
> Is this really the same thing? There's at least no pkgconf binary in pkg-config. And judging from my ArchLinux's pkgconf and conda-forge's pkg-config --help, these seem to be two different things.


That's fine. They both do the same thing. https://github.com/pkgconf/pkgconf#compatibility-with-pkg-config



---

archive/issue_comments_402152.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-21T23:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_402153.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:28 mkoeppe]:\n> but not individual CPAN packages\n\n\nIt's just that they haven't been package yet. If there's anybody who is interested in helping out, they can be packaged.",
    "created_at": "2019-11-22T06:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402153",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:37'></a>Replying to [comment:28 mkoeppe]:
> but not individual CPAN packages


It's just that they haven't been package yet. If there's anybody who is interested in helping out, they can be packaged.



---

archive/issue_comments_402154.json:
```json
{
    "body": "<a id='comment:38'></a>We can add `openblas, cliquer, r-base` to the list now.",
    "created_at": "2019-12-20T00:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402154",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:38'></a>We can add `openblas, cliquer, r-base` to the list now.



---

archive/issue_comments_402155.json:
```json
{
    "body": "<a id='comment:39'></a>New commits:",
    "created_at": "2019-12-21T19:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402155",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:39'></a>New commits:



---

archive/issue_comments_402156.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T19:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_402157.json:
```json
{
    "body": "<a id='comment:41'></a>The latter doesn't work for me:\n\n```\n$ conda env create -n sage -f environment.yml\nCollecting package metadata (repodata.json): done\nSolving environment: failed\n\nResolvePackageNotFound: \n  - blas-devel[build=*openblas]\n```",
    "created_at": "2019-12-22T03:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402157",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>The latter doesn't work for me:

```
$ conda env create -n sage -f environment.yml
Collecting package metadata (repodata.json): done
Solving environment: failed

ResolvePackageNotFound: 
  - blas-devel[build=*openblas]
```



---

archive/issue_events_072505.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-12-25T16:23:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28745#event-72505"
}
```



---

archive/issue_comments_402158.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:41 dimpase]:\n> The latter doesn't work for me:\n> \n> ```\n> $ conda env create -n sage -f environment.yml\n> Collecting package metadata (repodata.json): done\n> Solving environment: failed\n> \n> ResolvePackageNotFound: \n>   - blas-devel[build=*openblas]\n> ```\n\nNeither for me.",
    "created_at": "2020-01-14T18:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402158",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Replying to [comment:41 dimpase]:
> The latter doesn't work for me:
> 
> ```
> $ conda env create -n sage -f environment.yml
> Collecting package metadata (repodata.json): done
> Solving environment: failed
> 
> ResolvePackageNotFound: 
>   - blas-devel[build=*openblas]
> ```

Neither for me.



---

archive/issue_comments_402159.json:
```json
{
    "body": "<a id='comment:44'></a>After removing this line, I get the following:\n\n```\n[python3-3.7.3.p1] /opt/conda/envs/sage/bin/x86_64-conda_cos6-linux-gnu-cc -pthread -shared -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/envs/sage/lib -Wl,-rpath-link,/opt/conda/envs/sage/lib -L/opt/conda/envs/sage/lib -L. -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/envs/sage/lib -Wl,-rpath-link,/opt/conda/envs/sage/lib -L/opt/conda/envs/sage/lib -L. -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/envs/sage/lib -Wl,-rpath-link,/opt/conda/envs/sage/lib -L/opt/conda/envs/sage/lib -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /opt/conda/envs/sage/include build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/_ctypes.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/callbacks.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/callproc.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/stgdict.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/cfield.o -L. -L/sage/local/lib -L/opt/conda/envs/sage/lib -L/usr/local/lib -lffi -ldl -lpython3.7m -o build/lib.linux-x86_64-3.7/_ctypes.cpython-37m-x86_64-linux-gnu.so\n[python3-3.7.3.p1] *** WARNING: renaming \"_crypt\" since importing it failed: build/lib.linux-x86_64-3.7/_crypt.cpython-37m-x86_64-linux-gnu.so: undefined symbol: crypt_r\n...\n[python3-3.7.3.p1] hashlib module imported OK\n[python3-3.7.3.p1] Traceback (most recent call last):\n[python3-3.7.3.p1]   File \"<string>\", line 1, in <module>\n[python3-3.7.3.p1]   File \"/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Lib/crypt.py\", line 3, in <module>\n[python3-3.7.3.p1]     import _crypt\n[python3-3.7.3.p1] ModuleNotFoundError: No module named '_crypt'\n[python3-3.7.3.p1] crypt module failed to import\n[python3-3.7.3.p1] readline module imported OK\n[python3-3.7.3.p1] socket module imported OK\n[python3-3.7.3.p1] Error: One or more modules failed to import.\n```\nThis is on a Debian docker image based on continuumio/miniconda3:latest - see attached",
    "created_at": "2020-01-14T19:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402159",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>After removing this line, I get the following:

```
[python3-3.7.3.p1] /opt/conda/envs/sage/bin/x86_64-conda_cos6-linux-gnu-cc -pthread -shared -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/envs/sage/lib -Wl,-rpath-link,/opt/conda/envs/sage/lib -L/opt/conda/envs/sage/lib -L. -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/envs/sage/lib -Wl,-rpath-link,/opt/conda/envs/sage/lib -L/opt/conda/envs/sage/lib -L. -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/envs/sage/lib -Wl,-rpath-link,/opt/conda/envs/sage/lib -L/opt/conda/envs/sage/lib -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /opt/conda/envs/sage/include build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/_ctypes.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/callbacks.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/callproc.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/stgdict.o build/temp.linux-x86_64-3.7/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_ctypes/cfield.o -L. -L/sage/local/lib -L/opt/conda/envs/sage/lib -L/usr/local/lib -lffi -ldl -lpython3.7m -o build/lib.linux-x86_64-3.7/_ctypes.cpython-37m-x86_64-linux-gnu.so
[python3-3.7.3.p1] *** WARNING: renaming "_crypt" since importing it failed: build/lib.linux-x86_64-3.7/_crypt.cpython-37m-x86_64-linux-gnu.so: undefined symbol: crypt_r
...
[python3-3.7.3.p1] hashlib module imported OK
[python3-3.7.3.p1] Traceback (most recent call last):
[python3-3.7.3.p1]   File "<string>", line 1, in <module>
[python3-3.7.3.p1]   File "/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Lib/crypt.py", line 3, in <module>
[python3-3.7.3.p1]     import _crypt
[python3-3.7.3.p1] ModuleNotFoundError: No module named '_crypt'
[python3-3.7.3.p1] crypt module failed to import
[python3-3.7.3.p1] readline module imported OK
[python3-3.7.3.p1] socket module imported OK
[python3-3.7.3.p1] Error: One or more modules failed to import.
```
This is on a Debian docker image based on continuumio/miniconda3:latest - see attached



---

archive/issue_comments_402160.json:
```json
{
    "body": "Attachment [Dockerfile-build-within-conda](tarball://root/attachments/some-uuid/ticket28745/Dockerfile-build-within-conda) by @mkoeppe created at 2020-01-14 19:44:52",
    "created_at": "2020-01-14T19:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402160",
    "user": "https://github.com/mkoeppe"
}
```

Attachment [Dockerfile-build-within-conda](tarball://root/attachments/some-uuid/ticket28745/Dockerfile-build-within-conda) by @mkoeppe created at 2020-01-14 19:44:52



---

archive/issue_comments_402161.json:
```json
{
    "body": "<a id='comment:45'></a>I have created #29012 for this defect.",
    "created_at": "2020-01-14T20:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402161",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>I have created #29012 for this defect.



---

archive/issue_comments_402162.json:
```json
{
    "body": "<a id='comment:47'></a>Would it be a good idea to generate this file from information to be put in `build/pkgs/SPKG/conda-environment.txt` as in #29053? \n\n---\nNew commits:",
    "created_at": "2020-01-22T17:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402162",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>Would it be a good idea to generate this file from information to be put in `build/pkgs/SPKG/conda-environment.txt` as in #29053? 

---
New commits:



---

archive/issue_comments_402163.json:
```json
{
    "body": "<a id='comment:49'></a>If one works around the python build failures of #29012 by using system python3 (#27824), several other errors show up:\n\nTestsuite of libatomic_ops:\n\n```\n  [libatomic_ops-7.6.2]   /bin/bash ../libtool  --tag=CC   --mode=link /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc  -Wall -Wextra -Wpedantic -Wno-long-long -O2 -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include   -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/lib -Wl,-rpath-link,/opt/conda/lib -L/opt/conda/lib -o test_malloc test_malloc.o -lpthread ../src/libatomic_ops_gpl.la ../src/libatomic_ops.la \n  [libatomic_ops-7.6.2]   libtool: link: /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc -Wall -Wextra -Wpedantic -Wno-long-long -O2 -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include -Wl,-rpath -Wl,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/opt/conda/lib -Wl,-rpath-link -Wl,/opt/conda/lib -o test_malloc test_malloc.o  -L/sage/local/lib -L/opt/conda/lib -lpthread ../src/.libs/libatomic_ops_gpl.a /sage/local/var/tmp/sage/build/libatomic_ops-7.6.2/src/src/.libs/libatomic_ops.a ../src/.libs/libatomic_ops.a\n  [libatomic_ops-7.6.2]   /opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: ../src/.libs/libatomic_ops_gpl.a(atomic_ops_stack.o): in function `AO_double_compare_and_swap_release':\n  [libatomic_ops-7.6.2]   /sage/local/var/tmp/sage/build/libatomic_ops-7.6.2/src/src/atomic_ops/sysdeps/gcc/generic.h:219: undefined reference to `__atomic_compare_exchange_16'\n  [libatomic_ops-7.6.2]   collect2: error: ld returned 1 exit status\n  [libatomic_ops-7.6.2]   make[7]: *** [Makefile:634: test_malloc] Error 1\n```",
    "created_at": "2020-03-22T17:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402163",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>If one works around the python build failures of #29012 by using system python3 (#27824), several other errors show up:

Testsuite of libatomic_ops:

```
  [libatomic_ops-7.6.2]   /bin/bash ../libtool  --tag=CC   --mode=link /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc  -Wall -Wextra -Wpedantic -Wno-long-long -O2 -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include   -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/lib -Wl,-rpath-link,/opt/conda/lib -L/opt/conda/lib -o test_malloc test_malloc.o -lpthread ../src/libatomic_ops_gpl.la ../src/libatomic_ops.la 
  [libatomic_ops-7.6.2]   libtool: link: /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc -Wall -Wextra -Wpedantic -Wno-long-long -O2 -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include -Wl,-rpath -Wl,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/opt/conda/lib -Wl,-rpath-link -Wl,/opt/conda/lib -o test_malloc test_malloc.o  -L/sage/local/lib -L/opt/conda/lib -lpthread ../src/.libs/libatomic_ops_gpl.a /sage/local/var/tmp/sage/build/libatomic_ops-7.6.2/src/src/.libs/libatomic_ops.a ../src/.libs/libatomic_ops.a
  [libatomic_ops-7.6.2]   /opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: ../src/.libs/libatomic_ops_gpl.a(atomic_ops_stack.o): in function `AO_double_compare_and_swap_release':
  [libatomic_ops-7.6.2]   /sage/local/var/tmp/sage/build/libatomic_ops-7.6.2/src/src/atomic_ops/sysdeps/gcc/generic.h:219: undefined reference to `__atomic_compare_exchange_16'
  [libatomic_ops-7.6.2]   collect2: error: ld returned 1 exit status
  [libatomic_ops-7.6.2]   make[7]: *** [Makefile:634: test_malloc] Error 1
```



---

archive/issue_comments_402164.json:
```json
{
    "body": "<a id='comment:50'></a>... as well as giac and fflas_ffpack.\n\nTo reproduce: \n\n```\nEXTRA_DOCKER_BUILD_ARGS=\"--build-arg TARGETS=\\\"build ptest\\\" --build-arg USE_MAKEFLAGS=\\\"-k V=0\\\"\" tox -e docker-conda-forge-standard\n```\non the branch of #27824.",
    "created_at": "2020-03-22T17:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402164",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>... as well as giac and fflas_ffpack.

To reproduce: 

```
EXTRA_DOCKER_BUILD_ARGS="--build-arg TARGETS=\"build ptest\" --build-arg USE_MAKEFLAGS=\"-k V=0\"" tox -e docker-conda-forge-standard
```
on the branch of #27824.



---

archive/issue_comments_402165.json:
```json
{
    "body": "<a id='comment:51'></a>(see also #29327)",
    "created_at": "2020-03-22T18:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402165",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>(see also #29327)



---

archive/issue_comments_402166.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-22T18:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_402167.json:
```json
{
    "body": "<a id='comment:54'></a>Shall we try to get this one here to work for 9.1?",
    "created_at": "2020-04-18T21:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402167",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>Shall we try to get this one here to work for 9.1?



---

archive/issue_comments_402168.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-26T19:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_402169.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2020-04-29T19:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402169",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to minor.



---

archive/issue_events_072506.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T18:16:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28745#event-72506"
}
```



---

archive/issue_events_072507.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T18:16:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28745#event-72507"
}
```



---

archive/issue_comments_402170.json:
```json
{
    "body": "<a id='comment:57'></a>Moving some tickets to 9.2. This is not a promise that I will be working on them.",
    "created_at": "2020-05-01T18:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>Moving some tickets to 9.2. This is not a promise that I will be working on them.



---

archive/issue_events_072508.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28745#event-72508"
}
```



---

archive/issue_events_072509.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28745#event-72509"
}
```



---

archive/issue_comments_402171.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-30T19:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402171",
    "user": "https://github.com/isuruf"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_402172.json:
```json
{
    "body": "<a id='comment:60'></a>I added `SAGE_ROOT/environment.yml` for spkg-configure ones and `SAGE_ROOT/src/environment.yml` for all standard packages. These files are auto generated. Not sure if we should check them into the repo for ease of use.",
    "created_at": "2020-10-30T22:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402172",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:60'></a>I added `SAGE_ROOT/environment.yml` for spkg-configure ones and `SAGE_ROOT/src/environment.yml` for all standard packages. These files are auto generated. Not sure if we should check them into the repo for ease of use.



---

archive/issue_comments_402173.json:
```json
{
    "body": "<a id='comment:62'></a>I don't think the generated files should be checked in - instead they should be added to the list of files that are put into the configure tarball.",
    "created_at": "2020-10-30T22:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402173",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>I don't think the generated files should be checked in - instead they should be added to the list of files that are put into the configure tarball.



---

archive/issue_comments_402174.json:
```json
{
    "body": "<a id='comment:63'></a>See for example commit 885092e77b06b6d616297edd8ac1a37db9113cc6, where files were added",
    "created_at": "2020-10-30T22:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402174",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>See for example commit 885092e77b06b6d616297edd8ac1a37db9113cc6, where files were added



---

archive/issue_comments_402175.json:
```json
{
    "body": "<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-30T22:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402175",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_402176.json:
```json
{
    "body": "<a id='comment:65'></a>Also, if you could untabify `src/doc/bootstrap`...",
    "created_at": "2020-10-30T22:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402176",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>Also, if you could untabify `src/doc/bootstrap`...



---

archive/issue_comments_402177.json:
```json
{
    "body": "<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-30T22:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_402178.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-30T23:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402178",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_402179.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-11-01T10:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402179",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_402180.json:
```json
{
    "body": "<a id='comment:68'></a>Merge conflict",
    "created_at": "2020-11-01T10:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402180",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:68'></a>Merge conflict



---

archive/issue_comments_402181.json:
```json
{
    "body": "<a id='comment:70'></a>New commits:",
    "created_at": "2020-11-01T16:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402181",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>New commits:



---

archive/issue_comments_402182.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-11-01T16:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402182",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_402183.json:
```json
{
    "body": "<a id='comment:71'></a>New commits:",
    "created_at": "2020-11-10T17:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402183",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:71'></a>New commits:



---

archive/issue_comments_402184.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-11-19T23:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402184",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_402185.json:
```json
{
    "body": "<a id='comment:72'></a>Merge conflict",
    "created_at": "2020-11-19T23:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402185",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:72'></a>Merge conflict



---

archive/issue_comments_402186.json:
```json
{
    "body": "<a id='comment:73'></a>Which branch should I fix the conflict against? `develop` doesn't seem to have a conflict with this branch",
    "created_at": "2020-11-19T23:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402186",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:73'></a>Which branch should I fix the conflict against? `develop` doesn't seem to have a conflict with this branch



---

archive/issue_comments_402187.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:73 isuruf]:\n> Which branch should I fix the conflict against? `develop` doesn't seem to have a conflict with this branch\n\n\nit's unfortunate feauture of our workflow that this is a bit of a moving target.\nhttps://github.com/vbraun/sage/tree/develop\n\ndo not try to merge/rebase with it, as it's likely to be in vain.",
    "created_at": "2020-11-20T09:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402187",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:74'></a>Replying to [comment:73 isuruf]:
> Which branch should I fix the conflict against? `develop` doesn't seem to have a conflict with this branch


it's unfortunate feauture of our workflow that this is a bit of a moving target.
https://github.com/vbraun/sage/tree/develop

do not try to merge/rebase with it, as it's likely to be in vain.



---

archive/issue_comments_402188.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-11-23T02:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402188",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_402189.json:
```json
{
    "body": "<a id='comment:77'></a>Last 10 new commits:",
    "created_at": "2020-11-23T02:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402189",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>Last 10 new commits:



---

archive/issue_comments_402190.json:
```json
{
    "body": "<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:",
    "created_at": "2020-11-23T02:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:



---

archive/issue_comments_402191.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-11-23T02:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_402192.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-23T02:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402192",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_402193.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-29T11:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28745#issuecomment-402193",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_072510.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-29T11:57:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28745",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28745#event-72510"
}
```
