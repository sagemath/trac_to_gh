# Issue 28007: Keep upstream three.js directory structure

archive/issues_027770.json:
```json
{
    "assignees": [],
    "body": "Currently sage flattens the threejs directory structure. It still needs to take the actual structure into account when using threejs from a CDN though.\n\nI don't see a reason to flatten the structure. It should be easier for distributions (certainly is for nixos) to keep the structure.\n\nI have only tested this with the nix package, since it is a pain to get the sage build system working on nixos. Would appreciate it if someone else could test the `build/` changes (simple `make ptestlong`).\n\nCC:  @antonio-rojas @kiwifb @saraedum @timokau @paulmasson\n\nKeywords: **threejs**\n\nBranch/Commit: **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**\n\nReviewer: **Paul Masson**\n\nAuthor: **Timo Kaufmann**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28007_\n\n",
    "closed_at": "2019-06-28T04:29:56Z",
    "created_at": "2019-06-17T20:00:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Keep upstream three.js directory structure",
    "type": "issue",
    "updated_at": "2019-06-28T04:29:56Z",
    "url": "https://github.com/sagemath/sage/issues/28007",
    "user": "https://github.com/timokau"
}
```
Currently sage flattens the threejs directory structure. It still needs to take the actual structure into account when using threejs from a CDN though.

I don't see a reason to flatten the structure. It should be easier for distributions (certainly is for nixos) to keep the structure.

I have only tested this with the nix package, since it is a pain to get the sage build system working on nixos. Would appreciate it if someone else could test the `build/` changes (simple `make ptestlong`).

CC:  @antonio-rojas @kiwifb @saraedum @timokau @paulmasson

Keywords: **threejs**

Branch/Commit: **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**

Reviewer: **Paul Masson**

Author: **Timo Kaufmann**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/28007_





---

archive/issue_events_384068.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-17T20:00:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384068"
}
```



---

archive/issue_events_384069.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-17T20:00:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384069"
}
```



---

archive/issue_events_384070.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-17T20:00:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384070"
}
```



---

archive/issue_events_384071.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-17T20:00:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384071"
}
```



---

archive/issue_events_384072.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-17T20:09:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384072"
}
```



---

archive/issue_comments_435823.json:
```json
{
    "body": "Author: **Timo Kaufmann**",
    "created_at": "2019-06-17T20:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435823",
    "user": "https://github.com/timokau"
}
```

Author: **Timo Kaufmann**



---

archive/issue_comments_435824.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68b6f8c3f88c9893807e55f00a8ce8adb6f50fd1\">68b6f8c</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>\n",
    "created_at": "2019-06-17T21:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435824",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68b6f8c3f88c9893807e55f00a8ce8adb6f50fd1">68b6f8c</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>




---

archive/issue_comments_435825.json:
```json
{
    "body": "Changed commit from **[`38e4207`](https://github.com/sagemath/sagetrac-mirror/commit/38e420749bcd8a71319a06ebf8962ba5074335b0)** to **[`68b6f8c`](https://github.com/sagemath/sagetrac-mirror/commit/68b6f8c3f88c9893807e55f00a8ce8adb6f50fd1)**",
    "created_at": "2019-06-17T21:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435825",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`38e4207`](https://github.com/sagemath/sagetrac-mirror/commit/38e420749bcd8a71319a06ebf8962ba5074335b0)** to **[`68b6f8c`](https://github.com/sagemath/sagetrac-mirror/commit/68b6f8c3f88c9893807e55f00a8ce8adb6f50fd1)**



---

archive/issue_comments_435826.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIf you do that, the package will need a rev-bump to be re-installed.",
    "created_at": "2019-06-17T21:20:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435826",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">comment:3</div>

If you do that, the package will need a rev-bump to be re-installed.



---

archive/issue_comments_435827.json:
```json
{
    "body": "Changed keywords from none to **threejs**",
    "created_at": "2019-06-17T22:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435827",
    "user": "https://github.com/paulmasson"
}
```

Changed keywords from none to **threejs**



---

archive/issue_comments_435828.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nTimo, please explain how this makes things simpler for a distribution. It seems to me like extra complication for two files. Are you thinking of having some automatic mechanism for shifting between local files and a CDN?",
    "created_at": "2019-06-17T22:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435828",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:5" align="right">comment:5</div>

Timo, please explain how this makes things simpler for a distribution. It seems to me like extra complication for two files. Are you thinking of having some automatic mechanism for shifting between local files and a CDN?



---

archive/issue_comments_435829.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWhat are you installing in nix to find it a burden to change the structure? Because it didn't appear that we are using an upstream tarball I just used sage's one in sage-on-gentoo. Admittedly, I call the package `threejs-sage-extension` and it is installed in a sage related location rather then something more generic.\n\nI am curious of your install procedure and if it make sense for me to follow suite.",
    "created_at": "2019-06-18T01:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435829",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

What are you installing in nix to find it a burden to change the structure? Because it didn't appear that we are using an upstream tarball I just used sage's one in sage-on-gentoo. Admittedly, I call the package `threejs-sage-extension` and it is installed in a sage related location rather then something more generic.

I am curious of your install procedure and if it make sense for me to follow suite.



---

archive/issue_comments_435830.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRegardless of anything else `THREEJSDIR` should be used like you do in this branch even if we don't end up flattening the structure. That would be worth a ticket by itself.",
    "created_at": "2019-06-18T01:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435830",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

Regardless of anything else `THREEJSDIR` should be used like you do in this branch even if we don't end up flattening the structure. That would be worth a ticket by itself.



---

archive/issue_comments_435831.json:
```json
{
    "body": "Changed commit from **[`68b6f8c`](https://github.com/sagemath/sagetrac-mirror/commit/68b6f8c3f88c9893807e55f00a8ce8adb6f50fd1)** to **[`1f7d28e`](https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107)**",
    "created_at": "2019-06-18T10:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435831",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`68b6f8c`](https://github.com/sagemath/sagetrac-mirror/commit/68b6f8c3f88c9893807e55f00a8ce8adb6f50fd1)** to **[`1f7d28e`](https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107)**



---

archive/issue_comments_435832.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed5477a64c2cce16378f6618b54efb3dcf0454ae\">ed5477a</a></td><td><code>Consistently THREEJS_DIR for threejs location</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107\">1f7d28e</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>\n",
    "created_at": "2019-06-18T10:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435832",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed5477a64c2cce16378f6618b54efb3dcf0454ae">ed5477a</a></td><td><code>Consistently THREEJS_DIR for threejs location</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107">1f7d28e</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>




---

archive/issue_comments_435833.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI bumped the patch version and made a separate commit for the `THREEJS_DIR` usage.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed5477a64c2cce16378f6618b54efb3dcf0454ae\">ed5477a</a></td><td><code>Consistently THREEJS_DIR for threejs location</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107\">1f7d28e</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>\n",
    "created_at": "2019-06-18T10:02:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435833",
    "user": "https://github.com/timokau"
}
```

<div id="comment:9" align="right">comment:9</div>

I bumped the patch version and made a separate commit for the `THREEJS_DIR` usage.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed5477a64c2cce16378f6618b54efb3dcf0454ae">ed5477a</a></td><td><code>Consistently THREEJS_DIR for threejs location</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107">1f7d28e</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>




---

archive/issue_comments_435834.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@paulmasson](#comment:5):\n> Timo, please explain how this makes things simpler for a distribution. It seems to me like extra complication for two files. Are you thinking of having some automatic mechanism for shifting between local files and a CDN?\n\nWell sage doesn't actually build anything, it just cherry-picks \"binaries\" (or as close as javascript can come to binaries) from a CDN. If you actually \"build\" the whole threejs package, you'll end up with the upstream directory structure. I'd need to patch sage or create a separate \"interface\" package that only symlinks the two files to the places sage expects them.\n\n@kiwifb we have some (suboptimal) npm [infrastructure](https://nixos.org/nixpkgs/manual/#node.js-packages) to package javascript packages, that is what I'm using. As far as I understand it (I haven't really looked into it) it scrapes npm for the dependencies, generates the build recipes, fetches each package from the npm registry and then builds them. So basically a wrapper around npm that takes over all network activity while still using npm for the actual building.",
    "created_at": "2019-06-18T10:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435834",
    "user": "https://github.com/timokau"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@paulmasson](#comment:5):
> Timo, please explain how this makes things simpler for a distribution. It seems to me like extra complication for two files. Are you thinking of having some automatic mechanism for shifting between local files and a CDN?

Well sage doesn't actually build anything, it just cherry-picks "binaries" (or as close as javascript can come to binaries) from a CDN. If you actually "build" the whole threejs package, you'll end up with the upstream directory structure. I'd need to patch sage or create a separate "interface" package that only symlinks the two files to the places sage expects them.

@kiwifb we have some (suboptimal) npm [infrastructure](https://nixos.org/nixpkgs/manual/#node.js-packages) to package javascript packages, that is what I'm using. As far as I understand it (I haven't really looked into it) it scrapes npm for the dependencies, generates the build recipes, fetches each package from the npm registry and then builds them. So basically a wrapper around npm that takes over all network activity while still using npm for the actual building.



---

archive/issue_comments_435835.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nRight, npm stuff is a pain. I don't see an updated `package-version.txt` and `checksums.ini`. But technically the real problem is you want to change the tarball without changing the version. That is a bit of a challenge. The nice way to do that is to do an upgrade at the same time so the problem with the tarball change is avoided.",
    "created_at": "2019-06-18T10:21:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435835",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

Right, npm stuff is a pain. I don't see an updated `package-version.txt` and `checksums.ini`. But technically the real problem is you want to change the tarball without changing the version. That is a bit of a challenge. The nice way to do that is to do an upgrade at the same time so the problem with the tarball change is avoided.



---

archive/issue_comments_435836.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763\">20b010c</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>\n",
    "created_at": "2019-06-18T17:23:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435836",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763">20b010c</a></td><td><code>Keep the upstream threejs directory structure</code></td></tr></table>




---

archive/issue_comments_435837.json:
```json
{
    "body": "Changed commit from **[`1f7d28e`](https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107)** to **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)**",
    "created_at": "2019-06-18T17:23:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435837",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1f7d28e`](https://github.com/sagemath/sagetrac-mirror/commit/1f7d28e6728143f6dc496c19b1f93abcc620d107)** to **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)**



---

archive/issue_comments_435838.json:
```json
{
    "body": "Changed commit from **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)** to **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**",
    "created_at": "2019-06-18T17:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435838",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)** to **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**



---

archive/issue_comments_435839.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422\">4a69f3b</a></td><td><code>Update threejs to r105</code></td></tr></table>\n",
    "created_at": "2019-06-18T17:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435839",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422">4a69f3b</a></td><td><code>Update threejs to r105</code></td></tr></table>




---

archive/issue_comments_435840.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nRight, somehow failed to push that.\n\nWhy is that a challenge? Can't I just add `.p1` to the version? In any case, I also added an update.",
    "created_at": "2019-06-18T17:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435840",
    "user": "https://github.com/timokau"
}
```

<div id="comment:14" align="right">comment:14</div>

Right, somehow failed to push that.

Why is that a challenge? Can't I just add `.p1` to the version? In any case, I also added an update.



---

archive/issue_comments_435841.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@kiwifb](#comment:11):\n> Right, npm stuff is a pain.\n\nLife was good when there was only make and autotools. At least for packagers that is.",
    "created_at": "2019-06-18T17:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435841",
    "user": "https://github.com/timokau"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@kiwifb](#comment:11):
> Right, npm stuff is a pain.

Life was good when there was only make and autotools. At least for packagers that is.



---

archive/issue_comments_435842.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@timokau](#comment:10):\n> Replying to [@paulmasson](#comment:5):\n> > Timo, please explain how this makes things simpler for a distribution. It seems to me like extra complication for two files. Are you thinking of having some automatic mechanism for shifting between local files and a CDN?\n\n> \n> Well sage doesn't actually build anything, it just cherry-picks \"binaries\" (or as close as javascript can come to binaries) from a CDN. If you actually \"build\" the whole threejs package, you'll end up with the upstream directory structure. I'd need to patch sage or create a separate \"interface\" package that only symlinks the two files to the places sage expects them.\n\nAs the main author of the Three.js viewer, I can practically guarantee that Sage will never build all of Three.js since only a small portion of the entire library will ever get used in practice. Given that, keeping the original directory structure really is an extra complication without much practical gain.",
    "created_at": "2019-06-18T19:31:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435842",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@timokau](#comment:10):
> Replying to [@paulmasson](#comment:5):
> > Timo, please explain how this makes things simpler for a distribution. It seems to me like extra complication for two files. Are you thinking of having some automatic mechanism for shifting between local files and a CDN?

> 
> Well sage doesn't actually build anything, it just cherry-picks "binaries" (or as close as javascript can come to binaries) from a CDN. If you actually "build" the whole threejs package, you'll end up with the upstream directory structure. I'd need to patch sage or create a separate "interface" package that only symlinks the two files to the places sage expects them.

As the main author of the Three.js viewer, I can practically guarantee that Sage will never build all of Three.js since only a small portion of the entire library will ever get used in practice. Given that, keeping the original directory structure really is an extra complication without much practical gain.



---

archive/issue_comments_435843.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@sagetrac-git](#comment:13):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n\n|                                                                                                                                                 |                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[4a69f3b](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)|`Update threejs to r105`|\nIn the context of Three.js this is a bad idea. Upgrades are very often not backward compatible. An upgrade of Three.js should always happen on a separate ticket to be sure the template I wrote still works properly with the new version. Believe me, there were definite issues the last time I did an upgrade. Unless you use Three.js on a regular basis and are certain nothing is broken, please remove this upgrade.",
    "created_at": "2019-06-18T19:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435843",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@sagetrac-git](#comment:13):
> Branch pushed to git repo; I updated commit sha1. New commits:

|                                                                                                                                                 |                        |
|-------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[4a69f3b](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)|`Update threejs to r105`|
In the context of Three.js this is a bad idea. Upgrades are very often not backward compatible. An upgrade of Three.js should always happen on a separate ticket to be sure the template I wrote still works properly with the new version. Believe me, there were definite issues the last time I did an upgrade. Unless you use Three.js on a regular basis and are certain nothing is broken, please remove this upgrade.



---

archive/issue_events_384073.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-06-18T19:35:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384073"
}
```



---

archive/issue_events_384074.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-06-18T19:35:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384074"
}
```



---

archive/issue_comments_435844.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@paulmasson](#comment:16):\n> As the main author of the Three.js viewer, I can practically guarantee that Sage will never build all of Three.js since only a small portion of the entire library will ever get used in practice\n\nYes, but there is value in standardizing the directory structure. While sage only packages threejs for a single purpose, distributions usually have multiple consumers in mind. If every package expects the threejs files in a different place, everyones lives are harder.\n\nI don't really see much of a complication here. Since it makes the `offline` code closer to the one that fetches from the CDN, it may even simplify in the future. But in any case, I don't see any complication for sage.",
    "created_at": "2019-06-18T19:37:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435844",
    "user": "https://github.com/timokau"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@paulmasson](#comment:16):
> As the main author of the Three.js viewer, I can practically guarantee that Sage will never build all of Three.js since only a small portion of the entire library will ever get used in practice

Yes, but there is value in standardizing the directory structure. While sage only packages threejs for a single purpose, distributions usually have multiple consumers in mind. If every package expects the threejs files in a different place, everyones lives are harder.

I don't really see much of a complication here. Since it makes the `offline` code closer to the one that fetches from the CDN, it may even simplify in the future. But in any case, I don't see any complication for sage.



---

archive/issue_comments_435845.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-18T19:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435845",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_435846.json:
```json
{
    "body": "Changed commit from **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)** to **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)**",
    "created_at": "2019-06-18T19:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435846",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)** to **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)**



---

archive/issue_comments_435847.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@paulmasson](#comment:17):\n> Replying to [@sagetrac-git](#comment:13):\n> > Branch pushed to git repo; I updated commit sha1. New commits:\n\n> |                                                                                                                                                 |                        |\n> |-------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n> |[4a69f3b](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)|`Update threejs to r105`|\n> In the context of Three.js this is a bad idea. Upgrades are very often not backward compatible. An upgrade of Three.js should always happen on a separate ticket to be sure the template I wrote still works properly with the new version. Believe me, there were definite issues the last time I did an upgrade. Unless you use Three.js on a regular basis and are certain nothing is broken, please remove this upgrade.\n\nOkay, I've undone that commit. Does anyone know how `spkg-src` works with volkers workflow? Do I need to upload the new tarball anywhere?",
    "created_at": "2019-06-18T19:40:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435847",
    "user": "https://github.com/timokau"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@paulmasson](#comment:17):
> Replying to [@sagetrac-git](#comment:13):
> > Branch pushed to git repo; I updated commit sha1. New commits:

> |                                                                                                                                                 |                        |
> |-------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
> |[4a69f3b](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)|`Update threejs to r105`|
> In the context of Three.js this is a bad idea. Upgrades are very often not backward compatible. An upgrade of Three.js should always happen on a separate ticket to be sure the template I wrote still works properly with the new version. Believe me, there were definite issues the last time I did an upgrade. Unless you use Three.js on a regular basis and are certain nothing is broken, please remove this upgrade.

Okay, I've undone that commit. Does anyone know how `spkg-src` works with volkers workflow? Do I need to upload the new tarball anywhere?



---

archive/issue_comments_435848.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@timokau](#comment:20):\n> Replying to [@paulmasson](#comment:17):\n> > Replying to [@sagetrac-git](#comment:13):\n> > > Branch pushed to git repo; I updated commit sha1. New commits:\n\n> > |                                                                                                                                                 |                        |\n> > |-------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n> > |[4a69f3b](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)|`Update threejs to r105`|\n> > In the context of Three.js this is a bad idea. Upgrades are very often not backward compatible. An upgrade of Three.js should always happen on a separate ticket to be sure the template I wrote still works properly with the new version. Believe me, there were definite issues the last time I did an upgrade. Unless you use Three.js on a regular basis and are certain nothing is broken, please remove this upgrade.\n\n> \n> Okay, I've undone that commit. Does anyone know how `spkg-src` works with volkers workflow? Do I need to upload the new tarball anywhere?\n\nJust attach it to this ticket. Volker does the rest.",
    "created_at": "2019-06-18T19:44:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435848",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@timokau](#comment:20):
> Replying to [@paulmasson](#comment:17):
> > Replying to [@sagetrac-git](#comment:13):
> > > Branch pushed to git repo; I updated commit sha1. New commits:

> > |                                                                                                                                                 |                        |
> > |-------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
> > |[4a69f3b](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)|`Update threejs to r105`|
> > In the context of Three.js this is a bad idea. Upgrades are very often not backward compatible. An upgrade of Three.js should always happen on a separate ticket to be sure the template I wrote still works properly with the new version. Believe me, there were definite issues the last time I did an upgrade. Unless you use Three.js on a regular basis and are certain nothing is broken, please remove this upgrade.

> 
> Okay, I've undone that commit. Does anyone know how `spkg-src` works with volkers workflow? Do I need to upload the new tarball anywhere?

Just attach it to this ticket. Volker does the rest.



---

archive/issue_comments_435849.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@timokau](#comment:18):\n> Replying to [@paulmasson](#comment:16):\n> > As the main author of the Three.js viewer, I can practically guarantee that Sage will never build all of Three.js since only a small portion of the entire library will ever get used in practice\n\n> \n> Yes, but there is value in standardizing the directory structure. While sage only packages threejs for a single purpose, distributions usually have multiple consumers in mind. If every package expects the threejs files in a different place, everyones lives are harder.\n\nThen I guess I don\u2019t have an objection, but would like other packagers to chime in.",
    "created_at": "2019-06-18T19:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435849",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@timokau](#comment:18):
> Replying to [@paulmasson](#comment:16):
> > As the main author of the Three.js viewer, I can practically guarantee that Sage will never build all of Three.js since only a small portion of the entire library will ever get used in practice

> 
> Yes, but there is value in standardizing the directory structure. While sage only packages threejs for a single purpose, distributions usually have multiple consumers in mind. If every package expects the threejs files in a different place, everyones lives are harder.

Then I guess I don’t have an objection, but would like other packagers to chime in.



---

archive/issue_comments_435850.json:
```json
{
    "body": "Soruce tarball",
    "created_at": "2019-06-18T19:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435850",
    "user": "https://github.com/timokau"
}
```

Soruce tarball



---

archive/issue_events_384075.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-18T19:55:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384075"
}
```



---

archive/issue_events_384076.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-18T19:55:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384076"
}
```



---

archive/issue_comments_435851.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAttachment: **[threejs-r100.tar.gz](https://github.com/sagemath/sage/files/ticket28007/threejs-r100.tar.gz)**",
    "created_at": "2019-06-18T19:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435851",
    "user": "https://github.com/timokau"
}
```

<div id="comment:23" align="right">comment:23</div>

Attachment: **[threejs-r100.tar.gz](https://github.com/sagemath/sage/files/ticket28007/threejs-r100.tar.gz)**



---

archive/issue_comments_435852.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@timokau](#comment:14):\n> Right, somehow failed to push that.\n> \n> Why is that a challenge? Can't I just add `.p1` to the version? In any case, I also added an update.\n\nBecause pkg-$version and pkg-$version.p$number are supposed to have the same tarball in sage's package management system. Which is a problem when the online package repo has to hold tarballs for several versions of sage, see http://mirror.aarnet.edu.au/pub/sage/spkg/upstream/threejs/index.html for a relevant example. This is where patchbot gets their packages by the way.",
    "created_at": "2019-06-18T20:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435852",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@timokau](#comment:14):
> Right, somehow failed to push that.
> 
> Why is that a challenge? Can't I just add `.p1` to the version? In any case, I also added an update.

Because pkg-$version and pkg-$version.p$number are supposed to have the same tarball in sage's package management system. Which is a problem when the online package repo has to hold tarballs for several versions of sage, see http://mirror.aarnet.edu.au/pub/sage/spkg/upstream/threejs/index.html for a relevant example. This is where patchbot gets their packages by the way.



---

archive/issue_events_384077.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-18T20:13:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384077"
}
```



---

archive/issue_events_384078.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-06-18T20:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384078"
}
```



---

archive/issue_comments_435853.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAh, I see. That is annoying. @paulmasson since you've added the package and made the last two updates, do you plan to update it again in the future? If so, would you mind just basing that update on my branch?\n\nThat'd be the easiest solution, and I'm not in a hurry (I'm already patching sage anyways).",
    "created_at": "2019-06-18T20:17:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435853",
    "user": "https://github.com/timokau"
}
```

<div id="comment:26" align="right">comment:26</div>

Ah, I see. That is annoying. @paulmasson since you've added the package and made the last two updates, do you plan to update it again in the future? If so, would you mind just basing that update on my branch?

That'd be the easiest solution, and I'm not in a hurry (I'm already patching sage anyways).



---

archive/issue_comments_435854.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@timokau](#comment:26):\n> Ah, I see. That is annoying. @paulmasson since you've added the package and made the last two updates, do you plan to update it again in the future? If so, would you mind just basing that update on my branch?\n> \n> That'd be the easiest solution, and I'm not in a hurry (I'm already patching sage anyways).\n\nJust did some local testing with r105 and didn't see any major problems with this version. If you want to add the upgrade back in then I'll review the ticket. Sorry for creating the extra work for you, but I always try to remind people of possible issues with upgrading Three.js.",
    "created_at": "2019-06-18T21:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435854",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@timokau](#comment:26):
> Ah, I see. That is annoying. @paulmasson since you've added the package and made the last two updates, do you plan to update it again in the future? If so, would you mind just basing that update on my branch?
> 
> That'd be the easiest solution, and I'm not in a hurry (I'm already patching sage anyways).

Just did some local testing with r105 and didn't see any major problems with this version. If you want to add the upgrade back in then I'll review the ticket. Sorry for creating the extra work for you, but I always try to remind people of possible issues with upgrading Three.js.



---

archive/issue_comments_435855.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422\">4a69f3b</a></td><td><code>Update threejs to r105</code></td></tr></table>\n",
    "created_at": "2019-06-18T21:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435855",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422">4a69f3b</a></td><td><code>Update threejs to r105</code></td></tr></table>




---

archive/issue_comments_435856.json:
```json
{
    "body": "Changed commit from **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)** to **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**",
    "created_at": "2019-06-18T21:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435856",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`20b010c`](https://github.com/sagemath/sagetrac-mirror/commit/20b010c09cfd33f035371c79a3466372018bf763)** to **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**



---

archive/issue_comments_435857.json:
```json
{
    "body": "Up-to-date source tarball",
    "created_at": "2019-06-18T21:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435857",
    "user": "https://github.com/timokau"
}
```

Up-to-date source tarball



---

archive/issue_comments_435858.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAttachment: **[threejs-r105.tar.gz](https://github.com/sagemath/sage/files/ticket28007/threejs-r105.tar.gz)**\n\nNot a problem, dealing with backwards incompatibility is always annoying. Update re-added.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422\">4a69f3b</a></td><td><code>Update threejs to r105</code></td></tr></table>\n",
    "created_at": "2019-06-18T21:50:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435858",
    "user": "https://github.com/timokau"
}
```

<div id="comment:29" align="right">comment:29</div>

Attachment: **[threejs-r105.tar.gz](https://github.com/sagemath/sage/files/ticket28007/threejs-r105.tar.gz)**

Not a problem, dealing with backwards incompatibility is always annoying. Update re-added.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422">4a69f3b</a></td><td><code>Update threejs to r105</code></td></tr></table>




---

archive/issue_comments_435859.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\ngh-timokau: #26434 might also make this problem go away? (In a somewhat brutal manner.)",
    "created_at": "2019-06-18T22:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435859",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:30" align="right">comment:30</div>

gh-timokau: #26434 might also make this problem go away? (In a somewhat brutal manner.)



---

archive/issue_comments_435860.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI think it may indeed. It certainly addresses some points raised here. I quite like #26434 (beside the obvious reason of removing `installed_packages`).",
    "created_at": "2019-06-18T22:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435860",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

I think it may indeed. It certainly addresses some points raised here. I quite like #26434 (beside the obvious reason of removing `installed_packages`).



---

archive/issue_comments_435861.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nTo be clear, there should be coordination between the tickets. #26434 does a lot of the dealing internally with script locations. But this ticket is talking about changing the way threejs is packaged and installed. And because the cleanest way to achieve this is an upgrade, it does that too. \n\nAdopting #26434 means this ticket can do its packaging changes without touching \"sage\"'s code.",
    "created_at": "2019-06-18T22:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435861",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

To be clear, there should be coordination between the tickets. #26434 does a lot of the dealing internally with script locations. But this ticket is talking about changing the way threejs is packaged and installed. And because the cleanest way to achieve this is an upgrade, it does that too. 

Adopting #26434 means this ticket can do its packaging changes without touching "sage"'s code.



---

archive/issue_comments_435862.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@saraedum](#comment:30):\n> gh-timokau: #26434 might also make this problem go away? (In a somewhat brutal manner.)\n\nThat ticket appears to remove the online, i.e. CDN scripts, completely and only uses local scripts. How will that allow people to create and share notebooks? The CDN fallback was fixed in #27575 and would likely have addressed the issues you encountered at the conference.",
    "created_at": "2019-06-18T22:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435862",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@saraedum](#comment:30):
> gh-timokau: #26434 might also make this problem go away? (In a somewhat brutal manner.)

That ticket appears to remove the online, i.e. CDN scripts, completely and only uses local scripts. How will that allow people to create and share notebooks? The CDN fallback was fixed in #27575 and would likely have addressed the issues you encountered at the conference.



---

archive/issue_comments_435863.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\n@paulmasson the issue that #26434 originally seeks to address is that sage is calling its internal package management to figure out the version of threejs to look for. For us on distro it is not feasible or desirable.",
    "created_at": "2019-06-18T22:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435863",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34" align="right">comment:34</div>

@paulmasson the issue that #26434 originally seeks to address is that sage is calling its internal package management to figure out the version of threejs to look for. For us on distro it is not feasible or desirable.



---

archive/issue_comments_435864.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@kiwifb](#comment:32):\n> Adopting #26434 means this ticket can do its packaging changes without touching \"sage\"'s code.\n\nHow is that? #26434 still contains this line:\n\n```\nscripts = [os.path.join(THREEJS_DIR, script) for script in ['three.min.js', 'OrbitControls.js']]\n```",
    "created_at": "2019-06-19T08:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435864",
    "user": "https://github.com/timokau"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@kiwifb](#comment:32):
> Adopting #26434 means this ticket can do its packaging changes without touching "sage"'s code.

How is that? #26434 still contains this line:

```
scripts = [os.path.join(THREEJS_DIR, script) for script in ['three.min.js', 'OrbitControls.js']]
```



---

archive/issue_comments_435865.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@timokau](#comment:35):\n> Replying to [@kiwifb](#comment:32):\n> > Adopting #26434 means this ticket can do its packaging changes without touching \"sage\"'s code.\n\n> \n> How is that? #26434 still contains this line:\n> \n> ```\n> scripts = [os.path.join(THREEJS_DIR, script) for script in ['three.min.js', 'OrbitControls.js']]\n> ```\n\nYou are right. I misread something this morning, I thought it was walking in any subdirectories for some reason.",
    "created_at": "2019-06-19T09:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435865",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@timokau](#comment:35):
> Replying to [@kiwifb](#comment:32):
> > Adopting #26434 means this ticket can do its packaging changes without touching "sage"'s code.

> 
> How is that? #26434 still contains this line:
> 
> ```
> scripts = [os.path.join(THREEJS_DIR, script) for script in ['three.min.js', 'OrbitControls.js']]
> ```

You are right. I misread something this morning, I thought it was walking in any subdirectories for some reason.



---

archive/issue_comments_435866.json:
```json
{
    "body": "Reviewer: **Paul Masson**",
    "created_at": "2019-06-19T23:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435866",
    "user": "https://github.com/paulmasson"
}
```

Reviewer: **Paul Masson**



---

archive/issue_events_384079.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-06-19T23:56:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384079"
}
```



---

archive/issue_events_384080.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-06-19T23:56:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384080"
}
```



---

archive/issue_comments_435867.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nLGTM",
    "created_at": "2019-06-19T23:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435867",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:37" align="right">comment:37</div>

LGTM



---

archive/issue_events_384081.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-06-19T23:56:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384081"
}
```



---

archive/issue_events_384082.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-06-19T23:56:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384082"
}
```



---

archive/issue_comments_435868.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThank you for the review!",
    "created_at": "2019-06-20T11:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435868",
    "user": "https://github.com/timokau"
}
```

<div id="comment:38" align="right">comment:38</div>

Thank you for the review!



---

archive/issue_events_384083.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-28T04:29:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384083"
}
```



---

archive/issue_events_384084.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4abf1fa505beded23c157e82a721df4888ebf097",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-06-28T04:29:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28007#event-384084"
}
```



---

archive/issue_comments_435869.json:
```json
{
    "body": "Changed branch from **[u/gh-timokau/threejs-directory-structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/threejs-directory-structure)** to **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**",
    "created_at": "2019-06-28T04:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28007#issuecomment-435869",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-timokau/threejs-directory-structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/threejs-directory-structure)** to **[`4a69f3b`](https://github.com/sagemath/sagetrac-mirror/commit/4a69f3bacfbc7c0864ab4097080773bfe6590422)**
