# Issue 28925: Modify find_python_sources to support modularization of sagelib by native namespace packages (PEP 420)

archive/issues_028688.json:
```json
{
    "body": "This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n\nOrdinary packages (directories of modules) can be turned into namespace packages by removing the empty `__init__.py` file.\nThen several distribution package can share the same namespace. \n\nBecause our source discovery mechanism in sagelib's build system (`setup.py` + `sage_setup`) distinguishes package directories from other directories containing data files by the presence of the `__init__.py` file, the present ticket makes several adjustments to the build system - in particular to the functions `find_python_sources` and `find_extra_files`.\n\nPer convention in the Sage library, namespace packages are recognized by the presence of `all.py` or `all__*.py` files (#33033).\n\nIn this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, \nin which `__init__.py` are removed from the `MANIFEST.in` files.\n\nBecause the actual files are not removed from the source tree, the normal build of the Sage distribution is not affected.\n\nTo test these two distributions:\n\n```\n./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-objects && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'\n\n./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-categories && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'\n```\n\nFollow-up tickets:\n- #33011 Remove the `__init__.py` files for packages designated to be namespace packages\n- Wishlist item: Warn or give errors if the `sage_setup: distribution` directives, `namespace` and `nonamespace` files indicate an inconsistent structure such as when it was forgotten to remove `__init__.py`.\n- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n\nSee also:\n- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n- #21654: `src/setup.py`: Disentangle cleaning of stale installed files in build directory and in install directory\n\n\n\n\nCC:  @isuruf @embray @jdemeyer @dimpase @dcoudert @videlec @vbraun @tobiasdiez @kiwifb\n\nKeywords: sd111\n\nBranch/Commit: f9df1ae6eef3dd955d060ca8005b9ed3f5af3974\n\nReviewer: Kwankyu Lee, Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nDependencies: #33803\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28925\n\n",
    "closed_at": "2022-07-10T22:35:02Z",
    "created_at": "2019-12-30T01:31:06Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Modify find_python_sources to support modularization of sagelib by native namespace packages (PEP 420)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28925",
    "user": "https://github.com/mkoeppe"
}
```
This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.

Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty `__init__.py` file.
Then several distribution package can share the same namespace. 

Because our source discovery mechanism in sagelib's build system (`setup.py` + `sage_setup`) distinguishes package directories from other directories containing data files by the presence of the `__init__.py` file, the present ticket makes several adjustments to the build system - in particular to the functions `find_python_sources` and `find_extra_files`.

Per convention in the Sage library, namespace packages are recognized by the presence of `all.py` or `all__*.py` files (#33033).

In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, 
in which `__init__.py` are removed from the `MANIFEST.in` files.

Because the actual files are not removed from the source tree, the normal build of the Sage distribution is not affected.

To test these two distributions:

```
./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-objects && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'

./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-categories && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'
```

Follow-up tickets:
- #33011 Remove the `__init__.py` files for packages designated to be namespace packages
- Wishlist item: Warn or give errors if the `sage_setup: distribution` directives, `namespace` and `nonamespace` files indicate an inconsistent structure such as when it was forgotten to remove `__init__.py`.
- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages

See also:
- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
- #21654: `src/setup.py`: Disentangle cleaning of stale installed files in build directory and in install directory




CC:  @isuruf @embray @jdemeyer @dimpase @dcoudert @videlec @vbraun @tobiasdiez @kiwifb

Keywords: sd111

Branch/Commit: f9df1ae6eef3dd955d060ca8005b9ed3f5af3974

Reviewer: Kwankyu Lee, Dima Pasechnik

Author: Matthias Koeppe

Dependencies: #33803

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28925





---

archive/issue_comments_431309.json:
```json
{
    "body": "<a id='comment:1'></a>pushing these forward to 9.2",
    "created_at": "2020-04-14T06:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431309",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>pushing these forward to 9.2



---

archive/issue_events_073225.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T06:38:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73225"
}
```



---

archive/issue_comments_431310.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,12 @@\n As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of namespace packages - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n \n One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701 Meta-ticket: Replace use of OptionalExtension by namespace packages\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-05-17T21:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431310",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,12 @@
 As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of namespace packages - See ​https://packaging.python.org/guides/packaging-namespace-packages/
 
 One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701 Meta-ticket: Replace use of OptionalExtension by namespace packages
+
 
 Comment: 1
 
```




---

archive/issue_comments_431311.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of namespace packages - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701 Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-17T21:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431311",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,11 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of namespace packages - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701 Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
 
 
 Comment: 1
```




---

archive/issue_comments_431312.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701 Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-17T21:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431312",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,11 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701 Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
 
 
 Comment: 1
```




---

archive/issue_comments_431313.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701 Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #21654 \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-18T00:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431313",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,12 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701 Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #21654 \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431314.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. We either need to list the namespace package explicitly in \\`setup.py\\` (\\`packages=python_packages + find_namespace_packages(include=['sage.x.y.z'])\\`), or invent something Sage-specific... such as a comment on the top of a module file that indicates into which distutils package a given module belongs...\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-18T00:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431314",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,15 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. We either need to list the namespace package explicitly in \`setup.py\` (\`packages=python_packages + find_namespace_packages(include=['sage.x.y.z'])\`), or invent something Sage-specific... such as a comment on the top of a module file that indicates into which distutils package a given module belongs...
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431315.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) We either need to list the namespace package explicitly in \\`setup.py\\` (\\`packages=python_packages + find_namespace_packages(include=['sage.x.y.z'])\\`), ...\n+\n+   b) or invent something Sage-specific... such as a comment on the top of a module file that indicates into which distutils package a given module belongs...\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. We should probably create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-18T21:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431315",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,28 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) We either need to list the namespace package explicitly in \`setup.py\` (\`packages=python_packages + find_namespace_packages(include=['sage.x.y.z'])\`), ...
+
+   b) or invent something Sage-specific... such as a comment on the top of a module file that indicates into which distutils package a given module belongs...
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. We should probably create a function similar to \`find_python_sources\` for this as well.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431316.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) We either need to list the namespace package explicitly in \\`setup.py\\` (\\`packages=python_packages + find_namespace_packages(include=['sage.x.y.z'])\\`), ...\n+\n+   b) or invent something Sage-specific... such as a comment on the top of a module file that indicates into which distutils package a given module belongs...\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. We should probably create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-19T04:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431316",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,28 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) We either need to list the namespace package explicitly in \`setup.py\` (\`packages=python_packages + find_namespace_packages(include=['sage.x.y.z'])\`), ...
+
+   b) or invent something Sage-specific... such as a comment on the top of a module file that indicates into which distutils package a given module belongs...
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. We should probably create a function similar to \`find_python_sources\` for this as well.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431317.json:
```json
{
    "body": "<a id='comment:11'></a>New commits:",
    "created_at": "2020-05-20T04:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431317",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>New commits:



---

archive/issue_comments_431318.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,30 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`\\`nonamespace\\`\\` (I just made this up, in analogy to the \\`\\`nodoctest\\`\\` file).\n+\n+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. We should probably create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-20T04:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431318",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,30 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`\`nonamespace\`\` (I just made this up, in analogy to the \`\`nodoctest\`\` file).
+
+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. We should probably create a function similar to \`find_python_sources\` for this as well.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431319.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`\\`nonamespace\\`\\` (I just made this up, in analogy to the \\`\\`nodoctest\\`\\` file).\n+\n+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-20T04:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431319",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`\`nonamespace\`\` (I just made this up, in analogy to the \`\`nodoctest\`\` file).
+
+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Create a function similar to \`find_python_sources\` for this as well.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431320.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`\\`nonamespace\\`\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-20T04:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431320",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`\`nonamespace\`\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Create a function similar to \`find_python_sources\` for this as well.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431321.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this on one example module: \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package.\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-20T04:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431321",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Create a function similar to \`find_python_sources\` for this as well.
+
+We test this on one example module: \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package.
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431322.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-20T05:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431323.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,36 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:\n+\n+\\`\\`\\`\n+   # distutils_package: sage_tdlib\n+\\`\\`\\`\n+    (This would be parsed by \\`find_python_sources\\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.)\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Create a function similar to \\`find_python_sources\\` for this as well.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-20T05:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431323",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,36 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) TBD: Mark Python modules as belonging to a specific distutils package, using a comment on the top of a module file:
+
+\`\`\`
+   # distutils_package: sage_tdlib
+\`\`\`
+    (This would be parsed by \`find_python_sources\`, which would also warn or give errors if these comments indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.)
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Create a function similar to \`find_python_sources\` for this as well.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431324.json:
```json
{
    "body": "<a id='comment:18'></a>Next steps: adjust the cleaner, find Cython sources",
    "created_at": "2020-05-20T05:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431324",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Next steps: adjust the cleaner, find Cython sources



---

archive/issue_comments_431325.json:
```json
{
    "body": "<a id='comment:19'></a>The Cython source finder could perhaps also parse a new directive that controls `OptionalExtension` behavior (until we get rid of `OptionalExtension` altogether in #29701) so that we can get rid of `module_list.py` completely (see #29706)",
    "created_at": "2020-05-20T05:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431325",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>The Cython source finder could perhaps also parse a new directive that controls `OptionalExtension` behavior (until we get rid of `OptionalExtension` altogether in #29701) so that we can get rid of `module_list.py` completely (see #29706)



---

archive/issue_comments_431326.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-20T22:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431327.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,38 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) Mark Python modules as belonging to a specific distutils package, using a distutils directive on the top of a module file:\n+\n+\\`\\`\\`\n+   # distutils: sage_package: sage_tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives by using existing Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Extend \\`find_python_sources\\` so that it returns Cython modules as an additional result, handling \\`OptionalExtensions\\` logic via the new \\`sage_package\\` directive.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-05-20T22:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431327",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,38 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) Mark Python modules as belonging to a specific distutils package, using a distutils directive on the top of a module file:
+
+\`\`\`
+   # distutils: sage_package: sage_tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives by using existing Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Extend \`find_python_sources\` so that it returns Cython modules as an additional result, handling \`OptionalExtensions\` logic via the new \`sage_package\` directive.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431328.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-21T04:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431329.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T00:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431330.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,38 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage_tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Extend \\`find_python_sources\\` so that it returns Cython modules as an additional result, handling \\`OptionalExtensions\\` logic via the new \\`sage_package\\` directive.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-02T00:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431330",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,38 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:
+
+\`\`\`
+   # sage_setup: distribution = sage_tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Extend \`find_python_sources\` so that it returns Cython modules as an additional result, handling \`OptionalExtensions\` logic via the new \`sage_package\` directive.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431331.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-02T00:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431332.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T02:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431333.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T02:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431333",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431334.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,38 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Extend \\`find_python_sources\\` so that it returns Cython modules as an additional result, handling \\`OptionalExtensions\\` logic via the new \\`sage_package\\` directive.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-02T02:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431334",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,38 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Extend \`find_python_sources\` so that it returns Cython modules as an additional result, handling \`OptionalExtensions\` logic via the new \`sage_package\` directive.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431335.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T02:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431336.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,38 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Extend \\`find_python_sources\\` so that it returns Cython modules as an additional result, handling \\`OptionalExtensions\\` logic via the new \\`sage_setup\\` directive.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-02T06:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431336",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,38 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Extend \`find_python_sources\` so that it returns Cython modules as an additional result, handling \`OptionalExtensions\` logic via the new \`sage_setup\` directive.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
 
 
 Comment: 1
```




---

archive/issue_comments_431337.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-06-02T07:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_431338.json:
```json
{
    "body": "<a id='comment:32'></a>Next: Fix `find_extra_files` so that it finds the `.pxd` files in `sage.numerical.backends`",
    "created_at": "2020-06-02T07:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431338",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Next: Fix `find_extra_files` so that it finds the `.pxd` files in `sage.numerical.backends`



---

archive/issue_comments_431339.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-03T01:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431340.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T02:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431341.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T02:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431342.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T03:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431343.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T03:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431343",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431344.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T03:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431345.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,43 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   TBD: Extend \\`find_python_sources\\` so that it returns Cython modules as an additional result, handling \\`OptionalExtensions\\` logic via the new \\`sage_setup\\` directive.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n+The branch on this meta-ticket is not intended for merging.\n+It is an integration branch to facilitate testing. See https://github.com/mkoeppe/sage/pull/35 for automated tests\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-03T20:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431345",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,43 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   TBD: Extend \`find_python_sources\` so that it returns Cython modules as an additional result, handling \`OptionalExtensions\` logic via the new \`sage_setup\` directive.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
+The branch on this meta-ticket is not intended for merging.
+It is an integration branch to facilitate testing. See https://github.com/mkoeppe/sage/pull/35 for automated tests
+
 
 
 Comment: 1
```




---

archive/issue_comments_431346.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,40 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. \n+\n+   We extend \\`find_python_sources\\` so that it returns Cython modules as an additional result.  In a follow-up ticket, we then remove the use of \\`module_list.py\\`.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29701: Meta-ticket: Replace use of \\`OptionalExtension\\` by namespace packages\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-03T21:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431346",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,40 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) Mark Python modules as belonging to a specific distutils package, using a directive on the top of a module file:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, currently we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. 
+
+   We extend \`find_python_sources\` so that it returns Cython modules as an additional result.  In a follow-up ticket, we then remove the use of \`module_list.py\`.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29701: Meta-ticket: Replace use of \`OptionalExtension\` by namespace packages
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_events_073226.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-03T22:58:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73226"
}
```



---

archive/issue_events_073227.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-03T22:58:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73227"
}
```



---

archive/issue_comments_431347.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,39 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) #29701 already introduced a directive on the top of Cython extension source files:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. \n+\n+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. #29701 (Replace use of \\`module_list\\` and \\`OptionalExtension\\` by extending \\`find_python_sources\\`) changes this, so 2. above applies to Cython as well.\n+\n+We test this new mechanism on two example modules: \n+\n+- \\`sage.graphs.graph_decompositions.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package. The module is maintained in the sage source tree.\n+\n+- \\`sage.numerical.backends.coin_backend\\`. The package \\`sage.numerical.backends\\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-07T19:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431347",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,39 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) #29701 already introduced a directive on the top of Cython extension source files:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. 
+
+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. #29701 (Replace use of \`module_list\` and \`OptionalExtension\` by extending \`find_python_sources\`) changes this, so 2. above applies to Cython as well.
+
+We test this new mechanism on two example modules: 
+
+- \`sage.graphs.graph_decompositions.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package. The module is maintained in the sage source tree.
+
+- \`sage.numerical.backends.coin_backend\`. The package \`sage.numerical.backends\` is turned into a namespace package. It serves as an example of a module in a namespace package that is maintained outside of the sage source tree (here: https://github.com/mkoeppe/sage-numerical-backends-namespace)
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431348.json:
```json
{
    "body": "<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-10T02:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_431349.json:
```json
{
    "body": "<a id='comment:47'></a>Squashed some commits",
    "created_at": "2020-06-10T02:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431349",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>Squashed some commits



---

archive/issue_comments_431350.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-10T02:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431351.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-10T03:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_431352.json:
```json
{
    "body": "<a id='comment:50'></a>Rebased on top of #29701",
    "created_at": "2020-06-10T03:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431352",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>Rebased on top of #29701



---

archive/issue_comments_431353.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,47 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+   Solution: \n+\n+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.\n+\n+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \\`sagelib\\` called \\`sage-core\\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. \n+\n+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) #29701 already introduced a directive on the top of Cython extension source files:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. \n+\n+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. #29701 (Replace use of \\`module_list\\` and \\`OptionalExtension\\` by extending \\`find_python_sources\\`) changes this, so 2. above applies to Cython as well.\n+\n+We test this new mechanism on an example package: \n+\\`sage.graphs.graph_decompositions\\`, which we turn into a namespace package by removing \\`__init__.py\\`.\n+(This is preparation for shipping  \\`sage.graphs.graph_decompositions.tdlib\\` as a separate distribution \\`sage-tdlib\\` in #29864)\n+.tdlib\\`. The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package by removing. The module continues to be maintained in the sage source tree.\n+\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-07-16T04:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431353",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,47 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+   Solution: 
+
+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.
+
+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \`sagelib\` called \`sage-core\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. 
+
+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) #29701 already introduced a directive on the top of Cython extension source files:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. 
+
+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. #29701 (Replace use of \`module_list\` and \`OptionalExtension\` by extending \`find_python_sources\`) changes this, so 2. above applies to Cython as well.
+
+We test this new mechanism on an example package: 
+\`sage.graphs.graph_decompositions\`, which we turn into a namespace package by removing \`__init__.py\`.
+(This is preparation for shipping  \`sage.graphs.graph_decompositions.tdlib\` as a separate distribution \`sage-tdlib\` in #29864)
+.tdlib\`. The package \`sage.graphs.graph_decompositions\` is turned into a namespace package by removing. The module continues to be maintained in the sage source tree.
+
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431354.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-16T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431355.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,47 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+   Solution: \n+\n+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.\n+\n+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \\`sagelib\\` called \\`sage-core\\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. \n+\n+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) #29701 already introduced a directive on the top of Cython extension source files:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. \n+\n+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.\n+\n+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. #29701 (Replace use of \\`module_list\\` and \\`OptionalExtension\\` by extending \\`find_python_sources\\`) changes this, so 2. above applies to Cython as well.\n+\n+We test this new mechanism on an example package: \n+\\`sage.graphs.graph_decompositions\\`, which we turn into a namespace package by removing \\`__init__.py\\`.\n+(This is preparation for shipping  \\`sage.graphs.graph_decompositions.tdlib\\` as a separate distribution \\`sage-tdlib\\` in #29864.)\n+The package \\`sage.graphs.graph_decompositions\\` is turned into a namespace package by removing. The module continues to be maintained in the sage source tree.\n+\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-07-17T01:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431355",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,47 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+   Solution: 
+
+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.
+
+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \`sagelib\` called \`sage-core\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. 
+
+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) #29701 already introduced a directive on the top of Cython extension source files:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. 
+
+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.
+
+   TBD: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. #29701 (Replace use of \`module_list\` and \`OptionalExtension\` by extending \`find_python_sources\`) changes this, so 2. above applies to Cython as well.
+
+We test this new mechanism on an example package: 
+\`sage.graphs.graph_decompositions\`, which we turn into a namespace package by removing \`__init__.py\`.
+(This is preparation for shipping  \`sage.graphs.graph_decompositions.tdlib\` as a separate distribution \`sage-tdlib\` in #29864.)
+The package \`sage.graphs.graph_decompositions\` is turned into a namespace package by removing. The module continues to be maintained in the sage source tree.
+
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431356.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-08-18T02:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431357.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-08-18T02:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_431358.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,45 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+   Solution: \n+\n+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.\n+\n+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \\`sagelib\\` called \\`sage-core\\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. \n+\n+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) #29701 already introduced a directive on the top of Cython extension source files:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. \n+\n+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.\n+\n+   Wishlist item: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. #29701 (Replace use of \\`module_list\\` and \\`OptionalExtension\\` by extending \\`find_python_sources\\`) changes this, so 2. above applies to Cython as well.\n+\n+We test this new mechanism on two example packages: \n+- \\`sage.graphs.graph_decompositions\\`, which we turn into a namespace package by removing \\`__init__.py\\`. (This is preparation for shipping  \\`sage.graphs.graph_decompositions.tdlib\\` as a separate distribution \\`sage-tdlib\\` in #29864.)\n+- \\`sage.numerical.backends\\`. (This is preparation for later work, in #30152.)\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-08-18T02:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431358",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,45 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+   Solution: 
+
+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.
+
+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \`sagelib\` called \`sage-core\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. 
+
+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) #29701 already introduced a directive on the top of Cython extension source files:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. 
+
+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.
+
+   Wishlist item: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. #29701 (Replace use of \`module_list\` and \`OptionalExtension\` by extending \`find_python_sources\`) changes this, so 2. above applies to Cython as well.
+
+We test this new mechanism on two example packages: 
+- \`sage.graphs.graph_decompositions\`, which we turn into a namespace package by removing \`__init__.py\`. (This is preparation for shipping  \`sage.graphs.graph_decompositions.tdlib\` as a separate distribution \`sage-tdlib\` in #29864.)
+- \`sage.numerical.backends\`. (This is preparation for later work, in #30152.)
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431359.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-18T04:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431360.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,49 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+   Solution: \n+\n+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.\n+\n+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \\`sagelib\\` called \\`sage-core\\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. \n+\n+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) #29701 already introduced a directive on the top of Cython extension source files:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. \n+\n+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.\n+\n+   Wishlist item: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. #29701 (Replace use of \\`module_list\\` and \\`OptionalExtension\\` by extending \\`find_python_sources\\`) changes this, so 2. above applies to Cython as well.\n+\n+We test this new mechanism on 6 example packages (by replacing the \\`__init__.py\\` file by a \\`namespace\\` file): \n+- \\`sage.matrix\\` (for \\`.matrix_gfpn_dense\\` -> \\`sage-meataxe\\`).\n+- \\`sage.libs\\` (for \\`.meataxe\\`, \\`.sirocco\\`, \\`.coexter3\\`, \\`.fes\\`)\n+- \\`sage.interfaces\\` (for \\`.primecount\\`)\n+- \\`sage.graphs\\` (for \\`.bliss\\`, \\`.mcqd\\`)\n+- \\`sage.graphs.graph_decompositions\\` (for \\`.tdlib\\` -> \\`sage-tdlib\\`, #29864.)\n+- \\`sage.numerical.backends\\`. (This is preparation for later work, in #30152.)\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-08-18T05:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431360",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,49 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+   Solution: 
+
+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.
+
+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \`sagelib\` called \`sage-core\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. 
+
+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) #29701 already introduced a directive on the top of Cython extension source files:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. 
+
+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.
+
+   Wishlist item: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. #29701 (Replace use of \`module_list\` and \`OptionalExtension\` by extending \`find_python_sources\`) changes this, so 2. above applies to Cython as well.
+
+We test this new mechanism on 6 example packages (by replacing the \`__init__.py\` file by a \`namespace\` file): 
+- \`sage.matrix\` (for \`.matrix_gfpn_dense\` -> \`sage-meataxe\`).
+- \`sage.libs\` (for \`.meataxe\`, \`.sirocco\`, \`.coexter3\`, \`.fes\`)
+- \`sage.interfaces\` (for \`.primecount\`)
+- \`sage.graphs\` (for \`.bliss\`, \`.mcqd\`)
+- \`sage.graphs.graph_decompositions\` (for \`.tdlib\` -> \`sage-tdlib\`, #29864.)
+- \`sage.numerical.backends\`. (This is preparation for later work, in #30152.)
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431361.json:
```json
{
    "body": "<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-09T01:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431362.json:
```json
{
    "body": "<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-10-16T22:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_431363.json:
```json
{
    "body": "<a id='comment:70'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-17T00:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431363",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:70'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431364.json:
```json
{
    "body": "<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T01:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431365.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-17T01:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431365",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_431366.json:
```json
{
    "body": "<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T02:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431367.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T04:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431367",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431368.json:
```json
{
    "body": "<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T17:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431368",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431369.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,49 @@\n+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n+\n+1. One obstacle to using namespace packages is that \\`src/setup.py\\` (\\`clean_stale_files\\`) deletes unknown files in the installation tree (\\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\`). This would remove installed namespace packages within the \\`sage\\` package.\n+\n+   Solution: \n+\n+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.\n+\n+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \\`sagelib\\` called \\`sage-core\\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. \n+\n+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.\n+\n+2. We also need to adjust the mechanism for source discovery. \n+\n+   Ordinary packages are turned into namespace packages by removing the empty \\`__init__.py\\` file. But \\`find_python_sources\\` uses \\`__init__.py\\` to recognize package directories. \n+\n+   a) Instead of using \\`find_namespace_packages\\` from \\`setuptools\\`, we modify \\`sage_setup.find.find_python_sources\\` to also find modules in namespace packages.\n+\n+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \\`nonamespace\\` (I just made this up, in analogy to the \\`nodoctest\\` file).\n+\n+   c) #29701 already introduced a directive on the top of Cython extension source files:\n+\n+\\`\\`\\`\n+   # sage_setup: distribution = sage-tdlib\n+\\`\\`\\`\n+    \\`find_python_sources\\` parses these directives using code adapted from Cython infrastructure (\\`Cython.Build.Dependencies.DistutilsInfo\\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. \n+\n+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.\n+\n+   Wishlist item: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+\n+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \\`src/module_list.py\\`. This is very different from how we discover Python modules. #29701 (Replace use of \\`module_list\\` and \\`OptionalExtension\\` by extending \\`find_python_sources\\`) changes this, so 2. above applies to Cython as well.\n+\n+We test this new mechanism on 6 example packages (by replacing the \\`__init__.py\\` file by a \\`namespace\\` file): \n+- \\`sage.matrix\\` (for \\`.matrix_gfpn_dense\\` -> \\`sage-meataxe\\` - #30151).\n+- \\`sage.libs\\` (for \\`.meataxe\\` - #30151, \\`.sirocco\\`, \\`.coexter3\\`, \\`.fes\\`)\n+- \\`sage.interfaces\\` (for \\`.primecount\\`)\n+- \\`sage.graphs\\` (for \\`.bliss\\`, \\`.mcqd\\`)\n+- \\`sage.graphs.graph_decompositions\\` (for \\`.tdlib\\` -> \\`sage-tdlib\\`, #29864.)\n+- \\`sage.numerical.backends\\`. (This is preparation for later work, in #30152.)\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-10-17T18:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431369",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,49 @@
+As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of native namespace packages (PEP 420) - See ​https://packaging.python.org/guides/packaging-namespace-packages/
+
+1. One obstacle to using namespace packages is that \`src/setup.py\` (\`clean_stale_files\`) deletes unknown files in the installation tree (\`$SAGE_LIB/sage\` = \`..../site-packages/sage\`). This would remove installed namespace packages within the \`sage\` package.
+
+   Solution: 
+
+   i) On this ticket, sage-the-distribution continues to use the sagelib package (as the monolithic install including the optional extensions via #29701). The cleaner is only modified so it does not forget to collect namespace packages. No other distribution writes into the same tree.
+
+   ii) Follow-up tickets will set up PyPI deployment, using a mildly modularized version of \`sagelib\` called \`sage-core\`, and separate packages for each optional extension.  None of these packages will use the sage cleaner; they are installed using pip. 
+
+   iii) After that, in a next step, #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages together with the monolithic sagelib installation.
+
+2. We also need to adjust the mechanism for source discovery. 
+
+   Ordinary packages are turned into namespace packages by removing the empty \`__init__.py\` file. But \`find_python_sources\` uses \`__init__.py\` to recognize package directories. 
+
+   a) Instead of using \`find_namespace_packages\` from \`setuptools\`, we modify \`sage_setup.find.find_python_sources\` to also find modules in namespace packages.
+
+   b) We have a few directories that contain Python files but should not be namespace packages. We mark them with a file \`nonamespace\` (I just made this up, in analogy to the \`nodoctest\` file).
+
+   c) #29701 already introduced a directive on the top of Cython extension source files:
+
+\`\`\`
+   # sage_setup: distribution = sage-tdlib
+\`\`\`
+    \`find_python_sources\` parses these directives using code adapted from Cython infrastructure (\`Cython.Build.Dependencies.DistutilsInfo\`).  We use dashes in these distribution names to emphasize that they are names of distutils packages (distributions), NOT Python package identifiers. 
+
+   In this ticket, we extend this to Python modules - to mark them as belonging to a specific distutils package.
+
+   Wishlist item: Warn or give errors if these directives indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+
+3. For Cython extensions, as of Sage 9.1, we use a mix of explicitly named modules and wildcards in \`src/module_list.py\`. This is very different from how we discover Python modules. #29701 (Replace use of \`module_list\` and \`OptionalExtension\` by extending \`find_python_sources\`) changes this, so 2. above applies to Cython as well.
+
+We test this new mechanism on 6 example packages (by replacing the \`__init__.py\` file by a \`namespace\` file): 
+- \`sage.matrix\` (for \`.matrix_gfpn_dense\` -> \`sage-meataxe\` - #30151).
+- \`sage.libs\` (for \`.meataxe\` - #30151, \`.sirocco\`, \`.coexter3\`, \`.fes\`)
+- \`sage.interfaces\` (for \`.primecount\`)
+- \`sage.graphs\` (for \`.bliss\`, \`.mcqd\`)
+- \`sage.graphs.graph_decompositions\` (for \`.tdlib\` -> \`sage-tdlib\`, #29864.)
+- \`sage.numerical.backends\`. (This is preparation for later work, in #30152.)
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431370.json:
```json
{
    "body": "<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431371.json:
```json
{
    "body": "<a id='comment:80'></a>Ready for review",
    "created_at": "2020-10-17T18:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431371",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>Ready for review



---

archive/issue_comments_431372.json:
```json
{
    "body": "<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431373.json:
```json
{
    "body": "<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T21:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431374.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,43 @@\n+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n+\n+Ordinary packages (directories of modules) are turned into namespace packages by removing the empty \\`__init__.py\\` file.\n+\n+Then a different distribution (distutils package) can share the same namespace. \n+\n+In the first stage of modularization, planned for Sage 9.3, we use this new mechanism to split out all \"optional extension modules\" (which depend on some optional library) from the \\`sagelib\\` distribution to separate pip-installable packages. This will simplify deployment and dependency management.\n+\n+(The source code remains in the same place in \\`src/sage\\` in the git tree; the new pip-installable packages will have separate metadata in \\`build/pkgs/SPKG\\`.)\n+\n+1. To this end, this ticket changes the following packages to namespace packages (by removing \\`__init__.py\\`): \n+- \\`sage.matrix\\` (this allows the new distribution \\`sage-meataxe\\` introduced in #30151 to add the module \\`sage.matrix.matrix_gfpn_dense\\`) to the package)\n+- \\`sage.libs\\` (for \\`.meataxe\\` - #30151, \\`.sirocco\\`, \\`.coexter3\\`, \\`.fes\\`)\n+- \\`sage.interfaces\\` (for \\`.primecount\\`)\n+- \\`sage.graphs\\` (for \\`.bliss\\`, \\`.mcqd\\`)\n+- \\`sage.graphs.graph_decompositions\\` (for \\`.tdlib\\` -> \\`sage-tdlib\\`, #29864.)\n+- \\`sage.numerical.backends\\`. (This is preparation for later work, in #30152.)\n+\n+2. Because our source discovery mechanism in sagelib's build system (\\`setup.py\\` + \\`sage_setup\\`) distinguishes package directories from other directories containing data files by the presence of the \\`__init__.py\\` file, the present ticket makes several adjustments to the build system - in particular to the functions \\`find_python_sources\\` and \\`find_extra_files\\`.\n+\n+To simplify the implementation and to allow for self-documentation of the directory structure, we introduce \\`sage_setup\\`-specific files named \n+- \\`namespace\\` to mark a directory without \\`__init__.py\\` as a namespace package; \n+- \\`nonamespace\\` to mark a directory as a data directory. (This is in analogy with the \\`nodoctest\\` files that control the Sage doctester.)\n+\n+(In the branch of this ticket, these are empty files; but they could contain comments that explain the purpose of a particular directory.)\n+\n+3. Also the incremental installation mechanisms of sagelib's build system need adjustment. \\`clean_stale_files\\`, which deletes installed Python modules in \\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\` that are no longer present in the current version of the source tree, is changed so that it does not delete modules in a namespace package that are provided by a separate distribution (pip-installable package).\n+\n+\n+\n+Follow-up tickets:\n+- Wishlist item: Warn or give errors if the \\`sage_setup: distribution\\` directives, \\`namespace\\` and \\`nonamespace\\` files indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-10-18T03:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431374",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,43 @@
+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.
+
+Ordinary packages (directories of modules) are turned into namespace packages by removing the empty \`__init__.py\` file.
+
+Then a different distribution (distutils package) can share the same namespace. 
+
+In the first stage of modularization, planned for Sage 9.3, we use this new mechanism to split out all "optional extension modules" (which depend on some optional library) from the \`sagelib\` distribution to separate pip-installable packages. This will simplify deployment and dependency management.
+
+(The source code remains in the same place in \`src/sage\` in the git tree; the new pip-installable packages will have separate metadata in \`build/pkgs/SPKG\`.)
+
+1. To this end, this ticket changes the following packages to namespace packages (by removing \`__init__.py\`): 
+- \`sage.matrix\` (this allows the new distribution \`sage-meataxe\` introduced in #30151 to add the module \`sage.matrix.matrix_gfpn_dense\`) to the package)
+- \`sage.libs\` (for \`.meataxe\` - #30151, \`.sirocco\`, \`.coexter3\`, \`.fes\`)
+- \`sage.interfaces\` (for \`.primecount\`)
+- \`sage.graphs\` (for \`.bliss\`, \`.mcqd\`)
+- \`sage.graphs.graph_decompositions\` (for \`.tdlib\` -> \`sage-tdlib\`, #29864.)
+- \`sage.numerical.backends\`. (This is preparation for later work, in #30152.)
+
+2. Because our source discovery mechanism in sagelib's build system (\`setup.py\` + \`sage_setup\`) distinguishes package directories from other directories containing data files by the presence of the \`__init__.py\` file, the present ticket makes several adjustments to the build system - in particular to the functions \`find_python_sources\` and \`find_extra_files\`.
+
+To simplify the implementation and to allow for self-documentation of the directory structure, we introduce \`sage_setup\`-specific files named 
+- \`namespace\` to mark a directory without \`__init__.py\` as a namespace package; 
+- \`nonamespace\` to mark a directory as a data directory. (This is in analogy with the \`nodoctest\` files that control the Sage doctester.)
+
+(In the branch of this ticket, these are empty files; but they could contain comments that explain the purpose of a particular directory.)
+
+3. Also the incremental installation mechanisms of sagelib's build system need adjustment. \`clean_stale_files\`, which deletes installed Python modules in \`$SAGE_LIB/sage\` = \`..../site-packages/sage\` that are no longer present in the current version of the source tree, is changed so that it does not delete modules in a namespace package that are provided by a separate distribution (pip-installable package).
+
+
+
+Follow-up tickets:
+- Wishlist item: Warn or give errors if the \`sage_setup: distribution\` directives, \`namespace\` and \`nonamespace\` files indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431375.json:
```json
{
    "body": "<a id='comment:84'></a>What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?",
    "created_at": "2020-10-18T09:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431375",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:84'></a>What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?



---

archive/issue_comments_431376.json:
```json
{
    "body": "<a id='comment:85'></a>Replying to [comment:84 gh-tobiasdiez]:\n> What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?\n\n\nOne **cannot** keep `__init__.py` for native namespace packages. PEP 420 is quite clear about it. Sub-packages of namespace packages do have `__init__.py`; and also the present ticket keeps them.",
    "created_at": "2020-10-19T21:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431376",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'></a>Replying to [comment:84 gh-tobiasdiez]:
> What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?


One **cannot** keep `__init__.py` for native namespace packages. PEP 420 is quite clear about it. Sub-packages of namespace packages do have `__init__.py`; and also the present ticket keeps them.



---

archive/issue_comments_431377.json:
```json
{
    "body": "<a id='comment:86'></a>`find_namespace_packages` accepts any directory as a package directory:\n\n```\nclass PEP420PackageFinder(PackageFinder):\n    @staticmethod\n    def _looks_like_package(path):\n        return True\n```\n(https://github.com/pypa/setuptools/blob/f991fbb3c9d0e10a0a78ae2b508b3fd99f9cdef2/setuptools/__init__.py#L110)\n\nBut our source tree has some directories that should not be considered package directories. I have marked these with the `nonamespace` file.\n\nHaving both `nonamespace` and `namespace` files results in simpler changes to the existing code.",
    "created_at": "2020-10-19T21:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431377",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:86'></a>`find_namespace_packages` accepts any directory as a package directory:

```
class PEP420PackageFinder(PackageFinder):
    @staticmethod
    def _looks_like_package(path):
        return True
```
(https://github.com/pypa/setuptools/blob/f991fbb3c9d0e10a0a78ae2b508b3fd99f9cdef2/setuptools/__init__.py#L110)

But our source tree has some directories that should not be considered package directories. I have marked these with the `nonamespace` file.

Having both `nonamespace` and `namespace` files results in simpler changes to the existing code.



---

archive/issue_comments_431378.json:
```json
{
    "body": "<a id='comment:87'></a>Oh ok, sorry, I've misunderstood the ticket description. You are of course right, implicit namespace packages don't have a `__init__.py` file.\n\nConcerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n\nIf you do prefer to have these files, I would like to ask you to add documentation to the dev docs.",
    "created_at": "2020-10-19T22:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431378",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:87'></a>Oh ok, sorry, I've misunderstood the ticket description. You are of course right, implicit namespace packages don't have a `__init__.py` file.

Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.

If you do prefer to have these files, I would like to ask you to add documentation to the dev docs.



---

archive/issue_comments_431379.json:
```json
{
    "body": "<a id='comment:88'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-20T03:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431379",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:88'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431380.json:
```json
{
    "body": "<a id='comment:89'></a>Replying to [comment:87 gh-tobiasdiez]:\n> Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n\n\nThanks for the input and the pointer to PEP 382.\nI'll try out if your suggestion can be implemented without major changes.",
    "created_at": "2020-10-20T03:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431380",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:89'></a>Replying to [comment:87 gh-tobiasdiez]:
> Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.


Thanks for the input and the pointer to PEP 382.
I'll try out if your suggestion can be implemented without major changes.



---

archive/issue_comments_431381.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-20T03:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431381",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_431382.json:
```json
{
    "body": "<a id='comment:90'></a>TBD: In incremental builds, the cleaner fails to remove previously installed `__init__.py` files:\n\n```\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 343, in sage_setup.find.installed_files_by_module\nFailed example:\n    files_by_module['sage.graphs.graph_decompositions']\nExpected nothing\nGot:\n    {'sage/graphs/graph_decompositions/__init__.py',\n     'sage/graphs/graph_decompositions/__pycache__/__init__.cpython-37.pyc'}\n**********************************************************************\n```",
    "created_at": "2020-10-20T03:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431382",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:90'></a>TBD: In incremental builds, the cleaner fails to remove previously installed `__init__.py` files:

```
**********************************************************************
File "src/sage_setup/find.py", line 343, in sage_setup.find.installed_files_by_module
Failed example:
    files_by_module['sage.graphs.graph_decompositions']
Expected nothing
Got:
    {'sage/graphs/graph_decompositions/__init__.py',
     'sage/graphs/graph_decompositions/__pycache__/__init__.cpython-37.pyc'}
**********************************************************************
```



---

archive/issue_comments_431383.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,43 @@\n+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n+\n+Ordinary packages (directories of modules) are turned into namespace packages by removing the empty \\`__init__.py\\` file.\n+\n+Then a different distribution (distutils package) can share the same namespace. \n+\n+In the first stage of modularization, planned for Sage 9.3, we use this new mechanism to split out all \"optional extension modules\" (which depend on some optional library) from the \\`sagelib\\` distribution to separate pip-installable packages. This will simplify deployment and dependency management.\n+\n+(The source code remains in the same place in \\`src/sage\\` in the git tree; the new pip-installable packages will have separate metadata in \\`build/pkgs/SPKG\\`.)\n+\n+1. To this end, this ticket changes the following packages to namespace packages (by removing \\`__init__.py\\`): \n+   - \\`sage.matrix\\` (this allows the new distribution \\`sage-meataxe\\` introduced in #30151 to add the module \\`sage.matrix.matrix_gfpn_dense\\`) to the package)\n+   - \\`sage.libs\\` (for \\`.meataxe\\` - #30151, \\`.sirocco\\`, \\`.coexter3\\`, \\`.fes\\`)\n+   - \\`sage.interfaces\\` (for \\`.primecount\\`)\n+   - \\`sage.graphs\\` (for \\`.bliss\\`, \\`.mcqd\\`)\n+   - \\`sage.graphs.graph_decompositions\\` (for \\`.tdlib\\` -> \\`sage-tdlib\\`, #29864.)\n+   - \\`sage.numerical.backends\\`. (This is preparation for later work, in #30152.)\n+\n+2. Because our source discovery mechanism in sagelib's build system (\\`setup.py\\` + \\`sage_setup\\`) distinguishes package directories from other directories containing data files by the presence of the \\`__init__.py\\` file, the present ticket makes several adjustments to the build system - in particular to the functions \\`find_python_sources\\` and \\`find_extra_files\\`.\n+\n+   To simplify the implementation and to allow for self-documentation of the directory structure, we introduce \\`sage_setup\\`-specific files named:\n+    - \\`namespace\\` to mark a directory without \\`__init__.py\\` as a namespace package; \n+    - \\`nonamespace\\` to mark a directory as a data directory. (This is in analogy with the \\`nodoctest\\` files that control the Sage doctester.)\n+\n+   (In the branch of this ticket, these are empty files; but they could contain comments that explain the purpose of a particular directory.)\n+\n+3. Also the incremental installation mechanisms of sagelib's build system need adjustment. \\`clean_stale_files\\`, which deletes installed Python modules in \\`$SAGE_LIB/sage\\` = \\`..../site-packages/sage\\` that are no longer present in the current version of the source tree, is changed so that it does not delete modules in a namespace package that are provided by a separate distribution (pip-installable package).\n+\n+\n+\n+Follow-up tickets:\n+- Wishlist item: Warn or give errors if the \\`sage_setup: distribution\\` directives, \\`namespace\\` and \\`nonamespace\\` files indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-10-20T04:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431383",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,43 @@
+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.
+
+Ordinary packages (directories of modules) are turned into namespace packages by removing the empty \`__init__.py\` file.
+
+Then a different distribution (distutils package) can share the same namespace. 
+
+In the first stage of modularization, planned for Sage 9.3, we use this new mechanism to split out all "optional extension modules" (which depend on some optional library) from the \`sagelib\` distribution to separate pip-installable packages. This will simplify deployment and dependency management.
+
+(The source code remains in the same place in \`src/sage\` in the git tree; the new pip-installable packages will have separate metadata in \`build/pkgs/SPKG\`.)
+
+1. To this end, this ticket changes the following packages to namespace packages (by removing \`__init__.py\`): 
+   - \`sage.matrix\` (this allows the new distribution \`sage-meataxe\` introduced in #30151 to add the module \`sage.matrix.matrix_gfpn_dense\`) to the package)
+   - \`sage.libs\` (for \`.meataxe\` - #30151, \`.sirocco\`, \`.coexter3\`, \`.fes\`)
+   - \`sage.interfaces\` (for \`.primecount\`)
+   - \`sage.graphs\` (for \`.bliss\`, \`.mcqd\`)
+   - \`sage.graphs.graph_decompositions\` (for \`.tdlib\` -> \`sage-tdlib\`, #29864.)
+   - \`sage.numerical.backends\`. (This is preparation for later work, in #30152.)
+
+2. Because our source discovery mechanism in sagelib's build system (\`setup.py\` + \`sage_setup\`) distinguishes package directories from other directories containing data files by the presence of the \`__init__.py\` file, the present ticket makes several adjustments to the build system - in particular to the functions \`find_python_sources\` and \`find_extra_files\`.
+
+   To simplify the implementation and to allow for self-documentation of the directory structure, we introduce \`sage_setup\`-specific files named:
+    - \`namespace\` to mark a directory without \`__init__.py\` as a namespace package; 
+    - \`nonamespace\` to mark a directory as a data directory. (This is in analogy with the \`nodoctest\` files that control the Sage doctester.)
+
+   (In the branch of this ticket, these are empty files; but they could contain comments that explain the purpose of a particular directory.)
+
+3. Also the incremental installation mechanisms of sagelib's build system need adjustment. \`clean_stale_files\`, which deletes installed Python modules in \`$SAGE_LIB/sage\` = \`..../site-packages/sage\` that are no longer present in the current version of the source tree, is changed so that it does not delete modules in a namespace package that are provided by a separate distribution (pip-installable package).
+
+
+
+Follow-up tickets:
+- Wishlist item: Warn or give errors if the \`sage_setup: distribution\` directives, \`namespace\` and \`nonamespace\` files indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431384.json:
```json
{
    "body": "<a id='comment:92'></a>Note that one annoying thing about `find_namespace_packages` when applied to our source tree is that we have lots of directories that do not contain any python files, leading to output like this from distutils:\n\n```\n[sagelib-9.2.rc2] package init file 'sage/schemes/generic/notes/__init__.py' not found (or not a regular file)\n```\nThe branch on this ticket handles such directories specially (no need for `nonamespace` files there). If there is a solution that could silence these notes, the code could be brought closer to `find_namespace_packages` behavior.",
    "created_at": "2020-10-20T04:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431384",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:92'></a>Note that one annoying thing about `find_namespace_packages` when applied to our source tree is that we have lots of directories that do not contain any python files, leading to output like this from distutils:

```
[sagelib-9.2.rc2] package init file 'sage/schemes/generic/notes/__init__.py' not found (or not a regular file)
```
The branch on this ticket handles such directories specially (no need for `nonamespace` files there). If there is a solution that could silence these notes, the code could be brought closer to `find_namespace_packages` behavior.



---

archive/issue_comments_431385.json:
```json
{
    "body": "<a id='comment:93'></a>`find_namespace_packages` excepts `include` and `exclude` directories as arguments. So one option would be to get a list of all folders not including any python files, and pass this as `exclude` (or the same approach using a whitelist).",
    "created_at": "2020-10-20T08:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431385",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:93'></a>`find_namespace_packages` excepts `include` and `exclude` directories as arguments. So one option would be to get a list of all folders not including any python files, and pass this as `exclude` (or the same approach using a whitelist).



---

archive/issue_comments_431386.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431386",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_431387.json:
```json
{
    "body": "<a id='comment:95'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-09T05:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:95'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431388.json:
```json
{
    "body": "<a id='comment:97'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431388",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_073228.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73228"
}
```



---

archive/issue_events_073229.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73229"
}
```



---

archive/issue_events_073230.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73230"
}
```



---

archive/issue_events_073231.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73231"
}
```



---

archive/issue_comments_431389.json:
```json
{
    "body": "<a id='comment:98'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431389",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_431390.json:
```json
{
    "body": "<a id='comment:99'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-26T23:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:99'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431391.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-26T23:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431392.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-11-27T22:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_431393.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,29 @@\n+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n+\n+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \\`__init__.py\\` file.\n+Then a different distribution package can share the same namespace. \n+\n+Because our source discovery mechanism in sagelib's build system (\\`setup.py\\` + \\`sage_setup\\`) distinguishes package directories from other directories containing data files by the presence of the \\`__init__.py\\` file, the present ticket makes several adjustments to the build system - in particular to the functions \\`find_python_sources\\` and \\`find_extra_files\\`.\n+\n+To simplify the implementation and to allow for self-documentation of the directory structure, we introduce \\`sage_setup\\`-specific files named:\n+- \\`namespace\\` to mark a directory without \\`__init__.py\\` as a namespace package; \n+- \\`nonamespace\\` to mark a directory as a data directory. (This is in analogy with the \\`nodoctest\\` files that control the Sage doctester.)\n+(In the branch of this ticket, these are empty files; but they could contain comments that explain the purpose of a particular directory.)\n+\n+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages.\n+\n+\n+Follow-up tickets:\n+- #33011 Remove the \\`__init__.py\\` files for packages designated to be namespace packages\n+- Wishlist item: Warn or give errors if the \\`sage_setup: distribution\\` directives, \\`namespace\\` and \\`nonamespace\\` files indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2021-12-11T04:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431393",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,29 @@
+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.
+
+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \`__init__.py\` file.
+Then a different distribution package can share the same namespace. 
+
+Because our source discovery mechanism in sagelib's build system (\`setup.py\` + \`sage_setup\`) distinguishes package directories from other directories containing data files by the presence of the \`__init__.py\` file, the present ticket makes several adjustments to the build system - in particular to the functions \`find_python_sources\` and \`find_extra_files\`.
+
+To simplify the implementation and to allow for self-documentation of the directory structure, we introduce \`sage_setup\`-specific files named:
+- \`namespace\` to mark a directory without \`__init__.py\` as a namespace package; 
+- \`nonamespace\` to mark a directory as a data directory. (This is in analogy with the \`nodoctest\` files that control the Sage doctester.)
+(In the branch of this ticket, these are empty files; but they could contain comments that explain the purpose of a particular directory.)
+
+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages.
+
+
+Follow-up tickets:
+- #33011 Remove the \`__init__.py\` files for packages designated to be namespace packages
+- Wishlist item: Warn or give errors if the \`sage_setup: distribution\` directives, \`namespace\` and \`nonamespace\` files indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431394.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-12-11T04:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_431395.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-11T05:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431396.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-11T06:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431397.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-11T06:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_073232.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73232"
}
```



---

archive/issue_events_073233.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73233"
}
```



---

archive/issue_comments_431398.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T19:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431398",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431399.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T21:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431400.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T22:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431401.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,27 @@\n+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n+\n+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \\`__init__.py\\` file.\n+Then several distribution package can share the same namespace. \n+\n+Because our source discovery mechanism in sagelib's build system (\\`setup.py\\` + \\`sage_setup\\`) distinguishes package directories from other directories containing data files by the presence of the \\`__init__.py\\` file, the present ticket makes several adjustments to the build system - in particular to the functions \\`find_python_sources\\` and \\`find_extra_files\\`.\n+\n+Per convention in the Sage library, namespace packages are recognized by the presence of \\`all.py\\` or \\`all__*.py\\` files (#33033).\n+\n+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, \n+in which \\`__init__.py\\` are removed from the \\`MANIFEST.in\\` files.\n+\n+\n+Follow-up tickets:\n+- #33011 Remove the \\`__init__.py\\` files for packages designated to be namespace packages\n+- Wishlist item: Warn or give errors if the \\`sage_setup: distribution\\` directives, \\`namespace\\` and \\`nonamespace\\` files indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2021-12-16T22:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431401",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,27 @@
+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.
+
+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \`__init__.py\` file.
+Then several distribution package can share the same namespace. 
+
+Because our source discovery mechanism in sagelib's build system (\`setup.py\` + \`sage_setup\`) distinguishes package directories from other directories containing data files by the presence of the \`__init__.py\` file, the present ticket makes several adjustments to the build system - in particular to the functions \`find_python_sources\` and \`find_extra_files\`.
+
+Per convention in the Sage library, namespace packages are recognized by the presence of \`all.py\` or \`all__*.py\` files (#33033).
+
+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, 
+in which \`__init__.py\` are removed from the \`MANIFEST.in\` files.
+
+
+Follow-up tickets:
+- #33011 Remove the \`__init__.py\` files for packages designated to be namespace packages
+- Wishlist item: Warn or give errors if the \`sage_setup: distribution\` directives, \`namespace\` and \`nonamespace\` files indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431402.json:
```json
{
    "body": "<a id='comment:115'></a>Replying to [comment:89 mkoeppe]:\n> Replying to [comment:87 gh-tobiasdiez]:\n> > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n\n> \n> Thanks for the input and the pointer to PEP 382.\n> I'll try out if your suggestion can be implemented without major changes.\n\n\nDone now via #33033.",
    "created_at": "2021-12-16T22:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431402",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:115'></a>Replying to [comment:89 mkoeppe]:
> Replying to [comment:87 gh-tobiasdiez]:
> > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.

> 
> Thanks for the input and the pointer to PEP 382.
> I'll try out if your suggestion can be implemented without major changes.


Done now via #33033.



---

archive/issue_comments_431403.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T23:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431403",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_431404.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,34 @@\n+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n+\n+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \\`__init__.py\\` file.\n+Then several distribution package can share the same namespace. \n+\n+Because our source discovery mechanism in sagelib's build system (\\`setup.py\\` + \\`sage_setup\\`) distinguishes package directories from other directories containing data files by the presence of the \\`__init__.py\\` file, the present ticket makes several adjustments to the build system - in particular to the functions \\`find_python_sources\\` and \\`find_extra_files\\`.\n+\n+Per convention in the Sage library, namespace packages are recognized by the presence of \\`all.py\\` or \\`all__*.py\\` files (#33033).\n+\n+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, \n+in which \\`__init__.py\\` are removed from the \\`MANIFEST.in\\` files.\n+\n+To test these two distributions:\n+\n+\\`\\`\\`\n+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-objects && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'\n+\n+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-categories && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'\n+\\`\\`\\`\n+\n+Follow-up tickets:\n+- #33011 Remove the \\`__init__.py\\` files for packages designated to be namespace packages\n+- Wishlist item: Warn or give errors if the \\`sage_setup: distribution\\` directives, \\`namespace\\` and \\`nonamespace\\` files indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2021-12-16T23:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431404",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,34 @@
+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.
+
+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \`__init__.py\` file.
+Then several distribution package can share the same namespace. 
+
+Because our source discovery mechanism in sagelib's build system (\`setup.py\` + \`sage_setup\`) distinguishes package directories from other directories containing data files by the presence of the \`__init__.py\` file, the present ticket makes several adjustments to the build system - in particular to the functions \`find_python_sources\` and \`find_extra_files\`.
+
+Per convention in the Sage library, namespace packages are recognized by the presence of \`all.py\` or \`all__*.py\` files (#33033).
+
+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, 
+in which \`__init__.py\` are removed from the \`MANIFEST.in\` files.
+
+To test these two distributions:
+
+\`\`\`
+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-objects && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'
+
+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-categories && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'
+\`\`\`
+
+Follow-up tickets:
+- #33011 Remove the \`__init__.py\` files for packages designated to be namespace packages
+- Wishlist item: Warn or give errors if the \`sage_setup: distribution\` directives, \`namespace\` and \`nonamespace\` files indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431405.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T23:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431406.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-12-17T00:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_431407.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,36 @@\n+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.\n+\n+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \\`__init__.py\\` file.\n+Then several distribution package can share the same namespace. \n+\n+Because our source discovery mechanism in sagelib's build system (\\`setup.py\\` + \\`sage_setup\\`) distinguishes package directories from other directories containing data files by the presence of the \\`__init__.py\\` file, the present ticket makes several adjustments to the build system - in particular to the functions \\`find_python_sources\\` and \\`find_extra_files\\`.\n+\n+Per convention in the Sage library, namespace packages are recognized by the presence of \\`all.py\\` or \\`all__*.py\\` files (#33033).\n+\n+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, \n+in which \\`__init__.py\\` are removed from the \\`MANIFEST.in\\` files.\n+\n+Because the actual files are not removed from the source tree, the normal build of the Sage distribution is not affected.\n+\n+To test these two distributions:\n+\n+\\`\\`\\`\n+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-objects && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'\n+\n+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-categories && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'\n+\\`\\`\\`\n+\n+Follow-up tickets:\n+- #33011 Remove the \\`__init__.py\\` files for packages designated to be namespace packages\n+- Wishlist item: Warn or give errors if the \\`sage_setup: distribution\\` directives, \\`namespace\\` and \\`nonamespace\\` files indicate an inconsistent structure such as when it was forgotten to remove \\`__init__.py\\`.\n+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages\n+\n+See also:\n+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages\n+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4\n+- #21654: \\`src/setup.py\\`: Disentangle cleaning of stale installed files in build directory and in install directory\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2021-12-17T00:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431407",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,36 @@
+This ticket prepares the modularization of sagelib into separate distributions (pip-installable packages) by adding support for [native namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/) (PEP 420) to sagelib's build system.
+
+Ordinary packages (directories of modules) can be turned into namespace packages by removing the empty \`__init__.py\` file.
+Then several distribution package can share the same namespace. 
+
+Because our source discovery mechanism in sagelib's build system (\`setup.py\` + \`sage_setup\`) distinguishes package directories from other directories containing data files by the presence of the \`__init__.py\` file, the present ticket makes several adjustments to the build system - in particular to the functions \`find_python_sources\` and \`find_extra_files\`.
+
+Per convention in the Sage library, namespace packages are recognized by the presence of \`all.py\` or \`all__*.py\` files (#33033).
+
+In this ticket, we apply it to turn **sagemath-objects** and **sagemath-categories** (from #29865) into namespace packages, 
+in which \`__init__.py\` are removed from the \`MANIFEST.in\` files.
+
+Because the actual files are not removed from the source tree, the normal build of the Sage distribution is not affected.
+
+To test these two distributions:
+
+\`\`\`
+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-objects && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'
+
+./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-categories && SAGE_NUM_THREADS=16 tox -r -v -v -v -e py39)'
+\`\`\`
+
+Follow-up tickets:
+- #33011 Remove the \`__init__.py\` files for packages designated to be namespace packages
+- Wishlist item: Warn or give errors if the \`sage_setup: distribution\` directives, \`namespace\` and \`nonamespace\` files indicate an inconsistent structure such as when it was forgotten to remove \`__init__.py\`.
+- #30152 will make further changes to the cleaner that will allow out-of-tree namespace packages
+
+See also:
+- #29705: Meta-ticket: Modularize sagelib into separate distutils packages
+- Initial discussion of namespace packages for Sage in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4
+- #21654: \`src/setup.py\`: Disentangle cleaning of stale installed files in build directory and in install directory
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_431408.json:
```json
{
    "body": "<a id='comment:0'></a>Rebased away from #32927.",
    "created_at": "2021-12-17T00:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431408",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>Rebased away from #32927.



---

archive/issue_comments_431409.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-17T06:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431409",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431410.json:
```json
{
    "body": "<a id='comment:122'></a>Replying to [comment:115 mkoeppe]:\n> Replying to [comment:89 mkoeppe]:\n> > Replying to [comment:87 gh-tobiasdiez]:\n> > > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n\n> > \n> > Thanks for the input and the pointer to PEP 382.\n> > I'll try out if your suggestion can be implemented without major changes.\n\n> \n> Done now via #33033.\n\n\nProbably I'm missing something here. The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.\nThe point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like\n\n```\nis_namespace_package(dir):\n   return dir in setuptools.find_namespace_packages(include=..., exclude=...)\n```\nAnd the setup.cfg would use https://setuptools.pypa.io/en/latest/userguide/package_discovery.html.",
    "created_at": "2021-12-17T12:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431410",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:122'></a>Replying to [comment:115 mkoeppe]:
> Replying to [comment:89 mkoeppe]:
> > Replying to [comment:87 gh-tobiasdiez]:
> > > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.

> > 
> > Thanks for the input and the pointer to PEP 382.
> > I'll try out if your suggestion can be implemented without major changes.

> 
> Done now via #33033.


Probably I'm missing something here. The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.
The point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like

```
is_namespace_package(dir):
   return dir in setuptools.find_namespace_packages(include=..., exclude=...)
```
And the setup.cfg would use https://setuptools.pypa.io/en/latest/userguide/package_discovery.html.



---

archive/issue_comments_431411.json:
```json
{
    "body": "<a id='comment:123'></a>Replying to [comment:122 gh-tobiasdiez]:\n> The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.\n\n\nThat's certainly true, but at least the Sage source tree already has these files",
    "created_at": "2021-12-17T16:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:123'></a>Replying to [comment:122 gh-tobiasdiez]:
> The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.


That's certainly true, but at least the Sage source tree already has these files



---

archive/issue_comments_431412.json:
```json
{
    "body": "<a id='comment:124'></a>Replying to [comment:122 gh-tobiasdiez]:\n> The point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like\n> \n> ```\n> is_namespace_package(dir):\n>    return dir in setuptools.find_namespace_packages(include=..., exclude=...)\n> ```\n\n\nThe helper function is added in #33033 for runtime use (doctesting). Doctesting needs to be able to work on (a) Sage source trees, (b) installed Sage packages (this is important, for example, for the downstream packagers), (c) arbitrary files. \nHardcoding inclusions and exclusions in the helper function seems a bit unmodular",
    "created_at": "2021-12-17T16:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:124'></a>Replying to [comment:122 gh-tobiasdiez]:
> The point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like
> 
> ```
> is_namespace_package(dir):
>    return dir in setuptools.find_namespace_packages(include=..., exclude=...)
> ```


The helper function is added in #33033 for runtime use (doctesting). Doctesting needs to be able to work on (a) Sage source trees, (b) installed Sage packages (this is important, for example, for the downstream packagers), (c) arbitrary files. 
Hardcoding inclusions and exclusions in the helper function seems a bit unmodular



---

archive/issue_comments_431413.json:
```json
{
    "body": "<a id='comment:5'></a>In the end it comes down to who should have the control:\n- Should the doctest code decide what to test, and the setup.py/cfg file what to distribute and the sage startup script what to expose\n- or should the module/package be responsible to declare that it should be tested, distributed and exposed\n\nCurrently, this ticket (and the related ones) go in the direction of the second approach by using `all.py`. For me, using inversion of control and following the first approach seems more natural and flexible. Since you have a better overview though, I trust your judgement.",
    "created_at": "2021-12-17T17:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431413",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>In the end it comes down to who should have the control:
- Should the doctest code decide what to test, and the setup.py/cfg file what to distribute and the sage startup script what to expose
- or should the module/package be responsible to declare that it should be tested, distributed and exposed

Currently, this ticket (and the related ones) go in the direction of the second approach by using `all.py`. For me, using inversion of control and following the first approach seems more natural and flexible. Since you have a better overview though, I trust your judgement.



---

archive/issue_comments_431414.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T06:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431415.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T03:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431416.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T04:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431417.json:
```json
{
    "body": "<a id='comment:0'></a>All dependencies are merged",
    "created_at": "2022-02-14T04:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431417",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>All dependencies are merged



---

archive/issue_comments_431418.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T06:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431419.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-02-22T02:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431419",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_431420.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-13T17:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431421.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-13T18:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431421",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_073234.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73234"
}
```



---

archive/issue_events_073235.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73235"
}
```



---

archive/issue_comments_431422.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-29T16:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431423.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-05T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431424.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-05T17:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431425.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-06T16:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431426.json:
```json
{
    "body": "<a id='comment:1'></a>The failure in `src/sage/interfaces/expect.py` shown by the patchbot is unrelated.\nReady for review",
    "created_at": "2022-05-09T18:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431426",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>The failure in `src/sage/interfaces/expect.py` shown by the patchbot is unrelated.
Ready for review



---

archive/issue_comments_431427.json:
```json
{
    "body": "<a id='comment:2'></a>should one `exclude` not only *.so, but *.dylib, too?",
    "created_at": "2022-05-10T22:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431427",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>should one `exclude` not only *.so, but *.dylib, too?



---

archive/issue_comments_431428.json:
```json
{
    "body": "<a id='comment:3'></a>On macOS, the compiled python modules are also .so, not .dylib.",
    "created_at": "2022-05-10T22:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431428",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>On macOS, the compiled python modules are also .so, not .dylib.



---

archive/issue_comments_431429.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-29T23:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431430.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-08T06:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431430",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431431.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-09T18:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431432.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-12T18:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431433.json:
```json
{
    "body": "<a id='comment:9'></a>Sorry for my ignorance, but I am unable to merge this ticket:\n\n```\n% git clone -c core.symlinks=true --branch develop --tags https://github.com/sagemath/sage.git\n[...]\n% cd sage\n% git-trac-merge 28925\n\n#28925\nremote branch: u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_\n\nFrom git://trac.sagemath.org/sage\n * branch                  u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> FETCH_HEAD\n * [new branch]            u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> trac/u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_\n\nAuto-merging build/pkgs/sage_setup/dependencies\nCONFLICT (content): Merge conflict in build/pkgs/sage_setup/dependencies\nAutomatic merge failed; fix conflicts and then commit the result.\n% \n```",
    "created_at": "2022-06-21T13:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431433",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:9'></a>Sorry for my ignorance, but I am unable to merge this ticket:

```
% git clone -c core.symlinks=true --branch develop --tags https://github.com/sagemath/sage.git
[...]
% cd sage
% git-trac-merge 28925

#28925
remote branch: u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_

From git://trac.sagemath.org/sage
 * branch                  u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> FETCH_HEAD
 * [new branch]            u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> trac/u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_

Auto-merging build/pkgs/sage_setup/dependencies
CONFLICT (content): Merge conflict in build/pkgs/sage_setup/dependencies
Automatic merge failed; fix conflicts and then commit the result.
% 
```



---

archive/issue_comments_431434.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-25T18:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431435.json:
```json
{
    "body": "<a id='comment:1'></a>I've resolved the merge conflict",
    "created_at": "2022-06-25T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431435",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>I've resolved the merge conflict



---

archive/issue_comments_431436.json:
```json
{
    "body": "<a id='comment:2'></a>Not used import?\n\n```diff\ndiff --git a/pkgs/sagemath-objects/setup.py b/pkgs/sagemath-objects/setup.py\nindex 124f0cb218..907cabef83 100644\n--- a/pkgs/sagemath-objects/setup.py\n+++ b/pkgs/sagemath-objects/setup.py\n@@ -42,7 +42,7 @@ if sdist:\n     python_modules = []\n     cython_modules = []\n else:\n-    from sage_setup.find import find_python_sources, is_package_or_namespace_package_dir\n+    from sage_setup.find import find_python_sources\n     python_packages, python_modules, cython_modules = find_python_sources(\n         '.', ['sage'])   # for now, we do the filtering using MANIFEST\n```",
    "created_at": "2022-06-30T01:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431436",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>Not used import?

```diff
diff --git a/pkgs/sagemath-objects/setup.py b/pkgs/sagemath-objects/setup.py
index 124f0cb218..907cabef83 100644
--- a/pkgs/sagemath-objects/setup.py
+++ b/pkgs/sagemath-objects/setup.py
@@ -42,7 +42,7 @@ if sdist:
     python_modules = []
     cython_modules = []
 else:
-    from sage_setup.find import find_python_sources, is_package_or_namespace_package_dir
+    from sage_setup.find import find_python_sources
     python_packages, python_modules, cython_modules = find_python_sources(
         '.', ['sage'])   # for now, we do the filtering using MANIFEST
```



---

archive/issue_comments_431437.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T00:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431438.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks!\n\nAnd I have applied the change that left that import unused also to another file.",
    "created_at": "2022-07-01T00:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431438",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Thanks!

And I have applied the change that left that import unused also to another file.



---

archive/issue_comments_431439.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks. \n\nAnother comment: `clean_install_dir` and `find_extra_files` have a new argument `distributions`, but the docstrings do not explain it.",
    "created_at": "2022-07-01T01:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431439",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:5'></a>Thanks. 

Another comment: `clean_install_dir` and `find_extra_files` have a new argument `distributions`, but the docstrings do not explain it.



---

archive/issue_comments_431440.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T01:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431441.json:
```json
{
    "body": "<a id='comment:7'></a>Thank you for the update.\n\nI have been testing (using) this ticket and and the sequel #33011 for a while. They works well. I checked the code as far as I can (not very far), and it looks good to me. \n\nIf we don't have further comments on this ticket, then it would better be tested by more developers in the wild by merging this now, so that we can fix problems before the next release.\n\nI will wait for your (not Matthias) meta comments, and proceed to \"positive review\" in a couple of days.",
    "created_at": "2022-07-04T02:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431441",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>Thank you for the update.

I have been testing (using) this ticket and and the sequel #33011 for a while. They works well. I checked the code as far as I can (not very far), and it looks good to me. 

If we don't have further comments on this ticket, then it would better be tested by more developers in the wild by merging this now, so that we can fix problems before the next release.

I will wait for your (not Matthias) meta comments, and proceed to "positive review" in a couple of days.



---

archive/issue_comments_431442.json:
```json
{
    "body": "<a id='comment:8'></a>Is this\n\n```\n./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n```\nbroken? It doesn't work with (and without) this ticket.",
    "created_at": "2022-07-06T06:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431442",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>Is this

```
./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
```
broken? It doesn't work with (and without) this ticket.



---

archive/issue_comments_431443.json:
```json
{
    "body": "<a id='comment:159'></a>Replying to [comment:158 klee]:\n> Is this\n> \n> ```\n> ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n> ```\n> broken? It doesn't work with (and without) this ticket.\n\n\nworks for me (after `make build` from a clean state done)",
    "created_at": "2022-07-06T09:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431443",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:159'></a>Replying to [comment:158 klee]:
> Is this
> 
> ```
> ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
> ```
> broken? It doesn't work with (and without) this ticket.


works for me (after `make build` from a clean state done)



---

archive/issue_comments_431444.json:
```json
{
    "body": "<a id='comment:160'></a>Replying to [comment:159 dimpase]:\n> Replying to [comment:158 klee]:\n> > Is this\n> > \n> > ```\n> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n> > ```\n> > broken? It doesn't work with (and without) this ticket.\n\n> \n> works for me (after `make build` from a clean state done)\n\n\nI did `make distclean; make -j8; ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'`. So this is clean.\n\nThis is the initial part that goes wrong:\n\n```\nsage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\n**********************************************************************\nFile \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\", line 58, in sage.structure.coerce_actions.GenericAction.__init__\nFailed example:\n    M = MatrixSpace(ZZ,2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>\", line 1, in <module>\n        M = MatrixSpace(ZZ,Integer(2))\n    NameError: name 'MatrixSpace' is not defined\n```\nAny clue? I am on Mac.",
    "created_at": "2022-07-06T09:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431444",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:160'></a>Replying to [comment:159 dimpase]:
> Replying to [comment:158 klee]:
> > Is this
> > 
> > ```
> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
> > ```
> > broken? It doesn't work with (and without) this ticket.

> 
> works for me (after `make build` from a clean state done)


I did `make distclean; make -j8; ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'`. So this is clean.

This is the initial part that goes wrong:

```
sage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx
**********************************************************************
File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx", line 58, in sage.structure.coerce_actions.GenericAction.__init__
Failed example:
    M = MatrixSpace(ZZ,2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>", line 1, in <module>
        M = MatrixSpace(ZZ,Integer(2))
    NameError: name 'MatrixSpace' is not defined
```
Any clue? I am on Mac.



---

archive/issue_comments_431445.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-06T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431445",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_431446.json:
```json
{
    "body": "<a id='comment:1'></a>I start from `git clean -fdx` - which cleans much more.\n\nYou'll probably want to move `upstream/` outside and after `git clean` make a symbolic link to it, otherwise it will re-download things.\n\nSo it's positive review from me.",
    "created_at": "2022-07-06T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431446",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>I start from `git clean -fdx` - which cleans much more.

You'll probably want to move `upstream/` outside and after `git clean` make a symbolic link to it, otherwise it will re-download things.

So it's positive review from me.



---

archive/issue_comments_431447.json:
```json
{
    "body": "<a id='comment:162'></a>Replying to [comment:161 dimpase]:\n> I start from `git clean -fdx` - which cleans much more.\n\n\nThanks. But it didn't help. As far as I understand, the doctest failures are expected. The real problem is:\n\n```python\n$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \nPython 3.9.13 (main, May 24 2022, 21:28:31) \n[Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.categories.category import Category\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py\", line 107, in <module>\n    from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge\n  File \"sage/misc/c3_controlled.pyx\", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)\n  File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py\", line 2, in <module>\n    import sage.structure.element\n  File \"sage/structure/element.pyx\", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)\n  File \"sage/structure/category_object.pyx\", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)\nImportError: cannot import name Category\n```\nStrangely this works \n\n```python\nHera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \nPython 3.9.13 (main, May 24 2022, 21:28:31) \n[Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.structure.sage_object import SageObject\n>>> from sage.categories.category import Category\n>>> \n```\n\nAnyway, this is not a problem of this ticket. The situation is the same without this ticket.\n\nHence my positive review to this ticket!",
    "created_at": "2022-07-06T12:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431447",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:162'></a>Replying to [comment:161 dimpase]:
> I start from `git clean -fdx` - which cleans much more.


Thanks. But it didn't help. As far as I understand, the doctest failures are expected. The real problem is:

```python
$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
Python 3.9.13 (main, May 24 2022, 21:28:31) 
[Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.categories.category import Category
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py", line 107, in <module>
    from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge
  File "sage/misc/c3_controlled.pyx", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)
  File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py", line 2, in <module>
    import sage.structure.element
  File "sage/structure/element.pyx", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)
  File "sage/structure/category_object.pyx", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)
ImportError: cannot import name Category
```
Strangely this works 

```python
Hera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
Python 3.9.13 (main, May 24 2022, 21:28:31) 
[Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.structure.sage_object import SageObject
>>> from sage.categories.category import Category
>>> 
```

Anyway, this is not a problem of this ticket. The situation is the same without this ticket.

Hence my positive review to this ticket!



---

archive/issue_comments_431448.json:
```json
{
    "body": "<a id='comment:3'></a>hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.",
    "created_at": "2022-07-06T14:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431448",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.



---

archive/issue_comments_431449.json:
```json
{
    "body": "<a id='comment:164'></a>Replying to [comment:163 dimpase]:\n> hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.\n\n\nYes. But even after removing it from the path, it's the same. \n\n`./configure` shows `python3-3.10.3: using system package; SPKG will not be installed`, and\n\n```python\n$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \nPython 3.9.13 (main, May 24 2022, 21:28:31) \n[Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.path\n['', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python39.zip', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages']\n```\n\n```python\n$ pkgs/sagemath-categories/.tox/python/bin/python \nPython 3.10.4 (main, Apr 26 2022, 19:42:59) [Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.path\n['', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python310.zip', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages']\n```",
    "created_at": "2022-07-06T14:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431449",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:164'></a>Replying to [comment:163 dimpase]:
> hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.


Yes. But even after removing it from the path, it's the same. 

`./configure` shows `python3-3.10.3: using system package; SPKG will not be installed`, and

```python
$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
Python 3.9.13 (main, May 24 2022, 21:28:31) 
[Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.path
['', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python39.zip', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages']
```

```python
$ pkgs/sagemath-categories/.tox/python/bin/python 
Python 3.10.4 (main, Apr 26 2022, 19:42:59) [Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.path
['', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python310.zip', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages']
```



---

archive/issue_comments_431450.json:
```json
{
    "body": "<a id='comment:165'></a>Replying to [comment:159 dimpase]:\n> Replying to [comment:158 klee]:\n> > Is this\n> > \n> > ```\n> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n> > ```\n> > broken? It doesn't work with (and without) this ticket.\n\n> \n> works for me (after `make build` from a clean state done)\n\n\nsagemath-categories (in contrast to sagemath-standard) does not need `make build` because all of its build and runtime dependencies can be found on PyPI.",
    "created_at": "2022-07-06T18:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431450",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:165'></a>Replying to [comment:159 dimpase]:
> Replying to [comment:158 klee]:
> > Is this
> > 
> > ```
> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
> > ```
> > broken? It doesn't work with (and without) this ticket.

> 
> works for me (after `make build` from a clean state done)


sagemath-categories (in contrast to sagemath-standard) does not need `make build` because all of its build and runtime dependencies can be found on PyPI.



---

archive/issue_comments_431451.json:
```json
{
    "body": "<a id='comment:166'></a>Replying to [comment:160 klee]:\n> This is the initial part that goes wrong:\n> \n> ```\n> sage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\n> **********************************************************************\n> File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\", line 58, in sage.structure.coerce_actions.GenericAction.__init__\n> Failed example:\n>     M = MatrixSpace(ZZ,2)\n> Exception raised:\n>     Traceback (most recent call last):\n>       File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>\", line 1, in <module>\n>         M = MatrixSpace(ZZ,Integer(2))\n>     NameError: name 'MatrixSpace' is not defined\n> ```\n\n\n**sagemath-categories** as of this ticket does not contain src/sage/matrix/matrix_space.py (see `pkgs/sagemath-categories/MANIFEST.in`), so `MatrixSpace` is not available in `sage.all__sagemath_categories`.\n\nNote that the `tox` run ends with the message \"lots of doctest failures are expected\". This is one of them.",
    "created_at": "2022-07-06T18:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431451",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:166'></a>Replying to [comment:160 klee]:
> This is the initial part that goes wrong:
> 
> ```
> sage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx
> **********************************************************************
> File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx", line 58, in sage.structure.coerce_actions.GenericAction.__init__
> Failed example:
>     M = MatrixSpace(ZZ,2)
> Exception raised:
>     Traceback (most recent call last):
>       File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>", line 1, in <module>
>         M = MatrixSpace(ZZ,Integer(2))
>     NameError: name 'MatrixSpace' is not defined
> ```


**sagemath-categories** as of this ticket does not contain src/sage/matrix/matrix_space.py (see `pkgs/sagemath-categories/MANIFEST.in`), so `MatrixSpace` is not available in `sage.all__sagemath_categories`.

Note that the `tox` run ends with the message "lots of doctest failures are expected". This is one of them.



---

archive/issue_comments_431452.json:
```json
{
    "body": "<a id='comment:167'></a>Replying to [comment:162 klee]:\n> The real problem is:\n> \n> ```python\n> $ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \n> Python 3.9.13 (main, May 24 2022, 21:28:31) \n> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> from sage.categories.category import Category\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n>   File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py\", line 107, in <module>\n>     from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge\n>   File \"sage/misc/c3_controlled.pyx\", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)\n>   File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py\", line 2, in <module>\n>     import sage.structure.element\n>   File \"sage/structure/element.pyx\", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)\n>   File \"sage/structure/category_object.pyx\", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)\n> ImportError: cannot import name Category\n> ```\n> Strangely this works \n> \n> ```python\n> Hera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \n> Python 3.9.13 (main, May 24 2022, 21:28:31) \n> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> from sage.structure.sage_object import SageObject\n> >>> from sage.categories.category import Category\n> >>> \n> ```\n\n\nThe Sage library contains many cyclic imports. If one starts at the wrong place in an import cycle, one can run into problems with partially initialized modules. See #33580 (Meta-ticket: make all modules importable without sage.all)",
    "created_at": "2022-07-06T18:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431452",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:167'></a>Replying to [comment:162 klee]:
> The real problem is:
> 
> ```python
> $ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
> Python 3.9.13 (main, May 24 2022, 21:28:31) 
> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
> >>> from sage.categories.category import Category
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py", line 107, in <module>
>     from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge
>   File "sage/misc/c3_controlled.pyx", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)
>   File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py", line 2, in <module>
>     import sage.structure.element
>   File "sage/structure/element.pyx", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)
>   File "sage/structure/category_object.pyx", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)
> ImportError: cannot import name Category
> ```
> Strangely this works 
> 
> ```python
> Hera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
> Python 3.9.13 (main, May 24 2022, 21:28:31) 
> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
> >>> from sage.structure.sage_object import SageObject
> >>> from sage.categories.category import Category
> >>> 
> ```


The Sage library contains many cyclic imports. If one starts at the wrong place in an import cycle, one can run into problems with partially initialized modules. See #33580 (Meta-ticket: make all modules importable without sage.all)



---

archive/issue_comments_431453.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks both for the review!",
    "created_at": "2022-07-06T18:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431453",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Thanks both for the review!



---

archive/issue_comments_431454.json:
```json
{
    "body": "<a id='comment:169'></a>Replying to [comment:166 mkoeppe]: \n> Note that the `tox` run ends with the message \"lots of doctest failures are expected\". \n\n\nYes, it's there. It would perhaps better be colored red or green...",
    "created_at": "2022-07-07T04:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431454",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:169'></a>Replying to [comment:166 mkoeppe]: 
> Note that the `tox` run ends with the message "lots of doctest failures are expected". 


Yes, it's there. It would perhaps better be colored red or green...



---

archive/issue_comments_431455.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-07-08T21:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431455",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_431456.json:
```json
{
    "body": "<a id='comment:0'></a>Merge failure on top of:\n\n843eb03e7e Updated [SageMath](SageMath) version to 9.7.beta4\n\n\n\nmerge was not clean: conflicts in pkgs/sagemath-categories/tox.ini",
    "created_at": "2022-07-08T21:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431456",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:0'></a>Merge failure on top of:

843eb03e7e Updated [SageMath](SageMath) version to 9.7.beta4



merge was not clean: conflicts in pkgs/sagemath-categories/tox.ini



---

archive/issue_comments_431457.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-08T23:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431457",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_431458.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-07-08T23:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431458",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_073236.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-10T22:35:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28925#event-73236"
}
```



---

archive/issue_comments_431459.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-10T22:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28925#issuecomment-431459",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
