# Issue 28136: Add number_of_subgroups() method to AbelianGroup

archive/issues_027899.json:
```json
{
    "assignees": [],
    "body": "Using `len(AbelianGroup(...).subgroups())` to find the number of subgroups of an abelian group is inefficient. Using the function `sage.combinat.q_analogues.q_subgroups_of_abelian_group` is much faster. This also allows to find the number of subgroups of a given order more efficiently. For example:\n\n```python\nsage: G = AbelianGroup([10,15,25,12])\nsage: %time len(G.subgroups())\nCPU times: user 33.4 s, sys: 3.88 s, total: 37.3 s\nWall time: 47.5 s\n5760\nsage: %time G.number_of_subgroups()\nCPU times: user 9.39 ms, sys: 160 \u00b5s, total: 9.55 ms\nWall time: 8.74 ms\n5760\nsage: %time G.number_of_subgroups(order=50)\nCPU times: user 4.34 ms, sys: 39 \u00b5s, total: 4.38 ms\nWall time: 3.77 ms\n168\n```\n\nThe commit also fix few ReST typos in the docs of the module.\n\nCC:  @tscrim @fchapoton\n\nComponent: **group theory**\n\nKeywords: **abelian group fpsac2019**\n\nAuthor: **Tomer Bauer**\n\nBranch/Commit: **[`86a9405`](https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28136_\n\n",
    "closed_at": "2020-09-15T21:58:48Z",
    "created_at": "2019-07-08T15:49:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add number_of_subgroups() method to AbelianGroup",
    "type": "issue",
    "updated_at": "2020-09-15T22:01:20Z",
    "url": "https://github.com/sagemath/sage/issues/28136",
    "user": "https://github.com/mathzeta"
}
```
Using `len(AbelianGroup(...).subgroups())` to find the number of subgroups of an abelian group is inefficient. Using the function `sage.combinat.q_analogues.q_subgroups_of_abelian_group` is much faster. This also allows to find the number of subgroups of a given order more efficiently. For example:

```python
sage: G = AbelianGroup([10,15,25,12])
sage: %time len(G.subgroups())
CPU times: user 33.4 s, sys: 3.88 s, total: 37.3 s
Wall time: 47.5 s
5760
sage: %time G.number_of_subgroups()
CPU times: user 9.39 ms, sys: 160 µs, total: 9.55 ms
Wall time: 8.74 ms
5760
sage: %time G.number_of_subgroups(order=50)
CPU times: user 4.34 ms, sys: 39 µs, total: 4.38 ms
Wall time: 3.77 ms
168
```

The commit also fix few ReST typos in the docs of the module.

CC:  @tscrim @fchapoton

Component: **group theory**

Keywords: **abelian group fpsac2019**

Author: **Tomer Bauer**

Branch/Commit: **[`86a9405`](https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/28136_





---

archive/issue_events_382889.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2019-07-08T15:49:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382889"
}
```



---

archive/issue_events_382890.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2019-07-08T15:49:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382890"
}
```



---

archive/issue_events_382891.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2019-07-08T15:49:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382891"
}
```



---

archive/issue_events_382892.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2019-07-08T15:49:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382892"
}
```



---

archive/issue_comments_437700.json:
```json
{
    "body": "Branch: **[u/mathzeta2/28136_add_abelian_group_number_of_subgroups](https://github.com/sagemath/sagetrac-mirror/tree/u/mathzeta2/28136_add_abelian_group_number_of_subgroups)**",
    "created_at": "2019-07-12T14:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437700",
    "user": "https://github.com/mathzeta"
}
```

Branch: **[u/mathzeta2/28136_add_abelian_group_number_of_subgroups](https://github.com/sagemath/sagetrac-mirror/tree/u/mathzeta2/28136_add_abelian_group_number_of_subgroups)**



---

archive/issue_events_382893.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2019-07-12T14:49:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382893"
}
```



---

archive/issue_comments_437701.json:
```json
{
    "body": "Commit: **[`d1d7948`](https://github.com/sagemath/sagetrac-mirror/commit/d1d7948d092e62a7d073e5428adc059e3df0b4ad)**",
    "created_at": "2019-07-12T14:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437701",
    "user": "https://github.com/mathzeta"
}
```

Commit: **[`d1d7948`](https://github.com/sagemath/sagetrac-mirror/commit/d1d7948d092e62a7d073e5428adc059e3df0b4ad)**



---

archive/issue_comments_437702.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,19 @@\n-Using `len(AbelianGroup(...).subgroups())` to find the number of subgroups of an abelian group is inefficient. Using the function `sage.combinat.q_analogues.q_subgroups_of_abelian_group` should be much faster. This will also allow to find the number of subgroups of a given order.\n+Using `len(AbelianGroup(...).subgroups())` to find the number of subgroups of an abelian group is inefficient. Using the function `sage.combinat.q_analogues.q_subgroups_of_abelian_group` is much faster. This also allows to find the number of subgroups of a given order more efficiently. For example:\n+\n+```python\n+sage: G = AbelianGroup([10,15,25,12])\n+sage: %time len(G.subgroups())\n+CPU times: user 33.4 s, sys: 3.88 s, total: 37.3 s\n+Wall time: 47.5 s\n+5760\n+sage: %time G.number_of_subgroups()\n+CPU times: user 9.39 ms, sys: 160 \u00b5s, total: 9.55 ms\n+Wall time: 8.74 ms\n+5760\n+sage: %time G.number_of_subgroups(order=50)\n+CPU times: user 4.34 ms, sys: 39 \u00b5s, total: 4.38 ms\n+Wall time: 3.77 ms\n+168\n+```\n+\n+The commit also fix few ReST typos in the docs of the module.\n``````\n",
    "created_at": "2019-07-12T14:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437702",
    "user": "https://github.com/mathzeta"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,19 @@
-Using `len(AbelianGroup(...).subgroups())` to find the number of subgroups of an abelian group is inefficient. Using the function `sage.combinat.q_analogues.q_subgroups_of_abelian_group` should be much faster. This will also allow to find the number of subgroups of a given order.
+Using `len(AbelianGroup(...).subgroups())` to find the number of subgroups of an abelian group is inefficient. Using the function `sage.combinat.q_analogues.q_subgroups_of_abelian_group` is much faster. This also allows to find the number of subgroups of a given order more efficiently. For example:
+
+```python
+sage: G = AbelianGroup([10,15,25,12])
+sage: %time len(G.subgroups())
+CPU times: user 33.4 s, sys: 3.88 s, total: 37.3 s
+Wall time: 47.5 s
+5760
+sage: %time G.number_of_subgroups()
+CPU times: user 9.39 ms, sys: 160 µs, total: 9.55 ms
+Wall time: 8.74 ms
+5760
+sage: %time G.number_of_subgroups(order=50)
+CPU times: user 4.34 ms, sys: 39 µs, total: 4.38 ms
+Wall time: 3.77 ms
+168
+```
+
+The commit also fix few ReST typos in the docs of the module.
``````




---

archive/issue_comments_437703.json:
```json
{
    "body": "Changed keywords from **abelian group fpsac** to **abelian group fpsac2019**",
    "created_at": "2019-07-12T14:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437703",
    "user": "https://github.com/mathzeta"
}
```

Changed keywords from **abelian group fpsac** to **abelian group fpsac2019**



---

archive/issue_comments_437704.json:
```json
{
    "body": "Changed commit from **[`d1d7948`](https://github.com/sagemath/sagetrac-mirror/commit/d1d7948d092e62a7d073e5428adc059e3df0b4ad)** to **[`0e9c92d`](https://github.com/sagemath/sagetrac-mirror/commit/0e9c92df85f610346840f28ec8a9fe7e50bd88d3)**",
    "created_at": "2019-07-12T15:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d1d7948`](https://github.com/sagemath/sagetrac-mirror/commit/d1d7948d092e62a7d073e5428adc059e3df0b4ad)** to **[`0e9c92d`](https://github.com/sagemath/sagetrac-mirror/commit/0e9c92df85f610346840f28ec8a9fe7e50bd88d3)**



---

archive/issue_comments_437705.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e9c92df85f610346840f28ec8a9fe7e50bd88d3\"><code>0e9c92d</code></a></td><td><code>Implement number_of_subgroups() for AbelianGroup and docs fixes.</code></td></tr></table>\n",
    "created_at": "2019-07-12T15:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437705",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e9c92df85f610346840f28ec8a9fe7e50bd88d3"><code>0e9c92d</code></a></td><td><code>Implement number_of_subgroups() for AbelianGroup and docs fixes.</code></td></tr></table>




---

archive/issue_comments_437706.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nsome tests in torsion_subgroup are not testing the right method",
    "created_at": "2019-07-16T19:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437706",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

some tests in torsion_subgroup are not testing the right method



---

archive/issue_comments_437707.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nA few little details in addition to Fr\u00e9d\u00e9ric's comment:\n\nRemove the period at the end here:\n\n```\n        - ``order`` -- (default: ``None``) find the number of subgroups of this\n          order; if ``None``, this defaults to counting all subgroups.\n```\n\nTypo: `infinitly` -> `infinitely`\n\nThis is faster:\n\n```diff\n             for p, p_exps in six.iteritems(sylow_types):\n-                p_exps.sort(reverse=True)\n-                p_exps = Partition(p_exps)\n-                orders_by_prime[p] = range(p_exps.size() + 1)\n+                orders_by_prime[p] = range(sum(p_exps) + 1)\n```\nthere is no need to create the partition just to get its size.\n\nI don't understand what this code does:\n\n```python\n            for p, p_exps in six.iteritems(sylow_types):\n                p_exps.sort(reverse=True)\n                p_exps = Partition(p_exps)\n                orders_by_prime[p] = [order_exps[p]]\n```\n`p_exps` is never used to do any computation. Shouldn't you just remove that part?\n\nI am guessing you are meaning to modify in place the `p_exps`, which the call to `sort` does, but I am pretty sure the `Partition` call does not. In either case, this should be done in the loop you actually use it:\n\n```diff\n         for p, p_exps in six.iteritems(sylow_types):\n             p_result = Integer(0)\n+            p_exps.sort(reverse=True)\n             for i in orders_by_prime[p]:\n                 for mu in Partitions(i, outer=p_exps):\n                     p_result += q_subgroups_of_abelian_group(p_exps, mu, q=p)\n             result *= p_result\n         return result\n```",
    "created_at": "2019-07-21T06:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437707",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

A few little details in addition to Frédéric's comment:

Remove the period at the end here:

```
        - ``order`` -- (default: ``None``) find the number of subgroups of this
          order; if ``None``, this defaults to counting all subgroups.
```

Typo: `infinitly` -> `infinitely`

This is faster:

```diff
             for p, p_exps in six.iteritems(sylow_types):
-                p_exps.sort(reverse=True)
-                p_exps = Partition(p_exps)
-                orders_by_prime[p] = range(p_exps.size() + 1)
+                orders_by_prime[p] = range(sum(p_exps) + 1)
```
there is no need to create the partition just to get its size.

I don't understand what this code does:

```python
            for p, p_exps in six.iteritems(sylow_types):
                p_exps.sort(reverse=True)
                p_exps = Partition(p_exps)
                orders_by_prime[p] = [order_exps[p]]
```
`p_exps` is never used to do any computation. Shouldn't you just remove that part?

I am guessing you are meaning to modify in place the `p_exps`, which the call to `sort` does, but I am pretty sure the `Partition` call does not. In either case, this should be done in the loop you actually use it:

```diff
         for p, p_exps in six.iteritems(sylow_types):
             p_result = Integer(0)
+            p_exps.sort(reverse=True)
             for i in orders_by_prime[p]:
                 for mu in Partitions(i, outer=p_exps):
                     p_result += q_subgroups_of_abelian_group(p_exps, mu, q=p)
             result *= p_result
         return result
```



---

archive/issue_comments_437708.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad872249463bebdac0a7a13d52d6c1bf04043021\"><code>ad87224</code></a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into u/mathzeta2/28136_add_abelian_group_number_of_subgroups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21d8df7cc375aa367a7b7e436bf980af02298d59\"><code>21d8df7</code></a></td><td><code>Review fixes of number_of_subgroups()</code></td></tr></table>\n",
    "created_at": "2019-07-28T15:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437708",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad872249463bebdac0a7a13d52d6c1bf04043021"><code>ad87224</code></a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into u/mathzeta2/28136_add_abelian_group_number_of_subgroups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21d8df7cc375aa367a7b7e436bf980af02298d59"><code>21d8df7</code></a></td><td><code>Review fixes of number_of_subgroups()</code></td></tr></table>




---

archive/issue_comments_437709.json:
```json
{
    "body": "Changed commit from **[`0e9c92d`](https://github.com/sagemath/sagetrac-mirror/commit/0e9c92df85f610346840f28ec8a9fe7e50bd88d3)** to **[`21d8df7`](https://github.com/sagemath/sagetrac-mirror/commit/21d8df7cc375aa367a7b7e436bf980af02298d59)**",
    "created_at": "2019-07-28T15:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437709",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0e9c92d`](https://github.com/sagemath/sagetrac-mirror/commit/0e9c92df85f610346840f28ec8a9fe7e50bd88d3)** to **[`21d8df7`](https://github.com/sagemath/sagetrac-mirror/commit/21d8df7cc375aa367a7b7e436bf980af02298d59)**



---

archive/issue_comments_437710.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@fchapoton](#comment%3A3):\n> some tests in torsion_subgroup are not testing the right method\n> \n\nThanks, fixed. Mmmm, that was an embarrassing oversight.\n\nReplying to [@tscrim](#comment%3A4):\n> A few little details in addition to Fr\u00e9d\u00e9ric's comment:\n> \n> Remove the period at the end here:\n> \n> ```\n>         - ``order`` -- (default: ``None``) find the number of subgroups of this\n>           order; if ``None``, this defaults to counting all subgroups.\n> ```\n> \n> Typo: `infinitly` -> `infinitely`\n> \n> [...]\n\nThanks, fixed.\n\nFor the other things, I think I wanted to use the [robustness principle](https://en.wikipedia.org/wiki/Robustness_principle), thinking that `q_subgroups_of_abelian_group` needs to an integer partition for input. Now I removed even importing `Partition` and followed your suggestions.",
    "created_at": "2019-07-28T15:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437710",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@fchapoton](#comment%3A3):
> some tests in torsion_subgroup are not testing the right method
> 

Thanks, fixed. Mmmm, that was an embarrassing oversight.

Replying to [@tscrim](#comment%3A4):
> A few little details in addition to Frédéric's comment:
> 
> Remove the period at the end here:
> 
> ```
>         - ``order`` -- (default: ``None``) find the number of subgroups of this
>           order; if ``None``, this defaults to counting all subgroups.
> ```
> 
> Typo: `infinitly` -> `infinitely`
> 
> [...]

Thanks, fixed.

For the other things, I think I wanted to use the [robustness principle](https://en.wikipedia.org/wiki/Robustness_principle), thinking that `q_subgroups_of_abelian_group` needs to an integer partition for input. Now I removed even importing `Partition` and followed your suggestions.



---

archive/issue_comments_437711.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mathzeta](#comment%3A6):\n> For the other things, I think I wanted to use the [robustness principle](https://en.wikipedia.org/wiki/Robustness_principle), thinking that `q_subgroups_of_abelian_group` needs to an integer partition for input. Now I removed even importing `Partition` and followed your suggestions.\n\nI think my changes might have increased the types of input it could take, but is not so important.\n\nOne last thing I noticed (which should result in a speedup):\n\n```diff\n-            p_result = Integer(0)\n             p_exps.sort(reverse=True)\n-            for i in subgroups_orders_by_prime[p]:\n-                for mu in Partitions(i, outer=p_exps):\n-                    p_result += q_subgroups_of_abelian_group(p_exps, mu, q=p)\n-            result *= p_result\n+            result *= sum(q_subgroups_of_abelian_group(p_exps, mu, q=p)\n+                          for i in subgroups_orders_by_prime[p]\n+                          for mu in Partitions(i, outer=p_exps))\n```\nIt would be even faster if you avoided the transient `Partition` objects and just passed a list, but that would mean modifying `q_subgroups_of_abelian_group`, possibly for not much gain. (Definitely a separate ticket.)",
    "created_at": "2019-07-28T18:41:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437711",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mathzeta](#comment%3A6):
> For the other things, I think I wanted to use the [robustness principle](https://en.wikipedia.org/wiki/Robustness_principle), thinking that `q_subgroups_of_abelian_group` needs to an integer partition for input. Now I removed even importing `Partition` and followed your suggestions.

I think my changes might have increased the types of input it could take, but is not so important.

One last thing I noticed (which should result in a speedup):

```diff
-            p_result = Integer(0)
             p_exps.sort(reverse=True)
-            for i in subgroups_orders_by_prime[p]:
-                for mu in Partitions(i, outer=p_exps):
-                    p_result += q_subgroups_of_abelian_group(p_exps, mu, q=p)
-            result *= p_result
+            result *= sum(q_subgroups_of_abelian_group(p_exps, mu, q=p)
+                          for i in subgroups_orders_by_prime[p]
+                          for mu in Partitions(i, outer=p_exps))
```
It would be even faster if you avoided the transient `Partition` objects and just passed a list, but that would mean modifying `q_subgroups_of_abelian_group`, possibly for not much gain. (Definitely a separate ticket.)



---

archive/issue_comments_437712.json:
```json
{
    "body": "Changed commit from **[`21d8df7`](https://github.com/sagemath/sagetrac-mirror/commit/21d8df7cc375aa367a7b7e436bf980af02298d59)** to **[`8e33149`](https://github.com/sagemath/sagetrac-mirror/commit/8e33149725a130dbb899f298834ad77e18f0df3d)**",
    "created_at": "2019-07-28T22:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437712",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`21d8df7`](https://github.com/sagemath/sagetrac-mirror/commit/21d8df7cc375aa367a7b7e436bf980af02298d59)** to **[`8e33149`](https://github.com/sagemath/sagetrac-mirror/commit/8e33149725a130dbb899f298834ad77e18f0df3d)**



---

archive/issue_comments_437713.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e33149725a130dbb899f298834ad77e18f0df3d\"><code>8e33149</code></a></td><td><code>Use IntegerListsLex in AbelianGroup.number_of_subgroups().</code></td></tr></table>\n",
    "created_at": "2019-07-28T22:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437713",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e33149725a130dbb899f298834ad77e18f0df3d"><code>8e33149</code></a></td><td><code>Use IntegerListsLex in AbelianGroup.number_of_subgroups().</code></td></tr></table>




---

archive/issue_comments_437714.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIn general, after trying to use lists instead of `Partition` objects, it always seems like the start of a re-implementation of `Partition`'s methods. I assume speeding up src/sage/combinat/partition.py, for example cythonizing it, will bring more benefit. But that is for a separate ticket, too.\n\nFor `q_subgroups_of_abelian_group`, there is the helper function `sage.combinat.partition.conjugate` which return a list (and is used in `Partition.conjugate`), but it still not enough to remove the convenience of using `Partition`.\n\nInstead of iterating over `Partitions(i, outer=p_exps)` I tried `IntegerListsLex` and there was a speedup. Does the code looks clearer with the \"long\" `sum`? I do not mind making the change.",
    "created_at": "2019-07-28T22:58:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437714",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:9" align="right">comment:9</div>

In general, after trying to use lists instead of `Partition` objects, it always seems like the start of a re-implementation of `Partition`'s methods. I assume speeding up src/sage/combinat/partition.py, for example cythonizing it, will bring more benefit. But that is for a separate ticket, too.

For `q_subgroups_of_abelian_group`, there is the helper function `sage.combinat.partition.conjugate` which return a list (and is used in `Partition.conjugate`), but it still not enough to remove the convenience of using `Partition`.

Instead of iterating over `Partitions(i, outer=p_exps)` I tried `IntegerListsLex` and there was a speedup. Does the code looks clearer with the "long" `sum`? I do not mind making the change.



---

archive/issue_comments_437715.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437715",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

Ticket retargeted after milestone closed



---

archive/issue_events_382894.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382894"
}
```



---

archive/issue_events_382895.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382895"
}
```



---

archive/issue_comments_437716.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437716",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_382896.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382896"
}
```



---

archive/issue_events_382897.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382897"
}
```



---

archive/issue_events_382898.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382898"
}
```



---

archive/issue_events_382899.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382899"
}
```



---

archive/issue_comments_437717.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/708412630e68438b1044b844fd78e0ce14e67ea8\"><code>7084126</code></a></td><td><code>Merge branch 'u/mathzeta2/28136_add_abelian_group_number_of_subgroups' of git://trac.sagemath.org/sage into tmp</code></td></tr></table>\n",
    "created_at": "2020-09-09T09:45:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437717",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/708412630e68438b1044b844fd78e0ce14e67ea8"><code>7084126</code></a></td><td><code>Merge branch 'u/mathzeta2/28136_add_abelian_group_number_of_subgroups' of git://trac.sagemath.org/sage into tmp</code></td></tr></table>




---

archive/issue_comments_437718.json:
```json
{
    "body": "Changed commit from **[`8e33149`](https://github.com/sagemath/sagetrac-mirror/commit/8e33149725a130dbb899f298834ad77e18f0df3d)** to **[`7084126`](https://github.com/sagemath/sagetrac-mirror/commit/708412630e68438b1044b844fd78e0ce14e67ea8)**",
    "created_at": "2020-09-09T09:45:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437718",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8e33149`](https://github.com/sagemath/sagetrac-mirror/commit/8e33149725a130dbb899f298834ad77e18f0df3d)** to **[`7084126`](https://github.com/sagemath/sagetrac-mirror/commit/708412630e68438b1044b844fd78e0ce14e67ea8)**



---

archive/issue_comments_437719.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffdb927781d8e748a226cf489fe3909f905e0c53\"><code>ffdb927</code></a></td><td><code>Python 3: remove six.iteritems()</code></td></tr></table>\n",
    "created_at": "2020-09-09T09:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437719",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffdb927781d8e748a226cf489fe3909f905e0c53"><code>ffdb927</code></a></td><td><code>Python 3: remove six.iteritems()</code></td></tr></table>




---

archive/issue_comments_437720.json:
```json
{
    "body": "Changed commit from **[`7084126`](https://github.com/sagemath/sagetrac-mirror/commit/708412630e68438b1044b844fd78e0ce14e67ea8)** to **[`ffdb927`](https://github.com/sagemath/sagetrac-mirror/commit/ffdb927781d8e748a226cf489fe3909f905e0c53)**",
    "created_at": "2020-09-09T09:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437720",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7084126`](https://github.com/sagemath/sagetrac-mirror/commit/708412630e68438b1044b844fd78e0ce14e67ea8)** to **[`ffdb927`](https://github.com/sagemath/sagetrac-mirror/commit/ffdb927781d8e748a226cf489fe3909f905e0c53)**



---

archive/issue_comments_437721.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nreplaced `six.iteritems()` with `.items()`. Ready for review.",
    "created_at": "2020-09-09T09:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437721",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:15" align="right">comment:15</div>

replaced `six.iteritems()` with `.items()`. Ready for review.



---

archive/issue_comments_437722.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nPut your name down in the author slot so the patchbot will run. Once that comes back green, then positive review. Sorry for loosing track of this.",
    "created_at": "2020-09-09T23:01:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437722",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Put your name down in the author slot so the patchbot will run. Once that comes back green, then positive review. Sorry for loosing track of this.



---

archive/issue_comments_437723.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-09-09T23:01:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437723",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_437724.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@tscrim](#comment%3A16):\n> Put your name down in the author slot so the patchbot will run.\n\nThanks. I forget this, and then wonder why the patchbot did not run.",
    "created_at": "2020-09-09T23:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437724",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@tscrim](#comment%3A16):
> Put your name down in the author slot so the patchbot will run.

Thanks. I forget this, and then wonder why the patchbot did not run.



---

archive/issue_comments_437725.json:
```json
{
    "body": "Author: **Tomer Bauer**",
    "created_at": "2020-09-09T23:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437725",
    "user": "https://github.com/mathzeta"
}
```

Author: **Tomer Bauer**



---

archive/issue_comments_437726.json:
```json
{
    "body": "Changed commit from **[`ffdb927`](https://github.com/sagemath/sagetrac-mirror/commit/ffdb927781d8e748a226cf489fe3909f905e0c53)** to **[`de2db70`](https://github.com/sagemath/sagetrac-mirror/commit/de2db70af65171ea3cd21c7f404bca3a5c2a4a0b)**",
    "created_at": "2020-09-10T15:54:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437726",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ffdb927`](https://github.com/sagemath/sagetrac-mirror/commit/ffdb927781d8e748a226cf489fe3909f905e0c53)** to **[`de2db70`](https://github.com/sagemath/sagetrac-mirror/commit/de2db70af65171ea3cd21c7f404bca3a5c2a4a0b)**



---

archive/issue_comments_437727.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de2db70af65171ea3cd21c7f404bca3a5c2a4a0b\"><code>de2db70</code></a></td><td><code>pyflakes fix: local variables assigned to but never used</code></td></tr></table>\n",
    "created_at": "2020-09-10T15:54:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437727",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de2db70af65171ea3cd21c7f404bca3a5c2a4a0b"><code>de2db70</code></a></td><td><code>pyflakes fix: local variables assigned to but never used</code></td></tr></table>




---

archive/issue_comments_437728.json:
```json
{
    "body": "Changed commit from **[`de2db70`](https://github.com/sagemath/sagetrac-mirror/commit/de2db70af65171ea3cd21c7f404bca3a5c2a4a0b)** to **[`86a9405`](https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7)**",
    "created_at": "2020-09-10T16:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437728",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`de2db70`](https://github.com/sagemath/sagetrac-mirror/commit/de2db70af65171ea3cd21c7f404bca3a5c2a4a0b)** to **[`86a9405`](https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7)**



---

archive/issue_comments_437729.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7\"><code>86a9405</code></a></td><td><code>pyflakes fix: local variable 'nn' is assigned to but never used</code></td></tr></table>\n",
    "created_at": "2020-09-10T16:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437729",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7"><code>86a9405</code></a></td><td><code>pyflakes fix: local variable 'nn' is assigned to but never used</code></td></tr></table>




---

archive/issue_events_382900.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2020-09-10T21:10:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382900"
}
```



---

archive/issue_events_382901.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2020-09-10T21:10:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382901"
}
```



---

archive/issue_comments_437730.json:
```json
{
    "body": "Changed branch from **[u/mathzeta2/28136_add_abelian_group_number_of_subgroups](https://github.com/sagemath/sagetrac-mirror/tree/u/mathzeta2/28136_add_abelian_group_number_of_subgroups)** to **[`86a9405`](https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7)**",
    "created_at": "2020-09-15T21:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28136#issuecomment-437730",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mathzeta2/28136_add_abelian_group_number_of_subgroups](https://github.com/sagemath/sagetrac-mirror/tree/u/mathzeta2/28136_add_abelian_group_number_of_subgroups)** to **[`86a9405`](https://github.com/sagemath/sagetrac-mirror/commit/86a9405b69606ed720dae5dd572c0d97ebef48b7)**



---

archive/issue_events_382902.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T21:58:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382902"
}
```



---

archive/issue_events_382903.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "70ea8fedf0bcbd6fd98f3786a3fb41075d82a763",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-09-15T21:58:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382903"
}
```



---

archive/issue_events_382904.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T22:01:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382904"
}
```



---

archive/issue_events_382905.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T22:01:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28136",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28136#event-382905"
}
```
