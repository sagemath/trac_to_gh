# Issue 28711: Fix spkg-install of p_group_cohomology

archive/issues_028474.json:
```json
{
    "assignees": [],
    "body": "This is a reformulation of the ticket summary, after some discussion went on.\n\np_group_cohomology is divided into four parts:\n- a C-library libmodres (autotoolized), also providing a data base.\n- a pip-installable collection of Python / Cython modules\n- some files containing GAP code (let's call it GAP helper module)\n- a documentation using sphinx\n\nProblem: Some of the modules refer to SAGE_LOCAL at installation or at run time, respectively. Moreover, the GAP helper module is currently installed into SAGE_LOCAL/share/sage, which has been removed.\n\nIssues of each part:\n- The C-library seems totally fine. One could consider to turn it into a stand-alone spkg.\n- The Python / Cython modules seem mostly fine. Problems: \n  - Its setup.py takes the job of installing the GAP helper module, in a folder whose location is determined from the value of SAGE_LOCAL and which actually doesn't exist any longer.\n  - Some Python module makes GAP read the GAP helper module, thus also determines the import location from the value of SAGE_LOCAL.\n  Proposed solution:\n  - It shouldn't be the job of setup.py to install the GAP helper module.\n  - It should be possible for GAP to load the helper module without explicitly constructing a path derived from SAGE_LOCAL.\n  Side remark: It would be possible to move the Python / Cython modules into Sage's src tree, but that would created issues with testing and documentation.\n- The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage(\"pGroupCohomologyHelpers\");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?\n- Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.\n\n**Upstream of the package:** https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2\n\nCC:  @embray @jhpalmieri @orlitzky @kiwifb @dimpase\n\nBranch/Commit: **[f4e5f6a](https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9)**\n\nReviewer: **Dima Pasechnik, Matthias Koeppe**\n\nAuthor: **Simon King**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28711_\n\n",
    "closed_at": "2020-10-31T18:07:39Z",
    "created_at": "2019-11-08T22:02:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix spkg-install of p_group_cohomology",
    "type": "issue",
    "updated_at": "2020-10-31T18:07:39Z",
    "url": "https://github.com/sagemath/sage/issues/28711",
    "user": "https://github.com/simon-king-jena"
}
```
This is a reformulation of the ticket summary, after some discussion went on.

p_group_cohomology is divided into four parts:
- a C-library libmodres (autotoolized), also providing a data base.
- a pip-installable collection of Python / Cython modules
- some files containing GAP code (let's call it GAP helper module)
- a documentation using sphinx

Problem: Some of the modules refer to SAGE_LOCAL at installation or at run time, respectively. Moreover, the GAP helper module is currently installed into SAGE_LOCAL/share/sage, which has been removed.

Issues of each part:
- The C-library seems totally fine. One could consider to turn it into a stand-alone spkg.
- The Python / Cython modules seem mostly fine. Problems: 
  - Its setup.py takes the job of installing the GAP helper module, in a folder whose location is determined from the value of SAGE_LOCAL and which actually doesn't exist any longer.
  - Some Python module makes GAP read the GAP helper module, thus also determines the import location from the value of SAGE_LOCAL.
  Proposed solution:
  - It shouldn't be the job of setup.py to install the GAP helper module.
  - It should be possible for GAP to load the helper module without explicitly constructing a path derived from SAGE_LOCAL.
  Side remark: It would be possible to move the Python / Cython modules into Sage's src tree, but that would created issues with testing and documentation.
- The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage("pGroupCohomologyHelpers");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?
- Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.

**Upstream of the package:** https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2

CC:  @embray @jhpalmieri @orlitzky @kiwifb @dimpase

Branch/Commit: **[f4e5f6a](https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9)**

Reviewer: **Dima Pasechnik, Matthias Koeppe**

Author: **Simon King**

_Issue created by migration from https://trac.sagemath.org/ticket/28711_





---

archive/issue_events_376089.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-11-08T22:02:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376089"
}
```



---

archive/issue_events_376090.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-11-08T22:02:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376090"
}
```



---

archive/issue_events_376091.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-11-08T22:02:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376091"
}
```



---

archive/issue_events_376092.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-11-08T22:02:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376092"
}
```



---

archive/issue_comments_450645.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThe spkg-install script does use sdh_configure, sdh_make and sdh_pip_install, but is also uses \"$MAKE install\" and \"$MAKE html\" and \"cp -r\". I guess \"$MAKE install\" should become \"sdh_make_install\", but I don't know what to do with \"$MAKE html\" and \"cp -r\" which is used to build and install the package documentation.",
    "created_at": "2019-11-08T22:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450645",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">Comment 1</div>

The spkg-install script does use sdh_configure, sdh_make and sdh_pip_install, but is also uses "$MAKE install" and "$MAKE html" and "cp -r". I guess "$MAKE install" should become "sdh_make_install", but I don't know what to do with "$MAKE html" and "cp -r" which is used to build and install the package documentation.



---

archive/issue_comments_450646.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-The three parts of p_group_cohomology, namely a c-library libmodres and a bunch of Cython and Python modules and a documentation using sphinx, are supposed to allow DESTDIR install. However, if I understand correctly, the current spkg-install script prevents this. The purpose of this ticket is to fix it.\n+The three parts of p_group_cohomology, namely a c-library libmodres (autotoolized) and a bunch of Cython and Python modules (pip installable) and a documentation using sphinx, are supposed to allow DESTDIR install. However, if I understand correctly, the current spkg-install script prevents this. The purpose of this ticket is to fix it.\n \n``````\n",
    "created_at": "2019-11-08T22:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450646",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-The three parts of p_group_cohomology, namely a c-library libmodres and a bunch of Cython and Python modules and a documentation using sphinx, are supposed to allow DESTDIR install. However, if I understand correctly, the current spkg-install script prevents this. The purpose of this ticket is to fix it.
+The three parts of p_group_cohomology, namely a c-library libmodres (autotoolized) and a bunch of Cython and Python modules (pip installable) and a documentation using sphinx, are supposed to allow DESTDIR install. However, if I understand correctly, the current spkg-install script prevents this. The purpose of this ticket is to fix it.
 
``````




---

archive/issue_comments_450647.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nCan you use `$MAKE html` to build the documentation and then `sdh_install` to install it?",
    "created_at": "2019-11-08T22:15:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450647",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">Comment 3</div>

Can you use `$MAKE html` to build the documentation and then `sdh_install` to install it?



---

archive/issue_events_376093.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376093"
}
```



---

archive/issue_events_376094.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376094"
}
```



---

archive/issue_comments_450648.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450648",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">Comment 4</div>

Ticket retargeted after milestone closed



---

archive/issue_events_376095.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-24T02:05:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376095"
}
```



---

archive/issue_events_376096.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-24T02:05:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376096"
}
```



---

archive/issue_comments_450649.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nAlso it looks like dependencies are not right.\nhttps://github.com/mkoeppe/sage/runs/874569119",
    "created_at": "2020-07-15T21:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450649",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

Also it looks like dependencies are not right.
https://github.com/mkoeppe/sage/runs/874569119



---

archive/issue_comments_450650.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nThere have for a long time been issues with installation of `p_group_cohomology`: it seems that you have to install `meataxe` and then run `sage -b` and then install `p_group_cohomology`. Something like that, anyway. If someone could straighten that out, that would be great.",
    "created_at": "2020-07-15T21:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450650",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">Comment 8</div>

There have for a long time been issues with installation of `p_group_cohomology`: it seems that you have to install `meataxe` and then run `sage -b` and then install `p_group_cohomology`. Something like that, anyway. If someone could straighten that out, that would be great.



---

archive/issue_comments_450651.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI have been reluctant to work on `p_group_cohomology` for a long time because of the state of `meataxe` - in the installation department. I am not planning to work on this until there is proof of improvement. In the past I would have been willing to help with that, nowadays I am considering myself overcommitted already.",
    "created_at": "2020-07-15T21:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450651",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">Comment 9</div>

I have been reluctant to work on `p_group_cohomology` for a long time because of the state of `meataxe` - in the installation department. I am not planning to work on this until there is proof of improvement. In the past I would have been willing to help with that, nowadays I am considering myself overcommitted already.



---

archive/issue_comments_450652.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThanks for the info. Then let's postpone work on this until after modularization of sagelib, which will eliminate this complicated dependency.",
    "created_at": "2020-07-15T21:42:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450652",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">Comment 10</div>

Thanks for the info. Then let's postpone work on this until after modularization of sagelib, which will eliminate this complicated dependency.



---

archive/issue_events_376097.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-15T21:42:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376097"
}
```



---

archive/issue_events_376098.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-15T21:42:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376098"
}
```



---

archive/issue_comments_450653.json:
```json
{
    "body": "Dependencies: **#30151**",
    "created_at": "2020-07-15T21:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450653",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30151**



---

archive/issue_comments_450654.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThere is an issue that came up at #30349: Apparently there is a problem with the installation folder of gap code that is part of the package. It isn't clear to me how this should be fixed.",
    "created_at": "2020-10-15T16:28:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450654",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">Comment 13</div>

There is an issue that came up at #30349: Apparently there is a problem with the installation folder of gap code that is part of the package. It isn't clear to me how this should be fixed.



---

archive/issue_comments_450655.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nOn the other ticket, Dima stated:\n\n///\n\nYou can call GAP and examine GAPInfo.RootPaths. When looking for a package, GAP appends pkg/ to each directory in this list, cf. 9.2 GAP Root Directories in its manual.\n\nIMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (\u200bhttps://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. \n\n///\n\nSo, I'll have a look at it.\n\nQuestion: When using GAP's package manager, it would probably be possible to do it in the setup.py, using libgap. Should I keep it there, or is it cleaner to move installation of GAP code to spkg-install?",
    "created_at": "2020-10-15T16:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450655",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">Comment 14</div>

On the other ticket, Dima stated:

///

You can call GAP and examine GAPInfo.RootPaths. When looking for a package, GAP appends pkg/ to each directory in this list, cf. 9.2 GAP Root Directories in its manual.

IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (​https://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. 

///

So, I'll have a look at it.

Question: When using GAP's package manager, it would probably be possible to do it in the setup.py, using libgap. Should I keep it there, or is it cleaner to move installation of GAP code to spkg-install?



---

archive/issue_comments_450656.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\none can do this in setup.py regardless, getting a proper path to install a GAP package to is just\n\n```\nsage: next(filter(lambda l: l.sage().startswith(SAGE_LOCAL), libgap.eval('GAPInfo.RootPaths'))).sage()+'pkg/'                                                                                                                          \n'/mnt/opt/Sage/sage-dev/local/share/gap/pkg/'\n```",
    "created_at": "2020-10-15T18:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450656",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">Comment 15</div>

one can do this in setup.py regardless, getting a proper path to install a GAP package to is just

```
sage: next(filter(lambda l: l.sage().startswith(SAGE_LOCAL), libgap.eval('GAPInfo.RootPaths'))).sage()+'pkg/'                                                                                                                          
'/mnt/opt/Sage/sage-dev/local/share/gap/pkg/'
```



---

archive/issue_comments_450657.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nnot sure how \"pythonic\" this is though.",
    "created_at": "2020-10-15T18:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450657",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">Comment 16</div>

not sure how "pythonic" this is though.



---

archive/issue_comments_450658.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nReplying to [@simon-king-jena](#comment%3A14):\n> IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (\u200bhttps://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. \n\nDo I understand correctly that GAP's PackageManager is for installing packages from the GAP ecosystem? What I want to do is to use some GAP code that is NOT an upstream GAP package (not even an unofficial \"submitted\" package).\n\nAnyway, using some GAP infrastructure to install my files, rather than hacking paths, seems the right approach to me.",
    "created_at": "2020-10-15T20:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450658",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">Comment 17</div>

Replying to [@simon-king-jena](#comment%3A14):
> IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (​https://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. 

Do I understand correctly that GAP's PackageManager is for installing packages from the GAP ecosystem? What I want to do is to use some GAP code that is NOT an upstream GAP package (not even an unofficial "submitted" package).

Anyway, using some GAP infrastructure to install my files, rather than hacking paths, seems the right approach to me.



---

archive/issue_comments_450659.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nI see one and a half clear disadvantages of the PackageManager:\n\nThe PackageManager is provided by the gap_packages spkg. Thus, p_group_cohomology would need yet another dependency. I'd rather avoid to add it. It should be enough to have the Small Groups library in GAP (which I think meanwhile is available without installing optional spkgs).\n\nThe \"half\" disadvantage is the GAP-typical lack of a clear documentation. The documentation of InstallPackage says that one way to install a package is to provide the URL of a valid PackageInfo.g file. But nowhere is defined (at least I couldn't find it at https://gap-packages.github.io/PackageManager/doc/chap0.html) what constitutes a \"valid\" PackageInfo.g file.\n\nIn other words, it is explained how to install a package, but it is not explained how to create a package that can be installed.\n\nDo you have pointers how to create a GAP package?",
    "created_at": "2020-10-15T20:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450659",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">Comment 18</div>

I see one and a half clear disadvantages of the PackageManager:

The PackageManager is provided by the gap_packages spkg. Thus, p_group_cohomology would need yet another dependency. I'd rather avoid to add it. It should be enough to have the Small Groups library in GAP (which I think meanwhile is available without installing optional spkgs).

The "half" disadvantage is the GAP-typical lack of a clear documentation. The documentation of InstallPackage says that one way to install a package is to provide the URL of a valid PackageInfo.g file. But nowhere is defined (at least I couldn't find it at https://gap-packages.github.io/PackageManager/doc/chap0.html) what constitutes a "valid" PackageInfo.g file.

In other words, it is explained how to install a package, but it is not explained how to create a package that can be installed.

Do you have pointers how to create a GAP package?



---

archive/issue_comments_450660.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nPS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.\n\nSo, I guess it is no option.",
    "created_at": "2020-10-15T20:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450660",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">Comment 19</div>

PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.

So, I guess it is no option.



---

archive/issue_comments_450661.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nI am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.\n\nWHAT NEEDS TO BE AVAILABLE:\n- A couple of .g files, containing function definitions.\n\nCURRENT APPROACH:\n- Install the files into $SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/\n- Let setup.py do the installation\n\nCURRENT PROBLEM:\n- As reported on #30349, Sage totally messes up the path. Note that I have never seen that problem, myself.\n- It is argued that installation of the .g files should be done in spkg-install, not in setup.py.\n\nALTERNATIVE APPROACH:\n- Put the files somewhere else, such as $SAGE_LOCAL/share/gap/pkg/\n- Let spkg-install do the installation, perhaps via some GAP tool\n\nPROBLEM WITH THE ALTERNATIVE APPROACH:\n- I don't consider the couple of .g files a \"package\" for GAP.\n- Potential GAP tools seem to be not part of the gap_packages spkg. Thus, aren't readily available in Sage.\n\nSo, I believe the current approach is just fine: We need a place for some GAP readable files, that logically belong to a Sage package (p_group_cohomology) but can hardly be seen a stand-alone GAP package. Thus, some place in $SAGE_LOCAL/share/sage/ext/gap seems just right to me.\n\nOnly we need to understand why, according to #30349, Sage puts stuff into $SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/, although setup.py clearly states, `data_files=[(os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")`.",
    "created_at": "2020-10-15T21:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450661",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">Comment 20</div>

I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.

WHAT NEEDS TO BE AVAILABLE:
- A couple of .g files, containing function definitions.

CURRENT APPROACH:
- Install the files into $SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/
- Let setup.py do the installation

CURRENT PROBLEM:
- As reported on #30349, Sage totally messes up the path. Note that I have never seen that problem, myself.
- It is argued that installation of the .g files should be done in spkg-install, not in setup.py.

ALTERNATIVE APPROACH:
- Put the files somewhere else, such as $SAGE_LOCAL/share/gap/pkg/
- Let spkg-install do the installation, perhaps via some GAP tool

PROBLEM WITH THE ALTERNATIVE APPROACH:
- I don't consider the couple of .g files a "package" for GAP.
- Potential GAP tools seem to be not part of the gap_packages spkg. Thus, aren't readily available in Sage.

So, I believe the current approach is just fine: We need a place for some GAP readable files, that logically belong to a Sage package (p_group_cohomology) but can hardly be seen a stand-alone GAP package. Thus, some place in $SAGE_LOCAL/share/sage/ext/gap seems just right to me.

Only we need to understand why, according to #30349, Sage puts stuff into $SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/, although setup.py clearly states, `data_files=[(os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")`.



---

archive/issue_comments_450662.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nAHA! Can it be that $SAGE_LOCAL/share/sage has been removed?\n\n```\nsage: 'sage' in os.listdir(os.path.join(SAGE_LOCAL,\"share\"))                                                       \nFalse\nsage: 'gap' in os.listdir(os.path.join(SAGE_LOCAL,\"share\"))                                                        \nTrue\n```\n\nThen of course a different location is needed. In that case, os.listdir(os.path.join(SAGE_LOCAL,\"share\",\"gap\",\"pkg\",\"p_group_cohomology\")) seems good to me.\n\nEDIT: Since it isn't really a GAP package, os.listdir(os.path.join(SAGE_LOCAL,\"share\",\"p_group_cohomology\")) seems better!",
    "created_at": "2020-10-15T21:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450662",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">Comment 21</div>

AHA! Can it be that $SAGE_LOCAL/share/sage has been removed?

```
sage: 'sage' in os.listdir(os.path.join(SAGE_LOCAL,"share"))                                                       
False
sage: 'gap' in os.listdir(os.path.join(SAGE_LOCAL,"share"))                                                        
True
```

Then of course a different location is needed. In that case, os.listdir(os.path.join(SAGE_LOCAL,"share","gap","pkg","p_group_cohomology")) seems good to me.

EDIT: Since it isn't really a GAP package, os.listdir(os.path.join(SAGE_LOCAL,"share","p_group_cohomology")) seems better!



---

archive/issue_comments_450663.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nReplying to [@simon-king-jena](#comment%3A20):\n> I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.\n> \n> WHAT NEEDS TO BE AVAILABLE:\n> - A couple of .g files, containing function definitions.\n\nI think such data files should just be installed next to the python files of the package.\nJust like `src/sage/interfaces/sage-maxima.lisp`",
    "created_at": "2020-10-15T21:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450663",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">Comment 22</div>

Replying to [@simon-king-jena](#comment%3A20):
> I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.
> 
> WHAT NEEDS TO BE AVAILABLE:
> - A couple of .g files, containing function definitions.

I think such data files should just be installed next to the python files of the package.
Just like `src/sage/interfaces/sage-maxima.lisp`



---

archive/issue_comments_450664.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nIt should definitely not depend on the environment variable `SAGE_LOCAL` at all.\nBackground: pip-installable packages should be installable into various virtual environments.",
    "created_at": "2020-10-15T22:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450664",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">Comment 23</div>

It should definitely not depend on the environment variable `SAGE_LOCAL` at all.
Background: pip-installable packages should be installable into various virtual environments.



---

archive/issue_comments_450665.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@mkoeppe](#comment%3A22):\n> I think such data files should just be installed next to the python files of the package.\n> Just like `src/sage/interfaces/sage-maxima.lisp`\n\nDoes it mean you suggest that the python and cython files be moved into the sage src library?",
    "created_at": "2020-10-15T22:02:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450665",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@mkoeppe](#comment%3A22):
> I think such data files should just be installed next to the python files of the package.
> Just like `src/sage/interfaces/sage-maxima.lisp`

Does it mean you suggest that the python and cython files be moved into the sage src library?



---

archive/issue_comments_450666.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReplying to [@mkoeppe](#comment%3A23):\n> It should definitely not depend on the environment variable `SAGE_LOCAL` at all.\n> Background: pip-installable packages should be installable into various virtual environments. \n\nI don't understand that. Do you say that a fixed Sage installation has no fixed paths relative to SAGE_ROOT? Then how can any spkg tell where stuff ought to be installed?\n\nDoes it also mean I cannot keep the cohomology ring data base in its current location?",
    "created_at": "2020-10-15T22:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450666",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">Comment 25</div>

Replying to [@mkoeppe](#comment%3A23):
> It should definitely not depend on the environment variable `SAGE_LOCAL` at all.
> Background: pip-installable packages should be installable into various virtual environments. 

I don't understand that. Do you say that a fixed Sage installation has no fixed paths relative to SAGE_ROOT? Then how can any spkg tell where stuff ought to be installed?

Does it also mean I cannot keep the cohomology ring data base in its current location?



---

archive/issue_comments_450667.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nNon-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.\nIn Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.",
    "created_at": "2020-10-15T22:12:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450667",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">Comment 26</div>

Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.
In Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.



---

archive/issue_comments_450668.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nReplying to [@mkoeppe](#comment%3A26):\n> Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.\n> In Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.\n\nArgh. Sounds like a lot of work.\n\nProblems:\n- Where to install the data base? It used to be put into SAGE_SHARE. Is it still fine?\n- Do we put the Python and Cython files into SAGE_SRC? Then:\n  - Is it really ok to have a Python file float around that cannot be imported unless some optional package is installed?\n  - Can one build the documentation of optional Cython extension modules?\n  - Can one make all doc tests optional without adding \"#optional: p_group_cohomology\" into each line?",
    "created_at": "2020-10-15T22:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450668",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">Comment 27</div>

Replying to [@mkoeppe](#comment%3A26):
> Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.
> In Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.

Argh. Sounds like a lot of work.

Problems:
- Where to install the data base? It used to be put into SAGE_SHARE. Is it still fine?
- Do we put the Python and Cython files into SAGE_SRC? Then:
  - Is it really ok to have a Python file float around that cannot be imported unless some optional package is installed?
  - Can one build the documentation of optional Cython extension modules?
  - Can one make all doc tests optional without adding "#optional: p_group_cohomology" into each line?



---

archive/issue_comments_450669.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nActually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.",
    "created_at": "2020-10-16T00:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450669",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">Comment 28</div>

Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.



---

archive/issue_comments_450670.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nOn the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. \n\nI assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?",
    "created_at": "2020-10-16T05:45:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450670",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">Comment 29</div>

On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. 

I assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?



---

archive/issue_comments_450671.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@mkoeppe](#comment%3A29):\n> On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. \n\nThe problem I have with that depends on the definition of \"can\", when you say it \"can\" independently be used. I believe splitting `modular_resolution` off makes no sense. If one uses `modular_resolution`, one would also use `p_group_cohomology`-\n\n> I assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?\n\nWrong. The C library, that I inherited from David Green, makes intense use of meataxe, and is the only reason why I added meataxe as an optional spkg.",
    "created_at": "2020-10-16T06:10:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450671",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@mkoeppe](#comment%3A29):
> On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. 

The problem I have with that depends on the definition of "can", when you say it "can" independently be used. I believe splitting `modular_resolution` off makes no sense. If one uses `modular_resolution`, one would also use `p_group_cohomology`-

> I assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?

Wrong. The C library, that I inherited from David Green, makes intense use of meataxe, and is the only reason why I added meataxe as an optional spkg.



---

archive/issue_comments_450672.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@mkoeppe](#comment%3A28):\n> Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.\n\nThat's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.\n\nThe only question is where to install the data base, and where/how to install the .g files.\n\nConcerning the data base: Currently the data base is installed when installing the C library `libmodres`. Requirements: It must be a location that is readable for all users of Sage; write permission is only needed during package installation. So, what I currently do in Makefile.am, namely\n\n```\ndbdir           = $(datadir)/pGroupCohomology\ndist_db_DATA    = group_cohomology_database.tar\ninstall-data-hook:\n        cd $(DESTDIR)$(dbdir) && tar xf $(dist_db_DATA) && rm $(dist_db_DATA)\n\nuninstall-hook:\n        rm -r $(DESTDIR)$(dbdir)\n```\nshould be the right thing to do, shouldn't it??\n\nConcerning the .g files: If I understand correctly, many GAP packages are installed by just unpacking a .tar.gz into GAP's pkg/ folder. So, I could imagine to create a mock GAP package `pGroupCohomologyHelpers` (\"Helpers\" meaning that the package is not supposed to be of any use on its own), by creating a folder `/pGroupCohomologyHelpers` in GAP's `pkg/` folder, which contains a file `init.g`, that in turn reads the code from my current .g files (that perhaps should be renamed as .gap files).\n\nThen, one could just do libgap.LoadPackage(\"pGroupCohomologyHelpers\"), without the trouble to explicitly referring to the SAGE_LOCAL variable at run time.\n\nThe question is: How to locate GAP's `pkg/` folder at installation time, without messing around with SAGE_LOCAL? How can I make GAP reveal the location, using a shell command, so that spkg-install can install the .g files?",
    "created_at": "2020-10-16T08:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450672",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@mkoeppe](#comment%3A28):
> Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.

That's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.

The only question is where to install the data base, and where/how to install the .g files.

Concerning the data base: Currently the data base is installed when installing the C library `libmodres`. Requirements: It must be a location that is readable for all users of Sage; write permission is only needed during package installation. So, what I currently do in Makefile.am, namely

```
dbdir           = $(datadir)/pGroupCohomology
dist_db_DATA    = group_cohomology_database.tar
install-data-hook:
        cd $(DESTDIR)$(dbdir) && tar xf $(dist_db_DATA) && rm $(dist_db_DATA)

uninstall-hook:
        rm -r $(DESTDIR)$(dbdir)
```
should be the right thing to do, shouldn't it??

Concerning the .g files: If I understand correctly, many GAP packages are installed by just unpacking a .tar.gz into GAP's pkg/ folder. So, I could imagine to create a mock GAP package `pGroupCohomologyHelpers` ("Helpers" meaning that the package is not supposed to be of any use on its own), by creating a folder `/pGroupCohomologyHelpers` in GAP's `pkg/` folder, which contains a file `init.g`, that in turn reads the code from my current .g files (that perhaps should be renamed as .gap files).

Then, one could just do libgap.LoadPackage("pGroupCohomologyHelpers"), without the trouble to explicitly referring to the SAGE_LOCAL variable at run time.

The question is: How to locate GAP's `pkg/` folder at installation time, without messing around with SAGE_LOCAL? How can I make GAP reveal the location, using a shell command, so that spkg-install can install the .g files?



---

archive/issue_comments_450673.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nI changed the ticket description. Do you agree that it correctly reflects the discussion so far?\n\nIf I see that correctly, only two real issues remain: How to determine GAP's pkg folder during installation? How to install the documentation after building it?",
    "created_at": "2020-10-16T10:04:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450673",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">Comment 32</div>

I changed the ticket description. Do you agree that it correctly reflects the discussion so far?

If I see that correctly, only two real issues remain: How to determine GAP's pkg folder during installation? How to install the documentation after building it?



---

archive/issue_comments_450674.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,22 @@\n-The three parts of p_group_cohomology, namely a c-library libmodres (autotoolized) and a bunch of Cython and Python modules (pip installable) and a documentation using sphinx, are supposed to allow DESTDIR install. However, if I understand correctly, the current spkg-install script prevents this. The purpose of this ticket is to fix it.\n+This is a reformulation of the ticket summary, after some discussion went on.\n \n+p_group_cohomology is divided into four parts:\n+- a C-library libmodres (autotoolized), also providing a data base.\n+- a pip-installable collection of Python / Cython modules\n+- some files containing GAP code (let's call it GAP helper module)\n+- a documentation using sphinx\n+\n+Problem: Some of the modules refer to SAGE_LOCAL at installation or at run time, respectively. Moreover, the GAP helper module is currently installed into SAGE_LOCAL/share/sage, which has been removed.\n+\n+Issues of each part:\n+- The C-library seems totally fine. One could consider to turn it into a stand-alone spkg.\n+- The Python / Cython modules seem mostly fine. Problems: \n+  - Its setup.py takes the job of installing the GAP helper module, in a folder whose location is determined from the value of SAGE_LOCAL and which actually doesn't exist any longer.\n+  - Some Python module makes GAP read the GAP helper module, thus also determines the import location from the value of SAGE_LOCAL.\n+  Proposed solution:\n+  - It shouldn't be the job of setup.py to install the GAP helper module.\n+  - It should be possible for GAP to load the helper module without explicitly constructing a path derived from SAGE_LOCAL.\n+  Side remark: It would be possible to move the Python / Cython modules into Sage's src tree, but that would created issues with testing and documentation.\n+- The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage(\"pGroupCohomologyHelpers\");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?\n+- Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.\n+\n``````\n",
    "created_at": "2020-10-16T10:04:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450674",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,22 @@
-The three parts of p_group_cohomology, namely a c-library libmodres (autotoolized) and a bunch of Cython and Python modules (pip installable) and a documentation using sphinx, are supposed to allow DESTDIR install. However, if I understand correctly, the current spkg-install script prevents this. The purpose of this ticket is to fix it.
+This is a reformulation of the ticket summary, after some discussion went on.
 
+p_group_cohomology is divided into four parts:
+- a C-library libmodres (autotoolized), also providing a data base.
+- a pip-installable collection of Python / Cython modules
+- some files containing GAP code (let's call it GAP helper module)
+- a documentation using sphinx
+
+Problem: Some of the modules refer to SAGE_LOCAL at installation or at run time, respectively. Moreover, the GAP helper module is currently installed into SAGE_LOCAL/share/sage, which has been removed.
+
+Issues of each part:
+- The C-library seems totally fine. One could consider to turn it into a stand-alone spkg.
+- The Python / Cython modules seem mostly fine. Problems: 
+  - Its setup.py takes the job of installing the GAP helper module, in a folder whose location is determined from the value of SAGE_LOCAL and which actually doesn't exist any longer.
+  - Some Python module makes GAP read the GAP helper module, thus also determines the import location from the value of SAGE_LOCAL.
+  Proposed solution:
+  - It shouldn't be the job of setup.py to install the GAP helper module.
+  - It should be possible for GAP to load the helper module without explicitly constructing a path derived from SAGE_LOCAL.
+  Side remark: It would be possible to move the Python / Cython modules into Sage's src tree, but that would created issues with testing and documentation.
+- The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage("pGroupCohomologyHelpers");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?
+- Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.
+
``````




---

archive/issue_comments_450675.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nIs it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?\n\nIf so, then I think the two issues actually boil down to a single question: What syntax to use for sdh_install to let spkg-install put stuff in a sub-folder of DESTDIR?",
    "created_at": "2020-10-16T11:03:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450675",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:33" align="right">Comment 33</div>

Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?

If so, then I think the two issues actually boil down to a single question: What syntax to use for sdh_install to let spkg-install put stuff in a sub-folder of DESTDIR?



---

archive/issue_comments_450676.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@simon-king-jena](#comment%3A19):\n> PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.\n> \n> So, I guess it is no option.\n\noops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although \nnow I see I didn't include it in #29314 - although it can be done. \n\nUnfortunately #29314 is  getting stuck on Volker's buildbot, only him seems to be able to debug the problem :-(",
    "created_at": "2020-10-16T11:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450676",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@simon-king-jena](#comment%3A19):
> PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.
> 
> So, I guess it is no option.

oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although 
now I see I didn't include it in #29314 - although it can be done. 

Unfortunately #29314 is  getting stuck on Volker's buildbot, only him seems to be able to debug the problem :-(



---

archive/issue_comments_450677.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nReplying to [@dimpase](#comment%3A34):\n> oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although \n> now I see I didn't include it in #29314 - although it can be done. \n\nEven if the package manager could be included, I think one should try to not make it a dependency.\n\n*If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager. sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.",
    "created_at": "2020-10-16T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450677",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:35" align="right">Comment 35</div>

Replying to [@dimpase](#comment%3A34):
> oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although 
> now I see I didn't include it in #29314 - although it can be done. 

Even if the package manager could be included, I think one should try to not make it a dependency.

*If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager. sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.



---

archive/issue_comments_450678.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nReplying to [@simon-king-jena](#comment%3A35):\n> Replying to [@dimpase](#comment%3A34):\n> > oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although \n> > now I see I didn't include it in #29314 - although it can be done. \n\n> \n> Even if the package manager could be included, I think one should try to not make it a dependency.\n> \n> *If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, \n\nif you don't do this then you'd need to use GAP's `Read()` rather than `LoadPackage()` to load the\nGAP files, and then you'd need to use the full path to the files.\n\nOne can try using https://github.com/gap-system/PackageMaker to generate the needed for a package boilerplate.\n\n\n\n> and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager.\n\nwe can put `PackageManager` into `gap` rather than `gap_packages`, then it won't be a dependency.\n\n\n> sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.\n\nsee its source with comments in \n`build/bin/sage-dist-helpers`\n\n(that's all the docs there are, ATM, I think)",
    "created_at": "2020-10-16T12:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450678",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">Comment 36</div>

Replying to [@simon-king-jena](#comment%3A35):
> Replying to [@dimpase](#comment%3A34):
> > oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although 
> > now I see I didn't include it in #29314 - although it can be done. 

> 
> Even if the package manager could be included, I think one should try to not make it a dependency.
> 
> *If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, 

if you don't do this then you'd need to use GAP's `Read()` rather than `LoadPackage()` to load the
GAP files, and then you'd need to use the full path to the files.

One can try using https://github.com/gap-system/PackageMaker to generate the needed for a package boilerplate.



> and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager.

we can put `PackageManager` into `gap` rather than `gap_packages`, then it won't be a dependency.


> sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.

see its source with comments in 
`build/bin/sage-dist-helpers`

(that's all the docs there are, ATM, I think)



---

archive/issue_comments_450679.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nI played a bit with GAP's PackageMaker, it produced the following:\n\nhttps://github.com/dimpase/p_group_cohomology_helper\n\n(this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.",
    "created_at": "2020-10-16T13:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450679",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:37" align="right">Comment 37</div>

I played a bit with GAP's PackageMaker, it produced the following:

https://github.com/dimpase/p_group_cohomology_helper

(this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.



---

archive/issue_comments_450680.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@dimpase](#comment%3A37):\n> I played a bit with GAP's PackageMaker, it produced the following:\n> \n> https://github.com/dimpase/p_group_cohomology_helper\n> \n> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.\n\nThank you!\n\nIt sounds like a lot of work to change the current code in the required format for a package.\n\nI wonder what functions I'd need to declare as global functions. Currently, the code is split into several .g files: GapMaxels.g, GapMB.g, GapSgs.g. Suppose a function from GapMaxels is used in GapMB: Do I need to declare such function as global? And if a function from GapMB is used in another function of GapMB: Do I need to declare such function as global?\n\nIs it really needed to make a full package (even if it is boiler plate)? My hope was that I can keep it simpler and that I wouldn't need to write separate documentation for David Green's GAP code.\n\nEDIT: I cloned your github repository.",
    "created_at": "2020-10-16T13:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450680",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@dimpase](#comment%3A37):
> I played a bit with GAP's PackageMaker, it produced the following:
> 
> https://github.com/dimpase/p_group_cohomology_helper
> 
> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.

Thank you!

It sounds like a lot of work to change the current code in the required format for a package.

I wonder what functions I'd need to declare as global functions. Currently, the code is split into several .g files: GapMaxels.g, GapMB.g, GapSgs.g. Suppose a function from GapMaxels is used in GapMB: Do I need to declare such function as global? And if a function from GapMB is used in another function of GapMB: Do I need to declare such function as global?

Is it really needed to make a full package (even if it is boiler plate)? My hope was that I can keep it simpler and that I wouldn't need to write separate documentation for David Green's GAP code.

EDIT: I cloned your github repository.



---

archive/issue_comments_450681.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nReplying to [@dimpase](#comment%3A36):\n> > sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.\n\n> see its source with comments in \n> `build/bin/sage-dist-helpers`\n> \n> (that's all the docs there are, ATM, I think)\n\nIt says\n\n```\n# - sdh_install [-T] SRC [SRC...] DEST\n#\n#    Copies one or more files or directories given as SRC (recursively in the\n#    case of directories) into the destination directory DEST, while ensuring\n#    that DEST and all its parent directories exist.  DEST should be a path\n#    under $SAGE_LOCAL, generally.  For DESTDIR installs the $SAGE_DESTDIR path\n#    is automatically prepended to the destination.\n#\n#    The -T option treats DEST as a normal file instead (e.g. for copying a\n#    file to a different filename).  All directory components are still created\n#    in this case.\n```\n\nDoes it mean that when one provide a path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path??? It seems this is the exactly how the install path of my GAP files got messed up as reported in #30349!! I'll add a comment there.",
    "created_at": "2020-10-16T13:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450681",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:39" align="right">Comment 39</div>

Replying to [@dimpase](#comment%3A36):
> > sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.

> see its source with comments in 
> `build/bin/sage-dist-helpers`
> 
> (that's all the docs there are, ATM, I think)

It says

```
# - sdh_install [-T] SRC [SRC...] DEST
#
#    Copies one or more files or directories given as SRC (recursively in the
#    case of directories) into the destination directory DEST, while ensuring
#    that DEST and all its parent directories exist.  DEST should be a path
#    under $SAGE_LOCAL, generally.  For DESTDIR installs the $SAGE_DESTDIR path
#    is automatically prepended to the destination.
#
#    The -T option treats DEST as a normal file instead (e.g. for copying a
#    file to a different filename).  All directory components are still created
#    in this case.
```

Does it mean that when one provide a path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path??? It seems this is the exactly how the install path of my GAP files got messed up as reported in #30349!! I'll add a comment there.



---

archive/issue_comments_450682.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nI'm away from keyboard until late pm. I guess it should not be hard to wrap this up as a hotfix, though",
    "created_at": "2020-10-16T14:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450682",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">Comment 40</div>

I'm away from keyboard until late pm. I guess it should not be hard to wrap this up as a hotfix, though



---

archive/issue_comments_450683.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nReplying to [@dimpase](#comment%3A37):\n> I played a bit with GAP's PackageMaker, it produced the following:\n> \n> https://github.com/dimpase/p_group_cohomology_helper\n> \n> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.\n\nI have created a fork and made the package actually usable. See https://github.com/simon-king-jena/p_group_cohomology_helper",
    "created_at": "2020-10-16T16:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450683",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:41" align="right">Comment 41</div>

Replying to [@dimpase](#comment%3A37):
> I played a bit with GAP's PackageMaker, it produced the following:
> 
> https://github.com/dimpase/p_group_cohomology_helper
> 
> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.

I have created a fork and made the package actually usable. See https://github.com/simon-king-jena/p_group_cohomology_helper



---

archive/issue_comments_450684.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nFYI: there is some documentation on `sdh_install` and related functions in the Developer's Guide: https://doc.sagemath.org/html/en/developer/packaging.html#helper-functions. It's the same as in `build/bin/sage-dist-helpers`, but at least the documentation is public.",
    "created_at": "2020-10-16T16:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450684",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">Comment 42</div>

FYI: there is some documentation on `sdh_install` and related functions in the Developer's Guide: https://doc.sagemath.org/html/en/developer/packaging.html#helper-functions. It's the same as in `build/bin/sage-dist-helpers`, but at least the documentation is public.



---

archive/issue_comments_450685.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nIn spkg-install, I currently have\n\n```\n# building modular_resolution\ncd `ls -d modular_resolution*`\nsdh_configure || sdh_die \"Error configuring modular_resolution\"\nsdh_make || sdh_die \"Error making modular_resolution\"\n# sdh_make install got broken by trac ticket #24106\n$MAKE install || sdh_die \"Error installing modular_resolution\"\ncd ..\n```\n\nHas sdh_make_install been fixed? Is it enough to just do\n\n```\n# build and install modular_resolution\ncd `ls -d modular_resolution*`\nsdh_configure || sdh_die \"Error configuring modular_resolution\"\nsdh_make_install || sdh_die \"Error making modular_resolution\"\ncd ..\n```\n?",
    "created_at": "2020-10-16T16:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450685",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:43" align="right">Comment 43</div>

In spkg-install, I currently have

```
# building modular_resolution
cd `ls -d modular_resolution*`
sdh_configure || sdh_die "Error configuring modular_resolution"
sdh_make || sdh_die "Error making modular_resolution"
# sdh_make install got broken by trac ticket #24106
$MAKE install || sdh_die "Error installing modular_resolution"
cd ..
```

Has sdh_make_install been fixed? Is it enough to just do

```
# build and install modular_resolution
cd `ls -d modular_resolution*`
sdh_configure || sdh_die "Error configuring modular_resolution"
sdh_make_install || sdh_die "Error making modular_resolution"
cd ..
```
?



---

archive/issue_comments_450686.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nI don't know your answer about `sdh_make_install`, but the code could just read\n\n```\ncd ...\nsdh_configure\nsdh_make_install # assuming this works\n```\n`sdh_die` is called automatically by the other helper functions, so you don't need to call it yourself.\n\nRe #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.",
    "created_at": "2020-10-16T17:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450686",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">Comment 44</div>

I don't know your answer about `sdh_make_install`, but the code could just read

```
cd ...
sdh_configure
sdh_make_install # assuming this works
```
`sdh_die` is called automatically by the other helper functions, so you don't need to call it yourself.

Re #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.



---

archive/issue_comments_450687.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [@simon-king-jena](#comment%3A39):\n> Does it mean that when one provide a path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?\n\nYes, that's how the staged install works.",
    "created_at": "2020-10-16T17:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450687",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [@simon-king-jena](#comment%3A39):
> Does it mean that when one provide a path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?

Yes, that's how the staged install works.



---

archive/issue_comments_450688.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@mkoeppe](#comment%3A45):\n> Replying to [@simon-king-jena](#comment%3A39):\n> > Does it mean that when one provide a path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?\n\n> \n> Yes, that's how the staged install works.\n\nSo, you say that MOST spkgs are currently broken, because they have all things like this in spkg-install?\n\n```\nsdh_install doc/ref doc/tut \"$SAGE_SHARE/doc/gap/\"\nsdh_install -T src \"${SAGE_SHARE}/jmol\"\n```\nJust grep for SAGE_SHARE or SAGE_LOCAL in `$SAGE_ROOT/build/pkgs`.",
    "created_at": "2020-10-16T18:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450688",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@mkoeppe](#comment%3A45):
> Replying to [@simon-king-jena](#comment%3A39):
> > Does it mean that when one provide a path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?

> 
> Yes, that's how the staged install works.

So, you say that MOST spkgs are currently broken, because they have all things like this in spkg-install?

```
sdh_install doc/ref doc/tut "$SAGE_SHARE/doc/gap/"
sdh_install -T src "${SAGE_SHARE}/jmol"
```
Just grep for SAGE_SHARE or SAGE_LOCAL in `$SAGE_ROOT/build/pkgs`.



---

archive/issue_comments_450689.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nIt seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.\n\nSince #29152 may soon be reviewed (and fixes something with meataxe), it could make sense to replace #30151 by #29152 as a dependency. But not STRICTLY needed, IMHO.",
    "created_at": "2020-10-16T18:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450689",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:47" align="right">Comment 47</div>

It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.

Since #29152 may soon be reviewed (and fixes something with meataxe), it could make sense to replace #30151 by #29152 as a dependency. But not STRICTLY needed, IMHO.



---

archive/issue_comments_450690.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nReplying to [@simon-king-jena](#comment%3A46):\n> So, you say that MOST spkgs are currently broken\n\nNo. `sdh_install` works. It installs into `SAGE_DESTDIR` and then `sage-spkg` copies from there to the actual install directory.",
    "created_at": "2020-10-16T18:23:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450690",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">Comment 48</div>

Replying to [@simon-king-jena](#comment%3A46):
> So, you say that MOST spkgs are currently broken

No. `sdh_install` works. It installs into `SAGE_DESTDIR` and then `sage-spkg` copies from there to the actual install directory.



---

archive/issue_comments_450691.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nReplying to [@simon-king-jena](#comment%3A47):\n> It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.\n\nWithout #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.",
    "created_at": "2020-10-16T18:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450691",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">Comment 49</div>

Replying to [@simon-king-jena](#comment%3A47):
> It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.

Without #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.



---

archive/issue_comments_450692.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nReplying to [@simon-king-jena](#comment%3A33):\n> Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?\n\nNo. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.",
    "created_at": "2020-10-16T18:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450692",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">Comment 50</div>

Replying to [@simon-king-jena](#comment%3A33):
> Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?

No. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.



---

archive/issue_comments_450693.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\n(deleted)",
    "created_at": "2020-10-16T18:30:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450693",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:51" align="right">Comment 51</div>

(deleted)



---

archive/issue_comments_450694.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nReplying to [@simon-king-jena](#comment%3A31):\n> Replying to [@mkoeppe](#comment%3A28):\n> > Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.\n\n> \n> That's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.\n\nYes, but it should be separate package - whose spkg-install only contains `sdh_pip_install` and nothing else",
    "created_at": "2020-10-16T18:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450694",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:52" align="right">Comment 52</div>

Replying to [@simon-king-jena](#comment%3A31):
> Replying to [@mkoeppe](#comment%3A28):
> > Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.

> 
> That's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.

Yes, but it should be separate package - whose spkg-install only contains `sdh_pip_install` and nothing else



---

archive/issue_comments_450695.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nReplying to [@mkoeppe](#comment%3A49): \n> Without #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.\n\nHow is the following broken?\n\n```\n# Check if meataxe was properly installed\nsage -c \"import sage.libs.meataxe\" || sdh_die \"sage.libs.meataxe cannot be imported. To solve this, it is enough to retry installation of p_group_cohomology\"\n```",
    "created_at": "2020-10-16T18:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450695",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:53" align="right">Comment 53</div>

Replying to [@mkoeppe](#comment%3A49): 
> Without #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.

How is the following broken?

```
# Check if meataxe was properly installed
sage -c "import sage.libs.meataxe" || sdh_die "sage.libs.meataxe cannot be imported. To solve this, it is enough to retry installation of p_group_cohomology"
```



---

archive/issue_comments_450696.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nIt is broken because it is not reflected in the declared `dependencies` of the package.",
    "created_at": "2020-10-16T18:37:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450696",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">Comment 54</div>

It is broken because it is not reflected in the declared `dependencies` of the package.



---

archive/issue_comments_450697.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nThus, it is not possible to install it robustly using `./configure --enable-meataxe --enable-p_group_cohomology && make`",
    "created_at": "2020-10-16T18:38:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450697",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">Comment 55</div>

Thus, it is not possible to install it robustly using `./configure --enable-meataxe --enable-p_group_cohomology && make`



---

archive/issue_comments_450698.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nReplying to [@mkoeppe](#comment%3A50):\n> Replying to [@simon-king-jena](#comment%3A33):\n> > Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?\n\n> \n> No. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.\n\nWhat do you mean by \"the C library package\"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.\n\nAnyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `\"$SAGE_SHARE/singular/LIB/\"` or `\"$SAGE_SHARE/gap/pkg/\"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.",
    "created_at": "2020-10-16T18:38:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450698",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:56" align="right">Comment 56</div>

Replying to [@mkoeppe](#comment%3A50):
> Replying to [@simon-king-jena](#comment%3A33):
> > Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?

> 
> No. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.

What do you mean by "the C library package"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.

Anyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `"$SAGE_SHARE/singular/LIB/"` or `"$SAGE_SHARE/gap/pkg/"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.



---

archive/issue_comments_450699.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nReplying to [@mkoeppe](#comment%3A54):\n> It is broken because it is not reflected in the declared `dependencies` of the package.\n\nRight. But waiting for #30151 means that for a potentially long time, p_group_cohomology will not install. When we keep the current check for meataxe, it may be broken, but it will build.",
    "created_at": "2020-10-16T18:40:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450699",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:57" align="right">Comment 57</div>

Replying to [@mkoeppe](#comment%3A54):
> It is broken because it is not reflected in the declared `dependencies` of the package.

Right. But waiting for #30151 means that for a potentially long time, p_group_cohomology will not install. When we keep the current check for meataxe, it may be broken, but it will build.



---

archive/issue_comments_450700.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nReplying to [@simon-king-jena](#comment%3A56):\n> What do you mean by \"the C library package\"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.\n\nOK, thanks for the clarification. I retract this particular suggestion then.\n\n> Anyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `\"$SAGE_SHARE/singular/LIB/\"` or `\"$SAGE_SHARE/gap/pkg/\"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.\n\nThis is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).",
    "created_at": "2020-10-16T19:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450700",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">Comment 58</div>

Replying to [@simon-king-jena](#comment%3A56):
> What do you mean by "the C library package"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.

OK, thanks for the clarification. I retract this particular suggestion then.

> Anyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `"$SAGE_SHARE/singular/LIB/"` or `"$SAGE_SHARE/gap/pkg/"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.

This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).



---

archive/issue_comments_450701.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nSomething else is broken: Trying to install, I get\n\n```\n[p_group_cohomology-3.3.2]   creating build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology\n[p_group_cohomology-3.3.2]   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/cpython -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/cysignals -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/ext -I/usr/include/python3.7m -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/numpy/core/include -I/home/king/Sage/git/py3/local/include -I/usr/include/python3.7m -c build/c_files-3.7/pGroupCohomology/resolution.c -o build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology/resolution.o\n[p_group_cohomology-3.3.2]   build/c_files-3.7/pGroupCohomology/resolution.c:644:39: fatal error: modular_resolution/pgroup.h: No such file or directory\n[p_group_cohomology-3.3.2]   compilation terminated.\n[p_group_cohomology-3.3.2]   error: command 'gcc' failed with exit status 1\n[p_group_cohomology-3.3.2]   Building wheel for pGroupCohomology (setup.py): finished with status 'error'\n[p_group_cohomology-3.3.2]   ERROR: Failed building wheel for pGroupCohomology\n[p_group_cohomology-3.3.2]   Running setup.py clean for pGroupCohomology\n[p_group_cohomology-3.3.2]   Running command /home/king/Sage/git/py3/local/bin/python3 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/tmp/pip-req-build-vx2ktc1p/setup.py'\"'\"'; __file__='\"'\"'/tmp/pip-req-build-vx2ktc1p/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' clean --all\n[p_group_cohomology-3.3.2]   running clean\n```\nWhy the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.",
    "created_at": "2020-10-16T19:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450701",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:59" align="right">Comment 59</div>

Something else is broken: Trying to install, I get

```
[p_group_cohomology-3.3.2]   creating build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology
[p_group_cohomology-3.3.2]   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/cpython -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/cysignals -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/ext -I/usr/include/python3.7m -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/numpy/core/include -I/home/king/Sage/git/py3/local/include -I/usr/include/python3.7m -c build/c_files-3.7/pGroupCohomology/resolution.c -o build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology/resolution.o
[p_group_cohomology-3.3.2]   build/c_files-3.7/pGroupCohomology/resolution.c:644:39: fatal error: modular_resolution/pgroup.h: No such file or directory
[p_group_cohomology-3.3.2]   compilation terminated.
[p_group_cohomology-3.3.2]   error: command 'gcc' failed with exit status 1
[p_group_cohomology-3.3.2]   Building wheel for pGroupCohomology (setup.py): finished with status 'error'
[p_group_cohomology-3.3.2]   ERROR: Failed building wheel for pGroupCohomology
[p_group_cohomology-3.3.2]   Running setup.py clean for pGroupCohomology
[p_group_cohomology-3.3.2]   Running command /home/king/Sage/git/py3/local/bin/python3 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/tmp/pip-req-build-vx2ktc1p/setup.py'"'"'; __file__='"'"'/tmp/pip-req-build-vx2ktc1p/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' clean --all
[p_group_cohomology-3.3.2]   running clean
```
Why the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.



---

archive/issue_comments_450702.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nReplying to [@mkoeppe](#comment%3A58):\n> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\nWhat about C libraries? What about additional files needed to make a pip-installable python package work?",
    "created_at": "2020-10-16T19:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450702",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:60" align="right">Comment 60</div>

Replying to [@mkoeppe](#comment%3A58):
> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).

What about C libraries? What about additional files needed to make a pip-installable python package work?



---

archive/issue_comments_450703.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nReplying to [@simon-king-jena](#comment%3A60):\n> Replying to [@mkoeppe](#comment%3A58):\n> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\n> \n> What about C libraries? What about additional files needed to make a pip-installable python package work?\n\nAnything that `setup.py` builds, including extension modules, is fine.\n\nStandalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.",
    "created_at": "2020-10-16T19:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450703",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">Comment 61</div>

Replying to [@simon-king-jena](#comment%3A60):
> Replying to [@mkoeppe](#comment%3A58):
> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).

> 
> What about C libraries? What about additional files needed to make a pip-installable python package work?

Anything that `setup.py` builds, including extension modules, is fine.

Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.



---

archive/issue_comments_450704.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nReplying to [@simon-king-jena](#comment%3A59):\n> Why the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.\n\nThis is (I guess) the moment when pgroup.h is supposed to be installed:\n\n```\n[p_group_cohomology-3.3.2]  /usr/bin/install -c -m 644 fileplus.h fp_decls.h modular_resolution.h pgroup.h pgroup_decls.h nDiag.h urbild_decls.h nBuchberger_decls.h pcommon.h slice_decls.h '/home/king/Sage/git/py3/local/var/tmp/sage/build/p_group_cohomology-3.3.2/inst/home/king/Sage/git/py3/local/include/modular_resolution'\n```\n\nI guess it again is a staged process. But why stuff isn't moved to its final destination? modular_resolution uses an autotoolised build system, so, why is \n\n```\nsdh_configure || sdh_die \"Error configuring modular_resolution\"\nsdh_make_install || sdh_die \"Error making modular_resolution\"\n```\nnot working any more?",
    "created_at": "2020-10-16T19:13:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450704",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:62" align="right">Comment 62</div>

Replying to [@simon-king-jena](#comment%3A59):
> Why the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.

This is (I guess) the moment when pgroup.h is supposed to be installed:

```
[p_group_cohomology-3.3.2]  /usr/bin/install -c -m 644 fileplus.h fp_decls.h modular_resolution.h pgroup.h pgroup_decls.h nDiag.h urbild_decls.h nBuchberger_decls.h pcommon.h slice_decls.h '/home/king/Sage/git/py3/local/var/tmp/sage/build/p_group_cohomology-3.3.2/inst/home/king/Sage/git/py3/local/include/modular_resolution'
```

I guess it again is a staged process. But why stuff isn't moved to its final destination? modular_resolution uses an autotoolised build system, so, why is 

```
sdh_configure || sdh_die "Error configuring modular_resolution"
sdh_make_install || sdh_die "Error making modular_resolution"
```
not working any more?



---

archive/issue_comments_450705.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nReplying to [@mkoeppe](#comment%3A61):\n> Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.\n\nThat's a show stopper.\n\nEDIT: Why and on what ticket has that changed?",
    "created_at": "2020-10-16T19:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450705",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:63" align="right">Comment 63</div>

Replying to [@mkoeppe](#comment%3A61):
> Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.

That's a show stopper.

EDIT: Why and on what ticket has that changed?



---

archive/issue_comments_450706.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nReplying to [@mkoeppe](#comment%3A58):\n> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\nWhen you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.\n\nWould the following be the right way to split the current p_group_cohomology spkg into three spkgs?\n1. modular_resolution, depending on meataxe-the-C-library, that installs \n   - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?\n   - some executables in $SAGE_LOCAL/bin, linked against libmodres\n2. p_group_cohomology_helper, that installs\n   - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/\n   - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/\n   - a data base in $SAGE_LOCAL/share/p_group_cohomology/\n3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable\n\nThe computation of cohomology rings needs all the above! So, when you seriously state that \"Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.\", then you should tell what to do instead.",
    "created_at": "2020-10-16T19:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450706",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:64" align="right">Comment 64</div>

Replying to [@mkoeppe](#comment%3A58):
> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).

When you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.

Would the following be the right way to split the current p_group_cohomology spkg into three spkgs?
1. modular_resolution, depending on meataxe-the-C-library, that installs 
   - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?
   - some executables in $SAGE_LOCAL/bin, linked against libmodres
2. p_group_cohomology_helper, that installs
   - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/
   - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/
   - a data base in $SAGE_LOCAL/share/p_group_cohomology/
3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable

The computation of cohomology rings needs all the above! So, when you seriously state that "Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.", then you should tell what to do instead.



---

archive/issue_comments_450707.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nReplying to [@simon-king-jena](#comment%3A62):\nmodular_resolution uses an autotoolised build system, so, why is \n> \n> ```\n> sdh_configure || sdh_die \"Error configuring modular_resolution\"\n> sdh_make_install || sdh_die \"Error making modular_resolution\"\n> ```\n> not working any more?\n\nGot it. In the previous version of spkg-install.in, it was stated that `# sdh_make install got broken by trac ticket #24106`. So, sdh_make_install apparently is still broken...",
    "created_at": "2020-10-16T19:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450707",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:65" align="right">Comment 65</div>

Replying to [@simon-king-jena](#comment%3A62):
modular_resolution uses an autotoolised build system, so, why is 
> 
> ```
> sdh_configure || sdh_die "Error configuring modular_resolution"
> sdh_make_install || sdh_die "Error making modular_resolution"
> ```
> not working any more?

Got it. In the previous version of spkg-install.in, it was stated that `# sdh_make install got broken by trac ticket #24106`. So, sdh_make_install apparently is still broken...



---

archive/issue_comments_450708.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nReplying to [@simon-king-jena](#comment%3A64):\n> Replying to [@mkoeppe](#comment%3A58):\n> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\n> \n> When you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.\n\nYes.\n\n> Would the following be the right way to split the current p_group_cohomology spkg into three spkgs?\n> 1. modular_resolution, depending on meataxe-the-C-library, that installs \n>    - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?\n>    - some executables in $SAGE_LOCAL/bin, linked against libmodres\n\nYes.\n\n> 2. p_group_cohomology_helper, that installs\n>    - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/\n>    - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/\n>    - a data base in $SAGE_LOCAL/share/p_group_cohomology/\n\nPerhaps; although it could also make sense to make them actually part of the pip-installable package -- in which case the install location would NOT be `$SAGE_LOCAL/share/...` but next to the Python modules (this would depend on setting some load paths for GAP or Singular so that the modules would be found, I suppose - but I do not know enough about these systems). In that case, the installation would be done using `setup.py`'s `package_data` or similar.\n\n> 3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable\n\nYes.\n\n> The computation of cohomology rings needs all the above! So, when you seriously state that \"Standalone libraries that would be installed in `$SAGE_LOCAL/lib/` are not fine\n\n... I meant here: for a Python package!\n\nNon-Python packages, of course, will install in `$SAGE_LOCAL`.",
    "created_at": "2020-10-16T20:07:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450708",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">Comment 66</div>

Replying to [@simon-king-jena](#comment%3A64):
> Replying to [@mkoeppe](#comment%3A58):
> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).

> 
> When you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.

Yes.

> Would the following be the right way to split the current p_group_cohomology spkg into three spkgs?
> 1. modular_resolution, depending on meataxe-the-C-library, that installs 
>    - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?
>    - some executables in $SAGE_LOCAL/bin, linked against libmodres

Yes.

> 2. p_group_cohomology_helper, that installs
>    - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/
>    - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/
>    - a data base in $SAGE_LOCAL/share/p_group_cohomology/

Perhaps; although it could also make sense to make them actually part of the pip-installable package -- in which case the install location would NOT be `$SAGE_LOCAL/share/...` but next to the Python modules (this would depend on setting some load paths for GAP or Singular so that the modules would be found, I suppose - but I do not know enough about these systems). In that case, the installation would be done using `setup.py`'s `package_data` or similar.

> 3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable

Yes.

> The computation of cohomology rings needs all the above! So, when you seriously state that "Standalone libraries that would be installed in `$SAGE_LOCAL/lib/` are not fine

... I meant here: for a Python package!

Non-Python packages, of course, will install in `$SAGE_LOCAL`.



---

archive/issue_comments_450709.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nSomething I don't understand (and has been broken before): When I open install the package including the documentation, then the documentation is built and installed --- but the resulting html files are broken. But if I open the p_group_cohomology tar ball, cd into pGroupCohomology-3.2.2/doc and do \"make html\" in a Sage shell, the resulting html files are fine (except that I am not totally happy about syntax highlighting for the examples in the documentation).\n\nSo, apparently there is a difference between building the documentation during `sage -i p_group_cohomology` and building the documentation manually. Although I believe what I described above (namely \"make html\" in a Sage shell) is exactly what happens during package installation, too.\n\nCan someone explain the problem? The same problem occurred in previous versions of p_group_cohomology, so, I don't think I broke something.",
    "created_at": "2020-10-16T22:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450709",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:67" align="right">Comment 67</div>

Something I don't understand (and has been broken before): When I open install the package including the documentation, then the documentation is built and installed --- but the resulting html files are broken. But if I open the p_group_cohomology tar ball, cd into pGroupCohomology-3.2.2/doc and do "make html" in a Sage shell, the resulting html files are fine (except that I am not totally happy about syntax highlighting for the examples in the documentation).

So, apparently there is a difference between building the documentation during `sage -i p_group_cohomology` and building the documentation manually. Although I believe what I described above (namely "make html" in a Sage shell) is exactly what happens during package installation, too.

Can someone explain the problem? The same problem occurred in previous versions of p_group_cohomology, so, I don't think I broke something.



---

archive/issue_comments_450710.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nI'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. In particular the lines \n\n```\nfrom sphinx import highlighting\n```\nand\n\n```\npygments_style = 'sphinx'\n```\nand\n\n```\nhighlighting.lexers['ipycon'] = IPythonConsoleLexer(in1_regex=r'sage: ', in2_regex=r'[.][.][.][.]: ')\nhighlighting.lexers['ipython'] = IPyLexer()\nhighlight_language = 'ipycon'\n```\nare relevant.",
    "created_at": "2020-10-16T22:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450710",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:68" align="right">Comment 68</div>

I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. In particular the lines 

```
from sphinx import highlighting
```
and

```
pygments_style = 'sphinx'
```
and

```
highlighting.lexers['ipycon'] = IPythonConsoleLexer(in1_regex=r'sage: ', in2_regex=r'[.][.][.][.]: ')
highlighting.lexers['ipython'] = IPyLexer()
highlight_language = 'ipycon'
```
are relevant.



---

archive/issue_comments_450711.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nReplying to [@jhpalmieri](#comment%3A68):\n> I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. ...\n\nNice! Thank you! It now looks much better (at least when built manually).",
    "created_at": "2020-10-16T23:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450711",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:69" align="right">Comment 69</div>

Replying to [@jhpalmieri](#comment%3A68):
> I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. ...

Nice! Thank you! It now looks much better (at least when built manually).



---

archive/issue_comments_450712.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nUnfortunately there is a problem with [travis-ci](https://travis-ci.org/github/sagemath/p_group_cohomology).\n\nTesting fails before it was even tried to install p_group_cohomology. Namely, it fails when doing \"sage -b\" after installing meataxe. The error is:\n\n```\nmake: *** No targets specified and no makefile found.  Stop.\n\nThe command \"docker exec cohomology sage -b\" failed and exited with 2 during .\n```\nOf course that command did work in the past.",
    "created_at": "2020-10-17T07:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450712",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:70" align="right">Comment 70</div>

Unfortunately there is a problem with [travis-ci](https://travis-ci.org/github/sagemath/p_group_cohomology).

Testing fails before it was even tried to install p_group_cohomology. Namely, it fails when doing "sage -b" after installing meataxe. The error is:

```
make: *** No targets specified and no makefile found.  Stop.

The command "docker exec cohomology sage -b" failed and exited with 2 during .
```
Of course that command did work in the past.



---

archive/issue_comments_450713.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nDamned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:\n\n```\n[p_group_cohomology-3.3.2]         H1 = COHO(Integer(8),Integer(3),root=tmp_root1)\n[p_group_cohomology-3.3.2]       File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/categories/unital_algebras.py\", line 117, in __init_extra__\n[p_group_cohomology-3.3.2]         deprecation(19225, \"the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead\")\n[p_group_cohomology-3.3.2]       File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 100, in deprecation\n[p_group_cohomology-3.3.2]         warning(trac_number, message, DeprecationWarning, stacklevel)\n[p_group_cohomology-3.3.2]       File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 146, in warning\n[p_group_cohomology-3.3.2]         warn(message, warning_class, stacklevel)\n[p_group_cohomology-3.3.2]       File \"/usr/lib/python3.7/warnings.py\", line 110, in _showwarnmsg\n[p_group_cohomology-3.3.2]         msg.file, msg.line)\n[p_group_cohomology-3.3.2]     :\n[p_group_cohomology-3.3.2]     DeprecationWarning: the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead\n[p_group_cohomology-3.3.2]     See http://trac.sagemath.org/19225 for details.\n```",
    "created_at": "2020-10-17T08:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450713",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:71" align="right">Comment 71</div>

Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:

```
[p_group_cohomology-3.3.2]         H1 = COHO(Integer(8),Integer(3),root=tmp_root1)
[p_group_cohomology-3.3.2]       File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/categories/unital_algebras.py", line 117, in __init_extra__
[p_group_cohomology-3.3.2]         deprecation(19225, "the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead")
[p_group_cohomology-3.3.2]       File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
[p_group_cohomology-3.3.2]         warning(trac_number, message, DeprecationWarning, stacklevel)
[p_group_cohomology-3.3.2]       File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 146, in warning
[p_group_cohomology-3.3.2]         warn(message, warning_class, stacklevel)
[p_group_cohomology-3.3.2]       File "/usr/lib/python3.7/warnings.py", line 110, in _showwarnmsg
[p_group_cohomology-3.3.2]         msg.file, msg.line)
[p_group_cohomology-3.3.2]     :
[p_group_cohomology-3.3.2]     DeprecationWarning: the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead
[p_group_cohomology-3.3.2]     See http://trac.sagemath.org/19225 for details.
```



---

archive/issue_comments_450714.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nReplying to [@simon-king-jena](#comment%3A71):\n> Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:\n\nNeedless to say that #19225 doesn't clearly explain what to do in order to replace the ugly _no_generic_basering_coercion by something better. Should one simply remove it or what? And \"of course\" clicking on the branch of #19225 doesn't show a diff to the pre-#19225 state, i.e., I cannot infer from the changes in the code what I'd have to do now.\n\nSometimes I still miss patches attached to tickets.",
    "created_at": "2020-10-17T08:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450714",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:72" align="right">Comment 72</div>

Replying to [@simon-king-jena](#comment%3A71):
> Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:

Needless to say that #19225 doesn't clearly explain what to do in order to replace the ugly _no_generic_basering_coercion by something better. Should one simply remove it or what? And "of course" clicking on the branch of #19225 doesn't show a diff to the pre-#19225 state, i.e., I cannot infer from the changes in the code what I'd have to do now.

Sometimes I still miss patches attached to tickets.



---

archive/issue_comments_450715.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nHooray! After simply removing the hack that was deprecated by #19225, I get\n\n```\n[p_group_cohomology-3.3.2] ----------------------------------------------------------------------\n[p_group_cohomology-3.3.2] All tests passed!\n[p_group_cohomology-3.3.2] ----------------------------------------------------------------------\n```\nThat was withoug #30151, though.\n\n**Problems solved:**\n- setup.py is not messing around with SAGE_LOCAL. Instead, stuff that needs to be installed relative to the root of the Sage installation is now put in place by spkg-install using sdh_install.\n- The GAP part of the package has become a proper GAP package, that is installed where GAP expects packages (and can actually be loaded by `LoadPackage(...)`).\n- A hack that has been deprecated in #19225 is removed.\n\n**Remaining problems:**\n1. Documentation does still not build correctly, although it can be built separately.\n2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?\n\n  ```\n  $(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n   ```\n   Or can this by simplified due to #30151?\n3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.\n\nProblem 2 should be addressed here. I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?",
    "created_at": "2020-10-17T11:02:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450715",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:73" align="right">Comment 73</div>

Hooray! After simply removing the hack that was deprecated by #19225, I get

```
[p_group_cohomology-3.3.2] ----------------------------------------------------------------------
[p_group_cohomology-3.3.2] All tests passed!
[p_group_cohomology-3.3.2] ----------------------------------------------------------------------
```
That was withoug #30151, though.

**Problems solved:**
- setup.py is not messing around with SAGE_LOCAL. Instead, stuff that needs to be installed relative to the root of the Sage installation is now put in place by spkg-install using sdh_install.
- The GAP part of the package has become a proper GAP package, that is installed where GAP expects packages (and can actually be loaded by `LoadPackage(...)`).
- A hack that has been deprecated in #19225 is removed.

**Remaining problems:**
1. Documentation does still not build correctly, although it can be built separately.
2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?

  ```
  $(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
   ```
   Or can this by simplified due to #30151?
3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.

Problem 2 should be addressed here. I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?



---

archive/issue_comments_450716.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nReplying to [@simon-king-jena](#comment%3A73):\n> **Remaining problems:**\n> ...\n> 2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?\n> \n>   ```\n>   $(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n>    ```\n>    Or can this by simplified due to #30151?\n> ...\n> \n> Problem 2 should be addressed here. ...\n\nOn the other hand: #30151 doesn't work yet, because of circular imports. So, in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151, so that, once the circular import problem is solved, `build/pkgs/p_group_cohomology/dependencies` can be modified there, not here. Do you think that's reasonable?",
    "created_at": "2020-10-17T11:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450716",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:74" align="right">Comment 74</div>

Replying to [@simon-king-jena](#comment%3A73):
> **Remaining problems:**
> ...
> 2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?
> 
>   ```
>   $(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
>    ```
>    Or can this by simplified due to #30151?
> ...
> 
> Problem 2 should be addressed here. ...

On the other hand: #30151 doesn't work yet, because of circular imports. So, in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151, so that, once the circular import problem is solved, `build/pkgs/p_group_cohomology/dependencies` can be modified there, not here. Do you think that's reasonable?



---

archive/issue_comments_450717.json:
```json
{
    "body": "Branch: **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)**",
    "created_at": "2020-10-17T11:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450717",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)**



---

archive/issue_comments_450718.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nFor now, I'll proceed as announced in the previous two comments.\n\nRemark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a\">4f5a810</a></td><td><code>Upgrade p_group_cohomology to version 3.3.2</code></td></tr></table>\n",
    "created_at": "2020-10-17T11:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450718",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:76" align="right">Comment 76</div>

For now, I'll proceed as announced in the previous two comments.

Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a">4f5a810</a></td><td><code>Upgrade p_group_cohomology to version 3.3.2</code></td></tr></table>




---

archive/issue_comments_450719.json:
```json
{
    "body": "Changed dependencies from **#30151** to none",
    "created_at": "2020-10-17T11:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450719",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#30151** to none



---

archive/issue_events_376099.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-10-17T11:30:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376099"
}
```



---

archive/issue_comments_450720.json:
```json
{
    "body": "Commit: **[4f5a810](https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a)**",
    "created_at": "2020-10-17T11:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450720",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[4f5a810](https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a)**



---

archive/issue_comments_450721.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,3 +20,4 @@\n - The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage(\"pGroupCohomologyHelpers\");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?\n - Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.\n \n+**Upstream of the package:** https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2\n``````\n",
    "created_at": "2020-10-17T11:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450721",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,3 +20,4 @@
 - The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage("pGroupCohomologyHelpers");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?
 - Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.
 
+**Upstream of the package:** https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2
``````




---

archive/issue_comments_450722.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\ncould you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?",
    "created_at": "2020-10-17T14:27:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450722",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:77" align="right">Comment 77</div>

could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?



---

archive/issue_comments_450723.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nReplying to [@simon-king-jena](#comment%3A76):\n> Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.\n\nTry `git push origin v3.3.2`",
    "created_at": "2020-10-17T15:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450723",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">Comment 78</div>

Replying to [@simon-king-jena](#comment%3A76):
> Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.

Try `git push origin v3.3.2`



---

archive/issue_comments_450724.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2020-10-17T15:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450724",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Simon King**



---

archive/issue_comments_450725.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nThis change seems to be undoing some changes that we made in the past to get the dependencies right -- probably a mistake?\n\n```\n--- a/build/pkgs/p_group_cohomology/dependencies\n+++ b/build/pkgs/p_group_cohomology/dependencies\n@@ -1 +1 @@\n-$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | $(PYTHON_TOOLCHAIN) matplotlib gap xz $(SAGERUNTIME) ipywidgets\n+$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n```",
    "created_at": "2020-10-17T15:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450725",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:80" align="right">Comment 80</div>

This change seems to be undoing some changes that we made in the past to get the dependencies right -- probably a mistake?

```
--- a/build/pkgs/p_group_cohomology/dependencies
+++ b/build/pkgs/p_group_cohomology/dependencies
@@ -1 +1 @@
-$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | $(PYTHON_TOOLCHAIN) matplotlib gap xz $(SAGERUNTIME) ipywidgets
+$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
```



---

archive/issue_comments_450726.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nReplying to [@simon-king-jena](#comment%3A74):\n> in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151\n\nOK",
    "created_at": "2020-10-17T15:51:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450726",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:81" align="right">Comment 81</div>

Replying to [@simon-king-jena](#comment%3A74):
> in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151

OK



---

archive/issue_comments_450727.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">Comment 82</div>\n\nPlease add `upstream_url` to `checksums.ini`",
    "created_at": "2020-10-17T15:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450727",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">Comment 82</div>

Please add `upstream_url` to `checksums.ini`



---

archive/issue_comments_450728.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">Comment 83</div>\n\nReplying to [@simon-king-jena](#comment%3A73):\n> **Remaining problems:**\n> 1. Documentation does still not build correctly, although it can be built separately.\n> ...\n> 3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.\n> \n> ... I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?\n\nSounds like a good plan",
    "created_at": "2020-10-17T15:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450728",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:83" align="right">Comment 83</div>

Replying to [@simon-king-jena](#comment%3A73):
> **Remaining problems:**
> 1. Documentation does still not build correctly, although it can be built separately.
> ...
> 3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.
> 
> ... I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?

Sounds like a good plan



---

archive/issue_comments_450729.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">Comment 84</div>\n\nAlso see [comment:44](#comment%3A44)",
    "created_at": "2020-10-17T16:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450729",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">Comment 84</div>

Also see [comment:44](#comment%3A44)



---

archive/issue_events_376100.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-17T17:07:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376100"
}
```



---

archive/issue_events_376101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-17T17:07:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376101"
}
```



---

archive/issue_comments_450730.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">Comment 86</div>\n\nReplying to [@mkoeppe](#comment%3A78):\n> Replying to [@simon-king-jena](#comment%3A76):\n> > Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.\n\n> \n> Try `git push origin v3.3.2`\n\nWhen creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.\n\nIs that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as \"different history\"?",
    "created_at": "2020-10-17T19:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450730",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:86" align="right">Comment 86</div>

Replying to [@mkoeppe](#comment%3A78):
> Replying to [@simon-king-jena](#comment%3A76):
> > Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.

> 
> Try `git push origin v3.3.2`

When creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.

Is that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as "different history"?



---

archive/issue_comments_450731.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">Comment 87</div>\n\nReplying to [@dimpase](#comment%3A77):\n> could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?\n\nNo.\n\nFirst of all, meataxe IS in dependencies:\n\n```\n$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n```\n\nSecondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.",
    "created_at": "2020-10-17T19:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450731",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:87" align="right">Comment 87</div>

Replying to [@dimpase](#comment%3A77):
> could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?

No.

First of all, meataxe IS in dependencies:

```
$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
```

Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.



---

archive/issue_comments_450732.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">Comment 88</div>\n\nReplying to [@jhpalmieri](#comment%3A44):\n> I don't know your answer about `sdh_make_install`, but the code could just read\n> \n> ```\n> cd ...\n> sdh_configure\n> sdh_make_install # assuming this works\n> ```\n\nNope, sdh_make_install is still broken. I tried, but it didn't work.\n\n> Re #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.\n\nNo idea.",
    "created_at": "2020-10-17T19:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450732",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:88" align="right">Comment 88</div>

Replying to [@jhpalmieri](#comment%3A44):
> I don't know your answer about `sdh_make_install`, but the code could just read
> 
> ```
> cd ...
> sdh_configure
> sdh_make_install # assuming this works
> ```

Nope, sdh_make_install is still broken. I tried, but it didn't work.

> Re #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.

No idea.



---

archive/issue_comments_450733.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">Comment 89</div>\n\nReplying to [@simon-king-jena](#comment%3A86):\n> When creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.\n> \n> Is that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as \"different history\"?\n\nLooking at https://github.com/sagemath/p_group_cohomology/commits/v3.3.2, I see that the tag is on the HEAD commit of master branch. This looks fine.",
    "created_at": "2020-10-17T19:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450733",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:89" align="right">Comment 89</div>

Replying to [@simon-king-jena](#comment%3A86):
> When creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.
> 
> Is that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as "different history"?

Looking at https://github.com/sagemath/p_group_cohomology/commits/v3.3.2, I see that the tag is on the HEAD commit of master branch. This looks fine.



---

archive/issue_comments_450734.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">Comment 90</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de8adfab53d360a9383091a4c018a3ed2308ef16\">de8adfa</a></td><td><code>Revert a change to \"dependencies\" of p_group_cohomology</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0\">cf60884</a></td><td><code>Add upstream_url to p_group_cohomology</code></td></tr></table>\n",
    "created_at": "2020-10-17T19:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450734",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90" align="right">Comment 90</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de8adfab53d360a9383091a4c018a3ed2308ef16">de8adfa</a></td><td><code>Revert a change to "dependencies" of p_group_cohomology</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0">cf60884</a></td><td><code>Add upstream_url to p_group_cohomology</code></td></tr></table>




---

archive/issue_comments_450735.json:
```json
{
    "body": "Changed commit from **[4f5a810](https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a)** to **[cf60884](https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0)**",
    "created_at": "2020-10-17T19:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4f5a810](https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a)** to **[cf60884](https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0)**



---

archive/issue_comments_450736.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">Comment 91</div>\n\nIn the previous two commits, I revert the changes to \"dependencies\" (no idea where the change came from) and added upstream_url. Hope the definition of upstream_url is correct.",
    "created_at": "2020-10-17T19:54:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450736",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:91" align="right">Comment 91</div>

In the previous two commits, I revert the changes to "dependencies" (no idea where the change came from) and added upstream_url. Hope the definition of upstream_url is correct.



---

archive/issue_events_376102.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-10-17T19:54:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376102"
}
```



---

archive/issue_events_376103.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-10-17T19:54:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376103"
}
```



---

archive/issue_comments_450737.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">Comment 92</div>\n\nWhat problem do you see with `sdh_make_install`?",
    "created_at": "2020-10-17T19:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450737",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:92" align="right">Comment 92</div>

What problem do you see with `sdh_make_install`?



---

archive/issue_comments_450738.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">Comment 93</div>\n\nReplying to [@simon-king-jena](#comment%3A91):\n> Hope the definition of upstream_url is correct.\n\nSomething downloads but ....\n\n```\n[p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')\n[p_group_cohomology-3.3.2] ChecksumError: checksum does not match\n[p_group_cohomology-3.3.2] ************************************************************************\n[p_group_cohomology-3.3.2] ************************************************************************\n[p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz\n```",
    "created_at": "2020-10-17T20:15:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450738",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:93" align="right">Comment 93</div>

Replying to [@simon-king-jena](#comment%3A91):
> Hope the definition of upstream_url is correct.

Something downloads but ....

```
[p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')
[p_group_cohomology-3.3.2] ChecksumError: checksum does not match
[p_group_cohomology-3.3.2] ************************************************************************
[p_group_cohomology-3.3.2] ************************************************************************
[p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz
```



---

archive/issue_comments_450739.json:
```json
{
    "body": "Attachment: **[p_group_cohomology-3.3.2.log](https://github.com/sagemath/sage/files/ticket28711/p_group_cohomology-3.3.2.log)**\n\nError with sdh_make_install",
    "created_at": "2020-10-17T20:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450739",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[p_group_cohomology-3.3.2.log](https://github.com/sagemath/sage/files/ticket28711/p_group_cohomology-3.3.2.log)**

Error with sdh_make_install



---

archive/issue_comments_450740.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">Comment 94</div>\n\nReplying to [@mkoeppe](#comment%3A92):\n> What problem do you see with `sdh_make_install`?\n\nWhith\n\n```\n...\n# build and install modular_resolution\ncd `ls -d modular_resolution*`\nsdh_configure\n# sdh_make install got broken by trac ticket #24106\nsdh_make_install\ncd ..\n...\n```\nI get :attachment:p_group_cohomology-3.3.2.log when first removing libmodres.* from SAGE_LOCAL/lib and modular_resolution from SAGE_LOCAL/include, then doing sage -f p_group_cohomology.",
    "created_at": "2020-10-17T20:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450740",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:94" align="right">Comment 94</div>

Replying to [@mkoeppe](#comment%3A92):
> What problem do you see with `sdh_make_install`?

Whith

```
...
# build and install modular_resolution
cd `ls -d modular_resolution*`
sdh_configure
# sdh_make install got broken by trac ticket #24106
sdh_make_install
cd ..
...
```
I get :attachment:p_group_cohomology-3.3.2.log when first removing libmodres.* from SAGE_LOCAL/lib and modular_resolution from SAGE_LOCAL/include, then doing sage -f p_group_cohomology.



---

archive/issue_comments_450741.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">Comment 95</div>\n\nOK, what's happening here is that your package is not ready for the staged install because the \"make install\" of the C library goes to the staging directory, so the second step will not find it in `SAGE_LOCAL`.  \n\nThis is working as designed. The problem will go away if you split out modres as a separate spkg.",
    "created_at": "2020-10-17T20:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450741",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:95" align="right">Comment 95</div>

OK, what's happening here is that your package is not ready for the staged install because the "make install" of the C library goes to the staging directory, so the second step will not find it in `SAGE_LOCAL`.  

This is working as designed. The problem will go away if you split out modres as a separate spkg.



---

archive/issue_comments_450742.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">Comment 96</div>\n\nReplying to [@mkoeppe](#comment%3A93):\n> Replying to [@simon-king-jena](#comment%3A91):\n> > Hope the definition of upstream_url is correct.\n\n> \n> Something downloads but ....\n> \n> ```\n> [p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')\n> [p_group_cohomology-3.3.2] ChecksumError: checksum does not match\n> [p_group_cohomology-3.3.2] ************************************************************************\n> [p_group_cohomology-3.3.2] ************************************************************************\n> [p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz\n> ```\n\nThank you. I downloaded the tarball from github, and it did indeed differ. I modified the release on github, and now it seems to work.",
    "created_at": "2020-10-17T20:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450742",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:96" align="right">Comment 96</div>

Replying to [@mkoeppe](#comment%3A93):
> Replying to [@simon-king-jena](#comment%3A91):
> > Hope the definition of upstream_url is correct.

> 
> Something downloads but ....
> 
> ```
> [p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')
> [p_group_cohomology-3.3.2] ChecksumError: checksum does not match
> [p_group_cohomology-3.3.2] ************************************************************************
> [p_group_cohomology-3.3.2] ************************************************************************
> [p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz
> ```

Thank you. I downloaded the tarball from github, and it did indeed differ. I modified the release on github, and now it seems to work.



---

archive/issue_comments_450743.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">Comment 97</div>\n\nhttps://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball",
    "created_at": "2020-10-17T20:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450743",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">Comment 97</div>

https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball



---

archive/issue_events_376104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-17T21:38:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376104"
}
```



---

archive/issue_events_376105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-17T21:38:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376105"
}
```



---

archive/issue_comments_450744.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">Comment 99</div>\n\nReplying to [@mkoeppe](#comment%3A97):\n> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball \n\nit is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.\nOn https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on \"Edit Release\"\nand upload the tarball you want there.",
    "created_at": "2020-10-17T22:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450744",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:99" align="right">Comment 99</div>

Replying to [@mkoeppe](#comment%3A97):
> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball 

it is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.
On https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on "Edit Release"
and upload the tarball you want there.



---

archive/issue_comments_450745.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">Comment 100</div>\n\nReplying to [@simon-king-jena](#comment%3A87):\n> Replying to [@dimpase](#comment%3A77):\n> > could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?\n\n> \n> No.\n> \n> First of all, meataxe IS in dependencies:\n> \n> ```\n> $(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n> ```\n> \n\nit seems to be the only  spkg that lists *files* as dependencies.\nI don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.\n\n\n> Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.\n\nThen replace these two lines by `sage -b` !",
    "created_at": "2020-10-17T22:20:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450745",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:100" align="right">Comment 100</div>

Replying to [@simon-king-jena](#comment%3A87):
> Replying to [@dimpase](#comment%3A77):
> > could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?

> 
> No.
> 
> First of all, meataxe IS in dependencies:
> 
> ```
> $(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
> ```
> 

it seems to be the only  spkg that lists *files* as dependencies.
I don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.


> Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.

Then replace these two lines by `sage -b` !



---

archive/issue_comments_450746.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">Comment 101</div>\n\nReplying to [@mkoeppe](#comment%3A97):\n> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball \n\nWTF? When I removed the old tarball (that I did produce on my own machine, by the way), I immediately replaced it by - again - the tarball from my machine. And afterwards I could download it by wget.",
    "created_at": "2020-10-17T22:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450746",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:101" align="right">Comment 101</div>

Replying to [@mkoeppe](#comment%3A97):
> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball 

WTF? When I removed the old tarball (that I did produce on my own machine, by the way), I immediately replaced it by - again - the tarball from my machine. And afterwards I could download it by wget.



---

archive/issue_comments_450747.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">Comment 102</div>\n\nReplying to [@dimpase](#comment%3A99):\n> Replying to [@mkoeppe](#comment%3A97):\n> > https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball \n\n> \n> it is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.\n\nBoth the old broken one and the new non-broken one are from my machine. Travis knows how to create a tarball for my package, but github doesn't.\n\n> On https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on \"Edit Release\"\n> and upload the tarball you want there.\n\nI did now, and I hope it is fine now.",
    "created_at": "2020-10-17T22:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450747",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:102" align="right">Comment 102</div>

Replying to [@dimpase](#comment%3A99):
> Replying to [@mkoeppe](#comment%3A97):
> > https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball 

> 
> it is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.

Both the old broken one and the new non-broken one are from my machine. Travis knows how to create a tarball for my package, but github doesn't.

> On https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on "Edit Release"
> and upload the tarball you want there.

I did now, and I hope it is fine now.



---

archive/issue_comments_450748.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nThe checksum still does not match...",
    "created_at": "2020-10-17T22:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450748",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">Comment 3</div>

The checksum still does not match...



---

archive/issue_comments_450749.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">Comment 104</div>\n\nReplying to [@dimpase](#comment%3A100):\n> it seems to be the only  spkg that lists *files* as dependencies.\n> I don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.\n\nI have no idea how exactly \"dependencies\" work. I don't recall who created the \"dependencies\" file for p_group_cohomology.\n\nI suppose the rationale is: If one would give \"sagelib\" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.\n\n> > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.\n\n> \n> Then replace these two lines by `sage -b` !\n\nI was told not to do that, IIRC.",
    "created_at": "2020-10-17T22:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450749",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:104" align="right">Comment 104</div>

Replying to [@dimpase](#comment%3A100):
> it seems to be the only  spkg that lists *files* as dependencies.
> I don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.

I have no idea how exactly "dependencies" work. I don't recall who created the "dependencies" file for p_group_cohomology.

I suppose the rationale is: If one would give "sagelib" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.

> > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.

> 
> Then replace these two lines by `sage -b` !

I was told not to do that, IIRC.



---

archive/issue_comments_450750.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">Comment 105</div>\n\nReplying to [@simon-king-jena](#comment%3A104):\n> I suppose the rationale is: If one would give \"sagelib\" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.\n\nI agree with this reasoning. In particular, note that `sagelib` is rebuilt every time.",
    "created_at": "2020-10-17T22:50:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450750",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:105" align="right">Comment 105</div>

Replying to [@simon-king-jena](#comment%3A104):
> I suppose the rationale is: If one would give "sagelib" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.

I agree with this reasoning. In particular, note that `sagelib` is rebuilt every time.



---

archive/issue_comments_450751.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">Comment 106</div>\n\nReplying to [@simon-king-jena](#comment%3A104):\n> > > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.\n\n> > \n> > Then replace these two lines by `sage -b` !\n\n> \n> I was told not to do that, IIRC.\n\nYes, let's not do that. The proper fix will come in the follow-up ticket, as discussed above.",
    "created_at": "2020-10-17T22:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450751",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:106" align="right">Comment 106</div>

Replying to [@simon-king-jena](#comment%3A104):
> > > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.

> > 
> > Then replace these two lines by `sage -b` !

> 
> I was told not to do that, IIRC.

Yes, let's not do that. The proper fix will come in the follow-up ticket, as discussed above.



---

archive/issue_comments_450752.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">Comment 107</div>\n\nReplying to [@mkoeppe](#comment%3A103):\n> The checksum still does not match...\n\nThe tarball in SAGE_ROOT/upstream is bitwise identical with what I downloaded.\n\nAnyway. If the checksums do not match, I suggest to clean things up. Namely, AFTER adding the tag \"v3.3.2\", I did a few changes in the index.rst file of the documentation. If I see that correctly, these changes are not part of the tarball that is posted on github.\n\nSince the numbers do not match, I will now\n- make sure to include my latest changes (to the documentation) in the release.\n- move the tag v3.3.2 to the corresponding commit, both locally and on github.\n- upload the release tarball on github\n- change the checksum, if necessary.",
    "created_at": "2020-10-17T22:51:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450752",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:107" align="right">Comment 107</div>

Replying to [@mkoeppe](#comment%3A103):
> The checksum still does not match...

The tarball in SAGE_ROOT/upstream is bitwise identical with what I downloaded.

Anyway. If the checksums do not match, I suggest to clean things up. Namely, AFTER adding the tag "v3.3.2", I did a few changes in the index.rst file of the documentation. If I see that correctly, these changes are not part of the tarball that is posted on github.

Since the numbers do not match, I will now
- make sure to include my latest changes (to the documentation) in the release.
- move the tag v3.3.2 to the corresponding commit, both locally and on github.
- upload the release tarball on github
- change the checksum, if necessary.



---

archive/issue_comments_450753.json:
```json
{
    "body": "Changed commit from **[cf60884](https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0)** to **[ae50157](https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9)**",
    "created_at": "2020-10-17T23:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450753",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cf60884](https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0)** to **[ae50157](https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9)**



---

archive/issue_comments_450754.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9\">ae50157</a></td><td><code>p_group_cohomology's upstream changed by some new commits</code></td></tr></table>\n",
    "created_at": "2020-10-17T23:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450754",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9">ae50157</a></td><td><code>p_group_cohomology's upstream changed by some new commits</code></td></tr></table>




---

archive/issue_events_376106.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-10-17T23:08:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376106"
}
```



---

archive/issue_events_376107.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-10-17T23:08:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376107"
}
```



---

archive/issue_comments_450755.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">Comment 109</div>\n\nReplying to [@simon-king-jena](#comment%3A107):\n> Since the numbers do not match, I will now\n> - make sure to include my latest changes (to the documentation) in the release.\n> - move the tag v3.3.2 to the corresponding commit, both locally and on github.\n> - upload the release tarball on github\n> - change the checksum, if necessary.\n\nDone. I think it is fine now.",
    "created_at": "2020-10-17T23:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450755",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:109" align="right">Comment 109</div>

Replying to [@simon-king-jena](#comment%3A107):
> Since the numbers do not match, I will now
> - make sure to include my latest changes (to the documentation) in the release.
> - move the tag v3.3.2 to the corresponding commit, both locally and on github.
> - upload the release tarball on github
> - change the checksum, if necessary.

Done. I think it is fine now.



---

archive/issue_comments_450756.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nI don't know what's happening here, but the checksums stil do not match. (..deleted..)",
    "created_at": "2020-10-17T23:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450756",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:0" align="right">Comment 0</div>

I don't know what's happening here, but the checksums stil do not match. (..deleted..)



---

archive/issue_comments_450757.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">Comment 111</div>\n\nReplying to [@mkoeppe](#comment%3A110):\n> I don't know what's happening here, but the checksums still do not match. \n\nLooks like this one was a malfunction on my side",
    "created_at": "2020-10-17T23:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450757",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:111" align="right">Comment 111</div>

Replying to [@mkoeppe](#comment%3A110):
> I don't know what's happening here, but the checksums still do not match. 

Looks like this one was a malfunction on my side



---

archive/issue_comments_450758.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nIt has built OK now on macOS",
    "created_at": "2020-10-17T23:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450758",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">Comment 2</div>

It has built OK now on macOS



---

archive/issue_comments_450759.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/actions/runs/313004407**",
    "created_at": "2020-10-17T23:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450759",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/actions/runs/313004407**



---

archive/issue_comments_450760.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet \u2014 it's in a staging area \u2014 so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:\n\n```diff\ndiff --git a/build/pkgs/p_group_cohomology/spkg-install.in b/build/pkgs/p_group_cohomology/spkg-install.in\nindex bcae3a8a47..aef761f9a6 100644\n--- a/build/pkgs/p_group_cohomology/spkg-install.in\n+++ b/build/pkgs/p_group_cohomology/spkg-install.in\n@@ -17,9 +17,3 @@ sdh_install singular_helper/dickson.lib \"$SAGE_SHARE/singular/LIB/\" || sdh_die \"\n # building pGroupCohomology (and its documentation)\n cd `ls -d pGroupCohomology*`\n sdh_pip_install .\n-\n-if [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then\n-    cd doc\n-    $MAKE html || sdh_die \"Error building documentation\"\n-    sdh_install build/html/* \"$SAGE_SHARE/doc/p_group_cohomology/\" || sdh_die \"Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology\"\n-fi\ndiff --git a/build/pkgs/p_group_cohomology/spkg-postinst.in b/build/pkgs/p_group_cohomology/spkg-postinst.in\nnew file mode 100644\nindex 0000000000..ec485455db\n--- /dev/null\n+++ b/build/pkgs/p_group_cohomology/spkg-postinst.in\n@@ -0,0 +1,8 @@\n+cd src\n+cd `ls -d pGroupCohomology*`\n+\n+if [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then\n+    cd doc\n+    $MAKE html || sdh_die \"Error building documentation\"\n+    sdh_install build/html/* \"$SAGE_SHARE/doc/p_group_cohomology/\" || sdh_die \"Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology\"\n+fi\n```",
    "created_at": "2020-10-18T01:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450760",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">Comment 4</div>

I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet — it's in a staging area — so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:

```diff
diff --git a/build/pkgs/p_group_cohomology/spkg-install.in b/build/pkgs/p_group_cohomology/spkg-install.in
index bcae3a8a47..aef761f9a6 100644
--- a/build/pkgs/p_group_cohomology/spkg-install.in
+++ b/build/pkgs/p_group_cohomology/spkg-install.in
@@ -17,9 +17,3 @@ sdh_install singular_helper/dickson.lib "$SAGE_SHARE/singular/LIB/" || sdh_die "
 # building pGroupCohomology (and its documentation)
 cd `ls -d pGroupCohomology*`
 sdh_pip_install .
-
-if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
-    cd doc
-    $MAKE html || sdh_die "Error building documentation"
-    sdh_install build/html/* "$SAGE_SHARE/doc/p_group_cohomology/" || sdh_die "Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology"
-fi
diff --git a/build/pkgs/p_group_cohomology/spkg-postinst.in b/build/pkgs/p_group_cohomology/spkg-postinst.in
new file mode 100644
index 0000000000..ec485455db
--- /dev/null
+++ b/build/pkgs/p_group_cohomology/spkg-postinst.in
@@ -0,0 +1,8 @@
+cd src
+cd `ls -d pGroupCohomology*`
+
+if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
+    cd doc
+    $MAKE html || sdh_die "Error building documentation"
+    sdh_install build/html/* "$SAGE_SHARE/doc/p_group_cohomology/" || sdh_die "Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology"
+fi
```



---

archive/issue_comments_450761.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nThe problem with the checksum error on automatic download was also reproduced on GH Actions: \n\n```\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/p_group_cohomology/p_group_cohomology-3.3.2.tar.xz'\nAttempting to download from https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz\n[......................................................................]\n************************************************************************\nTraceback (most recent call last):\n  File \"/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 130, in run_safe\n    run()\n  File \"/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 112, in run\n    app.download_tarball(args.url_or_tarball, args.destination, args.allow_upstream)\n  File \"/sage/build/bin/../sage_bootstrap/download/app.py\", line 41, in download_tarball\n    tarball.download(allow_upstream=allow_upstream)\n  File \"/sage/build/bin/../sage_bootstrap/tarball.py\", line 177, in download\n    raise ChecksumError('checksum does not match')\nChecksumError: checksum does not match\n```",
    "created_at": "2020-10-18T03:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450761",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">Comment 5</div>

The problem with the checksum error on automatic download was also reproduced on GH Actions: 

```
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/p_group_cohomology/p_group_cohomology-3.3.2.tar.xz'
Attempting to download from https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz
[......................................................................]
************************************************************************
Traceback (most recent call last):
  File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 130, in run_safe
    run()
  File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 112, in run
    app.download_tarball(args.url_or_tarball, args.destination, args.allow_upstream)
  File "/sage/build/bin/../sage_bootstrap/download/app.py", line 41, in download_tarball
    tarball.download(allow_upstream=allow_upstream)
  File "/sage/build/bin/../sage_bootstrap/tarball.py", line 177, in download
    raise ChecksumError('checksum does not match')
ChecksumError: checksum does not match
```



---

archive/issue_comments_450762.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nHm......\n\n```\n(sage-sh) mkoeppe@egret:sage-rebasing$ sage-download-file https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz > A\n[......................................................................]\n(sage-sh) mkoeppe@egret:sage-rebasing$ file A\nA: HTML document text, UTF-8 Unicode text, with very long lines\n(sage-sh) mkoeppe@egret:sage-rebasing$ head A\n\n\n\n\n\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n  <link rel=\"dns-prefetch\" href=\"https://github.githubassets.com\">\n```",
    "created_at": "2020-10-18T03:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450762",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

Hm......

```
(sage-sh) mkoeppe@egret:sage-rebasing$ sage-download-file https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz > A
[......................................................................]
(sage-sh) mkoeppe@egret:sage-rebasing$ file A
A: HTML document text, UTF-8 Unicode text, with very long lines
(sage-sh) mkoeppe@egret:sage-rebasing$ head A





<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://github.githubassets.com">
```



---

archive/issue_comments_450763.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)** to **[u/mkoeppe/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_spkg_install_of_p_group_cohomology)**",
    "created_at": "2020-10-18T03:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450763",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)** to **[u/mkoeppe/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_spkg_install_of_p_group_cohomology)**



---

archive/issue_comments_450764.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/313004407** to **https://github.com/mkoeppe/sage/actions/runs/313251166**",
    "created_at": "2020-10-18T03:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450764",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/313004407** to **https://github.com/mkoeppe/sage/actions/runs/313251166**



---

archive/issue_comments_450765.json:
```json
{
    "body": "Changed commit from **[ae50157](https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9)** to **[bd34c47](https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf)**",
    "created_at": "2020-10-18T03:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450765",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[ae50157](https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9)** to **[bd34c47](https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf)**



---

archive/issue_comments_450766.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf\">bd34c47</a></td><td><code>build/pkgs/p_group_cohomology/checksums.ini: Fix upstream_url</code></td></tr></table>\n",
    "created_at": "2020-10-18T03:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450766",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">Comment 8</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf">bd34c47</a></td><td><code>build/pkgs/p_group_cohomology/checksums.ini: Fix upstream_url</code></td></tr></table>




---

archive/issue_comments_450767.json:
```json
{
    "body": "<div id=\"comment:119\" align=\"right\">Comment 119</div>\n\nReplying to [@jhpalmieri](#comment%3A114):\n> I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet \u2014 it's in a staging area \u2014 so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:\n\nSure, that makes sense! Thank you for spotting it!\n\nI'll try, and if it works, I will also remove the comment from the doc that states that docbuilding during package installation is broken.",
    "created_at": "2020-10-18T07:13:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450767",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:119" align="right">Comment 119</div>

Replying to [@jhpalmieri](#comment%3A114):
> I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet — it's in a staging area — so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:

Sure, that makes sense! Thank you for spotting it!

I'll try, and if it works, I will also remove the comment from the doc that states that docbuilding during package installation is broken.



---

archive/issue_comments_450768.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_spkg_install_of_p_group_cohomology)** to **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)**",
    "created_at": "2020-10-18T07:56:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450768",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/mkoeppe/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_spkg_install_of_p_group_cohomology)** to **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)**



---

archive/issue_comments_450769.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThank you very much, when using spkg-postinst, building the documentation works!\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b\">245560d</a></td><td><code>Fix docbuild of p_group_cohomology</code></td></tr></table>\n",
    "created_at": "2020-10-18T07:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450769",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">Comment 1</div>

Thank you very much, when using spkg-postinst, building the documentation works!

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b">245560d</a></td><td><code>Fix docbuild of p_group_cohomology</code></td></tr></table>




---

archive/issue_comments_450770.json:
```json
{
    "body": "Changed commit from **[bd34c47](https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf)** to **[245560d](https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b)**",
    "created_at": "2020-10-18T07:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450770",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[bd34c47](https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf)** to **[245560d](https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b)**



---

archive/issue_comments_450771.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nPS: The new tarball (removing the remark on broken docbuild) is on github.",
    "created_at": "2020-10-18T07:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450771",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">Comment 2</div>

PS: The new tarball (removing the remark on broken docbuild) is on github.



---

archive/issue_comments_450772.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">Comment 123</div>\n\nOK, but one doctest is failing\n\n```\n$ ./sage -tp src/sage/tests/modular_group_cohomology.py\nRunning doctests with ID 2020-10-19-09-47-51-87beac43.\nGit branch: public/graphs/30386\nUsing --optional=bliss,build,debian,dochtml,gap_packages,libsemigroups,meataxe,memlimit,p_group_cohomology,pip,sage,sage_spkg\nDoctesting 1 file using 4 threads.\nsage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py\n**********************************************************************\nFile \"src/sage/tests/modular_group_cohomology.py\", line 20, in sage.tests.modular_group_cohomology\nFailed example:\n    H == H0                                       # optional - p_group_cohomology\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of  18 in sage.tests.modular_group_cohomology\n    [17 tests, 1 failure, 3.98 s]\n----------------------------------------------------------------------\nsage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 4.0 seconds\n    cpu time: 3.4 seconds\n    cumulative wall time: 4.0 seconds\n```\nnote that also at Sage prompt computing H and H0 gives\n\n```\nsage: H0.gens()                                                                                                                                                      \n[1,\n a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\nsage: H.gens()                                                                                                                                                       \n[1,\n a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\nsage: H0.is_isomorphic(H)                                                                                                                                            \n('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\nsage: H.is_isomorphic(H0)                                                                                                                                            \n('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\nsage: H==H0                                                                                                                                                          \nFalse\n```\n\nnot sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket.",
    "created_at": "2020-10-19T08:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450772",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:123" align="right">Comment 123</div>

OK, but one doctest is failing

```
$ ./sage -tp src/sage/tests/modular_group_cohomology.py
Running doctests with ID 2020-10-19-09-47-51-87beac43.
Git branch: public/graphs/30386
Using --optional=bliss,build,debian,dochtml,gap_packages,libsemigroups,meataxe,memlimit,p_group_cohomology,pip,sage,sage_spkg
Doctesting 1 file using 4 threads.
sage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py
**********************************************************************
File "src/sage/tests/modular_group_cohomology.py", line 20, in sage.tests.modular_group_cohomology
Failed example:
    H == H0                                       # optional - p_group_cohomology
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  18 in sage.tests.modular_group_cohomology
    [17 tests, 1 failure, 3.98 s]
----------------------------------------------------------------------
sage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 4.0 seconds
    cpu time: 3.4 seconds
    cumulative wall time: 4.0 seconds
```
note that also at Sage prompt computing H and H0 gives

```
sage: H0.gens()                                                                                                                                                      
[1,
 a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
sage: H.gens()                                                                                                                                                       
[1,
 a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
sage: H0.is_isomorphic(H)                                                                                                                                            
('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
sage: H.is_isomorphic(H0)                                                                                                                                            
('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
sage: H==H0                                                                                                                                                          
False
```

not sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket.



---

archive/issue_comments_450773.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">Comment 124</div>\n\nReplying to [@dimpase](#comment%3A123):\n> OK, but one doctest is failing\n\nThank you for spotting this! Indeed I forgot that there are some doctests in the Sage src tree, and only tested the package's own test suite.\n\n> note that also at Sage prompt computing H and H0 gives\n> \n> ```\n> sage: H0.gens()                                                                                                                                                      \n> [1,\n>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\n> sage: H.gens()                                                                                                                                                       \n> [1,\n>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\n> sage: H0.is_isomorphic(H)                                                                                                                                            \n> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\n> sage: H.is_isomorphic(H0)                                                                                                                                            \n> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\n> sage: H==H0                                                                                                                                                          \n> False\n> ```\n\nHm. I'll have a closer look. Two cohomology rings should evaluate equal if the two ring representations are identical. This should be the case here, as there is an isomorphism mapping the generators one to one.\n\n... unless there is a tail reduction of the relations in one case but not in the other case.\n\n> not sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket. \n\nAt least I'll have a look now.",
    "created_at": "2020-10-19T09:00:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450773",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:124" align="right">Comment 124</div>

Replying to [@dimpase](#comment%3A123):
> OK, but one doctest is failing

Thank you for spotting this! Indeed I forgot that there are some doctests in the Sage src tree, and only tested the package's own test suite.

> note that also at Sage prompt computing H and H0 gives
> 
> ```
> sage: H0.gens()                                                                                                                                                      
> [1,
>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
> sage: H.gens()                                                                                                                                                       
> [1,
>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
> sage: H0.is_isomorphic(H)                                                                                                                                            
> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
> sage: H.is_isomorphic(H0)                                                                                                                                            
> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
> sage: H==H0                                                                                                                                                          
> False
> ```

Hm. I'll have a closer look. Two cohomology rings should evaluate equal if the two ring representations are identical. This should be the case here, as there is an isomorphism mapping the generators one to one.

... unless there is a tail reduction of the relations in one case but not in the other case.

> not sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket. 

At least I'll have a look now.



---

archive/issue_comments_450774.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nInteresting:\n\n```\nsage: H.set_ring()                                                                                  \nsage: H.relation_ideal()                                                                            \na_1_0^2,\na_1_0*a_1_1,\na_1_1^3,\na_2_1*a_1_0,\na_2_1^2+a_2_1*a_1_1^2,\na_1_0*a_3_3+a_2_1*a_1_1^2,\na_1_1*a_3_3+a_2_1*a_1_1^2,\na_2_1*a_3_3,\na_3_3^2\nsage: H0.set_ring()                                                                                 \nsage: H0.relation_ideal()                                                                           \na_1_0^2,\na_1_0*a_1_1,\na_1_1^3,\na_2_1*a_1_0,\na_2_1^2+a_2_1*a_1_1^2,\na_1_0*a_3_3+a_2_1*a_1_1^2,\na_1_1*a_3_3+a_2_1*a_1_1^2,\na_2_1*a_3_3,\na_3_3^2\nsage: H.rels()                                                                                      \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_0*a_3_3+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1*a_1_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\nsage: H0.rels()                                                                                     \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1^2',\n 'a_1_0*a_3_3+a_2_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\n```\nSo, Singular says that the two ideals are identical, but the string representation stored in the cohomology ring is different.",
    "created_at": "2020-10-19T09:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450774",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">Comment 5</div>

Interesting:

```
sage: H.set_ring()                                                                                  
sage: H.relation_ideal()                                                                            
a_1_0^2,
a_1_0*a_1_1,
a_1_1^3,
a_2_1*a_1_0,
a_2_1^2+a_2_1*a_1_1^2,
a_1_0*a_3_3+a_2_1*a_1_1^2,
a_1_1*a_3_3+a_2_1*a_1_1^2,
a_2_1*a_3_3,
a_3_3^2
sage: H0.set_ring()                                                                                 
sage: H0.relation_ideal()                                                                           
a_1_0^2,
a_1_0*a_1_1,
a_1_1^3,
a_2_1*a_1_0,
a_2_1^2+a_2_1*a_1_1^2,
a_1_0*a_3_3+a_2_1*a_1_1^2,
a_1_1*a_3_3+a_2_1*a_1_1^2,
a_2_1*a_3_3,
a_3_3^2
sage: H.rels()                                                                                      
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_0*a_3_3+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1*a_1_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
sage: H0.rels()                                                                                     
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1^2',
 'a_1_0*a_3_3+a_2_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
```
So, Singular says that the two ideals are identical, but the string representation stored in the cohomology ring is different.



---

archive/issue_comments_450775.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nThe relations of H and H0 are equal as sets, but not as lists:\n\n```\nsage: H.rels()                                                                                                                                                       \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_0*a_3_3+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1*a_1_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\nsage: H0.rels()                                                                                                                                                      \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1^2',\n 'a_1_0*a_3_3+a_2_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\n```\n\nEDIT - oops, sorry, there are just a bit different - as you noticed already, I suppose.",
    "created_at": "2020-10-19T09:10:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450775",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">Comment 6</div>

The relations of H and H0 are equal as sets, but not as lists:

```
sage: H.rels()                                                                                                                                                       
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_0*a_3_3+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1*a_1_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
sage: H0.rels()                                                                                                                                                      
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1^2',
 'a_1_0*a_3_3+a_2_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
```

EDIT - oops, sorry, there are just a bit different - as you noticed already, I suppose.



---

archive/issue_comments_450776.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nIndeed, the problem is the missing interreduction:\n\n```\nsage: H0.set_ring()                                                                                 \nsage: I = singular.ideal(H0.rels())                                                                 \nsage: str(I) == str(H0.relation_ideal())                                                            \nFalse\nsage: str(I.interred()) == str(H0.relation_ideal())                                                 \nTrue\n```\nHm. What to do about it?",
    "created_at": "2020-10-19T09:10:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450776",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">Comment 7</div>

Indeed, the problem is the missing interreduction:

```
sage: H0.set_ring()                                                                                 
sage: I = singular.ideal(H0.rels())                                                                 
sage: str(I) == str(H0.relation_ideal())                                                            
False
sage: str(I.interred()) == str(H0.relation_ideal())                                                 
True
```
Hm. What to do about it?



---

archive/issue_comments_450777.json:
```json
{
    "body": "<div id=\"comment:128\" align=\"right\">Comment 128</div>\n\nReplying to [@dimpase](#comment%3A126):\n> The relations of H and H0 are equal as sets, but not as lists:\n\nNo, they aren't. They are equal after doing interreduction.\n\n```\nsage: set(H0.rels()) == set(H.rels())                                                               \nFalse\n```",
    "created_at": "2020-10-19T09:11:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450777",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:128" align="right">Comment 128</div>

Replying to [@dimpase](#comment%3A126):
> The relations of H and H0 are equal as sets, but not as lists:

No, they aren't. They are equal after doing interreduction.

```
sage: set(H0.rels()) == set(H.rels())                                                               
False
```



---

archive/issue_comments_450778.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nBack to the question what to do about it.\n\nThe point of the equality check is to provide a VERY QUICK test. So, I wouldn't like to do interreduction before comparing.\n\nBut one could fix the doctest by checking that the two rings are indeed isomorphic by mapping the list of generators one-to-one.",
    "created_at": "2020-10-19T09:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450778",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">Comment 9</div>

Back to the question what to do about it.

The point of the equality check is to provide a VERY QUICK test. So, I wouldn't like to do interreduction before comparing.

But one could fix the doctest by checking that the two rings are indeed isomorphic by mapping the list of generators one-to-one.



---

archive/issue_comments_450779.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nI would not call what we see here a \"pythonic\" equality. What we see here is more like \n`1/2==2/4` - the jury is still out on whether this should be True or False.\n\nOn the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?",
    "created_at": "2020-10-19T09:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450779",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:0" align="right">Comment 0</div>

I would not call what we see here a "pythonic" equality. What we see here is more like 
`1/2==2/4` - the jury is still out on whether this should be True or False.

On the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?



---

archive/issue_comments_450780.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9\">f4e5f6a</a></td><td><code>Fix a doctest in sage/tests/modular_cohomology.py</code></td></tr></table>\n",
    "created_at": "2020-10-19T09:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450780",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1" align="right">Comment 1</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9">f4e5f6a</a></td><td><code>Fix a doctest in sage/tests/modular_cohomology.py</code></td></tr></table>




---

archive/issue_comments_450781.json:
```json
{
    "body": "Changed commit from **[245560d](https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b)** to **[f4e5f6a](https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9)**",
    "created_at": "2020-10-19T09:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450781",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[245560d](https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b)** to **[f4e5f6a](https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9)**



---

archive/issue_comments_450782.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">Comment 132</div>\n\nReplying to [@dimpase](#comment%3A130):\n> I would not call what we see here a \"pythonic\" equality. What we see here is more like \n> `1/2==2/4` - the jury is still out on whether this should be True or False.\n\nI chose \"equality of cohomology rings\" to mean \"equality of ring representations\".\n\nSo, with this choice, one would have `1/2==2/4` if and only if `1/2` is represented in the same way (namely as a REDUCED fraction) as `2/4`.\n\nNote that to check whether two ideals represent the same set of polynomials, one would need to compute Gr\u00f6bner bases. But that's very expensive. Therefore, it was decided by Sage (at least in the past, I don't know if that has changed) to not do the expensive test, but to compare generators instead.\n\nAnd that's what I do here, too.\n\n> On the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?\n\nSure. I wrote a research paper (with Bettina Eick) on classifying the cohomology rings of groups of order <=81 up to graded isomorphism. And that's a totally different problem.\n\nHere, equality is not \"isomorphism of graded rings\", but \"identity of ring representations\".",
    "created_at": "2020-10-19T09:27:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450782",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:132" align="right">Comment 132</div>

Replying to [@dimpase](#comment%3A130):
> I would not call what we see here a "pythonic" equality. What we see here is more like 
> `1/2==2/4` - the jury is still out on whether this should be True or False.

I chose "equality of cohomology rings" to mean "equality of ring representations".

So, with this choice, one would have `1/2==2/4` if and only if `1/2` is represented in the same way (namely as a REDUCED fraction) as `2/4`.

Note that to check whether two ideals represent the same set of polynomials, one would need to compute Gröbner bases. But that's very expensive. Therefore, it was decided by Sage (at least in the past, I don't know if that has changed) to not do the expensive test, but to compare generators instead.

And that's what I do here, too.

> On the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?

Sure. I wrote a research paper (with Bettina Eick) on classifying the cohomology rings of groups of order <=81 up to graded isomorphism. And that's a totally different problem.

Here, equality is not "isomorphism of graded rings", but "identity of ring representations".



---

archive/issue_comments_450783.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nOK, good.\nOne can still try to find more errors here: https://github.com/mkoeppe/sage/actions/runs/313251166\nbut I guess it's OK.",
    "created_at": "2020-10-19T09:51:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450783",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">Comment 3</div>

OK, good.
One can still try to find more errors here: https://github.com/mkoeppe/sage/actions/runs/313251166
but I guess it's OK.



---

archive/issue_events_376108.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-19T09:51:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376108"
}
```



---

archive/issue_events_376109.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-19T09:51:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376109"
}
```



---

archive/issue_comments_450784.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/313251166** to **Dima Pasechnik**",
    "created_at": "2020-10-19T09:51:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450784",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/313251166** to **Dima Pasechnik**



---

archive/issue_comments_450785.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nLooking good. On to #30787...?",
    "created_at": "2020-10-19T23:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450785",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">Comment 4</div>

Looking good. On to #30787...?



---

archive/issue_comments_450786.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Matthias Koeppe**",
    "created_at": "2020-10-19T23:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450786",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Matthias Koeppe**



---

archive/issue_comments_450787.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)** to **[f4e5f6a](https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9)**",
    "created_at": "2020-10-31T18:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28711#issuecomment-450787",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/SimonKing/fix_spkg_install_of_p_group_cohomology](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_spkg_install_of_p_group_cohomology)** to **[f4e5f6a](https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9)**



---

archive/issue_events_376110.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-31T18:07:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376110"
}
```



---

archive/issue_events_376111.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "96caebb74a12e25d7406f7f13bc3caecdc300415",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-10-31T18:07:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28711",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28711#event-376111"
}
```
