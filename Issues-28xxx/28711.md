# Issue 28711: Fix spkg-install of p_group_cohomology

archive/issues_028474.json:
```json
{
    "body": "CC:  @embray @jhpalmieri @orlitzky @kiwifb @dimpase\n\nThis is a reformulation of the ticket summary, after some discussion went on.\n\np_group_cohomology is divided into four parts:\n- a C-library libmodres (autotoolized), also providing a data base.\n- a pip-installable collection of Python / Cython modules\n- some files containing GAP code (let's call it GAP helper module)\n- a documentation using sphinx\n\nProblem: Some of the modules refer to SAGE_LOCAL at installation or at run time, respectively. Moreover, the GAP helper module is currently installed into SAGE_LOCAL/share/sage, which has been removed.\n\nIssues of each part:\n- The C-library seems totally fine. One could consider to turn it into a stand-alone spkg.\n- The Python / Cython modules seem mostly fine. Problems: \n  - Its setup.py takes the job of installing the GAP helper module, in a folder whose location is determined from the value of SAGE_LOCAL and which actually doesn't exist any longer.\n  - Some Python module makes GAP read the GAP helper module, thus also determines the import location from the value of SAGE_LOCAL.\n  Proposed solution:\n  - It shouldn't be the job of setup.py to install the GAP helper module.\n  - It should be possible for GAP to load the helper module without explicitly constructing a path derived from SAGE_LOCAL.\n  Side remark: It would be possible to move the Python / Cython modules into Sage's src tree, but that would created issues with testing and documentation.\n- The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage(\"pGroupCohomologyHelpers\");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?\n- Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.\n\n**Upstream of the package:** https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2\n\nIssue created by migration from https://trac.sagemath.org/ticket/28711\n\n",
    "closed_at": "2020-10-31T18:07:39Z",
    "created_at": "2019-11-08T22:02:35Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Fix spkg-install of p_group_cohomology",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28711",
    "user": "https://github.com/simon-king-jena"
}
```
CC:  @embray @jhpalmieri @orlitzky @kiwifb @dimpase

This is a reformulation of the ticket summary, after some discussion went on.

p_group_cohomology is divided into four parts:
- a C-library libmodres (autotoolized), also providing a data base.
- a pip-installable collection of Python / Cython modules
- some files containing GAP code (let's call it GAP helper module)
- a documentation using sphinx

Problem: Some of the modules refer to SAGE_LOCAL at installation or at run time, respectively. Moreover, the GAP helper module is currently installed into SAGE_LOCAL/share/sage, which has been removed.

Issues of each part:
- The C-library seems totally fine. One could consider to turn it into a stand-alone spkg.
- The Python / Cython modules seem mostly fine. Problems: 
  - Its setup.py takes the job of installing the GAP helper module, in a folder whose location is determined from the value of SAGE_LOCAL and which actually doesn't exist any longer.
  - Some Python module makes GAP read the GAP helper module, thus also determines the import location from the value of SAGE_LOCAL.
  Proposed solution:
  - It shouldn't be the job of setup.py to install the GAP helper module.
  - It should be possible for GAP to load the helper module without explicitly constructing a path derived from SAGE_LOCAL.
  Side remark: It would be possible to move the Python / Cython modules into Sage's src tree, but that would created issues with testing and documentation.
- The files containing GAP code are not intended to be a proper GAP module, but should perhaps behave like a proper GAP module. A more or less clean solution would be to put it into GAP's pkg folder such that it can be loaded by `LoadPackage("pGroupCohomologyHelpers");`. Problem: How to determine GAP's pkg folder at installation time without referring to SAGE_LOCAL?
- Documentation is built using `$MAKE html` and then copied. It was suggested to replace `cp -r` by `sdh_install`.

**Upstream of the package:** https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2

Issue created by migration from https://trac.sagemath.org/ticket/28711





---

archive/issue_comments_401574.json:
```json
{
    "body": "The spkg-install script does use sdh_configure, sdh_make and sdh_pip_install, but is also uses \"$MAKE install\" and \"$MAKE html\" and \"cp -r\". I guess \"$MAKE install\" should become \"sdh_make_install\", but I don't know what to do with \"$MAKE html\" and \"cp -r\" which is used to build and install the package documentation.",
    "created_at": "2019-11-08T22:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401574",
    "user": "https://github.com/simon-king-jena"
}
```

The spkg-install script does use sdh_configure, sdh_make and sdh_pip_install, but is also uses "$MAKE install" and "$MAKE html" and "cp -r". I guess "$MAKE install" should become "sdh_make_install", but I don't know what to do with "$MAKE html" and "cp -r" which is used to build and install the package documentation.



---

archive/issue_comments_401575.json:
```json
{
    "body": "Can you use `$MAKE html` to build the documentation and then `sdh_install` to install it?",
    "created_at": "2019-11-08T22:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401575",
    "user": "https://github.com/jhpalmieri"
}
```

Can you use `$MAKE html` to build the documentation and then `sdh_install` to install it?



---

archive/issue_events_072374.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28711#event-72374"
}
```



---

archive/issue_comments_401576.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401576",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_072375.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-24T02:05:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28711#event-72375"
}
```



---

archive/issue_events_072376.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-24T02:05:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28711#event-72376"
}
```



---

archive/issue_comments_401577.json:
```json
{
    "body": "Also it looks like dependencies are not right.\nhttps://github.com/mkoeppe/sage/runs/874569119",
    "created_at": "2020-07-15T21:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401577",
    "user": "https://github.com/mkoeppe"
}
```

Also it looks like dependencies are not right.
https://github.com/mkoeppe/sage/runs/874569119



---

archive/issue_comments_401578.json:
```json
{
    "body": "There have for a long time been issues with installation of `p_group_cohomology`: it seems that you have to install `meataxe` and then run `sage -b` and then install `p_group_cohomology`. Something like that, anyway. If someone could straighten that out, that would be great.",
    "created_at": "2020-07-15T21:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401578",
    "user": "https://github.com/jhpalmieri"
}
```

There have for a long time been issues with installation of `p_group_cohomology`: it seems that you have to install `meataxe` and then run `sage -b` and then install `p_group_cohomology`. Something like that, anyway. If someone could straighten that out, that would be great.



---

archive/issue_comments_401579.json:
```json
{
    "body": "I have been reluctant to work on `p_group_cohomology` for a long time because of the state of `meataxe` - in the installation department. I am not planning to work on this until there is proof of improvement. In the past I would have been willing to help with that, nowadays I am considering myself overcommitted already.",
    "created_at": "2020-07-15T21:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401579",
    "user": "https://github.com/kiwifb"
}
```

I have been reluctant to work on `p_group_cohomology` for a long time because of the state of `meataxe` - in the installation department. I am not planning to work on this until there is proof of improvement. In the past I would have been willing to help with that, nowadays I am considering myself overcommitted already.



---

archive/issue_comments_401580.json:
```json
{
    "body": "Thanks for the info. Then let's postpone work on this until after modularization of sagelib, which will eliminate this complicated dependency.",
    "created_at": "2020-07-15T21:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401580",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the info. Then let's postpone work on this until after modularization of sagelib, which will eliminate this complicated dependency.



---

archive/issue_events_072377.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-15T21:42:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28711#event-72377"
}
```



---

archive/issue_events_072378.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-15T21:42:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28711#event-72378"
}
```



---

archive/issue_comments_401581.json:
```json
{
    "body": "There is an issue that came up at #30349: Apparently there is a problem with the installation folder of gap code that is part of the package. It isn't clear to me how this should be fixed.",
    "created_at": "2020-10-15T16:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401581",
    "user": "https://github.com/simon-king-jena"
}
```

There is an issue that came up at #30349: Apparently there is a problem with the installation folder of gap code that is part of the package. It isn't clear to me how this should be fixed.



---

archive/issue_comments_401582.json:
```json
{
    "body": "On the other ticket, Dima stated:\n\n///\n\nYou can call GAP and examine GAPInfo.RootPaths. When looking for a package, GAP appends pkg/ to each directory in this list, cf. 9.2 GAP Root Directories in its manual.\n\nIMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (\u200bhttps://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. \n\n///\n\nSo, I'll have a look at it.\n\nQuestion: When using GAP's package manager, it would probably be possible to do it in the setup.py, using libgap. Should I keep it there, or is it cleaner to move installation of GAP code to spkg-install?",
    "created_at": "2020-10-15T16:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401582",
    "user": "https://github.com/simon-king-jena"
}
```

On the other ticket, Dima stated:

///

You can call GAP and examine GAPInfo.RootPaths. When looking for a package, GAP appends pkg/ to each directory in this list, cf. 9.2 GAP Root Directories in its manual.

IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (​https://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. 

///

So, I'll have a look at it.

Question: When using GAP's package manager, it would probably be possible to do it in the setup.py, using libgap. Should I keep it there, or is it cleaner to move installation of GAP code to spkg-install?



---

archive/issue_comments_401583.json:
```json
{
    "body": "one can do this in setup.py regardless, getting a proper path to install a GAP package to is just\n\n```\nsage: next(filter(lambda l: l.sage().startswith(SAGE_LOCAL), libgap.eval('GAPInfo.RootPaths'))).sage()+'pkg/'                                                                                                                          \n'/mnt/opt/Sage/sage-dev/local/share/gap/pkg/'\n```",
    "created_at": "2020-10-15T18:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401583",
    "user": "https://github.com/dimpase"
}
```

one can do this in setup.py regardless, getting a proper path to install a GAP package to is just

```
sage: next(filter(lambda l: l.sage().startswith(SAGE_LOCAL), libgap.eval('GAPInfo.RootPaths'))).sage()+'pkg/'                                                                                                                          
'/mnt/opt/Sage/sage-dev/local/share/gap/pkg/'
```



---

archive/issue_comments_401584.json:
```json
{
    "body": "not sure how \"pythonic\" this is though.",
    "created_at": "2020-10-15T18:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401584",
    "user": "https://github.com/dimpase"
}
```

not sure how "pythonic" this is though.



---

archive/issue_comments_401585.json:
```json
{
    "body": "Replying to [comment:14 SimonKing]:\n> IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (\u200bhttps://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. \n\n\nDo I understand correctly that GAP's PackageManager is for installing packages from the GAP ecosystem? What I want to do is to use some GAP code that is NOT an upstream GAP package (not even an unofficial \"submitted\" package).\n\nAnyway, using some GAP infrastructure to install my files, rather than hacking paths, seems the right approach to me.",
    "created_at": "2020-10-15T20:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401585",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:14 SimonKing]:
> IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP data via setup.py. I'd say, install a GAP package separately, not from setup.py from spkg-install. By the way, GAP now has its own package manager. Maybe you can use it (​https://github.com/gap-packages/PackageManager) - it's in gap_packages, I think. 


Do I understand correctly that GAP's PackageManager is for installing packages from the GAP ecosystem? What I want to do is to use some GAP code that is NOT an upstream GAP package (not even an unofficial "submitted" package).

Anyway, using some GAP infrastructure to install my files, rather than hacking paths, seems the right approach to me.



---

archive/issue_comments_401586.json:
```json
{
    "body": "I see one and a half clear disadvantages of the PackageManager:\n\nThe PackageManager is provided by the gap_packages spkg. Thus, p_group_cohomology would need yet another dependency. I'd rather avoid to add it. It should be enough to have the Small Groups library in GAP (which I think meanwhile is available without installing optional spkgs).\n\nThe \"half\" disadvantage is the GAP-typical lack of a clear documentation. The documentation of InstallPackage says that one way to install a package is to provide the URL of a valid PackageInfo.g file. But nowhere is defined (at least I couldn't find it at https://gap-packages.github.io/PackageManager/doc/chap0.html) what constitutes a \"valid\" PackageInfo.g file.\n\nIn other words, it is explained how to install a package, but it is not explained how to create a package that can be installed.\n\nDo you have pointers how to create a GAP package?",
    "created_at": "2020-10-15T20:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401586",
    "user": "https://github.com/simon-king-jena"
}
```

I see one and a half clear disadvantages of the PackageManager:

The PackageManager is provided by the gap_packages spkg. Thus, p_group_cohomology would need yet another dependency. I'd rather avoid to add it. It should be enough to have the Small Groups library in GAP (which I think meanwhile is available without installing optional spkgs).

The "half" disadvantage is the GAP-typical lack of a clear documentation. The documentation of InstallPackage says that one way to install a package is to provide the URL of a valid PackageInfo.g file. But nowhere is defined (at least I couldn't find it at https://gap-packages.github.io/PackageManager/doc/chap0.html) what constitutes a "valid" PackageInfo.g file.

In other words, it is explained how to install a package, but it is not explained how to create a package that can be installed.

Do you have pointers how to create a GAP package?



---

archive/issue_comments_401587.json:
```json
{
    "body": "PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.\n\nSo, I guess it is no option.",
    "created_at": "2020-10-15T20:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401587",
    "user": "https://github.com/simon-king-jena"
}
```

PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.

So, I guess it is no option.



---

archive/issue_comments_401588.json:
```json
{
    "body": "I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.\n\nWHAT NEEDS TO BE AVAILABLE:\n- A couple of .g files, containing function definitions.\n\nCURRENT APPROACH:\n- Install the files into $SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/\n- Let setup.py do the installation\n\nCURRENT PROBLEM:\n- As reported on #30349, Sage totally messes up the path. Note that I have never seen that problem, myself.\n- It is argued that installation of the .g files should be done in spkg-install, not in setup.py.\n\nALTERNATIVE APPROACH:\n- Put the files somewhere else, such as $SAGE_LOCAL/share/gap/pkg/\n- Let spkg-install do the installation, perhaps via some GAP tool\n\nPROBLEM WITH THE ALTERNATIVE APPROACH:\n- I don't consider the couple of .g files a \"package\" for GAP.\n- Potential GAP tools seem to be not part of the gap_packages spkg. Thus, aren't readily available in Sage.\n\nSo, I believe the current approach is just fine: We need a place for some GAP readable files, that logically belong to a Sage package (p_group_cohomology) but can hardly be seen a stand-alone GAP package. Thus, some place in $SAGE_LOCAL/share/sage/ext/gap seems just right to me.\n\nOnly we need to understand why, according to #30349, Sage puts stuff into $SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/, although setup.py clearly states, `data_files=[(os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")`.",
    "created_at": "2020-10-15T21:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401588",
    "user": "https://github.com/simon-king-jena"
}
```

I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.

WHAT NEEDS TO BE AVAILABLE:
- A couple of .g files, containing function definitions.

CURRENT APPROACH:
- Install the files into $SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/
- Let setup.py do the installation

CURRENT PROBLEM:
- As reported on #30349, Sage totally messes up the path. Note that I have never seen that problem, myself.
- It is argued that installation of the .g files should be done in spkg-install, not in setup.py.

ALTERNATIVE APPROACH:
- Put the files somewhere else, such as $SAGE_LOCAL/share/gap/pkg/
- Let spkg-install do the installation, perhaps via some GAP tool

PROBLEM WITH THE ALTERNATIVE APPROACH:
- I don't consider the couple of .g files a "package" for GAP.
- Potential GAP tools seem to be not part of the gap_packages spkg. Thus, aren't readily available in Sage.

So, I believe the current approach is just fine: We need a place for some GAP readable files, that logically belong to a Sage package (p_group_cohomology) but can hardly be seen a stand-alone GAP package. Thus, some place in $SAGE_LOCAL/share/sage/ext/gap seems just right to me.

Only we need to understand why, according to #30349, Sage puts stuff into $SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/, although setup.py clearly states, `data_files=[(os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")`.



---

archive/issue_comments_401589.json:
```json
{
    "body": "AHA! Can it be that $SAGE_LOCAL/share/sage has been removed?\n\n```\nsage: 'sage' in os.listdir(os.path.join(SAGE_LOCAL,\"share\"))                                                       \nFalse\nsage: 'gap' in os.listdir(os.path.join(SAGE_LOCAL,\"share\"))                                                        \nTrue\n```\n\nThen of course a different location is needed. In that case, os.listdir(os.path.join(SAGE_LOCAL,\"share\",\"gap\",\"pkg\",\"p_group_cohomology\")) seems good to me.\n\nEDIT: Since it isn't really a GAP package, os.listdir(os.path.join(SAGE_LOCAL,\"share\",\"p_group_cohomology\")) seems better!",
    "created_at": "2020-10-15T21:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401589",
    "user": "https://github.com/simon-king-jena"
}
```

AHA! Can it be that $SAGE_LOCAL/share/sage has been removed?

```
sage: 'sage' in os.listdir(os.path.join(SAGE_LOCAL,"share"))                                                       
False
sage: 'gap' in os.listdir(os.path.join(SAGE_LOCAL,"share"))                                                        
True
```

Then of course a different location is needed. In that case, os.listdir(os.path.join(SAGE_LOCAL,"share","gap","pkg","p_group_cohomology")) seems good to me.

EDIT: Since it isn't really a GAP package, os.listdir(os.path.join(SAGE_LOCAL,"share","p_group_cohomology")) seems better!



---

archive/issue_comments_401590.json:
```json
{
    "body": "Replying to [comment:20 SimonKing]:\n> I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.\n> \n> WHAT NEEDS TO BE AVAILABLE:\n> - A couple of .g files, containing function definitions.\n\n\nI think such data files should just be installed next to the python files of the package.\nJust like `src/sage/interfaces/sage-maxima.lisp`",
    "created_at": "2020-10-15T21:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401590",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:20 SimonKing]:
> I am unhappy, because I don't see a good solution for the installation problems of the GAP parts of the spkg.
> 
> WHAT NEEDS TO BE AVAILABLE:
> - A couple of .g files, containing function definitions.


I think such data files should just be installed next to the python files of the package.
Just like `src/sage/interfaces/sage-maxima.lisp`



---

archive/issue_comments_401591.json:
```json
{
    "body": "It should definitely not depend on the environment variable `SAGE_LOCAL` at all.\nBackground: pip-installable packages should be installable into various virtual environments.",
    "created_at": "2020-10-15T22:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401591",
    "user": "https://github.com/mkoeppe"
}
```

It should definitely not depend on the environment variable `SAGE_LOCAL` at all.
Background: pip-installable packages should be installable into various virtual environments.



---

archive/issue_comments_401592.json:
```json
{
    "body": "Replying to [comment:22 mkoeppe]:\n> I think such data files should just be installed next to the python files of the package.\n> Just like `src/sage/interfaces/sage-maxima.lisp`\n\n\nDoes it mean you suggest that the python and cython files be moved into the sage src library?",
    "created_at": "2020-10-15T22:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401592",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:22 mkoeppe]:
> I think such data files should just be installed next to the python files of the package.
> Just like `src/sage/interfaces/sage-maxima.lisp`


Does it mean you suggest that the python and cython files be moved into the sage src library?



---

archive/issue_comments_401593.json:
```json
{
    "body": "Replying to [comment:23 mkoeppe]:\n> It should definitely not depend on the environment variable `SAGE_LOCAL` at all.\n> Background: pip-installable packages should be installable into various virtual environments. \n\n\nI don't understand that. Do you say that a fixed Sage installation has no fixed paths relative to SAGE_ROOT? Then how can any spkg tell where stuff ought to be installed?\n\nDoes it also mean I cannot keep the cohomology ring data base in its current location?",
    "created_at": "2020-10-15T22:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401593",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:23 mkoeppe]:
> It should definitely not depend on the environment variable `SAGE_LOCAL` at all.
> Background: pip-installable packages should be installable into various virtual environments. 


I don't understand that. Do you say that a fixed Sage installation has no fixed paths relative to SAGE_ROOT? Then how can any spkg tell where stuff ought to be installed?

Does it also mean I cannot keep the cohomology ring data base in its current location?



---

archive/issue_comments_401594.json:
```json
{
    "body": "Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.\nIn Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.",
    "created_at": "2020-10-15T22:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401594",
    "user": "https://github.com/mkoeppe"
}
```

Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.
In Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.



---

archive/issue_comments_401595.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.\n> In Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.\n\n\nArgh. Sounds like a lot of work.\n\nProblems:\n- Where to install the data base? It used to be put into SAGE_SHARE. Is it still fine?\n- Do we put the Python and Cython files into SAGE_SRC? Then:\n  - Is it really ok to have a Python file float around that cannot be imported unless some optional package is installed?\n  - Can one build the documentation of optional Cython extension modules?\n  - Can one make all doc tests optional without adding \"#optional: p_group_cohomology\" into each line?",
    "created_at": "2020-10-15T22:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401595",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:26 mkoeppe]:
> Non-Python packages will continue to be installed into SAGE_LOCAL (which defaults to SAGE_ROOT/local but can be configured differently already now) by the Sage distribution.
> In Sage 9.3, users will have more flexibility where Python packages such as sagelib are installed.


Argh. Sounds like a lot of work.

Problems:
- Where to install the data base? It used to be put into SAGE_SHARE. Is it still fine?
- Do we put the Python and Cython files into SAGE_SRC? Then:
  - Is it really ok to have a Python file float around that cannot be imported unless some optional package is installed?
  - Can one build the documentation of optional Cython extension modules?
  - Can one make all doc tests optional without adding "#optional: p_group_cohomology" into each line?



---

archive/issue_comments_401596.json:
```json
{
    "body": "Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.",
    "created_at": "2020-10-16T00:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401596",
    "user": "https://github.com/mkoeppe"
}
```

Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.



---

archive/issue_comments_401597.json:
```json
{
    "body": "On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. \n\nI assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?",
    "created_at": "2020-10-16T05:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401597",
    "user": "https://github.com/mkoeppe"
}
```

On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. 

I assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?



---

archive/issue_comments_401598.json:
```json
{
    "body": "Replying to [comment:29 mkoeppe]:\n> On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. \n\n\nThe problem I have with that depends on the definition of \"can\", when you say it \"can\" independently be used. I believe splitting `modular_resolution` off makes no sense. If one uses `modular_resolution`, one would also use `p_group_cohomology`-\n\n> I assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?\n\n\nWrong. The C library, that I inherited from David Green, makes intense use of meataxe, and is the only reason why I added meataxe as an optional spkg.",
    "created_at": "2020-10-16T06:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401598",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:29 mkoeppe]:
> On the Sage packaging side, a package `modular_resolution` should probably be split out from the package `p_group_cohomology` and become a dependency. 


The problem I have with that depends on the definition of "can", when you say it "can" independently be used. I believe splitting `modular_resolution` off makes no sense. If one uses `modular_resolution`, one would also use `p_group_cohomology`-

> I assume that only the !Python/Cython part of `p_group_cohomology`, not the C library, depends on `meataxe`?


Wrong. The C library, that I inherited from David Green, makes intense use of meataxe, and is the only reason why I added meataxe as an optional spkg.



---

archive/issue_comments_401599.json:
```json
{
    "body": "Replying to [comment:28 mkoeppe]:\n> Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.\n\n\nThat's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.\n\nThe only question is where to install the data base, and where/how to install the .g files.\n\nConcerning the data base: Currently the data base is installed when installing the C library `libmodres`. Requirements: It must be a location that is readable for all users of Sage; write permission is only needed during package installation. So, what I currently do in Makefile.am, namely\n\n```\ndbdir           = $(datadir)/pGroupCohomology\ndist_db_DATA    = group_cohomology_database.tar\ninstall-data-hook:\n        cd $(DESTDIR)$(dbdir) && tar xf $(dist_db_DATA) && rm $(dist_db_DATA)\n\nuninstall-hook:\n        rm -r $(DESTDIR)$(dbdir)\n```\nshould be the right thing to do, shouldn't it??\n\nConcerning the .g files: If I understand correctly, many GAP packages are installed by just unpacking a .tar.gz into GAP's pkg/ folder. So, I could imagine to create a mock GAP package `pGroupCohomologyHelpers` (\"Helpers\" meaning that the package is not supposed to be of any use on its own), by creating a folder `/pGroupCohomologyHelpers` in GAP's `pkg/` folder, which contains a file `init.g`, that in turn reads the code from my current .g files (that perhaps should be renamed as .gap files).\n\nThen, one could just do libgap.LoadPackage(\"pGroupCohomologyHelpers\"), without the trouble to explicitly referring to the SAGE_LOCAL variable at run time.\n\nThe question is: How to locate GAP's `pkg/` folder at installation time, without messing around with SAGE_LOCAL? How can I make GAP reveal the location, using a shell command, so that spkg-install can install the .g files?",
    "created_at": "2020-10-16T08:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401599",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:28 mkoeppe]:
> Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.


That's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.

The only question is where to install the data base, and where/how to install the .g files.

Concerning the data base: Currently the data base is installed when installing the C library `libmodres`. Requirements: It must be a location that is readable for all users of Sage; write permission is only needed during package installation. So, what I currently do in Makefile.am, namely

```
dbdir           = $(datadir)/pGroupCohomology
dist_db_DATA    = group_cohomology_database.tar
install-data-hook:
        cd $(DESTDIR)$(dbdir) && tar xf $(dist_db_DATA) && rm $(dist_db_DATA)

uninstall-hook:
        rm -r $(DESTDIR)$(dbdir)
```
should be the right thing to do, shouldn't it??

Concerning the .g files: If I understand correctly, many GAP packages are installed by just unpacking a .tar.gz into GAP's pkg/ folder. So, I could imagine to create a mock GAP package `pGroupCohomologyHelpers` ("Helpers" meaning that the package is not supposed to be of any use on its own), by creating a folder `/pGroupCohomologyHelpers` in GAP's `pkg/` folder, which contains a file `init.g`, that in turn reads the code from my current .g files (that perhaps should be renamed as .gap files).

Then, one could just do libgap.LoadPackage("pGroupCohomologyHelpers"), without the trouble to explicitly referring to the SAGE_LOCAL variable at run time.

The question is: How to locate GAP's `pkg/` folder at installation time, without messing around with SAGE_LOCAL? How can I make GAP reveal the location, using a shell command, so that spkg-install can install the .g files?



---

archive/issue_comments_401600.json:
```json
{
    "body": "I changed the ticket description. Do you agree that it correctly reflects the discussion so far?\n\nIf I see that correctly, only two real issues remain: How to determine GAP's pkg folder during installation? How to install the documentation after building it?",
    "created_at": "2020-10-16T10:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401600",
    "user": "https://github.com/simon-king-jena"
}
```

I changed the ticket description. Do you agree that it correctly reflects the discussion so far?

If I see that correctly, only two real issues remain: How to determine GAP's pkg folder during installation? How to install the documentation after building it?



---

archive/issue_comments_401601.json:
```json
{
    "body": "Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?\n\nIf so, then I think the two issues actually boil down to a single question: What syntax to use for sdh_install to let spkg-install put stuff in a sub-folder of DESTDIR?",
    "created_at": "2020-10-16T11:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401601",
    "user": "https://github.com/simon-king-jena"
}
```

Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?

If so, then I think the two issues actually boil down to a single question: What syntax to use for sdh_install to let spkg-install put stuff in a sub-folder of DESTDIR?



---

archive/issue_comments_401602.json:
```json
{
    "body": "Replying to [comment:19 SimonKing]:\n> PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.\n> \n> So, I guess it is no option.\n\n\noops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although \nnow I see I didn't include it in #29314 - although it can be done. \n\nUnfortunately #29314 is  getting stuck on Volker's buildbot, only him seems to be able to debug the problem :-(",
    "created_at": "2020-10-16T11:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401602",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:19 SimonKing]:
> PS: I just installed the gap_package spkg, but apparently it does not provide the PackageManager.
> 
> So, I guess it is no option.


oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although 
now I see I didn't include it in #29314 - although it can be done. 

Unfortunately #29314 is  getting stuck on Volker's buildbot, only him seems to be able to debug the problem :-(



---

archive/issue_comments_401603.json:
```json
{
    "body": "Replying to [comment:34 dimpase]:\n> oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although \n> now I see I didn't include it in #29314 - although it can be done. \n\n\nEven if the package manager could be included, I think one should try to not make it a dependency.\n\n*If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager. sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.",
    "created_at": "2020-10-16T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401603",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:34 dimpase]:
> oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although 
> now I see I didn't include it in #29314 - although it can be done. 


Even if the package manager could be included, I think one should try to not make it a dependency.

*If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager. sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.



---

archive/issue_comments_401604.json:
```json
{
    "body": "Replying to [comment:35 SimonKing]:\n> Replying to [comment:34 dimpase]:\n> > oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although \n> > now I see I didn't include it in #29314 - although it can be done. \n\n> \n> Even if the package manager could be included, I think one should try to not make it a dependency.\n> \n> *If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, \n\n\nif you don't do this then you'd need to use GAP's `Read()` rather than `LoadPackage()` to load the\nGAP files, and then you'd need to use the full path to the files.\n\nOne can try using https://github.com/gap-system/PackageMaker to generate the needed for a package boilerplate.\n\n\n\n> and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager.\n\n\nwe can put `PackageManager` into `gap` rather than `gap_packages`, then it won't be a dependency.\n\n\n> sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.\n\nsee its source with comments in \n`build/bin/sage-dist-helpers`\n\n(that's all the docs there are, ATM, I think)",
    "created_at": "2020-10-16T12:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401604",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:35 SimonKing]:
> Replying to [comment:34 dimpase]:
> > oops, it's not in the current GAP 4.10 bundled with Sage, but it is in GAP 4.11 (#29314) - although 
> > now I see I didn't include it in #29314 - although it can be done. 

> 
> Even if the package manager could be included, I think one should try to not make it a dependency.
> 
> *If* we agree that creating a !pGroupCohomologyHelpers module for GAP, being put into GAP's pkg/ folder, is a clean solution, 


if you don't do this then you'd need to use GAP's `Read()` rather than `LoadPackage()` to load the
GAP files, and then you'd need to use the full path to the files.

One can try using https://github.com/gap-system/PackageMaker to generate the needed for a package boilerplate.



> and *if* ((GAP is able to tell the pkg/ folder's path) or (DESTDIR/share/gap/pkg is safe to use)), then we don't need GAP's package manager.


we can put `PackageManager` into `gap` rather than `gap_packages`, then it won't be a dependency.


> sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.

see its source with comments in 
`build/bin/sage-dist-helpers`

(that's all the docs there are, ATM, I think)



---

archive/issue_comments_401605.json:
```json
{
    "body": "I played a bit with GAP's PackageMaker, it produced the following:\n\nhttps://github.com/dimpase/p_group_cohomology_helper\n\n(this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.",
    "created_at": "2020-10-16T13:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401605",
    "user": "https://github.com/dimpase"
}
```

I played a bit with GAP's PackageMaker, it produced the following:

https://github.com/dimpase/p_group_cohomology_helper

(this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.



---

archive/issue_comments_401606.json:
```json
{
    "body": "Replying to [comment:37 dimpase]:\n> I played a bit with GAP's PackageMaker, it produced the following:\n> \n> https://github.com/dimpase/p_group_cohomology_helper\n> \n> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.\n\n\nThank you!\n\nIt sounds like a lot of work to change the current code in the required format for a package.\n\nI wonder what functions I'd need to declare as global functions. Currently, the code is split into several .g files: GapMaxels.g, GapMB.g, GapSgs.g. Suppose a function from GapMaxels is used in GapMB: Do I need to declare such function as global? And if a function from GapMB is used in another function of GapMB: Do I need to declare such function as global?\n\nIs it really needed to make a full package (even if it is boiler plate)? My hope was that I can keep it simpler and that I wouldn't need to write separate documentation for David Green's GAP code.\n\nEDIT: I cloned your github repository.",
    "created_at": "2020-10-16T13:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401606",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:37 dimpase]:
> I played a bit with GAP's PackageMaker, it produced the following:
> 
> https://github.com/dimpase/p_group_cohomology_helper
> 
> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.


Thank you!

It sounds like a lot of work to change the current code in the required format for a package.

I wonder what functions I'd need to declare as global functions. Currently, the code is split into several .g files: GapMaxels.g, GapMB.g, GapSgs.g. Suppose a function from GapMaxels is used in GapMB: Do I need to declare such function as global? And if a function from GapMB is used in another function of GapMB: Do I need to declare such function as global?

Is it really needed to make a full package (even if it is boiler plate)? My hope was that I can keep it simpler and that I wouldn't need to write separate documentation for David Green's GAP code.

EDIT: I cloned your github repository.



---

archive/issue_comments_401607.json:
```json
{
    "body": "Replying to [comment:36 dimpase]:\n> > sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.\n\n> see its source with comments in \n> `build/bin/sage-dist-helpers`\n> \n> (that's all the docs there are, ATM, I think)\n\n\nIt says\n\n```\n# - sdh_install [-T] SRC [SRC...] DEST\n#\n#    Copies one or more files or directories given as SRC (recursively in the\n#    case of directories) into the destination directory DEST, while ensuring\n#    that DEST and all its parent directories exist.  DEST should be a path\n#    under $SAGE_LOCAL, generally.  For DESTDIR installs the $SAGE_DESTDIR path\n#    is automatically prepended to the destination.\n#\n#    The -T option treats DEST as a normal file instead (e.g. for copying a\n#    file to a different filename).  All directory components are still created\n#    in this case.\n```\n\nDoes it mean that when one provide a path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path??? It seems this is the exactly how the install path of my GAP files got messed up as reported in #30349!! I'll add a comment there.",
    "created_at": "2020-10-16T13:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401607",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:36 dimpase]:
> > sdh_install (as soon as someone gives me a pointer to its documentation) would be enough.

> see its source with comments in 
> `build/bin/sage-dist-helpers`
> 
> (that's all the docs there are, ATM, I think)


It says

```
# - sdh_install [-T] SRC [SRC...] DEST
#
#    Copies one or more files or directories given as SRC (recursively in the
#    case of directories) into the destination directory DEST, while ensuring
#    that DEST and all its parent directories exist.  DEST should be a path
#    under $SAGE_LOCAL, generally.  For DESTDIR installs the $SAGE_DESTDIR path
#    is automatically prepended to the destination.
#
#    The -T option treats DEST as a normal file instead (e.g. for copying a
#    file to a different filename).  All directory components are still created
#    in this case.
```

Does it mean that when one provide a path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path??? It seems this is the exactly how the install path of my GAP files got messed up as reported in #30349!! I'll add a comment there.



---

archive/issue_comments_401608.json:
```json
{
    "body": "I'm away from keyboard until late pm. I guess it should not be hard to wrap this up as a hotfix, though",
    "created_at": "2020-10-16T14:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401608",
    "user": "https://github.com/dimpase"
}
```

I'm away from keyboard until late pm. I guess it should not be hard to wrap this up as a hotfix, though



---

archive/issue_comments_401609.json:
```json
{
    "body": "Replying to [comment:37 dimpase]:\n> I played a bit with GAP's PackageMaker, it produced the following:\n> \n> https://github.com/dimpase/p_group_cohomology_helper\n> \n> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.\n\n\nI have created a fork and made the package actually usable. See https://github.com/simon-king-jena/p_group_cohomology_helper",
    "created_at": "2020-10-16T16:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401609",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:37 dimpase]:
> I played a bit with GAP's PackageMaker, it produced the following:
> 
> https://github.com/dimpase/p_group_cohomology_helper
> 
> (this is just a boilerplate with your address etc, no actual GAP code added). Hope this helps.


I have created a fork and made the package actually usable. See https://github.com/simon-king-jena/p_group_cohomology_helper



---

archive/issue_comments_401610.json:
```json
{
    "body": "FYI: there is some documentation on `sdh_install` and related functions in the Developer's Guide: https://doc.sagemath.org/html/en/developer/packaging.html#helper-functions. It's the same as in `build/bin/sage-dist-helpers`, but at least the documentation is public.",
    "created_at": "2020-10-16T16:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401610",
    "user": "https://github.com/jhpalmieri"
}
```

FYI: there is some documentation on `sdh_install` and related functions in the Developer's Guide: https://doc.sagemath.org/html/en/developer/packaging.html#helper-functions. It's the same as in `build/bin/sage-dist-helpers`, but at least the documentation is public.



---

archive/issue_comments_401611.json:
```json
{
    "body": "In spkg-install, I currently have\n\n```\n# building modular_resolution\ncd `ls -d modular_resolution*`\nsdh_configure || sdh_die \"Error configuring modular_resolution\"\nsdh_make || sdh_die \"Error making modular_resolution\"\n# sdh_make install got broken by trac ticket #24106\n$MAKE install || sdh_die \"Error installing modular_resolution\"\ncd ..\n```\n\nHas sdh_make_install been fixed? Is it enough to just do\n\n```\n# build and install modular_resolution\ncd `ls -d modular_resolution*`\nsdh_configure || sdh_die \"Error configuring modular_resolution\"\nsdh_make_install || sdh_die \"Error making modular_resolution\"\ncd ..\n```\n?",
    "created_at": "2020-10-16T16:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401611",
    "user": "https://github.com/simon-king-jena"
}
```

In spkg-install, I currently have

```
# building modular_resolution
cd `ls -d modular_resolution*`
sdh_configure || sdh_die "Error configuring modular_resolution"
sdh_make || sdh_die "Error making modular_resolution"
# sdh_make install got broken by trac ticket #24106
$MAKE install || sdh_die "Error installing modular_resolution"
cd ..
```

Has sdh_make_install been fixed? Is it enough to just do

```
# build and install modular_resolution
cd `ls -d modular_resolution*`
sdh_configure || sdh_die "Error configuring modular_resolution"
sdh_make_install || sdh_die "Error making modular_resolution"
cd ..
```
?



---

archive/issue_comments_401612.json:
```json
{
    "body": "I don't know your answer about `sdh_make_install`, but the code could just read\n\n```\ncd ...\nsdh_configure\nsdh_make_install # assuming this works\n```\n`sdh_die` is called automatically by the other helper functions, so you don't need to call it yourself.\n\nRe #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.",
    "created_at": "2020-10-16T17:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401612",
    "user": "https://github.com/jhpalmieri"
}
```

I don't know your answer about `sdh_make_install`, but the code could just read

```
cd ...
sdh_configure
sdh_make_install # assuming this works
```
`sdh_die` is called automatically by the other helper functions, so you don't need to call it yourself.

Re #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.



---

archive/issue_comments_401613.json:
```json
{
    "body": "Replying to [comment:39 SimonKing]:\n> Does it mean that when one provide a path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?\n\n\nYes, that's how the staged install works.",
    "created_at": "2020-10-16T17:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401613",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:39 SimonKing]:
> Does it mean that when one provide a path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?


Yes, that's how the staged install works.



---

archive/issue_comments_401614.json:
```json
{
    "body": "Replying to [comment:45 mkoeppe]:\n> Replying to [comment:39 SimonKing]:\n> > Does it mean that when one provide a path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?\n\n> \n> Yes, that's how the staged install works.\n\n\nSo, you say that MOST spkgs are currently broken, because they have all things like this in spkg-install?\n\n```\nsdh_install doc/ref doc/tut \"$SAGE_SHARE/doc/gap/\"\nsdh_install -T src \"${SAGE_SHARE}/jmol\"\n```\nJust grep for SAGE_SHARE or SAGE_LOCAL in `$SAGE_ROOT/build/pkgs`.",
    "created_at": "2020-10-16T18:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401614",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:45 mkoeppe]:
> Replying to [comment:39 SimonKing]:
> > Does it mean that when one provide a path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` in setup.py, then $SAGE_DESTDIR would be prepended to this ABSOLUTE path?

> 
> Yes, that's how the staged install works.


So, you say that MOST spkgs are currently broken, because they have all things like this in spkg-install?

```
sdh_install doc/ref doc/tut "$SAGE_SHARE/doc/gap/"
sdh_install -T src "${SAGE_SHARE}/jmol"
```
Just grep for SAGE_SHARE or SAGE_LOCAL in `$SAGE_ROOT/build/pkgs`.



---

archive/issue_comments_401615.json:
```json
{
    "body": "It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.\n\nSince #29152 may soon be reviewed (and fixes something with meataxe), it could make sense to replace #30151 by #29152 as a dependency. But not STRICTLY needed, IMHO.",
    "created_at": "2020-10-16T18:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401615",
    "user": "https://github.com/simon-king-jena"
}
```

It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.

Since #29152 may soon be reviewed (and fixes something with meataxe), it could make sense to replace #30151 by #29152 as a dependency. But not STRICTLY needed, IMHO.



---

archive/issue_comments_401616.json:
```json
{
    "body": "Replying to [comment:46 SimonKing]:\n> So, you say that MOST spkgs are currently broken\n\n\nNo. `sdh_install` works. It installs into `SAGE_DESTDIR` and then `sage-spkg` copies from there to the actual install directory.",
    "created_at": "2020-10-16T18:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401616",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:46 SimonKing]:
> So, you say that MOST spkgs are currently broken


No. `sdh_install` works. It installs into `SAGE_DESTDIR` and then `sage-spkg` copies from there to the actual install directory.



---

archive/issue_comments_401617.json:
```json
{
    "body": "Replying to [comment:47 SimonKing]:\n> It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.\n\n\nWithout #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.",
    "created_at": "2020-10-16T18:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401617",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:47 SimonKing]:
> It seems to me that #30151 will not be available soon. So, in order to fix spkg-install of p_group_cohomology SOON, I suggest to remove this dependency.


Without #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.



---

archive/issue_comments_401618.json:
```json
{
    "body": "Replying to [comment:33 SimonKing]:\n> Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?\n\n\nNo. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.",
    "created_at": "2020-10-16T18:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401618",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:33 SimonKing]:
> Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?


No. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.



---

archive/issue_comments_401619.json:
```json
{
    "body": "(deleted)",
    "created_at": "2020-10-16T18:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401619",
    "user": "https://github.com/mkoeppe"
}
```

(deleted)



---

archive/issue_comments_401620.json:
```json
{
    "body": "Replying to [comment:31 SimonKing]:\n> Replying to [comment:28 mkoeppe]:\n> > Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.\n\n> \n> That's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.\n\n\nYes, but it should be separate package - whose spkg-install only contains `sdh_pip_install` and nothing else",
    "created_at": "2020-10-16T18:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401620",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:31 SimonKing]:
> Replying to [comment:28 mkoeppe]:
> > Actually there is nothing wrong with keeping the Python/Cython part of your package separate from the Sage source tree. It should just be made sure that it is pip-installable into an arbitrary Python environment and does not try to use SAGE_LOCAL or SAGE_SHARE to determine installation locations.

> 
> That's what currently is the case. As you can see from spkg-install, installation of stuff is using pip.


Yes, but it should be separate package - whose spkg-install only contains `sdh_pip_install` and nothing else



---

archive/issue_comments_401621.json:
```json
{
    "body": "Replying to [comment:49 mkoeppe]: \n> Without #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.\n\n\nHow is the following broken?\n\n```\n# Check if meataxe was properly installed\nsage -c \"import sage.libs.meataxe\" || sdh_die \"sage.libs.meataxe cannot be imported. To solve this, it is enough to retry installation of p_group_cohomology\"\n```",
    "created_at": "2020-10-16T18:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401621",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:49 mkoeppe]: 
> Without #30151, there is no non-broken way to make sure that the optional extension depending on meataxe is already installed.


How is the following broken?

```
# Check if meataxe was properly installed
sage -c "import sage.libs.meataxe" || sdh_die "sage.libs.meataxe cannot be imported. To solve this, it is enough to retry installation of p_group_cohomology"
```



---

archive/issue_comments_401622.json:
```json
{
    "body": "It is broken because it is not reflected in the declared `dependencies` of the package.",
    "created_at": "2020-10-16T18:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401622",
    "user": "https://github.com/mkoeppe"
}
```

It is broken because it is not reflected in the declared `dependencies` of the package.



---

archive/issue_comments_401623.json:
```json
{
    "body": "Thus, it is not possible to install it robustly using `./configure --enable-meataxe --enable-p_group_cohomology && make`",
    "created_at": "2020-10-16T18:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401623",
    "user": "https://github.com/mkoeppe"
}
```

Thus, it is not possible to install it robustly using `./configure --enable-meataxe --enable-p_group_cohomology && make`



---

archive/issue_comments_401624.json:
```json
{
    "body": "Replying to [comment:50 mkoeppe]:\n> Replying to [comment:33 SimonKing]:\n> > Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?\n\n> \n> No. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.\n\n\nWhat do you mean by \"the C library package\"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.\n\nAnyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `\"$SAGE_SHARE/singular/LIB/\"` or `\"$SAGE_SHARE/gap/pkg/\"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.",
    "created_at": "2020-10-16T18:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401624",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:50 mkoeppe]:
> Replying to [comment:33 SimonKing]:
> > Is it safe to assume that GAP's pkg folder lies in DESTDIR/share/gap/pkg/?

> 
> No. The C library package should either have a configure option for the gap install directory, or should discover it from a gap executable in PATH.


What do you mean by "the C library package"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.

Anyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `"$SAGE_SHARE/singular/LIB/"` or `"$SAGE_SHARE/gap/pkg/"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.



---

archive/issue_comments_401625.json:
```json
{
    "body": "Replying to [comment:54 mkoeppe]:\n> It is broken because it is not reflected in the declared `dependencies` of the package.\n\n\nRight. But waiting for #30151 means that for a potentially long time, p_group_cohomology will not install. When we keep the current check for meataxe, it may be broken, but it will build.",
    "created_at": "2020-10-16T18:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401625",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:54 mkoeppe]:
> It is broken because it is not reflected in the declared `dependencies` of the package.


Right. But waiting for #30151 means that for a potentially long time, p_group_cohomology will not install. When we keep the current check for meataxe, it may be broken, but it will build.



---

archive/issue_comments_401626.json:
```json
{
    "body": "Replying to [comment:56 SimonKing]:\n> What do you mean by \"the C library package\"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.\n\n\nOK, thanks for the clarification. I retract this particular suggestion then.\n\n> Anyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `\"$SAGE_SHARE/singular/LIB/\"` or `\"$SAGE_SHARE/gap/pkg/\"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.\n\n\nThis is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).",
    "created_at": "2020-10-16T19:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401626",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:56 SimonKing]:
> What do you mean by "the C library package"? If you mean modular_resolution: This has never been related with installation of the GAP part of the package.


OK, thanks for the clarification. I retract this particular suggestion then.

> Anyway. In the branch that I am currently testing (not posted yet), it is the job of spkg-install to put the Singular and GAP helpers into the right places, `"$SAGE_SHARE/singular/LIB/"` or `"$SAGE_SHARE/gap/pkg/"`, using sdh_install. I'll see if this works for me, then post it here, and then you can tell if that's fine.


This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).



---

archive/issue_comments_401627.json:
```json
{
    "body": "Something else is broken: Trying to install, I get\n\n```\n[p_group_cohomology-3.3.2]   creating build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology\n[p_group_cohomology-3.3.2]   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/cpython -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/cysignals -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/ext -I/usr/include/python3.7m -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/numpy/core/include -I/home/king/Sage/git/py3/local/include -I/usr/include/python3.7m -c build/c_files-3.7/pGroupCohomology/resolution.c -o build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology/resolution.o\n[p_group_cohomology-3.3.2]   build/c_files-3.7/pGroupCohomology/resolution.c:644:39: fatal error: modular_resolution/pgroup.h: No such file or directory\n[p_group_cohomology-3.3.2]   compilation terminated.\n[p_group_cohomology-3.3.2]   error: command 'gcc' failed with exit status 1\n[p_group_cohomology-3.3.2]   Building wheel for pGroupCohomology (setup.py): finished with status 'error'\n[p_group_cohomology-3.3.2]   ERROR: Failed building wheel for pGroupCohomology\n[p_group_cohomology-3.3.2]   Running setup.py clean for pGroupCohomology\n[p_group_cohomology-3.3.2]   Running command /home/king/Sage/git/py3/local/bin/python3 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/tmp/pip-req-build-vx2ktc1p/setup.py'\"'\"'; __file__='\"'\"'/tmp/pip-req-build-vx2ktc1p/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' clean --all\n[p_group_cohomology-3.3.2]   running clean\n```\nWhy the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.",
    "created_at": "2020-10-16T19:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401627",
    "user": "https://github.com/simon-king-jena"
}
```

Something else is broken: Trying to install, I get

```
[p_group_cohomology-3.3.2]   creating build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology
[p_group_cohomology-3.3.2]   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/cpython -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/cysignals -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/ext -I/usr/include/python3.7m -I/home/king/Sage/git/py3/local/lib/python3.7/site-packages/numpy/core/include -I/home/king/Sage/git/py3/local/include -I/usr/include/python3.7m -c build/c_files-3.7/pGroupCohomology/resolution.c -o build/temp.linux-x86_64-3.7/build/c_files-3.7/pGroupCohomology/resolution.o
[p_group_cohomology-3.3.2]   build/c_files-3.7/pGroupCohomology/resolution.c:644:39: fatal error: modular_resolution/pgroup.h: No such file or directory
[p_group_cohomology-3.3.2]   compilation terminated.
[p_group_cohomology-3.3.2]   error: command 'gcc' failed with exit status 1
[p_group_cohomology-3.3.2]   Building wheel for pGroupCohomology (setup.py): finished with status 'error'
[p_group_cohomology-3.3.2]   ERROR: Failed building wheel for pGroupCohomology
[p_group_cohomology-3.3.2]   Running setup.py clean for pGroupCohomology
[p_group_cohomology-3.3.2]   Running command /home/king/Sage/git/py3/local/bin/python3 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/tmp/pip-req-build-vx2ktc1p/setup.py'"'"'; __file__='"'"'/tmp/pip-req-build-vx2ktc1p/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' clean --all
[p_group_cohomology-3.3.2]   running clean
```
Why the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.



---

archive/issue_comments_401628.json:
```json
{
    "body": "Replying to [comment:58 mkoeppe]:\n> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\n\nWhat about C libraries? What about additional files needed to make a pip-installable python package work?",
    "created_at": "2020-10-16T19:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401628",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:58 mkoeppe]:
> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).


What about C libraries? What about additional files needed to make a pip-installable python package work?



---

archive/issue_comments_401629.json:
```json
{
    "body": "Replying to [comment:60 SimonKing]:\n> Replying to [comment:58 mkoeppe]:\n> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\n> \n> What about C libraries? What about additional files needed to make a pip-installable python package work?\n\n\nAnything that `setup.py` builds, including extension modules, is fine.\n\nStandalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.",
    "created_at": "2020-10-16T19:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401629",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:60 SimonKing]:
> Replying to [comment:58 mkoeppe]:
> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).

> 
> What about C libraries? What about additional files needed to make a pip-installable python package work?


Anything that `setup.py` builds, including extension modules, is fine.

Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.



---

archive/issue_comments_401630.json:
```json
{
    "body": "Replying to [comment:59 SimonKing]:\n> Why the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.\n\n\nThis is (I guess) the moment when pgroup.h is supposed to be installed:\n\n```\n[p_group_cohomology-3.3.2]  /usr/bin/install -c -m 644 fileplus.h fp_decls.h modular_resolution.h pgroup.h pgroup_decls.h nDiag.h urbild_decls.h nBuchberger_decls.h pcommon.h slice_decls.h '/home/king/Sage/git/py3/local/var/tmp/sage/build/p_group_cohomology-3.3.2/inst/home/king/Sage/git/py3/local/include/modular_resolution'\n```\n\nI guess it again is a staged process. But why stuff isn't moved to its final destination? modular_resolution uses an autotoolised build system, so, why is \n\n```\nsdh_configure || sdh_die \"Error configuring modular_resolution\"\nsdh_make_install || sdh_die \"Error making modular_resolution\"\n```\nnot working any more?",
    "created_at": "2020-10-16T19:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401630",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:59 SimonKing]:
> Why the hack is `pgrou.h` not found? It is supposed to be installed by making modular_resolution, which has worked and hasn't changed since a long time.


This is (I guess) the moment when pgroup.h is supposed to be installed:

```
[p_group_cohomology-3.3.2]  /usr/bin/install -c -m 644 fileplus.h fp_decls.h modular_resolution.h pgroup.h pgroup_decls.h nDiag.h urbild_decls.h nBuchberger_decls.h pcommon.h slice_decls.h '/home/king/Sage/git/py3/local/var/tmp/sage/build/p_group_cohomology-3.3.2/inst/home/king/Sage/git/py3/local/include/modular_resolution'
```

I guess it again is a staged process. But why stuff isn't moved to its final destination? modular_resolution uses an autotoolised build system, so, why is 

```
sdh_configure || sdh_die "Error configuring modular_resolution"
sdh_make_install || sdh_die "Error making modular_resolution"
```
not working any more?



---

archive/issue_comments_401631.json:
```json
{
    "body": "Replying to [comment:61 mkoeppe]:\n> Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.\n\n\nThat's a show stopper.\n\nEDIT: Why and on what ticket has that changed?",
    "created_at": "2020-10-16T19:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401631",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:61 mkoeppe]:
> Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.


That's a show stopper.

EDIT: Why and on what ticket has that changed?



---

archive/issue_comments_401632.json:
```json
{
    "body": "Replying to [comment:58 mkoeppe]:\n> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\n\nWhen you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.\n\nWould the following be the right way to split the current p_group_cohomology spkg into three spkgs?\n1. modular_resolution, depending on meataxe-the-C-library, that installs \n   - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?\n   - some executables in $SAGE_LOCAL/bin, linked against libmodres\n2. p_group_cohomology_helper, that installs\n   - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/\n   - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/\n   - a data base in $SAGE_LOCAL/share/p_group_cohomology/\n3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable\n\nThe computation of cohomology rings needs all the above! So, when you seriously state that \"Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.\", then you should tell what to do instead.",
    "created_at": "2020-10-16T19:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401632",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:58 mkoeppe]:
> This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).


When you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.

Would the following be the right way to split the current p_group_cohomology spkg into three spkgs?
1. modular_resolution, depending on meataxe-the-C-library, that installs 
   - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?
   - some executables in $SAGE_LOCAL/bin, linked against libmodres
2. p_group_cohomology_helper, that installs
   - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/
   - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/
   - a data base in $SAGE_LOCAL/share/p_group_cohomology/
3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable

The computation of cohomology rings needs all the above! So, when you seriously state that "Standalone libraries that would be installed in $SAGE_LOCAL/lib/ are not fine.", then you should tell what to do instead.



---

archive/issue_comments_401633.json:
```json
{
    "body": "Replying to [comment:62 SimonKing]:\nmodular_resolution uses an autotoolised build system, so, why is \n> {{{\n> sdh_configure || sdh_die \"Error configuring modular_resolution\"\n> sdh_make_install || sdh_die \"Error making modular_resolution\"\n> }}}\n> not working any more?\n\n\nGot it. In the previous version of spkg-install.in, it was stated that `# sdh_make install got broken by trac ticket #24106`. So, sdh_make_install apparently is still broken...",
    "created_at": "2020-10-16T19:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401633",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:62 SimonKing]:
modular_resolution uses an autotoolised build system, so, why is 
> {{{
> sdh_configure || sdh_die "Error configuring modular_resolution"
> sdh_make_install || sdh_die "Error making modular_resolution"
> }}}
> not working any more?


Got it. In the previous version of spkg-install.in, it was stated that `# sdh_make install got broken by trac ticket #24106`. So, sdh_make_install apparently is still broken...



---

archive/issue_comments_401634.json:
```json
{
    "body": "Replying to [comment:64 SimonKing]:\n> Replying to [comment:58 mkoeppe]:\n> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).\n\n> \n> When you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.\n\n\nYes.\n\n> Would the following be the right way to split the current p_group_cohomology spkg into three spkgs?\n> 1. modular_resolution, depending on meataxe-the-C-library, that installs \n>    - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?\n>    - some executables in $SAGE_LOCAL/bin, linked against libmodres\n\n\nYes.\n\n> 2. p_group_cohomology_helper, that installs\n>    - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/\n>    - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/\n>    - a data base in $SAGE_LOCAL/share/p_group_cohomology/\n\n\nPerhaps; although it could also make sense to make them actually part of the pip-installable package -- in which case the install location would NOT be `$SAGE_LOCAL/share/...` but next to the Python modules (this would depend on setting some load paths for GAP or Singular so that the modules would be found, I suppose - but I do not know enough about these systems). In that case, the installation would be done using `setup.py`'s `package_data` or similar.\n\n> 3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable\n\n\nYes.\n\n> The computation of cohomology rings needs all the above! So, when you seriously state that \"Standalone libraries that would be installed in `$SAGE_LOCAL/lib/` are not fine\n\n\n... I meant here: for a Python package!\n\nNon-Python packages, of course, will install in `$SAGE_LOCAL`.",
    "created_at": "2020-10-16T20:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401634",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:64 SimonKing]:
> Replying to [comment:58 mkoeppe]:
> > This is not good - an spkg should either be a pip-installable Python package, or it should be a non-Python package (which can install anywhere in SAGE_LOCAL).

> 
> When you say that an spkg shouldn't be formed by a python package and a non-python package, then you suggest to split p_group_cohomology.


Yes.

> Would the following be the right way to split the current p_group_cohomology spkg into three spkgs?
> 1. modular_resolution, depending on meataxe-the-C-library, that installs 
>    - a standalone C library libmodres.so -- of course(!!) in $SAGE_LOCAL/lib, where else would a C library be installed?
>    - some executables in $SAGE_LOCAL/bin, linked against libmodres


Yes.

> 2. p_group_cohomology_helper, that installs
>    - a GAP helper module in $SAGE_LOCAL/share/gap/pkg/
>    - a Singular helper module in $SAGE_LOCAL/share/singular/LIB/
>    - a data base in $SAGE_LOCAL/share/p_group_cohomology/


Perhaps; although it could also make sense to make them actually part of the pip-installable package -- in which case the install location would NOT be `$SAGE_LOCAL/share/...` but next to the Python modules (this would depend on setting some load paths for GAP or Singular so that the modules would be found, I suppose - but I do not know enough about these systems). In that case, the installation would be done using `setup.py`'s `package_data` or similar.

> 3. p_group_cohomology, depending on meataxe-the-Cython-extension, that is pip-installable


Yes.

> The computation of cohomology rings needs all the above! So, when you seriously state that "Standalone libraries that would be installed in `$SAGE_LOCAL/lib/` are not fine


... I meant here: for a Python package!

Non-Python packages, of course, will install in `$SAGE_LOCAL`.



---

archive/issue_comments_401635.json:
```json
{
    "body": "Something I don't understand (and has been broken before): When I open install the package including the documentation, then the documentation is built and installed --- but the resulting html files are broken. But if I open the p_group_cohomology tar ball, cd into pGroupCohomology-3.2.2/doc and do \"make html\" in a Sage shell, the resulting html files are fine (except that I am not totally happy about syntax highlighting for the examples in the documentation).\n\nSo, apparently there is a difference between building the documentation during `sage -i p_group_cohomology` and building the documentation manually. Although I believe what I described above (namely \"make html\" in a Sage shell) is exactly what happens during package installation, too.\n\nCan someone explain the problem? The same problem occurred in previous versions of p_group_cohomology, so, I don't think I broke something.",
    "created_at": "2020-10-16T22:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401635",
    "user": "https://github.com/simon-king-jena"
}
```

Something I don't understand (and has been broken before): When I open install the package including the documentation, then the documentation is built and installed --- but the resulting html files are broken. But if I open the p_group_cohomology tar ball, cd into pGroupCohomology-3.2.2/doc and do "make html" in a Sage shell, the resulting html files are fine (except that I am not totally happy about syntax highlighting for the examples in the documentation).

So, apparently there is a difference between building the documentation during `sage -i p_group_cohomology` and building the documentation manually. Although I believe what I described above (namely "make html" in a Sage shell) is exactly what happens during package installation, too.

Can someone explain the problem? The same problem occurred in previous versions of p_group_cohomology, so, I don't think I broke something.



---

archive/issue_comments_401636.json:
```json
{
    "body": "I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. In particular the lines \n\n```\nfrom sphinx import highlighting\n```\nand\n\n```\npygments_style = 'sphinx'\n```\nand\n\n```\nhighlighting.lexers['ipycon'] = IPythonConsoleLexer(in1_regex=r'sage: ', in2_regex=r'[.][.][.][.]: ')\nhighlighting.lexers['ipython'] = IPyLexer()\nhighlight_language = 'ipycon'\n```\nare relevant.",
    "created_at": "2020-10-16T22:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401636",
    "user": "https://github.com/jhpalmieri"
}
```

I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. In particular the lines 

```
from sphinx import highlighting
```
and

```
pygments_style = 'sphinx'
```
and

```
highlighting.lexers['ipycon'] = IPythonConsoleLexer(in1_regex=r'sage: ', in2_regex=r'[.][.][.][.]: ')
highlighting.lexers['ipython'] = IPyLexer()
highlight_language = 'ipycon'
```
are relevant.



---

archive/issue_comments_401637.json:
```json
{
    "body": "Replying to [comment:68 jhpalmieri]:\n> I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. ...\n\n\nNice! Thank you! It now looks much better (at least when built manually).",
    "created_at": "2020-10-16T23:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401637",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:68 jhpalmieri]:
> I'm not going to be much help for what's broken, but for the syntax highlighting, you might want to take all or parts of src/sage/docs/conf.py. ...


Nice! Thank you! It now looks much better (at least when built manually).



---

archive/issue_comments_401638.json:
```json
{
    "body": "Unfortunately there is a problem with [travis-ci](https://travis-ci.org/github/sagemath/p_group_cohomology).\n\nTesting fails before it was even tried to install p_group_cohomology. Namely, it fails when doing \"sage -b\" after installing meataxe. The error is:\n\n```\nmake: *** No targets specified and no makefile found.  Stop.\n\nThe command \"docker exec cohomology sage -b\" failed and exited with 2 during .\n```\nOf course that command did work in the past.",
    "created_at": "2020-10-17T07:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401638",
    "user": "https://github.com/simon-king-jena"
}
```

Unfortunately there is a problem with [travis-ci](https://travis-ci.org/github/sagemath/p_group_cohomology).

Testing fails before it was even tried to install p_group_cohomology. Namely, it fails when doing "sage -b" after installing meataxe. The error is:

```
make: *** No targets specified and no makefile found.  Stop.

The command "docker exec cohomology sage -b" failed and exited with 2 during .
```
Of course that command did work in the past.



---

archive/issue_comments_401639.json:
```json
{
    "body": "Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:\n\n```\n[p_group_cohomology-3.3.2]         H1 = COHO(Integer(8),Integer(3),root=tmp_root1)\n[p_group_cohomology-3.3.2]       File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/categories/unital_algebras.py\", line 117, in __init_extra__\n[p_group_cohomology-3.3.2]         deprecation(19225, \"the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead\")\n[p_group_cohomology-3.3.2]       File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 100, in deprecation\n[p_group_cohomology-3.3.2]         warning(trac_number, message, DeprecationWarning, stacklevel)\n[p_group_cohomology-3.3.2]       File \"/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 146, in warning\n[p_group_cohomology-3.3.2]         warn(message, warning_class, stacklevel)\n[p_group_cohomology-3.3.2]       File \"/usr/lib/python3.7/warnings.py\", line 110, in _showwarnmsg\n[p_group_cohomology-3.3.2]         msg.file, msg.line)\n[p_group_cohomology-3.3.2]     :\n[p_group_cohomology-3.3.2]     DeprecationWarning: the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead\n[p_group_cohomology-3.3.2]     See http://trac.sagemath.org/19225 for details.\n```",
    "created_at": "2020-10-17T08:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401639",
    "user": "https://github.com/simon-king-jena"
}
```

Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:

```
[p_group_cohomology-3.3.2]         H1 = COHO(Integer(8),Integer(3),root=tmp_root1)
[p_group_cohomology-3.3.2]       File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/categories/unital_algebras.py", line 117, in __init_extra__
[p_group_cohomology-3.3.2]         deprecation(19225, "the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead")
[p_group_cohomology-3.3.2]       File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
[p_group_cohomology-3.3.2]         warning(trac_number, message, DeprecationWarning, stacklevel)
[p_group_cohomology-3.3.2]       File "/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 146, in warning
[p_group_cohomology-3.3.2]         warn(message, warning_class, stacklevel)
[p_group_cohomology-3.3.2]       File "/usr/lib/python3.7/warnings.py", line 110, in _showwarnmsg
[p_group_cohomology-3.3.2]         msg.file, msg.line)
[p_group_cohomology-3.3.2]     :
[p_group_cohomology-3.3.2]     DeprecationWarning: the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead
[p_group_cohomology-3.3.2]     See http://trac.sagemath.org/19225 for details.
```



---

archive/issue_comments_401640.json:
```json
{
    "body": "Replying to [comment:71 SimonKing]:\n> Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:\n\n\nNeedless to say that #19225 doesn't clearly explain what to do in order to replace the ugly _no_generic_basering_coercion by something better. Should one simply remove it or what? And \"of course\" clicking on the branch of #19225 doesn't show a diff to the pre-#19225 state, i.e., I cannot infer from the changes in the code what I'd have to do now.\n\nSometimes I still miss patches attached to tickets.",
    "created_at": "2020-10-17T08:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401640",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:71 SimonKing]:
> Damned. I am now running tests on my machine, and many/most fail, apparently because of yet another internal change in Sage, in the category framework, as it seems:


Needless to say that #19225 doesn't clearly explain what to do in order to replace the ugly _no_generic_basering_coercion by something better. Should one simply remove it or what? And "of course" clicking on the branch of #19225 doesn't show a diff to the pre-#19225 state, i.e., I cannot infer from the changes in the code what I'd have to do now.

Sometimes I still miss patches attached to tickets.



---

archive/issue_comments_401641.json:
```json
{
    "body": "Hooray! After simply removing the hack that was deprecated by #19225, I get\n\n```\n[p_group_cohomology-3.3.2] ----------------------------------------------------------------------\n[p_group_cohomology-3.3.2] All tests passed!\n[p_group_cohomology-3.3.2] ----------------------------------------------------------------------\n```\nThat was withoug #30151, though.\n\n**Problems solved:**\n- setup.py is not messing around with SAGE_LOCAL. Instead, stuff that needs to be installed relative to the root of the Sage installation is now put in place by spkg-install using sdh_install.\n- The GAP part of the package has become a proper GAP package, that is installed where GAP expects packages (and can actually be loaded by `LoadPackage(...)`).\n- A hack that has been deprecated in #19225 is removed.\n\n**Remaining problems:**\n1. Documentation does still not build correctly, although it can be built separately.\n2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?\n   {{{\n$(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n  }}}\n  Or can this by simplified due to #30151?\n3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.\n\nProblem 2 should be addressed here. I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?",
    "created_at": "2020-10-17T11:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401641",
    "user": "https://github.com/simon-king-jena"
}
```

Hooray! After simply removing the hack that was deprecated by #19225, I get

```
[p_group_cohomology-3.3.2] ----------------------------------------------------------------------
[p_group_cohomology-3.3.2] All tests passed!
[p_group_cohomology-3.3.2] ----------------------------------------------------------------------
```
That was withoug #30151, though.

**Problems solved:**
- setup.py is not messing around with SAGE_LOCAL. Instead, stuff that needs to be installed relative to the root of the Sage installation is now put in place by spkg-install using sdh_install.
- The GAP part of the package has become a proper GAP package, that is installed where GAP expects packages (and can actually be loaded by `LoadPackage(...)`).
- A hack that has been deprecated in #19225 is removed.

**Remaining problems:**
1. Documentation does still not build correctly, although it can be built separately.
2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?
   {{{
$(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
  }}}
  Or can this by simplified due to #30151?
3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.

Problem 2 should be addressed here. I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?



---

archive/issue_comments_401642.json:
```json
{
    "body": "Replying to [comment:73 SimonKing]:\n> **Remaining problems:**\n> ...\n> 2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?\n>    {{{\n> $(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n>   }}}\n>   Or can this by simplified due to #30151?\n> ...\n> \n> Problem 2 should be addressed here. ...\n\n\nOn the other hand: #30151 doesn't work yet, because of circular imports. So, in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151, so that, once the circular import problem is solved, `build/pkgs/p_group_cohomology/dependencies` can be modified there, not here. Do you think that's reasonable?",
    "created_at": "2020-10-17T11:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401642",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:73 SimonKing]:
> **Remaining problems:**
> ...
> 2. I'm not using #30151 yet. **Question**: Do I understand correctly that I need to change the dependencies of the ticket as follows?
>    {{{
> $(PYTHON) cython cysignals singular sage-meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
>   }}}
>   Or can this by simplified due to #30151?
> ...
> 
> Problem 2 should be addressed here. ...


On the other hand: #30151 doesn't work yet, because of circular imports. So, in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151, so that, once the circular import problem is solved, `build/pkgs/p_group_cohomology/dependencies` can be modified there, not here. Do you think that's reasonable?



---

archive/issue_comments_401643.json:
```json
{
    "body": "For now, I'll proceed as announced in the previous two comments.\n\nRemark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.\n\n---\nNew commits:",
    "created_at": "2020-10-17T11:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401643",
    "user": "https://github.com/simon-king-jena"
}
```

For now, I'll proceed as announced in the previous two comments.

Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.

---
New commits:



---

archive/issue_comments_401644.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-17T11:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401644",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_401645.json:
```json
{
    "body": "could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?",
    "created_at": "2020-10-17T14:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401645",
    "user": "https://github.com/dimpase"
}
```

could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?



---

archive/issue_comments_401646.json:
```json
{
    "body": "Replying to [comment:76 SimonKing]:\n> Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.\n\n\nTry `git push origin v3.3.2`",
    "created_at": "2020-10-17T15:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401646",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:76 SimonKing]:
> Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.


Try `git push origin v3.3.2`



---

archive/issue_comments_401647.json:
```json
{
    "body": "This change seems to be undoing some changes that we made in the past to get the dependencies right -- probably a mistake?\n\n```\n--- a/build/pkgs/p_group_cohomology/dependencies\n+++ b/build/pkgs/p_group_cohomology/dependencies\n@@ -1 +1 @@\n-$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | $(PYTHON_TOOLCHAIN) matplotlib gap xz $(SAGERUNTIME) ipywidgets\n+$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n```",
    "created_at": "2020-10-17T15:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401647",
    "user": "https://github.com/mkoeppe"
}
```

This change seems to be undoing some changes that we made in the past to get the dependencies right -- probably a mistake?

```
--- a/build/pkgs/p_group_cohomology/dependencies
+++ b/build/pkgs/p_group_cohomology/dependencies
@@ -1 +1 @@
-$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | $(PYTHON_TOOLCHAIN) matplotlib gap xz $(SAGERUNTIME) ipywidgets
+$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
```



---

archive/issue_comments_401648.json:
```json
{
    "body": "Replying to [comment:74 SimonKing]:\n> in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151\n\n\nOK",
    "created_at": "2020-10-17T15:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401648",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:74 SimonKing]:
> in order to fix p_group_cohomology ASAP, I suggest to remove the dependency on #30151. Instead, I suggest that this ticket will be a dependency for #30151


OK



---

archive/issue_comments_401649.json:
```json
{
    "body": "Please add `upstream_url` to `checksums.ini`",
    "created_at": "2020-10-17T15:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401649",
    "user": "https://github.com/mkoeppe"
}
```

Please add `upstream_url` to `checksums.ini`



---

archive/issue_comments_401650.json:
```json
{
    "body": "Replying to [comment:73 SimonKing]:\n> **Remaining problems:**\n> 1. Documentation does still not build correctly, although it can be built separately.\n> ...\n> 3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.\n> \n> ... I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?\n\n\nSounds like a good plan",
    "created_at": "2020-10-17T15:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401650",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:73 SimonKing]:
> **Remaining problems:**
> 1. Documentation does still not build correctly, although it can be built separately.
> ...
> 3. The package consists of several sub-packages. One may consider to split them, perhaps even to put the python and cython parts into the Sage src tree, analogously to #30151.
> 
> ... I suggest problems 1 and 3 will be tackled in two new tickets. Agreed?


Sounds like a good plan



---

archive/issue_comments_401651.json:
```json
{
    "body": "Also see comment:44",
    "created_at": "2020-10-17T16:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401651",
    "user": "https://github.com/mkoeppe"
}
```

Also see comment:44



---

archive/issue_comments_401652.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-17T17:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401652",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_401653.json:
```json
{
    "body": "Replying to [comment:78 mkoeppe]:\n> Replying to [comment:76 SimonKing]:\n> > Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.\n\n> \n> Try `git push origin v3.3.2`\n\n\nWhen creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.\n\nIs that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as \"different history\"?",
    "created_at": "2020-10-17T19:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401653",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:78 mkoeppe]:
> Replying to [comment:76 SimonKing]:
> > Remark: I did add a tag v3.3.2 to my local git repository of the cohomology package. However, when pushing to github, the tag did not arrive there. Why? Anyway, I posted the tarball of the package on github.

> 
> Try `git push origin v3.3.2`


When creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.

Is that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as "different history"?



---

archive/issue_comments_401654.json:
```json
{
    "body": "Replying to [comment:77 dimpase]:\n> could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?\n\n\nNo.\n\nFirst of all, meataxe IS in dependencies:\n\n```\n$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n```\n\nSecondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.",
    "created_at": "2020-10-17T19:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401654",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:77 dimpase]:
> could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?


No.

First of all, meataxe IS in dependencies:

```
$(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
```

Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.



---

archive/issue_comments_401655.json:
```json
{
    "body": "Replying to [comment:44 jhpalmieri]:\n> I don't know your answer about `sdh_make_install`, but the code could just read\n> \n> ```\n> cd ...\n> sdh_configure\n> sdh_make_install # assuming this works\n> ```\n\n\nNope, sdh_make_install is still broken. I tried, but it didn't work.\n\n> Re #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.\n\n\nNo idea.",
    "created_at": "2020-10-17T19:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401655",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:44 jhpalmieri]:
> I don't know your answer about `sdh_make_install`, but the code could just read
> 
> ```
> cd ...
> sdh_configure
> sdh_make_install # assuming this works
> ```


Nope, sdh_make_install is still broken. I tried, but it didn't work.

> Re #24106: do you know what got broken? I don't see any comments or notes about follow-ups on that ticket.


No idea.



---

archive/issue_comments_401656.json:
```json
{
    "body": "Replying to [comment:86 SimonKing]:\n> When creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.\n> \n> Is that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as \"different history\"?\n\n\nLooking at https://github.com/sagemath/p_group_cohomology/commits/v3.3.2, I see that the tag is on the HEAD commit of master branch. This looks fine.",
    "created_at": "2020-10-17T19:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401656",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:86 SimonKing]:
> When creating the release, github asked me for a tag, so, I added the tag v3.3.2 there.
> 
> Is that a problem? It is supposed to be the same tag on the same commit. But perhaps git considers it as "different history"?


Looking at https://github.com/sagemath/p_group_cohomology/commits/v3.3.2, I see that the tag is on the HEAD commit of master branch. This looks fine.



---

archive/issue_comments_401657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T19:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401658.json:
```json
{
    "body": "In the previous two commits, I revert the changes to \"dependencies\" (no idea where the change came from) and added upstream_url. Hope the definition of upstream_url is correct.",
    "created_at": "2020-10-17T19:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401658",
    "user": "https://github.com/simon-king-jena"
}
```

In the previous two commits, I revert the changes to "dependencies" (no idea where the change came from) and added upstream_url. Hope the definition of upstream_url is correct.



---

archive/issue_comments_401659.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-17T19:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401659",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_401660.json:
```json
{
    "body": "What problem do you see with `sdh_make_install`?",
    "created_at": "2020-10-17T19:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401660",
    "user": "https://github.com/mkoeppe"
}
```

What problem do you see with `sdh_make_install`?



---

archive/issue_comments_401661.json:
```json
{
    "body": "Replying to [comment:91 SimonKing]:\n> Hope the definition of upstream_url is correct.\n\n\nSomething downloads but ....\n\n```\n[p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')\n[p_group_cohomology-3.3.2] ChecksumError: checksum does not match\n[p_group_cohomology-3.3.2] ************************************************************************\n[p_group_cohomology-3.3.2] ************************************************************************\n[p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz\n```",
    "created_at": "2020-10-17T20:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401661",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:91 SimonKing]:
> Hope the definition of upstream_url is correct.


Something downloads but ....

```
[p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')
[p_group_cohomology-3.3.2] ChecksumError: checksum does not match
[p_group_cohomology-3.3.2] ************************************************************************
[p_group_cohomology-3.3.2] ************************************************************************
[p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz
```



---

archive/issue_comments_401662.json:
```json
{
    "body": "Attachment [p_group_cohomology-3.3.2.log](tarball://root/attachments/some-uuid/ticket28711/p_group_cohomology-3.3.2.log) by @simon-king-jena created at 2020-10-17 20:20:58\n\nError with sdh_make_install",
    "created_at": "2020-10-17T20:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401662",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [p_group_cohomology-3.3.2.log](tarball://root/attachments/some-uuid/ticket28711/p_group_cohomology-3.3.2.log) by @simon-king-jena created at 2020-10-17 20:20:58

Error with sdh_make_install



---

archive/issue_comments_401663.json:
```json
{
    "body": "Replying to [comment:92 mkoeppe]:\n> What problem do you see with `sdh_make_install`?\n\n\nWhith\n\n```\n...\n# build and install modular_resolution\ncd `ls -d modular_resolution*`\nsdh_configure\n# sdh_make install got broken by trac ticket #24106\nsdh_make_install\ncd ..\n...\n```\nI get :attachment:p_group_cohomology-3.3.2.log when first removing libmodres.* from SAGE_LOCAL/lib and modular_resolution from SAGE_LOCAL/include, then doing sage -f p_group_cohomology.",
    "created_at": "2020-10-17T20:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401663",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:92 mkoeppe]:
> What problem do you see with `sdh_make_install`?


Whith

```
...
# build and install modular_resolution
cd `ls -d modular_resolution*`
sdh_configure
# sdh_make install got broken by trac ticket #24106
sdh_make_install
cd ..
...
```
I get :attachment:p_group_cohomology-3.3.2.log when first removing libmodres.* from SAGE_LOCAL/lib and modular_resolution from SAGE_LOCAL/include, then doing sage -f p_group_cohomology.



---

archive/issue_comments_401664.json:
```json
{
    "body": "OK, what's happening here is that your package is not ready for the staged install because the \"make install\" of the C library goes to the staging directory, so the second step will not find it in `SAGE_LOCAL`.  \n\nThis is working as designed. The problem will go away if you split out modres as a separate spkg.",
    "created_at": "2020-10-17T20:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401664",
    "user": "https://github.com/mkoeppe"
}
```

OK, what's happening here is that your package is not ready for the staged install because the "make install" of the C library goes to the staging directory, so the second step will not find it in `SAGE_LOCAL`.  

This is working as designed. The problem will go away if you split out modres as a separate spkg.



---

archive/issue_comments_401665.json:
```json
{
    "body": "Replying to [comment:93 mkoeppe]:\n> Replying to [comment:91 SimonKing]:\n> > Hope the definition of upstream_url is correct.\n\n> \n> Something downloads but ....\n> \n> ```\n> [p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')\n> [p_group_cohomology-3.3.2] ChecksumError: checksum does not match\n> [p_group_cohomology-3.3.2] ************************************************************************\n> [p_group_cohomology-3.3.2] ************************************************************************\n> [p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz\n> ```\n\n\nThank you. I downloaded the tarball from github, and it did indeed differ. I modified the release on github, and now it seems to work.",
    "created_at": "2020-10-17T20:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401665",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:93 mkoeppe]:
> Replying to [comment:91 SimonKing]:
> > Hope the definition of upstream_url is correct.

> 
> Something downloads but ....
> 
> ```
> [p_group_cohomology-3.3.2]     raise ChecksumError('checksum does not match')
> [p_group_cohomology-3.3.2] ChecksumError: checksum does not match
> [p_group_cohomology-3.3.2] ************************************************************************
> [p_group_cohomology-3.3.2] ************************************************************************
> [p_group_cohomology-3.3.2] Error downloading p_group_cohomology-3.3.2.tar.xz
> ```


Thank you. I downloaded the tarball from github, and it did indeed differ. I modified the release on github, and now it seems to work.



---

archive/issue_comments_401666.json:
```json
{
    "body": "https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball",
    "created_at": "2020-10-17T20:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401666",
    "user": "https://github.com/mkoeppe"
}
```

https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball



---

archive/issue_comments_401667.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-17T21:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401667",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_401668.json:
```json
{
    "body": "Replying to [comment:97 mkoeppe]:\n> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball \n\n\nit is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.\nOn https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on \"Edit Release\"\nand upload the tarball you want there.",
    "created_at": "2020-10-17T22:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401668",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:97 mkoeppe]:
> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball 


it is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.
On https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on "Edit Release"
and upload the tarball you want there.



---

archive/issue_comments_401669.json:
```json
{
    "body": "Replying to [comment:87 SimonKing]:\n> Replying to [comment:77 dimpase]:\n> > could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?\n\n> \n> No.\n> \n> First of all, meataxe IS in dependencies:\n> \n> ```\n> $(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)\n> ```\n> \n\nit seems to be the only  spkg that lists *files* as dependencies.\nI don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.\n\n\n> Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.\n\n\nThen replace these two lines by `sage -b` !",
    "created_at": "2020-10-17T22:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401669",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:87 SimonKing]:
> Replying to [comment:77 dimpase]:
> > could you also remove the 1st 2 lines of spkg-install and add meataxe to `dependencies` ?

> 
> No.
> 
> First of all, meataxe IS in dependencies:
> 
> ```
> $(PYTHON) cython cysignals singular meataxe $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/structure/element.pxd $(SAGE_SRC)/sage/matrix/matrix_gfpn_dense.pxd $(SAGE_SRC)/sage/matrix/matrix0.pxd $(SAGE_SRC)/sage/libs/meataxe.pxd $(SAGE_SRC)/sage/rings/morphism.pxd | pip matplotlib gap xz $(SAGERUNTIME)
> ```
> 

it seems to be the only  spkg that lists *files* as dependencies.
I don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.


> Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.


Then replace these two lines by `sage -b` !



---

archive/issue_comments_401670.json:
```json
{
    "body": "Replying to [comment:97 mkoeppe]:\n> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball \n\n\nWTF? When I removed the old tarball (that I did produce on my own machine, by the way), I immediately replaced it by - again - the tarball from my machine. And afterwards I could download it by wget.",
    "created_at": "2020-10-17T22:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401670",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:97 mkoeppe]:
> https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball 


WTF? When I removed the old tarball (that I did produce on my own machine, by the way), I immediately replaced it by - again - the tarball from my machine. And afterwards I could download it by wget.



---

archive/issue_comments_401671.json:
```json
{
    "body": "Replying to [comment:99 dimpase]:\n> Replying to [comment:97 mkoeppe]:\n> > https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball \n\n> \n> it is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.\n\n\nBoth the old broken one and the new non-broken one are from my machine. Travis knows how to create a tarball for my package, but github doesn't.\n\n> On https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on \"Edit Release\"\n> and upload the tarball you want there.\n\n\nI did now, and I hope it is fine now.",
    "created_at": "2020-10-17T22:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401671",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:99 dimpase]:
> Replying to [comment:97 mkoeppe]:
> > https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 does not seem to have a source tarball 

> 
> it is much better to upload a tarball produced on your machine, rather than rely on GitHub's produced tarballs, which are known to change overtime sometimes.


Both the old broken one and the new non-broken one are from my machine. Travis knows how to create a tarball for my package, but github doesn't.

> On https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2 click  on "Edit Release"
> and upload the tarball you want there.


I did now, and I hope it is fine now.



---

archive/issue_comments_401672.json:
```json
{
    "body": "The checksum still does not match...",
    "created_at": "2020-10-17T22:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401672",
    "user": "https://github.com/mkoeppe"
}
```

The checksum still does not match...



---

archive/issue_comments_401673.json:
```json
{
    "body": "Replying to [comment:100 dimpase]:\n> it seems to be the only  spkg that lists *files* as dependencies.\n> I don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.\n\n\nI have no idea how exactly \"dependencies\" work. I don't recall who created the \"dependencies\" file for p_group_cohomology.\n\nI suppose the rationale is: If one would give \"sagelib\" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.\n\n> > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.\n\n> \n> Then replace these two lines by `sage -b` !\n\n\nI was told not to do that, IIRC.",
    "created_at": "2020-10-17T22:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401673",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:100 dimpase]:
> it seems to be the only  spkg that lists *files* as dependencies.
> I don't understand the need for these. Yes, your package depends on sagelib as a whole, thus on these files too.


I have no idea how exactly "dependencies" work. I don't recall who created the "dependencies" file for p_group_cohomology.

I suppose the rationale is: If one would give "sagelib" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.

> > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.

> 
> Then replace these two lines by `sage -b` !


I was told not to do that, IIRC.



---

archive/issue_comments_401674.json:
```json
{
    "body": "Replying to [comment:104 SimonKing]:\n> I suppose the rationale is: If one would give \"sagelib\" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.\n\n\nI agree with this reasoning. In particular, note that `sagelib` is rebuilt every time.",
    "created_at": "2020-10-17T22:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401674",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:104 SimonKing]:
> I suppose the rationale is: If one would give "sagelib" as a dependency, p_group_cohomology would be rebuilt (which takes a long time) for EACH SINGLE TOTALLY UNRELATED change in the Sage library. That's not nice. Therefore it is a good idea to be more specific and only mention those Cython headers that really are used by the Cython modules of p_group_cohomology.


I agree with this reasoning. In particular, note that `sagelib` is rebuilt every time.



---

archive/issue_comments_401675.json:
```json
{
    "body": "Replying to [comment:104 SimonKing]:\n> > > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.\n\n> > \n> > Then replace these two lines by `sage -b` !\n\n> \n> I was told not to do that, IIRC.\n\n\nYes, let's not do that. The proper fix will come in the follow-up ticket, as discussed above.",
    "created_at": "2020-10-17T22:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401675",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:104 SimonKing]:
> > > Secondly, installing meataxe is not enough, as it is required to do `sage -b` after installation. That's why there are the first two lines in spkg-install.in.

> > 
> > Then replace these two lines by `sage -b` !

> 
> I was told not to do that, IIRC.


Yes, let's not do that. The proper fix will come in the follow-up ticket, as discussed above.



---

archive/issue_comments_401676.json:
```json
{
    "body": "Replying to [comment:103 mkoeppe]:\n> The checksum still does not match...\n\n\nThe tarball in SAGE_ROOT/upstream is bitwise identical with what I downloaded.\n\nAnyway. If the checksums do not match, I suggest to clean things up. Namely, AFTER adding the tag \"v3.3.2\", I did a few changes in the index.rst file of the documentation. If I see that correctly, these changes are not part of the tarball that is posted on github.\n\nSince the numbers do not match, I will now\n- make sure to include my latest changes (to the documentation) in the release.\n- move the tag v3.3.2 to the corresponding commit, both locally and on github.\n- upload the release tarball on github\n- change the checksum, if necessary.",
    "created_at": "2020-10-17T22:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401676",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:103 mkoeppe]:
> The checksum still does not match...


The tarball in SAGE_ROOT/upstream is bitwise identical with what I downloaded.

Anyway. If the checksums do not match, I suggest to clean things up. Namely, AFTER adding the tag "v3.3.2", I did a few changes in the index.rst file of the documentation. If I see that correctly, these changes are not part of the tarball that is posted on github.

Since the numbers do not match, I will now
- make sure to include my latest changes (to the documentation) in the release.
- move the tag v3.3.2 to the corresponding commit, both locally and on github.
- upload the release tarball on github
- change the checksum, if necessary.



---

archive/issue_comments_401677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T23:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401678.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-17T23:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401678",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_401679.json:
```json
{
    "body": "Replying to [comment:107 SimonKing]:\n> Since the numbers do not match, I will now\n> - make sure to include my latest changes (to the documentation) in the release.\n> - move the tag v3.3.2 to the corresponding commit, both locally and on github.\n> - upload the release tarball on github\n> - change the checksum, if necessary.\n\n\nDone. I think it is fine now.",
    "created_at": "2020-10-17T23:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401679",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:107 SimonKing]:
> Since the numbers do not match, I will now
> - make sure to include my latest changes (to the documentation) in the release.
> - move the tag v3.3.2 to the corresponding commit, both locally and on github.
> - upload the release tarball on github
> - change the checksum, if necessary.


Done. I think it is fine now.



---

archive/issue_comments_401680.json:
```json
{
    "body": "I don't know what's happening here, but the checksums stil do not match. (..deleted..)",
    "created_at": "2020-10-17T23:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401680",
    "user": "https://github.com/mkoeppe"
}
```

I don't know what's happening here, but the checksums stil do not match. (..deleted..)



---

archive/issue_comments_401681.json:
```json
{
    "body": "Replying to [comment:110 mkoeppe]:\n> I don't know what's happening here, but the checksums still do not match. \n\n\nLooks like this one was a malfunction on my side",
    "created_at": "2020-10-17T23:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401681",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:110 mkoeppe]:
> I don't know what's happening here, but the checksums still do not match. 


Looks like this one was a malfunction on my side



---

archive/issue_comments_401682.json:
```json
{
    "body": "It has built OK now on macOS",
    "created_at": "2020-10-17T23:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401682",
    "user": "https://github.com/mkoeppe"
}
```

It has built OK now on macOS



---

archive/issue_comments_401683.json:
```json
{
    "body": "I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet \u2014 it's in a staging area \u2014 so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:\n\n```diff\ndiff --git a/build/pkgs/p_group_cohomology/spkg-install.in b/build/pkgs/p_group_cohomology/spkg-install.in\nindex bcae3a8a47..aef761f9a6 100644\n--- a/build/pkgs/p_group_cohomology/spkg-install.in\n+++ b/build/pkgs/p_group_cohomology/spkg-install.in\n@@ -17,9 +17,3 @@ sdh_install singular_helper/dickson.lib \"$SAGE_SHARE/singular/LIB/\" || sdh_die \"\n # building pGroupCohomology (and its documentation)\n cd `ls -d pGroupCohomology*`\n sdh_pip_install .\n-\n-if [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then\n-    cd doc\n-    $MAKE html || sdh_die \"Error building documentation\"\n-    sdh_install build/html/* \"$SAGE_SHARE/doc/p_group_cohomology/\" || sdh_die \"Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology\"\n-fi\ndiff --git a/build/pkgs/p_group_cohomology/spkg-postinst.in b/build/pkgs/p_group_cohomology/spkg-postinst.in\nnew file mode 100644\nindex 0000000000..ec485455db\n--- /dev/null\n+++ b/build/pkgs/p_group_cohomology/spkg-postinst.in\n@@ -0,0 +1,8 @@\n+cd src\n+cd `ls -d pGroupCohomology*`\n+\n+if [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then\n+    cd doc\n+    $MAKE html || sdh_die \"Error building documentation\"\n+    sdh_install build/html/* \"$SAGE_SHARE/doc/p_group_cohomology/\" || sdh_die \"Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology\"\n+fi\n```",
    "created_at": "2020-10-18T01:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401683",
    "user": "https://github.com/jhpalmieri"
}
```

I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet — it's in a staging area — so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:

```diff
diff --git a/build/pkgs/p_group_cohomology/spkg-install.in b/build/pkgs/p_group_cohomology/spkg-install.in
index bcae3a8a47..aef761f9a6 100644
--- a/build/pkgs/p_group_cohomology/spkg-install.in
+++ b/build/pkgs/p_group_cohomology/spkg-install.in
@@ -17,9 +17,3 @@ sdh_install singular_helper/dickson.lib "$SAGE_SHARE/singular/LIB/" || sdh_die "
 # building pGroupCohomology (and its documentation)
 cd `ls -d pGroupCohomology*`
 sdh_pip_install .
-
-if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
-    cd doc
-    $MAKE html || sdh_die "Error building documentation"
-    sdh_install build/html/* "$SAGE_SHARE/doc/p_group_cohomology/" || sdh_die "Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology"
-fi
diff --git a/build/pkgs/p_group_cohomology/spkg-postinst.in b/build/pkgs/p_group_cohomology/spkg-postinst.in
new file mode 100644
index 0000000000..ec485455db
--- /dev/null
+++ b/build/pkgs/p_group_cohomology/spkg-postinst.in
@@ -0,0 +1,8 @@
+cd src
+cd `ls -d pGroupCohomology*`
+
+if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
+    cd doc
+    $MAKE html || sdh_die "Error building documentation"
+    sdh_install build/html/* "$SAGE_SHARE/doc/p_group_cohomology/" || sdh_die "Error moving documentation to $SAGE_SHARE/doc/p_group_cohomology"
+fi
```



---

archive/issue_comments_401684.json:
```json
{
    "body": "The problem with the checksum error on automatic download was also reproduced on GH Actions: \n\n```\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/p_group_cohomology/p_group_cohomology-3.3.2.tar.xz'\nAttempting to download from https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz\n[......................................................................]\n************************************************************************\nTraceback (most recent call last):\n  File \"/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 130, in run_safe\n    run()\n  File \"/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 112, in run\n    app.download_tarball(args.url_or_tarball, args.destination, args.allow_upstream)\n  File \"/sage/build/bin/../sage_bootstrap/download/app.py\", line 41, in download_tarball\n    tarball.download(allow_upstream=allow_upstream)\n  File \"/sage/build/bin/../sage_bootstrap/tarball.py\", line 177, in download\n    raise ChecksumError('checksum does not match')\nChecksumError: checksum does not match\n```",
    "created_at": "2020-10-18T03:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401684",
    "user": "https://github.com/mkoeppe"
}
```

The problem with the checksum error on automatic download was also reproduced on GH Actions: 

```
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/p_group_cohomology/p_group_cohomology-3.3.2.tar.xz'
Attempting to download from https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz
[......................................................................]
************************************************************************
Traceback (most recent call last):
  File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 130, in run_safe
    run()
  File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 112, in run
    app.download_tarball(args.url_or_tarball, args.destination, args.allow_upstream)
  File "/sage/build/bin/../sage_bootstrap/download/app.py", line 41, in download_tarball
    tarball.download(allow_upstream=allow_upstream)
  File "/sage/build/bin/../sage_bootstrap/tarball.py", line 177, in download
    raise ChecksumError('checksum does not match')
ChecksumError: checksum does not match
```



---

archive/issue_comments_401685.json:
```json
{
    "body": "Hm......\n\n```\n(sage-sh) mkoeppe@egret:sage-rebasing$ sage-download-file https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz > A\n[......................................................................]\n(sage-sh) mkoeppe@egret:sage-rebasing$ file A\nA: HTML document text, UTF-8 Unicode text, with very long lines\n(sage-sh) mkoeppe@egret:sage-rebasing$ head A\n\n\n\n\n\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n  <link rel=\"dns-prefetch\" href=\"https://github.githubassets.com\">\n```",
    "created_at": "2020-10-18T03:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401685",
    "user": "https://github.com/mkoeppe"
}
```

Hm......

```
(sage-sh) mkoeppe@egret:sage-rebasing$ sage-download-file https://github.com/sagemath/p_group_cohomology/releases/tag/v3.3.2/p_group_cohomology-3.3.2.tar.xz > A
[......................................................................]
(sage-sh) mkoeppe@egret:sage-rebasing$ file A
A: HTML document text, UTF-8 Unicode text, with very long lines
(sage-sh) mkoeppe@egret:sage-rebasing$ head A





<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://github.githubassets.com">
```



---

archive/issue_comments_401686.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-10-18T03:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401686",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_401687.json:
```json
{
    "body": "Replying to [comment:114 jhpalmieri]:\n> I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet \u2014 it's in a staging area \u2014 so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:\n\n\nSure, that makes sense! Thank you for spotting it!\n\nI'll try, and if it works, I will also remove the comment from the doc that states that docbuilding during package installation is broken.",
    "created_at": "2020-10-18T07:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401687",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:114 jhpalmieri]:
> I think the problem with the documentation is this: if you install the documentation in `spkg-install.in`, then the package hasn't been installed yet — it's in a staging area — so it cannot be imported into Python, which is necessary for the docbuilding process. So move the docbuilding stuff to `spkg-postinst.in`:


Sure, that makes sense! Thank you for spotting it!

I'll try, and if it works, I will also remove the comment from the doc that states that docbuilding during package installation is broken.



---

archive/issue_comments_401688.json:
```json
{
    "body": "Thank you very much, when using spkg-postinst, building the documentation works!\n\n---\nNew commits:",
    "created_at": "2020-10-18T07:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401688",
    "user": "https://github.com/simon-king-jena"
}
```

Thank you very much, when using spkg-postinst, building the documentation works!

---
New commits:



---

archive/issue_comments_401689.json:
```json
{
    "body": "PS: The new tarball (removing the remark on broken docbuild) is on github.",
    "created_at": "2020-10-18T07:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401689",
    "user": "https://github.com/simon-king-jena"
}
```

PS: The new tarball (removing the remark on broken docbuild) is on github.



---

archive/issue_comments_401690.json:
```json
{
    "body": "OK, but one doctest is failing\n\n```\n$ ./sage -tp src/sage/tests/modular_group_cohomology.py\nRunning doctests with ID 2020-10-19-09-47-51-87beac43.\nGit branch: public/graphs/30386\nUsing --optional=bliss,build,debian,dochtml,gap_packages,libsemigroups,meataxe,memlimit,p_group_cohomology,pip,sage,sage_spkg\nDoctesting 1 file using 4 threads.\nsage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py\n**********************************************************************\nFile \"src/sage/tests/modular_group_cohomology.py\", line 20, in sage.tests.modular_group_cohomology\nFailed example:\n    H == H0                                       # optional - p_group_cohomology\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of  18 in sage.tests.modular_group_cohomology\n    [17 tests, 1 failure, 3.98 s]\n----------------------------------------------------------------------\nsage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 4.0 seconds\n    cpu time: 3.4 seconds\n    cumulative wall time: 4.0 seconds\n```\nnote that also at Sage prompt computing H and H0 gives\n\n```\nsage: H0.gens()                                                                                                                                                      \n[1,\n a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\nsage: H.gens()                                                                                                                                                       \n[1,\n a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\nsage: H0.is_isomorphic(H)                                                                                                                                            \n('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\nsage: H.is_isomorphic(H0)                                                                                                                                            \n('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\nsage: H==H0                                                                                                                                                          \nFalse\n```\n\nnot sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket.",
    "created_at": "2020-10-19T08:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401690",
    "user": "https://github.com/dimpase"
}
```

OK, but one doctest is failing

```
$ ./sage -tp src/sage/tests/modular_group_cohomology.py
Running doctests with ID 2020-10-19-09-47-51-87beac43.
Git branch: public/graphs/30386
Using --optional=bliss,build,debian,dochtml,gap_packages,libsemigroups,meataxe,memlimit,p_group_cohomology,pip,sage,sage_spkg
Doctesting 1 file using 4 threads.
sage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py
**********************************************************************
File "src/sage/tests/modular_group_cohomology.py", line 20, in sage.tests.modular_group_cohomology
Failed example:
    H == H0                                       # optional - p_group_cohomology
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  18 in sage.tests.modular_group_cohomology
    [17 tests, 1 failure, 3.98 s]
----------------------------------------------------------------------
sage -t --warn-long 81.6 --random-seed=0 src/sage/tests/modular_group_cohomology.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 4.0 seconds
    cpu time: 3.4 seconds
    cumulative wall time: 4.0 seconds
```
note that also at Sage prompt computing H and H0 gives

```
sage: H0.gens()                                                                                                                                                      
[1,
 a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
sage: H.gens()                                                                                                                                                       
[1,
 a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
 a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
sage: H0.is_isomorphic(H)                                                                                                                                            
('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
sage: H.is_isomorphic(H0)                                                                                                                                            
('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
sage: H==H0                                                                                                                                                          
False
```

not sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket.



---

archive/issue_comments_401691.json:
```json
{
    "body": "Replying to [comment:123 dimpase]:\n> OK, but one doctest is failing\n\n\nThank you for spotting this! Indeed I forgot that there are some doctests in the Sage src tree, and only tested the package's own test suite.\n\n> note that also at Sage prompt computing H and H0 gives\n> \n> ```\n> sage: H0.gens()                                                                                                                                                      \n> [1,\n>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\n> sage: H.gens()                                                                                                                                                       \n> [1,\n>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),\n>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]\n> sage: H0.is_isomorphic(H)                                                                                                                                            \n> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\n> sage: H.is_isomorphic(H0)                                                                                                                                            \n> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')\n> sage: H==H0                                                                                                                                                          \n> False\n> ```\n\n\nHm. I'll have a closer look. Two cohomology rings should evaluate equal if the two ring representations are identical. This should be the case here, as there is an isomorphism mapping the generators one to one.\n\n... unless there is a tail reduction of the relations in one case but not in the other case.\n\n> not sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket. \n\n\nAt least I'll have a look now.",
    "created_at": "2020-10-19T09:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401691",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:123 dimpase]:
> OK, but one doctest is failing


Thank you for spotting this! Indeed I forgot that there are some doctests in the Sage src tree, and only tested the package's own test suite.

> note that also at Sage prompt computing H and H0 gives
> 
> ```
> sage: H0.gens()                                                                                                                                                      
> [1,
>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
> sage: H.gens()                                                                                                                                                       
> [1,
>  a_2_1: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_2_2: 2-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  c_4_4: 4-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_0: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_1_1: 1-Cocycle in H^*(SmallGroup(64,14); GF(2)),
>  a_3_3: 3-Cocycle in H^*(SmallGroup(64,14); GF(2))]
> sage: H0.is_isomorphic(H)                                                                                                                                            
> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
> sage: H.is_isomorphic(H0)                                                                                                                                            
> ('1*a_2_1', '1*c_2_2', '1*c_4_4', '1*a_1_0', '1*a_1_1', '1*a_3_3')
> sage: H==H0                                                                                                                                                          
> False
> ```


Hm. I'll have a closer look. Two cohomology rings should evaluate equal if the two ring representations are identical. This should be the case here, as there is an isomorphism mapping the generators one to one.

... unless there is a tail reduction of the relations in one case but not in the other case.

> not sure how serious it is - if it's not, and you don't have time to fix it now, just mark it as a known error, and open another ticket. 


At least I'll have a look now.



---

archive/issue_comments_401692.json:
```json
{
    "body": "Interesting:\n\n```\nsage: H.set_ring()                                                                                  \nsage: H.relation_ideal()                                                                            \na_1_0^2,\na_1_0*a_1_1,\na_1_1^3,\na_2_1*a_1_0,\na_2_1^2+a_2_1*a_1_1^2,\na_1_0*a_3_3+a_2_1*a_1_1^2,\na_1_1*a_3_3+a_2_1*a_1_1^2,\na_2_1*a_3_3,\na_3_3^2\nsage: H0.set_ring()                                                                                 \nsage: H0.relation_ideal()                                                                           \na_1_0^2,\na_1_0*a_1_1,\na_1_1^3,\na_2_1*a_1_0,\na_2_1^2+a_2_1*a_1_1^2,\na_1_0*a_3_3+a_2_1*a_1_1^2,\na_1_1*a_3_3+a_2_1*a_1_1^2,\na_2_1*a_3_3,\na_3_3^2\nsage: H.rels()                                                                                      \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_0*a_3_3+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1*a_1_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\nsage: H0.rels()                                                                                     \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1^2',\n 'a_1_0*a_3_3+a_2_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\n```\nSo, Singular says that the two ideals are identical, but the string representation stored in the cohomology ring is different.",
    "created_at": "2020-10-19T09:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401692",
    "user": "https://github.com/simon-king-jena"
}
```

Interesting:

```
sage: H.set_ring()                                                                                  
sage: H.relation_ideal()                                                                            
a_1_0^2,
a_1_0*a_1_1,
a_1_1^3,
a_2_1*a_1_0,
a_2_1^2+a_2_1*a_1_1^2,
a_1_0*a_3_3+a_2_1*a_1_1^2,
a_1_1*a_3_3+a_2_1*a_1_1^2,
a_2_1*a_3_3,
a_3_3^2
sage: H0.set_ring()                                                                                 
sage: H0.relation_ideal()                                                                           
a_1_0^2,
a_1_0*a_1_1,
a_1_1^3,
a_2_1*a_1_0,
a_2_1^2+a_2_1*a_1_1^2,
a_1_0*a_3_3+a_2_1*a_1_1^2,
a_1_1*a_3_3+a_2_1*a_1_1^2,
a_2_1*a_3_3,
a_3_3^2
sage: H.rels()                                                                                      
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_0*a_3_3+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1*a_1_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
sage: H0.rels()                                                                                     
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1^2',
 'a_1_0*a_3_3+a_2_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
```
So, Singular says that the two ideals are identical, but the string representation stored in the cohomology ring is different.



---

archive/issue_comments_401693.json:
```json
{
    "body": "The relations of H and H0 are equal as sets, but not as lists:\n\n```\nsage: H.rels()                                                                                                                                                       \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_0*a_3_3+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1*a_1_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\nsage: H0.rels()                                                                                                                                                      \n['a_1_0^2',\n 'a_1_0*a_1_1',\n 'a_1_1^3',\n 'a_2_1*a_1_0',\n 'a_2_1^2+a_2_1*a_1_1^2',\n 'a_1_1*a_3_3+a_2_1^2',\n 'a_1_0*a_3_3+a_2_1^2',\n 'a_2_1*a_3_3',\n 'a_3_3^2']\n```\n\nEDIT - oops, sorry, there are just a bit different - as you noticed already, I suppose.",
    "created_at": "2020-10-19T09:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401693",
    "user": "https://github.com/dimpase"
}
```

The relations of H and H0 are equal as sets, but not as lists:

```
sage: H.rels()                                                                                                                                                       
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_0*a_3_3+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1*a_1_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
sage: H0.rels()                                                                                                                                                      
['a_1_0^2',
 'a_1_0*a_1_1',
 'a_1_1^3',
 'a_2_1*a_1_0',
 'a_2_1^2+a_2_1*a_1_1^2',
 'a_1_1*a_3_3+a_2_1^2',
 'a_1_0*a_3_3+a_2_1^2',
 'a_2_1*a_3_3',
 'a_3_3^2']
```

EDIT - oops, sorry, there are just a bit different - as you noticed already, I suppose.



---

archive/issue_comments_401694.json:
```json
{
    "body": "Indeed, the problem is the missing interreduction:\n\n```\nsage: H0.set_ring()                                                                                 \nsage: I = singular.ideal(H0.rels())                                                                 \nsage: str(I) == str(H0.relation_ideal())                                                            \nFalse\nsage: str(I.interred()) == str(H0.relation_ideal())                                                 \nTrue\n```\nHm. What to do about it?",
    "created_at": "2020-10-19T09:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401694",
    "user": "https://github.com/simon-king-jena"
}
```

Indeed, the problem is the missing interreduction:

```
sage: H0.set_ring()                                                                                 
sage: I = singular.ideal(H0.rels())                                                                 
sage: str(I) == str(H0.relation_ideal())                                                            
False
sage: str(I.interred()) == str(H0.relation_ideal())                                                 
True
```
Hm. What to do about it?



---

archive/issue_comments_401695.json:
```json
{
    "body": "Replying to [comment:126 dimpase]:\n> The relations of H and H0 are equal as sets, but not as lists:\n\n\nNo, they aren't. They are equal after doing interreduction.\n\n```\nsage: set(H0.rels()) == set(H.rels())                                                               \nFalse\n```",
    "created_at": "2020-10-19T09:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401695",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:126 dimpase]:
> The relations of H and H0 are equal as sets, but not as lists:


No, they aren't. They are equal after doing interreduction.

```
sage: set(H0.rels()) == set(H.rels())                                                               
False
```



---

archive/issue_comments_401696.json:
```json
{
    "body": "Back to the question what to do about it.\n\nThe point of the equality check is to provide a VERY QUICK test. So, I wouldn't like to do interreduction before comparing.\n\nBut one could fix the doctest by checking that the two rings are indeed isomorphic by mapping the list of generators one-to-one.",
    "created_at": "2020-10-19T09:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401696",
    "user": "https://github.com/simon-king-jena"
}
```

Back to the question what to do about it.

The point of the equality check is to provide a VERY QUICK test. So, I wouldn't like to do interreduction before comparing.

But one could fix the doctest by checking that the two rings are indeed isomorphic by mapping the list of generators one-to-one.



---

archive/issue_comments_401697.json:
```json
{
    "body": "I would not call what we see here a \"pythonic\" equality. What we see here is more like \n`1/2==2/4` - the jury is still out on whether this should be True or False.\n\nOn the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?",
    "created_at": "2020-10-19T09:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401697",
    "user": "https://github.com/dimpase"
}
```

I would not call what we see here a "pythonic" equality. What we see here is more like 
`1/2==2/4` - the jury is still out on whether this should be True or False.

On the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?



---

archive/issue_comments_401698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-19T09:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401699.json:
```json
{
    "body": "Replying to [comment:130 dimpase]:\n> I would not call what we see here a \"pythonic\" equality. What we see here is more like \n> `1/2==2/4` - the jury is still out on whether this should be True or False.\n\n\nI chose \"equality of cohomology rings\" to mean \"equality of ring representations\".\n\nSo, with this choice, one would have `1/2==2/4` if and only if `1/2` is represented in the same way (namely as a REDUCED fraction) as `2/4`.\n\nNote that to check whether two ideals represent the same set of polynomials, one would need to compute Gr\u00f6bner bases. But that's very expensive. Therefore, it was decided by Sage (at least in the past, I don't know if that has changed) to not do the expensive test, but to compare generators instead.\n\nAnd that's what I do here, too.\n\n> On the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?\n\n\nSure. I wrote a research paper (with Bettina Eick) on classifying the cohomology rings of groups of order <=81 up to graded isomorphism. And that's a totally different problem.\n\nHere, equality is not \"isomorphism of graded rings\", but \"identity of ring representations\".",
    "created_at": "2020-10-19T09:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401699",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:130 dimpase]:
> I would not call what we see here a "pythonic" equality. What we see here is more like 
> `1/2==2/4` - the jury is still out on whether this should be True or False.


I chose "equality of cohomology rings" to mean "equality of ring representations".

So, with this choice, one would have `1/2==2/4` if and only if `1/2` is represented in the same way (namely as a REDUCED fraction) as `2/4`.

Note that to check whether two ideals represent the same set of polynomials, one would need to compute Gröbner bases. But that's very expensive. Therefore, it was decided by Sage (at least in the past, I don't know if that has changed) to not do the expensive test, but to compare generators instead.

And that's what I do here, too.

> On the other hand what we have here is a stronger kind of equvalence than just a (graded) ring isomorphism, no?


Sure. I wrote a research paper (with Bettina Eick) on classifying the cohomology rings of groups of order <=81 up to graded isomorphism. And that's a totally different problem.

Here, equality is not "isomorphism of graded rings", but "identity of ring representations".



---

archive/issue_comments_401700.json:
```json
{
    "body": "OK, good.\nOne can still try to find more errors here: https://github.com/mkoeppe/sage/actions/runs/313251166\nbut I guess it's OK.",
    "created_at": "2020-10-19T09:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401700",
    "user": "https://github.com/dimpase"
}
```

OK, good.
One can still try to find more errors here: https://github.com/mkoeppe/sage/actions/runs/313251166
but I guess it's OK.



---

archive/issue_comments_401701.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-19T09:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401701",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_401702.json:
```json
{
    "body": "Looking good. On to #30787...?",
    "created_at": "2020-10-19T23:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401702",
    "user": "https://github.com/mkoeppe"
}
```

Looking good. On to #30787...?



---

archive/issue_events_072379.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-31T18:07:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28711#event-72379"
}
```



---

archive/issue_comments_401703.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-31T18:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28711#issuecomment-401703",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
