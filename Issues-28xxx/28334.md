# Issue 28334: py3: polynomial_rational_flint.pyx problem

archive/issues_028097.json:
```json
{
    "assignees": [],
    "body": "On some systems, Debian for example, we see this failure with Python 3:\n\n```\nFailed example:\n    G = f.galois_group(); G\nExpected:\n    Transitive group number 5 of degree 4\nGot:\n    Exception (FLINT memory_manager). Unable to allocate memory.\n    Transitive group number 5 of degree 4\n**********************************************************************\n1 item had failures:\n   1 of  16 in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.galois_group\n    [397 tests, 1 failure, 2.56 s]\n```\n\n\nCC:  @slel @sagetrac-spancratz @wbhart @fchapoton\n\nKeywords: **flint, flush**\n\nBranch/Commit: **[`ed66988`](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)**\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nReviewer: **Steven Trogdon**\n\nAuthor: **John Palmieri**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28334_\n\n",
    "closed_at": "2019-10-27T10:28:32Z",
    "created_at": "2019-08-08T17:01:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20python3"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: polynomial_rational_flint.pyx problem",
    "type": "issue",
    "updated_at": "2019-10-27T10:28:32Z",
    "url": "https://github.com/sagemath/sage/issues/28334",
    "user": "https://github.com/jhpalmieri"
}
```
On some systems, Debian for example, we see this failure with Python 3:

```
Failed example:
    G = f.galois_group(); G
Expected:
    Transitive group number 5 of degree 4
Got:
    Exception (FLINT memory_manager). Unable to allocate memory.
    Transitive group number 5 of degree 4
**********************************************************************
1 item had failures:
   1 of  16 in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.galois_group
    [397 tests, 1 failure, 2.56 s]
```


CC:  @slel @sagetrac-spancratz @wbhart @fchapoton

Keywords: **flint, flush**

Branch/Commit: **[`ed66988`](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)**

Upstream: **Fixed upstream, but not in a stable release.**

Reviewer: **Steven Trogdon**

Author: **John Palmieri**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/28334_





---

archive/issue_events_385868.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-08-08T17:01:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385868"
}
```



---

archive/issue_events_385869.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-08-08T17:01:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385869"
}
```



---

archive/issue_events_385870.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-08-08T17:01:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385870"
}
```



---

archive/issue_events_385871.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-08-08T17:01:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385871"
}
```



---

archive/issue_comments_441471.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI installed a Debian virtual machine, and now I can see this error.\n\nThis problem does not seem related to the particular doctest: if I remove lots of other doctests from that file but keep this one, the error goes away. If I instead keep the file intact and add some print statements, the error is printed as this line is executed:\n\n```\nreturn PermutationGroup(H)\n```\n`PermutationGroup` has nothing to do with flint, I think.\n\nAny ideas how to debug this?",
    "created_at": "2019-08-08T17:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441471",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

I installed a Debian virtual machine, and now I can see this error.

This problem does not seem related to the particular doctest: if I remove lots of other doctests from that file but keep this one, the error goes away. If I instead keep the file intact and add some print statements, the error is printed as this line is executed:

```
return PermutationGroup(H)
```
`PermutationGroup` has nothing to do with flint, I think.

Any ideas how to debug this?



---

archive/issue_comments_441472.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIt could be related to the problem discussed at #28106.",
    "created_at": "2019-08-08T17:22:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441472",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

It could be related to the problem discussed at #28106.



---

archive/issue_comments_441473.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@jhpalmieri](#comment:2):\n> It could be related to the problem discussed at #28106.\n\nOn the other hand, I've tried increasing the default `memlimit` in `bin/sage-runtests`, with no effect.",
    "created_at": "2019-08-08T18:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441473",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@jhpalmieri](#comment:2):
> It could be related to the problem discussed at #28106.

On the other hand, I've tried increasing the default `memlimit` in `bin/sage-runtests`, with no effect.



---

archive/issue_comments_441474.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAlso, I get the same error in a Sage session with\n\n```\nsage: from sage.doctest.control import DocTestController, DocTestDefaults\nsage: DC = DocTestController(DocTestDefaults(), ['/home/john/Sage/sage-8.9.beta5/src/sage/rings/polynomial/polynomial_rational_flint.pyx'])\nsage: DC.run()\n```\nI don't think this uses `sage-runtests` and the memory limits there. So maybe it's not the same as #28106.",
    "created_at": "2019-08-08T18:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441474",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

Also, I get the same error in a Sage session with

```
sage: from sage.doctest.control import DocTestController, DocTestDefaults
sage: DC = DocTestController(DocTestDefaults(), ['/home/john/Sage/sage-8.9.beta5/src/sage/rings/polynomial/polynomial_rational_flint.pyx'])
sage: DC.run()
```
I don't think this uses `sage-runtests` and the memory limits there. So maybe it's not the same as #28106.



---

archive/issue_comments_441475.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI added a few print statements to flint's `memory_manager.c`. This error is being printed by `flint_calloc`.",
    "created_at": "2019-08-08T20:55:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441475",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

I added a few print statements to flint's `memory_manager.c`. This error is being printed by `flint_calloc`.



---

archive/issue_comments_441476.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't have a debian machine and know nothing about flint. But John's experiment seems to indicate that the memory error is genuine. I guess somehow the polynomial_rational_flint module of sage on debian machine leaks memory.",
    "created_at": "2019-08-10T23:12:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441476",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't have a debian machine and know nothing about flint. But John's experiment seems to indicate that the memory error is genuine. I guess somehow the polynomial_rational_flint module of sage on debian machine leaks memory.



---

archive/issue_comments_441477.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.",
    "created_at": "2019-08-11T06:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441477",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

I'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.



---

archive/issue_comments_441478.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jhpalmieri](#comment:8):\n> I'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.\n\nAs reported in https://groups.google.com/d/msg/sage-release/VuAt1Sc46IQ/n9ejPwoiAwAJ, I also get the error on a Xeon E5-2623 processor (with Ubuntu 18.04).",
    "created_at": "2019-08-26T12:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441478",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jhpalmieri](#comment:8):
> I'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.

As reported in https://groups.google.com/d/msg/sage-release/VuAt1Sc46IQ/n9ejPwoiAwAJ, I also get the error on a Xeon E5-2623 processor (with Ubuntu 18.04).



---

archive/issue_comments_441479.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAccording to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...",
    "created_at": "2019-09-04T14:36:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441479",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:10" align="right">comment:10</div>

According to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...



---

archive/issue_comments_441480.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@egourgoulhon](#comment:10):\n> According to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...\n\nWell, actually it is reported as failed in\nhttps://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-54-generic/petitbonum/2019-09-03%2009:06:17?short\n\nIs this the \"reference patchbot\" for Python 3 Sage? If yes, then the table of #28298 must be updated.",
    "created_at": "2019-09-04T14:42:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441480",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@egourgoulhon](#comment:10):
> According to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...

Well, actually it is reported as failed in
https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-54-generic/petitbonum/2019-09-03%2009:06:17?short

Is this the "reference patchbot" for Python 3 Sage? If yes, then the table of #28298 must be updated.



---

archive/issue_comments_441481.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOkay, I think I know what's going on. This is the same problem as in #28454: strings are being sent to stdout by a C or C++ library but the output is not flushed, or whether it's flushed is system/OS-dependent, so messages like \"Exception (FLINT memory_manager). Unable to allocate memory.\" do not get printed when we expect them, but rather some time later. In this particular case, the message should be printed when this doctest is run:\n\n```\n        FLINT memory errors do not crash Sage (:trac:`17629`)::\n\n            sage: t^(sys.maxsize//2)\n            Traceback (most recent call last):\n            ...\n            RuntimeError: FLINT exception\n```\nin which case it's captured by the \"...\". But on some platforms, with Python 3 only, the message is not printed at the right time. (I don't know why, but this really does seem to be what's going on.)\n\nOne solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?",
    "created_at": "2019-09-09T17:28:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441481",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Okay, I think I know what's going on. This is the same problem as in #28454: strings are being sent to stdout by a C or C++ library but the output is not flushed, or whether it's flushed is system/OS-dependent, so messages like "Exception (FLINT memory_manager). Unable to allocate memory." do not get printed when we expect them, but rather some time later. In this particular case, the message should be printed when this doctest is run:

```
        FLINT memory errors do not crash Sage (:trac:`17629`)::

            sage: t^(sys.maxsize//2)
            Traceback (most recent call last):
            ...
            RuntimeError: FLINT exception
```
in which case it's captured by the "...". But on some platforms, with Python 3 only, the message is not printed at the right time. (I don't know why, but this really does seem to be what's going on.)

One solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?



---

archive/issue_comments_441482.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jhpalmieri](#comment:12):\n> One solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?\n\nI should also note that patching FLINT won't help if a user is using the system's version of FLINT. So can we do this just with Sage's FLINT interface?",
    "created_at": "2019-09-09T17:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441482",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jhpalmieri](#comment:12):
> One solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?

I should also note that patching FLINT won't help if a user is using the system's version of FLINT. So can we do this just with Sage's FLINT interface?



---

archive/issue_comments_441483.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)**",
    "created_at": "2019-09-09T18:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441483",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)**



---

archive/issue_comments_441484.json:
```json
{
    "body": "Commit: **[`d256999`](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)**",
    "created_at": "2019-09-09T18:44:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441484",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`d256999`](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)**



---

archive/issue_comments_441485.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHaving said that, here is a patch for FLINT. This fixes the problem for me. I won't mark as \"needs review\" yet, since I would like to know if there is a fix for this on the !Sage/Python side first. If that looks possible but complicated, we can use this patch as a stopgap.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9\"><code>d256999</code></a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>\n",
    "created_at": "2019-09-09T18:44:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441485",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Having said that, here is a patch for FLINT. This fixes the problem for me. I won't mark as "needs review" yet, since I would like to know if there is a fix for this on the !Sage/Python side first. If that looks possible but complicated, we can use this patch as a stopgap.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9"><code>d256999</code></a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>




---

archive/issue_comments_441486.json:
```json
{
    "body": "Changed commit from **[`d256999`](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)** to **[`b44f1ca`](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)**",
    "created_at": "2019-09-09T18:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441486",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d256999`](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)** to **[`b44f1ca`](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)**



---

archive/issue_comments_441487.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71\"><code>b44f1ca</code></a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>\n",
    "created_at": "2019-09-09T18:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441487",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71"><code>b44f1ca</code></a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>




---

archive/issue_comments_441488.json:
```json
{
    "body": "Changed commit from **[`b44f1ca`](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)** to **[`ed66988`](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)**",
    "created_at": "2019-09-09T19:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441488",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b44f1ca`](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)** to **[`ed66988`](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)**



---

archive/issue_comments_441489.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c\"><code>ed66988</code></a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>\n",
    "created_at": "2019-09-09T19:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441489",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c"><code>ed66988</code></a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>




---

archive/issue_comments_441490.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nA stupid workaround, by the way, would be to label the doctest in [comment:12](#comment:12) as `py2`. I would rather not do that.",
    "created_at": "2019-09-09T19:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441490",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

A stupid workaround, by the way, would be to label the doctest in [comment:12](#comment:12) as `py2`. I would rather not do that.



---

archive/issue_comments_441491.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI see this failure, as well as that at #28454, on a sage-on-gentoo build using py3. Of course both `flint` and `eclib` are system installed.",
    "created_at": "2019-09-09T19:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441491",
    "user": "https://github.com/strogdon"
}
```

<div id="comment:19" align="right">comment:19</div>

I see this failure, as well as that at #28454, on a sage-on-gentoo build using py3. Of course both `flint` and `eclib` are system installed.



---

archive/issue_comments_441492.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nJohn Cremona is working on a new `eclib` release, so that problem should be fixed pretty soon, without any patching needed (but after updating the system `eclib`). I don't know what to do about FLINT, if patching is not the right choice.",
    "created_at": "2019-09-09T19:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441492",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

John Cremona is working on a new `eclib` release, so that problem should be fixed pretty soon, without any patching needed (but after updating the system `eclib`). I don't know what to do about FLINT, if patching is not the right choice.



---

archive/issue_comments_441493.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think these are the options:\n\n- label one doctest as `py2`, thereby sweeping the problem under the rug\n- add a patch to flint, which won't help with system-installed copies of flint\n- convince the Python/flint interface to flush the output\n\nThe last one should be the best, but I don't know how to do it. Do we do either of the others as a stopgap, or wait?",
    "created_at": "2019-09-13T18:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441493",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

I think these are the options:

- label one doctest as `py2`, thereby sweeping the problem under the rug
- add a patch to flint, which won't help with system-installed copies of flint
- convince the Python/flint interface to flush the output

The last one should be the best, but I don't know how to do it. Do we do either of the others as a stopgap, or wait?



---

archive/issue_comments_441494.json:
```json
{
    "body": "Changed keywords from none to **flint, flush**",
    "created_at": "2019-09-15T14:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441494",
    "user": "https://github.com/slel"
}
```

Changed keywords from none to **flint, flush**



---

archive/issue_comments_441495.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\ncc-ing Bill Hart who might have some insight on this.",
    "created_at": "2019-09-15T14:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441495",
    "user": "https://github.com/slel"
}
```

<div id="comment:22" align="right">comment:22</div>

cc-ing Bill Hart who might have some insight on this.



---

archive/issue_events_385872.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-03T18:20:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385872"
}
```



---

archive/issue_events_385873.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-03T18:20:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385873"
}
```



---

archive/issue_comments_441496.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThere has been no progress on this. I'm going to mark this as \"needs review\", since the other options (new flint, or get Sage to flush flint's output) can coexist with this. As I've said before, I would welcome other solutions.",
    "created_at": "2019-10-10T14:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441496",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

There has been no progress on this. I'm going to mark this as "needs review", since the other options (new flint, or get Sage to flush flint's output) can coexist with this. As I've said before, I would welcome other solutions.



---

archive/issue_events_385874.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-10T14:47:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385874"
}
```



---

archive/issue_comments_441497.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2019-10-10T14:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441497",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_comments_441498.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nWould it help to file an issue or a pull request at https://github.com/wbhart/flint2. There are numerous locations in the `trunk` branch where code had been added of the type\n\n```\nflint_print(\"...\");\nfflush(stdout);\n```\nThen again adding a `fflush` to `memory_manager.c` may be too trivial a change prior to a major release.",
    "created_at": "2019-10-10T21:40:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441498",
    "user": "https://github.com/strogdon"
}
```

<div id="comment:25" align="right">comment:25</div>

Would it help to file an issue or a pull request at https://github.com/wbhart/flint2. There are numerous locations in the `trunk` branch where code had been added of the type

```
flint_print("...");
fflush(stdout);
```
Then again adding a `fflush` to `memory_manager.c` may be too trivial a change prior to a major release.



---

archive/issue_comments_441499.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI created a [pull request](https://github.com/wbhart/flint2/pull/585), but since the last release was four years ago, I don't have high hopes.",
    "created_at": "2019-10-10T22:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441499",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

I created a [pull request](https://github.com/wbhart/flint2/pull/585), but since the last release was four years ago, I don't have high hopes.



---

archive/issue_comments_441500.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2019-10-10T22:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441500",
    "user": "https://github.com/jhpalmieri"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_441501.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jhpalmieri](#comment:26):\n> I created a [pull request](https://github.com/wbhart/flint2/pull/585),\n> but since the last release was four years ago, I don't have high hopes.\n\nThe FLINT repo is active, and has\n[a roadmap for FLINT 2.6.0](https://github.com/wbhart/flint2/issues/517),\nitself part of\n[the Oscar roadmap](https://github.com/oscar-system/Oscar.jl/issues/1),\nso there are reasons to hope.",
    "created_at": "2019-10-10T22:51:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441501",
    "user": "https://github.com/slel"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jhpalmieri](#comment:26):
> I created a [pull request](https://github.com/wbhart/flint2/pull/585),
> but since the last release was four years ago, I don't have high hopes.

The FLINT repo is active, and has
[a roadmap for FLINT 2.6.0](https://github.com/wbhart/flint2/issues/517),
itself part of
[the Oscar roadmap](https://github.com/oscar-system/Oscar.jl/issues/1),
so there are reasons to hope.



---

archive/issue_comments_441502.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2019-10-11T00:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441502",
    "user": "https://github.com/jhpalmieri"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_441503.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThe pull request has been merged.",
    "created_at": "2019-10-11T00:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441503",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

The pull request has been merged.



---

archive/issue_comments_441504.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThis is the main remaining Py3 doctest failure. Shall we merge this, and then later hope to find a systematic way to flush output, or upgrade flint when it's ready?",
    "created_at": "2019-10-23T02:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441504",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

This is the main remaining Py3 doctest failure. Shall we merge this, and then later hope to find a systematic way to flush output, or upgrade flint when it's ready?



---

archive/issue_comments_441505.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI think we should merge it, but I'll wait for comment.",
    "created_at": "2019-10-23T02:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441505",
    "user": "https://github.com/strogdon"
}
```

<div id="comment:31" align="right">comment:31</div>

I think we should merge it, but I'll wait for comment.



---

archive/issue_comments_441506.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\n+1 to merging this. If you end up inserting \"flush\" in the interface wrappers, you'll end up flushing a lot when there's nothing to flush. Since flush is a system call, such wasteful use of resources might end up quite noticeable. Better flush at the source, where you know when it's necessary.",
    "created_at": "2019-10-23T20:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441506",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:32" align="right">comment:32</div>

+1 to merging this. If you end up inserting "flush" in the interface wrappers, you'll end up flushing a lot when there's nothing to flush. Since flush is a system call, such wasteful use of resources might end up quite noticeable. Better flush at the source, where you know when it's necessary.



---

archive/issue_events_385875.json:
```json
{
    "actor": "https://github.com/strogdon",
    "created_at": "2019-10-24T03:21:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385875"
}
```



---

archive/issue_events_385876.json:
```json
{
    "actor": "https://github.com/strogdon",
    "created_at": "2019-10-24T03:21:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385876"
}
```



---

archive/issue_comments_441507.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI'll push the button. It can always be undone.",
    "created_at": "2019-10-24T03:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441507",
    "user": "https://github.com/strogdon"
}
```

<div id="comment:33" align="right">comment:33</div>

I'll push the button. It can always be undone.



---

archive/issue_comments_441508.json:
```json
{
    "body": "Reviewer: **Steven Trogdon**",
    "created_at": "2019-10-24T03:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441508",
    "user": "https://github.com/strogdon"
}
```

Reviewer: **Steven Trogdon**



---

archive/issue_events_385877.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-24T08:40:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385877"
}
```



---

archive/issue_events_385878.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-24T08:40:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385878"
}
```



---

archive/issue_comments_441509.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSee #28649 for a followup. I still think we should merge this, especially since the patch has been accepted upstream. #28649 uses nbruin's suggestion for flushing the output when we have a non-patched FLINT.",
    "created_at": "2019-10-24T18:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441509",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

See #28649 for a followup. I still think we should merge this, especially since the patch has been accepted upstream. #28649 uses nbruin's suggestion for flushing the output when we have a non-patched FLINT.



---

archive/issue_events_385879.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-27T10:28:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385879"
}
```



---

archive/issue_events_385880.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2c7753ac60f307a174738526b3197ed0b2df1419",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-10-27T10:28:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28334#event-385880"
}
```



---

archive/issue_comments_441510.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)** to **[`ed66988`](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)**",
    "created_at": "2019-10-27T10:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28334#issuecomment-441510",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)** to **[`ed66988`](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)**
