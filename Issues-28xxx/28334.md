# Issue 28334: py3: polynomial_rational_flint.pyx problem

archive/issues_028097.json:
```json
{
    "body": "On some systems, Debian for example, we see this failure with Python 3:\n\n```\nFailed example:\n    G = f.galois_group(); G\nExpected:\n    Transitive group number 5 of degree 4\nGot:\n    Exception (FLINT memory_manager). Unable to allocate memory.\n    Transitive group number 5 of degree 4\n**********************************************************************\n1 item had failures:\n   1 of  16 in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.galois_group\n    [397 tests, 1 failure, 2.56 s]\n```\n\n\n**CC:**  @slel spancratz wbhart @fchapoton\n\n**Keywords:** flint, flush, py3\n\n**Branch/Commit:** [ed66988e948dd61850b03d8bc282e8effad0aa4c](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)\n\n**Upstream:** Fixed upstream, but not in a stable release.\n\n**Reviewer:** Steven Trogdon\n\n**Author:** John Palmieri\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28334\n\n",
    "closed_at": "2019-10-27T10:28:32Z",
    "created_at": "2019-08-08T17:01:15Z",
    "labels": [
        "component: python3",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "py3: polynomial_rational_flint.pyx problem",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28334",
    "user": "https://github.com/jhpalmieri"
}
```
On some systems, Debian for example, we see this failure with Python 3:

```
Failed example:
    G = f.galois_group(); G
Expected:
    Transitive group number 5 of degree 4
Got:
    Exception (FLINT memory_manager). Unable to allocate memory.
    Transitive group number 5 of degree 4
**********************************************************************
1 item had failures:
   1 of  16 in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.galois_group
    [397 tests, 1 failure, 2.56 s]
```


**CC:**  @slel spancratz wbhart @fchapoton

**Keywords:** flint, flush, py3

**Branch/Commit:** [ed66988e948dd61850b03d8bc282e8effad0aa4c](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)

**Upstream:** Fixed upstream, but not in a stable release.

**Reviewer:** Steven Trogdon

**Author:** John Palmieri

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/28334





---

archive/issue_comments_550927.json:
```json
{
    "body": "<a id='comment:1'></a>\nI installed a Debian virtual machine, and now I can see this error.\n\nThis problem does not seem related to the particular doctest: if I remove lots of other doctests from that file but keep this one, the error goes away. If I instead keep the file intact and add some print statements, the error is printed as this line is executed:\n\n```\nreturn PermutationGroup(H)\n```\n`PermutationGroup` has nothing to do with flint, I think.\n\nAny ideas how to debug this?",
    "created_at": "2019-08-08T17:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550927",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
I installed a Debian virtual machine, and now I can see this error.

This problem does not seem related to the particular doctest: if I remove lots of other doctests from that file but keep this one, the error goes away. If I instead keep the file intact and add some print statements, the error is printed as this line is executed:

```
return PermutationGroup(H)
```
`PermutationGroup` has nothing to do with flint, I think.

Any ideas how to debug this?



---

archive/issue_comments_550928.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt could be related to the problem discussed at #28106.",
    "created_at": "2019-08-08T17:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550928",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
It could be related to the problem discussed at #28106.



---

archive/issue_comments_550929.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [jhpalmieri](#comment%3A2):\n> It could be related to the problem discussed at #28106.\n\n\nOn the other hand, I've tried increasing the default `memlimit` in `bin/sage-runtests`, with no effect.",
    "created_at": "2019-08-08T18:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550929",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
Replying to [jhpalmieri](#comment%3A2):
> It could be related to the problem discussed at #28106.


On the other hand, I've tried increasing the default `memlimit` in `bin/sage-runtests`, with no effect.



---

archive/issue_comments_550930.json:
```json
{
    "body": "<a id='comment:4'></a>\nAlso, I get the same error in a Sage session with\n\n```\nsage: from sage.doctest.control import DocTestController, DocTestDefaults\nsage: DC = DocTestController(DocTestDefaults(), ['/home/john/Sage/sage-8.9.beta5/src/sage/rings/polynomial/polynomial_rational_flint.pyx'])\nsage: DC.run()\n```\nI don't think this uses `sage-runtests` and the memory limits there. So maybe it's not the same as #28106.",
    "created_at": "2019-08-08T18:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550930",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Also, I get the same error in a Sage session with

```
sage: from sage.doctest.control import DocTestController, DocTestDefaults
sage: DC = DocTestController(DocTestDefaults(), ['/home/john/Sage/sage-8.9.beta5/src/sage/rings/polynomial/polynomial_rational_flint.pyx'])
sage: DC.run()
```
I don't think this uses `sage-runtests` and the memory limits there. So maybe it's not the same as #28106.



---

archive/issue_comments_550931.json:
```json
{
    "body": "<a id='comment:5'></a>\nI added a few print statements to flint's `memory_manager.c`. This error is being printed by `flint_calloc`.",
    "created_at": "2019-08-08T20:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550931",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
I added a few print statements to flint's `memory_manager.c`. This error is being printed by `flint_calloc`.



---

archive/issue_comments_550932.json:
```json
{
    "body": "<a id='comment:6'></a>\nI don't have a debian machine and know nothing about flint. But John's experiment seems to indicate that the memory error is genuine. I guess somehow the polynomial_rational_flint module of sage on debian machine leaks memory.",
    "created_at": "2019-08-10T23:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550932",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:6'></a>
I don't have a debian machine and know nothing about flint. But John's experiment seems to indicate that the memory error is genuine. I guess somehow the polynomial_rational_flint module of sage on debian machine leaks memory.



---

archive/issue_comments_550933.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.",
    "created_at": "2019-08-11T06:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550933",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
I'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.



---

archive/issue_comments_550934.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jhpalmieri](#comment%3A8):\n> I'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.\n\n\nAs reported in https://groups.google.com/d/msg/sage-release/VuAt1Sc46IQ/n9ejPwoiAwAJ, I also get the error on a Xeon E5-2623 processor (with Ubuntu 18.04).",
    "created_at": "2019-08-26T12:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550934",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>
Replying to [jhpalmieri](#comment%3A8):
> I'm seeing this on an Ubuntu virtual machine (running on the same OS X box). I wonder if it's the processor as much as which type of linux is running. This machine has a Core i7 processor.


As reported in https://groups.google.com/d/msg/sage-release/VuAt1Sc46IQ/n9ejPwoiAwAJ, I also get the error on a Xeon E5-2623 processor (with Ubuntu 18.04).



---

archive/issue_comments_550935.json:
```json
{
    "body": "<a id='comment:10'></a>\nAccording to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...",
    "created_at": "2019-09-04T14:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550935",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:10'></a>
According to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...



---

archive/issue_comments_550936.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [egourgoulhon](#comment%3A10):\n> According to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...\n\nWell, actually it is reported as failed in\nhttps://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-54-generic/petitbonum/2019-09-03%2009:06:17?short\n\nIs this the \"reference patchbot\" for Python 3 Sage? If yes, then the table of #28298 must be updated.",
    "created_at": "2019-09-04T14:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550936",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>
Replying to [egourgoulhon](#comment%3A10):
> According to the entry (G) in the summary table of #28298, the doctest discussed here is passed on the reference patchbot, which is a Ubuntu machine though...

Well, actually it is reported as failed in
https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-54-generic/petitbonum/2019-09-03%2009:06:17?short

Is this the "reference patchbot" for Python 3 Sage? If yes, then the table of #28298 must be updated.



---

archive/issue_comments_550937.json:
```json
{
    "body": "<a id='comment:12'></a>\nOkay, I think I know what's going on. This is the same problem as in #28454: strings are being sent to stdout by a C or C++ library but the output is not flushed, or whether it's flushed is system/OS-dependent, so messages like \"Exception (FLINT memory_manager). Unable to allocate memory.\" do not get printed when we expect them, but rather some time later. In this particular case, the message should be printed when this doctest is run:\n\n```\n        FLINT memory errors do not crash Sage (:trac:`17629`)::\n\n            sage: t^(sys.maxsize//2)\n            Traceback (most recent call last):\n            ...\n            RuntimeError: FLINT exception\n```\nin which case it's captured by the \"...\". But on some platforms, with Python 3 only, the message is not printed at the right time. (I don't know why, but this really does seem to be what's going on.)\n\nOne solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?",
    "created_at": "2019-09-09T17:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550937",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Okay, I think I know what's going on. This is the same problem as in #28454: strings are being sent to stdout by a C or C++ library but the output is not flushed, or whether it's flushed is system/OS-dependent, so messages like "Exception (FLINT memory_manager). Unable to allocate memory." do not get printed when we expect them, but rather some time later. In this particular case, the message should be printed when this doctest is run:

```
        FLINT memory errors do not crash Sage (:trac:`17629`)::

            sage: t^(sys.maxsize//2)
            Traceback (most recent call last):
            ...
            RuntimeError: FLINT exception
```
in which case it's captured by the "...". But on some platforms, with Python 3 only, the message is not printed at the right time. (I don't know why, but this really does seem to be what's going on.)

One solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?



---

archive/issue_comments_550938.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> One solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?\n\n\nI should also note that patching FLINT won't help if a user is using the system's version of FLINT. So can we do this just with Sage's FLINT interface?",
    "created_at": "2019-09-09T17:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550938",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
Replying to [jhpalmieri](#comment%3A12):
> One solution would be to modify FLINT to flush the output. Is there a pure Python 3 solution, which we can incorporate in the Sage library without patching or modifying FLINT?


I should also note that patching FLINT won't help if a user is using the system's version of FLINT. So can we do this just with Sage's FLINT interface?



---

archive/issue_comments_550939.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)",
    "created_at": "2019-09-09T18:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550939",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)



---

archive/issue_comments_550940.json:
```json
{
    "body": "**Commit:** [d256999e0711075497d6ab54f8e91a20556a6ce9](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)",
    "created_at": "2019-09-09T18:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550940",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [d256999e0711075497d6ab54f8e91a20556a6ce9](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)



---

archive/issue_comments_550941.json:
```json
{
    "body": "<a id='comment:15'></a>\nHaving said that, here is a patch for FLINT. This fixes the problem for me. I won't mark as \"needs review\" yet, since I would like to know if there is a fix for this on the !Sage/Python side first. If that looks possible but complicated, we can use this patch as a stopgap.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9\">d256999</a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>\n",
    "created_at": "2019-09-09T18:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550941",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
Having said that, here is a patch for FLINT. This fixes the problem for me. I won't mark as "needs review" yet, since I would like to know if there is a fix for this on the !Sage/Python side first. If that looks possible but complicated, we can use this patch as a stopgap.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9">d256999</a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>




---

archive/issue_comments_550942.json:
```json
{
    "body": "**Changing commit** from \"[d256999e0711075497d6ab54f8e91a20556a6ce9](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)\" to \"[b44f1cac24196ee496cf0805d237f7850d618f71](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)\".",
    "created_at": "2019-09-09T18:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550942",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d256999e0711075497d6ab54f8e91a20556a6ce9](https://github.com/sagemath/sagetrac-mirror/commit/d256999e0711075497d6ab54f8e91a20556a6ce9)" to "[b44f1cac24196ee496cf0805d237f7850d618f71](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)".



---

archive/issue_comments_550943.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71\">b44f1ca</a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>\n",
    "created_at": "2019-09-09T18:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550943",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71">b44f1ca</a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>




---

archive/issue_comments_550944.json:
```json
{
    "body": "**Changing commit** from \"[b44f1cac24196ee496cf0805d237f7850d618f71](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)\" to \"[ed66988e948dd61850b03d8bc282e8effad0aa4c](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)\".",
    "created_at": "2019-09-09T19:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b44f1cac24196ee496cf0805d237f7850d618f71](https://github.com/sagemath/sagetrac-mirror/commit/b44f1cac24196ee496cf0805d237f7850d618f71)" to "[ed66988e948dd61850b03d8bc282e8effad0aa4c](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)".



---

archive/issue_comments_550945.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c\">ed66988</a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>\n",
    "created_at": "2019-09-09T19:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c">ed66988</a></td><td><code>trac 28334: patch FLINT to flush output when printing memory error message</code></td></tr></table>




---

archive/issue_comments_550946.json:
```json
{
    "body": "<a id='comment:18'></a>\nA stupid workaround, by the way, would be to label the doctest in[comment:12](#comment%3A12) as `py2`. I would rather not do that.",
    "created_at": "2019-09-09T19:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550946",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
A stupid workaround, by the way, would be to label the doctest in[comment:12](#comment%3A12) as `py2`. I would rather not do that.



---

archive/issue_comments_550947.json:
```json
{
    "body": "<a id='comment:19'></a>\nI see this failure, as well as that at #28454, on a sage-on-gentoo build using py3. Of course both `flint` and `eclib` are system installed.",
    "created_at": "2019-09-09T19:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550947",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:19'></a>
I see this failure, as well as that at #28454, on a sage-on-gentoo build using py3. Of course both `flint` and `eclib` are system installed.



---

archive/issue_comments_550948.json:
```json
{
    "body": "<a id='comment:20'></a>\nJohn Cremona is working on a new `eclib` release, so that problem should be fixed pretty soon, without any patching needed (but after updating the system `eclib`). I don't know what to do about FLINT, if patching is not the right choice.",
    "created_at": "2019-09-09T19:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550948",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
John Cremona is working on a new `eclib` release, so that problem should be fixed pretty soon, without any patching needed (but after updating the system `eclib`). I don't know what to do about FLINT, if patching is not the right choice.



---

archive/issue_comments_550949.json:
```json
{
    "body": "<a id='comment:21'></a>\nI think these are the options:\n\n- label one doctest as `py2`, thereby sweeping the problem under the rug\n- add a patch to flint, which won't help with system-installed copies of flint\n- convince the Python/flint interface to flush the output\n\nThe last one should be the best, but I don't know how to do it. Do we do either of the others as a stopgap, or wait?",
    "created_at": "2019-09-13T18:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550949",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>
I think these are the options:

- label one doctest as `py2`, thereby sweeping the problem under the rug
- add a patch to flint, which won't help with system-installed copies of flint
- convince the Python/flint interface to flush the output

The last one should be the best, but I don't know how to do it. Do we do either of the others as a stopgap, or wait?



---

archive/issue_comments_550950.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"flint, flush, py3\".",
    "created_at": "2019-09-15T14:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550950",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "flint, flush, py3".



---

archive/issue_comments_550951.json:
```json
{
    "body": "<a id='comment:22'></a>\ncc-ing Bill Hart who might have some insight on this.",
    "created_at": "2019-09-15T14:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550951",
    "user": "https://github.com/slel"
}
```

<a id='comment:22'></a>
cc-ing Bill Hart who might have some insight on this.



---

archive/issue_comments_550952.json:
```json
{
    "body": "<a id='comment:24'></a>\nThere has been no progress on this. I'm going to mark this as \"needs review\", since the other options (new flint, or get Sage to flush flint's output) can coexist with this. As I've said before, I would welcome other solutions.",
    "created_at": "2019-10-10T14:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550952",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>
There has been no progress on this. I'm going to mark this as "needs review", since the other options (new flint, or get Sage to flush flint's output) can coexist with this. As I've said before, I would welcome other solutions.



---

archive/issue_comments_550953.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-10-10T14:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550953",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_550954.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2019-10-10T14:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550954",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** John Palmieri



---

archive/issue_comments_550955.json:
```json
{
    "body": "<a id='comment:25'></a>\nWould it help to file an issue or a pull request at https://github.com/wbhart/flint2. There are numerous locations in the `trunk` branch where code had been added of the type\n\n```\nflint_print(\"...\");\nfflush(stdout);\n```\nThen again adding a `fflush` to `memory_manager.c` may be too trivial a change prior to a major release.",
    "created_at": "2019-10-10T21:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550955",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:25'></a>
Would it help to file an issue or a pull request at https://github.com/wbhart/flint2. There are numerous locations in the `trunk` branch where code had been added of the type

```
flint_print("...");
fflush(stdout);
```
Then again adding a `fflush` to `memory_manager.c` may be too trivial a change prior to a major release.



---

archive/issue_comments_550956.json:
```json
{
    "body": "<a id='comment:26'></a>\nI created a [pull request](https://github.com/wbhart/flint2/pull/585), but since the last release was four years ago, I don't have high hopes.",
    "created_at": "2019-10-10T22:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550956",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
I created a [pull request](https://github.com/wbhart/flint2/pull/585), but since the last release was four years ago, I don't have high hopes.



---

archive/issue_comments_550957.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2019-10-10T22:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550957",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing upstream** from "N/A" to "Reported upstream. No feedback yet.".



---

archive/issue_comments_550958.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A26):\n> I created a [pull request](https://github.com/wbhart/flint2/pull/585),\n> but since the last release was four years ago, I don't have high hopes.\n\n\nThe FLINT repo is active, and has\n[a roadmap for FLINT 2.6.0](https://github.com/wbhart/flint2/issues/517),\nitself part of\n[the Oscar roadmap](https://github.com/oscar-system/Oscar.jl/issues/1),\nso there are reasons to hope.",
    "created_at": "2019-10-10T22:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550958",
    "user": "https://github.com/slel"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A26):
> I created a [pull request](https://github.com/wbhart/flint2/pull/585),
> but since the last release was four years ago, I don't have high hopes.


The FLINT repo is active, and has
[a roadmap for FLINT 2.6.0](https://github.com/wbhart/flint2/issues/517),
itself part of
[the Oscar roadmap](https://github.com/oscar-system/Oscar.jl/issues/1),
so there are reasons to hope.



---

archive/issue_comments_550959.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2019-10-11T00:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550959",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_550960.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe pull request has been merged.",
    "created_at": "2019-10-11T00:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550960",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
The pull request has been merged.



---

archive/issue_comments_550961.json:
```json
{
    "body": "<a id='comment:29'></a>\nThis is the main remaining Py3 doctest failure. Shall we merge this, and then later hope to find a systematic way to flush output, or upgrade flint when it's ready?",
    "created_at": "2019-10-23T02:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550961",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
This is the main remaining Py3 doctest failure. Shall we merge this, and then later hope to find a systematic way to flush output, or upgrade flint when it's ready?



---

archive/issue_comments_550962.json:
```json
{
    "body": "<a id='comment:31'></a>\nI think we should merge it, but I'll wait for comment.",
    "created_at": "2019-10-23T02:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550962",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:31'></a>
I think we should merge it, but I'll wait for comment.



---

archive/issue_comments_550963.json:
```json
{
    "body": "<a id='comment:32'></a>\n+1 to merging this. If you end up inserting \"flush\" in the interface wrappers, you'll end up flushing a lot when there's nothing to flush. Since flush is a system call, such wasteful use of resources might end up quite noticeable. Better flush at the source, where you know when it's necessary.",
    "created_at": "2019-10-23T20:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550963",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:32'></a>
+1 to merging this. If you end up inserting "flush" in the interface wrappers, you'll end up flushing a lot when there's nothing to flush. Since flush is a system call, such wasteful use of resources might end up quite noticeable. Better flush at the source, where you know when it's necessary.



---

archive/issue_comments_550964.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-10-24T03:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550964",
    "user": "https://github.com/strogdon"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_550965.json:
```json
{
    "body": "<a id='comment:33'></a>\nI'll push the button. It can always be undone.",
    "created_at": "2019-10-24T03:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550965",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:33'></a>
I'll push the button. It can always be undone.



---

archive/issue_comments_550966.json:
```json
{
    "body": "**Reviewer:** Steven Trogdon",
    "created_at": "2019-10-24T03:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550966",
    "user": "https://github.com/strogdon"
}
```

**Reviewer:** Steven Trogdon



---

archive/issue_events_080067.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-24T08:40:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28334#event-80067"
}
```



---

archive/issue_comments_550967.json:
```json
{
    "body": "<a id='comment:35'></a>\nSee #28649 for a followup. I still think we should merge this, especially since the patch has been accepted upstream. #28649 uses nbruin's suggestion for flushing the output when we have a non-patched FLINT.",
    "created_at": "2019-10-24T18:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550967",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>
See #28649 for a followup. I still think we should merge this, especially since the patch has been accepted upstream. #28649 uses nbruin's suggestion for flushing the output when we have a non-patched FLINT.



---

archive/issue_comments_550968.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2019-10-27T10:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550968",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_080068.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-27T10:28:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28334#event-80068"
}
```



---

archive/issue_comments_550969.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)\" to \"[ed66988e948dd61850b03d8bc282e8effad0aa4c](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)\".",
    "created_at": "2019-10-27T10:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28334#issuecomment-550969",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jhpalmieri/flint-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/flint-flush)" to "[ed66988e948dd61850b03d8bc282e8effad0aa4c](https://github.com/sagemath/sagetrac-mirror/commit/ed66988e948dd61850b03d8bc282e8effad0aa4c)".
