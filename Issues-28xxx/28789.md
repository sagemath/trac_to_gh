# Issue 28789: Zeta functions of hyperelliptic curves giving wrong answers

archive/issues_028552.json:
```json
{
    "body": "Example from 9.0.beta5:\n\n```\nsage: P.<x> = PolynomialRing(GF(3))\nsage: u = x^10 + x^9 + x^8 + x\nsage: C = HyperellipticCurve(u)\nsage: C.frobenius_polynomial()\nx^8 + 731*x^7 + 6*x^6 - 720*x^5 + 18*x^4 - 2160*x^3 + 54*x^2 + 19737*x + 81\n```\nThis is being computed using Pari, but actually gp gives the correct answer:\n\n```\n? u = Mod(1,3)*(x^10 + x^9 + x^8 + x)\n? hyperellcharpoly(u)\n%1 = x^8 + 2*x^7 + 6*x^6 + 9*x^5 + 18*x^4 + 27*x^3 + 54*x^2 + 54*x + 81\n```\nSince the `x^7` term is off by `3^6`, this is presumably an issue with not enough p-adic precision in the Frobenius matrix we are getting from Pari.\n\nCC:  @roed314\n\nKeywords: hyperelliptic curves, zeta functions\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Kiran Kedlaya\n\nBranch: 7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3\n\nDependencies: #28840\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28789\n\n",
    "closed_at": "2019-12-16T23:15:09Z",
    "created_at": "2019-11-22T19:54:15Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Zeta functions of hyperelliptic curves giving wrong answers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28789",
    "user": "https://github.com/kedlaya"
}
```
Example from 9.0.beta5:

```
sage: P.<x> = PolynomialRing(GF(3))
sage: u = x^10 + x^9 + x^8 + x
sage: C = HyperellipticCurve(u)
sage: C.frobenius_polynomial()
x^8 + 731*x^7 + 6*x^6 - 720*x^5 + 18*x^4 - 2160*x^3 + 54*x^2 + 19737*x + 81
```
This is being computed using Pari, but actually gp gives the correct answer:

```
? u = Mod(1,3)*(x^10 + x^9 + x^8 + x)
? hyperellcharpoly(u)
%1 = x^8 + 2*x^7 + 6*x^6 + 9*x^5 + 18*x^4 + 27*x^3 + 54*x^2 + 54*x + 81
```
Since the `x^7` term is off by `3^6`, this is presumably an issue with not enough p-adic precision in the Frobenius matrix we are getting from Pari.

CC:  @roed314

Keywords: hyperelliptic curves, zeta functions

Upstream: Fixed upstream, in a later stable release.

Reviewer: Frédéric Chapoton

Author: Kiran Kedlaya

Branch: 7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3

Dependencies: #28840

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28789





---

archive/issue_comments_552015.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt looks like this was a bug which was just fixed upstream: I can reproduce the bug in gp version 2.11.1, but I get the correct answer in 2.11.2 (which is what I originally tried). So a simple Pari update should suffice.",
    "created_at": "2019-11-22T21:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552015",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:1'></a>
It looks like this was a bug which was just fixed upstream: I can reproduce the bug in gp version 2.11.1, but I get the correct answer in 2.11.2 (which is what I originally tried). So a simple Pari update should suffice.



---

archive/issue_comments_552016.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Fixed upstream, in a later stable release.\"",
    "created_at": "2019-11-22T21:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552016",
    "user": "https://github.com/kedlaya"
}
```

Changing upstream from "N/A" to "Fixed upstream, in a later stable release."



---

archive/issue_comments_552017.json:
```json
{
    "body": "<a id='comment:2'></a>\nSee #28424 for a Pari upgrade ticket that would resolve this issue.",
    "created_at": "2019-11-25T00:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552017",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:2'></a>
See #28424 for a Pari upgrade ticket that would resolve this issue.



---

archive/issue_comments_552018.json:
```json
{
    "body": "<a id='comment:3'></a>\n#28424 is somewhat exploratory to check for broken stuff. Of course we have gone on the pari git branch in the past when Jeroen was after new features.\n\nBut #28424 shouldn't prevent you from making this ticket an upgrade to 2.11.2 to fix your issue. If that make fell you better most sage-on-distros are probably already using 2.11.2 without reported side effects (apart from getting the right answer in the problem pointed out by this ticket - I know I do in sage-on-gentoo).",
    "created_at": "2019-12-03T20:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552018",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
#28424 is somewhat exploratory to check for broken stuff. Of course we have gone on the pari git branch in the past when Jeroen was after new features.

But #28424 shouldn't prevent you from making this ticket an upgrade to 2.11.2 to fix your issue. If that make fell you better most sage-on-distros are probably already using 2.11.2 without reported side effects (apart from getting the right answer in the problem pointed out by this ticket - I know I do in sage-on-gentoo).



---

archive/issue_comments_552019.json:
```json
{
    "body": "<a id='comment:4'></a>\nOK, so let's make this a ticket to upgrade Pari to 2.11.2. Unfortunately, updating an spkg falls outside of my expertise; but it should be trivial for someone more familiar with the build system.",
    "created_at": "2019-12-04T07:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552019",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:4'></a>
OK, so let's make this a ticket to upgrade Pari to 2.11.2. Unfortunately, updating an spkg falls outside of my expertise; but it should be trivial for someone more familiar with the build system.



---

archive/issue_comments_552020.json:
```json
{
    "body": "<a id='comment:5'></a>\nI have made #28840 for the upgrade to pari 2.11.2",
    "created_at": "2019-12-04T12:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552020",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
I have made #28840 for the upgrade to pari 2.11.2



---

archive/issue_comments_552021.json:
```json
{
    "body": "<a id='comment:6'></a>\nNow that #28840 is in, it would be nice to add the example from this ticket\nas a doctest in Sage's documentation. Something like:\n\n```\nCheck that :trac:`28789` is fixed::\n\n    sage: P.<x> = PolynomialRing(GF(3))\n    sage: u = x^10 + x^9 + x^8 + x\n    sage: C = HyperellipticCurve(u)\n    sage: C.frobenius_polynomial()\n    x^8 + 2*x^7 + 6*x^6 + 9*x^5 + 18*x^4 + 27*x^3 + 54*x^2 + 54*x + 81\n```",
    "created_at": "2019-12-09T05:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552021",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>
Now that #28840 is in, it would be nice to add the example from this ticket
as a doctest in Sage's documentation. Something like:

```
Check that :trac:`28789` is fixed::

    sage: P.<x> = PolynomialRing(GF(3))
    sage: u = x^10 + x^9 + x^8 + x
    sage: C = HyperellipticCurve(u)
    sage: C.frobenius_polynomial()
    x^8 + 2*x^7 + 6*x^6 + 9*x^5 + 18*x^4 + 27*x^3 + 54*x^2 + 54*x + 81
```



---

archive/issue_comments_552022.json:
```json
{
    "body": "Changing branch from \"\" to \"u/kedlaya/zeta_functions_of_hyperelliptic_curves_giving_wrong_answers\"",
    "created_at": "2019-12-11T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552022",
    "user": "https://github.com/kedlaya"
}
```

Changing branch from "" to "u/kedlaya/zeta_functions_of_hyperelliptic_curves_giving_wrong_answers"



---

archive/issue_comments_552023.json:
```json
{
    "body": "Changing commit from \"\" to \"7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3\"",
    "created_at": "2019-12-11T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552023",
    "user": "https://github.com/kedlaya"
}
```

Changing commit from "" to "7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3"



---

archive/issue_comments_552024.json:
```json
{
    "body": "Changing dependencies from \"\" to \"28840\"",
    "created_at": "2019-12-11T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552024",
    "user": "https://github.com/kedlaya"
}
```

Changing dependencies from "" to "28840"



---

archive/issue_comments_552025.json:
```json
{
    "body": "Changing author from \"\" to \"Kiran Kedlaya\"",
    "created_at": "2019-12-11T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552025",
    "user": "https://github.com/kedlaya"
}
```

Changing author from "" to "Kiran Kedlaya"



---

archive/issue_comments_552026.json:
```json
{
    "body": "Changing keywords from \"\" to \"hyperelliptic curves, zeta functions\".",
    "created_at": "2019-12-11T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552026",
    "user": "https://github.com/kedlaya"
}
```

Changing keywords from "" to "hyperelliptic curves, zeta functions".



---

archive/issue_comments_552027.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-11T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552027",
    "user": "https://github.com/kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_552028.json:
```json
{
    "body": "<a id='comment:8'></a>\nAgreed! I doctested both `frobenius_polynomial` and `frobenius_polynomial_pari`.\n\n---\nNew commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[7eb3cd1](https://github.com/sagemath/sagetrac-mirror/commit/7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3)|`Add doctests re 28789`|",
    "created_at": "2019-12-11T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552028",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:8'></a>
Agreed! I doctested both `frobenius_polynomial` and `frobenius_polynomial_pari`.

---
New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[7eb3cd1](https://github.com/sagemath/sagetrac-mirror/commit/7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3)|`Add doctests re 28789`|



---

archive/issue_comments_552029.json:
```json
{
    "body": "<a id='comment:9'></a>\nok, good to go. Thanks",
    "created_at": "2019-12-11T19:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552029",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
ok, good to go. Thanks



---

archive/issue_comments_552030.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-11T19:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552030",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_552031.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2019-12-11T19:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552031",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_552032.json:
```json
{
    "body": "Changing branch from \"u/kedlaya/zeta_functions_of_hyperelliptic_curves_giving_wrong_answers\" to \"7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3\"",
    "created_at": "2019-12-16T23:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552032",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/kedlaya/zeta_functions_of_hyperelliptic_curves_giving_wrong_answers" to "7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3"



---

archive/issue_events_090017.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-16T23:15:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28789#event-90017"
}
```



---

archive/issue_comments_552033.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-16T23:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552033",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_552034.json:
```json
{
    "body": "<a id='comment:11'></a>\nPossibly related problem reported on sage-support with Sage 9.0:\n\n- https://groups.google.com/d/topic/sage-support/JpbRY1HLEE8/discussion",
    "created_at": "2020-01-10T18:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552034",
    "user": "https://github.com/slel"
}
```

<a id='comment:11'></a>
Possibly related problem reported on sage-support with Sage 9.0:

- https://groups.google.com/d/topic/sage-support/JpbRY1HLEE8/discussion



---

archive/issue_comments_552035.json:
```json
{
    "body": "Changing commit from \"7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3\" to \"\"",
    "created_at": "2020-01-10T18:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552035",
    "user": "https://github.com/slel"
}
```

Changing commit from "7eb3cd1d9f73b7b49e653545e56002cd75d3e0e3" to ""



---

archive/issue_comments_552036.json:
```json
{
    "body": "Changing dependencies from \"28840\" to \"#28840\"",
    "created_at": "2020-01-10T18:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28789#issuecomment-552036",
    "user": "https://github.com/slel"
}
```

Changing dependencies from "28840" to "#28840"
