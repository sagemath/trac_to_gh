# Issue 28879: spkg-configure for GSL

archive/issues_028642.json:
```json
{
    "body": "\n\nCC:  @embray @kiwifb @isuruf @mkoeppe\n\nBranch/Commit: a18059933c6b6ecfe4e98a7c8e1ca6de3dc223c8\n\nWork_Issues: install modified gsl.pc\n\nReviewer: Isuru Fernando\n\nAuthor: Dima Pasechnik\n\nDependencies: #27870\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28879\n\n",
    "closed_at": "2020-01-09T23:44:29Z",
    "created_at": "2019-12-13T14:42:14Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "spkg-configure for GSL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28879",
    "user": "https://github.com/dimpase"
}
```


CC:  @embray @kiwifb @isuruf @mkoeppe

Branch/Commit: a18059933c6b6ecfe4e98a7c8e1ca6de3dc223c8

Work_Issues: install modified gsl.pc

Reviewer: Isuru Fernando

Author: Dima Pasechnik

Dependencies: #27870

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28879





---

archive/issue_comments_560764.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-12-14T10:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560764",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_560765.json:
```json
{
    "body": "Changing commit from \"f8833aa8b98fadbb8f060e112ba4ef3638a5421d\" to \"3a95431674d81d946926d0553d0f70b0d77654a4\"",
    "created_at": "2019-12-14T10:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f8833aa8b98fadbb8f060e112ba4ef3638a5421d" to "3a95431674d81d946926d0553d0f70b0d77654a4"



---

archive/issue_comments_560766.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-14T22:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560766",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_560767.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-12-14T22:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560767",
    "user": "https://github.com/dimpase"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_560768.json:
```json
{
    "body": "<a id='comment:4'></a>Did you check this with an underlinked GSL (A blas library is not linked in) or a fully linked one like Sage's GSL?",
    "created_at": "2019-12-14T23:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560768",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:4'></a>Did you check this with an underlinked GSL (A blas library is not linked in) or a fully linked one like Sage's GSL?



---

archive/issue_comments_560769.json:
```json
{
    "body": "Changing commit from \"3a95431674d81d946926d0553d0f70b0d77654a4\" to \"137c97252c15455b1d0e8c8d81929b4a21e722b2\"",
    "created_at": "2019-12-14T23:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3a95431674d81d946926d0553d0f70b0d77654a4" to "137c97252c15455b1d0e8c8d81929b4a21e722b2"



---

archive/issue_comments_560770.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-14T23:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_560771.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [isuruf](#comment%3A4):\n> Did you check this with an underlinked GSL (A blas library is not linked in) or a fully linked one like Sage's GSL?\n\n\nOnly on debian and gentoo, where it's linked to its own gslcblas",
    "created_at": "2019-12-15T00:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560771",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>Replying to [isuruf](#comment%3A4):
> Did you check this with an underlinked GSL (A blas library is not linked in) or a fully linked one like Sage's GSL?


Only on debian and gentoo, where it's linked to its own gslcblas



---

archive/issue_comments_560772.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [dimpase](#comment%3A6):\n> Replying to [isuruf](#comment%3A4):\n> > Did you check this with an underlinked GSL (A blas library is not linked in) or a fully linked one like Sage's GSL?\n\n> \n> Only on debian and gentoo, where it's linked to its own gslcblas\n\n\nNot on my gentoo box, but that would be the default. In any case neither debian or gentoo will ship it underlinked. I don't think any major distro ship underlinked libraries. OK as much as they can help it. Stuff that people build themselves is another story",
    "created_at": "2019-12-15T00:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560772",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>Replying to [dimpase](#comment%3A6):
> Replying to [isuruf](#comment%3A4):
> > Did you check this with an underlinked GSL (A blas library is not linked in) or a fully linked one like Sage's GSL?

> 
> Only on debian and gentoo, where it's linked to its own gslcblas


Not on my gentoo box, but that would be the default. In any case neither debian or gentoo will ship it underlinked. I don't think any major distro ship underlinked libraries. OK as much as they can help it. Stuff that people build themselves is another story



---

archive/issue_comments_560773.json:
```json
{
    "body": "<a id='comment:8'></a>What happens when `gslcblas` and `openblas` are both linked in?",
    "created_at": "2019-12-15T01:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560773",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:8'></a>What happens when `gslcblas` and `openblas` are both linked in?



---

archive/issue_comments_560774.json:
```json
{
    "body": "<a id='comment:9'></a>A bit pathological, but basically nothing visible until you test something with a high precision where there can be divergences between the two. \nIf you run GSL test suite with openblas rather than gslcblas you'll get failures of the numerical noise kind.\n\nHonestly, I am not sure which one would be used. My guess would be the first one on the list of libraries linked.",
    "created_at": "2019-12-15T01:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560774",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>A bit pathological, but basically nothing visible until you test something with a high precision where there can be divergences between the two. 
If you run GSL test suite with openblas rather than gslcblas you'll get failures of the numerical noise kind.

Honestly, I am not sure which one would be used. My guess would be the first one on the list of libraries linked.



---

archive/issue_comments_560775.json:
```json
{
    "body": "<a id='comment:10'></a>Okay. Another concern is when system's `gsl.pc` is used by downstream packages, they'll be linking to `gslcblas` instead of `openblas`, but sage's `gsl.pc` would link the downstream package to `openblas`.",
    "created_at": "2019-12-15T01:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560775",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:10'></a>Okay. Another concern is when system's `gsl.pc` is used by downstream packages, they'll be linking to `gslcblas` instead of `openblas`, but sage's `gsl.pc` would link the downstream package to `openblas`.



---

archive/issue_comments_560776.json:
```json
{
    "body": "<a id='comment:11'></a>\n```\nfbissey@moonloop ~ $  cat /usr/lib64/pkgconfig/gsl.pc \nprefix=/usr\nexec_prefix=/usr\nlibdir=/usr/lib64\nincludedir=/usr/include\nGSL_CBLAS_LIB=-lcblas\n\nName: GSL\nDescription: GNU Scientific Library\nVersion: 2.5\nLibs: -L/usr/lib64 -lgsl ${GSL_CBLAS_LIB} -lm -lm \nCflags: -I/usr/include\n```\ndistro will usually patch gsl.pc to match the linking they are doing. Supposing that libgsl is linked with cblas1 and sage tries to link extensions gslext.pyx using libgsl to cblas2. If there are direct call to cblas in glsext.pyx, cblas2 will be used for these, otherwise -lcblas2 will be ignored. If there is no direct calls to cblas in gslext.pyx, libgsl will use cblas1, since cblas2 will be discarded. If cblas2 is not discarded because there are calls to cblas in gslext.pyx what you get in libgsl is not clearly defined and may depend on what is loaded first.",
    "created_at": "2019-12-15T01:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560776",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
```
fbissey@moonloop ~ $  cat /usr/lib64/pkgconfig/gsl.pc 
prefix=/usr
exec_prefix=/usr
libdir=/usr/lib64
includedir=/usr/include
GSL_CBLAS_LIB=-lcblas

Name: GSL
Description: GNU Scientific Library
Version: 2.5
Libs: -L/usr/lib64 -lgsl ${GSL_CBLAS_LIB} -lm -lm 
Cflags: -I/usr/include
```
distro will usually patch gsl.pc to match the linking they are doing. Supposing that libgsl is linked with cblas1 and sage tries to link extensions gslext.pyx using libgsl to cblas2. If there are direct call to cblas in glsext.pyx, cblas2 will be used for these, otherwise -lcblas2 will be ignored. If there is no direct calls to cblas in gslext.pyx, libgsl will use cblas1, since cblas2 will be discarded. If cblas2 is not discarded because there are calls to cblas in gslext.pyx what you get in libgsl is not clearly defined and may depend on what is loaded first.



---

archive/issue_comments_560777.json:
```json
{
    "body": "<a id='comment:12'></a>On Ubuntu,\n\n```\n(base) isuru@isuru:~$ cat /usr/lib/x86_64-linux-gnu/pkgconfig/gsl.pc \nprefix=/usr\nexec_prefix=/usr\nlibdir=/usr/lib/x86_64-linux-gnu\nincludedir=/usr/include\nGSL_CBLAS_LIB=-lgslcblas\n\nName: GSL\nDescription: GNU Scientific Library\nVersion: 2.4\nLibs: -L/usr/lib/x86_64-linux-gnu -lgsl ${GSL_CBLAS_LIB} -lm -lm \nCflags: -I/usr/include\n(base) isuru@isuru:~$ ls /usr/lib/x86_64-linux-gnu/libgslcblas.so\n/usr/lib/x86_64-linux-gnu/libgslcblas.so\n(base) isuru@isuru:~$ ls -al /usr/lib/x86_64-linux-gnu/libgslcblas.so\nlrwxrwxrwx 1 root root 20 Aug  9  2017 /usr/lib/x86_64-linux-gnu/libgslcblas.so -> libgslcblas.so.0.0.0\n(base) isuru@isuru:~$ ls -al /usr/lib/x86_64-linux-gnu/libgslcblas.so.0.0.0 \n-rw-r--r-- 1 root root 255968 Aug  9  2017 /usr/lib/x86_64-linux-gnu/libgslcblas.so.0.0.0\n```",
    "created_at": "2019-12-15T03:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560777",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:12'></a>On Ubuntu,

```
(base) isuru@isuru:~$ cat /usr/lib/x86_64-linux-gnu/pkgconfig/gsl.pc 
prefix=/usr
exec_prefix=/usr
libdir=/usr/lib/x86_64-linux-gnu
includedir=/usr/include
GSL_CBLAS_LIB=-lgslcblas

Name: GSL
Description: GNU Scientific Library
Version: 2.4
Libs: -L/usr/lib/x86_64-linux-gnu -lgsl ${GSL_CBLAS_LIB} -lm -lm 
Cflags: -I/usr/include
(base) isuru@isuru:~$ ls /usr/lib/x86_64-linux-gnu/libgslcblas.so
/usr/lib/x86_64-linux-gnu/libgslcblas.so
(base) isuru@isuru:~$ ls -al /usr/lib/x86_64-linux-gnu/libgslcblas.so
lrwxrwxrwx 1 root root 20 Aug  9  2017 /usr/lib/x86_64-linux-gnu/libgslcblas.so -> libgslcblas.so.0.0.0
(base) isuru@isuru:~$ ls -al /usr/lib/x86_64-linux-gnu/libgslcblas.so.0.0.0 
-rw-r--r-- 1 root root 255968 Aug  9  2017 /usr/lib/x86_64-linux-gnu/libgslcblas.so.0.0.0
```



---

archive/issue_comments_560778.json:
```json
{
    "body": "<a id='comment:13'></a>It is underlinked as far as I can tell.\n\n```\n(base) isuru@isuru:~$ ldd /usr/lib/x86_64-linux-gnu/libgsl.so.23\n        linux-vdso.so.1 (0x00007fffb1ba6000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f8a703f4000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8a70003000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f8a70bf4000)\n```",
    "created_at": "2019-12-15T03:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560778",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:13'></a>It is underlinked as far as I can tell.

```
(base) isuru@isuru:~$ ldd /usr/lib/x86_64-linux-gnu/libgsl.so.23
        linux-vdso.so.1 (0x00007fffb1ba6000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f8a703f4000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8a70003000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f8a70bf4000)
```



---

archive/issue_comments_560779.json:
```json
{
    "body": "<a id='comment:14'></a>OK, I am surprised. Then cblas as to be provided with anything linking libgsl. And if we are taking it from gsl.pc that may be gslcblas. At worst we take performance hit.\n\nAn option would be to substitute gslcblas by the the default cblas we are using in the linking flags.",
    "created_at": "2019-12-15T03:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560779",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>OK, I am surprised. Then cblas as to be provided with anything linking libgsl. And if we are taking it from gsl.pc that may be gslcblas. At worst we take performance hit.

An option would be to substitute gslcblas by the the default cblas we are using in the linking flags.



---

archive/issue_comments_560780.json:
```json
{
    "body": "<a id='comment:15'></a>In the openblas `spkg-configure` script, `openblas.pc` is copied into `$SAGE_LOCAL/lib/pkgconfig/cblas.pc`. How about copying the system `gsl.pc` into `$SAGE_LOCAL/lib/pkgconfig/gsl.pc` and replacing the gslcblas line with openblas? (or whatever BLAS is selected)",
    "created_at": "2019-12-15T03:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560780",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:15'></a>In the openblas `spkg-configure` script, `openblas.pc` is copied into `$SAGE_LOCAL/lib/pkgconfig/cblas.pc`. How about copying the system `gsl.pc` into `$SAGE_LOCAL/lib/pkgconfig/gsl.pc` and replacing the gslcblas line with openblas? (or whatever BLAS is selected)



---

archive/issue_comments_560781.json:
```json
{
    "body": "<a id='comment:16'></a>Remove `GSL_CBLAS_LIB` and add a line\n\n```\nrequires: cblas\n```\nwhich will pull `cblas.pc` all by itself.",
    "created_at": "2019-12-15T04:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560781",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>Remove `GSL_CBLAS_LIB` and add a line

```
requires: cblas
```
which will pull `cblas.pc` all by itself.



---

archive/issue_comments_560782.json:
```json
{
    "body": "<a id='comment:17'></a>Just to make it clear, are you proposing to change `gsl.pc` in the underlinked case only,\nright?\n\nWill the underlinked GSL work with \"cblas\", which is in the configuration of #27870 the same as `openblas`? (I am ignorant about the purpose of `gslcblas`, sorry).",
    "created_at": "2019-12-15T09:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560782",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Just to make it clear, are you proposing to change `gsl.pc` in the underlinked case only,
right?

Will the underlinked GSL work with "cblas", which is in the configuration of #27870 the same as `openblas`? (I am ignorant about the purpose of `gslcblas`, sorry).



---

archive/issue_comments_560783.json:
```json
{
    "body": "<a id='comment:18'></a>Yes it will work. It would work if we did it in all cases. `gslcblas` is just another complete cblas implementation just as atlas and openblas are.",
    "created_at": "2019-12-15T09:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560783",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>Yes it will work. It would work if we did it in all cases. `gslcblas` is just another complete cblas implementation just as atlas and openblas are.



---

archive/issue_comments_560784.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-12-15T10:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560784",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_560785.json:
```json
{
    "body": "Changing work_issues from \"\" to \"install modified gsl.pc\"",
    "created_at": "2019-12-15T10:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560785",
    "user": "https://github.com/dimpase"
}
```

Changing work_issues from "" to "install modified gsl.pc"



---

archive/issue_comments_560786.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [fbissey](#comment%3A14):\n> OK, I am surprised. Then cblas as to be provided with anything linking libgsl. And if we are taking it from gsl.pc that may be gslcblas. At worst we take performance hit.\n> \n> An option would be to substitute gslcblas by the the default cblas we are using in the linking flags.\n\n\nGSL is also underlinked on Fedora",
    "created_at": "2019-12-15T12:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560786",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>Replying to [fbissey](#comment%3A14):
> OK, I am surprised. Then cblas as to be provided with anything linking libgsl. And if we are taking it from gsl.pc that may be gslcblas. At worst we take performance hit.
> 
> An option would be to substitute gslcblas by the the default cblas we are using in the linking flags.


GSL is also underlinked on Fedora



---

archive/issue_comments_560787.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [isuruf](#comment%3A8):\n> What happens when `gslcblas` and `openblas` are both linked in?\n\nthis is what I get with this branch:\n\n```\n$ ldd local/lib/python3.7/site-packages/cvxopt/gsl.cpython-37m-x86_64-linux-gnu.so\n...\n\tlibgsl.so.23 => /usr/lib/x86_64-linux-gnu/libgsl.so.23 (0x00007d76b701a000)\n\tlibopenblas.so.0 => /usr/lib/x86_64-linux-gnu/libopenblas.so.0 (0x00007d76b4e36000)\n...\n\tlibgslcblas.so.0 => /usr/lib/x86_64-linux-gnu/libgslcblas.so.0 (0x00007d76b48db000)\n...\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007d76b462e000)\n...\n```\n\nso both `libopenblas.so` and `libgslblas.so` are there. \n(I suppose it's the same with Sage-supplied GSL and OpenBLAS)\n\nAre you saying that modifyng `gsl.pc` as suggested here would lead to skipping `libgslblas.so` ?\n\nIMHO this would not lead to re-linking `libgsl.so` with `libopenblas.so`, if it was\nalready linked with `libgslblas.so`. Woulndn't is need some `LD_PRELOAD` platform-dependent `ld` hacks  --- I guess MacOS would need something quite different to achieve this.",
    "created_at": "2019-12-20T04:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560787",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Replying to [isuruf](#comment%3A8):
> What happens when `gslcblas` and `openblas` are both linked in?

this is what I get with this branch:

```
$ ldd local/lib/python3.7/site-packages/cvxopt/gsl.cpython-37m-x86_64-linux-gnu.so
...
	libgsl.so.23 => /usr/lib/x86_64-linux-gnu/libgsl.so.23 (0x00007d76b701a000)
	libopenblas.so.0 => /usr/lib/x86_64-linux-gnu/libopenblas.so.0 (0x00007d76b4e36000)
...
	libgslcblas.so.0 => /usr/lib/x86_64-linux-gnu/libgslcblas.so.0 (0x00007d76b48db000)
...
	libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007d76b462e000)
...
```

so both `libopenblas.so` and `libgslblas.so` are there. 
(I suppose it's the same with Sage-supplied GSL and OpenBLAS)

Are you saying that modifyng `gsl.pc` as suggested here would lead to skipping `libgslblas.so` ?

IMHO this would not lead to re-linking `libgsl.so` with `libopenblas.so`, if it was
already linked with `libgslblas.so`. Woulndn't is need some `LD_PRELOAD` platform-dependent `ld` hacks  --- I guess MacOS would need something quite different to achieve this.



---

archive/issue_comments_560788.json:
```json
{
    "body": "<a id='comment:22'></a>> (I suppose it's the same with Sage-supplied GSL and OpenBLAS) \n\n\nNo, see https://github.com/sagemath/sage/blob/f0ae571d17e685258c1de89c2a29953f4d8fb302/build/pkgs/gsl/patches/gsl-2.1-gslcblas.patch . gslcblas is removed sage-suplied GSL.\n\n>  Are you saying that modifyng gsl.pc as suggested here would lead to skipping libgslblas.so ?\n\n\nYes\n\n> IMHO this would not lead to re-linking libgsl.so with libopenblas.so, if it was already linked with libgslblas.so\n\n\n`libgsl.so` is not linked to any blas in distros like Ubuntu. It is underlinked. In sage-the-distribution, `libgsl.so` is linked to `libopenblas` and the `-lgslcblas` line is removed from `gsl.pc`.",
    "created_at": "2019-12-20T04:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560788",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:22'></a>> (I suppose it's the same with Sage-supplied GSL and OpenBLAS) 


No, see https://github.com/sagemath/sage/blob/f0ae571d17e685258c1de89c2a29953f4d8fb302/build/pkgs/gsl/patches/gsl-2.1-gslcblas.patch . gslcblas is removed sage-suplied GSL.

>  Are you saying that modifyng gsl.pc as suggested here would lead to skipping libgslblas.so ?


Yes

> IMHO this would not lead to re-linking libgsl.so with libopenblas.so, if it was already linked with libgslblas.so


`libgsl.so` is not linked to any blas in distros like Ubuntu. It is underlinked. In sage-the-distribution, `libgsl.so` is linked to `libopenblas` and the `-lgslcblas` line is removed from `gsl.pc`.



---

archive/issue_comments_560789.json:
```json
{
    "body": "<a id='comment:23'></a>No, why, on Debian 10 I see\n\n```\n$ ldd /usr/lib/x86_64-linux-gnu/libgsl.so\n\tlinux-vdso.so.1 (0x00007ffcf2bb5000)\n\tlibgslcblas.so.0 => /usr/lib/x86_64-linux-gnu/libgslcblas.so.0 (0x00007a0da11b5000)\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007a0da1032000)\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007a0da0e71000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007a0da1499000)\n```\nSo libgsl.so is linked to libopenblas.so",
    "created_at": "2019-12-20T04:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560789",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>No, why, on Debian 10 I see

```
$ ldd /usr/lib/x86_64-linux-gnu/libgsl.so
	linux-vdso.so.1 (0x00007ffcf2bb5000)
	libgslcblas.so.0 => /usr/lib/x86_64-linux-gnu/libgslcblas.so.0 (0x00007a0da11b5000)
	libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007a0da1032000)
	libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007a0da0e71000)
	/lib64/ld-linux-x86-64.so.2 (0x00007a0da1499000)
```
So libgsl.so is linked to libopenblas.so



---

archive/issue_comments_560790.json:
```json
{
    "body": "<a id='comment:24'></a>I guess it depends on the distro. I checked Ubuntu 18.04, and it's underlinked there. See #28879#comment:13",
    "created_at": "2019-12-20T04:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560790",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:24'></a>I guess it depends on the distro. I checked Ubuntu 18.04, and it's underlinked there. See #28879#comment:13



---

archive/issue_comments_560791.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [isuruf](#comment%3A24):\n> I guess it depends on the distro. I checked Ubuntu 18.04, and it's underlinked there. See #28879#comment:13\n\n\nYes, it's distro-dependent. So how is this gsl.pc hack supposed to help in such a case (of already linked gslcblas?\nAre we left with linking to both openblas and gslcblas then?",
    "created_at": "2019-12-20T04:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560791",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>Replying to [isuruf](#comment%3A24):
> I guess it depends on the distro. I checked Ubuntu 18.04, and it's underlinked there. See #28879#comment:13


Yes, it's distro-dependent. So how is this gsl.pc hack supposed to help in such a case (of already linked gslcblas?
Are we left with linking to both openblas and gslcblas then?



---

archive/issue_comments_560792.json:
```json
{
    "body": "<a id='comment:26'></a>In the case that it is already linked to libgslcblas, then the library or the executable using gsl has the option of selecting the blas.\n\nSee https://wiki.debian.org/DebianScience/LinearAlgebraLibraries section \"Using the GSL with an optimized BLAS\"",
    "created_at": "2019-12-20T04:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560792",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:26'></a>In the case that it is already linked to libgslcblas, then the library or the executable using gsl has the option of selecting the blas.

See https://wiki.debian.org/DebianScience/LinearAlgebraLibraries section "Using the GSL with an optimized BLAS"



---

archive/issue_comments_560793.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [isuruf](#comment%3A26):\n> In the case that it is already linked to libgslcblas, then the library or the executable using gsl has the option of selecting the blas.\n> \n> See https://wiki.debian.org/DebianScience/LinearAlgebraLibraries section \"Using the GSL with an optimized BLAS\"\n\n\nwell, this does not quite wotk.\nAfter these changes to gsl.pc I see the correct linking command\n\n```\n    gcc -pthread -shared -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib -L. -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib build/temp.linux-x86_64-3.7/src/C/gsl.o -L/home/dimpase/sage/local -L/home/dimpase/sage/local -L/home/dimpase/sage/local/lib -lm -lgsl -lopenblas -lpython3.7m -o build/lib.linux-x86_64-3.7/cvxopt/gsl.cpython-37m-x86_64-linux-gnu.so\n```\nbut stil the same ldd output as in[comment:21](#comment%3A21).",
    "created_at": "2019-12-20T06:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560793",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>Replying to [isuruf](#comment%3A26):
> In the case that it is already linked to libgslcblas, then the library or the executable using gsl has the option of selecting the blas.
> 
> See https://wiki.debian.org/DebianScience/LinearAlgebraLibraries section "Using the GSL with an optimized BLAS"


well, this does not quite wotk.
After these changes to gsl.pc I see the correct linking command

```
    gcc -pthread -shared -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib -L. -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib build/temp.linux-x86_64-3.7/src/C/gsl.o -L/home/dimpase/sage/local -L/home/dimpase/sage/local -L/home/dimpase/sage/local/lib -lm -lgsl -lopenblas -lpython3.7m -o build/lib.linux-x86_64-3.7/cvxopt/gsl.cpython-37m-x86_64-linux-gnu.so
```
but stil the same ldd output as in[comment:21](#comment%3A21).



---

archive/issue_comments_560794.json:
```json
{
    "body": "<a id='comment:28'></a>`ldd` gives transitive deps. Try `readelf -d local/lib/python3.7/site-packages/cvxopt/gsl.cpython-37m-x86_64-linux-gnu.so`",
    "created_at": "2019-12-20T06:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560794",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:28'></a>`ldd` gives transitive deps. Try `readelf -d local/lib/python3.7/site-packages/cvxopt/gsl.cpython-37m-x86_64-linux-gnu.so`



---

archive/issue_comments_560795.json:
```json
{
    "body": "<a id='comment:29'></a>OK, so `readelf -d` indeed shows that the only linking to gslcblas comes from one of the linked libs\n\n```\n0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgsl.so.23]\n 0x0000000000000001 (NEEDED)             Shared library: [libopenblas.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n```\nand it must be libgsl, for obvious reasons.\nSo that's as good as it gets, we won't try to relink libgsl, right?",
    "created_at": "2019-12-20T07:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560795",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>OK, so `readelf -d` indeed shows that the only linking to gslcblas comes from one of the linked libs

```
0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgsl.so.23]
 0x0000000000000001 (NEEDED)             Shared library: [libopenblas.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
```
and it must be libgsl, for obvious reasons.
So that's as good as it gets, we won't try to relink libgsl, right?



---

archive/issue_comments_560796.json:
```json
{
    "body": "<a id='comment:30'></a>> So that's as good as it gets, we won't try to relink libgsl, right? \n\n\nYes. Looks good. Can you push your changes to modify gsl.pc?",
    "created_at": "2019-12-20T11:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560796",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:30'></a>> So that's as good as it gets, we won't try to relink libgsl, right? 


Yes. Looks good. Can you push your changes to modify gsl.pc?



---

archive/issue_comments_560797.json:
```json
{
    "body": "Changing commit from \"137c97252c15455b1d0e8c8d81929b4a21e722b2\" to \"2bc86cd701014b1bdcc0c7d5055c5d323962fbd2\"",
    "created_at": "2019-12-20T18:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "137c97252c15455b1d0e8c8d81929b4a21e722b2" to "2bc86cd701014b1bdcc0c7d5055c5d323962fbd2"



---

archive/issue_comments_560798.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-20T18:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_560799.json:
```json
{
    "body": "<a id='comment:33'></a>This is not ideal, as one should use `$SED`, not `sed`.\nHowever, calling `sed` happens in `config.status`, and I have no\nidea how to make `$SED` known there.\nProbably some magic with \"init commands\" I don't know.",
    "created_at": "2019-12-20T18:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560799",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>This is not ideal, as one should use `$SED`, not `sed`.
However, calling `sed` happens in `config.status`, and I have no
idea how to make `$SED` known there.
Probably some magic with "init commands" I don't know.



---

archive/issue_comments_560800.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-20T18:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560800",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_560801.json:
```json
{
    "body": "<a id='comment:35'></a>`sed -i` without an extension is GNU sed specific and doesn't work with BSD sed",
    "created_at": "2019-12-20T18:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560801",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:35'></a>`sed -i` without an extension is GNU sed specific and doesn't work with BSD sed



---

archive/issue_comments_560802.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-12-20T18:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560802",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_560803.json:
```json
{
    "body": "Changing commit from \"2bc86cd701014b1bdcc0c7d5055c5d323962fbd2\" to \"c13be388d0e6ce1dbd719d64a7a71ff2f87cc82e\"",
    "created_at": "2019-12-21T01:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2bc86cd701014b1bdcc0c7d5055c5d323962fbd2" to "c13be388d0e6ce1dbd719d64a7a71ff2f87cc82e"



---

archive/issue_comments_560804.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T01:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_560805.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [isuruf](#comment%3A35):\n> `sed -i` without an extension is GNU sed specific and doesn't work with BSD sed\n\n\nIt is not posix full stop. I am surprised it works as suggested on freeBSD. My experience with AIX `sed`, which is posix, is that `-i` isn't supported at all. Fortunately we don't have to support such dinosaur platforms.\n\n`@`Dima one of the purpose of `-e` is to be able to chain commands.\n\n```\nsed -i'' -e 's/\\${GSL_CBLAS_LIB}\\ //'  -e 's/GSL_CBLAS_LIB.*/Require: cblas/' \"$SAGE_LOCAL\"/lib/pkgconfig/gsl.pc\n```\nis perfectly legal. Of course some line separation gain in clarity, but that's why I would break things into several line in a pure shell script\n\n```\nsed  \\\n       -e 's/\\${GSL_CBLAS_LIB}\\ //'  \\\n       -e 's/GSL_CBLAS_LIB.*/Require: cblas/' \\\n       -i'' $SAGE_LOCAL\"/lib/pkgconfig/gsl.pc\n```",
    "created_at": "2019-12-21T01:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560805",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>Replying to [isuruf](#comment%3A35):
> `sed -i` without an extension is GNU sed specific and doesn't work with BSD sed


It is not posix full stop. I am surprised it works as suggested on freeBSD. My experience with AIX `sed`, which is posix, is that `-i` isn't supported at all. Fortunately we don't have to support such dinosaur platforms.

`@`Dima one of the purpose of `-e` is to be able to chain commands.

```
sed -i'' -e 's/\${GSL_CBLAS_LIB}\ //'  -e 's/GSL_CBLAS_LIB.*/Require: cblas/' "$SAGE_LOCAL"/lib/pkgconfig/gsl.pc
```
is perfectly legal. Of course some line separation gain in clarity, but that's why I would break things into several line in a pure shell script

```
sed  \
       -e 's/\${GSL_CBLAS_LIB}\ //'  \
       -e 's/GSL_CBLAS_LIB.*/Require: cblas/' \
       -i'' $SAGE_LOCAL"/lib/pkgconfig/gsl.pc
```



---

archive/issue_comments_560806.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T01:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_560807.json:
```json
{
    "body": "Changing commit from \"c13be388d0e6ce1dbd719d64a7a71ff2f87cc82e\" to \"310ba06411ee413379c1ce3ca75b595ac83e8b0b\"",
    "created_at": "2019-12-21T01:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c13be388d0e6ce1dbd719d64a7a71ff2f87cc82e" to "310ba06411ee413379c1ce3ca75b595ac83e8b0b"



---

archive/issue_comments_560808.json:
```json
{
    "body": "<a id='comment:39'></a>OK, all done, also managed to get SED value into config.status.",
    "created_at": "2019-12-21T01:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560808",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>OK, all done, also managed to get SED value into config.status.



---

archive/issue_comments_560809.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-21T01:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560809",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_560810.json:
```json
{
    "body": "<a id='comment:40'></a>if you prefer chained `-e` in one sed call, let me know. I don't see this comment while I fought value of SED thing :-)",
    "created_at": "2019-12-21T01:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560810",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>if you prefer chained `-e` in one sed call, let me know. I don't see this comment while I fought value of SED thing :-)



---

archive/issue_comments_560811.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [dimpase](#comment%3A40):\n> if you prefer chained `-e` in one sed call, let me know. I don't see this comment while I fought value of SED thing :-)\n\n\nThat's just nitpicking and absolutely non-esential. My comment should be taken as informative rather than \"take this action, please\".",
    "created_at": "2019-12-21T01:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560811",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>Replying to [dimpase](#comment%3A40):
> if you prefer chained `-e` in one sed call, let me know. I don't see this comment while I fought value of SED thing :-)


That's just nitpicking and absolutely non-esential. My comment should be taken as informative rather than "take this action, please".



---

archive/issue_comments_560812.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [fbissey](#comment%3A37):\n> Replying to [isuruf](#comment%3A35):\n> > `sed -i` without an extension is GNU sed specific and doesn't work with BSD sed\n\n> \n> It is not posix full stop. I am surprised it works as suggested on freeBSD. My experience with AIX `sed`, which is posix, is that `-i` isn't supported at all. Fortunately we don't have to support such dinosaur platforms.\n\n\nI'm pretty sure this doesn't work on OSX. See https://stackoverflow.com/a/5694430/4768820",
    "created_at": "2019-12-21T14:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560812",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:42'></a>Replying to [fbissey](#comment%3A37):
> Replying to [isuruf](#comment%3A35):
> > `sed -i` without an extension is GNU sed specific and doesn't work with BSD sed

> 
> It is not posix full stop. I am surprised it works as suggested on freeBSD. My experience with AIX `sed`, which is posix, is that `-i` isn't supported at all. Fortunately we don't have to support such dinosaur platforms.


I'm pretty sure this doesn't work on OSX. See https://stackoverflow.com/a/5694430/4768820



---

archive/issue_comments_560813.json:
```json
{
    "body": "<a id='comment:43'></a>So it should be `-i *`, not `-i*`? I don't have access to an OSX machine in the coming 2 weeks, sorry.",
    "created_at": "2019-12-21T14:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560813",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>So it should be `-i *`, not `-i*`? I don't have access to an OSX machine in the coming 2 weeks, sorry.



---

archive/issue_comments_560814.json:
```json
{
    "body": "<a id='comment:44'></a>`-i *` works in BSD/OSX sed, but doesn't in GNU sed. `-i*` works in GNU sed, but doesn't in BSD/OSX sed.\n\nSolution is to use `-i.bak` as in the StackOverflow answer. This creates a backup file with suffix `.bak`",
    "created_at": "2019-12-21T14:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560814",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:44'></a>`-i *` works in BSD/OSX sed, but doesn't in GNU sed. `-i*` works in GNU sed, but doesn't in BSD/OSX sed.

Solution is to use `-i.bak` as in the StackOverflow answer. This creates a backup file with suffix `.bak`



---

archive/issue_comments_560815.json:
```json
{
    "body": "Changing commit from \"310ba06411ee413379c1ce3ca75b595ac83e8b0b\" to \"f9d6966f63a12991b81dce40ba69887cd9dacaa3\"",
    "created_at": "2019-12-21T15:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "310ba06411ee413379c1ce3ca75b595ac83e8b0b" to "f9d6966f63a12991b81dce40ba69887cd9dacaa3"



---

archive/issue_comments_560816.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T15:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_560817.json:
```json
{
    "body": "<a id='comment:46'></a>OK, done. Now it's POSIX, I think.",
    "created_at": "2019-12-21T15:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560817",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>OK, done. Now it's POSIX, I think.



---

archive/issue_comments_560818.json:
```json
{
    "body": "<a id='comment:47'></a>testing this on Ubuntu (i.e. undelinked libgsl.so) gives a linking error during python import:\n\n```\n$ ./sage --python\nPython 3.7.3 (default, Dec 21 2019, 11:29:09) \n[GCC 7.4.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.rings.complex_double import CDF\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nImportError: /usr/lib/i386-linux-gnu/libgsl.so.23: undefined symbol: cblas_ctrmv\n>>> \n```\nI suppose some sagelib modules don't know that they must also link with openblas.",
    "created_at": "2019-12-21T15:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560818",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>testing this on Ubuntu (i.e. undelinked libgsl.so) gives a linking error during python import:

```
$ ./sage --python
Python 3.7.3 (default, Dec 21 2019, 11:29:09) 
[GCC 7.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.rings.complex_double import CDF
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: /usr/lib/i386-linux-gnu/libgsl.so.23: undefined symbol: cblas_ctrmv
>>> 
```
I suppose some sagelib modules don't know that they must also link with openblas.



---

archive/issue_comments_560819.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-12-21T15:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560819",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_560820.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T15:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_560821.json:
```json
{
    "body": "Changing commit from \"f9d6966f63a12991b81dce40ba69887cd9dacaa3\" to \"9d9e0465310b67352105644e7e26eabb2684c84b\"",
    "created_at": "2019-12-21T15:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f9d6966f63a12991b81dce40ba69887cd9dacaa3" to "9d9e0465310b67352105644e7e26eabb2684c84b"



---

archive/issue_comments_560822.json:
```json
{
    "body": "<a id='comment:49'></a>the .pc syntax needs `Requires` rather than `Require`...",
    "created_at": "2019-12-21T15:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560822",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>the .pc syntax needs `Requires` rather than `Require`...



---

archive/issue_comments_560823.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-21T17:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560823",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_560824.json:
```json
{
    "body": "<a id='comment:50'></a>now things work on Ubuntu, too.",
    "created_at": "2019-12-21T17:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560824",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>now things work on Ubuntu, too.



---

archive/issue_comments_560825.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-21T18:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560825",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_560826.json:
```json
{
    "body": "<a id='comment:51'></a>Tested that configure creates gsl.pc correctly in OSX.",
    "created_at": "2019-12-21T18:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560826",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:51'></a>Tested that configure creates gsl.pc correctly in OSX.



---

archive/issue_comments_560827.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Isuru Fernando\"",
    "created_at": "2019-12-21T19:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560827",
    "user": "https://github.com/isuruf"
}
```

Changing reviewer from "" to "Isuru Fernando"



---

archive/issue_comments_560828.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:",
    "created_at": "2019-12-28T08:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:



---

archive/issue_comments_560829.json:
```json
{
    "body": "Changing commit from \"9d9e0465310b67352105644e7e26eabb2684c84b\" to \"a18059933c6b6ecfe4e98a7c8e1ca6de3dc223c8\"",
    "created_at": "2019-12-28T08:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9d9e0465310b67352105644e7e26eabb2684c84b" to "a18059933c6b6ecfe4e98a7c8e1ca6de3dc223c8"



---

archive/issue_comments_560830.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-12-28T08:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_events_073053.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-28T08:03:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28879#event-73053"
}
```



---

archive/issue_comments_560831.json:
```json
{
    "body": "<a id='comment:54'></a>trivial rebase over updated #27870",
    "created_at": "2019-12-28T08:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560831",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:54'></a>trivial rebase over updated #27870



---

archive/issue_comments_560832.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-28T08:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560832",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_073054.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-01T14:38:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28879#event-73054"
}
```



---

archive/issue_events_073055.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-01T14:38:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28879#event-73055"
}
```



---

archive/issue_events_073056.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-09T23:44:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28879#event-73056"
}
```



---

archive/issue_comments_560833.json:
```json
{
    "body": "Changing branch from \"u/dimpase/packages/gslconf\" to \"a18059933c6b6ecfe4e98a7c8e1ca6de3dc223c8\"",
    "created_at": "2020-01-09T23:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560833",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dimpase/packages/gslconf" to "a18059933c6b6ecfe4e98a7c8e1ca6de3dc223c8"



---

archive/issue_comments_560834.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-09T23:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28879",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28879#issuecomment-560834",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
