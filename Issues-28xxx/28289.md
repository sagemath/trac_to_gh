# Issue 28289: Settings in ipython_config.py can cause tests to fail

archive/issues_028052.json:
```json
{
    "body": "For example, I modify `~/.sage/ipython-5.0.0/profile_default/ipython_config.py` to set the `c.TerminalInteractiveShell.colors` to a different value, and get test failures in REPL tests where different terminal color codes are output than expected.\n\nThere's all kinds of other ways, I'm sure, that different ipython_config.py settings could cause tests to fail.\n\nLoading this file should be prevented when running the tests.  \n\nIt occurs to me now that this is the cause of some of the failures reported in #25361, since the Windows installer sets some specific defaults in ipython_config.py.\n\nReviewer: Markus Wageringel\n\nAuthor: Erik Bray\n\nBranch: 195438cbe74f5140b8deb0a96167454ea9b5d03f\n\nCommit: 195438cbe74f5140b8deb0a96167454ea9b5d03f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28289\n\n",
    "closed_at": "2019-12-04T22:43:27Z",
    "created_at": "2019-07-30T09:54:04Z",
    "labels": [
        "component: doctest framework",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Settings in ipython_config.py can cause tests to fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28289",
    "user": "https://github.com/embray"
}
```
For example, I modify `~/.sage/ipython-5.0.0/profile_default/ipython_config.py` to set the `c.TerminalInteractiveShell.colors` to a different value, and get test failures in REPL tests where different terminal color codes are output than expected.

There's all kinds of other ways, I'm sure, that different ipython_config.py settings could cause tests to fail.

Loading this file should be prevented when running the tests.  

It occurs to me now that this is the cause of some of the failures reported in #25361, since the Windows installer sets some specific defaults in ipython_config.py.

Reviewer: Markus Wageringel

Author: Erik Bray

Branch: 195438cbe74f5140b8deb0a96167454ea9b5d03f

Commit: 195438cbe74f5140b8deb0a96167454ea9b5d03f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28289





---

archive/issue_events_070592.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-11-08T11:10:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28289#event-70592"
}
```



---

archive/issue_comments_396038.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2019-11-08T11:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396038",
    "user": "https://github.com/embray"
}
```

Changing priority from major to minor.



---

archive/issue_comments_396039.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396039",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_396040.json:
```json
{
    "body": "<a id='comment:2'></a>This is a slightly softer approach, for now, than completely disabling loading of `ipython_config.py`.  I realized that the `get_test_shell()` used in the tests does apply a default configuration to the options that are known to affect the tests.  However, it only applied this configuration to the `InteractiveShell` class, and not to its subclass `TerminalInteractiveShell`.\n\nApplying the default config to `TerminalInteractiveShell` as well fixes the immediate problems I was seeing so this is good-enough for now.\n\n---\nNew commits:",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396040",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>This is a slightly softer approach, for now, than completely disabling loading of `ipython_config.py`.  I realized that the `get_test_shell()` used in the tests does apply a default configuration to the options that are known to affect the tests.  However, it only applied this configuration to the `InteractiveShell` class, and not to its subclass `TerminalInteractiveShell`.

Applying the default config to `TerminalInteractiveShell` as well fixes the immediate problems I was seeing so this is good-enough for now.

---
New commits:



---

archive/issue_comments_396041.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-01T16:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396041",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_396042.json:
```json
{
    "body": "<a id='comment:3'></a>Ok, this looks good to me. Though note that you can configure IPython options in your `init.sage` file instead which does not get sourced during tests. For example I have\n\n```\n%config TerminalInteractiveShell.colors = 'Neutral'\n```\nto get correct colors in embedded shells like in interact mode of the interfaces.",
    "created_at": "2019-12-01T16:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396042",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'></a>Ok, this looks good to me. Though note that you can configure IPython options in your `init.sage` file instead which does not get sourced during tests. For example I have

```
%config TerminalInteractiveShell.colors = 'Neutral'
```
to get correct colors in embedded shells like in interact mode of the interfaces.



---

archive/issue_comments_396043.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks, that's good to know.  Though in the case of the Windows version of Sage there are some defaults set in an ipython_config.py that's created during installation.  I could include a default \"init.sage\" too, but seeing as how it's a bit more of a \"user-facing\" file I wanted to leave it untouched.",
    "created_at": "2019-12-02T11:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396043",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>Thanks, that's good to know.  Though in the case of the Windows version of Sage there are some defaults set in an ipython_config.py that's created during installation.  I could include a default "init.sage" too, but seeing as how it's a bit more of a "user-facing" file I wanted to leave it untouched.



---

archive/issue_events_070593.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-04T22:43:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28289#event-70593"
}
```



---

archive/issue_comments_396044.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-04T22:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-396044",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
