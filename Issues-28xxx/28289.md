# Issue 28289: Settings in ipython_config.py can cause tests to fail

archive/issues_028052.json:
```json
{
    "body": "For example, I modify `~/.sage/ipython-5.0.0/profile_default/ipython_config.py` to set the `c.TerminalInteractiveShell.colors` to a different value, and get test failures in REPL tests where different terminal color codes are output than expected.\n\nThere's all kinds of other ways, I'm sure, that different ipython_config.py settings could cause tests to fail.\n\nLoading this file should be prevented when running the tests.  \n\nIt occurs to me now that this is the cause of some of the failures reported in #25361, since the Windows installer sets some specific defaults in ipython_config.py.\n\nBranch/Commit: 195438cbe74f5140b8deb0a96167454ea9b5d03f\n\nReviewer: Markus Wageringel\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28289\n\n",
    "closed_at": "2019-12-04T22:43:27Z",
    "created_at": "2019-07-30T09:54:04Z",
    "labels": [
        "component: doctest framework",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Settings in ipython_config.py can cause tests to fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28289",
    "user": "https://github.com/embray"
}
```
For example, I modify `~/.sage/ipython-5.0.0/profile_default/ipython_config.py` to set the `c.TerminalInteractiveShell.colors` to a different value, and get test failures in REPL tests where different terminal color codes are output than expected.

There's all kinds of other ways, I'm sure, that different ipython_config.py settings could cause tests to fail.

Loading this file should be prevented when running the tests.  

It occurs to me now that this is the cause of some of the failures reported in #25361, since the Windows installer sets some specific defaults in ipython_config.py.

Branch/Commit: 195438cbe74f5140b8deb0a96167454ea9b5d03f

Reviewer: Markus Wageringel

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28289





---

archive/issue_events_087803.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-11-08T11:10:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28289#event-87803"
}
```



---

archive/issue_comments_542059.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542059",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_542060.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis is a slightly softer approach, for now, than completely disabling loading of `ipython_config.py`.  I realized that the `get_test_shell()` used in the tests does apply a default configuration to the options that are known to affect the tests.  However, it only applied this configuration to the `InteractiveShell` class, and not to its subclass `TerminalInteractiveShell`.\n\nApplying the default config to `TerminalInteractiveShell` as well fixes the immediate problems I was seeing so this is good-enough for now.\n\n---\nNew commits:\n|                                                                                                                                          |                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[195438c](https://github.com/sagemath/sagetrac-mirror/commit/195438cbe74f5140b8deb0a96167454ea9b5d03f)|`Trac #28289: Set default configs for TerminalInteractiveShell`|",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542060",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
This is a slightly softer approach, for now, than completely disabling loading of `ipython_config.py`.  I realized that the `get_test_shell()` used in the tests does apply a default configuration to the options that are known to affect the tests.  However, it only applied this configuration to the `InteractiveShell` class, and not to its subclass `TerminalInteractiveShell`.

Applying the default config to `TerminalInteractiveShell` as well fixes the immediate problems I was seeing so this is good-enough for now.

---
New commits:
|                                                                                                                                          |                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[195438c](https://github.com/sagemath/sagetrac-mirror/commit/195438cbe74f5140b8deb0a96167454ea9b5d03f)|`Trac #28289: Set default configs for TerminalInteractiveShell`|



---

archive/issue_comments_542061.json:
```json
{
    "body": "Changing commit from \"\" to \"195438cbe74f5140b8deb0a96167454ea9b5d03f\"",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542061",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "195438cbe74f5140b8deb0a96167454ea9b5d03f"



---

archive/issue_comments_542062.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-28289\"",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542062",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-28289"



---

archive/issue_comments_542063.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2019-11-08T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542063",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_542064.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-01T16:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542064",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_542065.json:
```json
{
    "body": "<a id='comment:3'></a>\nOk, this looks good to me. Though note that you can configure IPython options in your `init.sage` file instead which does not get sourced during tests. For example I have\n\n```\n%config TerminalInteractiveShell.colors = 'Neutral'\n```\nto get correct colors in embedded shells like in interact mode of the interfaces.",
    "created_at": "2019-12-01T16:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542065",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'></a>
Ok, this looks good to me. Though note that you can configure IPython options in your `init.sage` file instead which does not get sourced during tests. For example I have

```
%config TerminalInteractiveShell.colors = 'Neutral'
```
to get correct colors in embedded shells like in interact mode of the interfaces.



---

archive/issue_comments_542066.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Markus Wageringel\"",
    "created_at": "2019-12-01T16:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542066",
    "user": "https://github.com/mwageringel"
}
```

Changing reviewer from "" to "Markus Wageringel"



---

archive/issue_comments_542067.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks, that's good to know.  Though in the case of the Windows version of Sage there are some defaults set in an ipython_config.py that's created during installation.  I could include a default \"init.sage\" too, but seeing as how it's a bit more of a \"user-facing\" file I wanted to leave it untouched.",
    "created_at": "2019-12-02T11:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542067",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
Thanks, that's good to know.  Though in the case of the Windows version of Sage there are some defaults set in an ipython_config.py that's created during installation.  I could include a default "init.sage" too, but seeing as how it's a bit more of a "user-facing" file I wanted to leave it untouched.



---

archive/issue_events_087804.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-04T22:43:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28289#event-87804"
}
```



---

archive/issue_comments_542068.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-28289\" to \"195438cbe74f5140b8deb0a96167454ea9b5d03f\"",
    "created_at": "2019-12-04T22:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542068",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-28289" to "195438cbe74f5140b8deb0a96167454ea9b5d03f"



---

archive/issue_comments_542069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-04T22:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28289#issuecomment-542069",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
