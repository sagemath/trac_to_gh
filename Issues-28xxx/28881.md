# Issue 28881: refresh the shuffle algebra file

archive/issues_028644.json:
```json
{
    "body": "fixing a very wrong coproduct\n\nenhancing the category\n\nsome pep8 changes\n\n\nCC:  @tscrim @jm58660\n\nReviewer: Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\nBranch: 3787e452e3db8a54bb7baba27f2ff4c21acece47\n\nCommit: 3787e452e3db8a54bb7baba27f2ff4c21acece47\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28881\n\n",
    "closed_at": "2019-12-17T22:46:27Z",
    "created_at": "2019-12-13T20:38:36Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "refresh the shuffle algebra file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28881",
    "user": "https://github.com/fchapoton"
}
```
fixing a very wrong coproduct

enhancing the category

some pep8 changes


CC:  @tscrim @jm58660

Reviewer: Travis Scrimshaw, Frédéric Chapoton

Author: Frédéric Chapoton, Travis Scrimshaw

Branch: 3787e452e3db8a54bb7baba27f2ff4c21acece47

Commit: 3787e452e3db8a54bb7baba27f2ff4c21acece47

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28881





---

archive/issue_comments_404005.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-13T20:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404005",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404006.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-12-13T20:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404006",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_404007.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-12-13T21:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404007",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_404008.json:
```json
{
    "body": "<a id='comment:2'></a>Well, technically the shuffle algebra should be in the category of commutative Hopf algebras, so it might be better to use the category of `Bialgebras(R).Commutative()`. However, the antipode is easy to implement: reverse the order of the `n` letters times (-1)<sup>n</sup> (see [this MathOverflow post](https://mathoverflow.net/questions/63923/shuffle-hopf-algebra-how-to-prove-its-properties-in-a-slick-way)). So I would propose changing the category to `HopfAlgebras(R).Commutative()` and adding\n\n```python\ndef antipode_on_basis(self, w):\n    \"\"\"\n    Return the antipode on the basis element ``w``.\n    \"\"\"\n    mone = -self.base_ring().one()\n    return self.term(w.reversal(), mone**len(w))\n```\nalong with in the dual PBW basis\n\n```python\ndef antipode(self, elt):\n    \"\"\"\n    Return the antipode of the element ``elt``.\n    \"\"\"\n    return self(self.expansion(elt).antipode())\n```",
    "created_at": "2019-12-13T21:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404008",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Well, technically the shuffle algebra should be in the category of commutative Hopf algebras, so it might be better to use the category of `Bialgebras(R).Commutative()`. However, the antipode is easy to implement: reverse the order of the `n` letters times (-1)<sup>n</sup> (see [this MathOverflow post](https://mathoverflow.net/questions/63923/shuffle-hopf-algebra-how-to-prove-its-properties-in-a-slick-way)). So I would propose changing the category to `HopfAlgebras(R).Commutative()` and adding

```python
def antipode_on_basis(self, w):
    """
    Return the antipode on the basis element ``w``.
    """
    mone = -self.base_ring().one()
    return self.term(w.reversal(), mone**len(w))
```
along with in the dual PBW basis

```python
def antipode(self, elt):
    """
    Return the antipode of the element ``elt``.
    """
    return self(self.expansion(elt).antipode())
```



---

archive/issue_comments_404009.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-14T09:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404010.json:
```json
{
    "body": "<a id='comment:4'></a>mmm; not so easy. I am hitting problems in the testsuites.",
    "created_at": "2019-12-14T09:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404010",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>mmm; not so easy. I am hitting problems in the testsuites.



---

archive/issue_comments_404011.json:
```json
{
    "body": "<a id='comment:5'></a>Hmm...maybe the product and coproduct implemented are not compatible? I will check it on Monday (Australian time).",
    "created_at": "2019-12-14T09:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404011",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>Hmm...maybe the product and coproduct implemented are not compatible? I will check it on Monday (Australian time).



---

archive/issue_comments_404012.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-14T16:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404013.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-14T19:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404014.json:
```json
{
    "body": "<a id='comment:8'></a>The coproduct was indeed broken. There still remains a failure..",
    "created_at": "2019-12-14T19:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404014",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>The coproduct was indeed broken. There still remains a failure..



---

archive/issue_comments_404015.json:
```json
{
    "body": "<a id='comment:9'></a>It almost seems like the old coproduct is meant to be the inflation product. (The coproduct was added in #15212, but there is little information available there.)",
    "created_at": "2019-12-14T22:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404015",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>It almost seems like the old coproduct is meant to be the inflation product. (The coproduct was added in #15212, but there is little information available there.)



---

archive/issue_comments_404016.json:
```json
{
    "body": "<a id='comment:10'></a>So the problem seems to come from the coproduct in the dual PBW basis. It is only converting basis indices over (whereas the implementation was meant to be treating them as monomials). Here is a fix that doesn't try to be clever and just uses the coercion framework.",
    "created_at": "2019-12-15T01:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404016",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>So the problem seems to come from the coproduct in the dual PBW basis. It is only converting basis indices over (whereas the implementation was meant to be treating them as monomials). Here is a fix that doesn't try to be clever and just uses the coercion framework.



---

archive/issue_comments_404017.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-12-15T01:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404017",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_404018.json:
```json
{
    "body": "<a id='comment:11'></a>I fixed it, and I also made the shuffle algebra know it is a graded connected Hopf algebra.\n\n---\nNew commits:",
    "created_at": "2019-12-15T01:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404018",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>I fixed it, and I also made the shuffle algebra know it is a graded connected Hopf algebra.

---
New commits:



---

archive/issue_comments_404019.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-15T07:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404020.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks a lot. Looks good now. I have fixed a pyflakes warning, and added some #long tags on the TestSuites.\n\nNow launching the bot.",
    "created_at": "2019-12-15T07:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404020",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Thanks a lot. Looks good now. I have fixed a pyflakes warning, and added some #long tags on the TestSuites.

Now launching the bot.



---

archive/issue_comments_404021.json:
```json
{
    "body": "<a id='comment:14'></a>Worked locally for me, so I am going to assume the patchbot comes back green. Thank you.",
    "created_at": "2019-12-15T08:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404021",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>Worked locally for me, so I am going to assume the patchbot comes back green. Thank you.



---

archive/issue_comments_404022.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-15T08:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404022",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404023.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-17T22:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28881#issuecomment-404023",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073059.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-17T22:46:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28881",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28881#event-73059"
}
```
