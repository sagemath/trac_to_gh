# Issue 28060: Extensions of finite fields embeddings: we have inverse image but `inverse_image` throws `NotImplemented`

archive/issues_027823.json:
```json
{
    "body": "The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:\n\n```\n    sage: k.<a> = GF(5^2)\n    sage: K, f = k.extension(3, map=True)\n    sage: f(a) in K\n    True\n    sage: f.inverse_image(f(a))\n    AttributeError:\n    ...\n    NotImplementedError\n```\n\nHowever, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that \"section\" means \"the partial inverse map\".\n\nThis ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.\n\n**CC:**  @xcaruso @tscrim\n\n**Keywords:** finitefield, rings\n\n**Branch/Commit:** [a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)\n\n**Reviewer:** Bruno Grenet\n\n**Author:** Johan Rosenkilde\n\nIssue created by migration from https://trac.sagemath.org/ticket/28060\n\n",
    "closed_at": "2019-08-26T22:14:56Z",
    "created_at": "2019-06-26T08:06:22Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Extensions of finite fields embeddings: we have inverse image but `inverse_image` throws `NotImplemented`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28060",
    "user": "https://github.com/johanrosenkilde"
}
```
The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:

```
    sage: k.<a> = GF(5^2)
    sage: K, f = k.extension(3, map=True)
    sage: f(a) in K
    True
    sage: f.inverse_image(f(a))
    AttributeError:
    ...
    NotImplementedError
```

However, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that "section" means "the partial inverse map".

This ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.

**CC:**  @xcaruso @tscrim

**Keywords:** finitefield, rings

**Branch/Commit:** [a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)

**Reviewer:** Bruno Grenet

**Author:** Johan Rosenkilde

Issue created by migration from https://trac.sagemath.org/ticket/28060





---

archive/issue_comments_519699.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The following gives me a map from GF(5^2) to GF(5^6), but there's neither \"inverse\" or \"section\":\n+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither \"inverse\" or \"section\":\n \n ```\n     sage: k.<a> = GF(5^2)\n``````\n",
    "created_at": "2019-06-26T10:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519699",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The following gives me a map from GF(5^2) to GF(5^6), but there's neither "inverse" or "section":
+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither "inverse" or "section":
 
 ```
     sage: k.<a> = GF(5^2)
``````




---

archive/issue_comments_519700.json:
```json
{
    "body": "**Branch:** [u/jsrn/28060_finfield_hom_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/28060_finfield_hom_inverse)",
    "created_at": "2019-06-26T12:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519700",
    "user": "https://github.com/johanrosenkilde"
}
```

**Branch:** [u/jsrn/28060_finfield_hom_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/28060_finfield_hom_inverse)



---

archive/issue_events_078492.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "rename": {
        "from": "Partial map from GF(q^m) to GF(q) is in Sage but not readily available",
        "to": "Extensions of finite fields embeddings: we have inverse image but `inverse_image` throws `NotImplemented`"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28060#event-78492"
}
```



---

archive/issue_comments_519701.json:
```json
{
    "body": "<a id='comment:3'></a>\nOops, I should have updated my ancient Sage before posting this ticket: the `f.section()` method now works fine and gives a partial map from K to k which inverts `f`. Sorry for the noise!\n\nFor usability, I find it very strange that `f.inverse_image(f(a))` does not return `a`, but rather throws a `NotImplementedException`. I'm posting a patch that makes `inverse_image` behave like this.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429\">0d72b81</a></td><td><code>Embedding morphism for finite field extensions: inverse_image</code></td></tr></table>\n",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519701",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:3'></a>
Oops, I should have updated my ancient Sage before posting this ticket: the `f.section()` method now works fine and gives a partial map from K to k which inverts `f`. Sorry for the noise!

For usability, I find it very strange that `f.inverse_image(f(a))` does not return `a`, but rather throws a `NotImplementedException`. I'm posting a patch that makes `inverse_image` behave like this.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429">0d72b81</a></td><td><code>Embedding morphism for finite field extensions: inverse_image</code></td></tr></table>




---

archive/issue_comments_519702.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,39 +1,16 @@\n-The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither \"inverse\" or \"section\":\n+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:\n \n ```\n     sage: k.<a> = GF(5^2)\n     sage: K, f = k.extension(3, map=True)\n     sage: f(a) in K\n     True\n-    sage: f.inverse(f(a))\n+    sage: f.inverse_image(f(a))\n     AttributeError:\n     ...\n-    NotImplementedError: \n-    sage: f.section()\n-    ---------------------------------------------------------------------------\n-    TypeError                                 Traceback (most recent call last)\n-    ...\n-    /opt/sage/sage_devel/local/lib/python2.7/site-packages/sage/rings/finite_rings/hom_finite_field.pyx in sage.rings.finite_rings.hom_finite_field.FiniteFieldHomomorphism_generic.section \n-(build/cythonized/sage/rings/finite_rings/hom_finite_field.c:4900)()\n-    340               Defn: t |--> T^20 + 2*T^18 + T^16 + 2*T^13 + T^9 + 2*T^8 + T^7 + T^6 + T^5 + T^3 + 2*T^2 + T\n-    341         \"\"\"\n---> 342         return self._section_class(self)\n-    343 \n-    344     def __hash__(self):\n-\n-    TypeError: 'NoneType' object is not callable\n+    NotImplementedError\n ```\n \n-The latter calls, apparently incorrectly, the code that *does* produce a map and its partial inverse:\n+However, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that \"section\" means \"the partial inverse map\".\n \n-```\n-    sage: k.<t> = GF(3^7)\n-    sage: K.<T> = GF(3^21)\n-    sage: from sage.rings.finite_rings.hom_finite_field import FiniteFieldHomomorphism_generic\n-    sage: f = FiniteFieldHomomorphism_generic(Hom(k, K))\n-    sage: g = f.section()\n-    sage: g(f(a))\n-    a\n-```\n-\n-On a related note, a redundant implementation of seemingly exactly this map is also available in `sage/coding/relative_finite_field_extension.py`. That implementation should probably be removed and its few uses in `sage/coding` be changed to use the one in `sage/rings/finite_rings/hom_finite_field.pyx`. \n+This ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.\n``````\n",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519702",
    "user": "https://github.com/johanrosenkilde"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,39 +1,16 @@
-The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither "inverse" or "section":
+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:
 
 ```
     sage: k.<a> = GF(5^2)
     sage: K, f = k.extension(3, map=True)
     sage: f(a) in K
     True
-    sage: f.inverse(f(a))
+    sage: f.inverse_image(f(a))
     AttributeError:
     ...
-    NotImplementedError: 
-    sage: f.section()
-    ---------------------------------------------------------------------------
-    TypeError                                 Traceback (most recent call last)
-    ...
-    /opt/sage/sage_devel/local/lib/python2.7/site-packages/sage/rings/finite_rings/hom_finite_field.pyx in sage.rings.finite_rings.hom_finite_field.FiniteFieldHomomorphism_generic.section 
-(build/cythonized/sage/rings/finite_rings/hom_finite_field.c:4900)()
-    340               Defn: t |--> T^20 + 2*T^18 + T^16 + 2*T^13 + T^9 + 2*T^8 + T^7 + T^6 + T^5 + T^3 + 2*T^2 + T
-    341         """
---> 342         return self._section_class(self)
-    343 
-    344     def __hash__(self):
-
-    TypeError: 'NoneType' object is not callable
+    NotImplementedError
 ```
 
-The latter calls, apparently incorrectly, the code that *does* produce a map and its partial inverse:
+However, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that "section" means "the partial inverse map".
 
-```
-    sage: k.<t> = GF(3^7)
-    sage: K.<T> = GF(3^21)
-    sage: from sage.rings.finite_rings.hom_finite_field import FiniteFieldHomomorphism_generic
-    sage: f = FiniteFieldHomomorphism_generic(Hom(k, K))
-    sage: g = f.section()
-    sage: g(f(a))
-    a
-```
-
-On a related note, a redundant implementation of seemingly exactly this map is also available in `sage/coding/relative_finite_field_extension.py`. That implementation should probably be removed and its few uses in `sage/coding` be changed to use the one in `sage/rings/finite_rings/hom_finite_field.pyx`. 
+This ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.
``````




---

archive/issue_comments_519703.json:
```json
{
    "body": "**Commit:** [0d72b8188be821b0d2da31d6d0996678d2f03429](https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429)",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519703",
    "user": "https://github.com/johanrosenkilde"
}
```

**Commit:** [0d72b8188be821b0d2da31d6d0996678d2f03429](https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429)



---

archive/issue_comments_519704.json:
```json
{
    "body": "**Author:** Johan Rosenkilde",
    "created_at": "2019-06-26T12:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519704",
    "user": "https://github.com/johanrosenkilde"
}
```

**Author:** Johan Rosenkilde



---

archive/issue_comments_519705.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-06-26T12:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519705",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_519706.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Johan, I have two very minor comments: \n\n1. There is a typo `methid` instead of `method` in the documentation.\n2. <code>\\`self.section()\\`</code> and <code>\\`b\\`</code> should have double backticks.\n\nOtherwise, LGTM.",
    "created_at": "2019-08-22T09:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519706",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:5'></a>
Hi Johan, I have two very minor comments: 

1. There is a typo `methid` instead of `method` in the documentation.
2. <code>\`self.section()\`</code> and <code>\`b\`</code> should have double backticks.

Otherwise, LGTM.



---

archive/issue_comments_519707.json:
```json
{
    "body": "**Changing commit** from \"[0d72b8188be821b0d2da31d6d0996678d2f03429](https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429)\" to \"[a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)\".",
    "created_at": "2019-08-22T10:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0d72b8188be821b0d2da31d6d0996678d2f03429](https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429)" to "[a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)".



---

archive/issue_comments_519708.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec\">a2ae7de</a></td><td><code>Fix typos pointed out by reviewer</code></td></tr></table>\n",
    "created_at": "2019-08-22T10:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec">a2ae7de</a></td><td><code>Fix typos pointed out by reviewer</code></td></tr></table>




---

archive/issue_comments_519709.json:
```json
{
    "body": "**Reviewer:** Bruno Grenet",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519709",
    "user": "https://github.com/johanrosenkilde"
}
```

**Reviewer:** Bruno Grenet



---

archive/issue_comments_519710.json:
```json
{
    "body": "<a id='comment:7'></a>\nCool, thanks Bruno!",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519710",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:7'></a>
Cool, thanks Bruno!



---

archive/issue_comments_519711.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519711",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_078493.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-26T22:14:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28060#event-78493"
}
```



---

archive/issue_comments_519712.json:
```json
{
    "body": "**Changing branch** from \"[u/jsrn/28060_finfield_hom_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/28060_finfield_hom_inverse)\" to \"[a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)\".",
    "created_at": "2019-08-26T22:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-519712",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jsrn/28060_finfield_hom_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/28060_finfield_hom_inverse)" to "[a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)".
