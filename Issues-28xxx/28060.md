# Issue 28060: Extensions of finite fields embeddings: we have inverse image but `inverse_image` throws `NotImplemented`

archive/issues_027823.json:
```json
{
    "body": "The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:\n\n```\n    sage: k.<a> = GF(5^2)\n    sage: K, f = k.extension(3, map=True)\n    sage: f(a) in K\n    True\n    sage: f.inverse_image(f(a))\n    AttributeError:\n    ...\n    NotImplementedError\n```\n\nHowever, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that \"section\" means \"the partial inverse map\".\n\nThis ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.\n\nCC:  @xcaruso @tscrim\n\nKeywords: finitefield, rings\n\nBranch/Commit: [a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)\n\nReviewer: Bruno Grenet\n\nAuthor: Johan Rosenkilde\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28060\n\n",
    "closed_at": "2019-08-26T22:14:56Z",
    "created_at": "2019-06-26T08:06:22Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Extensions of finite fields embeddings: we have inverse image but `inverse_image` throws `NotImplemented`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28060",
    "user": "https://github.com/johanrosenkilde"
}
```
The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:

```
    sage: k.<a> = GF(5^2)
    sage: K, f = k.extension(3, map=True)
    sage: f(a) in K
    True
    sage: f.inverse_image(f(a))
    AttributeError:
    ...
    NotImplementedError
```

However, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that "section" means "the partial inverse map".

This ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.

CC:  @xcaruso @tscrim

Keywords: finitefield, rings

Branch/Commit: [a2ae7def18a8854d720618e5c60ea960a2e841ec](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)

Reviewer: Bruno Grenet

Author: Johan Rosenkilde

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28060





---

archive/issue_comments_544983.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The following gives me a map from GF(5^2) to GF(5^6), but there's neither \"inverse\" or \"section\":\n+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither \"inverse\" or \"section\":\n \n ```\n     sage: k.<a> = GF(5^2)\n``````\n",
    "created_at": "2019-06-26T10:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544983",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The following gives me a map from GF(5^2) to GF(5^6), but there's neither "inverse" or "section":
+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither "inverse" or "section":
 
 ```
     sage: k.<a> = GF(5^2)
``````




---

archive/issue_comments_544984.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jsrn/28060_finfield_hom_inverse\"",
    "created_at": "2019-06-26T12:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544984",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing branch from "" to "u/jsrn/28060_finfield_hom_inverse"



---

archive/issue_events_078813.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "rename": {
        "from": "Partial map from GF(q^m) to GF(q) is in Sage but not readily available",
        "to": "Extensions of finite fields embeddings: we have inverse image but `inverse_image` throws `NotImplemented`"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28060#event-78813"
}
```



---

archive/issue_comments_544985.json:
```json
{
    "body": "<a id='comment:3'></a>\nOops, I should have updated my ancient Sage before posting this ticket: the `f.section()` method now works fine and gives a partial map from K to k which inverts `f`. Sorry for the noise!\n\nFor usability, I find it very strange that `f.inverse_image(f(a))` does not return `a`, but rather throws a `NotImplementedException`. I'm posting a patch that makes `inverse_image` behave like this.\n\n---\nNew commits:\n|                                                                                                                                          |                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[0d72b81](https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429)|`Embedding morphism for finite field extensions: inverse_image`|",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544985",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:3'></a>
Oops, I should have updated my ancient Sage before posting this ticket: the `f.section()` method now works fine and gives a partial map from K to k which inverts `f`. Sorry for the noise!

For usability, I find it very strange that `f.inverse_image(f(a))` does not return `a`, but rather throws a `NotImplementedException`. I'm posting a patch that makes `inverse_image` behave like this.

---
New commits:
|                                                                                                                                          |                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[0d72b81](https://github.com/sagemath/sagetrac-mirror/commit/0d72b8188be821b0d2da31d6d0996678d2f03429)|`Embedding morphism for finite field extensions: inverse_image`|



---

archive/issue_comments_544986.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,39 +1,16 @@\n-The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither \"inverse\" or \"section\":\n+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:\n \n ```\n     sage: k.<a> = GF(5^2)\n     sage: K, f = k.extension(3, map=True)\n     sage: f(a) in K\n     True\n-    sage: f.inverse(f(a))\n+    sage: f.inverse_image(f(a))\n     AttributeError:\n     ...\n-    NotImplementedError: \n-    sage: f.section()\n-    ---------------------------------------------------------------------------\n-    TypeError                                 Traceback (most recent call last)\n-    ...\n-    /opt/sage/sage_devel/local/lib/python2.7/site-packages/sage/rings/finite_rings/hom_finite_field.pyx in sage.rings.finite_rings.hom_finite_field.FiniteFieldHomomorphism_generic.section \n-(build/cythonized/sage/rings/finite_rings/hom_finite_field.c:4900)()\n-    340               Defn: t |--> T^20 + 2*T^18 + T^16 + 2*T^13 + T^9 + 2*T^8 + T^7 + T^6 + T^5 + T^3 + 2*T^2 + T\n-    341         \"\"\"\n---> 342         return self._section_class(self)\n-    343 \n-    344     def __hash__(self):\n-\n-    TypeError: 'NoneType' object is not callable\n+    NotImplementedError\n ```\n \n-The latter calls, apparently incorrectly, the code that *does* produce a map and its partial inverse:\n+However, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that \"section\" means \"the partial inverse map\".\n \n-```\n-    sage: k.<t> = GF(3^7)\n-    sage: K.<T> = GF(3^21)\n-    sage: from sage.rings.finite_rings.hom_finite_field import FiniteFieldHomomorphism_generic\n-    sage: f = FiniteFieldHomomorphism_generic(Hom(k, K))\n-    sage: g = f.section()\n-    sage: g(f(a))\n-    a\n-```\n-\n-On a related note, a redundant implementation of seemingly exactly this map is also available in `sage/coding/relative_finite_field_extension.py`. That implementation should probably be removed and its few uses in `sage/coding` be changed to use the one in `sage/rings/finite_rings/hom_finite_field.pyx`. \n+This ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.\n``````\n",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544986",
    "user": "https://github.com/johanrosenkilde"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,39 +1,16 @@
-The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>), but there's neither "inverse" or "section":
+The following gives me a map from GF(5<sup>2</sup>) to GF(5<sup>6</sup>) but the following leads users to believe that we can't invert it:
 
 ```
     sage: k.<a> = GF(5^2)
     sage: K, f = k.extension(3, map=True)
     sage: f(a) in K
     True
-    sage: f.inverse(f(a))
+    sage: f.inverse_image(f(a))
     AttributeError:
     ...
-    NotImplementedError: 
-    sage: f.section()
-    ---------------------------------------------------------------------------
-    TypeError                                 Traceback (most recent call last)
-    ...
-    /opt/sage/sage_devel/local/lib/python2.7/site-packages/sage/rings/finite_rings/hom_finite_field.pyx in sage.rings.finite_rings.hom_finite_field.FiniteFieldHomomorphism_generic.section 
-(build/cythonized/sage/rings/finite_rings/hom_finite_field.c:4900)()
-    340               Defn: t |--> T^20 + 2*T^18 + T^16 + 2*T^13 + T^9 + 2*T^8 + T^7 + T^6 + T^5 + T^3 + 2*T^2 + T
-    341         """
---> 342         return self._section_class(self)
-    343 
-    344     def __hash__(self):
-
-    TypeError: 'NoneType' object is not callable
+    NotImplementedError
 ```
 
-The latter calls, apparently incorrectly, the code that *does* produce a map and its partial inverse:
+However, the method `f.section()` provides the (partial) inverse map, and so the user should just have written `f.section()(a)`. I'm sure many users do not know that "section" means "the partial inverse map".
 
-```
-    sage: k.<t> = GF(3^7)
-    sage: K.<T> = GF(3^21)
-    sage: from sage.rings.finite_rings.hom_finite_field import FiniteFieldHomomorphism_generic
-    sage: f = FiniteFieldHomomorphism_generic(Hom(k, K))
-    sage: g = f.section()
-    sage: g(f(a))
-    a
-```
-
-On a related note, a redundant implementation of seemingly exactly this map is also available in `sage/coding/relative_finite_field_extension.py`. That implementation should probably be removed and its few uses in `sage/coding` be changed to use the one in `sage/rings/finite_rings/hom_finite_field.pyx`. 
+This ticket implements the trivial body `f.inverse_image()` so the user does not need to know this.
``````




---

archive/issue_comments_544987.json:
```json
{
    "body": "Changing commit from \"\" to \"0d72b8188be821b0d2da31d6d0996678d2f03429\"",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544987",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing commit from "" to "0d72b8188be821b0d2da31d6d0996678d2f03429"



---

archive/issue_comments_544988.json:
```json
{
    "body": "Changing author from \"\" to \"Johan Rosenkilde\"",
    "created_at": "2019-06-26T12:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544988",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing author from "" to "Johan Rosenkilde"



---

archive/issue_comments_544989.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-26T12:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544989",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_544990.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Johan, I have two very minor comments: \n\n1. There is a typo `methid` instead of `method` in the documentation.\n2. ``self.section()`` and ``b`` should have double backticks.\n\nOtherwise, LGTM.",
    "created_at": "2019-08-22T09:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544990",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:5'></a>
Hi Johan, I have two very minor comments: 

1. There is a typo `methid` instead of `method` in the documentation.
2. ``self.section()`` and ``b`` should have double backticks.

Otherwise, LGTM.



---

archive/issue_comments_544991.json:
```json
{
    "body": "Changing commit from \"0d72b8188be821b0d2da31d6d0996678d2f03429\" to \"a2ae7def18a8854d720618e5c60ea960a2e841ec\"",
    "created_at": "2019-08-22T10:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544991",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0d72b8188be821b0d2da31d6d0996678d2f03429" to "a2ae7def18a8854d720618e5c60ea960a2e841ec"



---

archive/issue_comments_544992.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[a2ae7de](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)|`Fix typos pointed out by reviewer`|",
    "created_at": "2019-08-22T10:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[a2ae7de](https://github.com/sagemath/sagetrac-mirror/commit/a2ae7def18a8854d720618e5c60ea960a2e841ec)|`Fix typos pointed out by reviewer`|



---

archive/issue_comments_544993.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Bruno Grenet\"",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544993",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing reviewer from "" to "Bruno Grenet"



---

archive/issue_comments_544994.json:
```json
{
    "body": "<a id='comment:7'></a>\nCool, thanks Bruno!",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544994",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:7'></a>
Cool, thanks Bruno!



---

archive/issue_comments_544995.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544995",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_544996.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-26T22:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544996",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_078814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-26T22:14:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28060#event-78814"
}
```



---

archive/issue_comments_544997.json:
```json
{
    "body": "Changing branch from \"u/jsrn/28060_finfield_hom_inverse\" to \"a2ae7def18a8854d720618e5c60ea960a2e841ec\"",
    "created_at": "2019-08-26T22:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28060#issuecomment-544997",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jsrn/28060_finfield_hom_inverse" to "a2ae7def18a8854d720618e5c60ea960a2e841ec"
