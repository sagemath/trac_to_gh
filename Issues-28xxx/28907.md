# Issue 28907: remove the method MathematicaElement.N()

archive/issues_028670.json:
```json
{
    "body": "Currently, the method `MathematicaElement.N()` returns a string [#point2 (2)], which is not useful for further computations. It also contradicts the convention of interface elements that `mathematica(1/3).N()` is a more pythonic syntax for `mathematica.N(mathematica(1/3))`, as is the case for all the dynamically added methods in interfaces. So for consistencey, the method `N()` should return a `MathematicaElement` instead of a string.\n\nThis ticket removes the method altogether, for simplicity, as it is not needed anymore [#point1 (1)]. Now a call to `mathematica(1/3).N()` dynamically redirects to Mathematica's `N[]` function and returns a `MathematicaElement` as expected.\n\n---\n\nThis change also reveaved an issue with serialization of Mathematica elements, which is also fixed by this ticket (see `_reduce()`). The corresponding doctest was actually just serializing a string. This is now fixed:\n\n```\nsage: a = mathematica('N[Pi/2,50]')\nsage: loads(dumps(a)) == a            # should be True\n...\nTypeError: Error executing code in Mathematica\nCODE:\n\tsage8=\n1.5707963267948966192313216916397514420985846996875529104874722961539082059438`50.;\nMathematica ERROR:\n```\n\n---\n\nMore details:\n\n[=#point1 (1)] In the past, Sage's object hierarchy used to define a method `N()`, so it had to be overwritten in the interface, but that is no longer the case.\n\n[=#point2 (2)] The return type was changed to string in #18888 as a workaround to an apparent bug in Mathematica itself. This bug does not seem to exist anymore in Mathematica 12, so the workaround is not needed anymore. Indeed, in the following computation, the decimal representation gets correctly truncated after 10 digits\n\n```\nMathematica 12.0.0 Kernel for Linux x86 (64-bit)\nCopyright 1988-2019 Wolfram Research, Inc.\n\nIn[1]:= x2=N[Pi,10]\nOut[1]= 3.141592654\nIn[2]:= InputForm[x2,NumberMarks->False]\nOut[2]//InputForm= 3.1415926536\n```\nwhereas, in [ticket:18888#comment:20] with Mathematica 10.0, the same computation did not truncate the output\n\n```\nIn[4]:= InputForm[x2,NumberMarks->False]\nOut[4]//InputForm= 3.14159265358979323846264338327950419993\n```\n\n\n**CC:**  @dimpase @mkoeppe\n\n**Keywords:** mathematica\n\n**Branch/Commit:** [52f8c9d3ff7fdc84be10151c2aa5a152698d26fa](https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Markus Wageringel\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28907\n\n",
    "closed_at": "2020-01-11T17:45:01Z",
    "created_at": "2019-12-22T20:14:27Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "remove the method MathematicaElement.N()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28907",
    "user": "https://github.com/mwageringel"
}
```
Currently, the method `MathematicaElement.N()` returns a string [#point2 (2)], which is not useful for further computations. It also contradicts the convention of interface elements that `mathematica(1/3).N()` is a more pythonic syntax for `mathematica.N(mathematica(1/3))`, as is the case for all the dynamically added methods in interfaces. So for consistencey, the method `N()` should return a `MathematicaElement` instead of a string.

This ticket removes the method altogether, for simplicity, as it is not needed anymore [#point1 (1)]. Now a call to `mathematica(1/3).N()` dynamically redirects to Mathematica's `N[]` function and returns a `MathematicaElement` as expected.

---

This change also reveaved an issue with serialization of Mathematica elements, which is also fixed by this ticket (see `_reduce()`). The corresponding doctest was actually just serializing a string. This is now fixed:

```
sage: a = mathematica('N[Pi/2,50]')
sage: loads(dumps(a)) == a            # should be True
...
TypeError: Error executing code in Mathematica
CODE:
	sage8=
1.5707963267948966192313216916397514420985846996875529104874722961539082059438`50.;
Mathematica ERROR:
```

---

More details:

[=#point1 (1)] In the past, Sage's object hierarchy used to define a method `N()`, so it had to be overwritten in the interface, but that is no longer the case.

[=#point2 (2)] The return type was changed to string in #18888 as a workaround to an apparent bug in Mathematica itself. This bug does not seem to exist anymore in Mathematica 12, so the workaround is not needed anymore. Indeed, in the following computation, the decimal representation gets correctly truncated after 10 digits

```
Mathematica 12.0.0 Kernel for Linux x86 (64-bit)
Copyright 1988-2019 Wolfram Research, Inc.

In[1]:= x2=N[Pi,10]
Out[1]= 3.141592654
In[2]:= InputForm[x2,NumberMarks->False]
Out[2]//InputForm= 3.1415926536
```
whereas, in [ticket:18888#comment:20] with Mathematica 10.0, the same computation did not truncate the output

```
In[4]:= InputForm[x2,NumberMarks->False]
Out[4]//InputForm= 3.14159265358979323846264338327950419993
```


**CC:**  @dimpase @mkoeppe

**Keywords:** mathematica

**Branch/Commit:** [52f8c9d3ff7fdc84be10151c2aa5a152698d26fa](https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa)

**Reviewer:** Dima Pasechnik

**Author:** Markus Wageringel

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/28907





---

archive/issue_comments_562765.json:
```json
{
    "body": "**Commit:** [52f8c9d3ff7fdc84be10151c2aa5a152698d26fa](https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa)",
    "created_at": "2019-12-22T20:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562765",
    "user": "https://github.com/mwageringel"
}
```

**Commit:** [52f8c9d3ff7fdc84be10151c2aa5a152698d26fa](https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa)



---

archive/issue_comments_562766.json:
```json
{
    "body": "**Author:** Markus Wageringel",
    "created_at": "2019-12-22T20:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562766",
    "user": "https://github.com/mwageringel"
}
```

**Author:** Markus Wageringel



---

archive/issue_comments_562767.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa\">52f8c9d</a></td><td><code>28907: fix return type/remove method MathematicaElement.N()</code></td></tr></table>\n",
    "created_at": "2019-12-22T20:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562767",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa">52f8c9d</a></td><td><code>28907: fix return type/remove method MathematicaElement.N()</code></td></tr></table>




---

archive/issue_comments_562768.json:
```json
{
    "body": "**Branch:** [u/gh-mwageringel/28907](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mwageringel/28907)",
    "created_at": "2019-12-22T20:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562768",
    "user": "https://github.com/mwageringel"
}
```

**Branch:** [u/gh-mwageringel/28907](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mwageringel/28907)



---

archive/issue_comments_562769.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-12-22T20:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562769",
    "user": "https://github.com/mwageringel"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_562770.json:
```json
{
    "body": "<a id='comment:2'></a>\nShouldn't there be a deprecation period set up, before removal?",
    "created_at": "2019-12-23T04:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562770",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
Shouldn't there be a deprecation period set up, before removal?



---

archive/issue_comments_562771.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt is difficult to deprecate this, as the method does not change name, but effectively just changes the return type. However, the string that is currently returned by this method cannot be used to compute anything else in a meaningful way, so it is unlikely that any existing code depends on the return type being a string.",
    "created_at": "2019-12-23T09:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562771",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'></a>
It is difficult to deprecate this, as the method does not change name, but effectively just changes the return type. However, the string that is currently returned by this method cannot be used to compute anything else in a meaningful way, so it is unlikely that any existing code depends on the return type being a string.



---

archive/issue_comments_562772.json:
```json
{
    "body": "<a id='comment:4'></a>\nseems that I don't have access to Mathematica any more, so I can't test :-(",
    "created_at": "2020-01-08T18:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562772",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
seems that I don't have access to Mathematica any more, so I can't test :-(



---

archive/issue_comments_562773.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-01-09T11:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562773",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_562774.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-01-09T11:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562774",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_562775.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK, got mathematica reinstalled on my desktop, all is good with this branch, thanks!",
    "created_at": "2020-01-09T11:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562775",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
OK, got mathematica reinstalled on my desktop, all is good with this branch, thanks!



---

archive/issue_comments_562776.json:
```json
{
    "body": "<a id='comment:6'></a>\nThank you.",
    "created_at": "2020-01-09T18:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562776",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:6'></a>
Thank you.



---

archive/issue_comments_562777.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-mwageringel/28907](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mwageringel/28907)\" to \"[52f8c9d3ff7fdc84be10151c2aa5a152698d26fa](https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa)\".",
    "created_at": "2020-01-11T17:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562777",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-mwageringel/28907](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mwageringel/28907)" to "[52f8c9d3ff7fdc84be10151c2aa5a152698d26fa](https://github.com/sagemath/sagetrac-mirror/commit/52f8c9d3ff7fdc84be10151c2aa5a152698d26fa)".



---

archive/issue_events_082586.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-11T17:45:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28907#event-82586"
}
```



---

archive/issue_comments_562778.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2020-01-11T17:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28907#issuecomment-562778",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
