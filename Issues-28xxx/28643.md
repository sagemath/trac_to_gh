# Issue 28643: Speed up incidence matrix of polyhedra

archive/issues_028406.json:
```json
{
    "body": "We speed up the calculation of the incidence matrix by avoiding recomputation.\n\nThe obvious way to implement it, is by doing a nested loop (one loop for `Vrepresentation`, one for `Hrepresentation`).\nWe do not change this.\nHowever, the inner loop should not recompute things, e.g.\n- the vector of a representation element,\n- the index of a representation element,\n- how to compute the product of two representation element (this consists of nested methods again),\n  instead call the product of two vectors directly.\n\nBefore:\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 2.21 s, sys: 52.4 ms, total: 2.26 s\nWall time: 2.21 s\nsage: P = polytopes.associahedron(['A',10],backend='normaliz')\nsage: %time _ = P.incidence_matrix()\nCPU times: user 21.7 s, sys: 129 ms, total: 21.9 s\nWall time: 21.7 s\n```\n\nAfter:\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 682 ms, sys: 81.4 ms, total: 764 ms\nWall time: 606 ms\nsage: P = polytopes.associahedron(['A',10],backend='normaliz')\nsage: %time _ = P.incidence_matrix()\nCPU times: user 6.16 s, sys: 67.5 ms, total: 6.23 s\nWall time: 6.16 s\n```\n\nCC:  @jplab @laisrast\n\nKeywords: polytopes, incidence matrix\n\nBranch/Commit: 6efb1bc7e06986126e8ba24da4ec9b7b6580be82\n\nReviewer: Laith Rastanawi\n\nAuthor: Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28643\n\n",
    "closed_at": "2019-10-27T10:28:23Z",
    "created_at": "2019-10-22T09:13:17Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Speed up incidence matrix of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28643",
    "user": "https://github.com/kliem"
}
```
We speed up the calculation of the incidence matrix by avoiding recomputation.

The obvious way to implement it, is by doing a nested loop (one loop for `Vrepresentation`, one for `Hrepresentation`).
We do not change this.
However, the inner loop should not recompute things, e.g.
- the vector of a representation element,
- the index of a representation element,
- how to compute the product of two representation element (this consists of nested methods again),
  instead call the product of two vectors directly.

Before:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 2.21 s, sys: 52.4 ms, total: 2.26 s
Wall time: 2.21 s
sage: P = polytopes.associahedron(['A',10],backend='normaliz')
sage: %time _ = P.incidence_matrix()
CPU times: user 21.7 s, sys: 129 ms, total: 21.9 s
Wall time: 21.7 s
```

After:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 682 ms, sys: 81.4 ms, total: 764 ms
Wall time: 606 ms
sage: P = polytopes.associahedron(['A',10],backend='normaliz')
sage: %time _ = P.incidence_matrix()
CPU times: user 6.16 s, sys: 67.5 ms, total: 6.23 s
Wall time: 6.16 s
```

CC:  @jplab @laisrast

Keywords: polytopes, incidence matrix

Branch/Commit: 6efb1bc7e06986126e8ba24da4ec9b7b6580be82

Reviewer: Laith Rastanawi

Author: Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28643





---

archive/issue_comments_427085.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-10-22T09:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427085",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_427086.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-22T09:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427086",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_427087.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n We speed up the calculation of the incidence matrix by avoiding recomputation.\n+\n+The obvious way to implement it, is by doing a nested loop (one loop for \\`Vrepresentation\\`, one for \\`Hrepresentation\\`).\n+We do not change this.\n+However, the inner loop should not recompute things, e.g.\n+- the vector of a representation element,\n+- the index of a representation element,\n+- how to compute the product of two representation element (this consists of nested methods again),\n+  instead call the product of two vectors directly.\n \n Before:\n \n```\n",
    "created_at": "2019-10-22T09:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427087",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
 We speed up the calculation of the incidence matrix by avoiding recomputation.
+
+The obvious way to implement it, is by doing a nested loop (one loop for \`Vrepresentation\`, one for \`Hrepresentation\`).
+We do not change this.
+However, the inner loop should not recompute things, e.g.
+- the vector of a representation element,
+- the index of a representation element,
+- how to compute the product of two representation element (this consists of nested methods again),
+  instead call the product of two vectors directly.
 
 Before:
 
```




---

archive/issue_comments_427088.json:
```json
{
    "body": "<a id='comment:3'></a>It is faster and still correct.\nOne suggestion: I think it would be a good idea to add more examples in the docstring.\nFor instance, you can add an example for unbounded polyhedron:\n\n```\nsage: P = Polyhedron(vertices=[(1,0,0), (1,1,0)], rays=[(1,0,0)], lines=[(0,0,1)])\nsage: P.incidence_matrix()\n[1 1 1]\n[1 1 0]\n[1 0 1]\n[0 1 1]\n```",
    "created_at": "2019-10-22T09:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427088",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:3'></a>It is faster and still correct.
One suggestion: I think it would be a good idea to add more examples in the docstring.
For instance, you can add an example for unbounded polyhedron:

```
sage: P = Polyhedron(vertices=[(1,0,0), (1,1,0)], rays=[(1,0,0)], lines=[(0,0,1)])
sage: P.incidence_matrix()
[1 1 1]
[1 1 0]
[1 0 1]
[0 1 1]
```



---

archive/issue_comments_427089.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T10:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_427090.json:
```json
{
    "body": "<a id='comment:5'></a>You wrote that \"The incidence matrix is not unique up to permutation for unbounded polyhedra\", I believe you meant something else.\n\nPlus, it would be nice to include the following example (which you suggested before). This is an example of two \"combinatorially isomorphic\" polyhedra with different incidence matrices.\n\n```\nsage: P1 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1]])\nsage: P1.incidence_matrix()\n[1 1 0]\n[1 0 1]\n[0 1 1]\nsage: P2 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1], [1,1]])\nsage: P2.incidence_matrix()\n[1 1 0]\n[1 0 0]\n[0 1 1]\n[0 0 1]\n```",
    "created_at": "2019-10-22T12:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427090",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:5'></a>You wrote that "The incidence matrix is not unique up to permutation for unbounded polyhedra", I believe you meant something else.

Plus, it would be nice to include the following example (which you suggested before). This is an example of two "combinatorially isomorphic" polyhedra with different incidence matrices.

```
sage: P1 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1]])
sage: P1.incidence_matrix()
[1 1 0]
[1 0 1]
[0 1 1]
sage: P2 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1], [1,1]])
sage: P2.incidence_matrix()
[1 1 0]
[1 0 0]
[0 1 1]
[0 0 1]
```



---

archive/issue_comments_427091.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T13:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427091",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_427092.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-22T13:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427092",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_427093.json:
```json
{
    "body": "<a id='comment:7'></a>I think it is good to go.",
    "created_at": "2019-10-22T13:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427093",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:7'></a>I think it is good to go.



---

archive/issue_comments_427094.json:
```json
{
    "body": "<a id='comment:8'></a>May I suggest:\n\n```\n-        The incidence matrix does not uniquely determine\n-        an unbounded polyhedra::\n+        An incidence matrix does not determine a unique \n+        polyhedra::\n```",
    "created_at": "2019-10-24T09:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427094",
    "user": "https://github.com/jplab"
}
```

<a id='comment:8'></a>May I suggest:

```
-        The incidence matrix does not uniquely determine
-        an unbounded polyhedra::
+        An incidence matrix does not determine a unique 
+        polyhedra::
```



---

archive/issue_comments_427095.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-10-24T09:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427095",
    "user": "https://github.com/jplab"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_427096.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-25T09:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_427097.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-25T09:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427097",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_427098.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-25T09:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427098",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_427099.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-27T10:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28643#issuecomment-427099",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_072130.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-27T10:28:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28643",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28643#event-72130"
}
```
