# Issue 28232: py3: fix doctests in doctest/test

archive/issues_027995.json:
```json
{
    "body": "This ticket fixes the last Python 3 doctest failure in doctest/test.py.\n\nThe problem is that the doctest dispatcher relies on internals of the multiprocessing library, which slightly changed in Python 3; see the [relevant file](https://github.com/python/cpython/blob/3.7/Lib/multiprocessing/process.py#L365). Because of that, until now with Python 3, the master doctest process waits for its children to exit before exiting itself, even though it is not supposed to.\n\nI also adjusted the affected doctest so that it checks for what was initially intended. This got lost when the minimum `die_timeout` of subprocesses got increased from 20 to 60 seconds, but this also means the doctest now lasts 40 seconds longer than before.\n\n\nReviewer: John Palmieri\n\nAuthor: Markus Wageringel\n\nBranch: 4be8c5ddb39cc3f49ece3c2181a9c23649c002ea\n\nCommit: 4be8c5ddb39cc3f49ece3c2181a9c23649c002ea\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28232\n\n",
    "closed_at": "2019-07-29T21:54:22Z",
    "created_at": "2019-07-22T23:27:18Z",
    "labels": [
        "component: python3",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "py3: fix doctests in doctest/test",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28232",
    "user": "https://github.com/mwageringel"
}
```
This ticket fixes the last Python 3 doctest failure in doctest/test.py.

The problem is that the doctest dispatcher relies on internals of the multiprocessing library, which slightly changed in Python 3; see the [relevant file](https://github.com/python/cpython/blob/3.7/Lib/multiprocessing/process.py#L365). Because of that, until now with Python 3, the master doctest process waits for its children to exit before exiting itself, even though it is not supposed to.

I also adjusted the affected doctest so that it checks for what was initially intended. This got lost when the minimum `die_timeout` of subprocesses got increased from 20 to 60 seconds, but this also means the doctest now lasts 40 seconds longer than before.


Reviewer: John Palmieri

Author: Markus Wageringel

Branch: 4be8c5ddb39cc3f49ece3c2181a9c23649c002ea

Commit: 4be8c5ddb39cc3f49ece3c2181a9c23649c002ea

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28232





---

archive/issue_comments_395144.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-22T23:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28232#issuecomment-395144",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_395145.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-07-22T23:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28232#issuecomment-395145",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_395146.json:
```json
{
    "body": "<a id='comment:2'></a>Nice work. Looks good to me.",
    "created_at": "2019-07-23T02:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28232#issuecomment-395146",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>Nice work. Looks good to me.



---

archive/issue_comments_395147.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-23T02:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28232#issuecomment-395147",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_070212.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-29T21:54:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28232",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28232#event-70212"
}
```



---

archive/issue_comments_395148.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-29T21:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28232#issuecomment-395148",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
