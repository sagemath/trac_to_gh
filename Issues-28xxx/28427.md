# Issue 28427: Various improvements to Lie algebras

archive/issues_028190.json:
```json
{
    "assignees": [],
    "body": "We fix a bug in constructing the `0` element of a Lie algebra by putting that path higher in the `_element_constructor_`.\n\nWe make all of the Lie algebras and modules in `virasoro.py` know that they are graded.\n\nImplement a fallback to the PBW basis for when the construction of the universal enveloping algebra fails for finite-dimensional Lie algebras with a basis.\n\nAllow coercions and actions between Lie algebras to lift to the PBW bases.\n\n**CC:**  @darijgr\n\n**Keywords:** lie algebra\n\n**Branch/Commit:** [1e2ecab106f621b4687a76a0308ef19525b2d4d7](https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton, Darij Grinberg\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/28427\n\n",
    "closed_at": "2019-09-05T21:33:02Z",
    "created_at": "2019-08-30T04:20:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Various improvements to Lie algebras",
    "type": "issue",
    "updated_at": "2019-09-05T21:33:02Z",
    "url": "https://github.com/sagemath/sage/issues/28427",
    "user": "https://github.com/tscrim"
}
```
We fix a bug in constructing the `0` element of a Lie algebra by putting that path higher in the `_element_constructor_`.

We make all of the Lie algebras and modules in `virasoro.py` know that they are graded.

Implement a fallback to the PBW basis for when the construction of the universal enveloping algebra fails for finite-dimensional Lie algebras with a basis.

Allow coercions and actions between Lie algebras to lift to the PBW bases.

**CC:**  @darijgr

**Keywords:** lie algebra

**Branch/Commit:** [1e2ecab106f621b4687a76a0308ef19525b2d4d7](https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7)

**Reviewer:** Frédéric Chapoton, Darij Grinberg

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/28427





---

archive/issue_events_341599.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-30T04:20:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341599"
}
```



---

archive/issue_events_341600.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-30T04:20:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "08517b",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341600"
}
```



---

archive/issue_events_341601.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-30T04:20:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341601"
}
```



---

archive/issue_comments_445604.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7217b2e3d349167fe3545970ba216e2d6c428a28\">7217b2e</a></td><td><code>Various improvements to Lie algebras.</code></td></tr></table>\n",
    "created_at": "2019-08-30T04:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445604",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7217b2e3d349167fe3545970ba216e2d6c428a28">7217b2e</a></td><td><code>Various improvements to Lie algebras.</code></td></tr></table>




---

archive/issue_events_341602.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-30T04:22:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341602"
}
```



---

archive/issue_comments_445605.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n We fix a bug in constructing the `0` element of a Lie algebra by putting that path higher in the `_element_constructor_`.\n \n We make all of the Lie algebras and modules in `virasoro.py` know that they are graded.\n+\n+Implement a fallback to the PBW basis for when the construction of the universal enveloping algebra fails for finite-dimensional Lie algebras with a basis.\n``````\n",
    "created_at": "2019-08-30T04:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445605",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 We fix a bug in constructing the `0` element of a Lie algebra by putting that path higher in the `_element_constructor_`.
 
 We make all of the Lie algebras and modules in `virasoro.py` know that they are graded.
+
+Implement a fallback to the PBW basis for when the construction of the universal enveloping algebra fails for finite-dimensional Lie algebras with a basis.
``````




---

archive/issue_comments_445606.json:
```json
{
    "body": "**Branch:** [public/lie_algebras/various_improvements-28427](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/various_improvements-28427)",
    "created_at": "2019-08-30T04:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445606",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/lie_algebras/various_improvements-28427](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/various_improvements-28427)



---

archive/issue_comments_445607.json:
```json
{
    "body": "**Commit:** [7217b2e3d349167fe3545970ba216e2d6c428a28](https://github.com/sagemath/sagetrac-mirror/commit/7217b2e3d349167fe3545970ba216e2d6c428a28)",
    "created_at": "2019-08-30T04:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445607",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [7217b2e3d349167fe3545970ba216e2d6c428a28](https://github.com/sagemath/sagetrac-mirror/commit/7217b2e3d349167fe3545970ba216e2d6c428a28)



---

archive/issue_comments_445608.json:
```json
{
    "body": "<a id='comment:2'></a>\nPlease fix the doc of the Virasoro degree_on_basis function: it should mention c, too.\n\n```\n+        We skip the grading test as we need to be able to echelonize a\n+        matrix over the base ring as part of the test::\n+\n             sage: L = lie_algebras.pwitt(Zmod(6), 6)\n-            sage: TestSuite(L).run()  # not tested -- universal envelope doesn't work\n-            sage: L._test_jacobi_identity()\n+            sage: TestSuite(L).run(skip=\"_test_grading\"\n```\nWhat needs to be echelonized?\n\nThe runtime error check is a bit of a hack -- but it may well be fine. Are you sure Singular will always throw a runtime error if it doesn't recognize the base ring as a field, as opposed to silently responding with a wrong result?",
    "created_at": "2019-08-30T07:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445608",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:2'></a>
Please fix the doc of the Virasoro degree_on_basis function: it should mention c, too.

```
+        We skip the grading test as we need to be able to echelonize a
+        matrix over the base ring as part of the test::
+
             sage: L = lie_algebras.pwitt(Zmod(6), 6)
-            sage: TestSuite(L).run()  # not tested -- universal envelope doesn't work
-            sage: L._test_jacobi_identity()
+            sage: TestSuite(L).run(skip="_test_grading"
```
What needs to be echelonized?

The runtime error check is a bit of a hack -- but it may well be fine. Are you sure Singular will always throw a runtime error if it doesn't recognize the base ring as a field, as opposed to silently responding with a wrong result?



---

archive/issue_comments_445609.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [@darijgr](#comment%3A2):\n> \n> ```\n> +        We skip the grading test as we need to be able to echelonize a\n> +        matrix over the base ring as part of the test::\n> +\n>              sage: L = lie_algebras.pwitt(Zmod(6), 6)\n> -            sage: TestSuite(L).run()  # not tested -- universal envelope doesn't work\n> -            sage: L._test_jacobi_identity()\n> +            sage: TestSuite(L).run(skip=\"_test_grading\"\n> ```\n> What needs to be echelonized?\n\nIt is done in computing the homogeneous degree component as part of the test.\n\n> The runtime error check is a bit of a hack -- but it may well be fine. Are you sure Singular will always throw a runtime error if it doesn't recognize the base ring as a field, as opposed to silently responding with a wrong result?\n\nThe reason Singular throws the error is because it only can work over certain base rings. If it silently returns a wrong result, then there is nothing anyone can do except submit an upstream bug report.",
    "created_at": "2019-08-30T07:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445609",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Replying to [@darijgr](#comment%3A2):
> 
> ```
> +        We skip the grading test as we need to be able to echelonize a
> +        matrix over the base ring as part of the test::
> +
>              sage: L = lie_algebras.pwitt(Zmod(6), 6)
> -            sage: TestSuite(L).run()  # not tested -- universal envelope doesn't work
> -            sage: L._test_jacobi_identity()
> +            sage: TestSuite(L).run(skip="_test_grading"
> ```
> What needs to be echelonized?

It is done in computing the homogeneous degree component as part of the test.

> The runtime error check is a bit of a hack -- but it may well be fine. Are you sure Singular will always throw a runtime error if it doesn't recognize the base ring as a field, as opposed to silently responding with a wrong result?

The reason Singular throws the error is because it only can work over certain base rings. If it silently returns a wrong result, then there is nothing anyone can do except submit an upstream bug report.



---

archive/issue_comments_445610.json:
```json
{
    "body": "<a id='comment:4'></a>\nDoes Singular say that it's not going to work over a non-field, or does it try and panic when some division fails? In the former case, what you're doing is fine; in the latter I'd be more careful.\n\nStill not sure why the echelon form may be needed in the test suite, but you know better. I'm fine with or without the tests; the grading on the Witt algebra is so obvious there can't be any trouble from that front :)\n\nCare to mention c in the doc of Virasoro's degree function? Everything apart of this (and the possible Singular issue, if it is one) LGTM. (Sorry for the absence of more significant code review from me lately...)",
    "created_at": "2019-08-30T09:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445610",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:4'></a>
Does Singular say that it's not going to work over a non-field, or does it try and panic when some division fails? In the former case, what you're doing is fine; in the latter I'd be more careful.

Still not sure why the echelon form may be needed in the test suite, but you know better. I'm fine with or without the tests; the grading on the Witt algebra is so obvious there can't be any trouble from that front :)

Care to mention c in the doc of Virasoro's degree function? Everything apart of this (and the possible Singular issue, if it is one) LGTM. (Sorry for the absence of more significant code review from me lately...)



---

archive/issue_comments_445611.json:
```json
{
    "body": "<a id='comment:5'></a>\nYou are way overthinking this Singular thing. Just run the test and you will see for the echelonization.\n\nI am planning on mentioning the c, but I am not at my computer right now.",
    "created_at": "2019-08-30T09:20:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445611",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
You are way overthinking this Singular thing. Just run the test and you will see for the echelonization.

I am planning on mentioning the c, but I am not at my computer right now.



---

archive/issue_comments_445612.json:
```json
{
    "body": "**Changing commit** from \"[7217b2e3d349167fe3545970ba216e2d6c428a28](https://github.com/sagemath/sagetrac-mirror/commit/7217b2e3d349167fe3545970ba216e2d6c428a28)\" to \"[91db3fa31ec4ba81a9004872fad8e48231fafae6](https://github.com/sagemath/sagetrac-mirror/commit/91db3fa31ec4ba81a9004872fad8e48231fafae6)\".",
    "created_at": "2019-08-31T01:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445612",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[7217b2e3d349167fe3545970ba216e2d6c428a28](https://github.com/sagemath/sagetrac-mirror/commit/7217b2e3d349167fe3545970ba216e2d6c428a28)" to "[91db3fa31ec4ba81a9004872fad8e48231fafae6](https://github.com/sagemath/sagetrac-mirror/commit/91db3fa31ec4ba81a9004872fad8e48231fafae6)".



---

archive/issue_comments_445613.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91db3fa31ec4ba81a9004872fad8e48231fafae6\">91db3fa</a></td><td><code>Improving doc, extending actions and coercions to PBW basis.</code></td></tr></table>\n",
    "created_at": "2019-08-31T01:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445613",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91db3fa31ec4ba81a9004872fad8e48231fafae6">91db3fa</a></td><td><code>Improving doc, extending actions and coercions to PBW basis.</code></td></tr></table>




---

archive/issue_comments_445614.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n We make all of the Lie algebras and modules in `virasoro.py` know that they are graded.\n \n Implement a fallback to the PBW basis for when the construction of the universal enveloping algebra fails for finite-dimensional Lie algebras with a basis.\n+\n+Allow coercions and actions between Lie algebras to lift to the PBW bases.\n``````\n",
    "created_at": "2019-08-31T01:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445614",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 We make all of the Lie algebras and modules in `virasoro.py` know that they are graded.
 
 Implement a fallback to the PBW basis for when the construction of the universal enveloping algebra fails for finite-dimensional Lie algebras with a basis.
+
+Allow coercions and actions between Lie algebras to lift to the PBW bases.
``````




---

archive/issue_comments_445615.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have updated the documentation. I also was more precise about that singular is failing for the **Z**/6**Z** example (although its documentation does (implicitly) say the algebra needs to be defined over a field; at least, I am fairly certain it needs an integral domain). I also did another improvement that I think would be useful, to allow coercions and actions to lift to the PBW basis.\n\nHere also is the traceback of what happens in the grading test:\n\n```\nsage: L = lie_algebras.pwitt(Zmod(6), 6)\nsage: L._test_grading()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-2-fb4e02d44a27> in <module>()\n----> 1 L._test_grading()\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/finite_dimensional_graded_lie_algebras_with_basis.pyc in _test_grading(self, **options)\n     82                         (X, Y, Zdeg, i + j))\n     83                 tester.assertTrue(\n---> 84                     Z.to_vector() in self.homogeneous_component_as_submodule(i + j),\n     85                     msg=\"Lie bracket [%s, %s] is not in the \"\n     86                         \"homogeneous component of degree %s\" % (X, Y, i + j))\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)()\n   1947                 return cache[k]\n   1948         except KeyError:\n-> 1949             w = self._instance_call(*args, **kwds)\n   1950             cache[k] = w\n   1951             return w\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)()\n   1823             True\n   1824         \"\"\"\n-> 1825         return self.f(self._instance, *args, **kwds)\n   1826 \n   1827     cdef fix_args_kwds(self, tuple args, dict kwds):\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/finite_dimensional_graded_lie_algebras_with_basis.pyc in homogeneous_component_as_submodule(self, d)\n    104             \"\"\"\n    105             B = self.homogeneous_component_basis(d)\n--> 106             return self.module().submodule([X.to_vector() for X in B])\n    107 \n    108     class Stratified(CategoryWithAxiom_over_base_ring):\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in submodule(self, gens, check, already_echelonized, unitriangular, category)\n    813             \"\"\"\n    814             if not already_echelonized:\n--> 815                 gens = self.echelon_form(gens, unitriangular)\n    816             from sage.modules.with_basis.subquotient import SubmoduleWithBasis\n    817             return SubmoduleWithBasis(gens, ambient=self,\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in echelon_form(self, elements, row_reduced)\n    657                     raise ValueError(\"unable to compute the row reduced echelon form\")\n    658             else:\n--> 659                 mat.echelonize()\n    660             return [self.from_vector(vec) for vec in mat if vec]\n    661 \n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/matrix/matrix_modn_dense_template.pxi in sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_template.echelonize (build/cythonized/sage/matrix/matrix_modn_dense_float.cpp:12657)()\n   1851 \n   1852         if not self.base_ring().is_field():\n-> 1853             raise NotImplementedError(\"Echelon form not implemented over '%s'.\"%self.base_ring())\n   1854 \n   1855         if algorithm == 'linbox':\n\nNotImplementedError: Echelon form not implemented over 'Ring of integers modulo 6'.\n```\nYou can see where it needs to be able to echelonize a matrix. If we wanted to fix this, we would have to change the test itself by weakening it when it is not over a field (which should be a separate ticket as that has farther reaching implications).\n\nAlso, no problem with not doing more reviewing. I know you are starting a new tenure-track job. `;)`",
    "created_at": "2019-08-31T01:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445615",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
I have updated the documentation. I also was more precise about that singular is failing for the **Z**/6**Z** example (although its documentation does (implicitly) say the algebra needs to be defined over a field; at least, I am fairly certain it needs an integral domain). I also did another improvement that I think would be useful, to allow coercions and actions to lift to the PBW basis.

Here also is the traceback of what happens in the grading test:

```
sage: L = lie_algebras.pwitt(Zmod(6), 6)
sage: L._test_grading()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-2-fb4e02d44a27> in <module>()
----> 1 L._test_grading()

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/finite_dimensional_graded_lie_algebras_with_basis.pyc in _test_grading(self, **options)
     82                         (X, Y, Zdeg, i + j))
     83                 tester.assertTrue(
---> 84                     Z.to_vector() in self.homogeneous_component_as_submodule(i + j),
     85                     msg="Lie bracket [%s, %s] is not in the "
     86                         "homogeneous component of degree %s" % (X, Y, i + j))

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)()
   1947                 return cache[k]
   1948         except KeyError:
-> 1949             w = self._instance_call(*args, **kwds)
   1950             cache[k] = w
   1951             return w

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)()
   1823             True
   1824         """
-> 1825         return self.f(self._instance, *args, **kwds)
   1826 
   1827     cdef fix_args_kwds(self, tuple args, dict kwds):

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/finite_dimensional_graded_lie_algebras_with_basis.pyc in homogeneous_component_as_submodule(self, d)
    104             """
    105             B = self.homogeneous_component_basis(d)
--> 106             return self.module().submodule([X.to_vector() for X in B])
    107 
    108     class Stratified(CategoryWithAxiom_over_base_ring):

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in submodule(self, gens, check, already_echelonized, unitriangular, category)
    813             """
    814             if not already_echelonized:
--> 815                 gens = self.echelon_form(gens, unitriangular)
    816             from sage.modules.with_basis.subquotient import SubmoduleWithBasis
    817             return SubmoduleWithBasis(gens, ambient=self,

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in echelon_form(self, elements, row_reduced)
    657                     raise ValueError("unable to compute the row reduced echelon form")
    658             else:
--> 659                 mat.echelonize()
    660             return [self.from_vector(vec) for vec in mat if vec]
    661 

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/matrix/matrix_modn_dense_template.pxi in sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_template.echelonize (build/cythonized/sage/matrix/matrix_modn_dense_float.cpp:12657)()
   1851 
   1852         if not self.base_ring().is_field():
-> 1853             raise NotImplementedError("Echelon form not implemented over '%s'."%self.base_ring())
   1854 
   1855         if algorithm == 'linbox':

NotImplementedError: Echelon form not implemented over 'Ring of integers modulo 6'.
```
You can see where it needs to be able to echelonize a matrix. If we wanted to fix this, we would have to change the test itself by weakening it when it is not over a field (which should be a separate ticket as that has farther reaching implications).

Also, no problem with not doing more reviewing. I know you are starting a new tenure-track job. `;)`



---

archive/issue_comments_445616.json:
```json
{
    "body": "<a id='comment:8'></a>\nHmm...something broke with that latest push for the Verma modules. I need to investigate.",
    "created_at": "2019-08-31T01:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445616",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Hmm...something broke with that latest push for the Verma modules. I need to investigate.



---

archive/issue_events_341603.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-31T01:09:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341603"
}
```



---

archive/issue_events_341604.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-31T01:09:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341604"
}
```



---

archive/issue_comments_445617.json:
```json
{
    "body": "<a id='comment:9'></a>\nSo the problem comes from extending the action of the Lie algebra to the PBW basis (i.e., not the additional coercions allowed).",
    "created_at": "2019-08-31T01:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445617",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
So the problem comes from extending the action of the Lie algebra to the PBW basis (i.e., not the additional coercions allowed).



---

archive/issue_comments_445618.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ca9fb82345b70a561fc5cbe02783c5cbaf4057\">08ca9fb</a></td><td><code>Fixing bug with extending the action and adding a shortcut.</code></td></tr></table>\n",
    "created_at": "2019-08-31T01:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445618",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ca9fb82345b70a561fc5cbe02783c5cbaf4057">08ca9fb</a></td><td><code>Fixing bug with extending the action and adding a shortcut.</code></td></tr></table>




---

archive/issue_comments_445619.json:
```json
{
    "body": "**Changing commit** from \"[91db3fa31ec4ba81a9004872fad8e48231fafae6](https://github.com/sagemath/sagetrac-mirror/commit/91db3fa31ec4ba81a9004872fad8e48231fafae6)\" to \"[08ca9fb82345b70a561fc5cbe02783c5cbaf4057](https://github.com/sagemath/sagetrac-mirror/commit/08ca9fb82345b70a561fc5cbe02783c5cbaf4057)\".",
    "created_at": "2019-08-31T01:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445619",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[91db3fa31ec4ba81a9004872fad8e48231fafae6](https://github.com/sagemath/sagetrac-mirror/commit/91db3fa31ec4ba81a9004872fad8e48231fafae6)" to "[08ca9fb82345b70a561fc5cbe02783c5cbaf4057](https://github.com/sagemath/sagetrac-mirror/commit/08ca9fb82345b70a561fc5cbe02783c5cbaf4057)".



---

archive/issue_comments_445620.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9ce01ca595f6f94ee333b56324581470fdaeb94\">c9ce01c</a></td><td><code>Fixing bug with extending the action and adding a shortcut.</code></td></tr></table>\n",
    "created_at": "2019-08-31T01:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445620",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9ce01ca595f6f94ee333b56324581470fdaeb94">c9ce01c</a></td><td><code>Fixing bug with extending the action and adding a shortcut.</code></td></tr></table>




---

archive/issue_comments_445621.json:
```json
{
    "body": "**Changing commit** from \"[08ca9fb82345b70a561fc5cbe02783c5cbaf4057](https://github.com/sagemath/sagetrac-mirror/commit/08ca9fb82345b70a561fc5cbe02783c5cbaf4057)\" to \"[c9ce01ca595f6f94ee333b56324581470fdaeb94](https://github.com/sagemath/sagetrac-mirror/commit/c9ce01ca595f6f94ee333b56324581470fdaeb94)\".",
    "created_at": "2019-08-31T01:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445621",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[08ca9fb82345b70a561fc5cbe02783c5cbaf4057](https://github.com/sagemath/sagetrac-mirror/commit/08ca9fb82345b70a561fc5cbe02783c5cbaf4057)" to "[c9ce01ca595f6f94ee333b56324581470fdaeb94](https://github.com/sagemath/sagetrac-mirror/commit/c9ce01ca595f6f94ee333b56324581470fdaeb94)".



---

archive/issue_events_341605.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-31T01:44:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341605"
}
```



---

archive/issue_events_341606.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-08-31T01:44:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341606"
}
```



---

archive/issue_comments_445622.json:
```json
{
    "body": "<a id='comment:12'></a>\nOkay, I fixed the problem. I forgot to also add the coefficient to the product `>_<`. I also added a shortcut for the action when there is a specialized PBW action implemented on a module (e.g., Verma modules).",
    "created_at": "2019-08-31T01:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445622",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Okay, I fixed the problem. I forgot to also add the coefficient to the product `>_<`. I also added a shortcut for the action when there is a specialized PBW action implemented on a module (e.g., Verma modules).



---

archive/issue_comments_445623.json:
```json
{
    "body": "<a id='comment:13'></a>\nsome warnings, see patchbot plugins",
    "created_at": "2019-08-31T07:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445623",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
some warnings, see patchbot plugins



---

archive/issue_comments_445624.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7\">1e2ecab</a></td><td><code>Fixing patchbot and pyflakes warnings.</code></td></tr></table>\n",
    "created_at": "2019-08-31T08:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445624",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7">1e2ecab</a></td><td><code>Fixing patchbot and pyflakes warnings.</code></td></tr></table>




---

archive/issue_comments_445625.json:
```json
{
    "body": "**Changing commit** from \"[c9ce01ca595f6f94ee333b56324581470fdaeb94](https://github.com/sagemath/sagetrac-mirror/commit/c9ce01ca595f6f94ee333b56324581470fdaeb94)\" to \"[1e2ecab106f621b4687a76a0308ef19525b2d4d7](https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7)\".",
    "created_at": "2019-08-31T08:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445625",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c9ce01ca595f6f94ee333b56324581470fdaeb94](https://github.com/sagemath/sagetrac-mirror/commit/c9ce01ca595f6f94ee333b56324581470fdaeb94)" to "[1e2ecab106f621b4687a76a0308ef19525b2d4d7](https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7)".



---

archive/issue_comments_445626.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@fchapoton](#comment%3A13):\n> some warnings, see patchbot plugins\n\nFixed.",
    "created_at": "2019-08-31T08:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445626",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
Replying to [@fchapoton](#comment%3A13):
> some warnings, see patchbot plugins

Fixed.



---

archive/issue_comments_445627.json:
```json
{
    "body": "<a id='comment:16'></a>\nok, good to go",
    "created_at": "2019-09-01T06:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445627",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
ok, good to go



---

archive/issue_comments_445628.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2019-09-01T06:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445628",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_events_341607.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-01T06:19:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341607"
}
```



---

archive/issue_events_341608.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-01T06:19:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341608"
}
```



---

archive/issue_comments_445629.json:
```json
{
    "body": "<a id='comment:18'></a>\nThank you. I am also adding Darij as a reviewer for his comments.",
    "created_at": "2019-09-01T08:53:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445629",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
Thank you. I am also adding Darij as a reviewer for his comments.



---

archive/issue_comments_445630.json:
```json
{
    "body": "**Changing reviewer** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Darij Grinberg\".",
    "created_at": "2019-09-01T08:53:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445630",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Frédéric Chapoton" to "Frédéric Chapoton, Darij Grinberg".



---

archive/issue_events_341609.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-09-05T21:33:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341609"
}
```



---

archive/issue_events_341610.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1ad1ee62acab978d11ec901d86c3513b9960c70f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-09-05T21:33:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28427#event-341610"
}
```



---

archive/issue_comments_445631.json:
```json
{
    "body": "**Changing branch** from \"[public/lie_algebras/various_improvements-28427](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/various_improvements-28427)\" to \"[1e2ecab106f621b4687a76a0308ef19525b2d4d7](https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7)\".",
    "created_at": "2019-09-05T21:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28427#issuecomment-445631",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/lie_algebras/various_improvements-28427](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/various_improvements-28427)" to "[1e2ecab106f621b4687a76a0308ef19525b2d4d7](https://github.com/sagemath/sagetrac-mirror/commit/1e2ecab106f621b4687a76a0308ef19525b2d4d7)".
