# Issue 28467: wrong bound in "Cannot compute primes beyond ..."

archive/issues_028230.json:
```json
{
    "body": "with Sage 8.8:\n\n```\nsage: sum(1./p for p in prime_range(436272668))\n...\nValueError: Cannot compute primes beyond 436273290\n```\nClearly the value 436272668 is below the given bound, thus the error message is misleading.\n\nCC:  @fchapoton\n\nBranch/Commit: 18e481910ad1785bf9fde990fab68ff75a4a7314\n\nReviewer: Paul Zimmermann, Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix, Samuel Leli\u00e8vre, Dima Pasechnik\n\nAuthor: Dave Morris\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28467\n\n",
    "closed_at": "2020-11-07T16:23:18Z",
    "created_at": "2019-09-09T15:52:31Z",
    "labels": [
        "component: number theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "wrong bound in \"Cannot compute primes beyond ...\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28467",
    "user": "https://github.com/zimmermann6"
}
```
with Sage 8.8:

```
sage: sum(1./p for p in prime_range(436272668))
...
ValueError: Cannot compute primes beyond 436273290
```
Clearly the value 436272668 is below the given bound, thus the error message is misleading.

CC:  @fchapoton

Branch/Commit: 18e481910ad1785bf9fde990fab68ff75a4a7314

Reviewer: Paul Zimmermann, Frédéric Chapoton, Vincent Delecroix, Samuel Lelièvre, Dima Pasechnik

Author: Dave Morris

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28467





---

archive/issue_comments_424433.json:
```json
{
    "body": "<a id='comment:2'></a>Instead of improving the error message, this PR eliminates the error. The function now prints a warning message and switches to the algorithm that works. This seems more user friendly, and addresses the misunderstanding expressed in https://groups.google.com/forum/#!topic/sage-support/TeBjfcKC9Jw\n\nI also revised the docstring, added a doctest, and deleted the declaration of the unused variable \"maxpr\".",
    "created_at": "2019-10-07T20:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424433",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:2'></a>Instead of improving the error message, this PR eliminates the error. The function now prints a warning message and switches to the algorithm that works. This seems more user friendly, and addresses the misunderstanding expressed in https://groups.google.com/forum/#!topic/sage-support/TeBjfcKC9Jw

I also revised the docstring, added a doctest, and deleted the declaration of the unused variable "maxpr".



---

archive/issue_comments_424434.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-07T20:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424434",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424435.json:
```json
{
    "body": "Attachment [openblas-0.3.6.p0.log](tarball://root/attachments/some-uuid/ticket28467/openblas-0.3.6.p0.log) by @zimmermann6 created at 2019-10-10 09:06:14",
    "created_at": "2019-10-10T09:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424435",
    "user": "https://github.com/zimmermann6"
}
```

Attachment [openblas-0.3.6.p0.log](tarball://root/attachments/some-uuid/ticket28467/openblas-0.3.6.p0.log) by @zimmermann6 created at 2019-10-10 09:06:14



---

archive/issue_comments_424436.json:
```json
{
    "body": "<a id='comment:5'></a>I tried to compile the code in that branch, but it failed with openblas (see attached file):\n\n```\ngcc -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 ... -l4 -lgfortran -lm -lquadmath -lm -lc\n/usr/bin/ld: cannot find -l4\n```\nAny hint? My machine has gcc 9.2.1 20190909 (Debian 9.2.1-8).",
    "created_at": "2019-10-10T09:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424436",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>I tried to compile the code in that branch, but it failed with openblas (see attached file):

```
gcc -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 ... -l4 -lgfortran -lm -lquadmath -lm -lc
/usr/bin/ld: cannot find -l4
```
Any hint? My machine has gcc 9.2.1 20190909 (Debian 9.2.1-8).



---

archive/issue_comments_424437.json:
```json
{
    "body": "<a id='comment:6'></a>Thanks for trying to test the patch. I'm not at all a sage expert, but I don't see how my patch would have caused this problem. Instead, the log file seems to suggest that it has to do with updating openblas (\"Uninstalling existing 'openblas'\", etc.), which should not be related to any changes in my patch. Your openblas does seem to be out of date (version 0.2.20.p2 instead of 0.3.6.p0), compared to my sage installation, but I am on Mac OS.\n\nCould you try building sage without the branch? If that works, then you could try to add the branch by using ./sage -br",
    "created_at": "2019-10-10T17:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424437",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:6'></a>Thanks for trying to test the patch. I'm not at all a sage expert, but I don't see how my patch would have caused this problem. Instead, the log file seems to suggest that it has to do with updating openblas ("Uninstalling existing 'openblas'", etc.), which should not be related to any changes in my patch. Your openblas does seem to be out of date (version 0.2.20.p2 instead of 0.3.6.p0), compared to my sage installation, but I am on Mac OS.

Could you try building sage without the branch? If that works, then you could try to add the branch by using ./sage -br



---

archive/issue_comments_424438.json:
```json
{
    "body": "<a id='comment:7'></a>Just a minor note - I feel like we may have a way to generate warnings of this type that is more Sage-specific, similarly to how deprecations are handled.  On the other hand, I'm not sure we even want to generate warnings in standard output at all in this case, since there isn't anything mathematically wrong (I assume) done, just that we need big notes in the documentation for what will happen.  E.g. the `WARNING::` block in Sphinx, or whatever we use nowadays.\n\nThoughts?  Could be worth a sage-devel discussion if we don't have anything currently in the developer guide on this (not because this ticket is bad, just having a standardized way to deal with these things in the future will be helpful, if we don't already).",
    "created_at": "2019-10-13T01:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424438",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>Just a minor note - I feel like we may have a way to generate warnings of this type that is more Sage-specific, similarly to how deprecations are handled.  On the other hand, I'm not sure we even want to generate warnings in standard output at all in this case, since there isn't anything mathematically wrong (I assume) done, just that we need big notes in the documentation for what will happen.  E.g. the `WARNING::` block in Sphinx, or whatever we use nowadays.

Thoughts?  Could be worth a sage-devel discussion if we don't have anything currently in the developer guide on this (not because this ticket is bad, just having a standardized way to deal with these things in the future will be helpful, if we don't already).



---

archive/issue_comments_424439.json:
```json
{
    "body": "<a id='comment:8'></a>Sorry, it didn't occur to me to write a warning in the docstring. I searched sage source for a function call that would produce a warning, but didn't find one. Instead, I found a function that printed a warning (I don't remember what), and I used that as a template. \n\nThere is indeed no mathematical error (that I know of). The warning addresses two issues: the user's request for a particular algorithm is being countermanded, and a small change in input may lead to a much slower calculation (because of the need to switch to the other algorithm).\n\nI defer to the sage experts (e.g., kcrisman) on what should be done. (A warning in the docs does seem reasonable to me. Or maybe there is no need for any warning at all.) I'll be happy to make whatever change is desired, but the branch is public, which I think means that anyone can fix it, without having to explain to me exactly what should be done.",
    "created_at": "2019-10-13T06:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424439",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:8'></a>Sorry, it didn't occur to me to write a warning in the docstring. I searched sage source for a function call that would produce a warning, but didn't find one. Instead, I found a function that printed a warning (I don't remember what), and I used that as a template. 

There is indeed no mathematical error (that I know of). The warning addresses two issues: the user's request for a particular algorithm is being countermanded, and a small change in input may lead to a much slower calculation (because of the need to switch to the other algorithm).

I defer to the sage experts (e.g., kcrisman) on what should be done. (A warning in the docs does seem reasonable to me. Or maybe there is no need for any warning at all.) I'll be happy to make whatever change is desired, but the branch is public, which I think means that anyone can fix it, without having to explain to me exactly what should be done.



---

archive/issue_comments_424440.json:
```json
{
    "body": "<a id='comment:9'></a>Oops. Even though the problem is dead easy, my code has a bug: start and stop should be cast to Integer before any comparison is made. We obviously want 90 < 100, but it is not true that \"90\" < \"100\". I'll make a PR to fix this.",
    "created_at": "2019-10-13T06:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424440",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:9'></a>Oops. Even though the problem is dead easy, my code has a bug: start and stop should be cast to Integer before any comparison is made. We obviously want 90 < 100, but it is not true that "90" < "100". I'll make a PR to fix this.



---

archive/issue_comments_424441.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-13T06:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424442.json:
```json
{
    "body": "<a id='comment:11'></a>I have a question about the following:\n\n```\nsage: prime_range(\"90\",\"100\")\n[97]\n```\nThis syntax was not allowed before. What is the purpose?",
    "created_at": "2019-10-14T14:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424442",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:11'></a>I have a question about the following:

```
sage: prime_range("90","100")
[97]
```
This syntax was not allowed before. What is the purpose?



---

archive/issue_comments_424443.json:
```json
{
    "body": "<a id='comment:12'></a>also maybe the warning (if any) should be printed only once?",
    "created_at": "2019-10-14T14:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424443",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'></a>also maybe the warning (if any) should be printed only once?



---

archive/issue_comments_424444.json:
```json
{
    "body": "<a id='comment:13'></a>I don't know where the bound 1500 comes from, but in http://primerecords.dk/primegaps/maximal.htm we already see a gap of 1476 between primes of 61 bits, thus this bound might be wrong.",
    "created_at": "2019-10-14T14:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424444",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:13'></a>I don't know where the bound 1500 comes from, but in http://primerecords.dk/primegaps/maximal.htm we already see a gap of 1476 between primes of 61 bits, thus this bound might be wrong.



---

archive/issue_comments_424445.json:
```json
{
    "body": "<a id='comment:14'></a>apart from the above tiny remarks, I have satisfied by this patch. Thank you!",
    "created_at": "2019-10-14T14:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424445",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:14'></a>apart from the above tiny remarks, I have satisfied by this patch. Thank you!



---

archive/issue_comments_424446.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-10-14T14:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424446",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_424447.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:11 zimmerma]:\n> I have a question about the following:\n> \n> ```\n> sage: prime_range(\"90\",\"100\")\n> [97]\n> ```\n> This syntax was not allowed before. What is the purpose?\n\n\nThanks for your helpful comments. I'm sorry for taking so long to respond.\n\nIt's a surprise to me that this syntax was not allowed -- I assumed that it would be ok (but my cython knowledge is rudimentary and I never tested it).  It was accepted for the \"pari_isprime\" algorithm: \n\n```\nsage: prime_range(\"90\",\"100\", \"pari_isprime\")\n[97]\n```\nI would consider the incompatible behaviors of the two algorithms to be a (minor) bug.\n\nActually, though, my motivation for the doctest was not really about that particular syntax. The original code assumes that start and stop are integers (or None), and it's hard to predict how it will react if the user passes in some other type of object that is not exactly an integer. So I added `start = Integer(start)` (and similarly for stop), in order to make sure that each input will act exactly like an integer, and also to produce an understandable error message if the function is called on an unacceptable type. (My original code gave a misleading error message when the strings \"90\" and \"100\" were passed for start and stop. I think that message would give the clear impression that there was a bug, rather than user error.) It seems to me that type-checking or coercion should be in the code, but I don't know whether sage developers have some other standard convention for this.\n\nI added the doctest to verify that the `start = Integer(start)` patch is still there (but perhaps it would be better to have a doctest to confirm that non-Integer input produces a reasonable error message).",
    "created_at": "2019-10-24T01:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424447",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:16'></a>Replying to [comment:11 zimmerma]:
> I have a question about the following:
> 
> ```
> sage: prime_range("90","100")
> [97]
> ```
> This syntax was not allowed before. What is the purpose?


Thanks for your helpful comments. I'm sorry for taking so long to respond.

It's a surprise to me that this syntax was not allowed -- I assumed that it would be ok (but my cython knowledge is rudimentary and I never tested it).  It was accepted for the "pari_isprime" algorithm: 

```
sage: prime_range("90","100", "pari_isprime")
[97]
```
I would consider the incompatible behaviors of the two algorithms to be a (minor) bug.

Actually, though, my motivation for the doctest was not really about that particular syntax. The original code assumes that start and stop are integers (or None), and it's hard to predict how it will react if the user passes in some other type of object that is not exactly an integer. So I added `start = Integer(start)` (and similarly for stop), in order to make sure that each input will act exactly like an integer, and also to produce an understandable error message if the function is called on an unacceptable type. (My original code gave a misleading error message when the strings "90" and "100" were passed for start and stop. I think that message would give the clear impression that there was a bug, rather than user error.) It seems to me that type-checking or coercion should be in the code, but I don't know whether sage developers have some other standard convention for this.

I added the doctest to verify that the `start = Integer(start)` patch is still there (but perhaps it would be better to have a doctest to confirm that non-Integer input produces a reasonable error message).



---

archive/issue_comments_424448.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:13 zimmerma]:\n> I don't know where the bound 1500 comes from, but in http://primerecords.dk/primegaps/maximal.htm we already see a gap of 1476 between primes of 61 bits, thus this bound might be wrong.\n\n\nThat's a very good point! 1500 was already in the code and I assumed it had been chosen by a number theorist to be clearly large enough. However, we actually do not need `prime_gap_bound` to be anywhere near that large, because `c_stop` is less than than 436273290 in this part of the code. I have now revised the code to use a smaller value of `prime_gap_bound` (namely, 250) that can be confirmed by sage in less than 2 minutes on my 7-year-old laptop.\n\nPS The hardcoded limit 436273290 is because pari stores the list of small primes via a list of gaps between the primes, and no gap can be larger than 255. The first prime gap that is larger than 255 is from 436273009 to 436273291. So the prime 436273291 cannot be stored in this manner.",
    "created_at": "2019-10-24T01:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424448",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:17'></a>Replying to [comment:13 zimmerma]:
> I don't know where the bound 1500 comes from, but in http://primerecords.dk/primegaps/maximal.htm we already see a gap of 1476 between primes of 61 bits, thus this bound might be wrong.


That's a very good point! 1500 was already in the code and I assumed it had been chosen by a number theorist to be clearly large enough. However, we actually do not need `prime_gap_bound` to be anywhere near that large, because `c_stop` is less than than 436273290 in this part of the code. I have now revised the code to use a smaller value of `prime_gap_bound` (namely, 250) that can be confirmed by sage in less than 2 minutes on my 7-year-old laptop.

PS The hardcoded limit 436273290 is because pari stores the list of small primes via a list of gaps between the primes, and no gap can be larger than 255. The first prime gap that is larger than 255 is from 436273009 to 436273291. So the prime 436273291 cannot be stored in this manner.



---

archive/issue_comments_424449.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:14 zimmerma]:\n> apart from the above tiny remarks, I have satisfied by this patch. Thank you!\n\n\nThanks again for your comments! I will submit a PR that removes the warning. (Using a warning in this situation was an error in judgment on my part.) And I revised the docstring to be consistent with the new behaviour of the function, and made other edits in an attempt to make the documentation more clear and accurate.",
    "created_at": "2019-10-24T01:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424449",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:18'></a>Replying to [comment:14 zimmerma]:
> apart from the above tiny remarks, I have satisfied by this patch. Thank you!


Thanks again for your comments! I will submit a PR that removes the warning. (Using a warning in this situation was an error in judgment on my part.) And I revised the docstring to be consistent with the new behaviour of the function, and made other edits in an attempt to make the documentation more clear and accurate.



---

archive/issue_comments_424450.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-24T01:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424451.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-10-24T03:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424451",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_424452.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-24T06:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424452",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_424453.json:
```json
{
    "body": "<a id='comment:21'></a>Failed doctest:\n\n```\nFile \"src/sage/functions/prime_pi.pyx\", line 454, in sage.functions.prime_pi.PrimePi.plot\nFailed example:\n    prime_pi.plot(-2, sqrt(2501), thickness=2, vertical_lines=False)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.functions.prime_pi.PrimePi.plot[1]>\", line 1, in <module>\n        prime_pi.plot(-Integer(2), sqrt(Integer(2501)), thickness=Integer(2), vertical_lines=False)\n      File \"sage/functions/prime_pi.pyx\", line 465, in sage.functions.prime_pi.PrimePi.plot (build/cythonized/sage/functions/prime_pi.c:6223)\n        for p in prime_range(xmin+1, xmax+1, py_ints=True):\n      File \"sage/rings/fast_arith.pyx\", line 48, in sage.rings.fast_arith.prime_range (build/cythonized/sage/rings/fast_arith.c:3429)\n        cpdef prime_range(start, stop=None, algorithm=\"pari_primes\", bint py_ints=False):\n      File \"sage/rings/fast_arith.pyx\", line 145, in sage.rings.fast_arith.prime_range (build/cythonized/sage/rings/fast_arith.c:2760)\n        stop = Integer(stop)\n      File \"sage/rings/integer.pyx\", line 692, in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6191)\n        set_from_Integer(self, otmp(the_integer_ring))\n      File \"sage/symbolic/expression.pyx\", line 1086, in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:8681)\n        raise TypeError(\"unable to convert %r to an integer\" % self)\n    TypeError: unable to convert sqrt(2501) + 1 to an integer\n```\nI will need to think about this. \n\nThe failed example calls `prime_range` with an argument that is a non-integer real number, which I did not think was allowed. It seems that, for backward compatibility, such an argument needs to be allowed at least when `algorithm=\"pari_primes\"`, even though the original function gives a `TypeError` when `algorithm=\"is_prime\"`.",
    "created_at": "2019-10-24T06:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424453",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:21'></a>Failed doctest:

```
File "src/sage/functions/prime_pi.pyx", line 454, in sage.functions.prime_pi.PrimePi.plot
Failed example:
    prime_pi.plot(-2, sqrt(2501), thickness=2, vertical_lines=False)
Exception raised:
    Traceback (most recent call last):
      File "/home/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.functions.prime_pi.PrimePi.plot[1]>", line 1, in <module>
        prime_pi.plot(-Integer(2), sqrt(Integer(2501)), thickness=Integer(2), vertical_lines=False)
      File "sage/functions/prime_pi.pyx", line 465, in sage.functions.prime_pi.PrimePi.plot (build/cythonized/sage/functions/prime_pi.c:6223)
        for p in prime_range(xmin+1, xmax+1, py_ints=True):
      File "sage/rings/fast_arith.pyx", line 48, in sage.rings.fast_arith.prime_range (build/cythonized/sage/rings/fast_arith.c:3429)
        cpdef prime_range(start, stop=None, algorithm="pari_primes", bint py_ints=False):
      File "sage/rings/fast_arith.pyx", line 145, in sage.rings.fast_arith.prime_range (build/cythonized/sage/rings/fast_arith.c:2760)
        stop = Integer(stop)
      File "sage/rings/integer.pyx", line 692, in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6191)
        set_from_Integer(self, otmp(the_integer_ring))
      File "sage/symbolic/expression.pyx", line 1086, in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:8681)
        raise TypeError("unable to convert %r to an integer" % self)
    TypeError: unable to convert sqrt(2501) + 1 to an integer
```
I will need to think about this. 

The failed example calls `prime_range` with an argument that is a non-integer real number, which I did not think was allowed. It seems that, for backward compatibility, such an argument needs to be allowed at least when `algorithm="pari_primes"`, even though the original function gives a `TypeError` when `algorithm="is_prime"`.



---

archive/issue_comments_424454.json:
```json
{
    "body": "<a id='comment:22'></a>I do not see any reason to reject real numbers as inputs. (I don't think I ever realized before that the Python function `range` accepts real numbers.) So I have revised the code to take real numbers, and I added a note to the docstring.",
    "created_at": "2019-10-28T04:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424454",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:22'></a>I do not see any reason to reject real numbers as inputs. (I don't think I ever realized before that the Python function `range` accepts real numbers.) So I have revised the code to take real numbers, and I added a note to the docstring.



---

archive/issue_comments_424455.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-28T04:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424455",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424456.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-28T07:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424456",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_424457.json:
```json
{
    "body": "<a id='comment:25'></a>I'm dubious about allowing real numbers and strings. This was not allowed before, and if you propose to change this behaviour, I believe this should be in a separate ticket. If so, I would give a positive review.",
    "created_at": "2019-11-04T15:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424457",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:25'></a>I'm dubious about allowing real numbers and strings. This was not allowed before, and if you propose to change this behaviour, I believe this should be in a separate ticket. If so, I would give a positive review.



---

archive/issue_comments_424458.json:
```json
{
    "body": "<a id='comment:26'></a>You are right. I was confused. Before I started work on this, the algorithm \"pari_primes\" allowed real numbers, and the algorithm \"pari_isprime\" allowed strings, but neither allowed both. I will upload a PR to restore this behavior (i.e., the patch removes the code that tests and coerces the input). The patch also mentions this behavior in a note in the docstring.\n\nI opened ticket:28712 to discuss the allowable input.",
    "created_at": "2019-11-08T19:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424458",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:26'></a>You are right. I was confused. Before I started work on this, the algorithm "pari_primes" allowed real numbers, and the algorithm "pari_isprime" allowed strings, but neither allowed both. I will upload a PR to restore this behavior (i.e., the patch removes the code that tests and coerces the input). The patch also mentions this behavior in a note in the docstring.

I opened ticket:28712 to discuss the allowable input.



---

archive/issue_comments_424459.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-08T20:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424459",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424460.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-13T10:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424460",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424461.json:
```json
{
    "body": "<a id='comment:28'></a>I give a positive review, but I'm still unable to try the new code because Sage fails to build on my machine (see #28104, comment [comment:12]).",
    "created_at": "2019-11-13T10:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424461",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:28'></a>I give a positive review, but I'm still unable to try the new code because Sage fails to build on my machine (see #28104, comment [comment:12]).



---

archive/issue_events_071343.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-11-13T20:10:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71343"
}
```



---

archive/issue_comments_424462.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-11-16T12:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424462",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_424463.json:
```json
{
    "body": "<a id='comment:30'></a>This causes various py3-related test failures",
    "created_at": "2019-11-16T12:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424463",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>This causes various py3-related test failures



---

archive/issue_comments_424464.json:
```json
{
    "body": "<a id='comment:31'></a>(which will be the default in the next beta, so mere that one in and run tests)",
    "created_at": "2019-11-16T12:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424464",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>(which will be the default in the next beta, so mere that one in and run tests)



---

archive/issue_comments_424465.json:
```json
{
    "body": "<a id='comment:32'></a>OK, I'm compiling a Python-3 version of sage, and I will try to figure out what is wrong. (I don't see how my \"innocent little patch\" could be causing build errors outside the file that I touched, so this is a learning opportunity for me.)",
    "created_at": "2019-11-19T01:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424465",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:32'></a>OK, I'm compiling a Python-3 version of sage, and I will try to figure out what is wrong. (I don't see how my "innocent little patch" could be causing build errors outside the file that I touched, so this is a learning opportunity for me.)



---

archive/issue_comments_424466.json:
```json
{
    "body": "<a id='comment:33'></a>Bug is fixed: we no longer ask `max` to compare an integer with `None`. This should eliminate the doctest failures, but I do not know why some of the patchbots gave build errors -- the problems do not seem to be related to this patch.\n\nUnfortunately, I cannot do a full doctest because I have not yet been able to compile a good copy of Python 3 sage. (My Mac OS Catalina installation has many doctest failures on an unmodified copy of the develop branch.)",
    "created_at": "2019-12-28T03:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424466",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:33'></a>Bug is fixed: we no longer ask `max` to compare an integer with `None`. This should eliminate the doctest failures, but I do not know why some of the patchbots gave build errors -- the problems do not seem to be related to this patch.

Unfortunately, I cannot do a full doctest because I have not yet been able to compile a good copy of Python 3 sage. (My Mac OS Catalina installation has many doctest failures on an unmodified copy of the develop branch.)



---

archive/issue_comments_424467.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-28T03:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424467",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_424468.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-28T03:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_071344.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2019-12-30T18:22:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71344"
}
```



---

archive/issue_events_071345.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2019-12-30T18:22:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71345"
}
```



---

archive/issue_comments_424469.json:
```json
{
    "body": "<a id='comment:36'></a>Looks like this has a couple of clean patchbot runs under Py3 (which is officially the default now that 9.0 is released).",
    "created_at": "2020-01-01T23:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424469",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:36'></a>Looks like this has a couple of clean patchbot runs under Py3 (which is officially the default now that 9.0 is released).



---

archive/issue_comments_424470.json:
```json
{
    "body": "<a id='comment:37'></a>branch no longer applies cleanly",
    "created_at": "2020-02-15T10:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424470",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>branch no longer applies cleanly



---

archive/issue_comments_424471.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-15T10:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424471",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_424472.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-12T01:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424473.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-12T01:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424473",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_424474.json:
```json
{
    "body": "<a id='comment:39'></a>Merged with 9.1b6 to fix the conflict with #29123, which revised the documentation.",
    "created_at": "2020-03-12T01:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424474",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:39'></a>Merged with 9.1b6 to fix the conflict with #29123, which revised the documentation.



---

archive/issue_comments_424475.json:
```json
{
    "body": "<a id='comment:40'></a>I tried not to mess up the intent of #29123, but I think chapoton should be informed that I revised the docstring.",
    "created_at": "2020-03-12T01:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424475",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:40'></a>I tried not to mess up the intent of #29123, but I think chapoton should be informed that I revised the docstring.



---

archive/issue_comments_424476.json:
```json
{
    "body": "<a id='comment:41'></a>The change in behavior you proposed is bad. If a user provides `algorithm=\"pari_primes\"` the function should not silently switch to the `\"pari_isprime\"` version. The adaptation should only applies when the algorithm is not explicitly specified.\n\nAlso, the NOTE is more confusing than anything else. You don't want to document that kind of behavior that forces you to stick to it in the future. If you feel it needs something, simply write: `if the input is not numerical then the behavior is not specified.`\n\nMinor comments\n- Instead of writing `The sage command ``primes``` you would better use references `The sage command :func:`~sage.arith.misc.primes``. That produces a link in the compiled documentation.\n- To describe strings as argument I think Sage preferrs ```\"pari_primes\"``` rather than `\"pari_primes\"`.\n- Don't write `trac ticket 28467` but `:trac:`28467`` (which produces a link in the compiled documentation).\n- Please test `prime_range(9.5, 14.3)` with both `\"pari_primes\"` and `\"pari_isprime\"`.",
    "created_at": "2020-04-12T08:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424476",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'></a>The change in behavior you proposed is bad. If a user provides `algorithm="pari_primes"` the function should not silently switch to the `"pari_isprime"` version. The adaptation should only applies when the algorithm is not explicitly specified.

Also, the NOTE is more confusing than anything else. You don't want to document that kind of behavior that forces you to stick to it in the future. If you feel it needs something, simply write: `if the input is not numerical then the behavior is not specified.`

Minor comments
- Instead of writing `The sage command ``primes``` you would better use references `The sage command :func:`~sage.arith.misc.primes``. That produces a link in the compiled documentation.
- To describe strings as argument I think Sage preferrs ```"pari_primes"``` rather than `"pari_primes"`.
- Don't write `trac ticket 28467` but `:trac:`28467`` (which produces a link in the compiled documentation).
- Please test `prime_range(9.5, 14.3)` with both `"pari_primes"` and `"pari_isprime"`.



---

archive/issue_comments_424477.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-12T08:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424477",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_424478.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-12T22:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424479.json:
```json
{
    "body": "<a id='comment:44'></a>Thanks for the corrections!\n\nPS IMHO, the two algorithms should have similar behavior, so the followup ticket #28712 addresses the fact that `prime_range(9.5, 14.3)` raises an error for one algorithm, but not the other.",
    "created_at": "2020-04-12T22:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424479",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:44'></a>Thanks for the corrections!

PS IMHO, the two algorithms should have similar behavior, so the followup ticket #28712 addresses the fact that `prime_range(9.5, 14.3)` raises an error for one algorithm, but not the other.



---

archive/issue_comments_424480.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-12T22:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424480",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_424481.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 gh-DaveWitteMorris]:\n> Thanks for the corrections!\n> \n> PS IMHO, the two algorithms should have similar behavior,\n\n\nWhy is that? If one can not do beyond `436273290` and the other can, we should restrict the latter to not do it so that they behave the same?\n\n> so the followup ticket #28712 addresses the fact that `prime_range(9.5, 14.3)` raises an error for one algorithm, but not the other.\n\n\nThis is about the interface, and I agree that it should be consistent.",
    "created_at": "2020-04-15T07:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424481",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'></a>Replying to [comment:44 gh-DaveWitteMorris]:
> Thanks for the corrections!
> 
> PS IMHO, the two algorithms should have similar behavior,


Why is that? If one can not do beyond `436273290` and the other can, we should restrict the latter to not do it so that they behave the same?

> so the followup ticket #28712 addresses the fact that `prime_range(9.5, 14.3)` raises an error for one algorithm, but not the other.


This is about the interface, and I agree that it should be consistent.



---

archive/issue_comments_424482.json:
```json
{
    "body": "<a id='comment:46'></a>You're right: \"behavior\" was the wrong word. I'm glad you agree that the interface (or this part, at least) should be consistent.",
    "created_at": "2020-04-15T07:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424482",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:46'></a>You're right: "behavior" was the wrong word. I'm glad you agree that the interface (or this part, at least) should be consistent.



---

archive/issue_comments_424483.json:
```json
{
    "body": "<a id='comment:47'></a>Please clarify what you are trying to do with prime_pi. Doctest are not meant for comments about the code such as\n\n```\nTo avoid a doctest error in functions/prime_pi.pyx, prime_range must allow real input::\n```\nFirst of all, while reading the documentation nobody cares about the doctests in distinct files. Even though the information might be relevant for someone, its place is not in the doc. Moreover, if there is a doctest in `functions/prime_pi.pyx` why would you need to duplicate it here? Finally, if somebody decides to fix the underlying problem in `functions/prime_pi.pyx`, this doctest will remain here for no good reason at all.",
    "created_at": "2020-04-15T07:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424483",
    "user": "https://github.com/videlec"
}
```

<a id='comment:47'></a>Please clarify what you are trying to do with prime_pi. Doctest are not meant for comments about the code such as

```
To avoid a doctest error in functions/prime_pi.pyx, prime_range must allow real input::
```
First of all, while reading the documentation nobody cares about the doctests in distinct files. Even though the information might be relevant for someone, its place is not in the doc. Moreover, if there is a doctest in `functions/prime_pi.pyx` why would you need to duplicate it here? Finally, if somebody decides to fix the underlying problem in `functions/prime_pi.pyx`, this doctest will remain here for no good reason at all.



---

archive/issue_comments_424484.json:
```json
{
    "body": "<a id='comment:48'></a>I was trying to be helpful (I was surprised that one of my edits caused a doctest failure in `functions/prime_pi.pyx`), but I now understand, from your explanation, that this redundant doctest is problematic.  I will delete it.",
    "created_at": "2020-04-15T07:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424484",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:48'></a>I was trying to be helpful (I was surprised that one of my edits caused a doctest failure in `functions/prime_pi.pyx`), but I now understand, from your explanation, that this redundant doctest is problematic.  I will delete it.



---

archive/issue_comments_424485.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-15T08:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_071346.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-07T02:29:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71346"
}
```



---

archive/issue_events_071347.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-07T02:29:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71347"
}
```



---

archive/issue_comments_424486.json:
```json
{
    "body": "<a id='comment:51'></a>Minor style comments.\n\nCompare to `None` with `is`, not `==`:\n\n```diff\n-    if algorithm == None:\n+    if algorithm is None:\n```\n\nTwo spaces before `#` for inline comments:\n\n```diff\n-    DEF small_prime_max = 436273009 # a prime < init_primes_max (preferably the largest)\n-    DEF prime_gap_bound = 250 # upper bound for gap between primes <= small_prime_max\n+    DEF small_prime_max = 436273009  # a prime < init_primes_max (preferably the largest)\n+    DEF prime_gap_bound = 250  # upper bound for gap between primes <= small_prime_max\n```\n\nProposed rephrasing and reformatting for the `ValueError` message:\n\n```diff\n         if max(start, stop or 0) > small_prime_max:\n-            raise ValueError('algorithm \"pari_primes\" cannot compute primes larger than'\n-                + ' {}'.format(small_prime_max - 1))\n+            s = 'algorithm \"pari_primes\" is limited to primes less than {}'\n+            raise ValueError(s.format(small_prime_max - 1))\n```\n\nPatchbots are happy. What do other reviewers think?",
    "created_at": "2020-08-22T19:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424486",
    "user": "https://github.com/slel"
}
```

<a id='comment:51'></a>Minor style comments.

Compare to `None` with `is`, not `==`:

```diff
-    if algorithm == None:
+    if algorithm is None:
```

Two spaces before `#` for inline comments:

```diff
-    DEF small_prime_max = 436273009 # a prime < init_primes_max (preferably the largest)
-    DEF prime_gap_bound = 250 # upper bound for gap between primes <= small_prime_max
+    DEF small_prime_max = 436273009  # a prime < init_primes_max (preferably the largest)
+    DEF prime_gap_bound = 250  # upper bound for gap between primes <= small_prime_max
```

Proposed rephrasing and reformatting for the `ValueError` message:

```diff
         if max(start, stop or 0) > small_prime_max:
-            raise ValueError('algorithm "pari_primes" cannot compute primes larger than'
-                + ' {}'.format(small_prime_max - 1))
+            s = 'algorithm "pari_primes" is limited to primes less than {}'
+            raise ValueError(s.format(small_prime_max - 1))
```

Patchbots are happy. What do other reviewers think?



---

archive/issue_comments_424487.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-08T11:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424487",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424488.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-08T11:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424489.json:
```json
{
    "body": "<a id='comment:54'></a>lgtm",
    "created_at": "2020-09-08T12:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424489",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:54'></a>lgtm



---

archive/issue_comments_424490.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-08T12:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424490",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424491.json:
```json
{
    "body": "<a id='comment:55'></a>Thanks for the corrections, and the review!",
    "created_at": "2020-09-20T04:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424491",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:55'></a>Thanks for the corrections, and the review!



---

archive/issue_events_071348.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71348"
}
```



---

archive/issue_events_071349.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71349"
}
```



---

archive/issue_events_071350.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-07T16:23:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28467#event-71350"
}
```



---

archive/issue_comments_424492.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-07T16:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28467#issuecomment-424492",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
