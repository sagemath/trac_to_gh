# Issue 28346: Use dots instead of precision in polynomial_element

archive/issues_028109.json:
```json
{
    "assignees": [],
    "body": "The precision markers check the precision of real and imaginary part individually. That is problematic when one of the parts is so small that it may be 0, because even 1e-16 is not equal to no number at all.\n\nI ran into this problem when running the sage testsuite on aarch64. There, the 3.88...e-16 components in the touched test files just reduces to 0 because of architecture-dependent precision differences.\n\nUsing dots is not particularly nice. Ideally we'd want `#abs tol` to relate to the norm of complex numbers. This works in the meanwhile though.\n\nBranch/Commit: **[`de9601d`](https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04)**\n\nReviewer: **Marc Mezzarobba**\n\nAuthor: **Timo Kaufmann**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28346_\n\n",
    "closed_at": "2019-08-21T22:27:36Z",
    "created_at": "2019-08-12T23:12:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Use dots instead of precision in polynomial_element",
    "type": "issue",
    "updated_at": "2019-08-21T22:27:36Z",
    "url": "https://github.com/sagemath/sage/issues/28346",
    "user": "https://github.com/timokau"
}
```
The precision markers check the precision of real and imaginary part individually. That is problematic when one of the parts is so small that it may be 0, because even 1e-16 is not equal to no number at all.

I ran into this problem when running the sage testsuite on aarch64. There, the 3.88...e-16 components in the touched test files just reduces to 0 because of architecture-dependent precision differences.

Using dots is not particularly nice. Ideally we'd want `#abs tol` to relate to the norm of complex numbers. This works in the meanwhile though.

Branch/Commit: **[`de9601d`](https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04)**

Reviewer: **Marc Mezzarobba**

Author: **Timo Kaufmann**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/28346_





---

archive/issue_events_389012.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-12T23:12:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389012"
}
```



---

archive/issue_events_389013.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-12T23:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389013"
}
```



---

archive/issue_events_389014.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-12T23:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389014"
}
```



---

archive/issue_events_389015.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-12T23:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389015"
}
```



---

archive/issue_events_389016.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-12T23:12:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389016"
}
```



---

archive/issue_comments_441804.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2019-08-18T12:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441804",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_events_389017.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-08-18T12:25:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389017"
}
```



---

archive/issue_events_389018.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-08-18T12:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389018"
}
```



---

archive/issue_comments_441805.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSorry for nitpicking, but why are you removing many more digits than implied by the tolerances you are replacing?",
    "created_at": "2019-08-18T12:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441805",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:2" align="right">comment:2</div>

Sorry for nitpicking, but why are you removing many more digits than implied by the tolerances you are replacing?



---

archive/issue_comments_441806.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nBecause I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle. I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?\n\nI don't feel that strongly about it though. If you prefer I can amend the patch to keep the precision.",
    "created_at": "2019-08-18T12:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441806",
    "user": "https://github.com/timokau"
}
```

<div id="comment:3" align="right">comment:3</div>

Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle. I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?

I don't feel that strongly about it though. If you prefer I can amend the patch to keep the precision.



---

archive/issue_comments_441807.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@timokau](#comment:3):\n> Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle.\n\nMaybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.\n\n> I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?\n\nOh yes I have `:-)`.",
    "created_at": "2019-08-18T13:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441807",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@timokau](#comment:3):
> Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle.

Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.

> I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?

Oh yes I have `:-)`.



---

archive/issue_comments_441808.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n> Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.\n\nWell the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.",
    "created_at": "2019-08-18T14:45:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441808",
    "user": "https://github.com/timokau"
}
```

<div id="comment:5" align="right">comment:5</div>

> Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.

Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.



---

archive/issue_comments_441809.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@timokau](#comment:5):\n> Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.\n\nYes, that's what I meant by \u201cessentially\u201d. An error that affects half of the mantissa is a different story (for instance, it could come from doing one less Newton step than you should, or using a formula subject to catastrophic cancellation, or inadvertently casting from `float` to `double`).",
    "created_at": "2019-08-18T15:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441809",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@timokau](#comment:5):
> Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.

Yes, that's what I meant by “essentially”. An error that affects half of the mantissa is a different story (for instance, it could come from doing one less Newton step than you should, or using a formula subject to catastrophic cancellation, or inadvertently casting from `float` to `double`).



---

archive/issue_comments_441810.json:
```json
{
    "body": "Changed commit from **[`22c18a9`](https://github.com/sagemath/sagetrac-mirror/commit/22c18a9b771574799c1ee35d37ed99d3be4e09b6)** to **[`de9601d`](https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04)**",
    "created_at": "2019-08-18T16:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441810",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`22c18a9`](https://github.com/sagemath/sagetrac-mirror/commit/22c18a9b771574799c1ee35d37ed99d3be4e09b6)** to **[`de9601d`](https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04)**



---

archive/issue_comments_441811.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04\">de9601d</a></td><td><code>Use dots instead of precision in polynomial_element</code></td></tr></table>\n",
    "created_at": "2019-08-18T16:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441811",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04">de9601d</a></td><td><code>Use dots instead of precision in polynomial_element</code></td></tr></table>




---

archive/issue_comments_441812.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFair enough. I've amended the commit to include 14 digits after the point (though I'm not entirely sure `#abs tol 1e-14` is supposed to be digits after the point or total significant digits).",
    "created_at": "2019-08-18T16:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441812",
    "user": "https://github.com/timokau"
}
```

<div id="comment:8" align="right">comment:8</div>

Fair enough. I've amended the commit to include 14 digits after the point (though I'm not entirely sure `#abs tol 1e-14` is supposed to be digits after the point or total significant digits).



---

archive/issue_events_389019.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-18T16:55:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389019"
}
```



---

archive/issue_events_389020.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-18T16:55:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389020"
}
```



---

archive/issue_comments_441813.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOkay so apparently it means the *difference* between the actual result and the one in the test can't exceed 1e-14, which makes sense. So my changes should be correct.",
    "created_at": "2019-08-18T17:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441813",
    "user": "https://github.com/timokau"
}
```

<div id="comment:10" align="right">comment:10</div>

Okay so apparently it means the *difference* between the actual result and the one in the test can't exceed 1e-14, which makes sense. So my changes should be correct.



---

archive/issue_comments_441814.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThank you!",
    "created_at": "2019-08-18T18:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441814",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:11" align="right">comment:11</div>

Thank you!



---

archive/issue_events_389021.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-08-18T18:55:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389021"
}
```



---

archive/issue_events_389022.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-08-18T18:55:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389022"
}
```



---

archive/issue_comments_441815.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAuthor name should be the actual name, not trac username",
    "created_at": "2019-08-19T22:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441815",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

Author name should be the actual name, not trac username



---

archive/issue_events_389023.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-19T22:11:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389023"
}
```



---

archive/issue_events_389024.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-19T22:11:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389024"
}
```



---

archive/issue_comments_441816.json:
```json
{
    "body": "Changed author from **gh-timokau** to **Timo Kaufmann**",
    "created_at": "2019-08-19T22:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441816",
    "user": "https://github.com/timokau"
}
```

Changed author from **gh-timokau** to **Timo Kaufmann**



---

archive/issue_events_389025.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-19T22:37:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389025"
}
```



---

archive/issue_events_389026.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-08-19T22:37:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389026"
}
```



---

archive/issue_events_389027.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-21T22:27:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389027"
}
```



---

archive/issue_events_389028.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "56f7684a5764b690fe32905c4651c1bac0e29a9a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-08-21T22:27:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28346#event-389028"
}
```



---

archive/issue_comments_441817.json:
```json
{
    "body": "Changed branch from **[u/gh-timokau/polynomial_element_precision](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/polynomial_element_precision)** to **[`de9601d`](https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04)**",
    "created_at": "2019-08-21T22:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28346#issuecomment-441817",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-timokau/polynomial_element_precision](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/polynomial_element_precision)** to **[`de9601d`](https://github.com/sagemath/sagetrac-mirror/commit/de9601db303150a0d66c3e3233862919548f8f04)**
