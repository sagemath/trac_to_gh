# Issue 28832: suitesparse spkg does not properly use a DESTDIR installation

archive/issues_028595.json:
```json
{
    "body": "This SPKG was introduced in #22380 as a standard package.\n\nHowever, it does not properly use the the facilities for DESTDIR installation, and thus a file manifest is not produced for it:\n\n```\n$ cat local/var/lib/sage/installed/suitesparse-5.6.0\n{\n    \"package_name\": \"suitesparse\",\n    \"package_version\": \"5.6.0\",\n    \"install_date\": \"Mon Dec  2 11:44:16 UTC 2019\",\n    \"system_uname\": \"Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\",\n    \"sage_version\": \"SageMath version 9.0.beta8, Release Date: 2019-12-01\",\n    \"test_result\": \"\",\n    \"files\": [\n\n    ]\n}\n```\n\nsuitesparse apparently has a custom build system (parts of it contain sub-libraries built with CMake (GraphBLAS, Mongoose) and hence should support `DESTDIR` but according to the `SPKG.txt` we don't install those components anyways.\n\nWe should have better documentation, for adding new SPKGs, about ensuring that DESTDIR install works.  I opened #28831 for that.\n\nCC:  @dimpase\n\nKeywords: suitesparse cvxopt\n\nBranch/Commit: [efeab2f799c7d4d6b2d89e110b9ddaffc77b2712](https://github.com/sagemath/sagetrac-mirror/commit/efeab2f799c7d4d6b2d89e110b9ddaffc77b2712)\n\nReviewer: Fran\u00e7ois Bissey, Erik Bray\n\nAuthor: Erik Bray, Fran\u00e7ois Bissey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28832\n\n",
    "closed_at": "2019-12-09T22:54:42Z",
    "created_at": "2019-12-02T14:17:37Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "suitesparse spkg does not properly use a DESTDIR installation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28832",
    "user": "https://github.com/embray"
}
```
This SPKG was introduced in #22380 as a standard package.

However, it does not properly use the the facilities for DESTDIR installation, and thus a file manifest is not produced for it:

```
$ cat local/var/lib/sage/installed/suitesparse-5.6.0
{
    "package_name": "suitesparse",
    "package_version": "5.6.0",
    "install_date": "Mon Dec  2 11:44:16 UTC 2019",
    "system_uname": "Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux",
    "sage_version": "SageMath version 9.0.beta8, Release Date: 2019-12-01",
    "test_result": "",
    "files": [

    ]
}
```

suitesparse apparently has a custom build system (parts of it contain sub-libraries built with CMake (GraphBLAS, Mongoose) and hence should support `DESTDIR` but according to the `SPKG.txt` we don't install those components anyways.

We should have better documentation, for adding new SPKGs, about ensuring that DESTDIR install works.  I opened #28831 for that.

CC:  @dimpase

Keywords: suitesparse cvxopt

Branch/Commit: [efeab2f799c7d4d6b2d89e110b9ddaffc77b2712](https://github.com/sagemath/sagetrac-mirror/commit/efeab2f799c7d4d6b2d89e110b9ddaffc77b2712)

Reviewer: François Bissey, Erik Bray

Author: Erik Bray, François Bissey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28832





---

archive/issue_comments_560766.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560766",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_560767.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560767",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_560768.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-28832\"",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560768",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-28832"



---

archive/issue_comments_560769.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis fixes it: \n\n```\n{\n    \"package_name\": \"suitesparse\",\n    \"package_version\": \"5.6.0\",\n    \"install_date\": \"Mon Dec  2 14:40:14 UTC 2019\",\n    \"system_uname\": \"Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\"\n,\n    \"sage_version\": \"SageMath version 9.0.beta8, Release Date: 2019-12-01\",\n    \"test_result\": \"\",\n    \"files\": [\n        \"include/RBio.h\",\n        \"include/SuiteSparseQR.hpp\",\n        \"include/SuiteSparseQR_C.h\",\n        \"include/SuiteSparseQR_definitions.h\",\n        \"include/SuiteSparse_config.h\",\n        \"include/amd.h\",\n        \"include/btf.h\",\n        \"include/camd.h\",\n        \"include/ccolamd.h\",\n        \"include/cholmod.h\",\n        \"include/cholmod_blas.h\",\n        \"include/cholmod_camd.h\",\n        \"include/cholmod_check.h\",\n        \"include/cholmod_cholesky.h\",\n        \"include/cholmod_complexity.h\",\n        \"include/cholmod_config.h\",\n        \"include/cholmod_core.h\",\n        \"include/cholmod_function.h\",\n        \"include/cholmod_gpu.h\",\n        \"include/cholmod_gpu_kernels.h\",\n        \"include/cholmod_io64.h\",\n        \"include/cholmod_matrixops.h\",\n        \"include/cholmod_modify.h\",\n        \"include/cholmod_partition.h\",\n        \"include/cholmod_supernodal.h\",\n        \"include/cholmod_template.h\",\n        \"include/colamd.h\",\n        \"include/cs.h\",\n        \"include/klu.h\",\n        \"include/ldl.h\",\n        \"include/spqr.hpp\",\n        \"include/umfpack.h\",\n        \"include/umfpack_col_to_triplet.h\",\n        \"include/umfpack_defaults.h\",\n        \"include/umfpack_free_numeric.h\",\n        \"include/umfpack_free_symbolic.h\",\n        \"include/umfpack_get_determinant.h\",\n        \"include/umfpack_get_lunz.h\",\n        \"include/umfpack_get_numeric.h\",\n        \"include/umfpack_get_symbolic.h\",\n        \"include/umfpack_global.h\",\n        \"include/umfpack_load_numeric.h\",\n        \"include/umfpack_load_symbolic.h\",\n        \"include/umfpack_numeric.h\",\n        \"include/umfpack_qsymbolic.h\",\n        \"include/umfpack_report_control.h\",\n        \"include/umfpack_report_info.h\",\n        \"include/umfpack_report_matrix.h\",\n        \"include/umfpack_report_numeric.h\",\n        \"include/umfpack_report_perm.h\",\n        \"include/umfpack_report_status.h\",\n        \"include/umfpack_report_symbolic.h\",\n        \"include/umfpack_report_triplet.h\",\n        \"include/umfpack_report_vector.h\",\n        \"include/umfpack_save_numeric.h\",\n        \"include/umfpack_save_symbolic.h\",\n        \"include/umfpack_scale.h\",\n        \"include/umfpack_solve.h\",\n        \"include/umfpack_symbolic.h\",\n        \"include/umfpack_tictoc.h\",\n        \"include/umfpack_timer.h\",\n        \"include/umfpack_transpose.h\",\n        \"include/umfpack_triplet_to_col.h\",\n        \"include/umfpack_wsolve.h\",\n        \"lib/libamd.so\",\n        \"lib/libamd.so.2\",\n        \"lib/libamd.so.2.4.6\",\n        \"lib/libbtf.so\",\n        \"lib/libbtf.so.1\",\n        \"lib/libbtf.so.1.2.6\",\n        \"lib/libcamd.so\",\n        \"lib/libcamd.so.2\",\n        \"lib/libcamd.so.2.4.6\",\n        \"lib/libccolamd.so\",\n        \"lib/libccolamd.so.2\",\n        \"lib/libccolamd.so.2.9.6\",\n        \"lib/libcholmod.so\",\n        \"lib/libcholmod.so.3\",\n        \"lib/libcholmod.so.3.0.13\",\n        \"lib/libcolamd.so\",\n        \"lib/libcolamd.so.2\",\n        \"lib/libcolamd.so.2.9.6\",\n        \"lib/libcxsparse.so\",\n        \"lib/libcxsparse.so.3\",\n        \"lib/libcxsparse.so.3.2.0\",\n        \"lib/libklu.so\",\n        \"lib/libklu.so.1\",                                                                                                   \n        \"lib/libklu.so.1.3.8\",\n        \"lib/libldl.so\",\n        \"lib/libldl.so.2\",\n        \"lib/libldl.so.2.2.6\",\n        \"lib/librbio.so\",\n        \"lib/librbio.so.2\",\n        \"lib/librbio.so.2.2.6\",\n        \"lib/libspqr.so\",\n        \"lib/libspqr.so.2\",\n        \"lib/libspqr.so.2.0.9\",\n        \"lib/libsuitesparseconfig.so\",\n        \"lib/libsuitesparseconfig.so.5\",\n        \"lib/libsuitesparseconfig.so.5.5.0\",\n        \"lib/libumfpack.so\",\n        \"lib/libumfpack.so.5\",\n        \"lib/libumfpack.so.5.7.9\",\n        \"share/doc/suitesparse-5.6.0/AMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/AMD_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/BTF_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CAMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CAMD_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/CCOLAMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CHOLMOD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CHOLMOD_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/COLAMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CXSPARSE_README.txt\",\n        \"share/doc/suitesparse-5.6.0/KLU_README.txt\",\n        \"share/doc/suitesparse-5.6.0/KLU_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/LDL_README.txt\",\n        \"share/doc/suitesparse-5.6.0/RBIO_README.txt\",\n        \"share/doc/suitesparse-5.6.0/SPQR_README.txt\",\n        \"share/doc/suitesparse-5.6.0/SUITESPARSECONFIG_README.txt\",\n        \"share/doc/suitesparse-5.6.0/SuiteSparse_README.txt\",\n        \"share/doc/suitesparse-5.6.0/UMFPACK_QuickStart.pdf\",\n        \"share/doc/suitesparse-5.6.0/UMFPACK_README.txt\",\n        \"share/doc/suitesparse-5.6.0/UMFPACK_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/ldl_userguide.pdf\",\n        \"share/doc/suitesparse-5.6.0/spqr_user_guide.pdf\"\n    ]\n}\n```\n\nI also confirmed that none of the installed files contain the DESTDIR temporary path, which is generally required for a proper staged install.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[19212a8](https://github.com/sagemath/sagetrac-mirror/commit/19212a8db7f8deec0a864145b802b3aa85099d0c)|`Trac #28832: Support staged installation of suitesparse using DESTDIR.`|",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560769",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
This fixes it: 

```
{
    "package_name": "suitesparse",
    "package_version": "5.6.0",
    "install_date": "Mon Dec  2 14:40:14 UTC 2019",
    "system_uname": "Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux"
,
    "sage_version": "SageMath version 9.0.beta8, Release Date: 2019-12-01",
    "test_result": "",
    "files": [
        "include/RBio.h",
        "include/SuiteSparseQR.hpp",
        "include/SuiteSparseQR_C.h",
        "include/SuiteSparseQR_definitions.h",
        "include/SuiteSparse_config.h",
        "include/amd.h",
        "include/btf.h",
        "include/camd.h",
        "include/ccolamd.h",
        "include/cholmod.h",
        "include/cholmod_blas.h",
        "include/cholmod_camd.h",
        "include/cholmod_check.h",
        "include/cholmod_cholesky.h",
        "include/cholmod_complexity.h",
        "include/cholmod_config.h",
        "include/cholmod_core.h",
        "include/cholmod_function.h",
        "include/cholmod_gpu.h",
        "include/cholmod_gpu_kernels.h",
        "include/cholmod_io64.h",
        "include/cholmod_matrixops.h",
        "include/cholmod_modify.h",
        "include/cholmod_partition.h",
        "include/cholmod_supernodal.h",
        "include/cholmod_template.h",
        "include/colamd.h",
        "include/cs.h",
        "include/klu.h",
        "include/ldl.h",
        "include/spqr.hpp",
        "include/umfpack.h",
        "include/umfpack_col_to_triplet.h",
        "include/umfpack_defaults.h",
        "include/umfpack_free_numeric.h",
        "include/umfpack_free_symbolic.h",
        "include/umfpack_get_determinant.h",
        "include/umfpack_get_lunz.h",
        "include/umfpack_get_numeric.h",
        "include/umfpack_get_symbolic.h",
        "include/umfpack_global.h",
        "include/umfpack_load_numeric.h",
        "include/umfpack_load_symbolic.h",
        "include/umfpack_numeric.h",
        "include/umfpack_qsymbolic.h",
        "include/umfpack_report_control.h",
        "include/umfpack_report_info.h",
        "include/umfpack_report_matrix.h",
        "include/umfpack_report_numeric.h",
        "include/umfpack_report_perm.h",
        "include/umfpack_report_status.h",
        "include/umfpack_report_symbolic.h",
        "include/umfpack_report_triplet.h",
        "include/umfpack_report_vector.h",
        "include/umfpack_save_numeric.h",
        "include/umfpack_save_symbolic.h",
        "include/umfpack_scale.h",
        "include/umfpack_solve.h",
        "include/umfpack_symbolic.h",
        "include/umfpack_tictoc.h",
        "include/umfpack_timer.h",
        "include/umfpack_transpose.h",
        "include/umfpack_triplet_to_col.h",
        "include/umfpack_wsolve.h",
        "lib/libamd.so",
        "lib/libamd.so.2",
        "lib/libamd.so.2.4.6",
        "lib/libbtf.so",
        "lib/libbtf.so.1",
        "lib/libbtf.so.1.2.6",
        "lib/libcamd.so",
        "lib/libcamd.so.2",
        "lib/libcamd.so.2.4.6",
        "lib/libccolamd.so",
        "lib/libccolamd.so.2",
        "lib/libccolamd.so.2.9.6",
        "lib/libcholmod.so",
        "lib/libcholmod.so.3",
        "lib/libcholmod.so.3.0.13",
        "lib/libcolamd.so",
        "lib/libcolamd.so.2",
        "lib/libcolamd.so.2.9.6",
        "lib/libcxsparse.so",
        "lib/libcxsparse.so.3",
        "lib/libcxsparse.so.3.2.0",
        "lib/libklu.so",
        "lib/libklu.so.1",                                                                                                   
        "lib/libklu.so.1.3.8",
        "lib/libldl.so",
        "lib/libldl.so.2",
        "lib/libldl.so.2.2.6",
        "lib/librbio.so",
        "lib/librbio.so.2",
        "lib/librbio.so.2.2.6",
        "lib/libspqr.so",
        "lib/libspqr.so.2",
        "lib/libspqr.so.2.0.9",
        "lib/libsuitesparseconfig.so",
        "lib/libsuitesparseconfig.so.5",
        "lib/libsuitesparseconfig.so.5.5.0",
        "lib/libumfpack.so",
        "lib/libumfpack.so.5",
        "lib/libumfpack.so.5.7.9",
        "share/doc/suitesparse-5.6.0/AMD_README.txt",
        "share/doc/suitesparse-5.6.0/AMD_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/BTF_README.txt",
        "share/doc/suitesparse-5.6.0/CAMD_README.txt",
        "share/doc/suitesparse-5.6.0/CAMD_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/CCOLAMD_README.txt",
        "share/doc/suitesparse-5.6.0/CHOLMOD_README.txt",
        "share/doc/suitesparse-5.6.0/CHOLMOD_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/COLAMD_README.txt",
        "share/doc/suitesparse-5.6.0/CXSPARSE_README.txt",
        "share/doc/suitesparse-5.6.0/KLU_README.txt",
        "share/doc/suitesparse-5.6.0/KLU_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/LDL_README.txt",
        "share/doc/suitesparse-5.6.0/RBIO_README.txt",
        "share/doc/suitesparse-5.6.0/SPQR_README.txt",
        "share/doc/suitesparse-5.6.0/SUITESPARSECONFIG_README.txt",
        "share/doc/suitesparse-5.6.0/SuiteSparse_README.txt",
        "share/doc/suitesparse-5.6.0/UMFPACK_QuickStart.pdf",
        "share/doc/suitesparse-5.6.0/UMFPACK_README.txt",
        "share/doc/suitesparse-5.6.0/UMFPACK_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/ldl_userguide.pdf",
        "share/doc/suitesparse-5.6.0/spqr_user_guide.pdf"
    ]
}
```

I also confirmed that none of the installed files contain the DESTDIR temporary path, which is generally required for a proper staged install.

---
New commits:
|                                                                                                                                          |                                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[19212a8](https://github.com/sagemath/sagetrac-mirror/commit/19212a8db7f8deec0a864145b802b3aa85099d0c)|`Trac #28832: Support staged installation of suitesparse using DESTDIR.`|



---

archive/issue_comments_560770.json:
```json
{
    "body": "Changing commit from \"\" to \"19212a8db7f8deec0a864145b802b3aa85099d0c\"",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560770",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "19212a8db7f8deec0a864145b802b3aa85099d0c"



---

archive/issue_comments_560771.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2019-12-02T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560771",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_560772.json:
```json
{
    "body": "<a id='comment:2'></a>\nFair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.",
    "created_at": "2019-12-02T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560772",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.



---

archive/issue_comments_560773.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-02T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560773",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_560774.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [fbissey](#comment%3A2):\n> Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.\n\n\nYeah don't worry, not your fault.  I need to do more work to make this clearer.  It's not even currently *that* important for \"standard\" packages, but is still useful for proper uninstallation/cleanup when updating package versions.",
    "created_at": "2019-12-03T10:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560774",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
Replying to [fbissey](#comment%3A2):
> Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.


Yeah don't worry, not your fault.  I need to do more work to make this clearer.  It's not even currently *that* important for "standard" packages, but is still useful for proper uninstallation/cleanup when updating package versions.



---

archive/issue_comments_560775.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-12-05T21:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560775",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_560776.json:
```json
{
    "body": "<a id='comment:4'></a>\nI'm getting \n\n```\nranlib libamd.a\ngcc -L/home/release/Sage/local/lib -Wl,-rpath,/home/release/Sage/local/lib  -shared -Wl,-soname -Wl,libamd.so.2 -Wl,--no-undefined amd_i_aat.o amd_i_1.o amd_i_2.o amd_i_dump.o amd_i_postorder.o amd_i_defaults.o amd_i_post_tree.o amd_i_order.o amd_i_control.o amd_i_info.o amd_i_valid.o amd_i_preprocess.o amd_l_aat.o amd_l_1.o amd_l_2.o amd_l_dump.o amd_l_postorder.o amd_l_defaults.o amd_l_post_tree.o amd_l_order.o amd_l_control.o amd_l_info.o amd_l_valid.o amd_l_preprocess.o -o /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6 -lm -lrt -lsuitesparseconfig\n/usr/bin/ld: cannot find -lsuitesparseconfig\ncollect2: error: ld returned 1 exit status\nmake[6]: *** [Makefile:90: /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6] Error 1\nmake[6]: Leaving directory '/home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/src/AMD/Lib'\n```\non my Ryzen 3800X. Note:\n\n```\n[release@zen Sage]$ find local | grep suitesparseconfig\nlocal/var/tmp/sage/build/suitesparse-5.6.0/src/SuiteSparse_config/libsuitesparseconfig.a\nlocal/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5.5.0\nlocal/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so\nlocal/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5\n```",
    "created_at": "2019-12-05T21:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560776",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
I'm getting 

```
ranlib libamd.a
gcc -L/home/release/Sage/local/lib -Wl,-rpath,/home/release/Sage/local/lib  -shared -Wl,-soname -Wl,libamd.so.2 -Wl,--no-undefined amd_i_aat.o amd_i_1.o amd_i_2.o amd_i_dump.o amd_i_postorder.o amd_i_defaults.o amd_i_post_tree.o amd_i_order.o amd_i_control.o amd_i_info.o amd_i_valid.o amd_i_preprocess.o amd_l_aat.o amd_l_1.o amd_l_2.o amd_l_dump.o amd_l_postorder.o amd_l_defaults.o amd_l_post_tree.o amd_l_order.o amd_l_control.o amd_l_info.o amd_l_valid.o amd_l_preprocess.o -o /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6 -lm -lrt -lsuitesparseconfig
/usr/bin/ld: cannot find -lsuitesparseconfig
collect2: error: ld returned 1 exit status
make[6]: *** [Makefile:90: /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6] Error 1
make[6]: Leaving directory '/home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/src/AMD/Lib'
```
on my Ryzen 3800X. Note:

```
[release@zen Sage]$ find local | grep suitesparseconfig
local/var/tmp/sage/build/suitesparse-5.6.0/src/SuiteSparse_config/libsuitesparseconfig.a
local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5.5.0
local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so
local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5
```



---

archive/issue_comments_560777.json:
```json
{
    "body": "<a id='comment:5'></a>\nHum, it should have worked. There must be something no behaving in AMD's makefile. Investigating.",
    "created_at": "2019-12-05T21:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560777",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Hum, it should have worked. There must be something no behaving in AMD's makefile. Investigating.



---

archive/issue_comments_560778.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think I know what's happening. The new patch removes\n\n```\n+-    LDFLAGS += -L$(INSTALL_LIB)\n```\nAnd later we have \n\n```\nSO_OPTS = $(LDFLAGS)\n```\nSo we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.",
    "created_at": "2019-12-05T21:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560778",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
I think I know what's happening. The new patch removes

```
+-    LDFLAGS += -L$(INSTALL_LIB)
```
And later we have 

```
SO_OPTS = $(LDFLAGS)
```
So we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.



---

archive/issue_comments_560779.json:
```json
{
    "body": "Changing commit from \"19212a8db7f8deec0a864145b802b3aa85099d0c\" to \"5b54ee73c5fbd24e0b4bd19abd610bba202eba85\"",
    "created_at": "2019-12-05T23:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560779",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "19212a8db7f8deec0a864145b802b3aa85099d0c" to "5b54ee73c5fbd24e0b4bd19abd610bba202eba85"



---

archive/issue_comments_560780.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-05T23:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560780",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_560781.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits:\n|                                                                                                                                          |                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[5b54ee7](https://github.com/sagemath/sagetrac-mirror/commit/5b54ee73c5fbd24e0b4bd19abd610bba202eba85)|`Re-add some LDFLAGS that are needed in suitesparse`|",
    "created_at": "2019-12-05T23:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560781",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
New commits:
|                                                                                                                                          |                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[5b54ee7](https://github.com/sagemath/sagetrac-mirror/commit/5b54ee73c5fbd24e0b4bd19abd610bba202eba85)|`Re-add some LDFLAGS that are needed in suitesparse`|



---

archive/issue_comments_560782.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-28832\" to \"u/fbissey/ticket-28832\"",
    "created_at": "2019-12-05T23:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560782",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "u/embray/ticket-28832" to "u/fbissey/ticket-28832"



---

archive/issue_comments_560783.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm getting doctesting errors on OS X 10.14.6, for example:\n\n```\nsage -t --long src/sage/numerical/optimize.py\n**********************************************************************\nFile \"src/sage/numerical/optimize.py\", line 597, in sage.numerical.optimize.linear_program\nFailed example:\n    sol=linear_program(c,G,h)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.numerical.optimize.linear_program[3]>\", line 1, in <module>\n        sol=linear_program(c,G,h)\n      File \"sage/misc/lazy_import.pyx\", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3686)\n        return self.get_object()(*args, **kwds)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/numerical/optimize.py\", line 639, in linear_program\n        sol=solvers.lp(c_,G_,h_,solver=solver)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/coneprog.py\", line 2783, in lp\n        from cvxopt import base, blas, misc\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/misc.py\", line 21, in <module>\n        from cvxopt import base, blas, lapack, cholmod, misc_solvers\n    ImportError: dlopen(/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so, 2): Library not loaded: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib\n      Referenced from: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so\n      Reason: image not found\n```",
    "created_at": "2019-12-06T00:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560783",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
I'm getting doctesting errors on OS X 10.14.6, for example:

```
sage -t --long src/sage/numerical/optimize.py
**********************************************************************
File "src/sage/numerical/optimize.py", line 597, in sage.numerical.optimize.linear_program
Failed example:
    sol=linear_program(c,G,h)
Exception raised:
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.optimize.linear_program[3]>", line 1, in <module>
        sol=linear_program(c,G,h)
      File "sage/misc/lazy_import.pyx", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3686)
        return self.get_object()(*args, **kwds)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/numerical/optimize.py", line 639, in linear_program
        sol=solvers.lp(c_,G_,h_,solver=solver)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/coneprog.py", line 2783, in lp
        from cvxopt import base, blas, misc
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/misc.py", line 21, in <module>
        from cvxopt import base, blas, lapack, cholmod, misc_solvers
    ImportError: dlopen(/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so, 2): Library not loaded: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib
      Referenced from: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so
      Reason: image not found
```



---

archive/issue_comments_560784.json:
```json
{
    "body": "<a id='comment:9'></a>\nIs it just with this ticket, or since we introduced suitesparse? Also does cvxopt work and pass its testsuite on the same machine?",
    "created_at": "2019-12-06T00:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560784",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Is it just with this ticket, or since we introduced suitesparse? Also does cvxopt work and pass its testsuite on the same machine?



---

archive/issue_comments_560785.json:
```json
{
    "body": "<a id='comment:10'></a>\nLack of `install_name` on OS X could be an issue but should also be present without this ticket.",
    "created_at": "2019-12-06T00:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560785",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Lack of `install_name` on OS X could be an issue but should also be present without this ticket.



---

archive/issue_comments_560786.json:
```json
{
    "body": "<a id='comment:11'></a>\nActually, now I am thinking that `install_name` could be automatically set to the location provided by the `-o` argument in linking. Which, with this ticket will be prefixed by `DESTDIR` and that would be an issue. And now that I tried to ask you some output of `otool -L` I realise that the prefix is present in what the loader asks. So this is the problem. I will fix it ASAP.",
    "created_at": "2019-12-06T00:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560786",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Actually, now I am thinking that `install_name` could be automatically set to the location provided by the `-o` argument in linking. Which, with this ticket will be prefixed by `DESTDIR` and that would be an issue. And now that I tried to ask you some output of `otool -L` I realise that the prefix is present in what the loader asks. So this is the problem. I will fix it ASAP.



---

archive/issue_comments_560787.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[8d79590](https://github.com/sagemath/sagetrac-mirror/commit/8d795908b343506192a5f9cdcaab76a2a7624180)|`fix install_name on OS X`|",
    "created_at": "2019-12-06T01:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[8d79590](https://github.com/sagemath/sagetrac-mirror/commit/8d795908b343506192a5f9cdcaab76a2a7624180)|`fix install_name on OS X`|



---

archive/issue_comments_560788.json:
```json
{
    "body": "Changing commit from \"5b54ee73c5fbd24e0b4bd19abd610bba202eba85\" to \"8d795908b343506192a5f9cdcaab76a2a7624180\"",
    "created_at": "2019-12-06T01:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5b54ee73c5fbd24e0b4bd19abd610bba202eba85" to "8d795908b343506192a5f9cdcaab76a2a7624180"



---

archive/issue_comments_560789.json:
```json
{
    "body": "<a id='comment:13'></a>\nTry it now.",
    "created_at": "2019-12-06T01:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560789",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Try it now.



---

archive/issue_comments_560790.json:
```json
{
    "body": "<a id='comment:14'></a>\nI'm using a different machine (OS X 10.15.1) but same result. `cvxopt` fails its test suite, too: same problem. With plain Sage 9.0.beta8, all tests pass and `cvxopt` passes its test suite.",
    "created_at": "2019-12-06T04:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560790",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I'm using a different machine (OS X 10.15.1) but same result. `cvxopt` fails its test suite, too: same problem. With plain Sage 9.0.beta8, all tests pass and `cvxopt` passes its test suite.



---

archive/issue_comments_560791.json:
```json
{
    "body": "<a id='comment:15'></a>\nEven with my updated branch? What does `otool -L local/lib/libcholmod.3.0.13.dylib` report?",
    "created_at": "2019-12-06T04:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560791",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Even with my updated branch? What does `otool -L local/lib/libcholmod.3.0.13.dylib` report?



---

archive/issue_comments_560792.json:
```json
{
    "body": "<a id='comment:16'></a>\nYes, this with the updated branch; the latest entry in `git log` is \n\n```\ncommit 8d795908b343506192a5f9cdcaab76a2a7624180 (HEAD -> t/28832/ticket-28832, trac/u/fbissey/ticket-28832)\nAuthor: Fran\u00e7ois Bissey <frp.bissey@gmail.com>\nDate:   Fri Dec 6 14:10:15 2019 +1300\n\n    fix install_name on OS X\n```\nI unpacked a tar file, ran `git trac config`, `git trac checkout 28832`, and then `make ptestlong`.\n\nThe paths are broken \u2014\u00a0they point to the temporary build directory:\n\n```\n% otool -L local/lib/libcholmod.3.0.13.dylib\nlocal/lib/libcholmod.3.0.13.dylib:\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.dylib (compatibility version 3.0.0, current version 3.0.13)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.dylib (compatibility version 5.0.0, current version 5.5.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libccolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)\n```\nIn comparison, with plain 9.0.beta8:\n\n```\n% otool -L local/lib/libcholmod.3.0.13.dylib\nlocal/lib/libcholmod.3.0.13.dylib:\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib (compatibility version 3.0.0, current version 3.0.13)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.5.0.dylib (compatibility version 5.0.0, current version 5.5.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libccolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)\n```",
    "created_at": "2019-12-06T05:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560792",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
Yes, this with the updated branch; the latest entry in `git log` is 

```
commit 8d795908b343506192a5f9cdcaab76a2a7624180 (HEAD -> t/28832/ticket-28832, trac/u/fbissey/ticket-28832)
Author: François Bissey <frp.bissey@gmail.com>
Date:   Fri Dec 6 14:10:15 2019 +1300

    fix install_name on OS X
```
I unpacked a tar file, ran `git trac config`, `git trac checkout 28832`, and then `make ptestlong`.

The paths are broken — they point to the temporary build directory:

```
% otool -L local/lib/libcholmod.3.0.13.dylib
local/lib/libcholmod.3.0.13.dylib:
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.dylib (compatibility version 3.0.0, current version 3.0.13)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.dylib (compatibility version 5.0.0, current version 5.5.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libccolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)
```
In comparison, with plain 9.0.beta8:

```
% otool -L local/lib/libcholmod.3.0.13.dylib
local/lib/libcholmod.3.0.13.dylib:
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib (compatibility version 3.0.0, current version 3.0.13)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.5.0.dylib (compatibility version 5.0.0, current version 5.5.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libccolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)
```



---

archive/issue_comments_560793.json:
```json
{
    "body": "<a id='comment:17'></a>\nI am officially stupid. Correcting...",
    "created_at": "2019-12-06T06:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560793",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
I am officially stupid. Correcting...



---

archive/issue_comments_560794.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[efeab2f](https://github.com/sagemath/sagetrac-mirror/commit/efeab2f799c7d4d6b2d89e110b9ddaffc77b2712)|`correct the final path in install_name`|",
    "created_at": "2019-12-06T06:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[efeab2f](https://github.com/sagemath/sagetrac-mirror/commit/efeab2f799c7d4d6b2d89e110b9ddaffc77b2712)|`correct the final path in install_name`|



---

archive/issue_comments_560795.json:
```json
{
    "body": "Changing commit from \"8d795908b343506192a5f9cdcaab76a2a7624180\" to \"efeab2f799c7d4d6b2d89e110b9ddaffc77b2712\"",
    "created_at": "2019-12-06T06:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8d795908b343506192a5f9cdcaab76a2a7624180" to "efeab2f799c7d4d6b2d89e110b9ddaffc77b2712"



---

archive/issue_comments_560796.json:
```json
{
    "body": "<a id='comment:19'></a>\nShould be better now.",
    "created_at": "2019-12-06T06:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560796",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Should be better now.



---

archive/issue_comments_560797.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [fbissey](#comment%3A6):\n> I think I know what's happening. The new patch removes\n> \n> ```\n> +-    LDFLAGS += -L$(INSTALL_LIB)\n> ```\n> And later we have \n> \n> ```\n> SO_OPTS = $(LDFLAGS)\n> ```\n> So we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.\n\n\nYou're right, of course.  I made the same update to the patch in #28829, but I really should have fixed the version here.  I'll have to rebase #28829 on this one if you think it's ready.",
    "created_at": "2019-12-06T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560797",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
Replying to [fbissey](#comment%3A6):
> I think I know what's happening. The new patch removes
> 
> ```
> +-    LDFLAGS += -L$(INSTALL_LIB)
> ```
> And later we have 
> 
> ```
> SO_OPTS = $(LDFLAGS)
> ```
> So we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.


You're right, of course.  I made the same update to the patch in #28829, but I really should have fixed the version here.  I'll have to rebase #28829 on this one if you think it's ready.



---

archive/issue_comments_560798.json:
```json
{
    "body": "<a id='comment:21'></a>\nThank you for adding the OSX stuff--I should've caught that.  Positive review from me pending review from John.",
    "created_at": "2019-12-06T13:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560798",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Thank you for adding the OSX stuff--I should've caught that.  Positive review from me pending review from John.



---

archive/issue_comments_560799.json:
```json
{
    "body": "<a id='comment:22'></a>\nThis version works for me.",
    "created_at": "2019-12-06T17:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560799",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
This version works for me.



---

archive/issue_comments_560800.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-06T17:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560800",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_560801.json:
```json
{
    "body": "Changing reviewer from \"Fran\u00e7ois Bissey\" to \"Fran\u00e7ois Bissey, Erik Bray\"",
    "created_at": "2019-12-06T17:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560801",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "François Bissey" to "François Bissey, Erik Bray"



---

archive/issue_comments_560802.json:
```json
{
    "body": "Changing author from \"Erik Bray\" to \"Erik Bray, Fran\u00e7ois Bissey\"",
    "created_at": "2019-12-06T17:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560802",
    "user": "https://github.com/jhpalmieri"
}
```

Changing author from "Erik Bray" to "Erik Bray, François Bissey"



---

archive/issue_events_082325.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-09T22:54:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28832#event-82325"
}
```



---

archive/issue_comments_560803.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-09T22:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560803",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_560804.json:
```json
{
    "body": "Changing branch from \"u/fbissey/ticket-28832\" to \"efeab2f799c7d4d6b2d89e110b9ddaffc77b2712\"",
    "created_at": "2019-12-09T22:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28832#issuecomment-560804",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/fbissey/ticket-28832" to "efeab2f799c7d4d6b2d89e110b9ddaffc77b2712"
