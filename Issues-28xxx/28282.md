# Issue 28282: Add iterator method in QQ for Calkin-Wilf sequence

archive/issues_028045.json:
```json
{
    "assignees": [],
    "body": "Add a method to the set of rational numbers to produce an iterator for the Calkin-Wilf sequence, an explicit ordering of the positive rationals with some interesting features.  Background:\n- https://www.math.upenn.edu/~wilf/website/recounting.pdf\n- https://oeis.org/A002487\n- https://en.wikipedia.org/wiki/Calkin%E2%80%93Wilf_tree.\n\n**CC:**  @slel\n\n**Keywords:** sequence, iterator\n\n**Branch:** [u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence](https://github.com/sagemath/sagetrac-mirror/tree/u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence)\n\n**Commit:** [9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea](https://github.com/sagemath/sagetrac-mirror/commit/9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea)\n\n**Reviewer:** Samuel Leli\u00e8vre\n\n**Author:** Bryan Gillespie\n\nIssue created by migration from https://trac.sagemath.org/ticket/28282\n\n",
    "created_at": "2019-07-30T03:47:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add iterator method in QQ for Calkin-Wilf sequence",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/28282",
    "user": "https://github.com/bgillesp"
}
```
Add a method to the set of rational numbers to produce an iterator for the Calkin-Wilf sequence, an explicit ordering of the positive rationals with some interesting features.  Background:
- https://www.math.upenn.edu/~wilf/website/recounting.pdf
- https://oeis.org/A002487
- https://en.wikipedia.org/wiki/Calkin%E2%80%93Wilf_tree.

**CC:**  @slel

**Keywords:** sequence, iterator

**Branch:** [u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence](https://github.com/sagemath/sagetrac-mirror/tree/u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence)

**Commit:** [9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea](https://github.com/sagemath/sagetrac-mirror/commit/9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea)

**Reviewer:** Samuel Lelièvre

**Author:** Bryan Gillespie

Issue created by migration from https://trac.sagemath.org/ticket/28282





---

archive/issue_comments_443624.json:
```json
{
    "body": "**Branch:** [u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence](https://github.com/sagemath/sagetrac-mirror/tree/u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence)",
    "created_at": "2019-07-30T04:25:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443624",
    "user": "https://github.com/bgillesp"
}
```

**Branch:** [u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence](https://github.com/sagemath/sagetrac-mirror/tree/u/bgillespie/add_iterator_method_in_qq_for_calkin_wilf_sequence)



---

archive/issue_comments_443625.json:
```json
{
    "body": "**Commit:** [9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea](https://github.com/sagemath/sagetrac-mirror/commit/9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea)",
    "created_at": "2019-08-11T16:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443625",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea](https://github.com/sagemath/sagetrac-mirror/commit/9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea)



---

archive/issue_comments_443626.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea\">9b82dac</a></td><td><code>Add literature reference and improve performance</code></td></tr></table>\n",
    "created_at": "2019-08-11T16:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443626",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b82daceade1a4ab1cedbe13d1c1d2cb61aa39ea">9b82dac</a></td><td><code>Add literature reference and improve performance</code></td></tr></table>




---

archive/issue_events_250208.json:
```json
{
    "actor": "https://github.com/bgillesp",
    "created_at": "2019-08-11T16:55:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250208"
}
```



---

archive/issue_comments_443627.json:
```json
{
    "body": "**Author:** Bryan Gillespie",
    "created_at": "2019-08-11T16:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443627",
    "user": "https://github.com/bgillesp"
}
```

**Author:** Bryan Gillespie



---

archive/issue_comments_443628.json:
```json
{
    "body": "<a id='comment:4'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443628",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_250209.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250209"
}
```



---

archive/issue_events_250210.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250210"
}
```



---

archive/issue_comments_443629.json:
```json
{
    "body": "<a id='comment:5'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443629",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_250211.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250211"
}
```



---

archive/issue_events_250212.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250212"
}
```



---

archive/issue_comments_443630.json:
```json
{
    "body": "<a id='comment:6'></a>\nThat would be a nice addition!\n\nThe branch needs rebasing. In addition I suggest considering these minor changes:\n\n```diff\n-        p, q = ZZ(1), ZZ(1)\n+        p = q = ZZ.one()\n         if all_rationals:\n-            yield self(0)\n+            yield self.zero()\n             while True:\n-                yield self(p / q)\n-                yield -self(p / q)\n+                yield self((p, q))\n+                yield self((-p, q))\n                 p, q = q, 2 * (p // q) * q - p + q\n         else:\n             while True:\n-                yield self(p / q)\n+                yield self((p, q))\n                 p, q = q, 2 * (p // q) * q - p + q\n```",
    "created_at": "2020-09-01T00:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443630",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>
That would be a nice addition!

The branch needs rebasing. In addition I suggest considering these minor changes:

```diff
-        p, q = ZZ(1), ZZ(1)
+        p = q = ZZ.one()
         if all_rationals:
-            yield self(0)
+            yield self.zero()
             while True:
-                yield self(p / q)
-                yield -self(p / q)
+                yield self((p, q))
+                yield self((-p, q))
                 p, q = q, 2 * (p // q) * q - p + q
         else:
             while True:
-                yield self(p / q)
+                yield self((p, q))
                 p, q = q, 2 * (p // q) * q - p + q
```



---

archive/issue_events_250213.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-01T00:28:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250213"
}
```



---

archive/issue_events_250214.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-01T00:28:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250214"
}
```



---

archive/issue_comments_443631.json:
```json
{
    "body": "**Reviewer:** Samuel Leli\u00e8vre",
    "created_at": "2020-09-01T00:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443631",
    "user": "https://github.com/slel"
}
```

**Reviewer:** Samuel Lelièvre



---

archive/issue_comments_443632.json:
```json
{
    "body": "<a id='comment:7'></a>\nWe've been there already:\n\nhttps://github.com/sagemath/sagetrac-mirror/commit/45dc1b94996b609a039531a64a81279892bb7c2d/src/sage/rings/rational_field.py\n\nIt's indeed a cute sequence. The generating formula is surprisingly simple, but most problems that require iterating over the rationals are better served by another order (indeed, it's since been replaced by iteration by height):\n\nhttps://github.com/sagemath/sagetrac-mirror/commits/55ad3590cb7d993f38c9104ea87da24b21567009",
    "created_at": "2020-09-01T03:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443632",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>
We've been there already:

https://github.com/sagemath/sagetrac-mirror/commit/45dc1b94996b609a039531a64a81279892bb7c2d/src/sage/rings/rational_field.py

It's indeed a cute sequence. The generating formula is surprisingly simple, but most problems that require iterating over the rationals are better served by another order (indeed, it's since been replaced by iteration by height):

https://github.com/sagemath/sagetrac-mirror/commits/55ad3590cb7d993f38c9104ea87da24b21567009



---

archive/issue_comments_443633.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks @nbruin for pointing out the initial iterator for `QQ`\nused this sequence, and for the pointers to the commits\nimplementing it and then replacing it with a better default.\n\nThis ticket aims to provide a Calkin-Wilf iterator as distinct\nfrom the standard iterator for `QQ`.\n\nWould you advise against it? Would this Calkin-Wilf iterator\nbetter be given as an example in the tutorial on iterators?\nMaybe with a reference from the documentation of `QQ`?",
    "created_at": "2020-09-01T17:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443633",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>
Thanks @nbruin for pointing out the initial iterator for `QQ`
used this sequence, and for the pointers to the commits
implementing it and then replacing it with a better default.

This ticket aims to provide a Calkin-Wilf iterator as distinct
from the standard iterator for `QQ`.

Would you advise against it? Would this Calkin-Wilf iterator
better be given as an example in the tutorial on iterators?
Maybe with a reference from the documentation of `QQ`?



---

archive/issue_comments_443634.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [@slel](#comment%3A8):\n> Thanks @nbruin for pointing out the initial iterator for `QQ`\n> used this sequence, and for the pointers to the commits\n> implementing it and then replacing it with a better default.\n> \n> This ticket aims to provide a Calkin-Wilf iterator as distinct\n> from the standard iterator for `QQ`.\n> \n> Would you advise against it? Would this Calkin-Wilf iterator\n> better be given as an example in the tutorial on iterators?\n> Maybe with a reference from the documentation of `QQ`?\n\nI'd think so. The formula is exceedingly simple: see the original implementation that was essentially a one-liner.\n\nI was originally enthusiastic when I learned about the formula, but I don't think the sequence really has wider applications. Including it would be more of encyclopedic interest, and I think `QQ` is not the right place for that. We already have OEIS. Interfacing with that makes more sense. There is in fact a (lousy) sage program listed there. It would make a lot more sense if there were an iterator there.",
    "created_at": "2020-09-02T21:51:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443634",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'></a>
Replying to [@slel](#comment%3A8):
> Thanks @nbruin for pointing out the initial iterator for `QQ`
> used this sequence, and for the pointers to the commits
> implementing it and then replacing it with a better default.
> 
> This ticket aims to provide a Calkin-Wilf iterator as distinct
> from the standard iterator for `QQ`.
> 
> Would you advise against it? Would this Calkin-Wilf iterator
> better be given as an example in the tutorial on iterators?
> Maybe with a reference from the documentation of `QQ`?

I'd think so. The formula is exceedingly simple: see the original implementation that was essentially a one-liner.

I was originally enthusiastic when I learned about the formula, but I don't think the sequence really has wider applications. Including it would be more of encyclopedic interest, and I think `QQ` is not the right place for that. We already have OEIS. Interfacing with that makes more sense. There is in fact a (lousy) sage program listed there. It would make a lot more sense if there were an iterator there.



---

archive/issue_events_250215.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250215"
}
```



---

archive/issue_events_250216.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250216"
}
```



---

archive/issue_comments_443635.json:
```json
{
    "body": "<a id='comment:11'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443635",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_250217.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250217"
}
```



---

archive/issue_events_250218.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250218"
}
```



---

archive/issue_events_250219.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250219"
}
```



---

archive/issue_events_250220.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250220"
}
```



---

archive/issue_comments_443636.json:
```json
{
    "body": "<a id='comment:12'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28282#issuecomment-443636",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_250221.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250221"
}
```



---

archive/issue_events_250222.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250222"
}
```



---

archive/issue_events_250223.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250223"
}
```



---

archive/issue_events_250224.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250224"
}
```



---

archive/issue_events_250225.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250225"
}
```



---

archive/issue_events_250226.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28282",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28282#event-250226"
}
```
