# Issue 28282: Add iterator method in QQ for Calkin-Wilf sequence

archive/issues_028045.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: sequence, iterator\n\nAdd a method to the set of rational numbers to produce an iterator for the Calkin-Wilf sequence, an explicit ordering of the positive rationals with some interesting features.  Background:\n- https://www.math.upenn.edu/~wilf/website/recounting.pdf\n- https://oeis.org/A002487\n- https://en.wikipedia.org/wiki/Calkin%E2%80%93Wilf_tree.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28282\n\n",
    "created_at": "2019-07-30T03:47:00Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Add iterator method in QQ for Calkin-Wilf sequence",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28282",
    "user": "https://github.com/bgillesp"
}
```
CC:  @slel

Keywords: sequence, iterator

Add a method to the set of rational numbers to produce an iterator for the Calkin-Wilf sequence, an explicit ordering of the positive rationals with some interesting features.  Background:
- https://www.math.upenn.edu/~wilf/website/recounting.pdf
- https://oeis.org/A002487
- https://en.wikipedia.org/wiki/Calkin%E2%80%93Wilf_tree.

Issue created by migration from https://trac.sagemath.org/ticket/28282





---

archive/issue_comments_395988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-11T16:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_395989.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-11T16:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395989",
    "user": "https://github.com/bgillesp"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_395990.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395990",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_070572.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70572"
}
```



---

archive/issue_comments_395991.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395991",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_070573.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70573"
}
```



---

archive/issue_events_070574.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70574"
}
```



---

archive/issue_comments_395992.json:
```json
{
    "body": "That would be a nice addition!\n\nThe branch needs rebasing. In addition I suggest considering these minor changes:\n\n```diff\n-        p, q = ZZ(1), ZZ(1)\n+        p = q = ZZ.one()\n         if all_rationals:\n-            yield self(0)\n+            yield self.zero()\n             while True:\n-                yield self(p / q)\n-                yield -self(p / q)\n+                yield self((p, q))\n+                yield self((-p, q))\n                 p, q = q, 2 * (p // q) * q - p + q\n         else:\n             while True:\n-                yield self(p / q)\n+                yield self((p, q))\n                 p, q = q, 2 * (p // q) * q - p + q\n```",
    "created_at": "2020-09-01T00:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395992",
    "user": "https://github.com/slel"
}
```

That would be a nice addition!

The branch needs rebasing. In addition I suggest considering these minor changes:

```diff
-        p, q = ZZ(1), ZZ(1)
+        p = q = ZZ.one()
         if all_rationals:
-            yield self(0)
+            yield self.zero()
             while True:
-                yield self(p / q)
-                yield -self(p / q)
+                yield self((p, q))
+                yield self((-p, q))
                 p, q = q, 2 * (p // q) * q - p + q
         else:
             while True:
-                yield self(p / q)
+                yield self((p, q))
                 p, q = q, 2 * (p // q) * q - p + q
```



---

archive/issue_comments_395993.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-01T00:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395993",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_395994.json:
```json
{
    "body": "We've been there already:\n\nhttps://git.sagemath.org/sage.git/commit/src/sage/rings/rational_field.py?h=45dc1b94996b609a039531a64a81279892bb7c2d\n\nIt's indeed a cute sequence. The generating formula is surprisingly simple, but most problems that require iterating over the rationals are better served by another order (indeed, it's since been replaced by iteration by height):\n\nhttps://git.sagemath.org/sage.git/commit/?h=55ad3590cb7d993f38c9104ea87da24b21567009",
    "created_at": "2020-09-01T03:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395994",
    "user": "https://github.com/nbruin"
}
```

We've been there already:

https://git.sagemath.org/sage.git/commit/src/sage/rings/rational_field.py?h=45dc1b94996b609a039531a64a81279892bb7c2d

It's indeed a cute sequence. The generating formula is surprisingly simple, but most problems that require iterating over the rationals are better served by another order (indeed, it's since been replaced by iteration by height):

https://git.sagemath.org/sage.git/commit/?h=55ad3590cb7d993f38c9104ea87da24b21567009



---

archive/issue_comments_395995.json:
```json
{
    "body": "Thanks `@`nbruin for pointing out the initial iterator for `QQ`\nused this sequence, and for the pointers to the commits\nimplementing it and then replacing it with a better default.\n\nThis ticket aims to provide a Calkin-Wilf iterator as distinct\nfrom the standard iterator for `QQ`.\n\nWould you advise against it? Would this Calkin-Wilf iterator\nbetter be given as an example in the tutorial on iterators?\nMaybe with a reference from the documentation of `QQ`?",
    "created_at": "2020-09-01T17:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395995",
    "user": "https://github.com/slel"
}
```

Thanks `@`nbruin for pointing out the initial iterator for `QQ`
used this sequence, and for the pointers to the commits
implementing it and then replacing it with a better default.

This ticket aims to provide a Calkin-Wilf iterator as distinct
from the standard iterator for `QQ`.

Would you advise against it? Would this Calkin-Wilf iterator
better be given as an example in the tutorial on iterators?
Maybe with a reference from the documentation of `QQ`?



---

archive/issue_comments_395996.json:
```json
{
    "body": "Replying to [comment:8 slelievre]:\n> Thanks `@`nbruin for pointing out the initial iterator for `QQ`\n> used this sequence, and for the pointers to the commits\n> implementing it and then replacing it with a better default.\n> \n> This ticket aims to provide a Calkin-Wilf iterator as distinct\n> from the standard iterator for `QQ`.\n> \n> Would you advise against it? Would this Calkin-Wilf iterator\n> better be given as an example in the tutorial on iterators?\n> Maybe with a reference from the documentation of `QQ`?\n\n\nI'd think so. The formula is exceedingly simple: see the original implementation that was essentially a one-liner.\n\nI was originally enthusiastic when I learned about the formula, but I don't think the sequence really has wider applications. Including it would be more of encyclopedic interest, and I think `QQ` is not the right place for that. We already have OEIS. Interfacing with that makes more sense. There is in fact a (lousy) sage program listed there. It would make a lot more sense if there were an iterator there.",
    "created_at": "2020-09-02T21:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395996",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:8 slelievre]:
> Thanks `@`nbruin for pointing out the initial iterator for `QQ`
> used this sequence, and for the pointers to the commits
> implementing it and then replacing it with a better default.
> 
> This ticket aims to provide a Calkin-Wilf iterator as distinct
> from the standard iterator for `QQ`.
> 
> Would you advise against it? Would this Calkin-Wilf iterator
> better be given as an example in the tutorial on iterators?
> Maybe with a reference from the documentation of `QQ`?


I'd think so. The formula is exceedingly simple: see the original implementation that was essentially a one-liner.

I was originally enthusiastic when I learned about the formula, but I don't think the sequence really has wider applications. Including it would be more of encyclopedic interest, and I think `QQ` is not the right place for that. We already have OEIS. Interfacing with that makes more sense. There is in fact a (lousy) sage program listed there. It would make a lot more sense if there were an iterator there.



---

archive/issue_events_070575.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70575"
}
```



---

archive/issue_events_070576.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70576"
}
```



---

archive/issue_comments_395997.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395997",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_070577.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70577"
}
```



---

archive/issue_events_070578.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70578"
}
```



---

archive/issue_events_070579.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70579"
}
```



---

archive/issue_events_070580.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70580"
}
```



---

archive/issue_comments_395998.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28282#issuecomment-395998",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_070581.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70581"
}
```



---

archive/issue_events_070582.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70582"
}
```



---

archive/issue_events_070583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70583"
}
```



---

archive/issue_events_070584.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70584"
}
```



---

archive/issue_events_070585.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70585"
}
```



---

archive/issue_events_070586.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28282",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28282#event-70586"
}
```
