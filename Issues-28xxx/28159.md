# Issue 28159: Vector Bundles

archive/issues_027922.json:
```json
{
    "body": "Implementation of topological and differentiable vector bundles over manifolds.\n\n**Features:**\n\n- abstract vector bundles on topological manifolds\n- trivializations\n- local frames\n- simple sections\n- vector bundle fibers\n- differentiable vector bundles and tensor bundles\n\n**Improvements in the preexisting code**\n\n- restriction of vectorframes depended on some strange order: fixed!\n- ~~`SR` enforcement for automorphism field inversion removed (due to ticket #28189)~~\n- `is_unit()` method superficially implemented for scalar fields to ensure division free matrix inversion for changes of frames (may be removed when #28629 is solved) \n\n**Planned in the farther future**\n\n- sections of general tensor products and automorphism fields on vector bundles\n- tensor products and Whitney sums of vector bundles\n- better zero treatment as in #28562\n- `TensorField` inherits from `Section`, `VectorFrame` inherits from `LocalFrame`\n- total space comes with induced charts\n\nCC:  @tscrim @egourgoulhon\n\nKeywords: vector bundles, manifolds\n\nBranch/Commit: 4ae4ca37508374ef9074cdbf9c650bb0d6ae8211\n\nReviewer: Eric Gourgoulhon, Travis Scrimshaw\n\nAuthor: Michael Jung\n\nDependencies: #28189\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28159\n\n",
    "closed_at": "2019-10-23T22:58:08Z",
    "created_at": "2019-07-10T15:46:30Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Vector Bundles",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28159",
    "user": "https://github.com/DeRhamSource"
}
```
Implementation of topological and differentiable vector bundles over manifolds.

**Features:**

- abstract vector bundles on topological manifolds
- trivializations
- local frames
- simple sections
- vector bundle fibers
- differentiable vector bundles and tensor bundles

**Improvements in the preexisting code**

- restriction of vectorframes depended on some strange order: fixed!
- ~~`SR` enforcement for automorphism field inversion removed (due to ticket #28189)~~
- `is_unit()` method superficially implemented for scalar fields to ensure division free matrix inversion for changes of frames (may be removed when #28629 is solved) 

**Planned in the farther future**

- sections of general tensor products and automorphism fields on vector bundles
- tensor products and Whitney sums of vector bundles
- better zero treatment as in #28562
- `TensorField` inherits from `Section`, `VectorFrame` inherits from `LocalFrame`
- total space comes with induced charts

CC:  @tscrim @egourgoulhon

Keywords: vector bundles, manifolds

Branch/Commit: 4ae4ca37508374ef9074cdbf9c650bb0d6ae8211

Reviewer: Eric Gourgoulhon, Travis Scrimshaw

Author: Michael Jung

Dependencies: #28189

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28159





---

archive/issue_comments_419691.json:
```json
{
    "body": "Changing keywords from \"\" to \"vector bundles, manifolds\".",
    "created_at": "2019-07-10T15:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419691",
    "user": "https://github.com/DeRhamSource"
}
```

Changing keywords from "" to "vector bundles, manifolds".



---

archive/issue_comments_419692.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-07-10T15:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419692",
    "user": "https://github.com/DeRhamSource"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_419693.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to geometry.",
    "created_at": "2019-07-10T16:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419693",
    "user": "https://github.com/DeRhamSource"
}
```

Changing component from PLEASE CHANGE to geometry.



---

archive/issue_comments_419694.json:
```json
{
    "body": "<a id='comment:4'></a>Please take a short look and give me a short feedback. I want to know whether I'm on the right way or not.\n\nFurthermore, I appreciate tricks and advices. Thanks in advance! :) \n\n---\nNew commits:",
    "created_at": "2019-07-10T16:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419694",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:4'></a>Please take a short look and give me a short feedback. I want to know whether I'm on the right way or not.

Furthermore, I appreciate tricks and advices. Thanks in advance! :) 

---
New commits:



---

archive/issue_comments_419695.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-07-10T17:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419695",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+Implementation of topological and differentiable vector bundles over manifolds.
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419696.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 gh-DeRhamSource]:\n> Please take a short look and give me a short feedback. I want to know whether I'm on the right way or not.\n> \n> Furthermore, I appreciate tricks and advices. Thanks in advance! :) \n\n\n\nThanks for this endeavor. I gave a look: it looks very nice! Please go on.\n\nA minor comment: for class names, full names are preferable, so `TopolVectorBundle` could be replaced by `TopologicalVectorBundle`. Also maybe, in the context of vector bundles, `TransitionMap` is more appropriate than `CoordChange`.",
    "created_at": "2019-07-11T08:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419696",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'></a>Replying to [comment:4 gh-DeRhamSource]:
> Please take a short look and give me a short feedback. I want to know whether I'm on the right way or not.
> 
> Furthermore, I appreciate tricks and advices. Thanks in advance! :) 



Thanks for this endeavor. I gave a look: it looks very nice! Please go on.

A minor comment: for class names, full names are preferable, so `TopolVectorBundle` could be replaced by `TopologicalVectorBundle`. Also maybe, in the context of vector bundles, `TransitionMap` is more appropriate than `CoordChange`.



---

archive/issue_comments_419697.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks!",
    "created_at": "2019-07-11T13:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419697",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:7'></a>Thanks!



---

archive/issue_comments_419698.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-13T20:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419699.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-13T21:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419700.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-14T17:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419701.json:
```json
{
    "body": "<a id='comment:12'></a>What about synergy and compatibility with the old code? I mean, tangent bundles and vector fields are just special cases of vector bundles and sections. So, it'd be nice when we don't have two different implementations for the very same thing. How would you like to handle that? Any suggestions?",
    "created_at": "2019-07-15T12:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419701",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:12'></a>What about synergy and compatibility with the old code? I mean, tangent bundles and vector fields are just special cases of vector bundles and sections. So, it'd be nice when we don't have two different implementations for the very same thing. How would you like to handle that? Any suggestions?



---

archive/issue_comments_419702.json:
```json
{
    "body": "<a id='comment:13'></a>Also, it could be a good idea to generalize tensor fields and vector fields\nto tensor product sections and treat tensor fields as a special case then.\nBut that's a huge step with pretty much effort (because I'm not that much\ninto your complete manifold code and the synergies between your files),\nwhere I'd appreciate some help -- if you agree of course. \n\nMy first approach in mind is to implement just simple sections and program tensor products of bundles aswell.",
    "created_at": "2019-07-15T14:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419702",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:13'></a>Also, it could be a good idea to generalize tensor fields and vector fields
to tensor product sections and treat tensor fields as a special case then.
But that's a huge step with pretty much effort (because I'm not that much
into your complete manifold code and the synergies between your files),
where I'd appreciate some help -- if you agree of course. 

My first approach in mind is to implement just simple sections and program tensor products of bundles aswell.



---

archive/issue_comments_419703.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 gh-DeRhamSource]:\n> What about synergy and compatibility with the old code? I mean, tangent bundles and vector fields are just special cases of vector bundles and sections. So, it'd be nice when we don't have two different implementations for the very same thing. How would you like to handle that? Any suggestions? \n\n\nSorry for the delay in replying. \nIMHO, you should introduce a subclass of `TopologicalVectorBundle` for the tangent bundle (or more generally for tensor bundles) and simply have the method `section` of this subclass return a vector field on the manifold, as defined by the \"old\" code. Maybe it is sufficient to have a single subclass for all tensor bundles, including the tangent and cotangent bundles, i.e. something like\n\n```\nclass TensorBundle(TopologicalVectorBundle):\n\n    def __init__(self, manifold, k, l):\n        rank = manifold.dim()**(k+l)\n        if (k, l) == (1, 0):\n            name = \"T{}\".format(manifold._name)\n        elif (k, l) == (0, 1):\n            name = \"T*{}\".format(manifold._name)\n        else:\n            name = \"T^({}{}){}\".format(k, l, manifold._name)\n        # similar code for latex_name\n        TopologicalVectorBundle.__init__(self, rank, name, manifold, \n                                         field=manifold.base_field(),\n                                         latex_name=latex_name)\n        self._tensor_type = (k, l)\n\n    def section(self, *args, **kwargs):\n        if self.tensor_type == (1, 0):\n            return self._base_space.vector_field(*args, **kwargs)\n        return self._base_space.tensor_field(*(self._tensor_type + args), **kwargs)\n```\nIn the code for differentiable manifolds, you could then add\n\n```\nclass DifferentiableManifold(TopologicalManifold):\n\n    ...\n\n    def tangent_bundle(self):\n        return TensorBundle(self, 1, 0)\n\n    def cotangent_bundle(self):\n        return TensorBundle(self, 0, 1)\n\n    def tensor_bundle(self, k, l)\n        return TensorBundle(self, k, l)\n\n```",
    "created_at": "2019-07-21T14:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419703",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'></a>Replying to [comment:12 gh-DeRhamSource]:
> What about synergy and compatibility with the old code? I mean, tangent bundles and vector fields are just special cases of vector bundles and sections. So, it'd be nice when we don't have two different implementations for the very same thing. How would you like to handle that? Any suggestions? 


Sorry for the delay in replying. 
IMHO, you should introduce a subclass of `TopologicalVectorBundle` for the tangent bundle (or more generally for tensor bundles) and simply have the method `section` of this subclass return a vector field on the manifold, as defined by the "old" code. Maybe it is sufficient to have a single subclass for all tensor bundles, including the tangent and cotangent bundles, i.e. something like

```
class TensorBundle(TopologicalVectorBundle):

    def __init__(self, manifold, k, l):
        rank = manifold.dim()**(k+l)
        if (k, l) == (1, 0):
            name = "T{}".format(manifold._name)
        elif (k, l) == (0, 1):
            name = "T*{}".format(manifold._name)
        else:
            name = "T^({}{}){}".format(k, l, manifold._name)
        # similar code for latex_name
        TopologicalVectorBundle.__init__(self, rank, name, manifold, 
                                         field=manifold.base_field(),
                                         latex_name=latex_name)
        self._tensor_type = (k, l)

    def section(self, *args, **kwargs):
        if self.tensor_type == (1, 0):
            return self._base_space.vector_field(*args, **kwargs)
        return self._base_space.tensor_field(*(self._tensor_type + args), **kwargs)
```
In the code for differentiable manifolds, you could then add

```
class DifferentiableManifold(TopologicalManifold):

    ...

    def tangent_bundle(self):
        return TensorBundle(self, 1, 0)

    def cotangent_bundle(self):
        return TensorBundle(self, 0, 1)

    def tensor_bundle(self, k, l)
        return TensorBundle(self, k, l)

```



---

archive/issue_comments_419704.json:
```json
{
    "body": "<a id='comment:15'></a>Also, I don't know if this is useful at this stage, but you could introduce an intermediate class, `DifferentiableVectorBundle` say, and let `TensorBundle` inherits from it. Besides, since (the total spaces of) differentiable vector bundles are differentiable manifolds, this intermediate class could inherit from `DifferentiableManifold` as well:\n\n```\nclass DifferentiableVectorBundle(TopologicalVectorBundle, DifferentiableManifold):\n\n    def __init__(self, rank, name, base_space, diff_degree=infinity,\n                 latex_name=None, category=None)\n        field = base_space.base_field()\n        TopologicalVectorBundle.__init__(self, rank, name, base_space, field=field,\n                                         latex_name=latex_name, category=category)\n        dim = base_space.dim() * rank\n        if isinstance(field, RealField_class):\n            structure = RealDifferentialStructure()\n        else:\n            structure = DifferentialStructure()\n        DifferentiableManifold.__init__(self, dim, name, field, structure,\n                                        diff_degree=diff_degree, \n                                        latex_name=latex_name, \n                                        start_index=base_space.start_index())\n\nclass TensorBundle(DifferentiableVectorBundle):\n    ...\n```",
    "created_at": "2019-07-21T16:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419704",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>Also, I don't know if this is useful at this stage, but you could introduce an intermediate class, `DifferentiableVectorBundle` say, and let `TensorBundle` inherits from it. Besides, since (the total spaces of) differentiable vector bundles are differentiable manifolds, this intermediate class could inherit from `DifferentiableManifold` as well:

```
class DifferentiableVectorBundle(TopologicalVectorBundle, DifferentiableManifold):

    def __init__(self, rank, name, base_space, diff_degree=infinity,
                 latex_name=None, category=None)
        field = base_space.base_field()
        TopologicalVectorBundle.__init__(self, rank, name, base_space, field=field,
                                         latex_name=latex_name, category=category)
        dim = base_space.dim() * rank
        if isinstance(field, RealField_class):
            structure = RealDifferentialStructure()
        else:
            structure = DifferentialStructure()
        DifferentiableManifold.__init__(self, dim, name, field, structure,
                                        diff_degree=diff_degree, 
                                        latex_name=latex_name, 
                                        start_index=base_space.start_index())

class TensorBundle(DifferentiableVectorBundle):
    ...
```



---

archive/issue_comments_419705.json:
```json
{
    "body": "<a id='comment:16'></a>In addition, to make the link with preexisting code, one could redefine the method `fiber()` of `TensorBundle` to return the tangent space at the given point if `(k,l)==(1,0)` or the corresponding tensor product for other values of `(k,l)`:\n\n```\nclass TensorBundle(DifferentiableVectorBundle):\n\n    def __init__(self, manifold, k, l):\n        rank = manifold.dim()**(k+l)\n        if (k, l) == (1, 0):\n            name = \"T{}\".format(manifold._name)\n        elif (k, l) == (0, 1):\n            name = \"T*{}\".format(manifold._name)\n        else:\n            name = \"T^({}{}){}\".format(k, l, manifold._name)\n        # similar code for latex_name\n        DifferentiableVectorBundle.__init__(self, rank, name, manifold, \n                                            diff_degree=manifold.diff_degree(),\n                                            latex_name=latex_name)\n        self._tensor_type = (k, l)\n\n    def section(self, *args, **kwargs):\n        if self.tensor_type == (1, 0):\n            return self._base_space.vector_field(*args, **kwargs)\n        return self._base_space.tensor_field(*(self._tensor_type + args), **kwargs)\n  \n    def fiber(self, point):\n        return self._base_space.tangent_space(point).tensor_module(*self._tensor_type)\n\n```",
    "created_at": "2019-07-21T19:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419705",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:16'></a>In addition, to make the link with preexisting code, one could redefine the method `fiber()` of `TensorBundle` to return the tangent space at the given point if `(k,l)==(1,0)` or the corresponding tensor product for other values of `(k,l)`:

```
class TensorBundle(DifferentiableVectorBundle):

    def __init__(self, manifold, k, l):
        rank = manifold.dim()**(k+l)
        if (k, l) == (1, 0):
            name = "T{}".format(manifold._name)
        elif (k, l) == (0, 1):
            name = "T*{}".format(manifold._name)
        else:
            name = "T^({}{}){}".format(k, l, manifold._name)
        # similar code for latex_name
        DifferentiableVectorBundle.__init__(self, rank, name, manifold, 
                                            diff_degree=manifold.diff_degree(),
                                            latex_name=latex_name)
        self._tensor_type = (k, l)

    def section(self, *args, **kwargs):
        if self.tensor_type == (1, 0):
            return self._base_space.vector_field(*args, **kwargs)
        return self._base_space.tensor_field(*(self._tensor_type + args), **kwargs)
  
    def fiber(self, point):
        return self._base_space.tangent_space(point).tensor_module(*self._tensor_type)

```



---

archive/issue_comments_419706.json:
```json
{
    "body": "<a id='comment:17'></a>Sounds like a very good compromise to me. I'll see what I can do. Thanks for your input!\n\nBut I feel not comfortable with inheriting from `DifferentiableManifold`. There are too many conflicts (`frame()`, `atlas()`, etc.). Maybe, having a `total_space()` method returning the corresponding manifold would be a better idea. What do you think?",
    "created_at": "2019-07-21T22:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419706",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:17'></a>Sounds like a very good compromise to me. I'll see what I can do. Thanks for your input!

But I feel not comfortable with inheriting from `DifferentiableManifold`. There are too many conflicts (`frame()`, `atlas()`, etc.). Maybe, having a `total_space()` method returning the corresponding manifold would be a better idea. What do you think?



---

archive/issue_comments_419707.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 gh-DeRhamSource]:\n> Sounds like a very good compromise to me. I'll see what I can do. Thanks for your input!\n> \n> But I feel not comfortable with inheriting from `DifferentiableManifold`. There are too many conflicts (`frame()`, `atlas()`, etc.). Maybe, having a `total_space()` method returning the corresponding manifold would be a better idea. What do you think?\n\n\nThis seems indeed a good idea. Also sounds closer to the mathematical definition of a vector bundle as a tuple `(E, M, pi)`, which distinguishes the bundle from its base space `E`.",
    "created_at": "2019-07-22T08:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419707",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'></a>Replying to [comment:17 gh-DeRhamSource]:
> Sounds like a very good compromise to me. I'll see what I can do. Thanks for your input!
> 
> But I feel not comfortable with inheriting from `DifferentiableManifold`. There are too many conflicts (`frame()`, `atlas()`, etc.). Maybe, having a `total_space()` method returning the corresponding manifold would be a better idea. What do you think?


This seems indeed a good idea. Also sounds closer to the mathematical definition of a vector bundle as a tuple `(E, M, pi)`, which distinguishes the bundle from its base space `E`.



---

archive/issue_comments_419708.json:
```json
{
    "body": "<a id='comment:19'></a>I need some help, again. I'm now trying to program local frames and sections and looked up how you managed it for vector fields. Maybe you can shortly explain how you did it? The code is pretty huge and spreaded. Especially, I'm interested in changes from one (coordinate) frame into another for different domains and the restriction process and display for tensor fields. Thanks! :)",
    "created_at": "2019-07-23T15:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419708",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:19'></a>I need some help, again. I'm now trying to program local frames and sections and looked up how you managed it for vector fields. Maybe you can shortly explain how you did it? The code is pretty huge and spreaded. Especially, I'm interested in changes from one (coordinate) frame into another for different domains and the restriction process and display for tensor fields. Thanks! :)



---

archive/issue_comments_419709.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 gh-DeRhamSource]:\n> I need some help, again. I'm now trying to program local frames and sections and looked up how you managed it for vector fields. Maybe you can shortly explain how you did it? The code is pretty huge and spreaded. Especially, I'm interested in changes from one (coordinate) frame into another for different domains and the restriction process and display for tensor fields. Thanks! :)\n\n\nYou can find some details of the implementation in [this article](http://ccirm.cedram.org/cedram-bin/article/CCIRM_2018__6_1_A1_0.pdf). Please tell me if this does not cover what you are looking for.",
    "created_at": "2019-07-23T21:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419709",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:20'></a>Replying to [comment:19 gh-DeRhamSource]:
> I need some help, again. I'm now trying to program local frames and sections and looked up how you managed it for vector fields. Maybe you can shortly explain how you did it? The code is pretty huge and spreaded. Especially, I'm interested in changes from one (coordinate) frame into another for different domains and the restriction process and display for tensor fields. Thanks! :)


You can find some details of the implementation in [this article](http://ccirm.cedram.org/cedram-bin/article/CCIRM_2018__6_1_A1_0.pdf). Please tell me if this does not cover what you are looking for.



---

archive/issue_comments_419710.json:
```json
{
    "body": "<a id='comment:21'></a>Thanks, that was very helpful.\n\nI think, one should do the following: Implement arbitrary tensor product sections on one particular vector bundle and apply and adapt the construction as it is done for tensor fields, and then derive tensor fields from this more general construction. Or even better: Implement tensor product sections of mixed vector bundles over the same base space (e.g. `\\Gamma(E \\otimes E^* \\otimes \\Lambda^k F)`).\n\nUnfortunately, I'm running out of time. Moreover, for this endeavour, you need to understand the whole code around tensor fields quite perfectly. I would implement just simple sections for now and apply the compromise we agreed on above. Maybe I can try this generalization after my thesis or one of you is willing to take the effort.\n\nHowever, simple sections seem enough for the beginning because it is possible to construct aforementioned sections by constructing the corresponding bundles and then defining simple sections on them. Still, imao, the way above is the most flexible and overall convenient.\n\nWhat do you think?",
    "created_at": "2019-07-26T15:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419710",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:21'></a>Thanks, that was very helpful.

I think, one should do the following: Implement arbitrary tensor product sections on one particular vector bundle and apply and adapt the construction as it is done for tensor fields, and then derive tensor fields from this more general construction. Or even better: Implement tensor product sections of mixed vector bundles over the same base space (e.g. `\Gamma(E \otimes E^* \otimes \Lambda^k F)`).

Unfortunately, I'm running out of time. Moreover, for this endeavour, you need to understand the whole code around tensor fields quite perfectly. I would implement just simple sections for now and apply the compromise we agreed on above. Maybe I can try this generalization after my thesis or one of you is willing to take the effort.

However, simple sections seem enough for the beginning because it is possible to construct aforementioned sections by constructing the corresponding bundles and then defining simple sections on them. Still, imao, the way above is the most flexible and overall convenient.

What do you think?



---

archive/issue_comments_419711.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 gh-DeRhamSource]:\n> I would implement just simple sections for now and apply the compromise we agreed on above. Maybe I can try this generalization after my thesis or one of you is willing to take the effort.\n> \n> However, simple sections seem enough for the beginning because it is possible to construct aforementioned sections by constructing the corresponding bundles and then defining simple sections on them. Still, imao, the way above is the most flexible and overall convenient.\n> \n> What do you think?\n\n\nSorry for the delay in replying. \nYes, implementing simple sections as a first stage seems the thing to do at the moment.",
    "created_at": "2019-07-31T08:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419711",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:22'></a>Replying to [comment:21 gh-DeRhamSource]:
> I would implement just simple sections for now and apply the compromise we agreed on above. Maybe I can try this generalization after my thesis or one of you is willing to take the effort.
> 
> However, simple sections seem enough for the beginning because it is possible to construct aforementioned sections by constructing the corresponding bundles and then defining simple sections on them. Still, imao, the way above is the most flexible and overall convenient.
> 
> What do you think?


Sorry for the delay in replying. 
Yes, implementing simple sections as a first stage seems the thing to do at the moment.



---

archive/issue_comments_419712.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-02T15:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419713.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-02T17:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419714.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-23T13:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419715.json:
```json
{
    "body": "<a id='comment:26'></a>The doctests take pretty much effort (especially for the section file). Maybe, I will not finish them on time. But for now, the code is mostly finished. Some things are still to do, but sections seem to work. Please take a look and write me if something is missing or should be done better.\n\nBest regards,\nMichael",
    "created_at": "2019-08-23T14:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419715",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:26'></a>The doctests take pretty much effort (especially for the section file). Maybe, I will not finish them on time. But for now, the code is mostly finished. Some things are still to do, but sections seem to work. Please take a look and write me if something is missing or should be done better.

Best regards,
Michael



---

archive/issue_comments_419716.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 gh-DeRhamSource]:\n> The doctests take pretty much effort (especially for the section file). Maybe, I will not finish them on time. But for now, the code is mostly finished. Some things are still to do, but sections seem to work. Please take a look and write me if something is missing or should be done better.\n> \n\n\nSorry for the delay in replying. I gave a look and it looks very good! Please go on.\n\nA few comments/questions:\n- you've deleted the dependency to #28189 while some source files modified in this ticket (those in `src/sage/matrix` and `src/sage/sets`) pertain to #28189\n- vector bundles have not been added to the reference manual yet; I guess you have to edit/add some files in `src/doc/en/reference/manifolds` and check that the documentation builds correcty with\n\n```\nsage -docbuild reference/manifolds html\n```\n- notice that the doctests that output a dictionary, like\n\n```\nsage: E.changes_of_frame()\n```\n  in line 105 of `trivialization.py`, must be marked `# random`\n- there is a typo in line 38 of `trivialization.py`:\n\n```\n    `(p, v) \\mapsto \\pi^{-1}(p)` is a linear isomorphism.  \n```\n  must be replaced by something like\n\n```\n    `(p, v) \\mapsto v` is a linear isomorphism from `\\pi^{-1}(p)` to `K^n`.\n```\n- another typo, in line 8 of `vector_bundle.py`: \n\n```\n- the set `E_p=\\pi^{-1}(x)` has the vector space structure of `K^n`,\n```\n  `x` has to be replaced by `p`.\n- the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?\n- shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)",
    "created_at": "2019-09-01T09:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419716",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:28'></a>Replying to [comment:26 gh-DeRhamSource]:
> The doctests take pretty much effort (especially for the section file). Maybe, I will not finish them on time. But for now, the code is mostly finished. Some things are still to do, but sections seem to work. Please take a look and write me if something is missing or should be done better.
> 


Sorry for the delay in replying. I gave a look and it looks very good! Please go on.

A few comments/questions:
- you've deleted the dependency to #28189 while some source files modified in this ticket (those in `src/sage/matrix` and `src/sage/sets`) pertain to #28189
- vector bundles have not been added to the reference manual yet; I guess you have to edit/add some files in `src/doc/en/reference/manifolds` and check that the documentation builds correcty with

```
sage -docbuild reference/manifolds html
```
- notice that the doctests that output a dictionary, like

```
sage: E.changes_of_frame()
```
  in line 105 of `trivialization.py`, must be marked `# random`
- there is a typo in line 38 of `trivialization.py`:

```
    `(p, v) \mapsto \pi^{-1}(p)` is a linear isomorphism.  
```
  must be replaced by something like

```
    `(p, v) \mapsto v` is a linear isomorphism from `\pi^{-1}(p)` to `K^n`.
```
- another typo, in line 8 of `vector_bundle.py`: 

```
- the set `E_p=\pi^{-1}(x)` has the vector space structure of `K^n`,
```
  `x` has to be replaced by `p`.
- the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
- shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)



---

archive/issue_comments_419717.json:
```json
{
    "body": "<a id='comment:30'></a>> \n> Sorry for the delay in replying. I gave a look and it looks very good! Please go on.\n\n>\n\\\\\nDon't worry. :)\n\\\\\\\\\n\n\n> A few comments/questions:\n> - you've deleted the dependency to #28189 while some source files modified in this ticket (those in `src/sage/matrix` and `src/sage/sets`) pertain to #28189\n\n\n\\\\\nAdded again.\n\\\\\\\\\n\n> - vector bundles have not been added to the reference manual yet; I guess you have to edit/add some files in `src/doc/en/reference/manifolds` and check that the documentation builds correcty with\n> \n> ```\n> sage -docbuild reference/manifolds html\n> ```\n\n\\\\\nComes later, when all the doc is finished. :)\n\\\\\\\\\n> - notice that the doctests that output a dictionary, like\n> \n> ```\n> sage: E.changes_of_frame()\n> ```\n>   in line 105 of `trivialization.py`, must be marked `# random`\n\n\\\\\nWhat do you mean?\n\\\\\\\\\n> - there is a typo in line 38 of `trivialization.py`:\n> \n> ```\n>     `(p, v) \\mapsto \\pi^{-1}(p)` is a linear isomorphism.  \n> ```\n>   must be replaced by something like\n> \n> ```\n>     `(p, v) \\mapsto v` is a linear isomorphism from `\\pi^{-1}(p)` to `K^n`.\n> ```\n> - another typo, in line 8 of `vector_bundle.py`: \n> \n> ```\n> - the set `E_p=\\pi^{-1}(x)` has the vector space structure of `K^n`,\n> ```\n>   `x` has to be replaced by `p`.\n\n\\\\\nCorrected. The projection compatibility was missing, too.\n\\\\\\\\\n\n> - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?\n \n\\\\\nI just borrowed the same code lines from manifold.py. I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.\n\\\\\\\\\n> - shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)\n \n\\\\\nFor now, yes. But later on, when the computation of the atlas is implemented, one should update the manifold's atlas, maybe using this method.\n\\\\\\\\\nBest, Michael",
    "created_at": "2019-09-07T13:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419717",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:30'></a>> 
> Sorry for the delay in replying. I gave a look and it looks very good! Please go on.

>
\\
Don't worry. :)
\\\\


> A few comments/questions:
> - you've deleted the dependency to #28189 while some source files modified in this ticket (those in `src/sage/matrix` and `src/sage/sets`) pertain to #28189


\\
Added again.
\\\\

> - vector bundles have not been added to the reference manual yet; I guess you have to edit/add some files in `src/doc/en/reference/manifolds` and check that the documentation builds correcty with
> 
> ```
> sage -docbuild reference/manifolds html
> ```

\\
Comes later, when all the doc is finished. :)
\\\\
> - notice that the doctests that output a dictionary, like
> 
> ```
> sage: E.changes_of_frame()
> ```
>   in line 105 of `trivialization.py`, must be marked `# random`

\\
What do you mean?
\\\\
> - there is a typo in line 38 of `trivialization.py`:
> 
> ```
>     `(p, v) \mapsto \pi^{-1}(p)` is a linear isomorphism.  
> ```
>   must be replaced by something like
> 
> ```
>     `(p, v) \mapsto v` is a linear isomorphism from `\pi^{-1}(p)` to `K^n`.
> ```
> - another typo, in line 8 of `vector_bundle.py`: 
> 
> ```
> - the set `E_p=\pi^{-1}(x)` has the vector space structure of `K^n`,
> ```
>   `x` has to be replaced by `p`.

\\
Corrected. The projection compatibility was missing, too.
\\\\

> - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
 
\\
I just borrowed the same code lines from manifold.py. I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.
\\\\
> - shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)
 
\\
For now, yes. But later on, when the computation of the atlas is implemented, one should update the manifold's atlas, maybe using this method.
\\\\
Best, Michael



---

archive/issue_comments_419718.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-08T09:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419719.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:30 gh-DeRhamSource]:\n> \n> Comes later, when all the doc is finished. :)\n\n\nI will ;-)\n\n>\n> > - notice that the doctests that output a dictionary, like\n> > {{{\n> > sage: E.changes_of_frame()\n> > }}}\n> >   in line 105 of `trivialization.py`, must be marked `# random`\n> \\\\\n> What do you mean?\n\n\nWhen printing a dictionary, the order of elements is random. For instance it depends on the computer. So a doctest that involves a directory output may fail on a different computer. The marker `# random` ensures that the doctest is skipped (see http://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests).\n\n\n\n> > - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?\n \n> \\\\\n> I just borrowed the same code lines from manifold.py. \n\n\nAh yes, you are right: that's already there for manifolds. \n\n>I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.\n\n\nYes this could be the reason. Travis, do remember why such a choice was made? \nOn the other side, things are not very consistent here, since `frames()` returns directly `self._frames` and we have the same for many other manifold methods. \n\n> > - shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)\n \n> \\\\\n> For now, yes. But later on, when the computation of the atlas is implemented, one should update the manifold's atlas, maybe using this method.\n\n\nOK, I see.",
    "created_at": "2019-09-08T20:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419719",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:32'></a>Replying to [comment:30 gh-DeRhamSource]:
> 
> Comes later, when all the doc is finished. :)


I will ;-)

>
> > - notice that the doctests that output a dictionary, like
> > {{{
> > sage: E.changes_of_frame()
> > }}}
> >   in line 105 of `trivialization.py`, must be marked `# random`
> \\
> What do you mean?


When printing a dictionary, the order of elements is random. For instance it depends on the computer. So a doctest that involves a directory output may fail on a different computer. The marker `# random` ensures that the doctest is skipped (see http://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests).



> > - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
 
> \\
> I just borrowed the same code lines from manifold.py. 


Ah yes, you are right: that's already there for manifolds. 

>I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.


Yes this could be the reason. Travis, do remember why such a choice was made? 
On the other side, things are not very consistent here, since `frames()` returns directly `self._frames` and we have the same for many other manifold methods. 

> > - shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)
 
> \\
> For now, yes. But later on, when the computation of the atlas is implemented, one should update the manifold's atlas, maybe using this method.


OK, I see.



---

archive/issue_comments_419720.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 egourgoulhon]:\n> Replying to [comment:30 gh-DeRhamSource]:\n> > > - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?\n \n> > \\\\\n> > I just borrowed the same code lines from manifold.py. \n\n> \n> Ah yes, you are right: that's already there for manifolds. \n> \n> >I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.\n\n> \n> Yes this could be the reason. Travis, do remember why such a choice was made? \n> On the other side, things are not very consistent here, since `frames()` returns directly `self._frames` and we have the same for many other manifold methods. \n\n\nProbably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.",
    "created_at": "2019-09-08T22:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419720",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>Replying to [comment:32 egourgoulhon]:
> Replying to [comment:30 gh-DeRhamSource]:
> > > - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
 
> > \\
> > I just borrowed the same code lines from manifold.py. 

> 
> Ah yes, you are right: that's already there for manifolds. 
> 
> >I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.

> 
> Yes this could be the reason. Travis, do remember why such a choice was made? 
> On the other side, things are not very consistent here, since `frames()` returns directly `self._frames` and we have the same for many other manifold methods. 


Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.



---

archive/issue_comments_419721.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 tscrim]:\n> \n> Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.\n\n\nMy concern here would be about efficiency. We might have quite often loops like \n\n```\nfor chart in M.atlas():\n    ...\n```\nThis implies that a list is created each time such a loop occurs. But maybe the CPU cost is negligible...",
    "created_at": "2019-09-09T20:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419721",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:34'></a>Replying to [comment:33 tscrim]:
> 
> Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.


My concern here would be about efficiency. We might have quite often loops like 

```
for chart in M.atlas():
    ...
```
This implies that a list is created each time such a loop occurs. But maybe the CPU cost is negligible...



---

archive/issue_comments_419722.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 egourgoulhon]:\n> Replying to [comment:33 tscrim]:\n> > \n> > Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.\n\n> \n> My concern here would be about efficiency. We might have quite often loops like \n> \n> ```\n> for chart in M.atlas():\n>     ...\n> ```\n> This implies that a list is created each time such a loop occurs. But maybe the CPU cost is negligible...\n\n\nThat would be my guess since so much time is spent in doing the computations of the manifold itself. (Python heavily optimizes list manipulations I think too.) Plus, since it is internal, it is much more okay to break encapsulation and just directly call the attribute when you know it is safe (or add a `copy` flag to the accessor methods).",
    "created_at": "2019-09-09T21:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419722",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>Replying to [comment:34 egourgoulhon]:
> Replying to [comment:33 tscrim]:
> > 
> > Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.

> 
> My concern here would be about efficiency. We might have quite often loops like 
> 
> ```
> for chart in M.atlas():
>     ...
> ```
> This implies that a list is created each time such a loop occurs. But maybe the CPU cost is negligible...


That would be my guess since so much time is spent in doing the computations of the manifold itself. (Python heavily optimizes list manipulations I think too.) Plus, since it is internal, it is much more okay to break encapsulation and just directly call the attribute when you know it is safe (or add a `copy` flag to the accessor methods).



---

archive/issue_comments_419723.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-16T12:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419724.json:
```json
{
    "body": "There was an issue with the restrictions of (vector) frames. Namely, the list of sub- and superframes was not complete and depended on some strange random order. Here is an example:\n\n```\nsage: M = Manifold(2, 'M')\nsage: U = M.open_subset('U'); V = M.open_subset('V'); W = U.intersection(V, name='W')\nsage: e = M.vector_frame('e')\nsage: eV = e.restrict(V); eU = e.restrict(U); eW = e.restrict(W)\nsage: eW._superframes\n{Vector frame (W, (e_0,e_1)),\n Vector frame (M, (e_0,e_1)),\n Vector frame (V, (e_0,e_1))}\nsage: eU._subframes\n{Vector frame (U, (e_0,e_1))}\nsage: eV._subframes\n{Vector frame (W, (e_0,e_1)), Vector frame (V, (e_0,e_1))}\n```\n\nI fixed it by avoiding any recursion and expanding the tree of subframes (and superframes) starting from the reference frame. Please check.",
    "created_at": "2019-09-16T13:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419724",
    "user": "https://github.com/DeRhamSource"
}
```

There was an issue with the restrictions of (vector) frames. Namely, the list of sub- and superframes was not complete and depended on some strange random order. Here is an example:

```
sage: M = Manifold(2, 'M')
sage: U = M.open_subset('U'); V = M.open_subset('V'); W = U.intersection(V, name='W')
sage: e = M.vector_frame('e')
sage: eV = e.restrict(V); eU = e.restrict(U); eW = e.restrict(W)
sage: eW._superframes
{Vector frame (W, (e_0,e_1)),
 Vector frame (M, (e_0,e_1)),
 Vector frame (V, (e_0,e_1))}
sage: eU._subframes
{Vector frame (U, (e_0,e_1))}
sage: eV._subframes
{Vector frame (W, (e_0,e_1)), Vector frame (V, (e_0,e_1))}
```

I fixed it by avoiding any recursion and expanding the tree of subframes (and superframes) starting from the reference frame. Please check.



---

archive/issue_comments_419725.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 gh-DeRhamSource]:\n> There was an issue with the restrictions of (vector) frames. Namely, the list of sub- and superframes was not complete and depended on some strange random order. \n\n>\n> I fixed it by avoiding any recursion and expanding the tree of subframes (and superframes) starting from the reference frame. Please check.\n\n\nLooks good to me. Thanks for the fix!",
    "created_at": "2019-09-18T20:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419725",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:38'></a>Replying to [comment:37 gh-DeRhamSource]:
> There was an issue with the restrictions of (vector) frames. Namely, the list of sub- and superframes was not complete and depended on some strange random order. 

>
> I fixed it by avoiding any recursion and expanding the tree of subframes (and superframes) starting from the reference frame. Please check.


Looks good to me. Thanks for the fix!



---

archive/issue_comments_419726.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-24T13:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419727.json:
```json
{
    "body": "<a id='comment:40'></a>I declared `ScalarFieldAlgebra` as a field so that matrix computations like inverses and determinants make no problems. When ticket #28189 is merged (hopefully in 9b0), this can be undone. But for now, this ticket does not depend on #28189 anymore.\n\nSince this solves some problems in the preexisting code, I removed the SR enforcement in `differentiable/automorphismfield.py` for more compatibility.\n\nDo you agree?",
    "created_at": "2019-09-24T13:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419727",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:40'></a>I declared `ScalarFieldAlgebra` as a field so that matrix computations like inverses and determinants make no problems. When ticket #28189 is merged (hopefully in 9b0), this can be undone. But for now, this ticket does not depend on #28189 anymore.

Since this solves some problems in the preexisting code, I removed the SR enforcement in `differentiable/automorphismfield.py` for more compatibility.

Do you agree?



---

archive/issue_comments_419728.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-24T19:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_419729.json:
```json
{
    "body": "<a id='comment:43'></a>A merge of #28189 for 9b0 seems imminent. Since this ticket will be merged earliest in 9b0, I added the dependencies again. Imao, it makes things easier and less complicated, especially for characteristic classes.\n\nI am sorry for potential inconveniences.",
    "created_at": "2019-09-24T19:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419729",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:43'></a>A merge of #28189 for 9b0 seems imminent. Since this ticket will be merged earliest in 9b0, I added the dependencies again. Imao, it makes things easier and less complicated, especially for characteristic classes.

I am sorry for potential inconveniences.



---

archive/issue_comments_419730.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- 'SR' enforcement for automorphism field inversion removed (due to ticket #28189)\n+- \n+\n+**Planned soon**\n+\n+- inheriting `VectorFrames from `LocalFrames`\n+- consistent use of preexisting vector frames in tensor bundles\n+- inheriting tangent spaces from vector bundle fibers?\n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products\n+- tensor products and Whitney sums of vector bundles\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-09-25T08:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419730",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,29 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- 'SR' enforcement for automorphism field inversion removed (due to ticket #28189)
+- 
+
+**Planned soon**
+
+- inheriting `VectorFrames from `LocalFrames`
+- consistent use of preexisting vector frames in tensor bundles
+- inheriting tangent spaces from vector bundle fibers?
+
+**Planned in the farther future**
+
+- sections of general tensor products
+- tensor products and Whitney sums of vector bundles
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419731.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- 'SR' enforcement for automorphism field inversion removed (due to ticket #28189)\n+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)\n+\n+**Planned soon**\n+\n+- inheriting `VectorFrames from `LocalFrames`\n+- consistent use of preexisting vector frames in tensor bundles\n+- inheriting tangent spaces from vector bundle fibers?\n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products\n+- tensor products and Whitney sums of vector bundles\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-09-25T08:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419731",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,29 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- 'SR' enforcement for automorphism field inversion removed (due to ticket #28189)
+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)
+
+**Planned soon**
+
+- inheriting `VectorFrames from `LocalFrames`
+- consistent use of preexisting vector frames in tensor bundles
+- inheriting tangent spaces from vector bundle fibers?
+
+**Planned in the farther future**
+
+- sections of general tensor products
+- tensor products and Whitney sums of vector bundles
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419732.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- 'SR' enforcement for automorphism field inversion removed (due to ticket #28189)\n+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)\n+\n+**Planned soon**\n+\n+- inheriting `VectorFrames` from `LocalFrames`\n+- consistent use of preexisting vector frames in tensor bundles\n+- inheriting tangent spaces from vector bundle fibers?\n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products\n+- tensor products and Whitney sums of vector bundles\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-09-25T08:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419732",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,29 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- 'SR' enforcement for automorphism field inversion removed (due to ticket #28189)
+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)
+
+**Planned soon**
+
+- inheriting `VectorFrames` from `LocalFrames`
+- consistent use of preexisting vector frames in tensor bundles
+- inheriting tangent spaces from vector bundle fibers?
+
+**Planned in the farther future**
+
+- sections of general tensor products
+- tensor products and Whitney sums of vector bundles
 
 Summary: vector_bundles
 
``````




---

archive/issue_events_069941.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-09-25T09:04:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28159#event-69941"
}
```



---

archive/issue_comments_419733.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- `SR` enforcement for automorphism field inversion removed (due to ticket #28189)\n+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)\n+\n+**Planned soon**\n+\n+- inheriting `VectorFrames` from `LocalFrames`\n+- derived from there: consistent use of preexisting vector frame implementation in tensor bundles as vector bundles\n+- inheriting tangent spaces from vector bundle fibers?\n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products\n+- tensor products and Whitney sums of vector bundles\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-09-25T09:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419733",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,29 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- `SR` enforcement for automorphism field inversion removed (due to ticket #28189)
+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)
+
+**Planned soon**
+
+- inheriting `VectorFrames` from `LocalFrames`
+- derived from there: consistent use of preexisting vector frame implementation in tensor bundles as vector bundles
+- inheriting tangent spaces from vector bundle fibers?
+
+**Planned in the farther future**
+
+- sections of general tensor products
+- tensor products and Whitney sums of vector bundles
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419734.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,30 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- `SR` enforcement for automorphism field inversion removed (due to ticket #28189)\n+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)\n+\n+**Planned soon**\n+\n+- inheriting `VectorFrames` from `LocalFrames`\n+- derived from there: consistent use of preexisting vector frame implementation in tensor bundles as vector bundles\n+- inheriting tangent spaces from vector bundle fibers?\n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products\n+- tensor products and Whitney sums of vector bundles\n+- return the total space with charts\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-09-25T09:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419734",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,30 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- `SR` enforcement for automorphism field inversion removed (due to ticket #28189)
+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)
+
+**Planned soon**
+
+- inheriting `VectorFrames` from `LocalFrames`
+- derived from there: consistent use of preexisting vector frame implementation in tensor bundles as vector bundles
+- inheriting tangent spaces from vector bundle fibers?
+
+**Planned in the farther future**
+
+- sections of general tensor products
+- tensor products and Whitney sums of vector bundles
+- return the total space with charts
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419735.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-25T14:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419736.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-04T14:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419737.json:
```json
{
    "body": "<a id='comment:52'></a>So, I guess, all pieces of the puzzles are fit together now. Please take a look, give me a feedback and tell me what is missing.\n\nI have some difficulties to interpret the docbuild errors. Can someone help? Is there a documentation?\n\nIt seems, we are almost done. :)",
    "created_at": "2019-10-04T14:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419737",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:52'></a>So, I guess, all pieces of the puzzles are fit together now. Please take a look, give me a feedback and tell me what is missing.

I have some difficulties to interpret the docbuild errors. Can someone help? Is there a documentation?

It seems, we are almost done. :)



---

archive/issue_comments_419738.json:
```json
{
    "body": "<a id='comment:53'></a>By the way: How should the authorship be handled? I copied most of the files and just adapted them. So, the other authors should be mentioned.",
    "created_at": "2019-10-04T14:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419738",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:53'></a>By the way: How should the authorship be handled? I copied most of the files and just adapted them. So, the other authors should be mentioned.



---

archive/issue_comments_419739.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,25 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+- differentiable vector bundles and tensor bundles\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- `SR` enforcement for automorphism field inversion removed (due to ticket #28189)\n+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)\n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products\n+- tensor products and Whitney sums of vector bundles\n+- return the total space with charts\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-10-04T15:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419739",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,25 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+- differentiable vector bundles and tensor bundles
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- `SR` enforcement for automorphism field inversion removed (due to ticket #28189)
+- `is_unit()` method implemented for scalar fields (to check whether a matrix with entries in the scalar field algebra is invertible)
+
+**Planned in the farther future**
+
+- sections of general tensor products
+- tensor products and Whitney sums of vector bundles
+- return the total space with charts
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419740.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-04T15:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419740",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419741.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-04T18:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419741",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_419742.json:
```json
{
    "body": "<a id='comment:57'></a>Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.\n\nAs for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.\n\nAre there things you can put as methods in the category of vector bundles? At least I think there should be an abstract method for the base space, and maybe also the projection map (i.e., things in this category should have a common way to give the defining properties).\n\nThis code doesn't do anything:\n\n```\n        if update_atlas:\n            # TODO: if self._atlas not empty, introduce charts\n            pass\n```\n\nI would change `Moebius` to `M\u00f6bius` in the documentation (also make sure to add the utf8 encoding `# -*- coding: utf-8 -*-` to the first line of such files).\n\n```diff\n-        desc = \"Module \"\n-        desc += self._name + \" \"\n-        desc += \"of sections \"\n-        desc += \"on the {} \".format(self._domain)\n-        desc += \"with values in the \" + self._vbundle.base_field_type() + \" \"\n-        desc += \"vector bundle \" + self._vbundle._name + \" \"\n-        desc += \"of rank {}\".format(self._vbundle.rank())\n+        desc = \"Module {} of sections on the {} with values in the {} vector bundle of rank {}\"\n+        desc = desc.format(self._name, self._domain, self._vbundle.base_field_type(), self._vbundle.rank())\n```\n\n```diff\n-Sets the default local frame on ``self``.\n+Set the default local frame on ``self``.\n```\n\nI will probably have more changes, but I don't have time right now to look in full detail.",
    "created_at": "2019-10-04T22:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419742",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:57'></a>Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.

As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.

Are there things you can put as methods in the category of vector bundles? At least I think there should be an abstract method for the base space, and maybe also the projection map (i.e., things in this category should have a common way to give the defining properties).

This code doesn't do anything:

```
        if update_atlas:
            # TODO: if self._atlas not empty, introduce charts
            pass
```

I would change `Moebius` to `Mbius` in the documentation (also make sure to add the utf8 encoding `# -*- coding: utf-8 -*-` to the first line of such files).

```diff
-        desc = "Module "
-        desc += self._name + " "
-        desc += "of sections "
-        desc += "on the {} ".format(self._domain)
-        desc += "with values in the " + self._vbundle.base_field_type() + " "
-        desc += "vector bundle " + self._vbundle._name + " "
-        desc += "of rank {}".format(self._vbundle.rank())
+        desc = "Module {} of sections on the {} with values in the {} vector bundle of rank {}"
+        desc = desc.format(self._name, self._domain, self._vbundle.base_field_type(), self._vbundle.rank())
```

```diff
-Sets the default local frame on ``self``.
+Set the default local frame on ``self``.
```

I will probably have more changes, but I don't have time right now to look in full detail.



---

archive/issue_comments_419743.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-05T09:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419743",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419744.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-05T09:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419744",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419745.json:
```json
{
    "body": "<a id='comment:60'></a>Thanks for your feedback!\n\nReplying to [comment:57 tscrim]:\n> Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.\n\n\nI guess, I have eliminated all doctest errors caused by these files. Please overlook this.\n\n> As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.\n\n\nDone. I kept Eric in the copyrights. Is that appropriate?\n\n> This code doesn't do anything:\n> \n> ```\n>         if update_atlas:\n>             # TODO: if self._atlas not empty, introduce charts\n>             pass\n> ```\n> \n> I would change `Moebius` to `M\u00f6bius` in the documentation (also make sure to add the utf8 encoding `# -*- coding: utf-8 -*-` to the first line of such files).\n> \n> \n> ```diff\n> -        desc = \"Module \"\n> -        desc += self._name + \" \"\n> -        desc += \"of sections \"\n> -        desc += \"on the {} \".format(self._domain)\n> -        desc += \"with values in the \" + self._vbundle.base_field_type() + \" \"\n> -        desc += \"vector bundle \" + self._vbundle._name + \" \"\n> -        desc += \"of rank {}\".format(self._vbundle.rank())\n> +        desc = \"Module {} of sections on the {} with values in the {} vector bundle of rank {}\"\n> +        desc = desc.format(self._name, self._domain, self._vbundle.base_field_type(), self._vbundle.rank())\n> ```\n> \n> \n> ```diff\n> -Sets the default local frame on ``self``.\n> +Set the default local frame on ``self``.\n> ```\n\n\nDone!\n\n> Are there things you can put as methods in the category of vector bundles? At least I think there should be an abstract method for the base space, and maybe also the projection map (i.e., things in this category should have a common way to give the defining properties).\n\n\nWhat do you mean? :/",
    "created_at": "2019-10-05T09:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419745",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:60'></a>Thanks for your feedback!

Replying to [comment:57 tscrim]:
> Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.


I guess, I have eliminated all doctest errors caused by these files. Please overlook this.

> As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.


Done. I kept Eric in the copyrights. Is that appropriate?

> This code doesn't do anything:
> 
> ```
>         if update_atlas:
>             # TODO: if self._atlas not empty, introduce charts
>             pass
> ```
> 
> I would change `Moebius` to `Mbius` in the documentation (also make sure to add the utf8 encoding `# -*- coding: utf-8 -*-` to the first line of such files).
> 
> 
> ```diff
> -        desc = "Module "
> -        desc += self._name + " "
> -        desc += "of sections "
> -        desc += "on the {} ".format(self._domain)
> -        desc += "with values in the " + self._vbundle.base_field_type() + " "
> -        desc += "vector bundle " + self._vbundle._name + " "
> -        desc += "of rank {}".format(self._vbundle.rank())
> +        desc = "Module {} of sections on the {} with values in the {} vector bundle of rank {}"
> +        desc = desc.format(self._name, self._domain, self._vbundle.base_field_type(), self._vbundle.rank())
> ```
> 
> 
> ```diff
> -Sets the default local frame on ``self``.
> +Set the default local frame on ``self``.
> ```


Done!

> Are there things you can put as methods in the category of vector bundles? At least I think there should be an abstract method for the base space, and maybe also the projection map (i.e., things in this category should have a common way to give the defining properties).


What do you mean? :/



---

archive/issue_comments_419746.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-05T10:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419747.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-05T10:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419748.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:60 gh-DeRhamSource]:\n> \n> Replying to [comment:57 tscrim]:\n> > Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.\n\n> \n> I guess, I have eliminated all doctest errors caused by these files. Please overlook this.\n> \n\n\nThanks for this painful work. It is true that sphinx messages are not very informative. In particular the line numbers do not refer to the start of the file but to the start of the docstring. For this reason, one should not hesitate to build the doc often, possibly after each modification of a doctring. For this, do not run `make doc`, which takes ages (*), use instead `sage -docbuild reference/manifolds html`.\n\n(*) hopefully there is a ticket about this (I don't remember which one at the moment).\n> > As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.\n\n> \n> Done. I kept Eric in the copyrights. Is that appropriate?\n\n\nI think you can remove my name from the copyright, leaving just yours. \n\nI'll have a look at the code soon.\n\n---\nNew commits:",
    "created_at": "2019-10-05T10:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419748",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:63'></a>Replying to [comment:60 gh-DeRhamSource]:
> 
> Replying to [comment:57 tscrim]:
> > Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.

> 
> I guess, I have eliminated all doctest errors caused by these files. Please overlook this.
> 


Thanks for this painful work. It is true that sphinx messages are not very informative. In particular the line numbers do not refer to the start of the file but to the start of the docstring. For this reason, one should not hesitate to build the doc often, possibly after each modification of a doctring. For this, do not run `make doc`, which takes ages (*), use instead `sage -docbuild reference/manifolds html`.

(*) hopefully there is a ticket about this (I don't remember which one at the moment).
> > As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.

> 
> Done. I kept Eric in the copyrights. Is that appropriate?


I think you can remove my name from the copyright, leaving just yours. 

I'll have a look at the code soon.

---
New commits:



---

archive/issue_comments_419749.json:
```json
{
    "body": "<a id='comment:64'></a>Thank you! I fixed pyflakes and coverage errors. I'm looking forward to your review! :)",
    "created_at": "2019-10-05T10:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419749",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:64'></a>Thank you! I fixed pyflakes and coverage errors. I'm looking forward to your review! :)



---

archive/issue_comments_419750.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-06T08:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419751.json:
```json
{
    "body": "<a id='comment:66'></a>Thanks for completing the documentation. \n\nWith python3 Sage 9.0.beta0, I've got the following errors:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 53.2 src/sage/categories/vector_bundles.py  # 2 doctests failed\nsage -t --long --warn-long 53.2 src/sage/manifolds/section.py  # 2 doctests failed\nsage -t --long --warn-long 53.2 src/sage/manifolds/chart_func.py  # 1 doctest failed\nsage -t --long --warn-long 53.2 src/sage/manifolds/section_module.py  # 10 doctests failed\nsage -t --long --warn-long 53.2 src/sage/manifolds/vector_bundle.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nThey appear on the patchbot report too.\n\nBesides, there is a warning when building the documentation:\n\n```\n[manifolds] <unknown>:1956: DeprecationWarning: invalid escape sequence \\c\n```",
    "created_at": "2019-10-07T13:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419751",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:66'></a>Thanks for completing the documentation. 

With python3 Sage 9.0.beta0, I've got the following errors:

```
----------------------------------------------------------------------
sage -t --long --warn-long 53.2 src/sage/categories/vector_bundles.py  # 2 doctests failed
sage -t --long --warn-long 53.2 src/sage/manifolds/section.py  # 2 doctests failed
sage -t --long --warn-long 53.2 src/sage/manifolds/chart_func.py  # 1 doctest failed
sage -t --long --warn-long 53.2 src/sage/manifolds/section_module.py  # 10 doctests failed
sage -t --long --warn-long 53.2 src/sage/manifolds/vector_bundle.py  # 1 doctest failed
----------------------------------------------------------------------
```
They appear on the patchbot report too.

Besides, there is a warning when building the documentation:

```
[manifolds] <unknown>:1956: DeprecationWarning: invalid escape sequence \c
```



---

archive/issue_comments_419752.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-07T13:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419752",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_419753.json:
```json
{
    "body": "<a id='comment:67'></a>There is also some wrong indentation in the docstring of class `TopologicalVectorBundle`, starting from line 85 of `src/sage/manifolds/vector_bundle.py`. This alters the output of the html documentation.",
    "created_at": "2019-10-07T14:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419753",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:67'></a>There is also some wrong indentation in the docstring of class `TopologicalVectorBundle`, starting from line 85 of `src/sage/manifolds/vector_bundle.py`. This alters the output of the html documentation.



---

archive/issue_comments_419754.json:
```json
{
    "body": "<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-07T14:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419755.json:
```json
{
    "body": "<a id='comment:69'></a>This should be fixed now.",
    "created_at": "2019-10-07T14:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419755",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:69'></a>This should be fixed now.



---

archive/issue_comments_419756.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-07T14:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419756",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419757.json:
```json
{
    "body": "<a id='comment:71'></a>The error in `src/sage/manifolds/chart_func.py` should not belong to this ticket. I fixed it anyway.",
    "created_at": "2019-10-07T14:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419757",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:71'></a>The error in `src/sage/manifolds/chart_func.py` should not belong to this ticket. I fixed it anyway.



---

archive/issue_comments_419758.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:71 gh-DeRhamSource]:\n> The error in `src/sage/manifolds/chart_func.py` should not belong to this ticket.\n\n\nYes it does: there is no such error in Sage 9.0.beta0. \nAnyway, thanks for the fixes.",
    "created_at": "2019-10-07T14:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419758",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:72'></a>Replying to [comment:71 gh-DeRhamSource]:
> The error in `src/sage/manifolds/chart_func.py` should not belong to this ticket.


Yes it does: there is no such error in Sage 9.0.beta0. 
Anyway, thanks for the fixes.



---

archive/issue_comments_419759.json:
```json
{
    "body": "<a id='comment:73'></a>I still get some errors:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 54.2 src/sage/manifolds/section.py  # 1 doctest failed\nsage -t --long --warn-long 54.2 src/sage/manifolds/chart_func.py  # 2 doctests failed\nsage -t --long --warn-long 54.2 src/sage/manifolds/vector_bundle.py  # 1 doctest failed\nsage -t --long --warn-long 54.2 src/sage/manifolds/section_module.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2019-10-09T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419759",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:73'></a>I still get some errors:

```
----------------------------------------------------------------------
sage -t --long --warn-long 54.2 src/sage/manifolds/section.py  # 1 doctest failed
sage -t --long --warn-long 54.2 src/sage/manifolds/chart_func.py  # 2 doctests failed
sage -t --long --warn-long 54.2 src/sage/manifolds/vector_bundle.py  # 1 doctest failed
sage -t --long --warn-long 54.2 src/sage/manifolds/section_module.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_419760.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-09T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419760",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_419761.json:
```json
{
    "body": "<a id='comment:74'></a>That's pretty strange:\n- For `section.py` I get no errors. What is your error message?\n- The two `chart_func.py` errors are not related to this ticket. However, it seems a `#random` mark is needed here.\n\nThe other issues get fixed soon. I'll change the status.",
    "created_at": "2019-10-09T09:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419761",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:74'></a>That's pretty strange:
- For `section.py` I get no errors. What is your error message?
- The two `chart_func.py` errors are not related to this ticket. However, it seems a `#random` mark is needed here.

The other issues get fixed soon. I'll change the status.



---

archive/issue_comments_419762.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-09T09:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419763.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-09T09:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419763",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419764.json:
```json
{
    "body": "<a id='comment:77'></a>Replying to [comment:74 gh-DeRhamSource]:\n> That's pretty strange:\n> - For `section.py` I get no errors. What is your error message?\n\n\nHere it is:\n\n```\nsage -t --long src/sage/manifolds/section.py\n**********************************************************************\nFile \"src/sage/manifolds/section.py\", line 305, in sage.manifolds.section.Section._latex_\nFailed example:\n    omega = E.section(name='\\omega')\nExpected nothing\nGot:\n    doctest:warning\n...\n    DeprecationWarning: invalid escape sequence \\o\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.manifolds.section.Section._latex_\n    [735 tests, 1 failure, 29.78 s]\n```\nThis is because the raw string marker `r` is missing in front of `'\\omega'`: the line 305 should read\n\n```\n   sage: omega = E.section(name=r'\\omega')\n```\nProbably the reason why you don't get this error is that you are using Python 2 version of Sage, which is less strict in this respect (however, this is still an error, since the LaTeX output will not be correct). On general ground, I would advise you to use Python 3 version of Sage for development, since Sage 9.0 will be Python 3 based. Installing Python 3 Sage is pretty easy:\n\n```\ngit clone https://github.com/sagemath/sage.git\ncd sage\ngit checkout develop\ngit pull\nmake configure\n./configure --with-python=3\nMAKE=\"make -j8\" make\n```",
    "created_at": "2019-10-09T12:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419764",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:77'></a>Replying to [comment:74 gh-DeRhamSource]:
> That's pretty strange:
> - For `section.py` I get no errors. What is your error message?


Here it is:

```
sage -t --long src/sage/manifolds/section.py
**********************************************************************
File "src/sage/manifolds/section.py", line 305, in sage.manifolds.section.Section._latex_
Failed example:
    omega = E.section(name='\omega')
Expected nothing
Got:
    doctest:warning
...
    DeprecationWarning: invalid escape sequence \o
**********************************************************************
1 item had failures:
   1 of   6 in sage.manifolds.section.Section._latex_
    [735 tests, 1 failure, 29.78 s]
```
This is because the raw string marker `r` is missing in front of `'\omega'`: the line 305 should read

```
   sage: omega = E.section(name=r'\omega')
```
Probably the reason why you don't get this error is that you are using Python 2 version of Sage, which is less strict in this respect (however, this is still an error, since the LaTeX output will not be correct). On general ground, I would advise you to use Python 3 version of Sage for development, since Sage 9.0 will be Python 3 based. Installing Python 3 Sage is pretty easy:

```
git clone https://github.com/sagemath/sage.git
cd sage
git checkout develop
git pull
make configure
./configure --with-python=3
MAKE="make -j8" make
```



---

archive/issue_comments_419765.json:
```json
{
    "body": "<a id='comment:78'></a>Oh yeah, thank you! :) I am going to try a new test run after the python3 compilation. Till then, I keep this ticket on *needs_work*.",
    "created_at": "2019-10-09T12:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419765",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:78'></a>Oh yeah, thank you! :) I am going to try a new test run after the python3 compilation. Till then, I keep this ticket on *needs_work*.



---

archive/issue_comments_419766.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-09T12:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419766",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_419767.json:
```json
{
    "body": "<a id='comment:79'></a>Replying to [comment:78 gh-DeRhamSource]:\n> Oh yeah, thank you! :) I am going to try a new test run after the python3 compilation. Till then, I keep this ticket on *needs_work*.\n\n\nOK. On my (Python 3) side, the doctest error in `section.py` is the last remaining one. However, there are various errors in the html output of the documentation. For instance, in the section \"Trivializations\", some links are wrong (class names not clickable or expressions as `:class:`sage.manifolds.chart_func.ChartFunction` appearing in the output) and some `::` are missing before doctest blocs. Could you please fix those?",
    "created_at": "2019-10-09T12:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419767",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:79'></a>Replying to [comment:78 gh-DeRhamSource]:
> Oh yeah, thank you! :) I am going to try a new test run after the python3 compilation. Till then, I keep this ticket on *needs_work*.


OK. On my (Python 3) side, the doctest error in `section.py` is the last remaining one. However, there are various errors in the html output of the documentation. For instance, in the section "Trivializations", some links are wrong (class names not clickable or expressions as `:class:`sage.manifolds.chart_func.ChartFunction` appearing in the output) and some `::` are missing before doctest blocs. Could you please fix those?



---

archive/issue_comments_419768.json:
```json
{
    "body": "<a id='comment:80'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-09T19:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:80'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419769.json:
```json
{
    "body": "<a id='comment:81'></a>Changed. Can you please check the docbuild for me?",
    "created_at": "2019-10-10T11:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419769",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:81'></a>Changed. Can you please check the docbuild for me?



---

archive/issue_comments_419770.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-10T11:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419770",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419771.json:
```json
{
    "body": "<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-10T15:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419772.json:
```json
{
    "body": "<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-10-10T15:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_419773.json:
```json
{
    "body": "<a id='comment:84'></a>New commits:",
    "created_at": "2019-10-12T21:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419773",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:84'></a>New commits:



---

archive/issue_comments_419774.json:
```json
{
    "body": "<a id='comment:85'></a>I've gone through the documentation and have introduced some fixes in the above commit (comment:84).\nIn particular, I've added an entry point for the category of vector bundles, as well as for fibers and fiber elements. I've also fixed hyperlinks, quote issues, missing `::` and the invalid escape sequence mentioned in comment:66. You can see the full list of changes [here](https://git.sagemath.org/sage.git/commit?id=12a86a4feef85048f97383363fd004f8d1961c44). Do you agree with them?",
    "created_at": "2019-10-12T21:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419774",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:85'></a>I've gone through the documentation and have introduced some fixes in the above commit (comment:84).
In particular, I've added an entry point for the category of vector bundles, as well as for fibers and fiber elements. I've also fixed hyperlinks, quote issues, missing `::` and the invalid escape sequence mentioned in comment:66. You can see the full list of changes [here](https://git.sagemath.org/sage.git/commit?id=12a86a4feef85048f97383363fd004f8d1961c44). Do you agree with them?



---

archive/issue_comments_419775.json:
```json
{
    "body": "<a id='comment:86'></a>Thank you so much for overlooking my code and your effort! There was still quite a lot to do.\n\nThere's just one thing in `differentiable/vector_bundle.py` around line 389 in the class `TensorBundle`:\n\n\"OUPUT\" -> \"OUTPUT\"\n\nApart from that, I agree. :)",
    "created_at": "2019-10-12T22:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419775",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:86'></a>Thank you so much for overlooking my code and your effort! There was still quite a lot to do.

There's just one thing in `differentiable/vector_bundle.py` around line 389 in the class `TensorBundle`:

"OUPUT" -> "OUTPUT"

Apart from that, I agree. :)



---

archive/issue_comments_419776.json:
```json
{
    "body": "<a id='comment:87'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-13T15:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:87'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419777.json:
```json
{
    "body": "<a id='comment:88'></a>Replying to [comment:86 gh-DeRhamSource]:\n \n> There's just one thing in `differentiable/vector_bundle.py` around line 389 in the class `TensorBundle`:\n> \n> \"OUPUT\" -> \"OUTPUT\"\n> \n\nCorrected in the above commit.\nI've also introduced minor changes to improve the documentation (I hope). \n\nI have also performed some changes in the code, replacing `self._dest_map` by `self._dest_map.restrict(domain)` in `DifferentiableVectorBundle.section()` and `DifferentiableVectorBundle.local_frame()`. Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?\n\nI have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.",
    "created_at": "2019-10-13T15:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419777",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:88'></a>Replying to [comment:86 gh-DeRhamSource]:
 
> There's just one thing in `differentiable/vector_bundle.py` around line 389 in the class `TensorBundle`:
> 
> "OUPUT" -> "OUTPUT"
> 

Corrected in the above commit.
I've also introduced minor changes to improve the documentation (I hope). 

I have also performed some changes in the code, replacing `self._dest_map` by `self._dest_map.restrict(domain)` in `DifferentiableVectorBundle.section()` and `DifferentiableVectorBundle.local_frame()`. Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?

I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.



---

archive/issue_comments_419778.json:
```json
{
    "body": "<a id='comment:89'></a>Replying to [comment:88 egourgoulhon]:\n> I have also performed some changes in the code, replacing `self._dest_map` by `self._dest_map.restrict(domain)` in `DifferentiableVectorBundle.section()` and `DifferentiableVectorBundle.local_frame()`.\n\n\nThank you! :)\n\n> Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?\n\n\nIn this case, I do not agree. Altough actual frames of general tensor bundles are not implemented, vector frames *induce* them canonically. In the whole preexisting code, a vector frame is used for declaration and output of tensor fields. So, in my opinion, we should keep it this way (at least until general tensor product bundles are implemented). However, a corresponding remark in the documentation might be a good idea.\n\n> I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.\n\n\nThe class `TopologicalVectorBundle` consists of these methods and `TensorBundle` inherits from it, so it must carry out these methods as well. But since all its features are already regulated through the manifold's framework (tensor bundles are induced by differentiable charts and their transitions), the vector bundle implementation is obsolete in this case and the methods must be overwritten. Likewise, a remark in the documentation might be useful, here. Do you have a better solution in mind?\n\n**Another thing:** In a next step, I want to inherit `TensorField` from `Section` (and perhaps `VectorFrame` from `LocalFrame`) in order to minimize code redundancies. Keeping in mind, when my modifications in #28519 are finished, `Section` and `TrivialSection` should be adapted anyways.",
    "created_at": "2019-10-13T16:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419778",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:89'></a>Replying to [comment:88 egourgoulhon]:
> I have also performed some changes in the code, replacing `self._dest_map` by `self._dest_map.restrict(domain)` in `DifferentiableVectorBundle.section()` and `DifferentiableVectorBundle.local_frame()`.


Thank you! :)

> Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?


In this case, I do not agree. Altough actual frames of general tensor bundles are not implemented, vector frames *induce* them canonically. In the whole preexisting code, a vector frame is used for declaration and output of tensor fields. So, in my opinion, we should keep it this way (at least until general tensor product bundles are implemented). However, a corresponding remark in the documentation might be a good idea.

> I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.


The class `TopologicalVectorBundle` consists of these methods and `TensorBundle` inherits from it, so it must carry out these methods as well. But since all its features are already regulated through the manifold's framework (tensor bundles are induced by differentiable charts and their transitions), the vector bundle implementation is obsolete in this case and the methods must be overwritten. Likewise, a remark in the documentation might be useful, here. Do you have a better solution in mind?

**Another thing:** In a next step, I want to inherit `TensorField` from `Section` (and perhaps `VectorFrame` from `LocalFrame`) in order to minimize code redundancies. Keeping in mind, when my modifications in #28519 are finished, `Section` and `TrivialSection` should be adapted anyways.



---

archive/issue_comments_419779.json:
```json
{
    "body": "<a id='comment:90'></a>Replying to [comment:89 gh-DeRhamSource]:\n> \n> > Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?\n\n> \n> In this case, I do not agree. Altough actual frames of general tensor bundles are not implemented, vector frames *induce* them canonically. In the whole preexisting code, a vector frame is used for declaration and output of tensor fields. So, in my opinion, we should keep it this way (at least until general tensor product bundles are implemented). \n\n\nOK, I see.\n\n>However, a corresponding remark in the documentation might be a good idea.\n\n\nYes, there should be a warning that the returned object is actually not a bundle local frame, although it canonically determines it, as you say. The same thing holds for the method `trivialization()`, which returns a chart on the base manifold and actually not a trivialization in the sense of a vector bundle.\n\n> \n> > I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.\n\n> \n> The class `TopologicalVectorBundle` consists of these methods and `TensorBundle` inherits from it, so it must carry out these methods as well. But since all its features are already regulated through the manifold's framework (tensor bundles are induced by differentiable charts and their transitions), the vector bundle implementation is obsolete in this case and the methods must be overwritten. \n\n\nOK.\n\n> Likewise, a remark in the documentation might be useful, here. \n\n\nIndeed.\n\n>Do you have a better solution in mind?\n> \n\n\nNot at the moment.\n\nI let you revert the `NotImplementedError` and add the relevent warnings.\n\n> **Another thing:** In a next step, I want to inherit `TensorField` from `Section` (and perhaps `VectorFrame` from `LocalFrame`) in order to minimize code redundancies.\n\n\nYes, I guess by \"next step\", you mean \"in another ticket\".",
    "created_at": "2019-10-13T18:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419779",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:90'></a>Replying to [comment:89 gh-DeRhamSource]:
> 
> > Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?

> 
> In this case, I do not agree. Altough actual frames of general tensor bundles are not implemented, vector frames *induce* them canonically. In the whole preexisting code, a vector frame is used for declaration and output of tensor fields. So, in my opinion, we should keep it this way (at least until general tensor product bundles are implemented). 


OK, I see.

>However, a corresponding remark in the documentation might be a good idea.


Yes, there should be a warning that the returned object is actually not a bundle local frame, although it canonically determines it, as you say. The same thing holds for the method `trivialization()`, which returns a chart on the base manifold and actually not a trivialization in the sense of a vector bundle.

> 
> > I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.

> 
> The class `TopologicalVectorBundle` consists of these methods and `TensorBundle` inherits from it, so it must carry out these methods as well. But since all its features are already regulated through the manifold's framework (tensor bundles are induced by differentiable charts and their transitions), the vector bundle implementation is obsolete in this case and the methods must be overwritten. 


OK.

> Likewise, a remark in the documentation might be useful, here. 


Indeed.

>Do you have a better solution in mind?
> 


Not at the moment.

I let you revert the `NotImplementedError` and add the relevent warnings.

> **Another thing:** In a next step, I want to inherit `TensorField` from `Section` (and perhaps `VectorFrame` from `LocalFrame`) in order to minimize code redundancies.


Yes, I guess by "next step", you mean "in another ticket".



---

archive/issue_comments_419780.json:
```json
{
    "body": "<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-13T22:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419780",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419781.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:90 egourgoulhon]:\n> I let you revert the `NotImplementedError` and add the relevent warnings.\n\n\nDone.\n\nWould you take a short look for typos etc?\n\nAlso, I've changed the name of the base space in the documentation of `TensorBundle` to `N` instead of `U`.\n\nDo you agree so far? Any more suggestions?\n\n> Yes, I guess by \"next step\", you mean \"in another ticket\".\n\n\nOf course. :)",
    "created_at": "2019-10-13T22:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419781",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:92'></a>Replying to [comment:90 egourgoulhon]:
> I let you revert the `NotImplementedError` and add the relevent warnings.


Done.

Would you take a short look for typos etc?

Also, I've changed the name of the base space in the documentation of `TensorBundle` to `N` instead of `U`.

Do you agree so far? Any more suggestions?

> Yes, I guess by "next step", you mean "in another ticket".


Of course. :)



---

archive/issue_comments_419782.json:
```json
{
    "body": "<a id='comment:93'></a>Ah, I've also fixed the filter algorithms for the frames. (Unfortunately, I missed it in the commit message.)",
    "created_at": "2019-10-13T22:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419782",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:93'></a>Ah, I've also fixed the filter algorithms for the frames. (Unfortunately, I missed it in the commit message.)



---

archive/issue_comments_419783.json:
```json
{
    "body": "<a id='comment:94'></a>There are some more things I noticed. I'm going to take of it later this day.",
    "created_at": "2019-10-14T07:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419783",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:94'></a>There are some more things I noticed. I'm going to take of it later this day.



---

archive/issue_comments_419784.json:
```json
{
    "body": "<a id='comment:95'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-14T09:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:95'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419785.json:
```json
{
    "body": "<a id='comment:96'></a>Please take a look. I made many modifications and fixes in the documentation.",
    "created_at": "2019-10-14T09:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419785",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:96'></a>Please take a look. I made many modifications and fixes in the documentation.



---

archive/issue_comments_419786.json:
```json
{
    "body": "<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-14T11:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419787.json:
```json
{
    "body": "<a id='comment:98'></a>Replying to [comment:96 gh-DeRhamSource]:\n> Please take a look. I made many modifications and fixes in the documentation.\n\n\nThanks for the improvements in the documentation!\nI've just pushed a minor fix in some `:meth:` hyperlink. \nI think the ticket is ready to go.",
    "created_at": "2019-10-14T11:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419787",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:98'></a>Replying to [comment:96 gh-DeRhamSource]:
> Please take a look. I made many modifications and fixes in the documentation.


Thanks for the improvements in the documentation!
I've just pushed a minor fix in some `:meth:` hyperlink. 
I think the ticket is ready to go.



---

archive/issue_comments_419788.json:
```json
{
    "body": "<a id='comment:99'></a>Just wait a moment. I have still some fixes, coming soon.",
    "created_at": "2019-10-14T12:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419788",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:99'></a>Just wait a moment. I have still some fixes, coming soon.



---

archive/issue_comments_419789.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-14T13:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419790.json:
```json
{
    "body": "<a id='comment:1'></a>There we go. I had a short discussion with a collegue of mine in which I noticed some more things. But that should be it. Please take a short look.",
    "created_at": "2019-10-14T13:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419790",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:1'></a>There we go. I had a short discussion with a collegue of mine in which I noticed some more things. But that should be it. Please take a short look.



---

archive/issue_comments_419791.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-14T13:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419792.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-14T19:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419792",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_419793.json:
```json
{
    "body": "<a id='comment:3'></a>I've just discovered that, with this ticket branch, the [AdS notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_anti_de_Sitter.ipynb) stalls at cell 92, which introduces the transition map from conformal coordinates to Poincar\u00e9 coordinates. Running the notebook with Sage 9.0.beta1 shows no problem. So the issue is caused by some piece of code in this ticket. \n\nCell 92 seems to run forever, or at least to take a very long time. After 15 min or so, I halted it by Kernel -> Interrupt in the Jupyter menu. It appeared then that the code was stalled in line 1147 of `src/sage/manifolds/differentiable/chart.py`:\n\n```\n   ch_basis_inv = ch_basis.inverse()\n```\nSo I strongly suspect the issue to be due to the change in the computation of inverse automorphism fields introduced in this ticket.",
    "created_at": "2019-10-14T19:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419793",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>I've just discovered that, with this ticket branch, the [AdS notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_anti_de_Sitter.ipynb) stalls at cell 92, which introduces the transition map from conformal coordinates to Poincar coordinates. Running the notebook with Sage 9.0.beta1 shows no problem. So the issue is caused by some piece of code in this ticket. 

Cell 92 seems to run forever, or at least to take a very long time. After 15 min or so, I halted it by Kernel -> Interrupt in the Jupyter menu. It appeared then that the code was stalled in line 1147 of `src/sage/manifolds/differentiable/chart.py`:

```
   ch_basis_inv = ch_basis.inverse()
```
So I strongly suspect the issue to be due to the change in the computation of inverse automorphism fields introduced in this ticket.



---

archive/issue_comments_419794.json:
```json
{
    "body": "<a id='comment:4'></a>This could be related to #28189, especially to the bug reported afterwards which has been partially fixed in #28570 (was this particular ticket merged in your testing?).\n\nIf there are no other options left, we can readd the SR enforcement for now. However, I suggest to construct a minimal example where this particular issue fails and report the error, since it seems to be a bigger problem deep in framework of matrices.",
    "created_at": "2019-10-14T20:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419794",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:4'></a>This could be related to #28189, especially to the bug reported afterwards which has been partially fixed in #28570 (was this particular ticket merged in your testing?).

If there are no other options left, we can readd the SR enforcement for now. However, I suggest to construct a minimal example where this particular issue fails and report the error, since it seems to be a bigger problem deep in framework of matrices.



---

archive/issue_comments_419795.json:
```json
{
    "body": "<a id='comment:5'></a>Wait. Why does the program compute the inverse anyway? This should not happen automatically, right? At least, in the next cell the inverse is set manually.",
    "created_at": "2019-10-14T20:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419795",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:5'></a>Wait. Why does the program compute the inverse anyway? This should not happen automatically, right? At least, in the next cell the inverse is set manually.



---

archive/issue_comments_419796.json:
```json
{
    "body": "<a id='comment:106'></a>Replying to [comment:105 gh-DeRhamSource]:\n> Wait. Why does the program compute the inverse anyway? This should not happen automatically, right? At least, in the next cell the inverse is set manually.\n  \nIt computes the inverse of the Jacobian matrix, not the inverse of the transition map.",
    "created_at": "2019-10-14T20:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419796",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:106'></a>Replying to [comment:105 gh-DeRhamSource]:
> Wait. Why does the program compute the inverse anyway? This should not happen automatically, right? At least, in the next cell the inverse is set manually.
  
It computes the inverse of the Jacobian matrix, not the inverse of the transition map.



---

archive/issue_comments_419797.json:
```json
{
    "body": "<a id='comment:7'></a>Okay, I started some debugging process. And apparently, this has nothing to do with the aforementioned issue.\n\nSince the algebra of scalar fields is not a field, the inversion algorithm is division free using adjugate matrices. I guess, this takes much more time than sophisticated algorithms on fields. My suggestion is to claim (at least for sage) that this algebra is a field (like it is done for the symbolic ring). I already started some testing and the computation time shrunk enormously. I've committed the changes.",
    "created_at": "2019-10-15T09:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419797",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:7'></a>Okay, I started some debugging process. And apparently, this has nothing to do with the aforementioned issue.

Since the algebra of scalar fields is not a field, the inversion algorithm is division free using adjugate matrices. I guess, this takes much more time than sophisticated algorithms on fields. My suggestion is to claim (at least for sage) that this algebra is a field (like it is done for the symbolic ring). I already started some testing and the computation time shrunk enormously. I've committed the changes.



---

archive/issue_comments_419798.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-15T09:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419799.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-15T10:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419799",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419800.json:
```json
{
    "body": "<a id='comment:0'></a>Just to tell that I am mostly AFK these days. I'll have a look at the ticket on Friday.",
    "created_at": "2019-10-16T10:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419800",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:0'></a>Just to tell that I am mostly AFK these days. I'll have a look at the ticket on Friday.



---

archive/issue_comments_419801.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-18T14:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419801",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_419802.json:
```json
{
    "body": "<a id='comment:1'></a>I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). \n\nI would propose that you revert to the original version of `AutomorphismFieldParal.__invert__()` and open a new ticket to discus the removal of `SR` enforcement in the inversion of automorphism fields. After all, this is not directly connected to vector bundles and therefore does not belong to the current ticket.",
    "created_at": "2019-10-18T14:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419802",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). 

I would propose that you revert to the original version of `AutomorphismFieldParal.__invert__()` and open a new ticket to discus the removal of `SR` enforcement in the inversion of automorphism fields. After all, this is not directly connected to vector bundles and therefore does not belong to the current ticket.



---

archive/issue_comments_419803.json:
```json
{
    "body": "<a id='comment:112'></a>Replying to [comment:111 egourgoulhon]:\n> I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). \n\n\nYeah, I feel not comfortable with this solution as well.\n\n> I would propose that you revert to the original version of `AutomorphismFieldParal.__invert__()` and open a new ticket to discus the removal of `SR` enforcement in the inversion of automorphism fields. After all, this is not directly connected to vector bundles and therefore does not belong to the current ticket. \n\n\nThis is not entirely true. If the vector bundle is similarly complicated as the example in the notebook, it runs into the same problem.\n\nHowever, forcing sage to use the inversion algorithm for fields would be very nice!\n\nI will open a ticket on that and suggest this in the sage-devel group. Meanwhile, I undo the SR enforcement at least for tensor fields.",
    "created_at": "2019-10-18T15:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419803",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:112'></a>Replying to [comment:111 egourgoulhon]:
> I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). 


Yeah, I feel not comfortable with this solution as well.

> I would propose that you revert to the original version of `AutomorphismFieldParal.__invert__()` and open a new ticket to discus the removal of `SR` enforcement in the inversion of automorphism fields. After all, this is not directly connected to vector bundles and therefore does not belong to the current ticket. 


This is not entirely true. If the vector bundle is similarly complicated as the example in the notebook, it runs into the same problem.

However, forcing sage to use the inversion algorithm for fields would be very nice!

I will open a ticket on that and suggest this in the sage-devel group. Meanwhile, I undo the SR enforcement at least for tensor fields.



---

archive/issue_comments_419804.json:
```json
{
    "body": "<a id='comment:113'></a>Replying to [comment:112 gh-DeRhamSource]:\n> Replying to [comment:111 egourgoulhon]:\n> > I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). \n\n> \n> Yeah, I feel not comfortable with this solution as well.\n> \n\n\nBesides, it generated a lot of doctest errors as you can check in the patchbot report. \n\n> \n> I will open a ticket on that and suggest this in the sage-devel group. Meanwhile, I undo the SR enforcement at least for tensor fields.\n\n\nOK, very good.",
    "created_at": "2019-10-18T15:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419804",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:113'></a>Replying to [comment:112 gh-DeRhamSource]:
> Replying to [comment:111 egourgoulhon]:
> > I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). 

> 
> Yeah, I feel not comfortable with this solution as well.
> 


Besides, it generated a lot of doctest errors as you can check in the patchbot report. 

> 
> I will open a ticket on that and suggest this in the sage-devel group. Meanwhile, I undo the SR enforcement at least for tensor fields.


OK, very good.



---

archive/issue_comments_419805.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-18T15:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419806.json:
```json
{
    "body": "<a id='comment:5'></a>Committed. Please check, again.",
    "created_at": "2019-10-18T15:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419806",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:5'></a>Committed. Please check, again.



---

archive/issue_comments_419807.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-18T16:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419807",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419808.json:
```json
{
    "body": "<a id='comment:7'></a>Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). \n\nSide note: `self.is_zero()`, as invoked in `ChartFunction.is_unit()`, can be very time consuming for large symbolic expressions, since it is trying to simplify the expression to zero. In this respect, the use of `is_trivial_zero()` in `ScalarField.is_unit()` is better.",
    "created_at": "2019-10-18T20:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419808",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). 

Side note: `self.is_zero()`, as invoked in `ChartFunction.is_unit()`, can be very time consuming for large symbolic expressions, since it is trying to simplify the expression to zero. In this respect, the use of `is_trivial_zero()` in `ScalarField.is_unit()` is better.



---

archive/issue_comments_419809.json:
```json
{
    "body": "<a id='comment:8'></a>Btw, thanks for having moved the treatment of autormorphism field inverses to #28629.",
    "created_at": "2019-10-18T20:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419809",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:8'></a>Btw, thanks for having moved the treatment of autormorphism field inverses to #28629.



---

archive/issue_comments_419810.json:
```json
{
    "body": "<a id='comment:119'></a>Replying to [comment:117 egourgoulhon]:\n> Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). \n\n\nI'm not quite sure, but I think this method is mandatory when using the division free algorithm. And the division free algorithm is invoked when changes of frames are established. In general, for vector bundles, frames may be distributed over serveral chart domains, for which the SR enforcement method fails. So yes, this is related to this ticket. I'm not completely satisfied with this either. As soon as the issue in ticket #28629 is solved, this snippet can be deleted again. Should I add a comment in the code about this?\n\n> Side note: `self.is_zero()`, as invoked in `ChartFunction.is_unit()`, can be very time consuming for large symbolic expressions, since it is trying to simplify the expression to zero. In this respect, the use of `is_trivial_zero()` in `ScalarField.is_unit()` is better.\n\n\nI agree, this is certainly better.",
    "created_at": "2019-10-18T22:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419810",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:119'></a>Replying to [comment:117 egourgoulhon]:
> Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). 


I'm not quite sure, but I think this method is mandatory when using the division free algorithm. And the division free algorithm is invoked when changes of frames are established. In general, for vector bundles, frames may be distributed over serveral chart domains, for which the SR enforcement method fails. So yes, this is related to this ticket. I'm not completely satisfied with this either. As soon as the issue in ticket #28629 is solved, this snippet can be deleted again. Should I add a comment in the code about this?

> Side note: `self.is_zero()`, as invoked in `ChartFunction.is_unit()`, can be very time consuming for large symbolic expressions, since it is trying to simplify the expression to zero. In this respect, the use of `is_trivial_zero()` in `ScalarField.is_unit()` is better.


I agree, this is certainly better.



---

archive/issue_comments_419811.json:
```json
{
    "body": "<a id='comment:0'></a>Furthermore, I would add a comment in the corresponding ticket, so that this code snippet gets not lost or forgotten.\n\nWhat do you say?",
    "created_at": "2019-10-18T22:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419811",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:0'></a>Furthermore, I would add a comment in the corresponding ticket, so that this code snippet gets not lost or forgotten.

What do you say?



---

archive/issue_comments_419812.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,27 @@\n+Implementation of topological and differentiable vector bundles over manifolds.\n \n+**Features:**\n+\n+- abstract vector bundles on topological manifolds\n+- trivializations\n+- local frames\n+- simple sections\n+- vector bundle fibers\n+- differentiable vector bundles and tensor bundles\n+\n+**Improvements in the preexisting code**\n+\n+- restriction of vectorframes depended on some strange order: fixed!\n+- ~~`SR` enforcement for automorphism field inversion removed (due to ticket #28189)~~\n+- `is_unit()` method superficially implemented for scalar fields to ensure division free matrix inversion for changes of frames (may be removed when #28629 is solved) \n+\n+**Planned in the farther future**\n+\n+- sections of general tensor products and automorphism fields on vector bundles\n+- tensor products and Whitney sums of vector bundles\n+- better zero treatment as in #28562\n+- `TensorField` inherits from `Section`, `VectorFrame` inherits from `LocalFrame`\n+- total space comes with induced charts\n \n Summary: vector_bundles\n \n``````\n",
    "created_at": "2019-10-19T12:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419812",
    "user": "https://github.com/DeRhamSource"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,27 @@
+Implementation of topological and differentiable vector bundles over manifolds.
 
+**Features:**
+
+- abstract vector bundles on topological manifolds
+- trivializations
+- local frames
+- simple sections
+- vector bundle fibers
+- differentiable vector bundles and tensor bundles
+
+**Improvements in the preexisting code**
+
+- restriction of vectorframes depended on some strange order: fixed!
+- ~~`SR` enforcement for automorphism field inversion removed (due to ticket #28189)~~
+- `is_unit()` method superficially implemented for scalar fields to ensure division free matrix inversion for changes of frames (may be removed when #28629 is solved) 
+
+**Planned in the farther future**
+
+- sections of general tensor products and automorphism fields on vector bundles
+- tensor products and Whitney sums of vector bundles
+- better zero treatment as in #28562
+- `TensorField` inherits from `Section`, `VectorFrame` inherits from `LocalFrame`
+- total space comes with induced charts
 
 Summary: vector_bundles
 
``````




---

archive/issue_comments_419813.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-19T20:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419814.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-20T12:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419815.json:
```json
{
    "body": "<a id='comment:4'></a>Since default frames are somehow obligatoric for further use, I added them. Please check. Sorry for that. But I think, this modification is very essential.",
    "created_at": "2019-10-20T12:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419815",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:4'></a>Since default frames are somehow obligatoric for further use, I added them. Please check. Sorry for that. But I think, this modification is very essential.



---

archive/issue_comments_419816.json:
```json
{
    "body": "<a id='comment:125'></a>Replying to [comment:119 gh-DeRhamSource]:\n> Replying to [comment:117 egourgoulhon]:\n> > Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). \n\n> \n> I'm not quite sure, but I think this method is mandatory when using the division free algorithm. And the division free algorithm is invoked when changes of frames are established. In general, for vector bundles, frames may be distributed over serveral chart domains, for which the SR enforcement method fails. So yes, this is related to this ticket. I'm not completely satisfied with this either. As soon as the issue in ticket #28629 is solved, this snippet can be deleted again. \n\n\nThanks for your answer. \n\n>Should I add a comment in the code about this?\n\n\nI've seen that you have done it; thanks.",
    "created_at": "2019-10-21T09:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419816",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:125'></a>Replying to [comment:119 gh-DeRhamSource]:
> Replying to [comment:117 egourgoulhon]:
> > Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). 

> 
> I'm not quite sure, but I think this method is mandatory when using the division free algorithm. And the division free algorithm is invoked when changes of frames are established. In general, for vector bundles, frames may be distributed over serveral chart domains, for which the SR enforcement method fails. So yes, this is related to this ticket. I'm not completely satisfied with this either. As soon as the issue in ticket #28629 is solved, this snippet can be deleted again. 


Thanks for your answer. 

>Should I add a comment in the code about this?


I've seen that you have done it; thanks.



---

archive/issue_comments_419817.json:
```json
{
    "body": "<a id='comment:126'></a>Replying to [comment:124 gh-DeRhamSource]:\n> Since default frames are somehow obligatoric for further use, I added them. Please check. Sorry for that. But I think, this modification is very essential.\n\n\nLGTM.",
    "created_at": "2019-10-21T09:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419817",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:126'></a>Replying to [comment:124 gh-DeRhamSource]:
> Since default frames are somehow obligatoric for further use, I added them. Please check. Sorry for that. But I think, this modification is very essential.


LGTM.



---

archive/issue_comments_419818.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-21T09:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419818",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419819.json:
```json
{
    "body": "<a id='comment:7'></a>Thank you very much for this very valuable addition to Sage!",
    "created_at": "2019-10-21T09:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419819",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>Thank you very much for this very valuable addition to Sage!



---

archive/issue_comments_419820.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-23T22:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28159#issuecomment-419820",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069942.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-23T22:58:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28159",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28159#event-69942"
}
```
