# Issue 28197: upgrade to ipython 7

archive/issues_027960.json:
```json
{
    "body": "Upgrade ipython and related packages: \n* https://pypi.org/project/ipython/ 7.13.0 (current as of 2020-06-05: 7.15.0)\n* https://pypi.org/project/ipykernel/ 5.2.1 (current as of 2020-06-05: 5.3.0)\n* https://pypi.org/project/backcall/ 0.1.0 (current as of 2020-06-05)\n* https://pypi.org/project/jedi/ 0.17.0 (current as of 2020-06-05)\n* https://pypi.org/project/prompt-toolkit/ 3.0.5 (current as of 2020-06-05)\n\nAll of these package versions support python >= 3.6 (note #29033).\n\nTarballs: see `checksums.ini` [`upstream_url`]. (To configure Sage to download from the upstream URLs, use `./configure --enable-download-from-upstream-url`)\n\n\nAssignee: jdemeyer, embray\n\nCC:  @embray @jdemeyer @slel @kiwifb @timokau @antonio-rojas\n\nKeywords: upgrade\n\nReviewer: John Palmieri, Matthias Koeppe\n\nAuthor: Jonathan Kliem, John Palmieri, Antonio Rojas\n\nBranch: e21a7b0eec15aac948ff62e0379207471cdc7de8\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28197\n\n",
    "closed_at": "2020-08-09T08:47:34Z",
    "created_at": "2019-07-14T15:37:44Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "upgrade to ipython 7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28197",
    "user": "https://github.com/fchapoton"
}
```
Upgrade ipython and related packages: 
* https://pypi.org/project/ipython/ 7.13.0 (current as of 2020-06-05: 7.15.0)
* https://pypi.org/project/ipykernel/ 5.2.1 (current as of 2020-06-05: 5.3.0)
* https://pypi.org/project/backcall/ 0.1.0 (current as of 2020-06-05)
* https://pypi.org/project/jedi/ 0.17.0 (current as of 2020-06-05)
* https://pypi.org/project/prompt-toolkit/ 3.0.5 (current as of 2020-06-05)

All of these package versions support python >= 3.6 (note #29033).

Tarballs: see `checksums.ini` [`upstream_url`]. (To configure Sage to download from the upstream URLs, use `./configure --enable-download-from-upstream-url`)


Assignee: jdemeyer, embray

CC:  @embray @jdemeyer @slel @kiwifb @timokau @antonio-rojas

Keywords: upgrade

Reviewer: John Palmieri, Matthias Koeppe

Author: Jonathan Kliem, John Palmieri, Antonio Rojas

Branch: e21a7b0eec15aac948ff62e0379207471cdc7de8

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28197





---

archive/issue_comments_420484.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n WARNING: this is python3-only\n+\n+* upgraded prompt-toolkit-2.0.9.tar.gz\n+\n+* pip-install backcall\n \n Comment: 1\n \n```\n",
    "created_at": "2019-07-14T15:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420484",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
 WARNING: this is python3-only
+
+* upgraded prompt-toolkit-2.0.9.tar.gz
+
+* pip-install backcall
 
 Comment: 1
 
```




---

archive/issue_comments_420485.json:
```json
{
    "body": "<a id='comment:1'></a>This is basically working, but maybe without preparsing..\n\n---\nNew commits:",
    "created_at": "2019-07-14T15:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420485",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>This is basically working, but maybe without preparsing..

---
New commits:



---

archive/issue_comments_420486.json:
```json
{
    "body": "<a id='comment:3'></a>Should this depend on #28190?",
    "created_at": "2019-07-14T17:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420486",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>Should this depend on #28190?



---

archive/issue_comments_420487.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+WARNING: this is python3-only\n+\n+* Upgrade ipython to 7.6.1\n+\n+```\n+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz\n+```\n+\n+* upgraded prompt-toolkit-2.0.9.tar.gz\n+\n+To download the tarball:\n+\n+```\n+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz\n+```\n+\n+* pip-install backcall\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2019-07-22T13:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420487",
    "user": "https://github.com/jplab"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+WARNING: this is python3-only
+
+* Upgrade ipython to 7.6.1
+
+```
+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz
+```
+
+* upgraded prompt-toolkit-2.0.9.tar.gz
+
+To download the tarball:
+
+```
+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz
+```
+
+* pip-install backcall
+
 
 
 Comment: 1
```




---

archive/issue_comments_420488.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,36 @@\n+WARNING: this is python3-only\n+\n+* Upgrade ipython to 7.6.1\n+\n+```\n+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz\n+```\n+\n+* upgraded prompt-toolkit-2.0.9.tar.gz\n+\n+To download the tarball:\n+\n+```\n+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz\n+```\n+\n+* pip-install backcall\n+\n+Current issues (8.9.beta3):\n+\n+```\n+sage: installed_packages()['ipython']                                                                                                                                                                              \n+'7.6.1'\n+sage: 2^3                                                                                                                                                                                                          \n+1\n+sage: 2**3                                                                                                                                                                                                         \n+8\n+sage: n=4                                                                                                                                                                                                          \n+sage: type(n)                                                                                                                                                                                                      \n+<class 'int'>\n+```\n+\n+The preparsing is not working.\n \n \n Comment: 1\n```\n",
    "created_at": "2019-07-22T13:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420488",
    "user": "https://github.com/jplab"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,36 @@
+WARNING: this is python3-only
+
+* Upgrade ipython to 7.6.1
+
+```
+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz
+```
+
+* upgraded prompt-toolkit-2.0.9.tar.gz
+
+To download the tarball:
+
+```
+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz
+```
+
+* pip-install backcall
+
+Current issues (8.9.beta3):
+
+```
+sage: installed_packages()['ipython']                                                                                                                                                                              
+'7.6.1'
+sage: 2^3                                                                                                                                                                                                          
+1
+sage: 2**3                                                                                                                                                                                                         
+8
+sage: n=4                                                                                                                                                                                                          
+sage: type(n)                                                                                                                                                                                                      
+<class 'int'>
+```
+
+The preparsing is not working.
 
 
 Comment: 1
```




---

archive/issue_comments_420489.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+WARNING: this is python3-only\n+\n+* Upgrade ipython to 7.6.1\n+\n+```\n+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz\n+```\n+\n+* upgraded prompt-toolkit-2.0.9.tar.gz\n+\n+To download the tarball:\n+\n+```\n+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz\n+```\n+\n+* pip-install backcall\n \n \n Comment: 1\n```\n",
    "created_at": "2019-07-22T13:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420489",
    "user": "https://github.com/jplab"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,20 @@
+WARNING: this is python3-only
+
+* Upgrade ipython to 7.6.1
+
+```
+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz
+```
+
+* upgraded prompt-toolkit-2.0.9.tar.gz
+
+To download the tarball:
+
+```
+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz
+```
+
+* pip-install backcall
 
 
 Comment: 1
```




---

archive/issue_comments_420490.json:
```json
{
    "body": "<a id='comment:7'></a>Current issues (8.9.beta3):\n\n```\nsage: installed_packages()['ipython']                                                                                                                                                                              \n'7.6.1'\nsage: 2^3                                                                                                                                                                                                          \n1\nsage: 2**3                                                                                                                                                                                                         \n8\nsage: n=4                                                                                                                                                                                                          \nsage: type(n)                                                                                                                                                                                                      \n<class 'int'>\n```\n\nThe preparsing is not working since it has been commented out.",
    "created_at": "2019-07-22T13:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420490",
    "user": "https://github.com/jplab"
}
```

<a id='comment:7'></a>Current issues (8.9.beta3):

```
sage: installed_packages()['ipython']                                                                                                                                                                              
'7.6.1'
sage: 2^3                                                                                                                                                                                                          
1
sage: 2**3                                                                                                                                                                                                         
8
sage: n=4                                                                                                                                                                                                          
sage: type(n)                                                                                                                                                                                                      
<class 'int'>
```

The preparsing is not working since it has been commented out.



---

archive/issue_comments_420491.json:
```json
{
    "body": "<a id='comment:8'></a>Trying to launch ipython one get:\n\n```\njplabbe@blackbomb:~/sage$ sage -ipython\nTraceback (most recent call last):\n...\npkg_resources.DistributionNotFound: The 'jedi>=0.10' distribution was not found and is required by ipython\n```\n\nSo one has to install the `jedi` module as well.",
    "created_at": "2019-07-22T13:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420491",
    "user": "https://github.com/jplab"
}
```

<a id='comment:8'></a>Trying to launch ipython one get:

```
jplabbe@blackbomb:~/sage$ sage -ipython
Traceback (most recent call last):
...
pkg_resources.DistributionNotFound: The 'jedi>=0.10' distribution was not found and is required by ipython
```

So one has to install the `jedi` module as well.



---

archive/issue_comments_420492.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,22 @@\n+WARNING: this is python3-only\n+\n+* Upgrade ipython to 7.6.1\n+\n+```\n+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz\n+```\n+\n+* upgraded prompt-toolkit-2.0.9.tar.gz\n+\n+To download the tarball:\n+\n+```\n+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz\n+```\n+\n+* pip-install backcall\n+\n+* pip-install jedi\n \n \n Comment: 1\n```\n",
    "created_at": "2019-09-01T06:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420492",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,22 @@
+WARNING: this is python3-only
+
+* Upgrade ipython to 7.6.1
+
+```
+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz
+```
+
+* upgraded prompt-toolkit-2.0.9.tar.gz
+
+To download the tarball:
+
+```
+$ wget -P upstream --output-document=prompt-toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz
+```
+
+* pip-install backcall
+
+* pip-install jedi
 
 
 Comment: 1
```




---

archive/issue_comments_420493.json:
```json
{
    "body": "<a id='comment:11'></a>A patch that makes sage work with ipython 7, including the preparser, is available at [1]. I haven't bothered to make it backwards compatible with older ipython, and it probably needs some polishing, feel free to take it from there.\n\n[1] https://aur.archlinux.org/cgit/aur.git/tree/sagemath-ipython7.patch?h=sagemath-python3-git",
    "created_at": "2019-09-01T14:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420493",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:11'></a>A patch that makes sage work with ipython 7, including the preparser, is available at [1]. I haven't bothered to make it backwards compatible with older ipython, and it probably needs some polishing, feel free to take it from there.

[1] https://aur.archlinux.org/cgit/aur.git/tree/sagemath-ipython7.patch?h=sagemath-python3-git



---

archive/issue_comments_420494.json:
```json
{
    "body": "<a id='comment:12'></a>(For lack of a better component; perhaps we should add a \"REPL\" component...?)",
    "created_at": "2019-09-18T12:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420494",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>(For lack of a better component; perhaps we should add a "REPL" component...?)



---

archive/issue_comments_420495.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to refactoring.",
    "created_at": "2019-09-18T12:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420495",
    "user": "https://github.com/embray"
}
```

Changing component from PLEASE CHANGE to refactoring.



---

archive/issue_comments_420496.json:
```json
{
    "body": "Changing component from refactoring to packages: standard.",
    "created_at": "2019-11-18T22:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420496",
    "user": "https://github.com/jhpalmieri"
}
```

Changing component from refactoring to packages: standard.



---

archive/issue_comments_420497.json:
```json
{
    "body": "Set assignee to jdemeyer, embray.",
    "created_at": "2019-11-18T22:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420497",
    "user": "https://github.com/jhpalmieri"
}
```

Set assignee to jdemeyer, embray.



---

archive/issue_comments_420498.json:
```json
{
    "body": "<a id='comment:15'></a>This is Python 3 only. Are there specific plans for when we drop Python 2 support from Sage? Version 9.1?",
    "created_at": "2019-11-18T22:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420498",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>This is Python 3 only. Are there specific plans for when we drop Python 2 support from Sage? Version 9.1?



---

archive/issue_comments_420499.json:
```json
{
    "body": "<a id='comment:16'></a>ipython 7.10 breaks many more tests due to it no longer sorting dicts. Some tests output is actually random now. Updated patch at https://aur.archlinux.org/cgit/aur.git/tree/sagemath-ipython7.patch?h=sagemath-git",
    "created_at": "2019-12-05T07:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420499",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:16'></a>ipython 7.10 breaks many more tests due to it no longer sorting dicts. Some tests output is actually random now. Updated patch at https://aur.archlinux.org/cgit/aur.git/tree/sagemath-ipython7.patch?h=sagemath-git



---

archive/issue_comments_420500.json:
```json
{
    "body": "<a id='comment:17'></a>Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420500",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Ticket retargeted after milestone closed



---

archive/issue_events_070069.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28197#event-70069"
}
```



---

archive/issue_comments_420501.json:
```json
{
    "body": "<a id='comment:18'></a>The new jedi completion engine seems to have some problems. For example with IPython 7.6.1, invoking tab completion like\n\n```\nsage: 1 + <TAB>\n```\ncauses the interpreter to freeze for about 1.5 minutes (apparently, a largish cache is created at `~/.cache/jedi/`). After that, several deprecated functions are imported into global scope causing deprecation warnings to be printed, such as:\n\n```\nImporting absolute_igusa_invariants_kohel from here is deprecated. If you need to use it, please import it directly from sage.schemes.hyperelliptic_curves.invariants\nSee https://trac.sagemath.org/28064 for details.\n  return getattr(handle.access, attribute)(*args, **kwargs)\n```\nThis also seems to slow down exiting Sage.\n\n---\n\nAs for the display of dictionaries during doctests, I suggest to open a separate ticket to remove the sorting. This can be done independently from the IPython upgrade, once Python 2 support is dropped by Sage (in 9.1 I assume).",
    "created_at": "2020-01-01T22:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420501",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:18'></a>The new jedi completion engine seems to have some problems. For example with IPython 7.6.1, invoking tab completion like

```
sage: 1 + <TAB>
```
causes the interpreter to freeze for about 1.5 minutes (apparently, a largish cache is created at `~/.cache/jedi/`). After that, several deprecated functions are imported into global scope causing deprecation warnings to be printed, such as:

```
Importing absolute_igusa_invariants_kohel from here is deprecated. If you need to use it, please import it directly from sage.schemes.hyperelliptic_curves.invariants
See https://trac.sagemath.org/28064 for details.
  return getattr(handle.access, attribute)(*args, **kwargs)
```
This also seems to slow down exiting Sage.

---

As for the display of dictionaries during doctests, I suggest to open a separate ticket to remove the sorting. This can be done independently from the IPython upgrade, once Python 2 support is dropped by Sage (in 9.1 I assume).



---

archive/issue_comments_420502.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,22 @@\n+WARNING: this is python3-only\n+\n+* Upgrade ipython to 7.6.1\n+\n+```\n+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz\n+```\n+\n+* upgraded prompt-toolkit-2.0.9.tar.gz\n+\n+To download the tarball:\n+\n+```\n+$ wget --output-document=upstream/prompt_toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz\n+```\n+\n+* pip-install backcall\n+\n+* pip-install jedi\n \n \n Comment: 1\n```\n",
    "created_at": "2020-01-01T22:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420502",
    "user": "https://github.com/mwageringel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,22 @@
+WARNING: this is python3-only
+
+* Upgrade ipython to 7.6.1
+
+```
+$ wget -P upstream https://github.com/ipython/ipython/releases/download/7.6.1/ipython-7.6.1.tar.gz
+```
+
+* upgraded prompt-toolkit-2.0.9.tar.gz
+
+To download the tarball:
+
+```
+$ wget --output-document=upstream/prompt_toolkit-2.0.9.tar.gz https://github.com/prompt-toolkit/python-prompt-toolkit/archive/2.0.9.tar.gz
+```
+
+* pip-install backcall
+
+* pip-install jedi
 
 
 Comment: 1
```




---

archive/issue_comments_420503.json:
```json
{
    "body": "<a id='comment:19'></a>a preparation step at #28948",
    "created_at": "2020-01-03T09:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420503",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>a preparation step at #28948



---

archive/issue_comments_420504.json:
```json
{
    "body": "<a id='comment:20'></a>I've opened #29042 for the dict sorting changes",
    "created_at": "2020-01-18T23:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420504",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:20'></a>I've opened #29042 for the dict sorting changes



---

archive/issue_comments_420505.json:
```json
{
    "body": "<a id='comment:21'></a>I have the following that I don't really know what to do with\n\n```\nsage -t --long /usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\", line 352, in sage.repl.ipython_extension.SageMagics.cython\nFailed example:\n    shell.run_cell('''\n    %%cython\n    def f():\n        print('test')\n    ''')\nExpected nothing\nGot:\n    UsageError: Line magic function `%%cython` not found.\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\", line 357, in sage.repl.ipython_extension.SageMagics.cython\nFailed example:\n    f()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.ipython_extension.SageMagics.cython[3]>\", line 1, in <module>\n        f()\n    NameError: name 'f' is not defined\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\", line 385, in sage.repl.ipython_extension.SageMagics.fortran\nFailed example:\n    shell.run_cell('''\n    %%fortran\n    C FILE: FIB1.F\n          SUBROUTINE FIB(A,N)\n    C\n    C     CALCULATE FIRST N FIBONACCI NUMBERS\n    C\n          INTEGER N\n          REAL*8 A(N)\n          DO I=1,N\n             IF (I.EQ.1) THEN\n                A(I) = 0.0D0\n             ELSEIF (I.EQ.2) THEN\n                A(I) = 1.0D0\n             ELSE\n                A(I) = A(I-1) + A(I-2)\n             ENDIF\n          ENDDO\n          END\n    C END FILE FIB1.F\n    ''')\nExpected nothing\nGot:\n      File \"<ipython-input-1-ab346d8f879f>\", line 3\n        C FILE: FIB1.F\n             ^\n    SyntaxError: invalid syntax\n    <BLANKLINE>\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\", line 406, in sage.repl.ipython_extension.SageMagics.fortran\nFailed example:\n    fib\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.ipython_extension.SageMagics.fortran[3]>\", line 1, in <module>\n        fib\n    NameError: name 'fib' is not defined\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\", line 410, in sage.repl.ipython_extension.SageMagics.fortran\nFailed example:\n    fib(a, 10)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.ipython_extension.SageMagics.fortran[6]>\", line 1, in <module>\n        fib(a, Integer(10))\n    NameError: name 'fib' is not defined\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py\", line 411, in sage.repl.ipython_extension.SageMagics.fortran\nFailed example:\n    a\nExpected:\n    array([  0.,   1.,   1.,   2.,   3.,   5.,   8.,  13.,  21.,  34.])\nGot:\n    array([0., 1., 2., 3., 4., 5., 6., 7., 8., 9.])\n**********************************************************************\n2 items had failures:\n   2 of   5 in sage.repl.ipython_extension.SageMagics.cython\n   4 of   9 in sage.repl.ipython_extension.SageMagics.fortran\n    [80 tests, 6 failures, 2.14 s]\n----------------------------------------------------------------------\nsage -t --long /usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py  # 6 doctests failed\n```\nIt all comes down from the first test failing because of the `%%cython` magic function not being found. Any clue as to what to do to fix that?",
    "created_at": "2020-03-29T07:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420505",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>I have the following that I don't really know what to do with

```
sage -t --long /usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py", line 352, in sage.repl.ipython_extension.SageMagics.cython
Failed example:
    shell.run_cell('''
    %%cython
    def f():
        print('test')
    ''')
Expected nothing
Got:
    UsageError: Line magic function `%%cython` not found.
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py", line 357, in sage.repl.ipython_extension.SageMagics.cython
Failed example:
    f()
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.ipython_extension.SageMagics.cython[3]>", line 1, in <module>
        f()
    NameError: name 'f' is not defined
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py", line 385, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
    shell.run_cell('''
    %%fortran
    C FILE: FIB1.F
          SUBROUTINE FIB(A,N)
    C
    C     CALCULATE FIRST N FIBONACCI NUMBERS
    C
          INTEGER N
          REAL*8 A(N)
          DO I=1,N
             IF (I.EQ.1) THEN
                A(I) = 0.0D0
             ELSEIF (I.EQ.2) THEN
                A(I) = 1.0D0
             ELSE
                A(I) = A(I-1) + A(I-2)
             ENDIF
          ENDDO
          END
    C END FILE FIB1.F
    ''')
Expected nothing
Got:
      File "<ipython-input-1-ab346d8f879f>", line 3
        C FILE: FIB1.F
             ^
    SyntaxError: invalid syntax
    <BLANKLINE>
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py", line 406, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
    fib
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.ipython_extension.SageMagics.fortran[3]>", line 1, in <module>
        fib
    NameError: name 'fib' is not defined
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py", line 410, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
    fib(a, 10)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.ipython_extension.SageMagics.fortran[6]>", line 1, in <module>
        fib(a, Integer(10))
    NameError: name 'fib' is not defined
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py", line 411, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
    a
Expected:
    array([  0.,   1.,   1.,   2.,   3.,   5.,   8.,  13.,  21.,  34.])
Got:
    array([0., 1., 2., 3., 4., 5., 6., 7., 8., 9.])
**********************************************************************
2 items had failures:
   2 of   5 in sage.repl.ipython_extension.SageMagics.cython
   4 of   9 in sage.repl.ipython_extension.SageMagics.fortran
    [80 tests, 6 failures, 2.14 s]
----------------------------------------------------------------------
sage -t --long /usr/lib/python3.7/site-packages/sage/repl/ipython_extension.py  # 6 doctests failed
```
It all comes down from the first test failing because of the `%%cython` magic function not being found. Any clue as to what to do to fix that?



---

archive/issue_comments_420506.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 fbissey]:\n\n> It all comes down from the first test failing because of the `%%cython` magic function not being found. Any clue as to what to do to fix that?\n\n\nBroken preparsing? it works fine here with the patch at comment:16",
    "created_at": "2020-03-29T08:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420506",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:22'></a>Replying to [comment:21 fbissey]:

> It all comes down from the first test failing because of the `%%cython` magic function not being found. Any clue as to what to do to fix that?


Broken preparsing? it works fine here with the patch at comment:16



---

archive/issue_comments_420507.json:
```json
{
    "body": "<a id='comment:23'></a>Because I was using ipython-7.5 so far I was using the patch at comment:11 (with small variations between sage-9.0 and 9.1.beta). I'll check the preparsing in comment:16.",
    "created_at": "2020-03-29T08:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420507",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>Because I was using ipython-7.5 so far I was using the patch at comment:11 (with small variations between sage-9.0 and 9.1.beta). I'll check the preparsing in comment:16.



---

archive/issue_comments_420508.json:
```json
{
    "body": "<a id='comment:24'></a>I should have asked. When you said it is fine, is it sage-9.0 or 9.1.betaX? I am working on 9.1.beta9 right now.",
    "created_at": "2020-03-29T08:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420508",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>I should have asked. When you said it is fine, is it sage-9.0 or 9.1.betaX? I am working on 9.1.beta9 right now.



---

archive/issue_comments_420509.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 fbissey]:\n> I should have asked. When you said it is fine, is it sage-9.0 or 9.1.betaX? I am working on 9.1.beta9 right now.\n\n\nBoth. The patch for 9.0 is at https://git.archlinux.org/svntogit/community.git/tree/trunk/sagemath-ipython7.patch?h=packages/sagemath",
    "created_at": "2020-03-29T08:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420509",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:25'></a>Replying to [comment:24 fbissey]:
> I should have asked. When you said it is fine, is it sage-9.0 or 9.1.betaX? I am working on 9.1.beta9 right now.


Both. The patch for 9.0 is at https://git.archlinux.org/svntogit/community.git/tree/trunk/sagemath-ipython7.patch?h=packages/sagemath



---

archive/issue_comments_420510.json:
```json
{
    "body": "<a id='comment:26'></a>Nope. I must be missing something subtle or something in my stack has a bug.",
    "created_at": "2020-03-29T08:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420510",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>Nope. I must be missing something subtle or something in my stack has a bug.



---

archive/issue_events_070070.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-31T14:36:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28197#event-70070"
}
```



---

archive/issue_events_070071.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-31T14:36:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28197#event-70071"
}
```



---

archive/issue_comments_420511.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-25T17:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420512.json:
```json
{
    "body": "<a id='comment:30'></a>Here is a branch for IPython 7.13, which requires new packages jedi and backcall, to give people something new to play with, especially since we're getting close to starting the 9.2 release cycle.\n\nI don't see the problem reported at #29428, or at least the small example there doesn't cause problems for me. The preparser doesn't work, though. I'm about to try the patch in comment:16, after which I'll add it to the branch. (Is there a missing or an extra single quote on line 47 of that patch?)",
    "created_at": "2020-04-25T17:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420512",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>Here is a branch for IPython 7.13, which requires new packages jedi and backcall, to give people something new to play with, especially since we're getting close to starting the 9.2 release cycle.

I don't see the problem reported at #29428, or at least the small example there doesn't cause problems for me. The preparser doesn't work, though. I'm about to try the patch in comment:16, after which I'll add it to the branch. (Is there a missing or an extra single quote on line 47 of that patch?)



---

archive/issue_comments_420513.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+WARNING: this is python3-only\n+\n+Upgrade ipython to 7.13.0 and related packages\n+\n+\n+Files:\n+\n+* https://pypi.io/packages/source/i/ipython/ipython-7.13.0.tar.gz\n+* https://pypi.io/packages/source/i/ipykernel/ipykernel-5.2.1.tar.gz\n+* https://pypi.io/packages/source/b/backcall/backcall-0.1.0.tar.gz\n+* https://pypi.io/packages/source/j/jedi/jedi-0.17.0.tar.gz\n+* https://pypi.io/packages/source/p/prompt_toolkit/prompt_toolkit-3.0.5.tar.gz\n \n \n Comment: 1\n```\n",
    "created_at": "2020-04-25T17:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420513",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,15 @@
+WARNING: this is python3-only
+
+Upgrade ipython to 7.13.0 and related packages
+
+
+Files:
+
+* https://pypi.io/packages/source/i/ipython/ipython-7.13.0.tar.gz
+* https://pypi.io/packages/source/i/ipykernel/ipykernel-5.2.1.tar.gz
+* https://pypi.io/packages/source/b/backcall/backcall-0.1.0.tar.gz
+* https://pypi.io/packages/source/j/jedi/jedi-0.17.0.tar.gz
+* https://pypi.io/packages/source/p/prompt_toolkit/prompt_toolkit-3.0.5.tar.gz
 
 
 Comment: 1
```




---

archive/issue_comments_420514.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-25T18:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420515.json:
```json
{
    "body": "<a id='comment:33'></a>Here is the preparser patch from comment:16 (although without the lines changing `sys.getrecursionlimit()`). When merged with #29042, I see these doctest failures:\n\n```\nsage -t --long src/sage/tests/cmdline.py  # 3 doctests failed\nsage -t --long src/sage/crypto/mq/sr.py  # 1 doctest failed\nsage -t --long src/sage/rings/polynomial/multi_polynomial_sequence.py  # 1 doctest failed\nsage -t --long src/sage/misc/package.py  # 1 doctest failed\nsage -t --long src/sage/rings/polynomial/pbori.pyx  # 1 doctest failed\nsage -t --long src/sage/sat/solvers/dimacs.py  # 1 doctest failed\nsage -t --long src/doc/en/reference/sat/index.rst  # 1 doctest failed\nsage -t --long src/sage/sat/converters/polybori.py  # 1 doctest failed\nsage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed\n```\n- Almost all of these come from brial:\n\n```\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/IPYTHON/sage-9.1.rc1/local/lib/python3.7/site-packages/brial/gbrefs.py\", line 9, in <module>\n        import imp\n    ...\n    DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses\n```\n- It seems that `jedi` needs `parso` as a prerequisite, and that causes the failure in `cmdline.py`.\n- The error in `misc/package.py` looks like another one from sorting dictionaries, and so it should be dealt with at #29042:\n\n```\nFailed example:\n    installed_packages()  # optional - build\nExpected:\n    {...'alabaster': ...'pynac': ...}\n```\npynac appeared before alabaster in the actual output, unfortunately.",
    "created_at": "2020-04-25T18:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420515",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>Here is the preparser patch from comment:16 (although without the lines changing `sys.getrecursionlimit()`). When merged with #29042, I see these doctest failures:

```
sage -t --long src/sage/tests/cmdline.py  # 3 doctests failed
sage -t --long src/sage/crypto/mq/sr.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/multi_polynomial_sequence.py  # 1 doctest failed
sage -t --long src/sage/misc/package.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/pbori.pyx  # 1 doctest failed
sage -t --long src/sage/sat/solvers/dimacs.py  # 1 doctest failed
sage -t --long src/doc/en/reference/sat/index.rst  # 1 doctest failed
sage -t --long src/sage/sat/converters/polybori.py  # 1 doctest failed
sage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed
```
- Almost all of these come from brial:

```
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/IPYTHON/sage-9.1.rc1/local/lib/python3.7/site-packages/brial/gbrefs.py", line 9, in <module>
        import imp
    ...
    DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
```
- It seems that `jedi` needs `parso` as a prerequisite, and that causes the failure in `cmdline.py`.
- The error in `misc/package.py` looks like another one from sorting dictionaries, and so it should be dealt with at #29042:

```
Failed example:
    installed_packages()  # optional - build
Expected:
    {...'alabaster': ...'pynac': ...}
```
pynac appeared before alabaster in the actual output, unfortunately.



---

archive/issue_comments_420516.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-25T18:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420517.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:33 jhpalmieri]:\n> Here is the preparser patch from comment:16 (although without the lines changing `sys.getrecursionlimit()`). When merged with #29042, I see these doctest failures:\n\n\nUhm, for some reason I haven't been getting emails from this ticket (and many others). The brial issues are fixed in 1.2.6, sage's package seems to be quite outdated (latest version is 1.2.8)\n\nWhen I ported the preparser, I removed quite a few tests from `SagePromptTransformer()`, those should probably be brought back somewhere.",
    "created_at": "2020-05-06T18:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420517",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:35'></a>Replying to [comment:33 jhpalmieri]:
> Here is the preparser patch from comment:16 (although without the lines changing `sys.getrecursionlimit()`). When merged with #29042, I see these doctest failures:


Uhm, for some reason I haven't been getting emails from this ticket (and many others). The brial issues are fixed in 1.2.6, sage's package seems to be quite outdated (latest version is 1.2.8)

When I ported the preparser, I removed quite a few tests from `SagePromptTransformer()`, those should probably be brought back somewhere.



---

archive/issue_comments_420518.json:
```json
{
    "body": "<a id='comment:36'></a>BRiAl update at #29658",
    "created_at": "2020-05-07T01:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420518",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>BRiAl update at #29658



---

archive/issue_comments_420519.json:
```json
{
    "body": "<a id='comment:38'></a>Opened #29774 to deal with the multiple deprecation warnings thrown by ipython with jedi>=0.16",
    "created_at": "2020-06-01T09:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420519",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:38'></a>Opened #29774 to deal with the multiple deprecation warnings thrown by ipython with jedi>=0.16



---

archive/issue_comments_420520.json:
```json
{
    "body": "<a id='comment:39'></a>This seems to basically work now. I'm testing it on top of #29042 now and for example with ubuntu eoan I'm getting only one new failure:\n\nhttps://github.com/kliem/sage-test-27122/runs/742530683\n\n```\nFile \"src/sage/rings/qqbar.py\", line 8096, in sage.rings.qqbar.ANBinaryExpr.exactify\nFailed example:\n    import sys; sys.getrecursionlimit()\nExpected:\n    1000\nGot:\n    3000\n**********************************************************************\nFile \"src/sage/rings/qqbar.py\", line 8102, in sage.rings.qqbar.ANBinaryExpr.exactify\nFailed example:\n    sys.getrecursionlimit()\nExpected:\n    1000\nGot:\n    3000\n```\n\nI will report further results, once the tests are done.",
    "created_at": "2020-06-05T19:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420520",
    "user": "https://github.com/kliem"
}
```

<a id='comment:39'></a>This seems to basically work now. I'm testing it on top of #29042 now and for example with ubuntu eoan I'm getting only one new failure:

https://github.com/kliem/sage-test-27122/runs/742530683

```
File "src/sage/rings/qqbar.py", line 8096, in sage.rings.qqbar.ANBinaryExpr.exactify
Failed example:
    import sys; sys.getrecursionlimit()
Expected:
    1000
Got:
    3000
**********************************************************************
File "src/sage/rings/qqbar.py", line 8102, in sage.rings.qqbar.ANBinaryExpr.exactify
Failed example:
    sys.getrecursionlimit()
Expected:
    1000
Got:
    3000
```

I will report further results, once the tests are done.



---

archive/issue_comments_420521.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+WARNING: this is python3-only\n+\n+Upgrade ipython to 7.13.0 and related packages: ipython-7.13.0, ipykernel-5.2.1, backcall-0.1.0, jedi-0.17.0, prompt_toolkit-3.0.5\n+\n+Tarballs: see `checksums.ini` [`upstream_url`]. (To configure Sage to download from the upstream URLs, use `./configure --enable-download-from-upstream-url`)\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-05T19:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420521",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,8 @@
+WARNING: this is python3-only
+
+Upgrade ipython to 7.13.0 and related packages: ipython-7.13.0, ipykernel-5.2.1, backcall-0.1.0, jedi-0.17.0, prompt_toolkit-3.0.5
+
+Tarballs: see `checksums.ini` [`upstream_url`]. (To configure Sage to download from the upstream URLs, use `./configure --enable-download-from-upstream-url`)
 
 
 Comment: 1
```




---

archive/issue_comments_420522.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+Upgrade ipython and related packages: \n+* https://pypi.org/project/ipython/ 7.13.0 (current as of 2020-06-05: 7.15.0)\n+* https://pypi.org/project/ipykernel/ 5.2.1 (current as of 2020-06-05: 5.3.0)\n+* https://pypi.org/project/backcall/ 0.1.0 (current as of 2020-06-05)\n+* https://pypi.org/project/jedi/ 0.17.0 (current as of 2020-06-05)\n+* https://pypi.org/project/prompt-toolkit/ 3.0.5 (current as of 2020-06-05)\n+\n+All of these package versions support python >= 3.6 (note #29033).\n+\n+Tarballs: see `checksums.ini` [`upstream_url`]. (To configure Sage to download from the upstream URLs, use `./configure --enable-download-from-upstream-url`)\n \n \n Comment: 1\n```\n",
    "created_at": "2020-06-05T20:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420522",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,13 @@
+Upgrade ipython and related packages: 
+* https://pypi.org/project/ipython/ 7.13.0 (current as of 2020-06-05: 7.15.0)
+* https://pypi.org/project/ipykernel/ 5.2.1 (current as of 2020-06-05: 5.3.0)
+* https://pypi.org/project/backcall/ 0.1.0 (current as of 2020-06-05)
+* https://pypi.org/project/jedi/ 0.17.0 (current as of 2020-06-05)
+* https://pypi.org/project/prompt-toolkit/ 3.0.5 (current as of 2020-06-05)
+
+All of these package versions support python >= 3.6 (note #29033).
+
+Tarballs: see `checksums.ini` [`upstream_url`]. (To configure Sage to download from the upstream URLs, use `./configure --enable-download-from-upstream-url`)
 
 
 Comment: 1
```




---

archive/issue_comments_420523.json:
```json
{
    "body": "<a id='comment:42'></a>Except for this qqbar test, all tests pass on my ubuntu bionic (testing this ticket on top of #29042).\n\nAs noted already tab completion is broken and #29774 fixes this.",
    "created_at": "2020-06-05T20:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420523",
    "user": "https://github.com/kliem"
}
```

<a id='comment:42'></a>Except for this qqbar test, all tests pass on my ubuntu bionic (testing this ticket on top of #29042).

As noted already tab completion is broken and #29774 fixes this.



---

archive/issue_comments_420524.json:
```json
{
    "body": "<a id='comment:43'></a>Is this coming from `jedi/app/__init__.py`, the line\n\n```\nsys.setrecursionlimit(3000)\n```\n?\n\nI don't think the actual limit is important, just that it doesn't change, so I propose the following:\n\n```diff\ndiff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py\nindex 7fc0cb9917..f38195cdcc 100644\n--- a/src/sage/rings/qqbar.py\n+++ b/src/sage/rings/qqbar.py\n@@ -8093,14 +8093,14 @@ class ANBinaryExpr(ANDescr):\n         do this by increasing the recursion level at each step and\n         decrease it before we return::\n \n-            sage: import sys; sys.getrecursionlimit()\n-            1000\n+            sage: import sys\n+            sage: old_limit = sys.getrecursionlimit()\n             sage: s = SymmetricFunctions(QQ).schur()\n             sage: a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))\n             sage: a.exactify(); a # long time\n             0\n-            sage: sys.getrecursionlimit()\n-            1000\n+            sage: sys.getrecursionlimit() == old_limit\n+            True\n \n         \"\"\"\n         import sys\n```",
    "created_at": "2020-06-05T23:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420524",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:43'></a>Is this coming from `jedi/app/__init__.py`, the line

```
sys.setrecursionlimit(3000)
```
?

I don't think the actual limit is important, just that it doesn't change, so I propose the following:

```diff
diff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py
index 7fc0cb9917..f38195cdcc 100644
--- a/src/sage/rings/qqbar.py
+++ b/src/sage/rings/qqbar.py
@@ -8093,14 +8093,14 @@ class ANBinaryExpr(ANDescr):
         do this by increasing the recursion level at each step and
         decrease it before we return::
 
-            sage: import sys; sys.getrecursionlimit()
-            1000
+            sage: import sys
+            sage: old_limit = sys.getrecursionlimit()
             sage: s = SymmetricFunctions(QQ).schur()
             sage: a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))
             sage: a.exactify(); a # long time
             0
-            sage: sys.getrecursionlimit()
-            1000
+            sage: sys.getrecursionlimit() == old_limit
+            True
 
         """
         import sys
```



---

archive/issue_comments_420525.json:
```json
{
    "body": "<a id='comment:44'></a>I ran into a problem building Sage because it tried to build `backcall` before `pip` was installed. So here is a new branch. (It doesn't include the proposed change from comment:43).",
    "created_at": "2020-06-05T23:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420525",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>I ran into a problem building Sage because it tried to build `backcall` before `pip` was installed. So here is a new branch. (It doesn't include the proposed change from comment:43).



---

archive/issue_comments_420526.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-05T23:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420527.json:
```json
{
    "body": "<a id='comment:46'></a>On OS X, with this + #29042, the `qqbar` test is the only one that fails for me.",
    "created_at": "2020-06-05T23:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420527",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:46'></a>On OS X, with this + #29042, the `qqbar` test is the only one that fails for me.



---

archive/issue_comments_420528.json:
```json
{
    "body": "<a id='comment:48'></a>PYTHON_TOOLKIT should probably be PYTHON_TOOLCHAIN",
    "created_at": "2020-06-10T20:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420528",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>PYTHON_TOOLKIT should probably be PYTHON_TOOLCHAIN



---

archive/issue_comments_420529.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-10T21:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420530.json:
```json
{
    "body": "<a id='comment:50'></a>Thanks, fixed.",
    "created_at": "2020-06-10T21:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420530",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:50'></a>Thanks, fixed.



---

archive/issue_comments_420531.json:
```json
{
    "body": "<a id='comment:51'></a>What is missing on this ticket?",
    "created_at": "2020-06-14T19:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420531",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>What is missing on this ticket?



---

archive/issue_comments_420532.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-06-14T19:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420532",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_420533.json:
```json
{
    "body": "<a id='comment:53'></a>In my opinion, the only thing missing is how to resolve the qqbar doctest failure. I proposed a solution in comment:43, but I would like some feedback before adding it to the branch. Maybe I'm missing something, or maybe there is a better solution.",
    "created_at": "2020-06-14T20:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420533",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:53'></a>In my opinion, the only thing missing is how to resolve the qqbar doctest failure. I proposed a solution in comment:43, but I would like some feedback before adding it to the branch. Maybe I'm missing something, or maybe there is a better solution.



---

archive/issue_comments_420534.json:
```json
{
    "body": "<a id='comment:54'></a>The test tests two things, if I see this correctly:\n- Changing the recursion limit in the method allows for\n\n```\na=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))\n```\n  to be exactified.\n- Also the recursion limit should be the same after the method was called.\n\nIf the initial recursion limit is already 3000, the test doesn't work anymore. As `a` can be exactified without modifying the recursion limit in the method `exactify` (I checked). So the test passes with the solution in comment:43, but it is almost meaningless.\n\nI see two solutions for this:\n\n- Replace `a` by\n\n```\na=s([3,2]).expand(10)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(7)^d for d in range(7)]]))\n```\n  This value cannot be exactified with recursion limit 3000, but it works fine once the method increases the recursion limit.\n  However the doctest takes a bit longer.\n- We could modify the recursion limit before and after the doctest. This is faster. However, we rely on the same machinery as the method.\n\n  The advantage is that this really is a long time solution. If with some new update the default recursion limit is increased again, we can still see that the method works correctly.",
    "created_at": "2020-06-15T06:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420534",
    "user": "https://github.com/kliem"
}
```

<a id='comment:54'></a>The test tests two things, if I see this correctly:
- Changing the recursion limit in the method allows for

```
a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))
```
  to be exactified.
- Also the recursion limit should be the same after the method was called.

If the initial recursion limit is already 3000, the test doesn't work anymore. As `a` can be exactified without modifying the recursion limit in the method `exactify` (I checked). So the test passes with the solution in comment:43, but it is almost meaningless.

I see two solutions for this:

- Replace `a` by

```
a=s([3,2]).expand(10)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(7)^d for d in range(7)]]))
```
  This value cannot be exactified with recursion limit 3000, but it works fine once the method increases the recursion limit.
  However the doctest takes a bit longer.
- We could modify the recursion limit before and after the doctest. This is faster. However, we rely on the same machinery as the method.

  The advantage is that this really is a long time solution. If with some new update the default recursion limit is increased again, we can still see that the method works correctly.



---

archive/issue_comments_420535.json:
```json
{
    "body": "<a id='comment:55'></a>With the longer version (your first proposal), `a.exactify()` takes over 10 seconds on my computer, which is longer than we usually aim for with tests. So I would prefer your second proposal.",
    "created_at": "2020-06-15T16:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420535",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:55'></a>With the longer version (your first proposal), `a.exactify()` takes over 10 seconds on my computer, which is longer than we usually aim for with tests. So I would prefer your second proposal.



---

archive/issue_comments_420536.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:51 mkoeppe]:\n> What is missing on this ticket?\n\n\nThe removed tests from the old SagePromptTransformer() need to be restored",
    "created_at": "2020-06-15T17:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420536",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:56'></a>Replying to [comment:51 mkoeppe]:
> What is missing on this ticket?


The removed tests from the old SagePromptTransformer() need to be restored



---

archive/issue_comments_420537.json:
```json
{
    "body": "<a id='comment:57'></a>New commits:",
    "created_at": "2020-06-15T18:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420537",
    "user": "https://github.com/kliem"
}
```

<a id='comment:57'></a>New commits:



---

archive/issue_comments_420538.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T19:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420539.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-15T19:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420539",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_420540.json:
```json
{
    "body": "<a id='comment:59'></a>As for the authors, I kind of guessed. Is this correct? Am I missing something?\n\nAlso I don't really know how we do it with order of authors. I went alphabetically. However, I just fixed doctests.",
    "created_at": "2020-06-15T19:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420540",
    "user": "https://github.com/kliem"
}
```

<a id='comment:59'></a>As for the authors, I kind of guessed. Is this correct? Am I missing something?

Also I don't really know how we do it with order of authors. I went alphabetically. However, I just fixed doctests.



---

archive/issue_comments_420541.json:
```json
{
    "body": "<a id='comment:60'></a>\n```\ndiff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py\nindex 7fa7f8d..fd4b3bf 100644\n--- a/src/sage/rings/qqbar.py\n+++ b/src/sage/rings/qqbar.py\n@@ -8091,9 +8091,16 @@ class ANBinaryExpr(ANDescr):\n \n         We check to make sure that this method still works even. We\n         do this by increasing the recursion level at each step and\n-        decrease it before we return::\n+        decrease it before we return.\n+        We lower the recursion limit for this test to allow\n+        a test in reasonable time::\n \n-            sage: import sys; sys.getrecursionlimit()\n+            sage: import sys\n+            sage: old_recursion_limit = sys.getrecursionlimit()\n+            sage: sys.setrecursionlimit(1000)\n+\n+            sage: old_recursion_limit = sys.getrecursionlimit()\n+            sage: sys.getrecursionlimit()\n             1000\n             sage: s = SymmetricFunctions(QQ).schur()\n             sage: a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))\n```\n\nThe second `old_recursion_limit = sys.getrecursionlimit()` here doesn't look right. This will always set the recursion limit to 1000 at the end regardless of the original value",
    "created_at": "2020-06-15T20:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420541",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:60'></a>
```
diff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py
index 7fa7f8d..fd4b3bf 100644
--- a/src/sage/rings/qqbar.py
+++ b/src/sage/rings/qqbar.py
@@ -8091,9 +8091,16 @@ class ANBinaryExpr(ANDescr):
 
         We check to make sure that this method still works even. We
         do this by increasing the recursion level at each step and
-        decrease it before we return::
+        decrease it before we return.
+        We lower the recursion limit for this test to allow
+        a test in reasonable time::
 
-            sage: import sys; sys.getrecursionlimit()
+            sage: import sys
+            sage: old_recursion_limit = sys.getrecursionlimit()
+            sage: sys.setrecursionlimit(1000)
+
+            sage: old_recursion_limit = sys.getrecursionlimit()
+            sage: sys.getrecursionlimit()
             1000
             sage: s = SymmetricFunctions(QQ).schur()
             sage: a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))
```

The second `old_recursion_limit = sys.getrecursionlimit()` here doesn't look right. This will always set the recursion limit to 1000 at the end regardless of the original value



---

archive/issue_comments_420542.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T20:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420543.json:
```json
{
    "body": "<a id='comment:62'></a>Thanks for catching this.\n\nReplying to [comment:60 arojas]:\n> {{{\n> diff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py\n> index 7fa7f8d..fd4b3bf 100644\n> --- a/src/sage/rings/qqbar.py\n> +++ b/src/sage/rings/qqbar.py\n> `@``@` -8091,9 +8091,16 `@``@` class ANBinaryExpr(ANDescr):\n>  \n>          We check to make sure that this method still works even. We\n>          do this by increasing the recursion level at each step and\n> -        decrease it before we return::\n> +        decrease it before we return.\n> +        We lower the recursion limit for this test to allow\n> +        a test in reasonable time::\n>  \n> -            sage: import sys; sys.getrecursionlimit()\n> +            sage: import sys\n> +            sage: old_recursion_limit = sys.getrecursionlimit()\n> +            sage: sys.setrecursionlimit(1000)\n> +\n> +            sage: old_recursion_limit = sys.getrecursionlimit()\n> +            sage: sys.getrecursionlimit()\n>              1000\n>              sage: s = SymmetricFunctions(QQ).schur()\n>              sage: a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))\n> }}}\n> \n> The second `old_recursion_limit = sys.getrecursionlimit()` here doesn't look right. This will always set the recursion limit to 1000 at the end regardless of the original value",
    "created_at": "2020-06-15T20:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420543",
    "user": "https://github.com/kliem"
}
```

<a id='comment:62'></a>Thanks for catching this.

Replying to [comment:60 arojas]:
> {{{
> diff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py
> index 7fa7f8d..fd4b3bf 100644
> --- a/src/sage/rings/qqbar.py
> +++ b/src/sage/rings/qqbar.py
> `@``@` -8091,9 +8091,16 `@``@` class ANBinaryExpr(ANDescr):
>  
>          We check to make sure that this method still works even. We
>          do this by increasing the recursion level at each step and
> -        decrease it before we return::
> +        decrease it before we return.
> +        We lower the recursion limit for this test to allow
> +        a test in reasonable time::
>  
> -            sage: import sys; sys.getrecursionlimit()
> +            sage: import sys
> +            sage: old_recursion_limit = sys.getrecursionlimit()
> +            sage: sys.setrecursionlimit(1000)
> +
> +            sage: old_recursion_limit = sys.getrecursionlimit()
> +            sage: sys.getrecursionlimit()
>              1000
>              sage: s = SymmetricFunctions(QQ).schur()
>              sage: a=s([3,2]).expand(8)(flatten([[QQbar.zeta(3)^d for d in range(3)], [QQbar.zeta(5)^d for d in range(5)]]))
> }}}
> 
> The second `old_recursion_limit = sys.getrecursionlimit()` here doesn't look right. This will always set the recursion limit to 1000 at the end regardless of the original value



---

archive/issue_comments_420544.json:
```json
{
    "body": "<a id='comment:63'></a>Are all of the issues taken care of? Tests pass for me on OS X (after merging #29042).",
    "created_at": "2020-06-16T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420544",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'></a>Are all of the issues taken care of? Tests pass for me on OS X (after merging #29042).



---

archive/issue_comments_420545.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade\".",
    "created_at": "2020-06-17T21:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420545",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "upgrade".



---

archive/issue_comments_420546.json:
```json
{
    "body": "<a id='comment:64'></a>(Fixing John Palmieri's name in \"Authors\" field to match its spelling in other tickets.)",
    "created_at": "2020-06-17T21:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420546",
    "user": "https://github.com/slel"
}
```

<a id='comment:64'></a>(Fixing John Palmieri's name in "Authors" field to match its spelling in other tickets.)



---

archive/issue_comments_420547.json:
```json
{
    "body": "<a id='comment:65'></a>So, can we move on here ? Patchbots are helpless to check that nothing is broken. Does the gitlab CI help in this case ?",
    "created_at": "2020-06-27T17:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420547",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:65'></a>So, can we move on here ? Patchbots are helpless to check that nothing is broken. Does the gitlab CI help in this case ?



---

archive/issue_comments_420548.json:
```json
{
    "body": "<a id='comment:66'></a>I started a test run pulling this ticket and #29851 in the newest develop (#29851 fixes the workflow for debian bullseye and debian sid, so this seems reasonable for a good testing experience, it just allows reinstalling python for them, so really nothing to do with our ticket).\n\nResults will be available here https://github.com/kliem/sage/pull/16/checks.",
    "created_at": "2020-06-27T17:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420548",
    "user": "https://github.com/kliem"
}
```

<a id='comment:66'></a>I started a test run pulling this ticket and #29851 in the newest develop (#29851 fixes the workflow for debian bullseye and debian sid, so this seems reasonable for a good testing experience, it just allows reinstalling python for them, so really nothing to do with our ticket).

Results will be available here https://github.com/kliem/sage/pull/16/checks.



---

archive/issue_comments_420549.json:
```json
{
    "body": "<a id='comment:67'></a>This still works for me on OS X, after merging with the latest `develop` branch. I'll switch to positive review in a few days, naming some collection of reviewers unless (a) someone objects or (b) someone beats me to it.",
    "created_at": "2020-06-27T21:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420549",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:67'></a>This still works for me on OS X, after merging with the latest `develop` branch. I'll switch to positive review in a few days, naming some collection of reviewers unless (a) someone objects or (b) someone beats me to it.



---

archive/issue_comments_420550.json:
```json
{
    "body": "<a id='comment:68'></a>I have also tested an earlier version successfully as part of #29864 (namespace packages). Let's get this into the next beta for wider testing.",
    "created_at": "2020-06-27T21:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420550",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>I have also tested an earlier version successfully as part of #29864 (namespace packages). Let's get this into the next beta for wider testing.



---

archive/issue_comments_420551.json:
```json
{
    "body": "<a id='comment:69'></a>As for the tests, there is no obvious failure. So at least installing seems to work everywhere. I didn't test any generated docker images to see how it actually looks though.",
    "created_at": "2020-06-29T07:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420551",
    "user": "https://github.com/kliem"
}
```

<a id='comment:69'></a>As for the tests, there is no obvious failure. So at least installing seems to work everywhere. I didn't test any generated docker images to see how it actually looks though.



---

archive/issue_comments_420552.json:
```json
{
    "body": "<a id='comment:70'></a>I'm carrying out my threat to set a positive review ;)\n\nDear all: feel free to add yourself as a reviewer or an author (or both), as you see fit.",
    "created_at": "2020-06-30T22:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420552",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:70'></a>I'm carrying out my threat to set a positive review ;)

Dear all: feel free to add yourself as a reviewer or an author (or both), as you see fit.



---

archive/issue_comments_420553.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-30T22:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420553",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420554.json:
```json
{
    "body": "<a id='comment:71'></a>For a future ticket, we could also upgrade to 7.16.1. I just tried, and it builds and passes tests on my OS X box. I want to get this ticket in as it stands, though.",
    "created_at": "2020-07-02T02:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420554",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:71'></a>For a future ticket, we could also upgrade to 7.16.1. I just tried, and it builds and passes tests on my OS X box. I want to get this ticket in as it stands, though.



---

archive/issue_comments_420555.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:71 jhpalmieri]:\n> For a future ticket, we could also upgrade to 7.16.1. I just tried, and it builds and passes tests on my OS X box. I want to get this ticket in as it stands, though.\n\n\nFor the record, I am at 7.16.1 in sage-on-gentoo as well. Merging as it it now is the most important bit.",
    "created_at": "2020-07-02T03:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420555",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:72'></a>Replying to [comment:71 jhpalmieri]:
> For a future ticket, we could also upgrade to 7.16.1. I just tried, and it builds and passes tests on my OS X box. I want to get this ticket in as it stands, though.


For the record, I am at 7.16.1 in sage-on-gentoo as well. Merging as it it now is the most important bit.



---

archive/issue_comments_420556.json:
```json
{
    "body": "<a id='comment:73'></a>Looks like merge failed",
    "created_at": "2020-07-12T20:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420556",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:73'></a>Looks like merge failed



---

archive/issue_comments_420557.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-07-12T20:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_420558.json:
```json
{
    "body": "<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-07-12T20:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_420559.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-12T20:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420559",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_070072.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-09T08:47:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28197#event-70072"
}
```



---

archive/issue_comments_420560.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-09T08:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420560",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_420561.json:
```json
{
    "body": "<a id='comment:78'></a>This update [broke](https://groups.google.com/d/msg/sage-release/spalYgXKr-4/khvt2dRMBwAJ) `sage-shell-mode` support for Sage session in emacs.",
    "created_at": "2020-08-11T16:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420561",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:78'></a>This update [broke](https://groups.google.com/d/msg/sage-release/spalYgXKr-4/khvt2dRMBwAJ) `sage-shell-mode` support for Sage session in emacs.



---

archive/issue_comments_420562.json:
```json
{
    "body": "<a id='comment:79'></a>Preparsing multi-line strings also seems to be broken by this upgrade. See #30417.",
    "created_at": "2020-08-21T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420562",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:79'></a>Preparsing multi-line strings also seems to be broken by this upgrade. See #30417.



---

archive/issue_comments_420563.json:
```json
{
    "body": "<a id='comment:81'></a>See #30928 for a possible follow-up.",
    "created_at": "2020-11-17T08:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28197",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28197#issuecomment-420563",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:81'></a>See #30928 for a possible follow-up.
