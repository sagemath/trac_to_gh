# Issue 28984: gfan - clash of log2 macro with standard library

archive/issues_028747.json:
```json
{
    "body": "gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699) -- log for `conda-forge-minimal` see https://github.com/mkoeppe/sage/runs/542501523\n\nSame error as reported and fixed here:\n\n241194 \u2013 math/gfan: fix build on 13.0-CURRENT: https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=241194\n\nPatch: \nhttps://bz-attachments.freebsd.org/attachment.cgi?id=208243\n\n\n**CC:**  @rwst @kiwifb @dimpase @vbraun @isuruf\n\n**Branch/Commit:** [4f28ea05aa4949313f772b6670fb9b7d78348686](https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686)\n\n**Upstream:** Not yet reported upstream; Will do shortly.\n\n**Reviewer:** Isuru Fernando\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/28984\n\n",
    "closed_at": "2020-04-09T22:45:11Z",
    "created_at": "2020-01-11T01:35:45Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "gfan - clash of log2 macro with standard library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28984",
    "user": "https://github.com/mkoeppe"
}
```
gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699) -- log for `conda-forge-minimal` see https://github.com/mkoeppe/sage/runs/542501523

Same error as reported and fixed here:

241194 – math/gfan: fix build on 13.0-CURRENT: https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=241194

Patch: 
https://bz-attachments.freebsd.org/attachment.cgi?id=208243


**CC:**  @rwst @kiwifb @dimpase @vbraun @isuruf

**Branch/Commit:** [4f28ea05aa4949313f772b6670fb9b7d78348686](https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686)

**Upstream:** Not yet reported upstream; Will do shortly.

**Reviewer:** Isuru Fernando

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/28984





---

archive/attachments_021292.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "gfan-0.6.2.p1.log",
    "asset_url": "tarball://root/attachments/some-uuid/ticket28984/gfan-0.6.2.p1.log",
    "created_at": "2020-01-11T02:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.log",
    "user": "https://github.com/mkoeppe"
}
```



---

archive/issue_comments_457042.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2020-01-11T02:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457042",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>




---

archive/issue_comments_457043.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,9 @@\n+gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699).\n+\n Same error as reported and fixed here:\n \n-241194 \u2013 math/gfan: fix build on 13.0-CURRENT\n+241194 \u2013 math/gfan: fix build on 13.0-CURRENT: https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=241194\n \n-https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=241194\n-\n+Patch: \n https://bz-attachments.freebsd.org/attachment.cgi?id=208243\n \n``````\n",
    "created_at": "2020-01-11T02:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457043",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,9 @@
+gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699).
+
 Same error as reported and fixed here:
 
-241194 – math/gfan: fix build on 13.0-CURRENT
+241194 – math/gfan: fix build on 13.0-CURRENT: https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=241194
 
-https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=241194
-
+Patch: 
 https://bz-attachments.freebsd.org/attachment.cgi?id=208243
 
``````




---

archive/issue_comments_457044.json:
```json
{
    "body": "<a id='comment:2'></a>\nCurrently sage's and sage's dependency C++ code is compiled with -std=c++11 unless overridden. This is autoconf macro's fault. So it won't be visible inside vanilla sage for the time being. But it is very important on distros. Also we should note that singular has a copy of \"libgfan\" based on the same code. There is probably an enforcement of c++11 in singular at the present time but the offending code may be there as well.\n\nHas upstream been contacted?",
    "created_at": "2020-01-11T02:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457044",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Currently sage's and sage's dependency C++ code is compiled with -std=c++11 unless overridden. This is autoconf macro's fault. So it won't be visible inside vanilla sage for the time being. But it is very important on distros. Also we should note that singular has a copy of "libgfan" based on the same code. There is probably an enforcement of c++11 in singular at the present time but the offending code may be there as well.

Has upstream been contacted?



---

archive/issue_comments_457045.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [fbissey](#comment%3A2):\n> Has upstream been contacted?\n\nI haven't contacted upstream.",
    "created_at": "2020-01-11T02:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457045",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Replying to [fbissey](#comment%3A2):
> Has upstream been contacted?

I haven't contacted upstream.



---

archive/issue_comments_457046.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699).\n+gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699) -- log for `conda-forge-minimal` see https://github.com/mkoeppe/sage/runs/542501523\n \n Same error as reported and fixed here:\n \n``````\n",
    "created_at": "2020-03-29T04:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457046",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699).
+gfan build fails with an error when `CXXFLAGS` includes `-std=c++14` (observed in a conda environment - #27699) -- log for `conda-forge-minimal` see https://github.com/mkoeppe/sage/runs/542501523
 
 Same error as reported and fixed here:
 
``````




---

archive/issue_comments_457047.json:
```json
{
    "body": "<a id='comment:5'></a>\nI'm using the following hack in conda-forge. https://github.com/conda-forge/gfan-feedstock/blob/master/recipe/build.sh#L9",
    "created_at": "2020-03-29T04:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457047",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:5'></a>
I'm using the following hack in conda-forge. https://github.com/conda-forge/gfan-feedstock/blob/master/recipe/build.sh#L9



---

archive/issue_events_261871.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T14:48:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28984#event-261871"
}
```



---

archive/issue_comments_457048.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Not yet reported upstream; Will do shortly.\".",
    "created_at": "2020-03-29T15:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457048",
    "user": "https://github.com/dimpase"
}
```

**Changing upstream** from "N/A" to "Not yet reported upstream; Will do shortly.".



---

archive/issue_comments_457049.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library)",
    "created_at": "2020-03-30T01:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457049",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library)



---

archive/issue_comments_457050.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-03-30T01:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457050",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_261872.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-30T01:55:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28984#event-261872"
}
```



---

archive/issue_comments_457051.json:
```json
{
    "body": "<a id='comment:9'></a>\nThat works.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686\">4f28ea0</a></td><td><code>gfan: Patch away log2 identifier clash</code></td></tr></table>\n",
    "created_at": "2020-03-30T01:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457051",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
That works.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686">4f28ea0</a></td><td><code>gfan: Patch away log2 identifier clash</code></td></tr></table>




---

archive/issue_comments_457052.json:
```json
{
    "body": "**Commit:** [4f28ea05aa4949313f772b6670fb9b7d78348686](https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686)",
    "created_at": "2020-03-30T01:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457052",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [4f28ea05aa4949313f772b6670fb9b7d78348686](https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686)



---

archive/issue_comments_457053.json:
```json
{
    "body": "<a id='comment:10'></a>\nLGTM",
    "created_at": "2020-03-30T02:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457053",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:10'></a>
LGTM



---

archive/issue_events_261873.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-03-30T02:07:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28984#event-261873"
}
```



---

archive/issue_events_261874.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-03-30T02:07:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28984#event-261874"
}
```



---

archive/issue_comments_457054.json:
```json
{
    "body": "**Reviewer:** Isuru Fernando",
    "created_at": "2020-03-30T02:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457054",
    "user": "https://github.com/isuruf"
}
```

**Reviewer:** Isuru Fernando



---

archive/issue_comments_457055.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks!",
    "created_at": "2020-03-30T04:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457055",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Thanks!



---

archive/issue_events_261875.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-09T22:45:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28984#event-261875"
}
```



---

archive/issue_events_261876.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-09T22:45:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28984#event-261876"
}
```



---

archive/issue_comments_457056.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library)\" to \"[4f28ea05aa4949313f772b6670fb9b7d78348686](https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686)\".",
    "created_at": "2020-04-09T22:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28984#issuecomment-457056",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfan___clash_of_log2_macro_with_standard_library)" to "[4f28ea05aa4949313f772b6670fb9b7d78348686](https://github.com/sagemath/sagetrac-mirror/commit/4f28ea05aa4949313f772b6670fb9b7d78348686)".
