# Issue 28487: Morphisms from p-adic rings and fields

archive/issues_028250.json:
```json
{
    "body": "The following should work:\n\n```\nsage: R.<x> = ZZ[]\nsage: K.<a> = Qq(25,modulus=x^2-2)\nsage: L.<b> = Qq(625,modulus=x^4-2)\nsage: K.hom([b^2])\n```\n\nKeywords: padicBordeaux\n\nBranch/Commit: 69ecb8176838817f9ad23ea92918d546d0c71234\n\nReviewer: Xavier Caruso\n\nAuthor: David Roe\n\nDependencies: #26105\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28487\n\n",
    "closed_at": "2019-10-13T09:31:23Z",
    "created_at": "2019-09-13T14:03:51Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Morphisms from p-adic rings and fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28487",
    "user": "https://github.com/roed314"
}
```
The following should work:

```
sage: R.<x> = ZZ[]
sage: K.<a> = Qq(25,modulus=x^2-2)
sage: L.<b> = Qq(625,modulus=x^4-2)
sage: K.hom([b^2])
```

Keywords: padicBordeaux

Branch/Commit: 69ecb8176838817f9ad23ea92918d546d0c71234

Reviewer: Xavier Caruso

Author: David Roe

Dependencies: #26105

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28487





---

archive/issue_comments_398556.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-13T15:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398556",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398557.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-09-13T15:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398557",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_398558.json:
```json
{
    "body": "Changing keywords from \"\" to \"padicBordeaux\".",
    "created_at": "2019-09-13T15:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398558",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "padicBordeaux".



---

archive/issue_comments_398559.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-13T23:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398559",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398560.json:
```json
{
    "body": "<a id='comment:5'></a>Couldn't we allow the construction `K.hom([x,y])` as a shortcut of `K.hom([x], base_map=K.base_ring().hom([y]))` for a two step extension?",
    "created_at": "2019-09-16T10:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398560",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:5'></a>Couldn't we allow the construction `K.hom([x,y])` as a shortcut of `K.hom([x], base_map=K.base_ring().hom([y]))` for a two step extension?



---

archive/issue_comments_398561.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-03T20:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398561",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398562.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-03T21:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398563.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-03T21:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398563",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398564.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-10T19:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398564",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398565.json:
```json
{
    "body": "<a id='comment:10'></a>Here's the diff against #26105:\n\n```\ndiff --git a/src/sage/rings/padics/padic_generic.py b/src/sage/rings/padics/padic_generic.py\nindex ea88eeb0d2..d80e48b1a0 100644\n--- a/src/sage/rings/padics/padic_generic.py\n+++ b/src/sage/rings/padics/padic_generic.py\n@@ -690,6 +690,50 @@ class pAdicGeneric(PrincipalIdealDomain, LocalGeneric):\n                         print_mode[option] = self._printer.dict()[option]\n         return ExtensionFactory(base=self, modulus=modulus, prec=prec, names=names, check = True, implementation=implementation, **print_mode)\n \n+    def _is_valid_homomorphism_(self, codomain, im_gens, base_map=None):\n+        \"\"\"\n+        Check whether the given images and map on the base ring determine a\n+        valid homomorphism to the codomain.\n+\n+        EXAMPLES::\n+\n+            sage: R.<x> = ZZ[]\n+            sage: K.<a> = Qq(25, modulus=x^2-2)\n+            sage: L.<b> = Qq(625, modulus=x^4-2)\n+            sage: K._is_valid_homomorphism_(L, [b^2])\n+            True\n+            sage: L._is_valid_homomorphism_(L, [b^3])\n+            False\n+            sage: z = L(-1).sqrt()\n+            sage: L._is_valid_homomorphism_(L, [z*b])\n+            True\n+            sage: L._is_valid_homomorphism_(L, [-b])\n+            True\n+\n+            sage: W.<w> = K.extension(x^2 - 5)\n+            sage: cc = K.hom([-a])\n+            sage: W._is_valid_homomorphism_(W, [w], base_map=cc)\n+            True\n+            sage: W._is_valid_homomorphism_(W, [-w], base_map=cc)\n+            True\n+            sage: W._is_valid_homomorphism_(W, [w+1])\n+            False\n+        \"\"\"\n+        K = self.base_ring()\n+        if base_map is None and not codomain.has_coerce_map_from(K):\n+            return False\n+        if len(im_gens) != 1:\n+            raise ValueError(\"Wrong number of generators\")\n+        if self is K:\n+            # Qp or Zp, so either base_map is not None or there's a coercion to the codomain\n+            # We check that the im_gens has the right length and value\n+            return im_gens[0] == codomain(self.prime())\n+        # Now we're an extension.  We check that the defining polynomial maps to zero\n+        f = self.modulus()\n+        if base_map is not None:\n+            f = f.change_ring(base_map)\n+        return f(im_gens[0]) == 0\n+\n     def _test_add(self, **options):\n         \"\"\"\n         Test addition of elements of this ring.\ndiff --git a/src/sage/rings/padics/padic_generic_element.pyx b/src/sage/rings/padics/padic_generic_element.pyx\nindex 4ff53800ce..efc040f0ed 100644\n--- a/src/sage/rings/padics/padic_generic_element.pyx\n+++ b/src/sage/rings/padics/padic_generic_element.pyx\n@@ -2277,6 +2277,50 @@ cdef class pAdicGenericElement(LocalGenericElement):\n             L += [Kbase(0)] * (K.relative_degree() - len(L))\n         return K(L)\n \n+    def _im_gens_(self, codomain, im_gens, base_map=None):\n+        \"\"\"\n+        Return the image of this element under the morphism defined by\n+        ``im_gens`` in ``codomain``, where elements of the\n+        base ring are mapped by ``base_map``.\n+\n+        EXAMPLES::\n+\n+            sage: R.<x> = ZZ[]\n+            sage: K.<a> = Qq(25, modulus=x^2-2)\n+            sage: L.<b> = Qq(625, modulus=x^4-2)\n+            sage: phi = K.hom([b^2]); phi(a+1)\n+            (b^2 + 1) + O(5^20)\n+            sage: z = L(-1).sqrt()\n+            sage: psi = L.hom([z*b]); psi(phi(a) + 5*b) == psi(phi(a)) + 5*psi(b)\n+            True\n+            sage: z = (1+5*b).log()\n+            sage: w = (5 - 5*b).exp()\n+            sage: psi(z*w) == psi(z) * psi(w)\n+            True\n+\n+            sage: P.<pi> = K.extension(x^2 - 5)\n+            sage: cc = K.hom([-a])\n+            sage: alpha = P.hom([pi], base_map=cc); alpha(a) + a\n+            O(pi^40)\n+            sage: zz = (1 + a*pi).log()\n+            sage: ww = pi.exp()\n+            sage: beta = P.hom([-pi], base_map=cc)\n+            sage: beta(ww*zz) == beta(ww)*beta(zz)\n+            True\n+        \"\"\"\n+        L = self.parent()\n+        K = L.base_ring()\n+        if L is K:\n+            # Qp or Zp, so there is a unique map\n+            if base_map is None:\n+                return codomain.coerce(self)\n+            else:\n+                return base_map(self)\n+        f = self.polynomial()\n+        if base_map is not None:\n+            f = f.change_ring(base_map)\n+        return f(im_gens[0])\n+\n     def _log_generic(self, aprec, mina=0):\n         r\"\"\"\n         Return ``\\log(self)`` for ``self`` equal to 1 in the residue field\n```",
    "created_at": "2019-10-10T19:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398565",
    "user": "https://github.com/roed314"
}
```

<a id='comment:10'></a>Here's the diff against #26105:

```
diff --git a/src/sage/rings/padics/padic_generic.py b/src/sage/rings/padics/padic_generic.py
index ea88eeb0d2..d80e48b1a0 100644
--- a/src/sage/rings/padics/padic_generic.py
+++ b/src/sage/rings/padics/padic_generic.py
@@ -690,6 +690,50 @@ class pAdicGeneric(PrincipalIdealDomain, LocalGeneric):
                         print_mode[option] = self._printer.dict()[option]
         return ExtensionFactory(base=self, modulus=modulus, prec=prec, names=names, check = True, implementation=implementation, **print_mode)
 
+    def _is_valid_homomorphism_(self, codomain, im_gens, base_map=None):
+        """
+        Check whether the given images and map on the base ring determine a
+        valid homomorphism to the codomain.
+
+        EXAMPLES::
+
+            sage: R.<x> = ZZ[]
+            sage: K.<a> = Qq(25, modulus=x^2-2)
+            sage: L.<b> = Qq(625, modulus=x^4-2)
+            sage: K._is_valid_homomorphism_(L, [b^2])
+            True
+            sage: L._is_valid_homomorphism_(L, [b^3])
+            False
+            sage: z = L(-1).sqrt()
+            sage: L._is_valid_homomorphism_(L, [z*b])
+            True
+            sage: L._is_valid_homomorphism_(L, [-b])
+            True
+
+            sage: W.<w> = K.extension(x^2 - 5)
+            sage: cc = K.hom([-a])
+            sage: W._is_valid_homomorphism_(W, [w], base_map=cc)
+            True
+            sage: W._is_valid_homomorphism_(W, [-w], base_map=cc)
+            True
+            sage: W._is_valid_homomorphism_(W, [w+1])
+            False
+        """
+        K = self.base_ring()
+        if base_map is None and not codomain.has_coerce_map_from(K):
+            return False
+        if len(im_gens) != 1:
+            raise ValueError("Wrong number of generators")
+        if self is K:
+            # Qp or Zp, so either base_map is not None or there's a coercion to the codomain
+            # We check that the im_gens has the right length and value
+            return im_gens[0] == codomain(self.prime())
+        # Now we're an extension.  We check that the defining polynomial maps to zero
+        f = self.modulus()
+        if base_map is not None:
+            f = f.change_ring(base_map)
+        return f(im_gens[0]) == 0
+
     def _test_add(self, **options):
         """
         Test addition of elements of this ring.
diff --git a/src/sage/rings/padics/padic_generic_element.pyx b/src/sage/rings/padics/padic_generic_element.pyx
index 4ff53800ce..efc040f0ed 100644
--- a/src/sage/rings/padics/padic_generic_element.pyx
+++ b/src/sage/rings/padics/padic_generic_element.pyx
@@ -2277,6 +2277,50 @@ cdef class pAdicGenericElement(LocalGenericElement):
             L += [Kbase(0)] * (K.relative_degree() - len(L))
         return K(L)
 
+    def _im_gens_(self, codomain, im_gens, base_map=None):
+        """
+        Return the image of this element under the morphism defined by
+        ``im_gens`` in ``codomain``, where elements of the
+        base ring are mapped by ``base_map``.
+
+        EXAMPLES::
+
+            sage: R.<x> = ZZ[]
+            sage: K.<a> = Qq(25, modulus=x^2-2)
+            sage: L.<b> = Qq(625, modulus=x^4-2)
+            sage: phi = K.hom([b^2]); phi(a+1)
+            (b^2 + 1) + O(5^20)
+            sage: z = L(-1).sqrt()
+            sage: psi = L.hom([z*b]); psi(phi(a) + 5*b) == psi(phi(a)) + 5*psi(b)
+            True
+            sage: z = (1+5*b).log()
+            sage: w = (5 - 5*b).exp()
+            sage: psi(z*w) == psi(z) * psi(w)
+            True
+
+            sage: P.<pi> = K.extension(x^2 - 5)
+            sage: cc = K.hom([-a])
+            sage: alpha = P.hom([pi], base_map=cc); alpha(a) + a
+            O(pi^40)
+            sage: zz = (1 + a*pi).log()
+            sage: ww = pi.exp()
+            sage: beta = P.hom([-pi], base_map=cc)
+            sage: beta(ww*zz) == beta(ww)*beta(zz)
+            True
+        """
+        L = self.parent()
+        K = L.base_ring()
+        if L is K:
+            # Qp or Zp, so there is a unique map
+            if base_map is None:
+                return codomain.coerce(self)
+            else:
+                return base_map(self)
+        f = self.polynomial()
+        if base_map is not None:
+            f = f.change_ring(base_map)
+        return f(im_gens[0])
+
     def _log_generic(self, aprec, mina=0):
         r"""
         Return ``\log(self)`` for ``self`` equal to 1 in the residue field
```



---

archive/issue_comments_398566.json:
```json
{
    "body": "<a id='comment:12'></a>Sorry, I pushed on the wrong ticket.",
    "created_at": "2019-10-10T20:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398566",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:12'></a>Sorry, I pushed on the wrong ticket.



---

archive/issue_comments_398567.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-11T05:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398567",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_398568.json:
```json
{
    "body": "<a id='comment:13'></a>Looks good to me.\n\nThe patchbot reported some failures and they seem unrelated to this ticket.",
    "created_at": "2019-10-11T05:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398568",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:13'></a>Looks good to me.

The patchbot reported some failures and they seem unrelated to this ticket.



---

archive/issue_events_071440.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-10-11T12:08:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28487#event-71440"
}
```



---

archive/issue_events_071441.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-13T09:31:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28487#event-71441"
}
```



---

archive/issue_comments_398569.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-13T09:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28487#issuecomment-398569",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
