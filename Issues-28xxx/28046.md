# Issue 28046: Improving the weight_function check in _check_weight_function method

archive/issues_027809.json:
```json
{
    "body": "Currently if any string is inputted as a weight in weight_function the _check_weight_function converts it into a float without raising any error.\nBut this can be problematic as per below example.\n\n\n```\n\nsage: g = digraphs.DeBruijn(2, 3)\nsage: def weight_function(e):\n....:     return e[2]\nsage: g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-7-f1977bafe148> in <module>()\n----> 1 g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)\n\n/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in shortest_path(self, u, v, by_weight, algorithm, weight_function, check_weight)\n  16250 \n  16251         if algorithm == \"Dijkstra_Bid\":\n> 16252             return self._backend.bidirectional_dijkstra(u, v, weight_function)\n  16253         elif algorithm == \"Dijkstra_Bid_NetworkX\":\n  16254             import networkx\n\n/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:19873)()\n   2262                         # negative value of distance + edge_label is stored in\n   2263                         # priority_queue to get minimum distance\n-> 2264                         pq.push(((-(distance + edge_label), side), (v, w)))\n   2265 \n   2266         # No meeting point has been found\n\nTypeError: unsupported operand type(s) for +: 'int' and 'str'\n\n```\n\nAlso this tickets also fixed some pep8 in examples.\n\nAssignee: @rajat1433\n\nCC:  @dcoudert\n\nBranch/Commit: a43b521903f21d45aff89154b09c299011a31204\n\nReviewer: David Coudert\n\nAuthor: Rajat Mittal\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28046\n\n",
    "closed_at": "2019-06-28T04:29:24Z",
    "created_at": "2019-06-23T01:40:38Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Improving the weight_function check in _check_weight_function method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28046",
    "user": "https://github.com/rajat1433"
}
```
Currently if any string is inputted as a weight in weight_function the _check_weight_function converts it into a float without raising any error.
But this can be problematic as per below example.


```

sage: g = digraphs.DeBruijn(2, 3)
sage: def weight_function(e):
....:     return e[2]
sage: g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-7-f1977bafe148> in <module>()
----> 1 g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)

/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in shortest_path(self, u, v, by_weight, algorithm, weight_function, check_weight)
  16250 
  16251         if algorithm == "Dijkstra_Bid":
> 16252             return self._backend.bidirectional_dijkstra(u, v, weight_function)
  16253         elif algorithm == "Dijkstra_Bid_NetworkX":
  16254             import networkx

/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:19873)()
   2262                         # negative value of distance + edge_label is stored in
   2263                         # priority_queue to get minimum distance
-> 2264                         pq.push(((-(distance + edge_label), side), (v, w)))
   2265 
   2266         # No meeting point has been found

TypeError: unsupported operand type(s) for +: 'int' and 'str'

```

Also this tickets also fixed some pep8 in examples.

Assignee: @rajat1433

CC:  @dcoudert

Branch/Commit: a43b521903f21d45aff89154b09c299011a31204

Reviewer: David Coudert

Author: Rajat Mittal

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28046





---

archive/issue_comments_544708.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-06-23T01:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544708",
    "user": "https://github.com/rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_comments_544709.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-rajat1433/28046_check_weight_fn\"",
    "created_at": "2019-06-23T01:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544709",
    "user": "https://github.com/rajat1433"
}
```

Changing branch from "" to "u/gh-rajat1433/28046_check_weight_fn"



---

archive/issue_comments_544710.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,23 +7,22 @@\n sage: g = digraphs.DeBruijn(2, 3)\n sage: shortest_path_func = g._backend.bidirectional_dijkstra\n sage: def weight_function(e):\n+....:     \n ....:     return e[2]\n ....: \n sage: shortest_path_func('000', '111', weight_function=weight_function)\n ---------------------------------------------------------------------------\n TypeError                                 Traceback (most recent call last)\n-<ipython-input-8-c0f776a1b620> in <module>()\n+<ipython-input-4-c0f776a1b620> in <module>()\n ----> 1 shortest_path_func('000', '111', weight_function=weight_function)\n \n-/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:24892)()\n-   2707                         # negative value of distance + edge_label is stored in\n-   2708                         # priority_queue to get minimum distance\n--> 2709                         pq.push(((-(distance + edge_label), side), (v, w)))\n-   2710 \n-   2711         # No meeting point has been found\n+/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:19873)()\n+   2262                         # negative value of distance + edge_label is stored in\n+   2263                         # priority_queue to get minimum distance\n+-> 2264                         pq.push(((-(distance + edge_label), side), (v, w)))\n+   2265 \n+   2266         # No meeting point has been found\n \n TypeError: unsupported operand type(s) for +: 'int' and 'str'\n+\n ```\n-\n-So this ticket aims at fixing this issue.\n-\n``````\n",
    "created_at": "2019-06-23T01:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544710",
    "user": "https://github.com/rajat1433"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,23 +7,22 @@
 sage: g = digraphs.DeBruijn(2, 3)
 sage: shortest_path_func = g._backend.bidirectional_dijkstra
 sage: def weight_function(e):
+....:     
 ....:     return e[2]
 ....: 
 sage: shortest_path_func('000', '111', weight_function=weight_function)
 ---------------------------------------------------------------------------
 TypeError                                 Traceback (most recent call last)
-<ipython-input-8-c0f776a1b620> in <module>()
+<ipython-input-4-c0f776a1b620> in <module>()
 ----> 1 shortest_path_func('000', '111', weight_function=weight_function)
 
-/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:24892)()
-   2707                         # negative value of distance + edge_label is stored in
-   2708                         # priority_queue to get minimum distance
--> 2709                         pq.push(((-(distance + edge_label), side), (v, w)))
-   2710 
-   2711         # No meeting point has been found
+/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:19873)()
+   2262                         # negative value of distance + edge_label is stored in
+   2263                         # priority_queue to get minimum distance
+-> 2264                         pq.push(((-(distance + edge_label), side), (v, w)))
+   2265 
+   2266         # No meeting point has been found
 
 TypeError: unsupported operand type(s) for +: 'int' and 'str'
+
 ```
-
-So this ticket aims at fixing this issue.
-
``````




---

archive/issue_comments_544711.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,16 +5,20 @@\n ```\n \n sage: g = digraphs.DeBruijn(2, 3)\n-sage: shortest_path_func = g._backend.bidirectional_dijkstra\n sage: def weight_function(e):\n-....:     \n ....:     return e[2]\n-....: \n-sage: shortest_path_func('000', '111', weight_function=weight_function)\n+sage: g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)\n ---------------------------------------------------------------------------\n TypeError                                 Traceback (most recent call last)\n-<ipython-input-4-c0f776a1b620> in <module>()\n-----> 1 shortest_path_func('000', '111', weight_function=weight_function)\n+<ipython-input-7-f1977bafe148> in <module>()\n+----> 1 g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)\n+\n+/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in shortest_path(self, u, v, by_weight, algorithm, weight_function, check_weight)\n+  16250 \n+  16251         if algorithm == \"Dijkstra_Bid\":\n+> 16252             return self._backend.bidirectional_dijkstra(u, v, weight_function)\n+  16253         elif algorithm == \"Dijkstra_Bid_NetworkX\":\n+  16254             import networkx\n \n /home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:19873)()\n    2262                         # negative value of distance + edge_label is stored in\n``````\n",
    "created_at": "2019-06-23T01:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544711",
    "user": "https://github.com/rajat1433"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,16 +5,20 @@
 ```
 
 sage: g = digraphs.DeBruijn(2, 3)
-sage: shortest_path_func = g._backend.bidirectional_dijkstra
 sage: def weight_function(e):
-....:     
 ....:     return e[2]
-....: 
-sage: shortest_path_func('000', '111', weight_function=weight_function)
+sage: g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)
 ---------------------------------------------------------------------------
 TypeError                                 Traceback (most recent call last)
-<ipython-input-4-c0f776a1b620> in <module>()
-----> 1 shortest_path_func('000', '111', weight_function=weight_function)
+<ipython-input-7-f1977bafe148> in <module>()
+----> 1 g.shortest_path('000', '111', by_weight=True, weight_function=weight_function)
+
+/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in shortest_path(self, u, v, by_weight, algorithm, weight_function, check_weight)
+  16250 
+  16251         if algorithm == "Dijkstra_Bid":
+> 16252             return self._backend.bidirectional_dijkstra(u, v, weight_function)
+  16253         elif algorithm == "Dijkstra_Bid_NetworkX":
+  16254             import networkx
 
 /home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:19873)()
    2262                         # negative value of distance + edge_label is stored in
``````




---

archive/issue_comments_544712.json:
```json
{
    "body": "Changing commit from \"\" to \"57000f8b731de830c4a0d8e12c0e8301a8d5175d\"",
    "created_at": "2019-06-23T02:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "57000f8b731de830c4a0d8e12c0e8301a8d5175d"



---

archive/issue_comments_544713.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[44abefa](https://github.com/sagemath/sagetrac-mirror/commit/44abefa3166d929e01b49f6f217b016d9bb3bbef)|`fixed graphs_weight_fn check`|\n|[57000f8](https://github.com/sagemath/sagetrac-mirror/commit/57000f8b731de830c4a0d8e12c0e8301a8d5175d)|`add example`|",
    "created_at": "2019-06-23T02:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[44abefa](https://github.com/sagemath/sagetrac-mirror/commit/44abefa3166d929e01b49f6f217b016d9bb3bbef)|`fixed graphs_weight_fn check`|
|[57000f8](https://github.com/sagemath/sagetrac-mirror/commit/57000f8b731de830c4a0d8e12c0e8301a8d5175d)|`add example`|



---

archive/issue_comments_544714.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,3 +30,5 @@\n TypeError: unsupported operand type(s) for +: 'int' and 'str'\n \n ```\n+\n+Also this tickets also fixed some pep8 in examples.\n``````\n",
    "created_at": "2019-06-23T02:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544714",
    "user": "https://github.com/rajat1433"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,3 +30,5 @@
 TypeError: unsupported operand type(s) for +: 'int' and 'str'
 
 ```
+
+Also this tickets also fixed some pep8 in examples.
``````




---

archive/issue_comments_544715.json:
```json
{
    "body": "<a id='comment:6'></a>\n- The doctest with `G = digraphs.DeBruijn(2, 3)` is failing with Python 3: the tested edge is not the same.\nSo use instead `G = Graph({0: {1: '123'}})` \n\n- Use a temporary variable to store `weight_function(e)` and so avoid to call the function twice.\n\n- In the `raise` statement of the `if isinstance(...):`, there is not need for a proper message.  Here, you can raise what you want, the error message will be catch by the except statement.",
    "created_at": "2019-06-23T08:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544715",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
- The doctest with `G = digraphs.DeBruijn(2, 3)` is failing with Python 3: the tested edge is not the same.
So use instead `G = Graph({0: {1: '123'}})` 

- Use a temporary variable to store `weight_function(e)` and so avoid to call the function twice.

- In the `raise` statement of the `if isinstance(...):`, there is not need for a proper message.  Here, you can raise what you want, the error message will be catch by the except statement.



---

archive/issue_comments_544716.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlso, in Python3 we will have the `str` versus `bytes` issue..., so use `isinstance(weight_function(e), (str, bytes))`",
    "created_at": "2019-06-23T08:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544716",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>
Also, in Python3 we will have the `str` versus `bytes` issue..., so use `isinstance(weight_function(e), (str, bytes))`



---

archive/issue_comments_544717.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[a43b521](https://github.com/sagemath/sagetrac-mirror/commit/a43b521903f21d45aff89154b09c299011a31204)|`fixed test and code`|",
    "created_at": "2019-06-23T09:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[a43b521](https://github.com/sagemath/sagetrac-mirror/commit/a43b521903f21d45aff89154b09c299011a31204)|`fixed test and code`|



---

archive/issue_comments_544718.json:
```json
{
    "body": "Changing commit from \"57000f8b731de830c4a0d8e12c0e8301a8d5175d\" to \"a43b521903f21d45aff89154b09c299011a31204\"",
    "created_at": "2019-06-23T09:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "57000f8b731de830c4a0d8e12c0e8301a8d5175d" to "a43b521903f21d45aff89154b09c299011a31204"



---

archive/issue_comments_544719.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-23T09:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544719",
    "user": "https://github.com/rajat1433"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_544720.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-23T09:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544720",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_544721.json:
```json
{
    "body": "<a id='comment:10'></a>\nLGTM.",
    "created_at": "2019-06-23T09:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544721",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
LGTM.



---

archive/issue_events_078789.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-28T04:29:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28046#event-78789"
}
```



---

archive/issue_comments_544722.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-28T04:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544722",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_544723.json:
```json
{
    "body": "Changing branch from \"u/gh-rajat1433/28046_check_weight_fn\" to \"a43b521903f21d45aff89154b09c299011a31204\"",
    "created_at": "2019-06-28T04:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28046",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28046#issuecomment-544723",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-rajat1433/28046_check_weight_fn" to "a43b521903f21d45aff89154b09c299011a31204"
