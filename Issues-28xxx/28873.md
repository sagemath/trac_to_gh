# Issue 28873: Implement ambient volume of polyhedron with normaliz

archive/issues_028636.json:
```json
{
    "assignees": [],
    "body": "We implement the ambient volume using backend normaliz.\n\nThis is done by return 0 or infinity if the polyhedron is not full-dimensional and not compact respectively.\n\nOtherwise, we take the `induced_lattice` volume and divide by `factorial(self.dim())`.\n\nSee section 6.1.1 of the normaliz manual on how `induced_lattice` volume relates to euclidean volume: [https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf](https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf)\n\nThis is much faster than the current method, so we set this to default if backend is normaliz.\n\n```\nsage: P = polytopes.dodecahedron(backend='normaliz')\nsage: %time P.volume(engine='normaliz')\nCPU times: user 3.91 ms, sys: 0 ns, total: 3.91 ms\nWall time: 1.49 ms\n-176*sqrt5 + 400\nsage: %time P.volume(engine='internal')\nCPU times: user 26.5 ms, sys: 332 \u00b5s, total: 26.9 ms\nWall time: 27.5 ms\n-176*sqrt5 + 400\n```\n\n```\nsage: P = polytopes.one_hundred_twenty_cell(backend='normaliz')\nsage: %time P.volume(engine='normaliz')\nCPU times: user 1.5 s, sys: 0 ns, total: 1.5 s\nWall time: 210 ms\n120*sqrt5\nsage: %time P.volume(engine='internal')\nCPU times: user 8.61 s, sys: 14.7 ms, total: 8.63 s\nWall time: 8.63 s\n120*sqrt5\n```\n\n```\nsage: P = polytopes.hypercube(6, backend='normaliz')\nsage: %time P.volume(engine='normaliz')\nCPU times: user 2.33 ms, sys: 0 ns, total: 2.33 ms\nWall time: 2.34 ms\n64\nsage: %time P.volume(engine='internal')\nCPU times: user 183 ms, sys: 32 \u00b5s, total: 183 ms\nWall time: 182 ms\n64\n```\n\nThis also speeds up calculation in case the polyhedron is not full-dimensional:\n\n```\nsage: P = polytopes.permutahedron(6, backend='normaliz')\nsage: %time P.volume(measure='induced')\nCPU times: user 37.7 s, sys: 42.4 ms, total: 37.7 s\nWall time: 24.2 s\n1296*sqrt(6)\nsage: %time P.volume(engine='internal', measure='induced')\nCPU times: user 42.9 s, sys: 71.9 ms, total: 43 s\nWall time: 41.8 s\n1296*sqrt(6)\n```\n\nHowever, note that calculation of the affine hull takes quite some time in this case. So we leave the inexact normaliz option for now:\n\n```\nsage: %time P.volume(engine='normaliz', measure='induced')\nCPU times: user 710 ms, sys: 0 ns, total: 710 ms\nWall time: 92.3 ms\n3174.5387066469984\n```\n\nPossible follow ups:\n\nThere is probably a good and fast way to convert the lattice volume to the euclidean volume exactly. Also, once we can set up a normaliz polyhedron with both Vrep and Hrep, affine hull should be really quick.\n\nDepends on #28872\n\nCC:  @jplab @LaisRast\n\nKeywords: **polyhedron, normaliz, ambient volume**\n\nBranch/Commit: **[cc808dd](https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8)**\n\nReviewer: **Jean-Philippe Labb\u00e9**\n\nAuthor: **Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28873_\n\n",
    "closed_at": "2020-04-23T22:33:01Z",
    "created_at": "2019-12-12T07:50:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement ambient volume of polyhedron with normaliz",
    "type": "issue",
    "updated_at": "2020-04-23T22:33:01Z",
    "url": "https://github.com/sagemath/sage/issues/28873",
    "user": "https://github.com/kliem"
}
```
We implement the ambient volume using backend normaliz.

This is done by return 0 or infinity if the polyhedron is not full-dimensional and not compact respectively.

Otherwise, we take the `induced_lattice` volume and divide by `factorial(self.dim())`.

See section 6.1.1 of the normaliz manual on how `induced_lattice` volume relates to euclidean volume: [https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf](https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf)

This is much faster than the current method, so we set this to default if backend is normaliz.

```
sage: P = polytopes.dodecahedron(backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 3.91 ms, sys: 0 ns, total: 3.91 ms
Wall time: 1.49 ms
-176*sqrt5 + 400
sage: %time P.volume(engine='internal')
CPU times: user 26.5 ms, sys: 332 µs, total: 26.9 ms
Wall time: 27.5 ms
-176*sqrt5 + 400
```

```
sage: P = polytopes.one_hundred_twenty_cell(backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 1.5 s, sys: 0 ns, total: 1.5 s
Wall time: 210 ms
120*sqrt5
sage: %time P.volume(engine='internal')
CPU times: user 8.61 s, sys: 14.7 ms, total: 8.63 s
Wall time: 8.63 s
120*sqrt5
```

```
sage: P = polytopes.hypercube(6, backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 2.33 ms, sys: 0 ns, total: 2.33 ms
Wall time: 2.34 ms
64
sage: %time P.volume(engine='internal')
CPU times: user 183 ms, sys: 32 µs, total: 183 ms
Wall time: 182 ms
64
```

This also speeds up calculation in case the polyhedron is not full-dimensional:

```
sage: P = polytopes.permutahedron(6, backend='normaliz')
sage: %time P.volume(measure='induced')
CPU times: user 37.7 s, sys: 42.4 ms, total: 37.7 s
Wall time: 24.2 s
1296*sqrt(6)
sage: %time P.volume(engine='internal', measure='induced')
CPU times: user 42.9 s, sys: 71.9 ms, total: 43 s
Wall time: 41.8 s
1296*sqrt(6)
```

However, note that calculation of the affine hull takes quite some time in this case. So we leave the inexact normaliz option for now:

```
sage: %time P.volume(engine='normaliz', measure='induced')
CPU times: user 710 ms, sys: 0 ns, total: 710 ms
Wall time: 92.3 ms
3174.5387066469984
```

Possible follow ups:

There is probably a good and fast way to convert the lattice volume to the euclidean volume exactly. Also, once we can set up a normaliz polyhedron with both Vrep and Hrep, affine hull should be really quick.

Depends on #28872

CC:  @jplab @LaisRast

Keywords: **polyhedron, normaliz, ambient volume**

Branch/Commit: **[cc808dd](https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8)**

Reviewer: **Jean-Philippe Labbé**

Author: **Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/28873_





---

archive/issue_events_378396.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-12T07:50:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378396"
}
```



---

archive/issue_events_378397.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-12T07:50:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378397"
}
```



---

archive/issue_events_378398.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-12T07:50:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378398"
}
```



---

archive/issue_events_378399.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-12T07:50:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378399"
}
```



---

archive/issue_comments_453509.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a15a44b8702bcd05d441f794493be350ce461f4\">6a15a44</a></td><td><code>raised error instead of crashing for a bug in normaliz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/516a62270a54e6d15f32e87241cf953a4f5daf75\">516a622</a></td><td><code>actually fixing our error</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f99cf7e9dedd2d5220f6409576041d065757e3c9\">f99cf7e</a></td><td><code>implement ambient volume using normaliz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f92b7b501c81e5dea25203681dce756307c5d6c\">2f92b7b</a></td><td><code>took care of non-compact case</code></td></tr></table>\n",
    "created_at": "2019-12-12T07:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453509",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a15a44b8702bcd05d441f794493be350ce461f4">6a15a44</a></td><td><code>raised error instead of crashing for a bug in normaliz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/516a62270a54e6d15f32e87241cf953a4f5daf75">516a622</a></td><td><code>actually fixing our error</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f99cf7e9dedd2d5220f6409576041d065757e3c9">f99cf7e</a></td><td><code>implement ambient volume using normaliz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f92b7b501c81e5dea25203681dce756307c5d6c">2f92b7b</a></td><td><code>took care of non-compact case</code></td></tr></table>




---

archive/issue_events_378400.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-12T07:51:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378400"
}
```



---

archive/issue_comments_453510.json:
```json
{
    "body": "Commit: **[2f92b7b](https://github.com/sagemath/sagetrac-mirror/commit/2f92b7b501c81e5dea25203681dce756307c5d6c)**",
    "created_at": "2019-12-12T07:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453510",
    "user": "https://github.com/kliem"
}
```

Commit: **[2f92b7b](https://github.com/sagemath/sagetrac-mirror/commit/2f92b7b501c81e5dea25203681dce756307c5d6c)**



---

archive/issue_comments_453511.json:
```json
{
    "body": "Branch: **[public/28873](https://github.com/sagemath/sagetrac-mirror/tree/public/28873)**",
    "created_at": "2019-12-12T07:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453511",
    "user": "https://github.com/kliem"
}
```

Branch: **[public/28873](https://github.com/sagemath/sagetrac-mirror/tree/public/28873)**



---

archive/issue_comments_453512.json:
```json
{
    "body": "Changed commit from **[2f92b7b](https://github.com/sagemath/sagetrac-mirror/commit/2f92b7b501c81e5dea25203681dce756307c5d6c)** to **[a35dc82](https://github.com/sagemath/sagetrac-mirror/commit/a35dc82c5d26c74e935f0c1b6d054e2efe3467be)**",
    "created_at": "2019-12-12T07:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453512",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2f92b7b](https://github.com/sagemath/sagetrac-mirror/commit/2f92b7b501c81e5dea25203681dce756307c5d6c)** to **[a35dc82](https://github.com/sagemath/sagetrac-mirror/commit/a35dc82c5d26c74e935f0c1b6d054e2efe3467be)**



---

archive/issue_comments_453513.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a35dc82c5d26c74e935f0c1b6d054e2efe3467be\">a35dc82</a></td><td><code>removed not needed method</code></td></tr></table>\n",
    "created_at": "2019-12-12T07:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453513",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a35dc82c5d26c74e935f0c1b6d054e2efe3467be">a35dc82</a></td><td><code>removed not needed method</code></td></tr></table>




---

archive/issue_comments_453514.json:
```json
{
    "body": "Changed branch from **[public/28873](https://github.com/sagemath/sagetrac-mirror/tree/public/28873)** to **[public/28873-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb)**",
    "created_at": "2019-12-26T21:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453514",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/28873](https://github.com/sagemath/sagetrac-mirror/tree/public/28873)** to **[public/28873-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb)**



---

archive/issue_comments_453515.json:
```json
{
    "body": "Changed commit from **[a35dc82](https://github.com/sagemath/sagetrac-mirror/commit/a35dc82c5d26c74e935f0c1b6d054e2efe3467be)** to **[a349c8c](https://github.com/sagemath/sagetrac-mirror/commit/a349c8ce2614c117aeea58a98d0ae0a0312035f7)**",
    "created_at": "2019-12-26T21:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453515",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[a35dc82](https://github.com/sagemath/sagetrac-mirror/commit/a35dc82c5d26c74e935f0c1b6d054e2efe3467be)** to **[a349c8c](https://github.com/sagemath/sagetrac-mirror/commit/a349c8ce2614c117aeea58a98d0ae0a0312035f7)**



---

archive/issue_comments_453516.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4046e3a9fd486bf2292005bdfe0996368e4926e9\">4046e3a</a></td><td><code>implement ambient volume using normaliz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/485cc64131ca6d2461b033cf31a983cd0295ae3a\">485cc64</a></td><td><code>took care of non-compact case</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6985bf8343378cca342d681e35795e7ebec5a390\">6985bf8</a></td><td><code>removed not needed method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/591d3b146d31b1c78a87c1fdc86e4611dd9bd98d\">591d3b1</a></td><td><code>fix pyflakes warning; added optional flag</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a349c8ce2614c117aeea58a98d0ae0a0312035f7\">a349c8c</a></td><td><code>undid change regarding strange conversion of normaliz `Sublattice` output</code></td></tr></table>\n",
    "created_at": "2019-12-26T21:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453516",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4046e3a9fd486bf2292005bdfe0996368e4926e9">4046e3a</a></td><td><code>implement ambient volume using normaliz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/485cc64131ca6d2461b033cf31a983cd0295ae3a">485cc64</a></td><td><code>took care of non-compact case</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6985bf8343378cca342d681e35795e7ebec5a390">6985bf8</a></td><td><code>removed not needed method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/591d3b146d31b1c78a87c1fdc86e4611dd9bd98d">591d3b1</a></td><td><code>fix pyflakes warning; added optional flag</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a349c8ce2614c117aeea58a98d0ae0a0312035f7">a349c8c</a></td><td><code>undid change regarding strange conversion of normaliz `Sublattice` output</code></td></tr></table>




---

archive/issue_comments_453517.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/add61a5dcf0194da376d34e2c3959c22d2b48bb4\">add61a5</a></td><td><code>undo false alignment</code></td></tr></table>\n",
    "created_at": "2019-12-26T21:38:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453517",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/add61a5dcf0194da376d34e2c3959c22d2b48bb4">add61a5</a></td><td><code>undo false alignment</code></td></tr></table>




---

archive/issue_comments_453518.json:
```json
{
    "body": "Changed commit from **[a349c8c](https://github.com/sagemath/sagetrac-mirror/commit/a349c8ce2614c117aeea58a98d0ae0a0312035f7)** to **[add61a5](https://github.com/sagemath/sagetrac-mirror/commit/add61a5dcf0194da376d34e2c3959c22d2b48bb4)**",
    "created_at": "2019-12-26T21:38:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453518",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a349c8c](https://github.com/sagemath/sagetrac-mirror/commit/a349c8ce2614c117aeea58a98d0ae0a0312035f7)** to **[add61a5](https://github.com/sagemath/sagetrac-mirror/commit/add61a5dcf0194da376d34e2c3959c22d2b48bb4)**



---

archive/issue_comments_453519.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIt should be noted that the conversion of the normaliz output does not work correctly when computing `Sublattice` for algebraic polyhedra.",
    "created_at": "2019-12-26T21:45:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453519",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'>Comment 5:</a>
It should be noted that the conversion of the normaliz output does not work correctly when computing `Sublattice` for algebraic polyhedra.



---

archive/issue_comments_453520.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -44,6 +44,29 @@\n 64\n ```\n \n-Follow up:\n+This also speeds up calculation in case the polyhedron is not full-dimensional:\n \n-Once `affine_hull` completely respects the backend, this method will be used to calculate the induced volume by default (automatically).\n+```\n+sage: P = polytopes.permutahedron(6, backend='normaliz')\n+sage: %time P.volume(measure='induced')\n+CPU times: user 37.7 s, sys: 42.4 ms, total: 37.7 s\n+Wall time: 24.2 s\n+1296*sqrt(6)\n+sage: %time P.volume(engine='internal', measure='induced')\n+CPU times: user 42.9 s, sys: 71.9 ms, total: 43 s\n+Wall time: 41.8 s\n+1296*sqrt(6)\n+```\n+\n+However, note that calculation of the affine hull takes quite some time in this case. So we leave the inexact normaliz option for now:\n+\n+```\n+sage: %time P.volume(engine='normaliz', measure='induced')\n+CPU times: user 710 ms, sys: 0 ns, total: 710 ms\n+Wall time: 92.3 ms\n+3174.5387066469984\n+```\n+\n+Possible follow ups:\n+\n+There is probably a good and fast way to convert the lattice volume to the euclidean volume exactly. Also, once we can set up a normaliz polyhedron with both Vrep and Hrep, affine hull should be really quick.\n``````\n",
    "created_at": "2019-12-26T22:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453520",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -44,6 +44,29 @@
 64
 ```
 
-Follow up:
+This also speeds up calculation in case the polyhedron is not full-dimensional:
 
-Once `affine_hull` completely respects the backend, this method will be used to calculate the induced volume by default (automatically).
+```
+sage: P = polytopes.permutahedron(6, backend='normaliz')
+sage: %time P.volume(measure='induced')
+CPU times: user 37.7 s, sys: 42.4 ms, total: 37.7 s
+Wall time: 24.2 s
+1296*sqrt(6)
+sage: %time P.volume(engine='internal', measure='induced')
+CPU times: user 42.9 s, sys: 71.9 ms, total: 43 s
+Wall time: 41.8 s
+1296*sqrt(6)
+```
+
+However, note that calculation of the affine hull takes quite some time in this case. So we leave the inexact normaliz option for now:
+
+```
+sage: %time P.volume(engine='normaliz', measure='induced')
+CPU times: user 710 ms, sys: 0 ns, total: 710 ms
+Wall time: 92.3 ms
+3174.5387066469984
+```
+
+Possible follow ups:
+
+There is probably a good and fast way to convert the lattice volume to the euclidean volume exactly. Also, once we can set up a normaliz polyhedron with both Vrep and Hrep, affine hull should be really quick.
``````




---

archive/issue_events_378401.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378401"
}
```



---

archive/issue_events_378402.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378402"
}
```



---

archive/issue_comments_453521.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453521",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'>Comment 7:</a>
Ticket retargeted after milestone closed



---

archive/issue_comments_453522.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nRebased.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0797f5ae613226eacb57b2f1d48579f835f5ca58\">0797f5a</a></td><td><code>implement ambient volume using normaliz</code></td></tr></table>\n",
    "created_at": "2020-03-27T15:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453522",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'>Comment 8:</a>
Rebased.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0797f5ae613226eacb57b2f1d48579f835f5ca58">0797f5a</a></td><td><code>implement ambient volume using normaliz</code></td></tr></table>




---

archive/issue_comments_453523.json:
```json
{
    "body": "Changed branch from **[public/28873-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb)** to **[public/28873-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb2)**",
    "created_at": "2020-03-27T15:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453523",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/28873-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb)** to **[public/28873-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb2)**



---

archive/issue_comments_453524.json:
```json
{
    "body": "Changed commit from **[add61a5](https://github.com/sagemath/sagetrac-mirror/commit/add61a5dcf0194da376d34e2c3959c22d2b48bb4)** to **[0797f5a](https://github.com/sagemath/sagetrac-mirror/commit/0797f5ae613226eacb57b2f1d48579f835f5ca58)**",
    "created_at": "2020-03-27T15:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453524",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[add61a5](https://github.com/sagemath/sagetrac-mirror/commit/add61a5dcf0194da376d34e2c3959c22d2b48bb4)** to **[0797f5a](https://github.com/sagemath/sagetrac-mirror/commit/0797f5ae613226eacb57b2f1d48579f835f5ca58)**



---

archive/issue_comments_453525.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453525",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_378403.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378403"
}
```



---

archive/issue_events_378404.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378404"
}
```



---

archive/issue_comments_453526.json:
```json
{
    "body": "Reviewer: **Jean-Philippe Labb\u00e9**",
    "created_at": "2020-04-19T13:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453526",
    "user": "https://github.com/jplab"
}
```

Reviewer: **Jean-Philippe Labbé**



---

archive/issue_events_378405.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-04-19T13:40:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378405"
}
```



---

archive/issue_events_378406.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-04-19T13:40:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378406"
}
```



---

archive/issue_comments_453527.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nYou should add the reference to the manual in the documentation of the function. That would be a good improvement.",
    "created_at": "2020-04-19T13:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453527",
    "user": "https://github.com/jplab"
}
```

<a id='comment:10'>Comment 10:</a>
You should add the reference to the manual in the documentation of the function. That would be a good improvement.



---

archive/issue_comments_453528.json:
```json
{
    "body": "Changed commit from **[0797f5a](https://github.com/sagemath/sagetrac-mirror/commit/0797f5ae613226eacb57b2f1d48579f835f5ca58)** to **[6a3d5b4](https://github.com/sagemath/sagetrac-mirror/commit/6a3d5b4056a69118ef0a15ff84f3eb0ce155bf47)**",
    "created_at": "2020-04-19T14:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453528",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[0797f5a](https://github.com/sagemath/sagetrac-mirror/commit/0797f5ae613226eacb57b2f1d48579f835f5ca58)** to **[6a3d5b4](https://github.com/sagemath/sagetrac-mirror/commit/6a3d5b4056a69118ef0a15ff84f3eb0ce155bf47)**



---

archive/issue_comments_453529.json:
```json
{
    "body": "Changed branch from **[public/28873-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb2)** to **[public/28873-reb3](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb3)**",
    "created_at": "2020-04-19T14:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453529",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/28873-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb2)** to **[public/28873-reb3](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb3)**



---

archive/issue_comments_453530.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/548d302ad38f9b1a25a6258dbea16058de0fc888\">548d302</a></td><td><code>Merge branch 'public/28873-reb2' of git://trac.sagemath.org/sage into public/28873-reb3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a3d5b4056a69118ef0a15ff84f3eb0ce155bf47\">6a3d5b4</a></td><td><code>added reference</code></td></tr></table>\n",
    "created_at": "2020-04-19T14:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453530",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'>Comment 11:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/548d302ad38f9b1a25a6258dbea16058de0fc888">548d302</a></td><td><code>Merge branch 'public/28873-reb2' of git://trac.sagemath.org/sage into public/28873-reb3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a3d5b4056a69118ef0a15ff84f3eb0ce155bf47">6a3d5b4</a></td><td><code>added reference</code></td></tr></table>




---

archive/issue_events_378407.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-19T14:24:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378407"
}
```



---

archive/issue_events_378408.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-19T14:24:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378408"
}
```



---

archive/issue_comments_453531.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nIt would be nice to have this in 9.1, if possible.",
    "created_at": "2020-04-19T14:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453531",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'>Comment 12:</a>
It would be nice to have this in 9.1, if possible.



---

archive/issue_comments_453532.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nIs the following \"unimodual\" a typo? Is unimodular meant?\n\n```diff\n+        One other possibility is to compute the scaled volume where a unimodual\n```\n\nThere is also\n\n```diff\n+        volume of the unimodal simplex (or zero if not full-dimensional)::\n```\n\nUnimodular?\n\nCould you check if this occurs in the rest of the file too?\n\nOtherwise, the ticket looks good and the bots are green on 9.1rc0, so you can put this on positive review on my behalf once you considered the above comments.",
    "created_at": "2020-04-20T09:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453532",
    "user": "https://github.com/jplab"
}
```

<a id='comment:13'>Comment 13:</a>
Is the following "unimodual" a typo? Is unimodular meant?

```diff
+        One other possibility is to compute the scaled volume where a unimodual
```

There is also

```diff
+        volume of the unimodal simplex (or zero if not full-dimensional)::
```

Unimodular?

Could you check if this occurs in the rest of the file too?

Otherwise, the ticket looks good and the bots are green on 9.1rc0, so you can put this on positive review on my behalf once you considered the above comments.



---

archive/issue_events_378409.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-04-20T09:23:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378409"
}
```



---

archive/issue_events_378410.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-04-20T09:23:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378410"
}
```



---

archive/issue_comments_453533.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8\">cc808dd</a></td><td><code>typo with unimodular</code></td></tr></table>\n",
    "created_at": "2020-04-20T10:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453533",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8">cc808dd</a></td><td><code>typo with unimodular</code></td></tr></table>




---

archive/issue_comments_453534.json:
```json
{
    "body": "Changed commit from **[6a3d5b4](https://github.com/sagemath/sagetrac-mirror/commit/6a3d5b4056a69118ef0a15ff84f3eb0ce155bf47)** to **[cc808dd](https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8)**",
    "created_at": "2020-04-20T10:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453534",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6a3d5b4](https://github.com/sagemath/sagetrac-mirror/commit/6a3d5b4056a69118ef0a15ff84f3eb0ce155bf47)** to **[cc808dd](https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8)**



---

archive/issue_events_378411.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-20T10:29:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378411"
}
```



---

archive/issue_events_378412.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-20T10:29:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378412"
}
```



---

archive/issue_events_378413.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-20T10:29:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378413"
}
```



---

archive/issue_events_378414.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-20T10:29:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378414"
}
```



---

archive/issue_events_378415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-23T22:33:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378415"
}
```



---

archive/issue_events_378416.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3e49dccf5dd39ee8af9182ab38d01abca0b85427",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-23T22:33:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28873#event-378416"
}
```



---

archive/issue_comments_453535.json:
```json
{
    "body": "Changed branch from **[public/28873-reb3](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb3)** to **[cc808dd](https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8)**",
    "created_at": "2020-04-23T22:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28873#issuecomment-453535",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/28873-reb3](https://github.com/sagemath/sagetrac-mirror/tree/public/28873-reb3)** to **[cc808dd](https://github.com/sagemath/sagetrac-mirror/commit/cc808ddf0aa4c094426d799f26bebaf5a2b5c3e8)**
