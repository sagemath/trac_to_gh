# Issue 28393: internal function of fricas appearing

archive/issues_028393.json:
```json
{
    "body": "CC:  @hemmecke whuss @rwst @fchapoton @mantepse\n\nKeywords: FriCAS\n\nAs reported on [this ask question](https://ask.sagemath.org/question/48409/possible-invalid-latex-translation-from-fricas-result), we have:\n\n```\nsage: f = polylog(3, x)\nsage: f.integral(x, algorithm='fricas')\n-x*%iint(x, -log(-x + 1)/x) - (x - 1)*log(-x + 1) + x*polylog(3, x) + x\n```\n\nSo, `fricas` produces something that is ill-interpreted as some `%iint` symbolic function.\n\nNote that `maxima` produces the following answer:\n\n```\nsage: f.integral(x, algorithm='maxima')\n-x*dilog(x) - (x - 1)*log(-x + 1) + x*polylog(3, x) + x\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28630\n\n",
    "closed_at": "2021-07-23T20:11:35Z",
    "created_at": "2019-10-18T19:59:26Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "internal function of fricas appearing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28393",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
CC:  @hemmecke whuss @rwst @fchapoton @mantepse

Keywords: FriCAS

As reported on [this ask question](https://ask.sagemath.org/question/48409/possible-invalid-latex-translation-from-fricas-result), we have:

```
sage: f = polylog(3, x)
sage: f.integral(x, algorithm='fricas')
-x*%iint(x, -log(-x + 1)/x) - (x - 1)*log(-x + 1) + x*polylog(3, x) + x
```

So, `fricas` produces something that is ill-interpreted as some `%iint` symbolic function.

Note that `maxima` produces the following answer:

```
sage: f.integral(x, algorithm='maxima')
-x*dilog(x) - (x - 1)*log(-x + 1) + x*polylog(3, x) + x
```


Issue created by migration from https://trac.sagemath.org/ticket/28630





---

archive/issue_comments_400585.json:
```json
{
    "body": "Changing keywords from \"\" to \"FriCAS\".",
    "created_at": "2019-10-20T13:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400585",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "FriCAS".



---

archive/issue_comments_400586.json:
```json
{
    "body": "This seems to be some kind of bug in Fricas:\n\n```\nsage: f = fricas(polylog(3,x))\nsage: f.integrate(x)\n              log(- x + 1)\n- x %iint(x,- ------------) + x polylog(3,x) + (- x + 1)log(- x + 1) + x\n                    x\n```\nAnd the first term can be differentiated (inside Fricas) correctly.",
    "created_at": "2019-10-20T15:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400586",
    "user": "https://github.com/fchapoton"
}
```

This seems to be some kind of bug in Fricas:

```
sage: f = fricas(polylog(3,x))
sage: f.integrate(x)
              log(- x + 1)
- x %iint(x,- ------------) + x polylog(3,x) + (- x + 1)log(- x + 1) + x
                    x
```
And the first term can be differentiated (inside Fricas) correctly.



---

archive/issue_comments_400587.json:
```json
{
    "body": "More a reminder to myself: SageMath's `dilog(x)` is FriCAS' `dilog(1-x)`.  This is properly reflected in `sage.functions.log.py`, in class `Function_dilog`.\n\nSo FriCAS should simplify `%iint(x, -log(1-x)/x))` to FriCAS `dilog(1-x)`.",
    "created_at": "2019-11-23T07:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400587",
    "user": "https://github.com/mantepse"
}
```

More a reminder to myself: SageMath's `dilog(x)` is FriCAS' `dilog(1-x)`.  This is properly reflected in `sage.functions.log.py`, in class `Function_dilog`.

So FriCAS should simplify `%iint(x, -log(1-x)/x))` to FriCAS `dilog(1-x)`.



---

archive/issue_comments_400588.json:
```json
{
    "body": "I reported this at\n\nhttps://groups.google.com/forum/#!topic/fricas-devel/olmzqJ6IJsE",
    "created_at": "2019-11-23T07:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400588",
    "user": "https://github.com/mantepse"
}
```

I reported this at

https://groups.google.com/forum/#!topic/fricas-devel/olmzqJ6IJsE



---

archive/issue_comments_400589.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400589",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_072072.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72072"
}
```



---

archive/issue_comments_400590.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400590",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_072073.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72073"
}
```



---

archive/issue_events_072074.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72074"
}
```



---

archive/issue_comments_400591.json:
```json
{
    "body": "Still the same in 9.2.beta10 after the update of FriCAS to 1.3.6 in #27309",
    "created_at": "2020-08-29T19:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400591",
    "user": "https://github.com/mkoeppe"
}
```

Still the same in 9.2.beta10 after the update of FriCAS to 1.3.6 in #27309



---

archive/issue_events_072075.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72075"
}
```



---

archive/issue_events_072076.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72076"
}
```



---

archive/issue_comments_400592.json:
```json
{
    "body": "Fricas devs say that `%iint` should have never appeared, it's a Fricas \n[bug](https://groups.google.com/g/fricas-devel/c/z5oRKlb8CFI/m/1W7PUExpBgAJ). So that's something for them to fix.",
    "created_at": "2021-01-09T11:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400592",
    "user": "https://github.com/dimpase"
}
```

Fricas devs say that `%iint` should have never appeared, it's a Fricas 
[bug](https://groups.google.com/g/fricas-devel/c/z5oRKlb8CFI/m/1W7PUExpBgAJ). So that's something for them to fix.



---

archive/issue_comments_400593.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400593",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_072077.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72077"
}
```



---

archive/issue_events_072078.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72078"
}
```



---

archive/issue_comments_400594.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-02T11:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400594",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400595.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-02T11:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400595",
    "user": "https://github.com/mantepse"
}
```

New commits:



---

archive/issue_comments_400596.json:
```json
{
    "body": "First one does not work for me on 9.4.b0. We must wait for Fricas release containing the fix.",
    "created_at": "2021-06-06T06:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400596",
    "user": "https://github.com/fchapoton"
}
```

First one does not work for me on 9.4.b0. We must wait for Fricas release containing the fix.



---

archive/issue_comments_400597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-07T09:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400598.json:
```json
{
    "body": "this gives me\n\n```\nFile \"src/sage/symbolic/integration/external.py\", line 418, in sage.symbolic.integration.external.fricas_integrator\nFailed example:\n    integrate(f, x, algorithm=\"fricas\")                               # optional - fricas\nExpected:\n    1/315*(64512*I*a*e^(10*I*d*x + 10*I*c) + 53760*I*a*e^(8*I*d*x + 8*I*c) + 30720*I*a*e^(6*I*d*x + 6*I*c) + 11520*I*a*e^(4*I*d*x + 4*I*c) + 2560*I*a*e^(2*I*d*x + 2*I*c) + 256*I*a)/(d*e^(20*I*d*x + 20*I*c) + 10*d*e^(18*I*d*x + 18*I*c) + 45*d*e^(16*I*d*x + 16*I*c) + 120*d*e^(14*I*d*x + 14*I*c) + 210*d*e^(12*I*d*x + 12*I*c) + 252*d*e^(10*I*d*x + 10*I*c) + 210*d*e^(8*I*d*x + 8*I*c) + 120*d*e^(6*I*d*x + 6*I*c) + 45*d*e^(4*I*d*x + 4*I*c) + 10*d*e^(2*I*d*x + 2*I*c) + d)\nGot:\n    -256/315*(-252*I*a*e^(10*I*d*x + 10*I*c) - 210*I*a*e^(8*I*d*x + 8*I*c) - 120*I*a*e^(6*I*d*x + 6*I*c) - 45*I*a*e^(4*I*d*x + 4*I*c) - 10*I*a*e^(2*I*d*x + 2*I*c) - I*a)/(d*e^(20*I*d*x + 20*I*c) + 10*d*e^(18*I*d*x + 18*I*c) + 45*d*e^(16*I*d*x + 16*I*c) + 120*d*e^(14*I*d*x + 14*I*c) + 210*d*e^(12*I*d*x + 12*I*c) + 252*d*e^(10*I*d*x + 10*I*c) + 210*d*e^(8*I*d*x + 8*I*c) + 120*d*e^(6*I*d*x + 6*I*c) + 45*d*e^(4*I*d*x + 4*I*c) + 10*d*e^(2*I*d*x + 2*I*c) + d)\n```\n\n- a different formatting of the same expression.",
    "created_at": "2021-07-08T08:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400598",
    "user": "https://github.com/dimpase"
}
```

this gives me

```
File "src/sage/symbolic/integration/external.py", line 418, in sage.symbolic.integration.external.fricas_integrator
Failed example:
    integrate(f, x, algorithm="fricas")                               # optional - fricas
Expected:
    1/315*(64512*I*a*e^(10*I*d*x + 10*I*c) + 53760*I*a*e^(8*I*d*x + 8*I*c) + 30720*I*a*e^(6*I*d*x + 6*I*c) + 11520*I*a*e^(4*I*d*x + 4*I*c) + 2560*I*a*e^(2*I*d*x + 2*I*c) + 256*I*a)/(d*e^(20*I*d*x + 20*I*c) + 10*d*e^(18*I*d*x + 18*I*c) + 45*d*e^(16*I*d*x + 16*I*c) + 120*d*e^(14*I*d*x + 14*I*c) + 210*d*e^(12*I*d*x + 12*I*c) + 252*d*e^(10*I*d*x + 10*I*c) + 210*d*e^(8*I*d*x + 8*I*c) + 120*d*e^(6*I*d*x + 6*I*c) + 45*d*e^(4*I*d*x + 4*I*c) + 10*d*e^(2*I*d*x + 2*I*c) + d)
Got:
    -256/315*(-252*I*a*e^(10*I*d*x + 10*I*c) - 210*I*a*e^(8*I*d*x + 8*I*c) - 120*I*a*e^(6*I*d*x + 6*I*c) - 45*I*a*e^(4*I*d*x + 4*I*c) - 10*I*a*e^(2*I*d*x + 2*I*c) - I*a)/(d*e^(20*I*d*x + 20*I*c) + 10*d*e^(18*I*d*x + 18*I*c) + 45*d*e^(16*I*d*x + 16*I*c) + 120*d*e^(14*I*d*x + 14*I*c) + 210*d*e^(12*I*d*x + 12*I*c) + 252*d*e^(10*I*d*x + 10*I*c) + 210*d*e^(8*I*d*x + 8*I*c) + 120*d*e^(6*I*d*x + 6*I*c) + 45*d*e^(4*I*d*x + 4*I*c) + 10*d*e^(2*I*d*x + 2*I*c) + d)
```

- a different formatting of the same expression.



---

archive/issue_comments_400599.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-08T08:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400599",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400600.json:
```json
{
    "body": "how about making this doctest robust:\n\n```\n        sage: ii=integrate(f, x, algorithm=\"fricas\")                    # optional - fricas\n        sage: ii==1/315*(64512*I*a*e^(10*I*d*x + 10*I*c) +<the rest...> # optional - fricas\n        True\n```",
    "created_at": "2021-07-08T08:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400600",
    "user": "https://github.com/dimpase"
}
```

how about making this doctest robust:

```
        sage: ii=integrate(f, x, algorithm="fricas")                    # optional - fricas
        sage: ii==1/315*(64512*I*a*e^(10*I*d*x + 10*I*c) +<the rest...> # optional - fricas
        True
```



---

archive/issue_comments_400601.json:
```json
{
    "body": "OK, like this\n\n---\nNew commits:",
    "created_at": "2021-07-08T08:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400601",
    "user": "https://github.com/dimpase"
}
```

OK, like this

---
New commits:



---

archive/issue_comments_400602.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-07-08T08:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400602",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_400603.json:
```json
{
    "body": "The final commit subsumes #29043, which I therefore set to duplicate.",
    "created_at": "2021-07-08T09:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400603",
    "user": "https://github.com/mantepse"
}
```

The final commit subsumes #29043, which I therefore set to duplicate.



---

archive/issue_comments_400604.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-23T20:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28393#issuecomment-400604",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_072079.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-23T20:11:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28393",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28393#event-72079"
}
```
