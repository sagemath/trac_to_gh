# Issue 28904: Move reversed graph from backend to CGraph for sparse graphs

archive/issues_028667.json:
```json
{
    "body": "Currently, for sparse graphs the backend keeps a copy of the reversed graph. This makes iterating over ingoing neighbors much faster.\n\nHowever, `SparseGraph` itself does not have access to this. So e.g. when deleting vertices, this results in a massive slow down as it needs to delete incoming edges.\n\nWe initialize the sparse backend with the reversed structure and instead add the reversed structure directly to `SparseGraph`.\n\nBefore this ticket:\n\n```\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: save(edges, '/tmp/edges')\nsage: D = DiGraph(multiedges=True, loops=True)\nsage: %time D.add_edges(edges)\nCPU times: user 80.1 ms, sys: 0 ns, total: 80.1 ms\nWall time: 79.6 ms\nsage: %time for i in range(100): D.delete_vertex(i)\nCPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms\nWall time: 11.5 ms\n```\n\nWith this ticket:\n\n```\nsage: edges = load('/tmp/edges')\nsage: D = DiGraph(multiedges=True, loops=True)\nsage: %time D.add_edges(edges)\nCPU times: user 69 ms, sys: 0 ns, total: 69 ms\nWall time: 68.6 ms\nsage: %time for i in range(100): D.delete_vertex(i)\nCPU times: user 4.42 ms, sys: 16 \u00b5s, total: 4.43 ms\nWall time: 4.44 ms\n```\n\n\nWe fix an issue in `subdivide_edges` that would have caused a doctest to fail with the new setup:\n\nThere is a doctest calling the method `subdivide_edges` with `self.edges()`. As one can see from the documenation from `EdgesView`, one should not modify the graph while iterating through `EdgesView`, because it updates itself. So the following test in `generic_graph.py` is wrong usage of `subdivide_edges` or `edges`:\n\n```\nsage: g.subdivide_edges(g.edges(), 1)\n```\n\nHowever, as it seems very natural to do this, we pass a tuple instead of `EdgesView` to the backend.\n\nCC:  @videlec @dcoudert\n\nKeywords: sparse graphs, backend\n\nBranch/Commit: a46e717377c1cd020b5bda37922cf8ff42e914a6\n\nReviewer: David Coudert\n\nAuthor: Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28904\n\n",
    "closed_at": "2020-08-14T22:23:47Z",
    "created_at": "2019-12-21T00:44:43Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Move reversed graph from backend to CGraph for sparse graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28904",
    "user": "https://github.com/kliem"
}
```
Currently, for sparse graphs the backend keeps a copy of the reversed graph. This makes iterating over ingoing neighbors much faster.

However, `SparseGraph` itself does not have access to this. So e.g. when deleting vertices, this results in a massive slow down as it needs to delete incoming edges.

We initialize the sparse backend with the reversed structure and instead add the reversed structure directly to `SparseGraph`.

Before this ticket:

```
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: save(edges, '/tmp/edges')
sage: D = DiGraph(multiedges=True, loops=True)
sage: %time D.add_edges(edges)
CPU times: user 80.1 ms, sys: 0 ns, total: 80.1 ms
Wall time: 79.6 ms
sage: %time for i in range(100): D.delete_vertex(i)
CPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms
Wall time: 11.5 ms
```

With this ticket:

```
sage: edges = load('/tmp/edges')
sage: D = DiGraph(multiedges=True, loops=True)
sage: %time D.add_edges(edges)
CPU times: user 69 ms, sys: 0 ns, total: 69 ms
Wall time: 68.6 ms
sage: %time for i in range(100): D.delete_vertex(i)
CPU times: user 4.42 ms, sys: 16 Âµs, total: 4.43 ms
Wall time: 4.44 ms
```


We fix an issue in `subdivide_edges` that would have caused a doctest to fail with the new setup:

There is a doctest calling the method `subdivide_edges` with `self.edges()`. As one can see from the documenation from `EdgesView`, one should not modify the graph while iterating through `EdgesView`, because it updates itself. So the following test in `generic_graph.py` is wrong usage of `subdivide_edges` or `edges`:

```
sage: g.subdivide_edges(g.edges(), 1)
```

However, as it seems very natural to do this, we pass a tuple instead of `EdgesView` to the backend.

CC:  @videlec @dcoudert

Keywords: sparse graphs, backend

Branch/Commit: a46e717377c1cd020b5bda37922cf8ff42e914a6

Reviewer: David Coudert

Author: Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28904





---

archive/issue_comments_561516.json:
```json
{
    "body": "<a id='comment:1'></a>TBtw, there is a bug that leads to a crash with:\n\n```\nsage: G = DiGraph(2, data_structure='dense')\nsage: G.add_edge(0,1)\nsage: G.is_eulerian()\n```\n\nThis ticket also fixes this (the method `in_degree` in the CGraph backend assumes `_cg_rev` to be initialized).",
    "created_at": "2019-12-21T00:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561516",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>TBtw, there is a bug that leads to a crash with:

```
sage: G = DiGraph(2, data_structure='dense')
sage: G.add_edge(0,1)
sage: G.is_eulerian()
```

This ticket also fixes this (the method `in_degree` in the CGraph backend assumes `_cg_rev` to be initialized).



---

archive/issue_comments_561517.json:
```json
{
    "body": "Changing commit from \"\" to \"47a3897ead68a87329f38e729508462af5472392\"",
    "created_at": "2019-12-21T00:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561517",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "47a3897ead68a87329f38e729508462af5472392"



---

archive/issue_comments_561518.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2019-12-21T00:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561518",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_561519.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-21T00:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561519",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_561520.json:
```json
{
    "body": "Changing branch from \"\" to \"public/28904\"",
    "created_at": "2019-12-21T00:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561520",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/28904"



---

archive/issue_comments_561521.json:
```json
{
    "body": "<a id='comment:2'></a>This probably needs to be cleaned up a lot.\nIs it going in a good direction?\nOn my side, all tests in graphs seem to succeed.\n\n---\nNew commits:",
    "created_at": "2019-12-21T00:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561521",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>This probably needs to be cleaned up a lot.
Is it going in a good direction?
On my side, all tests in graphs seem to succeed.

---
New commits:



---

archive/issue_comments_561522.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,19 +8,27 @@\n \n ```\n sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\n+sage: save(edges, '/tmp/edges')\n sage: D = DiGraph(multiedges=True, loops=True)\n-sage: D.add_edges(edges)\n-sage: for i in range(1000): G.add_vertex(i)\n+sage: %time D.add_edges(edges)\n+CPU times: user 80.1 ms, sys: 0 ns, total: 80.1 ms\n+Wall time: 79.6 ms\n sage: %time for i in range(100): D.delete_vertex(i)\n-CPU times: user 10.1 ms, sys: 0 ns, total: 10.1 ms\n-Wall time: 10.1 ms\n+CPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms\n+Wall time: 11.5 ms\n ```\n \n With this ticket:\n \n ```\n-CPU times: user 4.4 ms, sys: 4 \u00b5s, total: 4.41 ms\n-Wall time: 4.41 ms\n+sage: edges = load('/tmp/edges')\n+sage: D = DiGraph(multiedges=True, loops=True)\n+sage: %time D.add_edges(edges)\n+CPU times: user 69 ms, sys: 0 ns, total: 69 ms\n+Wall time: 68.6 ms\n+sage: %time for i in range(100): D.delete_vertex(i)\n+CPU times: user 4.42 ms, sys: 16 \u00b5s, total: 4.43 ms\n+Wall time: 4.44 ms\n ```\n \n Comment: 1\n``````\n",
    "created_at": "2019-12-21T10:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561522",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,19 +8,27 @@
 
 ```
 sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
+sage: save(edges, '/tmp/edges')
 sage: D = DiGraph(multiedges=True, loops=True)
-sage: D.add_edges(edges)
-sage: for i in range(1000): G.add_vertex(i)
+sage: %time D.add_edges(edges)
+CPU times: user 80.1 ms, sys: 0 ns, total: 80.1 ms
+Wall time: 79.6 ms
 sage: %time for i in range(100): D.delete_vertex(i)
-CPU times: user 10.1 ms, sys: 0 ns, total: 10.1 ms
-Wall time: 10.1 ms
+CPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms
+Wall time: 11.5 ms
 ```
 
 With this ticket:
 
 ```
-CPU times: user 4.4 ms, sys: 4 Âµs, total: 4.41 ms
-Wall time: 4.41 ms
+sage: edges = load('/tmp/edges')
+sage: D = DiGraph(multiedges=True, loops=True)
+sage: %time D.add_edges(edges)
+CPU times: user 69 ms, sys: 0 ns, total: 69 ms
+Wall time: 68.6 ms
+sage: %time for i in range(100): D.delete_vertex(i)
+CPU times: user 4.42 ms, sys: 16 Âµs, total: 4.43 ms
+Wall time: 4.44 ms
 ```
 
 Comment: 1
``````




---

archive/issue_comments_561523.json:
```json
{
    "body": "<a id='comment:4'></a>One needs to be careful, about taking the same set of edges I guess.",
    "created_at": "2019-12-21T10:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561523",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>One needs to be careful, about taking the same set of edges I guess.



---

archive/issue_comments_561524.json:
```json
{
    "body": "Changing commit from \"47a3897ead68a87329f38e729508462af5472392\" to \"7d70aafae5b56c1d440256bf4a1ed63af43291a0\"",
    "created_at": "2019-12-21T10:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "47a3897ead68a87329f38e729508462af5472392" to "7d70aafae5b56c1d440256bf4a1ed63af43291a0"



---

archive/issue_comments_561525.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T10:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_561526.json:
```json
{
    "body": "<a id='comment:6'></a>Thank you for doing this, it's really needed.\n\nWith these changes, `_cg_rev` is no longer initialized, right ? If it's no longer needed, may be we can remove it, but we have to ensure that no-one is using it. Actually I fear that some users are using it for personal code. I see 2 solutions for that:\n1. send a pool to sage-dev for complete removal\n2. maintain an object build from `_cg` with appropriate pointers, and add a warning in the documentation.\n\n\n## in `sparse_graph.pyx`:\n\n```diff\n-            for i from 0 <= i < self.active_vertices.size * self.hash_length:\n+            for i in range(self.active_vertices.size * self.hash_length):\n```\n\nI think you can simplify tests to `NULL`\n\n```diff\n-                while temp[0] != NULL:\n+                while temp[0]:\n```\n\n\n```diff\n-        Lists the in-neighbors of a vertex as BTNodes\n+        List the in-neighbors of a vertex as BTNodes\n```\n\n```diff\n-        Builds the list of arcs into a vertex.\n+        Build the list of arcs into a vertex.\n```\n\n```diff\n-        Adds arc (u, v) to the graph with label l.\n+        Add arc (u, v) to the graph with label l.\n```\n\nBetter to use `True` and `False` instead of 0 and 1.\n\n```diff\n-        cdef int u_int = self.check_labelled_vertex(u, 0)\n-        cdef int v_int = self.check_labelled_vertex(v, 0)\n+        cdef int u_int = self.check_labelled_vertex(u, False)\n+        cdef int v_int = self.check_labelled_vertex(v, False)\n```\n\n\n## in `c_graph.pyx` we can do some extra optimisations, like\n\nin `verts`\n\n```diff\n-        cdef int i\n-        return [i for i in range(<int>self.active_vertices.size)\n-                if bitset_in(self.active_vertices, i)]\n+       return bitset_list(self.active_vertices)\n```\n\nin `iterator_verts`\n\n```diff\n-            for i in range(self._cg.active_vertices.size):\n-                if (bitset_in(self._cg.active_vertices, i)\n-                    and i not in self.vertex_labels\n-                    and i not in self.vertex_ints):\n-                        yield i\n+            i = bitset_first(self._cg.active_vertices)\n+            while i >= 0:\n+                if (i not in self.vertex_labels\n+                    and i not in self.vertex_ints):\n+                        yield i\n+                i = bitset_next(self._cg.active_vertices, i + 1)\n```",
    "created_at": "2019-12-21T10:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561526",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>Thank you for doing this, it's really needed.

With these changes, `_cg_rev` is no longer initialized, right ? If it's no longer needed, may be we can remove it, but we have to ensure that no-one is using it. Actually I fear that some users are using it for personal code. I see 2 solutions for that:
1. send a pool to sage-dev for complete removal
2. maintain an object build from `_cg` with appropriate pointers, and add a warning in the documentation.


## in `sparse_graph.pyx`:

```diff
-            for i from 0 <= i < self.active_vertices.size * self.hash_length:
+            for i in range(self.active_vertices.size * self.hash_length):
```

I think you can simplify tests to `NULL`

```diff
-                while temp[0] != NULL:
+                while temp[0]:
```


```diff
-        Lists the in-neighbors of a vertex as BTNodes
+        List the in-neighbors of a vertex as BTNodes
```

```diff
-        Builds the list of arcs into a vertex.
+        Build the list of arcs into a vertex.
```

```diff
-        Adds arc (u, v) to the graph with label l.
+        Add arc (u, v) to the graph with label l.
```

Better to use `True` and `False` instead of 0 and 1.

```diff
-        cdef int u_int = self.check_labelled_vertex(u, 0)
-        cdef int v_int = self.check_labelled_vertex(v, 0)
+        cdef int u_int = self.check_labelled_vertex(u, False)
+        cdef int v_int = self.check_labelled_vertex(v, False)
```


## in `c_graph.pyx` we can do some extra optimisations, like

in `verts`

```diff
-        cdef int i
-        return [i for i in range(<int>self.active_vertices.size)
-                if bitset_in(self.active_vertices, i)]
+       return bitset_list(self.active_vertices)
```

in `iterator_verts`

```diff
-            for i in range(self._cg.active_vertices.size):
-                if (bitset_in(self._cg.active_vertices, i)
-                    and i not in self.vertex_labels
-                    and i not in self.vertex_ints):
-                        yield i
+            i = bitset_first(self._cg.active_vertices)
+            while i >= 0:
+                if (i not in self.vertex_labels
+                    and i not in self.vertex_ints):
+                        yield i
+                i = bitset_next(self._cg.active_vertices, i + 1)
```



---

archive/issue_events_073139.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28904#event-73139"
}
```



---

archive/issue_comments_561527.json:
```json
{
    "body": "<a id='comment:7'></a>Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561527",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Ticket retargeted after milestone closed



---

archive/issue_comments_561528.json:
```json
{
    "body": "Changing commit from \"7d70aafae5b56c1d440256bf4a1ed63af43291a0\" to \"64c949321b61352f991bca2aefdfb59732898d55\"",
    "created_at": "2020-01-07T19:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561528",
    "user": "https://github.com/kliem"
}
```

Changing commit from "7d70aafae5b56c1d440256bf4a1ed63af43291a0" to "64c949321b61352f991bca2aefdfb59732898d55"



---

archive/issue_comments_561529.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2020-01-07T19:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561529",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_561530.json:
```json
{
    "body": "Changing branch from \"public/28904\" to \"public/28904-reb\"",
    "created_at": "2020-01-07T19:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561530",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/28904" to "public/28904-reb"



---

archive/issue_comments_561531.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-07T21:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561531",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_561532.json:
```json
{
    "body": "Changing commit from \"64c949321b61352f991bca2aefdfb59732898d55\" to \"81e99e641b7ea36d16dcdd30dd6db9e01bb35d1e\"",
    "created_at": "2020-01-07T21:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "64c949321b61352f991bca2aefdfb59732898d55" to "81e99e641b7ea36d16dcdd30dd6db9e01bb35d1e"



---

archive/issue_comments_561533.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks for the comments.\n\nReplying to [comment:6 dcoudert]:\n> \n> in `iterator_verts`\n> \n> ```diff\n> -            for i in range(self._cg.active_vertices.size):\n> -                if (bitset_in(self._cg.active_vertices, i)\n> -                    and i not in self.vertex_labels\n> -                    and i not in self.vertex_ints):\n> -                        yield i\n> +            i = bitset_first(self._cg.active_vertices)\n> +            while i >= 0:\n> +                if (i not in self.vertex_labels\n> +                    and i not in self.vertex_ints):\n> +                        yield i\n> +                i = bitset_next(self._cg.active_vertices, i + 1)\n> ```\n\n\nFixing this makes a mistake apparent: There is a doctest in `generic_graph.py` that subdivides all edges of a graph by using `self.edges()`. However, one should not iterate over an `EdgesView` object while modifying the graph. I have modified the method `subdivide_edges` to generate a tuple from `EdgesView`.",
    "created_at": "2020-01-07T21:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561533",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>Thanks for the comments.

Replying to [comment:6 dcoudert]:
> 
> in `iterator_verts`
> 
> ```diff
> -            for i in range(self._cg.active_vertices.size):
> -                if (bitset_in(self._cg.active_vertices, i)
> -                    and i not in self.vertex_labels
> -                    and i not in self.vertex_ints):
> -                        yield i
> +            i = bitset_first(self._cg.active_vertices)
> +            while i >= 0:
> +                if (i not in self.vertex_labels
> +                    and i not in self.vertex_ints):
> +                        yield i
> +                i = bitset_next(self._cg.active_vertices, i + 1)
> ```


Fixing this makes a mistake apparent: There is a doctest in `generic_graph.py` that subdivides all edges of a graph by using `self.edges()`. However, one should not iterate over an `EdgesView` object while modifying the graph. I have modified the method `subdivide_edges` to generate a tuple from `EdgesView`.



---

archive/issue_comments_561534.json:
```json
{
    "body": "Changing commit from \"81e99e641b7ea36d16dcdd30dd6db9e01bb35d1e\" to \"f4423f08ba37e8d5478f1564f574b8bb64a212ba\"",
    "created_at": "2020-01-07T21:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561534",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "81e99e641b7ea36d16dcdd30dd6db9e01bb35d1e" to "f4423f08ba37e8d5478f1564f574b8bb64a212ba"



---

archive/issue_comments_561535.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-07T21:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_561536.json:
```json
{
    "body": "<a id='comment:12'></a>* I have some compilation warnings. It's better to check if it's possible to avoid.\n\n```\n[2/4] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I./sage/cpython -I./sage/libs/ntl -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/cysignals -Isage/cpython -I./sage/rings -I/Users/dcoudert/sage3/sage/local/include -I/Users/dcoudert/sage3/sage/src -I/Users/dcoudert/sage3/sage/src/sage/ext -I/Users/dcoudert/sage3/sage/local/include/python3.7m -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/numpy/core/include -Ibuild/cythonized -I/Users/dcoudert/sage3/sage/local/include/python3.7m -c build/cythonized/sage/graphs/base/c_graph.cpp -o build/temp.macosx-10.9-x86_64-3.7/build/cythonized/sage/graphs/base/c_graph.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c++11\nbuild/cythonized/sage/graphs/base/c_graph.cpp:16256:48: warning: comparison of integers of different signs: 'size_t' (aka 'unsigned long') and 'long' [-Wsign-compare]\n      __pyx_t_2 = ((__pyx_cur_scope->__pyx_v_i != -1L) != 0);\n                    ~~~~~~~~~~~~~~~~~~~~~~~~~~ ^  ~~~\n1 warning generated.\ng++ -bundle -undefined dynamic_lookup -L/Users/dcoudert/sage3/sage/local/lib -Wl,-rpath,/Users/dcoudert/sage3/sage/local/lib -L/usr/local/opt/openssl/lib -L. -L/Users/dcoudert/sage3/sage/local/lib -Wl,-rpath,/Users/dcoudert/sage3/sage/local/lib -L/usr/local/opt/openssl/lib -L/Users/dcoudert/sage3/sage/local/lib -Wl,-rpath,/Users/dcoudert/sage3/sage/local/lib build/temp.macosx-10.9-x86_64-3.7/build/cythonized/sage/graphs/base/c_graph.o -L/Users/dcoudert/sage3/sage/local/lib -L/Users/dcoudert/sage3/sage/local/lib -lgmp -lstdc++ -o build/lib.macosx-10.9-x86_64-3.7/sage/graphs/base/c_graph.cpython-37m-darwin.so -lpari\n[3/4] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I./sage/cpython -Isage/cpython -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/cysignals -I/Users/dcoudert/sage3/sage/local/include -I/Users/dcoudert/sage3/sage/src -I/Users/dcoudert/sage3/sage/src/sage/ext -I/Users/dcoudert/sage3/sage/local/include/python3.7m -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/numpy/core/include -Ibuild/cythonized -I/Users/dcoudert/sage3/sage/local/include/python3.7m -c build/cythonized/sage/graphs/base/sparse_graph.c -o build/temp.macosx-10.9-x86_64-3.7/build/cythonized/sage/graphs/base/sparse_graph.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99\nbuild/cythonized/sage/graphs/base/sparse_graph.c:11350:35: warning: comparison of integers of different signs: 'size_t' (aka 'unsigned long') and 'int' [-Wsign-compare]\n    for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\n                        ~~~~~~~~~ ^ ~~~~~~~~~\nbuild/cythonized/sage/graphs/base/sparse_graph.c:11384:35: warning: comparison of integers of different signs: 'size_t' (aka 'unsigned long') and 'int' [-Wsign-compare]\n    for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {\n                        ~~~~~~~~~ ^ ~~~~~~~~~\nbuild/cythonized/sage/graphs/base/sparse_graph.c:19114:87: warning: incompatible pointer types passing 'struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *' to parameter of\n      type 'struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *' [-Wincompatible-pointer-types]\n  ...((struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *)((struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *)__pyx_v_self->__pyx_base._cg)), __pyx_v_u_int...\n     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nbuild/cythonized/sage/graphs/base/sparse_graph.c:9396:149: note: passing argument to parameter '__pyx_v_self' here\nstatic int __pyx_f_4sage_6graphs_4base_12sparse_graph_11SparseGraph_has_arc_unsafe(struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *__pyx_v_self, int __pyx...\n                                                                                                                                                    ^\nbuild/cythonized/sage/graphs/base/sparse_graph.c:25037:87: warning: incompatible pointer types passing 'struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *' to parameter of\n      type 'struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *' [-Wincompatible-pointer-types]\n  ...((struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *)((struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *)__pyx_v_self->__pyx_base._cg)), __pyx_v_u_int...\n     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nbuild/cythonized/sage/graphs/base/sparse_graph.c:9396:149: note: passing argument to parameter '__pyx_v_self' here\nstatic int __pyx_f_4sage_6graphs_4base_12sparse_graph_11SparseGraph_has_arc_unsafe(struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *__pyx_v_self, int __pyx...\n                                                                                                                                                    ^\n4 warnings generated.\n``` \n\n* method `del_arc_unsafe` returns nothing\n\n* in method `del_arc_label_unsafe`, can't we do this (not sure if it's better or not):\n\n```diff\n-        cdef int error = self._del_arc_label_unsafe(u, v, l, self.vertices)\n-        if error:\n-            return 1 # indicate an error\n+        if self._del_arc_label_unsafe(u, v, l, self.vertices):\n+            return 1 # indicate an error\n```\n\n* Thanks for correcting `subdivise_edges`.\n\nI confirm that vertex deletion is much faster now.",
    "created_at": "2020-01-08T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561536",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>* I have some compilation warnings. It's better to check if it's possible to avoid.

```
[2/4] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I./sage/cpython -I./sage/libs/ntl -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/cysignals -Isage/cpython -I./sage/rings -I/Users/dcoudert/sage3/sage/local/include -I/Users/dcoudert/sage3/sage/src -I/Users/dcoudert/sage3/sage/src/sage/ext -I/Users/dcoudert/sage3/sage/local/include/python3.7m -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/numpy/core/include -Ibuild/cythonized -I/Users/dcoudert/sage3/sage/local/include/python3.7m -c build/cythonized/sage/graphs/base/c_graph.cpp -o build/temp.macosx-10.9-x86_64-3.7/build/cythonized/sage/graphs/base/c_graph.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c++11
build/cythonized/sage/graphs/base/c_graph.cpp:16256:48: warning: comparison of integers of different signs: 'size_t' (aka 'unsigned long') and 'long' [-Wsign-compare]
      __pyx_t_2 = ((__pyx_cur_scope->__pyx_v_i != -1L) != 0);
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~ ^  ~~~
1 warning generated.
g++ -bundle -undefined dynamic_lookup -L/Users/dcoudert/sage3/sage/local/lib -Wl,-rpath,/Users/dcoudert/sage3/sage/local/lib -L/usr/local/opt/openssl/lib -L. -L/Users/dcoudert/sage3/sage/local/lib -Wl,-rpath,/Users/dcoudert/sage3/sage/local/lib -L/usr/local/opt/openssl/lib -L/Users/dcoudert/sage3/sage/local/lib -Wl,-rpath,/Users/dcoudert/sage3/sage/local/lib build/temp.macosx-10.9-x86_64-3.7/build/cythonized/sage/graphs/base/c_graph.o -L/Users/dcoudert/sage3/sage/local/lib -L/Users/dcoudert/sage3/sage/local/lib -lgmp -lstdc++ -o build/lib.macosx-10.9-x86_64-3.7/sage/graphs/base/c_graph.cpython-37m-darwin.so -lpari
[3/4] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I./sage/cpython -Isage/cpython -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/cysignals -I/Users/dcoudert/sage3/sage/local/include -I/Users/dcoudert/sage3/sage/src -I/Users/dcoudert/sage3/sage/src/sage/ext -I/Users/dcoudert/sage3/sage/local/include/python3.7m -I/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/numpy/core/include -Ibuild/cythonized -I/Users/dcoudert/sage3/sage/local/include/python3.7m -c build/cythonized/sage/graphs/base/sparse_graph.c -o build/temp.macosx-10.9-x86_64-3.7/build/cythonized/sage/graphs/base/sparse_graph.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99
build/cythonized/sage/graphs/base/sparse_graph.c:11350:35: warning: comparison of integers of different signs: 'size_t' (aka 'unsigned long') and 'int' [-Wsign-compare]
    for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {
                        ~~~~~~~~~ ^ ~~~~~~~~~
build/cythonized/sage/graphs/base/sparse_graph.c:11384:35: warning: comparison of integers of different signs: 'size_t' (aka 'unsigned long') and 'int' [-Wsign-compare]
    for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {
                        ~~~~~~~~~ ^ ~~~~~~~~~
build/cythonized/sage/graphs/base/sparse_graph.c:19114:87: warning: incompatible pointer types passing 'struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *' to parameter of
      type 'struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *' [-Wincompatible-pointer-types]
  ...((struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *)((struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *)__pyx_v_self->__pyx_base._cg)), __pyx_v_u_int...
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
build/cythonized/sage/graphs/base/sparse_graph.c:9396:149: note: passing argument to parameter '__pyx_v_self' here
static int __pyx_f_4sage_6graphs_4base_12sparse_graph_11SparseGraph_has_arc_unsafe(struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *__pyx_v_self, int __pyx...
                                                                                                                                                    ^
build/cythonized/sage/graphs/base/sparse_graph.c:25037:87: warning: incompatible pointer types passing 'struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *' to parameter of
      type 'struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *' [-Wincompatible-pointer-types]
  ...((struct __pyx_obj_4sage_6graphs_4base_7c_graph_CGraph *)((struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *)__pyx_v_self->__pyx_base._cg)), __pyx_v_u_int...
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
build/cythonized/sage/graphs/base/sparse_graph.c:9396:149: note: passing argument to parameter '__pyx_v_self' here
static int __pyx_f_4sage_6graphs_4base_12sparse_graph_11SparseGraph_has_arc_unsafe(struct __pyx_obj_4sage_6graphs_4base_12sparse_graph_SparseGraph *__pyx_v_self, int __pyx...
                                                                                                                                                    ^
4 warnings generated.
``` 

* method `del_arc_unsafe` returns nothing

* in method `del_arc_label_unsafe`, can't we do this (not sure if it's better or not):

```diff
-        cdef int error = self._del_arc_label_unsafe(u, v, l, self.vertices)
-        if error:
-            return 1 # indicate an error
+        if self._del_arc_label_unsafe(u, v, l, self.vertices):
+            return 1 # indicate an error
```

* Thanks for correcting `subdivise_edges`.

I confirm that vertex deletion is much faster now.



---

archive/issue_comments_561537.json:
```json
{
    "body": "<a id='comment:13'></a>There are tons of compilation warnings, as we include all of `bitset.pxi`, which is annoying, but of course not serious.\n\nThe compilation warning about wrong casting of `self._cg` is a bit tricky. I think I took care of it now. The problem is that `SparseGraphBackend` casts the `SparseGraph` to a `CGraph` in order to assign it to `self._cg`, which is declared to be a `CGraph`. This is later on casted back into a `SpareGraph`, which of course produces a warning.\n\nMy approach now: Remove the attribute `_cg` from `CGraphBackend` and add it to the inherited backends with the proper declaration. Add an inline method `cg`, which returns `_cg` casted to a `CGraph`. This is cleaner, I think.",
    "created_at": "2020-01-08T16:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561537",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>There are tons of compilation warnings, as we include all of `bitset.pxi`, which is annoying, but of course not serious.

The compilation warning about wrong casting of `self._cg` is a bit tricky. I think I took care of it now. The problem is that `SparseGraphBackend` casts the `SparseGraph` to a `CGraph` in order to assign it to `self._cg`, which is declared to be a `CGraph`. This is later on casted back into a `SpareGraph`, which of course produces a warning.

My approach now: Remove the attribute `_cg` from `CGraphBackend` and add it to the inherited backends with the proper declaration. Add an inline method `cg`, which returns `_cg` casted to a `CGraph`. This is cleaner, I think.



---

archive/issue_comments_561538.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-08T16:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_561539.json:
```json
{
    "body": "Changing commit from \"f4423f08ba37e8d5478f1564f574b8bb64a212ba\" to \"4af81b4339f574584e3f86a49cb597cae9002741\"",
    "created_at": "2020-01-08T16:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f4423f08ba37e8d5478f1564f574b8bb64a212ba" to "4af81b4339f574584e3f86a49cb597cae9002741"



---

archive/issue_comments_561540.json:
```json
{
    "body": "<a id='comment:15'></a>I'm happy with the current code, but it would be better to get extra opinion (e.g., from the thread [https://groups.google.com/forum/#!topic/sage-devel/2eIaD3r8Vl8](https://groups.google.com/forum/#!topic/sage-devel/2eIaD3r8Vl8)).",
    "created_at": "2020-01-09T17:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561540",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>I'm happy with the current code, but it would be better to get extra opinion (e.g., from the thread [https://groups.google.com/forum/#!topic/sage-devel/2eIaD3r8Vl8](https://groups.google.com/forum/#!topic/sage-devel/2eIaD3r8Vl8)).



---

archive/issue_comments_561541.json:
```json
{
    "body": "<a id='comment:16'></a>There remains the question, whether we should remove `cg_rev` altogether and whether we should do it now.\n\nThe advantage of removing it, is that code referring to it won't compile anymore and/or give a proper warning. Currently, if one assumes this to be initialized and uses it in cython, sage might crash hard (segmentation fault I believe).",
    "created_at": "2020-01-09T19:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561541",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>There remains the question, whether we should remove `cg_rev` altogether and whether we should do it now.

The advantage of removing it, is that code referring to it won't compile anymore and/or give a proper warning. Currently, if one assumes this to be initialized and uses it in cython, sage might crash hard (segmentation fault I believe).



---

archive/issue_comments_561542.json:
```json
{
    "body": "Changing commit from \"4af81b4339f574584e3f86a49cb597cae9002741\" to \"bfd25a908e6e13da8280b98794424669c291e1b5\"",
    "created_at": "2020-01-14T08:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4af81b4339f574584e3f86a49cb597cae9002741" to "bfd25a908e6e13da8280b98794424669c291e1b5"



---

archive/issue_comments_561543.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-14T08:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_561544.json:
```json
{
    "body": "<a id='comment:18'></a>I removed the attribute `_cg_rev` now.\n\nThe method `check_labelled_vertex` just ignores the input `reverse` now.\n\nThe method `c_graph` return `(self._cg, None)` instead of `(self._cg, self._cg_rev)`.",
    "created_at": "2020-01-14T08:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561544",
    "user": "https://github.com/kliem"
}
```

<a id='comment:18'></a>I removed the attribute `_cg_rev` now.

The method `check_labelled_vertex` just ignores the input `reverse` now.

The method `c_graph` return `(self._cg, None)` instead of `(self._cg, self._cg_rev)`.



---

archive/issue_comments_561545.json:
```json
{
    "body": "<a id='comment:19'></a>Why\n\n```\ndiff --git a/src/sage/graphs/generic_graph.py b/src/sage/graphs/generic_graph.py\nindex 139c8df..4fa7f75 100644\n--- a/src/sage/graphs/generic_graph.py\n+++ b/src/sage/graphs/generic_graph.py\n@@ -11001,6 +11001,8 @@ class GenericGraph(GenericGraph_pyx):\n \n             - :meth:`subdivide_edge` -- subdivides one edge\n         \"\"\"\n+        if isinstance(edges, EdgesView):\n+            edges = tuple(edges)\n```",
    "created_at": "2020-02-15T15:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561545",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>Why

```
diff --git a/src/sage/graphs/generic_graph.py b/src/sage/graphs/generic_graph.py
index 139c8df..4fa7f75 100644
--- a/src/sage/graphs/generic_graph.py
+++ b/src/sage/graphs/generic_graph.py
@@ -11001,6 +11001,8 @@ class GenericGraph(GenericGraph_pyx):
 
             - :meth:`subdivide_edge` -- subdivides one edge
         """
+        if isinstance(edges, EdgesView):
+            edges = tuple(edges)
```



---

archive/issue_comments_561546.json:
```json
{
    "body": "<a id='comment:20'></a>This is independent from the purpose of this ticket, but this is effectively an issue to be fixed.",
    "created_at": "2020-02-15T16:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561546",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:20'></a>This is independent from the purpose of this ticket, but this is effectively an issue to be fixed.



---

archive/issue_comments_561547.json:
```json
{
    "body": "<a id='comment:21'></a>I updated the description of the ticket to account for the change.",
    "created_at": "2020-02-15T16:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561547",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>I updated the description of the ticket to account for the change.



---

archive/issue_comments_561548.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,46 @@\n+Currently, for sparse graphs the backend keeps a copy of the reversed graph. This makes iterating over ingoing neighbors much faster.\n \n+However, `SparseGraph` itself does not have access to this. So e.g. when deleting vertices, this results in a massive slow down as it needs to delete incoming edges.\n+\n+We initialize the sparse backend with the reversed structure and instead add the reversed structure directly to `SparseGraph`.\n+\n+Before this ticket:\n+\n+```\n+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\n+sage: save(edges, '/tmp/edges')\n+sage: D = DiGraph(multiedges=True, loops=True)\n+sage: %time D.add_edges(edges)\n+CPU times: user 80.1 ms, sys: 0 ns, total: 80.1 ms\n+Wall time: 79.6 ms\n+sage: %time for i in range(100): D.delete_vertex(i)\n+CPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms\n+Wall time: 11.5 ms\n+```\n+\n+With this ticket:\n+\n+```\n+sage: edges = load('/tmp/edges')\n+sage: D = DiGraph(multiedges=True, loops=True)\n+sage: %time D.add_edges(edges)\n+CPU times: user 69 ms, sys: 0 ns, total: 69 ms\n+Wall time: 68.6 ms\n+sage: %time for i in range(100): D.delete_vertex(i)\n+CPU times: user 4.42 ms, sys: 16 \u00b5s, total: 4.43 ms\n+Wall time: 4.44 ms\n+```\n+\n+\n+We fix an issue in `subdivide_edges` that would have caused a doctest to fail with the new setup:\n+\n+There is a doctest calling the method `subdivide_edges` with `self.edges()`. As one can see from the documenation from `EdgesView`, one should not modify the graph while iterating through `EdgesView`, because it updates itself. So the following test in `generic_graph.py` is wrong usage of `subdivide_edges` or `edges`:\n+\n+```\n+sage: g.subdivide_edges(g.edges(), 1)\n+```\n+\n+However, as it seems very natural to do this, we pass a tuple instead of `EdgesView` to the backend.\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-02-15T16:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561548",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,46 @@
+Currently, for sparse graphs the backend keeps a copy of the reversed graph. This makes iterating over ingoing neighbors much faster.
 
+However, `SparseGraph` itself does not have access to this. So e.g. when deleting vertices, this results in a massive slow down as it needs to delete incoming edges.
+
+We initialize the sparse backend with the reversed structure and instead add the reversed structure directly to `SparseGraph`.
+
+Before this ticket:
+
+```
+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
+sage: save(edges, '/tmp/edges')
+sage: D = DiGraph(multiedges=True, loops=True)
+sage: %time D.add_edges(edges)
+CPU times: user 80.1 ms, sys: 0 ns, total: 80.1 ms
+Wall time: 79.6 ms
+sage: %time for i in range(100): D.delete_vertex(i)
+CPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms
+Wall time: 11.5 ms
+```
+
+With this ticket:
+
+```
+sage: edges = load('/tmp/edges')
+sage: D = DiGraph(multiedges=True, loops=True)
+sage: %time D.add_edges(edges)
+CPU times: user 69 ms, sys: 0 ns, total: 69 ms
+Wall time: 68.6 ms
+sage: %time for i in range(100): D.delete_vertex(i)
+CPU times: user 4.42 ms, sys: 16 Âµs, total: 4.43 ms
+Wall time: 4.44 ms
+```
+
+
+We fix an issue in `subdivide_edges` that would have caused a doctest to fail with the new setup:
+
+There is a doctest calling the method `subdivide_edges` with `self.edges()`. As one can see from the documenation from `EdgesView`, one should not modify the graph while iterating through `EdgesView`, because it updates itself. So the following test in `generic_graph.py` is wrong usage of `subdivide_edges` or `edges`:
+
+```
+sage: g.subdivide_edges(g.edges(), 1)
+```
+
+However, as it seems very natural to do this, we pass a tuple instead of `EdgesView` to the backend.
 
 Comment: 1
 
``````




---

archive/issue_comments_561549.json:
```json
{
    "body": "<a id='comment:22'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561549",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_073140.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28904#event-73140"
}
```



---

archive/issue_events_073141.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28904#event-73141"
}
```



---

archive/issue_comments_561550.json:
```json
{
    "body": "<a id='comment:23'></a>What's the status of this ticket?",
    "created_at": "2020-08-11T17:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561550",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>What's the status of this ticket?



---

archive/issue_comments_561551.json:
```json
{
    "body": "<a id='comment:24'></a>Needs review.\n\nIt's annoying to check, I guess. But it would be a nice improvements with many applications. Maybe I should request a review on sage-devel.",
    "created_at": "2020-08-11T20:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561551",
    "user": "https://github.com/kliem"
}
```

<a id='comment:24'></a>Needs review.

It's annoying to check, I guess. But it would be a nice improvements with many applications. Maybe I should request a review on sage-devel.



---

archive/issue_comments_561552.json:
```json
{
    "body": "<a id='comment:25'></a>overall, it's a very nice improvement. I have only a few suggestions.\n\n**`sparse_graph.pyx`**\n-  instead of checking `self.vertices != self.vertices_rev`, we could store a boolean value `self._directed` and have a method `self.is_directed())`.\n\n- instead of `<size_t>-1`, don't we have a constant equal to the max value ? This is something we should do in several places in the code. Could be done in dedicated tickets\n\n- in `out_neighbors_unsafe` and `in_neighbors_unsafe`, remove `cdef list l = []`, not used\n\n\n- I know that the documentation of cdef methods is not displayed, but it would be cleaner to follow the same standard than in the other parts of the code. For instance\n\n```diff\n        INPUT:\n-            u, v -- non-negative integers\n+\n+            - ``u, v`` -- non-negative integers\n```\n  Of course, we can do that in a future ticket. Not a priority here\n\n\n- methods `out_arcs_unsafe` and `in_arcs_unsafe` return lists. Why not changing to an iterator ? If I'm not mistaken, these methods are only used in for loops.\n\n- same for method `all_arcs` which is used in a for loop and in some doctests where we could use `list(...)`.\n\n```\nconfetti:sage dcoudert$ git grep -i \"\\.all_arcs\" src/sage/\nsrc/sage/graphs/base/c_graph.pyx:            - :meth:`all_arcs <sage.graphs.base.sparse_graph.SparseGraph.all_arcs>`\nsrc/sage/graphs/base/c_graph.pyx:            sage: G.all_arcs(0, 1)\nsrc/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)\nsrc/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)\nsrc/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(7,3)\nsrc/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)\nsrc/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)\nsrc/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(5,4)\nsrc/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(1,2)\nsrc/sage/graphs/base/sparse_graph.pyx:        num_arcs = self.all_arcs_unsafe(u, v, arc_labels, size)\nsrc/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)\nsrc/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)\nsrc/sage/graphs/base/sparse_graph.pyx:                     for l_int in self._cg.all_arcs(u_int, v_int)]\nsrc/sage/graphs/base/sparse_graph.pyx:        for l_int in self._cg.all_arcs(u_int, v_int):\n```",
    "created_at": "2020-08-12T08:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561552",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:25'></a>overall, it's a very nice improvement. I have only a few suggestions.

**`sparse_graph.pyx`**
-  instead of checking `self.vertices != self.vertices_rev`, we could store a boolean value `self._directed` and have a method `self.is_directed())`.

- instead of `<size_t>-1`, don't we have a constant equal to the max value ? This is something we should do in several places in the code. Could be done in dedicated tickets

- in `out_neighbors_unsafe` and `in_neighbors_unsafe`, remove `cdef list l = []`, not used


- I know that the documentation of cdef methods is not displayed, but it would be cleaner to follow the same standard than in the other parts of the code. For instance

```diff
        INPUT:
-            u, v -- non-negative integers
+
+            - ``u, v`` -- non-negative integers
```
  Of course, we can do that in a future ticket. Not a priority here


- methods `out_arcs_unsafe` and `in_arcs_unsafe` return lists. Why not changing to an iterator ? If I'm not mistaken, these methods are only used in for loops.

- same for method `all_arcs` which is used in a for loop and in some doctests where we could use `list(...)`.

```
confetti:sage dcoudert$ git grep -i "\.all_arcs" src/sage/
src/sage/graphs/base/c_graph.pyx:            - :meth:`all_arcs <sage.graphs.base.sparse_graph.SparseGraph.all_arcs>`
src/sage/graphs/base/c_graph.pyx:            sage: G.all_arcs(0, 1)
src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)
src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)
src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(7,3)
src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)
src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)
src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(5,4)
src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(1,2)
src/sage/graphs/base/sparse_graph.pyx:        num_arcs = self.all_arcs_unsafe(u, v, arc_labels, size)
src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)
src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)
src/sage/graphs/base/sparse_graph.pyx:                     for l_int in self._cg.all_arcs(u_int, v_int)]
src/sage/graphs/base/sparse_graph.pyx:        for l_int in self._cg.all_arcs(u_int, v_int):
```



---

archive/issue_comments_561553.json:
```json
{
    "body": "Changing commit from \"bfd25a908e6e13da8280b98794424669c291e1b5\" to \"a46e717377c1cd020b5bda37922cf8ff42e914a6\"",
    "created_at": "2020-08-12T10:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561553",
    "user": "https://github.com/kliem"
}
```

Changing commit from "bfd25a908e6e13da8280b98794424669c291e1b5" to "a46e717377c1cd020b5bda37922cf8ff42e914a6"



---

archive/issue_comments_561554.json:
```json
{
    "body": "<a id='comment:26'></a>New commits:",
    "created_at": "2020-08-12T10:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561554",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>New commits:



---

archive/issue_comments_561555.json:
```json
{
    "body": "Changing branch from \"public/28904-reb\" to \"public/28904-reb2\"",
    "created_at": "2020-08-12T10:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561555",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/28904-reb" to "public/28904-reb2"



---

archive/issue_comments_561556.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:25 dcoudert]:\n> overall, it's a very nice improvement. I have only a few suggestions.\n> \n> **`sparse_graph.pyx`**\n> -  instead of checking `self.vertices != self.vertices_rev`, we could store a boolean value `self._directed` and have a method `self.is_directed())`.\n \nDone.\n> \n> - instead of `<size_t>-1`, don't we have a constant equal to the max value ? This is something we should do in several places in the code. Could be done in dedicated tickets\n \nThis is being cythonized into `((size_t)-1L)` and I hope the compiler takes care of it from there. It's maybe not so nice codewise, but I don't think it is any loss.\n> \n> - in `out_neighbors_unsafe` and `in_neighbors_unsafe`, remove `cdef list l = []`, not used\n \nDone.\n> \n> \n> - I know that the documentation of cdef methods is not displayed, but it would be cleaner to follow the same standard than in the other parts of the code. For instance\n> \n> ```diff\n>         INPUT:\n> -            u, v -- non-negative integers\n> +\n> +            - ``u, v`` -- non-negative integers\n> ```\n>   Of course, we can do that in a future ticket. Not a priority here\nDone. It's a rather large commit though as I went over all the places that \"caught my eye\".\n> \n> \n> - methods `out_arcs_unsafe` and `in_arcs_unsafe` return lists. Why not changing to an iterator ? If I'm not mistaken, these methods are only used in for loops.\n> \n> - same for method `all_arcs` which is used in a for loop and in some doctests where we could use `list(...)`.\n> \n> ```\n> confetti:sage dcoudert$ git grep -i \"\\.all_arcs\" src/sage/\n> src/sage/graphs/base/c_graph.pyx:            - :meth:`all_arcs <sage.graphs.base.sparse_graph.SparseGraph.all_arcs>`\n> src/sage/graphs/base/c_graph.pyx:            sage: G.all_arcs(0, 1)\n> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)\n> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)\n> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(7,3)\n> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)\n> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)\n> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(5,4)\n> src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(1,2)\n> src/sage/graphs/base/sparse_graph.pyx:        num_arcs = self.all_arcs_unsafe(u, v, arc_labels, size)\n> src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)\n> src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)\n> src/sage/graphs/base/sparse_graph.pyx:                     for l_int in self._cg.all_arcs(u_int, v_int)]\n> src/sage/graphs/base/sparse_graph.pyx:        for l_int in self._cg.all_arcs(u_int, v_int):\n> ```\n> \n\nThe last two I would leave for future tickets. But you are right. We really iterate over a structure that is already there (either over a bitset or a tree). So there is no use in wasting resources for creating this list.",
    "created_at": "2020-08-12T10:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561556",
    "user": "https://github.com/kliem"
}
```

<a id='comment:27'></a>Replying to [comment:25 dcoudert]:
> overall, it's a very nice improvement. I have only a few suggestions.
> 
> **`sparse_graph.pyx`**
> -  instead of checking `self.vertices != self.vertices_rev`, we could store a boolean value `self._directed` and have a method `self.is_directed())`.
 
Done.
> 
> - instead of `<size_t>-1`, don't we have a constant equal to the max value ? This is something we should do in several places in the code. Could be done in dedicated tickets
 
This is being cythonized into `((size_t)-1L)` and I hope the compiler takes care of it from there. It's maybe not so nice codewise, but I don't think it is any loss.
> 
> - in `out_neighbors_unsafe` and `in_neighbors_unsafe`, remove `cdef list l = []`, not used
 
Done.
> 
> 
> - I know that the documentation of cdef methods is not displayed, but it would be cleaner to follow the same standard than in the other parts of the code. For instance
> 
> ```diff
>         INPUT:
> -            u, v -- non-negative integers
> +
> +            - ``u, v`` -- non-negative integers
> ```
>   Of course, we can do that in a future ticket. Not a priority here
Done. It's a rather large commit though as I went over all the places that "caught my eye".
> 
> 
> - methods `out_arcs_unsafe` and `in_arcs_unsafe` return lists. Why not changing to an iterator ? If I'm not mistaken, these methods are only used in for loops.
> 
> - same for method `all_arcs` which is used in a for loop and in some doctests where we could use `list(...)`.
> 
> ```
> confetti:sage dcoudert$ git grep -i "\.all_arcs" src/sage/
> src/sage/graphs/base/c_graph.pyx:            - :meth:`all_arcs <sage.graphs.base.sparse_graph.SparseGraph.all_arcs>`
> src/sage/graphs/base/c_graph.pyx:            sage: G.all_arcs(0, 1)
> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)
> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)
> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(7,3)
> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(0,1)
> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(1,2)
> src/sage/graphs/base/sparse_graph.pyx:    sage: S.all_arcs(5,4)
> src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(1,2)
> src/sage/graphs/base/sparse_graph.pyx:        num_arcs = self.all_arcs_unsafe(u, v, arc_labels, size)
> src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)
> src/sage/graphs/base/sparse_graph.pyx:            sage: G.all_arcs(0,1)
> src/sage/graphs/base/sparse_graph.pyx:                     for l_int in self._cg.all_arcs(u_int, v_int)]
> src/sage/graphs/base/sparse_graph.pyx:        for l_int in self._cg.all_arcs(u_int, v_int):
> ```
> 

The last two I would leave for future tickets. But you are right. We really iterate over a structure that is already there (either over a bitset or a tree). So there is no use in wasting resources for creating this list.



---

archive/issue_comments_561557.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-12T13:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561557",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_561558.json:
```json
{
    "body": "<a id='comment:28'></a>OK to let the change from list to iterator for another ticket.\n\nLGTM.\n\nThank you.",
    "created_at": "2020-08-12T13:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561558",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:28'></a>OK to let the change from list to iterator for another ticket.

LGTM.

Thank you.



---

archive/issue_comments_561559.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2020-08-12T13:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561559",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_561560.json:
```json
{
    "body": "<a id='comment:29'></a>Thanks.",
    "created_at": "2020-08-12T15:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561560",
    "user": "https://github.com/kliem"
}
```

<a id='comment:29'></a>Thanks.



---

archive/issue_comments_561561.json:
```json
{
    "body": "Changing branch from \"public/28904-reb2\" to \"a46e717377c1cd020b5bda37922cf8ff42e914a6\"",
    "created_at": "2020-08-14T22:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561561",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/28904-reb2" to "a46e717377c1cd020b5bda37922cf8ff42e914a6"



---

archive/issue_events_073142.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-14T22:23:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28904#event-73142"
}
```



---

archive/issue_comments_561562.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-14T22:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28904#issuecomment-561562",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
