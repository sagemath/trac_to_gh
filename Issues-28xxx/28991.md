# Issue 28991: spkg-configure.m4 for gc

archive/issues_028754.json:
```json
{
    "body": "Split off of #28045, where the libatomic dependency is handled.\n\nCC:  @embray @dimpase @isuruf\n\nReviewer: Michael Orlitzky\n\nAuthor: Thierry Thomas, Dima Pasechnik\n\nBranch: d5c10a5b967108a99c375b1d9c621201e455783c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28991\n\n",
    "closed_at": "2020-09-15T22:00:49Z",
    "created_at": "2020-01-11T22:57:26Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "spkg-configure.m4 for gc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28991",
    "user": "https://github.com/orlitzky"
}
```
Split off of #28045, where the libatomic dependency is handled.

CC:  @embray @dimpase @isuruf

Reviewer: Michael Orlitzky

Author: Thierry Thomas, Dima Pasechnik

Branch: d5c10a5b967108a99c375b1d9c621201e455783c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28991





---

archive/issue_events_073414.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28991#event-73414"
}
```



---

archive/issue_comments_432294.json:
```json
{
    "body": "<a id='comment:2'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432294",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_432295.json:
```json
{
    "body": "spkg-configure.m4 to be copied under build/pkgs/gc",
    "created_at": "2020-04-30T12:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432295",
    "user": "https://github.com/thierry-FreeBSD"
}
```

spkg-configure.m4 to be copied under build/pkgs/gc



---

archive/issue_comments_432296.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [spkg-configure.m4](tarball://root/attachments/some-uuid/ticket28991/spkg-configure.m4) by @thierry-FreeBSD created at 2020-04-30 12:18:51\n\nWith the attached spkg-configure.m4, it works for me on FreeBSD, and Sage uses the system package.\n\nNote: ATM the FreeBSD system package is at v.8.0.4 (boehm-gc-threaded-8.0.4_1), and the pkg-config file is named bdw-gc-threaded.pc - this might be different on other systems.",
    "created_at": "2020-04-30T12:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432296",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:3'></a>Attachment [spkg-configure.m4](tarball://root/attachments/some-uuid/ticket28991/spkg-configure.m4) by @thierry-FreeBSD created at 2020-04-30 12:18:51

With the attached spkg-configure.m4, it works for me on FreeBSD, and Sage uses the system package.

Note: ATM the FreeBSD system package is at v.8.0.4 (boehm-gc-threaded-8.0.4_1), and the pkg-config file is named bdw-gc-threaded.pc - this might be different on other systems.



---

archive/issue_comments_432297.json:
```json
{
    "body": "<a id='comment:4'></a>It's `bdw-gc.pc` on Gentoo at least, so we should check that name too.",
    "created_at": "2020-04-30T13:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432297",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>It's `bdw-gc.pc` on Gentoo at least, so we should check that name too.



---

archive/issue_comments_432298.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 mjo]:\n> It's `bdw-gc.pc` on Gentoo at least, so we should check that name too.\n\nalso on Debian and Fedora it is `bdw-gc`.\n\n- on Debian on needs to install `libgc-dev`\n- on Fedora one needs to install `gc gc-devel`",
    "created_at": "2020-04-30T14:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432298",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>Replying to [comment:4 mjo]:
> It's `bdw-gc.pc` on Gentoo at least, so we should check that name too.

also on Debian and Fedora it is `bdw-gc`.

- on Debian on needs to install `libgc-dev`
- on Fedora one needs to install `gc gc-devel`



---

archive/issue_comments_432299.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2020-08-11T20:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432299",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_432300.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-11T20:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432300",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_432301.json:
```json
{
    "body": "<a id='comment:7'></a>GH Actions run?",
    "created_at": "2020-08-11T23:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432301",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>GH Actions run?



---

archive/issue_comments_432302.json:
```json
{
    "body": "<a id='comment:8'></a>Works on Gentoo now, thanks!",
    "created_at": "2020-08-12T18:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432302",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>Works on Gentoo now, thanks!



---

archive/issue_comments_432303.json:
```json
{
    "body": "<a id='comment:9'></a>tests run on https://github.com/dimpase/sage/pull/16",
    "created_at": "2020-08-12T18:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432303",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>tests run on https://github.com/dimpase/sage/pull/16



---

archive/issue_comments_432304.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-13T14:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432305.json:
```json
{
    "body": "<a id='comment:11'></a>as can be seen on the GH Action logs from https://github.com/dimpase/sage/actions/runs/207790649 libgc is correctly recongnised - if it can be installed\n\nOn macOS Conda, libgc is not found:\nhttps://github.com/dimpase/sage/runs/982690154\n\n```\n  - https://repo.anaconda.com/pkgs/main/osx-64\n  - https://repo.anaconda.com/pkgs/main/noarch\n  - https://repo.anaconda.com/pkgs/r/osx-64\n  - https://repo.anaconda.com/pkgs/r/noarch\n\nTo search for alternate channels that may provide the conda package you're\nlooking for, navigate to\n\n    https://anaconda.org\n\nand use the search bar at the top of the page.\n\n\nERROR: InvocationError for command /bin/bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/conda.txt`; . /Users/runner/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin/activate && /Users/runner/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin/conda install --yes --quiet $PACKAGES' (exited with code 1)\n___________________________________ summary ____________________________________\nERROR:   local-conda-forge-macos-standard: commands failed\n##[error]Process completed with exit code 1.\n```\n\nIsuru, do you get an idea what's wrong here?",
    "created_at": "2020-08-15T08:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432305",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>as can be seen on the GH Action logs from https://github.com/dimpase/sage/actions/runs/207790649 libgc is correctly recongnised - if it can be installed

On macOS Conda, libgc is not found:
https://github.com/dimpase/sage/runs/982690154

```
  - https://repo.anaconda.com/pkgs/main/osx-64
  - https://repo.anaconda.com/pkgs/main/noarch
  - https://repo.anaconda.com/pkgs/r/osx-64
  - https://repo.anaconda.com/pkgs/r/noarch

To search for alternate channels that may provide the conda package you're
looking for, navigate to

    https://anaconda.org

and use the search bar at the top of the page.


ERROR: InvocationError for command /bin/bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/conda.txt`; . /Users/runner/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin/activate && /Users/runner/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin/conda install --yes --quiet $PACKAGES' (exited with code 1)
___________________________________ summary ____________________________________
ERROR:   local-conda-forge-macos-standard: commands failed
##[error]Process completed with exit code 1.
```

Isuru, do you get an idea what's wrong here?



---

archive/issue_comments_432306.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-02T01:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432306",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_432307.json:
```json
{
    "body": "<a id='comment:14'></a>I will remove conda.txt",
    "created_at": "2020-09-02T06:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432307",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>I will remove conda.txt



---

archive/issue_comments_432308.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-02T10:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_432309.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-02T10:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432309",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_432310.json:
```json
{
    "body": "<a id='comment:16'></a>commented out conda, rebased over 9.2.beta11.",
    "created_at": "2020-09-02T10:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432310",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>commented out conda, rebased over 9.2.beta11.



---

archive/issue_comments_432311.json:
```json
{
    "body": "<a id='comment:17'></a>GH run please",
    "created_at": "2020-09-02T16:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432311",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>GH run please



---

archive/issue_comments_432312.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-02T23:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432313.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 mkoeppe]:\n> GH run please\n\n\nsee https://github.com/sagemath/sage/pull/98",
    "created_at": "2020-09-02T23:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432313",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>Replying to [comment:17 mkoeppe]:
> GH run please


see https://github.com/sagemath/sage/pull/98



---

archive/issue_comments_432314.json:
```json
{
    "body": "<a id='comment:20'></a>ping?",
    "created_at": "2020-09-07T08:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432314",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>ping?



---

archive/issue_comments_432315.json:
```json
{
    "body": "<a id='comment:21'></a>LGTM, but can you just delete those conda.txt files rather than comment out their contents? If I'm looking for packages that need Gentoo information, I'm going to be checking for the existence of `distros/gentoo.txt` and assume that it's correct if present.",
    "created_at": "2020-09-07T11:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432315",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>LGTM, but can you just delete those conda.txt files rather than comment out their contents? If I'm looking for packages that need Gentoo information, I'm going to be checking for the existence of `distros/gentoo.txt` and assume that it's correct if present.



---

archive/issue_comments_432316.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-07T11:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432316",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_432317.json:
```json
{
    "body": "<a id='comment:22'></a>Thanks! \n\nAs to deleting, we already have quite a few of distros/foo.txt with commented out content, e.g. `build/pkgs/arb/distros/homebrew.txt`, so, no, the content of these files matters matters :-)",
    "created_at": "2020-09-07T14:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432317",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>Thanks! 

As to deleting, we already have quite a few of distros/foo.txt with commented out content, e.g. `build/pkgs/arb/distros/homebrew.txt`, so, no, the content of these files matters matters :-)



---

archive/issue_events_073415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T22:00:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28991#event-73415"
}
```



---

archive/issue_comments_432318.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T22:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432318",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_432319.json:
```json
{
    "body": "<a id='comment:24'></a>Looks like this may have caused the breakage reported in #30629 (wsl-ubuntu-focal: ECL build fails).",
    "created_at": "2020-09-22T14:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432319",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Looks like this may have caused the breakage reported in #30629 (wsl-ubuntu-focal: ECL build fails).



---

archive/issue_comments_432320.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 mkoeppe]:\n> Looks like this may have caused the breakage reported in #30629 (wsl-ubuntu-focal: ECL build fails).\n\n\nit appears that all the  released versions of gc suffer from the problem at hand, no?",
    "created_at": "2020-09-22T14:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432320",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>Replying to [comment:24 mkoeppe]:
> Looks like this may have caused the breakage reported in #30629 (wsl-ubuntu-focal: ECL build fails).


it appears that all the  released versions of gc suffer from the problem at hand, no?



---

archive/issue_comments_432321.json:
```json
{
    "body": "<a id='comment:26'></a>If I understand the issue correctly, it's a particular libgc configuration used on Ubuntu 20.04 that is the problem.",
    "created_at": "2020-09-22T14:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28991#issuecomment-432321",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>If I understand the issue correctly, it's a particular libgc configuration used on Ubuntu 20.04 that is the problem.
