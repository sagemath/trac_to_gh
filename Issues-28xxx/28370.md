# Issue 28370: py3: polyhedron pynormaliz backend does not handle large coefficients correctly

archive/issues_028133.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: x = polygen(ZZ)\nsage: K.<sqrt2> = NumberField(x^2 - 2, embedding=AA(2).sqrt())\nsage: P = Polyhedron(vertices=[(2**100, sqrt2), (sqrt2,1)], backend='normaliz')\nError in rational_handler: Python int too large to convert to C long\nError in nfelem_handler: unsupported operand type(s) for +=: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nError in rational_handler: Python int too large to convert to C unsigned long\nError in rational_handler: Python int too large to convert to C unsigned long\nError in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nError in rational_handler: Python int too large to convert to C long\nError in rational_handler: Python int too large to convert to C long\nError in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nError in rational_handler: Python int too large to convert to C long\nError in rational_handler: Python int too large to convert to C long\nError in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nsage: P.vertices()\n(A vertex at (sqrt2, 1), A vertex at (0, sqrt2))\n```\nEven though `PyNormaliz` is perfectly fine working with large coefficients\n\n```\nsage: cone = PyNormaliz.NmzCone(cone=[],\n....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],\n....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])\nsage: PyNormaliz.NmzResult(cone, \"VerticesOfPolyhedron\")\n[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],\n [[[1267650600228229401496703205376, 1], [0, 1]],\n  [[0, 1], [1, 1]],\n  [[1, 1], [0, 1]]]]\nsage: PyNormaliz.NmzResult(cone, \"SupportHyperplanes\")\n[[[[0, 1267650600228229401496703205376],\n   [-1, 1267650600228229401496703205376]],\n  [[1, 1], [0, 1]],\n  [[0, 1], [0, 1]]],\n [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]\n```\n\nDepends on #28321\n\nCC:  @mkoeppe @jplab\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28370_\n\n",
    "closed_at": "2019-08-26T18:29:17Z",
    "created_at": "2019-08-20T08:26:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: polyhedron pynormaliz backend does not handle large coefficients correctly",
    "type": "issue",
    "updated_at": "2019-08-26T18:29:17Z",
    "url": "https://github.com/sagemath/sage/issues/28370",
    "user": "https://github.com/videlec"
}
```

```
sage: x = polygen(ZZ)
sage: K.<sqrt2> = NumberField(x^2 - 2, embedding=AA(2).sqrt())
sage: P = Polyhedron(vertices=[(2**100, sqrt2), (sqrt2,1)], backend='normaliz')
Error in rational_handler: Python int too large to convert to C long
Error in nfelem_handler: unsupported operand type(s) for +=: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
Error in rational_handler: Python int too large to convert to C unsigned long
Error in rational_handler: Python int too large to convert to C unsigned long
Error in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
Error in rational_handler: Python int too large to convert to C long
Error in rational_handler: Python int too large to convert to C long
Error in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
Error in rational_handler: Python int too large to convert to C long
Error in rational_handler: Python int too large to convert to C long
Error in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
sage: P.vertices()
(A vertex at (sqrt2, 1), A vertex at (0, sqrt2))
```
Even though `PyNormaliz` is perfectly fine working with large coefficients

```
sage: cone = PyNormaliz.NmzCone(cone=[],
....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],
....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])
sage: PyNormaliz.NmzResult(cone, "VerticesOfPolyhedron")
[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],
 [[[1267650600228229401496703205376, 1], [0, 1]],
  [[0, 1], [1, 1]],
  [[1, 1], [0, 1]]]]
sage: PyNormaliz.NmzResult(cone, "SupportHyperplanes")
[[[[0, 1267650600228229401496703205376],
   [-1, 1267650600228229401496703205376]],
  [[1, 1], [0, 1]],
  [[0, 1], [0, 1]]],
 [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]
```

Depends on #28321

CC:  @mkoeppe @jplab

_Issue created by migration from https://trac.sagemath.org/ticket/28370_





---

archive/issue_events_358077.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T08:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358077"
}
```



---

archive/issue_events_358078.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T08:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358078"
}
```



---

archive/issue_events_358079.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T08:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358079"
}
```



---

archive/issue_comments_444943.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,3 +17,21 @@\n sage: P.vertices()\n (A vertex at (sqrt2, 1), A vertex at (0, sqrt2))\n ```\n+Even though `PyNormaliz` is perfectly fine working with large coefficients\n+\n+```\n+sage: cone = PyNormaliz.NmzCone(cone=[],\n+....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],\n+....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])\n+sage: PyNormaliz.NmzResult(cone, \"VerticesOfPolyhedron\")\n+[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],\n+ [[[1267650600228229401496703205376, 1], [0, 1]],\n+  [[0, 1], [1, 1]],\n+  [[1, 1], [0, 1]]]]\n+sage: PyNormaliz.NmzResult(cone, \"SupportHyperplanes\")\n+[[[[0, 1267650600228229401496703205376],\n+   [-1, 1267650600228229401496703205376]],\n+  [[1, 1], [0, 1]],\n+  [[0, 1], [0, 1]]],\n+ [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]\n+```\n``````\n",
    "created_at": "2019-08-20T08:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444943",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,3 +17,21 @@
 sage: P.vertices()
 (A vertex at (sqrt2, 1), A vertex at (0, sqrt2))
 ```
+Even though `PyNormaliz` is perfectly fine working with large coefficients
+
+```
+sage: cone = PyNormaliz.NmzCone(cone=[],
+....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],
+....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])
+sage: PyNormaliz.NmzResult(cone, "VerticesOfPolyhedron")
+[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],
+ [[[1267650600228229401496703205376, 1], [0, 1]],
+  [[0, 1], [1, 1]],
+  [[1, 1], [0, 1]]]]
+sage: PyNormaliz.NmzResult(cone, "SupportHyperplanes")
+[[[[0, 1267650600228229401496703205376],
+   [-1, 1267650600228229401496703205376]],
+  [[1, 1], [0, 1]],
+  [[0, 1], [0, 1]]],
+ [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]
+```
``````




---

archive/issue_comments_444944.json:
```json
{
    "body": "Dependencies: **#28321**",
    "created_at": "2019-08-20T08:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444944",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#28321**



---

archive/issue_events_358080.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T08:38:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "title_is": "py3: polyhedron pynormaliz backend does not handle large coefficients correctly",
    "title_was": "Polyhedron pynormaliz backend does not handle large coefficients correctly",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358080"
}
```



---

archive/issue_comments_444945.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI just think that #28321 is to blame (Python 3 issue)",
    "created_at": "2019-08-20T08:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444945",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'>Comment 2:</a>
I just think that #28321 is to blame (Python 3 issue)



---

archive/issue_comments_444946.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2019-08-20T08:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444946",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_444947.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nYou mean that it would be a duplicate? i.e. that the backend is fine?",
    "created_at": "2019-08-20T08:53:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444947",
    "user": "https://github.com/jplab"
}
```

<a id='comment:3'>Comment 3:</a>
You mean that it would be a duplicate? i.e. that the backend is fine?



---

archive/issue_comments_444948.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nIt is probably not a problem with the backend.",
    "created_at": "2019-08-20T08:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444948",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'>Comment 4:</a>
It is probably not a problem with the backend.



---

archive/issue_comments_444949.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.",
    "created_at": "2019-08-20T11:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444949",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'>Comment 5:</a>
I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.



---

archive/issue_events_358081.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T11:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358081"
}
```



---

archive/issue_comments_444950.json:
```json
{
    "body": "Changed author from **Vincent Delecroix** to none",
    "created_at": "2019-08-20T11:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444950",
    "user": "https://github.com/videlec"
}
```

Changed author from **Vincent Delecroix** to none



---

archive/issue_events_358082.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T11:37:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358082"
}
```



---

archive/issue_events_358083.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-08-20T12:07:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358083"
}
```



---

archive/issue_events_358084.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-08-20T12:07:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358084"
}
```



---

archive/issue_comments_444951.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@videlec](#comment%3A5):\n> I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.\n\nI agree. Where to raise this error? This should become another ticket?",
    "created_at": "2019-08-20T12:07:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444951",
    "user": "https://github.com/jplab"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@videlec](#comment%3A5):
> I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.

I agree. Where to raise this error? This should become another ticket?



---

archive/issue_comments_444952.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@jplab](#comment%3A7):\n> Replying to [@videlec](#comment%3A5):\n> > I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.\n\n> \n> I agree. Where to raise this error? This should become another ticket?\n\n- Another ticket: yes\n- What to do: just remove the `try/except`",
    "created_at": "2019-08-20T12:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28370#issuecomment-444952",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@jplab](#comment%3A7):
> Replying to [@videlec](#comment%3A5):
> > I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.

> 
> I agree. Where to raise this error? This should become another ticket?

- Another ticket: yes
- What to do: just remove the `try/except`



---

archive/issue_events_358085.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-26T18:29:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358085"
}
```



---

archive/issue_events_358086.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-26T18:29:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358086"
}
```



---

archive/issue_events_358087.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-26T18:29:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28370#event-358087"
}
```
