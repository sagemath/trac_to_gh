# Issue 28370: py3: polyhedron pynormaliz backend does not handle large coefficients correctly

archive/issues_028133.json:
```json
{
    "body": "\n```\nsage: x = polygen(ZZ)\nsage: K.<sqrt2> = NumberField(x^2 - 2, embedding=AA(2).sqrt())\nsage: P = Polyhedron(vertices=[(2**100, sqrt2), (sqrt2,1)], backend='normaliz')\nError in rational_handler: Python int too large to convert to C long\nError in nfelem_handler: unsupported operand type(s) for +=: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nError in rational_handler: Python int too large to convert to C unsigned long\nError in rational_handler: Python int too large to convert to C unsigned long\nError in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nError in rational_handler: Python int too large to convert to C long\nError in rational_handler: Python int too large to convert to C long\nError in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nError in rational_handler: Python int too large to convert to C long\nError in rational_handler: Python int too large to convert to C long\nError in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'\nsage: P.vertices()\n(A vertex at (sqrt2, 1), A vertex at (0, sqrt2))\n```\nEven though `PyNormaliz` is perfectly fine working with large coefficients\n\n```\nsage: cone = PyNormaliz.NmzCone(cone=[],\n....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],\n....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])\nsage: PyNormaliz.NmzResult(cone, \"VerticesOfPolyhedron\")\n[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],\n [[[1267650600228229401496703205376, 1], [0, 1]],\n  [[0, 1], [1, 1]],\n  [[1, 1], [0, 1]]]]\nsage: PyNormaliz.NmzResult(cone, \"SupportHyperplanes\")\n[[[[0, 1267650600228229401496703205376],\n   [-1, 1267650600228229401496703205376]],\n  [[1, 1], [0, 1]],\n  [[0, 1], [0, 1]]],\n [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]\n```\n\nCC:  @mkoeppe @jplab\n\nDependencies: #28321\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/28370\n\n",
    "closed_at": "2019-08-26T18:29:17Z",
    "created_at": "2019-08-20T08:26:20Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "py3: polyhedron pynormaliz backend does not handle large coefficients correctly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28370",
    "user": "https://github.com/videlec"
}
```

```
sage: x = polygen(ZZ)
sage: K.<sqrt2> = NumberField(x^2 - 2, embedding=AA(2).sqrt())
sage: P = Polyhedron(vertices=[(2**100, sqrt2), (sqrt2,1)], backend='normaliz')
Error in rational_handler: Python int too large to convert to C long
Error in nfelem_handler: unsupported operand type(s) for +=: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
Error in rational_handler: Python int too large to convert to C unsigned long
Error in rational_handler: Python int too large to convert to C unsigned long
Error in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
Error in rational_handler: Python int too large to convert to C long
Error in rational_handler: Python int too large to convert to C long
Error in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
Error in rational_handler: Python int too large to convert to C long
Error in rational_handler: Python int too large to convert to C long
Error in nfelem_handler: unsupported operand type(s) for *: 'NoneType' and 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'
sage: P.vertices()
(A vertex at (sqrt2, 1), A vertex at (0, sqrt2))
```
Even though `PyNormaliz` is perfectly fine working with large coefficients

```
sage: cone = PyNormaliz.NmzCone(cone=[],
....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],
....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])
sage: PyNormaliz.NmzResult(cone, "VerticesOfPolyhedron")
[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],
 [[[1267650600228229401496703205376, 1], [0, 1]],
  [[0, 1], [1, 1]],
  [[1, 1], [0, 1]]]]
sage: PyNormaliz.NmzResult(cone, "SupportHyperplanes")
[[[[0, 1267650600228229401496703205376],
   [-1, 1267650600228229401496703205376]],
  [[1, 1], [0, 1]],
  [[0, 1], [0, 1]]],
 [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]
```

CC:  @mkoeppe @jplab

Dependencies: #28321

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/28370





---

archive/issue_comments_543401.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,3 +17,21 @@\n sage: P.vertices()\n (A vertex at (sqrt2, 1), A vertex at (0, sqrt2))\n ```\n+Even though `PyNormaliz` is perfectly fine working with large coefficients\n+\n+```\n+sage: cone = PyNormaliz.NmzCone(cone=[],\n+....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],\n+....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])\n+sage: PyNormaliz.NmzResult(cone, \"VerticesOfPolyhedron\")\n+[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],\n+ [[[1267650600228229401496703205376, 1], [0, 1]],\n+  [[0, 1], [1, 1]],\n+  [[1, 1], [0, 1]]]]\n+sage: PyNormaliz.NmzResult(cone, \"SupportHyperplanes\")\n+[[[[0, 1267650600228229401496703205376],\n+   [-1, 1267650600228229401496703205376]],\n+  [[1, 1], [0, 1]],\n+  [[0, 1], [0, 1]]],\n+ [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]\n+```\n``````\n",
    "created_at": "2019-08-20T08:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543401",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,3 +17,21 @@
 sage: P.vertices()
 (A vertex at (sqrt2, 1), A vertex at (0, sqrt2))
 ```
+Even though `PyNormaliz` is perfectly fine working with large coefficients
+
+```
+sage: cone = PyNormaliz.NmzCone(cone=[],
+....:          number_field=['a^2 - 2', 'a', '[1.414213562373095 +/- 2.99e-16]'],
+....:          vertices=[[1267650600228229401496703205376r, [[0r, 1r], [1r, 1r]], 1r], [[[0r, 1r], [1r, 1r]], 1r, 1r]])
+sage: PyNormaliz.NmzResult(cone, "VerticesOfPolyhedron")
+[[[[0, 1], [1, 1]], [[1, 1], [0, 1]], [[1, 1], [0, 1]]],
+ [[[1267650600228229401496703205376, 1], [0, 1]],
+  [[0, 1], [1, 1]],
+  [[1, 1], [0, 1]]]]
+sage: PyNormaliz.NmzResult(cone, "SupportHyperplanes")
+[[[[0, 1267650600228229401496703205376],
+   [-1, 1267650600228229401496703205376]],
+  [[1, 1], [0, 1]],
+  [[0, 1], [0, 1]]],
+ [[[0, 2], [1, 2]], [[-1, 1], [0, 1]], [[0, 1], [0, 1]]]]
+```
``````




---

archive/issue_comments_543402.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#28321\"",
    "created_at": "2019-08-20T08:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543402",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "" to "#28321"



---

archive/issue_events_088098.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "rename": {
        "from": "Polyhedron pynormaliz backend does not handle large coefficients correctly",
        "to": "py3: polyhedron pynormaliz backend does not handle large coefficients correctly"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28370#event-88098"
}
```



---

archive/issue_comments_543403.json:
```json
{
    "body": "<a id='comment:2'></a>\nI just think that #28321 is to blame (Python 3 issue)",
    "created_at": "2019-08-20T08:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543403",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>
I just think that #28321 is to blame (Python 3 issue)



---

archive/issue_comments_543404.json:
```json
{
    "body": "Changing author from \"\" to \"Vincent Delecroix\"",
    "created_at": "2019-08-20T08:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543404",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Vincent Delecroix"



---

archive/issue_comments_543405.json:
```json
{
    "body": "<a id='comment:3'></a>\nYou mean that it would be a duplicate? i.e. that the backend is fine?",
    "created_at": "2019-08-20T08:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543405",
    "user": "https://github.com/jplab"
}
```

<a id='comment:3'></a>
You mean that it would be a duplicate? i.e. that the backend is fine?



---

archive/issue_comments_543406.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt is probably not a problem with the backend.",
    "created_at": "2019-08-20T08:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543406",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
It is probably not a problem with the backend.



---

archive/issue_comments_543407.json:
```json
{
    "body": "<a id='comment:5'></a>\nI confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.",
    "created_at": "2019-08-20T11:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543407",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.



---

archive/issue_comments_543408.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-20T11:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543408",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_543409.json:
```json
{
    "body": "Changing author from \"Vincent Delecroix\" to \"\"",
    "created_at": "2019-08-20T11:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543409",
    "user": "https://github.com/videlec"
}
```

Changing author from "Vincent Delecroix" to ""



---

archive/issue_events_088099.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-08-20T11:37:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28370#event-88099"
}
```



---

archive/issue_comments_543410.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-20T12:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543410",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_543411.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vdelecroix](#comment%3A5):\n> I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.\n\n\nI agree. Where to raise this error? This should become another ticket?",
    "created_at": "2019-08-20T12:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543411",
    "user": "https://github.com/jplab"
}
```

<a id='comment:7'></a>
Replying to [vdelecroix](#comment%3A5):
> I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.


I agree. Where to raise this error? This should become another ticket?



---

archive/issue_comments_543412.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jipilab](#comment%3A7):\n> Replying to [vdelecroix](#comment%3A5):\n> > I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.\n\n> \n> I agree. Where to raise this error? This should become another ticket?\n\n\n- Another ticket: yes\n- What to do: just remove the `try/except`",
    "created_at": "2019-08-20T12:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543412",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Replying to [jipilab](#comment%3A7):
> Replying to [vdelecroix](#comment%3A5):
> > I confirm that it is solved with #28321... however, the fact that errors are not raised in the constructor is a bug in itself. In the example I wrote in the ticket description, I obtain a polytope `P` which is simply wrong. It is to my mind much better to get an error rather than false results.

> 
> I agree. Where to raise this error? This should become another ticket?


- Another ticket: yes
- What to do: just remove the `try/except`



---

archive/issue_comments_543413.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2019-08-26T18:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28370#issuecomment-543413",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate



---

archive/issue_events_088100.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-26T18:29:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28370#event-88100"
}
```
