# Issue 28895: Meta ticket: Simplify and speed up graph backends

archive/issues_028658.json:
```json
{
    "body": "This ticket collects tickets simplifying and improving the graph backends.\n\nIt is motivated by the following post:\n\nhttps://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ\n\n- #6604: Polish the use of iterators in C graphs\n-  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) \n- #12387: Everything is not well with dense graph backends\n- #12540: Graph library passes almost surelly erroneous calls without an exception\n- #13730: Speed up some graph iterations\n- #22349: Deprecate sorting of Graph vertices and edges by default \n- #28259: graph add_edges/delete_edges are dramatically slow \n- #28896: Graphs: Move common methods of backends to CGraph \n- #28897: BipartiteGraph blindly trusts generic graphs\n- #28904: Move reversed graph from backend to CGraph for sparse graphs\n- #30641: equality of graphs is 60 times slower than equality of their list of edges \n- #30665: Optimize edge iterator for graphs\n- #30769: Unify graph backends\n- #30753: Further improvements in method subgraph\n- #30777: Improve deleting of edges of graphs\n- use iterators for outgoing and ingoing arcs\n- #31197: Use bitsets/binary matrix for edges of dense graphs \n\nPossibly related tickets:\n\n- #6604: Polish the use of iterators in C graphs \n- #9143: Speed up graph generation using Cython \n- #9301: Modified check_edge_label in the sparse graph backend to consider equals the same objects rather than objects with the same contents\n- #22374: {c,sparse}_graph: systematically turn integer-like vertices into ints\n- #24989: G.edges_incident returns edges with vertices swapped\n- #25465, #28865: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph\n- #28309: improvement of method allow_multiple_edges\n- #31117: Improve Breadth First Search in c_graph.pyx\n- #31129: Improve Depth First Search in c_graph.pyx\n\nHere are some timings we try to improve along the way:\n\n```\nsage: import itertools\nsage: def test_speed(n):\n....:     for struct in ('dense', 'sparse'):\n....:         print(\"\\nnow doing {}\".format(struct))\n....:         G = Graph(n, data_structure=struct)\n....:         edges = itertools.combinations(range(n), 2)\n....:         print(\"adding edges\")\n....:         %time G.add_edges(edges)\n....:         print(\"copy to dense\")\n....:         %time _ = copy(G)\n....:         print(\"copy to sparse\")\n....:         %time _ = G.copy(sparse=True)\n....:         print(\"copy to statice sparse\")\n....:         %time H = G.copy(immutable=True)\n....:         edges = itertools.combinations(range(n), 2)\n....:         print(\"delete edges\")\n....:         %time G.delete_edges(edges)\n....:     \n....:         print(\"copying static sparse to {}\".format(struct))\n....:         %time _ = H.copy(data_structure=struct)\n....:   \n```\n\n```\nsage: test_speed(1000)\n\nnow doing dense\nadding edges\nCPU times: user 169 ms, sys: 4 \u00b5s, total: 169 ms\nWall time: 169 ms\ncopy to dense\nCPU times: user 2.14 s, sys: 0 ns, total: 2.14 s\nWall time: 2.14 s\ncopy to sparse\nCPU times: user 2.44 s, sys: 0 ns, total: 2.44 s\nWall time: 2.44 s\ncopy to statice sparse\nCPU times: user 2.75 s, sys: 3.61 ms, total: 2.75 s\nWall time: 2.75 s\ndelete edges\nCPU times: user 613 ms, sys: 0 ns, total: 613 ms\nWall time: 613 ms\ncopying static sparse to dense\nCPU times: user 282 ms, sys: 0 ns, total: 282 ms\nWall time: 282 ms\n\nnow doing sparse\nadding edges\nCPU times: user 434 ms, sys: 0 ns, total: 434 ms\nWall time: 435 ms\ncopy to dense\nCPU times: user 619 ms, sys: 0 ns, total: 619 ms\nWall time: 619 ms\ncopy to sparse\nCPU times: user 747 ms, sys: 3.84 ms, total: 750 ms\nWall time: 750 ms\ncopy to statice sparse\nCPU times: user 997 ms, sys: 0 ns, total: 997 ms\nWall time: 997 ms\ndelete edges\nCPU times: user 896 ms, sys: 0 ns, total: 896 ms\nWall time: 896 ms\ncopying static sparse to sparse\nCPU times: user 582 ms, sys: 0 ns, total: 582 ms\nWall time: 582 ms\n```\n\n```\nsage: test_speed(2000)\n\nnow doing dense\nadding edges\nCPU times: user 672 ms, sys: 0 ns, total: 672 ms\nWall time: 671 ms\ncopy to dense\nCPU times: user 16.1 s, sys: 0 ns, total: 16.1 s\nWall time: 16.1 s\ncopy to sparse\nCPU times: user 17.4 s, sys: 34.7 ms, total: 17.5 s\nWall time: 17.5 s\ncopy to statice sparse\nCPU times: user 18.9 s, sys: 51.6 ms, total: 18.9 s\nWall time: 18.9 s\ndelete edges\nCPU times: user 2.49 s, sys: 0 ns, total: 2.49 s\nWall time: 2.49 s\ncopying static sparse to dense\nCPU times: user 1.18 s, sys: 0 ns, total: 1.18 s\nWall time: 1.18 s\n\nnow doing sparse\nadding edges\nCPU times: user 1.87 s, sys: 0 ns, total: 1.87 s\nWall time: 1.87 s\ncopy to dense\nCPU times: user 2.64 s, sys: 0 ns, total: 2.64 s\nWall time: 2.64 s\ncopy to sparse\nCPU times: user 3.21 s, sys: 47.8 ms, total: 3.26 s\nWall time: 3.26 s\ncopy to statice sparse\nCPU times: user 4.25 s, sys: 36 ms, total: 4.28 s\nWall time: 4.28 s\ndelete edges\nCPU times: user 3.86 s, sys: 0 ns, total: 3.86 s\nWall time: 3.86 s\ncopying static sparse to sparse\nCPU times: user 2.55 s, sys: 0 ns, total: 2.55 s\nWall time: 2.55 s\n```\n\n**CC:**  @dcoudert @kliem\n\n**Keywords:** graphs, backends\n\n**Status:** new\n\nIssue created by migration from https://trac.sagemath.org/ticket/28895\n\n",
    "created_at": "2019-12-18T20:12:51Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta ticket: Simplify and speed up graph backends",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28895",
    "user": "https://github.com/kliem"
}
```
This ticket collects tickets simplifying and improving the graph backends.

It is motivated by the following post:

https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ

- #6604: Polish the use of iterators in C graphs
-  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) 
- #12387: Everything is not well with dense graph backends
- #12540: Graph library passes almost surelly erroneous calls without an exception
- #13730: Speed up some graph iterations
- #22349: Deprecate sorting of Graph vertices and edges by default 
- #28259: graph add_edges/delete_edges are dramatically slow 
- #28896: Graphs: Move common methods of backends to CGraph 
- #28897: BipartiteGraph blindly trusts generic graphs
- #28904: Move reversed graph from backend to CGraph for sparse graphs
- #30641: equality of graphs is 60 times slower than equality of their list of edges 
- #30665: Optimize edge iterator for graphs
- #30769: Unify graph backends
- #30753: Further improvements in method subgraph
- #30777: Improve deleting of edges of graphs
- use iterators for outgoing and ingoing arcs
- #31197: Use bitsets/binary matrix for edges of dense graphs 

Possibly related tickets:

- #6604: Polish the use of iterators in C graphs 
- #9143: Speed up graph generation using Cython 
- #9301: Modified check_edge_label in the sparse graph backend to consider equals the same objects rather than objects with the same contents
- #22374: {c,sparse}_graph: systematically turn integer-like vertices into ints
- #24989: G.edges_incident returns edges with vertices swapped
- #25465, #28865: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph
- #28309: improvement of method allow_multiple_edges
- #31117: Improve Breadth First Search in c_graph.pyx
- #31129: Improve Depth First Search in c_graph.pyx

Here are some timings we try to improve along the way:

```
sage: import itertools
sage: def test_speed(n):
....:     for struct in ('dense', 'sparse'):
....:         print("\nnow doing {}".format(struct))
....:         G = Graph(n, data_structure=struct)
....:         edges = itertools.combinations(range(n), 2)
....:         print("adding edges")
....:         %time G.add_edges(edges)
....:         print("copy to dense")
....:         %time _ = copy(G)
....:         print("copy to sparse")
....:         %time _ = G.copy(sparse=True)
....:         print("copy to statice sparse")
....:         %time H = G.copy(immutable=True)
....:         edges = itertools.combinations(range(n), 2)
....:         print("delete edges")
....:         %time G.delete_edges(edges)
....:     
....:         print("copying static sparse to {}".format(struct))
....:         %time _ = H.copy(data_structure=struct)
....:   
```

```
sage: test_speed(1000)

now doing dense
adding edges
CPU times: user 169 ms, sys: 4 µs, total: 169 ms
Wall time: 169 ms
copy to dense
CPU times: user 2.14 s, sys: 0 ns, total: 2.14 s
Wall time: 2.14 s
copy to sparse
CPU times: user 2.44 s, sys: 0 ns, total: 2.44 s
Wall time: 2.44 s
copy to statice sparse
CPU times: user 2.75 s, sys: 3.61 ms, total: 2.75 s
Wall time: 2.75 s
delete edges
CPU times: user 613 ms, sys: 0 ns, total: 613 ms
Wall time: 613 ms
copying static sparse to dense
CPU times: user 282 ms, sys: 0 ns, total: 282 ms
Wall time: 282 ms

now doing sparse
adding edges
CPU times: user 434 ms, sys: 0 ns, total: 434 ms
Wall time: 435 ms
copy to dense
CPU times: user 619 ms, sys: 0 ns, total: 619 ms
Wall time: 619 ms
copy to sparse
CPU times: user 747 ms, sys: 3.84 ms, total: 750 ms
Wall time: 750 ms
copy to statice sparse
CPU times: user 997 ms, sys: 0 ns, total: 997 ms
Wall time: 997 ms
delete edges
CPU times: user 896 ms, sys: 0 ns, total: 896 ms
Wall time: 896 ms
copying static sparse to sparse
CPU times: user 582 ms, sys: 0 ns, total: 582 ms
Wall time: 582 ms
```

```
sage: test_speed(2000)

now doing dense
adding edges
CPU times: user 672 ms, sys: 0 ns, total: 672 ms
Wall time: 671 ms
copy to dense
CPU times: user 16.1 s, sys: 0 ns, total: 16.1 s
Wall time: 16.1 s
copy to sparse
CPU times: user 17.4 s, sys: 34.7 ms, total: 17.5 s
Wall time: 17.5 s
copy to statice sparse
CPU times: user 18.9 s, sys: 51.6 ms, total: 18.9 s
Wall time: 18.9 s
delete edges
CPU times: user 2.49 s, sys: 0 ns, total: 2.49 s
Wall time: 2.49 s
copying static sparse to dense
CPU times: user 1.18 s, sys: 0 ns, total: 1.18 s
Wall time: 1.18 s

now doing sparse
adding edges
CPU times: user 1.87 s, sys: 0 ns, total: 1.87 s
Wall time: 1.87 s
copy to dense
CPU times: user 2.64 s, sys: 0 ns, total: 2.64 s
Wall time: 2.64 s
copy to sparse
CPU times: user 3.21 s, sys: 47.8 ms, total: 3.26 s
Wall time: 3.26 s
copy to statice sparse
CPU times: user 4.25 s, sys: 36 ms, total: 4.28 s
Wall time: 4.28 s
delete edges
CPU times: user 3.86 s, sys: 0 ns, total: 3.86 s
Wall time: 3.86 s
copying static sparse to sparse
CPU times: user 2.55 s, sys: 0 ns, total: 2.55 s
Wall time: 2.55 s
```

**CC:**  @dcoudert @kliem

**Keywords:** graphs, backends

**Status:** new

Issue created by migration from https://trac.sagemath.org/ticket/28895





---

archive/issue_comments_562431.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n It is motivated by the following post:\n \n https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ\n+\n+-  #28896: Graphs: Move common methods of backends to CGraph \n``````\n",
    "created_at": "2019-12-18T20:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562431",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 It is motivated by the following post:
 
 https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ
+
+-  #28896: Graphs: Move common methods of backends to CGraph 
``````




---

archive/issue_comments_562432.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe idea is that in the end, most top level function should be handled in `c_graph.pyx`.\nIf possible, only the low level functions are done separate for each backend.\n\nOnce things are unified (as good as different backends allow), one should speed up things. E.g. the following is extremely slow:\n\n```\nsage: import itertools\nsage: def test_speed(n):\n....:     G = Graph(n, data_structure='dense')\n....:     edges = itertools.combinations(range(n), 2)\n....:     %time G.add_edges(edges)\n....:     edges = itertools.combinations(range(n), 2)\n....:     %time G.delete_edges(edges)\nsage: test_speed(1000)\nCPU times: user 175 ms, sys: 8 \u00b5s, total: 175 ms\nWall time: 175 ms\nCPU times: user 574 ms, sys: 0 ns, total: 574 ms\nWall time: 574 ms\n```\nI got both things down to about 80 ms by calling `add_edges` on the top level and then actually using the unsafe methods wherever possible (if we already obtained the indices safely, there should be nothing preventing as from using unsafe methods). Similar for `delete_edges`.",
    "created_at": "2019-12-18T20:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562432",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
The idea is that in the end, most top level function should be handled in `c_graph.pyx`.
If possible, only the low level functions are done separate for each backend.

Once things are unified (as good as different backends allow), one should speed up things. E.g. the following is extremely slow:

```
sage: import itertools
sage: def test_speed(n):
....:     G = Graph(n, data_structure='dense')
....:     edges = itertools.combinations(range(n), 2)
....:     %time G.add_edges(edges)
....:     edges = itertools.combinations(range(n), 2)
....:     %time G.delete_edges(edges)
sage: test_speed(1000)
CPU times: user 175 ms, sys: 8 µs, total: 175 ms
Wall time: 175 ms
CPU times: user 574 ms, sys: 0 ns, total: 574 ms
Wall time: 574 ms
```
I got both things down to about 80 ms by calling `add_edges` on the top level and then actually using the unsafe methods wherever possible (if we already obtained the indices safely, there should be nothing preventing as from using unsafe methods). Similar for `delete_edges`.



---

archive/issue_comments_562433.json:
```json
{
    "body": "<a id='comment:3'></a>\nAdding this, because I missed it on my first try to optimize `add_edges`. This would have created a mistake in `BipartiteGraph` without a doctest catching on.",
    "created_at": "2019-12-18T20:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562433",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Adding this, because I missed it on my first try to optimize `add_edges`. This would have created a mistake in `BipartiteGraph` without a doctest catching on.



---

archive/issue_comments_562434.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,3 +5,4 @@\n https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ\n \n -  #28896: Graphs: Move common methods of backends to CGraph \n+-  #28897: BipartiteGraph blindly trusts generic graphs \n``````\n",
    "created_at": "2019-12-18T20:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562434",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,3 +5,4 @@
 https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ
 
 -  #28896: Graphs: Move common methods of backends to CGraph 
+-  #28897: BipartiteGraph blindly trusts generic graphs 
``````




---

archive/issue_comments_562435.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,4 +5,117 @@\n https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ\n \n -  #28896: Graphs: Move common methods of backends to CGraph \n--  #28897: BipartiteGraph blindly trusts generic graphs \n+-  #28897: BipartiteGraph blindly trusts generic graphs\n+\n+Here are some timings we try to improve along the way:\n+\n+```\n+sage: def test_speed(n):\n+....:     for struct in ('dense', 'sparse'):\n+....:         print(\"\\nnow doing {}\".format(struct))\n+....:         G = Graph(n, data_structure=struct)\n+....:         edges = itertools.combinations(range(n), 2)\n+....:         print(\"adding edges\")\n+....:         %time G.add_edges(edges)\n+....:         print(\"copy to dense\")\n+....:         %time _ = copy(G)\n+....:         print(\"copy to sparse\")\n+....:         %time _ = G.copy(sparse=True)\n+....:         print(\"copy to statice sparse\")\n+....:         %time H = G.copy(immutable=True)\n+....:         edges = itertools.combinations(range(n), 2)\n+....:         print(\"delete edges\")\n+....:         %time G.delete_edges(edges)\n+....:     \n+....:         print(\"copying static sparse to {}\".format(struct))\n+....:         %time _ = H.copy(data_structure=struct)\n+....:   \n+```\n+\n+```\n+sage: test_speed(1000)\n+\n+now doing dense\n+adding edges\n+CPU times: user 169 ms, sys: 4 \u00b5s, total: 169 ms\n+Wall time: 169 ms\n+copy to dense\n+CPU times: user 2.14 s, sys: 0 ns, total: 2.14 s\n+Wall time: 2.14 s\n+copy to sparse\n+CPU times: user 2.44 s, sys: 0 ns, total: 2.44 s\n+Wall time: 2.44 s\n+copy to statice sparse\n+CPU times: user 2.75 s, sys: 3.61 ms, total: 2.75 s\n+Wall time: 2.75 s\n+delete edges\n+CPU times: user 613 ms, sys: 0 ns, total: 613 ms\n+Wall time: 613 ms\n+copying static sparse to dense\n+CPU times: user 282 ms, sys: 0 ns, total: 282 ms\n+Wall time: 282 ms\n+\n+now doing sparse\n+adding edges\n+CPU times: user 434 ms, sys: 0 ns, total: 434 ms\n+Wall time: 435 ms\n+copy to dense\n+CPU times: user 619 ms, sys: 0 ns, total: 619 ms\n+Wall time: 619 ms\n+copy to sparse\n+CPU times: user 747 ms, sys: 3.84 ms, total: 750 ms\n+Wall time: 750 ms\n+copy to statice sparse\n+CPU times: user 997 ms, sys: 0 ns, total: 997 ms\n+Wall time: 997 ms\n+delete edges\n+CPU times: user 896 ms, sys: 0 ns, total: 896 ms\n+Wall time: 896 ms\n+copying static sparse to sparse\n+CPU times: user 582 ms, sys: 0 ns, total: 582 ms\n+Wall time: 582 ms\n+```\n+\n+```\n+sage: test_speed(2000)\n+\n+now doing dense\n+adding edges\n+CPU times: user 672 ms, sys: 0 ns, total: 672 ms\n+Wall time: 671 ms\n+copy to dense\n+CPU times: user 16.1 s, sys: 0 ns, total: 16.1 s\n+Wall time: 16.1 s\n+copy to sparse\n+CPU times: user 17.4 s, sys: 34.7 ms, total: 17.5 s\n+Wall time: 17.5 s\n+copy to statice sparse\n+CPU times: user 18.9 s, sys: 51.6 ms, total: 18.9 s\n+Wall time: 18.9 s\n+delete edges\n+CPU times: user 2.49 s, sys: 0 ns, total: 2.49 s\n+Wall time: 2.49 s\n+copying static sparse to dense\n+CPU times: user 1.18 s, sys: 0 ns, total: 1.18 s\n+Wall time: 1.18 s\n+\n+now doing sparse\n+adding edges\n+CPU times: user 1.87 s, sys: 0 ns, total: 1.87 s\n+Wall time: 1.87 s\n+copy to dense\n+CPU times: user 2.64 s, sys: 0 ns, total: 2.64 s\n+Wall time: 2.64 s\n+copy to sparse\n+CPU times: user 3.21 s, sys: 47.8 ms, total: 3.26 s\n+Wall time: 3.26 s\n+copy to statice sparse\n+CPU times: user 4.25 s, sys: 36 ms, total: 4.28 s\n+Wall time: 4.28 s\n+delete edges\n+CPU times: user 3.86 s, sys: 0 ns, total: 3.86 s\n+Wall time: 3.86 s\n+copying static sparse to sparse\n+CPU times: user 2.55 s, sys: 0 ns, total: 2.55 s\n+Wall time: 2.55 s\n+```\n``````\n",
    "created_at": "2019-12-19T06:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562435",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,4 +5,117 @@
 https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ
 
 -  #28896: Graphs: Move common methods of backends to CGraph 
--  #28897: BipartiteGraph blindly trusts generic graphs 
+-  #28897: BipartiteGraph blindly trusts generic graphs
+
+Here are some timings we try to improve along the way:
+
+```
+sage: def test_speed(n):
+....:     for struct in ('dense', 'sparse'):
+....:         print("\nnow doing {}".format(struct))
+....:         G = Graph(n, data_structure=struct)
+....:         edges = itertools.combinations(range(n), 2)
+....:         print("adding edges")
+....:         %time G.add_edges(edges)
+....:         print("copy to dense")
+....:         %time _ = copy(G)
+....:         print("copy to sparse")
+....:         %time _ = G.copy(sparse=True)
+....:         print("copy to statice sparse")
+....:         %time H = G.copy(immutable=True)
+....:         edges = itertools.combinations(range(n), 2)
+....:         print("delete edges")
+....:         %time G.delete_edges(edges)
+....:     
+....:         print("copying static sparse to {}".format(struct))
+....:         %time _ = H.copy(data_structure=struct)
+....:   
+```
+
+```
+sage: test_speed(1000)
+
+now doing dense
+adding edges
+CPU times: user 169 ms, sys: 4 µs, total: 169 ms
+Wall time: 169 ms
+copy to dense
+CPU times: user 2.14 s, sys: 0 ns, total: 2.14 s
+Wall time: 2.14 s
+copy to sparse
+CPU times: user 2.44 s, sys: 0 ns, total: 2.44 s
+Wall time: 2.44 s
+copy to statice sparse
+CPU times: user 2.75 s, sys: 3.61 ms, total: 2.75 s
+Wall time: 2.75 s
+delete edges
+CPU times: user 613 ms, sys: 0 ns, total: 613 ms
+Wall time: 613 ms
+copying static sparse to dense
+CPU times: user 282 ms, sys: 0 ns, total: 282 ms
+Wall time: 282 ms
+
+now doing sparse
+adding edges
+CPU times: user 434 ms, sys: 0 ns, total: 434 ms
+Wall time: 435 ms
+copy to dense
+CPU times: user 619 ms, sys: 0 ns, total: 619 ms
+Wall time: 619 ms
+copy to sparse
+CPU times: user 747 ms, sys: 3.84 ms, total: 750 ms
+Wall time: 750 ms
+copy to statice sparse
+CPU times: user 997 ms, sys: 0 ns, total: 997 ms
+Wall time: 997 ms
+delete edges
+CPU times: user 896 ms, sys: 0 ns, total: 896 ms
+Wall time: 896 ms
+copying static sparse to sparse
+CPU times: user 582 ms, sys: 0 ns, total: 582 ms
+Wall time: 582 ms
+```
+
+```
+sage: test_speed(2000)
+
+now doing dense
+adding edges
+CPU times: user 672 ms, sys: 0 ns, total: 672 ms
+Wall time: 671 ms
+copy to dense
+CPU times: user 16.1 s, sys: 0 ns, total: 16.1 s
+Wall time: 16.1 s
+copy to sparse
+CPU times: user 17.4 s, sys: 34.7 ms, total: 17.5 s
+Wall time: 17.5 s
+copy to statice sparse
+CPU times: user 18.9 s, sys: 51.6 ms, total: 18.9 s
+Wall time: 18.9 s
+delete edges
+CPU times: user 2.49 s, sys: 0 ns, total: 2.49 s
+Wall time: 2.49 s
+copying static sparse to dense
+CPU times: user 1.18 s, sys: 0 ns, total: 1.18 s
+Wall time: 1.18 s
+
+now doing sparse
+adding edges
+CPU times: user 1.87 s, sys: 0 ns, total: 1.87 s
+Wall time: 1.87 s
+copy to dense
+CPU times: user 2.64 s, sys: 0 ns, total: 2.64 s
+Wall time: 2.64 s
+copy to sparse
+CPU times: user 3.21 s, sys: 47.8 ms, total: 3.26 s
+Wall time: 3.26 s
+copy to statice sparse
+CPU times: user 4.25 s, sys: 36 ms, total: 4.28 s
+Wall time: 4.28 s
+delete edges
+CPU times: user 3.86 s, sys: 0 ns, total: 3.86 s
+Wall time: 3.86 s
+copying static sparse to sparse
+CPU times: user 2.55 s, sys: 0 ns, total: 2.55 s
+Wall time: 2.55 s
+```
``````




---

archive/issue_comments_562436.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,8 +4,22 @@\n \n https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ\n \n+-  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) \n+- #12387: Everything is not well with dense graph backends\n+- #12540: Graph library passes almost surelly erroneous calls without an exception\n+-  #28259: graph add_edges/delete_edges are dramatically slow \n -  #28896: Graphs: Move common methods of backends to CGraph \n -  #28897: BipartiteGraph blindly trusts generic graphs\n+\n+Possibly related tickets:\n+\n+- #6604: Polish the use of iterators in C graphs \n+- #9143: Speed up graph generation using Cython \n+- #9301: Modified check_edge_label in the sparse graph backend to consider equals the same objects rather than objects with the same contents\n+- #22374: {c,sparse}_graph: systematically turn integer-like vertices into ints\n+- #24989: G.edges_incident returns edges with vertices swapped\n+- #25465: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph\n+- #28309: improvement of method allow_multiple_edges\n \n Here are some timings we try to improve along the way:\n \n``````\n",
    "created_at": "2019-12-19T13:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562436",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,8 +4,22 @@
 
 https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ
 
+-  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) 
+- #12387: Everything is not well with dense graph backends
+- #12540: Graph library passes almost surelly erroneous calls without an exception
+-  #28259: graph add_edges/delete_edges are dramatically slow 
 -  #28896: Graphs: Move common methods of backends to CGraph 
 -  #28897: BipartiteGraph blindly trusts generic graphs
+
+Possibly related tickets:
+
+- #6604: Polish the use of iterators in C graphs 
+- #9143: Speed up graph generation using Cython 
+- #9301: Modified check_edge_label in the sparse graph backend to consider equals the same objects rather than objects with the same contents
+- #22374: {c,sparse}_graph: systematically turn integer-like vertices into ints
+- #24989: G.edges_incident returns edges with vertices swapped
+- #25465: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph
+- #28309: improvement of method allow_multiple_edges
 
 Here are some timings we try to improve along the way:
 
``````




---

archive/issue_comments_562437.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -18,7 +18,7 @@\n - #9301: Modified check_edge_label in the sparse graph backend to consider equals the same objects rather than objects with the same contents\n - #22374: {c,sparse}_graph: systematically turn integer-like vertices into ints\n - #24989: G.edges_incident returns edges with vertices swapped\n-- #25465: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph\n+- #25465, #28865: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph\n - #28309: improvement of method allow_multiple_edges\n \n Here are some timings we try to improve along the way:\n``````\n",
    "created_at": "2019-12-20T12:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562437",
    "user": "https://github.com/dcoudert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -18,7 +18,7 @@
 - #9301: Modified check_edge_label in the sparse graph backend to consider equals the same objects rather than objects with the same contents
 - #22374: {c,sparse}_graph: systematically turn integer-like vertices into ints
 - #24989: G.edges_incident returns edges with vertices swapped
-- #25465: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph
+- #25465, #28865: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph
 - #28309: improvement of method allow_multiple_edges
 
 Here are some timings we try to improve along the way:
``````




---

archive/issue_comments_562438.json:
```json
{
    "body": "<a id='comment:6'></a>\njust mentioned that #25465, #28865 are for the same issue.",
    "created_at": "2019-12-20T12:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562438",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
just mentioned that #25465, #28865 are for the same issue.



---

archive/issue_comments_562439.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n -  #28259: graph add_edges/delete_edges are dramatically slow \n -  #28896: Graphs: Move common methods of backends to CGraph \n -  #28897: BipartiteGraph blindly trusts generic graphs\n+-  #28904: Move reversed graph from backend to CGraph for sparse graphs \n \n Possibly related tickets:\n \n``````\n",
    "created_at": "2019-12-21T00:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562439",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 -  #28259: graph add_edges/delete_edges are dramatically slow 
 -  #28896: Graphs: Move common methods of backends to CGraph 
 -  #28897: BipartiteGraph blindly trusts generic graphs
+-  #28904: Move reversed graph from backend to CGraph for sparse graphs 
 
 Possibly related tickets:
 
``````




---

archive/issue_events_082549.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82549"
}
```



---

archive/issue_comments_562440.json:
```json
{
    "body": "<a id='comment:8'></a>\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562440",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_562441.json:
```json
{
    "body": "<a id='comment:9'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562441",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_082550.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82550"
}
```



---

archive/issue_events_082551.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82551"
}
```



---

archive/issue_comments_562442.json:
```json
{
    "body": "<a id='comment:10'></a>\n#22349 could also be part of this task.",
    "created_at": "2020-04-18T10:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562442",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
#22349 could also be part of this task.



---

archive/issue_comments_562443.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,7 @@\n -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) \n - #12387: Everything is not well with dense graph backends\n - #12540: Graph library passes almost surelly erroneous calls without an exception\n+-  #22349: Deprecate sorting of Graph vertices and edges by default \n -  #28259: graph add_edges/delete_edges are dramatically slow \n -  #28896: Graphs: Move common methods of backends to CGraph \n -  #28897: BipartiteGraph blindly trusts generic graphs\n``````\n",
    "created_at": "2020-04-24T08:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562443",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,7 @@
 -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) 
 - #12387: Everything is not well with dense graph backends
 - #12540: Graph library passes almost surelly erroneous calls without an exception
+-  #22349: Deprecate sorting of Graph vertices and edges by default 
 -  #28259: graph add_edges/delete_edges are dramatically slow 
 -  #28896: Graphs: Move common methods of backends to CGraph 
 -  #28897: BipartiteGraph blindly trusts generic graphs
``````




---

archive/issue_comments_562444.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,7 +11,8 @@\n -  #28259: graph add_edges/delete_edges are dramatically slow \n -  #28896: Graphs: Move common methods of backends to CGraph \n -  #28897: BipartiteGraph blindly trusts generic graphs\n--  #28904: Move reversed graph from backend to CGraph for sparse graphs \n+-  #28904: Move reversed graph from backend to CGraph for sparse graphs\n+-  use iterators for outgoing and ingoing arcs \n \n Possibly related tickets:\n \n``````\n",
    "created_at": "2020-08-12T11:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562444",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,7 +11,8 @@
 -  #28259: graph add_edges/delete_edges are dramatically slow 
 -  #28896: Graphs: Move common methods of backends to CGraph 
 -  #28897: BipartiteGraph blindly trusts generic graphs
--  #28904: Move reversed graph from backend to CGraph for sparse graphs 
+-  #28904: Move reversed graph from backend to CGraph for sparse graphs
+-  use iterators for outgoing and ingoing arcs 
 
 Possibly related tickets:
 
``````




---

archive/issue_events_082552.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82552"
}
```



---

archive/issue_events_082553.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82553"
}
```



---

archive/issue_comments_562445.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,7 +12,8 @@\n -  #28896: Graphs: Move common methods of backends to CGraph \n -  #28897: BipartiteGraph blindly trusts generic graphs\n -  #28904: Move reversed graph from backend to CGraph for sparse graphs\n--  use iterators for outgoing and ingoing arcs \n+-  #30641: equality of graphs is 60 times slower than equality of their list of edges \n+-  use iterators for outgoing and ingoing arcs\n \n Possibly related tickets:\n \n``````\n",
    "created_at": "2020-09-23T09:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562445",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,7 +12,8 @@
 -  #28896: Graphs: Move common methods of backends to CGraph 
 -  #28897: BipartiteGraph blindly trusts generic graphs
 -  #28904: Move reversed graph from backend to CGraph for sparse graphs
--  use iterators for outgoing and ingoing arcs 
+-  #30641: equality of graphs is 60 times slower than equality of their list of edges 
+-  use iterators for outgoing and ingoing arcs
 
 Possibly related tickets:
 
``````




---

archive/issue_comments_562446.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,13 +7,15 @@\n -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) \n - #12387: Everything is not well with dense graph backends\n - #12540: Graph library passes almost surelly erroneous calls without an exception\n--  #22349: Deprecate sorting of Graph vertices and edges by default \n--  #28259: graph add_edges/delete_edges are dramatically slow \n--  #28896: Graphs: Move common methods of backends to CGraph \n--  #28897: BipartiteGraph blindly trusts generic graphs\n--  #28904: Move reversed graph from backend to CGraph for sparse graphs\n--  #30641: equality of graphs is 60 times slower than equality of their list of edges \n--  use iterators for outgoing and ingoing arcs\n+- #22349: Deprecate sorting of Graph vertices and edges by default \n+- #28259: graph add_edges/delete_edges are dramatically slow \n+- #28896: Graphs: Move common methods of backends to CGraph \n+- #28897: BipartiteGraph blindly trusts generic graphs\n+- #28904: Move reversed graph from backend to CGraph for sparse graphs\n+- #30641: equality of graphs is 60 times slower than equality of their list of edges \n+- #30769: Unify graph backends\n+- #30753: Further improvements in method subgraph \n+- use iterators for outgoing and ingoing arcs\n \n Possibly related tickets:\n \n``````\n",
    "created_at": "2020-10-14T11:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562446",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,13 +7,15 @@
 -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) 
 - #12387: Everything is not well with dense graph backends
 - #12540: Graph library passes almost surelly erroneous calls without an exception
--  #22349: Deprecate sorting of Graph vertices and edges by default 
--  #28259: graph add_edges/delete_edges are dramatically slow 
--  #28896: Graphs: Move common methods of backends to CGraph 
--  #28897: BipartiteGraph blindly trusts generic graphs
--  #28904: Move reversed graph from backend to CGraph for sparse graphs
--  #30641: equality of graphs is 60 times slower than equality of their list of edges 
--  use iterators for outgoing and ingoing arcs
+- #22349: Deprecate sorting of Graph vertices and edges by default 
+- #28259: graph add_edges/delete_edges are dramatically slow 
+- #28896: Graphs: Move common methods of backends to CGraph 
+- #28897: BipartiteGraph blindly trusts generic graphs
+- #28904: Move reversed graph from backend to CGraph for sparse graphs
+- #30641: equality of graphs is 60 times slower than equality of their list of edges 
+- #30769: Unify graph backends
+- #30753: Further improvements in method subgraph 
+- use iterators for outgoing and ingoing arcs
 
 Possibly related tickets:
 
``````




---

archive/issue_comments_562447.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,6 +30,7 @@\n Here are some timings we try to improve along the way:\n \n ```\n+sage: import itertools\n sage: def test_speed(n):\n ....:     for struct in ('dense', 'sparse'):\n ....:         print(\"\\nnow doing {}\".format(struct))\n``````\n",
    "created_at": "2020-10-15T06:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562447",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,6 +30,7 @@
 Here are some timings we try to improve along the way:
 
 ```
+sage: import itertools
 sage: def test_speed(n):
 ....:     for struct in ('dense', 'sparse'):
 ....:         print("\nnow doing {}".format(struct))
``````




---

archive/issue_comments_562448.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,6 +13,7 @@\n - #28897: BipartiteGraph blindly trusts generic graphs\n - #28904: Move reversed graph from backend to CGraph for sparse graphs\n - #30641: equality of graphs is 60 times slower than equality of their list of edges \n+- #30665: Optimize edge iterator for graphs\n - #30769: Unify graph backends\n - #30753: Further improvements in method subgraph \n - use iterators for outgoing and ingoing arcs\n``````\n",
    "created_at": "2020-10-15T11:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562448",
    "user": "https://github.com/dcoudert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,6 +13,7 @@
 - #28897: BipartiteGraph blindly trusts generic graphs
 - #28904: Move reversed graph from backend to CGraph for sparse graphs
 - #30641: equality of graphs is 60 times slower than equality of their list of edges 
+- #30665: Optimize edge iterator for graphs
 - #30769: Unify graph backends
 - #30753: Further improvements in method subgraph 
 - use iterators for outgoing and ingoing arcs
``````




---

archive/issue_comments_562449.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,7 +15,8 @@\n - #30641: equality of graphs is 60 times slower than equality of their list of edges \n - #30665: Optimize edge iterator for graphs\n - #30769: Unify graph backends\n-- #30753: Further improvements in method subgraph \n+- #30753: Further improvements in method subgraph\n+- #30777: Improve deleting of edges of graphs\n - use iterators for outgoing and ingoing arcs\n \n Possibly related tickets:\n``````\n",
    "created_at": "2020-10-16T14:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562449",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,7 +15,8 @@
 - #30641: equality of graphs is 60 times slower than equality of their list of edges 
 - #30665: Optimize edge iterator for graphs
 - #30769: Unify graph backends
-- #30753: Further improvements in method subgraph 
+- #30753: Further improvements in method subgraph
+- #30777: Improve deleting of edges of graphs
 - use iterators for outgoing and ingoing arcs
 
 Possibly related tickets:
``````




---

archive/issue_comments_562450.json:
```json
{
    "body": "<a id='comment:19'></a>\nWith #30776 and #30777 things are looking much better:\n\n```\nsage: test_speed(1000)                                                                                                                                                                                                                                                                                                                                                     \n\nnow doing dense\nadding edges\nCPU times: user 81.9 ms, sys: 0 ns, total: 81.9 ms\nWall time: 81.9 ms\ncopy to dense\nCPU times: user 10.2 ms, sys: 0 ns, total: 10.2 ms\nWall time: 10.2 ms\ncopy to sparse\nCPU times: user 89.5 ms, sys: 7.87 ms, total: 97.4 ms\nWall time: 97.1 ms\ncopy to statice sparse\nCPU times: user 423 ms, sys: 11.9 ms, total: 435 ms\nWall time: 435 ms\ndelete edges\nCPU times: user 79.1 ms, sys: 0 ns, total: 79.1 ms\nWall time: 79.1 ms\ncopying static sparse to dense\nCPU times: user 81.3 ms, sys: 51 \u00b5s, total: 81.4 ms\nWall time: 81.4 ms\n\nnow doing sparse\nadding edges\nCPU times: user 169 ms, sys: 0 ns, total: 169 ms\nWall time: 169 ms\ncopy to dense\nCPU times: user 158 ms, sys: 0 ns, total: 158 ms\nWall time: 158 ms\ncopy to sparse\nCPU times: user 290 ms, sys: 0 ns, total: 290 ms\nWall time: 290 ms\ncopy to statice sparse\nCPU times: user 544 ms, sys: 0 ns, total: 544 ms\nWall time: 544 ms\ndelete edges\nCPU times: user 166 ms, sys: 0 ns, total: 166 ms\nWall time: 166 ms\ncopying static sparse to sparse\nCPU times: user 187 ms, sys: 0 ns, total: 187 ms\nWall time: 187 ms\nsage: test_speed(2000)                                                                                                                                                                                                                                                                                                                                                     \n\nnow doing dense\nadding edges\nCPU times: user 340 ms, sys: 0 ns, total: 340 ms\nWall time: 340 ms\ncopy to dense\nCPU times: user 40.9 ms, sys: 0 ns, total: 40.9 ms\nWall time: 40.8 ms\ncopy to sparse\nCPU times: user 396 ms, sys: 3.93 ms, total: 400 ms\nWall time: 400 ms\ncopy to statice sparse\nCPU times: user 2 s, sys: 68 ms, total: 2.07 s\nWall time: 2.07 s\ndelete edges\nCPU times: user 321 ms, sys: 32 \u00b5s, total: 321 ms\nWall time: 321 ms\ncopying static sparse to dense\nCPU times: user 396 ms, sys: 0 ns, total: 396 ms\nWall time: 396 ms\n\nnow doing sparse\nadding edges\nCPU times: user 768 ms, sys: 0 ns, total: 768 ms\nWall time: 768 ms\ncopy to dense\nCPU times: user 791 ms, sys: 0 ns, total: 791 ms\nWall time: 791 ms\ncopy to sparse\nCPU times: user 1.32 s, sys: 48 ms, total: 1.36 s\nWall time: 1.36 s\ncopy to statice sparse\nCPU times: user 2.48 s, sys: 0 ns, total: 2.48 s\nWall time: 2.48 s\ndelete edges\nCPU times: user 825 ms, sys: 0 ns, total: 825 ms\nWall time: 825 ms\ncopying static sparse to sparse\nCPU times: user 876 ms, sys: 0 ns, total: 876 ms\nWall time: 876 ms\n```",
    "created_at": "2020-10-16T14:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562450",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>
With #30776 and #30777 things are looking much better:

```
sage: test_speed(1000)                                                                                                                                                                                                                                                                                                                                                     

now doing dense
adding edges
CPU times: user 81.9 ms, sys: 0 ns, total: 81.9 ms
Wall time: 81.9 ms
copy to dense
CPU times: user 10.2 ms, sys: 0 ns, total: 10.2 ms
Wall time: 10.2 ms
copy to sparse
CPU times: user 89.5 ms, sys: 7.87 ms, total: 97.4 ms
Wall time: 97.1 ms
copy to statice sparse
CPU times: user 423 ms, sys: 11.9 ms, total: 435 ms
Wall time: 435 ms
delete edges
CPU times: user 79.1 ms, sys: 0 ns, total: 79.1 ms
Wall time: 79.1 ms
copying static sparse to dense
CPU times: user 81.3 ms, sys: 51 µs, total: 81.4 ms
Wall time: 81.4 ms

now doing sparse
adding edges
CPU times: user 169 ms, sys: 0 ns, total: 169 ms
Wall time: 169 ms
copy to dense
CPU times: user 158 ms, sys: 0 ns, total: 158 ms
Wall time: 158 ms
copy to sparse
CPU times: user 290 ms, sys: 0 ns, total: 290 ms
Wall time: 290 ms
copy to statice sparse
CPU times: user 544 ms, sys: 0 ns, total: 544 ms
Wall time: 544 ms
delete edges
CPU times: user 166 ms, sys: 0 ns, total: 166 ms
Wall time: 166 ms
copying static sparse to sparse
CPU times: user 187 ms, sys: 0 ns, total: 187 ms
Wall time: 187 ms
sage: test_speed(2000)                                                                                                                                                                                                                                                                                                                                                     

now doing dense
adding edges
CPU times: user 340 ms, sys: 0 ns, total: 340 ms
Wall time: 340 ms
copy to dense
CPU times: user 40.9 ms, sys: 0 ns, total: 40.9 ms
Wall time: 40.8 ms
copy to sparse
CPU times: user 396 ms, sys: 3.93 ms, total: 400 ms
Wall time: 400 ms
copy to statice sparse
CPU times: user 2 s, sys: 68 ms, total: 2.07 s
Wall time: 2.07 s
delete edges
CPU times: user 321 ms, sys: 32 µs, total: 321 ms
Wall time: 321 ms
copying static sparse to dense
CPU times: user 396 ms, sys: 0 ns, total: 396 ms
Wall time: 396 ms

now doing sparse
adding edges
CPU times: user 768 ms, sys: 0 ns, total: 768 ms
Wall time: 768 ms
copy to dense
CPU times: user 791 ms, sys: 0 ns, total: 791 ms
Wall time: 791 ms
copy to sparse
CPU times: user 1.32 s, sys: 48 ms, total: 1.36 s
Wall time: 1.36 s
copy to statice sparse
CPU times: user 2.48 s, sys: 0 ns, total: 2.48 s
Wall time: 2.48 s
delete edges
CPU times: user 825 ms, sys: 0 ns, total: 825 ms
Wall time: 825 ms
copying static sparse to sparse
CPU times: user 876 ms, sys: 0 ns, total: 876 ms
Wall time: 876 ms
```



---

archive/issue_comments_562451.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,7 @@\n -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) \n - #12387: Everything is not well with dense graph backends\n - #12540: Graph library passes almost surelly erroneous calls without an exception\n+- #13730: Speed up some graph iterations\n - #22349: Deprecate sorting of Graph vertices and edges by default \n - #28259: graph add_edges/delete_edges are dramatically slow \n - #28896: Graphs: Move common methods of backends to CGraph \n``````\n",
    "created_at": "2020-10-17T13:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562451",
    "user": "https://github.com/dcoudert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,7 @@
 -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) 
 - #12387: Everything is not well with dense graph backends
 - #12540: Graph library passes almost surelly erroneous calls without an exception
+- #13730: Speed up some graph iterations
 - #22349: Deprecate sorting of Graph vertices and edges by default 
 - #28259: graph add_edges/delete_edges are dramatically slow 
 - #28896: Graphs: Move common methods of backends to CGraph 
``````




---

archive/issue_comments_562452.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -29,6 +29,8 @@\n - #24989: G.edges_incident returns edges with vertices swapped\n - #25465, #28865: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph\n - #28309: improvement of method allow_multiple_edges\n+- #31117: Improve Breadth First Search in c_graph.pyx\n+- #31129: Improve Depth First Search in c_graph.pyx\n \n Here are some timings we try to improve along the way:\n \n``````\n",
    "created_at": "2020-12-29T17:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562452",
    "user": "https://github.com/dcoudert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -29,6 +29,8 @@
 - #24989: G.edges_incident returns edges with vertices swapped
 - #25465, #28865: Memory error with graphs generators: JankoKharaghaniGraph and SquaredSkewHadamardMatrixGraph
 - #28309: improvement of method allow_multiple_edges
+- #31117: Improve Breadth First Search in c_graph.pyx
+- #31129: Improve Depth First Search in c_graph.pyx
 
 Here are some timings we try to improve along the way:
 
``````




---

archive/issue_comments_562453.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,6 +19,7 @@\n - #30753: Further improvements in method subgraph\n - #30777: Improve deleting of edges of graphs\n - use iterators for outgoing and ingoing arcs\n+- #31197: Use bitsets/binary matrix for edges of dense graphs \n \n Possibly related tickets:\n \n``````\n",
    "created_at": "2021-01-07T15:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562453",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,6 +19,7 @@
 - #30753: Further improvements in method subgraph
 - #30777: Improve deleting of edges of graphs
 - use iterators for outgoing and ingoing arcs
+- #31197: Use bitsets/binary matrix for edges of dense graphs 
 
 Possibly related tickets:
 
``````




---

archive/issue_comments_562454.json:
```json
{
    "body": "<a id='comment:23'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562454",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_082554.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82554"
}
```



---

archive/issue_events_082555.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82555"
}
```



---

archive/issue_events_082556.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82556"
}
```



---

archive/issue_events_082557.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82557"
}
```



---

archive/issue_comments_562455.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,6 +4,7 @@\n \n https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ\n \n+- #6604: Polish the use of iterators in C graphs\n -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) \n - #12387: Everything is not well with dense graph backends\n - #12540: Graph library passes almost surelly erroneous calls without an exception\n``````\n",
    "created_at": "2021-12-03T17:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28895#issuecomment-562455",
    "user": "https://github.com/dcoudert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,6 +4,7 @@
 
 https://groups.google.com/d/msg/sage-devel/JhirgrbcFMc/CVfHhPCdAgAJ
 
+- #6604: Polish the use of iterators in C graphs
 -  #7720: Digraph.reverse() should be rewritten more efficiently ( not hard ) 
 - #12387: Everything is not well with dense graph backends
 - #12540: Graph library passes almost surelly erroneous calls without an exception
``````




---

archive/issue_events_082558.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82558"
}
```



---

archive/issue_events_082559.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82559"
}
```



---

archive/issue_events_082560.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82560"
}
```



---

archive/issue_events_082561.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82561"
}
```



---

archive/issue_events_082562.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82562"
}
```



---

archive/issue_events_082563.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28895",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28895#event-82563"
}
```
