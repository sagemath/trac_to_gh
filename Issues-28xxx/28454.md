# Issue 28454: py3 failure in src/sage/libs/eclib/interface.py

archive/issues_028217.json:
```json
{
    "assignees": [],
    "body": "On some machines, there is a Python 3 doctest failure at line 597 in the file `src/sage/libs/eclib/interface.py`:\n\n```\nsage -t --warn-long 39.6 src/sage/libs/eclib/interface.py\n**********************************************************************\nFile \"src/sage/libs/eclib/interface.py\", line 597, in sage.libs.eclib.interface.mwrank_EllipticCurve.saturate\nFailed example:\n    E.saturation([Q1,Q2])\nExpected:\n    ([(1 : -27 : 1), (157 : 1950 : 1)], 3, 0.801588644684981)\nGot:\n    Attempt to round -0.2617840677e25 to a long int fails, aborting!\n    ([(1 : -27 : 1), (157 : 1950 : 1)], 3, 0.801588644684981)\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.libs.eclib.interface.mwrank_EllipticCurve.saturate\n    [192 tests, 1 failure, 3.62 s]\n----------------------------------------------------------------------\nsage -t --warn-long 39.6 src/sage/libs/eclib/interface.py  # 1 doctest failed\n```\n\nCC:  @JohnCremona\n\nUpstream: **None of the above - read trac for reasoning.**\n\nReviewer: **John Cremona**\n\nAuthor: **John Cremona, John Palmieri**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28454_\n\n",
    "closed_at": "2019-09-14T06:04:59Z",
    "created_at": "2019-09-04T21:51:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3 failure in src/sage/libs/eclib/interface.py",
    "type": "issue",
    "updated_at": "2019-09-18T16:59:13Z",
    "url": "https://github.com/sagemath/sage/issues/28454",
    "user": "https://github.com/jhpalmieri"
}
```
On some machines, there is a Python 3 doctest failure at line 597 in the file `src/sage/libs/eclib/interface.py`:

```
sage -t --warn-long 39.6 src/sage/libs/eclib/interface.py
**********************************************************************
File "src/sage/libs/eclib/interface.py", line 597, in sage.libs.eclib.interface.mwrank_EllipticCurve.saturate
Failed example:
    E.saturation([Q1,Q2])
Expected:
    ([(1 : -27 : 1), (157 : 1950 : 1)], 3, 0.801588644684981)
Got:
    Attempt to round -0.2617840677e25 to a long int fails, aborting!
    ([(1 : -27 : 1), (157 : 1950 : 1)], 3, 0.801588644684981)
**********************************************************************
1 item had failures:
   1 of   9 in sage.libs.eclib.interface.mwrank_EllipticCurve.saturate
    [192 tests, 1 failure, 3.62 s]
----------------------------------------------------------------------
sage -t --warn-long 39.6 src/sage/libs/eclib/interface.py  # 1 doctest failed
```

CC:  @JohnCremona

Upstream: **None of the above - read trac for reasoning.**

Reviewer: **John Cremona**

Author: **John Cremona, John Palmieri**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/28454_





---

archive/issue_events_392491.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-04T21:51:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392491"
}
```



---

archive/issue_events_392492.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-04T21:51:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392492"
}
```



---

archive/issue_events_392493.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-04T21:51:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392493"
}
```



---

archive/issue_events_392494.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-04T21:51:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392494"
}
```



---

archive/issue_comments_443207.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI was trying to track this down. The message \"Attempt to round ...\" is from the eclib source code, so I put in some print statements, after which the \"Attempt to round ...\" message appeared after a different doctest. So then I thought I should flush the output after the \"Attempt to round ...\" message, to try to clarify where it was appearing. For reasons I don't understand, flushing the output caused the message to disappear entirely. Is this a valid fix for the problem?\n\nIn a bit more detail: I added the attached file to `build/pkgs/eclib/patches` (after creating that directory). Then I rebuilt eclib, after which this file passed its doctests.",
    "created_at": "2019-09-04T21:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443207",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

I was trying to track this down. The message "Attempt to round ..." is from the eclib source code, so I put in some print statements, after which the "Attempt to round ..." message appeared after a different doctest. So then I thought I should flush the output after the "Attempt to round ..." message, to try to clarify where it was appearing. For reasons I don't understand, flushing the output caused the message to disappear entirely. Is this a valid fix for the problem?

In a bit more detail: I added the attached file to `build/pkgs/eclib/patches` (after creating that directory). Then I rebuilt eclib, after which this file passed its doctests.



---

archive/issue_comments_443208.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[eclib-flush.patch.gz](https://github.com/sagemath/sage/files/ticket28454/eclib-flush.patch.gz)**",
    "created_at": "2019-09-04T22:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443208",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[eclib-flush.patch.gz](https://github.com/sagemath/sage/files/ticket28454/eclib-flush.patch.gz)**



---

archive/issue_comments_443209.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIt seems weird to me the switching python versions could affect what happens in a C++ library, which is what eclib is.  The warning from eclib just means that an integer has been computed as a floating point which it then tries to fit into a long int (not a multiprecision int) and fails since it has too many digits.\n\nI will raise an Issue in eclib for this, as there may be some underlying problem being revealed.\n\nNote that the doctest in question was added in 2015 in #18031\nafter an upstream fix.",
    "created_at": "2019-09-05T08:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443209",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:3" align="right">comment:3</div>

It seems weird to me the switching python versions could affect what happens in a C++ library, which is what eclib is.  The warning from eclib just means that an integer has been computed as a floating point which it then tries to fit into a long int (not a multiprecision int) and fails since it has too many digits.

I will raise an Issue in eclib for this, as there may be some underlying problem being revealed.

Note that the doctest in question was added in 2015 in #18031
after an upstream fix.



---

archive/issue_comments_443210.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe \"Attempt to round...\" warning in eclib comes from a function which as far as I can tell should not be called by E.saturate().\n\nCould someone who saw this message and has a python3 build try one thing:  in line 2604 of src/schemes/elliptic_curves/ell_rational_field change\n\n```\nprec = 100\n```\nto \n\n```\nprec = 200\n```\nand test again?  This is only the starting precision (in bits) and the code increases the precision by 50 in a loop until eclib reports that saturation has been completed.  Not long ago eclib changed from using decimal precision to bit precision, and at that time I reviewed all the places in sage where eclib's precision was being set, but may not have got this right.\n\nIf that fails I'll dig deeper.",
    "created_at": "2019-09-05T08:57:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443210",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">comment:4</div>

The "Attempt to round..." warning in eclib comes from a function which as far as I can tell should not be called by E.saturate().

Could someone who saw this message and has a python3 build try one thing:  in line 2604 of src/schemes/elliptic_curves/ell_rational_field change

```
prec = 100
```
to 

```
prec = 200
```
and test again?  This is only the starting precision (in bits) and the code increases the precision by 50 in a loop until eclib reports that saturation has been completed.  Not long ago eclib changed from using decimal precision to bit precision, and at that time I reviewed all the places in sage where eclib's precision was being set, but may not have got this right.

If that fails I'll dig deeper.



---

archive/issue_comments_443211.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIn the \"Report upstream\" box there should be an option \"developers do not know whether it is a bug or not\"!  Right now I neither acknowledge that there is a bug in eclib nor deny it.  Anyway, I think that the author of a library has the right to issue warnings, and it is surely a Sage problem if a warning in a dependent library is triggered under python2 but not under python3?",
    "created_at": "2019-09-05T09:00:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443211",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:5" align="right">comment:5</div>

In the "Report upstream" box there should be an option "developers do not know whether it is a bug or not"!  Right now I neither acknowledge that there is a bug in eclib nor deny it.  Anyway, I think that the author of a library has the right to issue warnings, and it is surely a Sage problem if a warning in a dependent library is triggered under python2 but not under python3?



---

archive/issue_comments_443212.json:
```json
{
    "body": "Upstream: **None of the above - read trac for reasoning.**",
    "created_at": "2019-09-05T09:00:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443212",
    "user": "https://github.com/JohnCremona"
}
```

Upstream: **None of the above - read trac for reasoning.**



---

archive/issue_comments_443213.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@JohnCremona](#comment:4):\n> The \"Attempt to round...\" warning in eclib comes from a function which as far as I can tell should not be called by E.saturate().\n\nAs I said in [comment:1](#comment:1), I first added some print statements to `mrank1.cc` to figure out which call of `ROUNDUP` or `ROUNDDOWN` was causing the message, and this made the message appear after a different doctest. So then I tried flushing the output, as in the patch, and this made the error disappear altogether. So I have no idea what's going on.\n\n> Could someone who saw this message and has a python3 build try one thing:  in line 2604 of src/schemes/elliptic_curves/ell_rational_field change\n> \n> ```\n> prec = 100\n> ```\n> to \n> \n> ```\n> prec = 200\n> ```\n> and test again?\n\nNo change.\n\nI hope others look at this, too. I am running Debian using VirtualBox on my Mac, which is not an ideal environment. I have taken it for granted that this a Python3-only bug (as reported at #28298), but I don't have a Python 2 build on this machine to test. I'm trying to build one now, but I may run out of disk space.",
    "created_at": "2019-09-05T17:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443213",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@JohnCremona](#comment:4):
> The "Attempt to round..." warning in eclib comes from a function which as far as I can tell should not be called by E.saturate().

As I said in [comment:1](#comment:1), I first added some print statements to `mrank1.cc` to figure out which call of `ROUNDUP` or `ROUNDDOWN` was causing the message, and this made the message appear after a different doctest. So then I tried flushing the output, as in the patch, and this made the error disappear altogether. So I have no idea what's going on.

> Could someone who saw this message and has a python3 build try one thing:  in line 2604 of src/schemes/elliptic_curves/ell_rational_field change
> 
> ```
> prec = 100
> ```
> to 
> 
> ```
> prec = 200
> ```
> and test again?

No change.

I hope others look at this, too. I am running Debian using VirtualBox on my Mac, which is not an ideal environment. I have taken it for granted that this a Python3-only bug (as reported at #28298), but I don't have a Python 2 build on this machine to test. I'm trying to build one now, but I may run out of disk space.



---

archive/issue_comments_443214.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks, that is helpful -- my guess is that the warning message is being created in an earlier doctest but only appearing in this one.  That code in mrank1.cc is only run when doing 2-descent on elliptic curves with no 2-torsion.  So the next step would be to manually run some subset of the doctests in that file interface.py.\n\nI'll make myself a new python3 build and see if I can get to the bottom of this.",
    "created_at": "2019-09-05T18:20:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443214",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks, that is helpful -- my guess is that the warning message is being created in an earlier doctest but only appearing in this one.  That code in mrank1.cc is only run when doing 2-descent on elliptic curves with no 2-torsion.  So the next step would be to manually run some subset of the doctests in that file interface.py.

I'll make myself a new python3 build and see if I can get to the bottom of this.



---

archive/issue_comments_443215.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNote that it is also platform-specific: I don't see it on OS X, for example. It is conceivable that it depends on a combination of the OS and the processor, or it could just be the OS. It makes it (along with a few other Python 3 failures) annoying to debug and fix.",
    "created_at": "2019-09-05T18:27:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443215",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Note that it is also platform-specific: I don't see it on OS X, for example. It is conceivable that it depends on a combination of the OS and the processor, or it could just be the OS. It makes it (along with a few other Python 3 failures) annoying to debug and fix.



---

archive/issue_comments_443216.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAnd of course, I am happy to test things on my virtual machine. Let me know how I can help.",
    "created_at": "2019-09-05T19:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443216",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

And of course, I am happy to test things on my virtual machine. Let me know how I can help.



---

archive/issue_comments_443217.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI've done more investigating. I think the message actually comes from this doctest:\n\n```\n    sage: EllipticCurve([0, prod(prime_range(100))]).mwrank_curve().two_descent()\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Aborted\n```\nIf I create a new file with just\n\n```\nr\"\"\"\nEXAMPLES::\n\n    sage: EllipticCurve([0, prod(prime_range(100))]).mwrank_curve().two_descent()\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Aborted\n\n    sage: E = EllipticCurve([0,-1,1,-266,968])\n    sage: Q1 = E([-1995,3674,125])\n    sage: Q2 = E([157,1950,1])\n    sage: E.saturation([Q1,Q2])\n    ([(1 : -27 : 1), (157 : 1950 : 1)], 3, 0.801588644684981)\n\"\"\"\n```\nthen I get the doctest failure. If I run the command\n\n```\nEllipticCurve([0, prod(prime_range(100))]).mwrank_curve().two_descent()\n```\ndirectly in Sage, I get the message \"Attempt to round ...\" as part of the traceback (and I see this on my Mac, not just linux, and I see it with Python 2 and 3). So I think that when I flush the output, this message is absorbed into the \"...\" part of the doctest output, as it should be. When it's not flushed, it appears somewhere else and causes the failure. So maybe this is a valid fix.\n\nI still don't know why this only happens with some operating systems, and why only with Python 3, and why the \"Attempt to round ...\" message appears in this particular place, but it now makes a bit more sense. Should we flush the output in the `ROUNDDOWN` function as well?",
    "created_at": "2019-09-06T23:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443217",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

I've done more investigating. I think the message actually comes from this doctest:

```
    sage: EllipticCurve([0, prod(prime_range(100))]).mwrank_curve().two_descent()
    Traceback (most recent call last):
    ...
    RuntimeError: Aborted
```
If I create a new file with just

```
r"""
EXAMPLES::

    sage: EllipticCurve([0, prod(prime_range(100))]).mwrank_curve().two_descent()
    Traceback (most recent call last):
    ...
    RuntimeError: Aborted

    sage: E = EllipticCurve([0,-1,1,-266,968])
    sage: Q1 = E([-1995,3674,125])
    sage: Q2 = E([157,1950,1])
    sage: E.saturation([Q1,Q2])
    ([(1 : -27 : 1), (157 : 1950 : 1)], 3, 0.801588644684981)
"""
```
then I get the doctest failure. If I run the command

```
EllipticCurve([0, prod(prime_range(100))]).mwrank_curve().two_descent()
```
directly in Sage, I get the message "Attempt to round ..." as part of the traceback (and I see this on my Mac, not just linux, and I see it with Python 2 and 3). So I think that when I flush the output, this message is absorbed into the "..." part of the doctest output, as it should be. When it's not flushed, it appears somewhere else and causes the failure. So maybe this is a valid fix.

I still don't know why this only happens with some operating systems, and why only with Python 3, and why the "Attempt to round ..." message appears in this particular place, but it now makes a bit more sense. Should we flush the output in the `ROUNDDOWN` function as well?



---

archive/issue_comments_443218.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks, that is extremely helpful.   mwrank bails out almost immediately if the input curve has very large coefficients and no 2-torsion, since when certain variables which are loop bounds are too large to fit into long ints (64-bit) the loop will not run in reasonable time, so it does not make sense for the code to use multiprecision ints at that point.  But it should catch this and issue a better warning/error, specifically saying that the curve's coefficients are too big.  I will look into that.  When this example is run with mwrank from the command line it core dumps after this message, certainly not good.\n\nHowever that is just half the story: it should be when this happens from within Sage, it raises a proper python error, and this output appears immediately.  Right now the error message goes into a buffer and it is very system-dependent when the message appears.\n\nIf you can see how to flush the output without changing eclib source code that would be the fastest fix, while I try to do something better for the longer term.",
    "created_at": "2019-09-07T11:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443218",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks, that is extremely helpful.   mwrank bails out almost immediately if the input curve has very large coefficients and no 2-torsion, since when certain variables which are loop bounds are too large to fit into long ints (64-bit) the loop will not run in reasonable time, so it does not make sense for the code to use multiprecision ints at that point.  But it should catch this and issue a better warning/error, specifically saying that the curve's coefficients are too big.  I will look into that.  When this example is run with mwrank from the command line it core dumps after this message, certainly not good.

However that is just half the story: it should be when this happens from within Sage, it raises a proper python error, and this output appears immediately.  Right now the error message goes into a buffer and it is very system-dependent when the message appears.

If you can see how to flush the output without changing eclib source code that would be the fastest fix, while I try to do something better for the longer term.



---

archive/issue_comments_443219.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@JohnCremona](#comment:11):\n> If you can see how to flush the output without changing eclib source code that would be the fastest fix, while I try to do something better for the longer term.\n\nI don't know how to do this. I mean, I can find sites like https://eli.thegreenplace.net/2015/redirecting-all-kinds-of-stdout-in-python/ or https://stackoverflow.com/questions/5081657/how-do-i-prevent-a-c-shared-library-to-print-on-stdout-in-python or others, but they don't quite address the issue, so they would require modification. In addition, they look complicated and I don't understand them. Instead, as a stopgap, I would suggest a patch in `build/pkgs/eclib/patches` like the one I've posted here. It's not going to help with a version of eclib installed system-wide (#28333), but it's simple and will work for Sage-installed versions of eclib.\n\nDo you have some objection to flushing the output in those functions?",
    "created_at": "2019-09-07T21:54:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443219",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@JohnCremona](#comment:11):
> If you can see how to flush the output without changing eclib source code that would be the fastest fix, while I try to do something better for the longer term.

I don't know how to do this. I mean, I can find sites like https://eli.thegreenplace.net/2015/redirecting-all-kinds-of-stdout-in-python/ or https://stackoverflow.com/questions/5081657/how-do-i-prevent-a-c-shared-library-to-print-on-stdout-in-python or others, but they don't quite address the issue, so they would require modification. In addition, they look complicated and I don't understand them. Instead, as a stopgap, I would suggest a patch in `build/pkgs/eclib/patches` like the one I've posted here. It's not going to help with a version of eclib installed system-wide (#28333), but it's simple and will work for Sage-installed versions of eclib.

Do you have some objection to flushing the output in those functions?



---

archive/issue_comments_443220.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNo objection.   I know that it is a *bad thing* for library functions to call abort() and ideally I would recode the places where that happens, but there are hundreds of such places since I seem to use it whenever something invalid is tried such as adding two vectors of different lengths, as well as when memory allocation fails or (as here) when an attempt is made to put a too large integer into a long int.  As a stopgap I will make sure that when some warning is output just before abort() then the output is flushed.\n\nThis will need a new eclib version, so patching ROUNDUP and ROUNDOWN in mwrank1.cc as suggested would be a reasonable stopgap.",
    "created_at": "2019-09-09T08:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443220",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:13" align="right">comment:13</div>

No objection.   I know that it is a *bad thing* for library functions to call abort() and ideally I would recode the places where that happens, but there are hundreds of such places since I seem to use it whenever something invalid is tried such as adding two vectors of different lengths, as well as when memory allocation fails or (as here) when an attempt is made to put a too large integer into a long int.  As a stopgap I will make sure that when some warning is output just before abort() then the output is flushed.

This will need a new eclib version, so patching ROUNDUP and ROUNDOWN in mwrank1.cc as suggested would be a reasonable stopgap.



---

archive/issue_comments_443221.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@JohnCremona](#comment:13):\n> No objection.   I know that it is a *bad thing* for library functions to call abort() and ideally I would recode the places where that happens, but there are hundreds of such places since I seem to use it whenever something invalid is tried such as adding two vectors of different lengths, as well as when memory allocation fails or (as here) when an attempt is made to put a too large integer into a long int.  As a stopgap I will make sure that when some warning is output just before abort() then the output is flushed.\n> \n> This will need a new eclib version, so patching ROUNDUP and ROUNDOWN in mwrank1.cc as suggested would be a reasonable stopgap.\n\n\nThere will soon be a new version of eclib (tarball is at http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/eclib-20190909.tar.bz2) which removes all calls to abort() and does something reasonable wherever that used to happen, including flushing output.  I have not made this new version into an official release yet.  The behaviour of mwrank on being given a curve with huge coefficients is \n\n```\n$ ./progs/mwrank -v 0 \nProgram mwrank: uses 2-descent (via 2-isogeny if possible) to\ndetermine the rank of an elliptic curve E over Q, and list a\nset of points which generate E(Q) modulo 2E(Q).\nand finally saturate to obtain generating points on the curve.\nFor more details see the mwrank documentation.\nFor details of algorithms see the author's book.\n\nPlease acknowledge use of this program in published work, \nand send problems to john.cremona@gmail.com.\n\nVersion compiled on Sep  9 2019 at 15:05:13 by GCC 5.4.0 20160609\nusing NTL bigints and NTL real and complex multiprecision floating point\nEnter curve: 0 0 0 0 429347239472947294723947203947209422347204720472021\nCurve [0,0,0,0,429347239472947294723947203947209422347204720472021] :   Attempt to convert -0.85368380442727e34 to long fails!\n2-descent: lower bound -0.85368380442727e34 on c too large\nAttempt to convert -0.13658940870836e36 to long fails!\n2-descent: lower bound -0.13658940870836e36 on c too large\nFailed to compute rank\n```\n\nresulting in something (a success flag) which Sage could test (as it already does in some circumstances).  It will need a little more work before Sage can install this version and pass tests, but it could be tested as is.",
    "created_at": "2019-09-09T14:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443221",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@JohnCremona](#comment:13):
> No objection.   I know that it is a *bad thing* for library functions to call abort() and ideally I would recode the places where that happens, but there are hundreds of such places since I seem to use it whenever something invalid is tried such as adding two vectors of different lengths, as well as when memory allocation fails or (as here) when an attempt is made to put a too large integer into a long int.  As a stopgap I will make sure that when some warning is output just before abort() then the output is flushed.
> 
> This will need a new eclib version, so patching ROUNDUP and ROUNDOWN in mwrank1.cc as suggested would be a reasonable stopgap.


There will soon be a new version of eclib (tarball is at http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/eclib-20190909.tar.bz2) which removes all calls to abort() and does something reasonable wherever that used to happen, including flushing output.  I have not made this new version into an official release yet.  The behaviour of mwrank on being given a curve with huge coefficients is 

```
$ ./progs/mwrank -v 0 
Program mwrank: uses 2-descent (via 2-isogeny if possible) to
determine the rank of an elliptic curve E over Q, and list a
set of points which generate E(Q) modulo 2E(Q).
and finally saturate to obtain generating points on the curve.
For more details see the mwrank documentation.
For details of algorithms see the author's book.

Please acknowledge use of this program in published work, 
and send problems to john.cremona@gmail.com.

Version compiled on Sep  9 2019 at 15:05:13 by GCC 5.4.0 20160609
using NTL bigints and NTL real and complex multiprecision floating point
Enter curve: 0 0 0 0 429347239472947294723947203947209422347204720472021
Curve [0,0,0,0,429347239472947294723947203947209422347204720472021] :   Attempt to convert -0.85368380442727e34 to long fails!
2-descent: lower bound -0.85368380442727e34 on c too large
Attempt to convert -0.13658940870836e36 to long fails!
2-descent: lower bound -0.13658940870836e36 on c too large
Failed to compute rank
```

resulting in something (a success flag) which Sage could test (as it already does in some circumstances).  It will need a little more work before Sage can install this version and pass tests, but it could be tested as is.



---

archive/issue_comments_443222.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe tarball in comment 14 is looking good (to me).  After installing it in a python2 Sage I only needed to adjust one doctest in this file interface.py: line 359 now says\n\n```\nRuntimeError: A 2-descent did not complete successfully.\n```\n\nI have not yet done any python3 testing.",
    "created_at": "2019-09-09T16:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443222",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:15" align="right">comment:15</div>

The tarball in comment 14 is looking good (to me).  After installing it in a python2 Sage I only needed to adjust one doctest in this file interface.py: line 359 now says

```
RuntimeError: A 2-descent did not complete successfully.
```

I have not yet done any python3 testing.



---

archive/issue_comments_443223.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIt looks good to me, too, at least as far as the doctests in `libs/eclib/` are concerned: I just see the one problem you mentioned. This is with Python 3.\n\nI think I will still prepare a patch for the old version, since it's easy to do, and if we end up not needing it and going straight to your new version, that's fine with me.",
    "created_at": "2019-09-09T18:28:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443223",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

It looks good to me, too, at least as far as the doctests in `libs/eclib/` are concerned: I just see the one problem you mentioned. This is with Python 3.

I think I will still prepare a patch for the old version, since it's easy to do, and if we end up not needing it and going straight to your new version, that's fine with me.



---

archive/issue_comments_443224.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment:16):\n> It looks good to me, too, at least as far as the doctests in `libs/eclib/` are concerned: I just see the one problem you mentioned. This is with Python 3.\n> \n\nGood.  I had a successful \"make ptestlong\" too (python2).\n\n> I think I will still prepare a patch for the old version, since it's easy to do, and if we end up not needing it and going straight to your new version, that's fine with me.\n\nThanks.",
    "created_at": "2019-09-09T18:39:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443224",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment:16):
> It looks good to me, too, at least as far as the doctests in `libs/eclib/` are concerned: I just see the one problem you mentioned. This is with Python 3.
> 

Good.  I had a successful "make ptestlong" too (python2).

> I think I will still prepare a patch for the old version, since it's easy to do, and if we end up not needing it and going straight to your new version, that's fine with me.

Thanks.



---

archive/issue_comments_443225.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/eclib-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/eclib-flush)**",
    "created_at": "2019-09-09T18:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443225",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/eclib-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/eclib-flush)**



---

archive/issue_comments_443226.json:
```json
{
    "body": "Commit: **[`ad86cbe`](https://github.com/sagemath/sagetrac-mirror/commit/ad86cbe9689b2488f481a9295f5c25e5a3e69d7a)**",
    "created_at": "2019-09-09T18:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443226",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`ad86cbe`](https://github.com/sagemath/sagetrac-mirror/commit/ad86cbe9689b2488f481a9295f5c25e5a3e69d7a)**



---

archive/issue_comments_443227.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOkay, done. I think I need you to decide whether to use the patch or wait for a new version, since I don't know your timeline. If a new release won't be ready within a week or so, I would suggest using the patch. I'd certainly rather do that than have you feel under any time pressure to produce a new release. (Full Python 3 support, with all tests passing, is very close, and I want to make progress quickly when possible.)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad86cbe9689b2488f481a9295f5c25e5a3e69d7a\"><code>ad86cbe</code></a></td><td><code>trac 28454: patch eclib to flush output after printing some messages.</code></td></tr></table>\n",
    "created_at": "2019-09-09T18:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443227",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Okay, done. I think I need you to decide whether to use the patch or wait for a new version, since I don't know your timeline. If a new release won't be ready within a week or so, I would suggest using the patch. I'd certainly rather do that than have you feel under any time pressure to produce a new release. (Full Python 3 support, with all tests passing, is very close, and I want to make progress quickly when possible.)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad86cbe9689b2488f481a9295f5c25e5a3e69d7a"><code>ad86cbe</code></a></td><td><code>trac 28454: patch eclib to flush output after printing some messages.</code></td></tr></table>




---

archive/issue_comments_443228.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe other good news is that because of this ticket, I realized that the same non-flushing problem causes another Python 3 doctest failure (#28334), which I had no idea how to diagnose before.",
    "created_at": "2019-09-09T19:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443228",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

The other good news is that because of this ticket, I realized that the same non-flushing problem causes another Python 3 doctest failure (#28334), which I had no idea how to diagnose before.



---

archive/issue_comments_443229.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/eclib-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/eclib-flush)** to **[u/cremona/28454](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/28454)**",
    "created_at": "2019-09-10T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443229",
    "user": "https://github.com/JohnCremona"
}
```

Changed branch from **[u/jhpalmieri/eclib-flush](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/eclib-flush)** to **[u/cremona/28454](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/28454)**



---

archive/issue_comments_443230.json:
```json
{
    "body": "Author: **John Cremona, John Palmieri**",
    "created_at": "2019-09-10T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443230",
    "user": "https://github.com/JohnCremona"
}
```

Author: **John Cremona, John Palmieri**



---

archive/issue_comments_443231.json:
```json
{
    "body": "Changed commit from **[`ad86cbe`](https://github.com/sagemath/sagetrac-mirror/commit/ad86cbe9689b2488f481a9295f5c25e5a3e69d7a)** to **[`6ab659a`](https://github.com/sagemath/sagetrac-mirror/commit/6ab659a47a1318932020dc2edec2dbb7eefc9295)**",
    "created_at": "2019-09-10T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443231",
    "user": "https://github.com/JohnCremona"
}
```

Changed commit from **[`ad86cbe`](https://github.com/sagemath/sagetrac-mirror/commit/ad86cbe9689b2488f481a9295f5c25e5a3e69d7a)** to **[`6ab659a`](https://github.com/sagemath/sagetrac-mirror/commit/6ab659a47a1318932020dc2edec2dbb7eefc9295)**



---

archive/issue_comments_443232.json:
```json
{
    "body": "Reviewer: **John Cremona**",
    "created_at": "2019-09-10T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443232",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona**



---

archive/issue_comments_443233.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI hope I have not broken any etiquette by replacing your patch with my own, which just patches the file sage.libs.eclib.wrap.cpp to ensure that both cout and cerr are flushed after every eclib library call which might bail out.  (I have a good idea of which these are having gone through over 200 places where eclib library functions call abort() yesterday).\n\nThe behaviour originally reported never happened for me anyway (on ubuntu) so I cannot really test, but \"make ptestlong\" had failures in 28 files (around 80 doctests in all) none of which are related to this as far as I can see.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ab659a47a1318932020dc2edec2dbb7eefc9295\"><code>6ab659a</code></a></td><td><code>#28454: systematic flushing of cout and cerr after calling eclib functions</code></td></tr></table>\n",
    "created_at": "2019-09-10T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443233",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:21" align="right">comment:21</div>

I hope I have not broken any etiquette by replacing your patch with my own, which just patches the file sage.libs.eclib.wrap.cpp to ensure that both cout and cerr are flushed after every eclib library call which might bail out.  (I have a good idea of which these are having gone through over 200 places where eclib library functions call abort() yesterday).

The behaviour originally reported never happened for me anyway (on ubuntu) so I cannot really test, but "make ptestlong" had failures in 28 files (around 80 doctests in all) none of which are related to this as far as I can see.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ab659a47a1318932020dc2edec2dbb7eefc9295"><code>6ab659a</code></a></td><td><code>#28454: systematic flushing of cout and cerr after calling eclib functions</code></td></tr></table>




---

archive/issue_comments_443234.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nTicket #28472 has an eclib upgrade.  No reason why the patch here cannot be merged first.",
    "created_at": "2019-09-10T18:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443234",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:22" align="right">comment:22</div>

Ticket #28472 has an eclib upgrade.  No reason why the patch here cannot be merged first.



---

archive/issue_events_392495.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-09-10T18:23:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392495"
}
```



---

archive/issue_comments_443235.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI get a doctest failure with Python 3 on debian: similar, but the output is flushed almost (but not quite) immediately, so the message appears in the doctest after the one where it should:\n\n```\nFile \"src/sage/libs/eclib/interface.py\", line 368, in sage.libs.eclib.interface.mwrank_EllipticCurve.?\nFailed example:\n    E.two_descent(verbose=False)\nExpected:\n    True\nGot:\n    Attempt to round -0.2617840677e25 to a long int fails, aborting!\n    True\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.libs.eclib.interface.mwrank_EllipticCurve.?\n    [192 tests, 1 failure, 7.16 s]\n----------------------------------------------------------------------\nsage -t --warn-long 206.6 src/sage/libs/eclib/interface.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2019-09-10T18:54:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443235",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

I get a doctest failure with Python 3 on debian: similar, but the output is flushed almost (but not quite) immediately, so the message appears in the doctest after the one where it should:

```
File "src/sage/libs/eclib/interface.py", line 368, in sage.libs.eclib.interface.mwrank_EllipticCurve.?
Failed example:
    E.two_descent(verbose=False)
Expected:
    True
Got:
    Attempt to round -0.2617840677e25 to a long int fails, aborting!
    True
**********************************************************************
1 item had failures:
   1 of   6 in sage.libs.eclib.interface.mwrank_EllipticCurve.?
    [192 tests, 1 failure, 7.16 s]
----------------------------------------------------------------------
sage -t --warn-long 206.6 src/sage/libs/eclib/interface.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_443236.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n(No breach of etiquette at all, by the way. I just want to get the problem fixed.)",
    "created_at": "2019-09-10T19:30:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443236",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

(No breach of etiquette at all, by the way. I just want to get the problem fixed.)



---

archive/issue_comments_443237.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nStrange.  I'll double check that I put in all the flushes, and perhaps insert some more before as well as after each library call.",
    "created_at": "2019-09-10T21:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443237",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:25" align="right">comment:25</div>

Strange.  I'll double check that I put in all the flushes, and perhaps insert some more before as well as after each library call.



---

archive/issue_comments_443238.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@JohnCremona](#comment:25):\n> Strange.  I'll double check that I put in all the flushes, and perhaps insert some more before as well as after each library call.\n\nI think that accepting #28472 now is the best way to go.",
    "created_at": "2019-09-11T08:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443238",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@JohnCremona](#comment:25):
> Strange.  I'll double check that I put in all the flushes, and perhaps insert some more before as well as after each library call.

I think that accepting #28472 now is the best way to go.



---

archive/issue_events_392496.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-11T18:38:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392496"
}
```



---

archive/issue_events_392497.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-11T18:38:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392497"
}
```



---

archive/issue_events_392498.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-11T18:38:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392498"
}
```



---

archive/issue_events_392499.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-11T18:38:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392499"
}
```



---

archive/issue_events_392500.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-09-11T18:38:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392500"
}
```



---

archive/issue_comments_443239.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI agree. I'm marking this as a duplicate.",
    "created_at": "2019-09-11T18:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443239",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

I agree. I'm marking this as a duplicate.



---

archive/issue_comments_443240.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n(deleting the branch so it doesn't get merged by accident)",
    "created_at": "2019-09-12T21:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443240",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

(deleting the branch so it doesn't get merged by accident)



---

archive/issue_comments_443241.json:
```json
{
    "body": "Changed branch from **[u/cremona/28454](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/28454)** to none",
    "created_at": "2019-09-12T21:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443241",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/cremona/28454](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/28454)** to none



---

archive/issue_comments_443242.json:
```json
{
    "body": "Changed commit from **[`6ab659a`](https://github.com/sagemath/sagetrac-mirror/commit/6ab659a47a1318932020dc2edec2dbb7eefc9295)** to none",
    "created_at": "2019-09-12T21:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443242",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`6ab659a`](https://github.com/sagemath/sagetrac-mirror/commit/6ab659a47a1318932020dc2edec2dbb7eefc9295)** to none



---

archive/issue_events_392501.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-14T06:04:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "c6c6c6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392501"
}
```



---

archive/issue_events_392502.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-14T06:04:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392502"
}
```



---

archive/issue_events_392503.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-14T06:04:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28454#event-392503"
}
```



---

archive/issue_comments_443243.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI know this is closed, but can you reproduce the issue if you run the tests with `--memlimit=0`?",
    "created_at": "2019-09-18T11:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443243",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

I know this is closed, but can you reproduce the issue if you run the tests with `--memlimit=0`?



---

archive/issue_comments_443244.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n`./sage -t --memlimit=0 src/sage/lib/eclib/interface.py` fails the same way.",
    "created_at": "2019-09-18T16:59:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28454#issuecomment-443244",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:31" align="right">comment:31</div>

`./sage -t --memlimit=0 src/sage/lib/eclib/interface.py` fails the same way.
