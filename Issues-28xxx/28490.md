# Issue 28490: Let Sage honour PEP 515 (py3)

archive/issues_028253.json:
```json
{
    "assignees": [],
    "body": "In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser, as well as integer and real number constructors, do not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).\n\n\n**CC:**  @slel\n\n**Keywords:** preparser, py3\n\n**Branch/Commit:** [4c0787ddabd93c2b79d652131503685c98d12888](https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888)\n\n**Reviewer:** Thierry Monteil, Vincent Delecroix, John Palmieri\n\n**Author:** Vincent Delecroix, John Palmieri\n\nIssue created by migration from https://trac.sagemath.org/ticket/28490\n\n",
    "closed_at": "2020-02-27T23:12:43Z",
    "created_at": "2019-09-14T00:43:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Let Sage honour PEP 515 (py3)",
    "type": "issue",
    "updated_at": "2020-02-27T23:12:43Z",
    "url": "https://github.com/sagemath/sage/issues/28490",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser, as well as integer and real number constructors, do not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).


**CC:**  @slel

**Keywords:** preparser, py3

**Branch/Commit:** [4c0787ddabd93c2b79d652131503685c98d12888](https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888)

**Reviewer:** Thierry Monteil, Vincent Delecroix, John Palmieri

**Author:** Vincent Delecroix, John Palmieri

Issue created by migration from https://trac.sagemath.org/ticket/28490





---

archive/issue_events_342495.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2019-09-14T00:43:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342495"
}
```



---

archive/issue_events_342496.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2019-09-14T00:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342496"
}
```



---

archive/issue_events_342497.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2019-09-14T00:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342497"
}
```



---

archive/issue_comments_446855.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"preparser, py3\".",
    "created_at": "2019-09-14T20:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446855",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "preparser, py3".



---

archive/issue_comments_446856.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this as question](https://ask.sagemath.org/question/47908/sage-is-not-preparsing-python-3-underscored-integers/).\n+In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908).\n``````\n",
    "created_at": "2019-09-14T20:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446856",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this as question](https://ask.sagemath.org/question/47908/sage-is-not-preparsing-python-3-underscored-integers/).
+In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908).
``````




---

archive/issue_comments_446857.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/preparse_underscore](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/preparse_underscore)",
    "created_at": "2019-10-18T21:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446857",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/preparse_underscore](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/preparse_underscore)



---

archive/issue_comments_446858.json:
```json
{
    "body": "**Commit:** [3601e61b65ce7c67e272e4d16be6a555318a6351](https://github.com/sagemath/sagetrac-mirror/commit/3601e61b65ce7c67e272e4d16be6a555318a6351)",
    "created_at": "2019-10-18T21:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446858",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [3601e61b65ce7c67e272e4d16be6a555318a6351](https://github.com/sagemath/sagetrac-mirror/commit/3601e61b65ce7c67e272e4d16be6a555318a6351)



---

archive/issue_events_342498.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-18T21:59:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342498"
}
```



---

archive/issue_comments_446859.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2019-10-18T21:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446859",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** John Palmieri



---

archive/issue_comments_446860.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nHere is an attempt. This does at least one other thing: it no longer allows leading zeroes in integers. This is not valid Python syntax, so Sage should not allow it, either.",
    "created_at": "2019-10-18T21:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446860",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'>**Comment 3:**</a>
Here is an attempt. This does at least one other thing: it no longer allows leading zeroes in integers. This is not valid Python syntax, so Sage should not allow it, either.



---

archive/issue_comments_446861.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfcdc57ecce11491d8428c50a5ecfc4beea5663a\">cfcdc57</a></td><td><code>trac 28490: preparse underscores in numeric literals.</code></td></tr></table>\n",
    "created_at": "2019-10-18T22:12:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446861",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>**Comment 4:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfcdc57ecce11491d8428c50a5ecfc4beea5663a">cfcdc57</a></td><td><code>trac 28490: preparse underscores in numeric literals.</code></td></tr></table>




---

archive/issue_comments_446862.json:
```json
{
    "body": "**Changing commit** from \"[3601e61b65ce7c67e272e4d16be6a555318a6351](https://github.com/sagemath/sagetrac-mirror/commit/3601e61b65ce7c67e272e4d16be6a555318a6351)\" to \"[cfcdc57ecce11491d8428c50a5ecfc4beea5663a](https://github.com/sagemath/sagetrac-mirror/commit/cfcdc57ecce11491d8428c50a5ecfc4beea5663a)\".",
    "created_at": "2019-10-18T22:12:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446862",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[3601e61b65ce7c67e272e4d16be6a555318a6351](https://github.com/sagemath/sagetrac-mirror/commit/3601e61b65ce7c67e272e4d16be6a555318a6351)" to "[cfcdc57ecce11491d8428c50a5ecfc4beea5663a](https://github.com/sagemath/sagetrac-mirror/commit/cfcdc57ecce11491d8428c50a5ecfc4beea5663a)".



---

archive/issue_comments_446863.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nIn my understanding of the PEP (confirmed by testing on a ipython3 console), trailing underscores are not allowed, however we currently have:\n\n```\nsage: 100_000_\n100000\n```\n\nAlso, perhaps could you show the feature in action with a concrete example, something like:\n\n```\nThe preparser can handle PEP 515 (see :trac:`28490`)::\n\n    sage: 1_000_000 + 3_000\n    1003000\n```",
    "created_at": "2019-10-18T23:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446863",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:5'>**Comment 5:**</a>
In my understanding of the PEP (confirmed by testing on a ipython3 console), trailing underscores are not allowed, however we currently have:

```
sage: 100_000_
100000
```

Also, perhaps could you show the feature in action with a concrete example, something like:

```
The preparser can handle PEP 515 (see :trac:`28490`)::

    sage: 1_000_000 + 3_000
    1003000
```



---

archive/issue_comments_446864.json:
```json
{
    "body": "**Reviewer:** Thierry Monteil",
    "created_at": "2019-10-18T23:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446864",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

**Reviewer:** Thierry Monteil



---

archive/issue_events_342499.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2019-10-18T23:04:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342499"
}
```



---

archive/issue_events_342500.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2019-10-18T23:04:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342500"
}
```



---

archive/issue_comments_446865.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61f06181e04f3c1266b22cd502bf223850df0ac0\">61f0618</a></td><td><code>trac 28490: do not allow trailing underscores</code></td></tr></table>\n",
    "created_at": "2019-10-19T04:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446865",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61f06181e04f3c1266b22cd502bf223850df0ac0">61f0618</a></td><td><code>trac 28490: do not allow trailing underscores</code></td></tr></table>




---

archive/issue_comments_446866.json:
```json
{
    "body": "**Changing commit** from \"[cfcdc57ecce11491d8428c50a5ecfc4beea5663a](https://github.com/sagemath/sagetrac-mirror/commit/cfcdc57ecce11491d8428c50a5ecfc4beea5663a)\" to \"[61f06181e04f3c1266b22cd502bf223850df0ac0](https://github.com/sagemath/sagetrac-mirror/commit/61f06181e04f3c1266b22cd502bf223850df0ac0)\".",
    "created_at": "2019-10-19T04:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446866",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[cfcdc57ecce11491d8428c50a5ecfc4beea5663a](https://github.com/sagemath/sagetrac-mirror/commit/cfcdc57ecce11491d8428c50a5ecfc4beea5663a)" to "[61f06181e04f3c1266b22cd502bf223850df0ac0](https://github.com/sagemath/sagetrac-mirror/commit/61f06181e04f3c1266b22cd502bf223850df0ac0)".



---

archive/issue_comments_446867.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a26c28960fd2c67b2415ed3bd75f9acac42d5a76\">a26c289</a></td><td><code>trac 28490: do not allow trailing underscores</code></td></tr></table>\n",
    "created_at": "2019-10-19T04:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446867",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>**Comment 7:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a26c28960fd2c67b2415ed3bd75f9acac42d5a76">a26c289</a></td><td><code>trac 28490: do not allow trailing underscores</code></td></tr></table>




---

archive/issue_comments_446868.json:
```json
{
    "body": "**Changing commit** from \"[61f06181e04f3c1266b22cd502bf223850df0ac0](https://github.com/sagemath/sagetrac-mirror/commit/61f06181e04f3c1266b22cd502bf223850df0ac0)\" to \"[a26c28960fd2c67b2415ed3bd75f9acac42d5a76](https://github.com/sagemath/sagetrac-mirror/commit/a26c28960fd2c67b2415ed3bd75f9acac42d5a76)\".",
    "created_at": "2019-10-19T04:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446868",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[61f06181e04f3c1266b22cd502bf223850df0ac0](https://github.com/sagemath/sagetrac-mirror/commit/61f06181e04f3c1266b22cd502bf223850df0ac0)" to "[a26c28960fd2c67b2415ed3bd75f9acac42d5a76](https://github.com/sagemath/sagetrac-mirror/commit/a26c28960fd2c67b2415ed3bd75f9acac42d5a76)".



---

archive/issue_comments_446869.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nOkay, trailing underscores now should fail, and I added the doctest.",
    "created_at": "2019-10-19T04:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446869",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'>**Comment 8:**</a>
Okay, trailing underscores now should fail, and I added the doctest.



---

archive/issue_comments_446870.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n-In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908).\n+In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).\n+\n``````\n",
    "created_at": "2019-10-19T04:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446870",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,2 @@
-In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908).
+In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).
+
``````




---

archive/issue_events_342501.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-19T04:46:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342501"
}
```



---

archive/issue_events_342502.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-10-19T04:46:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342502"
}
```



---

archive/issue_comments_446871.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nThe patchbots seem unhappy, apparently the doctests do not behave the same there.",
    "created_at": "2019-10-19T09:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446871",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:9'>**Comment 9:**</a>
The patchbots seem unhappy, apparently the doctests do not behave the same there.



---

archive/issue_comments_446872.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nThe doctests pass with Python 3, not with Python 2. I guess there is a question: using underscores is only valid starting in Python. Do we want to allow this in Sage built with Python 2?\n\nAlso, a leading zero is valid in Python 2 but not in Python 3. What should we do about that?",
    "created_at": "2019-10-19T15:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446872",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'>**Comment 10:**</a>
The doctests pass with Python 3, not with Python 2. I guess there is a question: using underscores is only valid starting in Python. Do we want to allow this in Sage built with Python 2?

Also, a leading zero is valid in Python 2 but not in Python 3. What should we do about that?



---

archive/issue_comments_446873.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fe807bad14c00b3c27421c8765893f0de56e1f2\">2fe807b</a></td><td><code>trac 28490: fix py2 behavior and doctests</code></td></tr></table>\n",
    "created_at": "2019-10-19T15:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446873",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>**Comment 11:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fe807bad14c00b3c27421c8765893f0de56e1f2">2fe807b</a></td><td><code>trac 28490: fix py2 behavior and doctests</code></td></tr></table>




---

archive/issue_comments_446874.json:
```json
{
    "body": "**Changing commit** from \"[a26c28960fd2c67b2415ed3bd75f9acac42d5a76](https://github.com/sagemath/sagetrac-mirror/commit/a26c28960fd2c67b2415ed3bd75f9acac42d5a76)\" to \"[2fe807bad14c00b3c27421c8765893f0de56e1f2](https://github.com/sagemath/sagetrac-mirror/commit/2fe807bad14c00b3c27421c8765893f0de56e1f2)\".",
    "created_at": "2019-10-19T15:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446874",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a26c28960fd2c67b2415ed3bd75f9acac42d5a76](https://github.com/sagemath/sagetrac-mirror/commit/a26c28960fd2c67b2415ed3bd75f9acac42d5a76)" to "[2fe807bad14c00b3c27421c8765893f0de56e1f2](https://github.com/sagemath/sagetrac-mirror/commit/2fe807bad14c00b3c27421c8765893f0de56e1f2)".



---

archive/issue_comments_446875.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nI propose to allow underscores with Python 2.",
    "created_at": "2019-10-19T15:48:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446875",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'>**Comment 12:**</a>
I propose to allow underscores with Python 2.



---

archive/issue_comments_446876.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nMy personal opinion:\n\n- write a simple code with Python 3 in mind only, to avoid cumbersome code, since Python2 will be dropped soon anyway (an i guess nobody using Python 2 will complain that 1000_000 should not be accepted)\n- use `# py2` and `# py3` in doctests to make patchbots happy.",
    "created_at": "2019-10-19T16:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446876",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:13'>**Comment 13:**</a>
My personal opinion:

- write a simple code with Python 3 in mind only, to avoid cumbersome code, since Python2 will be dropped soon anyway (an i guess nobody using Python 2 will complain that 1000_000 should not be accepted)
- use `# py2` and `# py3` in doctests to make patchbots happy.



---

archive/issue_comments_446877.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nThat's mostly what I did, except that with my code and Sage + Python 2, leading zeroes are still allowed. Aside from the `# py2` and `# py3` doctest tags, the only thing I've added to support Python 2 is to insert `if (six.PY3 and ...)` instead of `if (...)`. (This is to deal with leading zeroes.)",
    "created_at": "2019-10-19T18:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446877",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'>**Comment 14:**</a>
That's mostly what I did, except that with my code and Sage + Python 2, leading zeroes are still allowed. Aside from the `# py2` and `# py3` doctest tags, the only thing I've added to support Python 2 is to insert `if (six.PY3 and ...)` instead of `if (...)`. (This is to deal with leading zeroes.)



---

archive/issue_comments_446878.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nping?",
    "created_at": "2019-12-12T18:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446878",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'>**Comment 15:**</a>
ping?



---

archive/issue_events_342503.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342503"
}
```



---

archive/issue_events_342504.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342504"
}
```



---

archive/issue_comments_446879.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446879",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'>**Comment 16:**</a>
Ticket retargeted after milestone closed



---

archive/issue_comments_446880.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nCould you factorize\n\n```\n        # Multiple consecutive underscores is invalid Python\n        # syntax. Do not preparse.\n        if num.find('__') != -1:\n            continue\n\n        # Trailing underscore is invalid Python syntax. Do not\n        # preparse.\n        if num.endswith('_'):\n            continue\n```\ninto\n\n```\n        # Multiple consecutive underscores or trailing underscore\n        # is invalid Python syntax. Do not preparse.\n        if num.find('__') != -1 or num.endswith('_'):\n            continue\n```",
    "created_at": "2020-02-22T15:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446880",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'>**Comment 17:**</a>
Could you factorize

```
        # Multiple consecutive underscores is invalid Python
        # syntax. Do not preparse.
        if num.find('__') != -1:
            continue

        # Trailing underscore is invalid Python syntax. Do not
        # preparse.
        if num.endswith('_'):
            continue
```
into

```
        # Multiple consecutive underscores or trailing underscore
        # is invalid Python syntax. Do not preparse.
        if num.find('__') != -1 or num.endswith('_'):
            continue
```



---

archive/issue_comments_446881.json:
```json
{
    "body": "**Changing commit** from \"[2fe807bad14c00b3c27421c8765893f0de56e1f2](https://github.com/sagemath/sagetrac-mirror/commit/2fe807bad14c00b3c27421c8765893f0de56e1f2)\" to \"[8d22780cadd555599c2f50ec74c92274f668ccbc](https://github.com/sagemath/sagetrac-mirror/commit/8d22780cadd555599c2f50ec74c92274f668ccbc)\".",
    "created_at": "2020-02-24T21:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446881",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2fe807bad14c00b3c27421c8765893f0de56e1f2](https://github.com/sagemath/sagetrac-mirror/commit/2fe807bad14c00b3c27421c8765893f0de56e1f2)" to "[8d22780cadd555599c2f50ec74c92274f668ccbc](https://github.com/sagemath/sagetrac-mirror/commit/8d22780cadd555599c2f50ec74c92274f668ccbc)".



---

archive/issue_comments_446882.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c3ba0c124f6ea74d2accef84b3fa904c120e10c\">9c3ba0c</a></td><td><code>trac 28490: preparse underscores in numeric literals.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab0c26e4aec65766ce827d276413dc75c47e3861\">ab0c26e</a></td><td><code>trac 28490: do not allow trailing underscores</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/172ea242190b2bf2bab7ec3b971eb1b785922086\">172ea24</a></td><td><code>trac 28490: fix py2 behavior and doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d22780cadd555599c2f50ec74c92274f668ccbc\">8d22780</a></td><td><code>trac 28490: combine two \"if\" statements into one.</code></td></tr></table>\n",
    "created_at": "2020-02-24T21:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446882",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>**Comment 18:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c3ba0c124f6ea74d2accef84b3fa904c120e10c">9c3ba0c</a></td><td><code>trac 28490: preparse underscores in numeric literals.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab0c26e4aec65766ce827d276413dc75c47e3861">ab0c26e</a></td><td><code>trac 28490: do not allow trailing underscores</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/172ea242190b2bf2bab7ec3b971eb1b785922086">172ea24</a></td><td><code>trac 28490: fix py2 behavior and doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d22780cadd555599c2f50ec74c92274f668ccbc">8d22780</a></td><td><code>trac 28490: combine two "if" statements into one.</code></td></tr></table>




---

archive/issue_comments_446883.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [@videlec](#comment%3A17):\n> Could you factorize\n> \n> ```\n>         # Multiple consecutive underscores is invalid Python\n>         # syntax. Do not preparse.\n>         if num.find('__') != -1:\n>             continue\n> \n>         # Trailing underscore is invalid Python syntax. Do not\n>         # preparse.\n>         if num.endswith('_'):\n>             continue\n> ```\n> into\n> \n> ```\n>         # Multiple consecutive underscores or trailing underscore\n>         # is invalid Python syntax. Do not preparse.\n>         if num.find('__') != -1 or num.endswith('_'):\n>             continue\n> ```\n\nDone.",
    "created_at": "2020-02-24T21:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446883",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [@videlec](#comment%3A17):
> Could you factorize
> 
> ```
>         # Multiple consecutive underscores is invalid Python
>         # syntax. Do not preparse.
>         if num.find('__') != -1:
>             continue
> 
>         # Trailing underscore is invalid Python syntax. Do not
>         # preparse.
>         if num.endswith('_'):
>             continue
> ```
> into
> 
> ```
>         # Multiple consecutive underscores or trailing underscore
>         # is invalid Python syntax. Do not preparse.
>         if num.find('__') != -1 or num.endswith('_'):
>             continue
> ```

Done.



---

archive/issue_comments_446884.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nWhy would you change `123_456` to `123456`? This works perfectly fine\n\n```\nsage: preparser(False)\nsage: Integer(123_456)\n123456\nsage: preparser(True)\n```\nThe only problem seems to be that `.0` is too often converted to `.gen(0)`\n\n```\nsage: preparse(\"100_000.0\")\n'100_000.gen(0)'\n```",
    "created_at": "2020-02-24T22:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446884",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'>**Comment 20:**</a>
Why would you change `123_456` to `123456`? This works perfectly fine

```
sage: preparser(False)
sage: Integer(123_456)
123456
sage: preparser(True)
```
The only problem seems to be that `.0` is too often converted to `.gen(0)`

```
sage: preparse("100_000.0")
'100_000.gen(0)'
```



---

archive/issue_comments_446885.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nCouldn't you simply change `dec_num` to something like `dec_num = r\"\\d+(_\\d+)*\"` ?",
    "created_at": "2020-02-24T22:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446885",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'>**Comment 21:**</a>
Couldn't you simply change `dec_num` to something like `dec_num = r"\d+(_\d+)*"` ?



---

archive/issue_events_342505.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-02-24T23:01:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342505"
}
```



---

archive/issue_events_342506.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-02-24T23:01:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342506"
}
```



---

archive/issue_comments_446886.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nAnd it is not the role of the Sage preparser to implement PEP requests.",
    "created_at": "2020-02-24T23:01:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446886",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'>**Comment 22:**</a>
And it is not the role of the Sage preparser to implement PEP requests.



---

archive/issue_comments_446887.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nIn other words: it is good to make strings with underscored be recognized as numbers. But do not modify the input string beyond what is strictly necessary.",
    "created_at": "2020-02-24T23:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446887",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'>**Comment 23:**</a>
In other words: it is good to make strings with underscored be recognized as numbers. But do not modify the input string beyond what is strictly necessary.



---

archive/issue_comments_446888.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nI put a branch at `public/28490` which contains (I hope) the correct regexps. I also added more doctests for floating point numbers.\n\nOf course `Integer('1_23')` and `RealNumber('1_1.')` are broken. But this is IMHO a distinct problem.",
    "created_at": "2020-02-25T00:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446888",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'>**Comment 24:**</a>
I put a branch at `public/28490` which contains (I hope) the correct regexps. I also added more doctests for floating point numbers.

Of course `Integer('1_23')` and `RealNumber('1_1.')` are broken. But this is IMHO a distinct problem.



---

archive/issue_comments_446889.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nReplying to [@videlec](#comment%3A20):\n> Why would you change `123_456` to `123456`? This works perfectly fine\n\n5 months ago, when the ticket was opened, Python 2 was the default for Sage, and all of these things were completely broken with Python 2. Should this ticket provide support for Python 2? I haven't looked at your changes, so I don't know if they do.\n\n> And it is not the role of the Sage preparser to implement PEP requests. \n\nIt's not a request anymore, it's been merged into Python. Whose role is it to make sure that valid Python 3 syntax, like `100_000.0`, is interpreted properly in Sage?",
    "created_at": "2020-02-25T00:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446889",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'>**Comment 25:**</a>
Replying to [@videlec](#comment%3A20):
> Why would you change `123_456` to `123456`? This works perfectly fine

5 months ago, when the ticket was opened, Python 2 was the default for Sage, and all of these things were completely broken with Python 2. Should this ticket provide support for Python 2? I haven't looked at your changes, so I don't know if they do.

> And it is not the role of the Sage preparser to implement PEP requests. 

It's not a request anymore, it's been merged into Python. Whose role is it to make sure that valid Python 3 syntax, like `100_000.0`, is interpreted properly in Sage?



---

archive/issue_comments_446890.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nBy the way, I removed `dec_num` because it was redundant: covered (I think) by the other regexps.",
    "created_at": "2020-02-25T00:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446890",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'>**Comment 26:**</a>
By the way, I removed `dec_num` because it was redundant: covered (I think) by the other regexps.



---

archive/issue_comments_446891.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nReplying to [@jhpalmieri](#comment%3A25):\n> Replying to [@videlec](#comment%3A20):\n> > Why would you change `123_456` to `123456`? This works perfectly fine\n\n> \n> 5 months ago, when the ticket was opened, Python 2 was the default for Sage, and all of these things were completely broken with Python 2. Should this ticket provide support for Python 2? I haven't looked at your changes, so I don't know if they do.\n\nPython 2 is supposed to be dropped in sage-9.2. It should be supported for the next 9.1 release.\n \n> > And it is not the role of the Sage preparser to implement PEP requests. \n\n> \n> It's not a request anymore, it's been merged into Python. Whose role is it to make sure that valid Python 3 syntax, like `100_000.0`, is interpreted properly in Sage?\n\nAgreed. Did you have a look at `public/28490`? It does not touch to the interpreter beyond the update of regexp.",
    "created_at": "2020-02-25T09:21:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446891",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'>**Comment 27:**</a>
Replying to [@jhpalmieri](#comment%3A25):
> Replying to [@videlec](#comment%3A20):
> > Why would you change `123_456` to `123456`? This works perfectly fine

> 
> 5 months ago, when the ticket was opened, Python 2 was the default for Sage, and all of these things were completely broken with Python 2. Should this ticket provide support for Python 2? I haven't looked at your changes, so I don't know if they do.

Python 2 is supposed to be dropped in sage-9.2. It should be supported for the next 9.1 release.
 
> > And it is not the role of the Sage preparser to implement PEP requests. 

> 
> It's not a request anymore, it's been merged into Python. Whose role is it to make sure that valid Python 3 syntax, like `100_000.0`, is interpreted properly in Sage?

Agreed. Did you have a look at `public/28490`? It does not touch to the interpreter beyond the update of regexp.



---

archive/issue_comments_446892.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nI looked at your branch. It doesn't work with Python 2, for what that's worth:\n\n```\nsage: 123_456\n  File \"<ipython-input-1-d4d70e3ee054>\", line 1\n    Integer(123_456)\n                  ^\nSyntaxError: invalid syntax\n```\nI also get a few doctest failures with Python 3, but they should be easy to fix.\n\nYou can delete `dec_num` since it is redundant.\n\n```diff\ndiff --git a/src/sage/repl/preparse.py b/src/sage/repl/preparse.py\nindex a699394d1b..9b877285e9 100644\n--- a/src/sage/repl/preparse.py\n+++ b/src/sage/repl/preparse.py\n@@ -830,14 +830,13 @@ def preparse_numeric_literals(code, extract=False):\n \n     global all_num_regex\n     if all_num_regex is None:\n-        dec_num = r\"\\b\\d+(_\\d+)*\"\n         hex_num = r\"\\b0x[0-9a-f]+(_[0-9a-f]+)*\"\n         oct_num = r\"\\b0o[0-7]+(_[0-7]+)*\"\n         bin_num = r\"\\b0b[01]+(_[01]+)*\"\n         # This is slightly annoying as floating point numbers may start\n         # with a decimal point, but if they do the \\b will not match.\n         float_num = r\"((\\b\\d+(_\\d+)*([.](\\d+(_\\d+)*)?)?)|([.]\\d+(_\\d+)*))(e[-+]?\\d+(_\\d+)*)?\"\n-        all_num = r\"((%s)|(%s)|(%s)|(%s)|(%s))(rj|rL|jr|Lr|j|L|r|)\\b\" % (hex_num, oct_num, bin_num, float_num, dec_num)\n+        all_num = r\"((%s)|(%s)|(%s)|(%s))(rj|rL|jr|Lr|j|L|r|)\\b\" % (hex_num, oct_num, bin_num, float_num)\n         all_num_regex = re.compile(all_num, re.I)\n \n     for m in all_num_regex.finditer(code):\n```\nThe preparser is still broken with your branch:\n\n```\nsage: preparse('100_00.0')\n\"RealNumber('100_00.gen(0)')\"\n```\nWe need to fix this and add a doctest.",
    "created_at": "2020-02-25T18:03:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446892",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'>**Comment 28:**</a>
I looked at your branch. It doesn't work with Python 2, for what that's worth:

```
sage: 123_456
  File "<ipython-input-1-d4d70e3ee054>", line 1
    Integer(123_456)
                  ^
SyntaxError: invalid syntax
```
I also get a few doctest failures with Python 3, but they should be easy to fix.

You can delete `dec_num` since it is redundant.

```diff
diff --git a/src/sage/repl/preparse.py b/src/sage/repl/preparse.py
index a699394d1b..9b877285e9 100644
--- a/src/sage/repl/preparse.py
+++ b/src/sage/repl/preparse.py
@@ -830,14 +830,13 @@ def preparse_numeric_literals(code, extract=False):
 
     global all_num_regex
     if all_num_regex is None:
-        dec_num = r"\b\d+(_\d+)*"
         hex_num = r"\b0x[0-9a-f]+(_[0-9a-f]+)*"
         oct_num = r"\b0o[0-7]+(_[0-7]+)*"
         bin_num = r"\b0b[01]+(_[01]+)*"
         # This is slightly annoying as floating point numbers may start
         # with a decimal point, but if they do the \b will not match.
         float_num = r"((\b\d+(_\d+)*([.](\d+(_\d+)*)?)?)|([.]\d+(_\d+)*))(e[-+]?\d+(_\d+)*)?"
-        all_num = r"((%s)|(%s)|(%s)|(%s)|(%s))(rj|rL|jr|Lr|j|L|r|)\b" % (hex_num, oct_num, bin_num, float_num, dec_num)
+        all_num = r"((%s)|(%s)|(%s)|(%s))(rj|rL|jr|Lr|j|L|r|)\b" % (hex_num, oct_num, bin_num, float_num)
         all_num_regex = re.compile(all_num, re.I)
 
     for m in all_num_regex.finditer(code):
```
The preparser is still broken with your branch:

```
sage: preparse('100_00.0')
"RealNumber('100_00.gen(0)')"
```
We need to fix this and add a doctest.



---

archive/issue_comments_446893.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nFirst, with this change:\n\n```diff\ndiff --git a/src/sage/repl/preparse.py b/src/sage/repl/preparse.py\nindex a699394d1b..dd798f06b7 100644\n--- a/src/sage/repl/preparse.py\n+++ b/src/sage/repl/preparse.py\n@@ -1300,7 +1300,7 @@ def preparse(line, reset=True, do_time=False, ignore_prompts=False,\n \n     # Generators\n     # R.0 -> R.gen(0)\n-    L = re.sub(r'([_a-zA-Z]\\w*|[)\\]])\\.(\\d+)', r'\\1.gen(\\2)', L)\n+    L = re.sub(r'([a-zA-Z]\\w*|[)\\]])\\.(\\d+)', r'\\1.gen(\\2)', L)\n \n     # Use ^ for exponentiation and ^^ for xor\n     # (A side effect is that **** becomes xor as well.)\n```\n`preparse(100_000.0)` works, but `100_000.0` does not:\n\n```\nsage: preparse('100_000.0')\n\"RealNumber('100_000.0')\"\nsage: 100_000.0\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unable to convert '100_000.0' to a real number\n```\nSo that's some progress. Then this change fixes the conversion to `RealNumber`:\n\n```diff\ndiff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx\nindex 26cfddc0a2..8ec11ae38f 100644\n--- a/src/sage/rings/real_mpfr.pyx\n+++ b/src/sage/rings/real_mpfr.pyx\n@@ -1482,6 +1482,7 @@ cdef class RealNumber(sage.structure.element.RingElement):\n             mpfr_set_z(self.value, (<gmpy2.mpz>x).z, parent.rnd)\n         else:\n             s = str(x).replace(' ','')\n+            s = str(x).replace('_','')\n             s_lower = s.lower()\n             if s_lower == 'infinity':\n                 raise ValueError('can only convert signed infinity to RR')\n```",
    "created_at": "2020-02-25T18:59:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446893",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'>**Comment 29:**</a>
First, with this change:

```diff
diff --git a/src/sage/repl/preparse.py b/src/sage/repl/preparse.py
index a699394d1b..dd798f06b7 100644
--- a/src/sage/repl/preparse.py
+++ b/src/sage/repl/preparse.py
@@ -1300,7 +1300,7 @@ def preparse(line, reset=True, do_time=False, ignore_prompts=False,
 
     # Generators
     # R.0 -> R.gen(0)
-    L = re.sub(r'([_a-zA-Z]\w*|[)\]])\.(\d+)', r'\1.gen(\2)', L)
+    L = re.sub(r'([a-zA-Z]\w*|[)\]])\.(\d+)', r'\1.gen(\2)', L)
 
     # Use ^ for exponentiation and ^^ for xor
     # (A side effect is that **** becomes xor as well.)
```
`preparse(100_000.0)` works, but `100_000.0` does not:

```
sage: preparse('100_000.0')
"RealNumber('100_000.0')"
sage: 100_000.0
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unable to convert '100_000.0' to a real number
```
So that's some progress. Then this change fixes the conversion to `RealNumber`:

```diff
diff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx
index 26cfddc0a2..8ec11ae38f 100644
--- a/src/sage/rings/real_mpfr.pyx
+++ b/src/sage/rings/real_mpfr.pyx
@@ -1482,6 +1482,7 @@ cdef class RealNumber(sage.structure.element.RingElement):
             mpfr_set_z(self.value, (<gmpy2.mpz>x).z, parent.rnd)
         else:
             s = str(x).replace(' ','')
+            s = str(x).replace('_','')
             s_lower = s.lower()
             if s_lower == 'infinity':
                 raise ValueError('can only convert signed infinity to RR')
```



---

archive/issue_comments_446894.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nReplying to [@jhpalmieri](#comment%3A28):\n> I looked at your branch. It doesn't work with Python 2, for what that's worth:\n> \n> ```\n> sage: 123_456\n>   File \"<ipython-input-1-d4d70e3ee054>\", line 1\n>     Integer(123_456)\n>                   ^\n> SyntaxError: invalid syntax\n> ```\n\nIt **does** work with Python2 as the above `SyntaxError` is the expected behavior\n\n```\n$ python2 -c '123_456'\n  File \"<string>\", line 1\n    123_456\n          ^\nSyntaxError: invalid syntax\n```\nI don't see why we would change that in Sage.",
    "created_at": "2020-02-25T21:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446894",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'>**Comment 30:**</a>
Replying to [@jhpalmieri](#comment%3A28):
> I looked at your branch. It doesn't work with Python 2, for what that's worth:
> 
> ```
> sage: 123_456
>   File "<ipython-input-1-d4d70e3ee054>", line 1
>     Integer(123_456)
>                   ^
> SyntaxError: invalid syntax
> ```

It **does** work with Python2 as the above `SyntaxError` is the expected behavior

```
$ python2 -c '123_456'
  File "<string>", line 1
    123_456
          ^
SyntaxError: invalid syntax
```
I don't see why we would change that in Sage.



---

archive/issue_comments_446895.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\nReplying to [@jhpalmieri](#comment%3A29):\n> First, with this change:\n> \n> ```\n> <SNIP>\n> ```\n> `preparse(100_000.0)` works, but `100_000.0` does not:\n> \n> ```\n> <SNIP>\n> ```\n> So that's some progress.\n\nNice! To my mind, this is the end. `RealNumber` should accept this kind of strings as `float` does.\n\n```\nsage: float('1_1.1_1e1_1')\n1111000000000.0\n```\nIt is not the job of the preparser to modify the input string.\n\n> Then this change fixes the conversion to `RealNumber`:\n> \n> ```\n> <SNIP>\n> ```\n\nWhich is precisely what I don't wnat to do here!",
    "created_at": "2020-02-25T21:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446895",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'>**Comment 31:**</a>
Replying to [@jhpalmieri](#comment%3A29):
> First, with this change:
> 
> ```
> <SNIP>
> ```
> `preparse(100_000.0)` works, but `100_000.0` does not:
> 
> ```
> <SNIP>
> ```
> So that's some progress.

Nice! To my mind, this is the end. `RealNumber` should accept this kind of strings as `float` does.

```
sage: float('1_1.1_1e1_1')
1111000000000.0
```
It is not the job of the preparser to modify the input string.

> Then this change fixes the conversion to `RealNumber`:
> 
> ```
> <SNIP>
> ```

Which is precisely what I don't wnat to do here!



---

archive/issue_comments_446896.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nReplying to [@videlec](#comment%3A31):\n> > Then this change fixes the conversion to `RealNumber`:\n> > \n> > ```\n> > <SNIP>\n> > ```\n\n> \n> Which is precisely what I don't wnat to do here!\n\nWhy not? This is in the `__init__` method for `RealNumber`, where the string is already modified, as you can see from the surrounding lines. It's not in the preparser. Where else would you want to fix it?",
    "created_at": "2020-02-25T21:22:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446896",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'>**Comment 32:**</a>
Replying to [@videlec](#comment%3A31):
> > Then this change fixes the conversion to `RealNumber`:
> > 
> > ```
> > <SNIP>
> > ```

> 
> Which is precisely what I don't wnat to do here!

Why not? This is in the `__init__` method for `RealNumber`, where the string is already modified, as you can see from the surrounding lines. It's not in the preparser. Where else would you want to fix it?



---

archive/issue_comments_446897.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nReplying to [@jhpalmieri](#comment%3A32):\n> Replying to [@videlec](#comment%3A31):\n> > > Then this change fixes the conversion to `RealNumber`:\n> > > \n> > > ```\n> > > <SNIP>\n> > > ```\n\n> > \n> > Which is precisely what I don't wnat to do here!\n\n> \n> Why not? This is in the `__init__` method for `RealNumber`, where the string is already modified, as you can see from the surrounding lines. It's not in the preparser. Where else would you want to fix it?\n\nOups. I misread. It is fine modifying `RealNumber`. But the title and description has to be modified as it is not only about touching the preparser. Also `Integer` and `Rational` constructors have to be fixed.",
    "created_at": "2020-02-25T21:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446897",
    "user": "https://github.com/videlec"
}
```

<a id='comment:33'>**Comment 33:**</a>
Replying to [@jhpalmieri](#comment%3A32):
> Replying to [@videlec](#comment%3A31):
> > > Then this change fixes the conversion to `RealNumber`:
> > > 
> > > ```
> > > <SNIP>
> > > ```

> > 
> > Which is precisely what I don't wnat to do here!

> 
> Why not? This is in the `__init__` method for `RealNumber`, where the string is already modified, as you can see from the surrounding lines. It's not in the preparser. Where else would you want to fix it?

Oups. I misread. It is fine modifying `RealNumber`. But the title and description has to be modified as it is not only about touching the preparser. Also `Integer` and `Rational` constructors have to be fixed.



---

archive/issue_comments_446898.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nYour 'fix' from the first part of [comment:29](#comment%3A29) was not one... I will update the branch in a second.",
    "created_at": "2020-02-25T21:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446898",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'>**Comment 34:**</a>
Your 'fix' from the first part of [comment:29](#comment%3A29) was not one... I will update the branch in a second.



---

archive/issue_comments_446899.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/preparse_underscore](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/preparse_underscore)\" to \"[public/28490](https://github.com/sagemath/sagetrac-mirror/tree/public/28490)\".",
    "created_at": "2020-02-25T21:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446899",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/jhpalmieri/preparse_underscore](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/preparse_underscore)" to "[public/28490](https://github.com/sagemath/sagetrac-mirror/tree/public/28490)".



---

archive/issue_comments_446900.json:
```json
{
    "body": "**Changing commit** from \"[8d22780cadd555599c2f50ec74c92274f668ccbc](https://github.com/sagemath/sagetrac-mirror/commit/8d22780cadd555599c2f50ec74c92274f668ccbc)\" to \"[604d18debfdbb45e69258e61f847b15d01d0440e](https://github.com/sagemath/sagetrac-mirror/commit/604d18debfdbb45e69258e61f847b15d01d0440e)\".",
    "created_at": "2020-02-25T21:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446900",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[8d22780cadd555599c2f50ec74c92274f668ccbc](https://github.com/sagemath/sagetrac-mirror/commit/8d22780cadd555599c2f50ec74c92274f668ccbc)" to "[604d18debfdbb45e69258e61f847b15d01d0440e](https://github.com/sagemath/sagetrac-mirror/commit/604d18debfdbb45e69258e61f847b15d01d0440e)".



---

archive/issue_comments_446901.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/604d18debfdbb45e69258e61f847b15d01d0440e\">604d18d</a></td><td><code>28490: let preparser handle correctly _ in numbers</code></td></tr></table>\n",
    "created_at": "2020-02-25T21:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446901",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'>**Comment 35:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/604d18debfdbb45e69258e61f847b15d01d0440e">604d18d</a></td><td><code>28490: let preparser handle correctly _ in numbers</code></td></tr></table>




---

archive/issue_comments_446902.json:
```json
{
    "body": "**Changing author** from \"John Palmieri\" to \"John Palmieri, Vincent Delecroix\".",
    "created_at": "2020-02-25T21:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446902",
    "user": "https://github.com/videlec"
}
```

**Changing author** from "John Palmieri" to "John Palmieri, Vincent Delecroix".



---

archive/issue_comments_446903.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f235d02b07f765a63920a2b4e32eb91e41ba00fc\">f235d02</a></td><td><code>28490: remove leading 0 doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0148e7a40661a79a08e5f7adf62a42efce981b0c\">0148e7a</a></td><td><code>28490: more real numbers parser doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca980930adb16b5e88c3e6a96d986415fcfe5ed9\">ca98093</a></td><td><code>28490: remove dec_num</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d40ba4464cb4e8e2f202985f7cfe6623556fe99a\">d40ba44</a></td><td><code>28490: fix X.0 -> X.gen(0)</code></td></tr></table>\n",
    "created_at": "2020-02-25T21:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446903",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>**Comment 36:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f235d02b07f765a63920a2b4e32eb91e41ba00fc">f235d02</a></td><td><code>28490: remove leading 0 doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0148e7a40661a79a08e5f7adf62a42efce981b0c">0148e7a</a></td><td><code>28490: more real numbers parser doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca980930adb16b5e88c3e6a96d986415fcfe5ed9">ca98093</a></td><td><code>28490: remove dec_num</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d40ba4464cb4e8e2f202985f7cfe6623556fe99a">d40ba44</a></td><td><code>28490: fix X.0 -> X.gen(0)</code></td></tr></table>




---

archive/issue_comments_446904.json:
```json
{
    "body": "**Changing commit** from \"[604d18debfdbb45e69258e61f847b15d01d0440e](https://github.com/sagemath/sagetrac-mirror/commit/604d18debfdbb45e69258e61f847b15d01d0440e)\" to \"[d40ba4464cb4e8e2f202985f7cfe6623556fe99a](https://github.com/sagemath/sagetrac-mirror/commit/d40ba4464cb4e8e2f202985f7cfe6623556fe99a)\".",
    "created_at": "2020-02-25T21:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446904",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[604d18debfdbb45e69258e61f847b15d01d0440e](https://github.com/sagemath/sagetrac-mirror/commit/604d18debfdbb45e69258e61f847b15d01d0440e)" to "[d40ba4464cb4e8e2f202985f7cfe6623556fe99a](https://github.com/sagemath/sagetrac-mirror/commit/d40ba4464cb4e8e2f202985f7cfe6623556fe99a)".



---

archive/issue_comments_446905.json:
```json
{
    "body": "**Changing commit** from \"[d40ba4464cb4e8e2f202985f7cfe6623556fe99a](https://github.com/sagemath/sagetrac-mirror/commit/d40ba4464cb4e8e2f202985f7cfe6623556fe99a)\" to \"[70496a9218e87daf75e25f77375760023991456e](https://github.com/sagemath/sagetrac-mirror/commit/70496a9218e87daf75e25f77375760023991456e)\".",
    "created_at": "2020-02-25T21:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446905",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[d40ba4464cb4e8e2f202985f7cfe6623556fe99a](https://github.com/sagemath/sagetrac-mirror/commit/d40ba4464cb4e8e2f202985f7cfe6623556fe99a)" to "[70496a9218e87daf75e25f77375760023991456e](https://github.com/sagemath/sagetrac-mirror/commit/70496a9218e87daf75e25f77375760023991456e)".



---

archive/issue_comments_446906.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70496a9218e87daf75e25f77375760023991456e\">70496a9</a></td><td><code>28490: integer and real number constructor</code></td></tr></table>\n",
    "created_at": "2020-02-25T21:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446906",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>**Comment 37:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70496a9218e87daf75e25f77375760023991456e">70496a9</a></td><td><code>28490: integer and real number constructor</code></td></tr></table>




---

archive/issue_events_342507.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-02-25T21:42:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342507"
}
```



---

archive/issue_events_342508.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-02-25T21:42:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342508"
}
```



---

archive/issue_comments_446907.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nWith your branch in Python 2, `Integer('1_3')` returns 13 but plain `1_3` raises a `SyntaxError`. Is that what you intended? It's not consistent behavior.",
    "created_at": "2020-02-25T22:33:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446907",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'>**Comment 39:**</a>
With your branch in Python 2, `Integer('1_3')` returns 13 but plain `1_3` raises a `SyntaxError`. Is that what you intended? It's not consistent behavior.



---

archive/issue_events_342509.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-02-25T22:35:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "rename": {
        "from": "Let Sage preparser honour PEP 515 (py3)",
        "to": "Let Sage honour PEP 515 (py3)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342509"
}
```



---

archive/issue_comments_446908.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).\n+In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser, as well as integer and real number constructors, do not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).\n \n``````\n",
    "created_at": "2020-02-25T22:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446908",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser does not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).
+In Python 3, underscored numbers like `10_000_000.0` are allowed, but the preparser, as well as integer and real number constructors, do not handle them yet, see [this Ask Sage question](https://ask.sagemath.org/question/47908) and [PEP 515](https://www.python.org/dev/peps/pep-0515/).
 
``````




---

archive/issue_comments_446909.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nReplying to [@jhpalmieri](#comment%3A39):\n> With your branch in Python 2, `Integer('1_3')` returns 13 but plain `1_3` raises a `SyntaxError`. Is that what you intended? It's not consistent behavior.\n\nIt is not nice I agree. But I do not quite see inconsistency. Some constructors (like `Integer.__init__`) can perfectly support additional syntax. The problem to me is that on Python2, `1_3.` does not raise an error. But I do not want to worry about Python2. If you find a non invasive solution, feel free to add to the branch.\n\nRelated comment: it would be interesting to benchmark the two options for the preparser `123 -> Integer(123)` to `123 -> Integer('123')`. See the noticeable slowdown mentioned in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/Pc1qgjd_SzQ).",
    "created_at": "2020-02-26T08:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446909",
    "user": "https://github.com/videlec"
}
```

<a id='comment:42'>**Comment 42:**</a>
Replying to [@jhpalmieri](#comment%3A39):
> With your branch in Python 2, `Integer('1_3')` returns 13 but plain `1_3` raises a `SyntaxError`. Is that what you intended? It's not consistent behavior.

It is not nice I agree. But I do not quite see inconsistency. Some constructors (like `Integer.__init__`) can perfectly support additional syntax. The problem to me is that on Python2, `1_3.` does not raise an error. But I do not want to worry about Python2. If you find a non invasive solution, feel free to add to the branch.

Related comment: it would be interesting to benchmark the two options for the preparser `123 -> Integer(123)` to `123 -> Integer('123')`. See the noticeable slowdown mentioned in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/Pc1qgjd_SzQ).



---

archive/issue_comments_446910.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888\">4c0787d</a></td><td><code>trac 28490: tag one doctest \"py3\"</code></td></tr></table>\n",
    "created_at": "2020-02-26T20:04:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446910",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:43'>**Comment 43:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888">4c0787d</a></td><td><code>trac 28490: tag one doctest "py3"</code></td></tr></table>




---

archive/issue_comments_446911.json:
```json
{
    "body": "**Changing commit** from \"[70496a9218e87daf75e25f77375760023991456e](https://github.com/sagemath/sagetrac-mirror/commit/70496a9218e87daf75e25f77375760023991456e)\" to \"[4c0787ddabd93c2b79d652131503685c98d12888](https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888)\".",
    "created_at": "2020-02-26T20:04:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446911",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[70496a9218e87daf75e25f77375760023991456e](https://github.com/sagemath/sagetrac-mirror/commit/70496a9218e87daf75e25f77375760023991456e)" to "[4c0787ddabd93c2b79d652131503685c98d12888](https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888)".



---

archive/issue_comments_446912.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nOkay, good enough, I think.",
    "created_at": "2020-02-26T20:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446912",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'>**Comment 44:**</a>
Okay, good enough, I think.



---

archive/issue_events_342510.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-02-26T20:08:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342510"
}
```



---

archive/issue_events_342511.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-02-26T20:08:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342511"
}
```



---

archive/issue_comments_446913.json:
```json
{
    "body": "**Changing reviewer** from \"Thierry Monteil\" to \"Thierry Monteil, Vincent Delecroix, John Palmieri\".",
    "created_at": "2020-02-26T20:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446913",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing reviewer** from "Thierry Monteil" to "Thierry Monteil, Vincent Delecroix, John Palmieri".



---

archive/issue_comments_446914.json:
```json
{
    "body": "**Changing author** from \"John Palmieri, Vincent Delecroix\" to \"Vincent Delecroix, John Palmieri\".",
    "created_at": "2020-02-26T20:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446914",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing author** from "John Palmieri, Vincent Delecroix" to "Vincent Delecroix, John Palmieri".



---

archive/issue_comments_446915.json:
```json
{
    "body": "**Changing branch** from \"[public/28490](https://github.com/sagemath/sagetrac-mirror/tree/public/28490)\" to \"[4c0787ddabd93c2b79d652131503685c98d12888](https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888)\".",
    "created_at": "2020-02-27T23:12:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28490#issuecomment-446915",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/28490](https://github.com/sagemath/sagetrac-mirror/tree/public/28490)" to "[4c0787ddabd93c2b79d652131503685c98d12888](https://github.com/sagemath/sagetrac-mirror/commit/4c0787ddabd93c2b79d652131503685c98d12888)".



---

archive/issue_events_342512.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-02-27T23:12:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342512"
}
```



---

archive/issue_events_342513.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ec0ac6a389c4110ad9f68921ddd434e13c1aaf56",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-02-27T23:12:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28490",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28490#event-342513"
}
```
