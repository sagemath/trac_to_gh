# Issue 28557: julia_plot sometimes does not draw the entire julia set

archive/issues_028320.json:
```json
{
    "body": "The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.\n\nTo fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.\n\nI have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.\n\nKeywords: complexdynamics\n\nBranch/Commit: a5a0408e606b1936bd19bf821e631cc02f60bc7d\n\nReviewer: Markus Wageringel\n\nAuthor: Dave Morris\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28557\n\n",
    "closed_at": "2020-01-05T15:47:14Z",
    "created_at": "2019-10-05T06:00:30Z",
    "labels": [
        "component: dynamics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "julia_plot sometimes does not draw the entire julia set",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28557",
    "user": "https://github.com/DaveWitteMorris"
}
```
The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.

To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.

I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.

Keywords: complexdynamics

Branch/Commit: a5a0408e606b1936bd19bf821e631cc02f60bc7d

Reviewer: Markus Wageringel

Author: Dave Morris

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28557





---

archive/issue_comments_425762.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.\n \n-I have a patch that replaces 2 with this value of R, and I will attempt to upload it to the ticket as a PR, but I have not done this before, and I apologize if I already goofed up something else about this ticket.\n+I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.\n \n Stopgaps: none\n \n```\n",
    "created_at": "2019-10-05T06:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425762",
    "user": "https://github.com/DaveWitteMorris"
}
```

Description changed:
```diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.
 
-I have a patch that replaces 2 with this value of R, and I will attempt to upload it to the ticket as a PR, but I have not done this before, and I apologize if I already goofed up something else about this ticket.
+I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.
 
 Stopgaps: none
 
```




---

archive/issue_comments_425763.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-05T06:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425763",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_425764.json:
```json
{
    "body": "<a id='comment:3'></a>Ok, thank you. This change looks correct to me. Just in the documentation of `julia_plot`, I think you accidentally defined `R_c` as the square of the intended value. I changed it to `\\bigl(1 + \\sqrt{1 + 4|c|}\\bigr)/2` as you explained in the ticket description. Is this correct?\n\nI also rebased and squashed your commits and removed some trailing whitespace. If you agree with my changes, please set this ticket to positive review.\n\n---\nNew commits:",
    "created_at": "2019-12-01T15:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425764",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'></a>Ok, thank you. This change looks correct to me. Just in the documentation of `julia_plot`, I think you accidentally defined `R_c` as the square of the intended value. I changed it to `\bigl(1 + \sqrt{1 + 4|c|}\bigr)/2` as you explained in the ticket description. Is this correct?

I also rebased and squashed your commits and removed some trailing whitespace. If you agree with my changes, please set this ticket to positive review.

---
New commits:



---

archive/issue_comments_425765.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-01T23:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425765",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_425766.json:
```json
{
    "body": "<a id='comment:4'></a>You are right. Thanks for the review, for correcting the docstring, and for fixing my newbie mistakes.",
    "created_at": "2019-12-01T23:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425766",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:4'></a>You are right. Thanks for the review, for correcting the docstring, and for fixing my newbie mistakes.



---

archive/issue_comments_425767.json:
```json
{
    "body": "<a id='comment:5'></a>There is a merge conflict with the latest beta.",
    "created_at": "2019-12-02T07:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425767",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:5'></a>There is a merge conflict with the latest beta.



---

archive/issue_comments_425768.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-12-02T07:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425768",
    "user": "https://github.com/mwageringel"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_425769.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-14T12:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425770.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-14T12:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425770",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_425771.json:
```json
{
    "body": "<a id='comment:7'></a>Since #23740, Sage can now plot julia sets of more general polynomials. I merged in the latest beta, but this branch will only affect the case of polynomials of the form `f(z) = z^2 + c`. As this is the most common case, this seems acceptable to me.\n\n`@`gh-DaveWitteMorris: Please check whether this is ok, or change the implementation if possible.",
    "created_at": "2019-12-14T12:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425771",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:7'></a>Since #23740, Sage can now plot julia sets of more general polynomials. I merged in the latest beta, but this branch will only affect the case of polynomials of the form `f(z) = z^2 + c`. As this is the most common case, this seems acceptable to me.

`@`gh-DaveWitteMorris: Please check whether this is ok, or change the implementation if possible.



---

archive/issue_comments_425772.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-12-17T06:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425772",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_425773.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks for doing the merge. I'm sorry not to have done anything, but I moved to a different computer last month and have not been able to get git and sagemath working properly yet. Now that the semester is coming to an end, I should have more time and expect to be able to get my installation straightened out enough to work on this ticket later in the week.",
    "created_at": "2019-12-17T06:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425773",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:8'></a>Thanks for doing the merge. I'm sorry not to have done anything, but I moved to a different computer last month and have not been able to get git and sagemath working properly yet. Now that the semester is coming to an end, I should have more time and expect to be able to get my installation straightened out enough to work on this ticket later in the week.



---

archive/issue_comments_425774.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-30T04:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425774",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_425775.json:
```json
{
    "body": "<a id='comment:9'></a>I fixed two minor pyflakes complaints in mandel_julia.py. (`DynamicalSystem` was imported twice, and `QQ` was imported but never used.) I am happy with the state of this patch, and I recommend a positive review if the patchbots are green.\n\nHowever, I also think that `julia_plot` needs further work, as explained in the new metaticket #28923 (which tracks this ticket).\n\n`@`gh-mwageringel : Thanks again for your help with this ticket.",
    "created_at": "2019-12-30T04:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425775",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:9'></a>I fixed two minor pyflakes complaints in mandel_julia.py. (`DynamicalSystem` was imported twice, and `QQ` was imported but never used.) I am happy with the state of this patch, and I recommend a positive review if the patchbots are green.

However, I also think that `julia_plot` needs further work, as explained in the new metaticket #28923 (which tracks this ticket).

`@`gh-mwageringel : Thanks again for your help with this ticket.



---

archive/issue_comments_425776.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-30T04:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425777.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-30T17:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425777",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_425778.json:
```json
{
    "body": "<a id='comment:12'></a>Thanks for the updates.",
    "created_at": "2019-12-30T17:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425778",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:12'></a>Thanks for the updates.



---

archive/issue_events_071677.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2019-12-30T17:14:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28557#event-71677"
}
```



---

archive/issue_comments_425779.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.\n \n+To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.\n+\n+I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.\n+\n+**To the release manager:** This branch was merged into #28772 (to deal with a merge conflict). My intention was for this ticket to be merged first, and then #28772. On the other hand, if #28772 is merged first, then I think this ticket would be redundant, so it could be closed without being merged.\n \n Stopgaps: none\n \n```\n",
    "created_at": "2020-01-03T10:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425779",
    "user": "https://github.com/DaveWitteMorris"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,10 @@
+The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.
 
+To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.
+
+I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.
+
+**To the release manager:** This branch was merged into #28772 (to deal with a merge conflict). My intention was for this ticket to be merged first, and then #28772. On the other hand, if #28772 is merged first, then I think this ticket would be redundant, so it could be closed without being merged.
 
 Stopgaps: none
 
```




---

archive/issue_comments_425780.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.\n \n+To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.\n+\n+I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.\n \n Stopgaps: none\n \n```\n",
    "created_at": "2020-01-03T14:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425780",
    "user": "https://github.com/mwageringel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.
 
+To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.
+
+I have uploaded a PR that replaces 2 with this value of R, but I have not done this before, and I apologize if I goofed up anything about this ticket.
 
 Stopgaps: none
 
```




---

archive/issue_comments_425781.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 gh-DaveWitteMorris]:\n> This branch was merged into #28772 (to deal with a merge conflict). My intention was for this ticket to be merged first, and then #28772. On the other hand, if #28772 is merged first, then I think this ticket would be redundant, so it could be closed without being merged.\n\n\nNo problem, as this ticket is now a dependency of #28772, so this one gets merged first. It is still useful to merge this ticket individually, as it makes for a cleaner history which makes it easier to figure out where a change is coming from, later on. Try for example `git log --first-parent --oneline develop`.",
    "created_at": "2020-01-03T14:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425781",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:14'></a>Replying to [comment:13 gh-DaveWitteMorris]:
> This branch was merged into #28772 (to deal with a merge conflict). My intention was for this ticket to be merged first, and then #28772. On the other hand, if #28772 is merged first, then I think this ticket would be redundant, so it could be closed without being merged.


No problem, as this ticket is now a dependency of #28772, so this one gets merged first. It is still useful to merge this ticket individually, as it makes for a cleaner history which makes it easier to figure out where a change is coming from, later on. Try for example `git log --first-parent --oneline develop`.



---

archive/issue_events_071678.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-05T15:47:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28557#event-71678"
}
```



---

archive/issue_comments_425782.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-05T15:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28557#issuecomment-425782",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
