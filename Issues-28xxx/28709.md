# Issue 28709: Python executable in doctest/control.py

archive/issues_028472.json:
```json
{
    "body": "We don't need to specify the Python executable as `sage-python` in `doctest/control.py`, and it's better for distros and in general to not do so.\n\nThis is a followup to #28657.\n\n\nCC:  @kiwifb\n\nBranch/Commit: 7dc58a487230087818ef5608d1e1726a40a879e2\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: John Palmieri\n\nDependencies: #28657\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28709\n\n",
    "closed_at": "2019-11-16T20:15:38Z",
    "created_at": "2019-11-08T18:37:59Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Python executable in doctest/control.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28709",
    "user": "https://github.com/jhpalmieri"
}
```
We don't need to specify the Python executable as `sage-python` in `doctest/control.py`, and it's better for distros and in general to not do so.

This is a followup to #28657.


CC:  @kiwifb

Branch/Commit: 7dc58a487230087818ef5608d1e1726a40a879e2

Reviewer: François Bissey

Author: John Palmieri

Dependencies: #28657

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28709





---

archive/issue_comments_557192.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jhpalmieri/doctest-control-python\"",
    "created_at": "2019-11-08T18:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557192",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "" to "u/jhpalmieri/doctest-control-python"



---

archive/issue_comments_557193.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-08T18:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557193",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_557194.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-11-08T18:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557194",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_557195.json:
```json
{
    "body": "Changing commit from \"\" to \"b44e1b10664a18ce450540d449c544217c371db3\"",
    "created_at": "2019-11-08T18:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557195",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "b44e1b10664a18ce450540d449c544217c371db3"



---

archive/issue_comments_557196.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#28657\"",
    "created_at": "2019-11-08T18:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557196",
    "user": "https://github.com/jhpalmieri"
}
```

Changing dependencies from "" to "#28657"



---

archive/issue_comments_557197.json:
```json
{
    "body": "<a id='comment:4'></a>I was intending to do that. Nevermind, I am happy you think the idea is worthwhile.",
    "created_at": "2019-11-08T18:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557197",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>I was intending to do that. Nevermind, I am happy you think the idea is worthwhile.



---

archive/issue_comments_557198.json:
```json
{
    "body": "<a id='comment:5'></a>It would be good to test this on a machine with no `python` executable. I have a virtual machine for which I get failures in `calculus/riemann.pyx` with or without this branch: without this branch, I get numerical noise (which I always get with this virtual machine setup), and with this branch I get a segmentation fault instead. So it would be good to test on a more reliable machine.",
    "created_at": "2019-11-08T18:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557198",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>It would be good to test this on a machine with no `python` executable. I have a virtual machine for which I get failures in `calculus/riemann.pyx` with or without this branch: without this branch, I get numerical noise (which I always get with this virtual machine setup), and with this branch I get a segmentation fault instead. So it would be good to test on a more reliable machine.



---

archive/issue_comments_557199.json:
```json
{
    "body": "<a id='comment:6'></a>That's curious to say the least. I thought you needed a system python to start the sage build from scratch?\n\nAlso can you share the segfault? There may be interesting clues in there.",
    "created_at": "2019-11-08T19:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557199",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>That's curious to say the least. I thought you needed a system python to start the sage build from scratch?

Also can you share the segfault? There may be interesting clues in there.



---

archive/issue_comments_557200.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 fbissey]:\n> That's curious to say the least. I thought you needed a system python to start the sage build from scratch?\n\n\nNot with #28657. (There is a `python3` but no `python`.)\n \n> Also can you share the segfault? There may be interesting clues in there.\n\n\nIt's curious. If I do `./sage -t src/sage/calculus/riemann.pyx > TEST.log`, there is no segfault, but if I don't redirect output, there is. It looks like this:\n\n```\nsage -t --warn-long 55.3 src/sage/calculus/riemann.pyx\n    Killed due to segmentation fault\n**********************************************************************\nTests run before process (pid=2038) failed:\nsage: f(t) = e^(I*t) ## line 135 ##\nsage: fprime(t) = I*e^(I*t) ## line 136 ##\nsage: f(t) = e^(I*t) ## line 150 ##\nsage: fprime(t) = I*e^(I*t) ## line 151 ##\nsage: hf(t) = 0.5*e^(-I*t) ## line 152 ##\nsage: hfprime(t) = 0.5*-I*e^(-I*t) ## line 153 ##\nsage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I) ## line 154 ##\n------------------------------------------------------------------------\n/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9a64)[0x7f914669ba64]\n/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9b19)[0x7f914669bb19]\n/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xd57f)[0x7f914669f57f]\n/lib/x86_64-linux-gnu/libc.so.6(+0x46470)[0x7f9147bf2470]\n/home/john/Sage/sage-9.0.beta4/local/lib/libopenblas.so.0(zgemm_kernel_n+0x5467)[0x7f9144493467]\n------------------------------------------------------------------------\nAttaching gdb to process id 2038.\n...\n[snip]\n...\nSaved trace to /home/john/.sage/crash_logs/crash_ybgn81ga.log\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n```\nI'm attaching `/home/john/.sage/crash_logs/crash_ybgn81ga.log`.",
    "created_at": "2019-11-08T20:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557200",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>Replying to [comment:6 fbissey]:
> That's curious to say the least. I thought you needed a system python to start the sage build from scratch?


Not with #28657. (There is a `python3` but no `python`.)
 
> Also can you share the segfault? There may be interesting clues in there.


It's curious. If I do `./sage -t src/sage/calculus/riemann.pyx > TEST.log`, there is no segfault, but if I don't redirect output, there is. It looks like this:

```
sage -t --warn-long 55.3 src/sage/calculus/riemann.pyx
    Killed due to segmentation fault
**********************************************************************
Tests run before process (pid=2038) failed:
sage: f(t) = e^(I*t) ## line 135 ##
sage: fprime(t) = I*e^(I*t) ## line 136 ##
sage: f(t) = e^(I*t) ## line 150 ##
sage: fprime(t) = I*e^(I*t) ## line 151 ##
sage: hf(t) = 0.5*e^(-I*t) ## line 152 ##
sage: hfprime(t) = 0.5*-I*e^(-I*t) ## line 153 ##
sage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I) ## line 154 ##
------------------------------------------------------------------------
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9a64)[0x7f914669ba64]
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9b19)[0x7f914669bb19]
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xd57f)[0x7f914669f57f]
/lib/x86_64-linux-gnu/libc.so.6(+0x46470)[0x7f9147bf2470]
/home/john/Sage/sage-9.0.beta4/local/lib/libopenblas.so.0(zgemm_kernel_n+0x5467)[0x7f9144493467]
------------------------------------------------------------------------
Attaching gdb to process id 2038.
...
[snip]
...
Saved trace to /home/john/.sage/crash_logs/crash_ybgn81ga.log
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
```
I'm attaching `/home/john/.sage/crash_logs/crash_ybgn81ga.log`.



---

archive/issue_comments_557201.json:
```json
{
    "body": "Attachment [crash_ybgn81ga.log](tarball://root/attachments/some-uuid/ticket28709/crash_ybgn81ga.log) by @jhpalmieri created at 2019-11-08 20:19:40",
    "created_at": "2019-11-08T20:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557201",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [crash_ybgn81ga.log](tarball://root/attachments/some-uuid/ticket28709/crash_ybgn81ga.log) by @jhpalmieri created at 2019-11-08 20:19:40



---

archive/issue_comments_557202.json:
```json
{
    "body": "<a id='comment:8'></a>Needs rebasing with 9.0.beta5. Just when I was ready to test :(",
    "created_at": "2019-11-11T08:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557202",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Needs rebasing with 9.0.beta5. Just when I was ready to test :(



---

archive/issue_comments_557203.json:
```json
{
    "body": "<a id='comment:9'></a>The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.",
    "created_at": "2019-11-11T08:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557203",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.



---

archive/issue_comments_557204.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-11-11T17:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_557205.json:
```json
{
    "body": "Changing commit from \"b44e1b10664a18ce450540d449c544217c371db3\" to \"7dc58a487230087818ef5608d1e1726a40a879e2\"",
    "created_at": "2019-11-11T17:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b44e1b10664a18ce450540d449c544217c371db3" to "7dc58a487230087818ef5608d1e1726a40a879e2"



---

archive/issue_comments_557206.json:
```json
{
    "body": "<a id='comment:11'></a>Okay, rebased.",
    "created_at": "2019-11-11T17:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557206",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>Okay, rebased.



---

archive/issue_comments_557207.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:9 fbissey]:\n> The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.\n\n\nBy the way, on a virtual machine on a different computer, I don't see the segfault, just the usual numerical noise failures.",
    "created_at": "2019-11-11T20:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557207",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Replying to [comment:9 fbissey]:
> The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.


By the way, on a virtual machine on a different computer, I don't see the segfault, just the usual numerical noise failures.



---

archive/issue_comments_557208.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-12T01:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557208",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_557209.json:
```json
{
    "body": "<a id='comment:13'></a>Basic testing with python2 and python3 OK. I believe the segfault mentioned here is unrelated and may deserve wider scrutiny on sage-devel because it is definitely on the weirder side of things.",
    "created_at": "2019-11-12T01:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557209",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>Basic testing with python2 and python3 OK. I believe the segfault mentioned here is unrelated and may deserve wider scrutiny on sage-devel because it is definitely on the weirder side of things.



---

archive/issue_comments_557210.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2019-11-12T01:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557210",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_557211.json:
```json
{
    "body": "<a id='comment:14'></a>I agree it's weird, but since it's on a virtual machine that's a little flaky already, I don't know how seriously to take it.",
    "created_at": "2019-11-12T01:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557211",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>I agree it's weird, but since it's on a virtual machine that's a little flaky already, I don't know how seriously to take it.



---

archive/issue_comments_557212.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-16T20:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557212",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_557213.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/doctest-control-python\" to \"7dc58a487230087818ef5608d1e1726a40a879e2\"",
    "created_at": "2019-11-16T20:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-557213",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jhpalmieri/doctest-control-python" to "7dc58a487230087818ef5608d1e1726a40a879e2"



---

archive/issue_events_072372.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-16T20:15:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28709#event-72372"
}
```
