# Issue 28709: Python executable in doctest/control.py

archive/issues_028472.json:
```json
{
    "body": "We don't need to specify the Python executable as `sage-python` in `doctest/control.py`, and it's better for distros and in general to not do so.\n\nThis is a followup to #28657.\n\n\nCC:  @kiwifb\n\nBranch/Commit: [7dc58a487230087818ef5608d1e1726a40a879e2](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: John Palmieri\n\nDependencies: #28657\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28709\n\n",
    "closed_at": "2019-11-16T20:15:38Z",
    "created_at": "2019-11-08T18:37:59Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Python executable in doctest/control.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28709",
    "user": "https://github.com/jhpalmieri"
}
```
We don't need to specify the Python executable as `sage-python` in `doctest/control.py`, and it's better for distros and in general to not do so.

This is a followup to #28657.


CC:  @kiwifb

Branch/Commit: [7dc58a487230087818ef5608d1e1726a40a879e2](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)

Reviewer: François Bissey

Author: John Palmieri

Dependencies: #28657

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28709





---

archive/issue_comments_558384.json:
```json
{
    "body": "Branch: [u/jhpalmieri/doctest-control-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doctest-control-python)",
    "created_at": "2019-11-08T18:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558384",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: [u/jhpalmieri/doctest-control-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doctest-control-python)



---

archive/issue_comments_558385.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-08T18:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558385",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_558386.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[3ed0822](https://github.com/sagemath/sagetrac-mirror/commit/3ed0822a4425a385a73616e3a218add31309f303)|`trac 28657: build Sage when there is no 'python' present.`|\n|[831f51e](https://github.com/sagemath/sagetrac-mirror/commit/831f51e3dc395818ab3095d9e6a776bbc2886fad)|`trac 28657: use sage-python instead of sage-python23 when possible.`|\n|[84a042b](https://github.com/sagemath/sagetrac-mirror/commit/84a042b22ee860d6074f6168275c6abd3be5e82d)|`trac 28657: use sage-python or sage-system-python instead of sage-python23`|\n|[b44e1b1](https://github.com/sagemath/sagetrac-mirror/commit/b44e1b10664a18ce450540d449c544217c371db3)|`trac 28709: do not use \"sage-python\" in doctest/control.py`|",
    "created_at": "2019-11-08T18:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558386",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[3ed0822](https://github.com/sagemath/sagetrac-mirror/commit/3ed0822a4425a385a73616e3a218add31309f303)|`trac 28657: build Sage when there is no 'python' present.`|
|[831f51e](https://github.com/sagemath/sagetrac-mirror/commit/831f51e3dc395818ab3095d9e6a776bbc2886fad)|`trac 28657: use sage-python instead of sage-python23 when possible.`|
|[84a042b](https://github.com/sagemath/sagetrac-mirror/commit/84a042b22ee860d6074f6168275c6abd3be5e82d)|`trac 28657: use sage-python or sage-system-python instead of sage-python23`|
|[b44e1b1](https://github.com/sagemath/sagetrac-mirror/commit/b44e1b10664a18ce450540d449c544217c371db3)|`trac 28709: do not use "sage-python" in doctest/control.py`|



---

archive/issue_comments_558387.json:
```json
{
    "body": "Commit: [b44e1b10664a18ce450540d449c544217c371db3](https://github.com/sagemath/sagetrac-mirror/commit/b44e1b10664a18ce450540d449c544217c371db3)",
    "created_at": "2019-11-08T18:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558387",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: [b44e1b10664a18ce450540d449c544217c371db3](https://github.com/sagemath/sagetrac-mirror/commit/b44e1b10664a18ce450540d449c544217c371db3)



---

archive/issue_comments_558388.json:
```json
{
    "body": "Dependencies: #28657",
    "created_at": "2019-11-08T18:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558388",
    "user": "https://github.com/jhpalmieri"
}
```

Dependencies: #28657



---

archive/issue_comments_558389.json:
```json
{
    "body": "<a id='comment:4'></a>\nI was intending to do that. Nevermind, I am happy you think the idea is worthwhile.",
    "created_at": "2019-11-08T18:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558389",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
I was intending to do that. Nevermind, I am happy you think the idea is worthwhile.



---

archive/issue_comments_558390.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt would be good to test this on a machine with no `python` executable. I have a virtual machine for which I get failures in `calculus/riemann.pyx` with or without this branch: without this branch, I get numerical noise (which I always get with this virtual machine setup), and with this branch I get a segmentation fault instead. So it would be good to test on a more reliable machine.",
    "created_at": "2019-11-08T18:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558390",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
It would be good to test this on a machine with no `python` executable. I have a virtual machine for which I get failures in `calculus/riemann.pyx` with or without this branch: without this branch, I get numerical noise (which I always get with this virtual machine setup), and with this branch I get a segmentation fault instead. So it would be good to test on a more reliable machine.



---

archive/issue_comments_558391.json:
```json
{
    "body": "<a id='comment:6'></a>\nThat's curious to say the least. I thought you needed a system python to start the sage build from scratch?\n\nAlso can you share the segfault? There may be interesting clues in there.",
    "created_at": "2019-11-08T19:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558391",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
That's curious to say the least. I thought you needed a system python to start the sage build from scratch?

Also can you share the segfault? There may be interesting clues in there.



---

archive/issue_comments_558392.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [fbissey](#comment%3A6):\n> That's curious to say the least. I thought you needed a system python to start the sage build from scratch?\n\n\nNot with #28657. (There is a `python3` but no `python`.)\n \n> Also can you share the segfault? There may be interesting clues in there.\n\n\nIt's curious. If I do `./sage -t src/sage/calculus/riemann.pyx > TEST.log`, there is no segfault, but if I don't redirect output, there is. It looks like this:\n\n```\nsage -t --warn-long 55.3 src/sage/calculus/riemann.pyx\n    Killed due to segmentation fault\n**********************************************************************\nTests run before process (pid=2038) failed:\nsage: f(t) = e^(I*t) ## line 135 ##\nsage: fprime(t) = I*e^(I*t) ## line 136 ##\nsage: f(t) = e^(I*t) ## line 150 ##\nsage: fprime(t) = I*e^(I*t) ## line 151 ##\nsage: hf(t) = 0.5*e^(-I*t) ## line 152 ##\nsage: hfprime(t) = 0.5*-I*e^(-I*t) ## line 153 ##\nsage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I) ## line 154 ##\n------------------------------------------------------------------------\n/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9a64)[0x7f914669ba64]\n/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9b19)[0x7f914669bb19]\n/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xd57f)[0x7f914669f57f]\n/lib/x86_64-linux-gnu/libc.so.6(+0x46470)[0x7f9147bf2470]\n/home/john/Sage/sage-9.0.beta4/local/lib/libopenblas.so.0(zgemm_kernel_n+0x5467)[0x7f9144493467]\n------------------------------------------------------------------------\nAttaching gdb to process id 2038.\n...\n[snip]\n...\nSaved trace to /home/john/.sage/crash_logs/crash_ybgn81ga.log\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n```\nI'm attaching `/home/john/.sage/crash_logs/crash_ybgn81ga.log`.",
    "created_at": "2019-11-08T20:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558392",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Replying to [fbissey](#comment%3A6):
> That's curious to say the least. I thought you needed a system python to start the sage build from scratch?


Not with #28657. (There is a `python3` but no `python`.)
 
> Also can you share the segfault? There may be interesting clues in there.


It's curious. If I do `./sage -t src/sage/calculus/riemann.pyx > TEST.log`, there is no segfault, but if I don't redirect output, there is. It looks like this:

```
sage -t --warn-long 55.3 src/sage/calculus/riemann.pyx
    Killed due to segmentation fault
**********************************************************************
Tests run before process (pid=2038) failed:
sage: f(t) = e^(I*t) ## line 135 ##
sage: fprime(t) = I*e^(I*t) ## line 136 ##
sage: f(t) = e^(I*t) ## line 150 ##
sage: fprime(t) = I*e^(I*t) ## line 151 ##
sage: hf(t) = 0.5*e^(-I*t) ## line 152 ##
sage: hfprime(t) = 0.5*-I*e^(-I*t) ## line 153 ##
sage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I) ## line 154 ##
------------------------------------------------------------------------
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9a64)[0x7f914669ba64]
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9b19)[0x7f914669bb19]
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xd57f)[0x7f914669f57f]
/lib/x86_64-linux-gnu/libc.so.6(+0x46470)[0x7f9147bf2470]
/home/john/Sage/sage-9.0.beta4/local/lib/libopenblas.so.0(zgemm_kernel_n+0x5467)[0x7f9144493467]
------------------------------------------------------------------------
Attaching gdb to process id 2038.
...
[snip]
...
Saved trace to /home/john/.sage/crash_logs/crash_ybgn81ga.log
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
```
I'm attaching `/home/john/.sage/crash_logs/crash_ybgn81ga.log`.



---

archive/issue_comments_558393.json:
```json
{
    "body": "Attachment [crash_ybgn81ga.log](tarball://root/attachments/some-uuid/ticket28709/crash_ybgn81ga.log) by @jhpalmieri created at 2019-11-08 20:19:40",
    "created_at": "2019-11-08T20:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558393",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [crash_ybgn81ga.log](tarball://root/attachments/some-uuid/ticket28709/crash_ybgn81ga.log) by @jhpalmieri created at 2019-11-08 20:19:40



---

archive/issue_comments_558394.json:
```json
{
    "body": "<a id='comment:8'></a>\nNeeds rebasing with 9.0.beta5. Just when I was ready to test :(",
    "created_at": "2019-11-11T08:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558394",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Needs rebasing with 9.0.beta5. Just when I was ready to test :(



---

archive/issue_comments_558395.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.",
    "created_at": "2019-11-11T08:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558395",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.



---

archive/issue_comments_558396.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[7dc58a4](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)|`trac 28709: do not use \"sage-python\" in doctest/control.py`|",
    "created_at": "2019-11-11T17:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[7dc58a4](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)|`trac 28709: do not use "sage-python" in doctest/control.py`|



---

archive/issue_comments_558397.json:
```json
{
    "body": "Changing commit from \"[b44e1b10664a18ce450540d449c544217c371db3](https://github.com/sagemath/sagetrac-mirror/commit/b44e1b10664a18ce450540d449c544217c371db3)\" to \"[7dc58a487230087818ef5608d1e1726a40a879e2](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)\"",
    "created_at": "2019-11-11T17:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[b44e1b10664a18ce450540d449c544217c371db3](https://github.com/sagemath/sagetrac-mirror/commit/b44e1b10664a18ce450540d449c544217c371db3)" to "[7dc58a487230087818ef5608d1e1726a40a879e2](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)"



---

archive/issue_comments_558398.json:
```json
{
    "body": "<a id='comment:11'></a>\nOkay, rebased.",
    "created_at": "2019-11-11T17:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558398",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Okay, rebased.



---

archive/issue_comments_558399.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [fbissey](#comment%3A9):\n> The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.\n\n\nBy the way, on a virtual machine on a different computer, I don't see the segfault, just the usual numerical noise failures.",
    "created_at": "2019-11-11T20:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558399",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [fbissey](#comment%3A9):
> The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.


By the way, on a virtual machine on a different computer, I don't see the segfault, just the usual numerical noise failures.



---

archive/issue_comments_558400.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-12T01:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558400",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_558401.json:
```json
{
    "body": "<a id='comment:13'></a>\nBasic testing with python2 and python3 OK. I believe the segfault mentioned here is unrelated and may deserve wider scrutiny on sage-devel because it is definitely on the weirder side of things.",
    "created_at": "2019-11-12T01:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558401",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Basic testing with python2 and python3 OK. I believe the segfault mentioned here is unrelated and may deserve wider scrutiny on sage-devel because it is definitely on the weirder side of things.



---

archive/issue_comments_558402.json:
```json
{
    "body": "Reviewer: Fran\u00e7ois Bissey",
    "created_at": "2019-11-12T01:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558402",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: François Bissey



---

archive/issue_comments_558403.json:
```json
{
    "body": "<a id='comment:14'></a>\nI agree it's weird, but since it's on a virtual machine that's a little flaky already, I don't know how seriously to take it.",
    "created_at": "2019-11-12T01:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558403",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I agree it's weird, but since it's on a virtual machine that's a little flaky already, I don't know how seriously to take it.



---

archive/issue_comments_558404.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-16T20:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558404",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_558405.json:
```json
{
    "body": "Changing branch from \"[u/jhpalmieri/doctest-control-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doctest-control-python)\" to \"[7dc58a487230087818ef5608d1e1726a40a879e2](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)\"",
    "created_at": "2019-11-16T20:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28709#issuecomment-558405",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/jhpalmieri/doctest-control-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doctest-control-python)" to "[7dc58a487230087818ef5608d1e1726a40a879e2](https://github.com/sagemath/sagetrac-mirror/commit/7dc58a487230087818ef5608d1e1726a40a879e2)"



---

archive/issue_events_081770.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-16T20:15:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28709",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28709#event-81770"
}
```
