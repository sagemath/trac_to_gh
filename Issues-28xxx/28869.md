# Issue 28869: Isomorphisms of absolute fields can not be used in change_ring

archive/issues_028632.json:
```json
{
    "body": "For a polynomial `f` defined over a number field `K`, when replacing `K` by its absolute field `L = K.absolute_field(names='b')` there might be an error when changing `f` with the appropriate isomorphism `f.change_ring(L.structure()[1])`.\n\nThe problem arises from the fact that `change_ring` wants to check whether the isomorphism is part of `K.Hom(L)` by calling `K.Hom(L)(L.structure()[1])` which gives an error if `L.structure()[1]` is not an instance of `NumberFieldHomomorphism_im_gens` which it not necessarily is. Here is a minimal working example\n\n```\nsage: K.<a> = CyclotomicField(8)\nsage: L.<b> = K.absolute_field()\nsage: phi = L.structure()[1]\nsage: phi.parent() == K.Hom(L)\nTrue\nsage: K.Hom(L)(phi)\nTraceback (most recent call last):\n...\nTypeError: unable to convert Isomorphism given by variable name change map:\n  From: Cyclotomic Field of order 8 and degree 4\n  To:   Number Field in b with defining polynomial x^4 + 1 to an element of Number Field in b with defining polynomial x^4 + 1\n```\n\nThe error seems a consequence of a call to `K.Hom(L)` interpreting the argument as an element of the codomain if it is not an instance of `NumberFieldHomomorphism_im_gens`.\n\nHere is the example failing on `change_ring` where the error message is even less insightful\n\n```\nsage: K.<a> = CyclotomicField(8)\nsage: L.<b> = K.absolute_field()\nsage: R.<x> = K[]\nsage: f = x^2 + a\nsage: f.change_ring(L.structure()[1])\nTraceback (most recent call last):\n...\nTypeError: \n```\n \n\nKeywords: absolute field, coercion\n\nBranch/Commit: 5939e9853b533587a9a93d0e94c8a22e6c9c727b\n\nReviewer: Travis Scrimshaw\n\nAuthor: Peter Bruin\n\nDependencies: #29008, #29010\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28869\n\n",
    "closed_at": "2020-01-31T23:49:43Z",
    "created_at": "2019-12-10T13:36:34Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Isomorphisms of absolute fields can not be used in change_ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28869",
    "user": "https://trac.sagemath.org/admin/accounts/users/jvlangen"
}
```
For a polynomial `f` defined over a number field `K`, when replacing `K` by its absolute field `L = K.absolute_field(names='b')` there might be an error when changing `f` with the appropriate isomorphism `f.change_ring(L.structure()[1])`.

The problem arises from the fact that `change_ring` wants to check whether the isomorphism is part of `K.Hom(L)` by calling `K.Hom(L)(L.structure()[1])` which gives an error if `L.structure()[1]` is not an instance of `NumberFieldHomomorphism_im_gens` which it not necessarily is. Here is a minimal working example

```
sage: K.<a> = CyclotomicField(8)
sage: L.<b> = K.absolute_field()
sage: phi = L.structure()[1]
sage: phi.parent() == K.Hom(L)
True
sage: K.Hom(L)(phi)
Traceback (most recent call last):
...
TypeError: unable to convert Isomorphism given by variable name change map:
  From: Cyclotomic Field of order 8 and degree 4
  To:   Number Field in b with defining polynomial x^4 + 1 to an element of Number Field in b with defining polynomial x^4 + 1
```

The error seems a consequence of a call to `K.Hom(L)` interpreting the argument as an element of the codomain if it is not an instance of `NumberFieldHomomorphism_im_gens`.

Here is the example failing on `change_ring` where the error message is even less insightful

```
sage: K.<a> = CyclotomicField(8)
sage: L.<b> = K.absolute_field()
sage: R.<x> = K[]
sage: f = x^2 + a
sage: f.change_ring(L.structure()[1])
Traceback (most recent call last):
...
TypeError: 
```
 

Keywords: absolute field, coercion

Branch/Commit: 5939e9853b533587a9a93d0e94c8a22e6c9c727b

Reviewer: Travis Scrimshaw

Author: Peter Bruin

Dependencies: #29008, #29010

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28869





---

archive/issue_comments_561748.json:
```json
{
    "body": "<a id='comment:1'></a>\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561748",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_082444.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28869#event-82444"
}
```



---

archive/issue_comments_561749.json:
```json
{
    "body": "<a id='comment:2'></a>\nOne way to solve this is by moving ring homsets to the new coercion model; among other things, when doing `R.Hom(S)(f)`, this will check if `f` already has `R.Hom(S)` as its parent without checking the exact type.  I am working on this.",
    "created_at": "2020-01-14T08:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561749",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:2'></a>
One way to solve this is by moving ring homsets to the new coercion model; among other things, when doing `R.Hom(S)(f)`, this will check if `f` already has `R.Hom(S)` as its parent without checking the exact type.  I am working on this.



---

archive/issue_comments_561750.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29008\"",
    "created_at": "2020-01-14T11:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561750",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#29008"



---

archive/issue_comments_561751.json:
```json
{
    "body": "Changing dependencies from \"#29008\" to \"#29008, #29010\"",
    "created_at": "2020-01-14T14:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561751",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "#29008" to "#29008, #29010"



---

archive/issue_comments_561752.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/28869-NumberFieldHomset_coercion\"",
    "created_at": "2020-01-14T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561752",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/28869-NumberFieldHomset_coercion"



---

archive/issue_comments_561753.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Bruin\"",
    "created_at": "2020-01-14T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561753",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "" to "Peter Bruin"



---

archive/issue_comments_561754.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-14T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561754",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_561755.json:
```json
{
    "body": "Changing commit from \"\" to \"4470ebf8e0971998a39d67bb305d0c0f0985b2f5\"",
    "created_at": "2020-01-14T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561755",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "4470ebf8e0971998a39d67bb305d0c0f0985b2f5"



---

archive/issue_comments_561756.json:
```json
{
    "body": "Changing commit from \"4470ebf8e0971998a39d67bb305d0c0f0985b2f5\" to \"8c010d73b485892449ed4c36c9036f86d30a4f17\"",
    "created_at": "2020-01-17T09:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4470ebf8e0971998a39d67bb305d0c0f0985b2f5" to "8c010d73b485892449ed4c36c9036f86d30a4f17"



---

archive/issue_comments_561757.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[8c010d7](https://github.com/sagemath/sagetrac-mirror/commit/8c010d73b485892449ed4c36c9036f86d30a4f17)|`Trac 28869: add more doctests`|",
    "created_at": "2020-01-17T09:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[8c010d7](https://github.com/sagemath/sagetrac-mirror/commit/8c010d73b485892449ed4c36c9036f86d30a4f17)|`Trac 28869: add more doctests`|



---

archive/issue_comments_561758.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe last commit modifies/adds doctests to cover all `NumberFieldHomset` classes (absolute fields, relative fields and cyclotomic fields).",
    "created_at": "2020-01-17T09:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561758",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
The last commit modifies/adds doctests to cover all `NumberFieldHomset` classes (absolute fields, relative fields and cyclotomic fields).



---

archive/issue_comments_561759.json:
```json
{
    "body": "Changing commit from \"8c010d73b485892449ed4c36c9036f86d30a4f17\" to \"5939e9853b533587a9a93d0e94c8a22e6c9c727b\"",
    "created_at": "2020-01-17T22:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c010d73b485892449ed4c36c9036f86d30a4f17" to "5939e9853b533587a9a93d0e94c8a22e6c9c727b"



---

archive/issue_comments_561760.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|\n|[5939e98](https://github.com/sagemath/sagetrac-mirror/commit/5939e9853b533587a9a93d0e94c8a22e6c9c727b)|`Trac 28869: make _element_constructor_() always return an instance of element_class`|",
    "created_at": "2020-01-17T22:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
|[5939e98](https://github.com/sagemath/sagetrac-mirror/commit/5939e9853b533587a9a93d0e94c8a22e6c9c727b)|`Trac 28869: make _element_constructor_() always return an instance of element_class`|



---

archive/issue_comments_561761.json:
```json
{
    "body": "<a id='comment:9'></a>\nLGTM.",
    "created_at": "2020-01-29T06:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561761",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
LGTM.



---

archive/issue_comments_561762.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-01-29T06:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561762",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_561763.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-29T06:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561763",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_082445.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28869#event-82445"
}
```



---

archive/issue_comments_561764.json:
```json
{
    "body": "Changing branch from \"u/pbruin/28869-NumberFieldHomset_coercion\" to \"5939e9853b533587a9a93d0e94c8a22e6c9c727b\"",
    "created_at": "2020-01-31T23:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561764",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/28869-NumberFieldHomset_coercion" to "5939e9853b533587a9a93d0e94c8a22e6c9c727b"



---

archive/issue_comments_561765.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-31T23:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28869#issuecomment-561765",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
