# Issue 28242: spkg-configure.m4 for pari

archive/issues_028005.json:
```json
{
    "assignees": [],
    "body": "libpari-gmp is a dependency of many packages, so it's important to be able to use the one from the system.\n\nWe check that system's PARI/GP environment is close enough to what we would install in Sage (i.e. versions of GP and libpari, and that they share the datadir). Also, PARI packages need to be checked.\n\nCC:  @embray @kiwifb @isuruf @timokau @antonio-rojas\n\nComponent: **build: configure**\n\nAuthor: **Dima Pasechnik**\n\nBranch: **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)**\n\nReviewer: **Isuru Fernando**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28242_\n\n",
    "closed_at": "2019-08-11T16:44:02Z",
    "created_at": "2019-07-23T19:06:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "spkg-configure.m4 for pari",
    "type": "issue",
    "updated_at": "2020-04-28T01:50:05Z",
    "url": "https://github.com/sagemath/sage/issues/28242",
    "user": "https://github.com/dimpase"
}
```
libpari-gmp is a dependency of many packages, so it's important to be able to use the one from the system.

We check that system's PARI/GP environment is close enough to what we would install in Sage (i.e. versions of GP and libpari, and that they share the datadir). Also, PARI packages need to be checked.

CC:  @embray @kiwifb @isuruf @timokau @antonio-rojas

Component: **build: configure**

Author: **Dima Pasechnik**

Branch: **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)**

Reviewer: **Isuru Fernando**

_Issue created by migration from https://trac.sagemath.org/ticket/28242_





---

archive/issue_events_384484.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-23T19:06:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384484"
}
```



---

archive/issue_events_384485.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-23T19:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384485"
}
```



---

archive/issue_events_384486.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-23T19:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384486"
}
```



---

archive/issue_events_384487.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-23T19:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384487"
}
```



---

archive/issue_events_384488.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-23T19:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384488"
}
```



---

archive/issue_comments_439973.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nwe should use sample GP commands to test for packages, as in https://pari.math.u-bordeaux.fr/packages.html:\n\n```\n  ellinit(\"11a1\")     /* package: elldata */\n  galoisgetpol(8)     /* package: galpol */\n  galoisgetname(12,1) /* package: galpol 4.0 and up */\n  ellmodulareqn(11)   /* package: seadata */\n  polgalois(x^8-2)    /* package: galdata */\n```\n\nif only the small version of `seadata` is installed, `ellmodulareqn(211)` produces an error (it does work with the \"normal\" `seadata` version).\n\n\nneed to figure out how to test for `nftables`.",
    "created_at": "2019-07-31T08:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439973",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

we should use sample GP commands to test for packages, as in https://pari.math.u-bordeaux.fr/packages.html:

```
  ellinit("11a1")     /* package: elldata */
  galoisgetpol(8)     /* package: galpol */
  galoisgetname(12,1) /* package: galpol 4.0 and up */
  ellmodulareqn(11)   /* package: seadata */
  polgalois(x^8-2)    /* package: galdata */
```

if only the small version of `seadata` is installed, `ellmodulareqn(211)` produces an error (it does work with the "normal" `seadata` version).


need to figure out how to test for `nftables`.



---

archive/issue_comments_439974.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe following may be used to test whether libpari knows about `galdata`\n(Basically, obtained by editing the output of `gp2c` run on `polygalois(x^8-2)[1]`).\n\n```C\n#include <pari/pari.h>  /* cc t.c -lpari && ./a.out */\nGEN t_t(long prec)\n{\n  GEN x = pol_x(fetch_user_var(\"x\"));\n  return gel(polgalois(gsubgs(gpowgs(x, 8), 2), prec), 1);\n}\n\nint main() \n{\nGEN r;\npari_init(5000000, 0);\nr=t_t(100);\npari_printf(\"group order=%P4d\\n\", r); /* should be 16 */\npari_close();\nreturn 0;\n}\n```",
    "created_at": "2019-07-31T15:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439974",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

The following may be used to test whether libpari knows about `galdata`
(Basically, obtained by editing the output of `gp2c` run on `polygalois(x^8-2)[1]`).

```C
#include <pari/pari.h>  /* cc t.c -lpari && ./a.out */
GEN t_t(long prec)
{
  GEN x = pol_x(fetch_user_var("x"));
  return gel(polgalois(gsubgs(gpowgs(x, 8), 2), prec), 1);
}

int main() 
{
GEN r;
pari_init(5000000, 0);
r=t_t(100);
pari_printf("group order=%P4d\n", r); /* should be 16 */
pari_close();
return 0;
}
```



---

archive/issue_comments_439975.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n libpari-gmp is a dependency of many packages, so it's important to be able to use the one from the system.\n+\n+We check that system's PARI/GP environment is close enough to what we would install in Sage (i.e. versions of GP and libpari, and that they share the datadir). Also, PARI packages need to be checked.\n``````\n",
    "created_at": "2019-08-02T08:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439975",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 libpari-gmp is a dependency of many packages, so it's important to be able to use the one from the system.
+
+We check that system's PARI/GP environment is close enough to what we would install in Sage (i.e. versions of GP and libpari, and that they share the datadir). Also, PARI packages need to be checked.
``````




---

archive/issue_comments_439976.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/pariconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/pariconfig)**",
    "created_at": "2019-08-02T08:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439976",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/pariconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/pariconfig)**



---

archive/issue_comments_439977.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83d26e536c4d8e0f75e50a0c22e5d3c736e3aef8\"><code>83d26e5</code></a></td><td><code>spkg-configure for pari</code></td></tr></table>\n",
    "created_at": "2019-08-02T08:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439977",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83d26e536c4d8e0f75e50a0c22e5d3c736e3aef8"><code>83d26e5</code></a></td><td><code>spkg-configure for pari</code></td></tr></table>




---

archive/issue_comments_439978.json:
```json
{
    "body": "Commit: **[`83d26e5`](https://github.com/sagemath/sagetrac-mirror/commit/83d26e536c4d8e0f75e50a0c22e5d3c736e3aef8)**",
    "created_at": "2019-08-02T08:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439978",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`83d26e5`](https://github.com/sagemath/sagetrac-mirror/commit/83d26e536c4d8e0f75e50a0c22e5d3c736e3aef8)**



---

archive/issue_comments_439979.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-08-02T08:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439979",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_439980.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis is still WIP, more to be done here.",
    "created_at": "2019-08-02T08:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439980",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

This is still WIP, more to be done here.



---

archive/issue_comments_439981.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4088bfc501fd010be1b23dc6e9ec2916a2f73c30\"><code>4088bfc</code></a></td><td><code>spkg-configure for pari</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/712fb952c1bee5fefe3ec98781d397f9ecbbb837\"><code>712fb95</code></a></td><td><code>spkg-configure for pari_elldata</code></td></tr></table>\n",
    "created_at": "2019-08-02T20:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439981",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4088bfc501fd010be1b23dc6e9ec2916a2f73c30"><code>4088bfc</code></a></td><td><code>spkg-configure for pari</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/712fb952c1bee5fefe3ec98781d397f9ecbbb837"><code>712fb95</code></a></td><td><code>spkg-configure for pari_elldata</code></td></tr></table>




---

archive/issue_comments_439982.json:
```json
{
    "body": "Changed commit from **[`83d26e5`](https://github.com/sagemath/sagetrac-mirror/commit/83d26e536c4d8e0f75e50a0c22e5d3c736e3aef8)** to **[`712fb95`](https://github.com/sagemath/sagetrac-mirror/commit/712fb952c1bee5fefe3ec98781d397f9ecbbb837)**",
    "created_at": "2019-08-02T20:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439982",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`83d26e5`](https://github.com/sagemath/sagetrac-mirror/commit/83d26e536c4d8e0f75e50a0c22e5d3c736e3aef8)** to **[`712fb95`](https://github.com/sagemath/sagetrac-mirror/commit/712fb952c1bee5fefe3ec98781d397f9ecbbb837)**



---

archive/issue_comments_439983.json:
```json
{
    "body": "Changed commit from **[`712fb95`](https://github.com/sagemath/sagetrac-mirror/commit/712fb952c1bee5fefe3ec98781d397f9ecbbb837)** to **[`2e11aed`](https://github.com/sagemath/sagetrac-mirror/commit/2e11aed9dfd4572b0185c727509fb31b765a95d2)**",
    "created_at": "2019-08-03T22:01:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439983",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`712fb95`](https://github.com/sagemath/sagetrac-mirror/commit/712fb952c1bee5fefe3ec98781d397f9ecbbb837)** to **[`2e11aed`](https://github.com/sagemath/sagetrac-mirror/commit/2e11aed9dfd4572b0185c727509fb31b765a95d2)**



---

archive/issue_comments_439984.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f45c9e04487d7f962ade1ab596fc00ea201833c\"><code>2f45c9e</code></a></td><td><code>spkg-configure for pari</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b622942d9e72ecbf5c863b46a1bac0d60c163c28\"><code>b622942</code></a></td><td><code>spkg-configure for pari_elldata</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e11aed9dfd4572b0185c727509fb31b765a95d2\"><code>2e11aed</code></a></td><td><code>spkg-configure's for PARI packages</code></td></tr></table>\n",
    "created_at": "2019-08-03T22:01:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439984",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f45c9e04487d7f962ade1ab596fc00ea201833c"><code>2f45c9e</code></a></td><td><code>spkg-configure for pari</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b622942d9e72ecbf5c863b46a1bac0d60c163c28"><code>b622942</code></a></td><td><code>spkg-configure for pari_elldata</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e11aed9dfd4572b0185c727509fb31b765a95d2"><code>2e11aed</code></a></td><td><code>spkg-configure's for PARI packages</code></td></tr></table>




---

archive/issue_comments_439985.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nstill needed to sort out dependencies properly, and provide spkg-configure.m4 for gp2c.\n\nFor installing gp2c, one must provide pari.cfg location, something that it's not really discoverable. (save for `find / -name pari.cfg` :-))",
    "created_at": "2019-08-03T22:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439985",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

still needed to sort out dependencies properly, and provide spkg-configure.m4 for gp2c.

For installing gp2c, one must provide pari.cfg location, something that it's not really discoverable. (save for `find / -name pari.cfg` :-))



---

archive/issue_comments_439986.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIt seems that all the PARI package \"deps\" should be checked within spkg-configure of PARI itself (as PARI does not provide means to install extra packages, we need to disable system PARI lacking these packages). -- the branch does not yet implement this.\n\nAnd not only standard packages pari_galdata and\npari_seadata_small, but also the optional packages pari_elldata, \npari_galpol, and pari_seadata.\n\nThe optional package pari_nftables is clearly an afterthought (not used anywhere in sagelib, too), and I don't want to rule out an otherwise OK installation of PARI/GP, is it is missing (e.g. Debian doesn't even ship it, although Fedora does ship it; not sure about Conda and Gentoo).\n\npari_jupyter should be installable regardless.\n\ngp2c only needs the correct location of `pari.cfg`, and while it's a pain to find it, it is doable in some ad hoc way. I wonder what Conda does does with gp2c, and where it places `pari.cfg`.",
    "created_at": "2019-08-04T09:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439986",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

It seems that all the PARI package "deps" should be checked within spkg-configure of PARI itself (as PARI does not provide means to install extra packages, we need to disable system PARI lacking these packages). -- the branch does not yet implement this.

And not only standard packages pari_galdata and
pari_seadata_small, but also the optional packages pari_elldata, 
pari_galpol, and pari_seadata.

The optional package pari_nftables is clearly an afterthought (not used anywhere in sagelib, too), and I don't want to rule out an otherwise OK installation of PARI/GP, is it is missing (e.g. Debian doesn't even ship it, although Fedora does ship it; not sure about Conda and Gentoo).

pari_jupyter should be installable regardless.

gp2c only needs the correct location of `pari.cfg`, and while it's a pain to find it, it is doable in some ad hoc way. I wonder what Conda does does with gp2c, and where it places `pari.cfg`.



---

archive/issue_comments_439987.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nDistros have a bone to pick with the data packages from pari. That may be why some distro decided not to bother. There are ways to install the stuff manually if you want too.\n\nUpstream is committing the cardinal sin of not versioning their data packages. The tarball is always called exactly the same - even when the content is changed. You understand that's a bit of a problem for automated build scripts that rely on a stored checksum to verify that the package is authentic.\n\nFor info, I had the stuff packaged in Gentoo and I recently updated it.",
    "created_at": "2019-08-04T09:39:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439987",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

Distros have a bone to pick with the data packages from pari. That may be why some distro decided not to bother. There are ways to install the stuff manually if you want too.

Upstream is committing the cardinal sin of not versioning their data packages. The tarball is always called exactly the same - even when the content is changed. You understand that's a bit of a problem for automated build scripts that rely on a stored checksum to verify that the package is authentic.

For info, I had the stuff packaged in Gentoo and I recently updated it.



---

archive/issue_comments_439988.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI'm trying to convince the upstream to make configuration info for libpari discoverable.\nE.g. there is no way to get the location of `pari.cfg` from `gp`. I'm thinking of getting its location from the full path to `libpari.so`, I see no other good way...",
    "created_at": "2019-08-04T09:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439988",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

I'm trying to convince the upstream to make configuration info for libpari discoverable.
E.g. there is no way to get the location of `pari.cfg` from `gp`. I'm thinking of getting its location from the full path to `libpari.so`, I see no other good way...



---

archive/issue_comments_439989.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n`pari.cfg` is installed in something called `sysdatadir` at configure time. I don't know if it is possible to get that variable at runtime (without knowing `pari.cfg` already that is).",
    "created_at": "2019-08-04T10:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439989",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

`pari.cfg` is installed in something called `sysdatadir` at configure time. I don't know if it is possible to get that variable at runtime (without knowing `pari.cfg` already that is).



---

archive/issue_comments_439990.json:
```json
{
    "body": "Changed commit from **[`2e11aed`](https://github.com/sagemath/sagetrac-mirror/commit/2e11aed9dfd4572b0185c727509fb31b765a95d2)** to **[`183f47c`](https://github.com/sagemath/sagetrac-mirror/commit/183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5)**",
    "created_at": "2019-08-04T10:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439990",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2e11aed`](https://github.com/sagemath/sagetrac-mirror/commit/2e11aed9dfd4572b0185c727509fb31b765a95d2)** to **[`183f47c`](https://github.com/sagemath/sagetrac-mirror/commit/183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5)**



---

archive/issue_comments_439991.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5\"><code>183f47c</code></a></td><td><code>check for PARI packages in PARI's spkg-configure</code></td></tr></table>\n",
    "created_at": "2019-08-04T10:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439991",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5"><code>183f47c</code></a></td><td><code>check for PARI packages in PARI's spkg-configure</code></td></tr></table>




---

archive/issue_comments_439992.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee\"><code>72f3c20</code></a></td><td><code>spkg-configure for gp2c</code></td></tr></table>\n",
    "created_at": "2019-08-04T19:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439992",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee"><code>72f3c20</code></a></td><td><code>spkg-configure for gp2c</code></td></tr></table>




---

archive/issue_comments_439993.json:
```json
{
    "body": "Changed commit from **[`183f47c`](https://github.com/sagemath/sagetrac-mirror/commit/183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5)** to **[`72f3c20`](https://github.com/sagemath/sagetrac-mirror/commit/72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee)**",
    "created_at": "2019-08-04T19:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439993",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`183f47c`](https://github.com/sagemath/sagetrac-mirror/commit/183f47c23e5b8a3f1acdf37b9c2c37f8cd337ee5)** to **[`72f3c20`](https://github.com/sagemath/sagetrac-mirror/commit/72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee)**



---

archive/issue_comments_439994.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment%3A8):\n> And not only standard packages pari_galdata and\n> pari_seadata_small, but also the optional packages pari_elldata, \n> pari_galpol, and pari_seadata.\n\nIs there a way to avoid checking for the optional packages? Maybe build PARI from SPKG if the optional package is not found, but requested.\n\n> \n> The optional package pari_nftables is clearly an afterthought (not used anywhere in sagelib, too), and I don't want to rule out an otherwise OK installation of PARI/GP, is it is missing (e.g. Debian doesn't even ship it, although Fedora does ship it; not sure about Conda and Gentoo).\n\nI just packaged all the optional PARI database packages on conda including nftables.\n\n> \n> pari_jupyter should be installable regardless.\n> \n> gp2c only needs the correct location of `pari.cfg`, and while it's a pain to find it, it is doable in some ad hoc way. I wonder what Conda does does with gp2c, and where it places `pari.cfg`.\n> \n\nConda puts it into `<prefix>/lib/pari/pari.cfg`. We don't package `gp2c` yet.",
    "created_at": "2019-08-04T23:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439994",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment%3A8):
> And not only standard packages pari_galdata and
> pari_seadata_small, but also the optional packages pari_elldata, 
> pari_galpol, and pari_seadata.

Is there a way to avoid checking for the optional packages? Maybe build PARI from SPKG if the optional package is not found, but requested.

> 
> The optional package pari_nftables is clearly an afterthought (not used anywhere in sagelib, too), and I don't want to rule out an otherwise OK installation of PARI/GP, is it is missing (e.g. Debian doesn't even ship it, although Fedora does ship it; not sure about Conda and Gentoo).

I just packaged all the optional PARI database packages on conda including nftables.

> 
> pari_jupyter should be installable regardless.
> 
> gp2c only needs the correct location of `pari.cfg`, and while it's a pain to find it, it is doable in some ad hoc way. I wonder what Conda does does with gp2c, and where it places `pari.cfg`.
> 

Conda puts it into `<prefix>/lib/pari/pari.cfg`. We don't package `gp2c` yet.



---

archive/issue_comments_439995.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSomeone put `pari.cfg` in a unhelpful location in Gentoo. In fact it broke my ebuild of `gp2c`. I don't know for how long but no one ever complained so I don't think there are many users for that program. Fixed in sage-on-gentoo's pari (2.11.1 and 2.11.2). Current sage-on-gentoo location is `${EPREFIX}/usr/share/pari/pari.cfg`.",
    "created_at": "2019-08-05T00:32:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439995",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">comment:15</div>

Someone put `pari.cfg` in a unhelpful location in Gentoo. In fact it broke my ebuild of `gp2c`. I don't know for how long but no one ever complained so I don't think there are many users for that program. Fixed in sage-on-gentoo's pari (2.11.1 and 2.11.2). Current sage-on-gentoo location is `${EPREFIX}/usr/share/pari/pari.cfg`.



---

archive/issue_comments_439996.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nby the way, it seems that cypari needs either a patch or an amendend\n`spkg-install` script. With the branch on this ticket, its installation fails with \n\n```\nInstalling cypari-2.1.1\nInstalling package cypari2 using pip2\nIgnoring indexes: https://pypi.org/simple\nCreated temporary directory: /tmp/pip-ephem-wheel-cache-Nyv_mU\nCreated temporary directory: /tmp/pip-req-tracker-_Zruyw\nCreated requirements tracker '/tmp/pip-req-tracker-_Zruyw'\nCreated temporary directory: /tmp/pip-install-rsVw0C\nProcessing /home/dimpase/sage/local/var/tmp/sage/build/cypari-2.1.1/src\n  Created temporary directory: /tmp/pip-req-build-tpOOw3\n  Added file:///home/dimpase/sage/local/var/tmp/sage/build/cypari-2.1.1/src to build tracker '/tmp/pip-req-tracker-_Zruyw'\n  Running setup.py (path:/tmp/pip-req-build-tpOOw3/setup.py) egg_info for package from file:///home/dimpase/sage/local/var/tmp/sage/build/cypari-2\n.1.1/src\n    Running command python setup.py egg_info\n    running egg_info\n    creating pip-egg-info/cypari2.egg-info\n    writing requirements to pip-egg-info/cypari2.egg-info/requires.txt\n    writing pip-egg-info/cypari2.egg-info/PKG-INFO\n    writing top-level names to pip-egg-info/cypari2.egg-info/top_level.txt\n    writing dependency_links to pip-egg-info/cypari2.egg-info/dependency_links.txt\n    writing manifest file 'pip-egg-info/cypari2.egg-info/SOURCES.txt'\n    Generating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) Catalan/home/dimpase/sage/local/share/pari/doc not found at /usr/bin/gphelp line 147.\n    Traceback (most recent call last):\n      File \"<string>\", line 1, in <module>\n      File \"/tmp/pip-req-build-tpOOw3/setup.py\", line 83, in <module>\n        cmdclass=dict(build_ext=build_ext, bdist_egg=no_egg)\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/__init__.py\", line 143, in setup\n        return distutils.core.setup(**attrs)\n      File \"/home/dimpase/sage/local/lib/python2.7/distutils/core.py\", line 151, in setup\n        dist.run_commands()\n      File \"/home/dimpase/sage/local/lib/python2.7/distutils/dist.py\", line 953, in run_commands\n        self.run_command(cmd)\n      File \"/home/dimpase/sage/local/lib/python2.7/distutils/dist.py\", line 972, in run_command\n        cmd_obj.run()\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 296, in run\n        self.find_sources()\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 303, in find_sources\n        mm.run()\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 534, in run\n        self.add_defaults()\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 570, in add_defaults\n        sdist.add_defaults(self)\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/py36compat.py\", line 36, in add_defaults\n        self._add_defaults_ext()\n      File \"/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/py36compat.py\", line 119, in _add_defaults_ext\n        build_ext = self.get_finalized_command('build_ext')\n      File \"/home/dimpase/sage/local/lib/python2.7/distutils/cmd.py\", line 312, in get_finalized_command\n        cmd_obj.ensure_finalized()\n      File \"/home/dimpase/sage/local/lib/python2.7/distutils/cmd.py\", line 109, in ensure_finalized\n        self.finalize_options()\n      File \"/tmp/pip-req-build-tpOOw3/setup.py\", line 33, in finalize_options\n        rebuild()\n      File \"autogen/__init__.py\", line 26, in rebuild\n        G()\n      File \"autogen/generator.py\", line 341, in __call__\n        self.handle_pari_function(**v)\n      File \"autogen/generator.py\", line 234, in handle_pari_function\n        doc = get_rest_doc(function)\n      File \"autogen/doc.py\", line 345, in get_rest_doc\n        raw = get_raw_doc(function)\n      File \"autogen/doc.py\", line 277, in get_raw_doc\n        doc = subprocess.check_output([\"gphelp\", \"-raw\", function])\n      File \"/home/dimpase/sage/local/lib/python2.7/subprocess.py\", line 223, in check_output\n        raise CalledProcessError(retcode, cmd, output=output)\n    subprocess.CalledProcessError: Command '[u'gphelp', u'-raw', u'Catalan']' returned non-zero exit status 2\nCleaning up...\n  Removing source in /tmp/pip-req-build-tpOOw3\nRemoved file:///home/dimpase/sage/local/var/tmp/sage/build/cypari-2.1.1/src from build tracker '/tmp/pip-req-tracker-_Zruyw'\nRemoved build tracker '/tmp/pip-req-tracker-_Zruyw'\nCommand \"python setup.py egg_info\" failed with error code 1 in /tmp/pip-req-build-tpOOw3/\n```\nwhich appears to indicate that it does not try to figure out where PARI/GP docs are, but just assumes that they are in `SAGE_LOCAL/share/pari/doc`, instead of using\n<code>\\`echo \"default(datadir)\" | gp -qf\\`/doc</code>",
    "created_at": "2019-08-05T05:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439996",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

by the way, it seems that cypari needs either a patch or an amendend
`spkg-install` script. With the branch on this ticket, its installation fails with 

```
Installing cypari-2.1.1
Installing package cypari2 using pip2
Ignoring indexes: https://pypi.org/simple
Created temporary directory: /tmp/pip-ephem-wheel-cache-Nyv_mU
Created temporary directory: /tmp/pip-req-tracker-_Zruyw
Created requirements tracker '/tmp/pip-req-tracker-_Zruyw'
Created temporary directory: /tmp/pip-install-rsVw0C
Processing /home/dimpase/sage/local/var/tmp/sage/build/cypari-2.1.1/src
  Created temporary directory: /tmp/pip-req-build-tpOOw3
  Added file:///home/dimpase/sage/local/var/tmp/sage/build/cypari-2.1.1/src to build tracker '/tmp/pip-req-tracker-_Zruyw'
  Running setup.py (path:/tmp/pip-req-build-tpOOw3/setup.py) egg_info for package from file:///home/dimpase/sage/local/var/tmp/sage/build/cypari-2
.1.1/src
    Running command python setup.py egg_info
    running egg_info
    creating pip-egg-info/cypari2.egg-info
    writing requirements to pip-egg-info/cypari2.egg-info/requires.txt
    writing pip-egg-info/cypari2.egg-info/PKG-INFO
    writing top-level names to pip-egg-info/cypari2.egg-info/top_level.txt
    writing dependency_links to pip-egg-info/cypari2.egg-info/dependency_links.txt
    writing manifest file 'pip-egg-info/cypari2.egg-info/SOURCES.txt'
    Generating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) Catalan/home/dimpase/sage/local/share/pari/doc not found at /usr/bin/gphelp line 147.
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/tmp/pip-req-build-tpOOw3/setup.py", line 83, in <module>
        cmdclass=dict(build_ext=build_ext, bdist_egg=no_egg)
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/__init__.py", line 143, in setup
        return distutils.core.setup(**attrs)
      File "/home/dimpase/sage/local/lib/python2.7/distutils/core.py", line 151, in setup
        dist.run_commands()
      File "/home/dimpase/sage/local/lib/python2.7/distutils/dist.py", line 953, in run_commands
        self.run_command(cmd)
      File "/home/dimpase/sage/local/lib/python2.7/distutils/dist.py", line 972, in run_command
        cmd_obj.run()
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 296, in run
        self.find_sources()
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 303, in find_sources
        mm.run()
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 534, in run
        self.add_defaults()
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 570, in add_defaults
        sdist.add_defaults(self)
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/py36compat.py", line 36, in add_defaults
        self._add_defaults_ext()
      File "/home/dimpase/sage/local/lib/python2.7/site-packages/setuptools/command/py36compat.py", line 119, in _add_defaults_ext
        build_ext = self.get_finalized_command('build_ext')
      File "/home/dimpase/sage/local/lib/python2.7/distutils/cmd.py", line 312, in get_finalized_command
        cmd_obj.ensure_finalized()
      File "/home/dimpase/sage/local/lib/python2.7/distutils/cmd.py", line 109, in ensure_finalized
        self.finalize_options()
      File "/tmp/pip-req-build-tpOOw3/setup.py", line 33, in finalize_options
        rebuild()
      File "autogen/__init__.py", line 26, in rebuild
        G()
      File "autogen/generator.py", line 341, in __call__
        self.handle_pari_function(**v)
      File "autogen/generator.py", line 234, in handle_pari_function
        doc = get_rest_doc(function)
      File "autogen/doc.py", line 345, in get_rest_doc
        raw = get_raw_doc(function)
      File "autogen/doc.py", line 277, in get_raw_doc
        doc = subprocess.check_output(["gphelp", "-raw", function])
      File "/home/dimpase/sage/local/lib/python2.7/subprocess.py", line 223, in check_output
        raise CalledProcessError(retcode, cmd, output=output)
    subprocess.CalledProcessError: Command '[u'gphelp', u'-raw', u'Catalan']' returned non-zero exit status 2
Cleaning up...
  Removing source in /tmp/pip-req-build-tpOOw3
Removed file:///home/dimpase/sage/local/var/tmp/sage/build/cypari-2.1.1/src from build tracker '/tmp/pip-req-tracker-_Zruyw'
Removed build tracker '/tmp/pip-req-tracker-_Zruyw'
Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-req-build-tpOOw3/
```
which appears to indicate that it does not try to figure out where PARI/GP docs are, but just assumes that they are in `SAGE_LOCAL/share/pari/doc`, instead of using
<code>\`echo "default(datadir)" | gp -qf\`/doc</code>



---

archive/issue_comments_439997.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOops, this is simply due to\n\n```\n# For PARI/GP\nGP_DATA_DIR=\"$SAGE_LOCAL/share/pari\" && export GP_DATA_DIR\nGPHELP=\"$SAGE_LOCAL/bin/gphelp\" && export GPHELP\nGPDOCDIR=\"$SAGE_LOCAL/share/pari/doc\" && export GPDOCDIR\n```\nin `src/bin/sage-env`. \n\nOK, I can move this stuff into `src/bin/sage-env-config(.in)` and fill them in correctly.",
    "created_at": "2019-08-05T07:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439997",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Oops, this is simply due to

```
# For PARI/GP
GP_DATA_DIR="$SAGE_LOCAL/share/pari" && export GP_DATA_DIR
GPHELP="$SAGE_LOCAL/bin/gphelp" && export GPHELP
GPDOCDIR="$SAGE_LOCAL/share/pari/doc" && export GPDOCDIR
```
in `src/bin/sage-env`. 

OK, I can move this stuff into `src/bin/sage-env-config(.in)` and fill them in correctly.



---

archive/issue_comments_439998.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOn my rather underpowered Debian laptop with all the PARI packages installed systemwide (i.e. all pari* SPKGs and gp2c are not built), this branch (with edits as in [comment:17](#comment%3A17)) builds and passes all the unrelated to dochtml tests, which building docs fails with multiprocessing-related segfault:\n\n```\n[dochtml] Error building the documentation.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n[dochtml]     \"__main__\", fname, loader, pkg_name)\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/runpy.py\", line 72, in _run_code\n[dochtml]     exec code in run_globals\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1718, in main\n[dochtml]     builder()\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 354, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 550, in _wrapper\n[dochtml]     build_many(build_ref_doc, L)\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 288, in _build_many\n[dochtml]     ret = x.get(99999)\n[dochtml]   File \"/home/dimpase/sage/local/lib/python2.7/multiprocessing/pool.py\", line 572, in get\n[dochtml]     raise self._value\n[dochtml] Exception: ('Non-exception during docbuild: Segmentation fault', SignalError('Segmentation fault',))\n[dochtml] \n[dochtml]     Note: incremental documentation builds sometimes cause spurious\n[dochtml]     error messages. To be certain that these are real errors, run\n[dochtml]     \"make doc-clean\" first and try again.\nmake[3]: *** [Makefile:2032: doc-html] Error 1\nmake[3]: Leaving directory '/home/dimpase/sage/build/make'\nmake[2]: *** [Makefile:1843: all-start] Error 2\nmake[2]: Leaving directory '/home/dimpase/sage/build/make'\n```\n\nAny suggestions as to how to work around this?",
    "created_at": "2019-08-05T21:00:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439998",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

On my rather underpowered Debian laptop with all the PARI packages installed systemwide (i.e. all pari* SPKGs and gp2c are not built), this branch (with edits as in [comment:17](#comment%3A17)) builds and passes all the unrelated to dochtml tests, which building docs fails with multiprocessing-related segfault:

```
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1718, in main
[dochtml]     builder()
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 354, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 550, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 288, in _build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/home/dimpase/sage/local/lib/python2.7/multiprocessing/pool.py", line 572, in get
[dochtml]     raise self._value
[dochtml] Exception: ('Non-exception during docbuild: Segmentation fault', SignalError('Segmentation fault',))
[dochtml] 
[dochtml]     Note: incremental documentation builds sometimes cause spurious
[dochtml]     error messages. To be certain that these are real errors, run
[dochtml]     "make doc-clean" first and try again.
make[3]: *** [Makefile:2032: doc-html] Error 1
make[3]: Leaving directory '/home/dimpase/sage/build/make'
make[2]: *** [Makefile:1843: all-start] Error 2
make[2]: Leaving directory '/home/dimpase/sage/build/make'
```

Any suggestions as to how to work around this?



---

archive/issue_comments_439999.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nDo you have `libpari-gmp` or `libpari-gmp-tls`?",
    "created_at": "2019-08-05T21:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-439999",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">comment:19</div>

Do you have `libpari-gmp` or `libpari-gmp-tls`?



---

archive/issue_comments_440000.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI have libpari-gmp-tls",
    "created_at": "2019-08-06T05:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440000",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

I have libpari-gmp-tls



---

archive/issue_comments_440001.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nGiven that everything else works, I think it should be a docbuild bug, that produces segfaults at random places while reference manual is built. Something to do with tread-local storage in libpari, presumably.",
    "created_at": "2019-08-06T10:20:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440001",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Given that everything else works, I think it should be a docbuild bug, that produces segfaults at random places while reference manual is built. Something to do with tread-local storage in libpari, presumably.



---

archive/issue_comments_440002.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI know for pari we're also dependent currently on a few patches for bug fixes (on Cygwin one of these is critical).  It would be nice to get these upstream if they aren't already...",
    "created_at": "2019-08-06T12:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440002",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

I know for pari we're also dependent currently on a few patches for bug fixes (on Cygwin one of these is critical).  It would be nice to get these upstream if they aren't already...



---

archive/issue_comments_440003.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nthere is a Darwin-specific and a Cygwin-specific ones, the rest I presume are already in (in particular as they are by Pari people).",
    "created_at": "2019-08-06T13:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440003",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

there is a Darwin-specific and a Cygwin-specific ones, the rest I presume are already in (in particular as they are by Pari people).



---

archive/issue_comments_440004.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@dimpase](#comment%3A21):\n> Given that everything else works, I think it should be a docbuild bug, that produces segfaults at random places while reference manual is built. Something to do with tread-local storage in libpari, presumably.\n> \n\nthis is most certainly #26608; I'll try an appropriately adjusted #27490 -workaround.",
    "created_at": "2019-08-07T04:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440004",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@dimpase](#comment%3A21):
> Given that everything else works, I think it should be a docbuild bug, that produces segfaults at random places while reference manual is built. Something to do with tread-local storage in libpari, presumably.
> 

this is most certainly #26608; I'll try an appropriately adjusted #27490 -workaround.



---

archive/issue_comments_440005.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nRight, using the CYGWIN workaround, i.e. unconditional `from .utils import _build_many as build_many` in [src/sage_setup/docbuild/__init__.py](https://github.com/sagemath/sage/blob/master/src/sage_setup/docbuild/__init__.py#L307) allows docs to build. Now, we can either always use it for external PARI, or test external PARI on whether it has multi-threading enabled, and only in this case use it.\n\nI don't know how to test for PARI  multi-threading enabled, so unless someone can provide a test, I'm going to set it on always.",
    "created_at": "2019-08-07T07:17:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440005",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

Right, using the CYGWIN workaround, i.e. unconditional `from .utils import _build_many as build_many` in [src/sage_setup/docbuild/__init__.py](https://github.com/sagemath/sage/blob/master/src/sage_setup/docbuild/__init__.py#L307) allows docs to build. Now, we can either always use it for external PARI, or test external PARI on whether it has multi-threading enabled, and only in this case use it.

I don't know how to test for PARI  multi-threading enabled, so unless someone can provide a test, I'm going to set it on always.



---

archive/issue_comments_440006.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAlso,\n\n```\nFile \"src/sage/misc/package.py\", line 313, in sage.misc.package.is_package_installed\nFailed example:\n    is_package_installed('pari')  # optional - build\nExpected:\n    True\nGot:\n    False\n```\nneeds a fix. (I guess dummy packages are not counted as installed).",
    "created_at": "2019-08-07T09:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440006",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Also,

```
File "src/sage/misc/package.py", line 313, in sage.misc.package.is_package_installed
Failed example:
    is_package_installed('pari')  # optional - build
Expected:
    True
Got:
    False
```
needs a fix. (I guess dummy packages are not counted as installed).



---

archive/issue_comments_440007.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6eac55053f1e633c4d1638d23070467735149055\"><code>6eac550</code></a></td><td><code>as pari might become dummy, test with GAP</code></td></tr></table>\n",
    "created_at": "2019-08-07T13:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440007",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6eac55053f1e633c4d1638d23070467735149055"><code>6eac550</code></a></td><td><code>as pari might become dummy, test with GAP</code></td></tr></table>




---

archive/issue_comments_440008.json:
```json
{
    "body": "Changed commit from **[`72f3c20`](https://github.com/sagemath/sagetrac-mirror/commit/72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee)** to **[`6eac550`](https://github.com/sagemath/sagetrac-mirror/commit/6eac55053f1e633c4d1638d23070467735149055)**",
    "created_at": "2019-08-07T13:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440008",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`72f3c20`](https://github.com/sagemath/sagetrac-mirror/commit/72f3c20b38dd0aad6c8325f16f3b4be79b7c70ee)** to **[`6eac550`](https://github.com/sagemath/sagetrac-mirror/commit/6eac55053f1e633c4d1638d23070467735149055)**



---

archive/issue_comments_440009.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac207d5eed575e96f43ab44475d4a4625639a7a7\"><code>ac207d5</code></a></td><td><code>don't export GP_DATA_DIR, remove other, unneeded GP* vars</code></td></tr></table>\n",
    "created_at": "2019-08-07T19:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440009",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac207d5eed575e96f43ab44475d4a4625639a7a7"><code>ac207d5</code></a></td><td><code>don't export GP_DATA_DIR, remove other, unneeded GP* vars</code></td></tr></table>




---

archive/issue_comments_440010.json:
```json
{
    "body": "Changed commit from **[`6eac550`](https://github.com/sagemath/sagetrac-mirror/commit/6eac55053f1e633c4d1638d23070467735149055)** to **[`ac207d5`](https://github.com/sagemath/sagetrac-mirror/commit/ac207d5eed575e96f43ab44475d4a4625639a7a7)**",
    "created_at": "2019-08-07T19:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440010",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6eac550`](https://github.com/sagemath/sagetrac-mirror/commit/6eac55053f1e633c4d1638d23070467735149055)** to **[`ac207d5`](https://github.com/sagemath/sagetrac-mirror/commit/ac207d5eed575e96f43ab44475d4a4625639a7a7)**



---

archive/issue_comments_440011.json:
```json
{
    "body": "Changed commit from **[`ac207d5`](https://github.com/sagemath/sagetrac-mirror/commit/ac207d5eed575e96f43ab44475d4a4625639a7a7)** to **[`317f090`](https://github.com/sagemath/sagetrac-mirror/commit/317f0909d0d7ffbd17f32edf99f5b47eae3d6c49)**",
    "created_at": "2019-08-08T10:08:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440011",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ac207d5`](https://github.com/sagemath/sagetrac-mirror/commit/ac207d5eed575e96f43ab44475d4a4625639a7a7)** to **[`317f090`](https://github.com/sagemath/sagetrac-mirror/commit/317f0909d0d7ffbd17f32edf99f5b47eae3d6c49)**



---

archive/issue_comments_440012.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/317f0909d0d7ffbd17f32edf99f5b47eae3d6c49\"><code>317f090</code></a></td><td><code>proper dependency resolution (all tests in PARI spkg-config)</code></td></tr></table>\n",
    "created_at": "2019-08-08T10:08:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440012",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/317f0909d0d7ffbd17f32edf99f5b47eae3d6c49"><code>317f090</code></a></td><td><code>proper dependency resolution (all tests in PARI spkg-config)</code></td></tr></table>




---

archive/issue_events_384489.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-08-08T10:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384489"
}
```



---

archive/issue_comments_440013.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nplease review. I only tested this on Debian 10, which has all the require PARI packages. A new Fedora (29 or better) should do, too.",
    "created_at": "2019-08-08T10:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440013",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

please review. I only tested this on Debian 10, which has all the require PARI packages. A new Fedora (29 or better) should do, too.



---

archive/issue_comments_440014.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThe workaeound for docbuilding is not yet in this branch, thus if you supply a multithreaded libpari, docs won't build (unless one uses the workabout in [comment:25](#comment%3A25))",
    "created_at": "2019-08-08T10:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440014",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

The workaeound for docbuilding is not yet in this branch, thus if you supply a multithreaded libpari, docs won't build (unless one uses the workabout in [comment:25](#comment%3A25))



---

archive/issue_comments_440015.json:
```json
{
    "body": "Changed commit from **[`317f090`](https://github.com/sagemath/sagetrac-mirror/commit/317f0909d0d7ffbd17f32edf99f5b47eae3d6c49)** to **[`2c26115`](https://github.com/sagemath/sagetrac-mirror/commit/2c26115cd1752a3728793966785a451b2334a865)**",
    "created_at": "2019-08-08T12:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440015",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`317f090`](https://github.com/sagemath/sagetrac-mirror/commit/317f0909d0d7ffbd17f32edf99f5b47eae3d6c49)** to **[`2c26115`](https://github.com/sagemath/sagetrac-mirror/commit/2c26115cd1752a3728793966785a451b2334a865)**



---

archive/issue_comments_440016.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c26115cd1752a3728793966785a451b2334a865\"><code>2c26115</code></a></td><td><code>docbuild workaround for external PARI</code></td></tr></table>\n",
    "created_at": "2019-08-08T12:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440016",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c26115cd1752a3728793966785a451b2334a865"><code>2c26115</code></a></td><td><code>docbuild workaround for external PARI</code></td></tr></table>




---

archive/issue_comments_440017.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nOK, so it should work with docbuilding too.\n\nBy the way, I'd also welcome review of autoconf/m4 code (e.g. `m4/sage_check_pari_dep.m4`\ncontains the 1st autoconf macro I ever wrote :-))",
    "created_at": "2019-08-08T12:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440017",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

OK, so it should work with docbuilding too.

By the way, I'd also welcome review of autoconf/m4 code (e.g. `m4/sage_check_pari_dep.m4`
contains the 1st autoconf macro I ever wrote :-))



---

archive/issue_comments_440018.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI checked in conda and this picks up the conda installation correctly. For that though I needed to install the optional packages `pari-*`. `conda install pari` only pulls in `pari-seadata-small` and `pari-galdata`.\n\nEven though the above issue is there, this is still an improvement over current situation.",
    "created_at": "2019-08-09T17:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440018",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:35" align="right">comment:35</div>

I checked in conda and this picks up the conda installation correctly. For that though I needed to install the optional packages `pari-*`. `conda install pari` only pulls in `pari-seadata-small` and `pari-galdata`.

Even though the above issue is there, this is still an improvement over current situation.



---

archive/issue_events_384490.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2019-08-09T17:13:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384490"
}
```



---

archive/issue_events_384491.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2019-08-09T17:13:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384491"
}
```



---

archive/issue_events_384492.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2019-08-09T17:21:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384492"
}
```



---

archive/issue_events_384493.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2019-08-09T17:21:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384493"
}
```



---

archive/issue_comments_440019.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\n\n```\nconfigure: === checking whether to install the pari SPKG ===\nchecking installing gmp/mpir or readline? ... no\nchecking installing PARI/GP packages? ... checking for gp... /projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/bin/gp\nchecking is pari_elldata installed? ... yes\nchecking is pari_galdata installed? ... yes\nchecking is pari_galpol installed? ... yes\nchecking is pari_seadata installed? ...   ***   at top-level: poldegree(ellmodulareqn(211)[1])\n  ***                           ^----------------------\n  *** ellmodulareqn: error opening seadata file: `/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/share/pari/seadata/sea211'.\nno; cannot use system pari/GP without seadata package\nconfigure: Install seadata package and reconfigure.\nconfigure: Otherwise Sage will build its own pari/GP.\nusing Sage's pari SPKG\n```\n\nAbove error message from pari should go in `config.log` and not shown to the user.",
    "created_at": "2019-08-09T17:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440019",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:36" align="right">comment:36</div>


```
configure: === checking whether to install the pari SPKG ===
checking installing gmp/mpir or readline? ... no
checking installing PARI/GP packages? ... checking for gp... /projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/bin/gp
checking is pari_elldata installed? ... yes
checking is pari_galdata installed? ... yes
checking is pari_galpol installed? ... yes
checking is pari_seadata installed? ...   ***   at top-level: poldegree(ellmodulareqn(211)[1])
  ***                           ^----------------------
  *** ellmodulareqn: error opening seadata file: `/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/share/pari/seadata/sea211'.
no; cannot use system pari/GP without seadata package
configure: Install seadata package and reconfigure.
configure: Otherwise Sage will build its own pari/GP.
using Sage's pari SPKG
```

Above error message from pari should go in `config.log` and not shown to the user.



---

archive/issue_comments_440020.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5\"><code>dd2b3fa</code></a></td><td><code>redirect gp errors to config.log</code></td></tr></table>\n",
    "created_at": "2019-08-09T20:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440020",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5"><code>dd2b3fa</code></a></td><td><code>redirect gp errors to config.log</code></td></tr></table>




---

archive/issue_comments_440021.json:
```json
{
    "body": "Changed commit from **[`2c26115`](https://github.com/sagemath/sagetrac-mirror/commit/2c26115cd1752a3728793966785a451b2334a865)** to **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)**",
    "created_at": "2019-08-09T20:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440021",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2c26115`](https://github.com/sagemath/sagetrac-mirror/commit/2c26115cd1752a3728793966785a451b2334a865)** to **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)**



---

archive/issue_events_384494.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-08-09T20:33:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384494"
}
```



---

archive/issue_events_384495.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-08-09T20:33:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384495"
}
```



---

archive/issue_comments_440022.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOK, fixed.",
    "created_at": "2019-08-09T20:33:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440022",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

OK, fixed.



---

archive/issue_comments_440023.json:
```json
{
    "body": "Reviewer: **Isuru Fernando**",
    "created_at": "2019-08-10T04:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440023",
    "user": "https://github.com/isuruf"
}
```

Reviewer: **Isuru Fernando**



---

archive/issue_events_384496.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2019-08-10T04:51:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384496"
}
```



---

archive/issue_events_384497.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2019-08-10T04:51:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384497"
}
```



---

archive/issue_comments_440024.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThanks. Works for me",
    "created_at": "2019-08-10T04:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440024",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:39" align="right">comment:39</div>

Thanks. Works for me



---

archive/issue_comments_440025.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nSorry for the late intervention. \n\n```\ndiff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py\nindex e406bca..0e07c71 100644\n--- a/src/sage_setup/docbuild/__init__.py\n+++ b/src/sage_setup/docbuild/__init__.py\n@@ -294,7 +294,7 @@ def _build_many(target, args):\n             raise\n     return ret\n \n-if not (CYGWIN_VERSION and CYGWIN_VERSION[0] < 3):\n+if (os.environ['SAGE_PARI_CFG'] !='') and (not (CYGWIN_VERSION and CYGWIN_VERSION[0] < 3)):\n     build_many = _build_many\n else:\n     # Cygwin 64-bit < 3.0.0 has a bug with exception handling when exceptions\n```\nThat bit causes me trouble when building the doc\n\n```\n * python3_7: running distutils-r1_run_phase python_compile_all\nSetting permissions of DOT_SAGE directory so only you can read and write it.\nTraceback (most recent call last):\n  File \"sage_setup/docbuild/__main__.py\", line 1, in <module>\n    from sage_setup.docbuild import main\n  File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/sage_setup/docbuild/__init__.py\", line 297, in <module>\n    if (os.environ['SAGE_PARI_CFG'] !='') and (not (CYGWIN_VERSION and CYGWIN_VERSION[0] < 3)):\n  File \"/usr/lib/python3.7/os.py\", line 678, in __getitem__\n    raise KeyError(key) from None\nKeyError: 'SAGE_PARI_CFG'\n```",
    "created_at": "2019-08-10T23:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440025",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:40" align="right">comment:40</div>

Sorry for the late intervention. 

```
diff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py
index e406bca..0e07c71 100644
--- a/src/sage_setup/docbuild/__init__.py
+++ b/src/sage_setup/docbuild/__init__.py
@@ -294,7 +294,7 @@ def _build_many(target, args):
             raise
     return ret
 
-if not (CYGWIN_VERSION and CYGWIN_VERSION[0] < 3):
+if (os.environ['SAGE_PARI_CFG'] !='') and (not (CYGWIN_VERSION and CYGWIN_VERSION[0] < 3)):
     build_many = _build_many
 else:
     # Cygwin 64-bit < 3.0.0 has a bug with exception handling when exceptions
```
That bit causes me trouble when building the doc

```
 * python3_7: running distutils-r1_run_phase python_compile_all
Setting permissions of DOT_SAGE directory so only you can read and write it.
Traceback (most recent call last):
  File "sage_setup/docbuild/__main__.py", line 1, in <module>
    from sage_setup.docbuild import main
  File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/sage_setup/docbuild/__init__.py", line 297, in <module>
    if (os.environ['SAGE_PARI_CFG'] !='') and (not (CYGWIN_VERSION and CYGWIN_VERSION[0] < 3)):
  File "/usr/lib/python3.7/os.py", line 678, in __getitem__
    raise KeyError(key) from None
KeyError: 'SAGE_PARI_CFG'
```



---

archive/issue_events_384498.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-08-10T23:18:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384498"
}
```



---

archive/issue_events_384499.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-08-10T23:18:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384499"
}
```



---

archive/issue_comments_440026.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI would be happy for this ticket to proceed as is and the issue to be addressed in a follow up ticket. \n\nBut the general assumption should be sage-on-distros don't run configure. In fact we have pushed a few things so that sage-distro can run without `sage-env`. I did so a few release ago and Antonio Rojas from arch has pushed so he could follow my lead there in sage-8.9. We can define the variable at build time, I could even flip the value depending on whether `pari` has been built with tls in Gentoo. But it would be cleaner if it just worked, with the assumption that `pari` is provided externally, if the variable is undefined.",
    "created_at": "2019-08-10T23:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440026",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">comment:41</div>

I would be happy for this ticket to proceed as is and the issue to be addressed in a follow up ticket. 

But the general assumption should be sage-on-distros don't run configure. In fact we have pushed a few things so that sage-distro can run without `sage-env`. I did so a few release ago and Antonio Rojas from arch has pushed so he could follow my lead there in sage-8.9. We can define the variable at build time, I could even flip the value depending on whether `pari` has been built with tls in Gentoo. But it would be cleaner if it just worked, with the assumption that `pari` is provided externally, if the variable is undefined.



---

archive/issue_comments_440027.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nFollow up will take place at #28341.",
    "created_at": "2019-08-11T01:03:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440027",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">comment:42</div>

Follow up will take place at #28341.



---

archive/issue_events_384500.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-08-11T01:03:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384500"
}
```



---

archive/issue_events_384501.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-08-11T01:03:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384501"
}
```



---

archive/issue_comments_440028.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/pariconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/pariconfig)** to **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)**",
    "created_at": "2019-08-11T16:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440028",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/packages/pariconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/pariconfig)** to **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)**



---

archive/issue_events_384502.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-11T16:44:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384502"
}
```



---

archive/issue_events_384503.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ecdd4043be13672afec5f8e5ca1468e2f6a225ff",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-08-11T16:44:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28242#event-384503"
}
```



---

archive/issue_comments_440029.json:
```json
{
    "body": "Changed commit from **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)** to none",
    "created_at": "2019-08-26T18:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440029",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`dd2b3fa`](https://github.com/sagemath/sagetrac-mirror/commit/dd2b3faae58e7bad2c3109829b7468eb9902cbf5)** to none



---

archive/issue_comments_440030.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nCan Archlinux get more PARI packages (as much as Debian 10), so that its PARI may be used?",
    "created_at": "2019-08-26T18:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440030",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:44" align="right">comment:44</div>

Can Archlinux get more PARI packages (as much as Debian 10), so that its PARI may be used?



---

archive/issue_comments_440031.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@dimpase](#comment%3A44):\n> Can Archlinux get more PARI packages (as much as Debian 10), so that its PARI may be used?\n\nStandard packages are available from the official repositories, optional packages can easily be installed from AUR - https://aur.archlinux.org/packages/?K=pari-",
    "created_at": "2019-08-26T18:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440031",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@dimpase](#comment%3A44):
> Can Archlinux get more PARI packages (as much as Debian 10), so that its PARI may be used?

Standard packages are available from the official repositories, optional packages can easily be installed from AUR - https://aur.archlinux.org/packages/?K=pari-



---

archive/issue_comments_440032.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nFollow up at #29319",
    "created_at": "2020-03-12T17:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440032",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

Follow up at #29319



---

archive/issue_comments_440033.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@dimpase](#comment%3A16):\n> by the way, it seems that cypari needs either a patch or an amendend\n> `spkg-install` script. With the branch on this ticket, its installation fails with \n> \n> ```\n> Installing cypari-2.1.1\n> ...\n>       File \"autogen/doc.py\", line 277, in get_raw_doc\n>         doc = subprocess.check_output([\"gphelp\", \"-raw\", function])\n>       File \"/home/dimpase/sage/local/lib/python2.7/subprocess.py\", line 223, in check_output\n>         raise CalledProcessError(retcode, cmd, output=output)\n>     subprocess.CalledProcessError: Command '[u'gphelp', u'-raw', u'Catalan']' returned non-zero exit status 2 ...\n> ```\n> which appears to indicate that it does not try to figure out where PARI/GP docs are, but just assumes that they are in `SAGE_LOCAL/share/pari/doc`, instead of using\n> <code>\\`echo \"default(datadir)\" | gp -qf\\`/doc</code>\n\nFollow up for this problem: #29342",
    "created_at": "2020-03-15T21:13:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440033",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@dimpase](#comment%3A16):
> by the way, it seems that cypari needs either a patch or an amendend
> `spkg-install` script. With the branch on this ticket, its installation fails with 
> 
> ```
> Installing cypari-2.1.1
> ...
>       File "autogen/doc.py", line 277, in get_raw_doc
>         doc = subprocess.check_output(["gphelp", "-raw", function])
>       File "/home/dimpase/sage/local/lib/python2.7/subprocess.py", line 223, in check_output
>         raise CalledProcessError(retcode, cmd, output=output)
>     subprocess.CalledProcessError: Command '[u'gphelp', u'-raw', u'Catalan']' returned non-zero exit status 2 ...
> ```
> which appears to indicate that it does not try to figure out where PARI/GP docs are, but just assumes that they are in `SAGE_LOCAL/share/pari/doc`, instead of using
> <code>\`echo "default(datadir)" | gp -qf\`/doc</code>

Follow up for this problem: #29342



---

archive/issue_comments_440034.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI was working on FreeBSD with 9.1.beta9 and pari as a system package without any problem related to gp / pari.\n\nYesterday I switched to 9.1.rc1, with the same external package, and now the compilation of cysignals aborts with this message:\n\n\n```\n[cysignals-1.10.2]     cc -pthread -shared -L/usr/local/lib -fstack-protector-strong -L/usr/ports/math/sage/work/stage/usr/local/lib -Wl,-rpath,/usr/ports/math/sage/work/stage/usr/local/lib -L/usr/local/llvm90/lib -L/usr/local/lib -Wl,-rpath=/usr/local/lib/gcc9 -L/usr/local/lib/gcc9 -B/usr/local/bin -L/usr/local/lib -fstack-protector-strong -O2 -pipe -DLIBICONV_PLUG -fstack-protector-strong -isystem /usr/local/include -fno-strict-aliasing -DLIBICONV_PLUG -I/usr/local/include -isystem /usr/local/include -Wp,-U_FORTIFY_SOURCE build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o -L/usr/local/lib -lpython3.7m -o build/lib.freebsd-12.1-STABLE-amd64-3.7/cysignals/signals.so -lpari -lomp -pthread -L/usr/local/lib\n[cysignals-1.10.2]     /usr/local/bin/ld: PARI_SIGINT_block: TLS definition in /usr/local/lib/libpari.so section .tbss mismatches non-TLS reference in build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o\n[cysignals-1.10.2]     /usr/local/bin/ld: /usr/local/lib/libpari.so: error adding symbols: bad value\n\n```\n\nAnyone with the same problem on other OS, or is it specific to FreeBSD?",
    "created_at": "2020-04-25T10:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440034",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:48" align="right">comment:48</div>

I was working on FreeBSD with 9.1.beta9 and pari as a system package without any problem related to gp / pari.

Yesterday I switched to 9.1.rc1, with the same external package, and now the compilation of cysignals aborts with this message:


```
[cysignals-1.10.2]     cc -pthread -shared -L/usr/local/lib -fstack-protector-strong -L/usr/ports/math/sage/work/stage/usr/local/lib -Wl,-rpath,/usr/ports/math/sage/work/stage/usr/local/lib -L/usr/local/llvm90/lib -L/usr/local/lib -Wl,-rpath=/usr/local/lib/gcc9 -L/usr/local/lib/gcc9 -B/usr/local/bin -L/usr/local/lib -fstack-protector-strong -O2 -pipe -DLIBICONV_PLUG -fstack-protector-strong -isystem /usr/local/include -fno-strict-aliasing -DLIBICONV_PLUG -I/usr/local/include -isystem /usr/local/include -Wp,-U_FORTIFY_SOURCE build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o -L/usr/local/lib -lpython3.7m -o build/lib.freebsd-12.1-STABLE-amd64-3.7/cysignals/signals.so -lpari -lomp -pthread -L/usr/local/lib
[cysignals-1.10.2]     /usr/local/bin/ld: PARI_SIGINT_block: TLS definition in /usr/local/lib/libpari.so section .tbss mismatches non-TLS reference in build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o
[cysignals-1.10.2]     /usr/local/bin/ld: /usr/local/lib/libpari.so: error adding symbols: bad value

```

Anyone with the same problem on other OS, or is it specific to FreeBSD?



---

archive/issue_comments_440035.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nHmm, not sure what's happening here. I don't think I saw this before. Something related to `--enable-tls` (tls=thread-local storage) option while buildig Pari/GP - which works on Linux smoothly.",
    "created_at": "2020-04-26T16:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440035",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">comment:49</div>

Hmm, not sure what's happening here. I don't think I saw this before. Something related to `--enable-tls` (tls=thread-local storage) option while buildig Pari/GP - which works on Linux smoothly.



---

archive/issue_comments_440036.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nBut it seems that this is disabled when Sage builds Pari?\n\nIn build/pkgs/pari/spkg-install.in there is \"unset enable_tls\".",
    "created_at": "2020-04-26T17:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440036",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:50" align="right">comment:50</div>

But it seems that this is disabled when Sage builds Pari?

In build/pkgs/pari/spkg-install.in there is "unset enable_tls".



---

archive/issue_comments_440037.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI mean to say that we can use Pari built with `--enable-tls` with Sage on several Linux distributions (not the Pari built by Sage). Does FreeBSD Pari port use some special clang flags for TLS? \n\nIs Pari built with pthread on FreeBSD?",
    "created_at": "2020-04-27T03:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440037",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

I mean to say that we can use Pari built with `--enable-tls` with Sage on several Linux distributions (not the Pari built by Sage). Does FreeBSD Pari port use some special clang flags for TLS? 

Is Pari built with pthread on FreeBSD?



---

archive/issue_comments_440038.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nOn the other hand, `cysignals` is not known to be thread-safe, so it could be that FreeBSD tools are better than Linux tools in detecting this:\nhttps://github.com/sagemath/cysignals/issues/21\n\nIn view of this, linking `cysignals` with `-pthreads` might be what causes this error.",
    "created_at": "2020-04-27T04:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440038",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

On the other hand, `cysignals` is not known to be thread-safe, so it could be that FreeBSD tools are better than Linux tools in detecting this:
https://github.com/sagemath/cysignals/issues/21

In view of this, linking `cysignals` with `-pthreads` might be what causes this error.



---

archive/issue_comments_440039.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nActually the problem was different! Pari's spkg-configure.m4 is broken: I thought that I was using pari from the system packages, but I was not.\n\nspkg-configure.m4 includes unescaped [ ] and it produces an error.\n\nA fix could be:\n\n```\n--- build/pkgs/pari/spkg-configure.m4.orig      2020-04-27 19:20:17.006373000 +0200\n+++ build/pkgs/pari/spkg-configure.m4   2020-04-27 19:34:16.220830000 +0200\n@@ -74,7 +74,7 @@\n             sage_spkg_install_pari=yes\n         fi\n         AC_MSG_CHECKING([whether hyperellcharpoly bug is fixed])\n-        bug_check=$(echo \"hyperellcharpoly([x^10 + x^9 + x^8 + x,0]*Mod(1,3))\" | $GP -qf 2>> config.log)\n+        bug_check=$(echo \"hyperellcharpoly([[x^10 + x^9 + x^8 + x,0]]*Mod(1,3))\" | $GP -qf 2>> config.log)\n         expected=\"%1 = x^8 + 731*x^7 + 6*x^6 - 720*x^5 + 18*x^4 - 2160*x^3 + 54*x^2 + 19737*x + 81\"\n         if test x\"$bug_check\" = x\"$expected\"; then\n            AC_MSG_RESULT([yes])\n```\n\n(But ATM I removed this part)",
    "created_at": "2020-04-27T17:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440039",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:53" align="right">comment:53</div>

Actually the problem was different! Pari's spkg-configure.m4 is broken: I thought that I was using pari from the system packages, but I was not.

spkg-configure.m4 includes unescaped [ ] and it produces an error.

A fix could be:

```
--- build/pkgs/pari/spkg-configure.m4.orig      2020-04-27 19:20:17.006373000 +0200
+++ build/pkgs/pari/spkg-configure.m4   2020-04-27 19:34:16.220830000 +0200
@@ -74,7 +74,7 @@
             sage_spkg_install_pari=yes
         fi
         AC_MSG_CHECKING([whether hyperellcharpoly bug is fixed])
-        bug_check=$(echo "hyperellcharpoly([x^10 + x^9 + x^8 + x,0]*Mod(1,3))" | $GP -qf 2>> config.log)
+        bug_check=$(echo "hyperellcharpoly([[x^10 + x^9 + x^8 + x,0]]*Mod(1,3))" | $GP -qf 2>> config.log)
         expected="%1 = x^8 + 731*x^7 + 6*x^6 - 720*x^5 + 18*x^4 - 2160*x^3 + 54*x^2 + 19737*x + 81"
         if test x"$bug_check" = x"$expected"; then
            AC_MSG_RESULT([yes])
```

(But ATM I removed this part)



---

archive/issue_comments_440040.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nThat's fixed already by #29554",
    "created_at": "2020-04-27T22:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440040",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

That's fixed already by #29554



---

archive/issue_comments_440041.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@mkoeppe](#comment%3A54):\n> That's fixed already by #29554\n\nhowever, this still begs a question why cysignals is built with `-pythread` (as set in its setup.py), while it's known not to be thread-safe, cf.\nhttps://github.com/sagemath/cysignals/issues/21",
    "created_at": "2020-04-28T01:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28242#issuecomment-440041",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@mkoeppe](#comment%3A54):
> That's fixed already by #29554

however, this still begs a question why cysignals is built with `-pythread` (as set in its setup.py), while it's known not to be thread-safe, cf.
https://github.com/sagemath/cysignals/issues/21
