# Issue 28878: psutil doesn't build on recent Cygwin

archive/issues_028641.json:
```json
{
    "body": "psutil's Windows-related modules include some C headers that copy some Windows function and type declarations that are missing from public APIs.  However, Cygwin includes the [win32 API headers from the MinGW project](http://mingw-w64.org/doku.php/contribute#win32_api_and_runtime), which are more extensive.\n\nCygwin recently updated to MinGW-w64 7.0 which added some new structs to those headers that happen to already be redefined in psutil, so the psutil Cygwin patch needs to be updated to account for this (it still works on Cygwin installations using the older win32 headers, but for new builds this will be a problem).\n\nCC:  @slel\n\nKeywords: cygwin psutil\n\nBranch: [1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)\n\nReviewer: Volker Braun\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28878\n\n",
    "closed_at": "2019-12-28T22:53:19Z",
    "created_at": "2019-12-13T11:15:10Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "psutil doesn't build on recent Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28878",
    "user": "https://github.com/embray"
}
```
psutil's Windows-related modules include some C headers that copy some Windows function and type declarations that are missing from public APIs.  However, Cygwin includes the [win32 API headers from the MinGW project](http://mingw-w64.org/doku.php/contribute#win32_api_and_runtime), which are more extensive.

Cygwin recently updated to MinGW-w64 7.0 which added some new structs to those headers that happen to already be redefined in psutil, so the psutil Cygwin patch needs to be updated to account for this (it still works on Cygwin installations using the older win32 headers, but for new builds this will be a problem).

CC:  @slel

Keywords: cygwin psutil

Branch: [1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)

Reviewer: Volker Braun

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28878





---

archive/issue_comments_561891.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'm working on a patch...",
    "created_at": "2019-12-13T11:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561891",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
I'm working on a patch...



---

archive/issue_comments_561892.json:
```json
{
    "body": "Commit: [1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)",
    "created_at": "2019-12-13T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561892",
    "user": "https://github.com/embray"
}
```

Commit: [1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)



---

archive/issue_comments_561893.json:
```json
{
    "body": "Author: Erik Bray",
    "created_at": "2019-12-13T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561893",
    "user": "https://github.com/embray"
}
```

Author: Erik Bray



---

archive/issue_comments_561894.json:
```json
{
    "body": "Branch: [u/embray/ticket-28878](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28878)",
    "created_at": "2019-12-13T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561894",
    "user": "https://github.com/embray"
}
```

Branch: [u/embray/ticket-28878](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28878)



---

archive/issue_comments_561895.json:
```json
{
    "body": "Changing keywords from \"\" to \"cygwin psutil\".",
    "created_at": "2019-12-13T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561895",
    "user": "https://github.com/embray"
}
```

Changing keywords from "" to "cygwin psutil".



---

archive/issue_comments_561896.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis patch works on the new version of the headers, as well as an older version.  To check whether or not the patch is even relevant to your Cygwin install, run\n\n```\n$ cygcheck -s | grep 'w32api-headers'\nw32api-headers                          5.0.4-1                    OK\n```\n\nThis issue only affects version 7.0.0 and up.\n\nThere is no need to increase the patch level on the SPKG, because this is not a runtime issue; it only impacts building, so the patch will be needed if psutil is being built for the first time, or is being rebuilt for some other reason.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[1186b15](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)|`Trac #28878: Update the Cygwin patch to psutil to support version 7.0 of`|",
    "created_at": "2019-12-13T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561896",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
This patch works on the new version of the headers, as well as an older version.  To check whether or not the patch is even relevant to your Cygwin install, run

```
$ cygcheck -s | grep 'w32api-headers'
w32api-headers                          5.0.4-1                    OK
```

This issue only affects version 7.0.0 and up.

There is no need to increase the patch level on the SPKG, because this is not a runtime issue; it only impacts building, so the patch will be needed if psutil is being built for the first time, or is being rebuilt for some other reason.

---
New commits:
|                                                                                                                                          |                                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[1186b15](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)|`Trac #28878: Update the Cygwin patch to psutil to support version 7.0 of`|



---

archive/issue_comments_561897.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-13T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561897",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_561898.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-28T11:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561898",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_561899.json:
```json
{
    "body": "Reviewer: Volker Braun",
    "created_at": "2019-12-28T11:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561899",
    "user": "https://github.com/vbraun"
}
```

Reviewer: Volker Braun



---

archive/issue_comments_561900.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-28T22:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561900",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_082489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-28T22:53:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28878#event-82489"
}
```



---

archive/issue_comments_561901.json:
```json
{
    "body": "Changing branch from \"[u/embray/ticket-28878](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28878)\" to \"[1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)\"",
    "created_at": "2019-12-28T22:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561901",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/embray/ticket-28878](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-28878)" to "[1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)"



---

archive/issue_comments_561902.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks!",
    "created_at": "2019-12-30T15:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561902",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Thanks!



---

archive/issue_comments_561903.json:
```json
{
    "body": "Changing commit from \"[1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)\" to \"\"",
    "created_at": "2019-12-30T15:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-561903",
    "user": "https://github.com/embray"
}
```

Changing commit from "[1186b153cad151638f52582ce72e5beee3a9dee2](https://github.com/sagemath/sagetrac-mirror/commit/1186b153cad151638f52582ce72e5beee3a9dee2)" to ""
