# Issue 28636: Implement ambient volume of polyhedron with normaliz

archive/issues_028636.json:
```json
{
    "body": "CC:  @jplab @laisrast\n\nKeywords: polyhedron, normaliz, ambient volume\n\nWe implement the ambient volume using backend normaliz.\n\nThis is done by return 0 or infinity if the polyhedron is not full-dimensional and not compact respectively.\n\nOtherwise, we take the `induced_lattice` volume and divide by `factorial(self.dim())`.\n\nSee section 6.1.1 of the normaliz manual on how `induced_lattice` volume relates to euclidean volume: [https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf](https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf)\n\nThis is much faster than the current method, so we set this to default if backend is normaliz.\n\n```\nsage: P = polytopes.dodecahedron(backend='normaliz')\nsage: %time P.volume(engine='normaliz')\nCPU times: user 3.91 ms, sys: 0 ns, total: 3.91 ms\nWall time: 1.49 ms\n-176*sqrt5 + 400\nsage: %time P.volume(engine='internal')\nCPU times: user 26.5 ms, sys: 332 \u00b5s, total: 26.9 ms\nWall time: 27.5 ms\n-176*sqrt5 + 400\n```\n\n```\nsage: P = polytopes.one_hundred_twenty_cell(backend='normaliz')\nsage: %time P.volume(engine='normaliz')\nCPU times: user 1.5 s, sys: 0 ns, total: 1.5 s\nWall time: 210 ms\n120*sqrt5\nsage: %time P.volume(engine='internal')\nCPU times: user 8.61 s, sys: 14.7 ms, total: 8.63 s\nWall time: 8.63 s\n120*sqrt5\n```\n\n```\nsage: P = polytopes.hypercube(6, backend='normaliz')\nsage: %time P.volume(engine='normaliz')\nCPU times: user 2.33 ms, sys: 0 ns, total: 2.33 ms\nWall time: 2.34 ms\n64\nsage: %time P.volume(engine='internal')\nCPU times: user 183 ms, sys: 32 \u00b5s, total: 183 ms\nWall time: 182 ms\n64\n```\n\nThis also speeds up calculation in case the polyhedron is not full-dimensional:\n\n```\nsage: P = polytopes.permutahedron(6, backend='normaliz')\nsage: %time P.volume(measure='induced')\nCPU times: user 37.7 s, sys: 42.4 ms, total: 37.7 s\nWall time: 24.2 s\n1296*sqrt(6)\nsage: %time P.volume(engine='internal', measure='induced')\nCPU times: user 42.9 s, sys: 71.9 ms, total: 43 s\nWall time: 41.8 s\n1296*sqrt(6)\n```\n\nHowever, note that calculation of the affine hull takes quite some time in this case. So we leave the inexact normaliz option for now:\n\n```\nsage: %time P.volume(engine='normaliz', measure='induced')\nCPU times: user 710 ms, sys: 0 ns, total: 710 ms\nWall time: 92.3 ms\n3174.5387066469984\n```\n\nPossible follow ups:\n\nThere is probably a good and fast way to convert the lattice volume to the euclidean volume exactly. Also, once we can set up a normaliz polyhedron with both Vrep and Hrep, affine hull should be really quick.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28873\n\n",
    "closed_at": "2020-04-23T22:33:01Z",
    "created_at": "2019-12-12T07:50:39Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Implement ambient volume of polyhedron with normaliz",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28636",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @laisrast

Keywords: polyhedron, normaliz, ambient volume

We implement the ambient volume using backend normaliz.

This is done by return 0 or infinity if the polyhedron is not full-dimensional and not compact respectively.

Otherwise, we take the `induced_lattice` volume and divide by `factorial(self.dim())`.

See section 6.1.1 of the normaliz manual on how `induced_lattice` volume relates to euclidean volume: [https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf](https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf)

This is much faster than the current method, so we set this to default if backend is normaliz.

```
sage: P = polytopes.dodecahedron(backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 3.91 ms, sys: 0 ns, total: 3.91 ms
Wall time: 1.49 ms
-176*sqrt5 + 400
sage: %time P.volume(engine='internal')
CPU times: user 26.5 ms, sys: 332 µs, total: 26.9 ms
Wall time: 27.5 ms
-176*sqrt5 + 400
```

```
sage: P = polytopes.one_hundred_twenty_cell(backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 1.5 s, sys: 0 ns, total: 1.5 s
Wall time: 210 ms
120*sqrt5
sage: %time P.volume(engine='internal')
CPU times: user 8.61 s, sys: 14.7 ms, total: 8.63 s
Wall time: 8.63 s
120*sqrt5
```

```
sage: P = polytopes.hypercube(6, backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 2.33 ms, sys: 0 ns, total: 2.33 ms
Wall time: 2.34 ms
64
sage: %time P.volume(engine='internal')
CPU times: user 183 ms, sys: 32 µs, total: 183 ms
Wall time: 182 ms
64
```

This also speeds up calculation in case the polyhedron is not full-dimensional:

```
sage: P = polytopes.permutahedron(6, backend='normaliz')
sage: %time P.volume(measure='induced')
CPU times: user 37.7 s, sys: 42.4 ms, total: 37.7 s
Wall time: 24.2 s
1296*sqrt(6)
sage: %time P.volume(engine='internal', measure='induced')
CPU times: user 42.9 s, sys: 71.9 ms, total: 43 s
Wall time: 41.8 s
1296*sqrt(6)
```

However, note that calculation of the affine hull takes quite some time in this case. So we leave the inexact normaliz option for now:

```
sage: %time P.volume(engine='normaliz', measure='induced')
CPU times: user 710 ms, sys: 0 ns, total: 710 ms
Wall time: 92.3 ms
3174.5387066469984
```

Possible follow ups:

There is probably a good and fast way to convert the lattice volume to the euclidean volume exactly. Also, once we can set up a normaliz polyhedron with both Vrep and Hrep, affine hull should be really quick.

Issue created by migration from https://trac.sagemath.org/ticket/28873





---

archive/issue_comments_403890.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-12-12T07:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403890",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_403891.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-12T07:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403891",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_403892.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-12T07:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403892",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403893.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-12-26T21:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403893",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_403894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-26T21:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403895.json:
```json
{
    "body": "It should be noted that the conversion of the normaliz output does not work correctly when computing `Sublattice` for algebraic polyhedra.",
    "created_at": "2019-12-26T21:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403895",
    "user": "https://github.com/kliem"
}
```

It should be noted that the conversion of the normaliz output does not work correctly when computing `Sublattice` for algebraic polyhedra.



---

archive/issue_events_073042.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28636#event-73042"
}
```



---

archive/issue_comments_403896.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403896",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_403897.json:
```json
{
    "body": "Rebased.\n\n---\nNew commits:",
    "created_at": "2020-03-27T15:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403897",
    "user": "https://github.com/kliem"
}
```

Rebased.

---
New commits:



---

archive/issue_comments_403898.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403898",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_073043.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28636#event-73043"
}
```



---

archive/issue_events_073044.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28636#event-73044"
}
```



---

archive/issue_comments_403899.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-19T13:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403899",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_403900.json:
```json
{
    "body": "You should add the reference to the manual in the documentation of the function. That would be a good improvement.",
    "created_at": "2020-04-19T13:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403900",
    "user": "https://github.com/jplab"
}
```

You should add the reference to the manual in the documentation of the function. That would be a good improvement.



---

archive/issue_comments_403901.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-19T14:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403901",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_403902.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-19T14:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403902",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_403903.json:
```json
{
    "body": "It would be nice to have this in 9.1, if possible.",
    "created_at": "2020-04-19T14:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403903",
    "user": "https://github.com/kliem"
}
```

It would be nice to have this in 9.1, if possible.



---

archive/issue_comments_403904.json:
```json
{
    "body": "Is the following \"unimodual\" a typo? Is unimodular meant?\n\n```diff\n+        One other possibility is to compute the scaled volume where a unimodual\n```\n\nThere is also\n\n```diff\n+        volume of the unimodal simplex (or zero if not full-dimensional)::\n```\n\nUnimodular?\n\nCould you check if this occurs in the rest of the file too?\n\nOtherwise, the ticket looks good and the bots are green on 9.1rc0, so you can put this on positive review on my behalf once you considered the above comments.",
    "created_at": "2020-04-20T09:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403904",
    "user": "https://github.com/jplab"
}
```

Is the following "unimodual" a typo? Is unimodular meant?

```diff
+        One other possibility is to compute the scaled volume where a unimodual
```

There is also

```diff
+        volume of the unimodal simplex (or zero if not full-dimensional)::
```

Unimodular?

Could you check if this occurs in the rest of the file too?

Otherwise, the ticket looks good and the bots are green on 9.1rc0, so you can put this on positive review on my behalf once you considered the above comments.



---

archive/issue_comments_403905.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-20T09:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403905",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_403906.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-20T10:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_073045.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-20T10:29:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28636#event-73045"
}
```



---

archive/issue_events_073046.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-20T10:29:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28636#event-73046"
}
```



---

archive/issue_comments_403907.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-04-20T10:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403907",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_073047.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-23T22:33:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28636#event-73047"
}
```



---

archive/issue_comments_403908.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28636#issuecomment-403908",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
