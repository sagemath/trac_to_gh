# Issue 28951: Fixing a bug in sage.schemes.cyclic_covers.charpoly_frobenius

archive/issues_028714.json:
```json
{
    "body": "This fixes the following error\n\n```\n/Applications/sage-dev/local/lib/python2.7/site-packages/sage/schemes/cyclic_covers/charpoly_frobenius.pyc in charpoly_frobenius(frob_matrix, charpoly_prec, p, weight, a, known_factor)\n    220         if known_factor != [1]:\n    221             raise NotImplementedError()\n--> 222         for i in range(degree / 2):\n    223             p_power = p**min(\n    224                 charpoly_prec[i],\n\nTypeError: range() integer end argument expected, got float.\n```\n\nand I also add a test, to verify that the bug has been fixed.\n\nCC:  @alexjbest\n\nBranch/Commit: 264f9c1b4c8aa012db4a7cff46645edf7a6f658b\n\nReviewer: David Lowry-Duda\n\nAuthor: Edgar Costa\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28951\n\n",
    "closed_at": "2020-08-15T09:41:50Z",
    "created_at": "2020-01-04T18:42:25Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Fixing a bug in sage.schemes.cyclic_covers.charpoly_frobenius",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28951",
    "user": "https://github.com/edgarcosta"
}
```
This fixes the following error

```
/Applications/sage-dev/local/lib/python2.7/site-packages/sage/schemes/cyclic_covers/charpoly_frobenius.pyc in charpoly_frobenius(frob_matrix, charpoly_prec, p, weight, a, known_factor)
    220         if known_factor != [1]:
    221             raise NotImplementedError()
--> 222         for i in range(degree / 2):
    223             p_power = p**min(
    224                 charpoly_prec[i],

TypeError: range() integer end argument expected, got float.
```

and I also add a test, to verify that the bug has been fixed.

CC:  @alexjbest

Branch/Commit: 264f9c1b4c8aa012db4a7cff46645edf7a6f658b

Reviewer: David Lowry-Duda

Author: Edgar Costa

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28951





---

archive/issue_comments_555580.json:
```json
{
    "body": "<a id='comment:1'></a>\nyou could use `degree // 2`",
    "created_at": "2020-01-04T19:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555580",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
you could use `degree // 2`



---

archive/issue_comments_555581.json:
```json
{
    "body": "Changing commit from \"6fb150fc5149ccb21c51fbb1458696d00ea0725d\" to \"23674cf9fe5730d177a9df09c879a0a3e1e4438a\"",
    "created_at": "2020-01-04T19:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6fb150fc5149ccb21c51fbb1458696d00ea0725d" to "23674cf9fe5730d177a9df09c879a0a3e1e4438a"



---

archive/issue_comments_555582.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[23674cf](https://github.com/sagemath/sagetrac-mirror/commit/23674cf9fe5730d177a9df09c879a0a3e1e4438a)|`floor -> //`|",
    "created_at": "2020-01-04T19:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[23674cf](https://github.com/sagemath/sagetrac-mirror/commit/23674cf9fe5730d177a9df09c879a0a3e1e4438a)|`floor -> //`|



---

archive/issue_comments_555583.json:
```json
{
    "body": "<a id='comment:3'></a>\nI have replaced the `floor` by `//`.",
    "created_at": "2020-01-04T19:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555583",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:3'></a>
I have replaced the `floor` by `//`.



---

archive/issue_comments_555584.json:
```json
{
    "body": "<a id='comment:4'></a>\nAlex, could you review this?",
    "created_at": "2020-01-15T22:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555584",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:4'></a>
Alex, could you review this?



---

archive/issue_comments_555585.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-15T22:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555585",
    "user": "https://github.com/edgarcosta"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_555586.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis is not equivalent:\n\n```diff\n-    halfdegree = ceil(degree / 2) + 1\n+    halfdegree = degree // 2 + 1\n```\nInstead you have you use\n\n```python\n    halfdegree = (degree + 1) // 2 + 1\n```\nAlso, does the test matrix need to be so big?",
    "created_at": "2020-01-16T03:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555586",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
This is not equivalent:

```diff
-    halfdegree = ceil(degree / 2) + 1
+    halfdegree = degree // 2 + 1
```
Instead you have you use

```python
    halfdegree = (degree + 1) // 2 + 1
```
Also, does the test matrix need to be so big?



---

archive/issue_comments_555587.json:
```json
{
    "body": "<a id='comment:6'></a>\nMoving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555587",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_090675.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28951#event-90675"
}
```



---

archive/issue_comments_555588.json:
```json
{
    "body": "<a id='comment:7'></a>\nI looked into this for a bit today. After rebasing, this works as expected. But there is one aspect I don't understand, related to what tscrim pointed out before.\n\nI notice the current tests pass when the line \n\n```python\nhalfdegree = degree // 2 + 1\n```\n\nis replaced by the line\n\n```python\nhalfdegree = (degree + 1) // 2 + 1\n```\n\nbut not with either `(degree - 1)//2 + 1` or `(degree + 2)//2 + 1`. Thus sometimes the function behaves largely the same even when `halfdegree` differs by 1, but not always. I didn't track this dependence on parity, but this surprises me a little bit.",
    "created_at": "2020-08-10T18:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555588",
    "user": "https://github.com/davidlowryduda"
}
```

<a id='comment:7'></a>
I looked into this for a bit today. After rebasing, this works as expected. But there is one aspect I don't understand, related to what tscrim pointed out before.

I notice the current tests pass when the line 

```python
halfdegree = degree // 2 + 1
```

is replaced by the line

```python
halfdegree = (degree + 1) // 2 + 1
```

but not with either `(degree - 1)//2 + 1` or `(degree + 2)//2 + 1`. Thus sometimes the function behaves largely the same even when `halfdegree` differs by 1, but not always. I didn't track this dependence on parity, but this surprises me a little bit.



---

archive/issue_comments_555589.json:
```json
{
    "body": "Changing commit from \"23674cf9fe5730d177a9df09c879a0a3e1e4438a\" to \"093560f742fd40dc8e4652ef244e8371507e4acc\"",
    "created_at": "2020-08-13T20:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "23674cf9fe5730d177a9df09c879a0a3e1e4438a" to "093560f742fd40dc8e4652ef244e8371507e4acc"



---

archive/issue_comments_555590.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[134a13c](https://github.com/sagemath/sagetrac-mirror/commit/134a13c8d41e0d96663d0e9876b7950363e2cb88)|`Merge branch 'develop' into halfdegree`|\n|[093560f](https://github.com/sagemath/sagetrac-mirror/commit/093560f742fd40dc8e4652ef244e8371507e4acc)|`smaller example, and some comments`|",
    "created_at": "2020-08-13T20:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555590",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[134a13c](https://github.com/sagemath/sagetrac-mirror/commit/134a13c8d41e0d96663d0e9876b7950363e2cb88)|`Merge branch 'develop' into halfdegree`|
|[093560f](https://github.com/sagemath/sagetrac-mirror/commit/093560f742fd40dc8e4652ef244e8371507e4acc)|`smaller example, and some comments`|



---

archive/issue_comments_555591.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[0b5752d](https://github.com/sagemath/sagetrac-mirror/commit/0b5752d01aa70dfefab72e0d300a893ac732a08f)|`comments, and moving stuff around`|",
    "created_at": "2020-08-13T20:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555591",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[0b5752d](https://github.com/sagemath/sagetrac-mirror/commit/0b5752d01aa70dfefab72e0d300a893ac732a08f)|`comments, and moving stuff around`|



---

archive/issue_comments_555592.json:
```json
{
    "body": "Changing commit from \"093560f742fd40dc8e4652ef244e8371507e4acc\" to \"0b5752d01aa70dfefab72e0d300a893ac732a08f\"",
    "created_at": "2020-08-13T20:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "093560f742fd40dc8e4652ef244e8371507e4acc" to "0b5752d01aa70dfefab72e0d300a893ac732a08f"



---

archive/issue_comments_555593.json:
```json
{
    "body": "Changing commit from \"0b5752d01aa70dfefab72e0d300a893ac732a08f\" to \"42c2a858a1407e955e4d67e5ae95bde3733f01db\"",
    "created_at": "2020-08-13T21:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0b5752d01aa70dfefab72e0d300a893ac732a08f" to "42c2a858a1407e955e4d67e5ae95bde3733f01db"



---

archive/issue_comments_555594.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------|\n|[42c2a85](https://github.com/sagemath/sagetrac-mirror/commit/42c2a858a1407e955e4d67e5ae95bde3733f01db)|`typo`|",
    "created_at": "2020-08-13T21:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------|
|[42c2a85](https://github.com/sagemath/sagetrac-mirror/commit/42c2a858a1407e955e4d67e5ae95bde3733f01db)|`typo`|



---

archive/issue_comments_555595.json:
```json
{
    "body": "<a id='comment:11'></a>\n0- I have replaced the original example with a smaller example.\n\n1- I have replaced the original `degree/2` with `(degree + 1)//2`, as I'm comparing the ith coefficient and  (degree - i)th coefficient to figure out the sign of functional equation.\nIn the case that degree is even, I don't want to compare the middle coefficient against itself.\nSo, if `degree=2n` the loop ranges over `0,...,n-1`, and if `degree=2n+1`, the degree loops over `0, ..., n`.\n\n2- I replaced `halfdegree = ceil(degree / 2) + 1` with `degree // 2 + 1`. This is the number \nof coefficients that we will compute, so if `degree=2n` or `degree=2n+1` we will compute the coefficients `0, ...,n`. In the previous version we were unecessarily computing one extra coefficient.",
    "created_at": "2020-08-13T21:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555595",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:11'></a>
0- I have replaced the original example with a smaller example.

1- I have replaced the original `degree/2` with `(degree + 1)//2`, as I'm comparing the ith coefficient and  (degree - i)th coefficient to figure out the sign of functional equation.
In the case that degree is even, I don't want to compare the middle coefficient against itself.
So, if `degree=2n` the loop ranges over `0,...,n-1`, and if `degree=2n+1`, the degree loops over `0, ..., n`.

2- I replaced `halfdegree = ceil(degree / 2) + 1` with `degree // 2 + 1`. This is the number 
of coefficients that we will compute, so if `degree=2n` or `degree=2n+1` we will compute the coefficients `0, ...,n`. In the previous version we were unecessarily computing one extra coefficient.



---

archive/issue_comments_555596.json:
```json
{
    "body": "<a id='comment:12'></a>\nThere is a new division by two in the power of p :\n\n```\np**(a * degree * weight / 2)\n```\nmaybe it could use an exact division `//` ?",
    "created_at": "2020-08-14T06:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555596",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
There is a new division by two in the power of p :

```
p**(a * degree * weight / 2)
```
maybe it could use an exact division `//` ?



---

archive/issue_comments_555597.json:
```json
{
    "body": "Changing commit from \"42c2a858a1407e955e4d67e5ae95bde3733f01db\" to \"264f9c1b4c8aa012db4a7cff46645edf7a6f658b\"",
    "created_at": "2020-08-14T19:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "42c2a858a1407e955e4d67e5ae95bde3733f01db" to "264f9c1b4c8aa012db4a7cff46645edf7a6f658b"



---

archive/issue_comments_555598.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[264f9c1](https://github.com/sagemath/sagetrac-mirror/commit/264f9c1b4c8aa012db4a7cff46645edf7a6f658b)|`integer div`|",
    "created_at": "2020-08-14T19:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[264f9c1](https://github.com/sagemath/sagetrac-mirror/commit/264f9c1b4c8aa012db4a7cff46645edf7a6f658b)|`integer div`|



---

archive/issue_comments_555599.json:
```json
{
    "body": "<a id='comment:14'></a>\nThose are irrelevant as degree*weight is always even, but to avoid any confusion I converted every division to integer division",
    "created_at": "2020-08-14T19:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555599",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:14'></a>
Those are irrelevant as degree*weight is always even, but to avoid any confusion I converted every division to integer division



---

archive/issue_comments_555600.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Lowry-Duda\"",
    "created_at": "2020-08-14T20:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555600",
    "user": "https://github.com/davidlowryduda"
}
```

Changing reviewer from "" to "David Lowry-Duda"



---

archive/issue_comments_555601.json:
```json
{
    "body": "<a id='comment:15'></a>\nExcellent. This looks good to me. When patchbot finishes, this can be set to a positive review.",
    "created_at": "2020-08-14T20:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555601",
    "user": "https://github.com/davidlowryduda"
}
```

<a id='comment:15'></a>
Excellent. This looks good to me. When patchbot finishes, this can be set to a positive review.



---

archive/issue_comments_555602.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-14T21:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555602",
    "user": "https://github.com/davidlowryduda"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_090676.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-15T09:41:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28951#event-90676"
}
```



---

archive/issue_comments_555603.json:
```json
{
    "body": "Changing branch from \"public/halfdegree\" to \"264f9c1b4c8aa012db4a7cff46645edf7a6f658b\"",
    "created_at": "2020-08-15T09:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555603",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/halfdegree" to "264f9c1b4c8aa012db4a7cff46645edf7a6f658b"



---

archive/issue_comments_555604.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-15T09:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28951#issuecomment-555604",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
