# Issue 28328: Fix base ring conversion of non-associative unital algebras

archive/issues_028091.json:
```json
{
    "body": "When trying to construct a non-associative unital algebra, we get a boom:\n\n```\nsage: from sage.categories.magmatic_algebras import MagmaticAlgebras\nsage: C = MagmaticAlgebras(QQ).WithBasis().Unital()\nsage: F = CombinatorialFreeModule(QQ, (1,), category=C)\n...\nValueError: Free module generated by {1} over Rational Field is not in Category of rings\n```\n\nWhere do rings come into play? Line 107 in unital_algebras.py:\n\n```\nH = Hom(base_ring, self, Rings()) # TODO: non associative ring!\n```\n\n\nBranch/Commit: 3d4b6aa6808d633888142e6cd3b99c68a7e91779\n\nReviewer: Travis Scrimshaw\n\nAuthor: Michael Orlitzky\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28328\n\n",
    "closed_at": "2019-08-12T19:44:22Z",
    "created_at": "2019-08-06T18:24:34Z",
    "labels": [
        "component: categories",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Fix base ring conversion of non-associative unital algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28328",
    "user": "https://github.com/orlitzky"
}
```
When trying to construct a non-associative unital algebra, we get a boom:

```
sage: from sage.categories.magmatic_algebras import MagmaticAlgebras
sage: C = MagmaticAlgebras(QQ).WithBasis().Unital()
sage: F = CombinatorialFreeModule(QQ, (1,), category=C)
...
ValueError: Free module generated by {1} over Rational Field is not in Category of rings
```

Where do rings come into play? Line 107 in unital_algebras.py:

```
H = Hom(base_ring, self, Rings()) # TODO: non associative ring!
```


Branch/Commit: 3d4b6aa6808d633888142e6cd3b99c68a7e91779

Reviewer: Travis Scrimshaw

Author: Michael Orlitzky

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28328





---

archive/issue_comments_396429.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-08-06T18:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396429",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_396430.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-06T18:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396430",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_396431.json:
```json
{
    "body": "<a id='comment:2'></a>I do not quite agree with the comment in the `else:` part (because I also do not agree with the original comment). Mainly, as an algebra over what? Well, we probably should have that that every ring is an algebra over itself, but I am a little less sure of the axioms of an algebra over a non-associative ring. I think that requires more care in general, but it is a little too far from my expertise to say for certain. Do you know of any references about this?\n\nSo I think `Magmas().Unital()` is good, but you can also use the join category with `CommutativeAdditiveGroups()` and add in the distributive axiom to make it have more of the properties you want/expect.",
    "created_at": "2019-08-09T20:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396431",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>I do not quite agree with the comment in the `else:` part (because I also do not agree with the original comment). Mainly, as an algebra over what? Well, we probably should have that that every ring is an algebra over itself, but I am a little less sure of the axioms of an algebra over a non-associative ring. I think that requires more care in general, but it is a little too far from my expertise to say for certain. Do you know of any references about this?

So I think `Magmas().Unital()` is good, but you can also use the join category with `CommutativeAdditiveGroups()` and add in the distributive axiom to make it have more of the properties you want/expect.



---

archive/issue_comments_396432.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 tscrim]:\n> I do not quite agree with the comment in the `else:` part (because I also do not agree with the original comment). Mainly, as an algebra over what? Well, we probably should have that that every ring is an algebra over itself, but I am a little less sure of the axioms of an algebra over a non-associative ring. I think that requires more care in general, but it is a little too far from my expertise to say for certain. Do you know of any references about this?\n\n\nIn Sage, all rings are associative, so we don't have to worry about that.\n\nUltimately, all this function wants to do is construct a function that takes a scalar (in the base ring) to the same multiple of the algebra's unit element (in the algebra). So, for example, \"r\" maps to \"r*I\" if \"I\" is the algebra's multiplicative identity. The problem is that, since this is a coercion, the aforementioned function needs to be a morphism, and thus it needs to live in some category/homset. Which one? A priori, the smallest one that works: and since this is a method on unital algebras, the category of unital algebras would be perfect. But, alas, not every ring lives in the category of unital algebras in Sage, so that category won't work, and we have to weasel around the issue.\n\nLike you said, every (associative) ring should be an (associative) unital algebra over itself. The category of magmatic algebras is not *necessarily* associative, but that doesn't matter. Since e.g. the rationals form an associative unital algebra over themselves, they also form a not-necessarily-associative unital algebra. So that category *should* work, and is why I repeated the comment in the `else:` clause.\n\n\n> \n> So I think `Magmas().Unital()` is good, but you can also use the join category with `CommutativeAdditiveGroups()` and add in the distributive axiom to make it have more of the properties you want/expect.\n\n\nThe category here is only used while building the parent homset of the coercion that gets invoked in e.g. `A(3)`. Is that map or its homset even user-visible? Your category is more accurate, but it feels like overkill if the category information is essentially tossed out as soon as the algebra is constructed. I'm willing to change it in any case.",
    "created_at": "2019-08-09T22:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396432",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>Replying to [comment:2 tscrim]:
> I do not quite agree with the comment in the `else:` part (because I also do not agree with the original comment). Mainly, as an algebra over what? Well, we probably should have that that every ring is an algebra over itself, but I am a little less sure of the axioms of an algebra over a non-associative ring. I think that requires more care in general, but it is a little too far from my expertise to say for certain. Do you know of any references about this?


In Sage, all rings are associative, so we don't have to worry about that.

Ultimately, all this function wants to do is construct a function that takes a scalar (in the base ring) to the same multiple of the algebra's unit element (in the algebra). So, for example, "r" maps to "r*I" if "I" is the algebra's multiplicative identity. The problem is that, since this is a coercion, the aforementioned function needs to be a morphism, and thus it needs to live in some category/homset. Which one? A priori, the smallest one that works: and since this is a method on unital algebras, the category of unital algebras would be perfect. But, alas, not every ring lives in the category of unital algebras in Sage, so that category won't work, and we have to weasel around the issue.

Like you said, every (associative) ring should be an (associative) unital algebra over itself. The category of magmatic algebras is not *necessarily* associative, but that doesn't matter. Since e.g. the rationals form an associative unital algebra over themselves, they also form a not-necessarily-associative unital algebra. So that category *should* work, and is why I repeated the comment in the `else:` clause.


> 
> So I think `Magmas().Unital()` is good, but you can also use the join category with `CommutativeAdditiveGroups()` and add in the distributive axiom to make it have more of the properties you want/expect.


The category here is only used while building the parent homset of the coercion that gets invoked in e.g. `A(3)`. Is that map or its homset even user-visible? Your category is more accurate, but it feels like overkill if the category information is essentially tossed out as soon as the algebra is constructed. I'm willing to change it in any case.



---

archive/issue_comments_396433.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 mjo]:\n> Replying to [comment:2 tscrim]:\n> > I do not quite agree with the comment in the `else:` part (because I also do not agree with the original comment). Mainly, as an algebra over what? Well, we probably should have that that every ring is an algebra over itself, but I am a little less sure of the axioms of an algebra over a non-associative ring. I think that requires more care in general, but it is a little too far from my expertise to say for certain. Do you know of any references about this?\n\n> \n> In Sage, all rings are associative, so we don't have to worry about that.\n> \n> Ultimately, all this function wants to do is construct a function that takes a scalar (in the base ring) to the same multiple of the algebra's unit element (in the algebra). So, for example, \"r\" maps to \"r*I\" if \"I\" is the algebra's multiplicative identity. The problem is that, since this is a coercion, the aforementioned function needs to be a morphism, and thus it needs to live in some category/homset. Which one? A priori, the smallest one that works: and since this is a method on unital algebras, the category of unital algebras would be perfect. But, alas, not every ring lives in the category of unital algebras in Sage, so that category won't work, and we have to weasel around the issue.\n> \n> Like you said, every (associative) ring should be an (associative) unital algebra over itself. The category of magmatic algebras is not *necessarily* associative, but that doesn't matter. Since e.g. the rationals form an associative unital algebra over themselves, they also form a not-necessarily-associative unital algebra. So that category *should* work, and is why I repeated the comment in the `else:` clause.\n\n\nWhat I am asking about is the notion of an algebra over a non-associative ring. This is far less structured from what I can gather from a quick internet search. For example, an algebra `A` over a Lie algebra `L` should satisfy\n\n```\n   [x,y]a = x(ya) - y(xa)\n```\nfor all `x,y \\in L` and `a \\in A` because you also want it to be a Lie algebra module/representation. In this case, it makes it equivalently an algebra over the universal enveloping algebra of `L` (in other words, over an equivalent associative algebra). In short, I am asking what the analogous axiom for the usual scalar axiom `(xy)v = x(yv)` should be. Just require that the base should have an (natural) action? I am guessing you have a specific use-case for this and likely some extra structure. Maybe this is not important, but I am slightly worried about it being an honest morphism. In general, I do agree with you that it should work.\n\n> > So I think `Magmas().Unital()` is good, but you can also use the join category with `CommutativeAdditiveGroups()` and add in the distributive axiom to make it have more of the properties you want/expect.\n\n> \n> The category here is only used while building the parent homset of the coercion that gets invoked in e.g. `A(3)`. Is that map or its homset even user-visible? Your category is more accurate, but it feels like overkill if the category information is essentially tossed out as soon as the algebra is constructed. I'm willing to change it in any case.\n\n\nSo for `R` acting on the `R`-algebra `A`, you ask for the coercion map from `R` to `A` you get the morphism. This means the homset is also available to the user. I think it is better to be more explicit with the category when possible. It also makes it more future-proof should extra features get added.",
    "created_at": "2019-08-10T00:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396433",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>Replying to [comment:3 mjo]:
> Replying to [comment:2 tscrim]:
> > I do not quite agree with the comment in the `else:` part (because I also do not agree with the original comment). Mainly, as an algebra over what? Well, we probably should have that that every ring is an algebra over itself, but I am a little less sure of the axioms of an algebra over a non-associative ring. I think that requires more care in general, but it is a little too far from my expertise to say for certain. Do you know of any references about this?

> 
> In Sage, all rings are associative, so we don't have to worry about that.
> 
> Ultimately, all this function wants to do is construct a function that takes a scalar (in the base ring) to the same multiple of the algebra's unit element (in the algebra). So, for example, "r" maps to "r*I" if "I" is the algebra's multiplicative identity. The problem is that, since this is a coercion, the aforementioned function needs to be a morphism, and thus it needs to live in some category/homset. Which one? A priori, the smallest one that works: and since this is a method on unital algebras, the category of unital algebras would be perfect. But, alas, not every ring lives in the category of unital algebras in Sage, so that category won't work, and we have to weasel around the issue.
> 
> Like you said, every (associative) ring should be an (associative) unital algebra over itself. The category of magmatic algebras is not *necessarily* associative, but that doesn't matter. Since e.g. the rationals form an associative unital algebra over themselves, they also form a not-necessarily-associative unital algebra. So that category *should* work, and is why I repeated the comment in the `else:` clause.


What I am asking about is the notion of an algebra over a non-associative ring. This is far less structured from what I can gather from a quick internet search. For example, an algebra `A` over a Lie algebra `L` should satisfy

```
   [x,y]a = x(ya) - y(xa)
```
for all `x,y \in L` and `a \in A` because you also want it to be a Lie algebra module/representation. In this case, it makes it equivalently an algebra over the universal enveloping algebra of `L` (in other words, over an equivalent associative algebra). In short, I am asking what the analogous axiom for the usual scalar axiom `(xy)v = x(yv)` should be. Just require that the base should have an (natural) action? I am guessing you have a specific use-case for this and likely some extra structure. Maybe this is not important, but I am slightly worried about it being an honest morphism. In general, I do agree with you that it should work.

> > So I think `Magmas().Unital()` is good, but you can also use the join category with `CommutativeAdditiveGroups()` and add in the distributive axiom to make it have more of the properties you want/expect.

> 
> The category here is only used while building the parent homset of the coercion that gets invoked in e.g. `A(3)`. Is that map or its homset even user-visible? Your category is more accurate, but it feels like overkill if the category information is essentially tossed out as soon as the algebra is constructed. I'm willing to change it in any case.


So for `R` acting on the `R`-algebra `A`, you ask for the coercion map from `R` to `A` you get the morphism. This means the homset is also available to the user. I think it is better to be more explicit with the category when possible. It also makes it more future-proof should extra features get added.



---

archive/issue_comments_396434.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 tscrim]:\n> \n> What I am asking about is the notion of an algebra over a non-associative ring. This is far less structured from what I can gather from a quick internet search... I am guessing you have a specific use-case for this and likely some extra structure. Maybe this is not important, but I am slightly worried about it being an honest morphism.\n\n\nBut where does the non-associative ring come into play? I certainly don't have one in mind.\n\nThe `base_ring` in this section of the code is really a ring as far as sage is concerned, and ring multiplication is associative by definition in sage. My algebra multiplication isn't associative, so my algebra with vector addition/multiplication does *not* form a ring in sage -- that's why the existing \"if\" case doesn't work for me. But my algebra is still a magmatic algebra, since `MagmaticAlgebras(...)` are not necessarily associative.\n\nMathematically, the base ring should be an (associative) algebra over itself. Thus it would also be a non-necessarily-associative algebra over itself, and a morphism of not-necessarily-associative algebras would suffice. I don't think there's anything intricate to verify here: the base ring is still associative, it's only the algebra multiplication that isn't.\n\nFWIW, my Euclidean Jordan algebra code is public,\n\n  http://gitweb.michael.orlitzky.com/?p=sage.d.git\n\nand that's the only use case I have in mind. For now I still have the ` _no_generic_basering_coercion = True` hack in there.\n\n\n> So for `R` acting on the `R`-algebra `A`, you ask for the coercion map from `R` to `A` you get the morphism. This means the homset is also available to the user. I think it is better to be more explicit with the category when possible. It also makes it more future-proof should extra features get added.\n\n\nOk, no problem.",
    "created_at": "2019-08-10T00:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396434",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>Replying to [comment:4 tscrim]:
> 
> What I am asking about is the notion of an algebra over a non-associative ring. This is far less structured from what I can gather from a quick internet search... I am guessing you have a specific use-case for this and likely some extra structure. Maybe this is not important, but I am slightly worried about it being an honest morphism.


But where does the non-associative ring come into play? I certainly don't have one in mind.

The `base_ring` in this section of the code is really a ring as far as sage is concerned, and ring multiplication is associative by definition in sage. My algebra multiplication isn't associative, so my algebra with vector addition/multiplication does *not* form a ring in sage -- that's why the existing "if" case doesn't work for me. But my algebra is still a magmatic algebra, since `MagmaticAlgebras(...)` are not necessarily associative.

Mathematically, the base ring should be an (associative) algebra over itself. Thus it would also be a non-necessarily-associative algebra over itself, and a morphism of not-necessarily-associative algebras would suffice. I don't think there's anything intricate to verify here: the base ring is still associative, it's only the algebra multiplication that isn't.

FWIW, my Euclidean Jordan algebra code is public,

  http://gitweb.michael.orlitzky.com/?p=sage.d.git

and that's the only use case I have in mind. For now I still have the ` _no_generic_basering_coercion = True` hack in there.


> So for `R` acting on the `R`-algebra `A`, you ask for the coercion map from `R` to `A` you get the morphism. This means the homset is also available to the user. I think it is better to be more explicit with the category when possible. It also makes it more future-proof should extra features get added.


Ok, no problem.



---

archive/issue_comments_396435.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-10T13:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_396436.json:
```json
{
    "body": "<a id='comment:7'></a>I pushed a commit to use the category you suggested.",
    "created_at": "2019-08-10T13:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396436",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>I pushed a commit to use the category you suggested.



---

archive/issue_comments_396437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-10T23:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396437",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_396438.json:
```json
{
    "body": "<a id='comment:8'></a>Okay, that was a bit where my confusion was coming from. I was thinking you were allowing the base ring to not necessarily be associative. So that should still implicitly be there. Thanks for making the changes. I am still not very convinced by the else comment, but it makes the situation no worse than what is currently there. So I am going to set a positive review.",
    "created_at": "2019-08-10T23:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396438",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Okay, that was a bit where my confusion was coming from. I was thinking you were allowing the base ring to not necessarily be associative. So that should still implicitly be there. Thanks for making the changes. I am still not very convinced by the else comment, but it makes the situation no worse than what is currently there. So I am going to set a positive review.



---

archive/issue_comments_396439.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks, that comment is not particularly important to me, so if you have another suggestion I'm willing to change it. Ultimately, I think the solution will be to make all (associative) sage rings an algebra over themselves -- then the whole problem goes away.",
    "created_at": "2019-08-11T00:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396439",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'></a>Thanks, that comment is not particularly important to me, so if you have another suggestion I'm willing to change it. Ultimately, I think the solution will be to make all (associative) sage rings an algebra over themselves -- then the whole problem goes away.



---

archive/issue_events_070724.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-12T19:44:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28328#event-70724"
}
```



---

archive/issue_comments_396440.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-12T19:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28328#issuecomment-396440",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
