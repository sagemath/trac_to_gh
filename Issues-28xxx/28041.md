# Issue 28041: py3: Docker images for python3-based Sage

archive/issues_027804.json:
```json
{
    "body": "Docker images for python3-based Sage are useful in general,\nand in particular for continuous integration or other testing\nworkflows for packages that depend on Sage.\n\nThe infrastructure introduced by #24655 automatically produces\nDocker images for python2-based Sage. In order to extend it to\nalso produce python3-based ones,\n\n- we update the `micro_release` target for `make` in `Makefile`\n  to not remove the `config` directory\n\n- we adapt `.gitlab-ci.yml` and `docker/Dockerfile`,\n  duplicating all the docker targets for py3, creating\n  a `WITH_PYTHON` and a `DOCKER_TAG_SUFFIX`\n  environment variables, and using them in the shell\n  scripts `docker/*.sh`.\n\nTo play with the generated Python 2/3 docker images, you can go to https://gitlab-hooks-flau3jeaza-ew.a.run.app/status/trac/branch/u%2Fsaraedum%2F28041\n\nCC:  @saraedum zerline @roed314\n\nKeywords: docker, py3, gitlab-ci, days101\n\nBranch/Commit: ca243324e4d9706a0c189193beebec09eed33a2b\n\nReviewer: David Roe\n\nAuthor: Samuel Leli\u00e8vre, Julian R\u00fcth\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/28041\n\n",
    "closed_at": "2019-10-03T17:58:09Z",
    "created_at": "2019-06-21T15:35:56Z",
    "labels": [
        "component: distribution"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "py3: Docker images for python3-based Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28041",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```
Docker images for python3-based Sage are useful in general,
and in particular for continuous integration or other testing
workflows for packages that depend on Sage.

The infrastructure introduced by #24655 automatically produces
Docker images for python2-based Sage. In order to extend it to
also produce python3-based ones,

- we update the `micro_release` target for `make` in `Makefile`
  to not remove the `config` directory

- we adapt `.gitlab-ci.yml` and `docker/Dockerfile`,
  duplicating all the docker targets for py3, creating
  a `WITH_PYTHON` and a `DOCKER_TAG_SUFFIX`
  environment variables, and using them in the shell
  scripts `docker/*.sh`.

To play with the generated Python 2/3 docker images, you can go to https://gitlab-hooks-flau3jeaza-ew.a.run.app/status/trac/branch/u%2Fsaraedum%2F28041

CC:  @saraedum zerline @roed314

Keywords: docker, py3, gitlab-ci, days101

Branch/Commit: ca243324e4d9706a0c189193beebec09eed33a2b

Reviewer: David Roe

Author: Samuel Lelièvre, Julian Rüth

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/28041





---

archive/issue_comments_418079.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,15 +1,23 @@\n-Samuel Leli\u00e8vre ([\\`@\\`slel](https://gitlab.com/slel)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/22:\n+Docker images for python3-based Sage are useful in general,\n+and in particular for continuous integration or other testing\n+workflows for packages that depend on Sage.\n \n----\n+The infrastructure introduced by #24655 automatically produces\n+Docker images for python2-based Sage. In order to extend it to\n+also produce python3-based ones,\n \n-\\`\\`\\`markdown\n-Update .gitlab-ci.yml, Makefile, docker/Dockerfile, docker/build-docker.sh for Python 3.\n-\\`\\`\\`\n+- we update the \\`micro_release\\` target for \\`make\\` in \\`Makefile\\`\n+  to not remove the \\`config\\` directory\n \n+- we adapt \\`.gitlab-ci.yml\\` and \\`docker/Dockerfile\\`,\n+  duplicating all the docker targets for py3, creating\n+  a \\`WITH_PYTHON\\` and a \\`DOCKER_TAG_SUFFIX\\`\n+  environment variables, and using them in the shell\n+  scripts \\`docker/*.sh\\`.\n \n-\n-\n-\n+This ticket was created from a merge request opened by\n+Samuel Leli\u00e8vre ([\\`@\\`slel](https://gitlab.com/slel)) on GitLab\n+at https://gitlab.com/sagemath/sage/merge_requests/22.\n \n \n Author: Samuel Leli\u00e8vre\n```\n",
    "created_at": "2019-06-21T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418079",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,15 +1,23 @@
-Samuel Lelièvre ([\`@\`slel](https://gitlab.com/slel)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/22:
+Docker images for python3-based Sage are useful in general,
+and in particular for continuous integration or other testing
+workflows for packages that depend on Sage.
 
----
+The infrastructure introduced by #24655 automatically produces
+Docker images for python2-based Sage. In order to extend it to
+also produce python3-based ones,
 
-\`\`\`markdown
-Update .gitlab-ci.yml, Makefile, docker/Dockerfile, docker/build-docker.sh for Python 3.
-\`\`\`
+- we update the \`micro_release\` target for \`make\` in \`Makefile\`
+  to not remove the \`config\` directory
 
+- we adapt \`.gitlab-ci.yml\` and \`docker/Dockerfile\`,
+  duplicating all the docker targets for py3, creating
+  a \`WITH_PYTHON\` and a \`DOCKER_TAG_SUFFIX\`
+  environment variables, and using them in the shell
+  scripts \`docker/*.sh\`.
 
-
-
-
+This ticket was created from a merge request opened by
+Samuel Lelièvre ([\`@\`slel](https://gitlab.com/slel)) on GitLab
+at https://gitlab.com/sagemath/sage/merge_requests/22.
 
 
 Author: Samuel Lelièvre
```




---

archive/issue_comments_418080.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to distribution.",
    "created_at": "2019-06-21T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418080",
    "user": "https://github.com/slel"
}
```

Changing component from PLEASE CHANGE to distribution.



---

archive/issue_comments_418081.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-06-21T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418081",
    "user": "https://github.com/slel"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_418082.json:
```json
{
    "body": "Changing keywords from \"\" to \"docker, py3, gitlab-ci\".",
    "created_at": "2019-06-21T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418082",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "docker, py3, gitlab-ci".



---

archive/issue_comments_418083.json:
```json
{
    "body": "<a id='comment:2'></a>Still need to make the changes to the `docker/*.sh` shell scripts.",
    "created_at": "2019-06-21T16:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418083",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>Still need to make the changes to the `docker/*.sh` shell scripts.



---

archive/issue_comments_418084.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-21T17:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418084",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_418085.json:
```json
{
    "body": "Changing keywords from \"docker, py3, gitlab-ci\" to \"docker, py3, gitlab-ci, days101\".",
    "created_at": "2019-06-21T17:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418085",
    "user": "https://github.com/slel"
}
```

Changing keywords from "docker, py3, gitlab-ci" to "docker, py3, gitlab-ci, days101".



---

archive/issue_comments_418086.json:
```json
{
    "body": "<a id='comment:4'></a>I'm trying to get this working, but the build is stalling out at:\n\n```\nStep 61/80 : RUN sudo $SAGE_ROOT/sage --nodotsage -c \"install_scripts('/usr/bin')\"\n ---> Running in d4ce02ca02d6\nForcing sage-location, probably because a new package was installed.\nCleaning up, do not interrupt this.\nDone cleaning.\nTraceback (most recent call last):\n  File \"/home/sage/sage/src/bin/sage-eval\", line 4, in <module>\n    from sage.all import *\nImportError: No module named sage.all\nThe command '/bin/sh -c sudo $SAGE_ROOT/sage --nodotsage -c \"install_scripts('/usr/bin')\"' returned a non-zero code: 1\n```\n\nThe problem is that `SAGE_PYTHON_VERSION` is not being set properly when running `$SAGE_ROOT/sage`.\n\nThis is because there are *two* copies of `sage-env-config`, where `SAGE_PYTHON_VERSION` is defined:  One under `$SAGE_ROOT/src/bin` and one other `$SAGE_ROOT/local/bin`.  This is normal when doing Sage development, and I believe, if it exists, it's the one under `src/bin` that will be used by default when developing/building.\n\nThe problem in this case is that although the one in `local/bin` correctly has `SAGE_PYTHON_VERSION=3`, the one in `src/bin` still has `SAGE_PYTHON_VERSION=2` for some reason.\n\nI wonder if this is a remnant from an earlier build stage that was cached, but not properly updated for some reason (I thought that different `--build-arg` flags would avoid use incompatible cached images built with different `--build-arg`s, but it's possible that that arg isn't being included in the build early enough.",
    "created_at": "2019-07-03T13:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418086",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>I'm trying to get this working, but the build is stalling out at:

```
Step 61/80 : RUN sudo $SAGE_ROOT/sage --nodotsage -c "install_scripts('/usr/bin')"
 ---> Running in d4ce02ca02d6
Forcing sage-location, probably because a new package was installed.
Cleaning up, do not interrupt this.
Done cleaning.
Traceback (most recent call last):
  File "/home/sage/sage/src/bin/sage-eval", line 4, in <module>
    from sage.all import *
ImportError: No module named sage.all
The command '/bin/sh -c sudo $SAGE_ROOT/sage --nodotsage -c "install_scripts('/usr/bin')"' returned a non-zero code: 1
```

The problem is that `SAGE_PYTHON_VERSION` is not being set properly when running `$SAGE_ROOT/sage`.

This is because there are *two* copies of `sage-env-config`, where `SAGE_PYTHON_VERSION` is defined:  One under `$SAGE_ROOT/src/bin` and one other `$SAGE_ROOT/local/bin`.  This is normal when doing Sage development, and I believe, if it exists, it's the one under `src/bin` that will be used by default when developing/building.

The problem in this case is that although the one in `local/bin` correctly has `SAGE_PYTHON_VERSION=3`, the one in `src/bin` still has `SAGE_PYTHON_VERSION=2` for some reason.

I wonder if this is a remnant from an earlier build stage that was cached, but not properly updated for some reason (I thought that different `--build-arg` flags would avoid use incompatible cached images built with different `--build-arg`s, but it's possible that that arg isn't being included in the build early enough.



---

archive/issue_comments_418087.json:
```json
{
    "body": "<a id='comment:5'></a>The problem seems to start here:\n\n```\nStep 56/80 : RUN make micro_release\n ---> Using cache\n ---> 2fc1a353e2ac\n```\n\nWhen running `make micro_release`, `./configure` gets re-run, but without any flags we passed it previously.  So it doesn't preserve our `--with-python=3` from earlier.",
    "created_at": "2019-07-03T13:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418087",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>The problem seems to start here:

```
Step 56/80 : RUN make micro_release
 ---> Using cache
 ---> 2fc1a353e2ac
```

When running `make micro_release`, `./configure` gets re-run, but without any flags we passed it previously.  So it doesn't preserve our `--with-python=3` from earlier.



---

archive/issue_comments_418088.json:
```json
{
    "body": "<a id='comment:6'></a>(CC Odile who was interested in having a working Python 3 Docker image)",
    "created_at": "2019-07-03T13:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418088",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>(CC Odile who was interested in having a working Python 3 Docker image)



---

archive/issue_comments_418089.json:
```json
{
    "body": "<a id='comment:7'></a>Sorry for this. We had already figured the broken `./configure` when `micro_release` is run. I thought that Samuel had pushed a fix for this here already.",
    "created_at": "2019-07-03T13:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418089",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>Sorry for this. We had already figured the broken `./configure` when `micro_release` is run. I thought that Samuel had pushed a fix for this here already.



---

archive/issue_comments_418090.json:
```json
{
    "body": "<a id='comment:8'></a>Isn't the preservation of `config` good enough for this? (See the changeset here.)",
    "created_at": "2019-07-03T13:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418090",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:8'></a>Isn't the preservation of `config` good enough for this? (See the changeset here.)



---

archive/issue_comments_418091.json:
```json
{
    "body": "<a id='comment:9'></a>I was just about to say: I think the preservation of `config.status` is good enough in fact.",
    "created_at": "2019-07-03T13:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418091",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>I was just about to say: I think the preservation of `config.status` is good enough in fact.



---

archive/issue_comments_418092.json:
```json
{
    "body": "<a id='comment:10'></a>Specifically, one of the prereqs of `micro_release` is the `bdist-clean` target, which in turn calls `$(MAKE) misc-clean` which deletes `config.status`, forcing `configure` to be re-run.",
    "created_at": "2019-07-03T13:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418092",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>Specifically, one of the prereqs of `micro_release` is the `bdist-clean` target, which in turn calls `$(MAKE) misc-clean` which deletes `config.status`, forcing `configure` to be re-run.



---

archive/issue_comments_418093.json:
```json
{
    "body": "<a id='comment:11'></a>What the `bdist-clean`? Is this a automake target? Otherwise is it reasonable that the build system's config is visible after running it?",
    "created_at": "2019-07-03T13:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418093",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>What the `bdist-clean`? Is this a automake target? Otherwise is it reasonable that the build system's config is visible after running it?



---

archive/issue_comments_418094.json:
```json
{
    "body": "<a id='comment:12'></a>Not sure, but I think just swapping `sagelib-clean` and `bdist-clean` in the prereqs for `micro_release` should suffice.  It's fragile, but I think it will work.  Testing now.",
    "created_at": "2019-07-03T13:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418094",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Not sure, but I think just swapping `sagelib-clean` and `bdist-clean` in the prereqs for `micro_release` should suffice.  It's fragile, but I think it will work.  Testing now.



---

archive/issue_comments_418095.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 saraedum]:\n> What the `bdist-clean`? Is this a automake target? Otherwise is it reasonable that the build system's config is visible after running it?\n\n\nNo, this is just a pseudo-target in Sage's top-level Makefile.  I have no idea why specifically it's named that.  It's also used by the `fast-rebuild-clean` target.  It just calls `clean` (which is in `build/make/Makefile` for some reason), and then `misc-clean`.\n\nAll `clean` does apparently is:\n\n```\nclean:\n    @echo \"Deleting package build directories...\"\n    rm -rf \"$(SAGE_LOCAL)/var/tmp/sage/build\"\n```\n\nwhich is certainly worth doing.  But maybe this needs to be detangled a bit...",
    "created_at": "2019-07-03T13:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418095",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>Replying to [comment:11 saraedum]:
> What the `bdist-clean`? Is this a automake target? Otherwise is it reasonable that the build system's config is visible after running it?


No, this is just a pseudo-target in Sage's top-level Makefile.  I have no idea why specifically it's named that.  It's also used by the `fast-rebuild-clean` target.  It just calls `clean` (which is in `build/make/Makefile` for some reason), and then `misc-clean`.

All `clean` does apparently is:

```
clean:
    @echo "Deleting package build directories..."
    rm -rf "$(SAGE_LOCAL)/var/tmp/sage/build"
```

which is certainly worth doing.  But maybe this needs to be detangled a bit...



---

archive/issue_comments_418096.json:
```json
{
    "body": "<a id='comment:14'></a>The following files in `docker/` probably still need changes:\n\n- `build-docker.sh`\n- `pull-gitlab.sh`\n- `push-dockerhub.sh`\n- `push-gitlab.sh`\n- `setup-make-parallelity.sh`\n- `test-dev.sh`\n- `update-env.sh`",
    "created_at": "2019-07-03T14:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418096",
    "user": "https://github.com/slel"
}
```

<a id='comment:14'></a>The following files in `docker/` probably still need changes:

- `build-docker.sh`
- `pull-gitlab.sh`
- `push-dockerhub.sh`
- `push-gitlab.sh`
- `setup-make-parallelity.sh`
- `test-dev.sh`
- `update-env.sh`



---

archive/issue_comments_418097.json:
```json
{
    "body": "<a id='comment:15'></a>Yes, most likely.  One I just get the docker build working locally I will try adding all the other relevant updates.\n\nIt would be nice for starters to get *a* Python 3 image on Docker Hub, even if I have to push it manually, then get future ones building automatically.",
    "created_at": "2019-07-04T12:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418097",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>Yes, most likely.  One I just get the docker build working locally I will try adding all the other relevant updates.

It would be nice for starters to get *a* Python 3 image on Docker Hub, even if I have to push it manually, then get future ones building automatically.



---

archive/issue_comments_418098.json:
```json
{
    "body": "<a id='comment:16'></a>I think that once your Dockerfile goes through, you just need to add your branch to `build-from-clean`, pull your image from the [GitLab](GitLab) registry and push it to Docker Hub.",
    "created_at": "2019-07-04T16:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418098",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:16'></a>I think that once your Dockerfile goes through, you just need to add your branch to `build-from-clean`, pull your image from the [GitLab](GitLab) registry and push it to Docker Hub.



---

archive/issue_comments_418099.json:
```json
{
    "body": "<a id='comment:17'></a>For Odile's use I went ahead and pushed a prototype of this up to Dockerhub: sagemath/sagemath-dev-py3:alpha\n\nUnfortunately it still has a bug.  The `sage-entrypoint` still tries to run `make build` (understandably) which results in re-configuring (needlessly) and breaking things.\n\nA workaround for now is to set the PREREQ_OPTIONS variable which is used by Sage's top-level Makefile when it runs configure.  So you can set this when running the container like:\n\n```\ndocker run -ti --rm -e PREREQ_OPTIONS='--with-python=3' sagemath/sagemath-dev-py3:alpha\n```\n\nNext up, I think we should modify the Docker build to at least keep config.status so that this doesn't keep happening.",
    "created_at": "2019-07-09T16:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418099",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>For Odile's use I went ahead and pushed a prototype of this up to Dockerhub: sagemath/sagemath-dev-py3:alpha

Unfortunately it still has a bug.  The `sage-entrypoint` still tries to run `make build` (understandably) which results in re-configuring (needlessly) and breaking things.

A workaround for now is to set the PREREQ_OPTIONS variable which is used by Sage's top-level Makefile when it runs configure.  So you can set this when running the container like:

```
docker run -ti --rm -e PREREQ_OPTIONS='--with-python=3' sagemath/sagemath-dev-py3:alpha
```

Next up, I think we should modify the Docker build to at least keep config.status so that this doesn't keep happening.



---

archive/issue_comments_418100.json:
```json
{
    "body": "<a id='comment:18'></a>Apparently I was not able to successfully upload the Docker image to hub.docker.com because (AFAICT) of [this issue](https://github.com/moby/moby/issues/33558#issuecomment-510479853).\n\nBut I was able to upload it to our image registry on gitlab.com.   So try:\n\n```\ndocker run -ti --rm -e PREREQ_OPTIONS='--with-python=3' registry.gitlab.com/sagemath/dev/sage/sagemath-dev-py3:alpha\n```\n\nYou can also use this image as a base for another Docker image by doing something like:\n\n```\nFROM registry.gitlab.com/sagemath/dev/sage/sagemath-dev-py3:alpha\nENV PREREQ_OPTIONS='--with-python=3'\n...\n```\n\nThat is, you would ensure `PREREQ_OPTIONS` is set as an environment variable in the new image, by default.\n\nThis is not ideal and should be fixed, but it's a start anyways...",
    "created_at": "2019-07-11T14:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418100",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>Apparently I was not able to successfully upload the Docker image to hub.docker.com because (AFAICT) of [this issue](https://github.com/moby/moby/issues/33558#issuecomment-510479853).

But I was able to upload it to our image registry on gitlab.com.   So try:

```
docker run -ti --rm -e PREREQ_OPTIONS='--with-python=3' registry.gitlab.com/sagemath/dev/sage/sagemath-dev-py3:alpha
```

You can also use this image as a base for another Docker image by doing something like:

```
FROM registry.gitlab.com/sagemath/dev/sage/sagemath-dev-py3:alpha
ENV PREREQ_OPTIONS='--with-python=3'
...
```

That is, you would ensure `PREREQ_OPTIONS` is set as an environment variable in the new image, by default.

This is not ideal and should be fixed, but it's a start anyways...



---

archive/issue_comments_418101.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-19T19:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418102.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-19T19:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418103.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-19T20:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418104.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-08-19T20:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_418105.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T01:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418106.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T01:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418106",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418107.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T01:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418108.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T02:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418109.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T03:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418110.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-20T03:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418110",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_418111.json:
```json
{
    "body": "<a id='comment:31'></a>See #28367 for the related README update.",
    "created_at": "2019-08-20T03:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418111",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:31'></a>See #28367 for the related README update.



---

archive/issue_comments_418112.json:
```json
{
    "body": "<a id='comment:32'></a>We pushed initial docker `-py3` images to the Docker Hub.",
    "created_at": "2019-08-20T04:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418112",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:32'></a>We pushed initial docker `-py3` images to the Docker Hub.



---

archive/issue_comments_418113.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T04:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418114.json:
```json
{
    "body": "<a id='comment:34'></a>New commits:",
    "created_at": "2019-08-20T04:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418114",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:34'></a>New commits:



---

archive/issue_comments_418115.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-08-20T04:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418115",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_418116.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-20T23:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418116",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_418117.json:
```json
{
    "body": "<a id='comment:36'></a>When this is for sure ready can we squash some of these commits?",
    "created_at": "2019-08-21T10:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418117",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'></a>When this is for sure ready can we squash some of these commits?



---

archive/issue_comments_418118.json:
```json
{
    "body": "<a id='comment:37'></a>Just out of curiosity, is there a specific meaning to having a section in `.gitlab-ci.yml` that begins with a `.`, as in `.py3`?  Does that just emphasize that it's not a real build stage (rather a \"mix-in\" for multiple build stages)?  Or is that a syntax specifically recognized by the file format?\n\nIf I understand correctly, this is now keeping `config.status` in the image.  But what if someone runs `sage -i <some_optional_package>` in one of these py3 images?  In other words, if a user (or dockerfile author) does something that still results in `./configure` being re-run, will this keep the `--with-python=3` setting?\n\nI fear not, since we still haven't fully resolved #27373 (which related to system package settings specifically, but more broadly to retaining the values of flags passed to `./configure`).  The larger problem of course being that we have \"runtime\" features like `sage -i` that depend on running `./configure` at all...",
    "created_at": "2019-08-21T11:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418118",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>Just out of curiosity, is there a specific meaning to having a section in `.gitlab-ci.yml` that begins with a `.`, as in `.py3`?  Does that just emphasize that it's not a real build stage (rather a "mix-in" for multiple build stages)?  Or is that a syntax specifically recognized by the file format?

If I understand correctly, this is now keeping `config.status` in the image.  But what if someone runs `sage -i <some_optional_package>` in one of these py3 images?  In other words, if a user (or dockerfile author) does something that still results in `./configure` being re-run, will this keep the `--with-python=3` setting?

I fear not, since we still haven't fully resolved #27373 (which related to system package settings specifically, but more broadly to retaining the values of flags passed to `./configure`).  The larger problem of course being that we have "runtime" features like `sage -i` that depend on running `./configure` at all...



---

archive/issue_comments_418119.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:36 embray]:\n> When this is for sure ready can we squash some of these commits?\n\n\nFeel free to squash.",
    "created_at": "2019-08-21T14:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418119",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:38'></a>Replying to [comment:36 embray]:
> When this is for sure ready can we squash some of these commits?


Feel free to squash.



---

archive/issue_comments_418120.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:37 embray]:\n> Just out of curiosity, is there a specific meaning to having a section in `.gitlab-ci.yml` that begins with a `.`, as in `.py3`?  Does that just emphasize that it's not a real build stage (rather a \"mix-in\" for multiple build stages)?  Or is that a syntax specifically recognized by the file format?\n\n\nWithout out the `.` it would be a build job. As a default as port of the `test` stage I believe.\n\n> If I understand correctly, this is now keeping `config.status` in the image.  But what if someone runs `sage -i <some_optional_package>` in one of these py3 images?  In other words, if a user (or dockerfile author) does something that still results in `./configure` being re-run, will this keep the `--with-python=3` setting?\n\n\nDoes `sage -i` run `configure` when `config.status` is present?\n\n> I fear not, since we still haven't fully resolved #27373 (which related to system package settings specifically, but more broadly to retaining the values of flags passed to `./configure`).  The larger problem of course being that we have \"runtime\" features like `sage -i` that depend on running `./configure` at all...\n\n\nI don't think making `--with-python=3` persistent is within the scope of this ticket. But it's certainly a problem that we should be aware of.",
    "created_at": "2019-08-21T14:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418120",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:39'></a>Replying to [comment:37 embray]:
> Just out of curiosity, is there a specific meaning to having a section in `.gitlab-ci.yml` that begins with a `.`, as in `.py3`?  Does that just emphasize that it's not a real build stage (rather a "mix-in" for multiple build stages)?  Or is that a syntax specifically recognized by the file format?


Without out the `.` it would be a build job. As a default as port of the `test` stage I believe.

> If I understand correctly, this is now keeping `config.status` in the image.  But what if someone runs `sage -i <some_optional_package>` in one of these py3 images?  In other words, if a user (or dockerfile author) does something that still results in `./configure` being re-run, will this keep the `--with-python=3` setting?


Does `sage -i` run `configure` when `config.status` is present?

> I fear not, since we still haven't fully resolved #27373 (which related to system package settings specifically, but more broadly to retaining the values of flags passed to `./configure`).  The larger problem of course being that we have "runtime" features like `sage -i` that depend on running `./configure` at all...


I don't think making `--with-python=3` persistent is within the scope of this ticket. But it's certainly a problem that we should be aware of.



---

archive/issue_comments_418121.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-06T02:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418122.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-06T03:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418123.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-13T08:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418124.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-13T08:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_418125.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Docker images for python3-based Sage are useful in general,\n+and in particular for continuous integration or other testing\n+workflows for packages that depend on Sage.\n \n+The infrastructure introduced by #24655 automatically produces\n+Docker images for python2-based Sage. In order to extend it to\n+also produce python3-based ones,\n+\n+- we update the \\`micro_release\\` target for \\`make\\` in \\`Makefile\\`\n+  to not remove the \\`config\\` directory\n+\n+- we adapt \\`.gitlab-ci.yml\\` and \\`docker/Dockerfile\\`,\n+  duplicating all the docker targets for py3, creating\n+  a \\`WITH_PYTHON\\` and a \\`DOCKER_TAG_SUFFIX\\`\n+  environment variables, and using them in the shell\n+  scripts \\`docker/*.sh\\`.\n \n Author: Samuel Leli\u00e8vre\n \n```\n",
    "created_at": "2019-09-13T09:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418125",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Docker images for python3-based Sage are useful in general,
+and in particular for continuous integration or other testing
+workflows for packages that depend on Sage.
 
+The infrastructure introduced by #24655 automatically produces
+Docker images for python2-based Sage. In order to extend it to
+also produce python3-based ones,
+
+- we update the \`micro_release\` target for \`make\` in \`Makefile\`
+  to not remove the \`config\` directory
+
+- we adapt \`.gitlab-ci.yml\` and \`docker/Dockerfile\`,
+  duplicating all the docker targets for py3, creating
+  a \`WITH_PYTHON\` and a \`DOCKER_TAG_SUFFIX\`
+  environment variables, and using them in the shell
+  scripts \`docker/*.sh\`.
 
 Author: Samuel Lelièvre
 
```




---

archive/issue_comments_418126.json:
```json
{
    "body": "<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-13T09:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418127.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n+Docker images for python3-based Sage are useful in general,\n+and in particular for continuous integration or other testing\n+workflows for packages that depend on Sage.\n \n+The infrastructure introduced by #24655 automatically produces\n+Docker images for python2-based Sage. In order to extend it to\n+also produce python3-based ones,\n+\n+- we update the \\`micro_release\\` target for \\`make\\` in \\`Makefile\\`\n+  to not remove the \\`config\\` directory\n+\n+- we adapt \\`.gitlab-ci.yml\\` and \\`docker/Dockerfile\\`,\n+  duplicating all the docker targets for py3, creating\n+  a \\`WITH_PYTHON\\` and a \\`DOCKER_TAG_SUFFIX\\`\n+  environment variables, and using them in the shell\n+  scripts \\`docker/*.sh\\`.\n+\n+To play with the generated Python 2/3 docker images, you can go to https://gitlab-hooks-flau3jeaza-ew.a.run.app/status/trac/branch/u%2Fsaraedum%2F28041\n \n Author: Samuel Leli\u00e8vre\n \n```\n",
    "created_at": "2019-09-13T09:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418127",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,21 @@
+Docker images for python3-based Sage are useful in general,
+and in particular for continuous integration or other testing
+workflows for packages that depend on Sage.
 
+The infrastructure introduced by #24655 automatically produces
+Docker images for python2-based Sage. In order to extend it to
+also produce python3-based ones,
+
+- we update the \`micro_release\` target for \`make\` in \`Makefile\`
+  to not remove the \`config\` directory
+
+- we adapt \`.gitlab-ci.yml\` and \`docker/Dockerfile\`,
+  duplicating all the docker targets for py3, creating
+  a \`WITH_PYTHON\` and a \`DOCKER_TAG_SUFFIX\`
+  environment variables, and using them in the shell
+  scripts \`docker/*.sh\`.
+
+To play with the generated Python 2/3 docker images, you can go to https://gitlab-hooks-flau3jeaza-ew.a.run.app/status/trac/branch/u%2Fsaraedum%2F28041
 
 Author: Samuel Lelièvre
 
```




---

archive/issue_comments_418128.json:
```json
{
    "body": "<a id='comment:47'></a>the docker images should be available on binder shortly: https://gitlab.com/sagemath/dev/trac/pipelines/81996545",
    "created_at": "2019-09-13T09:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418128",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:47'></a>the docker images should be available on binder shortly: https://gitlab.com/sagemath/dev/trac/pipelines/81996545



---

archive/issue_comments_418129.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-13T09:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418130.json:
```json
{
    "body": "<a id='comment:50'></a>I started a full `build-from-clean` here: https://gitlab.com/sagemath/dev/trac/pipelines/82005383",
    "created_at": "2019-09-13T09:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418130",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:50'></a>I started a full `build-from-clean` here: https://gitlab.com/sagemath/dev/trac/pipelines/82005383



---

archive/issue_comments_418131.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-13T09:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418132.json:
```json
{
    "body": "<a id='comment:52'></a>The Python 2 and Python 3 images seem to be functional. (At least they work in Binder.)",
    "created_at": "2019-09-13T15:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418132",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:52'></a>The Python 2 and Python 3 images seem to be functional. (At least they work in Binder.)



---

archive/issue_comments_418133.json:
```json
{
    "body": "<a id='comment:53'></a>Looks good to me.  Both Python 2 and Python 3 built fine.",
    "created_at": "2019-09-13T22:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418133",
    "user": "https://github.com/roed314"
}
```

<a id='comment:53'></a>Looks good to me.  Both Python 2 and Python 3 built fine.



---

archive/issue_comments_418134.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-13T22:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418134",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418135.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-09-16T08:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418135",
    "user": "https://github.com/saraedum"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_418136.json:
```json
{
    "body": "<a id='comment:54'></a>Not sure if this comes from the changes here, but there's a `MAKEFLAGS=w -j -l7.8 --jobserver-fds=3,4 V=1` in the output. Let me try to see who put the `w` there.",
    "created_at": "2019-09-16T08:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418136",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:54'></a>Not sure if this comes from the changes here, but there's a `MAKEFLAGS=w -j -l7.8 --jobserver-fds=3,4 V=1` in the output. Let me try to see who put the `w` there.



---

archive/issue_comments_418137.json:
```json
{
    "body": "<a id='comment:55'></a>Ok. That's how it's supposed to work https://lists.gnu.org/archive/html/help-make/2016-03/msg00009.html.",
    "created_at": "2019-09-16T08:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418137",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:55'></a>Ok. That's how it's supposed to work https://lists.gnu.org/archive/html/help-make/2016-03/msg00009.html.



---

archive/issue_comments_418138.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-09-16T08:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418138",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_069507.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-30T08:12:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28041#event-69507"
}
```



---

archive/issue_comments_418139.json:
```json
{
    "body": "<a id='comment:56'></a>moving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418139",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:56'></a>moving milestone to 9.0 (after release of 8.9)



---

archive/issue_events_069508.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-03T17:58:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28041#event-69508"
}
```



---

archive/issue_comments_418140.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-03T17:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28041#issuecomment-418140",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
