# Issue 28760: py3: internet str vs bytes doctests failures

archive/issues_028523.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage -t --optional=sage,optional,external src/sage/coding/databases.py\n```\n\ngives\n\n```\n----------------------------------------------------------------------\nsage -t src/sage/coding/databases.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\nwith errors of that kind:\n\n```\nsage -t src/sage/coding/databases.py\n**********************************************************************\nFile \"src/sage/coding/databases.py\", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de\nFailed example:\n    L = codes.databases.best_linear_code_in_codetables_dot_de(72, 36, GF(2))    # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[0]>\", line 1, in <module>\n        L = codes.databases.best_linear_code_in_codetables_dot_de(Integer(72), Integer(36), GF(Integer(2)))    # optional - internet\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/coding/databases.py\", line 174, in best_linear_code_in_codetables_dot_de\n        i = s.find(\"<PRE>\")\n    TypeError: argument should be integer or bytes-like object, not 'str'\n**********************************************************************\n```\n\nBranch/Commit: **[1b000e1](https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/28760_\n\n",
    "closed_at": "2019-11-29T23:57:37Z",
    "created_at": "2019-11-19T08:47:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: internet str vs bytes doctests failures",
    "type": "issue",
    "updated_at": "2019-11-29T23:57:37Z",
    "url": "https://github.com/sagemath/sage/issues/28760",
    "user": "https://github.com/seblabbe"
}
```

```
sage -t --optional=sage,optional,external src/sage/coding/databases.py
```

gives

```
----------------------------------------------------------------------
sage -t src/sage/coding/databases.py  # 2 doctests failed
----------------------------------------------------------------------
```

with errors of that kind:

```
sage -t src/sage/coding/databases.py
**********************************************************************
File "src/sage/coding/databases.py", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de
Failed example:
    L = codes.databases.best_linear_code_in_codetables_dot_de(72, 36, GF(2))    # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[0]>", line 1, in <module>
        L = codes.databases.best_linear_code_in_codetables_dot_de(Integer(72), Integer(36), GF(Integer(2)))    # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/coding/databases.py", line 174, in best_linear_code_in_codetables_dot_de
        i = s.find("<PRE>")
    TypeError: argument should be integer or bytes-like object, not 'str'
**********************************************************************
```

Branch/Commit: **[1b000e1](https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898)**

Reviewer: **Sébastien Labbé**

Author: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/28760_





---

archive/issue_events_395021.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-19T08:47:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395021"
}
```



---

archive/issue_events_395022.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-19T08:47:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395022"
}
```



---

archive/issue_events_395023.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-19T08:47:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395023"
}
```



---

archive/issue_events_395024.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-19T08:47:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395024"
}
```



---

archive/issue_comments_448715.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,11 @@\n \n ```\n-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py  \n+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py\n ```\n \n gives\n \n ```\n-too many failed tests, not using stored timings\n-Running doctests with ID 2019-11-19-09-45-34-de2336ec.\n-Git branch: develop\n-Using --optional=4ti2,cbc,ccache,cryptominisat,dot2tex,e_antic,external,glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,pandoc_attributes,pycosat,pynormaliz,rst2ipynb,sage,sagenb\n-External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n-Doctesting 3 files.\n sage -t src/sage/coding/databases.py\n **********************************************************************\n File \"src/sage/coding/databases.py\", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de\n@@ -44,7 +38,7 @@\n **********************************************************************\n 1 item had failures:\n    2 of   3 in sage.coding.databases.best_linear_code_in_codetables_dot_de\n-    [7 tests, 2 failures, 1.17 s]\n+    [7 tests, 2 failures, 1.15 s]\n sage -t src/sage/repl/load.py\n **********************************************************************\n File \"src/sage/repl/load.py\", line 157, in sage.repl.load.load\n@@ -66,7 +60,7 @@\n **********************************************************************\n 1 item had failures:\n    1 of  36 in sage.repl.load.load\n-    [44 tests, 1 failure, 1.14 s]\n+    [44 tests, 1 failure, 0.99 s]\n sage -t src/sage/misc/latex.py\n **********************************************************************\n File \"src/sage/misc/latex.py\", line 1085, in sage.misc.latex.Latex.?\n@@ -86,14 +80,84 @@\n **********************************************************************\n 1 item had failures:\n    1 of   3 in sage.misc.latex.Latex.?\n-    [309 tests, 1 failure, 1.20 s]\n+    [309 tests, 1 failure, 1.19 s]\n+sage -t src/sage/misc/persist.pyx\n+**********************************************************************\n+File \"src/sage/misc/persist.pyx\", line 87, in sage.misc.persist.load\n+Failed example:\n+    s = load(u)                                                  # optional - internet\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.misc.persist.load[1]>\", line 1, in <module>\n+        s = load(u)                                                  # optional - internet\n+      File \"sage/misc/persist.pyx\", line 151, in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2710)\n+        filename = get_remote_file(filename, verbose=verbose)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py\", line 49, in get_remote_file\n+        f.write(content.read())\n+    TypeError: write() argument must be str, not bytes\n+**********************************************************************\n+File \"src/sage/misc/persist.pyx\", line 91, in sage.misc.persist.load\n+Failed example:\n+    s                                                            # optional - internet\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.misc.persist.load[2]>\", line 1, in <module>\n+        s                                                            # optional - internet\n+    NameError: name 's' is not defined\n+**********************************************************************\n+1 item had failures:\n+   2 of  20 in sage.misc.persist.load\n+    [163 tests, 2 failures, 1.01 s]\n+sage -t src/sage/misc/remote_file.py\n+**********************************************************************\n+File \"src/sage/misc/remote_file.py\", line 25, in sage.misc.remote_file.get_remote_file\n+Failed example:\n+    g = get_remote_file(url, verbose=False)      # optional - internet\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.misc.remote_file.get_remote_file[1]>\", line 1, in <module>\n+        g = get_remote_file(url, verbose=False)      # optional - internet\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py\", line 49, in get_remote_file\n+        f.write(content.read())\n+    TypeError: write() argument must be str, not bytes\n+**********************************************************************\n+File \"src/sage/misc/remote_file.py\", line 26, in sage.misc.remote_file.get_remote_file\n+Failed example:\n+    with open(g) as f: print(f.read())           # optional - internet\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.misc.remote_file.get_remote_file[2]>\", line 1, in <module>\n+        with open(g) as f: print(f.read())           # optional - internet\n+    NameError: name 'g' is not defined\n+**********************************************************************\n+1 item had failures:\n+   2 of   4 in sage.misc.remote_file.get_remote_file\n+    [3 tests, 2 failures, 0.08 s]\n ----------------------------------------------------------------------\n sage -t src/sage/coding/databases.py  # 2 doctests failed\n sage -t src/sage/repl/load.py  # 1 doctest failed\n sage -t src/sage/misc/latex.py  # 1 doctest failed\n+sage -t src/sage/misc/persist.pyx  # 2 doctests failed\n+sage -t src/sage/misc/remote_file.py  # 2 doctests failed\n ----------------------------------------------------------------------\n-Total time for all tests: 3.9 seconds\n-    cpu time: 1.3 seconds\n-    cumulative wall time: 3.5 seconds\n+Total time for all tests: 4.9 seconds\n+    cpu time: 1.8 seconds\n+    cumulative wall time: 4.4 seconds\n External software detected for doctesting: imagemagick,internet,latex\n ```\n``````\n",
    "created_at": "2019-11-19T08:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448715",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,11 @@
 
 ```
-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py  
+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py
 ```
 
 gives
 
 ```
-too many failed tests, not using stored timings
-Running doctests with ID 2019-11-19-09-45-34-de2336ec.
-Git branch: develop
-Using --optional=4ti2,cbc,ccache,cryptominisat,dot2tex,e_antic,external,glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,pandoc_attributes,pycosat,pynormaliz,rst2ipynb,sage,sagenb
-External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
-Doctesting 3 files.
 sage -t src/sage/coding/databases.py
 **********************************************************************
 File "src/sage/coding/databases.py", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de
@@ -44,7 +38,7 @@
 **********************************************************************
 1 item had failures:
    2 of   3 in sage.coding.databases.best_linear_code_in_codetables_dot_de
-    [7 tests, 2 failures, 1.17 s]
+    [7 tests, 2 failures, 1.15 s]
 sage -t src/sage/repl/load.py
 **********************************************************************
 File "src/sage/repl/load.py", line 157, in sage.repl.load.load
@@ -66,7 +60,7 @@
 **********************************************************************
 1 item had failures:
    1 of  36 in sage.repl.load.load
-    [44 tests, 1 failure, 1.14 s]
+    [44 tests, 1 failure, 0.99 s]
 sage -t src/sage/misc/latex.py
 **********************************************************************
 File "src/sage/misc/latex.py", line 1085, in sage.misc.latex.Latex.?
@@ -86,14 +80,84 @@
 **********************************************************************
 1 item had failures:
    1 of   3 in sage.misc.latex.Latex.?
-    [309 tests, 1 failure, 1.20 s]
+    [309 tests, 1 failure, 1.19 s]
+sage -t src/sage/misc/persist.pyx
+**********************************************************************
+File "src/sage/misc/persist.pyx", line 87, in sage.misc.persist.load
+Failed example:
+    s = load(u)                                                  # optional - internet
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.misc.persist.load[1]>", line 1, in <module>
+        s = load(u)                                                  # optional - internet
+      File "sage/misc/persist.pyx", line 151, in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2710)
+        filename = get_remote_file(filename, verbose=verbose)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py", line 49, in get_remote_file
+        f.write(content.read())
+    TypeError: write() argument must be str, not bytes
+**********************************************************************
+File "src/sage/misc/persist.pyx", line 91, in sage.misc.persist.load
+Failed example:
+    s                                                            # optional - internet
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.misc.persist.load[2]>", line 1, in <module>
+        s                                                            # optional - internet
+    NameError: name 's' is not defined
+**********************************************************************
+1 item had failures:
+   2 of  20 in sage.misc.persist.load
+    [163 tests, 2 failures, 1.01 s]
+sage -t src/sage/misc/remote_file.py
+**********************************************************************
+File "src/sage/misc/remote_file.py", line 25, in sage.misc.remote_file.get_remote_file
+Failed example:
+    g = get_remote_file(url, verbose=False)      # optional - internet
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.misc.remote_file.get_remote_file[1]>", line 1, in <module>
+        g = get_remote_file(url, verbose=False)      # optional - internet
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py", line 49, in get_remote_file
+        f.write(content.read())
+    TypeError: write() argument must be str, not bytes
+**********************************************************************
+File "src/sage/misc/remote_file.py", line 26, in sage.misc.remote_file.get_remote_file
+Failed example:
+    with open(g) as f: print(f.read())           # optional - internet
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.misc.remote_file.get_remote_file[2]>", line 1, in <module>
+        with open(g) as f: print(f.read())           # optional - internet
+    NameError: name 'g' is not defined
+**********************************************************************
+1 item had failures:
+   2 of   4 in sage.misc.remote_file.get_remote_file
+    [3 tests, 2 failures, 0.08 s]
 ----------------------------------------------------------------------
 sage -t src/sage/coding/databases.py  # 2 doctests failed
 sage -t src/sage/repl/load.py  # 1 doctest failed
 sage -t src/sage/misc/latex.py  # 1 doctest failed
+sage -t src/sage/misc/persist.pyx  # 2 doctests failed
+sage -t src/sage/misc/remote_file.py  # 2 doctests failed
 ----------------------------------------------------------------------
-Total time for all tests: 3.9 seconds
-    cpu time: 1.3 seconds
-    cumulative wall time: 3.5 seconds
+Total time for all tests: 4.9 seconds
+    cpu time: 1.8 seconds
+    cumulative wall time: 4.4 seconds
 External software detected for doctesting: imagemagick,internet,latex
 ```
``````




---

archive/issue_comments_448716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py\n+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py src/sage/plot/animate.py\n ```\n \n gives\n@@ -150,11 +150,110 @@\n    2 of   4 in sage.misc.remote_file.get_remote_file\n     [3 tests, 2 failures, 0.08 s]\n ----------------------------------------------------------------------\n+sage -t src/sage/plot/animate.py\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 563, in sage.plot.animate.Animation.?\n+Failed example:\n+    with open(td + 'my_animation.gif', 'rb') as f: print('\\x21\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.?[3]>\", line 1, in <module>\n+        with open(td + 'my_animation.gif', 'rb') as f: print('\\x21\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 1056, in sage.plot.animate.Animation.save\n+Failed example:\n+    with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.save[8]>\", line 1, in <module>\n+        with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 1058, in sage.plot.animate.Animation.save\n+Failed example:\n+    with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.save[9]>\", line 1, in <module>\n+        with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 1061, in sage.plot.animate.Animation.save\n+Failed example:\n+    with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.save[11]>\", line 1, in <module>\n+        with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 1063, in sage.plot.animate.Animation.save\n+Failed example:\n+    with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.save[12]>\", line 1, in <module>\n+        with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 1066, in sage.plot.animate.Animation.save\n+Failed example:\n+    with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.save[14]>\", line 1, in <module>\n+        with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+File \"src/sage/plot/animate.py\", line 1068, in sage.plot.animate.Animation.save\n+Failed example:\n+    with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x03\\x00\\x00' in f.read())  # optional -- ImageMagick\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.plot.animate.Animation.save[15]>\", line 1, in <module>\n+        with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x03\\x00\\x00' in f.read())  # optional -- ImageMagick\n+    TypeError: a bytes-like object is required, not 'str'\n+**********************************************************************\n+2 items had failures:\n+   1 of  15 in sage.plot.animate.Animation.?\n+   6 of  17 in sage.plot.animate.Animation.save\n+    [225 tests, 7 failures, 58.39 s]\n+----------------------------------------------------------------------\n sage -t src/sage/coding/databases.py  # 2 doctests failed\n sage -t src/sage/repl/load.py  # 1 doctest failed\n sage -t src/sage/misc/latex.py  # 1 doctest failed\n sage -t src/sage/misc/persist.pyx  # 2 doctests failed\n sage -t src/sage/misc/remote_file.py  # 2 doctests failed\n+sage -t src/sage/plot/animate.py  # 7 doctests failed\n ----------------------------------------------------------------------\n Total time for all tests: 4.9 seconds\n     cpu time: 1.8 seconds\n``````\n",
    "created_at": "2019-11-19T08:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448716",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py
+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py src/sage/plot/animate.py
 ```
 
 gives
@@ -150,11 +150,110 @@
    2 of   4 in sage.misc.remote_file.get_remote_file
     [3 tests, 2 failures, 0.08 s]
 ----------------------------------------------------------------------
+sage -t src/sage/plot/animate.py
+**********************************************************************
+File "src/sage/plot/animate.py", line 563, in sage.plot.animate.Animation.?
+Failed example:
+    with open(td + 'my_animation.gif', 'rb') as f: print('\x21\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.?[3]>", line 1, in <module>
+        with open(td + 'my_animation.gif', 'rb') as f: print('\x21\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+File "src/sage/plot/animate.py", line 1056, in sage.plot.animate.Animation.save
+Failed example:
+    with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.save[8]>", line 1, in <module>
+        with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+File "src/sage/plot/animate.py", line 1058, in sage.plot.animate.Animation.save
+Failed example:
+    with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.save[9]>", line 1, in <module>
+        with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+File "src/sage/plot/animate.py", line 1061, in sage.plot.animate.Animation.save
+Failed example:
+    with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.save[11]>", line 1, in <module>
+        with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+File "src/sage/plot/animate.py", line 1063, in sage.plot.animate.Animation.save
+Failed example:
+    with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.save[12]>", line 1, in <module>
+        with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+File "src/sage/plot/animate.py", line 1066, in sage.plot.animate.Animation.save
+Failed example:
+    with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.save[14]>", line 1, in <module>
+        with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+File "src/sage/plot/animate.py", line 1068, in sage.plot.animate.Animation.save
+Failed example:
+    with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x03\x00\x00' in f.read())  # optional -- ImageMagick
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.plot.animate.Animation.save[15]>", line 1, in <module>
+        with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x03\x00\x00' in f.read())  # optional -- ImageMagick
+    TypeError: a bytes-like object is required, not 'str'
+**********************************************************************
+2 items had failures:
+   1 of  15 in sage.plot.animate.Animation.?
+   6 of  17 in sage.plot.animate.Animation.save
+    [225 tests, 7 failures, 58.39 s]
+----------------------------------------------------------------------
 sage -t src/sage/coding/databases.py  # 2 doctests failed
 sage -t src/sage/repl/load.py  # 1 doctest failed
 sage -t src/sage/misc/latex.py  # 1 doctest failed
 sage -t src/sage/misc/persist.pyx  # 2 doctests failed
 sage -t src/sage/misc/remote_file.py  # 2 doctests failed
+sage -t src/sage/plot/animate.py  # 7 doctests failed
 ----------------------------------------------------------------------
 Total time for all tests: 4.9 seconds
     cpu time: 1.8 seconds
``````




---

archive/issue_comments_448717.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,252 +1,11 @@\n \n ```\n-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py src/sage/plot/animate.py\n+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/plot/animate.py\n ```\n \n gives\n \n ```\n-sage -t src/sage/coding/databases.py\n-**********************************************************************\n-File \"src/sage/coding/databases.py\", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de\n-Failed example:\n-    L = codes.databases.best_linear_code_in_codetables_dot_de(72, 36, GF(2))    # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[0]>\", line 1, in <module>\n-        L = codes.databases.best_linear_code_in_codetables_dot_de(Integer(72), Integer(36), GF(Integer(2)))    # optional - internet\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/coding/databases.py\", line 174, in best_linear_code_in_codetables_dot_de\n-        i = s.find(\"<PRE>\")\n-    TypeError: argument should be integer or bytes-like object, not 'str'\n-**********************************************************************\n-File \"src/sage/coding/databases.py\", line 138, in sage.coding.databases.best_linear_code_in_codetables_dot_de\n-Failed example:\n-    print(L)                                                                    # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[1]>\", line 1, in <module>\n-        print(L)                                                                    # optional - internet\n-    NameError: name 'L' is not defined\n-**********************************************************************\n-1 item had failures:\n-   2 of   3 in sage.coding.databases.best_linear_code_in_codetables_dot_de\n-    [7 tests, 2 failures, 1.15 s]\n-sage -t src/sage/repl/load.py\n-**********************************************************************\n-File \"src/sage/repl/load.py\", line 157, in sage.repl.load.load\n-Failed example:\n-    sage.repl.load.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())  # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.repl.load.load[16]>\", line 1, in <module>\n-        sage.repl.load.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())  # optional - internet\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/repl/load.py\", line 235, in load\n-        filename = get_remote_file(filename, verbose=False)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py\", line 49, in get_remote_file\n-        f.write(content.read())\n-    TypeError: write() argument must be str, not bytes\n-**********************************************************************\n-1 item had failures:\n-   1 of  36 in sage.repl.load.load\n-    [44 tests, 1 failure, 0.99 s]\n-sage -t src/sage/misc/latex.py\n-**********************************************************************\n-File \"src/sage/misc/latex.py\", line 1085, in sage.misc.latex.Latex.?\n-Failed example:\n-    latex.eval(\"\\ThisIsAnInvalidCommand\", {}) # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.misc.latex.Latex.?[1]>\", line 1, in <module>\n-        latex.eval(\"\\ThisIsAnInvalidCommand\", {}) # optional -- ImageMagick\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/latex.py\", line 1114, in eval\n-        O.write(str_to_bytes(x, encoding='utf-8'))\n-    TypeError: write() argument must be str, not bytes\n-**********************************************************************\n-1 item had failures:\n-   1 of   3 in sage.misc.latex.Latex.?\n-    [309 tests, 1 failure, 1.19 s]\n-sage -t src/sage/misc/persist.pyx\n-**********************************************************************\n-File \"src/sage/misc/persist.pyx\", line 87, in sage.misc.persist.load\n-Failed example:\n-    s = load(u)                                                  # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.misc.persist.load[1]>\", line 1, in <module>\n-        s = load(u)                                                  # optional - internet\n-      File \"sage/misc/persist.pyx\", line 151, in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2710)\n-        filename = get_remote_file(filename, verbose=verbose)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py\", line 49, in get_remote_file\n-        f.write(content.read())\n-    TypeError: write() argument must be str, not bytes\n-**********************************************************************\n-File \"src/sage/misc/persist.pyx\", line 91, in sage.misc.persist.load\n-Failed example:\n-    s                                                            # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.misc.persist.load[2]>\", line 1, in <module>\n-        s                                                            # optional - internet\n-    NameError: name 's' is not defined\n-**********************************************************************\n-1 item had failures:\n-   2 of  20 in sage.misc.persist.load\n-    [163 tests, 2 failures, 1.01 s]\n-sage -t src/sage/misc/remote_file.py\n-**********************************************************************\n-File \"src/sage/misc/remote_file.py\", line 25, in sage.misc.remote_file.get_remote_file\n-Failed example:\n-    g = get_remote_file(url, verbose=False)      # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.misc.remote_file.get_remote_file[1]>\", line 1, in <module>\n-        g = get_remote_file(url, verbose=False)      # optional - internet\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py\", line 49, in get_remote_file\n-        f.write(content.read())\n-    TypeError: write() argument must be str, not bytes\n-**********************************************************************\n-File \"src/sage/misc/remote_file.py\", line 26, in sage.misc.remote_file.get_remote_file\n-Failed example:\n-    with open(g) as f: print(f.read())           # optional - internet\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.misc.remote_file.get_remote_file[2]>\", line 1, in <module>\n-        with open(g) as f: print(f.read())           # optional - internet\n-    NameError: name 'g' is not defined\n-**********************************************************************\n-1 item had failures:\n-   2 of   4 in sage.misc.remote_file.get_remote_file\n-    [3 tests, 2 failures, 0.08 s]\n-----------------------------------------------------------------------\n-sage -t src/sage/plot/animate.py\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 563, in sage.plot.animate.Animation.?\n-Failed example:\n-    with open(td + 'my_animation.gif', 'rb') as f: print('\\x21\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.?[3]>\", line 1, in <module>\n-        with open(td + 'my_animation.gif', 'rb') as f: print('\\x21\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 1056, in sage.plot.animate.Animation.save\n-Failed example:\n-    with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.save[8]>\", line 1, in <module>\n-        with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 1058, in sage.plot.animate.Animation.save\n-Failed example:\n-    with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.save[9]>\", line 1, in <module>\n-        with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 1061, in sage.plot.animate.Animation.save\n-Failed example:\n-    with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.save[11]>\", line 1, in <module>\n-        with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x14\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 1063, in sage.plot.animate.Animation.save\n-Failed example:\n-    with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.save[12]>\", line 1, in <module>\n-        with open(td + 'wave.gif', 'rb') as f: print('!\\xf9\\x04\\x08\\x23\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 1066, in sage.plot.animate.Animation.save\n-Failed example:\n-    with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.save[14]>\", line 1, in <module>\n-        with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x00\\x00\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-File \"src/sage/plot/animate.py\", line 1068, in sage.plot.animate.Animation.save\n-Failed example:\n-    with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x03\\x00\\x00' in f.read())  # optional -- ImageMagick\n-Exception raised:\n-    Traceback (most recent call last):\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n-        self.compile_and_execute(example, compiler, test.globs)\n-      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n-        exec(compiled, globs)\n-      File \"<doctest sage.plot.animate.Animation.save[15]>\", line 1, in <module>\n-        with open(td + 'wave.gif', 'rb') as f: print('!\\xff\\x0bNETSCAPE2.0\\x03\\x01\\x03\\x00\\x00' in f.read())  # optional -- ImageMagick\n-    TypeError: a bytes-like object is required, not 'str'\n-**********************************************************************\n-2 items had failures:\n-   1 of  15 in sage.plot.animate.Animation.?\n-   6 of  17 in sage.plot.animate.Animation.save\n-    [225 tests, 7 failures, 58.39 s]\n ----------------------------------------------------------------------\n sage -t src/sage/coding/databases.py  # 2 doctests failed\n sage -t src/sage/repl/load.py  # 1 doctest failed\n@@ -255,8 +14,5 @@\n sage -t src/sage/misc/remote_file.py  # 2 doctests failed\n sage -t src/sage/plot/animate.py  # 7 doctests failed\n ----------------------------------------------------------------------\n-Total time for all tests: 4.9 seconds\n-    cpu time: 1.8 seconds\n-    cumulative wall time: 4.4 seconds\n External software detected for doctesting: imagemagick,internet,latex\n ```\n``````\n",
    "created_at": "2019-11-19T09:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448717",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,252 +1,11 @@
 
 ```
-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/misc/remote_file.py src/sage/plot/animate.py
+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/plot/animate.py
 ```
 
 gives
 
 ```
-sage -t src/sage/coding/databases.py
-**********************************************************************
-File "src/sage/coding/databases.py", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de
-Failed example:
-    L = codes.databases.best_linear_code_in_codetables_dot_de(72, 36, GF(2))    # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[0]>", line 1, in <module>
-        L = codes.databases.best_linear_code_in_codetables_dot_de(Integer(72), Integer(36), GF(Integer(2)))    # optional - internet
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/coding/databases.py", line 174, in best_linear_code_in_codetables_dot_de
-        i = s.find("<PRE>")
-    TypeError: argument should be integer or bytes-like object, not 'str'
-**********************************************************************
-File "src/sage/coding/databases.py", line 138, in sage.coding.databases.best_linear_code_in_codetables_dot_de
-Failed example:
-    print(L)                                                                    # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[1]>", line 1, in <module>
-        print(L)                                                                    # optional - internet
-    NameError: name 'L' is not defined
-**********************************************************************
-1 item had failures:
-   2 of   3 in sage.coding.databases.best_linear_code_in_codetables_dot_de
-    [7 tests, 2 failures, 1.15 s]
-sage -t src/sage/repl/load.py
-**********************************************************************
-File "src/sage/repl/load.py", line 157, in sage.repl.load.load
-Failed example:
-    sage.repl.load.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())  # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.repl.load.load[16]>", line 1, in <module>
-        sage.repl.load.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())  # optional - internet
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/repl/load.py", line 235, in load
-        filename = get_remote_file(filename, verbose=False)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py", line 49, in get_remote_file
-        f.write(content.read())
-    TypeError: write() argument must be str, not bytes
-**********************************************************************
-1 item had failures:
-   1 of  36 in sage.repl.load.load
-    [44 tests, 1 failure, 0.99 s]
-sage -t src/sage/misc/latex.py
-**********************************************************************
-File "src/sage/misc/latex.py", line 1085, in sage.misc.latex.Latex.?
-Failed example:
-    latex.eval("\ThisIsAnInvalidCommand", {}) # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.misc.latex.Latex.?[1]>", line 1, in <module>
-        latex.eval("\ThisIsAnInvalidCommand", {}) # optional -- ImageMagick
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/latex.py", line 1114, in eval
-        O.write(str_to_bytes(x, encoding='utf-8'))
-    TypeError: write() argument must be str, not bytes
-**********************************************************************
-1 item had failures:
-   1 of   3 in sage.misc.latex.Latex.?
-    [309 tests, 1 failure, 1.19 s]
-sage -t src/sage/misc/persist.pyx
-**********************************************************************
-File "src/sage/misc/persist.pyx", line 87, in sage.misc.persist.load
-Failed example:
-    s = load(u)                                                  # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.misc.persist.load[1]>", line 1, in <module>
-        s = load(u)                                                  # optional - internet
-      File "sage/misc/persist.pyx", line 151, in sage.misc.persist.load (build/cythonized/sage/misc/persist.c:2710)
-        filename = get_remote_file(filename, verbose=verbose)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py", line 49, in get_remote_file
-        f.write(content.read())
-    TypeError: write() argument must be str, not bytes
-**********************************************************************
-File "src/sage/misc/persist.pyx", line 91, in sage.misc.persist.load
-Failed example:
-    s                                                            # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.misc.persist.load[2]>", line 1, in <module>
-        s                                                            # optional - internet
-    NameError: name 's' is not defined
-**********************************************************************
-1 item had failures:
-   2 of  20 in sage.misc.persist.load
-    [163 tests, 2 failures, 1.01 s]
-sage -t src/sage/misc/remote_file.py
-**********************************************************************
-File "src/sage/misc/remote_file.py", line 25, in sage.misc.remote_file.get_remote_file
-Failed example:
-    g = get_remote_file(url, verbose=False)      # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.misc.remote_file.get_remote_file[1]>", line 1, in <module>
-        g = get_remote_file(url, verbose=False)      # optional - internet
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py", line 49, in get_remote_file
-        f.write(content.read())
-    TypeError: write() argument must be str, not bytes
-**********************************************************************
-File "src/sage/misc/remote_file.py", line 26, in sage.misc.remote_file.get_remote_file
-Failed example:
-    with open(g) as f: print(f.read())           # optional - internet
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.misc.remote_file.get_remote_file[2]>", line 1, in <module>
-        with open(g) as f: print(f.read())           # optional - internet
-    NameError: name 'g' is not defined
-**********************************************************************
-1 item had failures:
-   2 of   4 in sage.misc.remote_file.get_remote_file
-    [3 tests, 2 failures, 0.08 s]
-----------------------------------------------------------------------
-sage -t src/sage/plot/animate.py
-**********************************************************************
-File "src/sage/plot/animate.py", line 563, in sage.plot.animate.Animation.?
-Failed example:
-    with open(td + 'my_animation.gif', 'rb') as f: print('\x21\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.?[3]>", line 1, in <module>
-        with open(td + 'my_animation.gif', 'rb') as f: print('\x21\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-File "src/sage/plot/animate.py", line 1056, in sage.plot.animate.Animation.save
-Failed example:
-    with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.save[8]>", line 1, in <module>
-        with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-File "src/sage/plot/animate.py", line 1058, in sage.plot.animate.Animation.save
-Failed example:
-    with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.save[9]>", line 1, in <module>
-        with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-File "src/sage/plot/animate.py", line 1061, in sage.plot.animate.Animation.save
-Failed example:
-    with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.save[11]>", line 1, in <module>
-        with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x14\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-File "src/sage/plot/animate.py", line 1063, in sage.plot.animate.Animation.save
-Failed example:
-    with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.save[12]>", line 1, in <module>
-        with open(td + 'wave.gif', 'rb') as f: print('!\xf9\x04\x08\x23\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-File "src/sage/plot/animate.py", line 1066, in sage.plot.animate.Animation.save
-Failed example:
-    with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.save[14]>", line 1, in <module>
-        with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-File "src/sage/plot/animate.py", line 1068, in sage.plot.animate.Animation.save
-Failed example:
-    with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x03\x00\x00' in f.read())  # optional -- ImageMagick
-Exception raised:
-    Traceback (most recent call last):
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
-        self.compile_and_execute(example, compiler, test.globs)
-      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
-        exec(compiled, globs)
-      File "<doctest sage.plot.animate.Animation.save[15]>", line 1, in <module>
-        with open(td + 'wave.gif', 'rb') as f: print('!\xff\x0bNETSCAPE2.0\x03\x01\x03\x00\x00' in f.read())  # optional -- ImageMagick
-    TypeError: a bytes-like object is required, not 'str'
-**********************************************************************
-2 items had failures:
-   1 of  15 in sage.plot.animate.Animation.?
-   6 of  17 in sage.plot.animate.Animation.save
-    [225 tests, 7 failures, 58.39 s]
 ----------------------------------------------------------------------
 sage -t src/sage/coding/databases.py  # 2 doctests failed
 sage -t src/sage/repl/load.py  # 1 doctest failed
@@ -255,8 +14,5 @@
 sage -t src/sage/misc/remote_file.py  # 2 doctests failed
 sage -t src/sage/plot/animate.py  # 7 doctests failed
 ----------------------------------------------------------------------
-Total time for all tests: 4.9 seconds
-    cpu time: 1.8 seconds
-    cumulative wall time: 4.4 seconds
 External software detected for doctesting: imagemagick,internet,latex
 ```
``````




---

archive/issue_comments_448718.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,6 @@\n sage -t src/sage/repl/load.py  # 1 doctest failed\n sage -t src/sage/misc/latex.py  # 1 doctest failed\n sage -t src/sage/misc/persist.pyx  # 2 doctests failed\n-sage -t src/sage/misc/remote_file.py  # 2 doctests failed\n sage -t src/sage/plot/animate.py  # 7 doctests failed\n ----------------------------------------------------------------------\n External software detected for doctesting: imagemagick,internet,latex\n``````\n",
    "created_at": "2019-11-19T09:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448718",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,6 @@
 sage -t src/sage/repl/load.py  # 1 doctest failed
 sage -t src/sage/misc/latex.py  # 1 doctest failed
 sage -t src/sage/misc/persist.pyx  # 2 doctests failed
-sage -t src/sage/misc/remote_file.py  # 2 doctests failed
 sage -t src/sage/plot/animate.py  # 7 doctests failed
 ----------------------------------------------------------------------
 External software detected for doctesting: imagemagick,internet,latex
``````




---

archive/issue_comments_448719.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,25 @@\n ----------------------------------------------------------------------\n External software detected for doctesting: imagemagick,internet,latex\n ```\n+\n+with errors of that kind:\n+\n+```\n+sage -t src/sage/coding/databases.py\n+**********************************************************************\n+File \"src/sage/coding/databases.py\", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de\n+Failed example:\n+    L = codes.databases.best_linear_code_in_codetables_dot_de(72, 36, GF(2))    # optional - internet\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[0]>\", line 1, in <module>\n+        L = codes.databases.best_linear_code_in_codetables_dot_de(Integer(72), Integer(36), GF(Integer(2)))    # optional - internet\n+      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/coding/databases.py\", line 174, in best_linear_code_in_codetables_dot_de\n+        i = s.find(\"<PRE>\")\n+    TypeError: argument should be integer or bytes-like object, not 'str'\n+**********************************************************************\n+```\n``````\n",
    "created_at": "2019-11-19T09:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448719",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,25 @@
 ----------------------------------------------------------------------
 External software detected for doctesting: imagemagick,internet,latex
 ```
+
+with errors of that kind:
+
+```
+sage -t src/sage/coding/databases.py
+**********************************************************************
+File "src/sage/coding/databases.py", line 137, in sage.coding.databases.best_linear_code_in_codetables_dot_de
+Failed example:
+    L = codes.databases.best_linear_code_in_codetables_dot_de(72, 36, GF(2))    # optional - internet
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.coding.databases.best_linear_code_in_codetables_dot_de[0]>", line 1, in <module>
+        L = codes.databases.best_linear_code_in_codetables_dot_de(Integer(72), Integer(36), GF(Integer(2)))    # optional - internet
+      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/coding/databases.py", line 174, in best_linear_code_in_codetables_dot_de
+        i = s.find("<PRE>")
+    TypeError: argument should be integer or bytes-like object, not 'str'
+**********************************************************************
+```
``````




---

archive/issue_comments_448720.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nsrc/sage/misc/persist.pyx is fixed in #28761",
    "created_at": "2019-11-19T10:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448720",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

src/sage/misc/persist.pyx is fixed in #28761



---

archive/issue_comments_448721.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/plot/animate.py\n+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/plot/animate.py\n ```\n \n gives\n@@ -10,7 +10,6 @@\n sage -t src/sage/coding/databases.py  # 2 doctests failed\n sage -t src/sage/repl/load.py  # 1 doctest failed\n sage -t src/sage/misc/latex.py  # 1 doctest failed\n-sage -t src/sage/misc/persist.pyx  # 2 doctests failed\n sage -t src/sage/plot/animate.py  # 7 doctests failed\n ----------------------------------------------------------------------\n External software detected for doctesting: imagemagick,internet,latex\n``````\n",
    "created_at": "2019-11-19T10:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448721",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/misc/persist.pyx  src/sage/plot/animate.py
+sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/plot/animate.py
 ```
 
 gives
@@ -10,7 +10,6 @@
 sage -t src/sage/coding/databases.py  # 2 doctests failed
 sage -t src/sage/repl/load.py  # 1 doctest failed
 sage -t src/sage/misc/latex.py  # 1 doctest failed
-sage -t src/sage/misc/persist.pyx  # 2 doctests failed
 sage -t src/sage/plot/animate.py  # 7 doctests failed
 ----------------------------------------------------------------------
 External software detected for doctesting: imagemagick,internet,latex
``````




---

archive/issue_comments_448722.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nsrc/sage/repl/load.py is almost fixed by #28761 too",
    "created_at": "2019-11-19T12:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448722",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

src/sage/repl/load.py is almost fixed by #28761 too



---

archive/issue_comments_448723.json:
```json
{
    "body": "Branch: **[public/ticket/28760](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28760)**",
    "created_at": "2019-11-19T14:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448723",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/ticket/28760](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28760)**



---

archive/issue_comments_448724.json:
```json
{
    "body": "Commit: **[1b000e1](https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898)**",
    "created_at": "2019-11-19T14:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448724",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[1b000e1](https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898)**



---

archive/issue_comments_448725.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHere is a fix for databases\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898\">1b000e1</a></td><td><code>trac 28760 py3 fix for databases</code></td></tr></table>\n",
    "created_at": "2019-11-19T14:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448725",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

Here is a fix for databases

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898">1b000e1</a></td><td><code>trac 28760 py3 fix for databases</code></td></tr></table>




---

archive/issue_comments_448726.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSpliting this ticket and moving the other issues to #28808",
    "created_at": "2019-11-27T15:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448726",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:9" align="right">comment:9</div>

Spliting this ticket and moving the other issues to #28808



---

archive/issue_comments_448727.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/plot/animate.py\n+sage -t --optional=sage,optional,external src/sage/coding/databases.py\n ```\n \n gives\n@@ -8,11 +8,7 @@\n ```\n ----------------------------------------------------------------------\n sage -t src/sage/coding/databases.py  # 2 doctests failed\n-sage -t src/sage/repl/load.py  # 1 doctest failed\n-sage -t src/sage/misc/latex.py  # 1 doctest failed\n-sage -t src/sage/plot/animate.py  # 7 doctests failed\n ----------------------------------------------------------------------\n-External software detected for doctesting: imagemagick,internet,latex\n ```\n \n with errors of that kind:\n``````\n",
    "created_at": "2019-11-27T15:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448727",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage -t --optional=sage,optional,external src/sage/coding/databases.py src/sage/repl/load.py src/sage/misc/latex.py src/sage/plot/animate.py
+sage -t --optional=sage,optional,external src/sage/coding/databases.py
 ```
 
 gives
@@ -8,11 +8,7 @@
 ```
 ----------------------------------------------------------------------
 sage -t src/sage/coding/databases.py  # 2 doctests failed
-sage -t src/sage/repl/load.py  # 1 doctest failed
-sage -t src/sage/misc/latex.py  # 1 doctest failed
-sage -t src/sage/plot/animate.py  # 7 doctests failed
 ----------------------------------------------------------------------
-External software detected for doctesting: imagemagick,internet,latex
 ```
 
 with errors of that kind:
``````




---

archive/issue_events_395025.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-27T15:15:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395025"
}
```



---

archive/issue_events_395026.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-27T15:15:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395026"
}
```



---

archive/issue_events_395027.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-27T15:15:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395027"
}
```



---

archive/issue_comments_448728.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2019-11-27T15:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448728",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_448729.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2019-11-27T15:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448729",
    "user": "https://github.com/seblabbe"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_events_395028.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-11-27T15:17:35Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "title_is": "py3: internet str vs bytes doctests failures",
    "title_was": "py3: imagemagick,internet,latex str vs bytes doctests failures",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395028"
}
```



---

archive/issue_comments_448730.json:
```json
{
    "body": "Changed branch from **[public/ticket/28760](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28760)** to **[1b000e1](https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898)**",
    "created_at": "2019-11-29T23:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28760#issuecomment-448730",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ticket/28760](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/28760)** to **[1b000e1](https://github.com/sagemath/sagetrac-mirror/commit/1b000e1f3858c3189c2786ffb1e31265114de898)**



---

archive/issue_events_395029.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-29T23:57:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395029"
}
```



---

archive/issue_events_395030.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1dd55655a1fee681462b58bb27cbffc7adbf715c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-11-29T23:57:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28760",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28760#event-395030"
}
```
