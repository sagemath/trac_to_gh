# Issue 28554: Scalar Field Restrictions

archive/issues_028317.json:
```json
{
    "assignees": [],
    "body": "How is a scalar field implemented which is piecewisely defined with different expressions in one particular chart?\n\nTake for instance a scalar field `f` on the real line with standard \"top\" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using\n\n```\nf = M.scalar_field( unit_step(x + 1)*unit_step(1 - x)*(1 - abs(x)) )\n```\n(see [#28519 comment:46](https://github.com/sagemath/sage/issues/28519#comment:46)).\n\nThis solution is quite unhandy and becomes even more so for more complicated scalar fields.\n\nThis ticket is part of the metaticket #28519.\n\n**This ticket includes:**\n\n- `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)\n- `set_restriction` method added smilar to tensor fields\n\n**CC:**  @tscrim @egourgoulhon\n\n**Keywords:** manifolds, scalar fields\n\n**Branch/Commit:** [a126d9187fed8552fd14351248f54704dac26737](https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737)\n\n**Reviewer:** Eric Gourgoulhon\n\n**Author:** Michael Jung\n\nIssue created by migration from https://trac.sagemath.org/ticket/28554\n\n",
    "closed_at": "2019-10-29T23:41:59Z",
    "created_at": "2019-10-03T17:40:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Scalar Field Restrictions",
    "type": "issue",
    "updated_at": "2019-10-29T23:41:59Z",
    "url": "https://github.com/sagemath/sage/issues/28554",
    "user": "https://github.com/DeRhamSource"
}
```
How is a scalar field implemented which is piecewisely defined with different expressions in one particular chart?

Take for instance a scalar field `f` on the real line with standard "top" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using

```
f = M.scalar_field( unit_step(x + 1)*unit_step(1 - x)*(1 - abs(x)) )
```
(see [#28519 comment:46](https://github.com/sagemath/sage/issues/28519#comment:46)).

This solution is quite unhandy and becomes even more so for more complicated scalar fields.

This ticket is part of the metaticket #28519.

**This ticket includes:**

- `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)
- `set_restriction` method added smilar to tensor fields

**CC:**  @tscrim @egourgoulhon

**Keywords:** manifolds, scalar fields

**Branch/Commit:** [a126d9187fed8552fd14351248f54704dac26737](https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737)

**Reviewer:** Eric Gourgoulhon

**Author:** Michael Jung

Issue created by migration from https://trac.sagemath.org/ticket/28554





---

archive/issue_events_343314.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-03T17:40:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343314"
}
```



---

archive/issue_events_343315.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-03T17:40:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "08517b",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343315"
}
```



---

archive/issue_events_343316.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-03T17:40:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343316"
}
```



---

archive/issue_comments_447928.json:
```json
{
    "body": "<a id='comment:1'></a>\nEric, in the ticket mentioned above, I suggested to display all *known* expressions (on the greatest domain) and compute new expressions only if a particular chart is stated. It seems, there is no big difference to the previous code then, and the additional computation time might be negligible. What do you say? Is this a good compromise for you? Moreover, this approach seems to be the easiest one.\n\nOr one implements an additional flag `display_all` for which the user is aware of additional computation time when using it?\n\nHowever, do you have an example for me with much computation time to test my current algorithm how long it takes? Then, I can compare computation times. I have a feeling that the current algorithm is not that much slower than before because it starts from the top charts -- what happens anyway and, I guess, it only makes a significant difference if the scalar field is picewisely defined.",
    "created_at": "2019-10-04T09:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447928",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:1'></a>
Eric, in the ticket mentioned above, I suggested to display all *known* expressions (on the greatest domain) and compute new expressions only if a particular chart is stated. It seems, there is no big difference to the previous code then, and the additional computation time might be negligible. What do you say? Is this a good compromise for you? Moreover, this approach seems to be the easiest one.

Or one implements an additional flag `display_all` for which the user is aware of additional computation time when using it?

However, do you have an example for me with much computation time to test my current algorithm how long it takes? Then, I can compare computation times. I have a feeling that the current algorithm is not that much slower than before because it starts from the top charts -- what happens anyway and, I guess, it only makes a significant difference if the scalar field is picewisely defined.



---

archive/issue_comments_447929.json:
```json
{
    "body": "**Branch:** [u/gh-DeRhamSource/scalar_field_restrictions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-DeRhamSource/scalar_field_restrictions)",
    "created_at": "2019-10-04T18:37:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447929",
    "user": "https://github.com/DeRhamSource"
}
```

**Branch:** [u/gh-DeRhamSource/scalar_field_restrictions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-DeRhamSource/scalar_field_restrictions)



---

archive/issue_comments_447930.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,4 +9,20 @@\n \n This solution is quite unhandy and becomes even more so for more complicated scalar fields.\n \n-In this ticket, I try to solve this issue by adding a `set_restriction` method (similar to tensor fields) and modifying the `display` method.\n+How is a scalar field implemented which is split into different expressions in one particular chart?\n+\n+Take for instance a scalar field `f` on the real line with standard \"top\" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using\n+\n+```\n+f = M.scalar_field( unit_step(x + 1)*unit_step(1 - x)*(1 - abs(x)) )\n+```\n+(see [#28519 comment:46](https://github.com/sagemath/sage/issues/28519#comment:46)).\n+\n+This solution is quite unhandy and becomes even more so for more complicated scalar fields.\n+\n+**This ticket includes:**\n+\n+- modification of namings after algebraic operations, such as `f*g` (`f \\cdot g` for LaTeX code), `f/g` and `f+g`\n+- `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)\n+- `set_restriction` method added smilar to tensor fields\n+- `_is_zero` attribute copied for a copy\n``````\n",
    "created_at": "2019-10-04T18:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447930",
    "user": "https://github.com/DeRhamSource"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,4 +9,20 @@
 
 This solution is quite unhandy and becomes even more so for more complicated scalar fields.
 
-In this ticket, I try to solve this issue by adding a `set_restriction` method (similar to tensor fields) and modifying the `display` method.
+How is a scalar field implemented which is split into different expressions in one particular chart?
+
+Take for instance a scalar field `f` on the real line with standard "top" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using
+
+```
+f = M.scalar_field( unit_step(x + 1)*unit_step(1 - x)*(1 - abs(x)) )
+```
+(see [#28519 comment:46](https://github.com/sagemath/sage/issues/28519#comment:46)).
+
+This solution is quite unhandy and becomes even more so for more complicated scalar fields.
+
+**This ticket includes:**
+
+- modification of namings after algebraic operations, such as `f*g` (`f \cdot g` for LaTeX code), `f/g` and `f+g`
+- `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)
+- `set_restriction` method added smilar to tensor fields
+- `_is_zero` attribute copied for a copy
``````




---

archive/issue_comments_447931.json:
```json
{
    "body": "**Commit:** [0c645ca987eb13c63cfc7841aac1c4d320eec253](https://github.com/sagemath/sagetrac-mirror/commit/0c645ca987eb13c63cfc7841aac1c4d320eec253)",
    "created_at": "2019-10-04T18:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447931",
    "user": "https://github.com/DeRhamSource"
}
```

**Commit:** [0c645ca987eb13c63cfc7841aac1c4d320eec253](https://github.com/sagemath/sagetrac-mirror/commit/0c645ca987eb13c63cfc7841aac1c4d320eec253)



---

archive/issue_comments_447932.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c645ca987eb13c63cfc7841aac1c4d320eec253\">0c645ca</a></td><td><code>'set_restriction' added + 'display' modified + naming modified</code></td></tr></table>\n",
    "created_at": "2019-10-04T18:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447932",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c645ca987eb13c63cfc7841aac1c4d320eec253">0c645ca</a></td><td><code>'set_restriction' added + 'display' modified + naming modified</code></td></tr></table>




---

archive/issue_comments_447933.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,4 @@\n-How is a scalar field implemented which is split into different expressions in one particular chart?\n-\n-Take for instance a scalar field `f` on the real line with standard \"top\" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using\n-\n-```\n-f = M.scalar_field( unit_step(x + 1)*unit_step(1 - x)*(1 - abs(x)) )\n-```\n-(see [#28519 comment:46](https://github.com/sagemath/sage/issues/28519#comment:46)).\n-\n-This solution is quite unhandy and becomes even more so for more complicated scalar fields.\n-\n-How is a scalar field implemented which is split into different expressions in one particular chart?\n+How is a scalar field implemented which is piecewisely defined with different expressions in one particular chart?\n \n Take for instance a scalar field `f` on the real line with standard \"top\" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using\n \n``````\n",
    "created_at": "2019-10-04T18:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447933",
    "user": "https://github.com/DeRhamSource"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,4 @@
-How is a scalar field implemented which is split into different expressions in one particular chart?
-
-Take for instance a scalar field `f` on the real line with standard "top" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using
-
-```
-f = M.scalar_field( unit_step(x + 1)*unit_step(1 - x)*(1 - abs(x)) )
-```
-(see [#28519 comment:46](https://github.com/sagemath/sage/issues/28519#comment:46)).
-
-This solution is quite unhandy and becomes even more so for more complicated scalar fields.
-
-How is a scalar field implemented which is split into different expressions in one particular chart?
+How is a scalar field implemented which is piecewisely defined with different expressions in one particular chart?
 
 Take for instance a scalar field `f` on the real line with standard "top" chart `x`, defined via `f(x)=0 for x<-1`, `f(x)=x+1 for -1<=x<0`, `f(x)=1-x for 0<=x<1` and `f(x)=0 for x>=1`. Currently, this is solved by using
 
``````




---

archive/issue_comments_447934.json:
```json
{
    "body": "<a id='comment:5'></a>\nI compared computation times.\n\n**Before:**\n\n\n```\n...$ ./sage -t src/sage/manifolds/scalarfield.py \ntoo few successful tests, not using stored timings\nRunning doctests with ID 2019-10-04-19-03-38-e810720b.\nGit branch: scalar_field_restrictions\nUsing --optional=build,dochtml,memlimit,python2,sage\nDoctesting 1 file.\nsage -t src/sage/manifolds/scalarfield.py\n    [715 tests, 31.77 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 32.0 seconds\n    cpu time: 33.2 seconds\n    cumulative wall time: 31.8 seconds\n```\n\n**With this ticket:**\n\n```\n...$ ./sage -t src/sage/manifolds/scalarfield.py\ntoo few successful tests, not using stored timings\nRunning doctests with ID 2019-10-04-20-45-12-df0ec794.\nGit branch: scalar_field_restrictions\nUsing --optional=build,dochtml,memlimit,python2,sage\nDoctesting 1 file.\nsage -t src/sage/manifolds/scalarfield.py\n    [735 tests, 34.59 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 34.8 seconds\n    cpu time: 35.9 seconds\n    cumulative wall time: 34.6 seconds\n```\n\nWhat do you say?",
    "created_at": "2019-10-04T18:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447934",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:5'></a>
I compared computation times.

**Before:**


```
...$ ./sage -t src/sage/manifolds/scalarfield.py 
too few successful tests, not using stored timings
Running doctests with ID 2019-10-04-19-03-38-e810720b.
Git branch: scalar_field_restrictions
Using --optional=build,dochtml,memlimit,python2,sage
Doctesting 1 file.
sage -t src/sage/manifolds/scalarfield.py
    [715 tests, 31.77 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 32.0 seconds
    cpu time: 33.2 seconds
    cumulative wall time: 31.8 seconds
```

**With this ticket:**

```
...$ ./sage -t src/sage/manifolds/scalarfield.py
too few successful tests, not using stored timings
Running doctests with ID 2019-10-04-20-45-12-df0ec794.
Git branch: scalar_field_restrictions
Using --optional=build,dochtml,memlimit,python2,sage
Doctesting 1 file.
sage -t src/sage/manifolds/scalarfield.py
    [735 tests, 34.59 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 34.8 seconds
    cpu time: 35.9 seconds
    cumulative wall time: 34.6 seconds
```

What do you say?



---

archive/issue_comments_447935.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b85f6ec46f9878c48ed4d8843123b46b844cb252\">b85f6ec</a></td><td><code>Typos fixed</code></td></tr></table>\n",
    "created_at": "2019-10-04T19:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447935",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b85f6ec46f9878c48ed4d8843123b46b844cb252">b85f6ec</a></td><td><code>Typos fixed</code></td></tr></table>




---

archive/issue_comments_447936.json:
```json
{
    "body": "**Changing commit** from \"[0c645ca987eb13c63cfc7841aac1c4d320eec253](https://github.com/sagemath/sagetrac-mirror/commit/0c645ca987eb13c63cfc7841aac1c4d320eec253)\" to \"[b85f6ec46f9878c48ed4d8843123b46b844cb252](https://github.com/sagemath/sagetrac-mirror/commit/b85f6ec46f9878c48ed4d8843123b46b844cb252)\".",
    "created_at": "2019-10-04T19:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447936",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0c645ca987eb13c63cfc7841aac1c4d320eec253](https://github.com/sagemath/sagetrac-mirror/commit/0c645ca987eb13c63cfc7841aac1c4d320eec253)" to "[b85f6ec46f9878c48ed4d8843123b46b844cb252](https://github.com/sagemath/sagetrac-mirror/commit/b85f6ec46f9878c48ed4d8843123b46b844cb252)".



---

archive/issue_comments_447937.json:
```json
{
    "body": "**Changing commit** from \"[b85f6ec46f9878c48ed4d8843123b46b844cb252](https://github.com/sagemath/sagetrac-mirror/commit/b85f6ec46f9878c48ed4d8843123b46b844cb252)\" to \"[1d68a1f83e9fbb0135077e5e0ec60be0f5beb141](https://github.com/sagemath/sagetrac-mirror/commit/1d68a1f83e9fbb0135077e5e0ec60be0f5beb141)\".",
    "created_at": "2019-10-06T13:23:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447937",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[b85f6ec46f9878c48ed4d8843123b46b844cb252](https://github.com/sagemath/sagetrac-mirror/commit/b85f6ec46f9878c48ed4d8843123b46b844cb252)" to "[1d68a1f83e9fbb0135077e5e0ec60be0f5beb141](https://github.com/sagemath/sagetrac-mirror/commit/1d68a1f83e9fbb0135077e5e0ec60be0f5beb141)".



---

archive/issue_comments_447938.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d68a1f83e9fbb0135077e5e0ec60be0f5beb141\">1d68a1f</a></td><td><code>'set_restriction' added + some restriction modifications</code></td></tr></table>\n",
    "created_at": "2019-10-06T13:23:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447938",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d68a1f83e9fbb0135077e5e0ec60be0f5beb141">1d68a1f</a></td><td><code>'set_restriction' added + some restriction modifications</code></td></tr></table>




---

archive/issue_comments_447939.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,7 +11,5 @@\n \n **This ticket includes:**\n \n-- modification of namings after algebraic operations, such as `f*g` (`f \\cdot g` for LaTeX code), `f/g` and `f+g`\n - `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)\n - `set_restriction` method added smilar to tensor fields\n-- `_is_zero` attribute copied for a copy\n``````\n",
    "created_at": "2019-10-06T13:24:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447939",
    "user": "https://github.com/DeRhamSource"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,7 +11,5 @@
 
 **This ticket includes:**
 
-- modification of namings after algebraic operations, such as `f*g` (`f \cdot g` for LaTeX code), `f/g` and `f+g`
 - `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)
 - `set_restriction` method added smilar to tensor fields
-- `_is_zero` attribute copied for a copy
``````




---

archive/issue_comments_447940.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,8 @@\n \n This solution is quite unhandy and becomes even more so for more complicated scalar fields.\n \n+This ticket is part of the metaticket #28519.\n+\n **This ticket includes:**\n \n - `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)\n``````\n",
    "created_at": "2019-10-06T14:41:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447940",
    "user": "https://github.com/DeRhamSource"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,8 @@
 
 This solution is quite unhandy and becomes even more so for more complicated scalar fields.
 
+This ticket is part of the metaticket #28519.
+
 **This ticket includes:**
 
 - `display` method modified in such a way that all distinct expressions are shown (a small slowdown in computation time)
``````




---

archive/issue_comments_447941.json:
```json
{
    "body": "<a id='comment:10'></a>\nPlease give me a short feedback so that I can work further on this.\n\nThis ticket is essential for my future implementation of characteristic classes (due to the `set_restriction` method).",
    "created_at": "2019-10-07T19:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447941",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:10'></a>
Please give me a short feedback so that I can work further on this.

This ticket is essential for my future implementation of characteristic classes (due to the `set_restriction` method).



---

archive/issue_events_343317.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-07T19:58:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343317"
}
```



---

archive/issue_comments_447942.json:
```json
{
    "body": "<a id='comment:12'></a>\nSorry for the delay. The ticket looks good; it clearly improves the treatment of restrictions of scalar fields. I have a few remarks:\n- Regarding the change in `display()`, I agree that your solution is a good compromise\n- I guess the method `_new_instance()` has been introduced in scalar fields by analogy of what is done for tensor fields. However in the present case, this method is quite trivial, since it returns a mere `type(self)(self.parent())`. IMHO this adds some code complexity (a new method) for not a big gain; for someone reading the code, \n\n```\n   res = type(self)(self.parent())\n```\n  is at least as clear as\n\n```\n   res = self._new_instance()\n```\n   Moreover the latter involves one extra function call. Therefore I would suggest to revert this change.\n- When you perform significant changes/additions to some file, I would suggest that you add your name to the `AUTHORS` field and copyright statement. For instance in `src/sage/mnifolds/scalarfield.py`, you could add to the `AUTHORS` field something like \n\n```\n- Michael Jung (2019) : improve restrictions; make ``display()`` show all\n  distinct expressions\n```\n  The same holds for #28628 and other tickets of #28519.",
    "created_at": "2019-10-26T15:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447942",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:12'></a>
Sorry for the delay. The ticket looks good; it clearly improves the treatment of restrictions of scalar fields. I have a few remarks:
- Regarding the change in `display()`, I agree that your solution is a good compromise
- I guess the method `_new_instance()` has been introduced in scalar fields by analogy of what is done for tensor fields. However in the present case, this method is quite trivial, since it returns a mere `type(self)(self.parent())`. IMHO this adds some code complexity (a new method) for not a big gain; for someone reading the code, 

```
   res = type(self)(self.parent())
```
  is at least as clear as

```
   res = self._new_instance()
```
   Moreover the latter involves one extra function call. Therefore I would suggest to revert this change.
- When you perform significant changes/additions to some file, I would suggest that you add your name to the `AUTHORS` field and copyright statement. For instance in `src/sage/mnifolds/scalarfield.py`, you could add to the `AUTHORS` field something like 

```
- Michael Jung (2019) : improve restrictions; make ``display()`` show all
  distinct expressions
```
  The same holds for #28628 and other tickets of #28519.



---

archive/issue_comments_447943.json:
```json
{
    "body": "**Changing commit** from \"[1d68a1f83e9fbb0135077e5e0ec60be0f5beb141](https://github.com/sagemath/sagetrac-mirror/commit/1d68a1f83e9fbb0135077e5e0ec60be0f5beb141)\" to \"[512d2b1a31d7491e5ecce1bb167b74830929b06d](https://github.com/sagemath/sagetrac-mirror/commit/512d2b1a31d7491e5ecce1bb167b74830929b06d)\".",
    "created_at": "2019-10-27T13:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447943",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[1d68a1f83e9fbb0135077e5e0ec60be0f5beb141](https://github.com/sagemath/sagetrac-mirror/commit/1d68a1f83e9fbb0135077e5e0ec60be0f5beb141)" to "[512d2b1a31d7491e5ecce1bb167b74830929b06d](https://github.com/sagemath/sagetrac-mirror/commit/512d2b1a31d7491e5ecce1bb167b74830929b06d)".



---

archive/issue_comments_447944.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e999f17a5dc78a4903e4f759a0ea31a1bfe4314\">4e999f1</a></td><td><code>Merge branch 'develop' into t/28554/scalar_field_restrictions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/512d2b1a31d7491e5ecce1bb167b74830929b06d\">512d2b1</a></td><td><code>Revert '_new_instance' + authorship</code></td></tr></table>\n",
    "created_at": "2019-10-27T13:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447944",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e999f17a5dc78a4903e4f759a0ea31a1bfe4314">4e999f1</a></td><td><code>Merge branch 'develop' into t/28554/scalar_field_restrictions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/512d2b1a31d7491e5ecce1bb167b74830929b06d">512d2b1</a></td><td><code>Revert '_new_instance' + authorship</code></td></tr></table>




---

archive/issue_events_343318.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-27T13:31:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343318"
}
```



---

archive/issue_events_343319.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-27T13:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343319"
}
```



---

archive/issue_comments_447945.json:
```json
{
    "body": "**Author:** Michael Jung",
    "created_at": "2019-10-27T13:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447945",
    "user": "https://github.com/DeRhamSource"
}
```

**Author:** Michael Jung



---

archive/issue_comments_447946.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks! There we go. :)",
    "created_at": "2019-10-27T13:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447946",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:14'></a>
Thanks! There we go. :)



---

archive/issue_events_343320.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-10-27T14:27:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343320"
}
```



---

archive/issue_events_343321.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-10-27T14:27:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343321"
}
```



---

archive/issue_comments_447947.json:
```json
{
    "body": "<a id='comment:15'></a>\nWith Sage 9.0.beta3, there are two failed doctests:\n\n```\n**********************************************************************\nFile \"src/sage/manifolds/section.py\", line 971, in sage.manifolds.section.Section.add_expr_from_subdomain\nFailed example:\n    sorted(s._components.values())[0]._comp[(1,)].display()\nExpected:\n    S^2 --> R\n    on U: (x, y) |--> x\nGot:\n    S^2 --> R\n    on U: (x, y) |--> x\n    on W: (u, v) |--> u/(u^2 + v^2)\n**********************************************************************\n\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/pseudo_riemannian_submanifold.py\", line 1517, in sage.manifolds.differentiable.pseudo_riemannian_submanifold.?.principal_curvatures\nFailed example:\n    N.principal_curvatures(stereoN)[0].display()  # long time\nExpected:\n    k_0: N --> R\n    on U: x |--> -1\nGot:\n    k_0: N --> R\n    on U: x |--> -1\n    on W: y |--> -1\n**********************************************************************\n```",
    "created_at": "2019-10-27T14:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447947",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>
With Sage 9.0.beta3, there are two failed doctests:

```
**********************************************************************
File "src/sage/manifolds/section.py", line 971, in sage.manifolds.section.Section.add_expr_from_subdomain
Failed example:
    sorted(s._components.values())[0]._comp[(1,)].display()
Expected:
    S^2 --> R
    on U: (x, y) |--> x
Got:
    S^2 --> R
    on U: (x, y) |--> x
    on W: (u, v) |--> u/(u^2 + v^2)
**********************************************************************

**********************************************************************
File "src/sage/manifolds/differentiable/pseudo_riemannian_submanifold.py", line 1517, in sage.manifolds.differentiable.pseudo_riemannian_submanifold.?.principal_curvatures
Failed example:
    N.principal_curvatures(stereoN)[0].display()  # long time
Expected:
    k_0: N --> R
    on U: x |--> -1
Got:
    k_0: N --> R
    on U: x |--> -1
    on W: y |--> -1
**********************************************************************
```



---

archive/issue_comments_447948.json:
```json
{
    "body": "<a id='comment:16'></a>\nBtw, thanks for reverting `_new_instance()`.",
    "created_at": "2019-10-27T14:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447948",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:16'></a>
Btw, thanks for reverting `_new_instance()`.



---

archive/issue_comments_447949.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/763f69c5224ff93bb34e9030de814e1b7f481522\">763f69c</a></td><td><code>Merge branch 'develop' into t/28554/scalar_field_restrictions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737\">a126d91</a></td><td><code>Doctest errors fixed</code></td></tr></table>\n",
    "created_at": "2019-10-27T14:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447949",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/763f69c5224ff93bb34e9030de814e1b7f481522">763f69c</a></td><td><code>Merge branch 'develop' into t/28554/scalar_field_restrictions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737">a126d91</a></td><td><code>Doctest errors fixed</code></td></tr></table>




---

archive/issue_comments_447950.json:
```json
{
    "body": "**Changing commit** from \"[512d2b1a31d7491e5ecce1bb167b74830929b06d](https://github.com/sagemath/sagetrac-mirror/commit/512d2b1a31d7491e5ecce1bb167b74830929b06d)\" to \"[a126d9187fed8552fd14351248f54704dac26737](https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737)\".",
    "created_at": "2019-10-27T14:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447950",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[512d2b1a31d7491e5ecce1bb167b74830929b06d](https://github.com/sagemath/sagetrac-mirror/commit/512d2b1a31d7491e5ecce1bb167b74830929b06d)" to "[a126d9187fed8552fd14351248f54704dac26737](https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737)".



---

archive/issue_comments_447951.json:
```json
{
    "body": "<a id='comment:18'></a>\nI totally missed that we are in beta3 already!\n\nPlease check once again.\n\nThanks for your effort so far! :)",
    "created_at": "2019-10-27T14:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447951",
    "user": "https://github.com/DeRhamSource"
}
```

<a id='comment:18'></a>
I totally missed that we are in beta3 already!

Please check once again.

Thanks for your effort so far! :)



---

archive/issue_events_343322.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-27T14:45:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343322"
}
```



---

archive/issue_events_343323.json:
```json
{
    "actor": "https://github.com/DeRhamSource",
    "created_at": "2019-10-27T14:45:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343323"
}
```



---

archive/issue_events_343324.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-10-28T17:56:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343324"
}
```



---

archive/issue_events_343325.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-10-28T17:56:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343325"
}
```



---

archive/issue_comments_447952.json:
```json
{
    "body": "<a id='comment:20'></a>\nEverything is fine now. Thanks.",
    "created_at": "2019-10-28T17:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447952",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:20'></a>
Everything is fine now. Thanks.



---

archive/issue_comments_447953.json:
```json
{
    "body": "**Reviewer:** Eric Gourgoulhon",
    "created_at": "2019-10-28T18:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447953",
    "user": "https://github.com/egourgoulhon"
}
```

**Reviewer:** Eric Gourgoulhon



---

archive/issue_comments_447954.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-DeRhamSource/scalar_field_restrictions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-DeRhamSource/scalar_field_restrictions)\" to \"[a126d9187fed8552fd14351248f54704dac26737](https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737)\".",
    "created_at": "2019-10-29T23:41:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/28554#issuecomment-447954",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-DeRhamSource/scalar_field_restrictions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-DeRhamSource/scalar_field_restrictions)" to "[a126d9187fed8552fd14351248f54704dac26737](https://github.com/sagemath/sagetrac-mirror/commit/a126d9187fed8552fd14351248f54704dac26737)".



---

archive/issue_events_343326.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-29T23:41:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343326"
}
```



---

archive/issue_events_343327.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b960e6998dc3465274cb08bf6fda2d3221cbf025",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-10-29T23:41:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/28554",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/28554#event-343327"
}
```
