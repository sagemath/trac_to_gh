# Issue 21357: Fomin's growth diagrams and Schensted-like algorithms

Issue created by migration from https://trac.sagemath.org/ticket/21594

Original creator: mantepse

Original creation time: 2016-09-25 20:37:53

CC:  sage-combinat darij tscrim kdilks etzanaki vivianepons




---

Comment by mantepse created at 2016-09-25 20:40:26

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mantepse created at 2016-09-25 20:40:26

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by mantepse created at 2016-09-25 20:40:26

Set assignee to mantepse.


---

Comment by mantepse created at 2016-09-25 20:40:26

New commits:


---

Comment by git created at 2016-09-26 09:41:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-09-26 09:43:09

Comments very welcome!


---

Comment by git created at 2016-09-26 12:11:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-26 12:32:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-27 06:48:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-09-27 07:48:07

Where should I put the documentation?  `catalog_partitions.py`?


---

Comment by git created at 2016-09-27 09:07:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-27 12:12:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-09-27 12:16:14

Changing status from new to needs_review.


---

Comment by git created at 2016-09-27 15:31:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-09-27 15:54:21

Looks like this will become a very good addition to Sage. I think your choice of `catalog_partitions.py` is the best place in the doc. Some quick comments:

- In Sage, we have the triple quotes on their own line, so you should revert this change:
  {{{#!diff
 class SkewTableau(ClonableList):
-    """
-    A skew tableau.
+    """A skew tableau.
  }}}
  as well as convert the others.
- In `from_chain`, it should be `EXAMPLES::`.
- `_shape_from_labels` could be an ``@`abstract_method` and needs a doctest irregardless. (I typically do an example for a subclass which demonstrates the expected behavior.)
- `out_labels` and `in_labels` need doctests.
- When you just pass the same args to the base class `__init__`, you don't need to define an `__init__` (e.g., `GrowthDiagramRSK`).


---

Comment by mantepse created at 2016-09-27 17:43:19

Replying to [comment:15 tscrim]:
> Looks like this will become a very good addition to Sage. I think your choice of `catalog_partitions.py` is the best place in the doc. Some quick comments:

Thanks!

> - When you just pass the same args to the base class `__init__`, you don't need to define an `__init__` (e.g., `GrowthDiagramRSK`).

Could you expand on this?  (Eg., by example)


---

Comment by tscrim created at 2016-09-27 18:10:10

Replying to [comment:16 mantepse]:
> Replying to [comment:15 tscrim]:
> > - When you just pass the same args to the base class `__init__`, you don't need to define an `__init__` (e.g., `GrowthDiagramRSK`).
> 
> Could you expand on this?  (Eg., by example)

You can simply remove `GrowthDiagramRSK.__init__`.


---

Comment by mantepse created at 2016-09-27 18:36:02

Oh, thanks!  I somehow didn't see that I really don't do anything but passing the arguments...

Related question: should I replace the (soft) requirement to implement `_shape_from_labels` with the (soft) requirement to implement the rank function of the dual graded graphs?  ("soft" means that not implementing this doesn't render the whole thing useless, just less practical: without it, one has to provide the shape of the region always.)

The downside is: it might be that the covering relation is easier than the rank function...  Moreover, if we want to check the argument `labels`, we need the two covering relations, not just the rank.

On the other hand, it would be much less code.


---

Comment by tscrim created at 2016-09-27 18:40:41

I can't really answer that without doing a more detailed review, which I don't have the time right now for (maybe in a week or so).


---

Comment by git created at 2016-09-27 22:09:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-27 22:43:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-28 11:50:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-29 06:35:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-09-29 09:38:33

I need help with the following complaint of the patchbot:


```
========== next_method ==========
git checkout patchbot/ticket_merged
Already on 'patchbot/ticket_merged'
inside file:  b/src/sage/combinat/growth.py
@@ -0,0 +1,1374 @@
+            v = filling.itervalues().next()
python2-only .next() method inserted on 1 non-empty lines
Traceback (most recent call last):
  File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1060, in test_a_ticket
    baseline=baseline, **kwds)
  File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage_patchbot/plugins.py", line 358, in next_method
    msg="python2-only .next() method", **kwds)
  File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage_patchbot/plugins.py", line 214, in exclude_new
    raise ValueError(full_msg)
ValueError: python2-only .next() method inserted on 1 non-empty lines
next_method -- 0 seconds
========== end next_method ==========
```


What should I do about it?


---

Comment by tscrim created at 2016-09-29 12:29:58

Change `iter.next()` to (the Python3 compatible) `next(iter)`.

Edit - more explicitly: `filling.itervalues().next()` -> `next(filling.itervalues())`


---

Comment by chapoton created at 2016-09-29 18:29:25

you can and should get rid of the deprecation

```
+        sage: pi.descents()
+        doctest:...: DeprecationWarning: default behavior of descents may change in the near future to have indices starting from 1
+        See http://trac.sagemath.org/20555 for details.
+        [0, 2, 4, 5]
```

by setting explicitly `from_zero=True` (or False if you prefer):

```
sage: pi.descents(from_zero=True)
```



---

Comment by chapoton created at 2016-09-29 18:32:01

this is still to be corrected:

```
+    """A skew tableau.
```

by adding a line break between `"""` and `A`


---

Comment by git created at 2016-09-29 18:49:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-29 19:07:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-29 19:12:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-29 19:45:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-29 21:21:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-30 00:59:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-02 20:31:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-10-03 11:37:07

Questions for the reviewer...

Background:

The main object underlying the algorithm is the "dual graded graph", that is, a pair of graded digraphs on the same set of vertices, with the same rank function, satisfying some relations (mainly: `DU = UD + rI`, where `U` means "up" in one graph and `D` is down in the other graph).

However, the code is intended mostly for experimenting with growth diagrams.  In particular, it should be as easy as possible to define new rules. Thus it is important that nothing is enforced, unless needed.  For example, it is perfectly OK to define only `_forward_rule`, and leave all of `_rank_function`, `_covers_1` , `_covers_2`, `_zero` and `_backward_rule` undefined.  The only consequence should be that in this case some features will raise an error.

Moreover, I believe that the RSK growth diagrams aren't growth diagrams in the strict sense of the word: I think it makes more sense to say that they are destandardizations of growth diagrams on Young's lattice.  Thus, I certainly do not want to be strict.

So, all of what follows is probably cosmetics.

1) should `_rank_function`, `_covers_1` , `_covers_2`, `_zero`, `_forward_rule` and `_backward_rule` be `staticmethod`s instead of attributes?

2) if these become methods, I think we should make them public, too, right?

3) it would be nice to be able to define a growth diagram completely interactively, by just specifying, for example, the forward rule.  I tried:

```
sage: from growth import GrowthDiagramOnPartitions
sage: class MyG(GrowthDiagramOnPartitions):
....:     @staticmethod
....:     def _forward_rule(a, b, c, d):
....:         pass
....:     
sage: MyG._forward_rule = GrowthDiagramDomino._forward_rule
sage: MyG([1])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
TypeError: _forward_rule() takes exactly 4 arguments (5 given)
```

so this doesn't work.  Should we have a function `growth_diagram(forward_rule=None, backward_rule=None)` that returns a class?  Or is there a more practical way to interactively redefine methods of a class?


---

Comment by git created at 2016-10-04 11:47:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-04 12:55:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-10-04 18:06:56


```
sage -t --long src/sage/combinat/growth.py  # 16 doctests failed
```



---

Comment by mantepse created at 2016-10-04 18:22:03

Replying to [comment:39 chapoton]:
> {{{
> sage -t --long src/sage/combinat/growth.py  # 16 doctests failed
> }}}

Did you apply #21609 first?


---

Comment by chapoton created at 2016-10-04 18:24:56

This is coming from a patchbot, see there. In principle, it applies the dependencies, I think.


---

Comment by mantepse created at 2016-10-04 18:33:28

Replying to [comment:41 chapoton]:
> This is coming from a patchbot, see there. In principle, it applies the dependencies, I think.
Well, the error message is precisely the one to be expected if the dependency is not applied.  How can I check?


---

Comment by chapoton created at 2016-10-04 18:36:51

Look at

https://patchbot.sagemath.org/log/21594/Ubuntu/14.04/x86_64/3.16.0-30-generic/petitbonum/2016-10-04%2016:59:58?short

Do you say that these errors are the ones coming from not applying the dependency ?


---

Comment by mantepse created at 2016-10-04 18:51:33

Replying to [comment:43 chapoton]:
> Look at
> 
> https://patchbot.sagemath.org/log/21594/Ubuntu/14.04/x86_64/3.16.0-30-generic/petitbonum/2016-10-04%2016:59:58?short
> 
> Do you say that these errors are the ones coming from not applying the dependency ?

Exactly.


---

Comment by chapoton created at 2016-10-04 18:52:29

ok, then the bot is not pulling the dependency. I have no time to solve that.


---

Comment by git created at 2016-10-18 07:39:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-19 17:10:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-10-19 21:07:58

This looks like a really useful update. But the documentation is rather vague about how the various growth rules are defined :/ Martin, is there a single source whose notations you are following, or is it patchwork? Would you consider perhaps writing a mathematical exposition along with this patch? To me it's not immediately obvious even how your RSK-growth is defined. There are two ways to define growth rules for (semistandard) RSK: Either you work in Young's lattice, with only 0's and 1's in cells, after standardizing your two words into two permutations. Or you work in the directed graph whose vertices correspond to partitions and whose edges correspond to horizontal strips (of any length), and the cells can contain any nonnegative integers; the growth rule is a discrete analogue of the octahedron recurrence. Which of these two are you using?


---

Comment by darij created at 2016-10-19 21:08:57

PS. Seems like my commit hasn't been shown:

https://git.sagemath.org/sage.git/commit/?h=85982673ab2490dd6b845a90051d189c4140aa1b


---

Comment by mantepse created at 2016-10-20 07:04:09

Dear Darij!

Many thanks for your encouragement and the improvements of the documentation, especially for the `x`'s!

I do not know of a single source containing all the known rules, the references are what I accumulated over the years.  In fact, I'm quite sure I'm missing some.

However, for each rule I implemented, I gave a reference - as precisely as the article allows - in the corresponding methods `_forward_rule` and `_backward_rule`.

Replying to [comment:49 darij]:
> There are two ways to define growth rules for (semistandard) RSK: Either you work in Young's lattice, with only 0's and 1's in cells, after standardizing your two words into two permutations. Or you work in the directed graph whose vertices correspond to partitions and whose edges correspond to horizontal strips (of any length), and the cells can contain any nonnegative integers; the growth rule is a discrete analogue of the octahedron recurrence. Which of these two are you using?

(That's a nice way to learn new stuff :-)  I admit, I just implemented the rules (long ago, in 2008 or so) without worrying too much on the underlying dual graded graphs.  In any case, as far as I can see the notion of dual graded graphs is too restrictive for RSK.  So, what I assumed is that the growth rules from Christian's paper simply "destandardize" each entry of the matrix.

Is http://web.mit.edu/~shopkins/docs/rsk.pdf what I should be reading?  I'm keen to learn more about that.

To clarify: with 'make semistandard extension generic' I meant that it might be good to have a procedure that standardizes the filling (in one of the 4 possible ways), and then applies the rules.  A horizontal strip is then a list of vertices.  In the RSK case, it is sufficient to remember the last shape of the horizontal strip, but I did not check under which conditions precisely this is true in the general case.


---

Comment by mantepse created at 2016-10-31 10:39:09

I just noticed that doing `GrowthDiagramRSK?` is not all that helpful, it only displays

```
   A class modelling Robinson-Schensted-Knuth insertion.

   EXAMPLES:

      sage: pi = Permutation([2,3,6,1,4,5])
      sage: G = GrowthDiagramRSK(pi)
      sage: G.P_symbol(), G.Q_symbol()
      ([[1, 3, 4, 5], [2, 6]], [[1, 2, 3, 6], [4, 5]])
      sage: RSK(pi)
      [[[1, 3, 4, 5], [2, 6]], [[1, 2, 3, 6], [4, 5]]]
```

which should not come as a surprise, but it did.  Somehow I thought that the parent's documentation would be included...

(besides: instead some documentation for `LazyImport` is displayed, three times in fact, which is annoying and stupid)

So, what should I do to make sage display the documentation of the parent class `GrowthDiagram`?  I certainly do not want to duplicate it in every subclass, it is always the same and rather long!  `automethod`?


---

Comment by chapoton created at 2016-11-04 19:51:55

from patchbot report:

please use python3-compatible syntax for print, namely `print("stuff")`

```
++                print shape1, shape2, shape3
++                print shape1.parent(), shape2.parent(), shape3.parent()
++                print shape1 == shape2
++                print shape2 == shape3
+python2-only print syntax inserted on 4 non-empty lines
```

and please do not use iteritems but items:

```
++        F = {(j,i): v for (i,j),v in self._filling.iteritems()}
++        F = {(max_row-i,max_col-j): v for (i,j),v in self._filling.iteritems()}
++            for ((i,j), v) in self._filling.iteritems():
++            for ((i,j), v) in sorted(self._filling.iteritems()):
++                    for (i, row) in filling.iteritems():
++                        for (j, v) in row.iteritems():
++                    F = {(i,j): v for ((i,j), v) in filling.iteritems()
+Python 3 incompatible code inserted on 8 non-empty lines
```



---

Comment by git created at 2016-11-04 20:47:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-15 20:04:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-11-15 20:06:30

One aestetic problem I still have is that

```
sage: GrowthDiagramRSK?
```

does not show the docstring of the `__init__` method, because it is imported lazily.  Doing

```
sage: from sage.combinat.growth import *
```

fixes this, but surely, this is not the way things ought to be?


---

Comment by chapoton created at 2017-01-02 12:20:37

and do not use "bla.itervalues()" but

```
from six import itervalues

itervalues(bla)
```



---

Comment by git created at 2017-01-05 09:36:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2017-01-05 09:37:36

Any chance that this get's a review?  Would be great...


---

Comment by rkarpman created at 2017-01-12 11:38:48

We're on it. We're quite new with this (this is our first review) but we're willing to read and test and comment! (I'm doing this with `@`etzanaki )


---

Comment by rkarpman created at 2017-01-12 11:40:34

Changing keywords from "" to "days82".


---

Comment by chapoton created at 2017-01-14 08:38:30

+Missing doctests in combinat/growth.py: 35 / 40 = 87%


---

Comment by mantepse created at 2017-01-14 10:03:54

Replying to [comment:65 chapoton]:
> +Missing doctests in combinat/growth.py: 35 / 40 = 87%

I think they are not really missing, it's a misfeature of the coverage tool:

```
Missing doctests:
     * line 208: def __init__(self, filling=None, shape=None, labels=None)
```

This is the init of an abstract class.

```
Missing documentation:
     * line 1014: def __init__(self, filling=None, shape=None, labels=None)
     * line 1165: def __init__(self, filling=None, shape=None, labels=None)
     * line 1411: def __init__(self, filling=None, shape=None, labels=None)
     * line 1554: def __init__(self, filling=None, shape=None, labels=None)
```

These get their documentation set explicitely in the following lines.


---

Comment by mantepse created at 2017-01-25 12:27:37

ping?


---

Comment by chapoton created at 2017-01-25 14:37:54

could you do one last thing:

```
-   arXiv:0705.2689 (2007)
+   :arxiv:`0705.2689` (2007)
```

then you can set to positive on my behalf.


---

Comment by git created at 2017-01-25 19:32:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2017-01-25 19:33:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-28 17:03:56

Resolution: fixed


---

Comment by jdemeyer created at 2017-02-11 15:41:26

This is not valid Python 3:

```
lambda (a,b): True
```

This should have been written as

```
lamdba ab: True
```



---

Comment by mantepse created at 2017-02-11 19:09:29

Thanks!  I'm adding a fix to #22356.  (currently recompiling)


---

Comment by vbraun created at 2017-02-11 19:22:15

Should be fixed in #22357 or a separate ticket...
