# Issue 12251: Numpy wrongly assume that any non-i386 OS X system is PowerPC

Issue created by migration from https://trac.sagemath.org/ticket/12423

Original creator: jdemeyer

Original creation time: 2012-02-03 23:43:18

Assignee: tbd

Apparently Numpy forgot about the existence of "x86_64" systems:

```
Python 2.7.2 (default, Feb  3 2012, 15:29:15)
[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from distutils.util import get_platform
>>> get_platform()
'macosx-10.6-x86_64'
```


The bug is in `src/numpy/distutils/system_info.py`:

```
        if sys.platform=='darwin' and not os.environ.get('ATLAS',None):
            args = []
            link_args = []
            if get_platform()[-4:] == 'i386':
                intel = 1
            else:
                intel = 0
```



---

Comment by jdemeyer created at 2012-02-04 12:08:01

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-02-10 12:52:01

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-02-10 13:01:46

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2012-02-10 13:02:08

Diff for the numpy spkg, for review only


---

Comment by was created at 2012-02-13 15:26:29

Changing status from needs_review to needs_work.


---

Attachment

Please remove everything from the patch that involves deleting support for Cygwin.  Though I'm now not gung ho about the future of porting Sage to Cygwin and using it, I definitely don't think we should start silently sneaking in removing bits of cygwin support left and right all over in Sage!  If somebody already did the work to figure out how to get numpy to build on Cygwin, let's not just delete that.  What if I'm wrong, and it turns out that some genius does get Sage working well on Cygwin (and if nothing else, deleting cygwin support should be a different ticket).

The actual change for OS X 10.7 seems to be:
 
  * general clean up SPKG.txt -- good!
  * test for "intel" or "i386" instead of just "i386" -- can't be bad.

So I think the cygwin deletions should be deleted from this patch, then this should get a positive review once somebody checks that it actually works. 

William


---

Comment by jdemeyer created at 2012-02-13 15:51:37

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2012-02-13 15:51:37

Replying to [comment:11 was]:
> Please remove everything from the patch that involves deleting support for Cygwin.
There is no such thing.  I am only removing the _patched_ file, not the _patch_.  This is because I changed the spkg to use "patch" instead of "cp" to apply patches.  So it should still work as before on Cygwin (even though I haven't tested this).

> The actual change for OS X 10.7 seems to be:
>  
>   * general clean up SPKG.txt -- good!
>   * test for "intel" or "i386" instead of just "i386" -- can't be bad.
> 
> So I think the cygwin deletions should be deleted from this patch, then this should get a positive review once somebody checks that it actually works. 
Since there is no problem with Cygwin and since it does actually work, I take this as "positive_review".


---

Comment by was created at 2012-02-13 16:38:24

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 was]:
> > Please remove everything from the patch that involves deleting support for Cygwin.
> There is no such thing.  I am only removing the _patched_ file, not the _patch_.  This is because I changed the spkg to use "patch" instead of "cp" to apply patches.  So it should still work as before on Cygwin (even though I haven't tested this).
> 

Thanks for the clarification.  In fact, what you've done is really, really good. 

> > The actual change for OS X 10.7 seems to be:
> >  
> >   * general clean up SPKG.txt -- good!
> >   * test for "intel" or "i386" instead of just "i386" -- can't be bad.
> > 
> > So I think the cygwin deletions should be deleted from this patch, then this should get a positive review once somebody checks that it actually works. 
> Since there is no problem with Cygwin and since it does actually work, I take this as "positive_review".

Indeed.  OK, positive_review.


---

Comment by jdemeyer created at 2012-02-22 10:46:03

Resolution: fixed
