# Issue 15507: Speed up MPC multiplication

archive/issues_015507.json:
```json
{
    "body": "CC:  zimmerma jpflori\n\nAdd a patch from upstream which significantly speeds up MPC multiplication.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15744\n\n",
    "created_at": "2014-01-27T14:08:47Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Speed up MPC multiplication",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15507",
    "user": "jdemeyer"
}
```
CC:  zimmerma jpflori

Add a patch from upstream which significantly speeds up MPC multiplication.

Issue created by migration from https://trac.sagemath.org/ticket/15744





---

archive/issue_comments_200365.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-27T14:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200365",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_200366.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-27T14:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200366",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200367.json:
```json
{
    "body": "For future ref, patch taken from upstream commit r1439 (https://gforge.inria.fr/scm/viewvc.php/trunk/src/mul.c?root=mpc&r1=1298&r2=1439).",
    "created_at": "2014-02-19T12:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200367",
    "user": "jpflori"
}
```

For future ref, patch taken from upstream commit r1439 (https://gforge.inria.fr/scm/viewvc.php/trunk/src/mul.c?root=mpc&r1=1298&r2=1439).



---

archive/issue_comments_200368.json:
```json
{
    "body": "Everything looks fine and multiplication is indeed sped up.",
    "created_at": "2014-02-19T13:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200368",
    "user": "jpflori"
}
```

Everything looks fine and multiplication is indeed sped up.



---

archive/issue_comments_200369.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-19T13:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200369",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200370.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-22T06:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200370",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_200371.json:
```json
{
    "body": "I have added a new function `mpfr_fmma` (and its companion `mpfr_fmms`) in the development version of MPFR. This function is now used in the development version of MPC. Those functions should be faster than the patch used in this ticket. Please could someone update the timings with those new functions?\n\n1. Get the development (svn) version of MPFR.\n2. Get the development (git) version of MPC, and check that configure finds `mpfr_fmma` and it is used in `mpc_mul`.\n3. Rebuild Sage with those version of MPFR and MPC.\n\nPaul\n\nPS: the 1.74ms for ComplexField in 1024 bits looks dubious to me, if you compare to 0.77ms for 360 bits. What is the command used for those timings?",
    "created_at": "2016-01-15T08:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200371",
    "user": "zimmerma"
}
```

I have added a new function `mpfr_fmma` (and its companion `mpfr_fmms`) in the development version of MPFR. This function is now used in the development version of MPC. Those functions should be faster than the patch used in this ticket. Please could someone update the timings with those new functions?

1. Get the development (svn) version of MPFR.
2. Get the development (git) version of MPC, and check that configure finds `mpfr_fmma` and it is used in `mpc_mul`.
3. Rebuild Sage with those version of MPFR and MPC.

Paul

PS: the 1.74ms for ComplexField in 1024 bits looks dubious to me, if you compare to 0.77ms for 360 bits. What is the command used for those timings?



---

archive/issue_comments_200372.json:
```json
{
    "body": "Jeroen, please could you redo the timings with the new `mpfr_fmma` from the development version of MPFR (as indicated in comment [comment:11]), and publish the code you used in the description so that we can reproduce your timings?",
    "created_at": "2016-02-17T08:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15507#issuecomment-200372",
    "user": "zimmerma"
}
```

Jeroen, please could you redo the timings with the new `mpfr_fmma` from the development version of MPFR (as indicated in comment [comment:11]), and publish the code you used in the description so that we can reproduce your timings?
