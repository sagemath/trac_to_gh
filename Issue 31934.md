# Issue 31934: Matrix: Add generic SVD method using sympy

archive/issues_031934.json:
```json
{
    "body": "CC:  @honglizhaobob\n\n(from #31992)\n\n#31942 added `_sympy_` methods for matrices and vectors.\n\nBased on this, we can now implement various matrix methods using Sympy.\n\nIn this ticket, we add SVD (singular value decomposition) https://docs.sympy.org/latest/modules/matrices/matrices.html\n\nThis provides exact and symbolic SVD. Sage currently only has one implementation, for RDF, using `scipy.linalg`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32171\n\n",
    "created_at": "2021-07-09T22:09:02Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Matrix: Add generic SVD method using sympy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31934",
    "user": "mkoeppe"
}
```
CC:  @honglizhaobob

(from #31992)

#31942 added `_sympy_` methods for matrices and vectors.

Based on this, we can now implement various matrix methods using Sympy.

In this ticket, we add SVD (singular value decomposition) https://docs.sympy.org/latest/modules/matrices/matrices.html

This provides exact and symbolic SVD. Sage currently only has one implementation, for RDF, using `scipy.linalg`.

Issue created by migration from https://trac.sagemath.org/ticket/32171





---

archive/issue_comments_456287.json:
```json
{
    "body": "This would go into `src/sage/matrix/matrix2.pyx`",
    "created_at": "2021-07-09T22:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31934#issuecomment-456287",
    "user": "mkoeppe"
}
```

This would go into `src/sage/matrix/matrix2.pyx`



---

archive/issue_comments_456288.json:
```json
{
    "body": "I think the documentation should make very clear that in 99% of the cases, it is better to use scipy and work over `RDF`/`CDF` if one expects a numerical result, rather than using sympy with `RR`. The sympy implementation gets very slow for larger matrices.\n\nAlso, even though sympy seems to support singular value decompositions up to precision 83 (or at least does not raise an error), the result is not really much more accurate compared to `RDF`. In fact, the result has 53-bit precision as well.\n\n\n```\nsage: a = matrix.random(RealField(83), 10)\nsage: b = a._sympy_().as_mutable()\nsage: U,S,V = b.singular_value_decomposition()\nsage: u,s,v = a.change_ring(RDF).SVD()\nsage: (U * S * V.H - b).norm('fro'), (u * s * v.H - a).norm('frob')\n(1.73609121130844744221236e-15, 5.9963160390748384e-15)\nsage: S[0,0]._prec\n53\n```\n\n----\nNew commits:",
    "created_at": "2021-07-18T14:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31934#issuecomment-456288",
    "user": "@mwageringel"
}
```

I think the documentation should make very clear that in 99% of the cases, it is better to use scipy and work over `RDF`/`CDF` if one expects a numerical result, rather than using sympy with `RR`. The sympy implementation gets very slow for larger matrices.

Also, even though sympy seems to support singular value decompositions up to precision 83 (or at least does not raise an error), the result is not really much more accurate compared to `RDF`. In fact, the result has 53-bit precision as well.


```
sage: a = matrix.random(RealField(83), 10)
sage: b = a._sympy_().as_mutable()
sage: U,S,V = b.singular_value_decomposition()
sage: u,s,v = a.change_ring(RDF).SVD()
sage: (U * S * V.H - b).norm('fro'), (u * s * v.H - a).norm('frob')
(1.73609121130844744221236e-15, 5.9963160390748384e-15)
sage: S[0,0]._prec
53
```

----
New commits:



---

archive/issue_comments_456289.json:
```json
{
    "body": "That's a great point, thanks for looking into this. The main use case for using sympy here should be symbolic SVD.",
    "created_at": "2021-07-18T17:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31934#issuecomment-456289",
    "user": "mkoeppe"
}
```

That's a great point, thanks for looking into this. The main use case for using sympy here should be symbolic SVD.
