# Issue 24451: implement falting height of an elliptic curve

Issue created by migration from https://trac.sagemath.org/ticket/24688

Original creator: klui

Original creation time: 2018-02-08 02:03:05

CC:  cremona nbruin

The goal of this ticket is to be able to determine the falting height of an elliptic curve.


---

Comment by klui created at 2018-02-08 23:00:21

Changing type from PLEASE CHANGE to enhancement.


---

Comment by klui created at 2018-02-08 23:00:21

Changing keywords from "" to "elliptic curves, faltings height".


---

Comment by klui created at 2018-02-08 23:00:21

Changing priority from major to minor.


---

Comment by klui created at 2018-02-08 23:00:21

Changing component from PLEASE CHANGE to elliptic curves.


---

Comment by git created at 2018-04-24 19:18:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klui created at 2018-04-24 19:20:23

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-05-01 12:33:57

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-05-01 12:33:57

You should fill the `Authors` field with your full name.


---

Comment by klui created at 2018-05-02 17:42:27

Thanks!


---

Comment by git created at 2018-06-20 22:35:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-20 23:26:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-06-21 06:13:02

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-06-21 19:45:27

Maybe you could do that over any number field, if possible ? using something like

```
A = self.base_ring()
emb = A.embeddings(RR)[0]
return -self.period_lattice(emb).complex_area().log() / 2
```

but an expert opinion is required. John ?


---

Comment by alexjbest created at 2018-06-22 03:46:05

Is this really ready for review?
I'm a little confused as to what this is meant to do, is it meant to match Magma's FaltingsHeight? For example in Magma V2.22-6


```c
> E := EllipticCurve("32a");
> E;
Elliptic Curve defined by y^2 = x^3 + 4*x over Rational Field
> FaltingsHeight(E);
-1.31053292591150951825227508330
```

quite different from the output this ticket gives, and the code in Magma is a lot more involved, picks a minimal model, uses the denominator of the j-invariant, discriminant etc.

The Magma documentation leaves a lot to be desired here I think.


---

Comment by klui created at 2018-06-22 04:44:14

I forgot the web calculator exists so I only checked it against MagmaV2.18-5. And in that version, the height was dependent on the model which was rather confusing to me. I always worked with the minimal model anyways so that difference didn't matter to me.

I'm happy to see that that has changed:


```
E := EllipticCurve("32a");
FaltingsHeight(E);
FaltingsHeight(WeierstrassModel(E));
```

yields


```
-1.31053292591150951825227508330
-1.31053292591150951825227508330
```

using http://magma.maths.usyd.edu.au/calc/ .

My interest in Faltings height is using Steven's conjecture to identify the J_1(N)-optimal curve in a given isogeny class. So the goal of this ticket was the compute whatever height is used in Steven's conjecture. So I took what was defined in Remark 3.3 here: https://arxiv.org/pdf/math/0404333.pdf and re-normalized it so that it matched with Magma. Though now I'm not sure what Magma is computing anymore. It seems to different than what's documented here: https://magma.maths.usyd.edu.au/magma/handbook/text/1455

In any case, I should change it so that it uses the minimal model.


---

Comment by git created at 2018-06-22 04:52:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-06-22 08:10:58

No time for detailed comment now but it should not depend on model being minimal -- over number fields there is not always a global minimal model -- so there is a formula which is independent of model, though it is simpler (and possible over Q) to use a simpler formula valid only for minimal models.

klui, I like your project.  If you want to do this with no computation at all use the files at https://github.com/JohnCremona/ecdata/tree/master/allbsd (see under "TABLE FOUR" at http://johncremona.github.io/ecdata/ for description of their content).


---

Comment by klui created at 2018-06-22 18:00:22

Replying to [comment:15 cremona]:
> No time for detailed comment now but it should not depend on model being minimal -- over number fields there is not always a global minimal model -- so there is a formula which is independent of model, though it is simpler (and possible over Q) to use a simpler formula valid only for minimal models.
> 
The only model-independent formula I know of requires computing the minimal discriminant anyways so it should be okay to just compute the minimal model, from a speed-perspective as well.
> klui, I like your project.  If you want to do this with no computation at all use the files at https://github.com/JohnCremona/ecdata/tree/master/allbsd (see under "TABLE FOUR" at http://johncremona.github.io/ecdata/ for description of their content).
I think I'm being slow but I don't see how knowing the BSD invariants help with computing the Faltings height.


---

Comment by pbruin created at 2020-01-14 16:47:48

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2020-01-14 16:47:48

Instead of saying that this uses the same normalisation as Magma, I suggest putting a definition or formula in the documentation.  For the elliptic curve 32a1, the output agrees with the function `ellheight` in PARI but seems to be half of that returned by Magma.

For a future generalisation to number fields, the PARI function `ellheight` does the same thing as this function over *Q* and also works over number fields.


---

Comment by cremona created at 2021-03-16 15:29:47

I am planning to revise and resubmit this patch, with an option to return either the (unstable) Faltings height as the code now does (-log(A)/2) or the stable height which adds log(denom(j)/abs(disc))/12 -- the result being the same for semistable curves (since denom(j)=abs(disc) for a minimal model of a semistable curve, as then gcd(c4,disc)=1), and independent of the model.


---

Comment by cremona created at 2021-03-16 17:12:16

Changing status from needs_work to needs_review.


---

Comment by cremona created at 2021-03-16 17:12:16

I merged the previous branch with 9.3.beta9, and enhanced the method by having `stable` as an optional parameter (default `False`) and adding a precision parameter.  I added extra tests to show how the stable and unstable heights are the same for semistable curves (but not otherwise) and how the stable height is independent of the model while the unstable one is not.

I included definitions (but no citations).

Obviously we'll also want a version of this for number fields too, but I think this is enough for now.  Please re-review!
----
New commits:


---

Comment by chapoton created at 2021-03-19 11:01:21

the bot is green and this looks good, so let it be (not a mathematical review)


---

Comment by chapoton created at 2021-03-19 11:01:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-03-20 20:54:51

Resolution: fixed
