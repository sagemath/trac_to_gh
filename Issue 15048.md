# Issue 15048: Bug in AffineGeometryDesign

archive/issues_015048.json:
```json
{
    "body": "A `List` is used instead of a `Set`, and as a result blocks are returned several times. Example :\n\nBefore\n\n```\nsage: print designs.AffineGeometryDesign(2, 1, GF(2)).blocks()\n[[0, 1], [0, 1], [0, 2], [0, 2], [0, 3], [0, 3], [1, 2], \n [1, 2], [1, 3], [1, 3], [2, 3], [2, 3]]\n```\n\nAfter\n\n```\nsage: print designs.AffineGeometryDesign(2, 1, GF(2)).blocks()\n[[0, 1], [0, 2], [0, 3], [1, 2], [1, 3], [2, 3]]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15285\n\n",
    "created_at": "2013-10-16T13:58:02Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Bug in AffineGeometryDesign",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15048",
    "user": "https://github.com/nathanncohen"
}
```
A `List` is used instead of a `Set`, and as a result blocks are returned several times. Example :

Before

```
sage: print designs.AffineGeometryDesign(2, 1, GF(2)).blocks()
[[0, 1], [0, 1], [0, 2], [0, 2], [0, 3], [0, 3], [1, 2], 
 [1, 2], [1, 3], [1, 3], [2, 3], [2, 3]]
```

After

```
sage: print designs.AffineGeometryDesign(2, 1, GF(2)).blocks()
[[0, 1], [0, 2], [0, 3], [1, 2], [1, 3], [2, 3]]
```


Issue created by migration from https://trac.sagemath.org/ticket/15285





---

archive/issue_comments_192185.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-16T14:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192185",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_192186.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-10-16T14:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192186",
    "user": "https://github.com/nathanncohen"
}
```

New commits:



---

archive/issue_comments_192187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-07T08:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192188.json:
```json
{
    "body": "Looks good, but I do not understand the doctests about\n\n`AffineGeometryDesign(3, 2, GF(2))`\n\nWhy do the parameters differ from the result of `is_block_design` ?\n\nIs it because it is a 3-(something) design and not a 2-(something) design ?\n\nIf so, maybe you should rather use rather BD.parameters(t=3) ?",
    "created_at": "2014-01-09T20:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192188",
    "user": "https://github.com/fchapoton"
}
```

Looks good, but I do not understand the doctests about

`AffineGeometryDesign(3, 2, GF(2))`

Why do the parameters differ from the result of `is_block_design` ?

Is it because it is a 3-(something) design and not a 2-(something) design ?

If so, maybe you should rather use rather BD.parameters(t=3) ?



---

archive/issue_comments_192189.json:
```json
{
    "body": "Yoooooooooo !!\n\n> Looks good, but I do not understand the doctests about\n> \n> `AffineGeometryDesign(3, 2, GF(2))`\n> \n> Why do the parameters differ from the result of `is_block_design` ?\n> \n> Is it because it is a 3-(something) design and not a 2-(something) design ?\n> \n> If so, maybe you should rather use rather BD.parameters(t=3) ?\n\n\nAhahaha. Design codes are tricky `:-P`\n\nThe first number is the size of the sets that the design covers. That does not change.\n\nThe second number is the number of points, and that does not change.\n\nThe third number is the size of the sets contained in the design. This does not change.\n\nThe fourth number is the number of times each set to be covered is actually covered. And this one changes, because as each set was present too many times in the design, the set were covered too many times too.\n\nBut the parameter 't' has no reason to change.\n\nNathann",
    "created_at": "2014-01-09T21:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192189",
    "user": "https://github.com/nathanncohen"
}
```

Yoooooooooo !!

> Looks good, but I do not understand the doctests about
> 
> `AffineGeometryDesign(3, 2, GF(2))`
> 
> Why do the parameters differ from the result of `is_block_design` ?
> 
> Is it because it is a 3-(something) design and not a 2-(something) design ?
> 
> If so, maybe you should rather use rather BD.parameters(t=3) ?


Ahahaha. Design codes are tricky `:-P`

The first number is the size of the sets that the design covers. That does not change.

The second number is the number of points, and that does not change.

The third number is the size of the sets contained in the design. This does not change.

The fourth number is the number of times each set to be covered is actually covered. And this one changes, because as each set was present too many times in the design, the set were covered too many times too.

But the parameter 't' has no reason to change.

Nathann



---

archive/issue_comments_192190.json:
```json
{
    "body": "Let me re-ask my question, trying to be more clear.\n\n**After the commits** (and before also), the doctests show that\n\n`.parameters` and `.is_block_design` give the same numbers for `AffineGeometryDesign(3, 1, GF(2))`\n\nbut not for `AffineGeometryDesign(3, 2, GF(2))`\n\nWhy is it so ? Are they supposed to always give the same result ?",
    "created_at": "2014-01-10T08:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192190",
    "user": "https://github.com/fchapoton"
}
```

Let me re-ask my question, trying to be more clear.

**After the commits** (and before also), the doctests show that

`.parameters` and `.is_block_design` give the same numbers for `AffineGeometryDesign(3, 1, GF(2))`

but not for `AffineGeometryDesign(3, 2, GF(2))`

Why is it so ? Are they supposed to always give the same result ?



---

archive/issue_comments_192191.json:
```json
{
    "body": "Yooooo !\n\n> Let me re-ask my question, trying to be more clear.\n> \n> **After the commits** (and before also), the doctests show that\n> \n> `.parameters` and `.is_block_design` give the same numbers for `AffineGeometryDesign(3, 1, GF(2))`\n> \n> but not for `AffineGeometryDesign(3, 2, GF(2))`\n> \n> Why is it so ? Are they supposed to always give the same result ?\n\n\n`O_o`\n\nWell, I have absolutely no idea. I don't use this `BlockDesign` class. Hmmmmmm.. Let me see.\n\nThe docstring of `parameters` says that it does not check if the input is a block design (which can be costly). It just counts the number of blocks. And I am reading the code of `is_block_design` right now but I don't actually get it.\n\nFor the record \n\n```\nsage: IncidenceStructure([0,1],[[0,1]]*15).parameters()      \n(2, 2, 2, 15)\nsage: IncidenceStructure([0,1],[[0,1]]*15).is_block_design()\n...\nUnboundLocalError: local variable 't' referenced before assignment\n```\n\nAnd there, they do not return the same\n\n```\nsage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).is_block_design()\n(True, [1, 3, 2, 15])\nsage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).parameters()     \n(2, 3, 2, 15)\n```\n\nOh, I finally understand what you said ! And why you talked of this `t`. Well, I guess that both functions should always return the same, except when the incidence structure is not really a block design. Which `parameters` is not supposed to notice.\n\nBut they should agree on this `t` anyway. Especially if they agree on all other coordinates. And it looks like `is_block_design` is the one that is wrong here.\n\nHmmmm...\n\nWell it seems wrong but I really do not understand what the code does. And this `range(2, min(v, 11))` definitely looks like a cheap trick to not do anything if `t` is larger than  11...\n\nActually, I do not understand why this function does not call `parameter` to guess the value of `t,v,k,lambda`, then checks that the incidence structure is indeed such a design. \n\nThat's all I can say right now. I really don't understand the part of the code included in this `for` loop on `t`.\n\nNathann",
    "created_at": "2014-01-10T08:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192191",
    "user": "https://github.com/nathanncohen"
}
```

Yooooo !

> Let me re-ask my question, trying to be more clear.
> 
> **After the commits** (and before also), the doctests show that
> 
> `.parameters` and `.is_block_design` give the same numbers for `AffineGeometryDesign(3, 1, GF(2))`
> 
> but not for `AffineGeometryDesign(3, 2, GF(2))`
> 
> Why is it so ? Are they supposed to always give the same result ?


`O_o`

Well, I have absolutely no idea. I don't use this `BlockDesign` class. Hmmmmmm.. Let me see.

The docstring of `parameters` says that it does not check if the input is a block design (which can be costly). It just counts the number of blocks. And I am reading the code of `is_block_design` right now but I don't actually get it.

For the record 

```
sage: IncidenceStructure([0,1],[[0,1]]*15).parameters()      
(2, 2, 2, 15)
sage: IncidenceStructure([0,1],[[0,1]]*15).is_block_design()
...
UnboundLocalError: local variable 't' referenced before assignment
```

And there, they do not return the same

```
sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).is_block_design()
(True, [1, 3, 2, 15])
sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).parameters()     
(2, 3, 2, 15)
```

Oh, I finally understand what you said ! And why you talked of this `t`. Well, I guess that both functions should always return the same, except when the incidence structure is not really a block design. Which `parameters` is not supposed to notice.

But they should agree on this `t` anyway. Especially if they agree on all other coordinates. And it looks like `is_block_design` is the one that is wrong here.

Hmmmm...

Well it seems wrong but I really do not understand what the code does. And this `range(2, min(v, 11))` definitely looks like a cheap trick to not do anything if `t` is larger than  11...

Actually, I do not understand why this function does not call `parameter` to guess the value of `t,v,k,lambda`, then checks that the incidence structure is indeed such a design. 

That's all I can say right now. I really don't understand the part of the code included in this `for` loop on `t`.

Nathann



---

archive/issue_comments_192192.json:
```json
{
    "body": "I am about to send you and David an email. Looks like he is the one who wrote this code.\n\nNathann",
    "created_at": "2014-01-10T10:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192192",
    "user": "https://github.com/nathanncohen"
}
```

I am about to send you and David an email. Looks like he is the one who wrote this code.

Nathann



---

archive/issue_comments_192193.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-10T10:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192193",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_192194.json:
```json
{
    "body": "The docstring for designs.AffineGeometryDesign is not clear. It mentions an input \"v\" that's not an input.",
    "created_at": "2014-01-10T10:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192194",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

The docstring for designs.AffineGeometryDesign is not clear. It mentions an input "v" that's not an input.



---

archive/issue_comments_192195.json:
```json
{
    "body": "> The docstring for designs.AffineGeometryDesign is not clear. It mentions an input \"v\" that's not an input.\n\n\nAhahahahah. Yes, indeed. I fix a bug in a function that is not perfectly documented, so I should fix it too.\n\nHonestly, no problem. But no double standard either : keep the same level of expectation when you review combinat/ patches. If nobody is allowed to touch a function when it doc is not perfect this thing will be cleaned in a couple of months `:-P`\n\nNathann",
    "created_at": "2014-01-10T10:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192195",
    "user": "https://github.com/nathanncohen"
}
```

> The docstring for designs.AffineGeometryDesign is not clear. It mentions an input "v" that's not an input.


Ahahahahah. Yes, indeed. I fix a bug in a function that is not perfectly documented, so I should fix it too.

Honestly, no problem. But no double standard either : keep the same level of expectation when you review combinat/ patches. If nobody is allowed to touch a function when it doc is not perfect this thing will be cleaned in a couple of months `:-P`

Nathann



---

archive/issue_comments_192196.json:
```json
{
    "body": "Personally, I will. Perfection is a lofty goal, but surely a correct list of inputs, output, and a few doctests is a reasonable requirement? I'm just following the guidelines:\n\nhttp://www.sagemath.org/doc/developer/trac.html#reviewing-patches",
    "created_at": "2014-01-10T10:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192196",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Personally, I will. Perfection is a lofty goal, but surely a correct list of inputs, output, and a few doctests is a reasonable requirement? I'm just following the guidelines:

http://www.sagemath.org/doc/developer/trac.html#reviewing-patches



---

archive/issue_comments_192197.json:
```json
{
    "body": "> Personally, I will. Perfection is a lofty goal, but surely a correct list of inputs, output, and a few doctests is a reasonable requirement? I'm just following the guidelines:\n\n\nYou have no idea how totally I agree with you. You are right.\n\nThe point is that I have very frequent exchanges of hate mail with Nicolas (among others) about this very subject. Because there is on #10963 a comment saying \"Okay, the patch is missing on the documentation side but let's consider it good as it is\". Because very basic parts of the Category stuff still has no documentation, you just have to \"talk to the right guys\", who know what is missing (i.e. the questions they have to answer). Because I am accused of slowing down people's work in #13624 (comments 38 to 41) when I say that packages break without any reason nor explanation, and request more doc. Hell, I am told I can't complain if a package breaks for no reason because it is \"experimental\".\n\nDon't misunderstand me. I totally agree with you. I just suffer of the double standard. And of feeling that I am the only one to complain constantly, while expecting myself to do this kind of work on my patches `:-P`\n\nAnyway, I added a commit. I also allowed to input an integer instead of a FiniteField, because I hate to build a field to see the code discard the field and use its cardinality only.\n\nAnd by the way, here is an interesting thing :\n\n```\nsage: 6.order()\n+Infinity\n```\n\nLet's always leave a better place than the one we entered.\n\nNathann",
    "created_at": "2014-01-10T11:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192197",
    "user": "https://github.com/nathanncohen"
}
```

> Personally, I will. Perfection is a lofty goal, but surely a correct list of inputs, output, and a few doctests is a reasonable requirement? I'm just following the guidelines:


You have no idea how totally I agree with you. You are right.

The point is that I have very frequent exchanges of hate mail with Nicolas (among others) about this very subject. Because there is on #10963 a comment saying "Okay, the patch is missing on the documentation side but let's consider it good as it is". Because very basic parts of the Category stuff still has no documentation, you just have to "talk to the right guys", who know what is missing (i.e. the questions they have to answer). Because I am accused of slowing down people's work in #13624 (comments 38 to 41) when I say that packages break without any reason nor explanation, and request more doc. Hell, I am told I can't complain if a package breaks for no reason because it is "experimental".

Don't misunderstand me. I totally agree with you. I just suffer of the double standard. And of feeling that I am the only one to complain constantly, while expecting myself to do this kind of work on my patches `:-P`

Anyway, I added a commit. I also allowed to input an integer instead of a FiniteField, because I hate to build a field to see the code discard the field and use its cardinality only.

And by the way, here is an interesting thing :

```
sage: 6.order()
+Infinity
```

Let's always leave a better place than the one we entered.

Nathann



---

archive/issue_comments_192198.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-10T11:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192199.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-10T11:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192199",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_192200.json:
```json
{
    "body": "I see your suffering. I don't interact with the combinat code usually, so I haven't encountered it. The discussion about the design parameters is unrelated to this ticket, so I'm happy to see this one go in!",
    "created_at": "2014-01-10T11:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192200",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

I see your suffering. I don't interact with the combinat code usually, so I haven't encountered it. The discussion about the design parameters is unrelated to this ticket, so I'm happy to see this one go in!



---

archive/issue_comments_192201.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-10T11:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192201",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_192202.json:
```json
{
    "body": "> The discussion about the design parameters is unrelated to this ticket, so I'm happy to see this one go in!\n\n\nThank you for the review !\n\nBy the way I wrote to Frederic and David Joyner about that. David just answered and told me that Peter Cameron wrote this code. We'll end up fixing it I hope `:-P`\n\nNathann",
    "created_at": "2014-01-10T11:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192202",
    "user": "https://github.com/nathanncohen"
}
```

> The discussion about the design parameters is unrelated to this ticket, so I'm happy to see this one go in!


Thank you for the review !

By the way I wrote to Frederic and David Joyner about that. David just answered and told me that Peter Cameron wrote this code. We'll end up fixing it I hope `:-P`

Nathann



---

archive/issue_comments_192203.json:
```json
{
    "body": "Ah. Peter Cameron and I attended the same workshop this week, but I don't see him around today. Perhaps he left early, otherwise I would have asked him about it ;-)",
    "created_at": "2014-01-10T12:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192203",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Ah. Peter Cameron and I attended the same workshop this week, but I don't see him around today. Perhaps he left early, otherwise I would have asked him about it ;-)



---

archive/issue_comments_192204.json:
```json
{
    "body": "> The discussion about the design parameters is unrelated to this ticket, so I'm happy to see this one go in!\n\n\nNow fixed in #15664.\n\nNathann",
    "created_at": "2014-01-12T10:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192204",
    "user": "https://github.com/nathanncohen"
}
```

> The discussion about the design parameters is unrelated to this ticket, so I'm happy to see this one go in!


Now fixed in #15664.

Nathann



---

archive/issue_events_044261.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-20T23:52:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15048#event-44261"
}
```



---

archive/issue_comments_192205.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-20T23:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15048#issuecomment-192205",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
