# Issue 29720: Bug in ContinuedFraction rounding

Issue created by migration from https://trac.sagemath.org/ticket/29957

Original creator: @kliem

Original creation time: 2020-06-24 14:16:04

CC:  slelievre vdelecroix

Keywords: continued fraction, rounding

Rounding with `RNDD` and `RNDZ` with 17 bits of precision doesn't work for the continued fraction of `1761/1024`:


```
sage: fields = []
sage: for rnd in ['RNDD', 'RNDZ']:
....:     fields.append(RealField(prec=17, rnd=rnd))
sage: a = 1761/1024  
sage: cf = continued_fraction(a)
sage: for R in fields:
....:     if R(cf) == R(a):
....:         print('this worked')
```


This contradicts a doctest in `src/sage/rings/continued_fraction.py` which claims pretty much that this always works (running a loop on 3000 random values with assertion error; but the values where never really random).


---

Comment by slelievre created at 2020-06-26 17:47:32

Changing component from PLEASE CHANGE to number theory.


---

Comment by chapoton created at 2020-09-24 11:18:33

Changing keywords from "continued fraction, rounding" to "continued_fraction, rounding".


---

Comment by slelievre created at 2021-02-26 12:23:27

Is the element constructor of `RealField(prec=17, rnd='RNDZ')` buggy?


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by @kliem created at 2021-06-29 18:52:55

Turns out there are failures for 8 a divisor of the denominator.

Some examples:

`32771/8`, `16391/16`, `8195/32`, `4115/64`, `2051/128`, `1091/256`, `515/512`, `259/1024`, `141/2048`, `79/4096`, `35/8192`, `25/16384`, `23/32768`, `7/65536`, `3/131072`, `5/262144`, `3/524288`.


---

Comment by @kliem created at 2021-07-05 15:59:12

For `a=39117938827825157072802367/91026195129981723206` there is a `ZeroDivisionError`.
