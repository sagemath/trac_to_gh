# Issue 16111: Cdd linker path

archive/issues_016111.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/16348\n\n",
    "created_at": "2014-05-13T14:17:54Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Cdd linker path",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16111",
    "user": "https://github.com/vbraun"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/16348





---

archive/issue_comments_209891.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-05-13T14:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209891",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_209892.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2014-05-13T14:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209892",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_209893.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-05-13T14:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209893",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_209894.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-13T14:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209894",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_209895.json:
```json
{
    "body": "Wouldn't it make sense to add a *separate* patch for this?\n\n(The other changes are unrelated, and probably subject to change/vanish with #15871.)",
    "created_at": "2014-05-13T15:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209895",
    "user": "https://github.com/nexttime"
}
```

Wouldn't it make sense to add a *separate* patch for this?

(The other changes are unrelated, and probably subject to change/vanish with #15871.)



---

archive/issue_comments_209896.json:
```json
{
    "body": "Feel free to change the way changes are split into patches.",
    "created_at": "2014-05-13T15:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209896",
    "user": "https://github.com/vbraun"
}
```

Feel free to change the way changes are split into patches.



---

archive/issue_comments_209897.json:
```json
{
    "body": "The main culprit is\n\n```make\nexport gmpdir := /usr/local\n```\n\nin `cddlib-094g.p0/src/Makefile`, so calling `$MAKE gmpdir=\"$SAGE_LOCAL` might also work without patching anything further, or just changing *that* line.",
    "created_at": "2014-05-13T15:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209897",
    "user": "https://github.com/nexttime"
}
```

The main culprit is

```make
export gmpdir := /usr/local
```

in `cddlib-094g.p0/src/Makefile`, so calling `$MAKE gmpdir="$SAGE_LOCAL` might also work without patching anything further, or just changing *that* line.



---

archive/issue_comments_209898.json:
```json
{
    "body": "Replying to [comment:4 vbraun]:\n> Feel free to change the way changes are split into patches.\n\nNot my job.",
    "created_at": "2014-05-13T15:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209898",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:4 vbraun]:
> Feel free to change the way changes are split into patches.

Not my job.



---

archive/issue_comments_209899.json:
```json
{
    "body": "You can override gmpdir, but then SAGE_LOCAL will be added multiple times to the include/linker path.",
    "created_at": "2014-05-13T15:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209899",
    "user": "https://github.com/vbraun"
}
```

You can override gmpdir, but then SAGE_LOCAL will be added multiple times to the include/linker path.



---

archive/issue_comments_209900.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-05-13T15:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209900",
    "user": "https://github.com/vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_209901.json:
```json
{
    "body": "Replying to [comment:7 vbraun]:\n> You can override gmpdir, but then SAGE_LOCAL will be added multiple times to the include/linker path.\n\n... which doesn't hurt (unless we're e.g. exceeding the maximal number of command line arguments, but then other packages and especially the Sage library won't build either).",
    "created_at": "2014-05-13T15:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209901",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:7 vbraun]:
> You can override gmpdir, but then SAGE_LOCAL will be added multiple times to the include/linker path.

... which doesn't hurt (unless we're e.g. exceeding the maximal number of command line arguments, but then other packages and especially the Sage library won't build either).



---

archive/issue_comments_209902.json:
```json
{
    "body": "... or just remove adding `\"$SAGE_LOCAL/...\"` to `CPPFLAGS` and `LDFLAGS` in turn.",
    "created_at": "2014-05-13T15:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209902",
    "user": "https://github.com/nexttime"
}
```

... or just remove adding `"$SAGE_LOCAL/..."` to `CPPFLAGS` and `LDFLAGS` in turn.



---

archive/issue_comments_209903.json:
```json
{
    "body": "These are all equivalent solutions. None has any significant advantage over the others.",
    "created_at": "2014-05-13T16:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209903",
    "user": "https://github.com/vbraun"
}
```

These are all equivalent solutions. None has any significant advantage over the others.



---

archive/issue_comments_209904.json:
```json
{
    "body": "Well, even in Sage ;-) we have the convention\n\n* to only patch upstream if necessary (and submit such patches upstream if appropriate)\n\n* one issue per patch\n\n* ...\n\nIt's tedious and error-prone to later untangle cumulative patches, not to mention reviewing and documentation of patches.",
    "created_at": "2014-05-13T16:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209904",
    "user": "https://github.com/nexttime"
}
```

Well, even in Sage ;-) we have the convention

* to only patch upstream if necessary (and submit such patches upstream if appropriate)

* one issue per patch

* ...

It's tedious and error-prone to later untangle cumulative patches, not to mention reviewing and documentation of patches.



---

archive/issue_comments_209905.json:
```json
{
    "body": "Either off topic or doesn't work here (because its likely to trigger autoconf runs)",
    "created_at": "2014-05-13T16:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209905",
    "user": "https://github.com/vbraun"
}
```

Either off topic or doesn't work here (because its likely to trigger autoconf runs)



---

archive/issue_comments_209906.json:
```json
{
    "body": "http://trac.sagemath.org/ticket/13026#comment:15\n\nTo go triple-safe, touch the autotools-generated files in `spkg-install` after patching.\n\nBut as mentioned, patching the autotools *source* files is not even necessary in this case (although it would make sense to submit such a patch upstream, and hopefully remove it (and only this specific one!) upon one of the next upstream upgrades).\n\nI can't follow what otherwise would be off-topic, but that's probably intended.",
    "created_at": "2014-05-13T18:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209906",
    "user": "https://github.com/nexttime"
}
```

http://trac.sagemath.org/ticket/13026#comment:15

To go triple-safe, touch the autotools-generated files in `spkg-install` after patching.

But as mentioned, patching the autotools *source* files is not even necessary in this case (although it would make sense to submit such a patch upstream, and hopefully remove it (and only this specific one!) upon one of the next upstream upgrades).

I can't follow what otherwise would be off-topic, but that's probably intended.



---

archive/issue_comments_209907.json:
```json
{
    "body": "The `.am` patches are not applied in `spkg-install`, fyi.",
    "created_at": "2014-05-13T18:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209907",
    "user": "https://github.com/vbraun"
}
```

The `.am` patches are not applied in `spkg-install`, fyi.



---

archive/issue_comments_209908.json:
```json
{
    "body": "Replying to [comment:15 vbraun]:\n> The `.am` patches are not applied in `spkg-install`, fyi.\n\nI know, which is IMHO a bad hack anyway.\n\nBut how is this related?",
    "created_at": "2014-05-13T18:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209908",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 vbraun]:
> The `.am` patches are not applied in `spkg-install`, fyi.

I know, which is IMHO a bad hack anyway.

But how is this related?



---

archive/issue_comments_209909.json:
```json
{
    "body": "IMHO all of cddlib is a bad hack. We basically only have it because gfan depends on it.\n\nIn any case, this ticket is about making cddlib compile if there is something in `/usr/local`. Suggestions about how to reorganize the patches and still avoid re-running autoconf are off-topic, as you said.",
    "created_at": "2014-05-13T18:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209909",
    "user": "https://github.com/vbraun"
}
```

IMHO all of cddlib is a bad hack. We basically only have it because gfan depends on it.

In any case, this ticket is about making cddlib compile if there is something in `/usr/local`. Suggestions about how to reorganize the patches and still avoid re-running autoconf are off-topic, as you said.



---

archive/issue_comments_209910.json:
```json
{
    "body": "I'm talking about making the spkg even less maintainable (and distro-unfriendly), which is what you currently IMHO do, for no reason.\n\nThe issue here btw. popped up again because a previous patch got removed upon the last upgrade.",
    "created_at": "2014-05-13T19:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209910",
    "user": "https://github.com/nexttime"
}
```

I'm talking about making the spkg even less maintainable (and distro-unfriendly), which is what you currently IMHO do, for no reason.

The issue here btw. popped up again because a previous patch got removed upon the last upgrade.



---

archive/issue_comments_209911.json:
```json
{
    "body": "No the issue popped up again because replacing the upstream insanity with a sane autotools project was removed.",
    "created_at": "2014-05-13T19:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209911",
    "user": "https://github.com/vbraun"
}
```

No the issue popped up again because replacing the upstream insanity with a sane autotools project was removed.



---

archive/issue_comments_209912.json:
```json
{
    "body": "This is so wrong. Volker's patch is just the minimal work to make it more distro friendly. I would remove the \"export\"s statements from the the top Makefile.am too.\nThat particular mistake is usually not too bad for distro preparing binary packages in a sensible way. But it is ugly as hell.\n\nTo finish with the comments on distro unfriendliness we fortunately start with upstream adding only the piece we deem necessary. We don't start from the sage spkg unless there is no other sources around :)\n\nI am a bit uncomfortable with the way autotools patches are applied and enforced but I can  accept that. I am more to apply the full autotool solution that could be pushed upstream if they were responsive rather than the quick nice fix proposed by Leif.\nSo if I have a deciding vote I am going for Volker.",
    "created_at": "2014-05-13T22:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209912",
    "user": "https://github.com/kiwifb"
}
```

This is so wrong. Volker's patch is just the minimal work to make it more distro friendly. I would remove the "export"s statements from the the top Makefile.am too.
That particular mistake is usually not too bad for distro preparing binary packages in a sensible way. But it is ugly as hell.

To finish with the comments on distro unfriendliness we fortunately start with upstream adding only the piece we deem necessary. We don't start from the sage spkg unless there is no other sources around :)

I am a bit uncomfortable with the way autotools patches are applied and enforced but I can  accept that. I am more to apply the full autotool solution that could be pushed upstream if they were responsive rather than the quick nice fix proposed by Leif.
So if I have a deciding vote I am going for Volker.



---

archive/issue_comments_209913.json:
```json
{
    "body": "Replying to [comment:20 fbissey]:\n> To finish with the comments on distro unfriendliness we fortunately start with upstream adding only the piece we deem necessary. We don't start from the sage spkg unless there is no other sources around :)\n\nTo clarify, I'm not against patching the autotools files, I'm against mixing completely unrelated patches.  Especially if we want to submit *parts of it* upstream.  (And it's easy to make sure they get applied in the correct order if at all relevant.  Same for timestamps if patched files depend on other patched files.)\n\nAnd I'm sorry to say, but unfortunately Gentoo still isn't the only distro. ;-)\n\nOthers prefer to have `patches/fix_upstream_bug_{foo,bar}.patch`, `patches/add_sage_functionality_baz.patch` rather than `patches/modifying_{this,that}_file_for_a_couple_of_reason_you_can_probably_guess.patch`. \n\nEven for just Sage, the former is by far more easy to maintain.\n\n\n\n\n> I am a bit uncomfortable with the way autotools patches are applied and enforced but I can  accept that. I am more to apply the full autotool solution that could be pushed upstream if they were responsive rather than the quick nice fix proposed by Leif.\n> So if I have a deciding vote I am going for Volker.\n\nYou have it, just give it positive review if you really feel it's *the right thing*<sup>TM</sup> to do.  Also in the light of #15871.\n\nAlthough the Debianists should probably speak up, too.",
    "created_at": "2014-05-14T09:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209913",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:20 fbissey]:
> To finish with the comments on distro unfriendliness we fortunately start with upstream adding only the piece we deem necessary. We don't start from the sage spkg unless there is no other sources around :)

To clarify, I'm not against patching the autotools files, I'm against mixing completely unrelated patches.  Especially if we want to submit *parts of it* upstream.  (And it's easy to make sure they get applied in the correct order if at all relevant.  Same for timestamps if patched files depend on other patched files.)

And I'm sorry to say, but unfortunately Gentoo still isn't the only distro. ;-)

Others prefer to have `patches/fix_upstream_bug_{foo,bar}.patch`, `patches/add_sage_functionality_baz.patch` rather than `patches/modifying_{this,that}_file_for_a_couple_of_reason_you_can_probably_guess.patch`. 

Even for just Sage, the former is by far more easy to maintain.




> I am a bit uncomfortable with the way autotools patches are applied and enforced but I can  accept that. I am more to apply the full autotool solution that could be pushed upstream if they were responsive rather than the quick nice fix proposed by Leif.
> So if I have a deciding vote I am going for Volker.

You have it, just give it positive review if you really feel it's *the right thing*<sup>TM</sup> to do.  Also in the light of #15871.

Although the Debianists should probably speak up, too.



---

archive/issue_comments_209914.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> Replying to [comment:20 fbissey]:\n> > To finish with the comments on distro unfriendliness we fortunately start with upstream adding only the piece we deem necessary. We don't start from the sage spkg unless there is no other sources around :)\n> \n> To clarify, I'm not against patching the autotools files, I'm against mixing completely unrelated patches.  Especially if we want to submit *parts of it* upstream.  (And it's easy to make sure they get applied in the correct order if at all relevant.  Same for timestamps if patched files depend on other patched files.)\n> \n> And I'm sorry to say, but unfortunately Gentoo still isn't the only distro. ;-)\n> \n\nHow very unfortunate ;) that's why I have to read rpm .spec files from time to time and even troll debian sources.But that was a long and boring dragging comment - the kind you make in the morning because you are gathering your thoughts.\n\n> Others prefer to have `patches/fix_upstream_bug_{foo,bar}.patch`, `patches/add_sage_functionality_baz.patch` rather than `patches/modifying_{this,that}_file_for_a_couple_of_reason_you_can_probably_guess.patch`. \n> \n> Even for just Sage, the former is by far more easy to maintain.\n> \n> \n\n> \n> > I am a bit uncomfortable with the way autotools patches are applied and enforced but I can  accept that. I am more to apply the full autotool solution that could be pushed upstream if they were responsive rather than the quick nice fix proposed by Leif.\n> > So if I have a deciding vote I am going for Volker.\n> \n> You have it, just give it positive review if you really feel it's *the right thing*<sup>TM</sup> to do.  Also in the light of #15871.\n> \n> Although the Debianists should probably speak up, too.\n\nI guess we would need to invite them next time ;)\n\nIn the absence of a nice way to run autoreconf and al. on pristine source (as Gentoo would) it is good enough for me. What we should send upstream and in which form is another discussion.",
    "created_at": "2014-05-14T09:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209914",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:21 leif]:
> Replying to [comment:20 fbissey]:
> > To finish with the comments on distro unfriendliness we fortunately start with upstream adding only the piece we deem necessary. We don't start from the sage spkg unless there is no other sources around :)
> 
> To clarify, I'm not against patching the autotools files, I'm against mixing completely unrelated patches.  Especially if we want to submit *parts of it* upstream.  (And it's easy to make sure they get applied in the correct order if at all relevant.  Same for timestamps if patched files depend on other patched files.)
> 
> And I'm sorry to say, but unfortunately Gentoo still isn't the only distro. ;-)
> 

How very unfortunate ;) that's why I have to read rpm .spec files from time to time and even troll debian sources.But that was a long and boring dragging comment - the kind you make in the morning because you are gathering your thoughts.

> Others prefer to have `patches/fix_upstream_bug_{foo,bar}.patch`, `patches/add_sage_functionality_baz.patch` rather than `patches/modifying_{this,that}_file_for_a_couple_of_reason_you_can_probably_guess.patch`. 
> 
> Even for just Sage, the former is by far more easy to maintain.
> 
> 

> 
> > I am a bit uncomfortable with the way autotools patches are applied and enforced but I can  accept that. I am more to apply the full autotool solution that could be pushed upstream if they were responsive rather than the quick nice fix proposed by Leif.
> > So if I have a deciding vote I am going for Volker.
> 
> You have it, just give it positive review if you really feel it's *the right thing*<sup>TM</sup> to do.  Also in the light of #15871.
> 
> Although the Debianists should probably speak up, too.

I guess we would need to invite them next time ;)

In the absence of a nice way to run autoreconf and al. on pristine source (as Gentoo would) it is good enough for me. What we should send upstream and in which form is another discussion.



---

archive/issue_comments_209915.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-14T09:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209915",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_048173.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-15T17:18:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16111#event-48173"
}
```



---

archive/issue_comments_209916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-15T17:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16111#issuecomment-209916",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
