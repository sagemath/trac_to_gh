# Issue 19783: asymptotic expansion generator: singularity analysis (log-type) without renormalization

archive/issues_019783.json:
```json
{
    "body": "CC:  @behackl @dkrenn\n\nAs a follow-up to #19969, also implement singularity analysis for `(1-z)<sup>(-alpha)*(log(1/(1-z))</sup>beta`, i.e., where the renormalizing factor `1/z`, for integer beta.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20020\n\n",
    "created_at": "2016-02-07T13:50:50Z",
    "labels": [
        "component: asymptotic expansions"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "asymptotic expansion generator: singularity analysis (log-type) without renormalization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19783",
    "user": "https://github.com/cheuberg"
}
```
CC:  @behackl @dkrenn

As a follow-up to #19969, also implement singularity analysis for `(1-z)<sup>(-alpha)*(log(1/(1-z))</sup>beta`, i.e., where the renormalizing factor `1/z`, for integer beta.

Issue created by migration from https://trac.sagemath.org/ticket/20020





---

archive/issue_comments_271527.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2016-02-07T15:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271527",
    "user": "https://github.com/cheuberg"
}
```

Last 10 new commits:



---

archive/issue_comments_271528.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-07T15:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271528",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_271529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-07T16:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271530.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-13T09:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271531.json:
```json
{
    "body": "Merged dependencies.\n----\nLast 10 new commits:",
    "created_at": "2016-02-13T09:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271531",
    "user": "https://github.com/dkrenn"
}
```

Merged dependencies.
----
Last 10 new commits:



---

archive/issue_comments_271532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-13T11:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271533.json:
```json
{
    "body": "From the docstring:\n\n```\n            sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(\n            ....:     'n', 1, alpha=2, beta=2, precision=4) / n\n            log(n)^2 + (2*euler_gamma - 2)*log(n)\n            - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2\n            + n^(-1)*log(n)^2 + O(n^(-1)*log(n))\n\n        Be aware that the last result does *not* coincide with [FS2009]_,\n        they do have a different error term.\n```\n\nI've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.\n\nApart from that, everything looks good.",
    "created_at": "2016-02-13T11:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271533",
    "user": "https://github.com/dkrenn"
}
```

From the docstring:

```
            sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(
            ....:     'n', 1, alpha=2, beta=2, precision=4) / n
            log(n)^2 + (2*euler_gamma - 2)*log(n)
            - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2
            + n^(-1)*log(n)^2 + O(n^(-1)*log(n))

        Be aware that the last result does *not* coincide with [FS2009]_,
        they do have a different error term.
```

I've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.

Apart from that, everything looks good.



---

archive/issue_comments_271534.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-13T11:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271534",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_271535.json:
```json
{
    "body": "Replying to [comment:10 dkrenn]:\n> From the docstring:\n> {{{\n>             sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(\n>             ....:     'n', 1, alpha=2, beta=2, precision=4) / n\n>             log(n)^2 + (2*euler_gamma - 2)*log(n)\n>             - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2\n>             + n<sup>(-1)*log(n)</sup>2 + O(n^(-1)*log(n))\n> \n>         Be aware that the last result does *not* coincide with [FS2009]_,\n>         they do have a different error term.\n> }}}\n> I've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.\nI have run numerical tests (via `compare_with_values`) for \n\n```\nsage: asymptotic_expansions._SingularityAnalysis_non_normalized_(\n....:     'n', 1, alpha=2, beta=2, precision=6)\nn*log(n)^2 + (2*euler_gamma - 2)*n*log(n) + (-2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2)*n + log(n)^2 + (2*euler_gamma + 1)*log(n) + euler_gamma + euler_gamma^2 - 1/6*pi^2 + O(n^(-1)*log(n)^2)\n```\n\nthe result is\n\n```\n[(5000, -0.1171037?),\n (10000, -0.1069521?),\n (15000, -0.101778?),\n (20000, -0.098395?),\n (25000, -0.095920?),\n (30000, -0.093987?),\n (35000, -0.09242?),\n (40000, -0.09109?),\n (45000, -0.08995?),\n (50000, -0.08896?)]\n```\n\nwhich very much supports the additional term here (if it were not here, the renormalization would have multiplied with `n`, which is clearly not occurring).\n\nI therefore submitted this as an erratum at the [book site](http://ac.cs.princeton.edu/errata/).\n\nFor completeness, here is my code for testing.\n\n```\n@cached_function\ndef H(k):\n    \"\"\"\n    Harmonic numbers. Generating function: -log(1-z)/(1-z)\n    \"\"\"\n    if k < 1:\n        return 0\n    else:\n        return 1/k + H(k-1)\n@cached_function\ndef a(k):\n    \"\"\"\n    Coefficients of (-log(1-z))^2: differentiate GF once,\n    obtain 2(-log(1-z))/(1-z), i.e., the harmonic numbers multiplied by 2.\n    Shift and divide by k in order to take differntiation into account.\n    \"\"\"\n    return 2*H(k-1)/k\n@cached_function\ndef sum_a(k):\n    \"\"\"\n    Summatory function of a(k), thus GF (-log(1-z))^2/(1-z).\n    \"\"\"\n    if k<1:\n        return 0\n    else:\n        return sum_a(k-1)+a(k)\n@cached_function\ndef sum_sum_a(k):\n    \"\"\"\n    Summatory function of sum_a(k), thus GF (-log(1-z))^2/(1-z)^2.\n    \"\"\"\n    if k<1:\n        return 0\n    else:\n        return sum_sum_a(k-1)+sum_a(k)\nR.<z> = PowerSeriesRing(QQ, default_prec=100)\nassert (log(1/(1-z)))^2 - sum(z^n*2*H(n-1)/n for n in range(1, 101)) == O(z^101)\nassert (log(1/(1-z))/(1-z))^2 - sum(z^n*sum_sum_a(n) for n in range(1, 101)) == O(z^101)\n%time result = [sum_sum_a(_) > 0 for _ in range(100, 50001, 100)]\nae = asymptotic_expansions._SingularityAnalysis_non_normalized_('n', 1, alpha=2, beta=2, precision=6); ae\nae.compare_with_values('n', sum_sum_a, srange(5000, 50001, 5000))\n```\n",
    "created_at": "2016-02-13T15:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271535",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:10 dkrenn]:
> From the docstring:
> {{{
>             sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(
>             ....:     'n', 1, alpha=2, beta=2, precision=4) / n
>             log(n)^2 + (2*euler_gamma - 2)*log(n)
>             - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2
>             + n<sup>(-1)*log(n)</sup>2 + O(n^(-1)*log(n))
> 
>         Be aware that the last result does *not* coincide with [FS2009]_,
>         they do have a different error term.
> }}}
> I've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.
I have run numerical tests (via `compare_with_values`) for 

```
sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(
....:     'n', 1, alpha=2, beta=2, precision=6)
n*log(n)^2 + (2*euler_gamma - 2)*n*log(n) + (-2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2)*n + log(n)^2 + (2*euler_gamma + 1)*log(n) + euler_gamma + euler_gamma^2 - 1/6*pi^2 + O(n^(-1)*log(n)^2)
```

the result is

```
[(5000, -0.1171037?),
 (10000, -0.1069521?),
 (15000, -0.101778?),
 (20000, -0.098395?),
 (25000, -0.095920?),
 (30000, -0.093987?),
 (35000, -0.09242?),
 (40000, -0.09109?),
 (45000, -0.08995?),
 (50000, -0.08896?)]
```

which very much supports the additional term here (if it were not here, the renormalization would have multiplied with `n`, which is clearly not occurring).

I therefore submitted this as an erratum at the [book site](http://ac.cs.princeton.edu/errata/).

For completeness, here is my code for testing.

```
@cached_function
def H(k):
    """
    Harmonic numbers. Generating function: -log(1-z)/(1-z)
    """
    if k < 1:
        return 0
    else:
        return 1/k + H(k-1)
@cached_function
def a(k):
    """
    Coefficients of (-log(1-z))^2: differentiate GF once,
    obtain 2(-log(1-z))/(1-z), i.e., the harmonic numbers multiplied by 2.
    Shift and divide by k in order to take differntiation into account.
    """
    return 2*H(k-1)/k
@cached_function
def sum_a(k):
    """
    Summatory function of a(k), thus GF (-log(1-z))^2/(1-z).
    """
    if k<1:
        return 0
    else:
        return sum_a(k-1)+a(k)
@cached_function
def sum_sum_a(k):
    """
    Summatory function of sum_a(k), thus GF (-log(1-z))^2/(1-z)^2.
    """
    if k<1:
        return 0
    else:
        return sum_sum_a(k-1)+sum_a(k)
R.<z> = PowerSeriesRing(QQ, default_prec=100)
assert (log(1/(1-z)))^2 - sum(z^n*2*H(n-1)/n for n in range(1, 101)) == O(z^101)
assert (log(1/(1-z))/(1-z))^2 - sum(z^n*sum_sum_a(n) for n in range(1, 101)) == O(z^101)
%time result = [sum_sum_a(_) > 0 for _ in range(100, 50001, 100)]
ae = asymptotic_expansions._SingularityAnalysis_non_normalized_('n', 1, alpha=2, beta=2, precision=6); ae
ae.compare_with_values('n', sum_sum_a, srange(5000, 50001, 5000))
```




---

archive/issue_comments_271536.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-15T19:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19783#issuecomment-271536",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
