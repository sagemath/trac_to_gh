# Issue 24471: ratpoints fails to build with clang on ubuntu

Issue created by migration from https://trac.sagemath.org/ticket/24708

Original creator: SimonKing

Original creation time: 2018-02-11 10:35:37

Keywords: ratpoints clang

I attempted to build Sage with clang, with `CC=clang CXX="clang++ -I/usr/include/libcxxabi/ --stdlib=libc++" make`. Note that fpylll does not complain (see #24707).

I get two failing packages: sagelib (see #24705) and ratpoints. Here is the 
[ratpoints log](http://users.minet.uni-jena.de/cohomology/logs/ratpoints-2.1.3.p4.log) I guess the ratpoints developers should be contacted, but I don't know how.


---

Comment by jdemeyer created at 2018-02-11 10:58:07

Ratpoints is deprecated. We only include it in Sage for historical reasons.


---

Comment by SimonKing created at 2018-02-11 10:58:59

Replying to [comment:1 jdemeyer]:
> Ratpoints is deprecated. We only include it in Sage for historical reasons.

OK, but it is still a standard package and is supposed to work, right?


---

Comment by jdemeyer created at 2018-02-11 11:03:21

It depends. We might as well make it optional. But that would need a discussion on sage-devel.


---

Comment by cremona created at 2018-02-11 11:51:51

Why is ratpoints deprecated?   It does something which as far as I know is not done elsewhere, and does it efficiently.

The ratpoints author is Michael Stoll (Bayreuth).


---

Comment by jdemeyer created at 2018-02-11 21:23:37

Replying to [comment:4 cremona]:
> Why is ratpoints deprecated?   It does something which as far as I know is not done elsewhere, and does it efficiently.

See #24531. That ticket hasn't actually been merged yet, I thought it was.


---

Comment by cremona created at 2018-02-12 09:11:26

Replying to [comment:5 jdemeyer]:
> Replying to [comment:4 cremona]:
> > Why is ratpoints deprecated?   It does something which as far as I know is not done elsewhere, and does it efficiently.
> 
> See #24531. That ticket hasn't actually been merged yet, I thought it was.

OK thanks for telling me!   I always intended to adapt eclib to use ratpoints -- for years it has used an adaptation of a very old version, integrated into eclib code, and since ratpoints developed I never spent the time to just use it (the stumbling block for me was to convert NTL integers into gmp integers, no doubt a trivial task to someone who knows what to do).  Now that task becomes a different one.


---

Comment by jdemeyer created at 2018-02-12 11:43:34

Replying to [comment:6 cremona]:
> Now that task becomes a different one.

Converting PARI integers to gmp integers? :-) You may be interested in the [paritwine library](http://www.multiprecision.org/paritwine/home.html)

One gotcha I encountered in #24531: the original version of ratpoints was checking for _projective_ points, while the PARI version only checks for _affine_ points. Not a big deal, but that difference was initially causing some mysterious failures in #24531.


---

Comment by dimpase created at 2018-02-13 09:46:05

The error points at a GCC-specific macro `__builtin_ia32_andps` being used.
Not sure if it's inside ratpoints, or wrong a header being pulled in.
(I'm away from the computer till Thurs)


----

Regarding deprecating ratpoints - could one point me out where this was decided?
(Yes, there is #24531, which I find a bit too quick).

IMHO it's good to have more than one working implementation of tricky functionality.

Last time I did changes to ratpoints (on #12473) I reported them upstream.
Perhaps I should ping for a new release...


---

Comment by cremona created at 2018-02-13 09:49:57

Replying to [comment:8 dimpase]:
> The error points at a GCC-specific macro `__builtin_ia32_andps` being used.
> Not sure if it's inside ratpoints, or wrong a header being pulled in.
> (I'm away from the computer till Thurs)

That macro is in ratpoints in the source file rp-private.h:


```
#define AND(a,b) ((ratpoints_bit_array)__builtin_ia32_andps((__v4sf)(a), (__v4sf)(b)))
```


which does not look hard to avoid.


> 
> 
> ----
> 
> Regarding deprecating ratpoints - could one point me out where this was decided?
> (Yes, there is #24531, which I find a bit too quick).
> 
> IMHO it's good to have more than one working implementation of tricky functionality.
> 
> Last time I did changes to ratpoints (on #12473) I reported them upstream.
> Perhaps I should ping for a new release...


---

Comment by jdemeyer created at 2018-02-13 10:48:47

Replying to [comment:8 dimpase]:
> IMHO it's good to have more than one working implementation of tricky functionality.

The PARI implementation and ratpoints implementation are not independent, PARI essentially copied the ratpoints code. Anyway, this should be discussed on #24531.
