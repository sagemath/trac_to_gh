# Issue 21028: pynac does not build on Cygwin

archive/issues_021028.json:
```json
{
    "body": "CC:  embray jpflori gouezel rws\n\npynac-0.6.8 fails on 7.4.beta0 with multiple definition of functions such as\n\n```\n.libs/libpynac_la-lst.o: In function `std::_List_const_iterator<GiNaC::ex>::operator++()':\n/home/Travis/sage/local/var/tmp/sage/build/pynac-0.6.8/src/ginac/container.h:521: multiple definition of `GiNaC::container<std::list>::info(unsigned int) const'\n.libs/libpynac_la-inifcns_trans.o:/home/Travis/sage/local/var/tmp/sage/build/pynac-0.6.8/src/ginac/container.h:365: first defined here\ncollect2: error: ld returned 1 exit status\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21265\n\n",
    "created_at": "2016-08-17T14:15:18Z",
    "labels": [
        "porting: Cygwin",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "pynac does not build on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21028",
    "user": "tscrim"
}
```
CC:  embray jpflori gouezel rws

pynac-0.6.8 fails on 7.4.beta0 with multiple definition of functions such as

```
.libs/libpynac_la-lst.o: In function `std::_List_const_iterator<GiNaC::ex>::operator++()':
/home/Travis/sage/local/var/tmp/sage/build/pynac-0.6.8/src/ginac/container.h:521: multiple definition of `GiNaC::container<std::list>::info(unsigned int) const'
.libs/libpynac_la-inifcns_trans.o:/home/Travis/sage/local/var/tmp/sage/build/pynac-0.6.8/src/ginac/container.h:365: first defined here
collect2: error: ld returned 1 exit status
```


Issue created by migration from https://trac.sagemath.org/ticket/21265





---

archive/issue_comments_291388.json:
```json
{
    "body": "Confirmed the same.",
    "created_at": "2016-08-29T14:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291388",
    "user": "embray"
}
```

Confirmed the same.



---

archive/issue_comments_291389.json:
```json
{
    "body": "This looks to be related to this: http://www.ginac.de/ginac.git/?p=ginac.git;a=commit;h=e5eeee53d814cedc12cd725e76b0eb87859cdd77  But in a different incarnation since (I think?) the ginac that the current pynac is based on is much older?\n\nNot entirely sure why it only appears on Windows, but it wouldn't be the first time that the different linking routines used on Windows expose link issues that don't necessarily appear elsewhere (even if maybe they should).",
    "created_at": "2016-08-29T15:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291389",
    "user": "embray"
}
```

This looks to be related to this: http://www.ginac.de/ginac.git/?p=ginac.git;a=commit;h=e5eeee53d814cedc12cd725e76b0eb87859cdd77  But in a different incarnation since (I think?) the ginac that the current pynac is based on is much older?

Not entirely sure why it only appears on Windows, but it wouldn't be the first time that the different linking routines used on Windows expose link issues that don't necessarily appear elsewhere (even if maybe they should).



---

archive/issue_comments_291390.json:
```json
{
    "body": "That could be the cause. IDK how much changed in the latest upgrade of Pynac. Ralf, do you have any thoughts on this?",
    "created_at": "2016-08-29T15:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291390",
    "user": "tscrim"
}
```

That could be the cause. IDK how much changed in the latest upgrade of Pynac. Ralf, do you have any thoughts on this?



---

archive/issue_comments_291391.json:
```json
{
    "body": "Was there a version that compiled?",
    "created_at": "2016-08-29T15:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291391",
    "user": "rws"
}
```

Was there a version that compiled?



---

archive/issue_comments_291392.json:
```json
{
    "body": "I recall that some version somewhere in the 7.2 betas worked for me. Erik and/or JP likely have more precise details. Erik had compiled Sage on Cygwin64, which I believe was using 7.3, so probably the Pynac version just before 0.6.8 (which was included in 7.4.beta0). Please correct me if I'm wrong.",
    "created_at": "2016-08-29T15:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291392",
    "user": "tscrim"
}
```

I recall that some version somewhere in the 7.2 betas worked for me. Erik and/or JP likely have more precise details. Erik had compiled Sage on Cygwin64, which I believe was using 7.3, so probably the Pynac version just before 0.6.8 (which was included in 7.4.beta0). Please correct me if I'm wrong.



---

archive/issue_comments_291393.json:
```json
{
    "body": "I can check against 7.3 tonight (I need my machine on my Ubuntu boot to do my work for today).",
    "created_at": "2016-08-29T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291393",
    "user": "tscrim"
}
```

I can check against 7.3 tonight (I need my machine on my Ubuntu boot to do my work for today).



---

archive/issue_comments_291394.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-29T16:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291394",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_291395.json:
```json
{
    "body": "Here's a working patch--this doesn't apply to ginac where all incarnations of this issue are already fixed.\n\nI'm not sure what the procedure here is though.  Since we basically control pynac should the issue just be fixed in pynac, and pynac upgraded in Sage?  Or does it still make sense at this stage to have a patch to pynac in Sage?\n----\nNew commits:",
    "created_at": "2016-08-29T16:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291395",
    "user": "embray"
}
```

Here's a working patch--this doesn't apply to ginac where all incarnations of this issue are already fixed.

I'm not sure what the procedure here is though.  Since we basically control pynac should the issue just be fixed in pynac, and pynac upgraded in Sage?  Or does it still make sense at this stage to have a patch to pynac in Sage?
----
New commits:



---

archive/issue_comments_291396.json:
```json
{
    "body": "I can confirm also that before pynac 0.6.8 it worked.",
    "created_at": "2016-08-29T16:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291396",
    "user": "embray"
}
```

I can confirm also that before pynac 0.6.8 it worked.



---

archive/issue_comments_291397.json:
```json
{
    "body": "Ralf, do you want to cut a new release of Pynac for this or should we just include this as a Sage patch for now?",
    "created_at": "2016-08-29T16:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291397",
    "user": "tscrim"
}
```

Ralf, do you want to cut a new release of Pynac for this or should we just include this as a Sage patch for now?



---

archive/issue_comments_291398.json:
```json
{
    "body": "I wanted to do a new release tomorrow anyway. We can close this ticket after new Pynac is in Sage.\n\nThanks for the patch, authorship will be recognized.",
    "created_at": "2016-08-29T17:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291398",
    "user": "rws"
}
```

I wanted to do a new release tomorrow anyway. We can close this ticket after new Pynac is in Sage.

Thanks for the patch, authorship will be recognized.



---

archive/issue_comments_291399.json:
```json
{
    "body": "Sounds good to me.",
    "created_at": "2016-08-29T17:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291399",
    "user": "embray"
}
```

Sounds good to me.



---

archive/issue_comments_291400.json:
```json
{
    "body": "~~In any case it turns out my patch to `spkg-install` misused some variables in such a way that somehow caused the build to be skipped, while not producing any actual errors; this was very confusing.  That said, I had already confirmed that pynac does build properly with the patch--it's only the `spkg-install` itself that I messed up.~~\n\nScratch that. That doesn't seem to be it either.  For some reason every time I try to reinstall pynac now it's just a no-op.  It doesn't even run the `spkg-install`.  I've never seen this happen before.",
    "created_at": "2016-08-29T17:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291400",
    "user": "embray"
}
```

~~In any case it turns out my patch to `spkg-install` misused some variables in such a way that somehow caused the build to be skipped, while not producing any actual errors; this was very confusing.  That said, I had already confirmed that pynac does build properly with the patch--it's only the `spkg-install` itself that I messed up.~~

Scratch that. That doesn't seem to be it either.  For some reason every time I try to reinstall pynac now it's just a no-op.  It doesn't even run the `spkg-install`.  I've never seen this happen before.



---

archive/issue_comments_291401.json:
```json
{
    "body": "Does this mean the Pynac code changes are not confirmed to resolve the issue?\n\nTo reinstall Pynac (in the sense that `make` will pick it up) after changes/patches outside the tarball the patchlevel must be increased, i.e. `0.6.8.p0` in `package-version.txt`. However, you can skip that by forcing a reinstall with `sage -p pynac; make`.",
    "created_at": "2016-08-30T05:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291401",
    "user": "rws"
}
```

Does this mean the Pynac code changes are not confirmed to resolve the issue?

To reinstall Pynac (in the sense that `make` will pick it up) after changes/patches outside the tarball the patchlevel must be increased, i.e. `0.6.8.p0` in `package-version.txt`. However, you can skip that by forcing a reinstall with `sage -p pynac; make`.



---

archive/issue_comments_291402.json:
```json
{
    "body": "Replying to [comment:13 rws]:\n> Does this mean the Pynac code changes are not confirmed to resolve the issue?\n\nIt is confirmed.  I had already made the changes and built pynac from source (that is actually compiled it).\n\n> To reinstall Pynac (in the sense that `make` will pick it up) after changes/patches outside the tarball the patchlevel must be increased, i.e. `0.6.8.p0` in `package-version.txt`. However, you can skip that by forcing a reinstall with `sage -p pynac; make`.\n\nI did bump the patch level.  I think there's just some subtle bug in my edits to `spkg-install` that's causing it to exit prematurely but without error.  But I confirmed the patch worked manually before making those changes.",
    "created_at": "2016-08-30T07:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291402",
    "user": "embray"
}
```

Replying to [comment:13 rws]:
> Does this mean the Pynac code changes are not confirmed to resolve the issue?

It is confirmed.  I had already made the changes and built pynac from source (that is actually compiled it).

> To reinstall Pynac (in the sense that `make` will pick it up) after changes/patches outside the tarball the patchlevel must be increased, i.e. `0.6.8.p0` in `package-version.txt`. However, you can skip that by forcing a reinstall with `sage -p pynac; make`.

I did bump the patch level.  I think there's just some subtle bug in my edits to `spkg-install` that's causing it to exit prematurely but without error.  But I confirmed the patch worked manually before making those changes.



---

archive/issue_comments_291403.json:
```json
{
    "body": "See #21369.",
    "created_at": "2016-08-30T08:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291403",
    "user": "rws"
}
```

See #21369.



---

archive/issue_comments_291404.json:
```json
{
    "body": "Ah, I see what was wrong.  This made `patch` into an infinite recursion.  For some reason that causes bash to just bail.  Weird.  Anyways it's a moot point, this ticket is superseded by #21369.",
    "created_at": "2016-08-30T09:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291404",
    "user": "embray"
}
```

Ah, I see what was wrong.  This made `patch` into an infinite recursion.  For some reason that causes bash to just bail.  Weird.  Anyways it's a moot point, this ticket is superseded by #21369.



---

archive/issue_comments_291405.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-30T10:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291405",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291406.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2016-08-30T13:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291406",
    "user": "embray"
}
```

Resolution: wontfix



---

archive/issue_comments_291407.json:
```json
{
    "body": "Determined to be invalid/duplicate/wontfix (closing as \"wontfix\" as a catch-all resolution).",
    "created_at": "2016-08-30T13:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21028#issuecomment-291407",
    "user": "embray"
}
```

Determined to be invalid/duplicate/wontfix (closing as "wontfix" as a catch-all resolution).
