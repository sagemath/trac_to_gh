# Issue 21028: pynac does not build on Cygwin

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2016-08-17 14:15:18

CC:  embray jpflori gouezel rws

pynac-0.6.8 fails on 7.4.beta0 with multiple definition of functions such as

```
.libs/libpynac_la-lst.o: In function `std::_List_const_iterator<GiNaC::ex>::operator++()':
/home/Travis/sage/local/var/tmp/sage/build/pynac-0.6.8/src/ginac/container.h:521: multiple definition of `GiNaC::container<std::list>::info(unsigned int) const'
.libs/libpynac_la-inifcns_trans.o:/home/Travis/sage/local/var/tmp/sage/build/pynac-0.6.8/src/ginac/container.h:365: first defined here
collect2: error: ld returned 1 exit status
```



---

Comment by embray created at 2016-08-29 14:51:41

Confirmed the same.


---

Comment by embray created at 2016-08-29 15:33:10

This looks to be related to this: http://www.ginac.de/ginac.git/?p=ginac.git;a=commit;h=e5eeee53d814cedc12cd725e76b0eb87859cdd77  But in a different incarnation since (I think?) the ginac that the current pynac is based on is much older?

Not entirely sure why it only appears on Windows, but it wouldn't be the first time that the different linking routines used on Windows expose link issues that don't necessarily appear elsewhere (even if maybe they should).


---

Comment by tscrim created at 2016-08-29 15:37:44

That could be the cause. IDK how much changed in the latest upgrade of Pynac. Ralf, do you have any thoughts on this?


---

Comment by rws created at 2016-08-29 15:45:22

Was there a version that compiled?


---

Comment by tscrim created at 2016-08-29 15:54:47

I recall that some version somewhere in the 7.2 betas worked for me. Erik and/or JP likely have more precise details. Erik had compiled Sage on Cygwin64, which I believe was using 7.3, so probably the Pynac version just before 0.6.8 (which was included in 7.4.beta0). Please correct me if I'm wrong.


---

Comment by tscrim created at 2016-08-29 15:55:53

I can check against 7.3 tonight (I need my machine on my Ubuntu boot to do my work for today).


---

Comment by embray created at 2016-08-29 16:04:09

Changing status from new to needs_review.


---

Comment by embray created at 2016-08-29 16:04:09

Here's a working patch--this doesn't apply to ginac where all incarnations of this issue are already fixed.

I'm not sure what the procedure here is though.  Since we basically control pynac should the issue just be fixed in pynac, and pynac upgraded in Sage?  Or does it still make sense at this stage to have a patch to pynac in Sage?
----
New commits:


---

Comment by embray created at 2016-08-29 16:04:42

I can confirm also that before pynac 0.6.8 it worked.


---

Comment by tscrim created at 2016-08-29 16:12:27

Ralf, do you want to cut a new release of Pynac for this or should we just include this as a Sage patch for now?


---

Comment by rws created at 2016-08-29 17:08:40

I wanted to do a new release tomorrow anyway. We can close this ticket after new Pynac is in Sage.

Thanks for the patch, authorship will be recognized.


---

Comment by embray created at 2016-08-29 17:14:05

Sounds good to me.


---

Comment by embray created at 2016-08-29 17:31:39

~~In any case it turns out my patch to `spkg-install` misused some variables in such a way that somehow caused the build to be skipped, while not producing any actual errors; this was very confusing.  That said, I had already confirmed that pynac does build properly with the patch--it's only the `spkg-install` itself that I messed up.~~

Scratch that. That doesn't seem to be it either.  For some reason every time I try to reinstall pynac now it's just a no-op.  It doesn't even run the `spkg-install`.  I've never seen this happen before.


---

Comment by rws created at 2016-08-30 05:23:27

Does this mean the Pynac code changes are not confirmed to resolve the issue?

To reinstall Pynac (in the sense that `make` will pick it up) after changes/patches outside the tarball the patchlevel must be increased, i.e. `0.6.8.p0` in `package-version.txt`. However, you can skip that by forcing a reinstall with `sage -p pynac; make`.


---

Comment by embray created at 2016-08-30 07:52:46

Replying to [comment:13 rws]:
> Does this mean the Pynac code changes are not confirmed to resolve the issue?

It is confirmed.  I had already made the changes and built pynac from source (that is actually compiled it).

> To reinstall Pynac (in the sense that `make` will pick it up) after changes/patches outside the tarball the patchlevel must be increased, i.e. `0.6.8.p0` in `package-version.txt`. However, you can skip that by forcing a reinstall with `sage -p pynac; make`.

I did bump the patch level.  I think there's just some subtle bug in my edits to `spkg-install` that's causing it to exit prematurely but without error.  But I confirmed the patch worked manually before making those changes.


---

Comment by rws created at 2016-08-30 08:42:25

See #21369.


---

Comment by embray created at 2016-08-30 09:01:54

Ah, I see what was wrong.  This made `patch` into an infinite recursion.  For some reason that causes bash to just bail.  Weird.  Anyways it's a moot point, this ticket is superseded by #21369.


---

Comment by jdemeyer created at 2016-08-30 10:01:16

Changing status from needs_review to positive_review.


---

Comment by embray created at 2016-08-30 13:32:25

Resolution: wontfix


---

Comment by embray created at 2016-08-30 13:32:25

Determined to be invalid/duplicate/wontfix (closing as "wontfix" as a catch-all resolution).
